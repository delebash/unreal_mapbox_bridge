import{r as ref,i as isRuntimeSsrPreHydration,o as onMounted,c as createComponent,g as getCurrentInstance,a as onBeforeUnmount,n as noop,b as nextTick,h,l as listenOpts,d as inject,e as emptyRenderFn,f as computed,w as watch,j as hUniqueSlot,k as layoutKey,P as Platform,m as createDirective,p as client$1,q as leftClick,s as addEvt,t as preventDraggable,u as prevent,v as stop,x as position,y as cleanEvt,z as stopAndPrevent,A as useModelToggleProps,B as useDarkProps,C as useModelToggleEmits,D as useDark,E as useTimeout,F as useModelToggle,G as useHistory,H as withDirectives,I as hDir,J as hSlot,K as usePreventScroll,L as tabsKey,R as Ripple,M as isKeyCode,N as shouldIgnoreKey,Q as QIcon,O as hMergeSlot,S as isDeepEqual,T as uid$1,U as useTick,V as provide,W as onDeactivated,X as onActivated,Y as Transition,Z as getNormalizedVNodes,_ as KeepAlive,$ as useFieldProps,a0 as useFieldEmits,a1 as useField,a2 as useFieldState,a3 as useSizeProps,a4 as useSize,a5 as hMergeSlotSafely,a6 as useRouterLinkProps,a7 as useRouterLink,a8 as portalProxyList,a9 as getScrollbarWidth,aa as useTransitionProps,ab as useTransition,ac as usePortal,ad as addFocusout,ae as removeFocusout,af as removeEscapeKey,ag as getScrollTarget,ah as closePortalMenus,ai as addFocusFn,aj as addEscapeKey,ak as childHasFocus,al as debounce$2,am as onBeforeMount,an as useFormProps,ao as useFormInputNameAttr,ap as fieldValueIsFilled,aq as onBeforeUpdate,ar as onUpdated,as as useKeyComposition,at as QDialog,au as injectProp,av as QBtn,aw as vmHasRouter,ax as History,ay as isNumber$1,az as isDate,aA as isObject$6,aB as injectMultipleProps,aC as QCheckbox,aD as QSeparator,aE as pageContainerKey,aF as getVerticalScrollPosition,aG as getHorizontalScrollPosition,aH as reactive,aI as onUnmounted,aJ as getPortalProxy,aK as closePortals,aL as quasarKey,aM as _export_sfc,aN as openBlock,aO as createElementBlock,aP as createBaseVNode,aQ as createVNode,aR as withCtx,aS as QOptionGroup,aT as createTextVNode,aU as toDisplayString,aV as QCard,aW as QCardSection,aX as QCardActions,aY as Fragment,aZ as pushScopeId,a_ as popScopeId,a$ as QSpinner,b0 as toRaw,b1 as vShow,b2 as QInput,b3 as createBlock,b4 as isProxy,b5 as Notify,b6 as resolveComponent,b7 as createCommentVNode,b8 as withKeys}from"./index-9be27da1.js";import{Q as QPage}from"./QPage-2efbd3cb.js";function _mergeNamespaces(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(n,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function useCanRender(){const e=ref(!isRuntimeSsrPreHydration.value);return e.value===!1&&onMounted(()=>{e.value=!0}),e}const hasObserver=typeof ResizeObserver<"u",resizeProps=hasObserver===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},QResizeObserver=createComponent({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:t}){let r=null,n,a={width:-1,height:-1};function s(x){x===!0||e.debounce===0||e.debounce==="0"?f():r===null&&(r=setTimeout(f,e.debounce))}function f(){if(r!==null&&(clearTimeout(r),r=null),n){const{offsetWidth:x,offsetHeight:C}=n;(x!==a.width||C!==a.height)&&(a={width:x,height:C},t("resize",a))}}const{proxy:o}=getCurrentInstance();if(hasObserver===!0){let x;const C=P=>{n=o.$el.parentNode,n?(x=new ResizeObserver(s),x.observe(n),f()):P!==!0&&nextTick(()=>{C(!0)})};return onMounted(()=>{C()}),onBeforeUnmount(()=>{r!==null&&clearTimeout(r),x!==void 0&&(x.disconnect!==void 0?x.disconnect():n&&x.unobserve(n))}),noop}else{let P=function(){r!==null&&(clearTimeout(r),r=null),C!==void 0&&(C.removeEventListener!==void 0&&C.removeEventListener("resize",s,listenOpts.passive),C=void 0)},Y=function(){P(),n&&n.contentDocument&&(C=n.contentDocument.defaultView,C.addEventListener("resize",s,listenOpts.passive),f())};const x=useCanRender();let C;return onMounted(()=>{nextTick(()=>{n=o.$el,n&&Y()})}),onBeforeUnmount(P),o.trigger=s,()=>{if(x.value===!0)return h("object",{style:resizeProps.style,tabindex:-1,type:"text/html",data:resizeProps.url,"aria-hidden":"true",onLoad:Y})}}}}),QHeader=createComponent({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=inject(layoutKey,emptyRenderFn);if(a===emptyRenderFn)return console.error("QHeader needs to be child of QLayout"),emptyRenderFn;const s=ref(parseInt(e.heightHint,10)),f=ref(!0),o=computed(()=>e.reveal===!0||a.view.value.indexOf("H")>-1||n.platform.is.ios&&a.isContainer.value===!0),x=computed(()=>{if(e.modelValue!==!0)return 0;if(o.value===!0)return f.value===!0?s.value:0;const rl=s.value-a.scroll.value.position;return rl>0?rl:0}),C=computed(()=>e.modelValue!==!0||o.value===!0&&f.value!==!0),P=computed(()=>e.modelValue===!0&&C.value===!0&&e.reveal===!0),Y=computed(()=>"q-header q-layout__section--marginal "+(o.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(C.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),ze=computed(()=>{const rl=a.rows.value.top,Co={};return rl[0]==="l"&&a.left.space===!0&&(Co[n.lang.rtl===!0?"right":"left"]=`${a.left.size}px`),rl[2]==="r"&&a.right.space===!0&&(Co[n.lang.rtl===!0?"left":"right"]=`${a.right.size}px`),Co});function ge(rl,Co){a.update("header",rl,Co)}function Bt(rl,Co){rl.value!==Co&&(rl.value=Co)}function Ur({height:rl}){Bt(s,rl),ge("size",rl)}function kn(rl){P.value===!0&&Bt(f,!0),r("focusin",rl)}watch(()=>e.modelValue,rl=>{ge("space",rl),Bt(f,!0),a.animate()}),watch(x,rl=>{ge("offset",rl)}),watch(()=>e.reveal,rl=>{rl===!1&&Bt(f,e.modelValue)}),watch(f,rl=>{a.animate(),r("reveal",rl)}),watch(a.scroll,rl=>{e.reveal===!0&&Bt(f,rl.direction==="up"||rl.position<=e.revealOffset||rl.position-rl.inflectionPoint<100)});const Io={};return a.instances.header=Io,e.modelValue===!0&&ge("size",s.value),ge("space",e.modelValue),ge("offset",x.value),onBeforeUnmount(()=>{a.instances.header===Io&&(a.instances.header=void 0,ge("size",0),ge("offset",0),ge("space",!1))}),()=>{const rl=hUniqueSlot(t.default,[]);return e.elevated===!0&&rl.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),rl.push(h(QResizeObserver,{debounce:0,onResize:Ur})),h("header",{class:Y.value,style:ze.value,onFocusin:kn},rl)}}}),modifiersAll={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},directionList=Object.keys(modifiersAll);modifiersAll.all=!0;function getModifierDirections(e){const t={};for(const r of directionList)e[r]===!0&&(t[r]=!0);return Object.keys(t).length===0?modifiersAll:(t.horizontal===!0?t.left=t.right=!0:t.left===!0&&t.right===!0&&(t.horizontal=!0),t.vertical===!0?t.up=t.down=!0:t.up===!0&&t.down===!0&&(t.vertical=!0),t.horizontal===!0&&t.vertical===!0&&(t.all=!0),t)}const avoidNodeNamesList=["INPUT","TEXTAREA"];function shouldStart(e,t){return t.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof t.handler=="function"&&avoidNodeNamesList.includes(e.target.nodeName.toUpperCase())===!1&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(t.uid)===-1)}function clearSelection(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),Platform.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}function getChanges(e,t,r){const n=position(e);let a,s=n.left-t.event.x,f=n.top-t.event.y,o=Math.abs(s),x=Math.abs(f);const C=t.direction;C.horizontal===!0&&C.vertical!==!0?a=s<0?"left":"right":C.horizontal!==!0&&C.vertical===!0?a=f<0?"up":"down":C.up===!0&&f<0?(a="up",o>x&&(C.left===!0&&s<0?a="left":C.right===!0&&s>0&&(a="right"))):C.down===!0&&f>0?(a="down",o>x&&(C.left===!0&&s<0?a="left":C.right===!0&&s>0&&(a="right"))):C.left===!0&&s<0?(a="left",o<x&&(C.up===!0&&f<0?a="up":C.down===!0&&f>0&&(a="down"))):C.right===!0&&s>0&&(a="right",o<x&&(C.up===!0&&f<0?a="up":C.down===!0&&f>0&&(a="down")));let P=!1;if(a===void 0&&r===!1){if(t.event.isFirst===!0||t.event.lastDir===void 0)return{};a=t.event.lastDir,P=!0,a==="left"||a==="right"?(n.left-=s,o=0,s=0):(n.top-=f,x=0,f=0)}return{synthetic:P,payload:{evt:e,touch:t.event.mouse!==!0,mouse:t.event.mouse===!0,position:n,direction:a,isFirst:t.event.isFirst,isFinal:r===!0,duration:Date.now()-t.event.time,distance:{x:o,y:x},offset:{x:s,y:f},delta:{x:n.left-t.event.lastX,y:n.top-t.event.lastY}}}}let uid=0;const TouchPan=createDirective({name:"touch-pan",beforeMount(e,{value:t,modifiers:r}){if(r.mouse!==!0&&client$1.has.touch!==!0)return;function n(s,f){r.mouse===!0&&f===!0?stopAndPrevent(s):(r.stop===!0&&stop(s),r.prevent===!0&&prevent(s))}const a={uid:"qvtp_"+uid++,handler:t,modifiers:r,direction:getModifierDirections(r),noop,mouseStart(s){shouldStart(s,a)&&leftClick(s)&&(addEvt(a,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),a.start(s,!0))},touchStart(s){if(shouldStart(s,a)){const f=s.target;addEvt(a,"temp",[[f,"touchmove","move","notPassiveCapture"],[f,"touchcancel","end","passiveCapture"],[f,"touchend","end","passiveCapture"]]),a.start(s)}},start(s,f){if(client$1.is.firefox===!0&&preventDraggable(e,!0),a.lastEvt=s,f===!0||r.stop===!0){if(a.direction.all!==!0&&(f!==!0||a.modifiers.mouseAllDir!==!0&&a.modifiers.mousealldir!==!0)){const C=s.type.indexOf("mouse")>-1?new MouseEvent(s.type,s):new TouchEvent(s.type,s);s.defaultPrevented===!0&&prevent(C),s.cancelBubble===!0&&stop(C),Object.assign(C,{qKeyEvent:s.qKeyEvent,qClickOutside:s.qClickOutside,qAnchorHandled:s.qAnchorHandled,qClonedBy:s.qClonedBy===void 0?[a.uid]:s.qClonedBy.concat(a.uid)}),a.initialEvent={target:s.target,event:C}}stop(s)}const{left:o,top:x}=position(s);a.event={x:o,y:x,time:Date.now(),mouse:f===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:o,lastY:x}},move(s){if(a.event===void 0)return;const f=position(s),o=f.left-a.event.x,x=f.top-a.event.y;if(o===0&&x===0)return;a.lastEvt=s;const C=a.event.mouse===!0,P=()=>{n(s,C);let ge;r.preserveCursor!==!0&&r.preservecursor!==!0&&(ge=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),C===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),a.styleCleanup=Bt=>{if(a.styleCleanup=void 0,ge!==void 0&&(document.documentElement.style.cursor=ge),document.body.classList.remove("non-selectable"),C===!0){const Ur=()=>{document.body.classList.remove("no-pointer-events--children")};Bt!==void 0?setTimeout(()=>{Ur(),Bt()},50):Ur()}else Bt!==void 0&&Bt()}};if(a.event.detected===!0){a.event.isFirst!==!0&&n(s,a.event.mouse);const{payload:ge,synthetic:Bt}=getChanges(s,a,!1);ge!==void 0&&(a.handler(ge)===!1?a.end(s):(a.styleCleanup===void 0&&a.event.isFirst===!0&&P(),a.event.lastX=ge.position.left,a.event.lastY=ge.position.top,a.event.lastDir=Bt===!0?void 0:ge.direction,a.event.isFirst=!1));return}if(a.direction.all===!0||C===!0&&(a.modifiers.mouseAllDir===!0||a.modifiers.mousealldir===!0)){P(),a.event.detected=!0,a.move(s);return}const Y=Math.abs(o),ze=Math.abs(x);Y!==ze&&(a.direction.horizontal===!0&&Y>ze||a.direction.vertical===!0&&Y<ze||a.direction.up===!0&&Y<ze&&x<0||a.direction.down===!0&&Y<ze&&x>0||a.direction.left===!0&&Y>ze&&o<0||a.direction.right===!0&&Y>ze&&o>0?(a.event.detected=!0,a.move(s)):a.end(s,!0))},end(s,f){if(a.event!==void 0){if(cleanEvt(a,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),f===!0)a.styleCleanup!==void 0&&a.styleCleanup(),a.event.detected!==!0&&a.initialEvent!==void 0&&a.initialEvent.target.dispatchEvent(a.initialEvent.event);else if(a.event.detected===!0){a.event.isFirst===!0&&a.handler(getChanges(s===void 0?a.lastEvt:s,a).payload);const{payload:o}=getChanges(s===void 0?a.lastEvt:s,a,!0),x=()=>{a.handler(o)};a.styleCleanup!==void 0?a.styleCleanup(x):x()}a.event=void 0,a.initialEvent=void 0,a.lastEvt=void 0}}};if(e.__qtouchpan=a,r.mouse===!0){const s=r.mouseCapture===!0||r.mousecapture===!0?"Capture":"";addEvt(a,"main",[[e,"mousedown","mouseStart",`passive${s}`]])}client$1.has.touch===!0&&addEvt(a,"main",[[e,"touchstart","touchStart",`passive${r.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const r=e.__qtouchpan;r!==void 0&&(t.oldValue!==t.value&&(typeof value!="function"&&r.end(),r.handler=t.value),r.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchpan;t!==void 0&&(t.event!==void 0&&t.end(),cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchpan)}});function between(e,t,r){return r<=t?t:Math.min(r,Math.max(t,e))}function normalizeToInterval(e,t,r){if(r<=t)return t;const n=r-t+1;let a=t+(e-t)%n;return a<t&&(a=n+a),a===0?0:a}const duration=150,QDrawer=createComponent({name:"QDrawer",inheritAttrs:!1,props:{...useModelToggleProps,...useDarkProps,side:{type:String,default:"left",validator:e=>["left","right"].includes(e)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:e=>["default","desktop","mobile"].includes(e),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...useModelToggleEmits,"onLayout","miniState"],setup(e,{slots:t,emit:r,attrs:n}){const a=getCurrentInstance(),{proxy:{$q:s}}=a,f=useDark(e,s),{preventBodyScroll:o}=usePreventScroll(),{registerTimeout:x,removeTimeout:C}=useTimeout(),P=inject(layoutKey,emptyRenderFn);if(P===emptyRenderFn)return console.error("QDrawer needs to be child of QLayout"),emptyRenderFn;let Y,ze=null,ge;const Bt=ref(e.behavior==="mobile"||e.behavior!=="desktop"&&P.totalWidth.value<=e.breakpoint),Ur=computed(()=>e.mini===!0&&Bt.value!==!0),kn=computed(()=>Ur.value===!0?e.miniWidth:e.width),Io=ref(e.showIfAbove===!0&&Bt.value===!1?!0:e.modelValue===!0),rl=computed(()=>e.persistent!==!0&&(Bt.value===!0||md.value===!0));function Co(Xh,Ld){if(ch(),Xh!==!1&&P.animate(),jf(0),Bt.value===!0){const Kf=P.instances[ud.value];Kf!==void 0&&Kf.belowBreakpoint===!0&&Kf.hide(!1),yd(1),P.isContainer.value!==!0&&o(!0)}else yd(0),Xh!==!1&&Jd(!1);x(()=>{Xh!==!1&&Jd(!0),Ld!==!0&&r("show",Xh)},duration)}function as(Xh,Ld){Zu(),Xh!==!1&&P.animate(),yd(0),jf(sh.value*kn.value),Qh(),Ld!==!0?x(()=>{r("hide",Xh)},duration):C()}const{show:$s,hide:ah}=useModelToggle({showing:Io,hideOnRouteChange:rl,handleShow:Co,handleHide:as}),{addToHistory:ch,removeFromHistory:Zu}=useHistory(Io,ah,rl),ih={belowBreakpoint:Bt,hide:ah},al=computed(()=>e.side==="right"),sh=computed(()=>(s.lang.rtl===!0?-1:1)*(al.value===!0?1:-1)),_h=ref(0),Ih=ref(!1),Lh=ref(!1),Gh=ref(kn.value*sh.value),ud=computed(()=>al.value===!0?"left":"right"),Tf=computed(()=>Io.value===!0&&Bt.value===!1&&e.overlay===!1?e.miniToOverlay===!0?e.miniWidth:kn.value:0),Kd=computed(()=>e.overlay===!0||e.miniToOverlay===!0||P.view.value.indexOf(al.value?"R":"L")>-1||s.platform.is.ios===!0&&P.isContainer.value===!0),Af=computed(()=>e.overlay===!1&&Io.value===!0&&Bt.value===!1),md=computed(()=>e.overlay===!0&&Io.value===!0&&Bt.value===!1),vd=computed(()=>"fullscreen q-drawer__backdrop"+(Io.value===!1&&Ih.value===!1?" hidden":"")),qd=computed(()=>({backgroundColor:`rgba(0,0,0,${_h.value*.4})`})),Ed=computed(()=>al.value===!0?P.rows.value.top[2]==="r":P.rows.value.top[0]==="l"),Sd=computed(()=>al.value===!0?P.rows.value.bottom[2]==="r":P.rows.value.bottom[0]==="l"),zd=computed(()=>{const Xh={};return P.header.space===!0&&Ed.value===!1&&(Kd.value===!0?Xh.top=`${P.header.offset}px`:P.header.space===!0&&(Xh.top=`${P.header.size}px`)),P.footer.space===!0&&Sd.value===!1&&(Kd.value===!0?Xh.bottom=`${P.footer.offset}px`:P.footer.space===!0&&(Xh.bottom=`${P.footer.size}px`)),Xh}),Md=computed(()=>{const Xh={width:`${kn.value}px`,transform:`translateX(${Gh.value}px)`};return Bt.value===!0?Xh:Object.assign(Xh,zd.value)}),Gd=computed(()=>"q-drawer__content fit "+(P.isContainer.value!==!0?"scroll":"overflow-auto")),bf=computed(()=>`q-drawer q-drawer--${e.side}`+(Lh.value===!0?" q-drawer--mini-animate":"")+(e.bordered===!0?" q-drawer--bordered":"")+(f.value===!0?" q-drawer--dark q-dark":"")+(Ih.value===!0?" no-transition":Io.value===!0?"":" q-layout--prevent-focus")+(Bt.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${Ur.value===!0?"mini":"standard"}`+(Kd.value===!0||Af.value!==!0?" fixed":"")+(e.overlay===!0||e.miniToOverlay===!0?" q-drawer--on-top":"")+(Ed.value===!0?" q-drawer--top-padding":""))),Id=computed(()=>{const Xh=s.lang.rtl===!0?e.side:ud.value;return[[TouchPan,bp,void 0,{[Xh]:!0,mouse:!0}]]}),td=computed(()=>{const Xh=s.lang.rtl===!0?ud.value:e.side;return[[TouchPan,fp,void 0,{[Xh]:!0,mouse:!0}]]}),Fd=computed(()=>{const Xh=s.lang.rtl===!0?ud.value:e.side;return[[TouchPan,fp,void 0,{[Xh]:!0,mouse:!0,mouseAllDir:!0}]]});function rp(){sd(Bt,e.behavior==="mobile"||e.behavior!=="desktop"&&P.totalWidth.value<=e.breakpoint)}watch(Bt,Xh=>{Xh===!0?(Y=Io.value,Io.value===!0&&ah(!1)):e.overlay===!1&&e.behavior!=="mobile"&&Y!==!1&&(Io.value===!0?(jf(0),yd(0),Qh()):$s(!1))}),watch(()=>e.side,(Xh,Ld)=>{P.instances[Ld]===ih&&(P.instances[Ld]=void 0,P[Ld].space=!1,P[Ld].offset=0),P.instances[Xh]=ih,P[Xh].size=kn.value,P[Xh].space=Af.value,P[Xh].offset=Tf.value}),watch(P.totalWidth,()=>{(P.isContainer.value===!0||document.qScrollPrevented!==!0)&&rp()}),watch(()=>e.behavior+e.breakpoint,rp),watch(P.isContainer,Xh=>{Io.value===!0&&o(Xh!==!0),Xh===!0&&rp()}),watch(P.scrollbarWidth,()=>{jf(Io.value===!0?0:void 0)}),watch(Tf,Xh=>{Yd("offset",Xh)}),watch(Af,Xh=>{r("onLayout",Xh),Yd("space",Xh)}),watch(al,()=>{jf()}),watch(kn,Xh=>{jf(),Zd(e.miniToOverlay,Xh)}),watch(()=>e.miniToOverlay,Xh=>{Zd(Xh,kn.value)}),watch(()=>s.lang.rtl,()=>{jf()}),watch(()=>e.mini,()=>{e.noMiniAnimation||e.modelValue===!0&&(op(),P.animate())}),watch(Ur,Xh=>{r("miniState",Xh)});function jf(Xh){Xh===void 0?nextTick(()=>{Xh=Io.value===!0?0:kn.value,jf(sh.value*Xh)}):(P.isContainer.value===!0&&al.value===!0&&(Bt.value===!0||Math.abs(Xh)===kn.value)&&(Xh+=sh.value*P.scrollbarWidth.value),Gh.value=Xh)}function yd(Xh){_h.value=Xh}function Jd(Xh){const Ld=Xh===!0?"remove":P.isContainer.value!==!0?"add":"";Ld!==""&&document.body.classList[Ld]("q-body--drawer-toggle")}function op(){ze!==null&&clearTimeout(ze),a.proxy&&a.proxy.$el&&a.proxy.$el.classList.add("q-drawer--mini-animate"),Lh.value=!0,ze=setTimeout(()=>{ze=null,Lh.value=!1,a&&a.proxy&&a.proxy.$el&&a.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function bp(Xh){if(Io.value!==!1)return;const Ld=kn.value,Kf=between(Xh.distance.x,0,Ld);if(Xh.isFinal===!0){Kf>=Math.min(75,Ld)===!0?$s():(P.animate(),yd(0),jf(sh.value*Ld)),Ih.value=!1;return}jf((s.lang.rtl===!0?al.value!==!0:al.value)?Math.max(Ld-Kf,0):Math.min(0,Kf-Ld)),yd(between(Kf/Ld,0,1)),Xh.isFirst===!0&&(Ih.value=!0)}function fp(Xh){if(Io.value!==!0)return;const Ld=kn.value,Kf=Xh.direction===e.side,If=(s.lang.rtl===!0?Kf!==!0:Kf)?between(Xh.distance.x,0,Ld):0;if(Xh.isFinal===!0){Math.abs(If)<Math.min(75,Ld)===!0?(P.animate(),yd(1),jf(0)):ah(),Ih.value=!1;return}jf(sh.value*If),yd(between(1-If/Ld,0,1)),Xh.isFirst===!0&&(Ih.value=!0)}function Qh(){o(!1),Jd(!0)}function Yd(Xh,Ld){P.update(e.side,Xh,Ld)}function sd(Xh,Ld){Xh.value!==Ld&&(Xh.value=Ld)}function Zd(Xh,Ld){Yd("size",Xh===!0?e.miniWidth:Ld)}return P.instances[e.side]=ih,Zd(e.miniToOverlay,kn.value),Yd("space",Af.value),Yd("offset",Tf.value),e.showIfAbove===!0&&e.modelValue!==!0&&Io.value===!0&&e["onUpdate:modelValue"]!==void 0&&r("update:modelValue",!0),onMounted(()=>{r("onLayout",Af.value),r("miniState",Ur.value),Y=e.showIfAbove===!0;const Xh=()=>{(Io.value===!0?Co:as)(!1,!0)};if(P.totalWidth.value!==0){nextTick(Xh);return}ge=watch(P.totalWidth,()=>{ge(),ge=void 0,Io.value===!1&&e.showIfAbove===!0&&Bt.value===!1?$s(!1):Xh()})}),onBeforeUnmount(()=>{ge!==void 0&&ge(),ze!==null&&(clearTimeout(ze),ze=null),Io.value===!0&&Qh(),P.instances[e.side]===ih&&(P.instances[e.side]=void 0,Yd("size",0),Yd("offset",0),Yd("space",!1))}),()=>{const Xh=[];Bt.value===!0&&(e.noSwipeOpen===!1&&Xh.push(withDirectives(h("div",{key:"open",class:`q-drawer__opener fixed-${e.side}`,"aria-hidden":"true"}),Id.value)),Xh.push(hDir("div",{ref:"backdrop",class:vd.value,style:qd.value,"aria-hidden":"true",onClick:ah},void 0,"backdrop",e.noSwipeBackdrop!==!0&&Io.value===!0,()=>Fd.value)));const Ld=Ur.value===!0&&t.mini!==void 0,Kf=[h("div",{...n,key:""+Ld,class:[Gd.value,n.class]},Ld===!0?t.mini():hSlot(t.default))];return e.elevated===!0&&Io.value===!0&&Kf.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Xh.push(hDir("aside",{ref:"content",class:bf.value,style:Md.value},Kf,"contentclose",e.noSwipeClose!==!0&&Bt.value===!0,()=>td.value)),h("div",{class:"q-drawer-container"},Xh)}}});let id=0;const useTabEmits=["click","keydown"],useTabProps={icon:String,label:[Number,String],alert:[Boolean,String],alertIcon:String,name:{type:[Number,String],default:()=>`t_${id++}`},noCaps:Boolean,tabindex:[String,Number],disable:Boolean,contentClass:String,ripple:{type:[Boolean,Object],default:!0}};function useTab(e,t,r,n){const a=inject(tabsKey,emptyRenderFn);if(a===emptyRenderFn)return console.error("QTab/QRouteTab component needs to be child of QTabs"),emptyRenderFn;const{proxy:s}=getCurrentInstance(),f=ref(null),o=ref(null),x=ref(null),C=computed(()=>e.disable===!0||e.ripple===!1?!1:Object.assign({keyCodes:[13,32],early:!0},e.ripple===!0?{}:e.ripple)),P=computed(()=>a.currentModel.value===e.name),Y=computed(()=>"q-tab relative-position self-stretch flex flex-center text-center"+(P.value===!0?" q-tab--active"+(a.tabProps.value.activeClass?" "+a.tabProps.value.activeClass:"")+(a.tabProps.value.activeColor?` text-${a.tabProps.value.activeColor}`:"")+(a.tabProps.value.activeBgColor?` bg-${a.tabProps.value.activeBgColor}`:""):" q-tab--inactive")+(e.icon&&e.label&&a.tabProps.value.inlineLabel===!1?" q-tab--full":"")+(e.noCaps===!0||a.tabProps.value.noCaps===!0?" q-tab--no-caps":"")+(e.disable===!0?" disabled":" q-focusable q-hoverable cursor-pointer")+(n!==void 0?n.linkClass.value:"")),ze=computed(()=>"q-tab__content self-stretch flex-center relative-position q-anchor--skip non-selectable "+(a.tabProps.value.inlineLabel===!0?"row no-wrap q-tab__content--inline":"column")+(e.contentClass!==void 0?` ${e.contentClass}`:"")),ge=computed(()=>e.disable===!0||a.hasFocus.value===!0||P.value===!1&&a.hasActiveTab.value===!0?-1:e.tabindex||0);function Bt(Co,as){if(as!==!0&&f.value!==null&&f.value.focus(),e.disable===!0){n!==void 0&&n.hasRouterLink.value===!0&&stopAndPrevent(Co);return}if(n===void 0){a.updateModel({name:e.name}),r("click",Co);return}if(n.hasRouterLink.value===!0){const $s=(ah={})=>{let ch;const Zu=ah.to===void 0||isDeepEqual(ah.to,e.to)===!0?a.avoidRouteWatcher=uid$1():null;return n.navigateToRouterLink(Co,{...ah,returnRouterError:!0}).catch(ih=>{ch=ih}).then(ih=>{if(Zu===a.avoidRouteWatcher&&(a.avoidRouteWatcher=!1,ch===void 0&&(ih===void 0||ih.message.startsWith("Avoided redundant navigation")===!0)&&a.updateModel({name:e.name})),ah.returnRouterError===!0)return ch!==void 0?Promise.reject(ch):ih})};r("click",Co,$s),Co.defaultPrevented!==!0&&$s();return}r("click",Co)}function Ur(Co){isKeyCode(Co,[13,32])?Bt(Co,!0):shouldIgnoreKey(Co)!==!0&&Co.keyCode>=35&&Co.keyCode<=40&&Co.altKey!==!0&&Co.metaKey!==!0&&a.onKbdNavigate(Co.keyCode,s.$el)===!0&&stopAndPrevent(Co),r("keydown",Co)}function kn(){const Co=a.tabProps.value.narrowIndicator,as=[],$s=h("div",{ref:x,class:["q-tab__indicator",a.tabProps.value.indicatorClass]});e.icon!==void 0&&as.push(h(QIcon,{class:"q-tab__icon",name:e.icon})),e.label!==void 0&&as.push(h("div",{class:"q-tab__label"},e.label)),e.alert!==!1&&as.push(e.alertIcon!==void 0?h(QIcon,{class:"q-tab__alert-icon",color:e.alert!==!0?e.alert:void 0,name:e.alertIcon}):h("div",{class:"q-tab__alert"+(e.alert!==!0?` text-${e.alert}`:"")})),Co===!0&&as.push($s);const ah=[h("div",{class:"q-focus-helper",tabindex:-1,ref:f}),h("div",{class:ze.value},hMergeSlot(t.default,as))];return Co===!1&&ah.push($s),ah}const Io={name:computed(()=>e.name),rootRef:o,tabIndicatorRef:x,routeData:n};onBeforeUnmount(()=>{a.unregisterTab(Io)}),onMounted(()=>{a.registerTab(Io)});function rl(Co,as){const $s={ref:o,class:Y.value,tabindex:ge.value,role:"tab","aria-selected":P.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:Bt,onKeydown:Ur,...as};return withDirectives(h(Co,$s,kn()),[[Ripple,C.value]])}return{renderTab:rl,$tabs:a}}const QTab=createComponent({name:"QTab",props:useTabProps,emits:useTabEmits,setup(e,{slots:t,emit:r}){const{renderTab:n}=useTab(e,t,r);return()=>n("div")}});let rtlHasScrollBug=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const t=document.createElement("div");Object.assign(t.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(t),e.scrollLeft=-1e3,rtlHasScrollBug=e.scrollLeft>=0,e.remove()}function getIndicatorClass(e,t,r){const n=r===!0?["left","right"]:["top","bottom"];return`absolute-${t===!0?n[0]:n[1]}${e?` text-${e}`:""}`}const alignValues=["left","center","right","justify"],QTabs=createComponent({name:"QTabs",props:{modelValue:[Number,String],align:{type:String,default:"center",validator:e=>alignValues.includes(e)},breakpoint:{type:[String,Number],default:600},vertical:Boolean,shrink:Boolean,stretch:Boolean,activeClass:String,activeColor:String,activeBgColor:String,indicatorColor:String,leftIcon:String,rightIcon:String,outsideArrows:Boolean,mobileArrows:Boolean,switchIndicator:Boolean,narrowIndicator:Boolean,inlineLabel:Boolean,noCaps:Boolean,dense:Boolean,contentClass:String,"onUpdate:modelValue":[Function,Array]},setup(e,{slots:t,emit:r}){const{proxy:n}=getCurrentInstance(),{$q:a}=n,{registerTick:s}=useTick(),{registerTick:f}=useTick(),{registerTick:o}=useTick(),{registerTimeout:x,removeTimeout:C}=useTimeout(),{registerTimeout:P,removeTimeout:Y}=useTimeout(),ze=ref(null),ge=ref(null),Bt=ref(e.modelValue),Ur=ref(!1),kn=ref(!0),Io=ref(!1),rl=ref(!1),Co=[],as=ref(0),$s=ref(!1);let ah=null,ch=null,Zu;const ih=computed(()=>({activeClass:e.activeClass,activeColor:e.activeColor,activeBgColor:e.activeBgColor,indicatorClass:getIndicatorClass(e.indicatorColor,e.switchIndicator,e.vertical),narrowIndicator:e.narrowIndicator,inlineLabel:e.inlineLabel,noCaps:e.noCaps})),al=computed(()=>{const sd=as.value,Zd=Bt.value;for(let Xh=0;Xh<sd;Xh++)if(Co[Xh].name.value===Zd)return!0;return!1}),sh=computed(()=>`q-tabs__content--align-${Ur.value===!0?"left":rl.value===!0?"justify":e.align}`),_h=computed(()=>`q-tabs row no-wrap items-center q-tabs--${Ur.value===!0?"":"not-"}scrollable q-tabs--${e.vertical===!0?"vertical":"horizontal"} q-tabs__arrows--${e.outsideArrows===!0?"outside":"inside"} q-tabs--mobile-with${e.mobileArrows===!0?"":"out"}-arrows`+(e.dense===!0?" q-tabs--dense":"")+(e.shrink===!0?" col-shrink":"")+(e.stretch===!0?" self-stretch":"")),Ih=computed(()=>"q-tabs__content scroll--mobile row no-wrap items-center self-stretch hide-scrollbar relative-position "+sh.value+(e.contentClass!==void 0?` ${e.contentClass}`:"")),Lh=computed(()=>e.vertical===!0?{container:"height",content:"offsetHeight",scroll:"scrollHeight"}:{container:"width",content:"offsetWidth",scroll:"scrollWidth"}),Gh=computed(()=>e.vertical!==!0&&a.lang.rtl===!0),ud=computed(()=>rtlHasScrollBug===!1&&Gh.value===!0);watch(Gh,qd),watch(()=>e.modelValue,sd=>{Tf({name:sd,setCurrent:!0,skipEmit:!0})}),watch(()=>e.outsideArrows,Kd);function Tf({name:sd,setCurrent:Zd,skipEmit:Xh}){Bt.value!==sd&&(Xh!==!0&&e["onUpdate:modelValue"]!==void 0&&r("update:modelValue",sd),(Zd===!0||e["onUpdate:modelValue"]===void 0)&&(md(Bt.value,sd),Bt.value=sd))}function Kd(){s(()=>{Af({width:ze.value.offsetWidth,height:ze.value.offsetHeight})})}function Af(sd){if(Lh.value===void 0||ge.value===null)return;const Zd=sd[Lh.value.container],Xh=Math.min(ge.value[Lh.value.scroll],Array.prototype.reduce.call(ge.value.children,(Kf,If)=>Kf+(If[Lh.value.content]||0),0)),Ld=Zd>0&&Xh>Zd;Ur.value=Ld,Ld===!0&&f(qd),rl.value=Zd<parseInt(e.breakpoint,10)}function md(sd,Zd){const Xh=sd!=null&&sd!==""?Co.find(Kf=>Kf.name.value===sd):null,Ld=Zd!=null&&Zd!==""?Co.find(Kf=>Kf.name.value===Zd):null;if(Xh&&Ld){const Kf=Xh.tabIndicatorRef.value,If=Ld.tabIndicatorRef.value;ah!==null&&(clearTimeout(ah),ah=null),Kf.style.transition="none",Kf.style.transform="none",If.style.transition="none",If.style.transform="none";const Df=Kf.getBoundingClientRect(),Jf=If.getBoundingClientRect();If.style.transform=e.vertical===!0?`translate3d(0,${Df.top-Jf.top}px,0) scale3d(1,${Jf.height?Df.height/Jf.height:1},1)`:`translate3d(${Df.left-Jf.left}px,0,0) scale3d(${Jf.width?Df.width/Jf.width:1},1,1)`,o(()=>{ah=setTimeout(()=>{ah=null,If.style.transition="transform .25s cubic-bezier(.4, 0, .2, 1)",If.style.transform="none"},70)})}Ld&&Ur.value===!0&&vd(Ld.rootRef.value)}function vd(sd){const{left:Zd,width:Xh,top:Ld,height:Kf}=ge.value.getBoundingClientRect(),If=sd.getBoundingClientRect();let Df=e.vertical===!0?If.top-Ld:If.left-Zd;if(Df<0){ge.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.floor(Df),qd();return}Df+=e.vertical===!0?If.height-Kf:If.width-Xh,Df>0&&(ge.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.ceil(Df),qd())}function qd(){const sd=ge.value;if(sd===null)return;const Zd=sd.getBoundingClientRect(),Xh=e.vertical===!0?sd.scrollTop:Math.abs(sd.scrollLeft);Gh.value===!0?(kn.value=Math.ceil(Xh+Zd.width)<sd.scrollWidth-1,Io.value=Xh>0):(kn.value=Xh>0,Io.value=e.vertical===!0?Math.ceil(Xh+Zd.height)<sd.scrollHeight:Math.ceil(Xh+Zd.width)<sd.scrollWidth)}function Ed(sd){ch!==null&&clearInterval(ch),ch=setInterval(()=>{Id(sd)===!0&&Md()},5)}function Sd(){Ed(ud.value===!0?Number.MAX_SAFE_INTEGER:0)}function zd(){Ed(ud.value===!0?0:Number.MAX_SAFE_INTEGER)}function Md(){ch!==null&&(clearInterval(ch),ch=null)}function Gd(sd,Zd){const Xh=Array.prototype.filter.call(ge.value.children,Jf=>Jf===Zd||Jf.matches&&Jf.matches(".q-tab.q-focusable")===!0),Ld=Xh.length;if(Ld===0)return;if(sd===36)return vd(Xh[0]),Xh[0].focus(),!0;if(sd===35)return vd(Xh[Ld-1]),Xh[Ld-1].focus(),!0;const Kf=sd===(e.vertical===!0?38:37),If=sd===(e.vertical===!0?40:39),Df=Kf===!0?-1:If===!0?1:void 0;if(Df!==void 0){const Jf=Gh.value===!0?-1:1,Nf=Xh.indexOf(Zd)+Df*Jf;return Nf>=0&&Nf<Ld&&(vd(Xh[Nf]),Xh[Nf].focus({preventScroll:!0})),!0}}const bf=computed(()=>ud.value===!0?{get:sd=>Math.abs(sd.scrollLeft),set:(sd,Zd)=>{sd.scrollLeft=-Zd}}:e.vertical===!0?{get:sd=>sd.scrollTop,set:(sd,Zd)=>{sd.scrollTop=Zd}}:{get:sd=>sd.scrollLeft,set:(sd,Zd)=>{sd.scrollLeft=Zd}});function Id(sd){const Zd=ge.value,{get:Xh,set:Ld}=bf.value;let Kf=!1,If=Xh(Zd);const Df=sd<If?-1:1;return If+=Df*5,If<0?(Kf=!0,If=0):(Df===-1&&If<=sd||Df===1&&If>=sd)&&(Kf=!0,If=sd),Ld(Zd,If),qd(),Kf}function td(sd,Zd){for(const Xh in sd)if(sd[Xh]!==Zd[Xh])return!1;return!0}function Fd(){let sd=null,Zd={matchedLen:0,queryDiff:9999,hrefLen:0};const Xh=Co.filter(Df=>Df.routeData!==void 0&&Df.routeData.hasRouterLink.value===!0),{hash:Ld,query:Kf}=n.$route,If=Object.keys(Kf).length;for(const Df of Xh){const Jf=Df.routeData.exact.value===!0;if(Df.routeData[Jf===!0?"linkIsExactActive":"linkIsActive"].value!==!0)continue;const{hash:Nf,query:Wf,matched:Mp,href:Sp}=Df.routeData.resolvedLink.value,Pp=Object.keys(Wf).length;if(Jf===!0){if(Nf!==Ld||Pp!==If||td(Kf,Wf)===!1)continue;sd=Df.name.value;break}if(Nf!==""&&Nf!==Ld||Pp!==0&&td(Wf,Kf)===!1)continue;const Yf={matchedLen:Mp.length,queryDiff:If-Pp,hrefLen:Sp.length-Nf.length};if(Yf.matchedLen>Zd.matchedLen){sd=Df.name.value,Zd=Yf;continue}else if(Yf.matchedLen!==Zd.matchedLen)continue;if(Yf.queryDiff<Zd.queryDiff)sd=Df.name.value,Zd=Yf;else if(Yf.queryDiff!==Zd.queryDiff)continue;Yf.hrefLen>Zd.hrefLen&&(sd=Df.name.value,Zd=Yf)}sd===null&&Co.some(Df=>Df.routeData===void 0&&Df.name.value===Bt.value)===!0||Tf({name:sd,setCurrent:!0})}function rp(sd){if(C(),$s.value!==!0&&ze.value!==null&&sd.target&&typeof sd.target.closest=="function"){const Zd=sd.target.closest(".q-tab");Zd&&ze.value.contains(Zd)===!0&&($s.value=!0,Ur.value===!0&&vd(Zd))}}function jf(){x(()=>{$s.value=!1},30)}function yd(){fp.avoidRouteWatcher===!1?P(Fd):Y()}function Jd(){if(Zu===void 0){const sd=watch(()=>n.$route.fullPath,yd);Zu=()=>{sd(),Zu=void 0}}}function op(sd){Co.push(sd),as.value++,Kd(),sd.routeData===void 0||n.$route===void 0?P(()=>{if(Ur.value===!0){const Zd=Bt.value,Xh=Zd!=null&&Zd!==""?Co.find(Ld=>Ld.name.value===Zd):null;Xh&&vd(Xh.rootRef.value)}}):(Jd(),sd.routeData.hasRouterLink.value===!0&&yd())}function bp(sd){Co.splice(Co.indexOf(sd),1),as.value--,Kd(),Zu!==void 0&&sd.routeData!==void 0&&(Co.every(Zd=>Zd.routeData===void 0)===!0&&Zu(),yd())}const fp={currentModel:Bt,tabProps:ih,hasFocus:$s,hasActiveTab:al,registerTab:op,unregisterTab:bp,verifyRouteModel:yd,updateModel:Tf,onKbdNavigate:Gd,avoidRouteWatcher:!1};provide(tabsKey,fp);function Qh(){ah!==null&&clearTimeout(ah),Md(),Zu!==void 0&&Zu()}let Yd;return onBeforeUnmount(Qh),onDeactivated(()=>{Yd=Zu!==void 0,Qh()}),onActivated(()=>{Yd===!0&&Jd(),Kd()}),()=>h("div",{ref:ze,class:_h.value,role:"tablist",onFocusin:rp,onFocusout:jf},[h(QResizeObserver,{onResize:Af}),h("div",{ref:ge,class:Ih.value,onScroll:qd},hSlot(t.default)),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--left absolute q-tab__icon"+(kn.value===!0?"":" q-tabs__arrow--faded"),name:e.leftIcon||a.iconSet.tabs[e.vertical===!0?"up":"left"],onMousedownPassive:Sd,onTouchstartPassive:Sd,onMouseupPassive:Md,onMouseleavePassive:Md,onTouchendPassive:Md}),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--right absolute q-tab__icon"+(Io.value===!0?"":" q-tabs__arrow--faded"),name:e.rightIcon||a.iconSet.tabs[e.vertical===!0?"down":"right"],onMousedownPassive:zd,onTouchstartPassive:zd,onMouseupPassive:Md,onMouseleavePassive:Md,onTouchendPassive:Md})])}});function parseArg(e){const t=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((r,n)=>{const a=parseFloat(r);a&&(t[n]=a)}),t}const TouchSwipe=createDirective({name:"touch-swipe",beforeMount(e,{value:t,arg:r,modifiers:n}){if(n.mouse!==!0&&client$1.has.touch!==!0)return;const a=n.mouseCapture===!0?"Capture":"",s={handler:t,sensitivity:parseArg(r),direction:getModifierDirections(n),noop,mouseStart(f){shouldStart(f,s)&&leftClick(f)&&(addEvt(s,"temp",[[document,"mousemove","move",`notPassive${a}`],[document,"mouseup","end","notPassiveCapture"]]),s.start(f,!0))},touchStart(f){if(shouldStart(f,s)){const o=f.target;addEvt(s,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","notPassiveCapture"],[o,"touchend","end","notPassiveCapture"]]),s.start(f)}},start(f,o){client$1.is.firefox===!0&&preventDraggable(e,!0);const x=position(f);s.event={x:x.left,y:x.top,time:Date.now(),mouse:o===!0,dir:!1}},move(f){if(s.event===void 0)return;if(s.event.dir!==!1){stopAndPrevent(f);return}const o=Date.now()-s.event.time;if(o===0)return;const x=position(f),C=x.left-s.event.x,P=Math.abs(C),Y=x.top-s.event.y,ze=Math.abs(Y);if(s.event.mouse!==!0){if(P<s.sensitivity[1]&&ze<s.sensitivity[1]){s.end(f);return}}else if(window.getSelection().toString()!==""){s.end(f);return}else if(P<s.sensitivity[2]&&ze<s.sensitivity[2])return;const ge=P/o,Bt=ze/o;s.direction.vertical===!0&&P<ze&&P<100&&Bt>s.sensitivity[0]&&(s.event.dir=Y<0?"up":"down"),s.direction.horizontal===!0&&P>ze&&ze<100&&ge>s.sensitivity[0]&&(s.event.dir=C<0?"left":"right"),s.direction.up===!0&&P<ze&&Y<0&&P<100&&Bt>s.sensitivity[0]&&(s.event.dir="up"),s.direction.down===!0&&P<ze&&Y>0&&P<100&&Bt>s.sensitivity[0]&&(s.event.dir="down"),s.direction.left===!0&&P>ze&&C<0&&ze<100&&ge>s.sensitivity[0]&&(s.event.dir="left"),s.direction.right===!0&&P>ze&&C>0&&ze<100&&ge>s.sensitivity[0]&&(s.event.dir="right"),s.event.dir!==!1?(stopAndPrevent(f),s.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),s.styleCleanup=Ur=>{s.styleCleanup=void 0,document.body.classList.remove("non-selectable");const kn=()=>{document.body.classList.remove("no-pointer-events--children")};Ur===!0?setTimeout(kn,50):kn()}),s.handler({evt:f,touch:s.event.mouse!==!0,mouse:s.event.mouse,direction:s.event.dir,duration:o,distance:{x:P,y:ze}})):s.end(f)},end(f){s.event!==void 0&&(cleanEvt(s,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),s.styleCleanup!==void 0&&s.styleCleanup(!0),f!==void 0&&s.event.dir!==!1&&stopAndPrevent(f),s.event=void 0)}};if(e.__qtouchswipe=s,n.mouse===!0){const f=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";addEvt(s,"main",[[e,"mousedown","mouseStart",`passive${f}`]])}client$1.has.touch===!0&&addEvt(s,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const r=e.__qtouchswipe;r!==void 0&&(t.oldValue!==t.value&&(typeof t.value!="function"&&r.end(),r.handler=t.value),r.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchswipe;t!==void 0&&(cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchswipe)}});function useCache(){const e=new Map;return{getCache:function(t,r){return e[t]===void 0?e[t]=r:e[t]},getCacheWithFn:function(t,r){return e[t]===void 0?e[t]=r():e[t]}}}const usePanelChildProps={name:{required:!0},disable:Boolean},PanelWrapper={setup(e,{slots:t}){return()=>h("div",{class:"q-panel scroll",role:"tabpanel"},hSlot(t.default))}},usePanelProps={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},usePanelEmits=["update:modelValue","beforeTransition","transition"];function usePanel(){const{props:e,emit:t,proxy:r}=getCurrentInstance(),{getCacheWithFn:n}=useCache();let a,s;const f=ref(null),o=ref(null);function x(Ih){const Lh=e.vertical===!0?"up":"left";ch((r.$q.lang.rtl===!0?-1:1)*(Ih.direction===Lh?1:-1))}const C=computed(()=>[[TouchSwipe,x,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),P=computed(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),Y=computed(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),ze=computed(()=>`--q-transition-duration: ${e.transitionDuration}ms`),ge=computed(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),Bt=computed(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),Ur=computed(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);watch(()=>e.modelValue,(Ih,Lh)=>{const Gh=Co(Ih)===!0?as(Ih):-1;s!==!0&&ah(Gh===-1?0:Gh<as(Lh)?-1:1),f.value!==Gh&&(f.value=Gh,t("beforeTransition",Ih,Lh),nextTick(()=>{t("transition",Ih,Lh)}))});function kn(){ch(1)}function Io(){ch(-1)}function rl(Ih){t("update:modelValue",Ih)}function Co(Ih){return Ih!=null&&Ih!==""}function as(Ih){return a.findIndex(Lh=>Lh.props.name===Ih&&Lh.props.disable!==""&&Lh.props.disable!==!0)}function $s(){return a.filter(Ih=>Ih.props.disable!==""&&Ih.props.disable!==!0)}function ah(Ih){const Lh=Ih!==0&&e.animated===!0&&f.value!==-1?"q-transition--"+(Ih===-1?P.value:Y.value):null;o.value!==Lh&&(o.value=Lh)}function ch(Ih,Lh=f.value){let Gh=Lh+Ih;for(;Gh>-1&&Gh<a.length;){const ud=a[Gh];if(ud!==void 0&&ud.props.disable!==""&&ud.props.disable!==!0){ah(Ih),s=!0,t("update:modelValue",ud.props.name),setTimeout(()=>{s=!1});return}Gh+=Ih}e.infinite===!0&&a.length!==0&&Lh!==-1&&Lh!==a.length&&ch(Ih,Ih===-1?a.length:-1)}function Zu(){const Ih=as(e.modelValue);return f.value!==Ih&&(f.value=Ih),!0}function ih(){const Ih=Co(e.modelValue)===!0&&Zu()&&a[f.value];return e.keepAlive===!0?[h(KeepAlive,Bt.value,[h(Ur.value===!0?n(ge.value,()=>({...PanelWrapper,name:ge.value})):PanelWrapper,{key:ge.value,style:ze.value},()=>Ih)])]:[h("div",{class:"q-panel scroll",style:ze.value,key:ge.value,role:"tabpanel"},[Ih])]}function al(){if(a.length!==0)return e.animated===!0?[h(Transition,{name:o.value},ih)]:ih()}function sh(Ih){return a=getNormalizedVNodes(hSlot(Ih.default,[])).filter(Lh=>Lh.props!==null&&Lh.props.slot===void 0&&Co(Lh.props.name)===!0),a.length}function _h(){return a}return Object.assign(r,{next:kn,previous:Io,goTo:rl}),{panelIndex:f,panelDirectives:C,updatePanelsList:sh,updatePanelIndex:Zu,getPanelContent:al,getEnabledPanels:$s,getPanels:_h,isValidPanelName:Co,keepAliveProps:Bt,needsUniqueKeepAliveWrapper:Ur,goToPanelByOffset:ch,goToPanel:rl,nextPanel:kn,previousPanel:Io}}const QTabPanel=createComponent({name:"QTabPanel",props:usePanelChildProps,setup(e,{slots:t}){return()=>h("div",{class:"q-tab-panel",role:"tabpanel"},hSlot(t.default))}}),QField=createComponent({name:"QField",inheritAttrs:!1,props:useFieldProps,emits:useFieldEmits,setup(){return useField(useFieldState())}}),defaultSizes$1={xs:8,sm:10,md:14,lg:20,xl:24},QChip=createComponent({name:"QChip",props:{...useDarkProps,...useSizeProps,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=useDark(e,n),s=useSize(e,defaultSizes$1),f=computed(()=>e.selected===!0||e.icon!==void 0),o=computed(()=>e.selected===!0?e.iconSelected||n.iconSet.chip.selected:e.icon),x=computed(()=>e.iconRemove||n.iconSet.chip.remove),C=computed(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),P=computed(()=>{const kn=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(kn?` text-${kn} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(C.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(a.value===!0?" q-chip--dark q-dark":"")}),Y=computed(()=>{const kn=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},Io={...kn,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||n.lang.label.remove};return{chip:kn,remove:Io}});function ze(kn){kn.keyCode===13&&ge(kn)}function ge(kn){e.disable||(r("update:selected",!e.selected),r("click",kn))}function Bt(kn){(kn.keyCode===void 0||kn.keyCode===13)&&(stopAndPrevent(kn),e.disable===!1&&(r("update:modelValue",!1),r("remove")))}function Ur(){const kn=[];C.value===!0&&kn.push(h("div",{class:"q-focus-helper"})),f.value===!0&&kn.push(h(QIcon,{class:"q-chip__icon q-chip__icon--left",name:o.value}));const Io=e.label!==void 0?[h("div",{class:"ellipsis"},[e.label])]:void 0;return kn.push(h("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},hMergeSlotSafely(t.default,Io))),e.iconRight&&kn.push(h(QIcon,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&kn.push(h(QIcon,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:x.value,...Y.value.remove,onClick:Bt,onKeyup:Bt})),kn}return()=>{if(e.modelValue===!1)return;const kn={class:P.value,style:s.value};return C.value===!0&&Object.assign(kn,Y.value.chip,{onClick:ge,onKeyup:ze}),hDir("div",kn,Ur(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Ripple,e.ripple]])}}}),QItem=createComponent({name:"QItem",props:{...useDarkProps,...useRouterLinkProps,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=useDark(e,n),{hasLink:s,linkAttrs:f,linkClass:o,linkTag:x,navigateOnClick:C}=useRouterLink(),P=ref(null),Y=ref(null),ze=computed(()=>e.clickable===!0||s.value===!0||e.tag==="label"),ge=computed(()=>e.disable!==!0&&ze.value===!0),Bt=computed(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(a.value===!0?" q-item--dark":"")+(s.value===!0&&e.active===null?o.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(ge.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),Ur=computed(()=>e.insetLevel===void 0?null:{["padding"+(n.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function kn(Co){ge.value===!0&&(Y.value!==null&&(Co.qKeyEvent!==!0&&document.activeElement===P.value?Y.value.focus():document.activeElement===Y.value&&P.value.focus()),C(Co))}function Io(Co){if(ge.value===!0&&isKeyCode(Co,13)===!0){stopAndPrevent(Co),Co.qKeyEvent=!0;const as=new MouseEvent("click",Co);as.qKeyEvent=!0,P.value.dispatchEvent(as)}r("keyup",Co)}function rl(){const Co=hUniqueSlot(t.default,[]);return ge.value===!0&&Co.unshift(h("div",{class:"q-focus-helper",tabindex:-1,ref:Y})),Co}return()=>{const Co={ref:P,class:Bt.value,style:Ur.value,role:"listitem",onClick:kn,onKeyup:Io};return ge.value===!0?(Co.tabindex=e.tabindex||"0",Object.assign(Co,f.value)):ze.value===!0&&(Co["aria-disabled"]="true"),h(x.value,Co,rl())}}}),QItemSection=createComponent({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:t}){const r=computed(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>h("div",{class:r.value},hSlot(t.default))}}),QItemLabel=createComponent({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(e,{slots:t}){const r=computed(()=>parseInt(e.lines,10)),n=computed(()=>"q-item__label"+(e.overline===!0?" q-item__label--overline text-overline":"")+(e.caption===!0?" q-item__label--caption text-caption":"")+(e.header===!0?" q-item__label--header":"")+(r.value===1?" ellipsis":"")),a=computed(()=>e.lines!==void 0&&r.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":r.value}:null);return()=>h("div",{style:a.value,class:n.value},hSlot(t.default))}}),useAnchorProps={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function useAnchor({showing:e,avoidEmit:t,configureAnchorEl:r}){const{props:n,proxy:a,emit:s}=getCurrentInstance(),f=ref(null);let o=null;function x(ge){return f.value===null?!1:ge===void 0||ge.touches===void 0||ge.touches.length<=1}const C={};r===void 0&&(Object.assign(C,{hide(ge){a.hide(ge)},toggle(ge){a.toggle(ge),ge.qAnchorHandled=!0},toggleKey(ge){isKeyCode(ge,13)===!0&&C.toggle(ge)},contextClick(ge){a.hide(ge),prevent(ge),nextTick(()=>{a.show(ge),ge.qAnchorHandled=!0})},prevent,mobileTouch(ge){if(C.mobileCleanup(ge),x(ge)!==!0)return;a.hide(ge),f.value.classList.add("non-selectable");const Bt=ge.target;addEvt(C,"anchor",[[Bt,"touchmove","mobileCleanup","passive"],[Bt,"touchend","mobileCleanup","passive"],[Bt,"touchcancel","mobileCleanup","passive"],[f.value,"contextmenu","prevent","notPassive"]]),o=setTimeout(()=>{o=null,a.show(ge),ge.qAnchorHandled=!0},300)},mobileCleanup(ge){f.value.classList.remove("non-selectable"),o!==null&&(clearTimeout(o),o=null),e.value===!0&&ge!==void 0&&clearSelection()}}),r=function(ge=n.contextMenu){if(n.noParentEvent===!0||f.value===null)return;let Bt;ge===!0?a.$q.platform.is.mobile===!0?Bt=[[f.value,"touchstart","mobileTouch","passive"]]:Bt=[[f.value,"mousedown","hide","passive"],[f.value,"contextmenu","contextClick","notPassive"]]:Bt=[[f.value,"click","toggle","passive"],[f.value,"keyup","toggleKey","passive"]],addEvt(C,"anchor",Bt)});function P(){cleanEvt(C,"anchor")}function Y(ge){for(f.value=ge;f.value.classList.contains("q-anchor--skip");)f.value=f.value.parentNode;r()}function ze(){if(n.target===!1||n.target===""||a.$el.parentNode===null)f.value=null;else if(n.target===!0)Y(a.$el.parentNode);else{let ge=n.target;if(typeof n.target=="string")try{ge=document.querySelector(n.target)}catch{ge=void 0}ge!=null?(f.value=ge.$el||ge,r()):(f.value=null,console.error(`Anchor: target "${n.target}" not found`))}}return watch(()=>n.contextMenu,ge=>{f.value!==null&&(P(),r(ge))}),watch(()=>n.target,()=>{f.value!==null&&P(),ze()}),watch(()=>n.noParentEvent,ge=>{f.value!==null&&(ge===!0?P():r())}),onMounted(()=>{ze(),t!==!0&&n.modelValue===!0&&f.value===null&&s("update:modelValue",!1)}),onBeforeUnmount(()=>{o!==null&&clearTimeout(o),P()}),{anchorEl:f,canShow:x,anchorEvents:C}}function useScrollTarget(e,t){const r=ref(null);let n;function a(o,x){const C=`${x!==void 0?"add":"remove"}EventListener`,P=x!==void 0?x:n;o!==window&&o[C]("scroll",P,listenOpts.passive),window[C]("scroll",P,listenOpts.passive),n=x}function s(){r.value!==null&&(a(r.value),r.value=null)}const f=watch(()=>e.noParentEvent,()=>{r.value!==null&&(s(),t())});return onBeforeUnmount(f),{localScrollTarget:r,unconfigureScrollTarget:s,changeScrollEvent:a}}const{notPassiveCapture}=listenOpts,registeredList=[];function globalHandler(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let r=portalProxyList.length-1;for(;r>=0;){const n=portalProxyList[r].$;if(n.type.name!=="QDialog")break;if(n.props.seamless!==!0)return;r--}for(let n=registeredList.length-1;n>=0;n--){const a=registeredList[n];if((a.anchorEl.value===null||a.anchorEl.value.contains(t)===!1)&&(t===document.body||a.innerRef.value!==null&&a.innerRef.value.contains(t)===!1))e.qClickOutside=!0,a.onClickOutside(e);else return}}function addClickOutside(e){registeredList.push(e),registeredList.length===1&&(document.addEventListener("mousedown",globalHandler,notPassiveCapture),document.addEventListener("touchstart",globalHandler,notPassiveCapture))}function removeClickOutside(e){const t=registeredList.findIndex(r=>r===e);t>-1&&(registeredList.splice(t,1),registeredList.length===0&&(document.removeEventListener("mousedown",globalHandler,notPassiveCapture),document.removeEventListener("touchstart",globalHandler,notPassiveCapture)))}let vpLeft,vpTop;function validatePosition(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function validateOffset(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const horizontalPos={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{horizontalPos[`${e}#ltr`]=e,horizontalPos[`${e}#rtl`]=e});function parsePosition(e,t){const r=e.split(" ");return{vertical:r[0],horizontal:horizontalPos[`${r[1]}#${t===!0?"rtl":"ltr"}`]}}function getAnchorProps(e,t){let{top:r,left:n,right:a,bottom:s,width:f,height:o}=e.getBoundingClientRect();return t!==void 0&&(r-=t[1],n-=t[0],s+=t[1],a+=t[0],f+=t[0],o+=t[1]),{top:r,bottom:s,height:o,left:n,right:a,width:f,middle:n+(a-n)/2,center:r+(s-r)/2}}function getAbsoluteAnchorProps(e,t,r){let{top:n,left:a}=e.getBoundingClientRect();return n+=t.top,a+=t.left,r!==void 0&&(n+=r[1],a+=r[0]),{top:n,bottom:n+1,height:1,left:a,right:a+1,width:1,middle:a,center:n}}function getTargetProps(e){return{top:0,center:e.offsetHeight/2,bottom:e.offsetHeight,left:0,middle:e.offsetWidth/2,right:e.offsetWidth}}function getTopLeftProps(e,t,r){return{top:e[r.anchorOrigin.vertical]-t[r.selfOrigin.vertical],left:e[r.anchorOrigin.horizontal]-t[r.selfOrigin.horizontal]}}function setPosition(e){if(client$1.is.ios===!0&&window.visualViewport!==void 0){const o=document.body.style,{offsetLeft:x,offsetTop:C}=window.visualViewport;x!==vpLeft&&(o.setProperty("--q-pe-left",x+"px"),vpLeft=x),C!==vpTop&&(o.setProperty("--q-pe-top",C+"px"),vpTop=C)}const{scrollLeft:t,scrollTop:r}=e.el,n=e.absoluteOffset===void 0?getAnchorProps(e.anchorEl,e.cover===!0?[0,0]:e.offset):getAbsoluteAnchorProps(e.anchorEl,e.absoluteOffset,e.offset);let a={maxHeight:e.maxHeight,maxWidth:e.maxWidth,visibility:"visible"};(e.fit===!0||e.cover===!0)&&(a.minWidth=n.width+"px",e.cover===!0&&(a.minHeight=n.height+"px")),Object.assign(e.el.style,a);const s=getTargetProps(e.el);let f=getTopLeftProps(n,s,e);if(e.absoluteOffset===void 0||e.offset===void 0)applyBoundaries(f,n,s,e.anchorOrigin,e.selfOrigin);else{const{top:o,left:x}=f;applyBoundaries(f,n,s,e.anchorOrigin,e.selfOrigin);let C=!1;if(f.top!==o){C=!0;const P=2*e.offset[1];n.center=n.top-=P,n.bottom-=P+2}if(f.left!==x){C=!0;const P=2*e.offset[0];n.middle=n.left-=P,n.right-=P+2}C===!0&&(f=getTopLeftProps(n,s,e),applyBoundaries(f,n,s,e.anchorOrigin,e.selfOrigin))}a={top:f.top+"px",left:f.left+"px"},f.maxHeight!==void 0&&(a.maxHeight=f.maxHeight+"px",n.height>f.maxHeight&&(a.minHeight=a.maxHeight)),f.maxWidth!==void 0&&(a.maxWidth=f.maxWidth+"px",n.width>f.maxWidth&&(a.minWidth=a.maxWidth)),Object.assign(e.el.style,a),e.el.scrollTop!==r&&(e.el.scrollTop=r),e.el.scrollLeft!==t&&(e.el.scrollLeft=t)}function applyBoundaries(e,t,r,n,a){const s=r.bottom,f=r.right,o=getScrollbarWidth(),x=window.innerHeight-o,C=document.body.clientWidth;if(e.top<0||e.top+s>x)if(a.vertical==="center")e.top=t[n.vertical]>x/2?Math.max(0,x-s):0,e.maxHeight=Math.min(s,x);else if(t[n.vertical]>x/2){const P=Math.min(x,n.vertical==="center"?t.center:n.vertical===a.vertical?t.bottom:t.top);e.maxHeight=Math.min(s,P),e.top=Math.max(0,P-s)}else e.top=Math.max(0,n.vertical==="center"?t.center:n.vertical===a.vertical?t.top:t.bottom),e.maxHeight=Math.min(s,x-e.top);if(e.left<0||e.left+f>C)if(e.maxWidth=Math.min(f,C),a.horizontal==="middle")e.left=t[n.horizontal]>C/2?Math.max(0,C-f):0;else if(t[n.horizontal]>C/2){const P=Math.min(C,n.horizontal==="middle"?t.middle:n.horizontal===a.horizontal?t.right:t.left);e.maxWidth=Math.min(f,P),e.left=Math.max(0,P-e.maxWidth)}else e.left=Math.max(0,n.horizontal==="middle"?t.middle:n.horizontal===a.horizontal?t.left:t.right),e.maxWidth=Math.min(f,C-e.left)}const QMenu=createComponent({name:"QMenu",inheritAttrs:!1,props:{...useAnchorProps,...useModelToggleProps,...useDarkProps,...useTransitionProps,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:validatePosition},self:{type:String,validator:validatePosition},offset:{type:Array,validator:validateOffset},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...useModelToggleEmits,"click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){let a=null,s,f,o;const x=getCurrentInstance(),{proxy:C}=x,{$q:P}=C,Y=ref(null),ze=ref(!1),ge=computed(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),Bt=useDark(e,P),{registerTick:Ur,removeTick:kn}=useTick(),{registerTimeout:Io}=useTimeout(),{transitionProps:rl,transitionStyle:Co}=useTransition(e),{localScrollTarget:as,changeScrollEvent:$s,unconfigureScrollTarget:ah}=useScrollTarget(e,Ed),{anchorEl:ch,canShow:Zu}=useAnchor({showing:ze}),{hide:ih}=useModelToggle({showing:ze,canShow:Zu,handleShow:md,handleHide:vd,hideOnRouteChange:ge,processOnMount:!0}),{showPortal:al,hidePortal:sh,renderPortal:_h}=usePortal(x,Y,bf,"menu"),Ih={anchorEl:ch,innerRef:Y,onClickOutside(Id){if(e.persistent!==!0&&ze.value===!0)return ih(Id),(Id.type==="touchstart"||Id.target.classList.contains("q-dialog__backdrop"))&&stopAndPrevent(Id),!0}},Lh=computed(()=>parsePosition(e.anchor||(e.cover===!0?"center middle":"bottom start"),P.lang.rtl)),Gh=computed(()=>e.cover===!0?Lh.value:parsePosition(e.self||"top start",P.lang.rtl)),ud=computed(()=>(e.square===!0?" q-menu--square":"")+(Bt.value===!0?" q-menu--dark q-dark":"")),Tf=computed(()=>e.autoClose===!0?{onClick:Sd}:{}),Kd=computed(()=>ze.value===!0&&e.persistent!==!0);watch(Kd,Id=>{Id===!0?(addEscapeKey(Md),addClickOutside(Ih)):(removeEscapeKey(Md),removeClickOutside(Ih))});function Af(){addFocusFn(()=>{let Id=Y.value;Id&&Id.contains(document.activeElement)!==!0&&(Id=Id.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||Id.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||Id.querySelector("[autofocus], [data-autofocus]")||Id,Id.focus({preventScroll:!0}))})}function md(Id){if(a=e.noRefocus===!1?document.activeElement:null,addFocusout(zd),al(),Ed(),s=void 0,Id!==void 0&&(e.touchPosition||e.contextMenu)){const td=position(Id);if(td.left!==void 0){const{top:Fd,left:rp}=ch.value.getBoundingClientRect();s={left:td.left-rp,top:td.top-Fd}}}f===void 0&&(f=watch(()=>P.screen.width+"|"+P.screen.height+"|"+e.self+"|"+e.anchor+"|"+P.lang.rtl,Gd)),e.noFocus!==!0&&document.activeElement.blur(),Ur(()=>{Gd(),e.noFocus!==!0&&Af()}),Io(()=>{P.platform.is.ios===!0&&(o=e.autoClose,Y.value.click()),Gd(),al(!0),r("show",Id)},e.transitionDuration)}function vd(Id){kn(),sh(),qd(!0),a!==null&&(Id===void 0||Id.qClickOutside!==!0)&&(((Id&&Id.type.indexOf("key")===0?a.closest('[tabindex]:not([tabindex^="-"])'):void 0)||a).focus(),a=null),Io(()=>{sh(!0),r("hide",Id)},e.transitionDuration)}function qd(Id){s=void 0,f!==void 0&&(f(),f=void 0),(Id===!0||ze.value===!0)&&(removeFocusout(zd),ah(),removeClickOutside(Ih),removeEscapeKey(Md)),Id!==!0&&(a=null)}function Ed(){(ch.value!==null||e.scrollTarget!==void 0)&&(as.value=getScrollTarget(ch.value,e.scrollTarget),$s(as.value,Gd))}function Sd(Id){o!==!0?(closePortalMenus(C,Id),r("click",Id)):o=!1}function zd(Id){Kd.value===!0&&e.noFocus!==!0&&childHasFocus(Y.value,Id.target)!==!0&&Af()}function Md(Id){r("escapeKey"),ih(Id)}function Gd(){const Id=Y.value;Id===null||ch.value===null||setPosition({el:Id,offset:e.offset,anchorEl:ch.value,anchorOrigin:Lh.value,selfOrigin:Gh.value,absoluteOffset:s,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function bf(){return h(Transition,rl.value,()=>ze.value===!0?h("div",{role:"menu",...n,ref:Y,tabindex:-1,class:["q-menu q-position-engine scroll"+ud.value,n.class],style:[n.style,Co.value],...Tf.value},hSlot(t.default)):null)}return onBeforeUnmount(qd),Object.assign(C,{focus:Af,updatePosition:Gd}),_h}}),aggBucketSize=1e3,scrollToEdges=["start","center","end","start-force","center-force","end-force"],filterProto=Array.prototype.filter,setOverflowAnchor=window.getComputedStyle(document.body).overflowAnchor===void 0?noop:function(e,t){e!==null&&(e._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;e._qOverflowAnimationFrame=void 0;const r=e.children||[];filterProto.call(r,a=>a.dataset&&a.dataset.qVsAnchor!==void 0).forEach(a=>{delete a.dataset.qVsAnchor});const n=r[t];n&&n.dataset&&(n.dataset.qVsAnchor="")}))};function sumFn(e,t){return e+t}function getScrollDetails(e,t,r,n,a,s,f,o){const x=e===window?document.scrollingElement||document.documentElement:e,C=a===!0?"offsetWidth":"offsetHeight",P={scrollStart:0,scrollViewSize:-f-o,scrollMaxSize:0,offsetStart:-f,offsetEnd:-o};if(a===!0?(e===window?(P.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,P.scrollViewSize+=document.documentElement.clientWidth):(P.scrollStart=x.scrollLeft,P.scrollViewSize+=x.clientWidth),P.scrollMaxSize=x.scrollWidth,s===!0&&(P.scrollStart=(rtlHasScrollBug===!0?P.scrollMaxSize-P.scrollViewSize:0)-P.scrollStart)):(e===window?(P.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,P.scrollViewSize+=document.documentElement.clientHeight):(P.scrollStart=x.scrollTop,P.scrollViewSize+=x.clientHeight),P.scrollMaxSize=x.scrollHeight),r!==null)for(let Y=r.previousElementSibling;Y!==null;Y=Y.previousElementSibling)Y.classList.contains("q-virtual-scroll--skip")===!1&&(P.offsetStart+=Y[C]);if(n!==null)for(let Y=n.nextElementSibling;Y!==null;Y=Y.nextElementSibling)Y.classList.contains("q-virtual-scroll--skip")===!1&&(P.offsetEnd+=Y[C]);if(t!==e){const Y=x.getBoundingClientRect(),ze=t.getBoundingClientRect();a===!0?(P.offsetStart+=ze.left-Y.left,P.offsetEnd-=ze.width):(P.offsetStart+=ze.top-Y.top,P.offsetEnd-=ze.height),e!==window&&(P.offsetStart+=P.scrollStart),P.offsetEnd+=P.scrollMaxSize-P.offsetStart}return P}function setScroll(e,t,r,n){t==="end"&&(t=(e===window?document.body:e)[r===!0?"scrollWidth":"scrollHeight"]),e===window?r===!0?(n===!0&&(t=(rtlHasScrollBug===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-t),window.scrollTo(t,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,t):r===!0?(n===!0&&(t=(rtlHasScrollBug===!0?e.scrollWidth-e.offsetWidth:0)-t),e.scrollLeft=t):e.scrollTop=t}function sumSize(e,t,r,n){if(r>=n)return 0;const a=t.length,s=Math.floor(r/aggBucketSize),f=Math.floor((n-1)/aggBucketSize)+1;let o=e.slice(s,f).reduce(sumFn,0);return r%aggBucketSize!==0&&(o-=t.slice(s*aggBucketSize,r).reduce(sumFn,0)),n%aggBucketSize!==0&&n!==a&&(o-=t.slice(n,f*aggBucketSize).reduce(sumFn,0)),o}const commonVirtScrollProps={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},commonVirtPropsList=Object.keys(commonVirtScrollProps),useVirtualScrollProps={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...commonVirtScrollProps};function useVirtualScroll({virtualScrollLength:e,getVirtualScrollTarget:t,getVirtualScrollEl:r,virtualScrollItemSizeComputed:n}){const a=getCurrentInstance(),{props:s,emit:f,proxy:o}=a,{$q:x}=o;let C,P,Y,ze=[],ge;const Bt=ref(0),Ur=ref(0),kn=ref({}),Io=ref(null),rl=ref(null),Co=ref(null),as=ref({from:0,to:0}),$s=computed(()=>s.tableColspan!==void 0?s.tableColspan:100);n===void 0&&(n=computed(()=>s.virtualScrollItemSize));const ah=computed(()=>n.value+";"+s.virtualScrollHorizontal),ch=computed(()=>ah.value+";"+s.virtualScrollSliceRatioBefore+";"+s.virtualScrollSliceRatioAfter);watch(ch,()=>{ud()}),watch(ah,Zu);function Zu(){Gh(P,!0)}function ih(vd){Gh(vd===void 0?P:vd)}function al(vd,qd){const Ed=t();if(Ed==null||Ed.nodeType===8)return;const Sd=getScrollDetails(Ed,r(),Io.value,rl.value,s.virtualScrollHorizontal,x.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd);Y!==Sd.scrollViewSize&&ud(Sd.scrollViewSize),_h(Ed,Sd,Math.min(e.value-1,Math.max(0,parseInt(vd,10)||0)),0,scrollToEdges.indexOf(qd)>-1?qd:P>-1&&vd>P?"end":"start")}function sh(){const vd=t();if(vd==null||vd.nodeType===8)return;const qd=getScrollDetails(vd,r(),Io.value,rl.value,s.virtualScrollHorizontal,x.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd),Ed=e.value-1,Sd=qd.scrollMaxSize-qd.offsetStart-qd.offsetEnd-Ur.value;if(C===qd.scrollStart)return;if(qd.scrollMaxSize<=0){_h(vd,qd,0,0);return}Y!==qd.scrollViewSize&&ud(qd.scrollViewSize),Ih(as.value.from);const zd=Math.floor(qd.scrollMaxSize-Math.max(qd.scrollViewSize,qd.offsetEnd)-Math.min(ge[Ed],qd.scrollViewSize/2));if(zd>0&&Math.ceil(qd.scrollStart)>=zd){_h(vd,qd,Ed,qd.scrollMaxSize-qd.offsetEnd-ze.reduce(sumFn,0));return}let Md=0,Gd=qd.scrollStart-qd.offsetStart,bf=Gd;if(Gd<=Sd&&Gd+qd.scrollViewSize>=Bt.value)Gd-=Bt.value,Md=as.value.from,bf=Gd;else for(let Id=0;Gd>=ze[Id]&&Md<Ed;Id++)Gd-=ze[Id],Md+=aggBucketSize;for(;Gd>0&&Md<Ed;)Gd-=ge[Md],Gd>-qd.scrollViewSize?(Md++,bf=Gd):bf=ge[Md]+Gd;_h(vd,qd,Md,bf)}function _h(vd,qd,Ed,Sd,zd){const Md=typeof zd=="string"&&zd.indexOf("-force")>-1,Gd=Md===!0?zd.replace("-force",""):zd,bf=Gd!==void 0?Gd:"start";let Id=Math.max(0,Ed-kn.value[bf]),td=Id+kn.value.total;td>e.value&&(td=e.value,Id=Math.max(0,td-kn.value.total)),C=qd.scrollStart;const Fd=Id!==as.value.from||td!==as.value.to;if(Fd===!1&&Gd===void 0){Kd(Ed);return}const{activeElement:rp}=document,jf=Co.value;Fd===!0&&jf!==null&&jf!==rp&&jf.contains(rp)===!0&&(jf.addEventListener("focusout",Lh),setTimeout(()=>{jf!==null&&jf.removeEventListener("focusout",Lh)})),setOverflowAnchor(jf,Ed-Id);const yd=Gd!==void 0?ge.slice(Id,Ed).reduce(sumFn,0):0;if(Fd===!0){const Jd=td>=as.value.from&&Id<=as.value.to?as.value.to:td;as.value={from:Id,to:Jd},Bt.value=sumSize(ze,ge,0,Id),Ur.value=sumSize(ze,ge,td,e.value),requestAnimationFrame(()=>{as.value.to!==td&&C===qd.scrollStart&&(as.value={from:as.value.from,to:td},Ur.value=sumSize(ze,ge,td,e.value))})}requestAnimationFrame(()=>{if(C!==qd.scrollStart)return;Fd===!0&&Ih(Id);const Jd=ge.slice(Id,Ed).reduce(sumFn,0),op=Jd+qd.offsetStart+Bt.value,bp=op+ge[Ed];let fp=op+Sd;if(Gd!==void 0){const Qh=Jd-yd,Yd=qd.scrollStart+Qh;fp=Md!==!0&&Yd<op&&bp<Yd+qd.scrollViewSize?Yd:Gd==="end"?bp-qd.scrollViewSize:op-(Gd==="start"?0:Math.round((qd.scrollViewSize-ge[Ed])/2))}C=fp,setScroll(vd,fp,s.virtualScrollHorizontal,x.lang.rtl),Kd(Ed)})}function Ih(vd){const qd=Co.value;if(qd){const Ed=filterProto.call(qd.children,Id=>Id.classList&&Id.classList.contains("q-virtual-scroll--skip")===!1),Sd=Ed.length,zd=s.virtualScrollHorizontal===!0?Id=>Id.getBoundingClientRect().width:Id=>Id.offsetHeight;let Md=vd,Gd,bf;for(let Id=0;Id<Sd;){for(Gd=zd(Ed[Id]),Id++;Id<Sd&&Ed[Id].classList.contains("q-virtual-scroll--with-prev")===!0;)Gd+=zd(Ed[Id]),Id++;bf=Gd-ge[Md],bf!==0&&(ge[Md]+=bf,ze[Math.floor(Md/aggBucketSize)]+=bf),Md++}}}function Lh(){Co.value!==null&&Co.value!==void 0&&Co.value.focus()}function Gh(vd,qd){const Ed=1*n.value;(qd===!0||Array.isArray(ge)===!1)&&(ge=[]);const Sd=ge.length;ge.length=e.value;for(let Md=e.value-1;Md>=Sd;Md--)ge[Md]=Ed;const zd=Math.floor((e.value-1)/aggBucketSize);ze=[];for(let Md=0;Md<=zd;Md++){let Gd=0;const bf=Math.min((Md+1)*aggBucketSize,e.value);for(let Id=Md*aggBucketSize;Id<bf;Id++)Gd+=ge[Id];ze.push(Gd)}P=-1,C=void 0,Bt.value=sumSize(ze,ge,0,as.value.from),Ur.value=sumSize(ze,ge,as.value.to,e.value),vd>=0?(Ih(as.value.from),nextTick(()=>{al(vd)})):Af()}function ud(vd){if(vd===void 0&&typeof window<"u"){const Gd=t();Gd!=null&&Gd.nodeType!==8&&(vd=getScrollDetails(Gd,r(),Io.value,rl.value,s.virtualScrollHorizontal,x.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd).scrollViewSize)}Y=vd;const qd=parseFloat(s.virtualScrollSliceRatioBefore)||0,Ed=parseFloat(s.virtualScrollSliceRatioAfter)||0,Sd=1+qd+Ed,zd=vd===void 0||vd<=0?1:Math.ceil(vd/n.value),Md=Math.max(1,zd,Math.ceil((s.virtualScrollSliceSize>0?s.virtualScrollSliceSize:10)/Sd));kn.value={total:Math.ceil(Md*Sd),start:Math.ceil(Md*qd),center:Math.ceil(Md*(.5+qd)),end:Math.ceil(Md*(1+qd)),view:zd}}function Tf(vd,qd){const Ed=s.virtualScrollHorizontal===!0?"width":"height",Sd={["--q-virtual-scroll-item-"+Ed]:n.value+"px"};return[vd==="tbody"?h(vd,{class:"q-virtual-scroll__padding",key:"before",ref:Io},[h("tr",[h("td",{style:{[Ed]:`${Bt.value}px`,...Sd},colspan:$s.value})])]):h(vd,{class:"q-virtual-scroll__padding",key:"before",ref:Io,style:{[Ed]:`${Bt.value}px`,...Sd}}),h(vd,{class:"q-virtual-scroll__content",key:"content",ref:Co,tabindex:-1},qd.flat()),vd==="tbody"?h(vd,{class:"q-virtual-scroll__padding",key:"after",ref:rl},[h("tr",[h("td",{style:{[Ed]:`${Ur.value}px`,...Sd},colspan:$s.value})])]):h(vd,{class:"q-virtual-scroll__padding",key:"after",ref:rl,style:{[Ed]:`${Ur.value}px`,...Sd}})]}function Kd(vd){P!==vd&&(s.onVirtualScroll!==void 0&&f("virtualScroll",{index:vd,from:as.value.from,to:as.value.to-1,direction:vd<P?"decrease":"increase",ref:o}),P=vd)}ud();const Af=debounce$2(sh,x.platform.is.ios===!0?120:35);onBeforeMount(()=>{ud()});let md=!1;return onDeactivated(()=>{md=!0}),onActivated(()=>{if(md!==!0)return;const vd=t();C!==void 0&&vd!==void 0&&vd!==null&&vd.nodeType!==8?setScroll(vd,C,s.virtualScrollHorizontal,x.lang.rtl):al(P)}),onBeforeUnmount(()=>{Af.cancel()}),Object.assign(o,{scrollTo:al,reset:Zu,refresh:ih}),{virtualScrollSliceRange:as,virtualScrollSliceSizeComputed:kn,setVirtualScrollSize:ud,onVirtualScrollEvt:Af,localResetVirtualScroll:Gh,padVirtualScroll:Tf,scrollTo:al,reset:Zu,refresh:ih}}const validateNewValueMode=e=>["add","add-unique","toggle"].includes(e),reEscapeList=".*+?^${}()|[]\\",fieldPropsList=Object.keys(useFieldProps),QSelect=createComponent({name:"QSelect",inheritAttrs:!1,props:{...useVirtualScrollProps,...useFormProps,...useFieldProps,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:validateNewValueMode},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...useFieldEmits,"add","remove","inputValue","newValue","keyup","keypress","keydown","filterAbort"],setup(e,{slots:t,emit:r}){const{proxy:n}=getCurrentInstance(),{$q:a}=n,s=ref(!1),f=ref(!1),o=ref(-1),x=ref(""),C=ref(!1),P=ref(!1);let Y=null,ze,ge,Bt,Ur=null,kn,Io,rl,Co;const as=ref(null),$s=ref(null),ah=ref(null),ch=ref(null),Zu=ref(null),ih=useFormInputNameAttr(e),al=useKeyComposition(Dd),sh=computed(()=>Array.isArray(e.options)?e.options.length:0),_h=computed(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:Ih,virtualScrollSliceSizeComputed:Lh,localResetVirtualScroll:Gh,padVirtualScroll:ud,onVirtualScrollEvt:Tf,scrollTo:Kd,setVirtualScrollSize:Af}=useVirtualScroll({virtualScrollLength:sh,getVirtualScrollTarget:hp,getVirtualScrollEl:Sm,virtualScrollItemSizeComputed:_h}),md=useFieldState(),vd=computed(()=>{const Ah=e.mapOptions===!0&&e.multiple!==!0,mf=e.modelValue!==void 0&&(e.modelValue!==null||Ah===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const Od=e.mapOptions===!0&&ze!==void 0?ze:[],qf=mf.map(mp=>Sp(mp,Od));return e.modelValue===null&&Ah===!0?qf.filter(mp=>mp!==null):qf}return mf}),qd=computed(()=>{const Ah={};return fieldPropsList.forEach(mf=>{const Od=e[mf];Od!==void 0&&(Ah[mf]=Od)}),Ah}),Ed=computed(()=>e.optionsDark===null?md.isDark.value:e.optionsDark),Sd=computed(()=>fieldValueIsFilled(vd.value)),zd=computed(()=>{let Ah="q-field__input q-placeholder col";return e.hideSelected===!0||vd.value.length===0?[Ah,e.inputClass]:(Ah+=" q-field__input--padding",e.inputClass===void 0?Ah:[Ah,e.inputClass])}),Md=computed(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),Gd=computed(()=>sh.value===0),bf=computed(()=>vd.value.map(Ah=>sd.value(Ah)).join(", ")),Id=computed(()=>e.displayValue!==void 0?e.displayValue:bf.value),td=computed(()=>e.optionsHtml===!0?()=>!0:Ah=>Ah!=null&&Ah.html===!0),Fd=computed(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||vd.value.some(td.value))),rp=computed(()=>md.focused.value===!0?e.tabindex:-1),jf=computed(()=>{const Ah={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":s.value===!0?"true":"false","aria-controls":`${md.targetUid.value}_lb`};return o.value>=0&&(Ah["aria-activedescendant"]=`${md.targetUid.value}_${o.value}`),Ah}),yd=computed(()=>({id:`${md.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),Jd=computed(()=>vd.value.map((Ah,mf)=>({index:mf,opt:Ah,html:td.value(Ah),selected:!0,removeAtIndex:Df,toggleOption:Nf,tabindex:rp.value}))),op=computed(()=>{if(sh.value===0)return[];const{from:Ah,to:mf}=Ih.value;return e.options.slice(Ah,mf).map((Od,qf)=>{const mp=Zd.value(Od)===!0,Vp=Ah+qf,om={clickable:!0,active:!1,activeClass:Qh.value,manualFocus:!0,focused:!1,disable:mp,tabindex:-1,dense:e.optionsDense,dark:Ed.value,role:"option",id:`${md.targetUid.value}_${Vp}`,onClick:()=>{Nf(Od)}};return mp!==!0&&(Yf(Od)===!0&&(om.active=!0),o.value===Vp&&(om.focused=!0),om["aria-selected"]=om.active===!0?"true":"false",a.platform.is.desktop===!0&&(om.onMousemove=()=>{s.value===!0&&Wf(Vp)})),{index:Vp,opt:Od,html:td.value(Od),label:sd.value(Od),selected:om.active,focused:om.focused,toggleOption:Nf,setOptionIndex:Wf,itemProps:om}})}),bp=computed(()=>e.dropdownIcon!==void 0?e.dropdownIcon:a.iconSet.arrow.dropdown),fp=computed(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Qh=computed(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),Yd=computed(()=>Pp(e.optionValue,"value")),sd=computed(()=>Pp(e.optionLabel,"label")),Zd=computed(()=>Pp(e.optionDisable,"disable")),Xh=computed(()=>vd.value.map(Ah=>Yd.value(Ah))),Ld=computed(()=>{const Ah={onInput:Dd,onChange:al,onKeydown:rm,onKeyup:Xd,onKeypress:Op,onFocus:qp,onClick(mf){ge===!0&&stop(mf)}};return Ah.onCompositionstart=Ah.onCompositionupdate=Ah.onCompositionend=al,Ah});watch(vd,Ah=>{ze=Ah,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&md.innerLoading.value!==!0&&(f.value!==!0&&s.value!==!0||Sd.value!==!0)&&(Bt!==!0&&zh(),(f.value===!0||s.value===!0)&&Jh(""))},{immediate:!0}),watch(()=>e.fillInput,zh),watch(s,Ad),watch(sh,wd);function Kf(Ah){return e.emitValue===!0?Yd.value(Ah):Ah}function If(Ah){if(Ah>-1&&Ah<vd.value.length)if(e.multiple===!0){const mf=e.modelValue.slice();r("remove",{index:Ah,value:mf.splice(Ah,1)[0]}),r("update:modelValue",mf)}else r("update:modelValue",null)}function Df(Ah){If(Ah),md.focus()}function Jf(Ah,mf){const Od=Kf(Ah);if(e.multiple!==!0){e.fillInput===!0&&mh(sd.value(Ah),!0,!0),r("update:modelValue",Od);return}if(vd.value.length===0){r("add",{index:0,value:Od}),r("update:modelValue",e.multiple===!0?[Od]:Od);return}if(mf===!0&&Yf(Ah)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const qf=e.modelValue.slice();r("add",{index:qf.length,value:Od}),qf.push(Od),r("update:modelValue",qf)}function Nf(Ah,mf){if(md.editable.value!==!0||Ah===void 0||Zd.value(Ah)===!0)return;const Od=Yd.value(Ah);if(e.multiple!==!0){mf!==!0&&(mh(e.fillInput===!0?sd.value(Ah):"",!0,!0),Ph()),$s.value!==null&&$s.value.focus(),(vd.value.length===0||isDeepEqual(Yd.value(vd.value[0]),Od)!==!0)&&r("update:modelValue",e.emitValue===!0?Od:Ah);return}if((ge!==!0||C.value===!0)&&md.focus(),qp(),vd.value.length===0){const Vp=e.emitValue===!0?Od:Ah;r("add",{index:0,value:Vp}),r("update:modelValue",e.multiple===!0?[Vp]:Vp);return}const qf=e.modelValue.slice(),mp=Xh.value.findIndex(Vp=>isDeepEqual(Vp,Od));if(mp>-1)r("remove",{index:mp,value:qf.splice(mp,1)[0]});else{if(e.maxValues!==void 0&&qf.length>=e.maxValues)return;const Vp=e.emitValue===!0?Od:Ah;r("add",{index:qf.length,value:Vp}),qf.push(Vp)}r("update:modelValue",qf)}function Wf(Ah){if(a.platform.is.desktop!==!0)return;const mf=Ah>-1&&Ah<sh.value?Ah:-1;o.value!==mf&&(o.value=mf)}function Mp(Ah=1,mf){if(s.value===!0){let Od=o.value;do Od=normalizeToInterval(Od+Ah,-1,sh.value-1);while(Od!==-1&&Od!==o.value&&Zd.value(e.options[Od])===!0);o.value!==Od&&(Wf(Od),Kd(Od),mf!==!0&&e.useInput===!0&&e.fillInput===!0&&Hf(Od>=0?sd.value(e.options[Od]):kn))}}function Sp(Ah,mf){const Od=qf=>isDeepEqual(Yd.value(qf),Ah);return e.options.find(Od)||mf.find(Od)||Ah}function Pp(Ah,mf){const Od=Ah!==void 0?Ah:mf;return typeof Od=="function"?Od:qf=>qf!==null&&typeof qf=="object"&&Od in qf?qf[Od]:qf}function Yf(Ah){const mf=Yd.value(Ah);return Xh.value.find(Od=>isDeepEqual(Od,mf))!==void 0}function qp(Ah){e.useInput===!0&&$s.value!==null&&(Ah===void 0||$s.value===Ah.target&&Ah.target.value===bf.value)&&$s.value.select()}function sm(Ah){isKeyCode(Ah,27)===!0&&s.value===!0&&(stop(Ah),Ph(),zh()),r("keyup",Ah)}function Xd(Ah){const{value:mf}=Ah.target;if(Ah.keyCode!==void 0){sm(Ah);return}if(Ah.target.value="",Y!==null&&(clearTimeout(Y),Y=null),zh(),typeof mf=="string"&&mf.length!==0){const Od=mf.toLocaleLowerCase(),qf=Vp=>{const om=e.options.find(Pd=>Vp.value(Pd).toLocaleLowerCase()===Od);return om===void 0?!1:(vd.value.indexOf(om)===-1?Nf(om):Ph(),!0)},mp=Vp=>{qf(Yd)!==!0&&(qf(sd)===!0||Vp===!0||Jh(mf,!0,()=>mp(!0)))};mp()}else md.clearValue(Ah)}function Op(Ah){r("keypress",Ah)}function rm(Ah){if(r("keydown",Ah),shouldIgnoreKey(Ah)===!0)return;const mf=x.value.length!==0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),Od=Ah.shiftKey!==!0&&e.multiple!==!0&&(o.value>-1||mf===!0);if(Ah.keyCode===27){prevent(Ah);return}if(Ah.keyCode===9&&Od===!1){dh();return}if(Ah.target===void 0||Ah.target.id!==md.targetUid.value)return;if(Ah.keyCode===40&&md.innerLoading.value!==!0&&s.value===!1){stopAndPrevent(Ah),vh();return}if(Ah.keyCode===8&&e.hideSelected!==!0&&x.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?If(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&r("update:modelValue",null);return}(Ah.keyCode===35||Ah.keyCode===36)&&(typeof x.value!="string"||x.value.length===0)&&(stopAndPrevent(Ah),o.value=-1,Mp(Ah.keyCode===36?1:-1,e.multiple)),(Ah.keyCode===33||Ah.keyCode===34)&&Lh.value!==void 0&&(stopAndPrevent(Ah),o.value=Math.max(-1,Math.min(sh.value,o.value+(Ah.keyCode===33?-1:1)*Lh.value.view)),Mp(Ah.keyCode===33?1:-1,e.multiple)),(Ah.keyCode===38||Ah.keyCode===40)&&(stopAndPrevent(Ah),Mp(Ah.keyCode===38?-1:1,e.multiple));const qf=sh.value;if((rl===void 0||Co<Date.now())&&(rl=""),qf>0&&e.useInput!==!0&&Ah.key!==void 0&&Ah.key.length===1&&Ah.altKey===!1&&Ah.ctrlKey===!1&&Ah.metaKey===!1&&(Ah.keyCode!==32||rl.length!==0)){s.value!==!0&&vh(Ah);const mp=Ah.key.toLocaleLowerCase(),Vp=rl.length===1&&rl[0]===mp;Co=Date.now()+1500,Vp===!1&&(stopAndPrevent(Ah),rl+=mp);const om=new RegExp("^"+rl.split("").map(Hg=>reEscapeList.indexOf(Hg)>-1?"\\"+Hg:Hg).join(".*"),"i");let Pd=o.value;if(Vp===!0||Pd<0||om.test(sd.value(e.options[Pd]))!==!0)do Pd=normalizeToInterval(Pd+1,-1,qf-1);while(Pd!==o.value&&(Zd.value(e.options[Pd])===!0||om.test(sd.value(e.options[Pd]))!==!0));o.value!==Pd&&nextTick(()=>{Wf(Pd),Kd(Pd),Pd>=0&&e.useInput===!0&&e.fillInput===!0&&Hf(sd.value(e.options[Pd]))});return}if(!(Ah.keyCode!==13&&(Ah.keyCode!==32||e.useInput===!0||rl!=="")&&(Ah.keyCode!==9||Od===!1))){if(Ah.keyCode!==9&&stopAndPrevent(Ah),o.value>-1&&o.value<qf){Nf(e.options[o.value]);return}if(mf===!0){const mp=(Vp,om)=>{if(om){if(validateNewValueMode(om)!==!0)return}else om=e.newValueMode;if(Vp==null)return;mh("",e.multiple!==!0,!0),(om==="toggle"?Nf:Jf)(Vp,om==="add-unique"),e.multiple!==!0&&($s.value!==null&&$s.value.focus(),Ph())};if(e.onNewValue!==void 0?r("newValue",x.value,mp):mp(x.value),e.multiple!==!0)return}s.value===!0?dh():md.innerLoading.value!==!0&&vh()}}function Sm(){return ge===!0?Zu.value:ah.value!==null&&ah.value.contentEl!==null?ah.value.contentEl:void 0}function hp(){return Sm()}function Em(){return e.hideSelected===!0?[]:t["selected-item"]!==void 0?Jd.value.map(Ah=>t["selected-item"](Ah)).slice():t.selected!==void 0?[].concat(t.selected()):e.useChips===!0?Jd.value.map((Ah,mf)=>h(QChip,{key:"option-"+mf,removable:md.editable.value===!0&&Zd.value(Ah.opt)!==!0,dense:!0,textColor:e.color,tabindex:rp.value,onRemove(){Ah.removeAtIndex(mf)}},()=>h("span",{class:"ellipsis",[Ah.html===!0?"innerHTML":"textContent"]:sd.value(Ah.opt)}))):[h("span",{[Fd.value===!0?"innerHTML":"textContent"]:Id.value})]}function Qp(){if(Gd.value===!0)return t["no-option"]!==void 0?t["no-option"]({inputValue:x.value}):void 0;const Ah=t.option!==void 0?t.option:Od=>h(QItem,{key:Od.index,...Od.itemProps},()=>h(QItemSection,()=>h(QItemLabel,()=>h("span",{[Od.html===!0?"innerHTML":"textContent"]:Od.label}))));let mf=ud("div",op.value.map(Ah));return t["before-options"]!==void 0&&(mf=t["before-options"]().concat(mf)),hMergeSlot(t["after-options"],mf)}function lm(Ah,mf){const Od=mf===!0?{...jf.value,...md.splitAttrs.attributes.value}:void 0,qf={ref:mf===!0?$s:void 0,key:"i_t",class:zd.value,style:e.inputStyle,value:x.value!==void 0?x.value:"",type:"search",...Od,id:mf===!0?md.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":Ah===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...Ld.value};return Ah!==!0&&ge===!0&&(Array.isArray(qf.class)===!0?qf.class=[...qf.class,"no-pointer-events"]:qf.class+=" no-pointer-events"),h("input",qf)}function Dd(Ah){Y!==null&&(clearTimeout(Y),Y=null),!(Ah&&Ah.target&&Ah.target.qComposing===!0)&&(Hf(Ah.target.value||""),Bt=!0,kn=x.value,md.focused.value!==!0&&(ge!==!0||C.value===!0)&&md.focus(),e.onFilter!==void 0&&(Y=setTimeout(()=>{Y=null,Jh(x.value)},e.inputDebounce)))}function Hf(Ah){x.value!==Ah&&(x.value=Ah,r("inputValue",Ah))}function mh(Ah,mf,Od){Bt=Od!==!0,e.useInput===!0&&(Hf(Ah),(mf===!0||Od!==!0)&&(kn=Ah),mf!==!0&&Jh(Ah))}function Jh(Ah,mf,Od){if(e.onFilter===void 0||mf!==!0&&md.focused.value!==!0)return;md.innerLoading.value===!0?r("filterAbort"):(md.innerLoading.value=!0,P.value=!0),Ah!==""&&e.multiple!==!0&&vd.value.length!==0&&Bt!==!0&&Ah===sd.value(vd.value[0])&&(Ah="");const qf=setTimeout(()=>{s.value===!0&&(s.value=!1)},10);Ur!==null&&clearTimeout(Ur),Ur=qf,r("filter",Ah,(mp,Vp)=>{(mf===!0||md.focused.value===!0)&&Ur===qf&&(clearTimeout(Ur),typeof mp=="function"&&mp(),P.value=!1,nextTick(()=>{md.innerLoading.value=!1,md.editable.value===!0&&(mf===!0?s.value===!0&&Ph():s.value===!0?Ad(!0):s.value=!0),typeof Vp=="function"&&nextTick(()=>{Vp(n)}),typeof Od=="function"&&nextTick(()=>{Od(n)})}))},()=>{md.focused.value===!0&&Ur===qf&&(clearTimeout(Ur),md.innerLoading.value=!1,P.value=!1),s.value===!0&&(s.value=!1)})}function Wu(){return h(QMenu,{ref:ah,class:Md.value,style:e.popupContentStyle,modelValue:s.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&Gd.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:Ed.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:fp.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...yd.value,onScrollPassive:Tf,onBeforeShow:xf,onBeforeHide:sl,onShow:Gn},Qp)}function sl(Ah){zf(Ah),dh()}function Gn(){Af()}function _n(Ah){stop(Ah),$s.value!==null&&$s.value.focus(),C.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function cs(Ah){stop(Ah),nextTick(()=>{C.value=!1})}function $u(){const Ah=[h(QField,{class:`col-auto ${md.fieldClass.value}`,...qd.value,for:md.targetUid.value,dark:Ed.value,square:!0,loading:P.value,itemAligned:!1,filled:!0,stackLabel:x.value.length!==0,...md.splitAttrs.listeners.value,onFocus:_n,onBlur:cs},{...t,rawControl:()=>md.getControl(!0),before:void 0,after:void 0})];return s.value===!0&&Ah.push(h("div",{ref:Zu,class:Md.value+" scroll",style:e.popupContentStyle,...yd.value,onClick:prevent,onScrollPassive:Tf},Qp())),h(QDialog,{ref:ch,modelValue:f.value,position:e.useInput===!0?"top":void 0,transitionShow:Io,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:xf,onBeforeHide:eh,onHide:nh,onShow:uh},()=>h("div",{class:"q-select__dialog"+(Ed.value===!0?" q-select__dialog--dark q-dark":"")+(C.value===!0?" q-select__dialog--focused":"")},Ah))}function eh(Ah){zf(Ah),ch.value!==null&&ch.value.__updateRefocusTarget(md.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),md.focused.value=!1}function nh(Ah){Ph(),md.focused.value===!1&&r("blur",Ah),zh()}function uh(){const Ah=document.activeElement;(Ah===null||Ah.id!==md.targetUid.value)&&$s.value!==null&&$s.value!==Ah&&$s.value.focus(),Af()}function dh(){f.value!==!0&&(o.value=-1,s.value===!0&&(s.value=!1),md.focused.value===!1&&(Ur!==null&&(clearTimeout(Ur),Ur=null),md.innerLoading.value===!0&&(r("filterAbort"),md.innerLoading.value=!1,P.value=!1)))}function vh(Ah){md.editable.value===!0&&(ge===!0?(md.onControlFocusin(Ah),f.value=!0,nextTick(()=>{md.focus()})):md.focus(),e.onFilter!==void 0?Jh(x.value):(Gd.value!==!0||t["no-option"]!==void 0)&&(s.value=!0))}function Ph(){f.value=!1,dh()}function zh(){e.useInput===!0&&mh(e.multiple!==!0&&e.fillInput===!0&&vd.value.length!==0&&sd.value(vd.value[0])||"",!0,!0)}function Ad(Ah){let mf=-1;if(Ah===!0){if(vd.value.length!==0){const Od=Yd.value(vd.value[0]);mf=e.options.findIndex(qf=>isDeepEqual(Yd.value(qf),Od))}Gh(mf)}Wf(mf)}function wd(Ah,mf){s.value===!0&&md.innerLoading.value===!1&&(Gh(-1,!0),nextTick(()=>{s.value===!0&&md.innerLoading.value===!1&&(Ah>mf?Gh():Ad(!0))}))}function Qd(){f.value===!1&&ah.value!==null&&ah.value.updatePosition()}function xf(Ah){Ah!==void 0&&stop(Ah),r("popupShow",Ah),md.hasPopupOpen=!0,md.onControlFocusin(Ah)}function zf(Ah){Ah!==void 0&&stop(Ah),r("popupHide",Ah),md.hasPopupOpen=!1,md.onControlFocusout(Ah)}function np(){ge=a.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?t["no-option"]!==void 0||e.onFilter!==void 0||Gd.value===!1:!0),Io=a.platform.is.ios===!0&&ge===!0&&e.useInput===!0?"fade":e.transitionShow}return onBeforeUpdate(np),onUpdated(Qd),np(),onBeforeUnmount(()=>{Y!==null&&clearTimeout(Y)}),Object.assign(n,{showPopup:vh,hidePopup:Ph,removeAtIndex:If,add:Jf,toggleOption:Nf,getOptionIndex:()=>o.value,setOptionIndex:Wf,moveOptionSelection:Mp,filter:Jh,updateMenuPosition:Qd,updateInputValue:mh,isOptionSelected:Yf,getEmittingOptionValue:Kf,isOptionDisabled:(...Ah)=>Zd.value.apply(null,Ah)===!0,getOptionValue:(...Ah)=>Yd.value.apply(null,Ah),getOptionLabel:(...Ah)=>sd.value.apply(null,Ah)}),Object.assign(md,{innerValue:vd,fieldClass:computed(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:as,targetRef:$s,hasValue:Sd,showPopup:vh,floatingLabel:computed(()=>e.hideSelected!==!0&&Sd.value===!0||typeof x.value=="number"||x.value.length!==0||fieldValueIsFilled(e.displayValue)),getControlChild:()=>{if(md.editable.value!==!1&&(f.value===!0||Gd.value!==!0||t["no-option"]!==void 0))return ge===!0?$u():Wu();md.hasPopupOpen===!0&&(md.hasPopupOpen=!1)},controlEvents:{onFocusin(Ah){md.onControlFocusin(Ah)},onFocusout(Ah){md.onControlFocusout(Ah,()=>{zh(),dh()})},onClick(Ah){if(prevent(Ah),ge!==!0&&s.value===!0){dh(),$s.value!==null&&$s.value.focus();return}vh(Ah)}},getControl:Ah=>{const mf=Em(),Od=Ah===!0||f.value!==!0||ge!==!0;if(e.useInput===!0)mf.push(lm(Ah,Od));else if(md.editable.value===!0){const mp=Od===!0?jf.value:void 0;mf.push(h("input",{ref:Od===!0?$s:void 0,key:"d_t",class:"q-select__focus-target",id:Od===!0?md.targetUid.value:void 0,value:Id.value,readonly:!0,"data-autofocus":Ah===!0||e.autofocus===!0||void 0,...mp,onKeydown:rm,onKeyup:sm,onKeypress:Op})),Od===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length!==0&&mf.push(h("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:Xd}))}if(ih.value!==void 0&&e.disable!==!0&&Xh.value.length!==0){const mp=Xh.value.map(Vp=>h("option",{value:Vp,selected:!0}));mf.push(h("select",{class:"hidden",name:ih.value,multiple:e.multiple},mp))}const qf=e.useInput===!0||Od!==!0?void 0:md.splitAttrs.attributes.value;return h("div",{class:"q-field__native row items-center",...qf,...md.splitAttrs.listeners.value},mf)},getInnerAppend:()=>e.loading!==!0&&P.value!==!0&&e.hideDropdownIcon!==!0?[h(QIcon,{class:"q-select__dropdown-icon"+(s.value===!0?" rotate-180":""),name:bp.value})]:null}),useField(md)}}),QTd=createComponent({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:t}){const r=getCurrentInstance(),n=computed(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return h("td",{class:n.value},hSlot(t.default));const a=r.vnode.key,s=(e.props.colsMap!==void 0?e.props.colsMap[a]:null)||e.props.col;if(s===void 0)return;const{row:f}=e.props;return h("td",{class:n.value+s.__tdClass(f),style:s.__tdStyle(f)},hSlot(t.default))}}});function cloneDeep(e,t=new WeakMap){if(Object(e)!==e)return e;if(t.has(e))return t.get(e);const r=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const n=e.valueOf();if(Object(n)!==n){const a=new e.constructor(n);return t.set(e,a),a}}return t.set(e,r),e instanceof Set?e.forEach(n=>{r.add(cloneDeep(n,t))}):e instanceof Map&&e.forEach((n,a)=>{r.set(a,cloneDeep(n,t))}),Object.assign(r,...Object.keys(e).map(n=>({[n]:cloneDeep(e[n],t)})))}const QPopupEdit=createComponent({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:r}){const{proxy:n}=getCurrentInstance(),{$q:a}=n,s=ref(null),f=ref(""),o=ref("");let x=!1;const C=computed(()=>injectProp({initialValue:f.value,validate:e.validate,set:P,cancel:Y,updatePosition:ze},"value",()=>o.value,as=>{o.value=as}));function P(){e.validate(o.value)!==!1&&(ge()===!0&&(r("save",o.value,f.value),r("update:modelValue",o.value)),Bt())}function Y(){ge()===!0&&r("cancel",o.value,f.value),Bt()}function ze(){nextTick(()=>{s.value.updatePosition()})}function ge(){return isDeepEqual(o.value,f.value)===!1}function Bt(){x=!0,s.value.hide()}function Ur(){x=!1,f.value=cloneDeep(e.modelValue),o.value=cloneDeep(e.modelValue),r("beforeShow")}function kn(){r("show")}function Io(){x===!1&&ge()===!0&&(e.autoSave===!0&&e.validate(o.value)===!0?(r("save",o.value,f.value),r("update:modelValue",o.value)):r("cancel",o.value,f.value)),r("beforeHide")}function rl(){r("hide")}function Co(){const as=t.default!==void 0?[].concat(t.default(C.value)):[];return e.title&&as.unshift(h("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&as.push(h("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[h(QBtn,{flat:!0,color:e.color,label:e.labelCancel||a.lang.label.cancel,onClick:Y}),h(QBtn,{flat:!0,color:e.color,label:e.labelSet||a.lang.label.set,onClick:P})])),as}return Object.assign(n,{set:P,cancel:Y,show(as){s.value!==null&&s.value.show(as)},hide(as){s.value!==null&&s.value.hide(as)},updatePosition:ze}),()=>{if(e.disable!==!0)return h(QMenu,{ref:s,class:"q-popup-edit",cover:e.cover,onBeforeShow:Ur,onShow:kn,onBeforeHide:Io,onHide:rl,onEscapeKey:Y},Co)}}}),QTr=createComponent({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const r=computed(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>h("tr",{class:r.value},hSlot(t.default))}}),QTh=createComponent({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:t,emit:r}){const n=getCurrentInstance(),{proxy:{$q:a}}=n,s=f=>{r("click",f)};return()=>{if(e.props===void 0)return h("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:s},hSlot(t.default));let f,o;const x=n.vnode.key;if(x){if(f=e.props.colsMap[x],f===void 0)return}else f=e.props.col;if(f.sortable===!0){const P=f.align==="right"?"unshift":"push";o=hUniqueSlot(t.default,[]),o[P](h(QIcon,{class:f.__iconClass,name:a.iconSet.table.arrowUp}))}else o=hSlot(t.default);const C={class:f.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:f.headerStyle,onClick:P=>{f.sortable===!0&&e.props.sort(f),s(P)}};return h("th",C,o)}}}),QList=createComponent({name:"QList",props:{...useDarkProps,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:t}){const r=getCurrentInstance(),n=useDark(e,r.proxy.$q),a=computed(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(n.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>h(e.tag,{class:a.value},hSlot(t.default))}}),separatorValues=["horizontal","vertical","cell","none"],QMarkupTable=createComponent({name:"QMarkupTable",props:{...useDarkProps,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>separatorValues.includes(e)}},setup(e,{slots:t}){const r=getCurrentInstance(),n=useDark(e,r.proxy.$q),a=computed(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(n.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>h("div",{class:a.value},[h("table",{class:"q-table"},hSlot(t.default))])}});function getTableMiddle(e,t){return h("div",e,[h("table",{class:"q-table"},t)])}const comps={list:QList,table:QMarkupTable},typeOptions=["list","table","__qtable"],QVirtualScroll=createComponent({name:"QVirtualScroll",props:{...useVirtualScrollProps,type:{type:String,default:"list",validator:e=>typeOptions.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:t,attrs:r}){let n;const a=ref(null),s=computed(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:f,localResetVirtualScroll:o,padVirtualScroll:x,onVirtualScrollEvt:C}=useVirtualScroll({virtualScrollLength:s,getVirtualScrollTarget:Bt,getVirtualScrollEl:ge}),P=computed(()=>{if(s.value===0)return[];const rl=(Co,as)=>({index:f.value.from+as,item:Co});return e.itemsFn===void 0?e.items.slice(f.value.from,f.value.to).map(rl):e.itemsFn(f.value.from,f.value.to-f.value.from).map(rl)}),Y=computed(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),ze=computed(()=>e.scrollTarget!==void 0?{}:{tabindex:0});watch(s,()=>{o()}),watch(()=>e.scrollTarget,()=>{kn(),Ur()});function ge(){return a.value.$el||a.value}function Bt(){return n}function Ur(){n=getScrollTarget(ge(),e.scrollTarget),n.addEventListener("scroll",C,listenOpts.passive)}function kn(){n!==void 0&&(n.removeEventListener("scroll",C,listenOpts.passive),n=void 0)}function Io(){let rl=x(e.type==="list"?"div":"tbody",P.value.map(t.default));return t.before!==void 0&&(rl=t.before().concat(rl)),hMergeSlot(t.after,rl)}return onBeforeMount(()=>{o()}),onMounted(()=>{Ur()}),onActivated(()=>{Ur()}),onDeactivated(()=>{kn()}),onBeforeUnmount(()=>{kn()}),()=>{if(t.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?getTableMiddle({ref:a,class:"q-table__middle "+Y.value},Io()):h(comps[e.type],{...r,ref:a,class:[r.class,Y.value],...ze.value},Io)}}}),defaultSizes={xs:2,sm:4,md:6,lg:10,xl:14};function width(e,t,r){return{transform:t===!0?`translateX(${r.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}const QLinearProgress=createComponent({name:"QLinearProgress",props:{...useDarkProps,...useSizeProps,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:r}=getCurrentInstance(),n=useDark(e,r.$q),a=useSize(e,defaultSizes),s=computed(()=>e.indeterminate===!0||e.query===!0),f=computed(()=>e.reverse!==e.query),o=computed(()=>({...a.value!==null?a.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),x=computed(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),C=computed(()=>width(e.buffer!==void 0?e.buffer:1,f.value,r.$q)),P=computed(()=>`with${e.instantFeedback===!0?"out":""}-transition`),Y=computed(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${P.value} q-linear-progress__track--${n.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),ze=computed(()=>width(s.value===!0?1:e.value,f.value,r.$q)),ge=computed(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${P.value} q-linear-progress__model--${s.value===!0?"in":""}determinate`),Bt=computed(()=>({width:`${e.value*100}%`})),Ur=computed(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${P.value}`);return()=>{const kn=[h("div",{class:Y.value,style:C.value}),h("div",{class:ge.value,style:ze.value})];return e.stripe===!0&&s.value===!1&&kn.push(h("div",{class:Ur.value,style:Bt.value})),h("div",{class:x.value,style:o.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},hMergeSlot(t.default,kn))}}});let counter=0;const useFullscreenProps={fullscreen:Boolean,noRouteFullscreenExit:Boolean},useFullscreenEmits=["update:fullscreen","fullscreen"];function useFullscreen(){const e=getCurrentInstance(),{props:t,emit:r,proxy:n}=e;let a,s,f;const o=ref(!1);vmHasRouter(e)===!0&&watch(()=>n.$route.fullPath,()=>{t.noRouteFullscreenExit!==!0&&P()}),watch(()=>t.fullscreen,Y=>{o.value!==Y&&x()}),watch(o,Y=>{r("update:fullscreen",Y),r("fullscreen",Y)});function x(){o.value===!0?P():C()}function C(){o.value!==!0&&(o.value=!0,f=n.$el.parentNode,f.replaceChild(s,n.$el),document.body.appendChild(n.$el),counter++,counter===1&&document.body.classList.add("q-body--fullscreen-mixin"),a={handler:P},History.add(a))}function P(){o.value===!0&&(a!==void 0&&(History.remove(a),a=void 0),f.replaceChild(n.$el,s),o.value=!1,counter=Math.max(0,counter-1),counter===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),n.$el.scrollIntoView!==void 0&&setTimeout(()=>{n.$el.scrollIntoView()})))}return onBeforeMount(()=>{s=document.createElement("span")}),onMounted(()=>{t.fullscreen===!0&&C()}),onBeforeUnmount(P),Object.assign(n,{toggleFullscreen:x,setFullscreen:C,exitFullscreen:P}),{inFullscreen:o,toggleFullscreen:x}}function sortDate(e,t){return new Date(e)-new Date(t)}const useTableSortProps={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function useTableSort(e,t,r,n){const a=computed(()=>{const{sortBy:o}=t.value;return o&&r.value.find(x=>x.name===o)||null}),s=computed(()=>e.sortMethod!==void 0?e.sortMethod:(o,x,C)=>{const P=r.value.find(ge=>ge.name===x);if(P===void 0||P.field===void 0)return o;const Y=C===!0?-1:1,ze=typeof P.field=="function"?ge=>P.field(ge):ge=>ge[P.field];return o.sort((ge,Bt)=>{let Ur=ze(ge),kn=ze(Bt);return Ur==null?-1*Y:kn==null?1*Y:P.sort!==void 0?P.sort(Ur,kn,ge,Bt)*Y:isNumber$1(Ur)===!0&&isNumber$1(kn)===!0?(Ur-kn)*Y:isDate(Ur)===!0&&isDate(kn)===!0?sortDate(Ur,kn)*Y:typeof Ur=="boolean"&&typeof kn=="boolean"?(Ur-kn)*Y:([Ur,kn]=[Ur,kn].map(Io=>(Io+"").toLocaleString().toLowerCase()),Ur<kn?-1*Y:Ur===kn?0:Y)})});function f(o){let x=e.columnSortOrder;if(isObject$6(o)===!0)o.sortOrder&&(x=o.sortOrder),o=o.name;else{const Y=r.value.find(ze=>ze.name===o);Y!==void 0&&Y.sortOrder&&(x=Y.sortOrder)}let{sortBy:C,descending:P}=t.value;C!==o?(C=o,P=x==="da"):e.binaryStateSort===!0?P=!P:P===!0?x==="ad"?C=null:P=!1:x==="ad"?P=!0:C=null,n({sortBy:C,descending:P,page:1})}return{columnToSort:a,computedSortMethod:s,sort:f}}const useTableFilterProps={filter:[String,Object],filterMethod:Function};function useTableFilter(e,t){const r=computed(()=>e.filterMethod!==void 0?e.filterMethod:(n,a,s,f)=>{const o=a?a.toLowerCase():"";return n.filter(x=>s.some(C=>{const P=f(C,x)+"";return(P==="undefined"||P==="null"?"":P.toLowerCase()).indexOf(o)!==-1}))});return watch(()=>e.filter,()=>{nextTick(()=>{t({page:1},!0)})},{deep:!0}),{computedFilterMethod:r}}function samePagination(e,t){for(const r in t)if(t[r]!==e[r])return!1;return!0}function fixPagination(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const useTablePaginationProps={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function useTablePaginationState(e,t){const{props:r,emit:n}=e,a=ref(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:r.rowsPerPageOptions.length!==0?r.rowsPerPageOptions[0]:5},r.pagination)),s=computed(()=>{const P=r["onUpdate:pagination"]!==void 0?{...a.value,...r.pagination}:a.value;return fixPagination(P)}),f=computed(()=>s.value.rowsNumber!==void 0);function o(P){x({pagination:P,filter:r.filter})}function x(P={}){nextTick(()=>{n("request",{pagination:P.pagination||s.value,filter:P.filter||r.filter,getCellValue:t})})}function C(P,Y){const ze=fixPagination({...s.value,...P});if(samePagination(s.value,ze)===!0){f.value===!0&&Y===!0&&o(ze);return}if(f.value===!0){o(ze);return}r.pagination!==void 0&&r["onUpdate:pagination"]!==void 0?n("update:pagination",ze):a.value=ze}return{innerPagination:a,computedPagination:s,isServerSide:f,requestServerInteraction:x,setPagination:C}}function useTablePagination(e,t,r,n,a,s){const{props:f,emit:o,proxy:{$q:x}}=e,C=computed(()=>n.value===!0?r.value.rowsNumber||0:s.value),P=computed(()=>{const{page:as,rowsPerPage:$s}=r.value;return(as-1)*$s}),Y=computed(()=>{const{page:as,rowsPerPage:$s}=r.value;return as*$s}),ze=computed(()=>r.value.page===1),ge=computed(()=>r.value.rowsPerPage===0?1:Math.max(1,Math.ceil(C.value/r.value.rowsPerPage))),Bt=computed(()=>Y.value===0?!0:r.value.page>=ge.value),Ur=computed(()=>(f.rowsPerPageOptions.includes(t.value.rowsPerPage)?f.rowsPerPageOptions:[t.value.rowsPerPage].concat(f.rowsPerPageOptions)).map($s=>({label:$s===0?x.lang.table.allRows:""+$s,value:$s})));watch(ge,(as,$s)=>{if(as===$s)return;const ah=r.value.page;as&&!ah?a({page:1}):as<ah&&a({page:as})});function kn(){a({page:1})}function Io(){const{page:as}=r.value;as>1&&a({page:as-1})}function rl(){const{page:as,rowsPerPage:$s}=r.value;Y.value>0&&as*$s<C.value&&a({page:as+1})}function Co(){a({page:ge.value})}return f["onUpdate:pagination"]!==void 0&&o("update:pagination",{...r.value}),{firstRowIndex:P,lastRowIndex:Y,isFirstPage:ze,isLastPage:Bt,pagesNumber:ge,computedRowsPerPageOptions:Ur,computedRowsNumber:C,firstPage:kn,prevPage:Io,nextPage:rl,lastPage:Co}}const useTableRowSelectionProps={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},useTableRowSelectionEmits=["update:selected","selection"];function useTableRowSelection(e,t,r,n){const a=computed(()=>{const Bt={};return e.selected.map(n.value).forEach(Ur=>{Bt[Ur]=!0}),Bt}),s=computed(()=>e.selection!=="none"),f=computed(()=>e.selection==="single"),o=computed(()=>e.selection==="multiple"),x=computed(()=>r.value.length!==0&&r.value.every(Bt=>a.value[n.value(Bt)]===!0)),C=computed(()=>x.value!==!0&&r.value.some(Bt=>a.value[n.value(Bt)]===!0)),P=computed(()=>e.selected.length);function Y(Bt){return a.value[Bt]===!0}function ze(){t("update:selected",[])}function ge(Bt,Ur,kn,Io){t("selection",{rows:Ur,added:kn,keys:Bt,evt:Io});const rl=f.value===!0?kn===!0?Ur:[]:kn===!0?e.selected.concat(Ur):e.selected.filter(Co=>Bt.includes(n.value(Co))===!1);t("update:selected",rl)}return{hasSelectionMode:s,singleSelection:f,multipleSelection:o,allRowsSelected:x,someRowsSelected:C,rowsSelectedNumber:P,isRowSelected:Y,clearSelection:ze,updateSelection:ge}}function getVal(e){return Array.isArray(e)?e.slice():[]}const useTableRowExpandProps={expanded:Array},useTableRowExpandEmits=["update:expanded"];function useTableRowExpand(e,t){const r=ref(getVal(e.expanded));watch(()=>e.expanded,f=>{r.value=getVal(f)});function n(f){return r.value.includes(f)}function a(f){e.expanded!==void 0?t("update:expanded",f):r.value=f}function s(f,o){const x=r.value.slice(),C=x.indexOf(f);o===!0?C===-1&&(x.push(f),a(x)):C!==-1&&(x.splice(C,1),a(x))}return{isRowExpanded:n,setExpanded:a,updateExpanded:s}}const useTableColumnSelectionProps={visibleColumns:Array};function useTableColumnSelection(e,t,r){const n=computed(()=>{if(e.columns!==void 0)return e.columns;const o=e.rows[0];return o!==void 0?Object.keys(o).map(x=>({name:x,label:x.toUpperCase(),field:x,align:isNumber$1(o[x])?"right":"left",sortable:!0})):[]}),a=computed(()=>{const{sortBy:o,descending:x}=t.value;return(e.visibleColumns!==void 0?n.value.filter(P=>P.required===!0||e.visibleColumns.includes(P.name)===!0):n.value).map(P=>{const Y=P.align||"right",ze=`text-${Y}`;return{...P,align:Y,__iconClass:`q-table__sort-icon q-table__sort-icon--${Y}`,__thClass:ze+(P.headerClasses!==void 0?" "+P.headerClasses:"")+(P.sortable===!0?" sortable":"")+(P.name===o?` sorted ${x===!0?"sort-desc":""}`:""),__tdStyle:P.style!==void 0?typeof P.style!="function"?()=>P.style:P.style:()=>null,__tdClass:P.classes!==void 0?typeof P.classes!="function"?()=>ze+" "+P.classes:ge=>ze+" "+P.classes(ge):()=>ze}})}),s=computed(()=>{const o={};return a.value.forEach(x=>{o[x.name]=x}),o}),f=computed(()=>e.tableColspan!==void 0?e.tableColspan:a.value.length+(r.value===!0?1:0));return{colList:n,computedCols:a,computedColsMap:s,computedColspan:f}}const bottomClass="q-table__bottom row items-center",commonVirtPropsObj={};commonVirtPropsList.forEach(e=>{commonVirtPropsObj[e]={}});const QTable=createComponent({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...commonVirtPropsObj,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...useDarkProps,...useFullscreenProps,...useTableColumnSelectionProps,...useTableFilterProps,...useTablePaginationProps,...useTableRowExpandProps,...useTableRowSelectionProps,...useTableSortProps},emits:["request","virtualScroll",...useFullscreenEmits,...useTableRowExpandEmits,...useTableRowSelectionEmits],setup(e,{slots:t,emit:r}){const n=getCurrentInstance(),{proxy:{$q:a}}=n,s=useDark(e,a),{inFullscreen:f,toggleFullscreen:o}=useFullscreen(),x=computed(()=>typeof e.rowKey=="function"?e.rowKey:Dd=>Dd[e.rowKey]),C=ref(null),P=ref(null),Y=computed(()=>e.grid!==!0&&e.virtualScroll===!0),ze=computed(()=>" q-table__card"+(s.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),ge=computed(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":ze.value)+(s.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(f.value===!0?" fullscreen scroll":"")),Bt=computed(()=>ge.value+(e.loading===!0?" q-table--loading":""));watch(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+ge.value,()=>{Y.value===!0&&P.value!==null&&P.value.reset()});const{innerPagination:Ur,computedPagination:kn,isServerSide:Io,requestServerInteraction:rl,setPagination:Co}=useTablePaginationState(n,Mp),{computedFilterMethod:as}=useTableFilter(e,Co),{isRowExpanded:$s,setExpanded:ah,updateExpanded:ch}=useTableRowExpand(e,r),Zu=computed(()=>{let Dd=e.rows;if(Io.value===!0||Dd.length===0)return Dd;const{sortBy:Hf,descending:mh}=kn.value;return e.filter&&(Dd=as.value(Dd,e.filter,vd.value,Mp)),Sd.value!==null&&(Dd=zd.value(e.rows===Dd?Dd.slice():Dd,Hf,mh)),Dd}),ih=computed(()=>Zu.value.length),al=computed(()=>{let Dd=Zu.value;if(Io.value===!0)return Dd;const{rowsPerPage:Hf}=kn.value;return Hf!==0&&(Gd.value===0&&e.rows!==Dd?Dd.length>bf.value&&(Dd=Dd.slice(0,bf.value)):Dd=Dd.slice(Gd.value,bf.value)),Dd}),{hasSelectionMode:sh,singleSelection:_h,multipleSelection:Ih,allRowsSelected:Lh,someRowsSelected:Gh,rowsSelectedNumber:ud,isRowSelected:Tf,clearSelection:Kd,updateSelection:Af}=useTableRowSelection(e,r,al,x),{colList:md,computedCols:vd,computedColsMap:qd,computedColspan:Ed}=useTableColumnSelection(e,kn,sh),{columnToSort:Sd,computedSortMethod:zd,sort:Md}=useTableSort(e,kn,md,Co),{firstRowIndex:Gd,lastRowIndex:bf,isFirstPage:Id,isLastPage:td,pagesNumber:Fd,computedRowsPerPageOptions:rp,computedRowsNumber:jf,firstPage:yd,prevPage:Jd,nextPage:op,lastPage:bp}=useTablePagination(n,Ur,kn,Io,Co,ih),fp=computed(()=>al.value.length===0),Qh=computed(()=>{const Dd={};return commonVirtPropsList.forEach(Hf=>{Dd[Hf]=e[Hf]}),Dd.virtualScrollItemSize===void 0&&(Dd.virtualScrollItemSize=e.dense===!0?28:48),Dd});function Yd(){Y.value===!0&&P.value.reset()}function sd(){if(e.grid===!0)return lm();const Dd=e.hideHeader!==!0?qp:null;if(Y.value===!0){const mh=t["top-row"],Jh=t["bottom-row"],Wu={default:sl=>Kf(sl.item,t.body,sl.index)};if(mh!==void 0){const sl=h("tbody",mh({cols:vd.value}));Wu.before=Dd===null?()=>sl:()=>[Dd()].concat(sl)}else Dd!==null&&(Wu.before=Dd);return Jh!==void 0&&(Wu.after=()=>h("tbody",Jh({cols:vd.value}))),h(QVirtualScroll,{ref:P,class:e.tableClass,style:e.tableStyle,...Qh.value,scrollTarget:e.virtualScrollTarget,items:al.value,type:"__qtable",tableColspan:Ed.value,onVirtualScroll:Xh},Wu)}const Hf=[If()];return Dd!==null&&Hf.unshift(Dd()),getTableMiddle({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},Hf)}function Zd(Dd,Hf){if(P.value!==null){P.value.scrollTo(Dd,Hf);return}Dd=parseInt(Dd,10);const mh=C.value.querySelector(`tbody tr:nth-of-type(${Dd+1})`);if(mh!==null){const Jh=C.value.querySelector(".q-table__middle.scroll"),Wu=mh.offsetTop-e.virtualScrollStickySizeStart,sl=Wu<Jh.scrollTop?"decrease":"increase";Jh.scrollTop=Wu,r("virtualScroll",{index:Dd,from:0,to:Ur.value.rowsPerPage-1,direction:sl})}}function Xh(Dd){r("virtualScroll",Dd)}function Ld(){return[h(QLinearProgress,{class:"q-table__linear-progress",color:e.color,dark:s.value,indeterminate:!0,trackColor:"transparent"})]}function Kf(Dd,Hf,mh){const Jh=x.value(Dd),Wu=Tf(Jh);if(Hf!==void 0)return Hf(Df({key:Jh,row:Dd,pageIndex:mh,__trClass:Wu?"selected":""}));const sl=t["body-cell"],Gn=vd.value.map(cs=>{const $u=t[`body-cell-${cs.name}`],eh=$u!==void 0?$u:sl;return eh!==void 0?eh(Jf({key:Jh,row:Dd,pageIndex:mh,col:cs})):h("td",{class:cs.__tdClass(Dd),style:cs.__tdStyle(Dd)},Mp(cs,Dd))});if(sh.value===!0){const cs=t["body-selection"],$u=cs!==void 0?cs(Nf({key:Jh,row:Dd,pageIndex:mh})):[h(QCheckbox,{modelValue:Wu,color:e.color,dark:s.value,dense:e.dense,"onUpdate:modelValue":(eh,nh)=>{Af([Jh],[Dd],eh,nh)}})];Gn.unshift(h("td",{class:"q-table--col-auto-width"},$u))}const _n={key:Jh,class:{selected:Wu}};return e.onRowClick!==void 0&&(_n.class["cursor-pointer"]=!0,_n.onClick=cs=>{r("RowClick",cs,Dd,mh)}),e.onRowDblclick!==void 0&&(_n.class["cursor-pointer"]=!0,_n.onDblclick=cs=>{r("RowDblclick",cs,Dd,mh)}),e.onRowContextmenu!==void 0&&(_n.class["cursor-pointer"]=!0,_n.onContextmenu=cs=>{r("RowContextmenu",cs,Dd,mh)}),h("tr",_n,Gn)}function If(){const Dd=t.body,Hf=t["top-row"],mh=t["bottom-row"];let Jh=al.value.map((Wu,sl)=>Kf(Wu,Dd,sl));return Hf!==void 0&&(Jh=Hf({cols:vd.value}).concat(Jh)),mh!==void 0&&(Jh=Jh.concat(mh({cols:vd.value}))),h("tbody",Jh)}function Df(Dd){return Wf(Dd),Dd.cols=Dd.cols.map(Hf=>injectProp({...Hf},"value",()=>Mp(Hf,Dd.row))),Dd}function Jf(Dd){return Wf(Dd),injectProp(Dd,"value",()=>Mp(Dd.col,Dd.row)),Dd}function Nf(Dd){return Wf(Dd),Dd}function Wf(Dd){Object.assign(Dd,{cols:vd.value,colsMap:qd.value,sort:Md,rowIndex:Gd.value+Dd.pageIndex,color:e.color,dark:s.value,dense:e.dense}),sh.value===!0&&injectProp(Dd,"selected",()=>Tf(Dd.key),(Hf,mh)=>{Af([Dd.key],[Dd.row],Hf,mh)}),injectProp(Dd,"expand",()=>$s(Dd.key),Hf=>{ch(Dd.key,Hf)})}function Mp(Dd,Hf){const mh=typeof Dd.field=="function"?Dd.field(Hf):Hf[Dd.field];return Dd.format!==void 0?Dd.format(mh,Hf):mh}const Sp=computed(()=>({pagination:kn.value,pagesNumber:Fd.value,isFirstPage:Id.value,isLastPage:td.value,firstPage:yd,prevPage:Jd,nextPage:op,lastPage:bp,inFullscreen:f.value,toggleFullscreen:o}));function Pp(){const Dd=t.top,Hf=t["top-left"],mh=t["top-right"],Jh=t["top-selection"],Wu=sh.value===!0&&Jh!==void 0&&ud.value>0,sl="q-table__top relative-position row items-center";if(Dd!==void 0)return h("div",{class:sl},[Dd(Sp.value)]);let Gn;if(Wu===!0?Gn=Jh(Sp.value).slice():(Gn=[],Hf!==void 0?Gn.push(h("div",{class:"q-table__control"},[Hf(Sp.value)])):e.title&&Gn.push(h("div",{class:"q-table__control"},[h("div",{class:["q-table__title",e.titleClass]},e.title)]))),mh!==void 0&&(Gn.push(h("div",{class:"q-table__separator col"})),Gn.push(h("div",{class:"q-table__control"},[mh(Sp.value)]))),Gn.length!==0)return h("div",{class:sl},Gn)}const Yf=computed(()=>Gh.value===!0?null:Lh.value);function qp(){const Dd=sm();return e.loading===!0&&t.loading===void 0&&Dd.push(h("tr",{class:"q-table__progress"},[h("th",{class:"relative-position",colspan:Ed.value},Ld())])),h("thead",Dd)}function sm(){const Dd=t.header,Hf=t["header-cell"];if(Dd!==void 0)return Dd(Xd({header:!0})).slice();const mh=vd.value.map(Jh=>{const Wu=t[`header-cell-${Jh.name}`],sl=Wu!==void 0?Wu:Hf,Gn=Xd({col:Jh});return sl!==void 0?sl(Gn):h(QTh,{key:Jh.name,props:Gn},()=>Jh.label)});if(_h.value===!0&&e.grid!==!0)mh.unshift(h("th",{class:"q-table--col-auto-width"}," "));else if(Ih.value===!0){const Jh=t["header-selection"],Wu=Jh!==void 0?Jh(Xd({})):[h(QCheckbox,{color:e.color,modelValue:Yf.value,dark:s.value,dense:e.dense,"onUpdate:modelValue":Op})];mh.unshift(h("th",{class:"q-table--col-auto-width"},Wu))}return[h("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},mh)]}function Xd(Dd){return Object.assign(Dd,{cols:vd.value,sort:Md,colsMap:qd.value,color:e.color,dark:s.value,dense:e.dense}),Ih.value===!0&&injectProp(Dd,"selected",()=>Yf.value,Op),Dd}function Op(Dd){Gh.value===!0&&(Dd=!1),Af(al.value.map(x.value),al.value,Dd)}const rm=computed(()=>{const Dd=[e.iconFirstPage||a.iconSet.table.firstPage,e.iconPrevPage||a.iconSet.table.prevPage,e.iconNextPage||a.iconSet.table.nextPage,e.iconLastPage||a.iconSet.table.lastPage];return a.lang.rtl===!0?Dd.reverse():Dd});function Sm(){if(e.hideBottom===!0)return;if(fp.value===!0){if(e.hideNoData===!0)return;const mh=e.loading===!0?e.loadingLabel||a.lang.table.loading:e.filter?e.noResultsLabel||a.lang.table.noResults:e.noDataLabel||a.lang.table.noData,Jh=t["no-data"],Wu=Jh!==void 0?[Jh({message:mh,icon:a.iconSet.table.warning,filter:e.filter})]:[h(QIcon,{class:"q-table__bottom-nodata-icon",name:a.iconSet.table.warning}),mh];return h("div",{class:bottomClass+" q-table__bottom--nodata"},Wu)}const Dd=t.bottom;if(Dd!==void 0)return h("div",{class:bottomClass},[Dd(Sp.value)]);const Hf=e.hideSelectedBanner!==!0&&sh.value===!0&&ud.value>0?[h("div",{class:"q-table__control"},[h("div",[(e.selectedRowsLabel||a.lang.table.selectedRecords)(ud.value)])])]:[];if(e.hidePagination!==!0)return h("div",{class:bottomClass+" justify-end"},Em(Hf));if(Hf.length!==0)return h("div",{class:bottomClass},Hf)}function hp(Dd){Co({page:1,rowsPerPage:Dd.value})}function Em(Dd){let Hf;const{rowsPerPage:mh}=kn.value,Jh=e.paginationLabel||a.lang.table.pagination,Wu=t.pagination,sl=e.rowsPerPageOptions.length>1;if(Dd.push(h("div",{class:"q-table__separator col"})),sl===!0&&Dd.push(h("div",{class:"q-table__control"},[h("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||a.lang.table.recordsPerPage]),h(QSelect,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:mh,options:rp.value,displayValue:mh===0?a.lang.table.allRows:mh,dark:s.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":hp})])),Wu!==void 0)Hf=Wu(Sp.value);else if(Hf=[h("span",mh!==0?{class:"q-table__bottom-item"}:{},[mh?Jh(Gd.value+1,Math.min(bf.value,jf.value),jf.value):Jh(1,ih.value,jf.value)])],mh!==0&&Fd.value>1){const Gn={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&(Gn.size="sm"),Fd.value>2&&Hf.push(h(QBtn,{key:"pgFirst",...Gn,icon:rm.value[0],disable:Id.value,onClick:yd})),Hf.push(h(QBtn,{key:"pgPrev",...Gn,icon:rm.value[1],disable:Id.value,onClick:Jd}),h(QBtn,{key:"pgNext",...Gn,icon:rm.value[2],disable:td.value,onClick:op})),Fd.value>2&&Hf.push(h(QBtn,{key:"pgLast",...Gn,icon:rm.value[3],disable:td.value,onClick:bp}))}return Dd.push(h("div",{class:"q-table__control"},Hf)),Dd}function Qp(){const Dd=e.gridHeader===!0?[h("table",{class:"q-table"},[qp()])]:e.loading===!0&&t.loading===void 0?Ld():void 0;return h("div",{class:"q-table__middle"},Dd)}function lm(){const Dd=t.item!==void 0?t.item:Hf=>{const mh=Hf.cols.map(Wu=>h("div",{class:"q-table__grid-item-row"},[h("div",{class:"q-table__grid-item-title"},[Wu.label]),h("div",{class:"q-table__grid-item-value"},[Wu.value])]));if(sh.value===!0){const Wu=t["body-selection"],sl=Wu!==void 0?Wu(Hf):[h(QCheckbox,{modelValue:Hf.selected,color:e.color,dark:s.value,dense:e.dense,"onUpdate:modelValue":(Gn,_n)=>{Af([Hf.key],[Hf.row],Gn,_n)}})];mh.unshift(h("div",{class:"q-table__grid-item-row"},sl),h(QSeparator,{dark:s.value}))}const Jh={class:["q-table__grid-item-card"+ze.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(Jh.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(Jh.onClick=Wu=>{r("RowClick",Wu,Hf.row,Hf.pageIndex)}),e.onRowDblclick!==void 0&&(Jh.onDblclick=Wu=>{r("RowDblclick",Wu,Hf.row,Hf.pageIndex)})),h("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(Hf.selected===!0?" q-table__grid-item--selected":"")},[h("div",Jh,mh)])};return h("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},al.value.map((Hf,mh)=>Dd(Df({key:x.value(Hf),row:Hf,pageIndex:mh}))))}return Object.assign(n.proxy,{requestServerInteraction:rl,setPagination:Co,firstPage:yd,prevPage:Jd,nextPage:op,lastPage:bp,isRowSelected:Tf,clearSelection:Kd,isRowExpanded:$s,setExpanded:ah,sort:Md,resetVirtualScroll:Yd,scrollTo:Zd,getCellValue:Mp}),injectMultipleProps(n.proxy,{filteredSortedRows:()=>Zu.value,computedRows:()=>al.value,computedRowsNumber:()=>jf.value}),()=>{const Dd=[Pp()],Hf={ref:C,class:Bt.value};return e.grid===!0?Dd.push(Qp()):Object.assign(Hf,{class:[Hf.class,e.cardClass],style:e.cardStyle}),Dd.push(sd(),Sm()),e.loading===!0&&t.loading!==void 0&&Dd.push(t.loading()),h("div",Hf,Dd)}}}),QTabPanels=createComponent({name:"QTabPanels",props:{...usePanelProps,...useDarkProps},emits:usePanelEmits,setup(e,{slots:t}){const r=getCurrentInstance(),n=useDark(e,r.proxy.$q),{updatePanelsList:a,getPanelContent:s,panelDirectives:f}=usePanel(),o=computed(()=>"q-tab-panels q-panel-parent"+(n.value===!0?" q-tab-panels--dark q-dark":""));return()=>(a(t),hDir("div",{class:o.value},s(),"pan",e.swipeable,()=>f.value))}}),QPageContainer=createComponent({name:"QPageContainer",setup(e,{slots:t}){const{proxy:{$q:r}}=getCurrentInstance(),n=inject(layoutKey,emptyRenderFn);if(n===emptyRenderFn)return console.error("QPageContainer needs to be child of QLayout"),emptyRenderFn;provide(pageContainerKey,!0);const a=computed(()=>{const s={};return n.header.space===!0&&(s.paddingTop=`${n.header.size}px`),n.right.space===!0&&(s[`padding${r.lang.rtl===!0?"Left":"Right"}`]=`${n.right.size}px`),n.footer.space===!0&&(s.paddingBottom=`${n.footer.size}px`),n.left.space===!0&&(s[`padding${r.lang.rtl===!0?"Right":"Left"}`]=`${n.left.size}px`),s});return()=>h("div",{class:"q-page-container",style:a.value},hSlot(t.default))}}),{passive}=listenOpts,axisValues=["both","horizontal","vertical"],QScrollObserver=createComponent({name:"QScrollObserver",props:{axis:{type:String,validator:e=>axisValues.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(e,{emit:t}){const r={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let n=null,a,s;watch(()=>e.scrollTarget,()=>{x(),o()});function f(){n!==null&&n();const Y=Math.max(0,getVerticalScrollPosition(a)),ze=getHorizontalScrollPosition(a),ge={top:Y-r.position.top,left:ze-r.position.left};if(e.axis==="vertical"&&ge.top===0||e.axis==="horizontal"&&ge.left===0)return;const Bt=Math.abs(ge.top)>=Math.abs(ge.left)?ge.top<0?"up":"down":ge.left<0?"left":"right";r.position={top:Y,left:ze},r.directionChanged=r.direction!==Bt,r.delta=ge,r.directionChanged===!0&&(r.direction=Bt,r.inflectionPoint=r.position),t("scroll",{...r})}function o(){a=getScrollTarget(s,e.scrollTarget),a.addEventListener("scroll",C,passive),C(!0)}function x(){a!==void 0&&(a.removeEventListener("scroll",C,passive),a=void 0)}function C(Y){if(Y===!0||e.debounce===0||e.debounce==="0")f();else if(n===null){const[ze,ge]=e.debounce?[setTimeout(f,e.debounce),clearTimeout]:[requestAnimationFrame(f),cancelAnimationFrame];n=()=>{ge(ze),n=null}}}const{proxy:P}=getCurrentInstance();return watch(()=>P.$q.lang.rtl,f),onMounted(()=>{s=P.$el.parentNode,o()}),onBeforeUnmount(()=>{n!==null&&n(),x()}),Object.assign(P,{trigger:C,getPosition:()=>r}),noop}}),QLayout=createComponent({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=ref(null),s=ref(n.screen.height),f=ref(e.container===!0?0:n.screen.width),o=ref({position:0,direction:"down",inflectionPoint:0}),x=ref(0),C=ref(isRuntimeSsrPreHydration.value===!0?0:getScrollbarWidth()),P=computed(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),Y=computed(()=>e.container===!1?{minHeight:n.screen.height+"px"}:null),ze=computed(()=>C.value!==0?{[n.lang.rtl===!0?"left":"right"]:`${C.value}px`}:null),ge=computed(()=>C.value!==0?{[n.lang.rtl===!0?"right":"left"]:0,[n.lang.rtl===!0?"left":"right"]:`-${C.value}px`,width:`calc(100% + ${C.value}px)`}:null);function Bt(as){if(e.container===!0||document.qScrollPrevented!==!0){const $s={position:as.position.top,direction:as.direction,directionChanged:as.directionChanged,inflectionPoint:as.inflectionPoint.top,delta:as.delta.top};o.value=$s,e.onScroll!==void 0&&r("scroll",$s)}}function Ur(as){const{height:$s,width:ah}=as;let ch=!1;s.value!==$s&&(ch=!0,s.value=$s,e.onScrollHeight!==void 0&&r("scrollHeight",$s),Io()),f.value!==ah&&(ch=!0,f.value=ah),ch===!0&&e.onResize!==void 0&&r("resize",as)}function kn({height:as}){x.value!==as&&(x.value=as,Io())}function Io(){if(e.container===!0){const as=s.value>x.value?getScrollbarWidth():0;C.value!==as&&(C.value=as)}}let rl=null;const Co={instances:{},view:computed(()=>e.view),isContainer:computed(()=>e.container),rootRef:a,height:s,containerHeight:x,scrollbarWidth:C,totalWidth:computed(()=>f.value+C.value),rows:computed(()=>{const as=e.view.toLowerCase().split(" ");return{top:as[0].split(""),middle:as[1].split(""),bottom:as[2].split("")}}),header:reactive({size:0,offset:0,space:!1}),right:reactive({size:300,offset:0,space:!1}),footer:reactive({size:0,offset:0,space:!1}),left:reactive({size:300,offset:0,space:!1}),scroll:o,animate(){rl!==null?clearTimeout(rl):document.body.classList.add("q-body--layout-animate"),rl=setTimeout(()=>{rl=null,document.body.classList.remove("q-body--layout-animate")},155)},update(as,$s,ah){Co[as][$s]=ah}};if(provide(layoutKey,Co),getScrollbarWidth()>0){let ah=function(){as=null,$s.classList.remove("hide-scrollbar")},ch=function(){if(as===null){if($s.scrollHeight>n.screen.height)return;$s.classList.add("hide-scrollbar")}else clearTimeout(as);as=setTimeout(ah,300)},Zu=function(ih){as!==null&&ih==="remove"&&(clearTimeout(as),ah()),window[`${ih}EventListener`]("resize",ch)},as=null;const $s=document.body;watch(()=>e.container!==!0?"add":"remove",Zu),e.container!==!0&&Zu("add"),onUnmounted(()=>{Zu("remove")})}return()=>{const as=hMergeSlot(t.default,[h(QScrollObserver,{onScroll:Bt}),h(QResizeObserver,{onResize:Ur})]),$s=h("div",{class:P.value,style:Y.value,ref:e.container===!0?void 0:a,tabindex:-1},as);return e.container===!0?h("div",{class:"q-layout-container overflow-hidden",ref:a},[h(QResizeObserver,{onResize:kn}),h("div",{class:"absolute-full",style:ze.value},[h("div",{class:"scroll",style:ge.value},[$s])])]):$s}}});function getDepth$1(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const ClosePopup=createDirective({name:"close-popup",beforeMount(e,{value:t}){const r={depth:getDepth$1(t),handler(n){r.depth!==0&&setTimeout(()=>{const a=getPortalProxy(e);a!==void 0&&closePortals(a,n,r.depth)})},handlerKey(n){isKeyCode(n,13)===!0&&r.handler(n)}};e.__qclosepopup=r,e.addEventListener("click",r.handler),e.addEventListener("keyup",r.handlerKey)},updated(e,{value:t,oldValue:r}){t!==r&&(e.__qclosepopup.depth=getDepth$1(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}}),QToolbar=createComponent({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:t}){const r=computed(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>h("div",{class:r.value,role:"toolbar"},hSlot(t.default))}});class Store{constructor(t="unreal-mapbox",r="keyval"){this.storeName=r,this._dbp=new Promise((n,a)=>{const s=indexedDB.open(t,3);s.onerror=()=>a(s.error),s.onsuccess=()=>n(s.result),s.onupgradeneeded=()=>{try{s.result.deleteObjectStore(r)}catch{}s.result.createObjectStore(r)}})}_withIDBStore(t,r){return this._dbp.then(n=>new Promise((a,s)=>{const f=n.transaction(this.storeName,t);f.oncomplete=()=>a(),f.onabort=f.onerror=()=>s(f.error),r(f.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get$3(e,t=getDefaultStore()){let r;return t._withIDBStore("readonly",n=>{r=n.get(e)}).then(()=>r.result)}function set(e,t,r=getDefaultStore()){return r._withIDBStore("readwrite",n=>{n.put(t,e)})}function del(e,t=getDefaultStore()){return t._withIDBStore("readwrite",r=>{r.delete(e)})}function clear(e=getDefaultStore()){return e._withIDBStore("readwrite",t=>{t.clear()})}function keys$4(e=getDefaultStore()){const t=[];return e._withIDBStore("readonly",r=>{(r.openKeyCursor||r.openCursor).call(r).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}const idbKeyval={keys:keys$4,clear,del,set,get:get$3};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(e=>e[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(e=>e)}async function verifyPermission(e,t){const r={};return t&&(r.writable=!0,r.mode="readwrite"),await e.queryPermission(r)==="granted"||await e.requestPermission(r)==="granted"}async function writeFileToDisk(e,t,r){let a=await(await e.getFileHandle(t,{create:!0})).createWritable();await a.write(r),await a.close()}async function fileExists(e,t){try{return await e.getFileHandle(t),!0}catch(r){if(r.name==="NotFoundError")return!1;if(r.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(e,t){return await(await(await e.getFileHandle(t)).getFile()).arrayBuffer()}function checkFileApiSupport(){let e;return"showDirectoryPicker"in window?e=!0:e=!1,e}const fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var s=Function.bind.apply(t,a);return new s}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),r}var mapboxGl={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){var r,n,a;function s(o,x){if(!r)r=x;else if(!n)n=x;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",P={};r(P),a=x(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}s(["exports"],function(o){var x=typeof self<"u"?self:{},C="2.14.1";let P;const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(P==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{P={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):c}catch{P=c}}return P},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Y.API_URL)return null;try{const c=new URL(Y.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ze={supported:!1,testSupport:function(c){!Ur&&Bt&&(kn?Io(c):ge=c)}};let ge,Bt,Ur=!1,kn=!1;function Io(c){const l=c.createTexture();c.bindTexture(c.TEXTURE_2D,l);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Bt),c.isContextLost())return;ze.supported=!0}catch{}c.deleteTexture(l),Ur=!0}x.document&&(Bt=x.document.createElement("img"),Bt.onload=function(){ge&&Io(ge),ge=null,kn=!0},Bt.onerror=function(){Ur=!0,ge=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rl="01";var Co=as;function as(c,l,d,y){this.cx=3*c,this.bx=3*(d-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(y-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=d,this.p2y=y}as.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var d=c,y=0;y<8;y++){var M=this.sampleCurveX(d)-c;if(Math.abs(M)<l)return d;var N=this.sampleCurveDerivativeX(d);if(Math.abs(N)<1e-6)break;d-=M/N}var X=0,vt=1;for(d=c,y=0;y<20&&(M=this.sampleCurveX(d),!(Math.abs(M-c)<l));y++)c>M?X=d:vt=d,d=.5*(vt-X)+X;return d},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var $s=ah;function ah(c,l){this.x=c,this.y=l}ah.prototype={clone:function(){return new ah(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,l){return this.clone()._rotateAround(c,l)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var l=c.x-this.x,d=c.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,l){return Math.atan2(this.x*l-this.y*c,this.x*c+this.y*l)},_matMult:function(c){var l=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=l,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var l=Math.cos(c),d=Math.sin(c),y=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=y,this},_rotateAround:function(c,l){var d=Math.cos(c),y=Math.sin(c),M=l.y+y*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-y*(this.y-l.y),this.y=M,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ah.convert=function(c){return c instanceof ah?c:Array.isArray(c)?new ah(c[0],c[1]):c};const ch=Math.PI/180,Zu=180/Math.PI;function ih(c){return c*ch}function al(c){return c*Zu}const sh=[[0,0],[1,0],[1,1],[0,1]];function _h(c){if(c<=0)return 0;if(c>=1)return 1;const l=c*c,d=l*c;return 4*(c<.5?d:3*(c-l)+d-.75)}function Ih(c,l,d,y){const M=new Co(c,l,d,y);return function(N){return M.solve(N)}}const Lh=Ih(.25,.1,.25,1);function Gh(c,l,d){return Math.min(d,Math.max(l,c))}function ud(c,l,d){return(d=Gh((d-c)/(l-c),0,1))*d*(3-2*d)}function Tf(c,l,d){const y=d-l,M=((c-l)%y+y)%y+l;return M===l?d:M}function Kd(c,l,d){if(!c.length)return d(null,[]);let y=c.length;const M=new Array(c.length);let N=null;c.forEach((X,vt)=>{l(X,(Ht,Ui)=>{Ht&&(N=Ht),M[vt]=Ui,--y==0&&d(N,M)})})}function Af(c){const l=[];for(const d in c)l.push(c[d]);return l}function md(c,...l){for(const d of l)for(const y in d)c[y]=d[y];return c}let vd=1;function qd(){return vd++}function Ed(){return function c(l){return l?(l^Math.random()*(16>>l/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function Sd(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function zd(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function Md(c,l){c.forEach(d=>{l[d]&&(l[d]=l[d].bind(l))})}function Gd(c,l){return c.indexOf(l,c.length-l.length)!==-1}function bf(c,l,d){const y={};for(const M in c)y[M]=l.call(d||this,c[M],M,c);return y}function Id(c,l,d){const y={};for(const M in c)l.call(d||this,c[M],M,c)&&(y[M]=c[M]);return y}function td(c){return Array.isArray(c)?c.map(td):typeof c=="object"&&c?bf(c,td):c}const Fd={};function rp(c){Fd[c]||(typeof console<"u"&&console.warn(c),Fd[c]=!0)}function jf(c,l,d){return(d.y-c.y)*(l.x-c.x)>(l.y-c.y)*(d.x-c.x)}function yd(c){let l=0;for(let d,y,M=0,N=c.length,X=N-1;M<N;X=M++)d=c[M],y=c[X],l+=(y.x-d.x)*(d.y+y.y);return l}function Jd(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function op(c){const l={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,y,M,N)=>{const X=M||N;return l[y]=!X||X.toLowerCase(),""}),l["max-age"]){const d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l}let bp=null;function fp(c){if(bp==null){const l=c.navigator?c.navigator.userAgent:null;bp=!!c.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return bp}function Qh(c){try{const l=x[c];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}}function Yd(c,l){return[c[4*l],c[4*l+1],c[4*l+2],c[4*l+3]]}const sd="mapbox-tiles";let Zd,Xh,Ld=500,Kf=50;function If(){try{return x.caches}catch{}}function Df(){If()&&!Zd&&(Zd=x.caches.open(sd))}function Jf(c){const l=c.indexOf("?");if(l<0)return c;const d=function(M){const N=M.indexOf("?");return N>0?M.slice(N+1).split("&"):[]}(c),y=d.filter(M=>{const N=M.split("=");return N[0]==="language"||N[0]==="worldview"});return y.length?`${c.slice(0,l)}?${y.join("&")}`:c.slice(0,l)}let Nf=1/0;const Wf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Wf);class Mp extends Error{constructor(l,d,y){d===401&&Em(y)&&(l+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(l),this.status=d,this.url=y}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sp=Jd()?()=>self.worker&&self.worker.referrer:()=>(x.location.protocol==="blob:"?x.parent:x).location.href,Pp=function(c,l){if(!(/^file:/.test(d=c.url)||/^file:/.test(Sp())&&!/^\w+:/.test(d))){if(x.fetch&&x.Request&&x.AbortController&&x.Request.prototype.hasOwnProperty("signal"))return function(y,M){const N=new x.AbortController,X=new x.Request(y.url,{method:y.method||"GET",body:y.body,credentials:y.credentials,headers:y.headers,referrer:Sp(),referrerPolicy:y.referrerPolicy,signal:N.signal});let vt=!1,Ht=!1;const Ui=(Fn=X.url).indexOf("sku=")>0&&Em(Fn);var Fn;y.type==="json"&&X.headers.set("Accept","application/json");const Js=(ju,Ku,lh)=>{if(Ht)return;if(ju&&ju.message!=="SecurityError"&&rp(ju),Ku&&lh)return nl(Ku);const Eh=Date.now();x.fetch(X).then(Bh=>{if(Bh.ok){const Yh=Ui?Bh.clone():null;return nl(Bh,Yh,Eh)}return M(new Mp(Bh.statusText,Bh.status,y.url))}).catch(Bh=>{Bh.name!=="AbortError"&&M(new Error(`${Bh.message} ${y.url}`))})},nl=(ju,Ku,lh)=>{(y.type==="arrayBuffer"?ju.arrayBuffer():y.type==="json"?ju.json():ju.text()).then(Eh=>{Ht||(Ku&&lh&&function(Bh,Yh,kh){if(Df(),!Zd)return;const Vh={status:Yh.status,statusText:Yh.statusText,headers:new x.Headers};Yh.headers.forEach((Rd,kd)=>Vh.headers.set(kd,Rd));const rd=op(Yh.headers.get("Cache-Control")||"");if(rd["no-store"])return;rd["max-age"]&&Vh.headers.set("Expires",new Date(kh+1e3*rd["max-age"]).toUTCString());const ed=Vh.headers.get("Expires");ed&&(new Date(ed).getTime()-kh<42e4||function(Rd,kd){if(Xh===void 0)try{new Response(new ReadableStream),Xh=!0}catch{Xh=!1}Xh?kd(Rd.body):Rd.blob().then(kd)}(Yh,Rd=>{const kd=new x.Response(Rd,Vh);Df(),Zd&&Zd.then(Sf=>Sf.put(Jf(Bh.url),kd)).catch(Sf=>rp(Sf.message))}))}(X,Ku,lh),vt=!0,M(null,Eh,ju.headers.get("Cache-Control"),ju.headers.get("Expires")))}).catch(Eh=>{Ht||M(new Error(Eh.message))})};return Ui?function(ju,Ku){if(Df(),!Zd)return Ku(null);const lh=Jf(ju.url);Zd.then(Eh=>{Eh.match(lh).then(Bh=>{const Yh=function(kh){if(!kh)return!1;const Vh=new Date(kh.headers.get("Expires")||0),rd=op(kh.headers.get("Cache-Control")||"");return Vh>Date.now()&&!rd["no-cache"]}(Bh);Eh.delete(lh),Yh&&Eh.put(lh,Bh.clone()),Ku(null,Bh,Yh)}).catch(Ku)}).catch(Ku)}(X,Js):Js(null,null),{cancel:()=>{Ht=!0,vt||N.abort()}}}(c,l);if(Jd()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,l,void 0,!0)}var d;return function(y,M){const N=new x.XMLHttpRequest;N.open(y.method||"GET",y.url,!0),y.type==="arrayBuffer"&&(N.responseType="arraybuffer");for(const X in y.headers)N.setRequestHeader(X,y.headers[X]);return y.type==="json"&&(N.responseType="text",N.setRequestHeader("Accept","application/json")),N.withCredentials=y.credentials==="include",N.onerror=()=>{M(new Error(N.statusText))},N.onload=()=>{if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let X=N.response;if(y.type==="json")try{X=JSON.parse(N.response)}catch(vt){return M(vt)}M(null,X,N.getResponseHeader("Cache-Control"),N.getResponseHeader("Expires"))}else M(new Mp(N.statusText,N.status,y.url))},N.send(y.body),{cancel:()=>N.abort()}}(c,l)},Yf=function(c,l){return Pp(md(c,{type:"arrayBuffer"}),l)};function qp(c){const l=x.document.createElement("a");return l.href=c,l.protocol===x.document.location.protocol&&l.host===x.document.location.host}const sm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xd,Op;Xd=[],Op=0;const rm=function(c,l){if(ze.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Op>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const N={requestParameters:c,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return Xd.push(N),N}Op++;let d=!1;const y=()=>{if(!d)for(d=!0,Op--;Xd.length&&Op<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const N=Xd.shift(),{requestParameters:X,callback:vt,cancelled:Ht}=N;Ht||(N.cancel=rm(X,vt).cancel)}},M=Yf(c,(N,X,vt,Ht)=>{y(),N?l(N):X&&(x.createImageBitmap?function(Ui,Fn){const Js=new x.Blob([new Uint8Array(Ui)],{type:"image/png"});x.createImageBitmap(Js).then(nl=>{Fn(null,nl)}).catch(nl=>{Fn(new Error(`Could not load image because of ${nl.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(X,(Ui,Fn)=>l(Ui,Fn,vt,Ht)):function(Ui,Fn){const Js=new x.Image,nl=x.URL;Js.onload=()=>{Fn(null,Js),nl.revokeObjectURL(Js.src),Js.onload=null,x.requestAnimationFrame(()=>{Js.src=sm})},Js.onerror=()=>Fn(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ju=new x.Blob([new Uint8Array(Ui)],{type:"image/png"});Js.src=Ui.byteLength?nl.createObjectURL(ju):sm}(X,(Ui,Fn)=>l(Ui,Fn,vt,Ht)))});return{cancel:()=>{M.cancel(),y()}}},Sm="NO_ACCESS_TOKEN";function hp(c){return c.indexOf("mapbox:")===0}function Em(c){return Y.API_URL_REGEX.test(c)}function Qp(c){return Y.API_CDN_URL_REGEX.test(c)}function lm(c){return Y.API_STYLE_REGEX.test(c)&&!Dd(c)}function Dd(c){return Y.API_SPRITE_REGEX.test(c)}const Hf=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mh(c){const l=c.match(Hf);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function Jh(c){const l=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${l}`}function Wu(c){if(!c)return null;const l=c.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(decodeURIComponent(x.atob(l[1]).split("").map(d=>"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class sl{constructor(l){this.type=l,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const d=Wu(Y.ACCESS_TOKEN);let y="";return y=d&&d.u?x.btoa(encodeURIComponent(d.u).replace(/%([0-9A-F]{2})/g,(M,N)=>String.fromCharCode(+("0x"+N)))):Y.ACCESS_TOKEN||"",l?`mapbox.eventData.${l}:${y}`:`mapbox.eventData:${y}`}fetchEventData(){const l=Qh("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid");if(l)try{const M=x.localStorage.getItem(d);M&&(this.eventData=JSON.parse(M));const N=x.localStorage.getItem(y);N&&(this.anonId=N)}catch{rp("Unable to read from LocalStorage")}}saveEventData(){const l=Qh("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid");if(l)try{x.localStorage.setItem(y,this.anonId),Object.keys(this.eventData).length>=1&&x.localStorage.setItem(d,JSON.stringify(this.eventData))}catch{rp("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,d,y,M){if(!Y.EVENTS_URL)return;const N=mh(Y.EVENTS_URL);N.params.push(`access_token=${M||Y.ACCESS_TOKEN||""}`);const X={event:this.type,created:new Date(l).toISOString()},vt=d?md(X,d):X,Ht={url:Jh(N),headers:{"Content-Type":"text/plain"},body:JSON.stringify([vt])};this.pendingRequest=function(Ui,Fn){return Pp(md(Ui,{method:"POST"}),Fn)}(Ht,Ui=>{this.pendingRequest=null,y(Ui),this.saveEventData(),this.processRequests(M)})}queueRequest(l,d){this.queue.push(l),this.processRequests(d)}}const Gn=new class extends sl{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,l){Y.EVENTS_URL&&Y.ACCESS_TOKEN&&Array.isArray(c)&&c.some(d=>hp(d)||Em(d))&&this.queueRequest(Date.now(),l)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=Wu(Y.ACCESS_TOKEN),d=l?l.u:Y.ACCESS_TOKEN;let y=d!==this.eventData.tokenU;zd(this.anonId)||(this.anonId=Ed(),y=!0);const M=this.queue.shift();if(this.eventData.lastSuccess){const N=new Date(this.eventData.lastSuccess),X=new Date(M),vt=(M-this.eventData.lastSuccess)/864e5;y=y||vt>=1||vt<-1||N.getDate()!==X.getDate()}else y=!0;y?this.postEvent(M,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:rl,"enabled.telemetry":!1,userId:this.anonId},N=>{N||(this.eventData.lastSuccess=M,this.eventData.tokenU=d)},c):this.processRequests()}},_n=Gn.postTurnstileEvent.bind(Gn),cs=new class extends sl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,l,d,y){this.skuToken=l,this.errorCb=y,Y.EVENTS_URL&&(d||Y.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},d):this.errorCb(new Error(Sm)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:d}=this.queue.shift();l&&this.success[l]||(this.anonId||this.fetchEventData(),zd(this.anonId)||(this.anonId=Ed()),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:rl,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):l&&(this.success[l]=!0)},c))}},$u=cs.postMapLoadEvent.bind(cs),eh=new class extends sl{constructor(){super("gljs.performance")}postPerformanceEvent(c,l){Y.EVENTS_URL&&(c||Y.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:l},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,performanceData:d}=this.queue.shift(),y=function(M){const N=x.performance.getEntriesByType("resource"),X=x.performance.getEntriesByType("mark"),vt=function(nl){const ju={};if(nl){for(const Ku in nl)if(Ku!=="other")for(const lh of nl[Ku]){const Eh=`${Ku}ResolveRangeMin`,Bh=`${Ku}ResolveRangeMax`,Yh=`${Ku}RequestCount`,kh=`${Ku}RequestCachedCount`;ju[Eh]=Math.min(ju[Eh]||1/0,lh.startTime),ju[Bh]=Math.max(ju[Bh]||-1/0,lh.responseEnd);const Vh=rd=>{ju[rd]===void 0&&(ju[rd]=0),++ju[rd]};lh.transferSize!==void 0&&lh.transferSize===0&&Vh(kh),Vh(Yh)}}return ju}(function(nl,ju){const Ku={};if(nl)for(const lh of nl){const Eh=ju(lh);Ku[Eh]===void 0&&(Ku[Eh]=[]),Ku[Eh].push(lh)}return Ku}(N,Ad)),Ht=x.devicePixelRatio,Ui=x.navigator.connection||x.navigator.mozConnection||x.navigator.webkitConnection,Fn={counters:[],metadata:[],attributes:[]},Js=(nl,ju,Ku)=>{Ku!=null&&nl.push({name:ju,value:Ku.toString()})};for(const nl in vt)Js(Fn.counters,nl,vt[nl]);if(M.interactionRange[0]!==1/0&&M.interactionRange[1]!==-1/0&&(Js(Fn.counters,"interactionRangeMin",M.interactionRange[0]),Js(Fn.counters,"interactionRangeMax",M.interactionRange[1])),X)for(const nl of Object.keys(Ph)){const ju=Ph[nl],Ku=X.find(lh=>lh.name===ju);Ku&&Js(Fn.counters,ju,Ku.startTime)}return Js(Fn.counters,"visibilityHidden",M.visibilityHidden),Js(Fn.attributes,"style",function(nl){if(nl)for(const ju of nl){const Ku=ju.name.split("?")[0];if(lm(Ku)){const lh=Ku.split("/").slice(-2);if(lh.length===2)return`mapbox://styles/${lh[0]}/${lh[1]}`}}}(N)),Js(Fn.attributes,"terrainEnabled",M.terrainEnabled?"true":"false"),Js(Fn.attributes,"fogEnabled",M.fogEnabled?"true":"false"),Js(Fn.attributes,"projection",M.projection),Js(Fn.attributes,"zoom",M.zoom),Js(Fn.metadata,"devicePixelRatio",Ht),Js(Fn.metadata,"connectionEffectiveType",Ui?Ui.effectiveType:void 0),Js(Fn.metadata,"navigatorUserAgent",x.navigator.userAgent),Js(Fn.metadata,"screenWidth",x.screen.width),Js(Fn.metadata,"screenHeight",x.screen.height),Js(Fn.metadata,"windowWidth",x.innerWidth),Js(Fn.metadata,"windowHeight",x.innerHeight),Js(Fn.metadata,"mapWidth",M.width/Ht),Js(Fn.metadata,"mapHeight",M.height/Ht),Js(Fn.metadata,"webglRenderer",M.renderer),Js(Fn.metadata,"webglVendor",M.vendor),Js(Fn.metadata,"sdkVersion",C),Js(Fn.metadata,"sdkIdentifier","mapbox-gl-js"),Fn}(d);for(const M of y.metadata);for(const M of y.counters);for(const M of y.attributes);this.postEvent(l,y,()=>{},c)}},nh=eh.postPerformanceEvent.bind(eh),uh=new class extends sl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,l,d,y){if(!Y.API_URL||!Y.SESSION_PATH)return;const M=mh(Y.API_URL+Y.SESSION_PATH);M.params.push(`sku=${l||""}`),M.params.push(`access_token=${y||Y.ACCESS_TOKEN||""}`);const N={url:Jh(M),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(X,vt){return Pp(md(X,{method:"GET"}),vt)}(N,X=>{this.pendingRequest=null,d(X),this.saveEventData(),this.processRequests(y)})}getSessionAPI(c,l,d,y){this.skuToken=l,this.errorCb=y,Y.SESSION_PATH&&Y.API_URL&&(d||Y.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},d):this.errorCb(new Error(Sm)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:d}=this.queue.shift();l&&this.success[l]||this.getSession(d,this.skuToken,y=>{y?this.errorCb(y):l&&(this.success[l]=!0)},c)}},dh=uh.getSessionAPI.bind(uh),vh=new Set,Ph={create:"create",load:"load",fullLoad:"fullLoad"},zh={mark(c){x.performance.mark(c)},measure(c,l,d){x.performance.measure(c,l,d)}};function Ad(c){const l=c.name.split("?")[0];return Qp(l)&&l.includes("mapbox-gl.js")?"javascript":Qp(l)&&l.includes("mapbox-gl.css")?"css":function(d){return Y.API_FONTS_REGEX.test(d)}(l)?"fontRange":Dd(l)?"sprite":lm(l)?"style":function(d){return Y.API_TILEJSON_REGEX.test(d)}(l)?"tilejson":"other"}const wd=x.performance;function Qd(c){const l=c?c.url.toString():void 0;return wd.getEntriesByName(l)}let xf,zf,np,Ah;const mf={now:()=>np!==void 0?np:x.performance.now(),setNow(c){np=c},restoreNow(){np=void 0},frame(c){const l=x.requestAnimationFrame(c);return{cancel:()=>x.cancelAnimationFrame(l)}},getImageData(c,l=0){const{width:d,height:y}=c;Ah||(Ah=x.document.createElement("canvas"));const M=Ah.getContext("2d",{willReadFrequently:!0});if(!M)throw new Error("failed to create canvas 2d context");return(d>Ah.width||y>Ah.height)&&(Ah.width=d,Ah.height=y),M.clearRect(-l,-l,d+2*l,y+2*l),M.drawImage(c,0,0,d,y),M.getImageData(-l,-l,d+2*l,y+2*l)},resolveURL:c=>(xf||(xf=x.document.createElement("a")),xf.href=c,xf.href),get devicePixelRatio(){return x.devicePixelRatio},get prefersReducedMotion(){return!!x.matchMedia&&(zf==null&&(zf=x.matchMedia("(prefers-reduced-motion: reduce)")),zf.matches)}};function Od(c,l,d){d[c]&&d[c].indexOf(l)!==-1||(d[c]=d[c]||[],d[c].push(l))}function qf(c,l,d){if(d&&d[c]){const y=d[c].indexOf(l);y!==-1&&d[c].splice(y,1)}}class mp{constructor(l,d={}){md(this,d),this.type=l}}class Vp extends mp{constructor(l,d={}){super("error",md({error:l},d))}}class om{on(l,d){return this._listeners=this._listeners||{},Od(l,d,this._listeners),this}off(l,d){return qf(l,d,this._listeners),qf(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},Od(l,d,this._oneTimeListeners),this):new Promise(y=>this.once(l,y))}fire(l,d){typeof l=="string"&&(l=new mp(l,d||{}));const y=l.type;if(this.listens(y)){l.target=this;const M=this._listeners&&this._listeners[y]?this._listeners[y].slice():[];for(const vt of M)vt.call(this,l);const N=this._oneTimeListeners&&this._oneTimeListeners[y]?this._oneTimeListeners[y].slice():[];for(const vt of N)qf(y,vt,this._oneTimeListeners),vt.call(this,l);const X=this._eventedParent;X&&(md(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),X.fire(l))}else l instanceof Vp&&console.error(l.error);return this}listens(l){return!!(this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l))}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var Pd=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Hg(c,...l){for(const d of l)for(const y in d)c[y]=d[y];return c}function Fm(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function I_(c){if(Array.isArray(c))return c.map(I_);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const l={};for(const d in c)l[d]=I_(c[d]);return l}return Fm(c)}class Dy extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}var Pg=Dy;class l_{constructor(l,d=[]){this.parent=l,this.bindings={};for(const[y,M]of d)this.bindings[y]=M}concat(l){return new l_(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}var ev=l_;const c_={kind:"null"},ep={kind:"number"},im={kind:"string"},Jp={kind:"boolean"},mm={kind:"color"},yr={kind:"object"},el={kind:"value"},yh={kind:"collator"},Uh={kind:"formatted"},nd={kind:"resolvedImage"};function od(c,l){return{kind:"array",itemType:c,N:l}}function ad(c){if(c.kind==="array"){const l=ad(c.itemType);return typeof c.N=="number"?`array<${l}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${l}>`}return c.kind}const Gf=[c_,ep,im,Jp,mm,Uh,yr,od(el),nd];function Ef(c,l){if(l.kind==="error")return null;if(c.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Ef(c.itemType,l.itemType))&&(typeof c.N!="number"||c.N===l.N))return null}else{if(c.kind===l.kind)return null;if(c.kind==="value"){for(const d of Gf)if(!Ef(d,l))return null}}return`Expected ${ad(c)} but found ${ad(l)} instead.`}function _p(c,l){return l.some(d=>d.kind===c.kind)}function ap(c,l){return l.some(d=>d==="null"?c===null:d==="array"?Array.isArray(c):d==="object"?c&&!Array.isArray(c)&&typeof c=="object":d===typeof c)}var lp,Zp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rm(c){return(c=Math.round(c))<0?0:c>255?255:c}function Yp(c){return Rm(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function Pm(c){return(l=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:l>1?1:l;var l}function kf(c,l,d){return d<0?d+=1:d>1&&(d-=1),6*d<1?c+(l-c)*d*6:2*d<1?l:3*d<2?c+(l-c)*(2/3-d)*6:c}try{lp={}.parseCSSColor=function(c){var l,d=c.replace(/ /g,"").toLowerCase();if(d in Zp)return Zp[d].slice();if(d[0]==="#")return d.length===4?(l=parseInt(d.substr(1),16))>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null:d.length===7&&(l=parseInt(d.substr(1),16))>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null;var y=d.indexOf("("),M=d.indexOf(")");if(y!==-1&&M+1===d.length){var N=d.substr(0,y),X=d.substr(y+1,M-(y+1)).split(","),vt=1;switch(N){case"rgba":if(X.length!==4)return null;vt=Pm(X.pop());case"rgb":return X.length!==3?null:[Yp(X[0]),Yp(X[1]),Yp(X[2]),vt];case"hsla":if(X.length!==4)return null;vt=Pm(X.pop());case"hsl":if(X.length!==3)return null;var Ht=(parseFloat(X[0])%360+360)%360/360,Ui=Pm(X[1]),Fn=Pm(X[2]),Js=Fn<=.5?Fn*(Ui+1):Fn+Ui-Fn*Ui,nl=2*Fn-Js;return[Rm(255*kf(nl,Js,Ht+1/3)),Rm(255*kf(nl,Js,Ht)),Rm(255*kf(nl,Js,Ht-1/3)),vt];default:return null}}return null}}catch{}class Tp{constructor(l,d,y,M=1){this.r=l,this.g=d,this.b=y,this.a=M}static parse(l){if(!l)return;if(l instanceof Tp)return l;if(typeof l!="string")return;const d=lp(l);return d?new Tp(d[0]/255*d[3],d[1]/255*d[3],d[2]/255*d[3],d[3]):void 0}toString(){const[l,d,y,M]=this.toArray();return`rgba(${Math.round(l)},${Math.round(d)},${Math.round(y)},${M})`}toArray(){const{r:l,g:d,b:y,a:M}=this;return M===0?[0,0,0,0]:[255*l/M,255*d/M,255*y/M,M]}toArray01(){const{r:l,g:d,b:y,a:M}=this;return M===0?[0,0,0,0]:[l/M,d/M,y/M,M]}toArray01PremultipliedAlpha(){const{r:l,g:d,b:y,a:M}=this;return[l,d,y,M]}}Tp.black=new Tp(0,0,0,1),Tp.white=new Tp(1,1,1,1),Tp.transparent=new Tp(0,0,0,0),Tp.red=new Tp(1,0,0,1),Tp.blue=new Tp(0,0,1,1);var Np=Tp;class Jm{constructor(l,d,y){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=y,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Um{constructor(l,d,y,M,N){this.text=l.normalize?l.normalize():l,this.image=d,this.scale=y,this.fontStack=M,this.textColor=N}}class bg{constructor(l){this.sections=l}static fromString(l){return new bg([new Um(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof bg?l:bg.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}serialize(){const l=["format"];for(const d of this.sections){if(d.image){l.push(["image",d.image.name]);continue}l.push(d.text);const y={};d.fontStack&&(y["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(y["font-scale"]=d.scale),d.textColor&&(y["text-color"]=["rgba"].concat(d.textColor.toArray())),l.push(y)}return l}}class kg{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new kg({name:l,available:!1}):null}serialize(){return["image",this.name]}}function $m(c,l,d,y){return typeof c=="number"&&c>=0&&c<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?y===void 0||typeof y=="number"&&y>=0&&y<=1?null:`Invalid rgba value [${[c,l,d,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof y=="number"?[c,l,d,y]:[c,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fy(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Np||c instanceof Jm||c instanceof bg||c instanceof kg)return!0;if(Array.isArray(c)){for(const l of c)if(!fy(l))return!1;return!0}if(typeof c=="object"){for(const l in c)if(!fy(c[l]))return!1;return!0}return!1}function Km(c){if(c===null)return c_;if(typeof c=="string")return im;if(typeof c=="boolean")return Jp;if(typeof c=="number")return ep;if(c instanceof Np)return mm;if(c instanceof Jm)return yh;if(c instanceof bg)return Uh;if(c instanceof kg)return nd;if(Array.isArray(c)){const l=c.length;let d;for(const y of c){const M=Km(y);if(d){if(d===M)continue;d=el;break}d=M}return od(d||el,l)}return yr}function Xg(c){const l=typeof c;return c===null?"":l==="string"||l==="number"||l==="boolean"?String(c):c instanceof Np||c instanceof bg||c instanceof kg?c.toString():JSON.stringify(c)}class Ly{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!fy(l[1]))return d.error("invalid value");const y=l[1];let M=Km(y);const N=d.expectedType;return M.kind!=="array"||M.N!==0||!N||N.kind!=="array"||typeof N.N=="number"&&N.N!==0||(M=N),new Ly(M,y)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Np?["rgba"].concat(this.value.toArray()):this.value instanceof bg?this.value.serialize():this.value}}var Ry=Ly,wg=class{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}};const u_={string:im,number:ep,boolean:Jp,object:yr};class Oy{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let y,M=1;const N=l[0];if(N==="array"){let vt,Ht;if(l.length>2){const Ui=l[1];if(typeof Ui!="string"||!(Ui in u_)||Ui==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);vt=u_[Ui],M++}else vt=el;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);Ht=l[2],M++}y=od(vt,Ht)}else y=u_[N];const X=[];for(;M<l.length;M++){const vt=d.parse(l[M],M,el);if(!vt)return null;X.push(vt)}return new Oy(y,X)}evaluate(l){for(let d=0;d<this.args.length;d++){const y=this.args[d].evaluate(l);if(!Ef(this.type,Km(y)))return y;if(d===this.args.length-1)throw new wg(`Expected value to be of type ${ad(this.type)}, but found ${ad(Km(y))} instead.`)}return null}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=this.type,d=[l.kind];if(l.kind==="array"){const y=l.itemType;if(y.kind==="string"||y.kind==="number"||y.kind==="boolean"){d.push(y.kind);const M=l.N;(typeof M=="number"||this.args.length>1)&&d.push(M)}}return d.concat(this.args.map(y=>y.serialize()))}}var V_=Oy;class n0{constructor(l){this.type=Uh,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const y=l[1];if(!Array.isArray(y)&&typeof y=="object")return d.error("First argument must be an image or text section.");const M=[];let N=!1;for(let X=1;X<=l.length-1;++X){const vt=l[X];if(N&&typeof vt=="object"&&!Array.isArray(vt)){N=!1;let Ht=null;if(vt["font-scale"]&&(Ht=d.parse(vt["font-scale"],1,ep),!Ht))return null;let Ui=null;if(vt["text-font"]&&(Ui=d.parse(vt["text-font"],1,od(im)),!Ui))return null;let Fn=null;if(vt["text-color"]&&(Fn=d.parse(vt["text-color"],1,mm),!Fn))return null;const Js=M[M.length-1];Js.scale=Ht,Js.font=Ui,Js.textColor=Fn}else{const Ht=d.parse(l[X],1,el);if(!Ht)return null;const Ui=Ht.type.kind;if(Ui!=="string"&&Ui!=="value"&&Ui!=="null"&&Ui!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");N=!0,M.push({content:Ht,scale:null,font:null,textColor:null})}}return new n0(M)}evaluate(l){return new bg(this.sections.map(d=>{const y=d.content.evaluate(l);return Km(y)===nd?new Um("",y,null,null,null):new Um(Xg(y),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null)}))}eachChild(l){for(const d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor)}outputDefined(){return!1}serialize(){const l=["format"];for(const d of this.sections){l.push(d.content.serialize());const y={};d.scale&&(y["font-scale"]=d.scale.serialize()),d.font&&(y["text-font"]=d.font.serialize()),d.textColor&&(y["text-color"]=d.textColor.serialize()),l.push(y)}return l}}class O0{constructor(l){this.type=nd,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");const y=d.parse(l[1],1,im);return y?new O0(y):d.error("No image name provided.")}evaluate(l){const d=this.input.evaluate(l),y=kg.fromString(d);return y&&l.availableImages&&(y.available=l.availableImages.indexOf(d)>-1),y}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const l1={"to-boolean":Jp,"to-color":mm,"to-number":ep,"to-string":im};class tv{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const y=l[0];if((y==="to-boolean"||y==="to-string")&&l.length!==2)return d.error("Expected one argument.");const M=l1[y],N=[];for(let X=1;X<l.length;X++){const vt=d.parse(l[X],X,el);if(!vt)return null;N.push(vt)}return new tv(M,N)}evaluate(l){if(this.type.kind==="boolean")return!!this.args[0].evaluate(l);if(this.type.kind==="color"){let d,y;for(const M of this.args){if(d=M.evaluate(l),y=null,d instanceof Np)return d;if(typeof d=="string"){const N=l.parseColor(d);if(N)return N}else if(Array.isArray(d)&&(y=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:$m(d[0],d[1],d[2],d[3]),!y))return new Np(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new wg(y||`Could not parse color from value '${typeof d=="string"?d:String(JSON.stringify(d))}'`)}if(this.type.kind==="number"){let d=null;for(const y of this.args){if(d=y.evaluate(l),d===null)return 0;const M=Number(d);if(!isNaN(M))return M}throw new wg(`Could not convert ${JSON.stringify(d)} to number.`)}return this.type.kind==="formatted"?bg.fromString(Xg(this.args[0].evaluate(l))):this.type.kind==="resolvedImage"?kg.fromString(Xg(this.args[0].evaluate(l))):Xg(this.args[0].evaluate(l))}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){if(this.type.kind==="formatted")return new n0([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new O0(this.args[0]).serialize();const l=[`to-${this.type.kind}`];return this.eachChild(d=>{l.push(d.serialize())}),l}}var oy=tv;const o0=["Unknown","Point","LineString","Polygon"];var $y=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?o0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:d,y}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*l-c[0])+this.featureDistanceData.bearing[1]*(y*l-c[1])}return 0}parseColor(c){let l=this._parseColorCache[c];return l||(l=this._parseColorCache[c]=Np.parse(c)),l}};class py{constructor(l,d,y,M){this.name=l,this.type=d,this._evaluate=y,this.args=M}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(l=>l.serialize()))}static parse(l,d){const y=l[0],M=py.definitions[y];if(!M)return d.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0);const N=Array.isArray(M)?M[0]:M.type,X=Array.isArray(M)?[[M[1],M[2]]]:M.overloads,vt=X.filter(([Ui])=>!Array.isArray(Ui)||Ui.length===l.length-1);let Ht=null;for(const[Ui,Fn]of vt){Ht=new h0(d.registry,d.path,null,d.scope);const Js=[];let nl=!1;for(let ju=1;ju<l.length;ju++){const Ku=l[ju],lh=Array.isArray(Ui)?Ui[ju-1]:Ui.type,Eh=Ht.parse(Ku,1+Js.length,lh);if(!Eh){nl=!0;break}Js.push(Eh)}if(!nl)if(Array.isArray(Ui)&&Ui.length!==Js.length)Ht.error(`Expected ${Ui.length} arguments, but found ${Js.length} instead.`);else{for(let ju=0;ju<Js.length;ju++){const Ku=Array.isArray(Ui)?Ui[ju]:Ui.type,lh=Js[ju];Ht.concat(ju+1).checkSubtype(Ku,lh.type)}if(Ht.errors.length===0)return new py(y,N,Fn,Js)}}if(vt.length===1)d.errors.push(...Ht.errors);else{const Ui=(vt.length?vt:X).map(([Js])=>{return nl=Js,Array.isArray(nl)?`(${nl.map(ad).join(", ")})`:`(${ad(nl.type)}...)`;var nl}).join(" | "),Fn=[];for(let Js=1;Js<l.length;Js++){const nl=d.parse(l[Js],1+Fn.length);if(!nl)return null;Fn.push(ad(nl.type))}d.error(`Expected arguments of type ${Ui}, but found (${Fn.join(", ")}) instead.`)}return null}static register(l,d){py.definitions=d;for(const y in d)l[y]=py}}var Vg=py;class fm{constructor(l,d,y){this.type=yh,this.locale=y,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");const y=l[1];if(typeof y!="object"||Array.isArray(y))return d.error("Collator options argument must be an object.");const M=d.parse(y["case-sensitive"]!==void 0&&y["case-sensitive"],1,Jp);if(!M)return null;const N=d.parse(y["diacritic-sensitive"]!==void 0&&y["diacritic-sensitive"],1,Jp);if(!N)return null;let X=null;return y.locale&&(X=d.parse(y.locale,1,im),!X)?null:new fm(M,N,X)}evaluate(l){return new Jm(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}serialize(){const l={};return l["case-sensitive"]=this.caseSensitive.serialize(),l["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(l.locale=this.locale.serialize()),["collator",l]}}const G_=8192;function eg(c,l){c[0]=Math.min(c[0],l[0]),c[1]=Math.min(c[1],l[1]),c[2]=Math.max(c[2],l[0]),c[3]=Math.max(c[3],l[1])}function h_(c,l){return!(c[0]<=l[0]||c[2]>=l[2]||c[1]<=l[1]||c[3]>=l[3])}function iv(c,l){const d=(180+c[0])/360,y=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,M=Math.pow(2,l.z);return[Math.round(d*M*G_),Math.round(y*M*G_)]}function By(c,l,d){const y=c[0]-l[0],M=c[1]-l[1],N=c[0]-d[0],X=c[1]-d[1];return y*X-N*M==0&&y*N<=0&&M*X<=0}function j_(c,l){let d=!1;for(let X=0,vt=l.length;X<vt;X++){const Ht=l[X];for(let Ui=0,Fn=Ht.length;Ui<Fn-1;Ui++){if(By(c,Ht[Ui],Ht[Ui+1]))return!1;(M=Ht[Ui])[1]>(y=c)[1]!=(N=Ht[Ui+1])[1]>y[1]&&y[0]<(N[0]-M[0])*(y[1]-M[1])/(N[1]-M[1])+M[0]&&(d=!d)}}var y,M,N;return d}function a0(c,l){for(let d=0;d<l.length;d++)if(j_(c,l[d]))return!0;return!1}function s0(c,l,d,y){const M=y[0]-d[0],N=y[1]-d[1],X=(c[0]-d[0])*N-M*(c[1]-d[1]),vt=(l[0]-d[0])*N-M*(l[1]-d[1]);return X>0&&vt<0||X<0&&vt>0}function wm(c,l,d){for(const Ui of d)for(let Fn=0;Fn<Ui.length-1;++Fn)if((vt=[(X=Ui[Fn+1])[0]-(N=Ui[Fn])[0],X[1]-N[1]])[0]*(Ht=[(M=l)[0]-(y=c)[0],M[1]-y[1]])[1]-vt[1]*Ht[0]!=0&&s0(y,M,N,X)&&s0(N,X,y,M))return!0;var y,M,N,X,vt,Ht;return!1}function ay(c,l){for(let d=0;d<c.length;++d)if(!j_(c[d],l))return!1;for(let d=0;d<c.length-1;++d)if(wm(c[d],c[d+1],l))return!1;return!0}function my(c,l){for(let d=0;d<l.length;d++)if(ay(c,l[d]))return!0;return!1}function l0(c,l,d){const y=[];for(let M=0;M<c.length;M++){const N=[];for(let X=0;X<c[M].length;X++){const vt=iv(c[M][X],d);eg(l,vt),N.push(vt)}y.push(N)}return y}function gy(c,l,d){const y=[];for(let M=0;M<c.length;M++){const N=l0(c[M],l,d);y.push(N)}return y}function vv(c,l,d,y){if(c[0]<d[0]||c[0]>d[2]){const M=.5*y;let N=c[0]-d[0]>M?-y:d[0]-c[0]>M?y:0;N===0&&(N=c[0]-d[2]>M?-y:d[2]-c[0]>M?y:0),c[0]+=N}eg(l,c)}function sy(c,l,d,y){const M=Math.pow(2,y.z)*G_,N=[y.x*G_,y.y*G_],X=[];if(!c)return X;for(const vt of c)for(const Ht of vt){const Ui=[Ht.x+N[0],Ht.y+N[1]];vv(Ui,l,d,M),X.push(Ui)}return X}function cm(c,l,d,y){const M=Math.pow(2,y.z)*G_,N=[y.x*G_,y.y*G_],X=[];if(!c)return X;for(const Ht of c){const Ui=[];for(const Fn of Ht){const Js=[Fn.x+N[0],Fn.y+N[1]];eg(l,Js),Ui.push(Js)}X.push(Ui)}if(l[2]-l[0]<=M/2){(vt=l)[0]=vt[1]=1/0,vt[2]=vt[3]=-1/0;for(const Ht of X)for(const Ui of Ht)vv(Ui,l,d,M)}var vt;return X}class Ny{constructor(l,d){this.type=Jp,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(fy(l[1])){const y=l[1];if(y.type==="FeatureCollection")for(let M=0;M<y.features.length;++M){const N=y.features[M].geometry.type;if(N==="Polygon"||N==="MultiPolygon")return new Ny(y,y.features[M].geometry)}else if(y.type==="Feature"){const M=y.geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new Ny(y,y.geometry)}else if(y.type==="Polygon"||y.type==="MultiPolygon")return new Ny(y,y)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,y){const M=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],X=d.canonicalID();if(!X)return!1;if(y.type==="Polygon"){const vt=l0(y.coordinates,N,X),Ht=sy(d.geometry(),M,N,X);if(!h_(M,N))return!1;for(const Ui of Ht)if(!j_(Ui,vt))return!1}if(y.type==="MultiPolygon"){const vt=gy(y.coordinates,N,X),Ht=sy(d.geometry(),M,N,X);if(!h_(M,N))return!1;for(const Ui of Ht)if(!a0(Ui,vt))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,y){const M=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],X=d.canonicalID();if(!X)return!1;if(y.type==="Polygon"){const vt=l0(y.coordinates,N,X),Ht=cm(d.geometry(),M,N,X);if(!h_(M,N))return!1;for(const Ui of Ht)if(!ay(Ui,vt))return!1}if(y.type==="MultiPolygon"){const vt=gy(y.coordinates,N,X),Ht=cm(d.geometry(),M,N,X);if(!h_(M,N))return!1;for(const Ui of Ht)if(!my(Ui,vt))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var zy=Ny;function q_(c){if(c instanceof Vg&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof zy)return!1;let l=!0;return c.eachChild(d=>{l&&!q_(d)&&(l=!1)}),l}function d_(c){if(c instanceof Vg&&c.name==="feature-state")return!1;let l=!0;return c.eachChild(d=>{l&&!d_(d)&&(l=!1)}),l}function c0(c,l){if(c instanceof Vg&&l.indexOf(c.name)>=0)return!1;let d=!0;return c.eachChild(y=>{d&&!c0(y,l)&&(d=!1)}),d}class u0{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const y=l[1];return d.scope.has(y)?new u0(y,d.scope.get(y)):d.error(`Unknown variable "${y}". Make sure "${y}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var rv=u0;class Fy{constructor(l,d=[],y,M=new ev,N=[]){this.registry=l,this.path=d,this.key=d.map(X=>`[${X}]`).join(""),this.scope=M,this.errors=N,this.expectedType=y}parse(l,d,y,M,N={}){return d?this.concat(d,y,M)._parse(l,N):this._parse(l,N)}_parse(l,d){function y(M,N,X){return X==="assert"?new V_(N,[M]):X==="coerce"?new oy(N,[M]):M}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const M=l[0];if(typeof M!="string")return this.error(`Expression name must be a string, but found ${typeof M} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const N=this.registry[M];if(N){let X=N.parse(l,this);if(!X)return null;if(this.expectedType){const vt=this.expectedType,Ht=X.type;if(vt.kind!=="string"&&vt.kind!=="number"&&vt.kind!=="boolean"&&vt.kind!=="object"&&vt.kind!=="array"||Ht.kind!=="value")if(vt.kind!=="color"&&vt.kind!=="formatted"&&vt.kind!=="resolvedImage"||Ht.kind!=="value"&&Ht.kind!=="string"){if(this.checkSubtype(vt,Ht))return null}else X=y(X,vt,d.typeAnnotation||"coerce");else X=y(X,vt,d.typeAnnotation||"assert")}if(!(X instanceof Ry)&&X.type.kind!=="resolvedImage"&&Eg(X)){const vt=new $y;try{X=new Ry(X.type,X.evaluate(vt))}catch(Ht){return this.error(Ht.message),null}}return X}return this.error(`Unknown expression "${M}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,y){const M=typeof l=="number"?this.path.concat(l):this.path,N=y?this.scope.concat(y):this.scope;return new Fy(this.registry,M,d||null,N,this.errors)}error(l,...d){const y=`${this.key}${d.map(M=>`[${M}]`).join("")}`;this.errors.push(new Pg(y,l))}checkSubtype(l,d){const y=Ef(l,d);return y&&this.error(y),y}}var h0=Fy;function Eg(c){if(c instanceof rv)return Eg(c.boundExpression);if(c instanceof Vg&&c.name==="error"||c instanceof fm||c instanceof zy)return!1;const l=c instanceof oy||c instanceof V_;let d=!0;return c.eachChild(y=>{d=l?d&&Eg(y):d&&y instanceof Ry}),!!d&&q_(c)&&c0(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Z_(c,l){const d=c.length-1;let y,M,N=0,X=d,vt=0;for(;N<=X;)if(vt=Math.floor((N+X)/2),y=c[vt],M=c[vt+1],y<=l){if(vt===d||l<M)return vt;N=vt+1}else{if(!(y>l))throw new wg("Input is not a number.");X=vt-1}return 0}class f_{constructor(l,d,y){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(const[M,N]of y)this.labels.push(M),this.outputs.push(N)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");const y=d.parse(l[1],1,ep);if(!y)return null;const M=[];let N=null;d.expectedType&&d.expectedType.kind!=="value"&&(N=d.expectedType);for(let X=1;X<l.length;X+=2){const vt=X===1?-1/0:l[X],Ht=l[X+1],Ui=X,Fn=X+1;if(typeof vt!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ui);if(M.length&&M[M.length-1][0]>=vt)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ui);const Js=d.parse(Ht,Fn,N);if(!Js)return null;N=N||Js.type,M.push([vt,Js])}return new f_(N,y,M)}evaluate(l){const d=this.labels,y=this.outputs;if(d.length===1)return y[0].evaluate(l);const M=this.input.evaluate(l);if(M<=d[0])return y[0].evaluate(l);const N=d.length;return M>=d[N-1]?y[N-1].evaluate(l):y[Z_(d,M)].evaluate(l)}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){const l=["step",this.input.serialize()];for(let d=0;d<this.labels.length;d++)d>0&&l.push(this.labels[d]),l.push(this.outputs[d].serialize());return l}}var p_=f_;function Kp(c,l,d){return c*(1-d)+l*d}var C_=Object.freeze({__proto__:null,number:Kp,color:function(c,l,d){return new Np(Kp(c.r,l.r,d),Kp(c.g,l.g,d),Kp(c.b,l.b,d),Kp(c.a,l.a,d))},array:function(c,l,d){return c.map((y,M)=>Kp(y,l[M],d))}});const m_=.95047,Nv=1.08883,_y=4/29,Uy=6/29,Xm=3*Uy*Uy,d0=Math.PI/180,um=180/Math.PI;function Vy(c){return c>.008856451679035631?Math.pow(c,1/3):c/Xm+_y}function Bm(c){return c>Uy?c*c*c:Xm*(c-_y)}function Im(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function g_(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function ly(c){const l=g_(c.r),d=g_(c.g),y=g_(c.b),M=Vy((.4124564*l+.3575761*d+.1804375*y)/m_),N=Vy((.2126729*l+.7151522*d+.072175*y)/1);return{l:116*N-16,a:500*(M-N),b:200*(N-Vy((.0193339*l+.119192*d+.9503041*y)/Nv)),alpha:c.a}}function xv(c){let l=(c.l+16)/116,d=isNaN(c.a)?l:l+c.a/500,y=isNaN(c.b)?l:l-c.b/200;return l=1*Bm(l),d=m_*Bm(d),y=Nv*Bm(y),new Np(Im(3.2404542*d-1.5371385*l-.4985314*y),Im(-.969266*d+1.8760108*l+.041556*y),Im(.0556434*d-.2040259*l+1.0572252*y),c.alpha)}function cy(c,l,d){const y=l-c;return c+d*(y>180||y<-180?y-360*Math.round(y/360):y)}const f0={forward:ly,reverse:xv,interpolate:function(c,l,d){return{l:Kp(c.l,l.l,d),a:Kp(c.a,l.a,d),b:Kp(c.b,l.b,d),alpha:Kp(c.alpha,l.alpha,d)}}},__={forward:function(c){const{l,a:d,b:y}=ly(c),M=Math.atan2(y,d)*um;return{h:M<0?M+360:M,c:Math.sqrt(d*d+y*y),l,alpha:c.a}},reverse:function(c){const l=c.h*d0,d=c.c;return xv({l:c.l,a:Math.cos(l)*d,b:Math.sin(l)*d,alpha:c.alpha})},interpolate:function(c,l,d){return{h:cy(c.h,l.h,d),c:Kp(c.c,l.c,d),l:Kp(c.l,l.l,d),alpha:Kp(c.alpha,l.alpha,d)}}};var H_=Object.freeze({__proto__:null,lab:f0,hcl:__});class jy{constructor(l,d,y,M,N){this.type=l,this.operator=d,this.interpolation=y,this.input=M,this.labels=[],this.outputs=[];for(const[X,vt]of N)this.labels.push(X),this.outputs.push(vt)}static interpolationFactor(l,d,y,M){let N=0;if(l.name==="exponential")N=yy(d,l.base,y,M);else if(l.name==="linear")N=yy(d,1,y,M);else if(l.name==="cubic-bezier"){const X=l.controlPoints;N=new Co(X[0],X[1],X[2],X[3]).solve(yy(d,1,y,M))}return N}static parse(l,d){let[y,M,N,...X]=l;if(!Array.isArray(M)||M.length===0)return d.error("Expected an interpolation type expression.",1);if(M[0]==="linear")M={name:"linear"};else if(M[0]==="exponential"){const Ui=M[1];if(typeof Ui!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);M={name:"exponential",base:Ui}}else{if(M[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(M[0])}`,1,0);{const Ui=M.slice(1);if(Ui.length!==4||Ui.some(Fn=>typeof Fn!="number"||Fn<0||Fn>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);M={name:"cubic-bezier",controlPoints:Ui}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(N=d.parse(N,2,ep),!N)return null;const vt=[];let Ht=null;y==="interpolate-hcl"||y==="interpolate-lab"?Ht=mm:d.expectedType&&d.expectedType.kind!=="value"&&(Ht=d.expectedType);for(let Ui=0;Ui<X.length;Ui+=2){const Fn=X[Ui],Js=X[Ui+1],nl=Ui+3,ju=Ui+4;if(typeof Fn!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',nl);if(vt.length&&vt[vt.length-1][0]>=Fn)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',nl);const Ku=d.parse(Js,ju,Ht);if(!Ku)return null;Ht=Ht||Ku.type,vt.push([Fn,Ku])}return Ht.kind==="number"||Ht.kind==="color"||Ht.kind==="array"&&Ht.itemType.kind==="number"&&typeof Ht.N=="number"?new jy(Ht,y,M,N,vt):d.error(`Type ${ad(Ht)} is not interpolatable.`)}evaluate(l){const d=this.labels,y=this.outputs;if(d.length===1)return y[0].evaluate(l);const M=this.input.evaluate(l);if(M<=d[0])return y[0].evaluate(l);const N=d.length;if(M>=d[N-1])return y[N-1].evaluate(l);const X=Z_(d,M),vt=jy.interpolationFactor(this.interpolation,M,d[X],d[X+1]),Ht=y[X].evaluate(l),Ui=y[X+1].evaluate(l);return this.operator==="interpolate"?C_[this.type.kind.toLowerCase()](Ht,Ui,vt):this.operator==="interpolate-hcl"?__.reverse(__.interpolate(__.forward(Ht),__.forward(Ui),vt)):f0.reverse(f0.interpolate(f0.forward(Ht),f0.forward(Ui),vt))}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){let l;l=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const d=[this.operator,l,this.input.serialize()];for(let y=0;y<this.labels.length;y++)d.push(this.labels[y],this.outputs[y].serialize());return d}}function yy(c,l,d,y){const M=y-d,N=c-d;return M===0?0:l===1?N/M:(Math.pow(l,N)-1)/(Math.pow(l,M)-1)}var Qg=jy;class qy{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expectected at least one argument.");let y=null;const M=d.expectedType;M&&M.kind!=="value"&&(y=M);const N=[];for(const vt of l.slice(1)){const Ht=d.parse(vt,1+N.length,y,void 0,{typeAnnotation:"omit"});if(!Ht)return null;y=y||Ht.type,N.push(Ht)}const X=M&&N.some(vt=>Ef(M,vt.type));return new qy(X?el:y,N)}evaluate(l){let d,y=null,M=0;for(const N of this.args){if(M++,y=N.evaluate(l),y&&y instanceof kg&&!y.available&&(d||(d=y),y=null,M===this.args.length))return d;if(y!==null)break}return y}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=["coalesce"];return this.eachChild(d=>{l.push(d.serialize())}),l}}var nv=qy;class p0{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const y=[];for(let N=1;N<l.length-1;N+=2){const X=l[N];if(typeof X!="string")return d.error(`Expected string, but found ${typeof X} instead.`,N);if(/[^a-zA-Z0-9_]/.test(X))return d.error("Variable names must contain only alphanumeric characters or '_'.",N);const vt=d.parse(l[N+1],N+1);if(!vt)return null;y.push([X,vt])}const M=d.parse(l[l.length-1],l.length-1,d.expectedType,y);return M?new p0(y,M):null}outputDefined(){return this.result.outputDefined()}serialize(){const l=["let"];for(const[d,y]of this.bindings)l.push(d,y.serialize());return l.push(this.result.serialize()),l}}var M_=p0;class m0{constructor(l,d,y){this.type=l,this.index=d,this.input=y}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,ep),M=d.parse(l[2],2,od(d.expectedType||el));return y&&M?new m0(M.type.itemType,y,M):null}evaluate(l){const d=this.index.evaluate(l),y=this.input.evaluate(l);if(d<0)throw new wg(`Array index out of bounds: ${d} < 0.`);if(d>=y.length)throw new wg(`Array index out of bounds: ${d} > ${y.length-1}.`);if(d!==Math.floor(d))throw new wg(`Array index must be an integer, but found ${d} instead.`);return y[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var X_=m0;class hd{constructor(l,d){this.type=Jp,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,el),M=d.parse(l[2],2,el);return y&&M?_p(y.type,[Jp,im,ep,c_,el])?new hd(y,M):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ad(y.type)} instead`):null}evaluate(l){const d=this.needle.evaluate(l),y=this.haystack.evaluate(l);if(y==null)return!1;if(!ap(d,["boolean","string","number","null"]))throw new wg(`Expected first argument to be of type boolean, string, number or null, but found ${ad(Km(d))} instead.`);if(!ap(y,["string","array"]))throw new wg(`Expected second argument to be of type array or string, but found ${ad(Km(y))} instead.`);return y.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wf=hd;class ip{constructor(l,d,y){this.type=ep,this.needle=l,this.haystack=d,this.fromIndex=y}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,el),M=d.parse(l[2],2,el);if(!y||!M)return null;if(!_p(y.type,[Jp,im,ep,c_,el]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ad(y.type)} instead`);if(l.length===4){const N=d.parse(l[3],3,ep);return N?new ip(y,M,N):null}return new ip(y,M)}evaluate(l){const d=this.needle.evaluate(l),y=this.haystack.evaluate(l);if(!ap(d,["boolean","string","number","null"]))throw new wg(`Expected first argument to be of type boolean, string, number or null, but found ${ad(Km(d))} instead.`);if(!ap(y,["string","array"]))throw new wg(`Expected second argument to be of type array or string, but found ${ad(Km(y))} instead.`);if(this.fromIndex){const M=this.fromIndex.evaluate(l);return y.indexOf(d,M)}return y.indexOf(d)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const l=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),l]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var $p=ip;class Nm{constructor(l,d,y,M,N,X){this.inputType=l,this.type=d,this.input=y,this.cases=M,this.outputs=N,this.otherwise=X}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let y,M;d.expectedType&&d.expectedType.kind!=="value"&&(M=d.expectedType);const N={},X=[];for(let Ui=2;Ui<l.length-1;Ui+=2){let Fn=l[Ui];const Js=l[Ui+1];Array.isArray(Fn)||(Fn=[Fn]);const nl=d.concat(Ui);if(Fn.length===0)return nl.error("Expected at least one branch label.");for(const Ku of Fn){if(typeof Ku!="number"&&typeof Ku!="string")return nl.error("Branch labels must be numbers or strings.");if(typeof Ku=="number"&&Math.abs(Ku)>Number.MAX_SAFE_INTEGER)return nl.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ku=="number"&&Math.floor(Ku)!==Ku)return nl.error("Numeric branch labels must be integer values.");if(y){if(nl.checkSubtype(y,Km(Ku)))return null}else y=Km(Ku);if(N[String(Ku)]!==void 0)return nl.error("Branch labels must be unique.");N[String(Ku)]=X.length}const ju=d.parse(Js,Ui,M);if(!ju)return null;M=M||ju.type,X.push(ju)}const vt=d.parse(l[1],1,el);if(!vt)return null;const Ht=d.parse(l[l.length-1],l.length-1,M);return Ht?vt.type.kind!=="value"&&d.concat(1).checkSubtype(y,vt.type)?null:new Nm(y,M,vt,N,X,Ht):null}evaluate(l){const d=this.input.evaluate(l);return(Km(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["match",this.input.serialize()],d=Object.keys(this.cases).sort(),y=[],M={};for(const X of d){const vt=M[this.cases[X]];vt===void 0?(M[this.cases[X]]=y.length,y.push([this.cases[X],[X]])):y[vt][1].push(X)}const N=X=>this.inputType.kind==="number"?Number(X):X;for(const[X,vt]of y)l.push(vt.length===1?N(vt[0]):vt.map(N)),l.push(this.outputs[X].serialize());return l.push(this.otherwise.serialize()),l}}var hm=Nm;class Qm{constructor(l,d,y){this.type=l,this.branches=d,this.otherwise=y}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let y;d.expectedType&&d.expectedType.kind!=="value"&&(y=d.expectedType);const M=[];for(let X=1;X<l.length-1;X+=2){const vt=d.parse(l[X],X,Jp);if(!vt)return null;const Ht=d.parse(l[X+1],X+1,y);if(!Ht)return null;M.push([vt,Ht]),y=y||Ht.type}const N=d.parse(l[l.length-1],l.length-1,y);return N?new Qm(y,M,N):null}evaluate(l){for(const[d,y]of this.branches)if(d.evaluate(l))return y.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[d,y]of this.branches)l(d),l(y);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["case"];return this.eachChild(d=>{l.push(d.serialize())}),l}}var og=Qm;class ag{constructor(l,d,y,M){this.type=l,this.input=d,this.beginIndex=y,this.endIndex=M}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,el),M=d.parse(l[2],2,ep);if(!y||!M)return null;if(!_p(y.type,[od(el),im,el]))return d.error(`Expected first argument to be of type array or string, but found ${ad(y.type)} instead`);if(l.length===4){const N=d.parse(l[3],3,ep);return N?new ag(y.type,y,M,N):null}return new ag(y.type,y,M)}evaluate(l){const d=this.input.evaluate(l),y=this.beginIndex.evaluate(l);if(!ap(d,["string","array"]))throw new wg(`Expected first argument to be of type array or string, but found ${ad(Km(d))} instead.`);if(this.endIndex){const M=this.endIndex.evaluate(l);return d.slice(y,M)}return d.slice(y)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const l=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),l]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Vm=ag;function tp(c,l){return c==="=="||c==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Wg(c,l,d,y){return y.compare(l,d)===0}function Tg(c,l,d){const y=c!=="=="&&c!=="!=";return class YE{constructor(N,X,vt){this.type=Jp,this.lhs=N,this.rhs=X,this.collator=vt,this.hasUntypedArgument=N.type.kind==="value"||X.type.kind==="value"}static parse(N,X){if(N.length!==3&&N.length!==4)return X.error("Expected two or three arguments.");const vt=N[0];let Ht=X.parse(N[1],1,el);if(!Ht)return null;if(!tp(vt,Ht.type))return X.concat(1).error(`"${vt}" comparisons are not supported for type '${ad(Ht.type)}'.`);let Ui=X.parse(N[2],2,el);if(!Ui)return null;if(!tp(vt,Ui.type))return X.concat(2).error(`"${vt}" comparisons are not supported for type '${ad(Ui.type)}'.`);if(Ht.type.kind!==Ui.type.kind&&Ht.type.kind!=="value"&&Ui.type.kind!=="value")return X.error(`Cannot compare types '${ad(Ht.type)}' and '${ad(Ui.type)}'.`);y&&(Ht.type.kind==="value"&&Ui.type.kind!=="value"?Ht=new V_(Ui.type,[Ht]):Ht.type.kind!=="value"&&Ui.type.kind==="value"&&(Ui=new V_(Ht.type,[Ui])));let Fn=null;if(N.length===4){if(Ht.type.kind!=="string"&&Ui.type.kind!=="string"&&Ht.type.kind!=="value"&&Ui.type.kind!=="value")return X.error("Cannot use collator to compare non-string types.");if(Fn=X.parse(N[3],3,yh),!Fn)return null}return new YE(Ht,Ui,Fn)}evaluate(N){const X=this.lhs.evaluate(N),vt=this.rhs.evaluate(N);if(y&&this.hasUntypedArgument){const Ht=Km(X),Ui=Km(vt);if(Ht.kind!==Ui.kind||Ht.kind!=="string"&&Ht.kind!=="number")throw new wg(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${Ht.kind}, ${Ui.kind}) instead.`)}if(this.collator&&!y&&this.hasUntypedArgument){const Ht=Km(X),Ui=Km(vt);if(Ht.kind!=="string"||Ui.kind!=="string")return l(N,X,vt)}return this.collator?d(N,X,vt,this.collator.evaluate(N)):l(N,X,vt)}eachChild(N){N(this.lhs),N(this.rhs),this.collator&&N(this.collator)}outputDefined(){return!0}serialize(){const N=[c];return this.eachChild(X=>{N.push(X.serialize())}),N}}}const fg=Tg("==",function(c,l,d){return l===d},Wg),A_=Tg("!=",function(c,l,d){return l!==d},function(c,l,d,y){return!Wg(0,l,d,y)}),sp=Tg("<",function(c,l,d){return l<d},function(c,l,d,y){return y.compare(l,d)<0}),Zy=Tg(">",function(c,l,d){return l>d},function(c,l,d,y){return y.compare(l,d)>0}),vy=Tg("<=",function(c,l,d){return l<=d},function(c,l,d,y){return y.compare(l,d)<=0}),$0=Tg(">=",function(c,l,d){return l>=d},function(c,l,d,y){return y.compare(l,d)>=0});class g0{constructor(l,d,y,M,N,X){this.type=im,this.number=l,this.locale=d,this.currency=y,this.unit=M,this.minFractionDigits=N,this.maxFractionDigits=X}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");const y=d.parse(l[1],1,ep);if(!y)return null;const M=l[2];if(typeof M!="object"||Array.isArray(M))return d.error("NumberFormat options argument must be an object.");let N=null;if(M.locale&&(N=d.parse(M.locale,1,im),!N))return null;let X=null;if(M.currency&&(X=d.parse(M.currency,1,im),!X))return null;let vt=null;if(M.unit&&(vt=d.parse(M.unit,1,im),!vt))return null;let Ht=null;if(M["min-fraction-digits"]&&(Ht=d.parse(M["min-fraction-digits"],1,ep),!Ht))return null;let Ui=null;return M["max-fraction-digits"]&&(Ui=d.parse(M["max-fraction-digits"],1,ep),!Ui)?null:new g0(y,N,X,vt,Ht,Ui)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(l):void 0,unit:this.unit?this.unit.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.unit&&l(this.unit),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const l={};return this.locale&&(l.locale=this.locale.serialize()),this.currency&&(l.currency=this.currency.serialize()),this.unit&&(l.unit=this.unit.serialize()),this.minFractionDigits&&(l["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(l["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),l]}}class ov{constructor(l){this.type=ep,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);const y=d.parse(l[1],1);return y?y.type.kind!=="array"&&y.type.kind!=="string"&&y.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${ad(y.type)} instead.`):new ov(y):null}evaluate(l){const d=this.input.evaluate(l);if(typeof d=="string"||Array.isArray(d))return d.length;throw new wg(`Expected value to be of type string or array, but found ${ad(Km(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){const l=["length"];return this.eachChild(d=>{l.push(d.serialize())}),l}}const _0={"==":fg,"!=":A_,">":Zy,"<":sp,">=":$0,"<=":vy,array:V_,at:X_,boolean:V_,case:og,coalesce:nv,collator:fm,format:n0,image:O0,in:wf,"index-of":$p,interpolate:Qg,"interpolate-hcl":Qg,"interpolate-lab":Qg,length:ov,let:M_,literal:Ry,match:hm,number:V_,"number-format":g0,object:V_,slice:Vm,step:p_,string:V_,"to-boolean":oy,"to-color":oy,"to-number":oy,"to-string":oy,var:rv,within:zy};function Mm(c,[l,d,y,M]){l=l.evaluate(c),d=d.evaluate(c),y=y.evaluate(c);const N=M?M.evaluate(c):1,X=$m(l,d,y,N);if(X)throw new wg(X);return new Np(l/255*N,d/255*N,y/255*N,N)}function am(c,l){return c in l}function P_(c,l){const d=l[c];return d===void 0?null:d}function Ng(c){return{type:c}}Vg.register(_0,{error:[{kind:"error"},[im],(c,[l])=>{throw new wg(l.evaluate(c))}],typeof:[im,[el],(c,[l])=>ad(Km(l.evaluate(c)))],"to-rgba":[od(ep,4),[mm],(c,[l])=>l.evaluate(c).toArray()],rgb:[mm,[ep,ep,ep],Mm],rgba:[mm,[ep,ep,ep,ep],Mm],has:{type:Jp,overloads:[[[im],(c,[l])=>am(l.evaluate(c),c.properties())],[[im,yr],(c,[l,d])=>am(l.evaluate(c),d.evaluate(c))]]},get:{type:el,overloads:[[[im],(c,[l])=>P_(l.evaluate(c),c.properties())],[[im,yr],(c,[l,d])=>P_(l.evaluate(c),d.evaluate(c))]]},"feature-state":[el,[im],(c,[l])=>P_(l.evaluate(c),c.featureState||{})],properties:[yr,[],c=>c.properties()],"geometry-type":[im,[],c=>c.geometryType()],id:[el,[],c=>c.id()],zoom:[ep,[],c=>c.globals.zoom],pitch:[ep,[],c=>c.globals.pitch||0],"distance-from-center":[ep,[],c=>c.distanceFromCenter()],"heatmap-density":[ep,[],c=>c.globals.heatmapDensity||0],"line-progress":[ep,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[ep,[],c=>c.globals.skyRadialProgress||0],accumulated:[el,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[ep,Ng(ep),(c,l)=>{let d=0;for(const y of l)d+=y.evaluate(c);return d}],"*":[ep,Ng(ep),(c,l)=>{let d=1;for(const y of l)d*=y.evaluate(c);return d}],"-":{type:ep,overloads:[[[ep,ep],(c,[l,d])=>l.evaluate(c)-d.evaluate(c)],[[ep],(c,[l])=>-l.evaluate(c)]]},"/":[ep,[ep,ep],(c,[l,d])=>l.evaluate(c)/d.evaluate(c)],"%":[ep,[ep,ep],(c,[l,d])=>l.evaluate(c)%d.evaluate(c)],ln2:[ep,[],()=>Math.LN2],pi:[ep,[],()=>Math.PI],e:[ep,[],()=>Math.E],"^":[ep,[ep,ep],(c,[l,d])=>Math.pow(l.evaluate(c),d.evaluate(c))],sqrt:[ep,[ep],(c,[l])=>Math.sqrt(l.evaluate(c))],log10:[ep,[ep],(c,[l])=>Math.log(l.evaluate(c))/Math.LN10],ln:[ep,[ep],(c,[l])=>Math.log(l.evaluate(c))],log2:[ep,[ep],(c,[l])=>Math.log(l.evaluate(c))/Math.LN2],sin:[ep,[ep],(c,[l])=>Math.sin(l.evaluate(c))],cos:[ep,[ep],(c,[l])=>Math.cos(l.evaluate(c))],tan:[ep,[ep],(c,[l])=>Math.tan(l.evaluate(c))],asin:[ep,[ep],(c,[l])=>Math.asin(l.evaluate(c))],acos:[ep,[ep],(c,[l])=>Math.acos(l.evaluate(c))],atan:[ep,[ep],(c,[l])=>Math.atan(l.evaluate(c))],min:[ep,Ng(ep),(c,l)=>Math.min(...l.map(d=>d.evaluate(c)))],max:[ep,Ng(ep),(c,l)=>Math.max(...l.map(d=>d.evaluate(c)))],abs:[ep,[ep],(c,[l])=>Math.abs(l.evaluate(c))],round:[ep,[ep],(c,[l])=>{const d=l.evaluate(c);return d<0?-Math.round(-d):Math.round(d)}],floor:[ep,[ep],(c,[l])=>Math.floor(l.evaluate(c))],ceil:[ep,[ep],(c,[l])=>Math.ceil(l.evaluate(c))],"filter-==":[Jp,[im,el],(c,[l,d])=>c.properties()[l.value]===d.value],"filter-id-==":[Jp,[el],(c,[l])=>c.id()===l.value],"filter-type-==":[Jp,[im],(c,[l])=>c.geometryType()===l.value],"filter-<":[Jp,[im,el],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y<M}],"filter-id-<":[Jp,[el],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d<y}],"filter->":[Jp,[im,el],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y>M}],"filter-id->":[Jp,[el],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d>y}],"filter-<=":[Jp,[im,el],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y<=M}],"filter-id-<=":[Jp,[el],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d<=y}],"filter->=":[Jp,[im,el],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y>=M}],"filter-id->=":[Jp,[el],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d>=y}],"filter-has":[Jp,[el],(c,[l])=>l.value in c.properties()],"filter-has-id":[Jp,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Jp,[od(im)],(c,[l])=>l.value.indexOf(c.geometryType())>=0],"filter-id-in":[Jp,[od(el)],(c,[l])=>l.value.indexOf(c.id())>=0],"filter-in-small":[Jp,[im,od(el)],(c,[l,d])=>d.value.indexOf(c.properties()[l.value])>=0],"filter-in-large":[Jp,[im,od(el)],(c,[l,d])=>function(y,M,N,X){for(;N<=X;){const vt=N+X>>1;if(M[vt]===y)return!0;M[vt]>y?X=vt-1:N=vt+1}return!1}(c.properties()[l.value],d.value,0,d.value.length-1)],all:{type:Jp,overloads:[[[Jp,Jp],(c,[l,d])=>l.evaluate(c)&&d.evaluate(c)],[Ng(Jp),(c,l)=>{for(const d of l)if(!d.evaluate(c))return!1;return!0}]]},any:{type:Jp,overloads:[[[Jp,Jp],(c,[l,d])=>l.evaluate(c)||d.evaluate(c)],[Ng(Jp),(c,l)=>{for(const d of l)if(d.evaluate(c))return!0;return!1}]]},"!":[Jp,[Jp],(c,[l])=>!l.evaluate(c)],"is-supported-script":[Jp,[im],(c,[l])=>{const d=c.globals&&c.globals.isSupportedScript;return!d||d(l.evaluate(c))}],upcase:[im,[im],(c,[l])=>l.evaluate(c).toUpperCase()],downcase:[im,[im],(c,[l])=>l.evaluate(c).toLowerCase()],concat:[im,Ng(el),(c,l)=>l.map(d=>Xg(d.evaluate(c))).join("")],"resolved-locale":[im,[yh],(c,[l])=>l.evaluate(c).resolvedLocale()]});var W_=_0;function Dg(c){return{result:"success",value:c}}function Gm(c){return{result:"error",value:c}}function sg(c){return c["property-type"]==="data-driven"}function Jg(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function k_(c){return!!c.expression&&c.expression.interpolated}function em(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Gg(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function bv(c){return c}function Ig(c,l){const d=l.type==="color",y=c.stops&&typeof c.stops[0][0]=="object",M=y||!(y||c.property!==void 0),N=c.type||(k_(l)?"exponential":"interval");if(d&&((c=Hg({},c)).stops&&(c.stops=c.stops.map(Ui=>[Ui[0],Np.parse(Ui[1])])),c.default=Np.parse(c.default?c.default:l.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!H_[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let X,vt,Ht;if(N==="exponential")X=Hy;else if(N==="interval")X=xy;else if(N==="categorical"){X=D_,vt=Object.create(null);for(const Ui of c.stops)vt[Ui[0]]=Ui[1];Ht=typeof c.stops[0][0]}else{if(N!=="identity")throw new Error(`Unknown function type "${N}"`);X=y0}if(y){const Ui={},Fn=[];for(let ju=0;ju<c.stops.length;ju++){const Ku=c.stops[ju],lh=Ku[0].zoom;Ui[lh]===void 0&&(Ui[lh]={zoom:lh,type:c.type,property:c.property,default:c.default,stops:[]},Fn.push(lh)),Ui[lh].stops.push([Ku[0].value,Ku[1]])}const Js=[];for(const ju of Fn)Js.push([Ui[ju].zoom,Ig(Ui[ju],l)]);const nl={name:"linear"};return{kind:"composite",interpolationType:nl,interpolationFactor:Qg.interpolationFactor.bind(void 0,nl),zoomStops:Js.map(ju=>ju[0]),evaluate:({zoom:ju},Ku)=>Hy({stops:Js,base:c.base},l,ju).evaluate(ju,Ku)}}if(M){const Ui=N==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Ui,interpolationFactor:Qg.interpolationFactor.bind(void 0,Ui),zoomStops:c.stops.map(Fn=>Fn[0]),evaluate:({zoom:Fn})=>X(c,l,Fn,vt,Ht)}}return{kind:"source",evaluate(Ui,Fn){const Js=Fn&&Fn.properties?Fn.properties[c.property]:void 0;return Js===void 0?Cm(c.default,l.default):X(c,l,Js,vt,Ht)}}}function Cm(c,l,d){return c!==void 0?c:l!==void 0?l:d!==void 0?d:void 0}function D_(c,l,d,y,M){return Cm(typeof d===M?y[d]:void 0,c.default,l.default)}function xy(c,l,d){if(em(d)!=="number")return Cm(c.default,l.default);const y=c.stops.length;if(y===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[y-1][0])return c.stops[y-1][1];const M=Z_(c.stops.map(N=>N[0]),d);return c.stops[M][1]}function Hy(c,l,d){const y=c.base!==void 0?c.base:1;if(em(d)!=="number")return Cm(c.default,l.default);const M=c.stops.length;if(M===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[M-1][0])return c.stops[M-1][1];const N=Z_(c.stops.map(Fn=>Fn[0]),d),X=function(Fn,Js,nl,ju){const Ku=ju-nl,lh=Fn-nl;return Ku===0?0:Js===1?lh/Ku:(Math.pow(Js,lh)-1)/(Math.pow(Js,Ku)-1)}(d,y,c.stops[N][0],c.stops[N+1][0]),vt=c.stops[N][1],Ht=c.stops[N+1][1];let Ui=C_[l.type]||bv;if(c.colorSpace&&c.colorSpace!=="rgb"){const Fn=H_[c.colorSpace];Ui=(Js,nl)=>Fn.reverse(Fn.interpolate(Fn.forward(Js),Fn.forward(nl),X))}return typeof vt.evaluate=="function"?{evaluate(...Fn){const Js=vt.evaluate.apply(void 0,Fn),nl=Ht.evaluate.apply(void 0,Fn);if(Js!==void 0&&nl!==void 0)return Ui(Js,nl,X)}}:Ui(vt,Ht,X)}function y0(c,l,d){return l.type==="color"?d=Np.parse(d):l.type==="formatted"?d=bg.fromString(d.toString()):l.type==="resolvedImage"?d=kg.fromString(d.toString()):em(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0),Cm(d,c.default,l.default)}class Y_{constructor(l,d){this.expression=l,this._warningHistory={},this._evaluator=new $y,this._defaultValue=d?function(y){return y.type==="color"&&(Gg(y.default)||Array.isArray(y.default))?new Np(0,0,0,0):y.type==="color"?Np.parse(y.default)||null:y.default===void 0?null:y.default}(d):null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,y,M,N,X,vt,Ht){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=y,this._evaluator.canonical=M||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=X,this._evaluator.featureTileCoord=vt||null,this._evaluator.featureDistanceData=Ht||null,this.expression.evaluate(this._evaluator)}evaluate(l,d,y,M,N,X,vt,Ht){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=y||null,this._evaluator.canonical=M||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=X||null,this._evaluator.featureTileCoord=vt||null,this._evaluator.featureDistanceData=Ht||null;try{const Ui=this.expression.evaluate(this._evaluator);if(Ui==null||typeof Ui=="number"&&Ui!=Ui)return this._defaultValue;if(this._enumValues&&!(Ui in this._enumValues))throw new wg(`Expected value to be one of ${Object.keys(this._enumValues).map(Fn=>JSON.stringify(Fn)).join(", ")}, but found ${JSON.stringify(Ui)} instead.`);return Ui}catch(Ui){return this._warningHistory[Ui.message]||(this._warningHistory[Ui.message]=!0,typeof console<"u"&&console.warn(Ui.message)),this._defaultValue}}}function Xy(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in W_}function e_(c,l){const d=new h0(W_,[],l?function(M){const N={color:mm,string:im,number:ep,enum:im,boolean:Jp,formatted:Uh,resolvedImage:nd};return M.type==="array"?od(N[M.value]||el,M.length):N[M.type]}(l):void 0),y=d.parse(c,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?Dg(new Y_(y,l)):Gm(d.errors)}class B0{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!d_(d.expression)}evaluateWithoutErrorHandling(l,d,y,M,N,X){return this._styleExpression.evaluateWithoutErrorHandling(l,d,y,M,N,X)}evaluate(l,d,y,M,N,X){return this._styleExpression.evaluate(l,d,y,M,N,X)}}class kp{constructor(l,d,y,M){this.kind=l,this.zoomStops=y,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!d_(d.expression),this.interpolationType=M}evaluateWithoutErrorHandling(l,d,y,M,N,X){return this._styleExpression.evaluateWithoutErrorHandling(l,d,y,M,N,X)}evaluate(l,d,y,M,N,X){return this._styleExpression.evaluate(l,d,y,M,N,X)}interpolationFactor(l,d,y){return this.interpolationType?Qg.interpolationFactor(this.interpolationType,l,d,y):0}}function Up(c,l){if((c=e_(c,l)).result==="error")return c;const d=c.value.expression,y=q_(d);if(!y&&!sg(l))return Gm([new Pg("","data expressions not supported")]);const M=c0(d,["zoom","pitch","distance-from-center"]);if(!M&&!Jg(l))return Gm([new Pg("","zoom expressions not supported")]);const N=N0(d);return N||M?N instanceof Pg?Gm([N]):N instanceof Qg&&!k_(l)?Gm([new Pg("",'"interpolate" expressions cannot be used with this property')]):Dg(N?new kp(y?"camera":"composite",c.value,N.labels,N instanceof Qg?N.interpolation:void 0):new B0(y?"constant":"source",c.value)):Gm([new Pg("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class by{constructor(l,d){this._parameters=l,this._specification=d,Hg(this,Ig(this._parameters,this._specification))}static deserialize(l){return new by(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function N0(c){let l=null;if(c instanceof M_)l=N0(c.result);else if(c instanceof nv){for(const d of c.args)if(l=N0(d),l)break}else(c instanceof p_||c instanceof Qg)&&c.input instanceof Vg&&c.input.name==="zoom"&&(l=c);return l instanceof Pg||c.eachChild(d=>{const y=N0(d);y instanceof Pg?l=y:!l&&y?l=new Pg("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&y&&l!==y&&(l=new Pg("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}class pp{constructor(l,d,y,M){this.message=(l?`${l}: `:"")+y,M&&(this.identifier=M),d!=null&&d.__line__&&(this.line=d.__line__)}}function tg(c){const l=c.key,d=c.value,y=c.valueSpec||{},M=c.objectElementValidators||{},N=c.style,X=c.styleSpec;let vt=[];const Ht=em(d);if(Ht!=="object")return[new pp(l,d,`object expected, ${Ht} found`)];for(const Ui in d){const Fn=Ui.split(".")[0],Js=y[Fn]||y["*"];let nl;M[Fn]?nl=M[Fn]:y[Fn]?nl=zg:M["*"]?nl=M["*"]:y["*"]&&(nl=zg),nl?vt=vt.concat(nl({key:(l&&`${l}.`)+Ui,value:d[Ui],valueSpec:Js,style:N,styleSpec:X,object:d,objectKey:Ui},d)):vt.push(new pp(l,d[Ui],`unknown property "${Ui}"`))}for(const Ui in y)M[Ui]||y[Ui].required&&y[Ui].default===void 0&&d[Ui]===void 0&&vt.push(new pp(l,d,`missing required property "${Ui}"`));return vt}function wv(c){const l=c.value,d=c.valueSpec,y=c.style,M=c.styleSpec,N=c.key,X=c.arrayElementValidator||zg;if(em(l)!=="array")return[new pp(N,l,`array expected, ${em(l)} found`)];if(d.length&&l.length!==d.length)return[new pp(N,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new pp(N,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let vt={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};M.$version<7&&(vt.function=d.function),em(d.value)==="object"&&(vt=d.value);let Ht=[];for(let Ui=0;Ui<l.length;Ui++)Ht=Ht.concat(X({array:l,arrayIndex:Ui,value:l[Ui],valueSpec:vt,style:y,styleSpec:M,key:`${N}[${Ui}]`}));return Ht}function L_(c){const l=c.key,d=c.value,y=c.valueSpec;let M=em(d);if(M==="number"&&d!=d&&(M="NaN"),M!=="number")return[new pp(l,d,`number expected, ${M} found`)];if("minimum"in y){let N=y.minimum;if(em(y.minimum)==="array"&&(N=y.minimum[c.arrayIndex]),d<N)return[new pp(l,d,`${d} is less than the minimum value ${N}`)]}if("maximum"in y){let N=y.maximum;if(em(y.maximum)==="array"&&(N=y.maximum[c.arrayIndex]),d>N)return[new pp(l,d,`${d} is greater than the maximum value ${N}`)]}return[]}function Ev(c){const l=c.valueSpec,d=Fm(c.value.type);let y,M,N,X={};const vt=d!=="categorical"&&c.value.property===void 0,Ht=!vt,Ui=em(c.value.stops)==="array"&&em(c.value.stops[0])==="array"&&em(c.value.stops[0][0])==="object",Fn=tg({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ju){if(d==="identity")return[new pp(ju.key,ju.value,'identity function may not have a "stops" property')];let Ku=[];const lh=ju.value;return Ku=Ku.concat(wv({key:ju.key,value:lh,valueSpec:ju.valueSpec,style:ju.style,styleSpec:ju.styleSpec,arrayElementValidator:Js})),em(lh)==="array"&&lh.length===0&&Ku.push(new pp(ju.key,lh,"array must have at least one stop")),Ku},default:function(ju){return zg({key:ju.key,value:ju.value,valueSpec:l,style:ju.style,styleSpec:ju.styleSpec})}}});return d==="identity"&&vt&&Fn.push(new pp(c.key,c.value,'missing required property "property"')),d==="identity"||c.value.stops||Fn.push(new pp(c.key,c.value,'missing required property "stops"')),d==="exponential"&&c.valueSpec.expression&&!k_(c.valueSpec)&&Fn.push(new pp(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(Ht&&!sg(c.valueSpec)?Fn.push(new pp(c.key,c.value,"property functions not supported")):vt&&!Jg(c.valueSpec)&&Fn.push(new pp(c.key,c.value,"zoom functions not supported"))),d!=="categorical"&&!Ui||c.value.property!==void 0||Fn.push(new pp(c.key,c.value,'"property" property is required')),Fn;function Js(ju){let Ku=[];const lh=ju.value,Eh=ju.key;if(em(lh)!=="array")return[new pp(Eh,lh,`array expected, ${em(lh)} found`)];if(lh.length!==2)return[new pp(Eh,lh,`array length 2 expected, length ${lh.length} found`)];if(Ui){if(em(lh[0])!=="object")return[new pp(Eh,lh,`object expected, ${em(lh[0])} found`)];if(lh[0].zoom===void 0)return[new pp(Eh,lh,"object stop key must have zoom")];if(lh[0].value===void 0)return[new pp(Eh,lh,"object stop key must have value")];const Bh=Fm(lh[0].zoom);if(typeof Bh!="number")return[new pp(Eh,lh[0].zoom,"stop zoom values must be numbers")];if(N&&N>Bh)return[new pp(Eh,lh[0].zoom,"stop zoom values must appear in ascending order")];Bh!==N&&(N=Bh,M=void 0,X={}),Ku=Ku.concat(tg({key:`${Eh}[0]`,value:lh[0],valueSpec:{zoom:{}},style:ju.style,styleSpec:ju.styleSpec,objectElementValidators:{zoom:L_,value:nl}}))}else Ku=Ku.concat(nl({key:`${Eh}[0]`,value:lh[0],valueSpec:{},style:ju.style,styleSpec:ju.styleSpec},lh));return Xy(I_(lh[1]))?Ku.concat([new pp(`${Eh}[1]`,lh[1],"expressions are not allowed in function stops.")]):Ku.concat(zg({key:`${Eh}[1]`,value:lh[1],valueSpec:l,style:ju.style,styleSpec:ju.styleSpec}))}function nl(ju,Ku){const lh=em(ju.value),Eh=Fm(ju.value),Bh=ju.value!==null?ju.value:Ku;if(y){if(lh!==y)return[new pp(ju.key,Bh,`${lh} stop domain type must match previous stop domain type ${y}`)]}else y=lh;if(lh!=="number"&&lh!=="string"&&lh!=="boolean"&&typeof Eh!="number"&&typeof Eh!="string"&&typeof Eh!="boolean")return[new pp(ju.key,Bh,"stop domain value must be a number, string, or boolean")];if(lh!=="number"&&d!=="categorical"){let Yh=`number expected, ${lh} found`;return sg(l)&&d===void 0&&(Yh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pp(ju.key,Bh,Yh)]}return d!=="categorical"||lh!=="number"||typeof Eh=="number"&&isFinite(Eh)&&Math.floor(Eh)===Eh?d!=="categorical"&&lh==="number"&&typeof Eh=="number"&&typeof M=="number"&&M!==void 0&&Eh<M?[new pp(ju.key,Bh,"stop domain values must appear in ascending order")]:(M=Eh,d==="categorical"&&Eh in X?[new pp(ju.key,Bh,"stop domain values must be unique")]:(X[Eh]=!0,[])):[new pp(ju.key,Bh,`integer expected, found ${String(Eh)}`)]}}function Wy(c){const l=(c.expressionContext==="property"?Up:e_)(I_(c.value),c.valueSpec);if(l.result==="error")return l.value.map(y=>new pp(`${c.key}${y.key}`,c.value,y.message));const d=l.value.expression||l.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!d.outputDefined())return[new pp(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!d_(d))return[new pp(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return pg(d,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!c0(d,["zoom","feature-state"]))return[new pp(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!q_(d))return[new pp(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pg(c,l){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const M of l.valueSpec.expression.parameters)d.delete(M);if(d.size===0)return[];const y=[];return c instanceof Vg&&d.has(c.name)?[new pp(l.key,l.value,`["${c.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(c.eachChild(M=>{y.push(...pg(M,l))}),y)}function mg(c){const l=c.key,d=c.value,y=c.valueSpec,M=[];return Array.isArray(y.values)?y.values.indexOf(Fm(d))===-1&&M.push(new pp(l,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf(Fm(d))===-1&&M.push(new pp(l,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),M}function zv(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const l of c.slice(1))if(!zv(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function v0(c,l="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zv(c)||(c=av(c));const d=c;let y=!0;try{y=function(Ui){if(!Lg(Ui))return Ui;let Fn=I_(Ui);return wy(Fn),Fn=x0(Fn),Fn}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}const M=Pd[`filter_${l}`],N=e_(y,M);let X=null;if(N.result==="error")throw new Error(N.value.map(Ui=>`${Ui.key}: ${Ui.message}`).join(", "));X=(Ui,Fn,Js)=>N.value.evaluate(Ui,Fn,{},Js);let vt=null,Ht=null;if(y!==d){const Ui=e_(d,M);if(Ui.result==="error")throw new Error(Ui.value.map(Fn=>`${Fn.key}: ${Fn.message}`).join(", "));vt=(Fn,Js,nl,ju,Ku)=>Ui.value.evaluate(Fn,Js,{},nl,void 0,void 0,ju,Ku),Ht=!q_(Ui.value.expression)}return{filter:X,dynamicFilter:vt||void 0,needGeometry:Fv(y),needFeature:!!Ht}}function x0(c){if(!Array.isArray(c))return c;const l=function(d){if(b0.has(d[0])){for(let y=1;y<d.length;y++)if(Lg(d[y]))return!0}return d}(c);return l===!0?l:l.map(d=>x0(d))}function wy(c){let l=!1;const d=[];if(c[0]==="case"){for(let y=1;y<c.length-1;y+=2)l=l||Lg(c[y]),d.push(c[y+1]);d.push(c[c.length-1])}else if(c[0]==="match"){l=l||Lg(c[1]);for(let y=2;y<c.length-1;y+=2)d.push(c[y+1]);d.push(c[c.length-1])}else if(c[0]==="step"){l=l||Lg(c[1]);for(let y=1;y<c.length-1;y+=2)d.push(c[y+1])}l&&(c.length=0,c.push("any",...d));for(let y=1;y<c.length;y++)wy(c[y])}function Lg(c){if(!Array.isArray(c))return!1;if((l=c[0])==="pitch"||l==="distance-from-center")return!0;var l;for(let d=1;d<c.length;d++)if(Lg(c[d]))return!0;return!1}const b0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Tv(c,l){return c<l?-1:c>l?1:0}function Fv(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let l=1;l<c.length;l++)if(Fv(c[l]))return!0;return!1}function av(c){if(!c)return!0;const l=c[0];return c.length<=1?l!=="any":l==="=="?sv(c[1],c[2],"=="):l==="!="?w0(sv(c[1],c[2],"==")):l==="<"||l===">"||l==="<="||l===">="?sv(c[1],c[2],l):l==="any"?(d=c.slice(1),["any"].concat(d.map(av))):l==="all"?["all"].concat(c.slice(1).map(av)):l==="none"?["all"].concat(c.slice(1).map(av).map(w0)):l==="in"?z0(c[1],c.slice(2)):l==="!in"?w0(z0(c[1],c.slice(2))):l==="has"?Uv(c[1]):l==="!has"?w0(Uv(c[1])):l!=="within"||c;var d}function sv(c,l,d){switch(c){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,c,l]}}function z0(c,l){if(l.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",c,["literal",l.sort(Tv)]]:["filter-in-small",c,["literal",l]]}}function Uv(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function w0(c){return["!",c]}function Sv(c){return zv(I_(c.value))?Wy(Hg({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Vv(c)}function Vv(c){const l=c.value,d=c.key;if(em(l)!=="array")return[new pp(d,l,`array expected, ${em(l)} found`)];const y=c.styleSpec;let M,N=[];if(l.length<1)return[new pp(d,l,"filter array must have at least 1 element")];switch(N=N.concat(mg({key:`${d}[0]`,value:l[0],valueSpec:y.filter_operator,style:c.style,styleSpec:c.styleSpec})),Fm(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Fm(l[1])==="$type"&&N.push(new pp(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&N.push(new pp(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(M=em(l[1]),M!=="string"&&N.push(new pp(`${d}[1]`,l[1],`string expected, ${M} found`)));for(let X=2;X<l.length;X++)M=em(l[X]),Fm(l[1])==="$type"?N=N.concat(mg({key:`${d}[${X}]`,value:l[X],valueSpec:y.geometry_type,style:c.style,styleSpec:c.styleSpec})):M!=="string"&&M!=="number"&&M!=="boolean"&&N.push(new pp(`${d}[${X}]`,l[X],`string, number, or boolean expected, ${M} found`));break;case"any":case"all":case"none":for(let X=1;X<l.length;X++)N=N.concat(Vv({key:`${d}[${X}]`,value:l[X],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":M=em(l[1]),l.length!==2?N.push(new pp(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):M!=="string"&&N.push(new pp(`${d}[1]`,l[1],`string expected, ${M} found`));break;case"within":M=em(l[1]),l.length!==2?N.push(new pp(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):M!=="object"&&N.push(new pp(`${d}[1]`,l[1],`object expected, ${M} found`))}return N}function F0(c,l){const d=c.key,y=c.style,M=c.styleSpec,N=c.value,X=c.objectKey,vt=M[`${l}_${c.layerType}`];if(!vt)return[];const Ht=X.match(/^(.*)-transition$/);if(l==="paint"&&Ht&&vt[Ht[1]]&&vt[Ht[1]].transition)return zg({key:d,value:N,valueSpec:M.transition,style:y,styleSpec:M});const Ui=c.valueSpec||vt[X];if(!Ui)return[new pp(d,N,`unknown property "${X}"`)];let Fn;if(em(N)==="string"&&sg(Ui)&&!Ui.tokens&&(Fn=/^{([^}]+)}$/.exec(N))){const nl=`\`{ "type": "identity", "property": ${Fn?JSON.stringify(Fn[1]):'"_"'} }\``;return[new pp(d,N,`"${X}" does not support interpolation syntax
Use an identity property function instead: ${nl}.`)]}const Js=[];return c.layerType==="symbol"&&(X==="text-field"&&y&&!y.glyphs&&Js.push(new pp(d,N,'use of "text-field" requires a style "glyphs" property')),X==="text-font"&&Gg(I_(N))&&Fm(N.type)==="identity"&&Js.push(new pp(d,N,'"text-font" does not support identity functions'))),Js.concat(zg({key:c.key,value:N,valueSpec:Ui,style:y,styleSpec:M,expressionContext:"property",propertyType:l,propertyKey:X}))}function Gv(c){return F0(c,"paint")}function Ey(c){return F0(c,"layout")}function lv(c){let l=[];const d=c.value,y=c.key,M=c.style,N=c.styleSpec;d.type||d.ref||l.push(new pp(y,d,'either "type" or "ref" is required'));let X=Fm(d.type);const vt=Fm(d.ref);if(d.id){const Ht=Fm(d.id);for(let Ui=0;Ui<c.arrayIndex;Ui++){const Fn=M.layers[Ui];Fm(Fn.id)===Ht&&l.push(new pp(y,d.id,`duplicate layer id "${d.id}", previously used at line ${Fn.id.__line__}`))}}if("ref"in d){let Ht;["type","source","source-layer","filter","layout"].forEach(Ui=>{Ui in d&&l.push(new pp(y,d[Ui],`"${Ui}" is prohibited for ref layers`))}),M.layers.forEach(Ui=>{Fm(Ui.id)===vt&&(Ht=Ui)}),Ht?Ht.ref?l.push(new pp(y,d.ref,"ref cannot reference another ref layer")):X=Fm(Ht.type):typeof vt=="string"&&l.push(new pp(y,d.ref,`ref layer "${vt}" not found`))}else if(X!=="background"&&X!=="sky")if(d.source){const Ht=M.sources&&M.sources[d.source],Ui=Ht&&Fm(Ht.type);Ht?Ui==="vector"&&X==="raster"?l.push(new pp(y,d.source,`layer "${d.id}" requires a raster source`)):Ui==="raster"&&X!=="raster"?l.push(new pp(y,d.source,`layer "${d.id}" requires a vector source`)):Ui!=="vector"||d["source-layer"]?Ui==="raster-dem"&&X!=="hillshade"?l.push(new pp(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):X!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||Ui==="geojson"&&Ht.lineMetrics||l.push(new pp(y,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new pp(y,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new pp(y,d.source,`source "${d.source}" not found`))}else l.push(new pp(y,d,'missing required property "source"'));return l=l.concat(tg({key:y,value:d,valueSpec:N.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zg({key:`${y}.type`,value:d.type,valueSpec:N.layer.type,style:c.style,styleSpec:c.styleSpec,object:d,objectKey:"type"}),filter:Ht=>Sv(Hg({layerType:X},Ht)),layout:Ht=>tg({layer:d,key:Ht.key,value:Ht.value,valueSpec:{},style:Ht.style,styleSpec:Ht.styleSpec,objectElementValidators:{"*":Ui=>Ey(Hg({layerType:X},Ui))}}),paint:Ht=>tg({layer:d,key:Ht.key,value:Ht.value,valueSpec:{},style:Ht.style,styleSpec:Ht.styleSpec,objectElementValidators:{"*":Ui=>Gv(Hg({layerType:X},Ui))}})}})),l}function E0(c){const l=c.value,d=c.key,y=em(l);return y!=="string"?[new pp(d,l,`string expected, ${y} found`)]:[]}const cv={promoteId:function({key:c,value:l}){if(em(l)==="string")return E0({key:c,value:l});{const d=[];for(const y in l)d.push(...E0({key:`${c}.${y}`,value:l[y]}));return d}}};function T0(c){const l=c.value,d=c.key,y=c.styleSpec,M=c.style;if(!l.type)return[new pp(d,l,'"type" is required')];const N=Fm(l.type);let X;switch(N){case"vector":case"raster":case"raster-dem":return X=tg({key:d,value:l,valueSpec:y[`source_${N.replace("-","_")}`],style:c.style,styleSpec:y,objectElementValidators:cv}),X;case"geojson":if(X=tg({key:d,value:l,valueSpec:y.source_geojson,style:M,styleSpec:y,objectElementValidators:cv}),l.cluster)for(const vt in l.clusterProperties){const[Ht,Ui]=l.clusterProperties[vt],Fn=typeof Ht=="string"?[Ht,["accumulated"],["get",vt]]:Ht;X.push(...Wy({key:`${d}.${vt}.map`,value:Ui,expressionContext:"cluster-map"})),X.push(...Wy({key:`${d}.${vt}.reduce`,value:Fn,expressionContext:"cluster-reduce"}))}return X;case"video":return tg({key:d,value:l,valueSpec:y.source_video,style:M,styleSpec:y});case"image":return tg({key:d,value:l,valueSpec:y.source_image,style:M,styleSpec:y});case"canvas":return[new pp(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mg({key:`${d}.type`,value:l.type,valueSpec:{values:jv(y)},style:M,styleSpec:y})}}function jv(c){return c.source.reduce((l,d)=>{const y=c[d];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function c1(c){const l=c.value,d=c.styleSpec,y=d.light,M=c.style;let N=[];const X=em(l);if(l===void 0)return N;if(X!=="object")return N=N.concat([new pp("light",l,`object expected, ${X} found`)]),N;for(const vt in l){const Ht=vt.match(/^(.*)-transition$/);N=N.concat(Ht&&y[Ht[1]]&&y[Ht[1]].transition?zg({key:vt,value:l[vt],valueSpec:d.transition,style:M,styleSpec:d}):y[vt]?zg({key:vt,value:l[vt],valueSpec:y[vt],style:M,styleSpec:d}):[new pp(vt,l[vt],`unknown property "${vt}"`)])}return N}function Iv(c){const l=c.value,d=c.key,y=c.style,M=c.styleSpec,N=M.terrain;let X=[];const vt=em(l);if(l===void 0)return X;if(vt!=="object")return X=X.concat([new pp("terrain",l,`object expected, ${vt} found`)]),X;for(const Ht in l){const Ui=Ht.match(/^(.*)-transition$/);X=X.concat(Ui&&N[Ui[1]]&&N[Ui[1]].transition?zg({key:Ht,value:l[Ht],valueSpec:M.transition,style:y,styleSpec:M}):N[Ht]?zg({key:Ht,value:l[Ht],valueSpec:N[Ht],style:y,styleSpec:M}):[new pp(Ht,l[Ht],`unknown property "${Ht}"`)])}if(l.source){const Ht=y.sources&&y.sources[l.source],Ui=Ht&&Fm(Ht.type);Ht?Ui!=="raster-dem"&&X.push(new pp(d,l.source,`terrain cannot be used with a source of type ${String(Ui)}, it only be used with a "raster-dem" source type`)):X.push(new pp(d,l.source,`source "${l.source}" not found`))}else X.push(new pp(d,l,'terrain is missing required property "source"'));return X}function Cv(c){const l=c.value,d=c.style,y=c.styleSpec,M=y.fog;let N=[];const X=em(l);if(l===void 0)return N;if(X!=="object")return N=N.concat([new pp("fog",l,`object expected, ${X} found`)]),N;for(const vt in l){const Ht=vt.match(/^(.*)-transition$/);N=N.concat(Ht&&M[Ht[1]]&&M[Ht[1]].transition?zg({key:vt,value:l[vt],valueSpec:y.transition,style:d,styleSpec:y}):M[vt]?zg({key:vt,value:l[vt],valueSpec:M[vt],style:d,styleSpec:y}):[new pp(vt,l[vt],`unknown property "${vt}"`)])}return N}const uv={"*":()=>[],array:wv,boolean:function(c){const l=c.value,d=c.key,y=em(l);return y!=="boolean"?[new pp(d,l,`boolean expected, ${y} found`)]:[]},number:L_,color:function(c){const l=c.key,d=c.value,y=em(d);return y!=="string"?[new pp(l,d,`color expected, ${y} found`)]:lp(d)===null?[new pp(l,d,`color expected, "${d}" found`)]:[]},enum:mg,filter:Sv,function:Ev,layer:lv,object:tg,source:T0,light:c1,terrain:Iv,fog:Cv,string:E0,formatted:function(c){return E0(c).length===0?[]:Wy(c)},resolvedImage:function(c){return E0(c).length===0?[]:Wy(c)},projection:function(c){const l=c.value,d=c.styleSpec,y=d.projection,M=c.style;let N=[];const X=em(l);if(X==="object")for(const vt in l)N=N.concat(zg({key:vt,value:l[vt],valueSpec:y[vt],style:M,styleSpec:d}));else X!=="string"&&(N=N.concat([new pp("projection",l,`object or string expected, ${X} found`)]));return N}};function zg(c){const l=c.value,d=c.valueSpec,y=c.styleSpec;return d.expression&&Gg(Fm(l))?Ev(c):d.expression&&Xy(I_(l))?Wy(c):d.type&&uv[d.type]?uv[d.type](c):tg(Hg({},c,{valueSpec:d.type?y[d.type]:d}))}function R1(c){const l=c.value,d=c.key,y=E0(c);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new pp(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new pp(d,l,'"glyphs" url must include a "{range}" token'))),y}function S0(c,l=Pd){return Ty(zg({key:"",value:c,valueSpec:l.$root,styleSpec:l,style:c,objectElementValidators:{glyphs:R1,"*":()=>[]}}))}const Mv=c=>Ty(Gv(c)),U0=c=>Ty(Ey(c));function Ty(c){return c.slice().sort((l,d)=>l.line&&d.line?l.line-d.line:0)}function qv(c,l){let d=!1;if(l&&l.length)for(const y of l)c.fire(new Vp(new Error(y.message))),d=!0;return d}var Sy=Iy;function Iy(c,l,d){var y=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var M=new Int32Array(this.arrayBuffer);c=M[0],this.d=(l=M[1])+2*(d=M[2]);for(var N=0;N<this.d*this.d;N++){var X=M[3+N],vt=M[3+N+1];y.push(X===vt?null:M.subarray(X,vt))}var Ht=M[3+y.length+1];this.keys=M.subarray(M[3+y.length],Ht),this.bboxes=M.subarray(Ht),this.insert=this._insertReadonly}else{this.d=l+2*d;for(var Ui=0;Ui<this.d*this.d;Ui++)y.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=c,this.padding=d,this.scale=l/c,this.uid=0;var Fn=d/l*c;this.min=-Fn,this.max=c+Fn}Iy.prototype.insert=function(c,l,d,y,M){this._forEachCell(l,d,y,M,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(M)},Iy.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Iy.prototype._insertCell=function(c,l,d,y,M,N){this.cells[M].push(N)},Iy.prototype.query=function(c,l,d,y,M){var N=this.min,X=this.max;if(c<=N&&l<=N&&X<=d&&X<=y&&!M)return Array.prototype.slice.call(this.keys);var vt=[];return this._forEachCell(c,l,d,y,this._queryCell,vt,{},M),vt},Iy.prototype._queryCell=function(c,l,d,y,M,N,X,vt){var Ht=this.cells[M];if(Ht!==null)for(var Ui=this.keys,Fn=this.bboxes,Js=0;Js<Ht.length;Js++){var nl=Ht[Js];if(X[nl]===void 0){var ju=4*nl;(vt?vt(Fn[ju+0],Fn[ju+1],Fn[ju+2],Fn[ju+3]):c<=Fn[ju+2]&&l<=Fn[ju+3]&&d>=Fn[ju+0]&&y>=Fn[ju+1])?(X[nl]=!0,N.push(Ui[nl])):X[nl]=!1}}},Iy.prototype._forEachCell=function(c,l,d,y,M,N,X,vt){for(var Ht=this._convertToCellCoord(c),Ui=this._convertToCellCoord(l),Fn=this._convertToCellCoord(d),Js=this._convertToCellCoord(y),nl=Ht;nl<=Fn;nl++)for(var ju=Ui;ju<=Js;ju++){var Ku=this.d*ju+nl;if((!vt||vt(this._convertFromCellCoord(nl),this._convertFromCellCoord(ju),this._convertFromCellCoord(nl+1),this._convertFromCellCoord(ju+1)))&&M.call(this,c,l,d,y,Ku,N,X,vt))return}},Iy.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},Iy.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},Iy.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,l=3+this.cells.length+1+1,d=0,y=0;y<this.cells.length;y++)d+=this.cells[y].length;var M=new Int32Array(l+d+this.keys.length+this.bboxes.length);M[0]=this.extent,M[1]=this.n,M[2]=this.padding;for(var N=l,X=0;X<c.length;X++){var vt=c[X];M[3+X]=N,M.set(vt,N),N+=vt.length}return M[3+c.length]=N,M.set(this.keys,N),M[3+c.length+1]=N+=this.keys.length,M.set(this.bboxes,N),N+=this.bboxes.length,M.buffer};const Zv={};function Ip(c,l,d={}){Object.defineProperty(c,"_classRegistryKey",{value:l,writeable:!1}),Zv[l]={klass:c,omit:d.omit||[]}}Ip(Object,"Object"),Sy.serialize=function(c,l){const d=c.toArrayBuffer();return l&&l.push(d),{buffer:d}},Sy.deserialize=function(c){return new Sy(c.buffer)},Object.defineProperty(Sy,"name",{value:"Grid"}),Ip(Sy,"Grid"),Ip(Np,"Color"),Ip(Error,"Error"),Ip(Mp,"AJAXError"),Ip(kg,"ResolvedImage"),Ip(by,"StylePropertyFunction"),Ip(Y_,"StyleExpression",{omit:["_evaluator"]}),Ip(kp,"ZoomDependentExpression"),Ip(B0,"ZoomConstantExpression"),Ip(Vg,"CompoundExpression",{omit:["_evaluate"]});for(const c in W_)Zv[W_[c]._classRegistryKey]||Ip(W_[c],`Expression${c}`);function O1(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function K_(c){return x.ImageBitmap&&c instanceof x.ImageBitmap}function he(c,l){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(O1(c)||K_(c))return l&&l.push(c),c;if(ArrayBuffer.isView(c)){const d=c;return l&&l.push(d.buffer),d}if(c instanceof x.ImageData)return l&&l.push(c.data.buffer),c;if(Array.isArray(c)){const d=[];for(const y of c)d.push(he(y,l));return d}if(typeof c=="object"){const d=c.constructor,y=d._classRegistryKey;if(!y)throw new Error(`can't serialize object of unregistered class ${y}`);const M=d.serialize?d.serialize(c,l):{};if(!d.serialize){for(const N in c)c.hasOwnProperty(N)&&(Zv[y].omit.indexOf(N)>=0||(M[N]=he(c[N],l)));c instanceof Error&&(M.message=c.message)}if(M.$name)throw new Error("$name property is reserved for worker serialization logic.");return y!=="Object"&&(M.$name=y),M}throw new Error("can't serialize object of type "+typeof c)}function g(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||O1(c)||K_(c)||ArrayBuffer.isView(c)||c instanceof x.ImageData)return c;if(Array.isArray(c))return c.map(g);if(typeof c=="object"){const l=c.$name||"Object",{klass:d}=Zv[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(c);const y=Object.create(d.prototype);for(const M of Object.keys(c))M!=="$name"&&(y[M]=g(c[M]));return y}throw new Error("can't deserialize object of type "+typeof c)}const A=c=>c>=1536&&c<=1791,q=c=>c>=1872&&c<=1919,nt=c=>c>=2208&&c<=2303,Ft=c=>c>=11904&&c<=12031,Xr=c=>c>=12032&&c<=12255,ls=c=>c>=12272&&c<=12287,Zs=c=>c>=12288&&c<=12351,ol=c=>c>=12352&&c<=12447,rh=c=>c>=12448&&c<=12543,th=c=>c>=12544&&c<=12591,ph=c=>c>=12704&&c<=12735,Dh=c=>c>=12736&&c<=12783,$h=c=>c>=12784&&c<=12799,Mh=c=>c>=12800&&c<=13055,Kh=c=>c>=13056&&c<=13311,fd=c=>c>=13312&&c<=19903,cd=c=>c>=19968&&c<=40959,jh=c=>c>=40960&&c<=42127,Td=c=>c>=42128&&c<=42191,Vd=c=>c>=44032&&c<=55215,Wd=c=>c>=63744&&c<=64255,Mf=c=>c>=64336&&c<=65023,Of=c=>c>=65040&&c<=65055,L=c=>c>=65072&&c<=65103,u=c=>c>=65104&&c<=65135,E=c=>c>=65136&&c<=65279,B=c=>c>=65280&&c<=65519;function _e(c){for(const l of c)if(qr(l.charCodeAt(0)))return!0;return!1}function St(c){for(const l of c)if(!mr(l.charCodeAt(0)))return!1;return!0}function mr(c){return!(A(c)||q(c)||nt(c)||Mf(c)||E(c))}function qr(c){return!(c!==746&&c!==747&&(c<4352||!(ph(c)||th(c)||L(c)&&!(c>=65097&&c<=65103)||Wd(c)||Kh(c)||Ft(c)||Dh(c)||!(!Zs(c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||fd(c)||cd(c)||Mh(c)||(l=>l>=12592&&l<=12687)(c)||(l=>l>=43360&&l<=43391)(c)||(l=>l>=55216&&l<=55295)(c)||(l=>l>=4352&&l<=4607)(c)||Vd(c)||ol(c)||ls(c)||(l=>l>=12688&&l<=12703)(c)||Xr(c)||$h(c)||rh(c)&&c!==12540||!(!B(c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!u(c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||(l=>l>=5120&&l<=5759)(c)||(l=>l>=6320&&l<=6399)(c)||Of(c)||(l=>l>=19904&&l<=19967)(c)||jh(c)||Td(c))))}function ss(c){return!(qr(c)||function(l){return!!((d=>d>=128&&d<=255)(l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||(d=>d>=8192&&d<=8303)(l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||(d=>d>=8448&&d<=8527)(l)||(d=>d>=8528&&d<=8591)(l)||(d=>d>=8960&&d<=9215)(l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||(d=>d>=9216&&d<=9279)(l)&&l!==9251||(d=>d>=9280&&d<=9311)(l)||(d=>d>=9312&&d<=9471)(l)||(d=>d>=9632&&d<=9727)(l)||(d=>d>=9728&&d<=9983)(l)&&!(l>=9754&&l<=9759)||(d=>d>=11008&&d<=11263)(l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Zs(l)||rh(l)||(d=>d>=57344&&d<=63743)(l)||L(l)||u(l)||B(l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(c))}function tl(c){return c>=1424&&c<=2303||Mf(c)||E(c)}function il(c,l){return!(!l&&tl(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||(d=>d>=6016&&d<=6143)(c))}function Qu(c){for(const l of c)if(tl(l.charCodeAt(0)))return!0;return!1}const fh="deferred",wh="loading",Sh="loaded";let Th=null,Ch="unavailable",hh=null;const Oh=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Ch="error"),Th&&Th(c)};function Rh(){Nh.fire(new mp("pluginStateChange",{pluginStatus:Ch,pluginURL:hh}))}const Nh=new om,qh=function(){return Ch},Fh=function(){if(Ch!==fh||!hh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ch=wh,Rh(),hh&&Yf({url:hh},c=>{c?Oh(c):(Ch=Sh,Rh())})},Hh={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ch===Sh||Hh.applyArabicShaping!=null,isLoading:()=>Ch===wh,setState(c){Ch=c.pluginStatus,hh=c.pluginURL},isParsed:()=>Hh.applyArabicShaping!=null&&Hh.processBidirectionalText!=null&&Hh.processStyledBidirectionalText!=null,getPluginURL:()=>hh};class ld{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.transition=d.transition,this.pitch=d.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(l){return function(d,y){for(const M of d)if(!il(M.charCodeAt(0),y))return!1;return!0}(l,Hh.isLoaded())}}class xd{constructor(l,d){this.property=l,this.value=d,this.expression=function(y,M){if(Gg(y))return new by(y,M);if(Xy(y)){const N=Up(y,M);if(N.result==="error")throw new Error(N.value.map(X=>`${X.key}: ${X.message}`).join(", "));return N.value}{let N=y;return typeof y=="string"&&M.type==="color"&&(N=Np.parse(y)),{kind:"constant",evaluate:()=>N}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,y){return this.property.possiblyEvaluate(this,l,d,y)}}class gd{constructor(l){this.property=l,this.value=new xd(l,void 0)}transitioned(l,d){return new _d(this.property,this.value,d,md({},l.transition,this.transition),l.now)}untransitioned(){return new _d(this.property,this.value,null,{},0)}}class Vf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return td(this._values[l].value.value)}setValue(l,d){this._values.hasOwnProperty(l)||(this._values[l]=new gd(this._values[l].property)),this._values[l].value=new xd(this._values[l].property,d===null?void 0:td(d))}getTransition(l){return td(this._values[l].transition)}setTransition(l,d){this._values.hasOwnProperty(l)||(this._values[l]=new gd(this._values[l].property)),this._values[l].transition=td(d)||void 0}serialize(){const l={};for(const d of Object.keys(this._values)){const y=this.getValue(d);y!==void 0&&(l[d]=y);const M=this.getTransition(d);M!==void 0&&(l[`${d}-transition`]=M)}return l}transitioned(l,d){const y=new Cf(this._properties);for(const M of Object.keys(this._values))y._values[M]=this._values[M].transitioned(l,d._values[M]);return y}untransitioned(){const l=new Cf(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class _d{constructor(l,d,y,M,N){const X=M.delay||0,vt=M.duration||0;N=N||0,this.property=l,this.value=d,this.begin=N+X,this.end=this.begin+vt,l.specification.transition&&(M.delay||M.duration)&&(this.prior=y)}possiblyEvaluate(l,d,y){const M=l.now||0,N=this.value.possiblyEvaluate(l,d,y),X=this.prior;if(X){if(M>this.end)return this.prior=null,N;if(this.value.isDataDriven())return this.prior=null,N;if(M<this.begin)return X.possiblyEvaluate(l,d,y);{const vt=(M-this.begin)/(this.end-this.begin);return this.property.interpolate(X.possiblyEvaluate(l,d,y),N,_h(vt))}}return N}}class Cf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,y){const M=new Cd(this._properties);for(const N of Object.keys(this._values))M._values[N]=this._values[N].possiblyEvaluate(l,d,y);return M}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Ud{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}getValue(l){return td(this._values[l].value)}setValue(l,d){this._values[l]=new xd(this._values[l].property,d===null?void 0:td(d))}serialize(){const l={};for(const d of Object.keys(this._values)){const y=this.getValue(d);y!==void 0&&(l[d]=y)}return l}possiblyEvaluate(l,d,y){const M=new Cd(this._properties);for(const N of Object.keys(this._values))M._values[N]=this._values[N].possiblyEvaluate(l,d,y);return M}}class Lf{constructor(l,d,y){this.property=l,this.value=d,this.parameters=y}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,y,M){return this.property.evaluate(this.value,this.parameters,l,d,y,M)}}class Cd{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class pd{constructor(l){this.specification=l}possiblyEvaluate(l,d){return l.expression.evaluate(d)}interpolate(l,d,y){const M=C_[this.specification.type];return M?M(l,d,y):l}}class $d{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,y,M){return new Lf(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},y,M)}:l.expression,d)}interpolate(l,d,y){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new Lf(this,{kind:"constant",value:void 0},l.parameters);const M=C_[this.specification.type];return M?new Lf(this,{kind:"constant",value:M(l.value.value,d.value.value,y)},l.parameters):l}evaluate(l,d,y,M,N,X){return l.kind==="constant"?l.value:l.evaluate(d,y,M,N,X)}}class yf{constructor(l){this.specification=l}possiblyEvaluate(l,d,y,M){return!!l.expression.evaluate(d,null,{},y,M)}interpolate(){return!1}}class $f{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const d=new ld(0,{});for(const y in l){const M=l[y];M.specification.overridable&&this.overridableProperties.push(y);const N=this.defaultPropertyValues[y]=new xd(M,void 0),X=this.defaultTransitionablePropertyValues[y]=new gd(M);this.defaultTransitioningPropertyValues[y]=X.untransitioned(),this.defaultPossiblyEvaluatedValues[y]=N.possiblyEvaluate(d)}}}function Dp(c,l){return 256*(c=Gh(Math.floor(c),0,255))+Gh(Math.floor(l),0,255)}Ip($d,"DataDrivenProperty"),Ip(pd,"DataConstantProperty"),Ip(yf,"ColorRampProperty");const nm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cp{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xp{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Lp(c,l=1){let d=0,y=0;return{members:c.map(M=>{const N=nm[M.type].BYTES_PER_ELEMENT,X=d=dm(d,Math.max(l,N)),vt=M.components||1;return y=Math.max(y,N),d+=N*vt,{name:M.name,type:M.type,components:vt,offset:X}}),size:dm(d,Math.max(y,l)),alignment:l}}function dm(c,l){return Math.ceil(c/l)*l}class zp extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){const y=this.length;return this.resize(y+1),this.emplace(y,l,d)}emplace(l,d,y){const M=2*l;return this.int16[M+0]=d,this.int16[M+1]=y,l}}zp.prototype.bytesPerElement=4,Ip(zp,"StructArrayLayout2i4");class km extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y){const M=this.length;return this.resize(M+1),this.emplace(M,l,d,y)}emplace(l,d,y,M){const N=3*l;return this.int16[N+0]=d,this.int16[N+1]=y,this.int16[N+2]=M,l}}km.prototype.bytesPerElement=6,Ip(km,"StructArrayLayout3i6");class Am extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const X=4*l;return this.int16[X+0]=d,this.int16[X+1]=y,this.int16[X+2]=M,this.int16[X+3]=N,l}}Am.prototype.bytesPerElement=8,Ip(Am,"StructArrayLayout4i8");class jm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X,vt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,l,d,y,M,N,X,vt)}emplace(l,d,y,M,N,X,vt,Ht){const Ui=6*l,Fn=12*l,Js=3*l;return this.int16[Ui+0]=d,this.int16[Ui+1]=y,this.uint8[Fn+4]=M,this.uint8[Fn+5]=N,this.uint8[Fn+6]=X,this.uint8[Fn+7]=vt,this.float32[Js+2]=Ht,l}}jm.prototype.bytesPerElement=12,Ip(jm,"StructArrayLayout2i4ub1f12");class zm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const X=4*l;return this.float32[X+0]=d,this.float32[X+1]=y,this.float32[X+2]=M,this.float32[X+3]=N,l}}zm.prototype.bytesPerElement=16,Ip(zm,"StructArrayLayout4f16");class gg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N){const X=this.length;return this.resize(X+1),this.emplace(X,l,d,y,M,N)}emplace(l,d,y,M,N,X){const vt=6*l,Ht=3*l;return this.uint16[vt+0]=d,this.uint16[vt+1]=y,this.uint16[vt+2]=M,this.uint16[vt+3]=N,this.float32[Ht+2]=X,l}}gg.prototype.bytesPerElement=12,Ip(gg,"StructArrayLayout4ui1f12");class lg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const X=4*l;return this.uint16[X+0]=d,this.uint16[X+1]=y,this.uint16[X+2]=M,this.uint16[X+3]=N,l}}lg.prototype.bytesPerElement=8,Ip(lg,"StructArrayLayout4ui8");class Cy extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X){const vt=this.length;return this.resize(vt+1),this.emplace(vt,l,d,y,M,N,X)}emplace(l,d,y,M,N,X,vt){const Ht=6*l;return this.int16[Ht+0]=d,this.int16[Ht+1]=y,this.int16[Ht+2]=M,this.int16[Ht+3]=N,this.int16[Ht+4]=X,this.int16[Ht+5]=vt,l}}Cy.prototype.bytesPerElement=12,Ip(Cy,"StructArrayLayout6i12");class V0 extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl){const ju=this.length;return this.resize(ju+1),this.emplace(ju,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl)}emplace(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju){const Ku=12*l;return this.int16[Ku+0]=d,this.int16[Ku+1]=y,this.int16[Ku+2]=M,this.int16[Ku+3]=N,this.uint16[Ku+4]=X,this.uint16[Ku+5]=vt,this.uint16[Ku+6]=Ht,this.uint16[Ku+7]=Ui,this.int16[Ku+8]=Fn,this.int16[Ku+9]=Js,this.int16[Ku+10]=nl,this.int16[Ku+11]=ju,l}}V0.prototype.bytesPerElement=24,Ip(V0,"StructArrayLayout4i4ui4i24");class ig extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X){const vt=this.length;return this.resize(vt+1),this.emplace(vt,l,d,y,M,N,X)}emplace(l,d,y,M,N,X,vt){const Ht=10*l,Ui=5*l;return this.int16[Ht+0]=d,this.int16[Ht+1]=y,this.int16[Ht+2]=M,this.float32[Ui+2]=N,this.float32[Ui+3]=X,this.float32[Ui+4]=vt,l}}ig.prototype.bytesPerElement=20,Ip(ig,"StructArrayLayout3i3f20");class qm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}qm.prototype.bytesPerElement=4,Ip(qm,"StructArrayLayout1ul4");class _m extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju){const Ku=this.length;return this.resize(Ku+1),this.emplace(Ku,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju)}emplace(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku){const lh=20*l,Eh=10*l;return this.int16[lh+0]=d,this.int16[lh+1]=y,this.int16[lh+2]=M,this.int16[lh+3]=N,this.int16[lh+4]=X,this.float32[Eh+3]=vt,this.float32[Eh+4]=Ht,this.float32[Eh+5]=Ui,this.float32[Eh+6]=Fn,this.int16[lh+14]=Js,this.uint32[Eh+8]=nl,this.uint16[lh+18]=ju,this.uint16[lh+19]=Ku,l}}_m.prototype.bytesPerElement=40,Ip(_m,"StructArrayLayout5i4f1i1ul2ui40");class cg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X,vt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,l,d,y,M,N,X,vt)}emplace(l,d,y,M,N,X,vt,Ht){const Ui=8*l;return this.int16[Ui+0]=d,this.int16[Ui+1]=y,this.int16[Ui+2]=M,this.int16[Ui+4]=N,this.int16[Ui+5]=X,this.int16[Ui+6]=vt,this.int16[Ui+7]=Ht,l}}cg.prototype.bytesPerElement=16,Ip(cg,"StructArrayLayout3i2i2i16");class n_ extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N){const X=this.length;return this.resize(X+1),this.emplace(X,l,d,y,M,N)}emplace(l,d,y,M,N,X){const vt=4*l,Ht=8*l;return this.float32[vt+0]=d,this.float32[vt+1]=y,this.float32[vt+2]=M,this.int16[Ht+6]=N,this.int16[Ht+7]=X,l}}n_.prototype.bytesPerElement=16,Ip(n_,"StructArrayLayout2f1f2i16");class Dm extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const X=12*l,vt=3*l;return this.uint8[X+0]=d,this.uint8[X+1]=y,this.float32[vt+1]=M,this.float32[vt+2]=N,l}}Dm.prototype.bytesPerElement=12,Ip(Dm,"StructArrayLayout2ub2f12");class jg extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y){const M=this.length;return this.resize(M+1),this.emplace(M,l,d,y)}emplace(l,d,y,M){const N=3*l;return this.float32[N+0]=d,this.float32[N+1]=y,this.float32[N+2]=M,l}}jg.prototype.bytesPerElement=12,Ip(jg,"StructArrayLayout3f12");class y_ extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y){const M=this.length;return this.resize(M+1),this.emplace(M,l,d,y)}emplace(l,d,y,M){const N=3*l;return this.uint16[N+0]=d,this.uint16[N+1]=y,this.uint16[N+2]=M,l}}y_.prototype.bytesPerElement=6,Ip(y_,"StructArrayLayout3ui6");class hv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh,Bh,Yh,kh,Vh,rd){const ed=this.length;return this.resize(ed+1),this.emplace(ed,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh,Bh,Yh,kh,Vh,rd)}emplace(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh,Bh,Yh,kh,Vh,rd,ed){const Rd=30*l,kd=15*l,Sf=60*l;return this.int16[Rd+0]=d,this.int16[Rd+1]=y,this.int16[Rd+2]=M,this.float32[kd+2]=N,this.float32[kd+3]=X,this.uint16[Rd+8]=vt,this.uint16[Rd+9]=Ht,this.uint32[kd+5]=Ui,this.uint32[kd+6]=Fn,this.uint32[kd+7]=Js,this.uint16[Rd+16]=nl,this.uint16[Rd+17]=ju,this.uint16[Rd+18]=Ku,this.float32[kd+10]=lh,this.float32[kd+11]=Eh,this.uint8[Sf+48]=Bh,this.uint8[Sf+49]=Yh,this.uint8[Sf+50]=kh,this.uint32[kd+13]=Vh,this.int16[Rd+28]=rd,this.uint8[Sf+58]=ed,l}}hv.prototype.bytesPerElement=60,Ip(hv,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh,Bh,Yh,kh,Vh,rd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf){const Xf=this.length;return this.resize(Xf+1),this.emplace(Xf,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh,Bh,Yh,kh,Vh,rd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf)}emplace(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh,Bh,Yh,kh,Vh,rd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf,Xf){const Hd=38*l,up=19*l;return this.int16[Hd+0]=d,this.int16[Hd+1]=y,this.int16[Hd+2]=M,this.float32[up+2]=N,this.float32[up+3]=X,this.int16[Hd+8]=vt,this.int16[Hd+9]=Ht,this.int16[Hd+10]=Ui,this.int16[Hd+11]=Fn,this.int16[Hd+12]=Js,this.int16[Hd+13]=nl,this.uint16[Hd+14]=ju,this.uint16[Hd+15]=Ku,this.uint16[Hd+16]=lh,this.uint16[Hd+17]=Eh,this.uint16[Hd+18]=Bh,this.uint16[Hd+19]=Yh,this.uint16[Hd+20]=kh,this.uint16[Hd+21]=Vh,this.uint16[Hd+22]=rd,this.uint16[Hd+23]=ed,this.uint16[Hd+24]=Rd,this.uint16[Hd+25]=kd,this.uint16[Hd+26]=Sf,this.uint16[Hd+27]=Zf,this.uint16[Hd+28]=jd,this.uint32[up+15]=Pf,this.float32[up+16]=Rf,this.float32[up+17]=Uf,this.float32[up+18]=Xf,l}}Hv.prototype.bytesPerElement=76,Ip(Hv,"StructArrayLayout3i2f6i15ui1ul3f76");class uy extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}uy.prototype.bytesPerElement=4,Ip(uy,"StructArrayLayout1f4");class My extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N){const X=this.length;return this.resize(X+1),this.emplace(X,l,d,y,M,N)}emplace(l,d,y,M,N,X){const vt=5*l;return this.float32[vt+0]=d,this.float32[vt+1]=y,this.float32[vt+2]=M,this.float32[vt+3]=N,this.float32[vt+4]=X,l}}My.prototype.bytesPerElement=20,Ip(My,"StructArrayLayout5f20");class G0 extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const X=6*l;return this.uint32[3*l+0]=d,this.uint16[X+2]=y,this.uint16[X+3]=M,this.uint16[X+4]=N,l}}G0.prototype.bytesPerElement=12,Ip(G0,"StructArrayLayout1ul3ui12");class dv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){const y=this.length;return this.resize(y+1),this.emplace(y,l,d)}emplace(l,d,y){const M=2*l;return this.uint16[M+0]=d,this.uint16[M+1]=y,l}}dv.prototype.bytesPerElement=4,Ip(dv,"StructArrayLayout2ui4");class I0 extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}I0.prototype.bytesPerElement=2,Ip(I0,"StructArrayLayout1ui2");class Xv extends xp{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){const y=this.length;return this.resize(y+1),this.emplace(y,l,d)}emplace(l,d,y){const M=2*l;return this.float32[M+0]=d,this.float32[M+1]=y,l}}Xv.prototype.bytesPerElement=8,Ip(Xv,"StructArrayLayout2f8");class u1 extends Cp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}u1.prototype.size=40;class hb extends _m{get(l){return new u1(this,l)}}Ip(hb,"CollisionBoxArray");class Rg extends Cp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(l){this._structArray.uint8[this._pos1+49]=l}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(l){this._structArray.uint8[this._pos1+50]=l}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(l){this._structArray.uint32[this._pos4+13]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(l){this._structArray.uint8[this._pos1+58]=l}}Rg.prototype.size=60;class ax extends hv{get(l){return new Rg(this,l)}}Ip(ax,"PlacedSymbolArray");class db extends Cp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(l){this._structArray.uint32[this._pos4+15]=l}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}db.prototype.size=76;class sx extends Hv{get(l){return new db(this,l)}}Ip(sx,"SymbolInstanceArray");class lx extends uy{getoffsetX(l){return this.float32[1*l+0]}}Ip(lx,"GlyphOffsetArray");class $1 extends zp{getx(l){return this.int16[2*l+0]}gety(l){return this.int16[2*l+1]}}Ip($1,"SymbolLineVertexArray");class fb extends Cp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fb.prototype.size=12;class pb extends G0{get(l){return new fb(this,l)}}Ip(pb,"FeatureIndexArray");class B1 extends dv{geta_centroid_pos0(l){return this.uint16[2*l+0]}geta_centroid_pos1(l){return this.uint16[2*l+1]}}Ip(B1,"FillExtrusionCentroidArray");const mb=Lp([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),gb=Lp([{name:"a_dash",components:4,type:"Uint16"}]);var h1={},tw={get exports(){return h1},set exports(c){h1=c}},d1={};({get exports(){return d1},set exports(c){d1=c}}).exports=function(c,l){var d,y,M,N,X,vt,Ht,Ui;for(y=c.length-(d=3&c.length),M=l,X=3432918353,vt=461845907,Ui=0;Ui<y;)Ht=255&c.charCodeAt(Ui)|(255&c.charCodeAt(++Ui))<<8|(255&c.charCodeAt(++Ui))<<16|(255&c.charCodeAt(++Ui))<<24,++Ui,M=27492+(65535&(N=5*(65535&(M=(M^=Ht=(65535&(Ht=(Ht=(65535&Ht)*X+(((Ht>>>16)*X&65535)<<16)&4294967295)<<15|Ht>>>17))*vt+(((Ht>>>16)*vt&65535)<<16)&4294967295)<<13|M>>>19))+((5*(M>>>16)&65535)<<16)&4294967295))+((58964+(N>>>16)&65535)<<16);switch(Ht=0,d){case 3:Ht^=(255&c.charCodeAt(Ui+2))<<16;case 2:Ht^=(255&c.charCodeAt(Ui+1))<<8;case 1:M^=Ht=(65535&(Ht=(Ht=(65535&(Ht^=255&c.charCodeAt(Ui)))*X+(((Ht>>>16)*X&65535)<<16)&4294967295)<<15|Ht>>>17))*vt+(((Ht>>>16)*vt&65535)<<16)&4294967295}return M^=c.length,M=2246822507*(65535&(M^=M>>>16))+((2246822507*(M>>>16)&65535)<<16)&4294967295,M=3266489909*(65535&(M^=M>>>13))+((3266489909*(M>>>16)&65535)<<16)&4294967295,(M^=M>>>16)>>>0};var _b={};({get exports(){return _b},set exports(c){_b=c}}).exports=function(c,l){for(var d,y=c.length,M=l^y,N=0;y>=4;)d=1540483477*(65535&(d=255&c.charCodeAt(N)|(255&c.charCodeAt(++N))<<8|(255&c.charCodeAt(++N))<<16|(255&c.charCodeAt(++N))<<24))+((1540483477*(d>>>16)&65535)<<16),M=1540483477*(65535&M)+((1540483477*(M>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),y-=4,++N;switch(y){case 3:M^=(255&c.charCodeAt(N+2))<<16;case 2:M^=(255&c.charCodeAt(N+1))<<8;case 1:M=1540483477*(65535&(M^=255&c.charCodeAt(N)))+((1540483477*(M>>>16)&65535)<<16)}return M=1540483477*(65535&(M^=M>>>13))+((1540483477*(M>>>16)&65535)<<16),(M^=M>>>15)>>>0};var $x=d1,Kw=_b;tw.exports=$x,h1.murmur3=$x,h1.murmur2=Kw;class N1{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,y,M){this.ids.push(Bx(l)),this.positions.push(d,y,M)}getPositions(l){const d=Bx(l);let y=0,M=this.ids.length-1;for(;y<M;){const X=y+M>>1;this.ids[X]>=d?M=X:y=X+1}const N=[];for(;this.ids[y]===d;)N.push({index:this.positions[3*y],start:this.positions[3*y+1],end:this.positions[3*y+2]}),y++;return N}static serialize(l,d){const y=new Float64Array(l.ids),M=new Uint32Array(l.positions);return cx(y,M,0,y.length-1),d&&d.push(y.buffer,M.buffer),{ids:y,positions:M}}static deserialize(l){const d=new N1;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function Bx(c){const l=+c;return!isNaN(l)&&Number.MIN_SAFE_INTEGER<=l&&l<=Number.MAX_SAFE_INTEGER?l:h1(String(c))}function cx(c,l,d,y){for(;d<y;){const M=c[d+y>>1];let N=d-1,X=y+1;for(;;){do N++;while(c[N]<M);do X--;while(c[X]>M);if(N>=X)break;Nx(c,N,X),Nx(l,3*N,3*X),Nx(l,3*N+1,3*X+1),Nx(l,3*N+2,3*X+2)}X-d<y-X?(cx(c,l,d,X),d=X+1):(cx(c,l,X+1,y),y=X)}}function Nx(c,l,d){const y=c[l];c[l]=c[d],c[d]=y}Ip(N1,"FeaturePositionMap");class Av{constructor(l){this.gl=l.gl,this.initialized=!1}fetchUniformLocation(l,d){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(l,d),this.initialized=!0),!!this.location}}class zx extends Av{constructor(l){super(l),this.current=0}set(l,d,y){this.fetchUniformLocation(l,d)&&this.current!==y&&(this.current=y,this.gl.uniform1f(this.location,y))}}class iw extends Av{constructor(l){super(l),this.current=[0,0,0,0]}set(l,d,y){this.fetchUniformLocation(l,d)&&(y[0]===this.current[0]&&y[1]===this.current[1]&&y[2]===this.current[2]&&y[3]===this.current[3]||(this.current=y,this.gl.uniform4f(this.location,y[0],y[1],y[2],y[3])))}}class rw extends Av{constructor(l){super(l),this.current=Np.transparent}set(l,d,y){this.fetchUniformLocation(l,d)&&(y.r===this.current.r&&y.g===this.current.g&&y.b===this.current.b&&y.a===this.current.a||(this.current=y,this.gl.uniform4f(this.location,y.r,y.g,y.b,y.a)))}}const Wv=new Float32Array(16),Qw=new Float32Array(9),nw=new Float32Array(4);function Yv(c){return[Dp(255*c.r,255*c.g),Dp(255*c.b,255*c.a)]}class ux{constructor(l,d,y){this.value=l,this.uniformNames=d.map(M=>`u_${M}`),this.type=y}setUniform(l,d,y,M,N){d.set(l,N,M.constantOr(this.value))}getBinding(l,d){return this.type==="color"?new rw(l):new zx(l)}}class z1{constructor(l,d){this.uniformNames=d.map(y=>`u_${y}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(l){this.pixelRatio=l.pixelRatio||1,this.pattern=l.tl.concat(l.br)}setUniform(l,d,y,M,N){const X=N==="u_pattern"||N==="u_dash"?this.pattern:N==="u_pixel_ratio"?this.pixelRatio:null;X&&d.set(l,N,X)}getBinding(l,d){return d==="u_pattern"||d==="u_dash"?new iw(l):new zx(l)}}class Pv{constructor(l,d,y,M){this.expression=l,this.type=y,this.maxValue=0,this.paintVertexAttributes=d.map(N=>({name:`a_${N}`,type:"Float32",components:y==="color"?2:1,offset:0})),this.paintVertexArray=new M}populatePaintArray(l,d,y,M,N,X){const vt=this.paintVertexArray.length,Ht=this.expression.evaluate(new ld(0),d,{},N,M,X);this.paintVertexArray.resize(l),this._setPaintValue(vt,l,Ht)}updatePaintArray(l,d,y,M,N){const X=this.expression.evaluate({zoom:0},y,M,void 0,N);this._setPaintValue(l,d,X)}_setPaintValue(l,d,y){if(this.type==="color"){const M=Yv(y);for(let N=l;N<d;N++)this.paintVertexArray.emplace(N,M[0],M[1])}else{for(let M=l;M<d;M++)this.paintVertexArray.emplace(M,y);this.maxValue=Math.max(this.maxValue,Math.abs(y))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class C0{constructor(l,d,y,M,N,X){this.expression=l,this.uniformNames=d.map(vt=>`u_${vt}_t`),this.type=y,this.useIntegerZoom=M,this.zoom=N,this.maxValue=0,this.paintVertexAttributes=d.map(vt=>({name:`a_${vt}`,type:"Float32",components:y==="color"?4:2,offset:0})),this.paintVertexArray=new X}populatePaintArray(l,d,y,M,N,X){const vt=this.expression.evaluate(new ld(this.zoom),d,{},N,M,X),Ht=this.expression.evaluate(new ld(this.zoom+1),d,{},N,M,X),Ui=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(Ui,l,vt,Ht)}updatePaintArray(l,d,y,M,N){const X=this.expression.evaluate({zoom:this.zoom},y,M,void 0,N),vt=this.expression.evaluate({zoom:this.zoom+1},y,M,void 0,N);this._setPaintValue(l,d,X,vt)}_setPaintValue(l,d,y,M){if(this.type==="color"){const N=Yv(y),X=Yv(M);for(let vt=l;vt<d;vt++)this.paintVertexArray.emplace(vt,N[0],N[1],X[0],X[1])}else{for(let N=l;N<d;N++)this.paintVertexArray.emplace(N,y,M);this.maxValue=Math.max(this.maxValue,Math.abs(y),Math.abs(M))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d,y,M,N){const X=this.useIntegerZoom?Math.floor(y.zoom):y.zoom,vt=Gh(this.expression.interpolationFactor(X,this.zoom,this.zoom+1),0,1);d.set(l,N,vt)}getBinding(l,d){return new zx(l)}}class kv{constructor(l,d,y,M,N){this.expression=l,this.layerId=N,this.paintVertexAttributes=(y==="array"?gb:mb).members;for(let X=0;X<d.length;++X);this.paintVertexArray=new M}populatePaintArray(l,d,y){const M=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValues(M,l,d.patterns&&d.patterns[this.layerId],y)}updatePaintArray(l,d,y,M,N,X){this._setPaintValues(l,d,y.patterns&&y.patterns[this.layerId],X)}_setPaintValues(l,d,y,M){if(!M||!y)return;const N=M[y];if(!N)return;const{tl:X,br:vt,pixelRatio:Ht}=N;for(let Ui=l;Ui<d;Ui++)this.paintVertexArray.emplace(Ui,X[0],X[1],vt[0],vt[1],Ht)}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kv{constructor(l,d,y=()=>!0){this.binders={},this._buffers=[];const M=[];for(const N in l.paint._values){if(!y(N))continue;const X=l.paint.get(N);if(!(X instanceof Lf&&sg(X.property.specification)))continue;const vt=e2(N,l.type),Ht=X.value,Ui=X.property.specification.type,Fn=!!X.property.useIntegerZoom,Js=N==="line-dasharray"||N.endsWith("pattern"),nl=N==="line-dasharray"&&l.layout.get("line-cap").value.kind!=="constant";if(Ht.kind!=="constant"||nl)if(Ht.kind==="source"||nl||Js){const ju=Fx(N,Ui,"source");this.binders[N]=Js?new kv(Ht,vt,Ui,ju,l.id):new Pv(Ht,vt,Ui,ju),M.push(`/a_${N}`)}else{const ju=Fx(N,Ui,"composite");this.binders[N]=new C0(Ht,vt,Ui,Fn,d,ju),M.push(`/z_${N}`)}else this.binders[N]=Js?new z1(Ht.value,vt):new ux(Ht.value,vt,Ui),M.push(`/u_${N}`)}this.cacheKey=M.sort().join("")}getMaxValue(l){const d=this.binders[l];return d instanceof Pv||d instanceof C0?d.maxValue:0}populatePaintArrays(l,d,y,M,N,X){for(const vt in this.binders){const Ht=this.binders[vt];(Ht instanceof Pv||Ht instanceof C0||Ht instanceof kv)&&Ht.populatePaintArray(l,d,y,M,N,X)}}setConstantPatternPositions(l){for(const d in this.binders){const y=this.binders[d];y instanceof z1&&y.setConstantPatternPositions(l)}}updatePaintArrays(l,d,y,M,N,X){let vt=!1;for(const Ht in l){const Ui=d.getPositions(Ht);for(const Fn of Ui){const Js=y.feature(Fn.index);for(const nl in this.binders){const ju=this.binders[nl];if((ju instanceof Pv||ju instanceof C0||ju instanceof kv)&&ju.expression.isStateDependent===!0){const Ku=M.paint.get(nl);ju.expression=Ku.value,ju.updatePaintArray(Fn.start,Fn.end,Js,l[Ht],N,X),vt=!0}}}}return vt}defines(){const l=[];for(const d in this.binders){const y=this.binders[d];(y instanceof ux||y instanceof z1)&&l.push(...y.uniformNames.map(M=>`#define HAS_UNIFORM_${M}`))}return l}getBinderAttributes(){const l=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof Pv||y instanceof C0||y instanceof kv)for(let M=0;M<y.paintVertexAttributes.length;M++)l.push(y.paintVertexAttributes[M].name)}return l}getBinderUniforms(){const l=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof ux||y instanceof z1||y instanceof C0)for(const M of y.uniformNames)l.push(M)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l){const d=[];for(const y in this.binders){const M=this.binders[y];if(M instanceof ux||M instanceof z1||M instanceof C0)for(const N of M.uniformNames)d.push({name:N,property:y,binding:M.getBinding(l,N)})}return d}setUniforms(l,d,y,M,N){for(const{name:X,property:vt,binding:Ht}of y)this.binders[vt].setUniform(l,Ht,N,M.get(vt),X)}updatePaintBuffers(){this._buffers=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Pv||d instanceof C0||d instanceof kv)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(l){for(const d in this.binders){const y=this.binders[d];(y instanceof Pv||y instanceof C0||y instanceof kv)&&y.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const d=this.binders[l];(d instanceof Pv||d instanceof C0||d instanceof kv)&&d.destroy()}}}class f1{constructor(l,d,y=()=>!0){this.programConfigurations={};for(const M of l)this.programConfigurations[M.id]=new Kv(M,d,y);this.needsUpload=!1,this._featureMap=new N1,this._bufferOffset=0}populatePaintArrays(l,d,y,M,N,X,vt){for(const Ht in this.programConfigurations)this.programConfigurations[Ht].populatePaintArrays(l,d,M,N,X,vt);d.id!==void 0&&this._featureMap.add(d.id,y,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,y,M,N){for(const X of y)this.needsUpload=this.programConfigurations[X.id].updatePaintArrays(l,this._featureMap,d,X,M,N)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}const Jw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function e2(c,l){return Jw[c]||[c.replace(`${l}-`,"").replace(/-/g,"_")]}const yb={"line-pattern":{source:gg,composite:gg},"fill-pattern":{source:gg,composite:gg},"fill-extrusion-pattern":{source:gg,composite:gg},"line-dasharray":{source:lg,composite:lg}},hx={color:{source:Xv,composite:zm},number:{source:uy,composite:Xv}};function Fx(c,l,d){const y=yb[c];return y&&y[d]||hx[l][d]}Ip(ux,"ConstantBinder"),Ip(z1,"PatternConstantBinder"),Ip(Pv,"SourceExpressionBinder"),Ip(kv,"PatternCompositeBinder"),Ip(C0,"CompositeExpressionBinder"),Ip(Kv,"ProgramConfiguration",{omit:["_buffers"]}),Ip(f1,"ProgramConfigurationSet");const Ux="-transition";class j0 extends om{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&l.type!=="sky"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Ud(d.layout)),d.paint)){this._transitionablePaint=new Vf(d.paint);for(const y in l.paint)this.setPaintProperty(y,l.paint[y],{validate:!1});for(const y in l.layout)this.setLayoutProperty(y,l.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cd(d.paint)}}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,y={}){d!=null&&this._validate(U0,`layers.${this.id}.layout.${l}`,l,d,y)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return Gd(l,Ux)?this._transitionablePaint.getTransition(l.slice(0,-Ux.length)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,y={}){if(d!=null&&this._validate(Mv,`layers.${this.id}.paint.${l}`,l,d,y))return!1;if(Gd(l,Ux))return this._transitionablePaint.setTransition(l.slice(0,-Ux.length),d||void 0),!1;{const M=this._transitionablePaint._values[l],N=M.value.isDataDriven(),X=M.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);const vt=this._transitionablePaint._values[l].value,Ht=vt.isDataDriven(),Ui=Gd(l,"pattern")||l==="line-dasharray";return Ht||N||Ui||this._handleOverridablePaintPropertyUpdate(l,X,vt)}}_handleSpecialPaintPropertyUpdate(l){}getProgramIds(){return null}getProgramConfiguration(l){return null}_handleOverridablePaintPropertyUpdate(l,d,y){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Id(l,(d,y)=>!(d===void 0||y==="layout"&&!Object.keys(d).length||y==="paint"&&!Object.keys(d).length))}_validate(l,d,y,M,N={}){return(!N||N.validate!==!1)&&qv(this,l.call(S0,{key:d,layerType:this.type,objectKey:y,value:M,styleSpec:Pd,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const d=this.paint.get(l);if(d instanceof Lf&&sg(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=v0(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const t2=Lp([{name:"a_pos",components:2,type:"Int16"}],4),dx=Lp([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Og{constructor(l=[]){this.segments=l}prepareSegment(l,d,y,M){let N=this.segments[this.segments.length-1];return l>Og.MAX_VERTEX_ARRAY_LENGTH&&rp(`Max vertices per segment is ${Og.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!N||N.vertexLength+l>Og.MAX_VERTEX_ARRAY_LENGTH||N.sortKey!==M)&&(N={vertexOffset:d.length,primitiveOffset:y.length,vertexLength:0,primitiveLength:0},M!==void 0&&(N.sortKey=M),this.segments.push(N)),N}get(){return this.segments}destroy(){for(const l of this.segments)for(const d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,y,M){return new Og([{vertexOffset:l,primitiveOffset:d,vertexLength:y,primitiveLength:M,vaos:{},sortKey:0}])}}Og.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ip(Og,"SegmentVector");var Hp=8192;class Qv{constructor(l,d){l&&(d?this.setSouthWest(l).setNorthEast(d):l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1]))}setNorthEast(l){return this._ne=l instanceof Tm?new Tm(l.lng,l.lat):Tm.convert(l),this}setSouthWest(l){return this._sw=l instanceof Tm?new Tm(l.lng,l.lat):Tm.convert(l),this}extend(l){const d=this._sw,y=this._ne;let M,N;if(l instanceof Tm)M=l,N=l;else{if(!(l instanceof Qv))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Qv.convert(l)):this.extend(Tm.convert(l)):typeof l=="object"&&l!==null&&l.hasOwnProperty("lat")&&(l.hasOwnProperty("lon")||l.hasOwnProperty("lng"))?this.extend(Tm.convert(l)):this;if(M=l._sw,N=l._ne,!M||!N)return this}return d||y?(d.lng=Math.min(M.lng,d.lng),d.lat=Math.min(M.lat,d.lat),y.lng=Math.max(N.lng,y.lng),y.lat=Math.max(N.lat,y.lat)):(this._sw=new Tm(M.lng,M.lat),this._ne=new Tm(N.lng,N.lat)),this}getCenter(){return new Tm((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tm(this.getWest(),this.getNorth())}getSouthEast(){return new Tm(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:d,lat:y}=Tm.convert(l);let M=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(M=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&M}static convert(l){return!l||l instanceof Qv?l:new Qv(l)}}var Vx=1e-6,Ay=typeof Float32Array<"u"?Float32Array:Array;function ow(){var c=new Ay(9);return Ay!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function aw(c,l,d){var y=l[0],M=l[1],N=l[2],X=l[3],vt=l[4],Ht=l[5],Ui=l[6],Fn=l[7],Js=l[8],nl=d[0],ju=d[1],Ku=d[2],lh=d[3],Eh=d[4],Bh=d[5],Yh=d[6],kh=d[7],Vh=d[8];return c[0]=nl*y+ju*X+Ku*Ui,c[1]=nl*M+ju*vt+Ku*Fn,c[2]=nl*N+ju*Ht+Ku*Js,c[3]=lh*y+Eh*X+Bh*Ui,c[4]=lh*M+Eh*vt+Bh*Fn,c[5]=lh*N+Eh*Ht+Bh*Js,c[6]=Yh*y+kh*X+Vh*Ui,c[7]=Yh*M+kh*vt+Vh*Fn,c[8]=Yh*N+kh*Ht+Vh*Js,c}function M0(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function fx(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],X=l[4],vt=l[5],Ht=l[6],Ui=l[7],Fn=l[8],Js=l[9],nl=l[10],ju=l[11],Ku=l[12],lh=l[13],Eh=l[14],Bh=l[15],Yh=d*vt-y*X,kh=d*Ht-M*X,Vh=d*Ui-N*X,rd=y*Ht-M*vt,ed=y*Ui-N*vt,Rd=M*Ui-N*Ht,kd=Fn*lh-Js*Ku,Sf=Fn*Eh-nl*Ku,Zf=Fn*Bh-ju*Ku,jd=Js*Eh-nl*lh,Pf=Js*Bh-ju*lh,Rf=nl*Bh-ju*Eh,Uf=Yh*Rf-kh*Pf+Vh*jd+rd*Zf-ed*Sf+Rd*kd;return Uf?(c[0]=(vt*Rf-Ht*Pf+Ui*jd)*(Uf=1/Uf),c[1]=(M*Pf-y*Rf-N*jd)*Uf,c[2]=(lh*Rd-Eh*ed+Bh*rd)*Uf,c[3]=(nl*ed-Js*Rd-ju*rd)*Uf,c[4]=(Ht*Zf-X*Rf-Ui*Sf)*Uf,c[5]=(d*Rf-M*Zf+N*Sf)*Uf,c[6]=(Eh*Vh-Ku*Rd-Bh*kh)*Uf,c[7]=(Fn*Rd-nl*Vh+ju*kh)*Uf,c[8]=(X*Pf-vt*Zf+Ui*kd)*Uf,c[9]=(y*Zf-d*Pf-N*kd)*Uf,c[10]=(Ku*ed-lh*Vh+Bh*Yh)*Uf,c[11]=(Js*Vh-Fn*ed-ju*Yh)*Uf,c[12]=(vt*Sf-X*jd-Ht*kd)*Uf,c[13]=(d*jd-y*Sf+M*kd)*Uf,c[14]=(lh*kh-Ku*rd-Eh*Yh)*Uf,c[15]=(Fn*rd-Js*kh+nl*Yh)*Uf,c):null}function p1(c,l,d){var y=l[0],M=l[1],N=l[2],X=l[3],vt=l[4],Ht=l[5],Ui=l[6],Fn=l[7],Js=l[8],nl=l[9],ju=l[10],Ku=l[11],lh=l[12],Eh=l[13],Bh=l[14],Yh=l[15],kh=d[0],Vh=d[1],rd=d[2],ed=d[3];return c[0]=kh*y+Vh*vt+rd*Js+ed*lh,c[1]=kh*M+Vh*Ht+rd*nl+ed*Eh,c[2]=kh*N+Vh*Ui+rd*ju+ed*Bh,c[3]=kh*X+Vh*Fn+rd*Ku+ed*Yh,c[4]=(kh=d[4])*y+(Vh=d[5])*vt+(rd=d[6])*Js+(ed=d[7])*lh,c[5]=kh*M+Vh*Ht+rd*nl+ed*Eh,c[6]=kh*N+Vh*Ui+rd*ju+ed*Bh,c[7]=kh*X+Vh*Fn+rd*Ku+ed*Yh,c[8]=(kh=d[8])*y+(Vh=d[9])*vt+(rd=d[10])*Js+(ed=d[11])*lh,c[9]=kh*M+Vh*Ht+rd*nl+ed*Eh,c[10]=kh*N+Vh*Ui+rd*ju+ed*Bh,c[11]=kh*X+Vh*Fn+rd*Ku+ed*Yh,c[12]=(kh=d[12])*y+(Vh=d[13])*vt+(rd=d[14])*Js+(ed=d[15])*lh,c[13]=kh*M+Vh*Ht+rd*nl+ed*Eh,c[14]=kh*N+Vh*Ui+rd*ju+ed*Bh,c[15]=kh*X+Vh*Fn+rd*Ku+ed*Yh,c}function F1(c,l,d){var y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh=d[0],Eh=d[1],Bh=d[2];return l===c?(c[12]=l[0]*lh+l[4]*Eh+l[8]*Bh+l[12],c[13]=l[1]*lh+l[5]*Eh+l[9]*Bh+l[13],c[14]=l[2]*lh+l[6]*Eh+l[10]*Bh+l[14],c[15]=l[3]*lh+l[7]*Eh+l[11]*Bh+l[15]):(M=l[1],N=l[2],X=l[3],vt=l[4],Ht=l[5],Ui=l[6],Fn=l[7],Js=l[8],nl=l[9],ju=l[10],Ku=l[11],c[0]=y=l[0],c[1]=M,c[2]=N,c[3]=X,c[4]=vt,c[5]=Ht,c[6]=Ui,c[7]=Fn,c[8]=Js,c[9]=nl,c[10]=ju,c[11]=Ku,c[12]=y*lh+vt*Eh+Js*Bh+l[12],c[13]=M*lh+Ht*Eh+nl*Bh+l[13],c[14]=N*lh+Ui*Eh+ju*Bh+l[14],c[15]=X*lh+Fn*Eh+Ku*Bh+l[15]),c}function Jv(c,l,d){var y=d[0],M=d[1],N=d[2];return c[0]=l[0]*y,c[1]=l[1]*y,c[2]=l[2]*y,c[3]=l[3]*y,c[4]=l[4]*M,c[5]=l[5]*M,c[6]=l[6]*M,c[7]=l[7]*M,c[8]=l[8]*N,c[9]=l[9]*N,c[10]=l[10]*N,c[11]=l[11]*N,c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c}function jx(c,l,d){var y=Math.sin(d),M=Math.cos(d),N=l[4],X=l[5],vt=l[6],Ht=l[7],Ui=l[8],Fn=l[9],Js=l[10],nl=l[11];return l!==c&&(c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[4]=N*M+Ui*y,c[5]=X*M+Fn*y,c[6]=vt*M+Js*y,c[7]=Ht*M+nl*y,c[8]=Ui*M-N*y,c[9]=Fn*M-X*y,c[10]=Js*M-vt*y,c[11]=nl*M-Ht*y,c}function qx(c,l,d){var y=Math.sin(d),M=Math.cos(d),N=l[0],X=l[1],vt=l[2],Ht=l[3],Ui=l[8],Fn=l[9],Js=l[10],nl=l[11];return l!==c&&(c[4]=l[4],c[5]=l[5],c[6]=l[6],c[7]=l[7],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=N*M-Ui*y,c[1]=X*M-Fn*y,c[2]=vt*M-Js*y,c[3]=Ht*M-nl*y,c[8]=N*y+Ui*M,c[9]=X*y+Fn*M,c[10]=vt*y+Js*M,c[11]=Ht*y+nl*M,c}function sw(c,l){return c[0]=l[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function lw(c,l,d){var y,M,N,X=d[0],vt=d[1],Ht=d[2],Ui=Math.hypot(X,vt,Ht);return Ui<Vx?null:(X*=Ui=1/Ui,vt*=Ui,Ht*=Ui,y=Math.sin(l),M=Math.cos(l),c[0]=X*X*(N=1-M)+M,c[1]=vt*X*N+Ht*y,c[2]=Ht*X*N-vt*y,c[3]=0,c[4]=X*vt*N-Ht*y,c[5]=vt*vt*N+M,c[6]=Ht*vt*N+X*y,c[7]=0,c[8]=X*Ht*N+vt*y,c[9]=vt*Ht*N-X*y,c[10]=Ht*Ht*N+M,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)});var uw=p1;function vb(){var c=new Ay(3);return Ay!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function hw(c){var l=new Ay(3);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l}function Dv(c){return Math.hypot(c[0],c[1],c[2])}function $g(c,l,d){var y=new Ay(3);return y[0]=c,y[1]=l,y[2]=d,y}function q0(c,l,d){return c[0]=l[0]+d[0],c[1]=l[1]+d[1],c[2]=l[2]+d[2],c}function Zx(c,l,d){return c[0]=l[0]-d[0],c[1]=l[1]-d[1],c[2]=l[2]-d[2],c}function xb(c,l,d){return c[0]=l[0]*d[0],c[1]=l[1]*d[1],c[2]=l[2]*d[2],c}function Om(c,l,d){return c[0]=Math.min(l[0],d[0]),c[1]=Math.min(l[1],d[1]),c[2]=Math.min(l[2],d[2]),c}function A0(c,l,d){return c[0]=Math.max(l[0],d[0]),c[1]=Math.max(l[1],d[1]),c[2]=Math.max(l[2],d[2]),c}function hy(c,l,d){return c[0]=l[0]*d,c[1]=l[1]*d,c[2]=l[2]*d,c}function U1(c,l,d,y){return c[0]=l[0]+d[0]*y,c[1]=l[1]+d[1]*y,c[2]=l[2]+d[2]*y,c}function R_(c,l){var d=l[0],y=l[1],M=l[2],N=d*d+y*y+M*M;return N>0&&(N=1/Math.sqrt(N)),c[0]=l[0]*N,c[1]=l[1]*N,c[2]=l[2]*N,c}function t_(c,l){return c[0]*l[0]+c[1]*l[1]+c[2]*l[2]}function e1(c,l,d){var y=l[0],M=l[1],N=l[2],X=d[0],vt=d[1],Ht=d[2];return c[0]=M*Ht-N*vt,c[1]=N*X-y*Ht,c[2]=y*vt-M*X,c}function Cg(c,l,d){var y=l[0],M=l[1],N=l[2],X=d[3]*y+d[7]*M+d[11]*N+d[15];return c[0]=(d[0]*y+d[4]*M+d[8]*N+d[12])/(X=X||1),c[1]=(d[1]*y+d[5]*M+d[9]*N+d[13])/X,c[2]=(d[2]*y+d[6]*M+d[10]*N+d[14])/X,c}function dw(c,l,d){var y=d[0],M=d[1],N=d[2],X=l[0],vt=l[1],Ht=l[2],Ui=M*Ht-N*vt,Fn=N*X-y*Ht,Js=y*vt-M*X,nl=M*Js-N*Fn,ju=N*Ui-y*Js,Ku=y*Fn-M*Ui,lh=2*d[3];return Fn*=lh,Js*=lh,ju*=2,Ku*=2,c[0]=X+(Ui*=lh)+(nl*=2),c[1]=vt+Fn+ju,c[2]=Ht+Js+Ku,c}var px,Z0=Zx,i2=xb,r2=Dv;function fw(c,l,d){return c[0]=l[0]*d,c[1]=l[1]*d,c[2]=l[2]*d,c[3]=l[3]*d,c}function pw(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],X=d*d+y*y+M*M+N*N;return X>0&&(X=1/Math.sqrt(X)),c[0]=d*X,c[1]=y*X,c[2]=M*X,c[3]=N*X,c}function m1(c,l,d){var y=l[0],M=l[1],N=l[2],X=l[3];return c[0]=d[0]*y+d[4]*M+d[8]*N+d[12]*X,c[1]=d[1]*y+d[5]*M+d[9]*N+d[13]*X,c[2]=d[2]*y+d[6]*M+d[10]*N+d[14]*X,c[3]=d[3]*y+d[7]*M+d[11]*N+d[15]*X,c}function mw(){var c=new Ay(4);return Ay!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function mx(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function g1(c,l,d){d*=.5;var y=l[0],M=l[1],N=l[2],X=l[3],vt=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht+X*vt,c[1]=M*Ht+N*vt,c[2]=N*Ht-M*vt,c[3]=X*Ht-y*vt,c}function bb(c,l,d){d*=.5;var y=l[0],M=l[1],N=l[2],X=l[3],vt=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht-N*vt,c[1]=M*Ht+X*vt,c[2]=N*Ht+y*vt,c[3]=X*Ht-M*vt,c}vb(),px=new Ay(4),Ay!=Float32Array&&(px[0]=0,px[1]=0,px[2]=0,px[3]=0);var n2=pw;vb(),$g(1,0,0),$g(0,1,0),mw(),mw(),ow();const o2=Lp([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:gw}=o2,wb=Lp([{name:"a_pos_3",components:3,type:"Int16"}]);var _1=Lp([{name:"a_pos",type:"Int16",components:2}]);class Hx{constructor(l,d){this.pos=l,this.dir=d}intersectsPlane(l,d,y){const M=t_(d,this.dir);if(Math.abs(M)<1e-6)return!1;const N=((l[0]-this.pos[0])*d[0]+(l[1]-this.pos[1])*d[1]+(l[2]-this.pos[2])*d[2])/M;return y[0]=this.pos[0]+this.dir[0]*N,y[1]=this.pos[1]+this.dir[1]*N,y[2]=this.pos[2]+this.dir[2]*N,!0}closestPointOnSphere(l,d,y){if(function(ju,Ku){var lh=ju[0],Eh=ju[1],Bh=ju[2],Yh=Ku[0],kh=Ku[1],Vh=Ku[2];return Math.abs(lh-Yh)<=Vx*Math.max(1,Math.abs(lh),Math.abs(Yh))&&Math.abs(Eh-kh)<=Vx*Math.max(1,Math.abs(Eh),Math.abs(kh))&&Math.abs(Bh-Vh)<=Vx*Math.max(1,Math.abs(Bh),Math.abs(Vh))}(this.pos,l)||d===0)return y[0]=y[1]=y[2]=0,!1;const[M,N,X]=this.dir,vt=this.pos[0]-l[0],Ht=this.pos[1]-l[1],Ui=this.pos[2]-l[2],Fn=M*M+N*N+X*X,Js=2*(vt*M+Ht*N+Ui*X),nl=Js*Js-4*Fn*(vt*vt+Ht*Ht+Ui*Ui-d*d);if(nl<0){const ju=Math.max(-Js/2,0),Ku=vt+M*ju,lh=Ht+N*ju,Eh=Ui+X*ju,Bh=Math.hypot(Ku,lh,Eh);return y[0]=Ku*d/Bh,y[1]=lh*d/Bh,y[2]=Eh*d/Bh,!1}{const ju=(-Js-Math.sqrt(nl))/(2*Fn);if(ju<0){const Ku=Math.hypot(vt,Ht,Ui);return y[0]=vt*d/Ku,y[1]=Ht*d/Ku,y[2]=Ui*d/Ku,!1}return y[0]=vt+M*ju,y[1]=Ht+N*ju,y[2]=Ui+X*ju,!0}}}class V1{constructor(l,d,y,M,N){this.TL=l,this.TR=d,this.BR=y,this.BL=M,this.horizon=N}static fromInvProjectionMatrix(l,d,y){const M=[-1,1,1],N=[1,1,1],X=[1,-1,1],vt=[-1,-1,1],Ht=Cg(M,M,l),Ui=Cg(N,N,l),Fn=Cg(X,X,l),Js=Cg(vt,vt,l);return new V1(Ht,Ui,Fn,Js,d/y)}}class y1{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,y,M){const N=Math.pow(2,y),X=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(Ht=>{const Ui=m1([],Ht,l),Fn=1/Ui[3]/d*N;return function(Js,nl,ju){return Js[0]=nl[0]*ju[0],Js[1]=nl[1]*ju[1],Js[2]=nl[2]*ju[2],Js[3]=nl[3]*ju[3],Js}(Ui,Ui,[Fn,Fn,M?1/Ui[3]:Fn,Fn])}),vt=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(Ht=>{const Ui=R_([],e1([],Z0([],X[Ht[0]],X[Ht[1]]),Z0([],X[Ht[2]],X[Ht[1]]))),Fn=-t_(Ui,X[Ht[1]]);return Ui.concat(Fn)});return new y1(X,vt)}}class Yg{static fromPoints(l){const d=[1/0,1/0,1/0],y=[-1/0,-1/0,-1/0];for(const M of l)Om(d,d,M),A0(y,y,M);return new Yg(d,y)}static applyTransform(l,d){const y=l.getCorners();for(let M=0;M<y.length;++M)Cg(y[M],y[M],d);return Yg.fromPoints(y)}constructor(l,d){this.min=l,this.max=d,this.center=hy([],q0([],this.min,this.max),.5)}quadrant(l){const d=[l%2==0,l<2],y=hw(this.min),M=hw(this.max);for(let N=0;N<d.length;N++)y[N]=d[N]?this.min[N]:this.center[N],M[N]=d[N]?this.center[N]:this.max[N];return M[2]=this.max[2],new Yg(y,M)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}getCorners(){const l=this.min,d=this.max;return[[l[0],l[1],l[2]],[d[0],l[1],l[2]],[d[0],d[1],l[2]],[l[0],d[1],l[2]],[l[0],l[1],d[2]],[d[0],l[1],d[2]],[d[0],d[1],d[2]],[l[0],d[1],d[2]]]}intersects(l){const d=this.getCorners();let y=!0;for(let M=0;M<l.planes.length;M++){const N=l.planes[M];let X=0;for(let vt=0;vt<d.length;vt++)X+=t_(N,d[vt])+N[3]>=0;if(X===0)return 0;X!==d.length&&(y=!1)}if(y)return 2;for(let M=0;M<3;M++){let N=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let vt=0;vt<l.points.length;vt++){const Ht=l.points[vt][M]-this.min[M];N=Math.min(N,Ht),X=Math.max(X,Ht)}if(X<0||N>this.max[M]-this.min[M])return 0}return 1}}const Yy=Hp/Math.PI/2,fv=64,gx=[fv,32,16],Ky=-Yy,Qy=Yy,a2=[new Yg([Ky,Ky,Ky],[Qy,Qy,Qy]),new Yg([Ky,Ky,Ky],[0,0,Qy]),new Yg([0,Ky,Ky],[Qy,0,Qy]),new Yg([Ky,0,Ky],[0,Qy,Qy]),new Yg([0,0,Ky],[Qy,Qy,Qy])];function _x(c){return c*Yy/xx}function Eb(c,l,d,y=!0){const M=hy([],c._camera.position,c.worldSize),N=[l,d,1,1];m1(N,N,c.pixelMatrixInverse),fw(N,N,1/N[3]);const X=R_([],Z0([],N,M)),vt=c.globeMatrix,Ht=[vt[12],vt[13],vt[14]],Ui=Z0([],Ht,M),Fn=Dv(Ui),Js=R_([],Ui),nl=c.worldSize/(2*Math.PI),ju=t_(Js,X),Ku=Math.asin(nl/Fn);if(Ku<Math.acos(ju)){if(!y)return null;const Zf=[],jd=[];hy(Zf,X,Fn/ju),R_(jd,Z0(jd,Zf,Ui)),R_(X,q0(X,Ui,hy(X,jd,Math.tan(Ku)*Fn)))}const lh=[];new Hx(M,X).closestPointOnSphere(Ht,nl,lh);const Eh=R_([],Yd(vt,0)),Bh=R_([],Yd(vt,1)),Yh=R_([],Yd(vt,2)),kh=t_(Eh,lh),Vh=t_(Bh,lh),rd=t_(Yh,lh),ed=al(Math.asin(-Vh/nl));let Rd=al(Math.atan2(kh,rd));Rd=c.center.lng+function(Zf,jd){const Pf=(jd-Zf+180)%360-180;return Pf<-180?Pf+360:Pf}(c.center.lng,Rd);const kd=P0(Rd),Sf=Gh(X0(ed),0,1);return new Z1(kd,Sf)}class Tb{constructor(l,d,y){this.a=Z0([],l,y),this.b=Z0([],d,y),this.center=y;const M=R_([],this.a),N=R_([],this.b);this.angle=Math.acos(t_(M,N))}}function yx(c,l){if(c.angle===0)return null;let d;return d=c.a[l]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[l]/c.a[l]/Math.sin(c.angle)-1/Math.tan(c.angle)),d<0||d>1?null:function(y,M,N,X){const vt=Math.sin(N);return y*(Math.sin((1-X)*N)/vt)+M*(Math.sin(X*N)/vt)}(c.a[l],c.b[l],c.angle,Gh(d,0,1))+c.center[l]}function pv(c){if(c.z<=1)return a2[c.z+2*c.y+c.x];const l=Xx(H0(c));return Yg.fromPoints(l)}function v1(c,l,d){return hy(c,c,1-d),U1(c,c,l,d)}function Sb(c,l){const d=Lv(l.zoom);if(d===0)return pv(c);const y=H0(c),M=Xx(y),N=P0(y.getWest())*l.worldSize,X=P0(y.getEast())*l.worldSize,vt=X0(y.getNorth())*l.worldSize,Ht=X0(y.getSouth())*l.worldSize,Ui=[N,vt,0],Fn=[X,vt,0],Js=[N,Ht,0],nl=[X,Ht,0],ju=fx([],l.globeMatrix);return Cg(Ui,Ui,ju),Cg(Fn,Fn,ju),Cg(Js,Js,ju),Cg(nl,nl,ju),M[0]=v1(M[0],Js,d),M[1]=v1(M[1],nl,d),M[2]=v1(M[2],Fn,d),M[3]=v1(M[3],Ui,d),Yg.fromPoints(M)}function mv(c,l,d){for(const y of c)Cg(y,y,l),hy(y,y,d)}function _w(c,l,d){const y=l/c.worldSize,M=c.globeMatrix;if(d.z<=1){const kd=pv(d).getCorners();return mv(kd,M,y),Yg.fromPoints(kd)}const N=H0(d),X=Xx(N);mv(X,M,y);const vt=Number.MAX_VALUE,Ht=[-vt,-vt,-vt],Ui=[vt,vt,vt];if(N.contains(c.center)){for(const Zf of X)Om(Ui,Ui,Zf),A0(Ht,Ht,Zf);Ht[2]=0;const kd=c.point,Sf=[kd.x*y,kd.y*y,0];return Om(Ui,Ui,Sf),A0(Ht,Ht,Sf),new Yg(Ui,Ht)}const Fn=[M[12]*y,M[13]*y,M[14]*y],Js=N.getCenter(),nl=Gh(c.center.lat,-o_,o_),ju=Gh(Js.lat,-o_,o_),Ku=P0(c.center.lng),lh=X0(nl);let Eh=Ku-P0(Js.lng);const Bh=lh-X0(ju);Eh>.5?Eh-=1:Eh<-.5&&(Eh+=1);let Yh=0;Math.abs(Eh)>Math.abs(Bh)?Yh=Eh>=0?1:3:(Yh=Bh>=0?0:2,U1(Fn,Fn,[M[4]*y,M[5]*y,M[6]*y],-Math.sin(ih(Bh>=0?N.getSouth():N.getNorth()))*Yy));const kh=X[Yh],Vh=X[(Yh+1)%4],rd=new Tb(kh,Vh,Fn),ed=[yx(rd,0)||kh[0],yx(rd,1)||kh[1],yx(rd,2)||kh[2]],Rd=Lv(c.zoom);if(Rd>0){const kd=function({x:Zf,y:jd,z:Pf},Rf,Uf,Xf,Hd){const up=1/(1<<Pf);let jp=Zf*up,vp=jp+up,Rp=jd*up,dp=Rp+up,Xp=0;const xm=(jp+vp)/2-Xf;return xm>.5?Xp=-1:xm<-.5&&(Xp=1),jp=((jp+Xp)*Rf-(Xf*=Rf))*Uf+Xf,vp=((vp+Xp)*Rf-Xf)*Uf+Xf,Rp=(Rp*Rf-(Hd*=Rf))*Uf+Hd,dp=(dp*Rf-Hd)*Uf+Hd,[[jp,dp,0],[vp,dp,0],[vp,Rp,0],[jp,Rp,0]]}(d,l,c._pixelsPerMercatorPixel,Ku,lh);for(let Zf=0;Zf<X.length;Zf++)v1(X[Zf],kd[Zf],Rd);const Sf=q0([],kd[Yh],kd[(Yh+1)%4]);hy(Sf,Sf,.5),v1(ed,Sf,Rd)}for(const kd of X)Om(Ui,Ui,kd),A0(Ht,Ht,kd);return Ui[2]=Math.min(kh[2],Vh[2]),Om(Ui,Ui,ed),A0(Ht,Ht,ed),new Yg(Ui,Ht)}function H0({x:c,y:l,z:d}){const y=1/(1<<d),M=new Tm(e0(c*y),Mg((l+1)*y)),N=new Tm(e0((c+1)*y),Mg(l*y));return new Qv(M,N)}function Xx(c){const l=ih(c.getNorth()),d=ih(c.getSouth()),y=Math.cos(l),M=Math.cos(d),N=Math.sin(l),X=Math.sin(d),vt=c.getWest(),Ht=c.getEast();return[x1(M,X,vt),x1(M,X,Ht),x1(y,N,Ht),x1(y,N,vt)]}function x1(c,l,d,y=Yy){return d=ih(d),[c*Math.sin(d)*y,-l*y,c*Math.cos(d)*y]}function b1(c,l,d){return x1(Math.cos(ih(c)),Math.sin(ih(c)),l,d)}function G1(c,l,d,y){const M=1<<d.z,N=(c/Hp+d.x)/M;return b1(Mg((l/Hp+d.y)/M),e0(N),y)}function Wx({min:c,max:l}){return 16383/Math.max(l[0]-c[0],l[1]-c[1],l[2]-c[2])}const yw=new Float64Array(16);function j1(c){const l=Wx(c),d=sw(yw,[l,l,l]);return F1(d,d,((y=[])[0]=-(M=c.min)[0],y[1]=-M[1],y[2]=-M[2],y));var y,M}function Yx(c){const l=(y=c.min,(d=yw)[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=y[0],d[13]=y[1],d[14]=y[2],d[15]=1,d);var d,y;const M=1/Wx(c);return Jv(l,l,[M,M,M])}function Ib(c,l,d,y,M){const N=function(Ht){const Ui=Hp/(2*Math.PI);return Ht/(2*Math.PI)/Ui}(d),X=[c,l,-d/(2*Math.PI)],vt=M0(new Float64Array(16));return F1(vt,vt,X),Jv(vt,vt,[N,N,N]),jx(vt,vt,ih(-M)),qx(vt,vt,ih(-y)),vt}function Lv(c){return ud(5,6,c)}function Cb(c,l){const d=b1(l.lat,l.lng),y=function(Ku){const lh=b1(Ku._center.lat,Ku._center.lng);let Eh=e1([],$g(0,1,0),lh);const Bh=lw([],-Ku.angle,lh);Eh=Cg(Eh,Eh,Bh),lw(Bh,-Ku._pitch,Eh);const Yh=R_([],lh);return hy(Yh,Yh,_x(Ku.cameraToCenterDistance/Ku.pixelsPerMeter)),Cg(Yh,Yh,Bh),q0([],lh,Yh)}(c);return X=(M=Zx([],y,d))[0],vt=M[1],Ht=M[2],Ui=(N=d)[0],Fn=N[1],Js=N[2],ju=(nl=Math.sqrt(X*X+vt*vt+Ht*Ht)*Math.sqrt(Ui*Ui+Fn*Fn+Js*Js))&&t_(M,N)/nl,Math.acos(Math.min(Math.max(ju,-1),1));var M,N,X,vt,Ht,Ui,Fn,Js,nl,ju}function q1(c,l){return Cb(c,l)>Math.PI/2*1.01}const vx=ih(85),Kx=Math.cos(vx),s2=Math.sin(vx),xx=63710088e-1,vw=2*Math.PI*xx;class Tm{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tm(Tf(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const d=Math.PI/180,y=this.lat*d,M=l.lat*d,N=Math.sin(y)*Math.sin(M)+Math.cos(y)*Math.cos(M)*Math.cos((l.lng-this.lng)*d);return xx*Math.acos(Math.min(N,1))}toBounds(l=0){const d=360*l/40075017,y=d/Math.cos(Math.PI/180*this.lat);return new Qv(new Tm(this.lng-y,this.lat-d),new Tm(this.lng+y,this.lat+d))}toEcef(l){const d=_x(l);return b1(this.lat,this.lng,Yy+d)}static convert(l){if(l instanceof Tm)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Tm(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Tm(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function t1(c){return vw*Math.cos(c*Math.PI/180)}function P0(c){return(180+c)/360}function X0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Jy(c,l){return c/t1(l)}function e0(c){return 360*c-180}function Mg(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Mb(c,l){return c*t1(Mg(l))}const o_=85.051129;function xw(c){return 1/Math.cos(c*Math.PI/180)}class Z1{constructor(l,d,y=0){this.x=+l,this.y=+d,this.z=+y}static fromLngLat(l,d=0){const y=Tm.convert(l);return new Z1(P0(y.lng),X0(y.lat),Jy(d,y.lat))}toLngLat(){return new Tm(e0(this.x),Mg(this.y))}toAltitude(){return Mb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vw*xw(Mg(this.y))}}function Ab(c,l,d,y,M,N,X,vt,Ht){const Ui=(l+y)/2,Fn=(d+M)/2,Js=new $s(Ui,Fn);vt(Js),function(nl,ju,Ku,lh,Eh,Bh){const Yh=Ku-Eh,kh=lh-Bh;return Math.abs((lh-ju)*Yh-(Ku-nl)*kh)/Math.hypot(Yh,kh)}(Js.x,Js.y,N.x,N.y,X.x,X.y)>=Ht?(Ab(c,l,d,Ui,Fn,N,Js,vt,Ht),Ab(c,Ui,Fn,y,M,Js,X,vt,Ht)):c.push(X)}function bx(c,l,d){let y=c[0],M=y.x,N=y.y;l(y);const X=[y];for(let vt=1;vt<c.length;vt++){const Ht=c[vt],{x:Ui,y:Fn}=Ht;l(Ht),Ab(X,M,N,Ui,Fn,y,Ht,l,d),M=Ui,N=Fn,y=Ht}return X}function wx(c,l,d,y){if(y(l,d)){const M=l.add(d)._mult(.5);wx(c,l,M,y),wx(c,M,d,y)}else c.push(d)}function l2(c,l){let d=c[0];const y=[d];for(let M=1;M<c.length;M++){const N=c[M];wx(y,d,N,l),d=N}return y}const Ex=Math.pow(2,14)-1,Qx=-Ex-1;function H1(c,l){const d=Math.round(c.x*l),y=Math.round(c.y*l);return c.x=Gh(d,Qx,Ex),c.y=Gh(y,Qx,Ex),(d<c.x||d>c.x+1||y<c.y||y>c.y+1)&&rp("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function Rv(c,l,d){const y=c.loadGeometry(),M=c.extent,N=Hp/M;if(l&&d&&d.projection.isReprojectedInTileSpace){const X=1<<l.z,{scale:vt,x:Ht,y:Ui,projection:Fn}=d,Js=nl=>{const ju=e0((l.x+nl.x/M)/X),Ku=Mg((l.y+nl.y/M)/X),lh=Fn.project(ju,Ku);nl.x=(lh.x*vt-Ht)*M,nl.y=(lh.y*vt-Ui)*M};for(let nl=0;nl<y.length;nl++)if(c.type!==1)y[nl]=bx(y[nl],Js,1);else{const ju=[];for(const Ku of y[nl])Ku.x<0||Ku.x>=M||Ku.y<0||Ku.y>=M||(Js(Ku),ju.push(Ku));y[nl]=ju}}for(const X of y)for(const vt of X)H1(vt,N);return y}function Ov(c,l){return{type:c.type,id:c.id,properties:c.properties,geometry:l?Rv(c):[]}}function Tx(c,l,d,y,M){c.emplaceBack(2*l+(y+1)/2,2*d+(M+1)/2)}function w1(c,l,d){c.emplaceBack(l.x,l.y,l.z,d[0]*16384,d[1]*16384,d[2]*16384)}class Sx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.projection=l.projection,this.layoutVertexArray=new zp,this.indexArray=new y_,this.segments=new Og,this.programConfigurations=new f1(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,y,M){const N=this.layers[0],X=[];let vt=null;N.type==="circle"&&(vt=N.layout.get("circle-sort-key"));for(const{feature:Ui,id:Fn,index:Js,sourceLayerIndex:nl}of l){const ju=this.layers[0]._featureFilter.needGeometry,Ku=Ov(Ui,ju);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),Ku,y))continue;const lh=vt?vt.evaluate(Ku,{},y):void 0,Eh={id:Fn,properties:Ui.properties,type:Ui.type,sourceLayerIndex:nl,index:Js,geometry:ju?Ku.geometry:Rv(Ui,y,M),patterns:{},sortKey:lh};X.push(Eh)}vt&&X.sort((Ui,Fn)=>Ui.sortKey-Fn.sortKey);let Ht=null;M.projection.name==="globe"&&(this.globeExtVertexArray=new Cy,Ht=M.projection);for(const Ui of X){const{geometry:Fn,index:Js,sourceLayerIndex:nl}=Ui,ju=l[Js].feature;this.addFeature(Ui,Fn,Js,d.availableImages,y,Ht),d.featureIndex.insert(ju,Fn,Js,nl,this.index)}}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,t2.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,dx.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(l,d,y,M,N,X){for(const vt of d)for(const Ht of vt){const Ui=Ht.x,Fn=Ht.y;if(Ui<0||Ui>=Hp||Fn<0||Fn>=Hp)continue;if(X){const ju=X.projectTilePoint(Ui,Fn,N),Ku=X.upVector(N,Ui,Fn),lh=this.globeExtVertexArray;w1(lh,ju,Ku),w1(lh,ju,Ku),w1(lh,ju,Ku),w1(lh,ju,Ku)}const Js=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),nl=Js.vertexLength;Tx(this.layoutVertexArray,Ui,Fn,-1,-1),Tx(this.layoutVertexArray,Ui,Fn,1,-1),Tx(this.layoutVertexArray,Ui,Fn,1,1),Tx(this.layoutVertexArray,Ui,Fn,-1,1),this.indexArray.emplaceBack(nl,nl+1,nl+2),this.indexArray.emplaceBack(nl,nl+2,nl+3),Js.vertexLength+=4,Js.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,{},M,N)}}function bw(c,l){for(let d=0;d<c.length;d++)if(i1(l,c[d]))return!0;for(let d=0;d<l.length;d++)if(i1(c,l[d]))return!0;return!!Pb(c,l)}function c2(c,l,d){return!!i1(c,l)||!!Sg(l,c,d)}function ww(c,l){if(c.length===1)return Db(l,c[0]);for(let d=0;d<l.length;d++){const y=l[d];for(let M=0;M<y.length;M++)if(i1(c,y[M]))return!0}for(let d=0;d<c.length;d++)if(Db(l,c[d]))return!0;for(let d=0;d<l.length;d++)if(Pb(c,l[d]))return!0;return!1}function u2(c,l,d){if(c.length>1){if(Pb(c,l))return!0;for(let y=0;y<l.length;y++)if(Sg(l[y],c,d))return!0}for(let y=0;y<c.length;y++)if(Sg(c[y],l,d))return!0;return!1}function Pb(c,l){if(c.length===0||l.length===0)return!1;for(let d=0;d<c.length-1;d++){const y=c[d],M=c[d+1];for(let N=0;N<l.length-1;N++)if(kb(y,M,l[N],l[N+1]))return!0}return!1}function kb(c,l,d,y){return jf(c,d,y)!==jf(l,d,y)&&jf(c,l,d)!==jf(c,l,y)}function Sg(c,l,d){const y=d*d;if(l.length===1)return c.distSqr(l[0])<y;for(let M=1;M<l.length;M++)if(E1(c,l[M-1],l[M])<y)return!0;return!1}function E1(c,l,d){const y=l.distSqr(d);if(y===0)return c.distSqr(l);const M=((c.x-l.x)*(d.x-l.x)+(c.y-l.y)*(d.y-l.y))/y;return c.distSqr(M<0?l:M>1?d:d.sub(l)._mult(M)._add(l))}function Db(c,l){let d,y,M,N=!1;for(let X=0;X<c.length;X++){d=c[X];for(let vt=0,Ht=d.length-1;vt<d.length;Ht=vt++)y=d[vt],M=d[Ht],y.y>l.y!=M.y>l.y&&l.x<(M.x-y.x)*(l.y-y.y)/(M.y-y.y)+y.x&&(N=!N)}return N}function i1(c,l){let d=!1;for(let y=0,M=c.length-1;y<c.length;M=y++){const N=c[y],X=c[M];N.y>l.y!=X.y>l.y&&l.x<(X.x-N.x)*(l.y-N.y)/(X.y-N.y)+N.x&&(d=!d)}return d}function Lb(c,l,d,y,M){for(const X of c)if(l<=X.x&&d<=X.y&&y>=X.x&&M>=X.y)return!0;const N=[new $s(l,d),new $s(l,M),new $s(y,M),new $s(y,d)];if(c.length>2){for(const X of N)if(i1(c,X))return!0}for(let X=0;X<c.length-1;X++)if(Ew(c[X],c[X+1],N))return!0;return!1}function Ew(c,l,d){const y=d[0],M=d[2];if(c.x<y.x&&l.x<y.x||c.x>M.x&&l.x>M.x||c.y<y.y&&l.y<y.y||c.y>M.y&&l.y>M.y)return!1;const N=jf(c,l,d[0]);return N!==jf(c,l,d[1])||N!==jf(c,l,d[2])||N!==jf(c,l,d[3])}function T1(c,l,d){const y=l.paint.get(c).value;return y.kind==="constant"?y.value:d.programConfigurations.get(l.id).getMaxValue(c)}function Ix(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Jx(c,l,d,y,M){if(!l[0]&&!l[1])return c;const N=$s.convert(l)._mult(M);d==="viewport"&&N._rotate(-y);const X=[];for(let vt=0;vt<c.length;vt++)X.push(c[vt].sub(N));return X}function Cx(c,l,d,y){const M=$s.convert(c)._mult(y);return l==="viewport"&&M._rotate(-d),M}Ip(Sx,"CircleBucket",{omit:["layers"]});const Tw=new $f({"circle-sort-key":new $d(Pd.layout_circle["circle-sort-key"])});var Rb={paint:new $f({"circle-radius":new $d(Pd.paint_circle["circle-radius"]),"circle-color":new $d(Pd.paint_circle["circle-color"]),"circle-blur":new $d(Pd.paint_circle["circle-blur"]),"circle-opacity":new $d(Pd.paint_circle["circle-opacity"]),"circle-translate":new pd(Pd.paint_circle["circle-translate"]),"circle-translate-anchor":new pd(Pd.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pd(Pd.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pd(Pd.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $d(Pd.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $d(Pd.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $d(Pd.paint_circle["circle-stroke-opacity"])}),layout:Tw};function Ob(c,l,d,y,M,N,X,vt,Ht){if(N&&c.queryGeometry.isAboveHorizon)return!1;N&&(Ht*=c.pixelToTileUnitsFactor);const Ui=c.tileID.canonical,Fn=d.projection.upVectorScale(Ui,d.center.lat,d.worldSize).metersToTile;for(const Js of l)for(const nl of Js){const ju=nl.add(vt),Ku=M&&d.elevation?d.elevation.exaggeration()*M.getElevationAt(ju.x,ju.y,!0):0,lh=d.projection.projectTilePoint(ju.x,ju.y,Ui);if(Ku>0){const kh=d.projection.upVector(Ui,ju.x,ju.y);lh.x+=kh[0]*Fn*Ku,lh.y+=kh[1]*Fn*Ku,lh.z+=kh[2]*Fn*Ku}const Eh=N?ju:t0(lh.x,lh.y,lh.z,y),Bh=N?c.tilespaceRays.map(kh=>Iw(kh,Ku)):c.queryGeometry.screenGeometry,Yh=m1([],[lh.x,lh.y,lh.z,1],y);if(!X&&N?Ht*=Yh[3]/d.cameraToCenterDistance:X&&!N&&(Ht*=d.cameraToCenterDistance/Yh[3]),N){const kh=Mg((nl.y/Hp+Ui.y)/(1<<Ui.z));Ht/=d.projection.pixelsPerMeter(kh,1)/Jy(1,kh)}if(c2(Bh,Eh,Ht))return!0}return!1}function t0(c,l,d,y){const M=m1([],[c,l,d,1],y);return new $s(M[0]/M[3],M[1]/M[3])}const X1=$g(0,0,0),Sw=$g(0,0,1);function Iw(c,l){const d=vb();return X1[2]=l,c.intersectsPlane(X1,Sw,d),new $s(d[0],d[1])}class $b extends Sx{}function Bb(c,{width:l,height:d},y,M){if(M){if(M instanceof Uint8ClampedArray)M=new Uint8Array(M.buffer);else if(M.length!==l*d*y)throw new RangeError("mismatched image size")}else M=new Uint8Array(l*d*y);return c.width=l,c.height=d,c.data=M,c}function Nb(c,l,d){const{width:y,height:M}=l;y===c.width&&M===c.height||(eb(c,l,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,y),height:Math.min(c.height,M)},d),c.width=y,c.height=M,c.data=l.data)}function eb(c,l,d,y,M,N){if(M.width===0||M.height===0)return l;if(M.width>c.width||M.height>c.height||d.x>c.width-M.width||d.y>c.height-M.height)throw new RangeError("out of range source coordinates for image copy");if(M.width>l.width||M.height>l.height||y.x>l.width-M.width||y.y>l.height-M.height)throw new RangeError("out of range destination coordinates for image copy");const X=c.data,vt=l.data;for(let Ht=0;Ht<M.height;Ht++){const Ui=((d.y+Ht)*c.width+d.x)*N,Fn=((y.y+Ht)*l.width+y.x)*N;for(let Js=0;Js<M.width*N;Js++)vt[Fn+Js]=X[Ui+Js]}return l}Ip($b,"HeatmapBucket",{omit:["layers"]});class $v{constructor(l,d){Bb(this,l,1,d)}resize(l){Nb(this,new $v(l),1)}clone(){return new $v({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,y,M,N){eb(l,d,y,M,N,1)}}class Q_{constructor(l,d){Bb(this,l,4,d)}resize(l){Nb(this,new Q_(l),4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Q_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,y,M,N){eb(l,d,y,M,N,4)}}Ip($v,"AlphaImage"),Ip(Q_,"RGBAImage");var Cw={paint:new $f({"heatmap-radius":new $d(Pd.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $d(Pd.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pd(Pd.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yf(Pd.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pd(Pd.paint_heatmap["heatmap-opacity"])})};function S1(c){const l={},d=c.resolution||256,y=c.clips?c.clips.length:1,M=c.image||new Q_({width:d,height:y}),N=(X,vt,Ht)=>{l[c.evaluationKey]=Ht;const Ui=c.expression.evaluate(l);M.data[X+vt+0]=Math.floor(255*Ui.r/Ui.a),M.data[X+vt+1]=Math.floor(255*Ui.g/Ui.a),M.data[X+vt+2]=Math.floor(255*Ui.b/Ui.a),M.data[X+vt+3]=Math.floor(255*Ui.a)};if(c.clips)for(let X=0,vt=0;X<y;++X,vt+=4*d)for(let Ht=0,Ui=0;Ht<d;Ht++,Ui+=4){const Fn=Ht/(d-1),{start:Js,end:nl}=c.clips[X];N(vt,Ui,Js*(1-Fn)+nl*Fn)}else for(let X=0,vt=0;X<d;X++,vt+=4)N(0,vt,X/(d-1));return M}var zb={paint:new $f({"hillshade-illumination-direction":new pd(Pd.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pd(Pd.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pd(Pd.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pd(Pd.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pd(Pd.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pd(Pd.paint_hillshade["hillshade-accent-color"])})};const Mw=Lp([{name:"a_pos",components:2,type:"Int16"}],4),{members:h2}=Mw;var W1={};function Y1(c,l,d){d=d||2;var y,M,N,X,vt,Ht,Ui,Fn=l&&l.length,Js=Fn?l[0]*d:c.length,nl=Mx(c,0,Js,d,!0),ju=[];if(!nl||nl.next===nl.prev)return ju;if(Fn&&(nl=function(lh,Eh,Bh,Yh){var kh,Vh,rd,ed=[];for(kh=0,Vh=Eh.length;kh<Vh;kh++)(rd=Mx(lh,Eh[kh]*Yh,kh<Vh-1?Eh[kh+1]*Yh:lh.length,Yh,!1))===rd.next&&(rd.steiner=!0),ed.push(Bn(rd));for(ed.sort(j),kh=0;kh<ed.length;kh++)Bh=ut(ed[kh],Bh);return Bh}(c,l,nl,d)),c.length>80*d){y=N=c[0],M=X=c[1];for(var Ku=d;Ku<Js;Ku+=d)(vt=c[Ku])<y&&(y=vt),(Ht=c[Ku+1])<M&&(M=Ht),vt>N&&(N=vt),Ht>X&&(X=Ht);Ui=(Ui=Math.max(N-y,X-M))!==0?32767/Ui:0}return I1(nl,ju,d,y,M,Ui,0),ju}function Mx(c,l,d,y,M){var N,X;if(M===Nd(c,l,d,y)>0)for(N=l;N<d;N+=y)X=bd(N,c[N],c[N+1],X);else for(N=d-y;N>=l;N-=y)X=bd(N,c[N],c[N+1],X);return X&&oh(X,X.next)&&(Bd(X),X=X.next),X}function W0(c,l){if(!c)return c;l||(l=c);var d,y=c;do if(d=!1,y.steiner||!oh(y,y.next)&&Ju(y.prev,y,y.next)!==0)y=y.next;else{if(Bd(y),(y=l=y.prev)===y.next)break;d=!0}while(d||y!==l);return l}function I1(c,l,d,y,M,N,X){if(c){!X&&N&&function(Fn,Js,nl,ju){var Ku=Fn;do Ku.z===0&&(Ku.z=fi(Ku.x,Ku.y,Js,nl,ju)),Ku.prevZ=Ku.prev,Ku.nextZ=Ku.next,Ku=Ku.next;while(Ku!==Fn);Ku.prevZ.nextZ=null,Ku.prevZ=null,function(lh){var Eh,Bh,Yh,kh,Vh,rd,ed,Rd,kd=1;do{for(Bh=lh,lh=null,Vh=null,rd=0;Bh;){for(rd++,Yh=Bh,ed=0,Eh=0;Eh<kd&&(ed++,Yh=Yh.nextZ);Eh++);for(Rd=kd;ed>0||Rd>0&&Yh;)ed!==0&&(Rd===0||!Yh||Bh.z<=Yh.z)?(kh=Bh,Bh=Bh.nextZ,ed--):(kh=Yh,Yh=Yh.nextZ,Rd--),Vh?Vh.nextZ=kh:lh=kh,kh.prevZ=Vh,Vh=kh;Bh=Yh}Vh.nextZ=null,kd*=2}while(rd>1)}(Ku)}(c,y,M,N);for(var vt,Ht,Ui=c;c.prev!==c.next;)if(vt=c.prev,Ht=c.next,N?_(c,y,M,N):d2(c))l.push(vt.i/d|0),l.push(c.i/d|0),l.push(Ht.i/d|0),Bd(c),c=Ht.next,Ui=Ht.next;else if((c=Ht)===Ui){X?X===1?I1(c=p(W0(c),l,d),l,d,y,M,N,2):X===2&&S(c,l,d,y,M,N):I1(W0(c),l,d,y,M,N,1);break}}}function d2(c){var l=c.prev,d=c,y=c.next;if(Ju(l,d,y)>=0)return!1;for(var M=l.x,N=d.x,X=y.x,vt=l.y,Ht=d.y,Ui=y.y,Fn=M<N?M<X?M:X:N<X?N:X,Js=vt<Ht?vt<Ui?vt:Ui:Ht<Ui?Ht:Ui,nl=M>N?M>X?M:X:N>X?N:X,ju=vt>Ht?vt>Ui?vt:Ui:Ht>Ui?Ht:Ui,Ku=y.next;Ku!==l;){if(Ku.x>=Fn&&Ku.x<=nl&&Ku.y>=Js&&Ku.y<=ju&&us(M,vt,N,Ht,X,Ui,Ku.x,Ku.y)&&Ju(Ku.prev,Ku,Ku.next)>=0)return!1;Ku=Ku.next}return!0}function _(c,l,d,y){var M=c.prev,N=c,X=c.next;if(Ju(M,N,X)>=0)return!1;for(var vt=M.x,Ht=N.x,Ui=X.x,Fn=M.y,Js=N.y,nl=X.y,ju=vt<Ht?vt<Ui?vt:Ui:Ht<Ui?Ht:Ui,Ku=Fn<Js?Fn<nl?Fn:nl:Js<nl?Js:nl,lh=vt>Ht?vt>Ui?vt:Ui:Ht>Ui?Ht:Ui,Eh=Fn>Js?Fn>nl?Fn:nl:Js>nl?Js:nl,Bh=fi(ju,Ku,l,d,y),Yh=fi(lh,Eh,l,d,y),kh=c.prevZ,Vh=c.nextZ;kh&&kh.z>=Bh&&Vh&&Vh.z<=Yh;){if(kh.x>=ju&&kh.x<=lh&&kh.y>=Ku&&kh.y<=Eh&&kh!==M&&kh!==X&&us(vt,Fn,Ht,Js,Ui,nl,kh.x,kh.y)&&Ju(kh.prev,kh,kh.next)>=0||(kh=kh.prevZ,Vh.x>=ju&&Vh.x<=lh&&Vh.y>=Ku&&Vh.y<=Eh&&Vh!==M&&Vh!==X&&us(vt,Fn,Ht,Js,Ui,nl,Vh.x,Vh.y)&&Ju(Vh.prev,Vh,Vh.next)>=0))return!1;Vh=Vh.nextZ}for(;kh&&kh.z>=Bh;){if(kh.x>=ju&&kh.x<=lh&&kh.y>=Ku&&kh.y<=Eh&&kh!==M&&kh!==X&&us(vt,Fn,Ht,Js,Ui,nl,kh.x,kh.y)&&Ju(kh.prev,kh,kh.next)>=0)return!1;kh=kh.prevZ}for(;Vh&&Vh.z<=Yh;){if(Vh.x>=ju&&Vh.x<=lh&&Vh.y>=Ku&&Vh.y<=Eh&&Vh!==M&&Vh!==X&&us(vt,Fn,Ht,Js,Ui,nl,Vh.x,Vh.y)&&Ju(Vh.prev,Vh,Vh.next)>=0)return!1;Vh=Vh.nextZ}return!0}function p(c,l,d){var y=c;do{var M=y.prev,N=y.next.next;!oh(M,N)&&gh(M,y,y.next,N)&&Wh(M,N)&&Wh(N,M)&&(l.push(M.i/d|0),l.push(y.i/d|0),l.push(N.i/d|0),Bd(y),Bd(y.next),y=c=N),y=y.next}while(y!==c);return W0(y)}function S(c,l,d,y,M,N){var X=c;do{for(var vt=X.next.next;vt!==X.prev;){if(X.i!==vt.i&&ul(X,vt)){var Ht=Zh(X,vt);return X=W0(X,X.next),Ht=W0(Ht,Ht.next),I1(X,l,d,y,M,N,0),void I1(Ht,l,d,y,M,N,0)}vt=vt.next}X=X.next}while(X!==c)}function j(c,l){return c.x-l.x}function ut(c,l){var d=function(M,N){var X,vt=N,Ht=M.x,Ui=M.y,Fn=-1/0;do{if(Ui<=vt.y&&Ui>=vt.next.y&&vt.next.y!==vt.y){var Js=vt.x+(Ui-vt.y)*(vt.next.x-vt.x)/(vt.next.y-vt.y);if(Js<=Ht&&Js>Fn&&(Fn=Js,X=vt.x<vt.next.x?vt:vt.next,Js===Ht))return X}vt=vt.next}while(vt!==N);if(!X)return null;var nl,ju=X,Ku=X.x,lh=X.y,Eh=1/0;vt=X;do Ht>=vt.x&&vt.x>=Ku&&Ht!==vt.x&&us(Ui<lh?Ht:Fn,Ui,Ku,lh,Ui<lh?Fn:Ht,Ui,vt.x,vt.y)&&(nl=Math.abs(Ui-vt.y)/(Ht-vt.x),Wh(vt,M)&&(nl<Eh||nl===Eh&&(vt.x>X.x||vt.x===X.x&&Ot(X,vt)))&&(X=vt,Eh=nl)),vt=vt.next;while(vt!==ju);return X}(c,l);if(!d)return l;var y=Zh(d,c);return W0(y,y.next),W0(d,d.next)}function Ot(c,l){return Ju(c.prev,c,l.prev)<0&&Ju(l.next,c,c.next)<0}function fi(c,l,d,y,M){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-d)*M|0)|c<<8))|c<<4))|c<<2))|c<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-y)*M|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Bn(c){var l=c,d=c;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==c);return d}function us(c,l,d,y,M,N,X,vt){return(M-X)*(l-vt)>=(c-X)*(N-vt)&&(c-X)*(y-vt)>=(d-X)*(l-vt)&&(d-X)*(N-vt)>=(M-X)*(y-vt)}function ul(c,l){return c.next.i!==l.i&&c.prev.i!==l.i&&!function(d,y){var M=d;do{if(M.i!==d.i&&M.next.i!==d.i&&M.i!==y.i&&M.next.i!==y.i&&gh(M,M.next,d,y))return!0;M=M.next}while(M!==d);return!1}(c,l)&&(Wh(c,l)&&Wh(l,c)&&function(d,y){var M=d,N=!1,X=(d.x+y.x)/2,vt=(d.y+y.y)/2;do M.y>vt!=M.next.y>vt&&M.next.y!==M.y&&X<(M.next.x-M.x)*(vt-M.y)/(M.next.y-M.y)+M.x&&(N=!N),M=M.next;while(M!==d);return N}(c,l)&&(Ju(c.prev,c,l.prev)||Ju(c,l.prev,l))||oh(c,l)&&Ju(c.prev,c,c.next)>0&&Ju(l.prev,l,l.next)>0)}function Ju(c,l,d){return(l.y-c.y)*(d.x-l.x)-(l.x-c.x)*(d.y-l.y)}function oh(c,l){return c.x===l.x&&c.y===l.y}function gh(c,l,d,y){var M=bh(Ju(c,l,d)),N=bh(Ju(c,l,y)),X=bh(Ju(d,y,c)),vt=bh(Ju(d,y,l));return M!==N&&X!==vt||!(M!==0||!xh(c,d,l))||!(N!==0||!xh(c,y,l))||!(X!==0||!xh(d,c,y))||!(vt!==0||!xh(d,l,y))}function xh(c,l,d){return l.x<=Math.max(c.x,d.x)&&l.x>=Math.min(c.x,d.x)&&l.y<=Math.max(c.y,d.y)&&l.y>=Math.min(c.y,d.y)}function bh(c){return c>0?1:c<0?-1:0}function Wh(c,l){return Ju(c.prev,c,c.next)<0?Ju(c,l,c.next)>=0&&Ju(c,c.prev,l)>=0:Ju(c,l,c.prev)<0||Ju(c,c.next,l)<0}function Zh(c,l){var d=new dd(c.i,c.x,c.y),y=new dd(l.i,l.x,l.y),M=c.next,N=l.prev;return c.next=l,l.prev=c,d.next=M,M.prev=d,y.next=d,d.prev=y,N.next=y,y.prev=N,y}function bd(c,l,d,y){var M=new dd(c,l,d);return y?(M.next=y.next,M.prev=y,y.next.prev=M,y.next=M):(M.prev=M,M.next=M),M}function Bd(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function dd(c,l,d){this.i=c,this.x=l,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nd(c,l,d,y){for(var M=0,N=l,X=d-y;N<d;N+=y)M+=(c[X]-c[N])*(c[N+1]+c[X+1]),X=N;return M}function Ff(c,l,d,y,M){Bf(c,l,d||0,y||c.length-1,M||Bp)}function Bf(c,l,d,y,M){for(;y>d;){if(y-d>600){var N=y-d+1,X=l-d+1,vt=Math.log(N),Ht=.5*Math.exp(2*vt/3),Ui=.5*Math.sqrt(vt*Ht*(N-Ht)/N)*(X-N/2<0?-1:1);Bf(c,l,Math.max(d,Math.floor(l-X*Ht/N+Ui)),Math.min(y,Math.floor(l+(N-X)*Ht/N+Ui)),M)}var Fn=c[l],Js=d,nl=y;for(Ap(c,d,l),M(c[y],Fn)>0&&Ap(c,d,y);Js<nl;){for(Ap(c,Js,nl),Js++,nl--;M(c[Js],Fn)<0;)Js++;for(;M(c[nl],Fn)>0;)nl--}M(c[d],Fn)===0?Ap(c,d,nl):Ap(c,++nl,y),nl<=l&&(d=nl+1),l<=nl&&(y=nl-1)}}function Ap(c,l,d){var y=c[l];c[l]=c[d],c[d]=y}function Bp(c,l){return c<l?-1:c>l?1:0}function wp(c,l){const d=c.length;if(d<=1)return[c];const y=[];let M,N;for(let X=0;X<d;X++){const vt=yd(c[X]);vt!==0&&(c[X].area=Math.abs(vt),N===void 0&&(N=vt<0),N===vt<0?(M&&y.push(M),M=[c[X]]):M.push(c[X]))}if(M&&y.push(M),l>1)for(let X=0;X<y.length;X++)y[X].length<=l||(Ff(y[X],l,1,y[X].length-1,yp),y[X]=y[X].slice(0,l));return y}function yp(c,l){return l.area-c.area}function cp(c,l,d){const y=d.patternDependencies;let M=!1;for(const N of l){const X=N.paint.get(`${c}-pattern`);X.isConstant()||(M=!0);const vt=X.constantOr(null);vt&&(M=!0,y[vt]=!0)}return M}function Ep(c,l,d,y,M){const N=M.patternDependencies;for(const X of l){const vt=X.paint.get(`${c}-pattern`).value;if(vt.kind!=="constant"){let Ht=vt.evaluate({zoom:y},d,{},M.availableImages);Ht=Ht&&Ht.name?Ht.name:Ht,N[Ht]=!0,d.patterns[X.id]=Ht}}return d}({get exports(){return W1},set exports(c){W1=c}}).exports=Y1,W1.default=Y1,Y1.deviation=function(c,l,d,y){var M=l&&l.length,N=Math.abs(Nd(c,0,M?l[0]*d:c.length,d));if(M)for(var X=0,vt=l.length;X<vt;X++)N-=Math.abs(Nd(c,l[X]*d,X<vt-1?l[X+1]*d:c.length,d));var Ht=0;for(X=0;X<y.length;X+=3){var Ui=y[X]*d,Fn=y[X+1]*d,Js=y[X+2]*d;Ht+=Math.abs((c[Ui]-c[Js])*(c[Fn+1]-c[Ui+1])-(c[Ui]-c[Fn])*(c[Js+1]-c[Ui+1]))}return N===0&&Ht===0?0:Math.abs((Ht-N)/N)},Y1.flatten=function(c){for(var l=c[0][0].length,d={vertices:[],holes:[],dimensions:l},y=0,M=0;M<c.length;M++){for(var N=0;N<c[M].length;N++)for(var X=0;X<l;X++)d.vertices.push(c[M][N][X]);M>0&&d.holes.push(y+=c[M-1].length)}return d};class gp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zp,this.indexArray=new y_,this.indexArray2=new dv,this.programConfigurations=new f1(l.layers,l.zoom),this.segments=new Og,this.segments2=new Og,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.projection=l.projection}populate(l,d,y,M){this.hasPattern=cp("fill",this.layers,d);const N=this.layers[0].layout.get("fill-sort-key"),X=[];for(const{feature:vt,id:Ht,index:Ui,sourceLayerIndex:Fn}of l){const Js=this.layers[0]._featureFilter.needGeometry,nl=Ov(vt,Js);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),nl,y))continue;const ju=N?N.evaluate(nl,{},y,d.availableImages):void 0,Ku={id:Ht,properties:vt.properties,type:vt.type,sourceLayerIndex:Fn,index:Ui,geometry:Js?nl.geometry:Rv(vt,y,M),patterns:{},sortKey:ju};X.push(Ku)}N&&X.sort((vt,Ht)=>vt.sortKey-Ht.sortKey);for(const vt of X){const{geometry:Ht,index:Ui,sourceLayerIndex:Fn}=vt;if(this.hasPattern){const Js=Ep("fill",this.layers,vt,this.zoom,d);this.patternFeatures.push(Js)}else this.addFeature(vt,Ht,Ui,y,{},d.availableImages);d.featureIndex.insert(l[Ui].feature,Ht,Ui,Fn,this.index)}}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}addFeatures(l,d,y,M,N){for(const X of this.patternFeatures)this.addFeature(X,X.geometry,X.index,d,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,h2),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,y,M,N,X=[]){for(const vt of wp(d,500)){let Ht=0;for(const Ku of vt)Ht+=Ku.length;const Ui=this.segments.prepareSegment(Ht,this.layoutVertexArray,this.indexArray),Fn=Ui.vertexLength,Js=[],nl=[];for(const Ku of vt){if(Ku.length===0)continue;Ku!==vt[0]&&nl.push(Js.length/2);const lh=this.segments2.prepareSegment(Ku.length,this.layoutVertexArray,this.indexArray2),Eh=lh.vertexLength;this.layoutVertexArray.emplaceBack(Ku[0].x,Ku[0].y),this.indexArray2.emplaceBack(Eh+Ku.length-1,Eh),Js.push(Ku[0].x),Js.push(Ku[0].y);for(let Bh=1;Bh<Ku.length;Bh++)this.layoutVertexArray.emplaceBack(Ku[Bh].x,Ku[Bh].y),this.indexArray2.emplaceBack(Eh+Bh-1,Eh+Bh),Js.push(Ku[Bh].x),Js.push(Ku[Bh].y);lh.vertexLength+=Ku.length,lh.primitiveLength+=Ku.length}const ju=W1(Js,nl);for(let Ku=0;Ku<ju.length;Ku+=3)this.indexArray.emplaceBack(Fn+ju[Ku],Fn+ju[Ku+1],Fn+ju[Ku+2]);Ui.vertexLength+=Ht,Ui.primitiveLength+=ju.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,N,X,M)}}Ip(gp,"FillBucket",{omit:["layers","patternFeatures"]});const Qf=new $f({"fill-sort-key":new $d(Pd.layout_fill["fill-sort-key"])});var Gp={paint:new $f({"fill-antialias":new pd(Pd.paint_fill["fill-antialias"]),"fill-opacity":new $d(Pd.paint_fill["fill-opacity"]),"fill-color":new $d(Pd.paint_fill["fill-color"]),"fill-outline-color":new $d(Pd.paint_fill["fill-outline-color"]),"fill-translate":new pd(Pd.paint_fill["fill-translate"]),"fill-translate-anchor":new pd(Pd.paint_fill["fill-translate-anchor"]),"fill-pattern":new $d(Pd.paint_fill["fill-pattern"])}),layout:Qf};const Fp=Lp([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ym=Lp([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ug=Lp([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:_g}=Fp;var Bg={},i0=$s,a_=yg;function yg(c,l,d,y,M){this.properties={},this.extent=d,this.type=0,this._pbf=c,this._geometry=-1,this._keys=y,this._values=M,c.readFields(i_,this,l)}function i_(c,l,d){c==1?l.id=d.readVarint():c==2?function(y,M){for(var N=y.readVarint()+y.pos;y.pos<N;){var X=M._keys[y.readVarint()],vt=M._values[y.readVarint()];M.properties[X]=vt}}(d,l):c==3?l.type=d.readVarint():c==4&&(l._geometry=d.pos)}function v_(c){for(var l,d,y=0,M=0,N=c.length,X=N-1;M<N;X=M++)y+=((d=c[X]).x-(l=c[M]).x)*(l.y+d.y);return y}yg.types=["Unknown","Point","LineString","Polygon"],yg.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,d=c.readVarint()+c.pos,y=1,M=0,N=0,X=0,vt=[];c.pos<d;){if(M<=0){var Ht=c.readVarint();y=7&Ht,M=Ht>>3}if(M--,y===1||y===2)N+=c.readSVarint(),X+=c.readSVarint(),y===1&&(l&&vt.push(l),l=[]),l.push(new i0(N,X));else{if(y!==7)throw new Error("unknown command "+y);l&&l.push(l[0].clone())}}return l&&vt.push(l),vt},yg.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,d=1,y=0,M=0,N=0,X=1/0,vt=-1/0,Ht=1/0,Ui=-1/0;c.pos<l;){if(y<=0){var Fn=c.readVarint();d=7&Fn,y=Fn>>3}if(y--,d===1||d===2)(M+=c.readSVarint())<X&&(X=M),M>vt&&(vt=M),(N+=c.readSVarint())<Ht&&(Ht=N),N>Ui&&(Ui=N);else if(d!==7)throw new Error("unknown command "+d)}return[X,Ht,vt,Ui]},yg.prototype.toGeoJSON=function(c,l,d){var y,M,N=this.extent*Math.pow(2,d),X=this.extent*c,vt=this.extent*l,Ht=this.loadGeometry(),Ui=yg.types[this.type];function Fn(ju){for(var Ku=0;Ku<ju.length;Ku++){var lh=ju[Ku];ju[Ku]=[360*(lh.x+X)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(lh.y+vt)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var Js=[];for(y=0;y<Ht.length;y++)Js[y]=Ht[y][0];Fn(Ht=Js);break;case 2:for(y=0;y<Ht.length;y++)Fn(Ht[y]);break;case 3:for(Ht=function(ju){var Ku=ju.length;if(Ku<=1)return[ju];for(var lh,Eh,Bh=[],Yh=0;Yh<Ku;Yh++){var kh=v_(ju[Yh]);kh!==0&&(Eh===void 0&&(Eh=kh<0),Eh===kh<0?(lh&&Bh.push(lh),lh=[ju[Yh]]):lh.push(ju[Yh]))}return lh&&Bh.push(lh),Bh}(Ht),y=0;y<Ht.length;y++)for(M=0;M<Ht[y].length;M++)Fn(Ht[y][M])}Ht.length===1?Ht=Ht[0]:Ui="Multi"+Ui;var nl={type:"Feature",geometry:{type:Ui,coordinates:Ht},properties:this.properties};return"id"in this&&(nl.id=this.id),nl};var O_=a_,J_=Fg;function Fg(c,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(x_,this,l),this.length=this._features.length}function x_(c,l,d){c===15?l.version=d.readVarint():c===1?l.name=d.readString():c===5?l.extent=d.readVarint():c===2?l._features.push(d.pos):c===3?l._keys.push(d.readString()):c===4&&l._values.push(function(y){for(var M=null,N=y.readVarint()+y.pos;y.pos<N;){var X=y.readVarint()>>3;M=X===1?y.readString():X===2?y.readFloat():X===3?y.readDouble():X===4?y.readVarint64():X===5?y.readVarint():X===6?y.readSVarint():X===7?y.readBoolean():null}return M}(d))}Fg.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var l=this._pbf.readVarint()+this._pbf.pos;return new O_(this._pbf,l,this.extent,this._keys,this._values)};var $_=J_;function ey(c,l,d){if(c===3){var y=new $_(d,d.readVarint()+d.pos);y.length&&(l[y.name]=y)}}var B_=Bg.VectorTile=function(c,l){this.layers=c.readFields(ey,{},l)},b_=Bg.VectorTileFeature=a_;function vg(c,l,d,y){const M=[],N=y===0?(X,vt,Ht,Ui,Fn,Js)=>{X.push(new $s(Js,Ht+(Js-vt)/(Ui-vt)*(Fn-Ht)))}:(X,vt,Ht,Ui,Fn,Js)=>{X.push(new $s(vt+(Js-Ht)/(Fn-Ht)*(Ui-vt),Js))};for(const X of c){const vt=[];for(const Ht of X){if(Ht.length<=2)continue;const Ui=[];for(let nl=0;nl<Ht.length-1;nl++){const ju=Ht[nl].x,Ku=Ht[nl].y,lh=Ht[nl+1].x,Eh=Ht[nl+1].y,Bh=y===0?ju:Ku,Yh=y===0?lh:Eh;Bh<l?Yh>l&&N(Ui,ju,Ku,lh,Eh,l):Bh>d?Yh<d&&N(Ui,ju,Ku,lh,Eh,d):Ui.push(Ht[nl]),Yh<l&&Bh>=l&&N(Ui,ju,Ku,lh,Eh,l),Yh>d&&Bh<=d&&N(Ui,ju,Ku,lh,Eh,d)}let Fn=Ht[Ht.length-1];const Js=y===0?Fn.x:Fn.y;Js>=l&&Js<=d&&Ui.push(Fn),Ui.length&&(Fn=Ui[Ui.length-1],Ui[0].x===Fn.x&&Ui[0].y===Fn.y||Ui.push(Ui[0]),vt.push(Ui))}vt.length&&M.push(vt)}return M}Bg.VectorTileLayer=J_;const w_=b_.types,vm=Math.pow(2,13);function E_(c,l,d,y,M,N,X,vt){c.emplaceBack((l<<1)+X,(d<<1)+N,(Math.floor(y*vm)<<1)+M,Math.round(vt))}function qg(c,l,d){c.emplaceBack(l.x,l.y,l.z,d[0]*16384,d[1]*16384,d[2]*16384)}class T_{constructor(){this.acc=new $s(0,0),this.polyCount=[]}startRing(l){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $s(l.x,l.y),this.max=new $s(l.x,l.y))}append(l,d){this.currentPolyCount.edges++,this.acc._add(l);const y=this.min,M=this.max;l.x<y.x?y.x=l.x:l.x>M.x&&(M.x=l.x),l.y<y.y?y.y=l.y:l.y>M.y&&(M.y=l.y),((l.x===0||l.x===Hp)&&l.x===d.x)!=((l.y===0||l.y===Hp)&&l.y===d.y)&&this.processBorderOverlap(l,d),d.x<0!=l.x<0&&this.addBorderIntersection(0,Kp(d.y,l.y,(0-d.x)/(l.x-d.x))),d.x>Hp!=l.x>Hp&&this.addBorderIntersection(1,Kp(d.y,l.y,(Hp-d.x)/(l.x-d.x))),d.y<0!=l.y<0&&this.addBorderIntersection(2,Kp(d.x,l.x,(0-d.y)/(l.y-d.y))),d.y>Hp!=l.y>Hp&&this.addBorderIntersection(3,Kp(d.x,l.x,(Hp-d.y)/(l.y-d.y)))}addBorderIntersection(l,d){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const y=this.borders[l];d<y[0]&&(y[0]=d),d>y[1]&&(y[1]=d)}processBorderOverlap(l,d){if(l.x===d.x){if(l.y===d.y)return;const y=l.x===0?0:1;this.addBorderIntersection(y,d.y),this.addBorderIntersection(y,l.y)}else{const y=l.y===0?2:3;this.addBorderIntersection(y,d.x),this.addBorderIntersection(y,l.x)}}centroid(){const l=this.polyCount.reduce((d,y)=>d+y.edges,0);return l!==0?this.acc.div(l)._round():new $s(0,0)}span(){return new $s(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((l,d)=>l+ +(d[0]!==Number.MAX_VALUE),0)}}class ty{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=l.projection,this.layoutVertexArray=new Am,this.centroidVertexArray=new B1,this.indexArray=new y_,this.programConfigurations=new f1(l.layers,l.zoom),this.segments=new Og,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.enableTerrain=l.enableTerrain}populate(l,d,y,M){this.features=[],this.hasPattern=cp("fill-extrusion",this.layers,d),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(N){const X=Math.exp(Math.PI*(1-N.y/(1<<N.z)*2));return 80150034*X/(X*X+1)/Hp/(1<<N.z)}(y),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:N,id:X,index:vt,sourceLayerIndex:Ht}of l){const Ui=this.layers[0]._featureFilter.needGeometry,Fn=Ov(N,Ui);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),Fn,y))continue;const Js={id:X,sourceLayerIndex:Ht,index:vt,geometry:Ui?Fn.geometry:Rv(N,y,M),properties:N.properties,type:N.type,patterns:{}},nl=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ep("fill-extrusion",this.layers,Js,this.zoom,d)):this.addFeature(Js,Js.geometry,vt,y,{},d.availableImages,M),d.featureIndex.insert(N,Js.geometry,vt,Ht,this.index,nl)}this.sortBorders()}addFeatures(l,d,y,M,N){for(const X of this.features){const{geometry:vt}=X;this.addFeature(X,vt,X.index,d,y,M,N)}this.sortBorders()}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,_g),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=l.createVertexBuffer(this.layoutVertexExtArray,ug.members,!0))),this.programConfigurations.upload(l),this.uploaded=!0}uploadCentroid(l){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,ym.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,y,M,N,X,vt){const Ht=[new $s(0,0),new $s(Hp,Hp)],Ui=vt.projection,Fn=Ui.name==="globe",Js=this.enableTerrain&&!Fn?new T_:null,nl=w_[l.type]==="Polygon";Fn&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cy);const ju=wp(d,500);for(let Bh=ju.length-1;Bh>=0;Bh--){const Yh=ju[Bh];(Yh.length===0||(Ku=Yh[0]).every(kh=>kh.x<=0)||Ku.every(kh=>kh.x>=Hp)||Ku.every(kh=>kh.y<=0)||Ku.every(kh=>kh.y>=Hp))&&ju.splice(Bh,1)}var Ku;let lh;if(Fn)lh=K1(ju,Ht,M);else{lh=[];for(const Bh of ju)lh.push({polygon:Bh,bounds:Ht})}const Eh=nl?this.edgeRadius:0;for(const{polygon:Bh,bounds:Yh}of lh){let kh=0,Vh=0;for(const ed of Bh)nl&&!ed[0].equals(ed[ed.length-1])&&ed.push(ed[0]),Vh+=nl?ed.length-1:ed.length;const rd=this.segments.prepareSegment((nl?5:4)*Vh,this.layoutVertexArray,this.indexArray);if(nl){const ed=[],Rd=[];kh=rd.vertexLength;for(const Sf of Bh){let Zf,jd;Sf.length&&Sf!==Bh[0]&&Rd.push(ed.length/2),Zf=Sf[1].sub(Sf[0])._perp()._unit();for(let Pf=1;Pf<Sf.length;Pf++){const Rf=Sf[Pf],Uf=Sf[Pf===Sf.length-1?1:Pf+1];let{x:Xf,y:Hd}=Rf;if(Eh){jd=Uf.sub(Rf)._perp()._unit();const up=Zf.add(jd)._unit(),jp=Eh*Math.min(4,1/(Zf.x*up.x+Zf.y*up.y));Xf+=jp*up.x,Hd+=jp*up.y,Zf=jd}E_(this.layoutVertexArray,Xf,Hd,0,0,1,1,0),rd.vertexLength++,ed.push(Rf.x,Rf.y),Fn&&qg(this.layoutVertexExtArray,Ui.projectTilePoint(Xf,Hd,M),Ui.upVector(M,Xf,Hd))}}const kd=W1(ed,Rd);for(let Sf=0;Sf<kd.length;Sf+=3)this.indexArray.emplaceBack(kh+kd[Sf],kh+kd[Sf+2],kh+kd[Sf+1]),rd.primitiveLength++}for(const ed of Bh){Js&&ed.length&&Js.startRing(ed[0]);let Rd,kd,Sf,Zf=ed.length>4&&Py(ed[ed.length-2],ed[0],ed[1]),jd=Eh?Y0(ed[ed.length-2],ed[0],ed[1],Eh):0;kd=ed[1].sub(ed[0])._perp()._unit();let Pf=!0;for(let Rf=1,Uf=0;Rf<ed.length;Rf++){let Xf=ed[Rf-1],Hd=ed[Rf];const up=ed[Rf===ed.length-1?1:Rf+1];if(Js&&nl&&Js.currentPolyCount.top++,r0(Hd,Xf,Yh)){Eh&&(kd=up.sub(Hd)._perp()._unit(),Pf=!Pf);continue}Js&&Js.append(Hd,Xf);const jp=Hd.sub(Xf)._perp(),vp=jp.x/(Math.abs(jp.x)+Math.abs(jp.y)),Rp=jp.y>0?1:0,dp=Xf.dist(Hd);if(Uf+dp>32768&&(Uf=0),Eh){Sf=up.sub(Hd)._perp()._unit();let pm=gv(Xf,Hd,up,k0(kd,Sf),Eh);isNaN(pm)&&(pm=0);const Wp=Hd.sub(Xf)._unit();Xf=Xf.add(Wp.mult(jd))._round(),Hd=Hd.add(Wp.mult(-pm))._round(),jd=pm,kd=Sf}const Xp=rd.vertexLength,xm=ed.length>4&&Py(Xf,Hd,up);let gm=iy(Uf,Zf,Pf);if(E_(this.layoutVertexArray,Xf.x,Xf.y,vp,Rp,0,0,gm),E_(this.layoutVertexArray,Xf.x,Xf.y,vp,Rp,0,1,gm),Uf+=dp,gm=iy(Uf,xm,!Pf),Zf=xm,E_(this.layoutVertexArray,Hd.x,Hd.y,vp,Rp,0,0,gm),E_(this.layoutVertexArray,Hd.x,Hd.y,vp,Rp,0,1,gm),rd.vertexLength+=4,this.indexArray.emplaceBack(Xp+0,Xp+1,Xp+2),this.indexArray.emplaceBack(Xp+1,Xp+3,Xp+2),rd.primitiveLength+=2,Eh){const pm=kh+(Rf===1?ed.length-2:Rf-2),Wp=Rf===1?kh:pm+1;if(this.indexArray.emplaceBack(Xp+1,pm,Xp+3),this.indexArray.emplaceBack(pm,Wp,Xp+3),rd.primitiveLength+=2,Rd===void 0&&(Rd=Xp),!r0(up,ed[Rf],Yh)){const Zm=Rf===ed.length-1?Rd:rd.vertexLength;this.indexArray.emplaceBack(Xp+2,Xp+3,Zm),this.indexArray.emplaceBack(Xp+3,Zm+1,Zm),this.indexArray.emplaceBack(Xp+3,Wp,Zm+1),rd.primitiveLength+=3}Pf=!Pf}if(Fn){const pm=this.layoutVertexExtArray,Wp=Ui.projectTilePoint(Xf.x,Xf.y,M),Zm=Ui.projectTilePoint(Hd.x,Hd.y,M),tm=Ui.upVector(M,Xf.x,Xf.y),bm=Ui.upVector(M,Hd.x,Hd.y);qg(pm,Wp,tm),qg(pm,Wp,tm),qg(pm,Zm,bm),qg(pm,Zm,bm)}}nl&&(kh+=ed.length-1)}}if(Js&&Js.polyCount.length>0){if(Js.borders){Js.vertexArrayOffset=this.centroidVertexArray.length;const Bh=Js.borders,Yh=this.featuresOnBorder.push(Js)-1;for(let kh=0;kh<4;kh++)Bh[kh][0]!==Number.MAX_VALUE&&this.borders[kh].push(Yh)}this.encodeCentroid(Js.borders?void 0:Js.centroid(),Js)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,N,X,M)}sortBorders(){for(let l=0;l<4;l++)this.borders[l].sort((d,y)=>this.featuresOnBorder[d].borders[l][0]-this.featuresOnBorder[y].borders[l][0])}encodeCentroid(l,d,y=!0){let M,N;if(l)if(l.y!==0){const vt=d.span()._mult(this.tileToMeter);M=(Math.max(l.x,1)<<3)+Math.min(7,Math.round(vt.x/10)),N=(Math.max(l.y,1)<<3)+Math.min(7,Math.round(vt.y/10))}else M=Math.ceil(7*(l.x+450)),N=0;else M=0,N=+y;let X=y?this.centroidVertexArray.length:d.vertexArrayOffset;for(const vt of d.polyCount){y&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*vt.edges+vt.top);for(let Ht=0;Ht<vt.top;Ht++)this.centroidVertexArray.emplace(X++,M,N);for(let Ht=0;Ht<2*vt.edges;Ht++)this.centroidVertexArray.emplace(X++,0,N),this.centroidVertexArray.emplace(X++,M,N)}}}function k0(c,l){const d=c.add(l)._unit();return c.x*d.x+c.y*d.y}function Y0(c,l,d,y){const M=l.sub(c)._perp()._unit(),N=d.sub(l)._perp()._unit();return gv(c,l,d,k0(M,N),y)}function gv(c,l,d,y,M){const N=Math.sqrt(1-y*y);return Math.min(c.dist(l)/3,l.dist(d)/3,M*N/y)}function r0(c,l,d){return c.x<d[0].x&&l.x<d[0].x||c.x>d[1].x&&l.x>d[1].x||c.y<d[0].y&&l.y<d[0].y||c.y>d[1].y&&l.y>d[1].y}function Py(c,l,d){if(c.x<0||c.x>=Hp||l.x<0||l.x>=Hp||d.x<0||d.x>=Hp)return!1;const y=d.sub(l),M=y.perp(),N=c.sub(l);return(y.x*N.x+y.y*N.y)/Math.sqrt((y.x*y.x+y.y*y.y)*(N.x*N.x+N.y*N.y))>-.866&&M.x*N.x+M.y*N.y<0}function iy(c,l,d){const y=l?2|c:-3&c;return d?1|y:-2&y}function _v(){const c=Math.PI/32,l=Math.tan(c),d=xx;return d*Math.sqrt(1+2*l*l)-d}function K1(c,l,d){const y=1<<d.z,M=e0(d.x/y),N=e0((d.x+1)/y),X=Mg(d.y/y),vt=Mg((d.y+1)/y);return function(Ht,Ui,Fn,Js,nl=0,ju){const Ku=[];if(!Ht.length||!Fn||!Js)return Ku;const lh=(ed,Rd)=>{for(const kd of ed)Ku.push({polygon:kd,bounds:Rd})},Eh=Math.ceil(Math.log2(Fn)),Bh=Math.ceil(Math.log2(Js)),Yh=Eh-Bh,kh=[];for(let ed=0;ed<Math.abs(Yh);ed++)kh.push(Yh>0?0:1);for(let ed=0;ed<Math.min(Eh,Bh);ed++)kh.push(0),kh.push(1);let Vh=Ht;if(Vh=vg(Vh,Ui[0].y-nl,Ui[1].y+nl,1),Vh=vg(Vh,Ui[0].x-nl,Ui[1].x+nl,0),!Vh.length)return Ku;const rd=[];for(kh.length?rd.push({polygons:Vh,bounds:Ui,depth:0}):lh(Vh,Ui);rd.length;){const ed=rd.pop(),Rd=ed.depth,kd=kh[Rd],Sf=ed.bounds[0],Zf=ed.bounds[1],jd=kd===0?Sf.x:Sf.y,Pf=kd===0?Zf.x:Zf.y,Rf=ju?ju(kd,jd,Pf):.5*(jd+Pf),Uf=vg(ed.polygons,jd-nl,Rf+nl,kd),Xf=vg(ed.polygons,Rf-nl,Pf+nl,kd);if(Uf.length){const Hd=[Sf,new $s(kd===0?Rf:Zf.x,kd===1?Rf:Zf.y)];kh.length>Rd+1?rd.push({polygons:Uf,bounds:Hd,depth:Rd+1}):lh(Uf,Hd)}if(Xf.length){const Hd=[new $s(kd===0?Rf:Sf.x,kd===1?Rf:Sf.y),Zf];kh.length>Rd+1?rd.push({polygons:Xf,bounds:Hd,depth:Rd+1}):lh(Xf,Hd)}}return Ku}(c,l,Math.ceil((N-M)/11.25),Math.ceil((X-vt)/11.25),1,(Ht,Ui,Fn)=>{if(Ht===0)return .5*(Ui+Fn);{const Js=Mg((d.y+Ui/Hp)/y);return(X0(.5*(Mg((d.y+Fn/Hp)/y)+Js))*y-d.y)*Hp}})}Ip(ty,"FillExtrusionBucket",{omit:["layers","features"]}),Ip(T_,"PartMetadata");const Aw=new $f({"fill-extrusion-edge-radius":new pd(Pd["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Fb={paint:new $f({"fill-extrusion-opacity":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $d(Pd["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $d(Pd["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $d(Pd["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $d(Pd["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pd(Pd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Aw};function tb(c,l,d){var y=2*Math.PI*6378137/256/Math.pow(2,d);return[c*y-2*Math.PI*6378137/2,l*y-2*Math.PI*6378137/2]}class D0{constructor(l,d,y){this.z=l,this.x=d,this.y=y,this.key=C1(0,l,l,d,y)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d){const y=function(N,X,vt){var Ht=tb(256*N,256*(X=Math.pow(2,vt)-X-1),vt),Ui=tb(256*(N+1),256*(X+1),vt);return Ht[0]+","+Ht[1]+","+Ui[0]+","+Ui[1]}(this.x,this.y,this.z),M=function(N,X,vt){let Ht,Ui="";for(let Fn=N;Fn>0;Fn--)Ht=1<<Fn-1,Ui+=(X&Ht?1:0)+(vt&Ht?2:0);return Ui}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",M).replace("{bbox-epsg-3857}",y)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ub{constructor(l,d){this.wrap=l,this.canonical=d,this.key=C1(l,d.z,d.z,d.x,d.y)}}class S_{constructor(l,d,y,M,N){this.overscaledZ=l,this.wrap=d,this.canonical=new D0(y,+M,+N),this.key=d===0&&l===y?this.canonical.key:C1(d,l,y,M,N)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){const d=this.canonical.z-l;return l>this.canonical.z?new S_(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new S_(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d=!0){if(this.overscaledZ===l&&d)return this.key;if(l>this.canonical.z)return C1(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y);{const y=this.canonical.z-l;return C1(this.wrap*+d,l,l,this.canonical.x>>y,this.canonical.y>>y)}}isChildOf(l){if(l.wrap!==this.wrap)return!1;const d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new S_(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,y=2*this.canonical.x,M=2*this.canonical.y;return[new S_(d,this.wrap,d,y,M),new S_(d,this.wrap,d,y+1,M),new S_(d,this.wrap,d,y,M+1),new S_(d,this.wrap,d,y+1,M+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new S_(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new S_(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ub(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function C1(c,l,d,y,M){const N=1<<Math.min(d,22);let X=N*(M%N)+y%N;return c&&d<22&&(X+=N*N*((c<0?-2*c-1:2*c)%(1<<2*(22-d)))),16*(32*X+d)+(l-d)}Ip(D0,"CanonicalTileID"),Ip(S_,"OverscaledTileID",{omit:["projMatrix"]});class M1 extends $s{constructor(l,d,y){super(l,d),this.z=y}}function Ax(c,l){return c.x*l.x+c.y*l.y}function Pw(c,l){if(c.length===1){let d=0;const y=l[d++];let M;for(;!M||y.equals(M);)if(M=l[d++],!M)return 1/0;for(;d<l.length;d++){const N=l[d],X=c[0],vt=M.sub(y),Ht=N.sub(y),Ui=X.sub(y),Fn=Ax(vt,vt),Js=Ax(vt,Ht),nl=Ax(Ht,Ht),ju=Ax(Ui,vt),Ku=Ax(Ui,Ht),lh=Fn*nl-Js*Js,Eh=(nl*ju-Js*Ku)/lh,Bh=(Fn*Ku-Js*ju)/lh,Yh=y.z*(1-Eh-Bh)+M.z*Eh+N.z*Bh;if(isFinite(Yh))return Yh}return 1/0}{let d=1/0;for(const y of l)d=Math.min(d,y.z);return d}}function kw(c,l,d,y,M,N,X,vt){const Ht=X*M.getElevationAt(c,l,!0,!0),Ui=N[0]!==0,Fn=Ui?N[1]===0?X*(N[0]/7-450):X*function(Js,nl,ju){const Ku=Math.floor(nl[0]/8),lh=Math.floor(nl[1]/8),Eh=10*(nl[0]-8*Ku),Bh=10*(nl[1]-8*lh),Yh=Js.getElevationAt(Ku,lh,!0,!0),kh=Js.getMeterToDEM(ju),Vh=Math.floor(.5*(Eh*kh-1)),rd=Math.floor(.5*(Bh*kh-1)),ed=Js.tileCoordToPixel(Ku,lh),Rd=2*Vh+1,kd=2*rd+1,Sf=function(Xf,Hd,up,jp,vp){return[Xf.getElevationAtPixel(Hd,up,!0),Xf.getElevationAtPixel(Hd+vp,up,!0),Xf.getElevationAtPixel(Hd,up+vp,!0),Xf.getElevationAtPixel(Hd+jp,up+vp,!0)]}(Js,ed.x-Vh,ed.y-rd,Rd,kd),Zf=Math.abs(Sf[0]-Sf[1]),jd=Math.abs(Sf[2]-Sf[3]),Pf=Math.abs(Sf[0]-Sf[2])+Math.abs(Sf[1]-Sf[3]),Rf=Math.min(.25,.5*kh*(Zf+jd)/Rd),Uf=Math.min(.25,.5*kh*Pf/kd);return Yh+Math.max(Rf*Eh,Uf*Bh)}(M,N,vt):Ht;return{base:Ht+(d===0)?-1:d,top:Ui?Math.max(Fn+y,Ht+d+2):Ht+y}}const f2=Lp([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:p2}=f2,m2=Lp([{name:"a_packed",components:4,type:"Float32"}]),{members:g2}=m2,_2=b_.types,K0=Math.cos(Math.PI/180*37.5);class A1{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.projection=l.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new jm,this.layoutVertexArray2=new zm,this.indexArray=new y_,this.programConfigurations=new f1(l.layers,l.zoom),this.segments=new Og,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,y,M){this.hasPattern=cp("line",this.layers,d);const N=this.layers[0].layout.get("line-sort-key"),X=[];for(const{feature:Fn,id:Js,index:nl,sourceLayerIndex:ju}of l){const Ku=this.layers[0]._featureFilter.needGeometry,lh=Ov(Fn,Ku);if(!this.layers[0]._featureFilter.filter(new ld(this.zoom),lh,y))continue;const Eh=N?N.evaluate(lh,{},y):void 0,Bh={id:Js,properties:Fn.properties,type:Fn.type,sourceLayerIndex:ju,index:nl,geometry:Ku?lh.geometry:Rv(Fn,y,M),patterns:{},sortKey:Eh};X.push(Bh)}N&&X.sort((Fn,Js)=>Fn.sortKey-Js.sortKey);const{lineAtlas:vt,featureIndex:Ht}=d,Ui=this.addConstantDashes(vt);for(const Fn of X){const{geometry:Js,index:nl,sourceLayerIndex:ju}=Fn;if(Ui&&this.addFeatureDashes(Fn,vt),this.hasPattern){const Ku=Ep("line",this.layers,Fn,this.zoom,d);this.patternFeatures.push(Ku)}else this.addFeature(Fn,Js,nl,y,vt.positions,d.availableImages);Ht.insert(l[nl].feature,Js,nl,ju,this.index)}}addConstantDashes(l){let d=!1;for(const y of this.layers){const M=y.paint.get("line-dasharray").value,N=y.layout.get("line-cap").value;if(M.kind!=="constant"||N.kind!=="constant")d=!0;else{const X=N.value,vt=M.value;if(!vt)continue;l.addDash(vt,X)}}return d}addFeatureDashes(l,d){const y=this.zoom;for(const M of this.layers){const N=M.paint.get("line-dasharray").value,X=M.layout.get("line-cap").value;if(N.kind==="constant"&&X.kind==="constant")continue;let vt,Ht;if(N.kind==="constant"){if(vt=N.value,!vt)continue}else vt=N.evaluate({zoom:y},l);Ht=X.kind==="constant"?X.value:X.evaluate({zoom:y},l),d.addDash(vt,Ht),l.patterns[M.id]=d.getKey(vt,Ht)}}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}addFeatures(l,d,y,M,N){for(const X of this.patternFeatures)this.addFeature(X,X.geometry,X.index,d,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,g2)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,p2),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&l.properties.hasOwnProperty("mapbox_clip_start")&&l.properties.hasOwnProperty("mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,y,M,N,X){const vt=this.layers[0].layout,Ht=vt.get("line-join").evaluate(l,{}),Ui=vt.get("line-cap").evaluate(l,{}),Fn=vt.get("line-miter-limit"),Js=vt.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const nl of d)this.addLine(nl,l,Ht,Ui,Fn,Js);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,N,X,M)}addLine(l,d,y,M,N,X){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Bh=0;Bh<l.length-1;Bh++)this.totalDistance+=l[Bh].dist(l[Bh+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const vt=_2[d.type]==="Polygon";let Ht=l.length;for(;Ht>=2&&l[Ht-1].equals(l[Ht-2]);)Ht--;let Ui=0;for(;Ui<Ht-1&&l[Ui].equals(l[Ui+1]);)Ui++;if(Ht<(vt?3:2))return;y==="bevel"&&(N=1.05);const Fn=this.overscaling<=16?122880/(512*this.overscaling):0,Js=this.segments.prepareSegment(10*Ht,this.layoutVertexArray,this.indexArray);let nl,ju,Ku,lh,Eh;this.e1=this.e2=-1,vt&&(nl=l[Ht-2],Eh=l[Ui].sub(nl)._unit()._perp());for(let Bh=Ui;Bh<Ht;Bh++){if(Ku=Bh===Ht-1?vt?l[Ui+1]:void 0:l[Bh+1],Ku&&l[Bh].equals(Ku))continue;Eh&&(lh=Eh),nl&&(ju=nl),nl=l[Bh],Eh=Ku?Ku.sub(nl)._unit()._perp():lh,lh=lh||Eh;let Yh=lh.add(Eh);Yh.x===0&&Yh.y===0||Yh._unit();const kh=lh.x*Eh.x+lh.y*Eh.y,Vh=Yh.x*Eh.x+Yh.y*Eh.y,rd=Vh!==0?1/Vh:1/0,ed=2*Math.sqrt(2-2*Vh),Rd=Vh<K0&&ju&&Ku,kd=lh.x*Eh.y-lh.y*Eh.x>0;if(Rd&&Bh>Ui){const jd=nl.dist(ju);if(jd>2*Fn){const Pf=nl.sub(nl.sub(ju)._mult(Fn/jd)._round());this.updateDistance(ju,Pf),this.addCurrentVertex(Pf,lh,0,0,Js),ju=Pf}}const Sf=ju&&Ku;let Zf=Sf?y:vt?"butt":M;if(Sf&&Zf==="round"&&(rd<X?Zf="miter":rd<=2&&(Zf="fakeround")),Zf==="miter"&&rd>N&&(Zf="bevel"),Zf==="bevel"&&(rd>2&&(Zf="flipbevel"),rd<N&&(Zf="miter")),ju&&this.updateDistance(ju,nl),Zf==="miter")Yh._mult(rd),this.addCurrentVertex(nl,Yh,0,0,Js);else if(Zf==="flipbevel"){if(rd>100)Yh=Eh.mult(-1);else{const jd=rd*lh.add(Eh).mag()/lh.sub(Eh).mag();Yh._perp()._mult(jd*(kd?-1:1))}this.addCurrentVertex(nl,Yh,0,0,Js),this.addCurrentVertex(nl,Yh.mult(-1),0,0,Js)}else if(Zf==="bevel"||Zf==="fakeround"){const jd=-Math.sqrt(rd*rd-1),Pf=kd?jd:0,Rf=kd?0:jd;if(ju&&this.addCurrentVertex(nl,lh,Pf,Rf,Js),Zf==="fakeround"){const Uf=Math.round(180*ed/Math.PI/20);for(let Xf=1;Xf<Uf;Xf++){let Hd=Xf/Uf;if(Hd!==.5){const jp=Hd-.5;Hd+=Hd*jp*(Hd-1)*((1.0904+kh*(kh*(3.55645-1.43519*kh)-3.2452))*jp*jp+(.848013+kh*(.215638*kh-1.06021)))}const up=Eh.sub(lh)._mult(Hd)._add(lh)._unit()._mult(kd?-1:1);this.addHalfVertex(nl,up.x,up.y,!1,kd,0,Js)}}Ku&&this.addCurrentVertex(nl,Eh,-Pf,-Rf,Js)}else if(Zf==="butt")this.addCurrentVertex(nl,Yh,0,0,Js);else if(Zf==="square"){const jd=ju?1:-1;ju||this.addCurrentVertex(nl,Yh,jd,jd,Js),this.addCurrentVertex(nl,Yh,0,0,Js),ju&&this.addCurrentVertex(nl,Yh,jd,jd,Js)}else Zf==="round"&&(ju&&(this.addCurrentVertex(nl,lh,0,0,Js),this.addCurrentVertex(nl,lh,1,1,Js,!0)),Ku&&(this.addCurrentVertex(nl,Eh,-1,-1,Js,!0),this.addCurrentVertex(nl,Eh,0,0,Js)));if(Rd&&Bh<Ht-1){const jd=nl.dist(Ku);if(jd>2*Fn){const Pf=nl.add(Ku.sub(nl)._mult(Fn/jd)._round());this.updateDistance(nl,Pf),this.addCurrentVertex(Pf,Eh,0,0,Js),nl=Pf}}}}addCurrentVertex(l,d,y,M,N,X=!1){const vt=d.y*M-d.x,Ht=-d.y-d.x*M;this.addHalfVertex(l,d.x+d.y*y,d.y-d.x*y,X,!1,y,N),this.addHalfVertex(l,vt,Ht,X,!0,-M,N)}addHalfVertex({x:l,y:d},y,M,N,X,vt,Ht){this.layoutVertexArray.emplaceBack((l<<1)+(N?1:0),(d<<1)+(X?1:0),Math.round(63*y)+128,Math.round(63*M)+128,1+(vt===0?0:vt<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const Ui=Ht.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ui),Ht.primitiveLength++),X?this.e2=Ui:this.e1=Ui}updateScaledDistance(){if(this.lineClips){const l=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=l*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}Ip(A1,"LineBucket",{omit:["layers","patternFeatures"]});const Dw=new $f({"line-cap":new $d(Pd.layout_line["line-cap"]),"line-join":new $d(Pd.layout_line["line-join"]),"line-miter-limit":new pd(Pd.layout_line["line-miter-limit"]),"line-round-limit":new pd(Pd.layout_line["line-round-limit"]),"line-sort-key":new $d(Pd.layout_line["line-sort-key"])});var ry={paint:new $f({"line-opacity":new $d(Pd.paint_line["line-opacity"]),"line-color":new $d(Pd.paint_line["line-color"]),"line-translate":new pd(Pd.paint_line["line-translate"]),"line-translate-anchor":new pd(Pd.paint_line["line-translate-anchor"]),"line-width":new $d(Pd.paint_line["line-width"]),"line-gap-width":new $d(Pd.paint_line["line-gap-width"]),"line-offset":new $d(Pd.paint_line["line-offset"]),"line-blur":new $d(Pd.paint_line["line-blur"]),"line-dasharray":new $d(Pd.paint_line["line-dasharray"]),"line-pattern":new $d(Pd.paint_line["line-pattern"]),"line-gradient":new yf(Pd.paint_line["line-gradient"]),"line-trim-offset":new pd(Pd.paint_line["line-trim-offset"])}),layout:Dw};const Q0=new class extends $d{possiblyEvaluate(c,l){return l=new ld(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(c,l)}evaluate(c,l,d,y){return l=md({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(c,l,d,y)}}(ry.paint.properties["line-width"].specification);function Q1(c,l){return l>0?l+2*c:c}Q0.useIntegerZoom=!0;const Px=Lp([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Lw=Lp([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),P1=Lp([{name:"a_projected_pos",components:4,type:"Float32"}],4);Lp([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tT=Lp([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),iT=Lp([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Lp([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const j2=Lp([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rT=Lp([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Lp([{name:"triangle",components:3,type:"Uint16"}]),Lp([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Lp([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Lp([{type:"Float32",name:"offsetX"}]),Lp([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ny=24;const r1=128;function y2(c,l){const{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new ld(c+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:M}=d;let N=0;for(;N<y.length&&y[N]<=c;)N++;N=Math.max(0,N-1);let X=N;for(;X<y.length&&y[X]<c+1;)X++;X=Math.min(y.length-1,X);const vt=y[N],Ht=y[X];return d.kind==="composite"?{kind:"composite",minZoom:vt,maxZoom:Ht,interpolationType:M}:{kind:"camera",minZoom:vt,maxZoom:Ht,minSize:d.evaluate(new ld(vt)),maxSize:d.evaluate(new ld(Ht)),interpolationType:M}}}function Rw(c,{uSize:l,uSizeT:d},{lowerSize:y,upperSize:M}){return c.kind==="source"?y/r1:c.kind==="composite"?Kp(y/r1,M/r1,d):l}function ib(c,l){let d=0,y=0;if(c.kind==="constant")y=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:M,minZoom:N,maxZoom:X}=c,vt=M?Gh(Qg.interpolationFactor(M,l,N,X),0,1):0;c.kind==="camera"?y=Kp(c.minSize,c.maxSize,vt):d=vt}return{uSizeT:d,uSize:y}}var nT=Object.freeze({__proto__:null,getSizeData:y2,evaluateSizeForFeature:Rw,evaluateSizeForZoom:ib,SIZE_PACK_FACTOR:r1});function oT(c,l,d){return c.sections.forEach(y=>{y.text=function(M,N,X){const vt=N.layout.get("text-transform").evaluate(X,{});return vt==="uppercase"?M=M.toLocaleUpperCase():vt==="lowercase"&&(M=M.toLocaleLowerCase()),Hh.applyArabicShaping&&(M=Hh.applyArabicShaping(M)),M}(y.text,l,d)}),c}const Vb={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function aT(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function sT(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var Gb=rg,q2=function(c,l,d,y,M){var N,X,vt=8*M-y-1,Ht=(1<<vt)-1,Ui=Ht>>1,Fn=-7,Js=d?M-1:0,nl=d?-1:1,ju=c[l+Js];for(Js+=nl,N=ju&(1<<-Fn)-1,ju>>=-Fn,Fn+=vt;Fn>0;N=256*N+c[l+Js],Js+=nl,Fn-=8);for(X=N&(1<<-Fn)-1,N>>=-Fn,Fn+=y;Fn>0;X=256*X+c[l+Js],Js+=nl,Fn-=8);if(N===0)N=1-Ui;else{if(N===Ht)return X?NaN:1/0*(ju?-1:1);X+=Math.pow(2,y),N-=Ui}return(ju?-1:1)*X*Math.pow(2,N-y)},Z2=function(c,l,d,y,M,N){var X,vt,Ht,Ui=8*N-M-1,Fn=(1<<Ui)-1,Js=Fn>>1,nl=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,ju=y?0:N-1,Ku=y?1:-1,lh=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(vt=isNaN(l)?1:0,X=Fn):(X=Math.floor(Math.log(l)/Math.LN2),l*(Ht=Math.pow(2,-X))<1&&(X--,Ht*=2),(l+=X+Js>=1?nl/Ht:nl*Math.pow(2,1-Js))*Ht>=2&&(X++,Ht/=2),X+Js>=Fn?(vt=0,X=Fn):X+Js>=1?(vt=(l*Ht-1)*Math.pow(2,M),X+=Js):(vt=l*Math.pow(2,Js-1)*Math.pow(2,M),X=0));M>=8;c[d+ju]=255&vt,ju+=Ku,vt/=256,M-=8);for(X=X<<M|vt,Ui+=M;Ui>0;c[d+ju]=255&X,ju+=Ku,X/=256,Ui-=8);c[d+ju-Ku]|=128*lh};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function rg(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}rg.Varint=0,rg.Fixed64=1,rg.Bytes=2,rg.Fixed32=5;var v2=4294967296,H2=1/v2,X2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function k1(c){return c.type===rg.Bytes?c.readVarint()+c.pos:c.pos+1}function rb(c,l,d){return d?4294967296*l+(c>>>0):4294967296*(l>>>0)+(c>>>0)}function W2(c,l,d){var y=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));d.realloc(y);for(var M=d.pos-1;M>=c;M--)d.buf[M+y]=d.buf[M]}function lT(c,l){for(var d=0;d<c.length;d++)l.writeVarint(c[d])}function cT(c,l){for(var d=0;d<c.length;d++)l.writeSVarint(c[d])}function uT(c,l){for(var d=0;d<c.length;d++)l.writeFloat(c[d])}function hT(c,l){for(var d=0;d<c.length;d++)l.writeDouble(c[d])}function dT(c,l){for(var d=0;d<c.length;d++)l.writeBoolean(c[d])}function fT(c,l){for(var d=0;d<c.length;d++)l.writeFixed32(c[d])}function pT(c,l){for(var d=0;d<c.length;d++)l.writeSFixed32(c[d])}function mT(c,l){for(var d=0;d<c.length;d++)l.writeFixed64(c[d])}function gT(c,l){for(var d=0;d<c.length;d++)l.writeSFixed64(c[d])}function Ow(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+16777216*c[l+3]}function nb(c,l,d){c[d]=l,c[d+1]=l>>>8,c[d+2]=l>>>16,c[d+3]=l>>>24}function Y2(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+(c[l+3]<<24)}function _T(c,l,d){l.glyphs=[],c===1&&d.readMessage(yT,l)}function yT(c,l,d){if(c===3){const{id:y,bitmap:M,width:N,height:X,left:vt,top:Ht,advance:Ui}=d.readMessage(vT,{});l.glyphs.push({id:y,bitmap:new $v({width:N+6,height:X+6},M),metrics:{width:N,height:X,left:vt,top:Ht,advance:Ui}})}else c===4?l.ascender=d.readSVarint():c===5&&(l.descender=d.readSVarint())}function vT(c,l,d){c===1?l.id=d.readVarint():c===2?l.bitmap=d.readBytes():c===3?l.width=d.readVarint():c===4?l.height=d.readVarint():c===5?l.left=d.readSVarint():c===6?l.top=d.readSVarint():c===7&&(l.advance=d.readVarint())}function x2(c){let l=0,d=0;for(const X of c)l+=X.w*X.h,d=Math.max(d,X.w);c.sort((X,vt)=>vt.h-X.h);const y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}];let M=0,N=0;for(const X of c)for(let vt=y.length-1;vt>=0;vt--){const Ht=y[vt];if(!(X.w>Ht.w||X.h>Ht.h)){if(X.x=Ht.x,X.y=Ht.y,N=Math.max(N,X.y+X.h),M=Math.max(M,X.x+X.w),X.w===Ht.w&&X.h===Ht.h){const Ui=y.pop();vt<y.length&&(y[vt]=Ui)}else X.h===Ht.h?(Ht.x+=X.w,Ht.w-=X.w):X.w===Ht.w?(Ht.y+=X.h,Ht.h-=X.h):(y.push({x:Ht.x+X.w,y:Ht.y,w:Ht.w-X.w,h:X.h}),Ht.y+=X.h,Ht.h-=X.h);break}}return{w:M,h:N,fill:l/(M*N)||0}}rg.prototype={destroy:function(){this.buf=null},readFields:function(c,l,d){for(d=d||this.length;this.pos<d;){var y=this.readVarint(),M=y>>3,N=this.pos;this.type=7&y,c(M,l,this),this.pos===N&&this.skip(y)}return l},readMessage:function(c,l){return this.readFields(c,l,this.readVarint()+this.pos)},readFixed32:function(){var c=Ow(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Y2(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Ow(this.buf,this.pos)+Ow(this.buf,this.pos+4)*v2;return this.pos+=8,c},readSFixed64:function(){var c=Ow(this.buf,this.pos)+Y2(this.buf,this.pos+4)*v2;return this.pos+=8,c},readFloat:function(){var c=q2(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=q2(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var l,d,y=this.buf;return l=127&(d=y[this.pos++]),d<128?l:(l|=(127&(d=y[this.pos++]))<<7,d<128?l:(l|=(127&(d=y[this.pos++]))<<14,d<128?l:(l|=(127&(d=y[this.pos++]))<<21,d<128?l:function(M,N,X){var vt,Ht,Ui=X.buf;if(vt=(112&(Ht=Ui[X.pos++]))>>4,Ht<128||(vt|=(127&(Ht=Ui[X.pos++]))<<3,Ht<128)||(vt|=(127&(Ht=Ui[X.pos++]))<<10,Ht<128)||(vt|=(127&(Ht=Ui[X.pos++]))<<17,Ht<128)||(vt|=(127&(Ht=Ui[X.pos++]))<<24,Ht<128)||(vt|=(1&(Ht=Ui[X.pos++]))<<31,Ht<128))return rb(M,vt,N);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(d=y[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,l=this.pos;return this.pos=c,c-l>=12&&X2?function(d,y,M){return X2.decode(d.subarray(y,M))}(this.buf,l,c):function(d,y,M){for(var N="",X=y;X<M;){var vt,Ht,Ui,Fn=d[X],Js=null,nl=Fn>239?4:Fn>223?3:Fn>191?2:1;if(X+nl>M)break;nl===1?Fn<128&&(Js=Fn):nl===2?(192&(vt=d[X+1]))==128&&(Js=(31&Fn)<<6|63&vt)<=127&&(Js=null):nl===3?(Ht=d[X+2],(192&(vt=d[X+1]))==128&&(192&Ht)==128&&((Js=(15&Fn)<<12|(63&vt)<<6|63&Ht)<=2047||Js>=55296&&Js<=57343)&&(Js=null)):nl===4&&(Ht=d[X+2],Ui=d[X+3],(192&(vt=d[X+1]))==128&&(192&Ht)==128&&(192&Ui)==128&&((Js=(15&Fn)<<18|(63&vt)<<12|(63&Ht)<<6|63&Ui)<=65535||Js>=1114112)&&(Js=null)),Js===null?(Js=65533,nl=1):Js>65535&&(Js-=65536,N+=String.fromCharCode(Js>>>10&1023|55296),Js=56320|1023&Js),N+=String.fromCharCode(Js),X+=nl}return N}(this.buf,l,c)},readBytes:function(){var c=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,c);return this.pos=c,l},readPackedVarint:function(c,l){if(this.type!==rg.Bytes)return c.push(this.readVarint(l));var d=k1(this);for(c=c||[];this.pos<d;)c.push(this.readVarint(l));return c},readPackedSVarint:function(c){if(this.type!==rg.Bytes)return c.push(this.readSVarint());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==rg.Bytes)return c.push(this.readBoolean());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==rg.Bytes)return c.push(this.readFloat());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==rg.Bytes)return c.push(this.readDouble());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==rg.Bytes)return c.push(this.readFixed32());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==rg.Bytes)return c.push(this.readSFixed32());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==rg.Bytes)return c.push(this.readFixed64());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==rg.Bytes)return c.push(this.readSFixed64());var l=k1(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed64());return c},skip:function(c){var l=7&c;if(l===rg.Varint)for(;this.buf[this.pos++]>127;);else if(l===rg.Bytes)this.pos=this.readVarint()+this.pos;else if(l===rg.Fixed32)this.pos+=4;else{if(l!==rg.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(c,l){this.writeVarint(c<<3|l)},realloc:function(c){for(var l=this.length||16;l<this.pos+c;)l*=2;if(l!==this.length){var d=new Uint8Array(l);d.set(this.buf),this.buf=d,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),nb(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),nb(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),nb(this.buf,-1&c,this.pos),nb(this.buf,Math.floor(c*H2),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),nb(this.buf,-1&c,this.pos),nb(this.buf,Math.floor(c*H2),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(l,d){var y,M;if(l>=0?(y=l%4294967296|0,M=l/4294967296|0):(M=~(-l/4294967296),4294967295^(y=~(-l%4294967296))?y=y+1|0:(y=0,M=M+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(N,X,vt){vt.buf[vt.pos++]=127&N|128,N>>>=7,vt.buf[vt.pos++]=127&N|128,N>>>=7,vt.buf[vt.pos++]=127&N|128,N>>>=7,vt.buf[vt.pos++]=127&N|128,vt.buf[vt.pos]=127&(N>>>=7)}(y,0,d),function(N,X){var vt=(7&N)<<4;X.buf[X.pos++]|=vt|((N>>>=3)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N|((N>>>=7)?128:0),N&&(X.buf[X.pos++]=127&N)))))}(M,d)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var l=this.pos;this.pos=function(y,M,N){for(var X,vt,Ht=0;Ht<M.length;Ht++){if((X=M.charCodeAt(Ht))>55295&&X<57344){if(!vt){X>56319||Ht+1===M.length?(y[N++]=239,y[N++]=191,y[N++]=189):vt=X;continue}if(X<56320){y[N++]=239,y[N++]=191,y[N++]=189,vt=X;continue}X=vt-55296<<10|X-56320|65536,vt=null}else vt&&(y[N++]=239,y[N++]=191,y[N++]=189,vt=null);X<128?y[N++]=X:(X<2048?y[N++]=X>>6|192:(X<65536?y[N++]=X>>12|224:(y[N++]=X>>18|240,y[N++]=X>>12&63|128),y[N++]=X>>6&63|128),y[N++]=63&X|128)}return N}(this.buf,c,this.pos);var d=this.pos-l;d>=128&&W2(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeFloat:function(c){this.realloc(4),Z2(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),Z2(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var l=c.length;this.writeVarint(l),this.realloc(l);for(var d=0;d<l;d++)this.buf[this.pos++]=c[d]},writeRawMessage:function(c,l){this.pos++;var d=this.pos;c(l,this);var y=this.pos-d;y>=128&&W2(d,y,this),this.pos=d-1,this.writeVarint(y),this.pos+=y},writeMessage:function(c,l,d){this.writeTag(c,rg.Bytes),this.writeRawMessage(l,d)},writePackedVarint:function(c,l){l.length&&this.writeMessage(c,lT,l)},writePackedSVarint:function(c,l){l.length&&this.writeMessage(c,cT,l)},writePackedBoolean:function(c,l){l.length&&this.writeMessage(c,dT,l)},writePackedFloat:function(c,l){l.length&&this.writeMessage(c,uT,l)},writePackedDouble:function(c,l){l.length&&this.writeMessage(c,hT,l)},writePackedFixed32:function(c,l){l.length&&this.writeMessage(c,fT,l)},writePackedSFixed32:function(c,l){l.length&&this.writeMessage(c,pT,l)},writePackedFixed64:function(c,l){l.length&&this.writeMessage(c,mT,l)},writePackedSFixed64:function(c,l){l.length&&this.writeMessage(c,gT,l)},writeBytesField:function(c,l){this.writeTag(c,rg.Bytes),this.writeBytes(l)},writeFixed32Field:function(c,l){this.writeTag(c,rg.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(c,l){this.writeTag(c,rg.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(c,l){this.writeTag(c,rg.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(c,l){this.writeTag(c,rg.Fixed64),this.writeSFixed64(l)},writeVarintField:function(c,l){this.writeTag(c,rg.Varint),this.writeVarint(l)},writeSVarintField:function(c,l){this.writeTag(c,rg.Varint),this.writeSVarint(l)},writeStringField:function(c,l){this.writeTag(c,rg.Bytes),this.writeString(l)},writeFloatField:function(c,l){this.writeTag(c,rg.Fixed32),this.writeFloat(l)},writeDoubleField:function(c,l){this.writeTag(c,rg.Fixed64),this.writeDouble(l)},writeBooleanField:function(c,l){this.writeVarintField(c,!!l)}};class b2{constructor(l,{pixelRatio:d,version:y,stretchX:M,stretchY:N,content:X}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=M,this.stretchY=N,this.content=X,this.version=y}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class K2{constructor(l,d){const y={},M={};this.haveRenderCallbacks=[];const N=[];this.addImages(l,y,N),this.addImages(d,M,N);const{w:X,h:vt}=x2(N),Ht=new Q_({width:X||1,height:vt||1});for(const Ui in l){const Fn=l[Ui],Js=y[Ui].paddedRect;Q_.copy(Fn.data,Ht,{x:0,y:0},{x:Js.x+1,y:Js.y+1},Fn.data)}for(const Ui in d){const Fn=d[Ui],Js=M[Ui].paddedRect,nl=Js.x+1,ju=Js.y+1,Ku=Fn.data.width,lh=Fn.data.height;Q_.copy(Fn.data,Ht,{x:0,y:0},{x:nl,y:ju},Fn.data),Q_.copy(Fn.data,Ht,{x:0,y:lh-1},{x:nl,y:ju-1},{width:Ku,height:1}),Q_.copy(Fn.data,Ht,{x:0,y:0},{x:nl,y:ju+lh},{width:Ku,height:1}),Q_.copy(Fn.data,Ht,{x:Ku-1,y:0},{x:nl-1,y:ju},{width:1,height:lh}),Q_.copy(Fn.data,Ht,{x:0,y:0},{x:nl+Ku,y:ju},{width:1,height:lh})}this.image=Ht,this.iconPositions=y,this.patternPositions=M}addImages(l,d,y){for(const M in l){const N=l[M],X={x:0,y:0,w:N.data.width+2,h:N.data.height+2};y.push(X),d[M]=new b2(X,N),N.hasRenderCallback&&this.haveRenderCallbacks.push(M)}}patchUpdatedImages(l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(y=>l.hasImage(y)),l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const y in l.updatedImages)this.patchUpdatedImage(this.iconPositions[y],l.getImage(y),d),this.patchUpdatedImage(this.patternPositions[y],l.getImage(y),d)}patchUpdatedImage(l,d,y){if(!l||!d||l.version===d.version)return;l.version=d.version;const[M,N]=l.tl;y.update(d.data,void 0,{x:M,y:N})}}Ip(b2,"ImagePosition"),Ip(K2,"ImageAtlas");const J0={horizontal:1,vertical:2,horizontalOnly:3};class jb{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,d){const y=new jb;return y.scale=l||1,y.fontStack=d,y}static forImage(l){const d=new jb;return d.imageName=l,d}}class ob{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){const y=new ob;for(let M=0;M<l.sections.length;M++){const N=l.sections[M];N.image?y.addImageSection(N):y.addTextSection(N,d)}return y}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSections(){return this.sections}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(l){this.text=function(d,y){let M="";for(let N=0;N<d.length;N++){const X=d.charCodeAt(N+1)||null,vt=d.charCodeAt(N-1)||null;M+=!y&&(X&&ss(X)&&!Vb[d[N+1]]||vt&&ss(vt)&&!Vb[d[N-1]])||!Vb[d[N]]?d[N]:Vb[d[N]]}return M}(this.text,l)}trim(){let l=0;for(let y=0;y<this.text.length&&$w[this.text.charCodeAt(y)];y++)l++;let d=this.text.length;for(let y=this.text.length-1;y>=0&&y>=l&&$w[this.text.charCodeAt(y)];y--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){const y=new ob;return y.text=this.text.substring(l,d),y.sectionIndex=this.sectionIndex.slice(l,d),y.sections=this.sections,y}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}addTextSection(l,d){this.text+=l.text,this.sections.push(jb.forText(l.scale,l.fontStack||d));const y=this.sections.length-1;for(let M=0;M<l.text.length;++M)this.sectionIndex.push(y)}addImageSection(l){const d=l.image?l.image.name:"";if(d.length===0)return void rp("Can't add FormattedSection with an empty image.");const y=this.getNextImageSectionCharCode();y?(this.text+=String.fromCharCode(y),this.sections.push(jb.forImage(d)),this.sectionIndex.push(this.sections.length-1)):rp("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function w2(c,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku){const lh=ob.fromFeature(c,M);Js===J0.vertical&&lh.verticalizePunctuation(nl);let Eh=[];const Bh=function(ed,Rd,kd,Sf,Zf,jd){if(!ed)return[];const Pf=[],Rf=function(up,jp,vp,Rp,dp,Xp){let xm=0;for(let gm=0;gm<up.length();gm++){const pm=up.getSection(gm);xm+=Q2(up.getCharCode(gm),pm,Rp,dp,jp,Xp)}return xm/Math.max(1,Math.ceil(xm/vp))}(ed,Rd,kd,Sf,Zf,jd),Uf=ed.text.indexOf("​")>=0;let Xf=0;for(let up=0;up<ed.length();up++){const jp=ed.getSection(up),vp=ed.getCharCode(up);if($w[vp]||(Xf+=Q2(vp,jp,Sf,Zf,Rd,jd)),up<ed.length()-1){const Rp=!((Hd=vp)<11904||!(ph(Hd)||th(Hd)||L(Hd)||Wd(Hd)||Kh(Hd)||Ft(Hd)||Dh(Hd)||Zs(Hd)||fd(Hd)||cd(Hd)||Mh(Hd)||B(Hd)||ol(Hd)||ls(Hd)||Xr(Hd)||$h(Hd)||rh(Hd)||Of(Hd)||Td(Hd)||jh(Hd)));(xT[vp]||Rp||jp.imageName)&&Pf.push(eE(up+1,Xf,Rf,Pf,bT(vp,ed.getCharCode(up+1),Rp&&Uf),!1))}}var Hd;return tE(eE(ed.length(),Xf,Rf,Pf,0,!0))}(lh,Ui,N,l,y,ju),{processBidirectionalText:Yh,processStyledBidirectionalText:kh}=Hh;if(Yh&&lh.sections.length===1){const ed=Yh(lh.toString(),Bh);for(const Rd of ed){const kd=new ob;kd.text=Rd,kd.sections=lh.sections;for(let Sf=0;Sf<Rd.length;Sf++)kd.sectionIndex.push(0);Eh.push(kd)}}else if(kh){const ed=kh(lh.text,lh.sectionIndex,Bh);for(const Rd of ed){const kd=new ob;kd.text=Rd[0],kd.sectionIndex=Rd[1],kd.sections=lh.sections,Eh.push(kd)}}else Eh=function(ed,Rd){const kd=[],Sf=ed.text;let Zf=0;for(const jd of Rd)kd.push(ed.substring(Zf,jd)),Zf=jd;return Zf<Sf.length&&kd.push(ed.substring(Zf,Sf.length)),kd}(lh,Bh);const Vh=[],rd={positionedLines:Vh,text:lh.toString(),top:Fn[1],bottom:Fn[1],left:Fn[0],right:Fn[0],writingMode:Js,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf,Xf,Hd,up){let jp=0,vp=0,Rp=0;const dp=Rf==="right"?1:Rf==="left"?0:.5;let Xp=!1;for(const tm of Zf){const bm=tm.getSections();for(const Wm of bm){if(Wm.imageName)continue;const hg=Rd[Wm.fontStack];if(hg&&(Xp=hg.ascender!==void 0&&hg.descender!==void 0,!Xp))break}if(!Xp)break}let xm=0;for(const tm of Zf){tm.trim();const bm=tm.getMaxScale(),Wm=(bm-1)*ny,hg={positionedGlyphs:[],lineOffset:0};ed.positionedLines[xm]=hg;const ng=hg.positionedGlyphs;let dg=0;if(!tm.length()){vp+=jd,++xm;continue}let xg=0,Ug=0;for(let Hm=0;Hm<tm.length();Hm++){const r_=tm.getSection(Hm),Kg=tm.getSectionIndex(Hm),Lm=tm.getCharCode(Hm);let Ag=r_.scale,s_=null,Ym=null,Zg=null,dy=ny,z_=0;const F_=!(Uf===J0.horizontal||!Hd&&!qr(Lm)||Hd&&($w[Lm]||(gm=Lm,A(gm)||q(gm)||nt(gm)||Mf(gm)||E(gm))));if(r_.imageName){const ky=Sf[r_.imageName];if(!ky)continue;Zg=r_.imageName,ed.iconsInText=ed.iconsInText||!0,Ym=ky.paddedRect;const U_=ky.displaySize;Ag=Ag*ny/up,s_={width:U_[0],height:U_[1],left:1,top:-3,advance:F_?U_[1]:U_[0],localGlyph:!1},z_=Xp?-s_.height*Ag:bm*ny-17-U_[1]*Ag,dy=s_.advance;const L1=(F_?U_[0]:U_[1])*Ag-ny*bm;L1>0&&L1>dg&&(dg=L1)}else{const ky=kd[r_.fontStack];if(!ky)continue;ky[Lm]&&(Ym=ky[Lm]);const U_=Rd[r_.fontStack];if(!U_)continue;const L1=U_.glyphs[Lm];if(!L1)continue;if(s_=L1.metrics,dy=Lm!==8203?ny:0,Xp){const ub=U_.ascender!==void 0?Math.abs(U_.ascender):0,Qb=U_.descender!==void 0?Math.abs(U_.descender):0,Jb=(ub+Qb)*Ag;xg<Jb&&(xg=Jb,Ug=(ub-Qb)/2*Ag),z_=-ub*Ag}else z_=(bm-Ag)*ny-17}F_?(ed.verticalizable=!0,ng.push({glyph:Lm,imageName:Zg,x:jp,y:vp+z_,vertical:F_,scale:Ag,localGlyph:s_.localGlyph,fontStack:r_.fontStack,sectionIndex:Kg,metrics:s_,rect:Ym}),jp+=dy*Ag+Xf):(ng.push({glyph:Lm,imageName:Zg,x:jp,y:vp+z_,vertical:F_,scale:Ag,localGlyph:s_.localGlyph,fontStack:r_.fontStack,sectionIndex:Kg,metrics:s_,rect:Ym}),jp+=s_.advance*Ag+Xf)}ng.length!==0&&(Rp=Math.max(jp-Xf,Rp),Xp?iE(ng,dp,dg,Ug,jd*bm/2):iE(ng,dp,dg,0,jd/2)),jp=0;const N_=jd*bm+dg;hg.lineOffset=Math.max(dg,Wm),vp+=N_,++xm}var gm;const pm=vp,{horizontalAlign:Wp,verticalAlign:Zm}=E2(Pf);(function(tm,bm,Wm,hg,ng,dg){const xg=(bm-Wm)*ng,Ug=-dg*hg;for(const N_ of tm)for(const Hm of N_.positionedGlyphs)Hm.x+=xg,Hm.y+=Ug})(ed.positionedLines,dp,Wp,Zm,Rp,pm),ed.top+=-Zm*pm,ed.bottom=ed.top+pm,ed.left+=-Wp*Rp,ed.right=ed.left+Rp,ed.hasBaseline=Xp}(rd,l,d,y,Eh,X,vt,Ht,Js,Ui,nl,Ku),!function(ed){for(const Rd of ed)if(Rd.positionedGlyphs.length!==0)return!1;return!0}(Vh)&&rd}const $w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Q2(c,l,d,y,M,N){if(l.imageName){const X=y[l.imageName];return X?X.displaySize[0]*l.scale*ny/N+M:0}{const X=d[l.fontStack],vt=X&&X.glyphs[c];return vt?vt.metrics.advance*l.scale+M:0}}function J2(c,l,d,y){const M=Math.pow(c-l,2);return y?c<l?M/2:2*M:M+Math.abs(d)*d}function bT(c,l,d){let y=0;return c===10&&(y-=1e4),d&&(y+=150),c!==40&&c!==65288||(y+=50),l!==41&&l!==65289||(y+=50),y}function eE(c,l,d,y,M,N){let X=null,vt=J2(l,d,M,N);for(const Ht of y){const Ui=J2(l-Ht.x,d,M,N)+Ht.badness;Ui<=vt&&(X=Ht,vt=Ui)}return{index:c,x:l,priorBreak:X,badness:vt}}function tE(c){return c?tE(c.priorBreak).concat(c.index):[]}function E2(c){let l=.5,d=.5;switch(c){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function iE(c,l,d,y,M){if(!(l||d||y||M))return;const N=c.length-1,X=c[N],vt=(X.x+X.metrics.advance*X.scale)*l;for(let Ht=0;Ht<=N;Ht++)c[Ht].x-=vt,c[Ht].y+=d+y+M}function wT(c,l,d){const{horizontalAlign:y,verticalAlign:M}=E2(d),N=l[0]-c.displaySize[0]*y,X=l[1]-c.displaySize[1]*M;return{image:c,top:X,bottom:X+c.displaySize[1],left:N,right:N+c.displaySize[0]}}function rE(c,l,d,y,M,N){const X=c.image;let vt;if(X.content){const Eh=X.content,Bh=X.pixelRatio||1;vt=[Eh[0]/Bh,Eh[1]/Bh,X.displaySize[0]-Eh[2]/Bh,X.displaySize[1]-Eh[3]/Bh]}const Ht=l.left*N,Ui=l.right*N;let Fn,Js,nl,ju;d==="width"||d==="both"?(ju=M[0]+Ht-y[3],Js=M[0]+Ui+y[1]):(ju=M[0]+(Ht+Ui-X.displaySize[0])/2,Js=ju+X.displaySize[0]);const Ku=l.top*N,lh=l.bottom*N;return d==="height"||d==="both"?(Fn=M[1]+Ku-y[0],nl=M[1]+lh+y[2]):(Fn=M[1]+(Ku+lh-X.displaySize[1])/2,nl=Fn+X.displaySize[1]),{image:X,top:Fn,right:Js,bottom:nl,left:ju,collisionPadding:vt}}class D1 extends $s{constructor(l,d,y,M,N){super(l,d),this.angle=M,this.z=y,N!==void 0&&(this.segment=N)}clone(){return new D1(this.x,this.y,this.z,this.angle,this.segment)}}function nE(c,l,d,y,M){if(l.segment===void 0)return!0;let N=l,X=l.segment+1,vt=0;for(;vt>-d/2;){if(X--,X<0)return!1;vt-=c[X].dist(N),N=c[X]}vt+=c[X].dist(c[X+1]),X++;const Ht=[];let Ui=0;for(;vt<d/2;){const Fn=c[X],Js=c[X+1];if(!Js)return!1;let nl=c[X-1].angleTo(Fn)-Fn.angleTo(Js);for(nl=Math.abs((nl+3*Math.PI)%(2*Math.PI)-Math.PI),Ht.push({distance:vt,angleDelta:nl}),Ui+=nl;vt-Ht[0].distance>y;)Ui-=Ht.shift().angleDelta;if(Ui>M)return!1;X++,vt+=Fn.dist(Js)}return!0}function oE(c){let l=0;for(let d=0;d<c.length-1;d++)l+=c[d].dist(c[d+1]);return l}function aE(c,l,d){return c?.6*l*d:0}function sE(c,l){return Math.max(c?c.right-c.left:0,l?l.right-l.left:0)}function ET(c,l,d,y,M,N){const X=aE(d,M,N),vt=sE(d,y)*N;let Ht=0;const Ui=oE(c)/2;for(let Fn=0;Fn<c.length-1;Fn++){const Js=c[Fn],nl=c[Fn+1],ju=Js.dist(nl);if(Ht+ju>Ui){const Ku=(Ui-Ht)/ju,lh=Kp(Js.x,nl.x,Ku),Eh=Kp(Js.y,nl.y,Ku),Bh=new D1(lh,Eh,0,nl.angleTo(Js),Fn);return!X||nE(c,Bh,vt,X,l)?Bh:void 0}Ht+=ju}}function TT(c,l,d,y,M,N,X,vt,Ht){const Ui=aE(y,N,X),Fn=sE(y,M),Js=Fn*X,nl=c[0].x===0||c[0].x===Ht||c[0].y===0||c[0].y===Ht;return l-Js<l/4&&(l=Js+l/4),lE(c,nl?l/2*vt%l:(Fn/2+2*N)*X*vt%l,l,Ui,d,Js,nl,!1,Ht)}function lE(c,l,d,y,M,N,X,vt,Ht){const Ui=N/2,Fn=oE(c);let Js=0,nl=l-d,ju=[];for(let Ku=0;Ku<c.length-1;Ku++){const lh=c[Ku],Eh=c[Ku+1],Bh=lh.dist(Eh),Yh=Eh.angleTo(lh);for(;nl+d<Js+Bh;){nl+=d;const kh=(nl-Js)/Bh,Vh=Kp(lh.x,Eh.x,kh),rd=Kp(lh.y,Eh.y,kh);if(Vh>=0&&Vh<Ht&&rd>=0&&rd<Ht&&nl-Ui>=0&&nl+Ui<=Fn){const ed=new D1(Vh,rd,0,Yh,Ku);ed._round(),y&&!nE(c,ed,N,y,M)||ju.push(ed)}}Js+=Bh}return vt||ju.length||X||(ju=lE(c,Js/2,d,y,M,N,X,!0,Ht)),ju}function cE(c,l,d,y,M){const N=[];for(let X=0;X<c.length;X++){const vt=c[X];let Ht;for(let Ui=0;Ui<vt.length-1;Ui++){let Fn=vt[Ui],Js=vt[Ui+1];Fn.x<l&&Js.x<l||(Fn.x<l?Fn=new $s(l,Fn.y+(l-Fn.x)/(Js.x-Fn.x)*(Js.y-Fn.y))._round():Js.x<l&&(Js=new $s(l,Fn.y+(l-Fn.x)/(Js.x-Fn.x)*(Js.y-Fn.y))._round()),Fn.y<d&&Js.y<d||(Fn.y<d?Fn=new $s(Fn.x+(d-Fn.y)/(Js.y-Fn.y)*(Js.x-Fn.x),d)._round():Js.y<d&&(Js=new $s(Fn.x+(d-Fn.y)/(Js.y-Fn.y)*(Js.x-Fn.x),d)._round()),Fn.x>=y&&Js.x>=y||(Fn.x>=y?Fn=new $s(y,Fn.y+(y-Fn.x)/(Js.x-Fn.x)*(Js.y-Fn.y))._round():Js.x>=y&&(Js=new $s(y,Fn.y+(y-Fn.x)/(Js.x-Fn.x)*(Js.y-Fn.y))._round()),Fn.y>=M&&Js.y>=M||(Fn.y>=M?Fn=new $s(Fn.x+(M-Fn.y)/(Js.y-Fn.y)*(Js.x-Fn.x),M)._round():Js.y>=M&&(Js=new $s(Fn.x+(M-Fn.y)/(Js.y-Fn.y)*(Js.x-Fn.x),M)._round()),Ht&&Fn.equals(Ht[Ht.length-1])||(Ht=[Fn],N.push(Ht)),Ht.push(Js)))))}}return N}Ip(D1,"Anchor");const qb=1e20;function uE(c,l,d,y,M,N,X,vt,Ht){for(let Ui=l;Ui<l+y;Ui++)hE(c,d*N+Ui,N,M,X,vt,Ht);for(let Ui=d;Ui<d+M;Ui++)hE(c,Ui*N+l,1,y,X,vt,Ht)}function hE(c,l,d,y,M,N,X){N[0]=0,X[0]=-qb,X[1]=qb,M[0]=c[l];for(let vt=1,Ht=0,Ui=0;vt<y;vt++){M[vt]=c[l+vt*d];const Fn=vt*vt;do{const Js=N[Ht];Ui=(M[vt]-M[Js]+Fn-Js*Js)/(vt-Js)/2}while(Ui<=X[Ht]&&--Ht>-1);Ht++,N[Ht]=vt,X[Ht]=Ui,X[Ht+1]=qb}for(let vt=0,Ht=0;vt<y;vt++){for(;X[Ht+1]<vt;)Ht++;const Ui=N[Ht],Fn=vt-Ui;c[l+vt*d]=M[Ui]+Fn*Fn}}const T2={none:0,ideographs:1,all:2};class ab{constructor(l,d,y){this.requestManager=l,this.localGlyphMode=d,this.localFontFamily=y,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(l){this.url=l}getGlyphs(l,d){const y=[];for(const M in l)for(const N of l[M])y.push({stack:M,id:N});Kd(y,({stack:M,id:N},X)=>{let vt=this.entries[M];vt||(vt=this.entries[M]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let Ht=vt.glyphs[N];if(Ht!==void 0)return void X(null,{stack:M,id:N,glyph:Ht});if(Ht=this._tinySDF(vt,M,N),Ht)return vt.glyphs[N]=Ht,void X(null,{stack:M,id:N,glyph:Ht});const Ui=Math.floor(N/256);if(256*Ui>65535)return void X(new Error("glyphs > 65535 not supported"));if(vt.ranges[Ui])return void X(null,{stack:M,id:N,glyph:Ht});let Fn=vt.requests[Ui];Fn||(Fn=vt.requests[Ui]=[],ab.loadGlyphRange(M,Ui,this.url,this.requestManager,(Js,nl)=>{if(nl){vt.ascender=nl.ascender,vt.descender=nl.descender;for(const ju in nl.glyphs)this._doesCharSupportLocalGlyph(+ju)||(vt.glyphs[+ju]=nl.glyphs[+ju]);vt.ranges[Ui]=!0}for(const ju of Fn)ju(Js,nl);delete vt.requests[Ui]})),Fn.push((Js,nl)=>{Js?X(Js):nl&&X(null,{stack:M,id:N,glyph:nl.glyphs[N]||null})})},(M,N)=>{if(M)d(M);else if(N){const X={};for(const{stack:vt,id:Ht,glyph:Ui}of N)X[vt]===void 0&&(X[vt]={}),X[vt].glyphs===void 0&&(X[vt].glyphs={}),X[vt].glyphs[Ht]=Ui&&{id:Ui.id,bitmap:Ui.bitmap.clone(),metrics:Ui.metrics},X[vt].ascender=this.entries[vt].ascender,X[vt].descender=this.entries[vt].descender;d(null,X)}})}_doesCharSupportLocalGlyph(l){return this.localGlyphMode!==T2.none&&(this.localGlyphMode===T2.all?!!this.localFontFamily:!!this.localFontFamily&&(cd(l)||Vd(l)||ol(l)||rh(l)||Zs(l)))}_tinySDF(l,d,y){const M=this.localFontFamily;if(!M||!this._doesCharSupportLocalGlyph(y))return;let N=l.tinySDF;if(!N){let lh="400";/bold/i.test(d)?lh="900":/medium/i.test(d)?lh="500":/light/i.test(d)&&(lh="200"),N=l.tinySDF=new ab.TinySDF({fontFamily:M,fontWeight:lh,fontSize:48,buffer:6,radius:16}),N.fontWeight=lh}if(this.localGlyphs[N.fontWeight][y])return this.localGlyphs[N.fontWeight][y];const X=String.fromCharCode(y),{data:vt,width:Ht,height:Ui,glyphWidth:Fn,glyphHeight:Js,glyphLeft:nl,glyphTop:ju,glyphAdvance:Ku}=N.draw(X);return this.localGlyphs[N.fontWeight][y]={id:y,bitmap:new $v({width:Ht,height:Ui},vt),metrics:{width:Fn/2,height:Js/2,left:nl/2,top:ju/2-27,advance:Ku/2,localGlyph:!0}}}}function dE(c,l,d,y){const M=[],N=c.image,X=N.pixelRatio,vt=N.paddedRect.w-2,Ht=N.paddedRect.h-2,Ui=c.right-c.left,Fn=c.bottom-c.top,Js=N.stretchX||[[0,vt]],nl=N.stretchY||[[0,Ht]],ju=(jd,Pf)=>jd+Pf[1]-Pf[0],Ku=Js.reduce(ju,0),lh=nl.reduce(ju,0),Eh=vt-Ku,Bh=Ht-lh;let Yh=0,kh=Ku,Vh=0,rd=lh,ed=0,Rd=Eh,kd=0,Sf=Bh;if(N.content&&y){const jd=N.content;Yh=Bw(Js,0,jd[0]),Vh=Bw(nl,0,jd[1]),kh=Bw(Js,jd[0],jd[2]),rd=Bw(nl,jd[1],jd[3]),ed=jd[0]-Yh,kd=jd[1]-Vh,Rd=jd[2]-jd[0]-kh,Sf=jd[3]-jd[1]-rd}const Zf=(jd,Pf,Rf,Uf)=>{const Xf=Nw(jd.stretch-Yh,kh,Ui,c.left),Hd=zw(jd.fixed-ed,Rd,jd.stretch,Ku),up=Nw(Pf.stretch-Vh,rd,Fn,c.top),jp=zw(Pf.fixed-kd,Sf,Pf.stretch,lh),vp=Nw(Rf.stretch-Yh,kh,Ui,c.left),Rp=zw(Rf.fixed-ed,Rd,Rf.stretch,Ku),dp=Nw(Uf.stretch-Vh,rd,Fn,c.top),Xp=zw(Uf.fixed-kd,Sf,Uf.stretch,lh),xm=new $s(Xf,up),gm=new $s(vp,up),pm=new $s(vp,dp),Wp=new $s(Xf,dp),Zm=new $s(Hd/X,jp/X),tm=new $s(Rp/X,Xp/X),bm=l*Math.PI/180;if(bm){const ng=Math.sin(bm),dg=Math.cos(bm),xg=[dg,-ng,ng,dg];xm._matMult(xg),gm._matMult(xg),Wp._matMult(xg),pm._matMult(xg)}const Wm=jd.stretch+jd.fixed,hg=Pf.stretch+Pf.fixed;return{tl:xm,tr:gm,bl:Wp,br:pm,tex:{x:N.paddedRect.x+1+Wm,y:N.paddedRect.y+1+hg,w:Rf.stretch+Rf.fixed-Wm,h:Uf.stretch+Uf.fixed-hg},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zm,pixelOffsetBR:tm,minFontScaleX:Rd/X/Ui,minFontScaleY:Sf/X/Fn,isSDF:d}};if(y&&(N.stretchX||N.stretchY)){const jd=fE(Js,Eh,Ku),Pf=fE(nl,Bh,lh);for(let Rf=0;Rf<jd.length-1;Rf++){const Uf=jd[Rf],Xf=jd[Rf+1];for(let Hd=0;Hd<Pf.length-1;Hd++)M.push(Zf(Uf,Pf[Hd],Xf,Pf[Hd+1]))}}else M.push(Zf({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:vt+1},{fixed:0,stretch:Ht+1}));return M}function Bw(c,l,d){let y=0;for(const M of c)y+=Math.max(l,Math.min(d,M[1]))-Math.max(l,Math.min(d,M[0]));return y}function fE(c,l,d){const y=[{fixed:-1,stretch:0}];for(const[M,N]of c){const X=y[y.length-1];y.push({fixed:M-X.stretch,stretch:X.stretch}),y.push({fixed:M-X.stretch,stretch:X.stretch+(N-M)})}return y.push({fixed:l+1,stretch:d}),y}function Nw(c,l,d,y){return c/l*d+y}function zw(c,l,d,y){return c-l*d/y}function ST(c,l,d,y){const M=l+c.positionedLines[y].lineOffset;return y===0?d+M/2:d+(M+(l+c.positionedLines[y-1].lineOffset))/2}ab.loadGlyphRange=function(c,l,d,y,M){const N=256*l,X=N+255,vt=y.transformRequest(y.normalizeGlyphsURL(d).replace("{fontstack}",c).replace("{range}",`${N}-${X}`),Wf.Glyphs);Yf(vt,(Ht,Ui)=>{if(Ht)M(Ht);else if(Ui){const Fn={},Js=function(nl){return new Gb(nl).readFields(_T,{})}(Ui);for(const nl of Js.glyphs)Fn[nl.id]=nl;M(null,{glyphs:Fn,ascender:Js.ascender,descender:Js.descender})}})},ab.TinySDF=class{constructor({fontSize:c=24,buffer:l=3,radius:d=8,cutoff:y=.25,fontFamily:M="sans-serif",fontWeight:N="normal",fontStyle:X="normal"}={}){this.buffer=l,this.cutoff=y,this.radius=d;const vt=this.size=c+4*l,Ht=this._createCanvas(vt),Ui=this.ctx=Ht.getContext("2d",{willReadFrequently:!0});Ui.font=`${X} ${N} ${c}px ${M}`,Ui.textBaseline="alphabetic",Ui.textAlign="left",Ui.fillStyle="black",this.gridOuter=new Float64Array(vt*vt),this.gridInner=new Float64Array(vt*vt),this.f=new Float64Array(vt),this.z=new Float64Array(vt+1),this.v=new Uint16Array(vt)}_createCanvas(c){const l=document.createElement("canvas");return l.width=l.height=c,l}draw(c){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:M,actualBoundingBoxRight:N}=this.ctx.measureText(c),X=Math.ceil(d),vt=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(N-M))),Ht=Math.min(this.size-this.buffer,X+Math.ceil(y)),Ui=vt+2*this.buffer,Fn=Ht+2*this.buffer,Js=Math.max(Ui*Fn,0),nl=new Uint8ClampedArray(Js),ju={data:nl,width:Ui,height:Fn,glyphWidth:vt,glyphHeight:Ht,glyphTop:X,glyphLeft:0,glyphAdvance:l};if(vt===0||Ht===0)return ju;const{ctx:Ku,buffer:lh,gridInner:Eh,gridOuter:Bh}=this;Ku.clearRect(lh,lh,vt,Ht),Ku.fillText(c,lh,lh+X);const Yh=Ku.getImageData(lh,lh,vt,Ht);Bh.fill(qb,0,Js),Eh.fill(0,0,Js);for(let kh=0;kh<Ht;kh++)for(let Vh=0;Vh<vt;Vh++){const rd=Yh.data[4*(kh*vt+Vh)+3]/255;if(rd===0)continue;const ed=(kh+lh)*Ui+Vh+lh;if(rd===1)Bh[ed]=0,Eh[ed]=qb;else{const Rd=.5-rd;Bh[ed]=Rd>0?Rd*Rd:0,Eh[ed]=Rd<0?Rd*Rd:0}}uE(Bh,0,0,Ui,Fn,Ui,this.f,this.v,this.z),uE(Eh,lh,lh,vt,Ht,Ui,this.f,this.v,this.z);for(let kh=0;kh<Js;kh++){const Vh=Math.sqrt(Bh[kh])-Math.sqrt(Eh[kh]);nl[kh]=Math.round(255-255*(Vh/this.radius+this.cutoff))}return ju}};class IT{constructor(l=[],d=CT){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let y=(this.length>>1)-1;y>=0;y--)this._down(y)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:d,compare:y}=this,M=d[l];for(;l>0;){const N=l-1>>1,X=d[N];if(y(M,X)>=0)break;d[l]=X,l=N}d[l]=M}_down(l){const{data:d,compare:y}=this,M=this.length>>1,N=d[l];for(;l<M;){let X=1+(l<<1),vt=d[X];const Ht=X+1;if(Ht<this.length&&y(d[Ht],vt)<0&&(X=Ht,vt=d[Ht]),y(vt,N)>=0)break;d[l]=vt,l=X}d[l]=N}}function CT(c,l){return c<l?-1:c>l?1:0}function MT(c,l=1,d=!1){let y=1/0,M=1/0,N=-1/0,X=-1/0;const vt=c[0];for(let ju=0;ju<vt.length;ju++){const Ku=vt[ju];(!ju||Ku.x<y)&&(y=Ku.x),(!ju||Ku.y<M)&&(M=Ku.y),(!ju||Ku.x>N)&&(N=Ku.x),(!ju||Ku.y>X)&&(X=Ku.y)}const Ht=Math.min(N-y,X-M);let Ui=Ht/2;const Fn=new IT([],AT);if(Ht===0)return new $s(y,M);for(let ju=y;ju<N;ju+=Ht)for(let Ku=M;Ku<X;Ku+=Ht)Fn.push(new sb(ju+Ui,Ku+Ui,Ui,c));let Js=function(ju){let Ku=0,lh=0,Eh=0;const Bh=ju[0];for(let Yh=0,kh=Bh.length,Vh=kh-1;Yh<kh;Vh=Yh++){const rd=Bh[Yh],ed=Bh[Vh],Rd=rd.x*ed.y-ed.x*rd.y;lh+=(rd.x+ed.x)*Rd,Eh+=(rd.y+ed.y)*Rd,Ku+=3*Rd}return new sb(lh/Ku,Eh/Ku,0,ju)}(c),nl=Fn.length;for(;Fn.length;){const ju=Fn.pop();(ju.d>Js.d||!Js.d)&&(Js=ju,d&&console.log("found best %d after %d probes",Math.round(1e4*ju.d)/1e4,nl)),ju.max-Js.d<=l||(Ui=ju.h/2,Fn.push(new sb(ju.p.x-Ui,ju.p.y-Ui,Ui,c)),Fn.push(new sb(ju.p.x+Ui,ju.p.y-Ui,Ui,c)),Fn.push(new sb(ju.p.x-Ui,ju.p.y+Ui,Ui,c)),Fn.push(new sb(ju.p.x+Ui,ju.p.y+Ui,Ui,c)),nl+=4)}return d&&(console.log(`num probes: ${nl}`),console.log(`best distance: ${Js.d}`)),Js.p}function AT(c,l){return l.max-c.max}class sb{constructor(l,d,y,M){this.p=new $s(l,d),this.h=y,this.d=function(N,X){let vt=!1,Ht=1/0;for(let Ui=0;Ui<X.length;Ui++){const Fn=X[Ui];for(let Js=0,nl=Fn.length,ju=nl-1;Js<nl;ju=Js++){const Ku=Fn[Js],lh=Fn[ju];Ku.y>N.y!=lh.y>N.y&&N.x<(lh.x-Ku.x)*(N.y-Ku.y)/(lh.y-Ku.y)+Ku.x&&(vt=!vt),Ht=Math.min(Ht,E1(N,Ku,lh))}}return(vt?1:-1)*Math.sqrt(Ht)}(this.p,M),this.max=this.d+this.h*Math.SQRT2}}const S2=Number.POSITIVE_INFINITY,PT=Math.sqrt(2);function pE(c,[l,d]){let y=0,M=0;if(d===S2){l<0&&(l=0);const N=l/PT;switch(c){case"top-right":case"top-left":M=N-7;break;case"bottom-right":case"bottom-left":M=7-N;break;case"bottom":M=7-l;break;case"top":M=l-7}switch(c){case"top-right":case"bottom-right":y=-N;break;case"top-left":case"bottom-left":y=N;break;case"left":y=l;break;case"right":y=-l}}else{switch(l=Math.abs(l),d=Math.abs(d),c){case"top-right":case"top-left":case"top":M=d-7;break;case"bottom-right":case"bottom-left":case"bottom":M=7-d}switch(c){case"top-right":case"bottom-right":case"right":y=-l;break;case"top-left":case"bottom-left":case"left":y=l}}return[y,M]}function kT(c,l,d,y,M,N,X,vt,Ht,Ui){c.createArrays(),c.tilePixelRatio=Hp/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const Fn=c.layers[0].layout,Js=c.layers[0]._unevaluatedLayout._values,nl={};if(c.textSizeData.kind==="composite"){const{minZoom:lh,maxZoom:Eh}=c.textSizeData;nl.compositeTextSizes=[Js["text-size"].possiblyEvaluate(new ld(lh),vt),Js["text-size"].possiblyEvaluate(new ld(Eh),vt)]}if(c.iconSizeData.kind==="composite"){const{minZoom:lh,maxZoom:Eh}=c.iconSizeData;nl.compositeIconSizes=[Js["icon-size"].possiblyEvaluate(new ld(lh),vt),Js["icon-size"].possiblyEvaluate(new ld(Eh),vt)]}nl.layoutTextSize=Js["text-size"].possiblyEvaluate(new ld(Ht+1),vt),nl.layoutIconSize=Js["icon-size"].possiblyEvaluate(new ld(Ht+1),vt),nl.textMaxSize=Js["text-size"].possiblyEvaluate(new ld(18),vt);const ju=Fn.get("text-rotation-alignment")==="map"&&Fn.get("symbol-placement")!=="point",Ku=Fn.get("text-size");for(const lh of c.features){const Eh=Fn.get("text-font").evaluate(lh,{},vt).join(","),Bh=Ku.evaluate(lh,{},vt),Yh=nl.layoutTextSize.evaluate(lh,{},vt),kh=(nl.layoutIconSize.evaluate(lh,{},vt),{horizontal:{},vertical:void 0}),Vh=lh.text;let rd,ed=[0,0];if(Vh){const Sf=Vh.toString(),Zf=Fn.get("text-letter-spacing").evaluate(lh,{},vt)*ny,jd=Fn.get("text-line-height").evaluate(lh,{},vt)*ny,Pf=St(Sf)?Zf:0,Rf=Fn.get("text-anchor").evaluate(lh,{},vt),Uf=Fn.get("text-variable-anchor");if(!Uf){const vp=Fn.get("text-radial-offset").evaluate(lh,{},vt);ed=vp?pE(Rf,[vp*ny,S2]):Fn.get("text-offset").evaluate(lh,{},vt).map(Rp=>Rp*ny)}let Xf=ju?"center":Fn.get("text-justify").evaluate(lh,{},vt);const Hd=Fn.get("symbol-placement")==="point",up=Hd?Fn.get("text-max-width").evaluate(lh,{},vt)*ny:1/0,jp=vp=>{c.allowVerticalPlacement&&_e(Sf)&&(kh.vertical=w2(Vh,l,d,M,Eh,up,jd,Rf,vp,Pf,ed,J0.vertical,!0,Yh,Bh))};if(!ju&&Uf){const vp=Xf==="auto"?Uf.map(dp=>I2(dp)):[Xf];let Rp=!1;for(let dp=0;dp<vp.length;dp++){const Xp=vp[dp];if(!kh.horizontal[Xp])if(Rp)kh.horizontal[Xp]=kh.horizontal[0];else{const xm=w2(Vh,l,d,M,Eh,up,jd,"center",Xp,Pf,ed,J0.horizontal,!1,Yh,Bh);xm&&(kh.horizontal[Xp]=xm,Rp=xm.positionedLines.length===1)}}jp("left")}else{if(Xf==="auto"&&(Xf=I2(Rf)),Hd||Fn.get("text-writing-mode").indexOf("horizontal")>=0||!_e(Sf)){const vp=w2(Vh,l,d,M,Eh,up,jd,Rf,Xf,Pf,ed,J0.horizontal,!1,Yh,Bh);vp&&(kh.horizontal[Xf]=vp)}jp(Hd?"left":Xf)}}let Rd=!1;if(lh.icon&&lh.icon.name){const Sf=y[lh.icon.name];Sf&&(rd=wT(M[lh.icon.name],Fn.get("icon-offset").evaluate(lh,{},vt),Fn.get("icon-anchor").evaluate(lh,{},vt)),Rd=Sf.sdf,c.sdfIcons===void 0?c.sdfIcons=Sf.sdf:c.sdfIcons!==Sf.sdf&&rp("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sf.pixelRatio!==c.pixelRatio||Fn.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const kd=gE(kh.horizontal)||kh.vertical;c.iconsInText||(c.iconsInText=!!kd&&kd.iconsInText),(kd||rd)&&DT(c,lh,kh,rd,y,nl,Yh,0,ed,Rd,X,vt,Ui)}N&&c.generateCollisionDebugBuffers(Ht,c.collisionBoxArray)}function I2(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function DT(c,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl){let ju=N.textMaxSize.evaluate(l,{},Js);ju===void 0&&(ju=X);const Ku=c.layers[0].layout,lh=Ku.get("icon-offset").evaluate(l,{},Js),Eh=gE(d.horizontal)||d.vertical,Bh=nl.name==="globe",Yh=X/24,kh=c.tilePixelRatio*ju/24,Vh=(Pf=c.overscaling,c.zoom>18&&Pf>2&&(Pf>>=1),Math.max(Hp/(512*Pf),1)*Ku.get("symbol-spacing")),rd=Ku.get("text-padding")*c.tilePixelRatio,ed=Ku.get("icon-padding")*c.tilePixelRatio,Rd=ih(Ku.get("text-max-angle")),kd=Ku.get("text-rotation-alignment")==="map"&&Ku.get("symbol-placement")!=="point",Sf=Ku.get("icon-rotation-alignment")==="map"&&Ku.get("symbol-placement")!=="point",Zf=Ku.get("symbol-placement"),jd=Vh/2;var Pf;const Rf=Ku.get("icon-text-fit");let Uf;y&&Rf!=="none"&&(c.allowVerticalPlacement&&d.vertical&&(Uf=rE(y,d.vertical,Rf,Ku.get("icon-text-fit-padding"),lh,Yh)),Eh&&(y=rE(y,Eh,Rf,Ku.get("icon-text-fit-padding"),lh,Yh)));const Xf=(Hd,up,jp)=>{if(up.x<0||up.x>=Hp||up.y<0||up.y>=Hp)return;let vp=null;if(Bh){const{x:Rp,y:dp,z:Xp}=nl.projectTilePoint(up.x,up.y,jp);vp={anchor:new D1(Rp,dp,Xp,0,void 0),up:nl.upVector(jp,up.x,up.y)}}(function(Rp,dp,Xp,xm,gm,pm,Wp,Zm,tm,bm,Wm,hg,ng,dg,xg,Ug,N_,Hm,r_,Kg,Lm,Ag,s_,Ym,Zg){const dy=Rp.addToLineVertexArray(dp,xm);let z_,F_,ky,U_,L1,ub,Qb,Jb=0,qE=0,ZE=0,HE=0,N2=-1,z2=-1;const s1={};let XE=h1("");const Lx=Xp?Xp.anchor:dp;let F2=0,U2=0;if(tm._unevaluatedLayout.getValue("text-radial-offset")===void 0?[F2,U2]=tm.layout.get("text-offset").evaluate(Lm,{},Zg).map(L0=>L0*ny):(F2=tm.layout.get("text-radial-offset").evaluate(Lm,{},Zg)*ny,U2=S2),Rp.allowVerticalPlacement&&gm.vertical){const L0=gm.vertical;if(xg)ub=C2(L0),Zm&&(Qb=C2(Zm));else{const R0=tm.layout.get("text-rotate").evaluate(Lm,{},Zg)+90;ky=Fw(bm,Lx,dp,Wm,hg,ng,L0,dg,R0,Ug),Zm&&(U_=Fw(bm,Lx,dp,Wm,hg,ng,Zm,Hm,R0))}}if(pm){const L0=tm.layout.get("icon-rotate").evaluate(Lm,{},Zg),R0=tm.layout.get("icon-text-fit")!=="none",ew=dE(pm,L0,s_,R0),G2=Zm?dE(Zm,L0,s_,R0):void 0;F_=Fw(bm,Lx,dp,Wm,hg,ng,pm,Hm,L0),Jb=4*ew.length;const WE=Rp.iconSizeData;let Rx=null;WE.kind==="source"?(Rx=[r1*tm.layout.get("icon-size").evaluate(Lm,{},Zg)],Rx[0]>J1&&rp(`${Rp.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):WE.kind==="composite"&&(Rx=[r1*Ag.compositeIconSizes[0].evaluate(Lm,{},Zg),r1*Ag.compositeIconSizes[1].evaluate(Lm,{},Zg)],(Rx[0]>J1||Rx[1]>J1)&&rp(`${Rp.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Rp.addSymbols(Rp.icon,ew,Rx,Kg,r_,Lm,!1,Xp,dp,dy.lineStartIndex,dy.lineLength,-1,Ym,Zg),N2=Rp.icon.placedSymbolArray.length-1,G2&&(qE=4*G2.length,Rp.addSymbols(Rp.icon,G2,Rx,Kg,r_,Lm,J0.vertical,Xp,dp,dy.lineStartIndex,dy.lineLength,-1,Ym,Zg),z2=Rp.icon.placedSymbolArray.length-1)}for(const L0 in gm.horizontal){const R0=gm.horizontal[L0];z_||(XE=h1(R0.text),xg?L1=C2(R0):z_=Fw(bm,Lx,dp,Wm,hg,ng,R0,dg,tm.layout.get("text-rotate").evaluate(Lm,{},Zg),Ug));const ew=R0.positionedLines.length===1;if(ZE+=mE(Rp,Xp,dp,R0,Wp,tm,xg,Lm,Ug,dy,gm.vertical?J0.horizontal:J0.horizontalOnly,ew?Object.keys(gm.horizontal):[L0],s1,N2,Ag,Ym,Zg),ew)break}gm.vertical&&(HE+=mE(Rp,Xp,dp,gm.vertical,Wp,tm,xg,Lm,Ug,dy,J0.vertical,["vertical"],s1,z2,Ag,Ym,Zg));let ox=-1;const V2=(L0,R0)=>L0?Math.max(L0,R0):R0;ox=V2(L1,ox),ox=V2(ub,ox),ox=V2(Qb,ox);const aS=ox>-1?1:0;Rp.glyphOffsetArray.length>=tx.MAX_GLYPHS&&rp("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lm.sortKey!==void 0&&Rp.addToSortKeyRanges(Rp.symbolInstances.length,Lm.sortKey),Rp.symbolInstances.emplaceBack(Lx.x,Lx.y,Lx.z,dp.x,dp.y,s1.right>=0?s1.right:-1,s1.center>=0?s1.center:-1,s1.left>=0?s1.left:-1,s1.vertical>=0?s1.vertical:-1,N2,z2,XE,z_!==void 0?z_:Rp.collisionBoxArray.length,z_!==void 0?z_+1:Rp.collisionBoxArray.length,ky!==void 0?ky:Rp.collisionBoxArray.length,ky!==void 0?ky+1:Rp.collisionBoxArray.length,F_!==void 0?F_:Rp.collisionBoxArray.length,F_!==void 0?F_+1:Rp.collisionBoxArray.length,U_||Rp.collisionBoxArray.length,U_?U_+1:Rp.collisionBoxArray.length,Wm,ZE,HE,Jb,qE,aS,0,F2,U2,ox)})(c,up,vp,Hd,d,y,M,Uf,c.layers[0],c.collisionBoxArray,l.index,l.sourceLayerIndex,c.index,rd,kd,Ht,0,ed,Sf,lh,l,N,Ui,Fn,Js)};if(Zf==="line")for(const Hd of cE(l.geometry,0,0,Hp,Hp)){const up=TT(Hd,Vh,Rd,d.vertical||Eh,y,24,kh,c.overscaling,Hp);for(const jp of up){const vp=Eh;vp&&LT(c,vp.text,jd,jp)||Xf(Hd,jp,Js)}}else if(Zf==="line-center"){for(const Hd of l.geometry)if(Hd.length>1){const up=ET(Hd,Rd,d.vertical||Eh,y,24,kh);up&&Xf(Hd,up,Js)}}else if(l.type==="Polygon")for(const Hd of wp(l.geometry,0)){const up=MT(Hd,16);Xf(Hd[0],new D1(up.x,up.y,0,0,void 0),Js)}else if(l.type==="LineString")for(const Hd of l.geometry)Xf(Hd,new D1(Hd[0].x,Hd[0].y,0,0,void 0),Js);else if(l.type==="Point")for(const Hd of l.geometry)for(const up of Hd)Xf([up],new D1(up.x,up.y,0,0,void 0),Js)}const J1=32640;function mE(c,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku,lh,Eh){const Bh=function(Vh,rd,ed,Rd,kd,Sf,Zf,jd){const Pf=[];if(rd.positionedLines.length===0)return Pf;const Rf=Rd.layout.get("text-rotate").evaluate(Sf,{})*Math.PI/180,Uf=function(vp){const Rp=vp[0],dp=vp[1],Xp=Rp*dp;return Xp>0?[Rp,-dp]:Xp<0?[-Rp,dp]:Rp===0?[dp,Rp]:[dp,-Rp]}(ed);let Xf=Math.abs(rd.top-rd.bottom);for(const vp of rd.positionedLines)Xf-=vp.lineOffset;const Hd=rd.positionedLines.length,up=Xf/Hd;let jp=rd.top-ed[1];for(let vp=0;vp<Hd;++vp){const Rp=rd.positionedLines[vp];jp=ST(rd,up,jp,vp);for(const dp of Rp.positionedGlyphs){if(!dp.rect)continue;const Xp=dp.rect||{};let xm=4,gm=!0,pm=1,Wp=0;if(dp.imageName){const Ym=Zf[dp.imageName];if(!Ym)continue;if(Ym.sdf){rp("SDF images are not supported in formatted text and will be ignored.");continue}gm=!1,pm=Ym.pixelRatio,xm=1/pm}const Zm=(kd||jd)&&dp.vertical,tm=dp.metrics.advance*dp.scale/2,bm=dp.metrics,Wm=dp.rect;if(Wm===null)continue;jd&&rd.verticalizable&&(Wp=dp.imageName?tm-dp.metrics.width*dp.scale/2:0);const hg=kd?[dp.x+tm,dp.y]:[0,0];let ng=[0,0],dg=[0,0],xg=!1;kd||(Zm?(dg=[dp.x+tm+Uf[0],dp.y+Uf[1]-Wp],xg=!0):ng=[dp.x+tm+ed[0],dp.y+ed[1]-Wp]);const Ug=Wm.w*dp.scale/(pm*(dp.localGlyph?2:1)),N_=Wm.h*dp.scale/(pm*(dp.localGlyph?2:1));let Hm,r_,Kg,Lm;if(Zm){const Ym=dp.y-jp,Zg=new $s(-tm,tm-Ym),dy=-Math.PI/2,z_=new $s(...dg);Hm=new $s(-tm+ng[0],ng[1]),Hm._rotateAround(dy,Zg)._add(z_),Hm.x+=-Ym+tm,Hm.y-=(bm.left-xm)*dp.scale;const F_=dp.imageName?bm.advance*dp.scale:ny*dp.scale,ky=String.fromCharCode(dp.glyph);aT(ky)?Hm.x+=(1-xm)*dp.scale:sT(ky)?Hm.x+=F_-bm.height*dp.scale+(-xm-1)*dp.scale:Hm.x+=dp.imageName||bm.width+2*xm===Wm.w&&bm.height+2*xm===Wm.h?(F_-N_)/2:(F_-(bm.height+2*xm)*dp.scale)/2,r_=new $s(Hm.x,Hm.y-Ug),Kg=new $s(Hm.x+N_,Hm.y),Lm=new $s(Hm.x+N_,Hm.y-Ug)}else{const Ym=(bm.left-xm)*dp.scale-tm+ng[0],Zg=(-bm.top-xm)*dp.scale+ng[1],dy=Ym+Ug,z_=Zg+N_;Hm=new $s(Ym,Zg),r_=new $s(dy,Zg),Kg=new $s(Ym,z_),Lm=new $s(dy,z_)}if(Rf){let Ym;Ym=kd?new $s(0,0):xg?new $s(Uf[0],Uf[1]):new $s(ed[0],ed[1]),Hm._rotateAround(Rf,Ym),r_._rotateAround(Rf,Ym),Kg._rotateAround(Rf,Ym),Lm._rotateAround(Rf,Ym)}const Ag=new $s(0,0),s_=new $s(0,0);Pf.push({tl:Hm,tr:r_,bl:Kg,br:Lm,tex:Xp,writingMode:rd.writingMode,glyphOffset:hg,sectionIndex:dp.sectionIndex,isSDF:gm,pixelOffsetTL:Ag,pixelOffsetBR:s_,minFontScaleX:0,minFontScaleY:0})}}return Pf}(0,y,Ht,N,X,vt,M,c.allowVerticalPlacement),Yh=c.textSizeData;let kh=null;Yh.kind==="source"?(kh=[r1*N.layout.get("text-size").evaluate(vt,{},Eh)],kh[0]>J1&&rp(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Yh.kind==="composite"&&(kh=[r1*Ku.compositeTextSizes[0].evaluate(vt,{},Eh),r1*Ku.compositeTextSizes[1].evaluate(vt,{},Eh)],(kh[0]>J1||kh[1]>J1)&&rp(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,Bh,kh,Ht,X,vt,Fn,l,d,Ui.lineStartIndex,Ui.lineLength,ju,lh,Eh);for(const Vh of Js)nl[Vh]=c.text.placedSymbolArray.length-1;return 4*Bh.length}function gE(c){for(const l in c)return c[l];return null}function Fw(c,l,d,y,M,N,X,vt,Ht,Ui){let Fn=X.top,Js=X.bottom,nl=X.left,ju=X.right;const Ku=X.collisionPadding;if(Ku&&(nl-=Ku[0],Fn-=Ku[1],ju+=Ku[2],Js+=Ku[3]),Ht){const lh=new $s(nl,Fn),Eh=new $s(ju,Fn),Bh=new $s(nl,Js),Yh=new $s(ju,Js),kh=ih(Ht);let Vh=new $s(0,0);Ui&&(Vh=new $s(Ui[0],Ui[1])),lh._rotateAround(kh,Vh),Eh._rotateAround(kh,Vh),Bh._rotateAround(kh,Vh),Yh._rotateAround(kh,Vh),nl=Math.min(lh.x,Eh.x,Bh.x,Yh.x),ju=Math.max(lh.x,Eh.x,Bh.x,Yh.x),Fn=Math.min(lh.y,Eh.y,Bh.y,Yh.y),Js=Math.max(lh.y,Eh.y,Bh.y,Yh.y)}return c.emplaceBack(l.x,l.y,l.z,d.x,d.y,nl,Fn,ju,Js,vt,y,M,N),c.length-1}function C2(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const l=c.bottom-c.top;return l>0?Math.max(10,l):null}function LT(c,l,d,y){const M=c.compareText;if(l in M){const N=M[l];for(let X=N.length-1;X>=0;X--)if(y.dist(N[X])<d)return!0}else M[l]=[];return M[l].push(y),!1}function _E(c,l){const d=c.fovAboveCenter,y=c.elevation?c.elevation.getMinElevationBelowMSL()*l:0,M=(c._camera.position[2]*c.worldSize-y)/Math.cos(c._pitch),N=Math.sin(d)*M/Math.sin(Math.max(Math.PI/2-c._pitch-d,.01)),X=Math.sin(c._pitch)*N+M;return Math.min(1.01*X,M*(1/c._horizonShift))}function kx(c,l){if(!l.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:l};const d=Math.pow(2,-c.z),y=c.x*d,M=(c.x+1)*d,N=c.y*d,X=(c.y+1)*d,vt=e0(y),Ht=e0(M),Ui=Mg(N),Fn=Mg(X),Js=l.project(vt,Ui),nl=l.project(Ht,Ui),ju=l.project(Ht,Fn),Ku=l.project(vt,Fn);let lh=Math.min(Js.x,nl.x,ju.x,Ku.x),Eh=Math.min(Js.y,nl.y,ju.y,Ku.y),Bh=Math.max(Js.x,nl.x,ju.x,Ku.x),Yh=Math.max(Js.y,nl.y,ju.y,Ku.y);const kh=d/16;function Vh(ed,Rd,kd,Sf,Zf,jd){const Pf=(kd+Zf)/2,Rf=(Sf+jd)/2,Uf=l.project(e0(Pf),Mg(Rf)),Xf=Math.max(0,lh-Uf.x,Eh-Uf.y,Uf.x-Bh,Uf.y-Yh);lh=Math.min(lh,Uf.x),Bh=Math.max(Bh,Uf.x),Eh=Math.min(Eh,Uf.y),Yh=Math.max(Yh,Uf.y),Xf>kh&&(Vh(ed,Uf,kd,Sf,Pf,Rf),Vh(Uf,Rd,Pf,Rf,Zf,jd))}Vh(Js,nl,y,N,M,N),Vh(nl,ju,M,N,M,X),Vh(ju,Ku,M,X,y,X),Vh(Ku,Js,y,X,y,N),lh-=kh,Eh-=kh,Bh+=kh,Yh+=kh;const rd=1/Math.max(Bh-lh,Yh-Eh);return{scale:rd,x:lh*rd,y:Eh*rd,x2:Bh*rd,y2:Yh*rd,projection:l}}const RT=M0(new Float32Array(16));class ex{constructor(l){this.spec=l,this.name=l.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(l,d){return{x:0,y:0,z:0}}unproject(l,d){return new Tm(0,0)}projectTilePoint(l,d,y){return{x:l,y:d,z:0}}locationPoint(l,d,y=!0){return l._coordinatePoint(l.locationCoordinate(d),y)}pixelsPerMeter(l,d){return Jy(1,l)*d}pixelSpaceConversion(l,d,y){return 1}farthestPixelDistance(l){return _E(l,l.pixelsPerMeter)}pointCoordinate(l,d,y,M){const N=l.horizonLineFromTop(!1),X=new $s(d,Math.max(N,y));return l.rayIntersectionCoordinate(l.pointRayIntersection(X,M))}pointCoordinate3D(l,d,y){const M=new $s(d,y);if(l.elevation)return l.elevation.pointCoordinate(M);{const N=this.pointCoordinate(l,M.x,M.y,0);return[N.x,N.y,N.z]}}isPointAboveHorizon(l,d){if(l.elevation)return!this.pointCoordinate3D(l,d.x,d.y);const y=l.horizonLineFromTop();return d.y<y}createInversionMatrix(l,d){return RT}createTileMatrix(l,d,y){let M,N,X;const vt=y.canonical,Ht=M0(new Float64Array(16));if(this.isReprojectedInTileSpace){const Ui=kx(vt,this);M=1,N=Ui.x+y.wrap*Ui.scale,X=Ui.y,Jv(Ht,Ht,[M/Ui.scale,M/Ui.scale,l.pixelsPerMeter/d])}else M=d/l.zoomScale(vt.z),N=(vt.x+Math.pow(2,vt.z)*y.wrap)*M,X=vt.y*M;return F1(Ht,Ht,[N,X,0]),Jv(Ht,Ht,[M/Hp,M/Hp,1]),Ht}upVector(l,d,y){return[0,0,1]}upVectorScale(l,d,y){return{metersToTile:1}}}class OT extends ex{constructor(l){super(l),this.range=[4,7],this.center=l.center||[-96,37.5];const[d,y]=this.parallels=l.parallels||[29.5,45.5],M=Math.sin(ih(d));this.n=(M+Math.sin(ih(y)))/2,this.c=1+M*(2*this.n-M),this.r0=Math.sqrt(this.c)/this.n}project(l,d){const{n:y,c:M,r0:N}=this,X=ih(l-this.center[0]),vt=ih(d),Ht=Math.sqrt(M-2*y*Math.sin(vt))/y;return{x:Ht*Math.sin(X*y),y:Ht*Math.cos(X*y)-N,z:0}}unproject(l,d){const{n:y,c:M,r0:N}=this,X=N+d;let vt=Math.atan2(l,Math.abs(X))*Math.sign(X);X*y<0&&(vt-=Math.PI*Math.sign(l)*Math.sign(X));const Ht=ih(this.center[0])*y;vt=Tf(vt,-Math.PI-Ht,Math.PI-Ht);const Ui=Gh(al(vt/y)+this.center[0],-180,180),Fn=Math.asin(Gh((M-(l*l+X*X)*y*y)/(2*y),-1,1)),Js=Gh(al(Fn),-o_,o_);return new Tm(Ui,Js)}}const Zb=1.340264,Hb=-.081106,Xb=893e-6,Wb=.003796,Uw=Math.sqrt(3)/2;class $T extends ex{project(l,d){d=d/180*Math.PI,l=l/180*Math.PI;const y=Math.asin(Uw*Math.sin(d)),M=y*y,N=M*M*M;return{x:.5*(l*Math.cos(y)/(Uw*(Zb+3*Hb*M+N*(7*Xb+9*Wb*M)))/Math.PI+.5),y:1-.5*(y*(Zb+Hb*M+N*(Xb+Wb*M))/Math.PI+1),z:0}}unproject(l,d){l=(2*l-.5)*Math.PI;let y=d=(2*(1-d)-1)*Math.PI,M=y*y,N=M*M*M;for(let Fn,Js,nl,ju=0;ju<12&&(Js=y*(Zb+Hb*M+N*(Xb+Wb*M))-d,nl=Zb+3*Hb*M+N*(7*Xb+9*Wb*M),Fn=Js/nl,y=Gh(y-Fn,-Math.PI/3,Math.PI/3),M=y*y,N=M*M*M,!(Math.abs(Fn)<1e-12));++ju);const X=Uw*l*(Zb+3*Hb*M+N*(7*Xb+9*Wb*M))/Math.cos(y),vt=Math.asin(Math.sin(y)/Uw),Ht=Gh(180*X/Math.PI,-180,180),Ui=Gh(180*vt/Math.PI,-o_,o_);return new Tm(Ht,Ui)}}class BT extends ex{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0}project(l,d){return{x:.5+l/360,y:.5-d/360,z:0}}unproject(l,d){const y=360*(l-.5),M=Gh(360*(.5-d),-o_,o_);return new Tm(y,M)}}const lb=Math.PI/2;function Vw(c){return Math.tan((lb+c)/2)}class NT extends ex{constructor(l){super(l),this.center=l.center||[0,30];const[d,y]=this.parallels=l.parallels||[30,30];let M=ih(d),N=ih(y);this.southernCenter=M+N<0,this.southernCenter&&(M=-M,N=-N);const X=Math.cos(M),vt=Vw(M);this.n=M===N?Math.sin(M):Math.log(X/Math.cos(N))/Math.log(Vw(N)/vt),this.f=X*Math.pow(Vw(M),this.n)/this.n}project(l,d){d=ih(d),this.southernCenter&&(d=-d),l=ih(l-this.center[0]);const y=1e-6,{n:M,f:N}=this;N>0?d<-lb+y&&(d=-lb+y):d>lb-y&&(d=lb-y);const X=N/Math.pow(Vw(d),M);let vt=X*Math.sin(M*l),Ht=N-X*Math.cos(M*l);return vt=.5*(vt/Math.PI+.5),Ht=.5*(Ht/Math.PI+.5),{x:vt,y:this.southernCenter?Ht:1-Ht,z:0}}unproject(l,d){l=(2*l-.5)*Math.PI,this.southernCenter&&(d=1-d),d=(2*(1-d)-.5)*Math.PI;const{n:y,f:M}=this,N=M-d,X=Math.sign(N),vt=Math.sign(y)*Math.sqrt(l*l+N*N);let Ht=Math.atan2(l,Math.abs(N))*X;N*y<0&&(Ht-=Math.PI*Math.sign(l)*X);const Ui=Gh(al(Ht/y)+this.center[0],-180,180),Fn=Gh(al(2*Math.atan(Math.pow(M/vt,1/y))-lb),-o_,o_);return new Tm(Ui,this.southernCenter?-Fn:Fn)}}class yE extends ex{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(l,d){return{x:P0(l),y:X0(d),z:0}}unproject(l,d){const y=e0(l),M=Mg(d);return new Tm(y,M)}}const vE=ih(o_);class zT extends ex{project(l,d){const y=(d=ih(d))*d,M=y*y;return{x:.5*((l=ih(l))*(.8707-.131979*y+M*(M*(.003971*y-.001529*M)-.013791))/Math.PI+.5),y:1-.5*(d*(1.007226+y*(.015085+M*(.028874*y-.044475-.005916*M)))/Math.PI+1),z:0}}unproject(l,d){l=(2*l-.5)*Math.PI;let y=d=(2*(1-d)-1)*Math.PI,M=25,N=0,X=y*y;do{X=y*y;const Ui=X*X;N=(y*(1.007226+X*(.015085+Ui*(.028874*X-.044475-.005916*Ui)))-d)/(1.007226+X*(.045255+Ui*(.259866*X-.311325-.005916*11*Ui))),y=Gh(y-N,-vE,vE)}while(Math.abs(N)>1e-6&&--M>0);X=y*y;const vt=Gh(al(l/(.8707+X*(X*(X*X*X*(.003971-.001529*X)-.013791)-.131979))),-180,180),Ht=al(y);return new Tm(vt,Ht)}}const xE=ih(o_);class FT extends ex{project(l,d){d=ih(d),l=ih(l);const y=Math.cos(d),M=2/Math.PI,N=Math.acos(y*Math.cos(l/2)),X=Math.sin(N)/N,vt=.5*(l*M+2*y*Math.sin(l/2)/X)||0,Ht=.5*(d+Math.sin(d)/X)||0;return{x:.5*(vt/Math.PI+.5),y:1-.5*(Ht/Math.PI+1),z:0}}unproject(l,d){let y=l=(2*l-.5)*Math.PI,M=d=(2*(1-d)-1)*Math.PI,N=25;const X=1e-6;let vt=0,Ht=0;do{const Ui=Math.cos(M),Fn=Math.sin(M),Js=2*Fn*Ui,nl=Fn*Fn,ju=Ui*Ui,Ku=Math.cos(y/2),lh=Math.sin(y/2),Eh=2*Ku*lh,Bh=lh*lh,Yh=1-ju*Ku*Ku,kh=Yh?1/Yh:0,Vh=Yh?Math.acos(Ui*Ku)*Math.sqrt(1/Yh):0,rd=.5*(2*Vh*Ui*lh+2*y/Math.PI)-l,ed=.5*(Vh*Fn+M)-d,Rd=.5*kh*(ju*Bh+Vh*Ui*Ku*nl)+1/Math.PI,kd=kh*(Eh*Js/4-Vh*Fn*lh),Sf=.125*kh*(Js*lh-Vh*Fn*ju*Eh),Zf=.5*kh*(nl*Ku+Vh*Bh*Ui)+.5,jd=kd*Sf-Zf*Rd;vt=(ed*kd-rd*Zf)/jd,Ht=(rd*Sf-ed*Rd)/jd,y=Gh(y-vt,-Math.PI,Math.PI),M=Gh(M-Ht,-xE,xE)}while((Math.abs(vt)>X||Math.abs(Ht)>X)&&--N>0);return new Tm(al(y),al(M))}}class bE extends ex{constructor(l){super(l),this.center=l.center||[0,0],this.parallels=l.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ih(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(l,d){const{scale:y,cosPhi:M}=this;return{x:ih(l)*M*y+.5,y:-Math.sin(ih(d))/M*y+.5,z:0}}unproject(l,d){const{scale:y,cosPhi:M}=this,N=-(d-.5)/y,X=Gh(al((l-.5)/y)/M,-180,180),vt=Math.asin(Gh(N*M,-1,1)),Ht=Gh(al(vt),-o_,o_);return new Tm(X,Ht)}}class UT extends yE{constructor(l){super(l),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(l,d,y){const M=G1(l,d,y);return Cg(M,M,j1(pv(y))),{x:M[0],y:M[1],z:M[2]}}locationPoint(l,d){const y=b1(d.lat,d.lng),M=R_([],y),N=l.elevation?l.elevation.getAtPointOrZero(l.locationCoordinate(d),l._centerAltitude):l._centerAltitude;U1(y,y,M,Jy(1,0)*Hp*N);const X=M0(new Float64Array(16));return p1(X,l.pixelMatrix,l.globeMatrix),Cg(y,y,X),new $s(y[0],y[1])}pixelsPerMeter(l,d){return Jy(1,0)*d}pixelSpaceConversion(l,d,y){const M=Jy(1,l)*d,N=Kp(Jy(1,45)*d,M,y);return this.pixelsPerMeter(l,d)/N}createTileMatrix(l,d,y){const M=Yx(pv(y.canonical));return p1(new Float64Array(16),l.globeMatrix,M)}createInversionMatrix(l,d){const{center:y}=l,M=j1(pv(d));return qx(M,M,ih(y.lng)),jx(M,M,ih(y.lat)),Jv(M,M,[l._pixelsPerMercatorPixel,l._pixelsPerMercatorPixel,1]),Float32Array.from(M)}pointCoordinate(l,d,y,M){return Eb(l,d,y,!0)||new Z1(0,0)}pointCoordinate3D(l,d,y){const M=this.pointCoordinate(l,d,y,0);return[M.x,M.y,M.z]}isPointAboveHorizon(l,d){return!Eb(l,d.x,d.y,!1)}farthestPixelDistance(l){const d=function(M,N){const X=M.cameraToCenterDistance,vt=M._centerAltitude*N,Ht=M._camera,Ui=M._camera.forward(),Fn=q0([],hy([],Ui,-X),[0,0,vt]),Js=M.worldSize/(2*Math.PI),nl=[0,0,-Js],ju=M.width/M.height,Ku=Math.tan(M.fovAboveCenter),lh=hy([],Ht.up(),Ku),Eh=hy([],Ht.right(),Ku*ju),Bh=R_([],q0([],q0([],Ui,lh),Eh)),Yh=[];let kh;if(new Hx(Fn,Bh).closestPointOnSphere(nl,Js,Yh)){const Vh=q0([],Yh,nl),rd=Z0([],Vh,Fn);kh=Math.cos(M.fovAboveCenter)*Dv(rd)}else{const Vh=Z0([],Fn,nl),rd=Z0([],nl,Fn);R_(rd,rd);const ed=Dv(Vh)-Js;kh=Math.sqrt(ed*(ed+2*Js));const Rd=Math.acos(kh/(Js+ed))-Math.acos(t_(Ui,rd));kh*=Math.cos(Rd)}return 1.01*kh}(l,this.pixelsPerMeter(l.center.lat,l.worldSize)),y=Lv(l.zoom);if(y>0){const M=_E(l,Jy(1,l.center.lat)*l.worldSize),N=l.worldSize/(2*Math.PI),X=Math.max(l.width,l.height)/l.worldSize*Math.PI;return Kp(d,M+N*(1-Math.cos(X)),Math.pow(y,10))}return d}upVector(l,d,y){return G1(d,y,l,1)}upVectorScale(l){return{metersToTile:_x(Wx(pv(l)))}}}function wE(c){const l=c.parallels,d=!!l&&Math.abs(l[0]+l[1])<.01;switch(c.name){case"mercator":return new yE(c);case"equirectangular":return new BT(c);case"naturalEarth":return new zT(c);case"equalEarth":return new $T(c);case"winkelTripel":return new FT(c);case"albers":return d?new bE(c):new OT(c);case"lambertConformalConic":return d?new bE(c):new NT(c);case"globe":return new UT(c)}throw new Error(`Invalid projection name: ${c.name}`)}const VT=b_.types,GT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gw(c,l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl){const ju=vt?Math.min(J1,Math.round(vt[0])):0,Ku=vt?Math.min(J1,Math.round(vt[1])):0;c.emplaceBack(l,d,Math.round(32*y),Math.round(32*M),N,X,(ju<<1)+(Ht?1:0),Ku,16*Ui,16*Fn,256*Js,256*nl)}function jw(c,l,d,y,M,N,X){c.emplaceBack(l,d,y,M,N,X)}function qw(c,l,d,y,M){c.emplaceBack(l,d,y,M),c.emplaceBack(l,d,y,M),c.emplaceBack(l,d,y,M),c.emplaceBack(l,d,y,M)}function jT(c){for(const l of c.sections)if(Qu(l.text))return!0;return!1}class M2{constructor(l){this.layoutVertexArray=new V0,this.indexArray=new y_,this.programConfigurations=l,this.segments=new Og,this.dynamicLayoutVertexArray=new zm,this.opacityVertexArray=new qm,this.placedSymbolArray=new ax,this.globeExtVertexArray=new ig}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,y,M){this.isEmpty()||(y&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Px.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,P1.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,GT,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,Lw.members,!0)),this.opacityVertexBuffer.itemSize=1),(y||M)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ip(M2,"SymbolBuffers");class A2{constructor(l,d,y){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new y,this.segments=new Og,this.collisionVertexArray=new Dm,this.collisionVertexArrayExt=new jg}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,tT.members,!0),this.collisionVertexBufferExt=l.createVertexBuffer(this.collisionVertexArrayExt,iT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ip(A2,"CollisionBuffers");class tx{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(X=>X.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=M0([]),this.placementViewportMatrix=M0([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=y2(this.zoom,d["text-size"]),this.iconSizeData=y2(this.zoom,d["icon-size"]);const y=this.layers[0].layout,M=y.get("symbol-sort-key"),N=y.get("symbol-z-order");this.canOverlap=y.get("text-allow-overlap")||y.get("icon-allow-overlap")||y.get("text-ignore-placement")||y.get("icon-ignore-placement"),this.sortFeaturesByKey=N!=="viewport-y"&&M.constantOr(1)!==void 0,this.sortFeaturesByY=(N==="viewport-y"||N==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=y.get("text-writing-mode").map(X=>J0[X]),this.stateDependentLayerIds=this.layers.filter(X=>X.isStateDependent()).map(X=>X.id),this.sourceID=l.sourceID,this.projection=l.projection}createArrays(){this.text=new M2(new f1(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new M2(new f1(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new lx,this.lineVertexArray=new $1,this.symbolInstances=new sx}calculateGlyphDependencies(l,d,y,M,N){for(let X=0;X<l.length;X++)if(d[l.charCodeAt(X)]=!0,M&&N){const vt=Vb[l.charAt(X)];vt&&(d[vt.charCodeAt(0)]=!0)}}populate(l,d,y,M){const N=this.layers[0],X=N.layout,vt=this.projection.name==="globe",Ht=X.get("text-font"),Ui=X.get("text-field"),Fn=X.get("icon-image"),Js=(Ui.value.kind!=="constant"||Ui.value.value instanceof bg&&!Ui.value.value.isEmpty()||Ui.value.value.toString().length>0)&&(Ht.value.kind!=="constant"||Ht.value.value.length>0),nl=Fn.value.kind!=="constant"||!!Fn.value.value||Object.keys(Fn.parameters).length>0,ju=X.get("symbol-sort-key");if(this.features=[],!Js&&!nl)return;const Ku=d.iconDependencies,lh=d.glyphDependencies,Eh=d.availableImages,Bh=new ld(this.zoom);for(const{feature:Yh,id:kh,index:Vh,sourceLayerIndex:rd}of l){const ed=N._featureFilter.needGeometry,Rd=Ov(Yh,ed);if(!N._featureFilter.filter(Bh,Rd,y))continue;if(ed||(Rd.geometry=Rv(Yh,y,M)),vt&&Yh.type!==1&&y.z<=5){const jd=Rd.geometry,Pf=.98078528056,Rf=(Uf,Xf)=>t_(G1(Uf.x,Uf.y,y,1),G1(Xf.x,Xf.y,y,1))<Pf;for(let Uf=0;Uf<jd.length;Uf++)jd[Uf]=l2(jd[Uf],Rf)}let kd,Sf;if(Js){const jd=N.getValueAndResolveTokens("text-field",Rd,y,Eh),Pf=bg.factory(jd);jT(Pf)&&(this.hasRTLText=!0),(!this.hasRTLText||qh()==="unavailable"||this.hasRTLText&&Hh.isParsed())&&(kd=oT(Pf,N,Rd))}if(nl){const jd=N.getValueAndResolveTokens("icon-image",Rd,y,Eh);Sf=jd instanceof kg?jd:kg.fromString(jd)}if(!kd&&!Sf)continue;const Zf=this.sortFeaturesByKey?ju.evaluate(Rd,{},y):void 0;if(this.features.push({id:kh,text:kd,icon:Sf,index:Vh,sourceLayerIndex:rd,geometry:Rd.geometry,properties:Yh.properties,type:VT[Yh.type],sortKey:Zf}),Sf&&(Ku[Sf.name]=!0),kd){const jd=Ht.evaluate(Rd,{},y).join(","),Pf=X.get("text-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(J0.vertical)>=0;for(const Rf of kd.sections)if(Rf.image)Ku[Rf.image.name]=!0;else{const Uf=_e(kd.toString()),Xf=Rf.fontStack||jd,Hd=lh[Xf]=lh[Xf]||{};this.calculateGlyphDependencies(Rf.text,Hd,Pf,this.allowVerticalPlacement,Uf)}}}X.get("symbol-placement")==="line"&&(this.features=function(Yh){const kh={},Vh={},rd=[];let ed=0;function Rd(jd){rd.push(Yh[jd]),ed++}function kd(jd,Pf,Rf){const Uf=Vh[jd];return delete Vh[jd],Vh[Pf]=Uf,rd[Uf].geometry[0].pop(),rd[Uf].geometry[0]=rd[Uf].geometry[0].concat(Rf[0]),Uf}function Sf(jd,Pf,Rf){const Uf=kh[Pf];return delete kh[Pf],kh[jd]=Uf,rd[Uf].geometry[0].shift(),rd[Uf].geometry[0]=Rf[0].concat(rd[Uf].geometry[0]),Uf}function Zf(jd,Pf,Rf){const Uf=Rf?Pf[0][Pf[0].length-1]:Pf[0][0];return`${jd}:${Uf.x}:${Uf.y}`}for(let jd=0;jd<Yh.length;jd++){const Pf=Yh[jd],Rf=Pf.geometry,Uf=Pf.text?Pf.text.toString():null;if(!Uf){Rd(jd);continue}const Xf=Zf(Uf,Rf),Hd=Zf(Uf,Rf,!0);if(Xf in Vh&&Hd in kh&&Vh[Xf]!==kh[Hd]){const up=Sf(Xf,Hd,Rf),jp=kd(Xf,Hd,rd[up].geometry);delete kh[Xf],delete Vh[Hd],Vh[Zf(Uf,rd[jp].geometry,!0)]=jp,rd[up].geometry=null}else Xf in Vh?kd(Xf,Hd,Rf):Hd in kh?Sf(Xf,Hd,Rf):(Rd(jd),kh[Xf]=ed-1,Vh[Hd]=ed-1)}return rd.filter(jd=>jd.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Yh,kh)=>Yh.sortKey-kh.sortKey)}update(l,d,y,M){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,y,M),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,y,M))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){const y=this.lineVertexArray.length;if(l.segment!==void 0)for(const{x:M,y:N}of d)this.lineVertexArray.emplaceBack(M,N);return{lineStartIndex:y,lineLength:this.lineVertexArray.length-y}}addSymbols(l,d,y,M,N,X,vt,Ht,Ui,Fn,Js,nl,ju,Ku){const lh=l.indexArray,Eh=l.layoutVertexArray,Bh=l.globeExtVertexArray,Yh=l.segments.prepareSegment(4*d.length,Eh,lh,this.canOverlap?X.sortKey:void 0),kh=this.glyphOffsetArray.length,Vh=Yh.vertexLength,rd=this.allowVerticalPlacement&&vt===J0.vertical?Math.PI/2:0,ed=X.text&&X.text.sections;for(let kd=0;kd<d.length;kd++){const{tl:Sf,tr:Zf,bl:jd,br:Pf,tex:Rf,pixelOffsetTL:Uf,pixelOffsetBR:Xf,minFontScaleX:Hd,minFontScaleY:up,glyphOffset:jp,isSDF:vp,sectionIndex:Rp}=d[kd],dp=Yh.vertexLength,Xp=jp[1];if(Gw(Eh,Ui.x,Ui.y,Sf.x,Xp+Sf.y,Rf.x,Rf.y,y,vp,Uf.x,Uf.y,Hd,up),Gw(Eh,Ui.x,Ui.y,Zf.x,Xp+Zf.y,Rf.x+Rf.w,Rf.y,y,vp,Xf.x,Uf.y,Hd,up),Gw(Eh,Ui.x,Ui.y,jd.x,Xp+jd.y,Rf.x,Rf.y+Rf.h,y,vp,Uf.x,Xf.y,Hd,up),Gw(Eh,Ui.x,Ui.y,Pf.x,Xp+Pf.y,Rf.x+Rf.w,Rf.y+Rf.h,y,vp,Xf.x,Xf.y,Hd,up),Ht){const{x:xm,y:gm,z:pm}=Ht.anchor,[Wp,Zm,tm]=Ht.up;jw(Bh,xm,gm,pm,Wp,Zm,tm),jw(Bh,xm,gm,pm,Wp,Zm,tm),jw(Bh,xm,gm,pm,Wp,Zm,tm),jw(Bh,xm,gm,pm,Wp,Zm,tm),qw(l.dynamicLayoutVertexArray,xm,gm,pm,rd)}else qw(l.dynamicLayoutVertexArray,Ui.x,Ui.y,Ui.z,rd);lh.emplaceBack(dp,dp+1,dp+2),lh.emplaceBack(dp+1,dp+2,dp+3),Yh.vertexLength+=4,Yh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jp[0]),kd!==d.length-1&&Rp===d[kd+1].sectionIndex||l.programConfigurations.populatePaintArrays(Eh.length,X,X.index,{},ju,Ku,ed&&ed[Rp])}const Rd=Ht?Ht.anchor:Ui;l.placedSymbolArray.emplaceBack(Rd.x,Rd.y,Rd.z,Ui.x,Ui.y,kh,this.glyphOffsetArray.length-kh,Vh,Fn,Js,Ui.segment,y?y[0]:0,y?y[1]:0,M[0],M[1],vt,0,!1,0,nl,0)}_commitLayoutVertex(l,d,y,M,N,X,vt){l.emplaceBack(d,y,M,N,X,Math.round(vt.x),Math.round(vt.y))}_addCollisionDebugVertices(l,d,y,M,N,X,vt){const Ht=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),Ui=Ht.vertexLength,Fn=vt.tileAnchorX,Js=vt.tileAnchorY;for(let ju=0;ju<4;ju++)y.collisionVertexArray.emplaceBack(0,0,0,0);y.collisionVertexArrayExt.emplaceBack(d,-l.padding,-l.padding),y.collisionVertexArrayExt.emplaceBack(d,l.padding,-l.padding),y.collisionVertexArrayExt.emplaceBack(d,l.padding,l.padding),y.collisionVertexArrayExt.emplaceBack(d,-l.padding,l.padding),this._commitLayoutVertex(y.layoutVertexArray,M,N,X,Fn,Js,new $s(l.x1,l.y1)),this._commitLayoutVertex(y.layoutVertexArray,M,N,X,Fn,Js,new $s(l.x2,l.y1)),this._commitLayoutVertex(y.layoutVertexArray,M,N,X,Fn,Js,new $s(l.x2,l.y2)),this._commitLayoutVertex(y.layoutVertexArray,M,N,X,Fn,Js,new $s(l.x1,l.y2)),Ht.vertexLength+=4;const nl=y.indexArray;nl.emplaceBack(Ui,Ui+1),nl.emplaceBack(Ui+1,Ui+2),nl.emplaceBack(Ui+2,Ui+3),nl.emplaceBack(Ui+3,Ui),Ht.primitiveLength+=4}_addTextDebugCollisionBoxes(l,d,y,M,N,X){for(let vt=M;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceTextSize(l,X,d,vt);this._addCollisionDebugVertices(Ht,Ui,this.textCollisionBox,Ht.projectedAnchorX,Ht.projectedAnchorY,Ht.projectedAnchorZ,X)}}_addIconDebugCollisionBoxes(l,d,y,M,N,X){for(let vt=M;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceIconSize(l,d,X.placedIconSymbolIndex);this._addCollisionDebugVertices(Ht,Ui,this.iconCollisionBox,Ht.projectedAnchorX,Ht.projectedAnchorY,Ht.projectedAnchorZ,X)}}generateCollisionDebugBuffers(l,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new A2(cg,j2.members,dv),this.iconCollisionBox=new A2(cg,j2.members,dv);const y=ib(this.iconSizeData,l),M=ib(this.textSizeData,l);for(let N=0;N<this.symbolInstances.length;N++){const X=this.symbolInstances.get(N);this._addTextDebugCollisionBoxes(M,l,d,X.textBoxStartIndex,X.textBoxEndIndex,X),this._addTextDebugCollisionBoxes(M,l,d,X.verticalTextBoxStartIndex,X.verticalTextBoxEndIndex,X),this._addIconDebugCollisionBoxes(y,l,d,X.iconBoxStartIndex,X.iconBoxEndIndex,X),this._addIconDebugCollisionBoxes(y,l,d,X.verticalIconBoxStartIndex,X.verticalIconBoxEndIndex,X)}}getSymbolInstanceTextSize(l,d,y,M){const N=this.text.placedSymbolArray.get(d.rightJustifiedTextSymbolIndex>=0?d.rightJustifiedTextSymbolIndex:d.centerJustifiedTextSymbolIndex>=0?d.centerJustifiedTextSymbolIndex:d.leftJustifiedTextSymbolIndex>=0?d.leftJustifiedTextSymbolIndex:d.verticalPlacedTextSymbolIndex>=0?d.verticalPlacedTextSymbolIndex:M),X=Rw(this.textSizeData,l,N)/ny;return this.tilePixelRatio*X}getSymbolInstanceIconSize(l,d,y){const M=this.icon.placedSymbolArray.get(y),N=Rw(this.iconSizeData,l,M);return this.tilePixelRatio*N}_commitDebugCollisionVertexUpdate(l,d,y){l.emplaceBack(d,-y,-y),l.emplaceBack(d,y,-y),l.emplaceBack(d,y,y),l.emplaceBack(d,-y,y)}_updateTextDebugCollisionBoxes(l,d,y,M,N,X){for(let vt=M;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceTextSize(l,X,d,vt);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Ui,Ht.padding)}}_updateIconDebugCollisionBoxes(l,d,y,M,N,X){for(let vt=M;vt<N;vt++){const Ht=y.get(vt),Ui=this.getSymbolInstanceIconSize(l,d,X);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Ui,Ht.padding)}}updateCollisionDebugBuffers(l,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=ib(this.iconSizeData,l),M=ib(this.textSizeData,l);for(let N=0;N<this.symbolInstances.length;N++){const X=this.symbolInstances.get(N);this._updateTextDebugCollisionBoxes(M,l,d,X.textBoxStartIndex,X.textBoxEndIndex,X),this._updateTextDebugCollisionBoxes(M,l,d,X.verticalTextBoxStartIndex,X.verticalTextBoxEndIndex,X),this._updateIconDebugCollisionBoxes(y,l,d,X.iconBoxStartIndex,X.iconBoxEndIndex,X.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(y,l,d,X.verticalIconBoxStartIndex,X.verticalIconBoxEndIndex,X.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(l,d,y,M,N,X,vt,Ht,Ui){const Fn={};if(d<y){const{x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh,featureIndex:rd}=l.get(d);Fn.textBox={x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh},Fn.textFeatureIndex=rd}if(M<N){const{x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh,featureIndex:rd}=l.get(M);Fn.verticalTextBox={x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh},Fn.verticalTextFeatureIndex=rd}if(X<vt){const{x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh,featureIndex:rd}=l.get(X);Fn.iconBox={x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh},Fn.iconFeatureIndex=rd}if(Ht<Ui){const{x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh,featureIndex:rd}=l.get(Ht);Fn.verticalIconBox={x1:Js,y1:nl,x2:ju,y2:Ku,padding:lh,projectedAnchorX:Eh,projectedAnchorY:Bh,projectedAnchorZ:Yh,tileAnchorX:kh,tileAnchorY:Vh},Fn.verticalIconFeatureIndex=rd}return Fn}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const y=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,y.textBoxStartIndex,y.textBoxEndIndex,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y.iconBoxStartIndex,y.iconBoxEndIndex,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){const y=l.placedSymbolArray.get(d),M=y.vertexStartIndex+4*y.numGlyphs;for(let N=y.vertexStartIndex;N<M;N+=4)l.indexArray.emplaceBack(N,N+1,N+2),l.indexArray.emplaceBack(N+1,N+2,N+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(l),y=Math.cos(l),M=[],N=[],X=[];for(let vt=0;vt<this.symbolInstances.length;++vt){X.push(vt);const Ht=this.symbolInstances.get(vt);M.push(0|Math.round(d*Ht.tileAnchorX+y*Ht.tileAnchorY)),N.push(Ht.featureIndex)}return X.sort((vt,Ht)=>M[vt]-M[Ht]||N[Ht]-N[vt]),X}addToSortKeyRanges(l,d){const y=this.sortKeyRanges[this.sortKeyRanges.length-1];y&&y.sortKey===d?y.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const y=this.symbolInstances.get(d);this.featureSortOrder.push(y.featureIndex);const{rightJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:N,leftJustifiedTextSymbolIndex:X,verticalPlacedTextSymbolIndex:vt,placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:Ui}=y;M>=0&&this.addIndicesForPlacedSymbol(this.text,M),N>=0&&N!==M&&this.addIndicesForPlacedSymbol(this.text,N),X>=0&&X!==N&&X!==M&&this.addIndicesForPlacedSymbol(this.text,X),vt>=0&&this.addIndicesForPlacedSymbol(this.text,vt),Ht>=0&&this.addIndicesForPlacedSymbol(this.icon,Ht),Ui>=0&&this.addIndicesForPlacedSymbol(this.icon,Ui)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ip(tx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tx.MAX_GLYPHS=65535,tx.addDynamicAttributes=qw;const qT=new $f({"symbol-placement":new pd(Pd.layout_symbol["symbol-placement"]),"symbol-spacing":new pd(Pd.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pd(Pd.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $d(Pd.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pd(Pd.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pd(Pd.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pd(Pd.layout_symbol["icon-ignore-placement"]),"icon-optional":new pd(Pd.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pd(Pd.layout_symbol["icon-rotation-alignment"]),"icon-size":new $d(Pd.layout_symbol["icon-size"]),"icon-text-fit":new pd(Pd.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pd(Pd.layout_symbol["icon-text-fit-padding"]),"icon-image":new $d(Pd.layout_symbol["icon-image"]),"icon-rotate":new $d(Pd.layout_symbol["icon-rotate"]),"icon-padding":new pd(Pd.layout_symbol["icon-padding"]),"icon-keep-upright":new pd(Pd.layout_symbol["icon-keep-upright"]),"icon-offset":new $d(Pd.layout_symbol["icon-offset"]),"icon-anchor":new $d(Pd.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pd(Pd.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pd(Pd.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pd(Pd.layout_symbol["text-rotation-alignment"]),"text-field":new $d(Pd.layout_symbol["text-field"]),"text-font":new $d(Pd.layout_symbol["text-font"]),"text-size":new $d(Pd.layout_symbol["text-size"]),"text-max-width":new $d(Pd.layout_symbol["text-max-width"]),"text-line-height":new $d(Pd.layout_symbol["text-line-height"]),"text-letter-spacing":new $d(Pd.layout_symbol["text-letter-spacing"]),"text-justify":new $d(Pd.layout_symbol["text-justify"]),"text-radial-offset":new $d(Pd.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pd(Pd.layout_symbol["text-variable-anchor"]),"text-anchor":new $d(Pd.layout_symbol["text-anchor"]),"text-max-angle":new pd(Pd.layout_symbol["text-max-angle"]),"text-writing-mode":new pd(Pd.layout_symbol["text-writing-mode"]),"text-rotate":new $d(Pd.layout_symbol["text-rotate"]),"text-padding":new pd(Pd.layout_symbol["text-padding"]),"text-keep-upright":new pd(Pd.layout_symbol["text-keep-upright"]),"text-transform":new $d(Pd.layout_symbol["text-transform"]),"text-offset":new $d(Pd.layout_symbol["text-offset"]),"text-allow-overlap":new pd(Pd.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pd(Pd.layout_symbol["text-ignore-placement"]),"text-optional":new pd(Pd.layout_symbol["text-optional"])});var P2={paint:new $f({"icon-opacity":new $d(Pd.paint_symbol["icon-opacity"]),"icon-color":new $d(Pd.paint_symbol["icon-color"]),"icon-halo-color":new $d(Pd.paint_symbol["icon-halo-color"]),"icon-halo-width":new $d(Pd.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $d(Pd.paint_symbol["icon-halo-blur"]),"icon-translate":new pd(Pd.paint_symbol["icon-translate"]),"icon-translate-anchor":new pd(Pd.paint_symbol["icon-translate-anchor"]),"text-opacity":new $d(Pd.paint_symbol["text-opacity"]),"text-color":new $d(Pd.paint_symbol["text-color"],{runtimeType:mm,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new $d(Pd.paint_symbol["text-halo-color"]),"text-halo-width":new $d(Pd.paint_symbol["text-halo-width"]),"text-halo-blur":new $d(Pd.paint_symbol["text-halo-blur"]),"text-translate":new pd(Pd.paint_symbol["text-translate"]),"text-translate-anchor":new pd(Pd.paint_symbol["text-translate-anchor"])}),layout:qT};class EE{constructor(l){this.type=l.property.overrides?l.property.overrides.runtimeType:c_,this.defaultValue=l}evaluate(l){if(l.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ip(EE,"FormatSectionOverride",{omit:["defaultValue"]});class Zw extends j0{constructor(l){super(l,P2)}recalculate(l,d){super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const y=this.layout.get("text-writing-mode");if(y){const M=[];for(const N of y)M.indexOf(N)<0&&M.push(N);this.layout._values["text-writing-mode"]=M}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(l,d,y,M){const N=this.layout.get(l).evaluate(d,{},y,M),X=this._unevaluatedLayout._values[l];return X.isDataDriven()||Xy(X.value)||!N?N:function(vt,Ht){return Ht.replace(/{([^{}]+)}/g,(Ui,Fn)=>Fn in vt?String(vt[Fn]):"")}(d.properties,N)}createBucket(l){return new tx(l)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const l of P2.paint.overridableProperties){if(!Zw.hasPaintOverride(this.layout,l))continue;const d=this.paint.get(l),y=new EE(d),M=new Y_(y,d.property.specification);let N=null;N=d.value.kind==="constant"||d.value.kind==="source"?new B0("source",M):new kp("composite",M,d.value.zoomStops,d.value._interpolationType),this.paint._values[l]=new Lf(d.property,N,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,y){return!(!this.layout||d.isDataDriven()||y.isDataDriven())&&Zw.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){const y=l.get("text-field"),M=P2.paint.properties[d];let N=!1;const X=vt=>{for(const Ht of vt)if(M.overrides&&M.overrides.hasOverride(Ht))return void(N=!0)};if(y.value.kind==="constant"&&y.value.value instanceof bg)X(y.value.value.sections);else if(y.value.kind==="source"){const vt=Ui=>{N||(Ui instanceof Ry&&Km(Ui.value)===Uh?X(Ui.value.sections):Ui instanceof n0?X(Ui.sections):Ui.eachChild(vt))},Ht=y.value;Ht._styleExpression&&vt(Ht._styleExpression.expression)}return N}getProgramConfiguration(l){return new Kv(this,l)}}var ZT={paint:new $f({"background-color":new pd(Pd.paint_background["background-color"]),"background-pattern":new pd(Pd.paint_background["background-pattern"]),"background-opacity":new pd(Pd.paint_background["background-opacity"])})},HT={paint:new $f({"raster-opacity":new pd(Pd.paint_raster["raster-opacity"]),"raster-hue-rotate":new pd(Pd.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pd(Pd.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pd(Pd.paint_raster["raster-brightness-max"]),"raster-saturation":new pd(Pd.paint_raster["raster-saturation"]),"raster-contrast":new pd(Pd.paint_raster["raster-contrast"]),"raster-resampling":new pd(Pd.paint_raster["raster-resampling"]),"raster-fade-duration":new pd(Pd.paint_raster["raster-fade-duration"])})};class XT extends j0{constructor(l){super(l,{}),this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)}onRemove(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)}}var WT={paint:new $f({"sky-type":new pd(Pd.paint_sky["sky-type"]),"sky-atmosphere-sun":new pd(Pd.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pd(Pd.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pd(Pd.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pd(Pd.paint_sky["sky-gradient-radius"]),"sky-gradient":new yf(Pd.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pd(Pd.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pd(Pd.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pd(Pd.paint_sky["sky-opacity"])})};function k2(c,l,d){const y=[0,0,1],M=mx([]);return bb(M,M,d?-ih(c)+Math.PI:ih(c)),g1(M,M,-ih(l)),dw(y,y,M),R_(y,y)}const YT={circle:class extends j0{constructor(c){super(c,Rb)}createBucket(c){return new Sx(c)}queryRadius(c){const l=c;return T1("circle-radius",this,l)+T1("circle-stroke-width",this,l)+Ix(this.paint.get("circle-translate"))}queryIntersectsFeature(c,l,d,y,M,N,X,vt){const Ht=Cx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Ui=this.paint.get("circle-radius").evaluate(l,d)+this.paint.get("circle-stroke-width").evaluate(l,d);return Ob(c,y,N,X,vt,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",Ht,Ui)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new Kv(this,c)}},heatmap:class extends j0{createBucket(c){return new $b(c)}constructor(c){super(c,Cw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=S1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return T1("heatmap-radius",this,c)}queryIntersectsFeature(c,l,d,y,M,N,X,vt){const Ht=this.paint.get("heatmap-radius").evaluate(l,d);return Ob(c,y,N,X,vt,!0,!0,new $s(0,0),Ht)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new Kv(this,c)}},hillshade:class extends j0{constructor(c){super(c,zb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends j0{constructor(c){super(c,Gp)}getProgramIds(){const c=this.paint.get("fill-pattern"),l=c&&c.constantOr(1),d=[l?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&d.push(l&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),d}getProgramConfiguration(c){return new Kv(this,c)}recalculate(c,l){super.recalculate(c,l);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new gp(c)}queryRadius(){return Ix(this.paint.get("fill-translate"))}queryIntersectsFeature(c,l,d,y,M,N){return!c.queryGeometry.isAboveHorizon&&ww(Jx(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),y)}isTileClipped(){return!0}},"fill-extrusion":class extends j0{constructor(c){super(c,Fb)}createBucket(c){return new ty(c)}queryRadius(){return Ix(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new Kv(this,c)}queryIntersectsFeature(c,l,d,y,M,N,X,vt,Ht){const Ui=Cx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Fn=this.paint.get("fill-extrusion-height").evaluate(l,d),Js=this.paint.get("fill-extrusion-base").evaluate(l,d),nl=[0,0],ju=vt&&N.elevation,Ku=N.elevation?N.elevation.exaggeration():1,lh=c.tile.getBucket(this);if(ju&&lh instanceof ty){const Vh=lh.centroidVertexArray,rd=Ht+1;rd<Vh.length&&(nl[0]=Vh.geta_centroid_pos0(rd),nl[1]=Vh.geta_centroid_pos1(rd))}if(nl[0]===0&&nl[1]===1)return!1;N.projection.name==="globe"&&(y=K1([y],[new $s(0,0),new $s(Hp,Hp)],c.tileID.canonical).map(Vh=>Vh.polygon).flat());const Eh=ju?vt:null,[Bh,Yh]=function(Vh,rd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf){return Vh.projection.name==="globe"?function(Xf,Hd,up,jp,vp,Rp,dp,Xp,xm,gm,pm){const Wp=[],Zm=[],tm=Xf.projection.upVectorScale(pm,Xf.center.lat,Xf.worldSize).metersToTile,bm=[0,0,0,1],Wm=[0,0,0,1],hg=(dg,xg,Ug,N_)=>{dg[0]=xg,dg[1]=Ug,dg[2]=N_,dg[3]=1},ng=_v();up>0&&(up+=ng),jp+=ng;for(const dg of Hd){const xg=[],Ug=[];for(const N_ of dg){const Hm=N_.x+vp.x,r_=N_.y+vp.y,Kg=Xf.projection.projectTilePoint(Hm,r_,pm),Lm=Xf.projection.upVector(pm,N_.x,N_.y);let Ag=up,s_=jp;if(dp){const Ym=kw(Hm,r_,up,jp,dp,Xp,xm,gm);Ag+=Ym.base,s_+=Ym.top}up!==0?hg(bm,Kg.x+Lm[0]*tm*Ag,Kg.y+Lm[1]*tm*Ag,Kg.z+Lm[2]*tm*Ag):hg(bm,Kg.x,Kg.y,Kg.z),hg(Wm,Kg.x+Lm[0]*tm*s_,Kg.y+Lm[1]*tm*s_,Kg.z+Lm[2]*tm*s_),Cg(bm,bm,Rp),Cg(Wm,Wm,Rp),xg.push(new M1(bm[0],bm[1],bm[2])),Ug.push(new M1(Wm[0],Wm[1],Wm[2]))}Wp.push(xg),Zm.push(Ug)}return[Wp,Zm]}(Vh,rd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf,Uf):Zf?function(Xf,Hd,up,jp,vp,Rp,dp,Xp,xm){const gm=[],pm=[],Wp=[0,0,0,1];for(const Zm of Xf){const tm=[],bm=[];for(const Wm of Zm){const hg=Wm.x+jp.x,ng=Wm.y+jp.y,dg=kw(hg,ng,Hd,up,Rp,dp,Xp,xm);Wp[0]=hg,Wp[1]=ng,Wp[2]=dg.base,Wp[3]=1,m1(Wp,Wp,vp),Wp[3]=Math.max(Wp[3],1e-5);const xg=new M1(Wp[0]/Wp[3],Wp[1]/Wp[3],Wp[2]/Wp[3]);Wp[0]=hg,Wp[1]=ng,Wp[2]=dg.top,Wp[3]=1,m1(Wp,Wp,vp),Wp[3]=Math.max(Wp[3],1e-5);const Ug=new M1(Wp[0]/Wp[3],Wp[1]/Wp[3],Wp[2]/Wp[3]);tm.push(xg),bm.push(Ug)}gm.push(tm),pm.push(bm)}return[gm,pm]}(rd,ed,Rd,kd,Sf,Zf,jd,Pf,Rf):function(Xf,Hd,up,jp,vp){const Rp=[],dp=[],Xp=vp[8]*Hd,xm=vp[9]*Hd,gm=vp[10]*Hd,pm=vp[11]*Hd,Wp=vp[8]*up,Zm=vp[9]*up,tm=vp[10]*up,bm=vp[11]*up;for(const Wm of Xf){const hg=[],ng=[];for(const dg of Wm){const xg=dg.x+jp.x,Ug=dg.y+jp.y,N_=vp[0]*xg+vp[4]*Ug+vp[12],Hm=vp[1]*xg+vp[5]*Ug+vp[13],r_=vp[2]*xg+vp[6]*Ug+vp[14],Kg=vp[3]*xg+vp[7]*Ug+vp[15],Lm=N_+Xp,Ag=Hm+xm,s_=r_+gm,Ym=Math.max(Kg+pm,1e-5),Zg=N_+Wp,dy=Hm+Zm,z_=r_+tm,F_=Math.max(Kg+bm,1e-5);hg.push(new M1(Lm/Ym,Ag/Ym,s_/Ym)),ng.push(new M1(Zg/F_,dy/F_,z_/F_))}Rp.push(hg),dp.push(ng)}return[Rp,dp]}(rd,ed,Rd,kd,Sf)}(N,y,Js,Fn,Ui,X,Eh,nl,Ku,N.center.lat,c.tileID.canonical),kh=c.queryGeometry;return function(Vh,rd,ed){let Rd=1/0;ww(ed,rd)&&(Rd=Pw(ed,rd[0]));for(let kd=0;kd<rd.length;kd++){const Sf=rd[kd],Zf=Vh[kd];for(let jd=0;jd<Sf.length-1;jd++){const Pf=Sf[jd],Rf=[Pf,Sf[jd+1],Zf[jd+1],Zf[jd],Pf];bw(ed,Rf)&&(Rd=Math.min(Rd,Pw(ed,Rf)))}}return Rd!==1/0&&Rd}(Bh,Yh,kh.isPointQuery()?kh.screenBounds:kh.screenGeometry)}},line:class extends j0{constructor(c){super(c,ry),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const l=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=l._styleExpression&&l._styleExpression.expression instanceof p_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,l){super.recalculate(c,l),this.paint._values["line-floorwidth"]=Q0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new A1(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new Kv(this,c)}queryRadius(c){const l=c,d=Q1(T1("line-width",this,l),T1("line-gap-width",this,l)),y=T1("line-offset",this,l);return d/2+Math.abs(y)+Ix(this.paint.get("line-translate"))}queryIntersectsFeature(c,l,d,y,M,N){if(c.queryGeometry.isAboveHorizon)return!1;const X=Jx(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),vt=c.pixelToTileUnitsFactor/2*Q1(this.paint.get("line-width").evaluate(l,d),this.paint.get("line-gap-width").evaluate(l,d)),Ht=this.paint.get("line-offset").evaluate(l,d);return Ht&&(y=function(Ui,Fn){const Js=[],nl=new $s(0,0);for(let ju=0;ju<Ui.length;ju++){const Ku=Ui[ju],lh=[];for(let Eh=0;Eh<Ku.length;Eh++){const Bh=Ku[Eh-1],Yh=Ku[Eh],kh=Ku[Eh+1],Vh=Eh===0?nl:Yh.sub(Bh)._unit()._perp(),rd=Eh===Ku.length-1?nl:kh.sub(Yh)._unit()._perp(),ed=Vh._add(rd)._unit();ed._mult(1/(ed.x*rd.x+ed.y*rd.y)),lh.push(ed._mult(Fn)._add(Yh))}Js.push(lh)}return Js}(y,Ht*c.pixelToTileUnitsFactor)),function(Ui,Fn,Js){for(let nl=0;nl<Fn.length;nl++){const ju=Fn[nl];if(Ui.length>=3){for(let Ku=0;Ku<ju.length;Ku++)if(i1(Ui,ju[Ku]))return!0}if(u2(Ui,ju,Js))return!0}return!1}(X,y,vt)}isTileClipped(){return!0}},symbol:Zw,background:class extends j0{constructor(c){super(c,ZT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends j0{constructor(c){super(c,HT)}getProgramIds(){return["raster"]}},sky:class extends j0{constructor(c){super(c,WT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=S1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const l=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==l.azimuthal||this._lightPosition.polar!==l.polar}return!1}getCenter(c,l){if(this.paint.get("sky-type")==="atmosphere"){const y=this.paint.get("sky-atmosphere-sun"),M=!y,N=c.style.light,X=N.properties.get("position");return M&&N.properties.get("anchor")==="viewport"&&rp("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),M?k2(X.azimuthal,90-X.polar,l):k2(y[0],90-y[1],l)}const d=this.paint.get("sky-gradient-center");return k2(d[0],90-d[1],l)}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}}};class Yb{constructor(l,d,y,M){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(d,M)}update(l,d,y){const{width:M,height:N}=l,{context:X}=this,{gl:vt}=X,{HTMLImageElement:Ht,HTMLCanvasElement:Ui,HTMLVideoElement:Fn,ImageData:Js,ImageBitmap:nl}=x;if(vt.bindTexture(vt.TEXTURE_2D,this.texture),X.pixelStoreUnpackFlipY.set(!1),X.pixelStoreUnpack.set(1),X.pixelStoreUnpackPremultiplyAlpha.set(this.format===vt.RGBA&&(!d||d.premultiply!==!1)),y||this.size&&this.size[0]===M&&this.size[1]===N){const{x:ju,y:Ku}=y||{x:0,y:0};l instanceof Ht||l instanceof Ui||l instanceof Fn||l instanceof Js||nl&&l instanceof nl?vt.texSubImage2D(vt.TEXTURE_2D,0,ju,Ku,vt.RGBA,vt.UNSIGNED_BYTE,l):vt.texSubImage2D(vt.TEXTURE_2D,0,ju,Ku,M,N,vt.RGBA,vt.UNSIGNED_BYTE,l.data)}else this.size=[M,N],l instanceof Ht||l instanceof Ui||l instanceof Fn||l instanceof Js||nl&&l instanceof nl?vt.texImage2D(vt.TEXTURE_2D,0,this.format,this.format,vt.UNSIGNED_BYTE,l):vt.texImage2D(vt.TEXTURE_2D,0,this.format,M,N,0,this.format,vt.UNSIGNED_BYTE,l.data);this.useMipmap=!!(d&&d.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&vt.generateMipmap(vt.TEXTURE_2D)}bind(l,d){const{context:y}=this,{gl:M}=y;M.bindTexture(M.TEXTURE_2D,this.texture),l!==this.filter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,l),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,this.useMipmap?l===M.NEAREST?M.NEAREST_MIPMAP_NEAREST:M.LINEAR_MIPMAP_NEAREST:l),this.filter=l),d!==this.wrap&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,d),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class KT{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QT{constructor(){this.tasks={},this.taskQueue=[],Md(["process"],this),this.invoker=new KT(this.process),this.nextId=0}add(l,d){const y=this.nextId++,M=function({type:N,isSymbolTile:X,zoom:vt}){return vt=vt||0,N==="message"?0:N!=="maybePrepare"||X?N!=="parseTile"||X?N==="parseTile"&&X?300-vt:N==="maybePrepare"&&X?400-vt:500:200-vt:100-vt}(d);if(M===0){Jd();try{l()}finally{}return{cancel:()=>{}}}return this.tasks[y]={fn:l,metadata:d,priority:M,id:y},this.taskQueue.push(y),this.invoker.trigger(),{cancel:()=>{delete this.tasks[y]}}}process(){Jd();try{if(this.taskQueue=this.taskQueue.filter(y=>!!this.tasks[y]),!this.taskQueue.length)return;const l=this.pick();if(l===null)return;const d=this.tasks[l];if(delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),!d)return;d.fn()}finally{}}pick(){let l=null,d=1/0;for(let M=0;M<this.taskQueue.length;M++){const N=this.tasks[this.taskQueue[M]];N.priority<d&&(d=N.priority,l=M)}if(l===null)return null;const y=this.taskQueue[l];return this.taskQueue.splice(l,1),y}remove(){this.invoker.remove()}}class TE{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){const y=l[d];this._stringToNumber[y]=d,this._numberToString[d]=y}}encode(l){return this._stringToNumber[l]}decode(l){return this._numberToString[l]}}const JT=["tile","layer","source","sourceLayer","state"];class SE{constructor(l,d,y,M,N){this.type="Feature",this._vectorTileFeature=l,this._z=d,this._x=y,this._y=M,this.properties=l.properties,this.id=N}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(l.id=this.id);for(const d of JT)this[d]!==void 0&&(l[d]=this[d]);return l}}const yv=32,n1=33,ix=new Uint16Array(8184);for(let c=0;c<2046;c++){let l=c+2,d=0,y=0,M=0,N=0,X=0,vt=0;for(1&l?M=N=X=yv:d=y=vt=yv;(l>>=1)>1;){const Ui=d+M>>1,Fn=y+N>>1;1&l?(M=d,N=y,d=X,y=vt):(d=M,y=N,M=X,N=vt),X=Ui,vt=Fn}const Ht=4*c;ix[Ht+0]=d,ix[Ht+1]=y,ix[Ht+2]=M,ix[Ht+3]=N}const o1=new Uint16Array(2178),rx=new Uint8Array(1089),Hw=new Uint16Array(1089);function IE(c){return c===0?-.03125:c===32?.03125:0}var CE=Lp([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ME={type:2,extent:Hp,loadGeometry:()=>[[new $s(0,0),new $s(8193,0),new $s(8193,8193),new $s(0,8193),new $s(0,0)]]};class D2{constructor(l,d,y,M,N){this.tileID=l,this.uid=qd(),this.uses=0,this.tileSize=d,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=N,this.expiredRequestCount=0,this.state="loading",M&&M.transform&&(this.projection=M.transform.projection)}registerFadeDuration(l){const d=l+this.timeAdded;d<mf.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=kx(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,d,y){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(M,N){const X={};if(!N)return X;for(const vt of M){const Ht=vt.layerIds.map(Ui=>N.getLayer(Ui)).filter(Boolean);if(Ht.length!==0){vt.layers=Ht,vt.stateDependentLayerIds&&(vt.stateDependentLayers=vt.stateDependentLayerIds.map(Ui=>Ht.filter(Fn=>Fn.id===Ui)[0]));for(const Ui of Ht)X[Ui.id]=vt}}return X}(l.buckets,d.style),this.hasSymbolBuckets=!1;for(const M in this.buckets){const N=this.buckets[M];if(N instanceof tx){if(this.hasSymbolBuckets=!0,!y)break;N.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const M in this.buckets){const N=this.buckets[M];if(N instanceof tx&&N.hasRTLText){this.hasRTLText=!0,Hh.isLoading()||Hh.isLoaded()||qh()!=="deferred"||Fh();break}}this.queryPadding=0;for(const M in this.buckets){const N=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(M).queryRadius(N))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas)}else this.collisionBoxArray=new hb}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const M=this.buckets[y];M.uploadPending()&&M.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yb(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yb(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Yb(l,this.lineAtlas.image,d.ALPHA),this.lineAtlas.uploaded=!0)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,y,M,N,X,vt,Ht){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:M,pixelPosMatrix:vt,transform:X,params:N,tileTransform:this.tileTransform},l,d,y):{}}querySourceFeatures(l,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const M=y.loadVTLayers(),N=d?d.sourceLayer:"",X=M._geojsonTileLayer||M[N];if(!X)return;const vt=v0(d&&d.filter),{z:Ht,x:Ui,y:Fn}=this.tileID.canonical,Js={z:Ht,x:Ui,y:Fn};for(let nl=0;nl<X.length;nl++){const ju=X.feature(nl);if(vt.needGeometry){const Eh=Ov(ju,!0);if(!vt.filter(new ld(this.tileID.overscaledZ),Eh,this.tileID.canonical))continue}else if(!vt.filter(new ld(this.tileID.overscaledZ),ju))continue;const Ku=y.getId(ju,N),lh=new SE(ju,Ht,Ui,Fn,Ku);lh.tile=Js,l.push(lh)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const y=op(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let M=!1;if(this.expirationTime>y)M=!1;else if(d)if(this.expirationTime<d)M=!0;else{const N=this.expirationTime-d;N?this.expirationTime=y+Math.max(N,3e4):M=!0}else M=!0;M?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0||!d)return;const y=this.latestFeatureIndex.loadVTLayers(),M=d.style.listImages();for(const N in this.buckets){if(!d.style.hasLayer(N))continue;const X=this.buckets[N],vt=X.layers[0].sourceLayer||"_geojsonTileLayer",Ht=y[vt],Ui=l[vt];if(!Ht||!Ui||Object.keys(Ui).length===0)continue;if(X.update(Ui,Ht,M,this.imageAtlas&&this.imageAtlas.patternPositions||{}),X instanceof A1||X instanceof gp){const Js=d.style._getSourceCache(X.layers[0].source);d._terrain&&d._terrain.enabled&&Js&&X.programConfigurations.needsUpload&&d._terrain._clearRenderCacheForTile(Js.id,this.tileID)}const Fn=d&&d.style&&d.style.getLayer(N);Fn&&(this.queryPadding=Math.max(this.queryPadding,Fn.queryRadius(X)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<mf.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=mf.now()+l}setTexture(l,d){const y=d.context,M=y.gl;this.texture=this.texture||d.getTileTexture(l.width),this.texture?this.texture.update(l,{useMipmap:!0}):(this.texture=new Yb(y,l,M.RGBA,{useMipmap:!0}),this.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE))}setDependencies(l,d){const y={};for(const M of d)y[M]=!0;this.dependencies[l]=y}hasDependency(l,d){for(const y of l){const M=this.dependencies[y];if(M){for(const N of d)if(M[N])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const y=Rv(ME,this.tileID.canonical,this.tileTransform)[0],M=new zp,N=new I0;for(let X=0;X<y.length;X++){const{x:vt,y:Ht}=y[X];M.emplaceBack(vt,Ht),N.emplaceBack(X)}N.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(N),this._tileDebugBuffer=l.createVertexBuffer(M,_1.members),this._tileDebugSegments=Og.simpleSegment(0,0,M.length,N.length)}_makeTileBoundsBuffers(l,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const y=Rv(ME,this.tileID.canonical,this.tileTransform)[0];let M,N;if(this.isRaster){const X=function(vt,Ht){const Ui=kx(vt,Ht),Fn=Math.pow(2,vt.z);for(let Eh=0;Eh<n1;Eh++)for(let Bh=0;Bh<n1;Bh++){const Yh=e0((vt.x+(Bh+IE(Bh))/yv)/Fn),kh=Mg((vt.y+(Eh+IE(Eh))/yv)/Fn),Vh=Ht.project(Yh,kh),rd=Eh*n1+Bh;o1[2*rd+0]=Math.round((Vh.x*Ui.scale-Ui.x)*Hp),o1[2*rd+1]=Math.round((Vh.y*Ui.scale-Ui.y)*Hp)}rx.fill(0),Hw.fill(0);for(let Eh=2045;Eh>=0;Eh--){const Bh=4*Eh,Yh=ix[Bh+0],kh=ix[Bh+1],Vh=ix[Bh+2],rd=ix[Bh+3],ed=Yh+Vh>>1,Rd=kh+rd>>1,kd=ed+Rd-kh,Sf=Rd+Yh-ed,Zf=kh*n1+Yh,jd=rd*n1+Vh,Pf=Rd*n1+ed,Rf=Math.hypot((o1[2*Zf+0]+o1[2*jd+0])/2-o1[2*Pf+0],(o1[2*Zf+1]+o1[2*jd+1])/2-o1[2*Pf+1])>=16;if(rx[Pf]=rx[Pf]||(Rf?1:0),Eh<1022){const Uf=(kh+Sf>>1)*n1+(Yh+kd>>1),Xf=(rd+Sf>>1)*n1+(Vh+kd>>1);rx[Pf]=rx[Pf]||rx[Uf]||rx[Xf]}}const Js=new Am,nl=new y_;let ju=0;function Ku(Eh,Bh){const Yh=Bh*n1+Eh;return Hw[Yh]===0&&(Js.emplaceBack(o1[2*Yh+0],o1[2*Yh+1],Eh*Hp/yv,Bh*Hp/yv),Hw[Yh]=++ju),Hw[Yh]-1}function lh(Eh,Bh,Yh,kh,Vh,rd){const ed=Eh+Yh>>1,Rd=Bh+kh>>1;if(Math.abs(Eh-Vh)+Math.abs(Bh-rd)>1&&rx[Rd*n1+ed])lh(Vh,rd,Eh,Bh,ed,Rd),lh(Yh,kh,Vh,rd,ed,Rd);else{const kd=Ku(Eh,Bh),Sf=Ku(Yh,kh),Zf=Ku(Vh,rd);nl.emplaceBack(kd,Sf,Zf)}}return lh(0,0,yv,yv,yv,0),lh(yv,yv,0,0,0,yv),{vertices:Js,indices:nl}}(this.tileID.canonical,d);M=X.vertices,N=X.indices}else{M=new Am,N=new y_;for(const{x:vt,y:Ht}of y)M.emplaceBack(vt,Ht,0,0);const X=W1(M.int16,void 0,4);for(let vt=0;vt<X.length;vt+=3)N.emplaceBack(X[vt],X[vt+1],X[vt+2])}this._tileBoundsBuffer=l.createVertexBuffer(M,CE.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(N),this._tileBoundsSegments=Og.simpleSegment(0,0,M.length,N.length)}_makeGlobeTileDebugBuffers(l,d){const y=d.projection;if(!y||y.name!=="globe"||d.freezeTileCoverage)return;const M=this.tileID.canonical,N=j1(Sb(M,d)),X=Lv(d.zoom);let vt;X>0&&(vt=fx(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(l,M,d,N,vt,X),this._makeGlobeTileDebugTextBuffer(l,M,d,N,vt,X)}_globePoint(l,d,y,M,N,X,vt){let Ht=G1(l,d,y);if(X){const Ui=1<<y.z,Fn=P0(M.center.lng),Js=X0(M.center.lat),nl=(y.x+.5)/Ui-Fn;let ju=0;nl>.5?ju=-1:nl<-.5&&(ju=1);let Ku=(l/Hp+y.x)/Ui+ju,lh=(d/Hp+y.y)/Ui;Ku=(Ku-Fn)*M._pixelsPerMercatorPixel+Fn,lh=(lh-Js)*M._pixelsPerMercatorPixel+Js;const Eh=[Ku*M.worldSize,lh*M.worldSize,0];Cg(Eh,Eh,X),Ht=v1(Ht,Eh,vt)}return Cg(Ht,Ht,N)}_makeGlobeTileDebugBorderBuffer(l,d,y,M,N,X){const vt=new zp,Ht=new I0,Ui=new km,Fn=(nl,ju,Ku,lh,Eh)=>{const Bh=(Ku-nl)/(Eh-1),Yh=(lh-ju)/(Eh-1),kh=vt.length;for(let Vh=0;Vh<Eh;Vh++){const rd=nl+Vh*Bh,ed=ju+Vh*Yh;vt.emplaceBack(rd,ed);const Rd=this._globePoint(rd,ed,d,y,M,N,X);Ui.emplaceBack(Rd[0],Rd[1],Rd[2]),Ht.emplaceBack(kh+Vh)}},Js=Hp;Fn(0,0,Js,0,16),Fn(Js,0,Js,Js,16),Fn(Js,Js,0,Js,16),Fn(0,Js,0,0,16),this._tileDebugIndexBuffer=l.createIndexBuffer(Ht),this._tileDebugBuffer=l.createVertexBuffer(vt,_1.members),this._globeTileDebugBorderBuffer=l.createVertexBuffer(Ui,wb.members),this._tileDebugSegments=Og.simpleSegment(0,0,vt.length,Ht.length)}_makeGlobeTileDebugTextBuffer(l,d,y,M,N,X){const vt=new zp,Ht=new y_,Ui=new km,Fn=25;Ht.reserve(32),vt.reserve(Fn),Ui.reserve(Fn);const Js=(nl,ju)=>Fn*nl+ju;for(let nl=0;nl<Fn;nl++){const ju=2048*nl;for(let Ku=0;Ku<Fn;Ku++){const lh=2048*Ku;vt.emplaceBack(lh,ju);const Eh=this._globePoint(lh,ju,d,y,M,N,X);Ui.emplaceBack(Eh[0],Eh[1],Eh[2])}}for(let nl=0;nl<4;nl++)for(let ju=0;ju<4;ju++){const Ku=Js(nl,ju),lh=Js(nl,ju+1),Eh=Js(nl+1,ju),Bh=Js(nl+1,ju+1);Ht.emplaceBack(Ku,lh,Eh),Ht.emplaceBack(Eh,lh,Bh)}this._tileDebugTextIndexBuffer=l.createIndexBuffer(Ht),this._tileDebugTextBuffer=l.createVertexBuffer(vt,_1.members),this._globeTileDebugTextBuffer=l.createVertexBuffer(Ui,wb.members),this._tileDebugTextSegments=Og.simpleSegment(0,0,Fn,32)}}class eS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,y){const M=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][M]=this.stateChanges[l][M]||{},md(this.stateChanges[l][M],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const N in this.state[l])N!==M&&(this.deletedStates[l][N]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][M]===null){this.deletedStates[l][M]={};for(const N in this.state[l][M])y[N]||(this.deletedStates[l][M][N]=null)}else for(const N in y)this.deletedStates[l]&&this.deletedStates[l][M]&&this.deletedStates[l][M][N]===null&&delete this.deletedStates[l][M][N]}removeFeatureState(l,d,y){if(this.deletedStates[l]===null)return;const M=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&d!==void 0)this.deletedStates[l][M]!==null&&(this.deletedStates[l][M]=this.deletedStates[l][M]||{},this.deletedStates[l][M][y]=null);else if(d!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][M])for(y in this.deletedStates[l][M]={},this.stateChanges[l][M])this.deletedStates[l][M][y]=null;else this.deletedStates[l][M]=null;else this.deletedStates[l]=null}getState(l,d){const y=String(d),M=md({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const N=this.deletedStates[l][d];if(N===null)return{};for(const X in N)delete M[X]}return M}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const y={};for(const M in this.stateChanges){this.state[M]=this.state[M]||{};const N={};for(const X in this.stateChanges[M])this.state[M][X]||(this.state[M][X]={}),md(this.state[M][X],this.stateChanges[M][X]),N[X]=this.state[M][X];y[M]=N}for(const M in this.deletedStates){this.state[M]=this.state[M]||{};const N={};if(this.deletedStates[M]===null)for(const X in this.state[M])N[X]={},this.state[M][X]={};else for(const X in this.deletedStates[M]){if(this.deletedStates[M][X]===null)this.state[M][X]={};else if(this.state[M][X])for(const vt of Object.keys(this.deletedStates[M][X]))delete this.state[M][X][vt];N[X]=this.state[M][X]}y[M]=y[M]||{},md(y[M],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const M in l)l[M].setFeatureState(y,d)}}class AE{constructor(l){this.size=l,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(l,d){const y=this.toIdx(l,d);return{min:this.minimums[y],max:this.maximums[y]}}isLeaf(l,d){return this.leaves[this.toIdx(l,d)]}toIdx(l,d){return d*this.size+l}}function PE(c,l,d,y){let M=0,N=Number.MAX_VALUE;for(let X=0;X<3;X++)if(Math.abs(y[X])<1e-15){if(d[X]<c[X]||d[X]>l[X])return null}else{const vt=1/y[X];let Ht=(c[X]-d[X])*vt,Ui=(l[X]-d[X])*vt;if(Ht>Ui){const Fn=Ht;Ht=Ui,Ui=Fn}if(Ht>M&&(M=Ht),Ui<N&&(N=Ui),M>N)return null}return M}function kE(c,l,d,y,M,N,X,vt,Ht,Ui,Fn){const Js=y-c,nl=M-l,ju=N-d,Ku=X-c,lh=vt-l,Eh=Ht-d,Bh=Fn[1]*Eh-Fn[2]*lh,Yh=Fn[2]*Ku-Fn[0]*Eh,kh=Fn[0]*lh-Fn[1]*Ku,Vh=Js*Bh+nl*Yh+ju*kh;if(Math.abs(Vh)<1e-15)return null;const rd=1/Vh,ed=Ui[0]-c,Rd=Ui[1]-l,kd=Ui[2]-d,Sf=(ed*Bh+Rd*Yh+kd*kh)*rd;if(Sf<0||Sf>1)return null;const Zf=Rd*ju-kd*nl,jd=kd*Js-ed*ju,Pf=ed*nl-Rd*Js,Rf=(Fn[0]*Zf+Fn[1]*jd+Fn[2]*Pf)*rd;return Rf<0||Sf+Rf>1?null:(Ku*Zf+lh*jd+Eh*Pf)*rd}function DE(c,l,d){return(c-l)/(d-l)}function LE(c,l,d,y,M,N,X,vt,Ht){const Ui=1<<d,Fn=N-y,Js=X-M,nl=(c+1)/Ui*Fn+y,ju=(l+0)/Ui*Js+M,Ku=(l+1)/Ui*Js+M;vt[0]=(c+0)/Ui*Fn+y,vt[1]=ju,Ht[0]=nl,Ht[1]=Ku}class RE{constructor(l){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=l,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const d=function(N){const X=Math.ceil(Math.log2(N.dim/8)),vt=[];let Ht=Math.ceil(Math.pow(2,X));const Ui=1/Ht,Fn=(ju,Ku,lh,Eh,Bh)=>{const Yh=Eh?1:0,kh=(ju+1)*lh-Yh,Vh=Ku*lh,rd=(Ku+1)*lh-Yh;Bh[0]=ju*lh,Bh[1]=Vh,Bh[2]=kh,Bh[3]=rd};let Js=new AE(Ht);const nl=[];for(let ju=0;ju<Ht*Ht;ju++){Fn(ju%Ht,Math.floor(ju/Ht),Ui,!1,nl);const Ku=nx(nl[0],nl[1],N),lh=nx(nl[2],nl[1],N),Eh=nx(nl[2],nl[3],N),Bh=nx(nl[0],nl[3],N);Js.minimums.push(Math.min(Ku,lh,Eh,Bh)),Js.maximums.push(Math.max(Ku,lh,Eh,Bh)),Js.leaves.push(1)}for(vt.push(Js),Ht/=2;Ht>=1;Ht/=2){const ju=vt[vt.length-1];Js=new AE(Ht);for(let Ku=0;Ku<Ht*Ht;Ku++){Fn(Ku%Ht,Math.floor(Ku/Ht),2,!0,nl);const lh=ju.getElevation(nl[0],nl[1]),Eh=ju.getElevation(nl[2],nl[1]),Bh=ju.getElevation(nl[2],nl[3]),Yh=ju.getElevation(nl[0],nl[3]),kh=ju.isLeaf(nl[0],nl[1]),Vh=ju.isLeaf(nl[2],nl[1]),rd=ju.isLeaf(nl[2],nl[3]),ed=ju.isLeaf(nl[0],nl[3]),Rd=Math.min(lh.min,Eh.min,Bh.min,Yh.min),kd=Math.max(lh.max,Eh.max,Bh.max,Yh.max),Sf=kh&&Vh&&rd&&ed;Js.maximums.push(kd),Js.minimums.push(Rd),Js.leaves.push(kd-Rd<=5&&Sf?1:0)}vt.push(Js)}return vt}(this.dem),y=d.length-1,M=d[y];this._addNode(M.minimums[0],M.maximums[0],M.leaves[0]),this._construct(d,0,0,y,0)}raycastRoot(l,d,y,M,N,X,vt=1){return PE([l,d,-100],[y,M,this.maximums[0]*vt],N,X)}raycast(l,d,y,M,N,X,vt=1){if(!this.nodeCount)return null;const Ht=this.raycastRoot(l,d,y,M,N,X,vt);if(Ht==null)return null;const Ui=[],Fn=[],Js=[],nl=[],ju=[{idx:0,t:Ht,nodex:0,nodey:0,depth:0}];for(;ju.length>0;){const{idx:Ku,t:lh,nodex:Eh,nodey:Bh,depth:Yh}=ju.pop();if(this.leaves[Ku]){LE(Eh,Bh,Yh,l,d,y,M,Js,nl);const Vh=1<<Yh,rd=(Eh+0)/Vh,ed=(Eh+1)/Vh,Rd=(Bh+0)/Vh,kd=(Bh+1)/Vh,Sf=nx(rd,Rd,this.dem)*vt,Zf=nx(ed,Rd,this.dem)*vt,jd=nx(ed,kd,this.dem)*vt,Pf=nx(rd,kd,this.dem)*vt,Rf=kE(Js[0],Js[1],Sf,nl[0],Js[1],Zf,nl[0],nl[1],jd,N,X),Uf=kE(nl[0],nl[1],jd,Js[0],nl[1],Pf,Js[0],Js[1],Sf,N,X),Xf=Math.min(Rf!==null?Rf:Number.MAX_VALUE,Uf!==null?Uf:Number.MAX_VALUE);if(Xf!==Number.MAX_VALUE)return Xf;{const Hd=U1([],N,X,lh);if(OE(Sf,Zf,Pf,jd,DE(Hd[0],Js[0],nl[0]),DE(Hd[1],Js[1],nl[1]))>=Hd[2])return lh}continue}let kh=0;for(let Vh=0;Vh<this._siblingOffset.length;Vh++){LE((Eh<<1)+this._siblingOffset[Vh][0],(Bh<<1)+this._siblingOffset[Vh][1],Yh+1,l,d,y,M,Js,nl),Js[2]=-100,nl[2]=this.maximums[this.childOffsets[Ku]+Vh]*vt;const rd=PE(Js,nl,N,X);if(rd!=null){const ed=rd;Ui[Vh]=ed;let Rd=!1;for(let kd=0;kd<kh&&!Rd;kd++)ed>=Ui[Fn[kd]]&&(Fn.splice(kd,0,Vh),Rd=!0);Rd||(Fn[kh]=Vh),kh++}}for(let Vh=0;Vh<kh;Vh++){const rd=Fn[Vh];ju.push({idx:this.childOffsets[Ku]+rd,t:Ui[rd],nodex:(Eh<<1)+this._siblingOffset[rd][0],nodey:(Bh<<1)+this._siblingOffset[rd][1],depth:Yh+1})}}return null}_addNode(l,d,y){return this.minimums.push(l),this.maximums.push(d),this.leaves.push(y),this.childOffsets.push(0),this.nodeCount++}_construct(l,d,y,M,N){if(l[M].isLeaf(d,y)===1)return;this.childOffsets[N]||(this.childOffsets[N]=this.nodeCount);const X=M-1,vt=l[X];let Ht=0,Ui=0;for(let Fn=0;Fn<this._siblingOffset.length;Fn++){const Js=2*d+this._siblingOffset[Fn][0],nl=2*y+this._siblingOffset[Fn][1],ju=vt.getElevation(Js,nl),Ku=vt.isLeaf(Js,nl),lh=this._addNode(ju.min,ju.max,Ku);Ku&&(Ht|=1<<Fn),Ui||(Ui=lh)}for(let Fn=0;Fn<this._siblingOffset.length;Fn++)Ht&1<<Fn||this._construct(l,2*d+this._siblingOffset[Fn][0],2*y+this._siblingOffset[Fn][1],X,Ui+Fn)}}function OE(c,l,d,y,M,N){return Kp(Kp(c,d,N),Kp(l,y,N),M)}function nx(c,l,d){const y=d.dim,M=Gh(c*y-.5,0,y-1),N=Gh(l*y-.5,0,y-1),X=Math.floor(M),vt=Math.floor(N),Ht=Math.min(X+1,y-1),Ui=Math.min(vt+1,y-1);return OE(d.get(X,vt),d.get(Ht,vt),d.get(X,Ui),d.get(Ht,Ui),M-X,N-vt)}const $E={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function tS(c,l,d){return(256*c*256+256*l+d)/10-1e4}function iS(c,l,d){return 256*c+l+d/256-32768}class Xw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(l,d,y,M=!1,N=!1){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(y&&y!=="mapbox"&&y!=="terrarium")return rp(`"${y}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=d.height;const X=this.dim=d.height-2,vt=new Uint32Array(d.data.buffer);if(this.pixels=new Uint8Array(d.data.buffer),this.encoding=y||"mapbox",this.borderReady=M,!M){for(let Ht=0;Ht<X;Ht++)vt[this._idx(-1,Ht)]=vt[this._idx(0,Ht)],vt[this._idx(X,Ht)]=vt[this._idx(X-1,Ht)],vt[this._idx(Ht,-1)]=vt[this._idx(Ht,0)],vt[this._idx(Ht,X)]=vt[this._idx(Ht,X-1)];vt[this._idx(-1,-1)]=vt[this._idx(0,0)],vt[this._idx(X,-1)]=vt[this._idx(X-1,0)],vt[this._idx(-1,X)]=vt[this._idx(0,X-1)],vt[this._idx(X,X)]=vt[this._idx(X-1,X-1)],N&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new RE(this)}get(l,d,y=!1){y&&(l=Gh(l,-1,this.dim),d=Gh(d,-1,this.dim));const M=4*this._idx(l,d);return(this.encoding==="terrarium"?iS:tS)(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}static getUnpackVector(l){return $E[l]}get unpackVector(){return $E[this.encoding]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}static pack(l,d){const y=[0,0,0,0],M=Xw.getUnpackVector(d);let N=Math.floor((l+M[3])/M[2]);return y[2]=N%256,N=Math.floor(N/256),y[1]=N%256,N=Math.floor(N/256),y[0]=N,y}getPixels(){return new Q_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(l,d,y){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let M=d*this.dim,N=d*this.dim+this.dim,X=y*this.dim,vt=y*this.dim+this.dim;switch(d){case-1:M=N-1;break;case 1:N=M+1}switch(y){case-1:X=vt-1;break;case 1:vt=X+1}const Ht=-d*this.dim,Ui=-y*this.dim;for(let Fn=X;Fn<vt;Fn++)for(let Js=M;Js<N;Js++){const nl=4*this._idx(Js,Fn),ju=4*this._idx(Js+Ht,Fn+Ui);this.pixels[nl+0]=l.pixels[ju+0],this.pixels[nl+1]=l.pixels[ju+1],this.pixels[nl+2]=l.pixels[ju+2],this.pixels[nl+3]=l.pixels[ju+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ip(Xw,"DEMData"),Ip(RE,"DemMinMaxQuadTree",{omit:["dem"]});class rS{constructor(l,d){this.max=l,this.onRemove=d,this.reset()}reset(){for(const l in this.data)for(const d of this.data[l])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(l,d,y){const M=l.wrapped().key;this.data[M]===void 0&&(this.data[M]=[]);const N={value:d,timeout:void 0};if(y!==void 0&&(N.timeout=setTimeout(()=>{this.remove(l,N)},y)),this.data[M].push(N),this.order.push(M),this.order.length>this.max){const X=this._getAndRemoveByKey(this.order[0]);X&&this.onRemove(X)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value}getByKey(l){const d=this.data[l];return d?d[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,d){if(!this.has(l))return this;const y=l.wrapped().key,M=d===void 0?0:this.data[y].indexOf(d),N=this.data[y][M];return this.data[y].splice(M,1),N.timeout&&clearTimeout(N.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(N.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(l){const d=[];for(const y in this.data)for(const M of this.data[y])l(M.value)||d.push(M);for(const y of d)this.remove(y.value.tileID,y)}}class cb{constructor(l,d,y){this.func=l,this.mask=d,this.range=y}}cb.ReadOnly=!1,cb.ReadWrite=!0,cb.disabled=new cb(519,cb.ReadOnly,[0,1]);const L2=7680;class R2{constructor(l,d,y,M,N,X){this.test=l,this.ref=d,this.mask=y,this.fail=M,this.depthFail=N,this.pass=X}}R2.disabled=new R2({func:519,mask:0},0,0,L2,L2,L2);class a1{constructor(l,d,y){this.blendFunction=l,this.blendColor=d,this.mask=y}}a1.Replace=[1,0],a1.disabled=new a1(a1.Replace,Np.transparent,[!1,!1,!1,!1]),a1.unblended=new a1(a1.Replace,Np.transparent,[!0,!0,!0,!0]),a1.alphaBlended=new a1([1,771],Np.transparent,[!0,!0,!0,!0]);const O2=1029,$2=2305;class Bv{constructor(l,d,y){this.enable=l,this.mode=d,this.frontFace=y}}Bv.disabled=new Bv(!1,O2,$2),Bv.backCCW=new Bv(!0,O2,$2),Bv.backCW=new Bv(!0,O2,2304),Bv.frontCW=new Bv(!0,1028,2304),Bv.frontCCW=new Bv(!0,1028,$2);class Dx extends om{constructor(l,d,y){super(),this.id=l,this._onlySymbols=y,d.on("data",M=>{M.dataType==="source"&&M.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new rS(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new eS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(l){this.map=l,this._minTileCacheSize=this._minTileCacheSize===void 0&&l?l._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&l?l._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles){const d=this._tiles[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,d){return l.isSymbolTile=this._onlySymbols,this._source.loadTile(l,d)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l,()=>{})}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Af(this._tiles).map(l=>l.tileID).sort(BE).map(l=>l.key)}getRenderableIds(l){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,l)&&d.push(this._tiles[y]);return l?d.sort((y,M)=>{const N=y.tileID,X=M.tileID,vt=new $s(N.canonical.x,N.canonical.y)._rotate(this.transform.angle),Ht=new $s(X.canonical.x,X.canonical.y)._rotate(this.transform.angle);return N.overscaledZ-X.overscaledZ||Ht.y-vt.y||Ht.x-vt.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(BE).map(y=>y.key)}hasRenderableParent(l){const d=this.findLoadedParent(l,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(l,d){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(d||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,d){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=d),this._loadTile(y,this._tileLoaded.bind(this,y,l,d)))}_tileLoaded(l,d,y,M){if(M)if(l.state="errored",M.status!==404)this._source.fire(new Vp(M,{tile:l}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const N=this.map.painter.terrain;this.update(this.transform,N.getScaledDemTileSize(),!0),N.resetTileLookupCache(this.id)}else this.update(this.transform);else l.timeAdded=mf.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new mp("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id}))}_backfillDEM(l){const d=this.getRenderableIds();for(let M=0;M<d.length;M++){const N=d[M];if(l.neighboringTiles&&l.neighboringTiles[N]){const X=this.getTileByID(N);y(l,X),y(X,l)}}function y(M,N){if(!M.dem||M.dem.borderReady)return;M.needsHillshadePrepare=!0,M.needsDEMTextureUpload=!0;let X=N.tileID.canonical.x-M.tileID.canonical.x;const vt=N.tileID.canonical.y-M.tileID.canonical.y,Ht=Math.pow(2,M.tileID.canonical.z),Ui=N.tileID.key;X===0&&vt===0||Math.abs(vt)>1||(Math.abs(X)>1&&(Math.abs(X+Ht)===1?X+=Ht:Math.abs(X-Ht)===1&&(X-=Ht)),N.dem&&M.dem&&(M.dem.backfillBorder(N.dem,X,vt),M.neighboringTiles&&M.neighboringTiles[Ui]&&(M.neighboringTiles[Ui].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,d,y,M){for(const N in this._tiles){let X=this._tiles[N];if(M[N]||!X.hasData()||X.tileID.overscaledZ<=d||X.tileID.overscaledZ>y)continue;let vt=X.tileID;for(;X&&X.tileID.overscaledZ>d+1;){const Ui=X.tileID.scaledTo(X.tileID.overscaledZ-1);X=this._tiles[Ui.key],X&&X.hasData()&&(vt=Ui)}let Ht=vt;for(;Ht.overscaledZ>d;)if(Ht=Ht.scaledTo(Ht.overscaledZ-1),l[Ht.key]){M[vt.key]=vt;break}}}findLoadedParent(l,d){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=l.overscaledZ-1;y>=d;y--){const M=l.scaledTo(y),N=this._getLoadedTile(M);if(N)return N}}_getLoadedTile(l){const d=this._tiles[l.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,d){d=d||this._source.tileSize;const y=Math.ceil(l.width/d)+1,M=Math.ceil(l.height/d)+1,N=Math.floor(y*M*5),X=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,N):N,vt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,X):X;this._cache.setMaxSize(vt)}handleWrapJump(l){const d=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,d){const y={};for(const M in this._tiles){const N=this._tiles[M];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+d),y[N.tileID.key]=N}this._tiles=y;for(const M in this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(const M in this._tiles)this._setTileReloadTimer(+M,this._tiles[M])}}update(l,d,y){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;let M;this.updateCacheSize(l,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?M=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(vt=>new S_(vt.canonical.z,vt.wrap,vt.canonical.z,vt.canonical.x,vt.canonical.y)):(M=l.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(M=M.filter(vt=>this._source.hasTile(vt)))):M=[];const N=this._updateRetainedTiles(M);if(NE(this._source.type)&&M.length!==0){const vt={},Ht={},Ui=Object.keys(N);for(const Js of Ui){const nl=N[Js],ju=this._tiles[Js];if(!ju||ju.fadeEndTime&&ju.fadeEndTime<=mf.now())continue;const Ku=this.findLoadedParent(nl,Math.max(nl.overscaledZ-Dx.maxOverzooming,this._source.minzoom));Ku&&(this._addTile(Ku.tileID),vt[Ku.tileID.key]=Ku.tileID),Ht[Js]=nl}const Fn=M[M.length-1].overscaledZ;for(const Js in this._tiles){const nl=this._tiles[Js];if(N[Js]||!nl.hasData())continue;let ju=nl.tileID;for(;ju.overscaledZ>Fn;){ju=ju.scaledTo(ju.overscaledZ-1);const Ku=this._tiles[ju.key];if(Ku&&Ku.hasData()&&Ht[ju.key]){N[Js]=nl.tileID;break}}}for(const Js in vt)N[Js]||(this._coveredTiles[Js]=!0,N[Js]=vt[Js])}for(const vt in N)this._tiles[vt].clearFadeHold();const X=function(vt,Ht){const Ui=[];for(const Fn in vt)Fn in Ht||Ui.push(Fn);return Ui}(this._tiles,N);for(const vt of X){const Ht=this._tiles[vt];Ht.hasSymbolBuckets&&!Ht.holdingForFade()?Ht.setHoldDuration(this.map._fadeDuration):Ht.hasSymbolBuckets&&!Ht.symbolFadeFinished()||this._removeTile(+vt)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const d={};if(l.length===0)return d;const y={},M=l.reduce((Ui,Fn)=>Math.min(Ui,Fn.overscaledZ),1/0),N=l[0].overscaledZ,X=Math.max(N-Dx.maxOverzooming,this._source.minzoom),vt=Math.max(N+Dx.maxUnderzooming,this._source.minzoom),Ht={};for(const Ui of l){const Fn=this._addTile(Ui);d[Ui.key]=Ui,Fn.hasData()||M<this._source.maxzoom&&(Ht[Ui.key]=Ui)}this._retainLoadedChildren(Ht,M,vt,d);for(const Ui of l){let Fn=this._tiles[Ui.key];if(Fn.hasData())continue;if(Ui.canonical.z>=this._source.maxzoom){const nl=Ui.children(this._source.maxzoom)[0],ju=this.getTile(nl);if(ju&&ju.hasData()){d[nl.key]=nl;continue}}else{const nl=Ui.children(this._source.maxzoom);if(d[nl[0].key]&&d[nl[1].key]&&d[nl[2].key]&&d[nl[3].key])continue}let Js=Fn.wasRequested();for(let nl=Ui.overscaledZ-1;nl>=X;--nl){const ju=Ui.scaledTo(nl);if(y[ju.key]||(y[ju.key]=!0,Fn=this.getTile(ju),!Fn&&Js&&(Fn=this._addTile(ju)),Fn&&(d[ju.key]=ju,Js=Fn.wasRequested(),Fn.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const d=[];let y,M=this._tiles[l].tileID;for(;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){y=this._loadedParentTiles[M.key];break}d.push(M.key);const N=M.scaledTo(M.overscaledZ-1);if(y=this._getLoadedTile(N),y)break;M=N}for(const N of d)this._loadedParentTiles[N]=y}}_addTile(l){let d=this._tiles[l.key];if(d)return d;d=this._cache.getAndRemove(l),d&&(this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,d)));const y=!!d;if(!y){const M=this.map?this.map.painter:null;d=new D2(l,this._source.tileSize*l.overscaleFactor(),this.transform.tileZoom,M,this._isRaster),this._loadTile(d,this._tileLoaded.bind(this,d,l.key,d.state))}return d?(d.uses++,this._tiles[l.key]=d,y||this._source.fire(new mp("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null}_setTileReloadTimer(l,d){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=d.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const d=this._tiles[l];d&&(d.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(l,d,y){const M=[],N=this.transform;if(!N)return M;const X=N.projection.name==="globe",vt=P0(N.center.lng);for(const Ht in this._tiles){const Ui=this._tiles[Ht];if(y&&Ui.clearQueryDebugViz(),Ui.holdingForFade())continue;let Fn;if(X){const Js=Ui.tileID.canonical;if(Js.z===0){const nl=[Math.abs(Gh(vt,...Kb(Js,-1))-vt),Math.abs(Gh(vt,...Kb(Js,1))-vt)];Fn=[0,2*nl.indexOf(Math.min(...nl))-1]}else{const nl=[Math.abs(Gh(vt,...Kb(Js,-1))-vt),Math.abs(Gh(vt,...Kb(Js,0))-vt),Math.abs(Gh(vt,...Kb(Js,1))-vt)];Fn=[nl.indexOf(Math.min(...nl))-1]}}else Fn=[0];for(const Js of Fn){const nl=l.containsTile(Ui,N,d,Js);nl&&M.push(nl)}}return M}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(NE(this._source.type))for(const l in this._tiles){const d=this._tiles[l];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=mf.now())return!0}return!1}setFeatureState(l,d,y){this._state.updateState(l=l||"_geojsonTileLayer",d,y)}removeFeatureState(l,d,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",d,y)}getFeatureState(l,d){return this._state.getState(l=l||"_geojsonTileLayer",d)}setDependencies(l,d,y){const M=this._tiles[l];M&&M.setDependencies(d,y)}reloadTilesForDependencies(l,d){for(const y in this._tiles)this._tiles[y].hasDependency(l,d)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(l,d))}_preloadTiles(l,d){const y=new Map,M=Array.isArray(l)?l:[l],N=this.map.painter.terrain,X=this.usedForTerrain&&N?N.getScaledDemTileSize():this._source.tileSize;for(const vt of M){const Ht=vt.coveringTiles({tileSize:X,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Ui of Ht)y.set(Ui.key,Ui);this.usedForTerrain&&vt.updateElevation(!1)}Kd(Array.from(y.values()),(vt,Ht)=>{const Ui=new D2(vt,this._source.tileSize*vt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Ui,Fn=>{this._source.type==="raster-dem"&&Ui.dem&&this._backfillDEM(Ui),Ht(Fn,Ui)})},d)}}function BE(c,l){const d=Math.abs(2*c.wrap)-+(c.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return c.overscaledZ-l.overscaledZ||y-d||l.canonical.y-c.canonical.y||l.canonical.x-c.canonical.x}function NE(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function Kb(c,l){const d=1<<c.z;return[c.x/d+l,(c.x+1)/d+l]}Dx.maxOverzooming=10,Dx.maxUnderzooming=3;class Ww{constructor(l,d,y){this._demTile=l,this._dem=this._demTile.dem,this._scale=d,this._offset=y}static create(l,d,y){const M=y||l.findDEMTileFor(d);if(!M||!M.dem)return;const N=M.dem,X=M.tileID,vt=1<<d.canonical.z-X.canonical.z;return new Ww(M,M.tileSize/Hp/vt,[(d.canonical.x/vt-X.canonical.x)*N.dim,(d.canonical.y/vt-X.canonical.y)*N.dim])}tileCoordToPixel(l,d){const y=d*this._scale+this._offset[1],M=Math.floor(l*this._scale+this._offset[0]),N=Math.floor(y);return new $s(M,N)}getElevationAt(l,d,y,M){const N=l*this._scale+this._offset[0],X=d*this._scale+this._offset[1],vt=Math.floor(N),Ht=Math.floor(X),Ui=this._dem;return M=!!M,y?Kp(Kp(Ui.get(vt,Ht,M),Ui.get(vt,Ht+1,M),X-Ht),Kp(Ui.get(vt+1,Ht,M),Ui.get(vt+1,Ht+1,M),X-Ht),N-vt):Ui.get(vt,Ht,M)}getElevationAtPixel(l,d,y){return this._dem.get(l,d,!!y)}getMeterToDEM(l){return(1<<this._demTile.tileID.canonical.z)*Jy(1,l)*this._dem.stride}}class zE{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Sy(Hp,16,0),this.featureIndexArray=new pb,this.promoteId=d}insert(l,d,y,M,N,X=0){const vt=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(y,M,N,X);const Ht=this.grid;for(let Ui=0;Ui<d.length;Ui++){const Fn=d[Ui],Js=[1/0,1/0,-1/0,-1/0];for(let nl=0;nl<Fn.length;nl++){const ju=Fn[nl];Js[0]=Math.min(Js[0],ju.x),Js[1]=Math.min(Js[1],ju.y),Js[2]=Math.max(Js[2],ju.x),Js[3]=Math.max(Js[3],ju.y)}Js[0]<Hp&&Js[1]<Hp&&Js[2]>=0&&Js[3]>=0&&Ht.insert(vt,Js[0],Js[1],Js[2],Js[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new B_(new Gb(this.rawTileData)).layers,this.sourceLayerCoder=new TE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const l in this.vtLayers)this.vtFeatures[l]=[]}return this.vtLayers}query(l,d,y,M){this.loadVTLayers();const N=l.params||{},X=v0(N.filter),vt=l.tileResult,Ht=l.transform,Ui=vt.bufferedTilespaceBounds,Fn=this.grid.query(Ui.min.x,Ui.min.y,Ui.max.x,Ui.max.y,(Ku,lh,Eh,Bh)=>Lb(vt.bufferedTilespaceGeometry,Ku,lh,Eh,Bh));Fn.sort(nS);let Js=null;Ht.elevation&&Fn.length>0&&(Js=Ww.create(Ht.elevation,this.tileID));const nl={};let ju;for(let Ku=0;Ku<Fn.length;Ku++){const lh=Fn[Ku];if(lh===ju)continue;ju=lh;const Eh=this.featureIndexArray.get(lh);let Bh=null;this.loadMatchingFeature(nl,Eh,X,N.layers,N.availableImages,d,y,M,(Yh,kh,Vh,rd=0)=>(Bh||(Bh=Rv(Yh,this.tileID.canonical,l.tileTransform)),kh.queryIntersectsFeature(vt,Yh,Vh,Bh,this.z,l.transform,l.pixelPosMatrix,Js,rd)))}return nl}loadMatchingFeature(l,d,y,M,N,X,vt,Ht,Ui){const{featureIndex:Fn,bucketIndex:Js,sourceLayerIndex:nl,layoutVertexArrayOffset:ju}=d,Ku=this.bucketLayerIDs[Js];if(M&&!function(Yh,kh){for(let Vh=0;Vh<Yh.length;Vh++)if(kh.indexOf(Yh[Vh])>=0)return!0;return!1}(M,Ku))return;const lh=this.sourceLayerCoder.decode(nl),Eh=this.vtLayers[lh].feature(Fn);if(y.needGeometry){const Yh=Ov(Eh,!0);if(!y.filter(new ld(this.tileID.overscaledZ),Yh,this.tileID.canonical))return}else if(!y.filter(new ld(this.tileID.overscaledZ),Eh))return;const Bh=this.getId(Eh,lh);for(let Yh=0;Yh<Ku.length;Yh++){const kh=Ku[Yh];if(M&&M.indexOf(kh)<0)continue;const Vh=X[kh];if(!Vh)continue;let rd={};Bh!==void 0&&Ht&&(rd=Ht.getState(Vh.sourceLayer||"_geojsonTileLayer",Bh));const ed=md({},vt[kh]);ed.paint=FE(ed.paint,Vh.paint,Eh,rd,N),ed.layout=FE(ed.layout,Vh.layout,Eh,rd,N);const Rd=!Ui||Ui(Eh,Vh,rd,ju);if(!Rd)continue;const kd=new SE(Eh,this.z,this.x,this.y,Bh);kd.layer=ed;let Sf=l[kh];Sf===void 0&&(Sf=l[kh]=[]),Sf.push({featureIndex:Fn,feature:kd,intersectionZ:Rd})}}lookupSymbolFeatures(l,d,y,M,N,X,vt,Ht){const Ui={};this.loadVTLayers();const Fn=v0(N);for(const Js of l)this.loadMatchingFeature(Ui,{bucketIndex:y,sourceLayerIndex:M,featureIndex:Js,layoutVertexArrayOffset:0},Fn,X,vt,Ht,d);return Ui}loadFeature(l){const{featureIndex:d,sourceLayerIndex:y}=l;this.loadVTLayers();const M=this.sourceLayerCoder.decode(y),N=this.vtFeatures[M];if(N[d])return N[d];const X=this.vtLayers[M].feature(d);return N[d]=X,X}hasLayer(l){for(const d of this.bucketLayerIDs)for(const y of d)if(l===y)return!0;return!1}getId(l,d){let y=l.id;if(this.promoteId){const M=typeof this.promoteId=="string"?this.promoteId:this.promoteId[d];M!=null&&(y=l.properties[M]),typeof y=="boolean"&&(y=Number(y))}return y}}function FE(c,l,d,y,M){return bf(c,(N,X)=>{const vt=l instanceof Cd?l.get(X):null;return vt&&vt.evaluate?vt.evaluate(d,y,M):vt})}function nS(c,l){return l-c}Ip(zE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class UE{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.image=new $v({width:l,height:d}),this.positions={},this.uploaded=!1}getDash(l,d){const y=this.getKey(l,d);return this.positions[y]}trim(){const l=this.width,d=this.height=Sd(this.nextRow);this.image.resize({width:l,height:d})}getKey(l,d){return l.join(",")+d}getDashRanges(l,d,y){const M=[];let N=l.length%2==1?-l[l.length-1]*y:0,X=l[0]*y,vt=!0;M.push({left:N,right:X,isDash:vt,zeroLength:l[0]===0});let Ht=l[0];for(let Ui=1;Ui<l.length;Ui++){vt=!vt;const Fn=l[Ui];N=Ht*y,Ht+=Fn,X=Ht*y,M.push({left:N,right:X,isDash:vt,zeroLength:Fn===0})}return M}addRoundDash(l,d,y){const M=d/2;for(let N=-y;N<=y;N++){const X=this.width*(this.nextRow+y+N);let vt=0,Ht=l[vt];for(let Ui=0;Ui<this.width;Ui++){Ui/Ht.right>1&&(Ht=l[++vt]);const Fn=Math.abs(Ui-Ht.left),Js=Math.abs(Ui-Ht.right),nl=Math.min(Fn,Js);let ju;const Ku=N/y*(M+1);if(Ht.isDash){const lh=M-Math.abs(Ku);ju=Math.sqrt(nl*nl+lh*lh)}else ju=M-Math.sqrt(nl*nl+Ku*Ku);this.image.data[X+Ui]=Math.max(0,Math.min(255,ju+128))}}}addRegularDash(l,d){for(let Ht=l.length-1;Ht>=0;--Ht){const Ui=l[Ht],Fn=l[Ht+1];Ui.zeroLength?l.splice(Ht,1):Fn&&Fn.isDash===Ui.isDash&&(Fn.left=Ui.left,l.splice(Ht,1))}const y=l[0],M=l[l.length-1];y.isDash===M.isDash&&(y.left=M.left-this.width,M.right=y.right+this.width);const N=this.width*this.nextRow;let X=0,vt=l[X];for(let Ht=0;Ht<this.width;Ht++){Ht/vt.right>1&&(vt=l[++X]);const Ui=Math.abs(Ht-vt.left),Fn=Math.abs(Ht-vt.right),Js=Math.min(Ui,Fn);this.image.data[N+Ht]=Math.max(0,Math.min(255,(vt.isDash?Js:-Js)+d+128))}}addDash(l,d){const y=this.getKey(l,d);if(this.positions[y])return this.positions[y];const M=d==="round",N=M?7:0,X=2*N+1;if(this.nextRow+X>this.height)return rp("LineAtlas out of space"),null;l.length===0&&l.push(1);let vt=0;for(let Fn=0;Fn<l.length;Fn++)l[Fn]<0&&(rp("Negative value is found in line dasharray, replacing values with 0"),l[Fn]=0),vt+=l[Fn];if(vt!==0){const Fn=this.width/vt,Js=this.getDashRanges(l,this.width,Fn);M?this.addRoundDash(Js,Fn,N):this.addRegularDash(Js,d==="square"?.5*Fn:0)}const Ht=this.nextRow+N;this.nextRow+=X;const Ui={tl:[Ht,N],br:[vt,0]};return this.positions[y]=Ui,Ui}}Ip(UE,"LineAtlas");class VE{constructor(l){const d={},y=[];for(const vt in l){const Ht=l[vt],Ui=d[vt]={};for(const Fn in Ht.glyphs){const Js=Ht.glyphs[+Fn];if(!Js||Js.bitmap.width===0||Js.bitmap.height===0)continue;const nl=Js.metrics.localGlyph?2:1,ju={x:0,y:0,w:Js.bitmap.width+2*nl,h:Js.bitmap.height+2*nl};y.push(ju),Ui[Fn]=ju}}const{w:M,h:N}=x2(y),X=new $v({width:M||1,height:N||1});for(const vt in l){const Ht=l[vt];for(const Ui in Ht.glyphs){const Fn=Ht.glyphs[+Ui];if(!Fn||Fn.bitmap.width===0||Fn.bitmap.height===0)continue;const Js=d[vt][Ui],nl=Fn.metrics.localGlyph?2:1;$v.copy(Fn.bitmap,X,{x:0,y:0},{x:Js.x+nl,y:Js.y+nl},Fn.bitmap)}}this.image=X,this.positions=d}}Ip(VE,"GlyphAtlas");class oS{constructor(l){this.tileID=new S_(l.tileID.overscaledZ,l.tileID.wrap,l.tileID.canonical.z,l.tileID.canonical.x,l.tileID.canonical.y),this.tileZoom=l.tileZoom,this.uid=l.uid,this.zoom=l.zoom,this.canonical=l.tileID.canonical,this.pixelRatio=l.pixelRatio,this.tileSize=l.tileSize,this.source=l.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=l.showCollisionBoxes,this.collectResourceTiming=!!l.collectResourceTiming,this.returnDependencies=!!l.returnDependencies,this.promoteId=l.promoteId,this.enableTerrain=!!l.enableTerrain,this.isSymbolTile=l.isSymbolTile,this.tileTransform=kx(l.tileID.canonical,l.projection),this.projection=l.projection}parse(l,d,y,M,N){this.status="parsing",this.data=l,this.collisionBoxArray=new hb;const X=new TE(Object.keys(l.layers).sort()),vt=new zE(this.tileID,this.promoteId);vt.bucketLayerIDs=[];const Ht={},Ui=new UE(256,256),Fn={featureIndex:vt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ui,availableImages:y},Js=d.familiesBySource[this.source];for(const rd in Js){const ed=l.layers[rd];if(!ed)continue;let Rd=!1,kd=!1;for(const jd of Js[rd])jd[0].type==="symbol"?Rd=!0:kd=!0;if(this.isSymbolTile===!0&&!Rd||this.isSymbolTile===!1&&!kd)continue;ed.version===1&&rp(`Vector tile source "${this.source}" layer "${rd}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sf=X.encode(rd),Zf=[];for(let jd=0;jd<ed.length;jd++){const Pf=ed.feature(jd),Rf=vt.getId(Pf,rd);Zf.push({feature:Pf,id:Rf,index:jd,sourceLayerIndex:Sf})}for(const jd of Js[rd]){const Pf=jd[0];this.isSymbolTile!==void 0&&Pf.type==="symbol"!==this.isSymbolTile||Pf.minzoom&&this.zoom<Math.floor(Pf.minzoom)||Pf.maxzoom&&this.zoom>=Pf.maxzoom||Pf.visibility!=="none"&&(B2(jd,this.zoom,y),(Ht[Pf.id]=Pf.createBucket({index:vt.bucketLayerIDs.length,layers:jd,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sf,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:y})).populate(Zf,Fn,this.tileID.canonical,this.tileTransform),vt.bucketLayerIDs.push(jd.map(Rf=>Rf.id)))}}let nl,ju,Ku,lh;Ui.trim();const Eh={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Bh=bf(Fn.glyphDependencies,rd=>Object.keys(rd).map(Number));Object.keys(Bh).length?M.send("getGlyphs",{uid:this.uid,stacks:Bh},(rd,ed)=>{nl||(nl=rd,ju=ed,Vh.call(this))},void 0,!1,Eh):ju={};const Yh=Object.keys(Fn.iconDependencies);Yh.length?M.send("getImages",{icons:Yh,source:this.source,tileID:this.tileID,type:"icons"},(rd,ed)=>{nl||(nl=rd,Ku=ed,Vh.call(this))},void 0,!1,Eh):Ku={};const kh=Object.keys(Fn.patternDependencies);function Vh(){if(nl)return N(nl);if(ju&&Ku&&lh){const rd=new VE(ju),ed=new K2(Ku,lh);for(const Rd in Ht){const kd=Ht[Rd];kd instanceof tx?(B2(kd.layers,this.zoom,y),kT(kd,ju,rd.positions,Ku,ed.iconPositions,this.showCollisionBoxes,y,this.tileID.canonical,this.tileZoom,this.projection)):kd.hasPattern&&(kd instanceof A1||kd instanceof gp||kd instanceof ty)&&(B2(kd.layers,this.zoom,y),kd.addFeatures(Fn,this.tileID.canonical,ed.patternPositions,y,this.tileTransform))}this.status="done",N(null,{buckets:Af(Ht).filter(Rd=>!Rd.isEmpty()),featureIndex:vt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:rd.image,lineAtlas:Ui,imageAtlas:ed,glyphMap:this.returnDependencies?ju:null,iconMap:this.returnDependencies?Ku:null,glyphPositions:this.returnDependencies?rd.positions:null})}}kh.length?M.send("getImages",{icons:kh,source:this.source,tileID:this.tileID,type:"patterns"},(rd,ed)=>{nl||(nl=rd,lh=ed,Vh.call(this))},void 0,!1,Eh):lh={},Vh.call(this)}}function B2(c,l,d){const y=new ld(l);for(const M of c)M.recalculate(y,d)}class GE{constructor(l){this.entries={},this.scheduler=l}request(l,d,y,M){const N=this.entries[l]=this.entries[l]||{callbacks:[]};if(N.result){const[X,vt]=N.result;return this.scheduler?this.scheduler.add(()=>{M(X,vt)},d):M(X,vt),()=>{}}return N.callbacks.push(M),N.cancel||(N.cancel=y((X,vt)=>{N.result=[X,vt];for(const Ht of N.callbacks)this.scheduler?this.scheduler.add(()=>{Ht(X,vt)},d):Ht(X,vt);setTimeout(()=>delete this.entries[l],3e3)})),()=>{N.result||(N.callbacks=N.callbacks.filter(X=>X!==M),N.callbacks.length||(N.cancel(),delete this.entries[l]))}}}function jE(c,l,d){const y=JSON.stringify(c.request);return c.data&&(this.deduped.entries[y]={result:[null,c.data]}),this.deduped.request(y,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},M=>{const N=Yf(c.request,(X,vt,Ht,Ui)=>{X?M(X):vt&&M(null,{vectorTile:d?void 0:new B_(new Gb(vt)),rawData:vt,cacheControl:Ht,expires:Ui})});return()=>{N.cancel(),M()}},l)}o.ARRAY_TYPE=Ay,o.AUTH_ERR_MSG=Sm,o.Aabb=Yg,o.Actor=class{constructor(c,l,d){this.target=c,this.parent=l,this.mapId=d,this.callbacks={},this.cancelCallbacks={},Md(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Jd()?c:x,this.scheduler=new QT}send(c,l,d,y,M=!1,N){const X=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=N,this.callbacks[X]=d);const vt=fp(this.globalScope)?void 0:[];return this.target.postMessage({id:X,type:c,hasCallback:!!d,targetMapId:y,mustQueue:M,sourceMapId:this.mapId,data:he(l,vt)},vt),{cancel:()=>{d&&delete this.callbacks[X],this.target.postMessage({id:X,type:"<cancel>",targetMapId:y,sourceMapId:this.mapId})}}}receive(c){const l=c.data,d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const y=this.cancelCallbacks[d];delete this.cancelCallbacks[d],y&&y.cancel()}else if(l.mustQueue||Jd()){const y=this.callbacks[d];this.cancelCallbacks[d]=this.scheduler.add(()=>this.processTask(d,l),y&&y.metadata||{type:"message"})}else this.processTask(d,l)}processTask(c,l){if(l.type==="<response>"){const d=this.callbacks[c];delete this.callbacks[c],d&&(l.error?d(g(l.error)):d(null,g(l.data)))}else{const d=fp(this.globalScope)?void 0:[],y=l.hasCallback?(N,X)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:N?he(N):null,data:he(X,d)},d)}:N=>{},M=g(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,M,y);else if(this.parent.getWorkerSource){const N=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,N[0],M.source)[N[1]](M,y)}else y(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=D0,o.Color=Np,o.ColorMode=a1,o.CullFaceMode=Bv,o.DEMData=Xw,o.DataConstantProperty=pd,o.DedupedRequest=GE,o.DepthMode=cb,o.EXTENT=Hp,o.Elevation=class{isDataAvailableAtPoint(c){const l=this._source();if(this.isUsingMockSource()||!l||c.y<0||c.y>1)return!1;const d=l.getSource().maxzoom,y=1<<d,M=Math.floor(c.x),N=Math.floor((c.x-M)*y),X=Math.floor(c.y*y),vt=this.findDEMTileFor(new S_(d,M,d,N,X));return!(!vt||!vt.dem)}getAtPointOrZero(c,l=0){return this.getAtPoint(c,l)||0}getAtPoint(c,l,d=!0){if(this.isUsingMockSource())return null;l==null&&(l=null);const y=this._source();if(!y||c.y<0||c.y>1)return l;const M=y.getSource().maxzoom,N=1<<M,X=Math.floor(c.x),vt=c.x-X,Ht=new S_(M,X,M,Math.floor(vt*N),Math.floor(c.y*N)),Ui=this.findDEMTileFor(Ht);if(!Ui||!Ui.dem)return l;const Fn=Ui.dem,Js=1<<Ui.tileID.canonical.z,nl=(vt*Js-Ui.tileID.canonical.x)*Fn.dim,ju=(c.y*Js-Ui.tileID.canonical.y)*Fn.dim,Ku=Math.floor(nl),lh=Math.floor(ju);return(d?this.exaggeration():1)*Kp(Kp(Fn.get(Ku,lh),Fn.get(Ku,lh+1),ju-lh),Kp(Fn.get(Ku+1,lh),Fn.get(Ku+1,lh+1),ju-lh),nl-Ku)}getAtTileOffset(c,l,d){const y=1<<c.canonical.z;return this.getAtPointOrZero(new Z1(c.wrap+(c.canonical.x+l/Hp)/y,(c.canonical.y+d/Hp)/y))}getAtTileOffsetFunc(c,l,d,y){return M=>{const N=this.getAtTileOffset(c,M.x,M.y),X=y.upVector(c.canonical,M.x,M.y);return hy(X,X,N*y.upVectorScale(c.canonical,l,d).metersToTile),X}}getForTilePoints(c,l,d,y){if(this.isUsingMockSource())return!1;const M=Ww.create(this,c,y);return!!M&&(l.forEach(N=>{N[2]=this.exaggeration()*M.getElevationAt(N[0],N[1],d)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const l=this.findDEMTileFor(c);if(!l||!l.dem)return null;const d=l.dem.tree,y=l.tileID,M=1<<c.canonical.z-y.canonical.z;let N=c.canonical.x/M-y.canonical.x,X=c.canonical.y/M-y.canonical.y,vt=0;for(let Ht=0;Ht<c.canonical.z-y.canonical.z&&!d.leaves[vt];Ht++){N*=2,X*=2;const Ui=2*Math.floor(X)+Math.floor(N);vt=d.childOffsets[vt]+Ui,N%=1,X%=1}return{min:this.exaggeration()*d.minimums[vt],max:this.exaggeration()*d.maximums[vt]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,l,d){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Vp,o.EvaluationParameters=ld,o.Event=mp,o.Evented=om,o.FillExtrusionBucket=ty,o.Frustum=y1,o.FrustumCorners=V1,o.GLOBE_RADIUS=Yy,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const c of this._wireframeSegments)c.destroy()}}_fillGridMeshWithLods(c,l){const d=new zp,y=new y_,M=[],N=c+1+2,X=l[0]+1,vt=l[0]+1+(1+l.length),Ht=(Ui,Fn,Js)=>{let nl=Ui===N-1?Ui-2:Ui===0?Ui:Ui-1;return nl+=Js?24575:0,[nl,Fn]};for(let Ui=0;Ui<N;++Ui)d.emplaceBack(...Ht(Ui,0,!0));for(let Ui=0;Ui<X;++Ui)for(let Fn=0;Fn<N;++Fn)d.emplaceBack(...Ht(Fn,Ui,(Fn===0||Fn===N-1)&&!0));for(let Ui=0;Ui<l.length;++Ui){const Fn=l[Ui];for(let Js=0;Js<N;++Js)d.emplaceBack(...Ht(Js,Fn,!0))}for(let Ui=0;Ui<l.length;++Ui){const Fn=y.length,Js=l[Ui]+1+2,nl=new y_;for(let lh=0;lh<Js-1;lh++){const Eh=lh===Js-2,Bh=Eh?N*(vt-l.length+Ui-lh):N;for(let Yh=0;Yh<N-1;Yh++){const kh=lh*N+Yh;lh===0||Eh||Yh===0||Yh===N-2?(nl.emplaceBack(kh+1,kh,kh+Bh),nl.emplaceBack(kh+Bh,kh+Bh+1,kh+1)):(y.emplaceBack(kh+1,kh,kh+Bh),y.emplaceBack(kh+Bh,kh+Bh+1,kh+1))}}const ju=Og.simpleSegment(0,Fn,d.length,y.length-Fn);for(let lh=0;lh<nl.uint16.length;lh+=3)y.emplaceBack(nl.uint16[lh],nl.uint16[lh+1],nl.uint16[lh+2]);const Ku=Og.simpleSegment(0,Fn,d.length,y.length-Fn);M.push({withoutSkirts:ju,withSkirts:Ku})}return{vertices:d,indices:y,segments:M}}_createGrid(c){const l=this._fillGridMeshWithLods(fv,gx);this._gridSegments=l.segments,this._gridBuffer=c.createVertexBuffer(l.vertices,_1.members),this._gridIndexBuffer=c.createIndexBuffer(l.indices,!0)}_createPoles(c){const l=new y_;for(let M=0;M<=fv;M++)l.emplaceBack(0,M+1,M+2);this._poleIndexBuffer=c.createIndexBuffer(l,!0);const d=new My,y=new My;this._poleSegments=[];for(let M=0,N=0;M<5;M++){const X=360/(1<<M);d.emplaceBack(0,-Yy,0,.5,0),y.emplaceBack(0,-Yy,0,.5,1);for(let vt=0;vt<=fv;vt++){const Ht=vt/fv,Ui=Kp(0,X,Ht),[Fn,Js,nl]=x1(Kx,s2,Ui,Yy);d.emplaceBack(Fn,Js,nl,Ht,0),y.emplaceBack(Fn,Js,nl,Ht,1)}this._poleSegments.push(Og.simpleSegment(N,0,66,64)),N+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(d,gw,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(y,gw,!1)}getGridBuffers(c,l){return[this._gridBuffer,this._gridIndexBuffer,l?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}getWirefameBuffers(c,l){if(!this._wireframeSegments){const d=new dv,y=fv,M=y+1+2,N=1;this._wireframeSegments=[];for(let X=0,vt=0;X<gx.length;X++){const Ht=gx[X];for(let Fn=N;Fn<Ht+N;Fn++)for(let Js=N;Js<y+N;Js++){const nl=Fn*M+Js;d.emplaceBack(nl,nl+1),d.emplaceBack(nl,nl+M),d.emplaceBack(nl,nl+M+1)}const Ui=Ht*y*3;this._wireframeSegments.push(Og.simpleSegment(0,vt,(Ht+1)*M,Ui)),vt+=Ui}this._wireframeIndexBuffer=c.createIndexBuffer(d)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[l]]}},o.GlyphManager=ab,o.ImagePosition=b2,o.LivePerformanceUtils=zh,o.LngLat=Tm,o.LngLatBounds=Qv,o.LocalGlyphMode=T2,o.MAX_MERCATOR_LATITUDE=o_,o.MercatorCoordinate=Z1,o.ONE_EM=ny,o.OverscaledTileID=S_,o.PerformanceMarkers=Ph,o.Properties=$f,o.RGBAImage=Q_,o.Ray=Hx,o.RequestManager=class{constructor(c,l,d){this._transformRequestFn=c,this._customAccessToken=l,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const c=function(){let l="";for(let d=0;d<10;d++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",rl,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,l){return this._transformRequestFn&&this._transformRequestFn(c,l)||{url:c}}normalizeStyleURL(c,l){if(!hp(c))return c;const d=mh(c);return d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeGlyphsURL(c,l){if(!hp(c))return c;const d=mh(c);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeSourceURL(c,l,d,y){if(!hp(c))return c;const M=mh(c);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),d&&M.params.push(`language=${d}`),y&&M.params.push(`worldview=${y}`),this._makeAPIURL(M,this._customAccessToken||l)}normalizeSpriteURL(c,l,d,y){const M=mh(c);return hp(c)?(M.path=`/styles/v1${M.path}/sprite${l}${d}`,this._makeAPIURL(M,this._customAccessToken||y)):(M.path+=`${l}${d}`,Jh(M))}normalizeTileURL(c,l,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!hp(c))return c;const y=mh(c);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||d&&y.authority!=="raster"&&d===512?"@2x":""}${ze.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${Y.RASTER_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${Y.TILE_URL_VERSION}${y.path}`);const M=this._customAccessToken||function(N){for(const X of N){const vt=X.match(/^access_token=(.*)$/);if(vt)return vt[1]}return null}(y.params)||Y.ACCESS_TOKEN;return Y.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,M)}canonicalizeTileURL(c,l){const d=mh(c);if(!d.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!d.path.match(/\.[\w]+$/))return c;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${Y.RASTER_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${Y.TILE_URL_VERSION}/`,"")}`;let M=d.params;return l&&(M=M.filter(N=>!N.match(/^access_token=/))),M.length&&(y+=`?${M.join("&")}`),y}canonicalizeTileset(c,l){const d=!!l&&hp(l),y=[];for(const M of c.tiles||[])Em(M)?y.push(this.canonicalizeTileURL(M,d)):y.push(M);return y}_makeAPIURL(c,l){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=mh(Y.API_URL);if(c.protocol=y.protocol,c.authority=y.authority,c.protocol==="http"){const M=c.params.indexOf("secure");M>=0&&c.params.splice(M,1)}if(y.path!=="/"&&(c.path=`${y.path}${c.path}`),!Y.REQUIRE_ACCESS_TOKEN)return Jh(c);if(l=l||Y.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return c.params=c.params.filter(M=>M.indexOf("access_token")===-1),c.params.push(`access_token=${l||""}`),Jh(c)}},o.ResourceType=Wf,o.SegmentVector=Og,o.SourceCache=Dx,o.StencilMode=R2,o.StructArrayLayout1ui2=I0,o.StructArrayLayout2f1f2i16=n_,o.StructArrayLayout2i4=zp,o.StructArrayLayout2ui4=dv,o.StructArrayLayout3f12=jg,o.StructArrayLayout3ui6=y_,o.StructArrayLayout4i8=Am,o.StructArrayLayout5f20=My,o.Texture=Yb,o.Tile=D2,o.Transitionable=Vf,o.Uniform1f=zx,o.Uniform1i=class extends Av{constructor(c){super(c),this.current=0}set(c,l,d){this.fetchUniformLocation(c,l)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}},o.Uniform2f=class extends Av{constructor(c){super(c),this.current=[0,0]}set(c,l,d){this.fetchUniformLocation(c,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}},o.Uniform3f=class extends Av{constructor(c){super(c),this.current=[0,0,0]}set(c,l,d){this.fetchUniformLocation(c,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}},o.Uniform4f=iw,o.UniformColor=rw,o.UniformMatrix2f=class extends Av{constructor(c){super(c),this.current=nw}set(c,l,d){if(this.fetchUniformLocation(c,l)){for(let y=0;y<4;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}},o.UniformMatrix3f=class extends Av{constructor(c){super(c),this.current=Qw}set(c,l,d){if(this.fetchUniformLocation(c,l)){for(let y=0;y<9;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix3fv(this.location,!1,d);break}}}},o.UniformMatrix4f=class extends Av{constructor(c){super(c),this.current=Wv}set(c,l,d){if(this.fetchUniformLocation(c,l)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let y=1;y<16;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}},o.UnwrappedTileID=Ub,o.ValidationError=pp,o.VectorTileFeature=b_,o.VectorTileWorkerSource=class extends om{constructor(c,l,d,y,M){super(),this.actor=c,this.layerIndex=l,this.availableImages=d,this.loadVectorData=M||jE,this.loading={},this.loaded={},this.deduped=new GE(c.scheduler),this.isSpriteLoaded=y,this.scheduler=c.scheduler}loadTile(c,l){const d=c.uid,y=c&&c.request,M=y&&y.collectResourceTiming,N=this.loading[d]=new oS(c);N.abort=this.loadVectorData(c,(X,vt)=>{const Ht=!this.loading[d];if(delete this.loading[d],Ht||X||!vt)return N.status="done",Ht||(this.loaded[d]=N),l(X);const Ui=vt.rawData,Fn={};vt.expires&&(Fn.expires=vt.expires),vt.cacheControl&&(Fn.cacheControl=vt.cacheControl),N.vectorTile=vt.vectorTile||new B_(new Gb(Ui));const Js=()=>{N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,(nl,ju)=>{if(nl||!ju)return l(nl);const Ku={};if(M){const lh=Qd(y);lh.length>0&&(Ku.resourceTiming=JSON.parse(JSON.stringify(lh)))}l(null,md({rawTileData:Ui.slice(0)},ju,Fn,Ku))})};this.isSpriteLoaded?Js():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Js,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):Js()}),this.loaded=this.loaded||{},this.loaded[d]=N})}reloadTile(c,l){const d=this.loaded,y=c.uid,M=this;if(d&&d[y]){const N=d[y];N.showCollisionBoxes=c.showCollisionBoxes,N.enableTerrain=!!c.enableTerrain,N.projection=c.projection,N.tileTransform=kx(c.tileID.canonical,c.projection);const X=(vt,Ht)=>{const Ui=N.reloadCallback;Ui&&(delete N.reloadCallback,N.parse(N.vectorTile,M.layerIndex,this.availableImages,M.actor,Ui)),l(vt,Ht)};N.status==="parsing"?N.reloadCallback=X:N.status==="done"&&(N.vectorTile?N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,X):X())}}abortTile(c,l){const d=c.uid,y=this.loading[d];y&&(y.abort&&y.abort(),delete this.loading[d]),l()}removeTile(c,l){const d=this.loaded,y=c.uid;d&&d[y]&&delete d[y],l()}},o.WritingMode=J0,o.ZoomDependentExpression=kp,o.add=q0,o.addDynamicAttributes=qw,o.adjoint=function(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],X=l[4],vt=l[5],Ht=l[6],Ui=l[7],Fn=l[8];return c[0]=X*Fn-vt*Ui,c[1]=M*Ui-y*Fn,c[2]=y*vt-M*X,c[3]=vt*Ht-N*Fn,c[4]=d*Fn-M*Ht,c[5]=M*N-d*vt,c[6]=N*Ui-X*Ht,c[7]=y*Ht-d*Ui,c[8]=d*X-y*N,c},o.asyncAll=Kd,o.bezier=Ih,o.bindAll=Md,o.boundsAttributes=CE,o.bufferConvexPolygon=function(c,l){const d=[];for(let y=0;y<c.length;y++){const M=Tf(y-1,-1,c.length-1),N=Tf(y+1,-1,c.length-1),X=c[y],vt=c[N],Ht=c[M].sub(X).unit(),Ui=vt.sub(X).unit(),Fn=Ui.angleWithSep(Ht.x,Ht.y),Js=Ht.add(Ui).unit().mult(-1*l/Math.sin(Fn/2));d.push(X.add(Js))}return d},o.cacheEntryPossiblyAdded=function(c){Nf++,Nf>Kf&&(c.getActor().send("enforceCacheSizeLimit",Ld),Nf=0)},o.calculateGlobeLabelMatrix=function(c,l){const{x:d,y}=c.point,M=Ib(d,y,c.worldSize/c._pixelsPerMercatorPixel,0,0);return p1(M,M,Yx(pv(l)))},o.calculateGlobeMatrix=function(c){const{x:l,y:d}=c.point,{lng:y,lat:M}=c._center;return Ib(l,d,c.worldSize,y,M)},o.calculateGlobeMercatorMatrix=function(c){const l=c.pixelsPerMeter,d=l/Jy(1,c.center.lat),y=M0(new Float64Array(16));return F1(y,y,[c.point.x,c.point.y,0]),Jv(y,y,[d,d,l]),Float32Array.from(y)},o.circumferenceAtLatitude=t1,o.clamp=Gh,o.clearTileCache=function(c){if(!If())return;const l=x.caches.delete(sd);c&&l.catch(c).then(()=>c())},o.clipLine=cE,o.clone=function(c){var l=new Ay(16);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=c[6],l[7]=c[7],l[8]=c[8],l[9]=c[9],l[10]=c[10],l[11]=c[11],l[12]=c[12],l[13]=c[13],l[14]=c[14],l[15]=c[15],l},o.clone$1=td,o.collisionCircleLayout=rT,o.config=Y,o.conjugate=function(c,l){return c[0]=-l[0],c[1]=-l[1],c[2]=-l[2],c[3]=l[3],c},o.create=function(){var c=new Ay(16);return Ay!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},o.create$1=ow,o.createExpression=e_,o.createLayout=Lp,o.createStyleLayer=function(c){return c.type==="custom"?new XT(c):new YT[c.type](c)},o.cross=e1,o.degToRad=ih,o.distance=function(c,l){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])},o.div=function(c,l,d){return c[0]=l[0]/d[0],c[1]=l[1]/d[1],c[2]=l[2]/d[2],c},o.dot=t_,o.earthRadius=xx,o.ease=Lh,o.easeCubicInOut=_h,o.ecefToLatLng=function([c,l,d]){const y=Math.hypot(c,l,d),M=Math.atan2(c,d),N=.5*Math.PI-Math.acos(-l/y);return new Tm(al(M),al(N))},o.emitValidationErrors=qv,o.endsWith=Gd,o.enforceCacheSizeLimit=function(c){Df(),Zd&&Zd.then(l=>{l.keys().then(d=>{for(let y=0;y<d.length-c;y++)l.delete(d[y])})})},o.evaluateSizeForFeature=Rw,o.evaluateSizeForZoom=ib,o.evaluateVariableOffset=pE,o.evented=Nh,o.exactEquals=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]&&c[3]===l[3]},o.exactEquals$1=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]},o.exported=mf,o.exported$1=ze,o.extend=md,o.extend$1=Hg,o.fillExtrusionHeightLift=_v,o.filterObject=Id,o.fromMat4=function(c,l){return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[4],c[4]=l[5],c[5]=l[6],c[6]=l[8],c[7]=l[9],c[8]=l[10],c},o.fromQuat=function(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],X=d+d,vt=y+y,Ht=M+M,Ui=d*X,Fn=y*X,Js=y*vt,nl=M*X,ju=M*vt,Ku=M*Ht,lh=N*X,Eh=N*vt,Bh=N*Ht;return c[0]=1-Js-Ku,c[1]=Fn+Bh,c[2]=nl-Eh,c[3]=0,c[4]=Fn-Bh,c[5]=1-Ui-Ku,c[6]=ju+lh,c[7]=0,c[8]=nl+Eh,c[9]=ju-lh,c[10]=1-Ui-Js,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},o.fromRotation=function(c,l){var d=Math.sin(l),y=Math.cos(l);return c[0]=y,c[1]=d,c[2]=0,c[3]=-d,c[4]=y,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},o.fromScaling=sw,o.furthestTileCorner=function(c){const l=Math.round((c+45+360)%360/90)%4;return sh[l]},o.getAABBPointSquareDist=function(c,l,d){let y=0;for(let M=0;M<2;++M){const N=d?d[M]:0;c[M]>N&&(y+=(c[M]-N)*(c[M]-N)),l[M]<N&&(y+=(N-l[M])*(N-l[M]))}return y},o.getAnchorAlignment=E2,o.getAnchorJustification=I2,o.getBounds=function(c){let l=1/0,d=1/0,y=-1/0,M=-1/0;for(const N of c)l=Math.min(l,N.x),d=Math.min(d,N.y),y=Math.max(y,N.x),M=Math.max(M,N.y);return{min:new $s(l,d),max:new $s(y,M)}},o.getColumn=Yd,o.getGridMatrix=function(c,l,d,y){const M=l.getNorth(),N=l.getSouth(),X=l.getWest(),vt=l.getEast(),Ht=1<<c.z,Ui=vt-X,Fn=M-N,Js=Ui/fv,nl=-Fn/gx[d],ju=[0,Js,0,nl,0,0,M,X,0];if(c.z>0){const Ku=180/y;aw(ju,ju,[Ku/Ui+1,0,0,0,Ku/Fn+1,0,-.5*Ku/Js,.5*Ku/nl,1])}return ju[2]=Ht,ju[5]=c.x,ju[8]=c.y,ju},o.getImage=rm,o.getJSON=function(c,l){return Pp(md(c,{type:"json"}),l)},o.getLatitudinalLod=function(c){const l=o_-5;c=Gh(c,-l,l)/l*90;const d=Math.pow(Math.abs(Math.sin(ih(c))),3);return Math.round(d*(gx.length-1))},o.getMapSessionAPI=dh,o.getPerformanceMeasurement=Qd,o.getProjection=wE,o.getRTLTextPluginStatus=qh,o.getReferrer=Sp,o.getTilePoint=function(c,{x:l,y:d},y=0){return new $s(((l-y)*c.scale-c.x)*Hp,(d*c.scale-c.y)*Hp)},o.getTileVec3=function(c,l,d=0){return $g(((l.x-d)*c.scale-c.x)*Hp,(l.y*c.scale-c.y)*Hp,Mb(l.z,l.y))},o.getVideo=function(c,l){const d=x.document.createElement("video");d.muted=!0,d.onloadstart=function(){l(null,d)};for(let y=0;y<c.length;y++){const M=x.document.createElement("source");qp(c[y])||(d.crossOrigin="Anonymous"),M.src=c[y],d.appendChild(M)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(c){const l=[0,0,0],d=M0(new Float64Array(16));return p1(d,c.pixelMatrix,c.globeMatrix),Cg(l,l,d),new $s(l[0],l[1])},o.globeDenormalizeECEF=Yx,o.globeECEFOrigin=function(c,l){const d=[0,0,0];return Cg(d,d,j1(pv(l.canonical))),Cg(d,d,c),d},o.globeMetersToEcef=_x,o.globeNormalizeECEF=j1,o.globePixelsToTileUnits=function(c,l){return Hp/(512*Math.pow(2,c))*Wx(pv(l))},o.globePoleMatrixForTile=function(c,l,d){const y=M0(new Float64Array(16)),M=(l/(1<<c)-.5)*Math.PI*2;return qx(y,d.globeMatrix,M),Float32Array.from(y)},o.globeTileBounds=pv,o.globeTiltAtLngLat=Cb,o.globeToMercatorTransition=Lv,o.globeUseCustomAntiAliasing=function(c,l,d){const y=Lv(d.zoom),M=c.style.map._antialias,N=!!l.extStandardDerivatives,X=l.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return y===0&&!M&&!X&&N},o.identity=M0,o.identity$1=mx,o.invert=fx,o.isFullscreen=function(){return!!x.document.fullscreenElement||!!x.document.webkitFullscreenElement},o.isLngLatBehindGlobe=q1,o.isMapAuthenticated=function(c){return vh.has(c)},o.isMapboxURL=hp,o.isSafariWithAntialiasingBug=function(c){const l=c.navigator?c.navigator.userAgent:null;return!!fp(c)&&l&&(l.match("Version/15.4")||l.match("Version/15.5")||l.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Mg,o.latLngToECEF=b1,o.len=r2,o.length=Dv,o.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},o.lngFromMercatorX=e0,o.loadVectorTile=jE,o.makeRequest=Pp,o.mapValue=function(c,l,d,y,M){return Gh((c-l)/(d-l)*(M-y)+y,y,M)},o.mercatorScale=xw,o.mercatorXfromLng=P0,o.mercatorYfromLat=X0,o.mercatorZfromAltitude=Jy,o.mul=uw,o.mul$1=i2,o.multiply=p1,o.multiply$1=aw,o.multiply$2=xb,o.nextPowerOfTwo=Sd,o.normalize=R_,o.normalize$1=n2,o.normalize$2=pw,o.number=Kp,o.ortho=function(c,l,d,y,M,N,X){var vt=1/(l-d),Ht=1/(y-M),Ui=1/(N-X);return c[0]=-2*vt,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*Ht,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*Ui,c[11]=0,c[12]=(l+d)*vt,c[13]=(M+y)*Ht,c[14]=(X+N)*Ui,c[15]=1,c},o.pbf=Gb,o.perspective=function(c,l,d,y,M){var N,X=1/Math.tan(l/2);return c[0]=X/d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=X,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,M!=null&&M!==1/0?(c[10]=(M+y)*(N=1/(y-M)),c[14]=2*M*y*N):(c[10]=-1,c[14]=-2*y),c},o.pick=function(c,l){const d={};for(let y=0;y<l.length;y++){const M=l[y];M in c&&(d[M]=c[M])}return d},o.plugin=Hh,o.pointGeometry=$s,o.polesInViewport=function(c){const l=M0(new Float64Array(16));p1(l,c.pixelMatrix,c.globeMatrix);const d=[0,Ky,0],y=[0,Qy,0];return Cg(d,d,l),Cg(y,y,l),[d[0]>0&&d[0]<=c.width&&d[1]>0&&d[1]<=c.height&&!q1(c,new Tm(c.center.lat,90)),y[0]>0&&y[0]<=c.width&&y[1]>0&&y[1]<=c.height&&!q1(c,new Tm(c.center.lat,-90))]},o.polygonContainsPoint=i1,o.polygonIntersectsBox=Lb,o.polygonIntersectsPolygon=bw,o.polygonizeBounds=function(c,l,d=0,y=!0){const M=new $s(d,d),N=c.sub(M),X=l.add(M),vt=[N,new $s(X.x,N.y),X,new $s(N.x,X.y)];return y&&vt.push(N.clone()),vt},o.posAttributes=_1,o.postMapLoadEvent=$u,o.postPerformanceEvent=nh,o.postTurnstileEvent=_n,o.potpack=x2,o.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},o.radToDeg=al,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(c){return c({pluginStatus:Ch,pluginURL:hh}),Nh.on("pluginStateChange",c),c},o.removeAuthState=function(c){vh.delete(c)},o.renderColorRamp=S1,o.resample=bx,o.rotateX=jx,o.rotateX$1=g1,o.rotateY=qx,o.rotateY$1=bb,o.rotateZ=function(c,l,d){var y=Math.sin(d),M=Math.cos(d),N=l[0],X=l[1],vt=l[2],Ht=l[3],Ui=l[4],Fn=l[5],Js=l[6],nl=l[7];return l!==c&&(c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=N*M+Ui*y,c[1]=X*M+Fn*y,c[2]=vt*M+Js*y,c[3]=Ht*M+nl*y,c[4]=Ui*M-N*y,c[5]=Fn*M-X*y,c[6]=Js*M-vt*y,c[7]=nl*M-Ht*y,c},o.rotateZ$1=function(c,l,d){d*=.5;var y=l[0],M=l[1],N=l[2],X=l[3],vt=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht+M*vt,c[1]=M*Ht-y*vt,c[2]=N*Ht+X*vt,c[3]=X*Ht-N*vt,c},o.scale=Jv,o.scale$1=fw,o.scale$2=hy,o.scaleAndAdd=U1,o.set=function(c,l,d,y){return c[0]=l,c[1]=d,c[2]=y,c},o.setCacheLimits=function(c,l){Ld=c,Kf=l},o.setColumn=function(c,l,d){c[4*l+0]=d[0],c[4*l+1]=d[1],c[4*l+2]=d[2],c[4*l+3]=d[3]},o.setRTLTextPlugin=function(c,l,d=!1){if(Ch===fh||Ch===wh||Ch===Sh)throw new Error("setRTLTextPlugin cannot be called multiple times.");hh=mf.resolveURL(c),Ch=fh,Th=l,Rh(),d||Fh()},o.smoothstep=ud,o.spec=Pd,o.squaredLength=function(c){var l=c[0],d=c[1],y=c[2];return l*l+d*d+y*y},o.storeAuthState=function(c,l){l?vh.add(c):vh.delete(c)},o.sub=Z0,o.subtract=Zx,o.symbolSize=nT,o.tileAABB=function(c,l,d,y,M,N,X,vt,Ht){if(Ht.name==="globe")return _w(c,l,new D0(d,y,M));const Ui=kx({z:d,x:y,y:M},Ht);return new Yg([(N+Ui.x/Ui.scale)*l,l*(Ui.y/Ui.scale),X],[(N+Ui.x2/Ui.scale)*l,l*(Ui.y2/Ui.scale),vt])},o.tileCornersToBounds=H0,o.tileTransform=kx,o.transformMat3=function(c,l,d){var y=l[0],M=l[1],N=l[2];return c[0]=y*d[0]+M*d[3]+N*d[6],c[1]=y*d[1]+M*d[4]+N*d[7],c[2]=y*d[2]+M*d[5]+N*d[8],c},o.transformMat4=Cg,o.transformMat4$1=m1,o.transformQuat=dw,o.transitionTileAABBinECEF=Sb,o.translate=F1,o.transpose=function(c,l){if(c===l){var d=l[1],y=l[2],M=l[5];c[1]=l[3],c[2]=l[6],c[3]=d,c[5]=l[7],c[6]=y,c[7]=M}else c[0]=l[0],c[1]=l[3],c[2]=l[6],c[3]=l[1],c[4]=l[4],c[5]=l[7],c[6]=l[2],c[7]=l[5],c[8]=l[8];return c},o.triggerPluginCompletionEvent=Oh,o.uniqueId=qd,o.updateGlobeVertexNormal=function(c,l,d,y,M){const N=5*l+2;c.float32[N+0]=d,c.float32[N+1]=y,c.float32[N+2]=M},o.validateCustomStyleLayer=function(c){const l=[],d=c.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),c.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},o.validateFilter=c=>Ty(Sv(c)),o.validateFog=c=>Ty(Cv(c)),o.validateLayer=c=>Ty(lv(c)),o.validateLight=c=>Ty(c1(c)),o.validateSource=c=>Ty(T0(c)),o.validateStyle=S0,o.validateTerrain=c=>Ty(Iv(c)),o.values=Af,o.vectorTile=Bg,o.version=C,o.warnOnce=rp,o.window=x,o.wrap=Tf}),s(["./shared"],function(o){function x(Gn){if(typeof Gn=="number"||typeof Gn=="boolean"||typeof Gn=="string"||Gn==null)return JSON.stringify(Gn);if(Array.isArray(Gn)){let cs="[";for(const $u of Gn)cs+=`${x($u)},`;return`${cs}]`}let _n="{";for(const cs of Object.keys(Gn).sort())_n+=`${cs}:${x(Gn[cs])},`;return`${_n}}`}function C(Gn){let _n="";for(const cs of o.refProperties)_n+=`/${x(Gn[cs])}`;return _n}class P{constructor(_n){this.keyCache={},_n&&this.replace(_n)}replace(_n){this._layerConfigs={},this._layers={},this.update(_n,[])}update(_n,cs){for(const eh of _n)this._layerConfigs[eh.id]=eh,(this._layers[eh.id]=o.createStyleLayer(eh)).compileFilter(),this.keyCache[eh.id]&&delete this.keyCache[eh.id];for(const eh of cs)delete this.keyCache[eh],delete this._layerConfigs[eh],delete this._layers[eh];this.familiesBySource={};const $u=function(eh,nh){const uh={};for(let vh=0;vh<eh.length;vh++){const Ph=nh&&nh[eh[vh].id]||C(eh[vh]);nh&&(nh[eh[vh].id]=Ph);let zh=uh[Ph];zh||(zh=uh[Ph]=[]),zh.push(eh[vh])}const dh=[];for(const vh in uh)dh.push(uh[vh]);return dh}(o.values(this._layerConfigs),this.keyCache);for(const eh of $u){const nh=eh.map(Ad=>this._layers[Ad.id]),uh=nh[0];if(uh.visibility==="none")continue;const dh=uh.source||"";let vh=this.familiesBySource[dh];vh||(vh=this.familiesBySource[dh]={});const Ph=uh.sourceLayer||"_geojsonTileLayer";let zh=vh[Ph];zh||(zh=vh[Ph]=[]),zh.push(nh)}}}class Y{loadTile(_n,cs){const{uid:$u,encoding:eh,rawImageData:nh,padding:uh,buildQuadTree:dh}=_n,vh=o.window.ImageBitmap&&nh instanceof o.window.ImageBitmap?this.getImageData(nh,uh):nh;cs(null,new o.DEMData($u,vh,eh,uh<1,dh))}getImageData(_n,cs){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(_n.width,_n.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=_n.width,this.offscreenCanvas.height=_n.height,this.offscreenCanvasContext.drawImage(_n,0,0,_n.width,_n.height);const $u=this.offscreenCanvasContext.getImageData(-cs,-cs,_n.width+2*cs,_n.height+2*cs);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),$u}}var ze=function Gn(_n,cs){var $u,eh=_n&&_n.type;if(eh==="FeatureCollection")for($u=0;$u<_n.features.length;$u++)Gn(_n.features[$u],cs);else if(eh==="GeometryCollection")for($u=0;$u<_n.geometries.length;$u++)Gn(_n.geometries[$u],cs);else if(eh==="Feature")Gn(_n.geometry,cs);else if(eh==="Polygon")ge(_n.coordinates,cs);else if(eh==="MultiPolygon")for($u=0;$u<_n.coordinates.length;$u++)ge(_n.coordinates[$u],cs);return _n};function ge(Gn,_n){if(Gn.length!==0){Bt(Gn[0],_n);for(var cs=1;cs<Gn.length;cs++)Bt(Gn[cs],!_n)}}function Bt(Gn,_n){for(var cs=0,$u=0,eh=0,nh=Gn.length,uh=nh-1;eh<nh;uh=eh++){var dh=(Gn[eh][0]-Gn[uh][0])*(Gn[uh][1]+Gn[eh][1]),vh=cs+dh;$u+=Math.abs(cs)>=Math.abs(dh)?cs-vh+dh:dh-vh+cs,cs=vh}cs+$u>=0!=!!_n&&Gn.reverse()}const Ur=o.VectorTileFeature.prototype.toGeoJSON;class kn{constructor(_n){this._feature=_n,this.extent=o.EXTENT,this.type=_n.type,this.properties=_n.tags,"id"in _n&&!isNaN(_n.id)&&(this.id=parseInt(_n.id,10))}loadGeometry(){if(this._feature.type===1){const _n=[];for(const cs of this._feature.geometry)_n.push([new o.pointGeometry(cs[0],cs[1])]);return _n}{const _n=[];for(const cs of this._feature.geometry){const $u=[];for(const eh of cs)$u.push(new o.pointGeometry(eh[0],eh[1]));_n.push($u)}return _n}}toGeoJSON(_n,cs,$u){return Ur.call(this,_n,cs,$u)}}class Io{constructor(_n){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=_n.length,this._features=_n}feature(_n){return new kn(this._features[_n])}}var rl={},Co={get exports(){return rl},set exports(Gn){rl=Gn}},as=o.pointGeometry,$s=o.vectorTile.VectorTileFeature,ah=ch;function ch(Gn,_n){this.options=_n||{},this.features=Gn,this.length=Gn.length}function Zu(Gn,_n){this.id=typeof Gn.id=="number"?Gn.id:void 0,this.type=Gn.type,this.rawGeometry=Gn.type===1?[Gn.geometry]:Gn.geometry,this.properties=Gn.tags,this.extent=_n||4096}ch.prototype.feature=function(Gn){return new Zu(this.features[Gn],this.options.extent)},Zu.prototype.loadGeometry=function(){var Gn=this.rawGeometry;this.geometry=[];for(var _n=0;_n<Gn.length;_n++){for(var cs=Gn[_n],$u=[],eh=0;eh<cs.length;eh++)$u.push(new as(cs[eh][0],cs[eh][1]));this.geometry.push($u)}return this.geometry},Zu.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Gn=this.geometry,_n=1/0,cs=-1/0,$u=1/0,eh=-1/0,nh=0;nh<Gn.length;nh++)for(var uh=Gn[nh],dh=0;dh<uh.length;dh++){var vh=uh[dh];_n=Math.min(_n,vh.x),cs=Math.max(cs,vh.x),$u=Math.min($u,vh.y),eh=Math.max(eh,vh.y)}return[_n,$u,cs,eh]},Zu.prototype.toGeoJSON=$s.prototype.toGeoJSON;var ih=o.pbf,al=ah;function sh(Gn){var _n=new ih;return function(cs,$u){for(var eh in cs.layers)$u.writeMessage(3,_h,cs.layers[eh])}(Gn,_n),_n.finish()}function _h(Gn,_n){var cs;_n.writeVarintField(15,Gn.version||1),_n.writeStringField(1,Gn.name||""),_n.writeVarintField(5,Gn.extent||4096);var $u={keys:[],values:[],keycache:{},valuecache:{}};for(cs=0;cs<Gn.length;cs++)$u.feature=Gn.feature(cs),_n.writeMessage(2,Ih,$u);var eh=$u.keys;for(cs=0;cs<eh.length;cs++)_n.writeStringField(3,eh[cs]);var nh=$u.values;for(cs=0;cs<nh.length;cs++)_n.writeMessage(4,Kd,nh[cs])}function Ih(Gn,_n){var cs=Gn.feature;cs.id!==void 0&&_n.writeVarintField(1,cs.id),_n.writeMessage(2,Lh,Gn),_n.writeVarintField(3,cs.type),_n.writeMessage(4,Tf,cs)}function Lh(Gn,_n){var cs=Gn.feature,$u=Gn.keys,eh=Gn.values,nh=Gn.keycache,uh=Gn.valuecache;for(var dh in cs.properties){var vh=cs.properties[dh],Ph=nh[dh];if(vh!==null){Ph===void 0&&($u.push(dh),nh[dh]=Ph=$u.length-1),_n.writeVarint(Ph);var zh=typeof vh;zh!=="string"&&zh!=="boolean"&&zh!=="number"&&(vh=JSON.stringify(vh));var Ad=zh+":"+vh,wd=uh[Ad];wd===void 0&&(eh.push(vh),uh[Ad]=wd=eh.length-1),_n.writeVarint(wd)}}}function Gh(Gn,_n){return(_n<<3)+(7&Gn)}function ud(Gn){return Gn<<1^Gn>>31}function Tf(Gn,_n){for(var cs=Gn.loadGeometry(),$u=Gn.type,eh=0,nh=0,uh=cs.length,dh=0;dh<uh;dh++){var vh=cs[dh],Ph=1;$u===1&&(Ph=vh.length),_n.writeVarint(Gh(1,Ph));for(var zh=$u===3?vh.length-1:vh.length,Ad=0;Ad<zh;Ad++){Ad===1&&$u!==1&&_n.writeVarint(Gh(2,zh-1));var wd=vh[Ad].x-eh,Qd=vh[Ad].y-nh;_n.writeVarint(ud(wd)),_n.writeVarint(ud(Qd)),eh+=wd,nh+=Qd}$u===3&&_n.writeVarint(Gh(7,1))}}function Kd(Gn,_n){var cs=typeof Gn;cs==="string"?_n.writeStringField(1,Gn):cs==="boolean"?_n.writeBooleanField(7,Gn):cs==="number"&&(Gn%1!=0?_n.writeDoubleField(3,Gn):Gn<0?_n.writeSVarintField(6,Gn):_n.writeVarintField(5,Gn))}function Af(Gn,_n,cs,$u,eh,nh){if(eh-$u<=cs)return;const uh=$u+eh>>1;md(Gn,_n,uh,$u,eh,nh%2),Af(Gn,_n,cs,$u,uh-1,nh+1),Af(Gn,_n,cs,uh+1,eh,nh+1)}function md(Gn,_n,cs,$u,eh,nh){for(;eh>$u;){if(eh-$u>600){const Ph=eh-$u+1,zh=cs-$u+1,Ad=Math.log(Ph),wd=.5*Math.exp(2*Ad/3),Qd=.5*Math.sqrt(Ad*wd*(Ph-wd)/Ph)*(zh-Ph/2<0?-1:1);md(Gn,_n,cs,Math.max($u,Math.floor(cs-zh*wd/Ph+Qd)),Math.min(eh,Math.floor(cs+(Ph-zh)*wd/Ph+Qd)),nh)}const uh=_n[2*cs+nh];let dh=$u,vh=eh;for(vd(Gn,_n,$u,cs),_n[2*eh+nh]>uh&&vd(Gn,_n,$u,eh);dh<vh;){for(vd(Gn,_n,dh,vh),dh++,vh--;_n[2*dh+nh]<uh;)dh++;for(;_n[2*vh+nh]>uh;)vh--}_n[2*$u+nh]===uh?vd(Gn,_n,$u,vh):(vh++,vd(Gn,_n,vh,eh)),vh<=cs&&($u=vh+1),cs<=vh&&(eh=vh-1)}}function vd(Gn,_n,cs,$u){qd(Gn,cs,$u),qd(_n,2*cs,2*$u),qd(_n,2*cs+1,2*$u+1)}function qd(Gn,_n,cs){const $u=Gn[_n];Gn[_n]=Gn[cs],Gn[cs]=$u}function Ed(Gn,_n,cs,$u){const eh=Gn-cs,nh=_n-$u;return eh*eh+nh*nh}Co.exports=sh,rl.fromVectorTileJs=sh,rl.fromGeojsonVt=function(Gn,_n){_n=_n||{};var cs={};for(var $u in Gn)cs[$u]=new al(Gn[$u].features,_n),cs[$u].name=$u,cs[$u].version=_n.version,cs[$u].extent=_n.extent;return sh({layers:cs})},rl.GeoJSONWrapper=al;const Sd=Gn=>Gn[0],zd=Gn=>Gn[1];class Md{constructor(_n,cs=Sd,$u=zd,eh=64,nh=Float64Array){this.nodeSize=eh,this.points=_n;const uh=_n.length<65536?Uint16Array:Uint32Array,dh=this.ids=new uh(_n.length),vh=this.coords=new nh(2*_n.length);for(let Ph=0;Ph<_n.length;Ph++)dh[Ph]=Ph,vh[2*Ph]=cs(_n[Ph]),vh[2*Ph+1]=$u(_n[Ph]);Af(dh,vh,eh,0,dh.length-1,0)}range(_n,cs,$u,eh){return function(nh,uh,dh,vh,Ph,zh,Ad){const wd=[0,nh.length-1,0],Qd=[];let xf,zf;for(;wd.length;){const np=wd.pop(),Ah=wd.pop(),mf=wd.pop();if(Ah-mf<=Ad){for(let mp=mf;mp<=Ah;mp++)xf=uh[2*mp],zf=uh[2*mp+1],xf>=dh&&xf<=Ph&&zf>=vh&&zf<=zh&&Qd.push(nh[mp]);continue}const Od=Math.floor((mf+Ah)/2);xf=uh[2*Od],zf=uh[2*Od+1],xf>=dh&&xf<=Ph&&zf>=vh&&zf<=zh&&Qd.push(nh[Od]);const qf=(np+1)%2;(np===0?dh<=xf:vh<=zf)&&(wd.push(mf),wd.push(Od-1),wd.push(qf)),(np===0?Ph>=xf:zh>=zf)&&(wd.push(Od+1),wd.push(Ah),wd.push(qf))}return Qd}(this.ids,this.coords,_n,cs,$u,eh,this.nodeSize)}within(_n,cs,$u){return function(eh,nh,uh,dh,vh,Ph){const zh=[0,eh.length-1,0],Ad=[],wd=vh*vh;for(;zh.length;){const Qd=zh.pop(),xf=zh.pop(),zf=zh.pop();if(xf-zf<=Ph){for(let qf=zf;qf<=xf;qf++)Ed(nh[2*qf],nh[2*qf+1],uh,dh)<=wd&&Ad.push(eh[qf]);continue}const np=Math.floor((zf+xf)/2),Ah=nh[2*np],mf=nh[2*np+1];Ed(Ah,mf,uh,dh)<=wd&&Ad.push(eh[np]);const Od=(Qd+1)%2;(Qd===0?uh-vh<=Ah:dh-vh<=mf)&&(zh.push(zf),zh.push(np-1),zh.push(Od)),(Qd===0?uh+vh>=Ah:dh+vh>=mf)&&(zh.push(np+1),zh.push(xf),zh.push(Od))}return Ad}(this.ids,this.coords,_n,cs,$u,this.nodeSize)}}const Gd={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Gn=>Gn},bf=Math.fround||(Id=new Float32Array(1),Gn=>(Id[0]=+Gn,Id[0]));var Id;class td{constructor(_n){this.options=fp(Object.create(Gd),_n),this.trees=new Array(this.options.maxZoom+1)}load(_n){const{log:cs,minZoom:$u,maxZoom:eh,nodeSize:nh}=this.options;cs&&console.time("total time");const uh=`prepare ${_n.length} points`;cs&&console.time(uh),this.points=_n;let dh=[];for(let vh=0;vh<_n.length;vh++)_n[vh].geometry&&dh.push(rp(_n[vh],vh));this.trees[eh+1]=new Md(dh,Qh,Yd,nh,Float32Array),cs&&console.timeEnd(uh);for(let vh=eh;vh>=$u;vh--){const Ph=+Date.now();dh=this._cluster(dh,vh),this.trees[vh]=new Md(dh,Qh,Yd,nh,Float32Array),cs&&console.log("z%d: %d clusters in %dms",vh,dh.length,+Date.now()-Ph)}return cs&&console.timeEnd("total time"),this}getClusters(_n,cs){let $u=((_n[0]+180)%360+360)%360-180;const eh=Math.max(-90,Math.min(90,_n[1]));let nh=_n[2]===180?180:((_n[2]+180)%360+360)%360-180;const uh=Math.max(-90,Math.min(90,_n[3]));if(_n[2]-_n[0]>=360)$u=-180,nh=180;else if($u>nh){const zh=this.getClusters([$u,eh,180,uh],cs),Ad=this.getClusters([-180,eh,nh,uh],cs);return zh.concat(Ad)}const dh=this.trees[this._limitZoom(cs)],vh=dh.range(Jd($u),op(uh),Jd(nh),op(eh)),Ph=[];for(const zh of vh){const Ad=dh.points[zh];Ph.push(Ad.numPoints?jf(Ad):this.points[Ad.index])}return Ph}getChildren(_n){const cs=this._getOriginId(_n),$u=this._getOriginZoom(_n),eh="No cluster with the specified id.",nh=this.trees[$u];if(!nh)throw new Error(eh);const uh=nh.points[cs];if(!uh)throw new Error(eh);const dh=this.options.radius/(this.options.extent*Math.pow(2,$u-1)),vh=nh.within(uh.x,uh.y,dh),Ph=[];for(const zh of vh){const Ad=nh.points[zh];Ad.parentId===_n&&Ph.push(Ad.numPoints?jf(Ad):this.points[Ad.index])}if(Ph.length===0)throw new Error(eh);return Ph}getLeaves(_n,cs,$u){const eh=[];return this._appendLeaves(eh,_n,cs=cs||10,$u=$u||0,0),eh}getTile(_n,cs,$u){const eh=this.trees[this._limitZoom(_n)],nh=Math.pow(2,_n),{extent:uh,radius:dh}=this.options,vh=dh/uh,Ph=($u-vh)/nh,zh=($u+1+vh)/nh,Ad={features:[]};return this._addTileFeatures(eh.range((cs-vh)/nh,Ph,(cs+1+vh)/nh,zh),eh.points,cs,$u,nh,Ad),cs===0&&this._addTileFeatures(eh.range(1-vh/nh,Ph,1,zh),eh.points,nh,$u,nh,Ad),cs===nh-1&&this._addTileFeatures(eh.range(0,Ph,vh/nh,zh),eh.points,-1,$u,nh,Ad),Ad.features.length?Ad:null}getClusterExpansionZoom(_n){let cs=this._getOriginZoom(_n)-1;for(;cs<=this.options.maxZoom;){const $u=this.getChildren(_n);if(cs++,$u.length!==1)break;_n=$u[0].properties.cluster_id}return cs}_appendLeaves(_n,cs,$u,eh,nh){const uh=this.getChildren(cs);for(const dh of uh){const vh=dh.properties;if(vh&&vh.cluster?nh+vh.point_count<=eh?nh+=vh.point_count:nh=this._appendLeaves(_n,vh.cluster_id,$u,eh,nh):nh<eh?nh++:_n.push(dh),_n.length===$u)break}return nh}_addTileFeatures(_n,cs,$u,eh,nh,uh){for(const dh of _n){const vh=cs[dh],Ph=vh.numPoints;let zh,Ad,wd;if(Ph)zh=yd(vh),Ad=vh.x,wd=vh.y;else{const zf=this.points[vh.index];zh=zf.properties,Ad=Jd(zf.geometry.coordinates[0]),wd=op(zf.geometry.coordinates[1])}const Qd={type:1,geometry:[[Math.round(this.options.extent*(Ad*nh-$u)),Math.round(this.options.extent*(wd*nh-eh))]],tags:zh};let xf;Ph?xf=vh.id:this.options.generateId?xf=vh.index:this.points[vh.index].id&&(xf=this.points[vh.index].id),xf!==void 0&&(Qd.id=xf),uh.features.push(Qd)}}_limitZoom(_n){return Math.max(this.options.minZoom,Math.min(Math.floor(+_n),this.options.maxZoom+1))}_cluster(_n,cs){const $u=[],{radius:eh,extent:nh,reduce:uh,minPoints:dh}=this.options,vh=eh/(nh*Math.pow(2,cs));for(let Ph=0;Ph<_n.length;Ph++){const zh=_n[Ph];if(zh.zoom<=cs)continue;zh.zoom=cs;const Ad=this.trees[cs+1],wd=Ad.within(zh.x,zh.y,vh),Qd=zh.numPoints||1;let xf=Qd;for(const zf of wd){const np=Ad.points[zf];np.zoom>cs&&(xf+=np.numPoints||1)}if(xf>Qd&&xf>=dh){let zf=zh.x*Qd,np=zh.y*Qd,Ah=uh&&Qd>1?this._map(zh,!0):null;const mf=(Ph<<5)+(cs+1)+this.points.length;for(const Od of wd){const qf=Ad.points[Od];if(qf.zoom<=cs)continue;qf.zoom=cs;const mp=qf.numPoints||1;zf+=qf.x*mp,np+=qf.y*mp,qf.parentId=mf,uh&&(Ah||(Ah=this._map(zh,!0)),uh(Ah,this._map(qf)))}zh.parentId=mf,$u.push(Fd(zf/xf,np/xf,mf,xf,Ah))}else if($u.push(zh),xf>1)for(const zf of wd){const np=Ad.points[zf];np.zoom<=cs||(np.zoom=cs,$u.push(np))}}return $u}_getOriginId(_n){return _n-this.points.length>>5}_getOriginZoom(_n){return(_n-this.points.length)%32}_map(_n,cs){if(_n.numPoints)return cs?fp({},_n.properties):_n.properties;const $u=this.points[_n.index].properties,eh=this.options.map($u);return cs&&eh===$u?fp({},eh):eh}}function Fd(Gn,_n,cs,$u,eh){return{x:bf(Gn),y:bf(_n),zoom:1/0,id:cs,parentId:-1,numPoints:$u,properties:eh}}function rp(Gn,_n){const[cs,$u]=Gn.geometry.coordinates;return{x:bf(Jd(cs)),y:bf(op($u)),zoom:1/0,index:_n,parentId:-1}}function jf(Gn){return{type:"Feature",id:Gn.id,properties:yd(Gn),geometry:{type:"Point",coordinates:[(_n=Gn.x,360*(_n-.5)),bp(Gn.y)]}};var _n}function yd(Gn){const _n=Gn.numPoints,cs=_n>=1e4?`${Math.round(_n/1e3)}k`:_n>=1e3?Math.round(_n/100)/10+"k":_n;return fp(fp({},Gn.properties),{cluster:!0,cluster_id:Gn.id,point_count:_n,point_count_abbreviated:cs})}function Jd(Gn){return Gn/360+.5}function op(Gn){const _n=Math.sin(Gn*Math.PI/180),cs=.5-.25*Math.log((1+_n)/(1-_n))/Math.PI;return cs<0?0:cs>1?1:cs}function bp(Gn){const _n=(180-360*Gn)*Math.PI/180;return 360*Math.atan(Math.exp(_n))/Math.PI-90}function fp(Gn,_n){for(const cs in _n)Gn[cs]=_n[cs];return Gn}function Qh(Gn){return Gn.x}function Yd(Gn){return Gn.y}function sd(Gn,_n,cs,$u){for(var eh,nh=$u,uh=cs-_n>>1,dh=cs-_n,vh=Gn[_n],Ph=Gn[_n+1],zh=Gn[cs],Ad=Gn[cs+1],wd=_n+3;wd<cs;wd+=3){var Qd=Zd(Gn[wd],Gn[wd+1],vh,Ph,zh,Ad);if(Qd>nh)eh=wd,nh=Qd;else if(Qd===nh){var xf=Math.abs(wd-uh);xf<dh&&(eh=wd,dh=xf)}}nh>$u&&(eh-_n>3&&sd(Gn,_n,eh,$u),Gn[eh+2]=nh,cs-eh>3&&sd(Gn,eh,cs,$u))}function Zd(Gn,_n,cs,$u,eh,nh){var uh=eh-cs,dh=nh-$u;if(uh!==0||dh!==0){var vh=((Gn-cs)*uh+(_n-$u)*dh)/(uh*uh+dh*dh);vh>1?(cs=eh,$u=nh):vh>0&&(cs+=uh*vh,$u+=dh*vh)}return(uh=Gn-cs)*uh+(dh=_n-$u)*dh}function Xh(Gn,_n,cs,$u){var eh={id:Gn===void 0?null:Gn,type:_n,geometry:cs,tags:$u,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nh){var uh=nh.geometry,dh=nh.type;if(dh==="Point"||dh==="MultiPoint"||dh==="LineString")Ld(nh,uh);else if(dh==="Polygon"||dh==="MultiLineString")for(var vh=0;vh<uh.length;vh++)Ld(nh,uh[vh]);else if(dh==="MultiPolygon")for(vh=0;vh<uh.length;vh++)for(var Ph=0;Ph<uh[vh].length;Ph++)Ld(nh,uh[vh][Ph])}(eh),eh}function Ld(Gn,_n){for(var cs=0;cs<_n.length;cs+=3)Gn.minX=Math.min(Gn.minX,_n[cs]),Gn.minY=Math.min(Gn.minY,_n[cs+1]),Gn.maxX=Math.max(Gn.maxX,_n[cs]),Gn.maxY=Math.max(Gn.maxY,_n[cs+1])}function Kf(Gn,_n,cs,$u){if(_n.geometry){var eh=_n.geometry.coordinates,nh=_n.geometry.type,uh=Math.pow(cs.tolerance/((1<<cs.maxZoom)*cs.extent),2),dh=[],vh=_n.id;if(cs.promoteId?vh=_n.properties[cs.promoteId]:cs.generateId&&(vh=$u||0),nh==="Point")If(eh,dh);else if(nh==="MultiPoint")for(var Ph=0;Ph<eh.length;Ph++)If(eh[Ph],dh);else if(nh==="LineString")Df(eh,dh,uh,!1);else if(nh==="MultiLineString"){if(cs.lineMetrics){for(Ph=0;Ph<eh.length;Ph++)Df(eh[Ph],dh=[],uh,!1),Gn.push(Xh(vh,"LineString",dh,_n.properties));return}Jf(eh,dh,uh,!1)}else if(nh==="Polygon")Jf(eh,dh,uh,!0);else{if(nh!=="MultiPolygon"){if(nh==="GeometryCollection"){for(Ph=0;Ph<_n.geometry.geometries.length;Ph++)Kf(Gn,{id:vh,geometry:_n.geometry.geometries[Ph],properties:_n.properties},cs,$u);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ph=0;Ph<eh.length;Ph++){var zh=[];Jf(eh[Ph],zh,uh,!0),dh.push(zh)}}Gn.push(Xh(vh,nh,dh,_n.properties))}}function If(Gn,_n){_n.push(Nf(Gn[0])),_n.push(Wf(Gn[1])),_n.push(0)}function Df(Gn,_n,cs,$u){for(var eh,nh,uh=0,dh=0;dh<Gn.length;dh++){var vh=Nf(Gn[dh][0]),Ph=Wf(Gn[dh][1]);_n.push(vh),_n.push(Ph),_n.push(0),dh>0&&(uh+=$u?(eh*Ph-vh*nh)/2:Math.sqrt(Math.pow(vh-eh,2)+Math.pow(Ph-nh,2))),eh=vh,nh=Ph}var zh=_n.length-3;_n[2]=1,sd(_n,0,zh,cs),_n[zh+2]=1,_n.size=Math.abs(uh),_n.start=0,_n.end=_n.size}function Jf(Gn,_n,cs,$u){for(var eh=0;eh<Gn.length;eh++){var nh=[];Df(Gn[eh],nh,cs,$u),_n.push(nh)}}function Nf(Gn){return Gn/360+.5}function Wf(Gn){var _n=Math.sin(Gn*Math.PI/180),cs=.5-.25*Math.log((1+_n)/(1-_n))/Math.PI;return cs<0?0:cs>1?1:cs}function Mp(Gn,_n,cs,$u,eh,nh,uh,dh){if($u/=_n,nh>=(cs/=_n)&&uh<$u)return Gn;if(uh<cs||nh>=$u)return null;for(var vh=[],Ph=0;Ph<Gn.length;Ph++){var zh=Gn[Ph],Ad=zh.geometry,wd=zh.type,Qd=eh===0?zh.minX:zh.minY,xf=eh===0?zh.maxX:zh.maxY;if(Qd>=cs&&xf<$u)vh.push(zh);else if(!(xf<cs||Qd>=$u)){var zf=[];if(wd==="Point"||wd==="MultiPoint")Sp(Ad,zf,cs,$u,eh);else if(wd==="LineString")Pp(Ad,zf,cs,$u,eh,!1,dh.lineMetrics);else if(wd==="MultiLineString")qp(Ad,zf,cs,$u,eh,!1);else if(wd==="Polygon")qp(Ad,zf,cs,$u,eh,!0);else if(wd==="MultiPolygon")for(var np=0;np<Ad.length;np++){var Ah=[];qp(Ad[np],Ah,cs,$u,eh,!0),Ah.length&&zf.push(Ah)}if(zf.length){if(dh.lineMetrics&&wd==="LineString"){for(np=0;np<zf.length;np++)vh.push(Xh(zh.id,wd,zf[np],zh.tags));continue}wd!=="LineString"&&wd!=="MultiLineString"||(zf.length===1?(wd="LineString",zf=zf[0]):wd="MultiLineString"),wd!=="Point"&&wd!=="MultiPoint"||(wd=zf.length===3?"Point":"MultiPoint"),vh.push(Xh(zh.id,wd,zf,zh.tags))}}}return vh.length?vh:null}function Sp(Gn,_n,cs,$u,eh){for(var nh=0;nh<Gn.length;nh+=3){var uh=Gn[nh+eh];uh>=cs&&uh<=$u&&(_n.push(Gn[nh]),_n.push(Gn[nh+1]),_n.push(Gn[nh+2]))}}function Pp(Gn,_n,cs,$u,eh,nh,uh){for(var dh,vh,Ph=Yf(Gn),zh=eh===0?Xd:Op,Ad=Gn.start,wd=0;wd<Gn.length-3;wd+=3){var Qd=Gn[wd],xf=Gn[wd+1],zf=Gn[wd+2],np=Gn[wd+3],Ah=Gn[wd+4],mf=eh===0?Qd:xf,Od=eh===0?np:Ah,qf=!1;uh&&(dh=Math.sqrt(Math.pow(Qd-np,2)+Math.pow(xf-Ah,2))),mf<cs?Od>cs&&(vh=zh(Ph,Qd,xf,np,Ah,cs),uh&&(Ph.start=Ad+dh*vh)):mf>$u?Od<$u&&(vh=zh(Ph,Qd,xf,np,Ah,$u),uh&&(Ph.start=Ad+dh*vh)):sm(Ph,Qd,xf,zf),Od<cs&&mf>=cs&&(vh=zh(Ph,Qd,xf,np,Ah,cs),qf=!0),Od>$u&&mf<=$u&&(vh=zh(Ph,Qd,xf,np,Ah,$u),qf=!0),!nh&&qf&&(uh&&(Ph.end=Ad+dh*vh),_n.push(Ph),Ph=Yf(Gn)),uh&&(Ad+=dh)}var mp=Gn.length-3;Qd=Gn[mp],xf=Gn[mp+1],zf=Gn[mp+2],(mf=eh===0?Qd:xf)>=cs&&mf<=$u&&sm(Ph,Qd,xf,zf),mp=Ph.length-3,nh&&mp>=3&&(Ph[mp]!==Ph[0]||Ph[mp+1]!==Ph[1])&&sm(Ph,Ph[0],Ph[1],Ph[2]),Ph.length&&_n.push(Ph)}function Yf(Gn){var _n=[];return _n.size=Gn.size,_n.start=Gn.start,_n.end=Gn.end,_n}function qp(Gn,_n,cs,$u,eh,nh){for(var uh=0;uh<Gn.length;uh++)Pp(Gn[uh],_n,cs,$u,eh,nh,!1)}function sm(Gn,_n,cs,$u){Gn.push(_n),Gn.push(cs),Gn.push($u)}function Xd(Gn,_n,cs,$u,eh,nh){var uh=(nh-_n)/($u-_n);return Gn.push(nh),Gn.push(cs+(eh-cs)*uh),Gn.push(1),uh}function Op(Gn,_n,cs,$u,eh,nh){var uh=(nh-cs)/(eh-cs);return Gn.push(_n+($u-_n)*uh),Gn.push(nh),Gn.push(1),uh}function rm(Gn,_n){for(var cs=[],$u=0;$u<Gn.length;$u++){var eh,nh=Gn[$u],uh=nh.type;if(uh==="Point"||uh==="MultiPoint"||uh==="LineString")eh=Sm(nh.geometry,_n);else if(uh==="MultiLineString"||uh==="Polygon"){eh=[];for(var dh=0;dh<nh.geometry.length;dh++)eh.push(Sm(nh.geometry[dh],_n))}else if(uh==="MultiPolygon")for(eh=[],dh=0;dh<nh.geometry.length;dh++){for(var vh=[],Ph=0;Ph<nh.geometry[dh].length;Ph++)vh.push(Sm(nh.geometry[dh][Ph],_n));eh.push(vh)}cs.push(Xh(nh.id,uh,eh,nh.tags))}return cs}function Sm(Gn,_n){var cs=[];cs.size=Gn.size,Gn.start!==void 0&&(cs.start=Gn.start,cs.end=Gn.end);for(var $u=0;$u<Gn.length;$u+=3)cs.push(Gn[$u]+_n,Gn[$u+1],Gn[$u+2]);return cs}function hp(Gn,_n){if(Gn.transformed)return Gn;var cs,$u,eh,nh=1<<Gn.z,uh=Gn.x,dh=Gn.y;for(cs=0;cs<Gn.features.length;cs++){var vh=Gn.features[cs],Ph=vh.geometry,zh=vh.type;if(vh.geometry=[],zh===1)for($u=0;$u<Ph.length;$u+=2)vh.geometry.push(Em(Ph[$u],Ph[$u+1],_n,nh,uh,dh));else for($u=0;$u<Ph.length;$u++){var Ad=[];for(eh=0;eh<Ph[$u].length;eh+=2)Ad.push(Em(Ph[$u][eh],Ph[$u][eh+1],_n,nh,uh,dh));vh.geometry.push(Ad)}}return Gn.transformed=!0,Gn}function Em(Gn,_n,cs,$u,eh,nh){return[Math.round(cs*(Gn*$u-eh)),Math.round(cs*(_n*$u-nh))]}function Qp(Gn,_n,cs,$u,eh){for(var nh=_n===eh.maxZoom?0:eh.tolerance/((1<<_n)*eh.extent),uh={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:cs,y:$u,z:_n,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},dh=0;dh<Gn.length;dh++){uh.numFeatures++,lm(uh,Gn[dh],nh,eh);var vh=Gn[dh].minX,Ph=Gn[dh].minY,zh=Gn[dh].maxX,Ad=Gn[dh].maxY;vh<uh.minX&&(uh.minX=vh),Ph<uh.minY&&(uh.minY=Ph),zh>uh.maxX&&(uh.maxX=zh),Ad>uh.maxY&&(uh.maxY=Ad)}return uh}function lm(Gn,_n,cs,$u){var eh=_n.geometry,nh=_n.type,uh=[];if(nh==="Point"||nh==="MultiPoint")for(var dh=0;dh<eh.length;dh+=3)uh.push(eh[dh]),uh.push(eh[dh+1]),Gn.numPoints++,Gn.numSimplified++;else if(nh==="LineString")Dd(uh,eh,Gn,cs,!1,!1);else if(nh==="MultiLineString"||nh==="Polygon")for(dh=0;dh<eh.length;dh++)Dd(uh,eh[dh],Gn,cs,nh==="Polygon",dh===0);else if(nh==="MultiPolygon")for(var vh=0;vh<eh.length;vh++){var Ph=eh[vh];for(dh=0;dh<Ph.length;dh++)Dd(uh,Ph[dh],Gn,cs,!0,dh===0)}if(uh.length){var zh=_n.tags||null;if(nh==="LineString"&&$u.lineMetrics){for(var Ad in zh={},_n.tags)zh[Ad]=_n.tags[Ad];zh.mapbox_clip_start=eh.start/eh.size,zh.mapbox_clip_end=eh.end/eh.size}var wd={geometry:uh,type:nh==="Polygon"||nh==="MultiPolygon"?3:nh==="LineString"||nh==="MultiLineString"?2:1,tags:zh};_n.id!==null&&(wd.id=_n.id),Gn.features.push(wd)}}function Dd(Gn,_n,cs,$u,eh,nh){var uh=$u*$u;if($u>0&&_n.size<(eh?uh:$u))cs.numPoints+=_n.length/3;else{for(var dh=[],vh=0;vh<_n.length;vh+=3)($u===0||_n[vh+2]>uh)&&(cs.numSimplified++,dh.push(_n[vh]),dh.push(_n[vh+1])),cs.numPoints++;eh&&function(Ph,zh){for(var Ad=0,wd=0,Qd=Ph.length,xf=Qd-2;wd<Qd;xf=wd,wd+=2)Ad+=(Ph[wd]-Ph[xf])*(Ph[wd+1]+Ph[xf+1]);if(Ad>0===zh)for(wd=0,Qd=Ph.length;wd<Qd/2;wd+=2){var zf=Ph[wd],np=Ph[wd+1];Ph[wd]=Ph[Qd-2-wd],Ph[wd+1]=Ph[Qd-1-wd],Ph[Qd-2-wd]=zf,Ph[Qd-1-wd]=np}}(dh,nh),Gn.push(dh)}}function Hf(Gn,_n){var cs=(_n=this.options=function(eh,nh){for(var uh in nh)eh[uh]=nh[uh];return eh}(Object.create(this.options),_n)).debug;if(cs&&console.time("preprocess data"),_n.maxZoom<0||_n.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(_n.promoteId&&_n.generateId)throw new Error("promoteId and generateId cannot be used together.");var $u=function(eh,nh){var uh=[];if(eh.type==="FeatureCollection")for(var dh=0;dh<eh.features.length;dh++)Kf(uh,eh.features[dh],nh,dh);else Kf(uh,eh.type==="Feature"?eh:{geometry:eh},nh);return uh}(Gn,_n);this.tiles={},this.tileCoords=[],cs&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",_n.indexMaxZoom,_n.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$u=function(eh,nh){var uh=nh.buffer/nh.extent,dh=eh,vh=Mp(eh,1,-1-uh,uh,0,-1,2,nh),Ph=Mp(eh,1,1-uh,2+uh,0,-1,2,nh);return(vh||Ph)&&(dh=Mp(eh,1,-uh,1+uh,0,-1,2,nh)||[],vh&&(dh=rm(vh,1).concat(dh)),Ph&&(dh=dh.concat(rm(Ph,-1)))),dh}($u,_n),$u.length&&this.splitTile($u,0,0,0),cs&&($u.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mh(Gn,_n,cs){return 32*((1<<Gn)*cs+_n)+Gn}function Jh(Gn,_n){const cs=Gn.tileID.canonical;if(!this._geoJSONIndex)return _n(null,null);const $u=this._geoJSONIndex.getTile(cs.z,cs.x,cs.y);if(!$u)return _n(null,null);const eh=new Io($u.features);let nh=rl(eh);nh.byteOffset===0&&nh.byteLength===nh.buffer.byteLength||(nh=new Uint8Array(nh)),_n(null,{vectorTile:eh,rawData:nh.buffer})}Hf.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hf.prototype.splitTile=function(Gn,_n,cs,$u,eh,nh,uh){for(var dh=[Gn,_n,cs,$u],vh=this.options,Ph=vh.debug;dh.length;){$u=dh.pop(),cs=dh.pop(),_n=dh.pop(),Gn=dh.pop();var zh=1<<_n,Ad=mh(_n,cs,$u),wd=this.tiles[Ad];if(!wd&&(Ph>1&&console.time("creation"),wd=this.tiles[Ad]=Qp(Gn,_n,cs,$u,vh),this.tileCoords.push({z:_n,x:cs,y:$u}),Ph)){Ph>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",_n,cs,$u,wd.numFeatures,wd.numPoints,wd.numSimplified),console.timeEnd("creation"));var Qd="z"+_n;this.stats[Qd]=(this.stats[Qd]||0)+1,this.total++}if(wd.source=Gn,eh){if(_n===vh.maxZoom||_n===eh)continue;var xf=1<<eh-_n;if(cs!==Math.floor(nh/xf)||$u!==Math.floor(uh/xf))continue}else if(_n===vh.indexMaxZoom||wd.numPoints<=vh.indexMaxPoints)continue;if(wd.source=null,Gn.length!==0){Ph>1&&console.time("clipping");var zf,np,Ah,mf,Od,qf,mp=.5*vh.buffer/vh.extent,Vp=.5-mp,om=.5+mp,Pd=1+mp;zf=np=Ah=mf=null,Od=Mp(Gn,zh,cs-mp,cs+om,0,wd.minX,wd.maxX,vh),qf=Mp(Gn,zh,cs+Vp,cs+Pd,0,wd.minX,wd.maxX,vh),Gn=null,Od&&(zf=Mp(Od,zh,$u-mp,$u+om,1,wd.minY,wd.maxY,vh),np=Mp(Od,zh,$u+Vp,$u+Pd,1,wd.minY,wd.maxY,vh),Od=null),qf&&(Ah=Mp(qf,zh,$u-mp,$u+om,1,wd.minY,wd.maxY,vh),mf=Mp(qf,zh,$u+Vp,$u+Pd,1,wd.minY,wd.maxY,vh),qf=null),Ph>1&&console.timeEnd("clipping"),dh.push(zf||[],_n+1,2*cs,2*$u),dh.push(np||[],_n+1,2*cs,2*$u+1),dh.push(Ah||[],_n+1,2*cs+1,2*$u),dh.push(mf||[],_n+1,2*cs+1,2*$u+1)}}},Hf.prototype.getTile=function(Gn,_n,cs){var $u=this.options,eh=$u.extent,nh=$u.debug;if(Gn<0||Gn>24)return null;var uh=1<<Gn,dh=mh(Gn,_n=(_n%uh+uh)%uh,cs);if(this.tiles[dh])return hp(this.tiles[dh],eh);nh>1&&console.log("drilling down to z%d-%d-%d",Gn,_n,cs);for(var vh,Ph=Gn,zh=_n,Ad=cs;!vh&&Ph>0;)Ph--,zh=Math.floor(zh/2),Ad=Math.floor(Ad/2),vh=this.tiles[mh(Ph,zh,Ad)];return vh&&vh.source?(nh>1&&console.log("found parent tile z%d-%d-%d",Ph,zh,Ad),nh>1&&console.time("drilling down"),this.splitTile(vh.source,Ph,zh,Ad,Gn,_n,cs),nh>1&&console.timeEnd("drilling down"),this.tiles[dh]?hp(this.tiles[dh],eh):null):null};class Wu extends o.VectorTileWorkerSource{constructor(_n,cs,$u,eh,nh){super(_n,cs,$u,eh,Jh),nh&&(this.loadGeoJSON=nh)}loadData(_n,cs){const $u=_n&&_n.request,eh=$u&&$u.collectResourceTiming;this.loadGeoJSON(_n,(nh,uh)=>{if(nh||!uh)return cs(nh);if(typeof uh!="object")return cs(new Error(`Input data given to '${_n.source}' is not a valid GeoJSON object.`));{ze(uh,!0);try{if(_n.filter){const vh=o.createExpression(_n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(vh.result==="error")throw new Error(vh.value.map(zh=>`${zh.key}: ${zh.message}`).join(", "));uh={type:"FeatureCollection",features:uh.features.filter(zh=>vh.value.evaluate({zoom:0},zh))}}this._geoJSONIndex=_n.cluster?new td(function({superclusterOptions:vh,clusterProperties:Ph}){if(!Ph||!vh)return vh;const zh={},Ad={},wd={accumulated:null,zoom:0},Qd={properties:null},xf=Object.keys(Ph);for(const zf of xf){const[np,Ah]=Ph[zf],mf=o.createExpression(Ah),Od=o.createExpression(typeof np=="string"?[np,["accumulated"],["get",zf]]:np);zh[zf]=mf.value,Ad[zf]=Od.value}return vh.map=zf=>{Qd.properties=zf;const np={};for(const Ah of xf)np[Ah]=zh[Ah].evaluate(wd,Qd);return np},vh.reduce=(zf,np)=>{Qd.properties=np;for(const Ah of xf)wd.accumulated=zf[Ah],zf[Ah]=Ad[Ah].evaluate(wd,Qd)},vh}(_n)).load(uh.features):function(vh,Ph){return new Hf(vh,Ph)}(uh,_n.geojsonVtOptions)}catch(vh){return cs(vh)}this.loaded={};const dh={};if(eh){const vh=o.getPerformanceMeasurement($u);vh&&(dh.resourceTiming={},dh.resourceTiming[_n.source]=JSON.parse(JSON.stringify(vh)))}cs(null,dh)}})}reloadTile(_n,cs){const $u=this.loaded;return $u&&$u[_n.uid]?super.reloadTile(_n,cs):this.loadTile(_n,cs)}loadGeoJSON(_n,cs){if(_n.request)o.getJSON(_n.request,cs);else{if(typeof _n.data!="string")return cs(new Error(`Input data given to '${_n.source}' is not a valid GeoJSON object.`));try{return cs(null,JSON.parse(_n.data))}catch{return cs(new Error(`Input data given to '${_n.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(_n,cs){try{cs(null,this._geoJSONIndex.getClusterExpansionZoom(_n.clusterId))}catch($u){cs($u)}}getClusterChildren(_n,cs){try{cs(null,this._geoJSONIndex.getChildren(_n.clusterId))}catch($u){cs($u)}}getClusterLeaves(_n,cs){try{cs(null,this._geoJSONIndex.getLeaves(_n.clusterId,_n.limit,_n.offset))}catch($u){cs($u)}}}class sl{constructor(_n){this.self=_n,this.actor=new o.Actor(_n,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Wu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(cs,$u)=>{if(this.workerSourceTypes[cs])throw new Error(`Worker source with name "${cs}" already registered.`);this.workerSourceTypes[cs]=$u},this.self.registerRTLTextPlugin=cs=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=cs.applyArabicShaping,o.plugin.processBidirectionalText=cs.processBidirectionalText,o.plugin.processStyledBidirectionalText=cs.processStyledBidirectionalText}}clearCaches(_n,cs,$u){delete this.layerIndexes[_n],delete this.availableImages[_n],delete this.workerSources[_n],delete this.demWorkerSources[_n],$u()}checkIfReady(_n,cs,$u){$u()}setReferrer(_n,cs){this.referrer=cs}spriteLoaded(_n,cs){this.isSpriteLoaded[_n]=cs;for(const $u in this.workerSources[_n]){const eh=this.workerSources[_n][$u];for(const nh in eh)eh[nh]instanceof o.VectorTileWorkerSource&&(eh[nh].isSpriteLoaded=cs,eh[nh].fire(new o.Event("isSpriteLoaded")))}}setImages(_n,cs,$u){this.availableImages[_n]=cs;for(const eh in this.workerSources[_n]){const nh=this.workerSources[_n][eh];for(const uh in nh)nh[uh].availableImages=cs}$u()}enableTerrain(_n,cs,$u){this.terrain=cs,$u()}setProjection(_n,cs){this.projections[_n]=o.getProjection(cs)}setLayers(_n,cs,$u){this.getLayerIndex(_n).replace(cs),$u()}updateLayers(_n,cs,$u){this.getLayerIndex(_n).update(cs.layers,cs.removedIds),$u()}loadTile(_n,cs,$u){const eh=this.enableTerrain?o.extend({enableTerrain:this.terrain},cs):cs;eh.projection=this.projections[_n]||this.defaultProjection,this.getWorkerSource(_n,cs.type,cs.source).loadTile(eh,$u)}loadDEMTile(_n,cs,$u){const eh=this.enableTerrain?o.extend({buildQuadTree:this.terrain},cs):cs;this.getDEMWorkerSource(_n,cs.source).loadTile(eh,$u)}reloadTile(_n,cs,$u){const eh=this.enableTerrain?o.extend({enableTerrain:this.terrain},cs):cs;eh.projection=this.projections[_n]||this.defaultProjection,this.getWorkerSource(_n,cs.type,cs.source).reloadTile(eh,$u)}abortTile(_n,cs,$u){this.getWorkerSource(_n,cs.type,cs.source).abortTile(cs,$u)}removeTile(_n,cs,$u){this.getWorkerSource(_n,cs.type,cs.source).removeTile(cs,$u)}removeSource(_n,cs,$u){if(!this.workerSources[_n]||!this.workerSources[_n][cs.type]||!this.workerSources[_n][cs.type][cs.source])return;const eh=this.workerSources[_n][cs.type][cs.source];delete this.workerSources[_n][cs.type][cs.source],eh.removeSource!==void 0?eh.removeSource(cs,$u):$u()}loadWorkerSource(_n,cs,$u){try{this.self.importScripts(cs.url),$u()}catch(eh){$u(eh.toString())}}syncRTLPluginState(_n,cs,$u){try{o.plugin.setState(cs);const eh=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&eh!=null){this.self.importScripts(eh);const nh=o.plugin.isParsed();$u(nh?void 0:new Error(`RTL Text Plugin failed to import scripts from ${eh}`),nh)}}catch(eh){$u(eh.toString())}}getAvailableImages(_n){let cs=this.availableImages[_n];return cs||(cs=[]),cs}getLayerIndex(_n){let cs=this.layerIndexes[_n];return cs||(cs=this.layerIndexes[_n]=new P),cs}getWorkerSource(_n,cs,$u){if(this.workerSources[_n]||(this.workerSources[_n]={}),this.workerSources[_n][cs]||(this.workerSources[_n][cs]={}),!this.workerSources[_n][cs][$u]){const eh={send:(nh,uh,dh,vh,Ph,zh)=>{this.actor.send(nh,uh,dh,_n,Ph,zh)},scheduler:this.actor.scheduler};this.workerSources[_n][cs][$u]=new this.workerSourceTypes[cs](eh,this.getLayerIndex(_n),this.getAvailableImages(_n),this.isSpriteLoaded[_n])}return this.workerSources[_n][cs][$u]}getDEMWorkerSource(_n,cs){return this.demWorkerSources[_n]||(this.demWorkerSources[_n]={}),this.demWorkerSources[_n][cs]||(this.demWorkerSources[_n][cs]=new Y),this.demWorkerSources[_n][cs]}enforceCacheSizeLimit(_n,cs){o.enforceCacheSizeLimit(cs)}getWorkerPerformanceMetrics(_n,cs,$u){$u(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new sl(self)),sl}),s(["./shared"],function(o){function x(L,u){if(Array.isArray(L)){if(!Array.isArray(u)||L.length!==u.length)return!1;for(let E=0;E<L.length;E++)if(!x(L[E],u[E]))return!1;return!0}if(typeof L=="object"&&L!==null&&u!==null){if(typeof u!="object"||Object.keys(L).length!==Object.keys(u).length)return!1;for(const E in L)if(!x(L[E],u[E]))return!1;return!0}return L===u}var C=P;function P(L){return!function(u){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var B,_e,St=new Blob([""],{type:"text/javascript"}),mr=URL.createObjectURL(St);try{_e=new Worker(mr),B=!0}catch{B=!1}return _e&&_e.terminate(),URL.revokeObjectURL(mr),B}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var B=document.createElement("canvas");B.width=B.height=1;var _e=B.getContext("2d");if(!_e)return!1;var St=_e.getImageData(0,0,1,1);return St&&St.width===B.width}()?(Y[E=u&&u.failIfMajorPerformanceCaveat]===void 0&&(Y[E]=function(B){var _e,St=function(mr){var qr=document.createElement("canvas"),ss=Object.create(P.webGLContextAttributes);return ss.failIfMajorPerformanceCaveat=mr,qr.getContext("webgl",ss)||qr.getContext("experimental-webgl",ss)}(B);if(!St)return!1;try{_e=St.createShader(St.VERTEX_SHADER)}catch{return!1}return!(!_e||St.isContextLost())&&(St.shaderSource(_e,"void main() {}"),St.compileShader(_e),St.getShaderParameter(_e,St.COMPILE_STATUS)===!0)}(E)),Y[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var E}(L)}var Y={};function ze(L,u,E){const B=o.window.document.createElement(L);return u!==void 0&&(B.className=u),E&&E.appendChild(B),B}function ge(L,u,E){const B=o.window.document.createElementNS("http://www.w3.org/2000/svg",L);for(const _e of Object.keys(u))B.setAttributeNS(null,_e,u[_e]);return E&&E.appendChild(B),B}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Bt=o.window.document&&o.window.document.documentElement.style,Ur=Bt&&Bt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let kn;function Io(){Bt&&Ur&&(kn=Bt[Ur],Bt[Ur]="none")}function rl(){Bt&&Ur&&(Bt[Ur]=kn)}function Co(L){L.preventDefault(),L.stopPropagation(),o.window.removeEventListener("click",Co,!0)}function as(){o.window.addEventListener("click",Co,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Co,!0)},0)}function $s(L,u){const E=L.getBoundingClientRect();return Zu(L,E,u)}function ah(L,u){const E=L.getBoundingClientRect(),B=[];for(let _e=0;_e<u.length;_e++)B.push(Zu(L,E,u[_e]));return B}function ch(L){return o.window.InstallTrigger!==void 0&&L.button===2&&L.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:L.button}function Zu(L,u,E){const B=L.offsetWidth===u.width?1:L.offsetWidth/u.width;return new o.pointGeometry((E.clientX-u.left)*B,(E.clientY-u.top)*B)}function ih(L,u){var E=u[0],B=u[1],_e=u[2],St=u[3],mr=E*St-_e*B;return mr?(L[0]=St*(mr=1/mr),L[1]=-B*mr,L[2]=-_e*mr,L[3]=E*mr,L):null}function al(L){const{userImage:u}=L;return!!(u&&u.render&&u.render())&&(L.data.replace(new Uint8Array(u.data.buffer)),!0)}class sh extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:E,callback:B}of this.requestors)this._notify(E,B);this.requestors=[]}}hasImage(u){return!!this.getImage(u)}getImage(u){return this.images[u]}addImage(u,E){this._validate(u,E)&&(this.images[u]=E)}_validate(u,E){let B=!0;return this._validateStretch(E.stretchX,E.data&&E.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "stretchX" value`))),B=!1),this._validateStretch(E.stretchY,E.data&&E.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "stretchY" value`))),B=!1),this._validateContent(E.content,E)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "content" value`))),B=!1),B}_validateStretch(u,E){if(!u)return!0;let B=0;for(const _e of u){if(_e[0]<B||_e[1]<_e[0]||E<_e[1])return!1;B=_e[1]}return!0}_validateContent(u,E){return!(u&&(u.length!==4||u[0]<0||E.data.width<u[0]||u[1]<0||E.data.height<u[1]||u[2]<0||E.data.width<u[2]||u[3]<0||E.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))}updateImage(u,E){E.version=this.images[u].version+1,this.images[u]=E,this.updatedImages[u]=!0}removeImage(u){const E=this.images[u];delete this.images[u],delete this.patterns[u],E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u,E){let B=!0;if(!this.isLoaded())for(const _e of u)this.images[_e]||(B=!1);this.isLoaded()||B?this._notify(u,E):this.requestors.push({ids:u,callback:E})}_notify(u,E){const B={};for(const _e of u){this.images[_e]||this.fire(new o.Event("styleimagemissing",{id:_e}));const St=this.images[_e];St?B[_e]={data:St.data.clone(),pixelRatio:St.pixelRatio,sdf:St.sdf,version:St.version,stretchX:St.stretchX,stretchY:St.stretchY,content:St.content,hasRenderCallback:!!(St.userImage&&St.userImage.render)}:o.warnOnce(`Image "${_e}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}E(null,B)}getPixelSize(){const{width:u,height:E}=this.atlasImage;return{width:u,height:E}}getPattern(u){const E=this.patterns[u],B=this.getImage(u);if(!B)return null;if(E&&E.position.version===B.version)return E.position;if(E)E.position.version=B.version;else{const _e={w:B.data.width+2,h:B.data.height+2,x:0,y:0},St=new o.ImagePosition(_e,B);this.patterns[u]={bin:_e,position:St}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const E=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(u,this.atlasImage,E.RGBA),this.atlasTexture&&this.atlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const St in this.patterns)u.push(this.patterns[St].bin);const{w:E,h:B}=o.potpack(u),_e=this.atlasImage;_e.resize({width:E||1,height:B||1});for(const St in this.patterns){const{bin:mr}=this.patterns[St],qr=mr.x+1,ss=mr.y+1,tl=this.images[St].data,il=tl.width,Qu=tl.height;o.RGBAImage.copy(tl,_e,{x:0,y:0},{x:qr,y:ss},{width:il,height:Qu}),o.RGBAImage.copy(tl,_e,{x:0,y:Qu-1},{x:qr,y:ss-1},{width:il,height:1}),o.RGBAImage.copy(tl,_e,{x:0,y:0},{x:qr,y:ss+Qu},{width:il,height:1}),o.RGBAImage.copy(tl,_e,{x:il-1,y:0},{x:qr-1,y:ss},{width:1,height:Qu}),o.RGBAImage.copy(tl,_e,{x:0,y:0},{x:qr+il,y:ss},{width:1,height:Qu})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const E of u){if(this.callbackDispatchedThisFrame[E])continue;this.callbackDispatchedThisFrame[E]=!0;const B=this.images[E];al(B)&&this.updateImage(E,B)}}}const _h=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(L,u){return function([E,B,_e]){const St=o.degToRad(B+90),mr=o.degToRad(_e);return{x:E*Math.cos(St)*Math.sin(mr),y:E*Math.sin(St)*Math.sin(mr),z:E*Math.cos(mr),azimuthal:B,polar:_e}}(L.expression.evaluate(u))}interpolate(L,u,E){return{x:o.number(L.x,u.x,E),y:o.number(L.y,u.y,E),z:o.number(L.z,u.z,E),azimuthal:o.number(L.azimuthal,u.azimuthal,E),polar:o.number(L.polar,u.polar,E)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Ih="-transition";class Lh extends o.Evented{constructor(u){super(),this._transitionable=new o.Transitionable(_h),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,E={}){if(!this._validate(o.validateLight,u,E))for(const B in u){const _e=u[B];o.endsWith(B,Ih)?this._transitionable.setTransition(B.slice(0,-Ih.length),_e):this._transitionable.setValue(B,_e)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,E,B){return(!B||B.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:E,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Gh=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),ud="-transition";class Tf extends o.Evented{constructor(u,E){super(),this._transitionable=new o.Transitionable(Gh),this.set(u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=E}get(){return this._transitionable.serialize()}set(u){for(const E in u){const B=u[E];o.endsWith(E,ud)?this._transitionable.setTransition(E.slice(0,-ud.length),B):this._transitionable.setValue(E,B)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}}function Kd(L,u,E,B){const _e=o.smoothstep(45,65,E),[St,mr]=Af(L,B),qr=o.length(u);let ss=1-Math.min(1,Math.exp((qr-St)/(mr-St)*-6));return ss*=ss*ss,ss=Math.min(1,1.00747*ss),ss*_e*L.alpha}function Af(L,u){const E=.5/Math.tan(.5*u);return[L.range[0]+E,L.range[1]+E]}const md=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),vd="-transition";class qd extends o.Evented{constructor(u,E){super(),this._transitionable=new o.Transitionable(md),this.set(u),this._transitioning=this._transitionable.untransitioned(),this._transform=E}get state(){const u=this._transform,E=u.projection.name==="globe",B=o.globeToMercatorTransition(u.zoom),_e=this.properties.get("range"),St=[.5,3];return{range:E?[o.number(St[0],_e[0],B),o.number(St[1],_e[1],B)]:_e,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(u,E={}){if(!this._validate(o.validateFog,u,E)){for(const B of Object.keys(o.spec.fog))u&&u[B]===void 0&&(u[B]=o.spec.fog[B].default);for(const B in u){const _e=u[B];o.endsWith(B,vd)?this._transitionable.setTransition(B.slice(0,-vd.length),_e):this._transitionable.setValue(B,_e)}}}getOpacity(u){if(!this._transform.projection.supportsFog)return 0;const E=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,u))*E.a}getOpacityAtLatLng(u,E){return this._transform.projection.supportsFog?function(B,_e,St){const mr=o.MercatorCoordinate.fromLngLat(_e),qr=St.elevation?St.elevation.getAtPointOrZero(mr):0,ss=[mr.x,mr.y,qr];return o.transformMat4(ss,ss,St.mercatorFogMatrix),Kd(B,ss,St.pitch,St._fov)}(this.state,u,E):0}getFovAdjustedRange(u){return this._transform.projection.supportsFog?Af(this.state,u):[0,1]}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,E,B){return(!B||B.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:E,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Ed{constructor(u,E){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const B=this.workerPool.acquire(this.id);for(let _e=0;_e<B.length;_e++){const St=new Ed.Actor(B[_e],E,this.id);St.name=`Worker ${_e}`,this.actors.push(St)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(u,E,B){o.asyncAll(this.actors,(_e,St)=>{_e.send(u,E,St)},B=B||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(u=>{u.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Sd(L,u,E){return u*(o.EXTENT/(L.tileSize*Math.pow(2,E-L.tileID.overscaledZ)))}Ed.Actor=o.Actor;class zd{constructor(u,E,B,_e){this.screenBounds=u,this.cameraPoint=E,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=B,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_e)}static createFromScreenPoints(u,E){let B,_e;if(u instanceof o.pointGeometry||typeof u[0]=="number"){const St=o.pointGeometry.convert(u);B=[St],_e=E.isPointAboveHorizon(St)}else{const St=o.pointGeometry.convert(u[0]),mr=o.pointGeometry.convert(u[1]);B=[St,mr],_e=o.polygonizeBounds(St,mr).every(qr=>E.isPointAboveHorizon(qr))}return new zd(B,E.getCameraPoint(),_e,E)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(u){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],u)}bufferedCameraGeometry(u){const E=this.screenBounds[0],B=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_e=o.polygonizeBounds(E,B,0,!1);return this.cameraPoint.y>B.y&&(this.cameraPoint.x>E.x&&this.cameraPoint.x<B.x?_e.splice(3,0,this.cameraPoint):this.cameraPoint.x>=B.x?_e[2]=this.cameraPoint:this.cameraPoint.x<=E.x&&(_e[3]=this.cameraPoint)),o.bufferConvexPolygon(_e,u)}bufferedCameraGeometryGlobe(u){const E=this.screenBounds[0],B=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_e=o.polygonizeBounds(E,B,u),St=this.cameraPoint.clone();switch(3*((St.y>E.y)+(St.y>B.y))+((St.x>E.x)+(St.x>B.x))){case 0:_e[0]=St,_e[4]=St.clone();break;case 1:_e.splice(1,0,St);break;case 2:_e[1]=St;break;case 3:_e.splice(4,0,St);break;case 5:_e.splice(2,0,St);break;case 6:_e[3]=St;break;case 7:_e.splice(3,0,St);break;case 8:_e[2]=St}return _e}containsTile(u,E,B,_e=0){const St=u.queryPadding/E._pixelsPerMercatorPixel+1,mr=B?this._bufferedCameraMercator(St,E):this._bufferedScreenMercator(St,E);let qr=u.tileID.wrap+(mr.unwrapped?_e:0);const ss=mr.polygon.map(Ch=>o.getTilePoint(u.tileTransform,Ch,qr));if(!o.polygonIntersectsBox(ss,0,0,o.EXTENT,o.EXTENT))return;qr=u.tileID.wrap+(this.screenGeometryMercator.unwrapped?_e:0);const tl=this.screenGeometryMercator.polygon.map(Ch=>o.getTileVec3(u.tileTransform,Ch,qr)),il=tl.map(Ch=>new o.pointGeometry(Ch[0],Ch[1])),Qu=E.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),fh=o.getTileVec3(u.tileTransform,Qu,qr),wh=tl.map(Ch=>{const hh=o.sub(Ch,Ch,fh);return o.normalize(hh,hh),new o.Ray(fh,hh)}),Sh=Sd(u,1,E.zoom)*E._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:il,tilespaceRays:wh,bufferedTilespaceGeometry:ss,bufferedTilespaceBounds:(Th=o.getBounds(ss),Th.min.x=o.clamp(Th.min.x,0,o.EXTENT),Th.min.y=o.clamp(Th.min.y,0,o.EXTENT),Th.max.x=o.clamp(Th.max.x,0,o.EXTENT),Th.max.y=o.clamp(Th.max.y,0,o.EXTENT),Th),tile:u,tileID:u.tileID,pixelToTileUnitsFactor:Sh};var Th}_bufferedScreenMercator(u,E){const B=bf(u);if(this._screenRaycastCache[B])return this._screenRaycastCache[B];{let _e;return _e=E.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(u),E):{polygon:this.bufferedScreenGeometry(u).map(St=>E.pointCoordinate3D(St)),unwrapped:!0},this._screenRaycastCache[B]=_e,_e}}_bufferedCameraMercator(u,E){const B=bf(u);if(this._cameraRaycastCache[B])return this._cameraRaycastCache[B];{let _e;return _e=E.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(u),E):{polygon:this.bufferedCameraGeometry(u).map(St=>E.pointCoordinate3D(St)),unwrapped:!0},this._cameraRaycastCache[B]=_e,_e}}_projectAndResample(u,E){const B=function(St,mr){const qr=o.multiply([],mr.pixelMatrix,mr.globeMatrix),ss=[0,-o.GLOBE_RADIUS,0,1],tl=[0,o.GLOBE_RADIUS,0,1],il=[0,0,0,1];o.transformMat4$1(ss,ss,qr),o.transformMat4$1(tl,tl,qr),o.transformMat4$1(il,il,qr);const Qu=new o.pointGeometry(ss[0]/ss[3],ss[1]/ss[3]),fh=new o.pointGeometry(tl[0]/tl[3],tl[1]/tl[3]),wh=o.polygonContainsPoint(St,Qu)&&ss[3]<il[3],Sh=o.polygonContainsPoint(St,fh)&&tl[3]<il[3];if(!wh&&!Sh)return null;const Th=function(Hh,ld,xd){for(let gd=1;gd<Hh.length;gd++){const Vf=Gd(ld.pointCoordinate3D(Hh[gd-1]).x),_d=Gd(ld.pointCoordinate3D(Hh[gd]).x);if(xd<0){if(Vf<_d)return{idx:gd,t:-Vf/(_d-1-Vf)}}else if(_d<Vf)return{idx:gd,t:(1-Vf)/(_d+1-Vf)}}return null}(St,mr,wh?-1:1);if(!Th)return null;const{idx:Ch,t:hh}=Th;let Oh=Ch>1?Md(St.slice(0,Ch),mr):[],Rh=Ch<St.length?Md(St.slice(Ch),mr):[];Oh=Oh.map(Hh=>new o.pointGeometry(Gd(Hh.x),Hh.y)),Rh=Rh.map(Hh=>new o.pointGeometry(Gd(Hh.x),Hh.y));const Nh=[...Oh];Nh.length===0&&Nh.push(Rh[Rh.length-1]);const qh=o.number(Nh[Nh.length-1].y,(Rh.length===0?Oh[0]:Rh[0]).y,hh);let Fh;return Fh=wh?[new o.pointGeometry(0,qh),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,qh)]:[new o.pointGeometry(1,qh),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,qh)],Nh.push(...Fh),Rh.length===0?Nh.push(Oh[0]):Nh.push(...Rh),{polygon:Nh.map(Hh=>new o.MercatorCoordinate(Hh.x,Hh.y)),unwrapped:!1}}(u,E);if(B)return B;const _e=function(St,mr){let qr=!1,ss=-1/0,tl=0;for(let Qu=0;Qu<St.length-1;Qu++)St[Qu].x>ss&&(ss=St[Qu].x,tl=Qu);for(let Qu=0;Qu<St.length-1;Qu++){const fh=(tl+Qu)%(St.length-1),wh=St[fh],Sh=St[fh+1];Math.abs(wh.x-Sh.x)>.5&&(wh.x<Sh.x?(wh.x+=1,fh===0&&(St[St.length-1].x+=1)):(Sh.x+=1,fh+1===St.length-1&&(St[0].x+=1)),qr=!0)}const il=o.mercatorXfromLng(mr.center.lng);return qr&&il<Math.abs(il-1)&&St.forEach(Qu=>{Qu.x-=1}),{polygon:St,unwrapped:qr}}(Md(u,E).map(St=>new o.pointGeometry(Gd(St.x),St.y)),E);return{polygon:_e.polygon.map(St=>new o.MercatorCoordinate(St.x,St.y)),unwrapped:_e.unwrapped}}}function Md(L,u){return o.resample(L,E=>{const B=u.pointCoordinate3D(E);E.x=B.x,E.y=B.y},1/256)}function Gd(L){return L<0?1+L%1:L%1}function bf(L){return 100*L|0}function Id(L,u,E,B,_e){const St=function(mr,qr){if(mr)return _e(mr);if(qr){L.url&&qr.tiles&&L.tiles&&delete L.tiles;const ss=o.pick(o.extend(qr,L),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);qr.vector_layers&&(ss.vectorLayers=qr.vector_layers,ss.vectorLayerIds=ss.vectorLayers.map(tl=>tl.id)),ss.tiles=u.canonicalizeTileset(ss,L.url),_e(null,ss)}};return L.url?o.getJSON(u.transformRequest(u.normalizeSourceURL(L.url,null,E,B),o.ResourceType.Source),St):o.exported.frame(()=>St(null,L))}class td{constructor(u,E,B){this.bounds=o.LngLatBounds.convert(this.validateBounds(u)),this.minzoom=E||0,this.maxzoom=B||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const E=Math.pow(2,u.z),B=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*E),_e=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*E),St=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*E),mr=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*E);return u.x>=B&&u.x<St&&u.y>=_e&&u.y<mr}}class Fd{constructor(u,E,B){this.context=u;const _e=u.gl;this.buffer=_e.createBuffer(),this.dynamicDraw=!!B,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),_e.bufferData(_e.ELEMENT_ARRAY_BUFFER,E.arrayBuffer,this.dynamicDraw?_e.DYNAMIC_DRAW:_e.STATIC_DRAW),this.dynamicDraw||E.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const E=this.context.gl;this.context.unbindVAO(),this.bind(),E.bufferSubData(E.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const rp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jf{constructor(u,E,B,_e){this.length=E.length,this.attributes=B,this.itemSize=E.bytesPerElement,this.dynamicDraw=_e,this.context=u;const St=u.gl;this.buffer=St.createBuffer(),u.bindVertexBuffer.set(this.buffer),St.bufferData(St.ARRAY_BUFFER,E.arrayBuffer,this.dynamicDraw?St.DYNAMIC_DRAW:St.STATIC_DRAW),this.dynamicDraw||E.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){const E=this.context.gl;this.bind(),E.bufferSubData(E.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,E){for(let B=0;B<this.attributes.length;B++){const _e=E.attributes[this.attributes[B].name];_e!==void 0&&u.enableVertexAttribArray(_e)}}setVertexAttribPointers(u,E,B){for(let _e=0;_e<this.attributes.length;_e++){const St=this.attributes[_e],mr=E.attributes[St.name];mr!==void 0&&u.vertexAttribPointer(mr,St.components,u[rp[St.type]],!1,this.itemSize,St.offset+this.itemSize*(B||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yd{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jd extends yd{getDefault(){return o.Color.transparent}set(u){const E=this.current;(u.r!==E.r||u.g!==E.g||u.b!==E.b||u.a!==E.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class op extends yd{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class bp extends yd{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class fp extends yd{getDefault(){return[!0,!0,!0,!0]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||u[3]!==E[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class Qh extends yd{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class Yd extends yd{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class sd extends yd{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const E=this.current;(u.func!==E.func||u.ref!==E.ref||u.mask!==E.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class Zd extends yd{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Xh extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.STENCIL_TEST):E.disable(E.STENCIL_TEST),this.current=u,this.dirty=!1}}class Ld extends yd{getDefault(){return[0,1]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class Kf extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.DEPTH_TEST):E.disable(E.DEPTH_TEST),this.current=u,this.dirty=!1}}class If extends yd{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class Df extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.BLEND):E.disable(E.BLEND),this.current=u,this.dirty=!1}}class Jf extends yd{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class Nf extends yd{getDefault(){return o.Color.transparent}set(u){const E=this.current;(u.r!==E.r||u.g!==E.g||u.b!==E.b||u.a!==E.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Wf extends yd{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class Mp extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.CULL_FACE):E.disable(E.CULL_FACE),this.current=u,this.dirty=!1}}class Sp extends yd{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class Pp extends yd{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class Yf extends yd{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class qp extends yd{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class sm extends yd{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||u[3]!==E[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class Xd extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindFramebuffer(E.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class Op extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindRenderbuffer(E.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class rm extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindTexture(E.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Sm extends yd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindBuffer(E.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class hp extends yd{getDefault(){return null}set(u){const E=this.gl;E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Em extends yd{constructor(u){super(u),this.vao=u.extVertexArrayObject}getDefault(){return null}set(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)}}class Qp extends yd{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class lm extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class Dd extends yd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Hf extends yd{constructor(u,E){super(u),this.context=u,this.parent=E}getDefault(){return null}}class mh extends Hf{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const E=this.gl;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Jh extends Hf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const E=this.gl;E.framebufferRenderbuffer(E.FRAMEBUFFER,this.attachment(),E.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Wu extends Jh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class sl{constructor(u,E,B,_e){this.context=u,this.width=E,this.height=B;const St=this.framebuffer=u.gl.createFramebuffer();this.colorAttachment=new mh(u,St),_e&&(this.depthAttachment=new Jh(u,St))}destroy(){const u=this.context.gl,E=this.colorAttachment.get();if(E&&u.deleteTexture(E),this.depthAttachment){const B=this.depthAttachment.get();B&&u.deleteRenderbuffer(B)}u.deleteFramebuffer(this.framebuffer)}}class Gn{constructor(u,E=!1){if(this.gl=u,this.isWebGL2=E,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),E){const B=u;this.extVertexArrayObject={createVertexArrayOES:B.createVertexArray.bind(u),deleteVertexArrayOES:B.deleteVertexArray.bind(u),bindVertexArrayOES:B.bindVertexArray.bind(u)}}this.clearColor=new Jd(this),this.clearDepth=new op(this),this.clearStencil=new bp(this),this.colorMask=new fp(this),this.depthMask=new Qh(this),this.stencilMask=new Yd(this),this.stencilFunc=new sd(this),this.stencilOp=new Zd(this),this.stencilTest=new Xh(this),this.depthRange=new Ld(this),this.depthTest=new Kf(this),this.depthFunc=new If(this),this.blend=new Df(this),this.blendFunc=new Jf(this),this.blendColor=new Nf(this),this.blendEquation=new Wf(this),this.cullFace=new Mp(this),this.cullFaceSide=new Sp(this),this.frontFace=new Pp(this),this.program=new Yf(this),this.activeTexture=new qp(this),this.viewport=new sm(this),this.bindFramebuffer=new Xd(this),this.bindRenderbuffer=new Op(this),this.bindTexture=new rm(this),this.bindVertexBuffer=new Sm(this),this.bindElementBuffer=new hp(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Em(this),this.pixelStoreUnpack=new Qp(this),this.pixelStoreUnpackPremultiplyAlpha=new lm(this),this.pixelStoreUnpackFlipY=new Dd(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=u.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=u.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=u.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),E||(this.extTextureHalfFloat=u.getExtension("OES_texture_half_float")),(E||this.extTextureHalfFloat&&u.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=E||u.getExtension("OES_standard_derivatives"),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,E){return new Fd(this,u,E)}createVertexBuffer(u,E,B){return new jf(this,u,E,B)}createRenderbuffer(u,E,B){const _e=this.gl,St=_e.createRenderbuffer();return this.bindRenderbuffer.set(St),_e.renderbufferStorage(_e.RENDERBUFFER,u,E,B),this.bindRenderbuffer.set(null),St}createFramebuffer(u,E,B){return new sl(this,u,E,B)}clear({color:u,depth:E,stencil:B}){const _e=this.gl;let St=0;u&&(St|=_e.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),E!==void 0&&(St|=_e.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(E),this.depthMask.set(!0)),B!==void 0&&(St|=_e.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),_e.clear(St)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){x(u.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class _n extends o.Evented{constructor(u,E,B,_e){if(super(),this.id=u,this.dispatcher=B,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(E,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},E),this._collectResourceTiming=E.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_e),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const E=Array.isArray(this.map._language)?this.map._language.join():this.map._language,B=this.map._worldview;this._tileJSONRequest=Id(this._options,this.map._requestManager,E,B,(_e,St)=>{this._tileJSONRequest=null,this._loaded=!0,_e?(E&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${E}`),B&&B.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${B}`),this.fire(new o.ErrorEvent(_e))):St&&(o.extend(this,St),St.bounds&&(this.tileBounds=new td(St.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(St.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(_e)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(u,E){const B=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),_e={request:this.map._requestManager.transformRequest(B,o.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(_e.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=E:u.request=u.actor.send("reloadTile",_e,St.bind(this));else if(u.actor=this._tileWorkers[B]=this._tileWorkers[B]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",_e,St.bind(this),void 0,!0);else{const mr=o.loadVectorTile.call({deduped:this._deduped},_e,(qr,ss)=>{qr||!ss?St.call(this,qr):(_e.data={cacheControl:ss.cacheControl,expires:ss.expires,rawData:ss.rawData.slice(0)},u.actor&&u.actor.send("loadTile",_e,St.bind(this),void 0,!0))},!0);u.request={cancel:mr}}function St(mr,qr){return delete u.request,u.aborted?E(null):mr&&mr.status!==404?E(mr):(qr&&qr.resourceTiming&&(u.resourceTiming=qr.resourceTiming),this.map._refreshExpiredTiles&&qr&&u.setExpiryData(qr),u.loadVectorData(qr,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),E(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class cs extends o.Evented{constructor(u,E,B,_e){super(),this.id=u,this.dispatcher=B,this.setEventedParent(_e),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},E),o.extend(this,o.pick(E,["url","scheme","tileSize"]))}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Id(this._options,this.map._requestManager,null,null,(E,B)=>{this._tileJSONRequest=null,this._loaded=!0,E?this.fire(new o.ErrorEvent(E)):B&&(o.extend(this,B),B.bounds&&(this.tileBounds=new td(B.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(B.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(E)})}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,E){const B=o.exported.devicePixelRatio>=2,_e=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),B,this.tileSize);u.request=o.getImage(this.map._requestManager.transformRequest(_e,o.ResourceType.Tile),(St,mr,qr,ss)=>(delete u.request,u.aborted?(u.state="unloaded",E(null)):St?(u.state="errored",E(St)):mr?(this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:qr,expires:ss}),u.setTexture(mr,this.map.painter),u.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void E(null)):E(null)))}static loadTileData(u,E,B){u.setTexture(E,B)}static unloadTileData(u,E){u.texture&&E.saveTileTexture(u.texture)}abortTile(u,E){u.request&&(u.request.cancel(),delete u.request),E()}unloadTile(u,E){u.texture&&this.map.painter.saveTileTexture(u.texture),E()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let $u;function eh(L,u,E,B,_e,St,mr,qr){const ss=[L,E,_e,u,B,St,1,1,1],tl=[mr,qr,1],il=o.adjoint([],ss),[Qu,fh,wh]=o.transformMat3(tl,tl,o.transpose(il,il));return o.multiply$1(ss,[Qu,0,0,0,fh,0,0,0,wh],ss)}class nh extends o.Evented{constructor(u,E,B,_e){super(),this.id=u,this.dispatcher=B,this.coordinates=E.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_e),this.options=E,this._dirty=!1}load(u,E){this._loaded=E||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(B,_e)=>{if(this._imageRequest=null,this._loaded=!0,B)this.fire(new o.ErrorEvent(B));else if(_e){const{HTMLImageElement:St}=o.window;this.image=_e instanceof St?o.exported.getImageData(_e):_e,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,u&&(this.coordinates=u),this._finishLoading()}})}loaded(){return this._loaded}updateImage(u){return this.image&&u.url?(this._imageRequest&&u.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=u.url,this.load(u.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(u){this.coordinates=u,this._boundsArray=void 0;const E=u.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(B){let _e=1/0,St=1/0,mr=-1/0,qr=-1/0;for(const Qu of B)_e=Math.min(_e,Qu.x),St=Math.min(St,Qu.y),mr=Math.max(mr,Qu.x),qr=Math.max(qr,Qu.y);const ss=Math.max(mr-_e,qr-St),tl=Math.max(0,Math.floor(-Math.log(ss)/Math.LN2)),il=Math.pow(2,tl);return new o.CanonicalTileID(tl,Math.floor((_e+mr)/2*il),Math.floor((St+qr)/2*il))}(E),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(u){for(const ss in this.tiles){const tl=this.tiles[ss];tl.state!=="loaded"&&(tl.state="loaded",tl.texture=this.texture)}if(this._boundsArray)return;const E=o.tileTransform(this.tileID,this.map.transform.projection),[B,_e,St,mr]=this.coordinates.map(ss=>{const tl=E.projection.project(ss[0],ss[1]);return o.getTilePoint(E,tl)._round()});this.perspectiveTransform=function(ss,tl,il,Qu,fh,wh,Sh,Th,Ch,hh){const Oh=eh(0,0,ss,0,0,tl,ss,tl),Rh=eh(il,Qu,fh,wh,Sh,Th,Ch,hh);return o.multiply$1(Rh,o.adjoint(Oh,Oh),Rh),[Rh[6]/Rh[8]*ss/o.EXTENT,Rh[7]/Rh[8]*tl/o.EXTENT]}(this.width,this.height,B.x,B.y,_e.x,_e.y,mr.x,mr.y,St.x,St.y);const qr=this._boundsArray=new o.StructArrayLayout4i8;qr.emplaceBack(B.x,B.y,0,0),qr.emplaceBack(_e.x,_e.y,o.EXTENT,0),qr.emplaceBack(mr.x,mr.y,0,o.EXTENT),qr.emplaceBack(St.x,St.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=u.createVertexBuffer(qr,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const u=this.map.painter.context,E=u.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(u,this.image,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(u)}loadTile(u,E){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},E(null)):(u.state="errored",E(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const uh={vector:_n,raster:cs,"raster-dem":class extends cs{constructor(L,u,E,B){super(L,u,E,B),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}loadTile(L,u){const E=this.map._requestManager.normalizeTileURL(L.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function B(_e,St){_e&&(L.state="errored",u(_e)),St&&(L.dem=St,L.dem.onDeserialize(),L.needsHillshadePrepare=!0,L.needsDEMTextureUpload=!0,L.state="loaded",u(null))}L.request=o.getImage(this.map._requestManager.transformRequest(E,o.ResourceType.Tile),function(_e,St,mr,qr){if(delete L.request,L.aborted)L.state="unloaded",u(null);else if(_e)L.state="errored",u(_e);else if(St){this.map._refreshExpiredTiles&&L.setExpiryData({cacheControl:mr,expires:qr});const ss=o.window.ImageBitmap&&St instanceof o.window.ImageBitmap&&($u==null&&($u=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),$u),tl=1-(St.width-o.prevPowerOfTwo(St.width))/2;tl<1||L.neighboringTiles||(L.neighboringTiles=this._getNeighboringTiles(L.tileID));const il=ss?St:o.exported.getImageData(St,tl),Qu={uid:L.uid,coord:L.tileID,source:this.id,rawImageData:il,encoding:this.encoding,padding:tl};L.actor&&L.state!=="expired"||(L.actor=this.dispatcher.getActor(),L.actor.send("loadDEMTile",Qu,B.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(L){const u=L.canonical,E=Math.pow(2,u.z),B=(u.x-1+E)%E,_e=u.x===0?L.wrap-1:L.wrap,St=(u.x+1+E)%E,mr=u.x+1===E?L.wrap+1:L.wrap,qr={};return qr[new o.OverscaledTileID(L.overscaledZ,_e,u.z,B,u.y).key]={backfilled:!1},qr[new o.OverscaledTileID(L.overscaledZ,mr,u.z,St,u.y).key]={backfilled:!1},u.y>0&&(qr[new o.OverscaledTileID(L.overscaledZ,_e,u.z,B,u.y-1).key]={backfilled:!1},qr[new o.OverscaledTileID(L.overscaledZ,L.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},qr[new o.OverscaledTileID(L.overscaledZ,mr,u.z,St,u.y-1).key]={backfilled:!1}),u.y+1<E&&(qr[new o.OverscaledTileID(L.overscaledZ,_e,u.z,B,u.y+1).key]={backfilled:!1},qr[new o.OverscaledTileID(L.overscaledZ,L.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},qr[new o.OverscaledTileID(L.overscaledZ,mr,u.z,St,u.y+1).key]={backfilled:!1}),qr}unloadTile(L){L.demTexture&&this.map.painter.saveTileTexture(L.demTexture),L.fbo&&(L.fbo.destroy(),delete L.fbo),L.dem&&delete L.dem,delete L.neighboringTiles,L.state="unloaded"}},geojson:class extends o.Evented{constructor(L,u,E,B){super(),this.id=L,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(B),this._data=u.data,this._options=o.extend({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const _e=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*_e,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*_e,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.EXTENT,radius:(u.clusterRadius!==void 0?u.clusterRadius:50)*_e,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}onAdd(L){this.map=L,this.setData(this._data)}setData(L){return this._data=L,this._updateWorkerData(),this}getClusterExpansionZoom(L,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:L,source:this.id},u),this}getClusterChildren(L,u){return this.actor.send("geojson.getClusterChildren",{clusterId:L,source:this.id},u),this}getClusterLeaves(L,u,E,B){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:L,limit:u,offset:E},B),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const L=o.extend({},this.workerOptions),u=this._data;typeof u=="string"?(L.request=this.map._requestManager.transformRequest(o.exported.resolveURL(u),o.ResourceType.Source),L.request.collectResourceTiming=this._collectResourceTiming):L.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,L,(E,B)=>{if(this._loaded=!0,this._pendingLoad=null,E)this.fire(new o.ErrorEvent(E));else{const _e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&B&&B.resourceTiming&&B.resourceTiming[this.id]&&(_e.resourceTiming=B.resourceTiming[this.id]),this.fire(new o.Event("data",_e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(L,u){const E=L.actor?"reloadTile":"loadTile";L.actor=this.actor,L.request=this.actor.send(E,{type:this.type,uid:L.uid,tileID:L.tileID,tileZoom:L.tileZoom,zoom:L.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(B,_e)=>(delete L.request,L.unloadVectorData(),L.aborted?u(null):B?u(B):(L.loadVectorData(_e,this.map.painter,E==="reloadTile"),u(null))),void 0,E==="loadTile")}abortTile(L){L.request&&(L.request.cancel(),delete L.request),L.aborted=!0}unloadTile(L){L.unloadVectorData(),this.actor.send("removeTile",{uid:L.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends nh{constructor(L,u,E,B){super(L,u,E,B),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const L=this.options;this.urls=[];for(const u of L.urls)this.urls.push(this.map._requestManager.transformRequest(u,o.ResourceType.Source).url);o.getVideo(this.urls,(u,E)=>{this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):E&&(this.video=E,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(L){if(this.video){const u=this.video.seekable;L<u.start(0)||L>u.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=L}}getVideo(){return this.video}onAdd(L){this.map||(this.map=L,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const L=this.map.painter.context,u=L.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(L,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(L)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:nh,canvas:class extends nh{constructor(L,u,E,B){super(L,u,E,B),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(_e=>!Array.isArray(_e)||_e.length!==2||_e.some(St=>typeof St!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(L){this.map=L,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let L=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,L=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,L=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context;this.texture?(L||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(u,this.canvas,u.gl.RGBA,{premultiply:!0}),this._prepareData(u)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const L of[this.canvas.width,this.canvas.height])if(isNaN(L)||L<=0)return!0;return!1}},custom:class extends o.Evented{constructor(L,u,E,B){super(),this.id=L,this.type="custom",this._dataType="raster",this._dispatcher=E,this._implementation=u,this.setEventedParent(B),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new td(this._implementation.bounds,this.minzoom,this.maxzoom)),u.update=this._update.bind(this),u.clearTiles=this._clearTiles.bind(this),u.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(u,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(L){this._map=L,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(L),this.load()}onRemove(L){this._implementation.onRemove&&this._implementation.onRemove(L)}hasTile(L){if(this._implementation.hasTile){const{x:u,y:E,z:B}=L.canonical;return this._implementation.hasTile({x:u,y:E,z:B})}return!this.tileBounds||this.tileBounds.contains(L.canonical)}loadTile(L,u){const{x:E,y:B,z:_e}=L.tileID.canonical,St=new o.window.AbortController;L.request=Promise.resolve(this._implementation.loadTile({x:E,y:B,z:_e},{signal:St.signal})).then(function(mr){return delete L.request,L.aborted?(L.state="unloaded",u(null)):mr===void 0?(L.state="errored",u(null)):mr===null?(this.loadTileData(L,{width:this.tileSize,height:this.tileSize,data:null}),L.state="loaded",u(null)):function(qr){return qr instanceof o.window.ImageData||qr instanceof o.window.HTMLCanvasElement||qr instanceof o.window.ImageBitmap||qr instanceof o.window.HTMLImageElement}(mr)?(this.loadTileData(L,mr),L.state="loaded",void u(null)):(L.state="errored",u(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(mr=>{mr.code!==20&&(L.state="errored",u(mr))}),L.request.cancel=()=>St.abort()}loadTileData(L,u){cs.loadTileData(L,u,this._map.painter)}unloadTileData(L){cs.unloadTileData(L,this._map.painter)}unloadTile(L,u){if(this.unloadTileData(L),this._implementation.unloadTile){const{x:E,y:B,z:_e}=L.tileID.canonical;this._implementation.unloadTile({x:E,y:B,z:_e})}u()}abortTile(L,u){L.request&&L.request.cancel&&(L.request.cancel(),delete L.request),u()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(L=>({x:L.canonical.x,y:L.canonical.y,z:L.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},dh=function(L,u,E,B){const _e=new uh[u.type](L,u,E,B);if(_e.id!==L)throw new Error(`Expected Source id to be ${L} instead of ${_e.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],_e),_e};function vh(L,u){const E=o.identity([]);return o.scale(E,E,[.5*L.width,.5*-L.height,1]),o.translate(E,E,[1,-1,0]),o.multiply(E,E,L.calculateProjMatrix(u.toUnwrapped())),Float32Array.from(E)}function Ph(L,u,E,B,_e,St,mr,qr=!1){const ss=L.tilesIn(B,mr,qr);ss.sort(Ad);const tl=[];for(const Qu of ss)tl.push({wrappedTileID:Qu.tile.tileID.wrapped().key,queryResults:Qu.tile.queryRenderedFeatures(u,E,L._state,Qu,_e,St,vh(L.transform,Qu.tile.tileID),qr)});const il=function(Qu){const fh={},wh={};for(const Sh of Qu){const Th=Sh.queryResults,Ch=Sh.wrappedTileID,hh=wh[Ch]=wh[Ch]||{};for(const Oh in Th){const Rh=Th[Oh],Nh=hh[Oh]=hh[Oh]||{},qh=fh[Oh]=fh[Oh]||[];for(const Fh of Rh)Nh[Fh.featureIndex]||(Nh[Fh.featureIndex]=!0,qh.push(Fh))}}return fh}(tl);for(const Qu in il)il[Qu].forEach(fh=>{const wh=fh.feature,Sh=wh.layer;Sh&&Sh.type!=="background"&&Sh.type!=="sky"&&(wh.source=Sh.source,Sh["source-layer"]&&(wh.sourceLayer=Sh["source-layer"]),wh.state=wh.id!==void 0?L.getFeatureState(Sh["source-layer"],wh.id):{})});return il}function zh(L,u){const E=L.getRenderableIds().map(St=>L.getTileByID(St)),B=[],_e={};for(let St=0;St<E.length;St++){const mr=E[St],qr=mr.tileID.canonical.key;_e[qr]||(_e[qr]=!0,mr.querySourceFeatures(B,u))}return B}function Ad(L,u){const E=L.tileID,B=u.tileID;return E.overscaledZ-B.overscaledZ||E.canonical.y-B.canonical.y||E.wrap-B.wrap||E.canonical.x-B.canonical.x}function wd(){return Of.workerClass!=null?new Of.workerClass:new o.window.Worker(Of.workerUrl)}const Qd="mapboxgl_preloaded_worker_pool";class xf{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<xf.workerCount;)this.workers.push(new wd);return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach(E=>{E.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Qd]}numActive(){return Object.keys(this.active).length}}let zf;function np(){return zf||(zf=new xf),zf}function Ah(L,u){const E={};for(const B in L)B!=="ref"&&(E[B]=L[B]);return o.refProperties.forEach(B=>{B in u&&(E[B]=u[B])}),E}function mf(L){L=L.slice();const u=Object.create(null);for(let E=0;E<L.length;E++)u[L[E].id]=L[E];for(let E=0;E<L.length;E++)"ref"in L[E]&&(L[E]=Ah(L[E],u[L[E].ref]));return L}xf.workerCount=2;const Od={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qf(L,u,E){E.push({command:Od.addSource,args:[L,u[L]]})}function mp(L,u,E){u.push({command:Od.removeSource,args:[L]}),E[L]=!0}function Vp(L,u,E,B){mp(L,E,B),qf(L,u,E)}function om(L,u,E){let B;for(B in L[E])if(L[E].hasOwnProperty(B)&&B!=="data"&&!x(L[E][B],u[E][B]))return!1;for(B in u[E])if(u[E].hasOwnProperty(B)&&B!=="data"&&!x(L[E][B],u[E][B]))return!1;return!0}function Pd(L,u,E,B,_e,St){let mr;for(mr in u=u||{},L=L||{})L.hasOwnProperty(mr)&&(x(L[mr],u[mr])||E.push({command:St,args:[B,mr,u[mr],_e]}));for(mr in u)u.hasOwnProperty(mr)&&!L.hasOwnProperty(mr)&&(x(L[mr],u[mr])||E.push({command:St,args:[B,mr,u[mr],_e]}))}function Hg(L){return L.id}function Fm(L,u){return L[u.id]=u,L}class I_{constructor(u,E){this.reset(u,E)}reset(u,E){this.points=u||[],this._distances=[0];for(let B=1;B<this.points.length;B++)this._distances[B]=this._distances[B-1]+this.points[B].dist(this.points[B-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(E||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=o.clamp(u,0,1);let E=1,B=this._distances[E];const _e=u*this.paddedLength+this.padding;for(;B<_e&&E<this._distances.length;)B=this._distances[++E];const St=E-1,mr=this._distances[St],qr=B-mr,ss=qr>0?(_e-mr)/qr:0;return this.points[St].mult(1-ss).add(this.points[E].mult(ss))}}class Dy{constructor(u,E,B){const _e=this.boxCells=[],St=this.circleCells=[];this.xCellCount=Math.ceil(u/B),this.yCellCount=Math.ceil(E/B);for(let mr=0;mr<this.xCellCount*this.yCellCount;mr++)_e.push([]),St.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=E,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/E,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,E,B,_e,St){this._forEachCell(E,B,_e,St,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(E),this.bboxes.push(B),this.bboxes.push(_e),this.bboxes.push(St)}insertCircle(u,E,B,_e){this._forEachCell(E-_e,B-_e,E+_e,B+_e,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(E),this.circles.push(B),this.circles.push(_e)}_insertBoxCell(u,E,B,_e,St,mr){this.boxCells[St].push(mr)}_insertCircleCell(u,E,B,_e,St,mr){this.circleCells[St].push(mr)}_query(u,E,B,_e,St,mr){if(B<0||u>this.width||_e<0||E>this.height)return!St&&[];const qr=[];if(u<=0&&E<=0&&this.width<=B&&this.height<=_e){if(St)return!0;for(let ss=0;ss<this.boxKeys.length;ss++)qr.push({key:this.boxKeys[ss],x1:this.bboxes[4*ss],y1:this.bboxes[4*ss+1],x2:this.bboxes[4*ss+2],y2:this.bboxes[4*ss+3]});for(let ss=0;ss<this.circleKeys.length;ss++){const tl=this.circles[3*ss],il=this.circles[3*ss+1],Qu=this.circles[3*ss+2];qr.push({key:this.circleKeys[ss],x1:tl-Qu,y1:il-Qu,x2:tl+Qu,y2:il+Qu})}return mr?qr.filter(mr):qr}return this._forEachCell(u,E,B,_e,this._queryCell,qr,{hitTest:St,seenUids:{box:{},circle:{}}},mr),St?qr.length>0:qr}_queryCircle(u,E,B,_e,St){const mr=u-B,qr=u+B,ss=E-B,tl=E+B;if(qr<0||mr>this.width||tl<0||ss>this.height)return!_e&&[];const il=[];return this._forEachCell(mr,ss,qr,tl,this._queryCellCircle,il,{hitTest:_e,circle:{x:u,y:E,radius:B},seenUids:{box:{},circle:{}}},St),_e?il.length>0:il}query(u,E,B,_e,St){return this._query(u,E,B,_e,!1,St)}hitTest(u,E,B,_e,St){return this._query(u,E,B,_e,!0,St)}hitTestCircle(u,E,B,_e){return this._queryCircle(u,E,B,!0,_e)}_queryCell(u,E,B,_e,St,mr,qr,ss){const tl=qr.seenUids,il=this.boxCells[St];if(il!==null){const fh=this.bboxes;for(const wh of il)if(!tl.box[wh]){tl.box[wh]=!0;const Sh=4*wh;if(u<=fh[Sh+2]&&E<=fh[Sh+3]&&B>=fh[Sh+0]&&_e>=fh[Sh+1]&&(!ss||ss(this.boxKeys[wh]))){if(qr.hitTest)return mr.push(!0),!0;mr.push({key:this.boxKeys[wh],x1:fh[Sh],y1:fh[Sh+1],x2:fh[Sh+2],y2:fh[Sh+3]})}}}const Qu=this.circleCells[St];if(Qu!==null){const fh=this.circles;for(const wh of Qu)if(!tl.circle[wh]){tl.circle[wh]=!0;const Sh=3*wh;if(this._circleAndRectCollide(fh[Sh],fh[Sh+1],fh[Sh+2],u,E,B,_e)&&(!ss||ss(this.circleKeys[wh]))){if(qr.hitTest)return mr.push(!0),!0;{const Th=fh[Sh],Ch=fh[Sh+1],hh=fh[Sh+2];mr.push({key:this.circleKeys[wh],x1:Th-hh,y1:Ch-hh,x2:Th+hh,y2:Ch+hh})}}}}}_queryCellCircle(u,E,B,_e,St,mr,qr,ss){const tl=qr.circle,il=qr.seenUids,Qu=this.boxCells[St];if(Qu!==null){const wh=this.bboxes;for(const Sh of Qu)if(!il.box[Sh]){il.box[Sh]=!0;const Th=4*Sh;if(this._circleAndRectCollide(tl.x,tl.y,tl.radius,wh[Th+0],wh[Th+1],wh[Th+2],wh[Th+3])&&(!ss||ss(this.boxKeys[Sh])))return mr.push(!0),!0}}const fh=this.circleCells[St];if(fh!==null){const wh=this.circles;for(const Sh of fh)if(!il.circle[Sh]){il.circle[Sh]=!0;const Th=3*Sh;if(this._circlesCollide(wh[Th],wh[Th+1],wh[Th+2],tl.x,tl.y,tl.radius)&&(!ss||ss(this.circleKeys[Sh])))return mr.push(!0),!0}}}_forEachCell(u,E,B,_e,St,mr,qr,ss){const tl=this._convertToXCellCoord(u),il=this._convertToYCellCoord(E),Qu=this._convertToXCellCoord(B),fh=this._convertToYCellCoord(_e);for(let wh=tl;wh<=Qu;wh++)for(let Sh=il;Sh<=fh;Sh++)if(St.call(this,u,E,B,_e,this.xCellCount*Sh+wh,mr,qr,ss))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,E,B,_e,St,mr){const qr=_e-u,ss=St-E,tl=B+mr;return tl*tl>qr*qr+ss*ss}_circleAndRectCollide(u,E,B,_e,St,mr,qr){const ss=(mr-_e)/2,tl=Math.abs(u-(_e+ss));if(tl>ss+B)return!1;const il=(qr-St)/2,Qu=Math.abs(E-(St+il));if(Qu>il+B)return!1;if(tl<=ss||Qu<=il)return!0;const fh=tl-ss,wh=Qu-il;return fh*fh+wh*wh<=B*B}}const Pg=Math.tan(85*Math.PI/180);function l_(L,u,E,B,_e,St,mr){const qr=o.create();if(E)if(St.name==="globe"){const ss=o.calculateGlobeLabelMatrix(_e,u);o.multiply(qr,qr,ss)}else{const ss=ih([],mr);qr[0]=ss[0],qr[1]=ss[1],qr[4]=ss[2],qr[5]=ss[3],B||o.rotateZ(qr,qr,_e.angle)}else o.multiply(qr,_e.labelPlaneMatrix,L);return qr}function ev(L,u,E,B,_e,St,mr){const qr=l_(L,u,E,B,_e,St,mr);return St.name==="globe"&&E||(qr[2]=qr[6]=qr[10]=qr[14]=0),qr}function c_(L,u,E,B,_e,St,mr){if(E){if(St.name==="globe"){const qr=l_(L,u,E,B,_e,St,mr);return o.invert(qr,qr),o.multiply(qr,L,qr),qr}{const qr=o.clone(L),ss=o.identity([]);return ss[0]=mr[0],ss[1]=mr[1],ss[4]=mr[2],ss[5]=mr[3],o.multiply(qr,qr,ss),B||o.rotateZ(qr,qr,-_e.angle),qr}}return _e.glCoordMatrix}function ep(L,u,E,B){const _e=[L,u,E,1];E?o.transformMat4$1(_e,_e,B):Gf(_e,_e,B);const St=_e[3];return _e[0]/=St,_e[1]/=St,_e[2]/=St,_e}function im(L,u){return Math.min(.5+L/u*.5,1.5)}function Jp(L,u){const E=L[0]/L[3],B=L[1]/L[3];return E>=-u[0]&&E<=u[0]&&B>=-u[1]&&B<=u[1]}function mm(L,u,E,B,_e,St,mr,qr,ss,tl){const il=E.transform,Qu=B?L.textSizeData:L.iconSizeData,fh=o.evaluateSizeForZoom(Qu,E.transform.zoom),wh=il.projection.name==="globe",Sh=[256/E.width*2+1,256/E.height*2+1],Th=B?L.text.dynamicLayoutVertexArray:L.icon.dynamicLayoutVertexArray;Th.clear();let Ch=null;wh&&(Ch=B?L.text.globeExtVertexArray:L.icon.globeExtVertexArray);const hh=L.lineVertexArray,Oh=B?L.text.placedSymbolArray:L.icon.placedSymbolArray,Rh=E.transform.width/E.transform.height;let Nh,qh=!1;for(let Fh=0;Fh<Oh.length;Fh++){const Hh=Oh.get(Fh),{numGlyphs:ld,writingMode:xd}=Hh;if(xd!==o.WritingMode.vertical||qh||Nh===o.WritingMode.horizontal||(qh=!0),Nh=xd,(Hh.hidden||xd===o.WritingMode.vertical)&&!qh){ad(ld,Th);continue}qh=!1;const gd=new o.pointGeometry(Hh.tileAnchorX,Hh.tileAnchorY);let{x:Vf,y:_d,z:Cf}=il.projection.projectTilePoint(gd.x,gd.y,tl.canonical);if(ss){const[nm,Cp,xp]=ss(gd);Vf+=nm,_d+=Cp,Cf+=xp}const Ud=[Vf,_d,Cf,1];if(o.transformMat4$1(Ud,Ud,u),!Jp(Ud,Sh)){ad(ld,Th);continue}const Lf=im(E.transform.cameraToCenterDistance,Ud[3]),Cd=o.evaluateSizeForFeature(Qu,fh,Hh),pd=mr?Cd/Lf:Cd*Lf,$d=ep(Vf,_d,Cf,_e);if($d[3]<=0){ad(ld,Th);continue}let yf={};const $f=mr?null:ss,Dp=yh(Hh,pd,!1,qr,u,_e,St,L.glyphOffsetArray,hh,Th,Ch,$d,gd,yf,Rh,$f,il.projection,tl,mr);qh=Dp.useVertical,$f&&Dp.needsFlipping&&(yf={}),(Dp.notEnoughRoom||qh||Dp.needsFlipping&&yh(Hh,pd,!0,qr,u,_e,St,L.glyphOffsetArray,hh,Th,Ch,$d,gd,yf,Rh,$f,il.projection,tl,mr).notEnoughRoom)&&ad(ld,Th)}B?(L.text.dynamicLayoutVertexBuffer.updateData(Th),Ch&&L.text.globeExtVertexBuffer.updateData(Ch)):(L.icon.dynamicLayoutVertexBuffer.updateData(Th),Ch&&L.icon.globeExtVertexBuffer.updateData(Ch))}function yr(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th){const{lineStartIndex:Ch,glyphStartIndex:hh,segment:Oh}=qr,Rh=hh+qr.numGlyphs,Nh=Ch+qr.lineLength,qh=u.getoffsetX(hh),Fh=u.getoffsetX(Rh-1),Hh=od(L*qh,E,B,_e,St,mr,Oh,Ch,Nh,ss,tl,il,Qu,fh,!0,wh,Sh,Th);if(!Hh)return null;const ld=od(L*Fh,E,B,_e,St,mr,Oh,Ch,Nh,ss,tl,il,Qu,fh,!0,wh,Sh,Th);return ld?{first:Hh,last:ld}:null}function el(L,u,E,B){return L===o.WritingMode.horizontal&&Math.abs(B)>Math.abs(E)?{useVertical:!0}:L===o.WritingMode.vertical?B>0?{needsFlipping:!0}:null:u!==0&&function(_e,St){return _e===0||Math.abs(St/_e)>Pg}(E,B)?u===1?{needsFlipping:!0}:null:E<0?{needsFlipping:!0}:null}function yh(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th,Ch,hh,Oh){const Rh=u/24,Nh=L.lineOffsetX*Rh,qh=L.lineOffsetY*Rh,{lineStartIndex:Fh,glyphStartIndex:Hh,numGlyphs:ld,segment:xd,writingMode:gd,flipState:Vf}=L,_d=Fh+L.lineLength,Cf=Ud=>{if(il){const[$d,yf,$f]=Ud.up,Dp=tl.length;o.updateGlobeVertexNormal(il,Dp+0,$d,yf,$f),o.updateGlobeVertexNormal(il,Dp+1,$d,yf,$f),o.updateGlobeVertexNormal(il,Dp+2,$d,yf,$f),o.updateGlobeVertexNormal(il,Dp+3,$d,yf,$f)}const[Lf,Cd,pd]=Ud.point;o.addDynamicAttributes(tl,Lf,Cd,pd,Ud.angle)};if(ld>1){const Ud=yr(Rh,qr,Nh,qh,E,Qu,fh,L,ss,St,wh,Th,!1,Ch,hh,Oh);if(!Ud)return{notEnoughRoom:!0};if(B&&!E){let[Lf,Cd,pd]=Ud.first.point,[$d,yf,$f]=Ud.last.point;[Lf,Cd]=ep(Lf,Cd,pd,mr),[$d,yf]=ep($d,yf,$f,mr);const Dp=el(gd,Vf,($d-Lf)*Sh,yf-Cd);if(L.flipState=Dp&&Dp.needsFlipping?1:2,Dp)return Dp}Cf(Ud.first);for(let Lf=Hh+1;Lf<Hh+ld-1;Lf++){const Cd=od(Rh*qr.getoffsetX(Lf),Nh,qh,E,Qu,fh,xd,Fh,_d,ss,St,wh,Th,!1,!1,Ch,hh,Oh);if(!Cd)return tl.length-=4*(Lf-Hh),{notEnoughRoom:!0};Cf(Cd)}Cf(Ud.last)}else{if(B&&!E){const Lf=ep(fh.x,fh.y,0,_e),Cd=Fh+xd+1,pd=new o.pointGeometry(ss.getx(Cd),ss.gety(Cd)),$d=ep(pd.x,pd.y,0,_e),yf=$d[3]>0?$d:nd(fh,pd,Lf,1,_e,void 0,Ch,hh.canonical),$f=el(gd,Vf,(yf[0]-Lf[0])*Sh,yf[1]-Lf[1]);if(L.flipState=$f&&$f.needsFlipping?1:2,$f)return $f}const Ud=od(Rh*qr.getoffsetX(Hh),Nh,qh,E,Qu,fh,xd,Fh,_d,ss,St,wh,Th,!1,!1,Ch,hh,Oh);if(!Ud)return{notEnoughRoom:!0};Cf(Ud)}return{}}function Uh(L,u,E,B,_e){const{x:St,y:mr,z:qr}=B.projectTilePoint(L.x,L.y,u);if(!_e)return ep(St,mr,qr,E);const[ss,tl,il]=_e(L);return ep(St+ss,mr+tl,qr+il,E)}function nd(L,u,E,B,_e,St,mr,qr){const ss=Uh(L.sub(u)._unit()._add(L),qr,_e,mr,St);return o.sub(ss,E,ss),o.normalize(ss,ss),o.scaleAndAdd(ss,E,ss,B)}function od(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th,Ch,hh){const Oh=B?L-u:L+u;let Rh=Oh>0?1:-1,Nh=0;B&&(Rh*=-1,Nh=Math.PI),Rh<0&&(Nh+=Math.PI);let qh=qr+mr+(Rh>0?0:1)|0,Fh=_e,Hh=_e,ld=0,xd=0;const gd=Math.abs(Oh),Vf=[],_d=[];let Cf=St,Ud=Cf;const Lf=()=>nd(Ud,Cf,Hh,gd-ld+1,il,fh,Th,Ch.canonical);for(;ld+xd<=gd;){if(qh+=Rh,qh<qr||qh>=ss)return null;if(Hh=Fh,Ud=Cf,Vf.push(Hh),wh&&_d.push(Ud),Cf=new o.pointGeometry(tl.getx(qh),tl.gety(qh)),Fh=Qu[qh],!Fh){const xp=Uh(Cf,Ch.canonical,il,Th,fh);Fh=xp[3]>0?Qu[qh]=xp:Lf()}ld+=xd,xd=o.distance(Hh,Fh)}Sh&&fh&&(Qu[qh]&&(Fh=Lf(),xd=o.distance(Hh,Fh)),Qu[qh]=Fh);const Cd=(gd-ld)/xd,pd=Cf.sub(Ud)._mult(Cd)._add(Ud),$d=o.sub([],Fh,Hh),yf=o.scaleAndAdd([],Hh,$d,Cd);let $f=[0,0,1],Dp=$d[0],nm=$d[1];if(hh&&($f=Th.upVector(Ch.canonical,pd.x,pd.y),$f[0]!==0||$f[1]!==0||$f[2]!==1)){const xp=[$f[2],0,-$f[0]],Lp=o.cross([],$f,xp);o.normalize(xp,xp),o.normalize(Lp,Lp),Dp=o.dot($d,xp),nm=o.dot($d,Lp)}if(E){const xp=o.cross([],$f,$d);o.normalize(xp,xp),o.scaleAndAdd(yf,yf,xp,E*Rh)}const Cp=Nh+Math.atan2(nm,Dp);return Vf.push(yf),wh&&_d.push(pd),{point:yf,angle:Cp,path:Vf,tilePath:_d,up:$f}}function ad(L,u){const E=u.length,B=E+4*L;u.resize(B),u.float32.fill(-1/0,4*E,4*B)}function Gf(L,u,E){const B=u[0],_e=u[1];return L[0]=E[0]*B+E[4]*_e+E[12],L[1]=E[1]*B+E[5]*_e+E[13],L[3]=E[3]*B+E[7]*_e+E[15],L}const Ef=100;class _p{constructor(u,E,B=new Dy(u.width+200,u.height+200,25),_e=new Dy(u.width+200,u.height+200,25)){this.transform=u,this.grid=B,this.ignoredGrid=_e,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+Ef,this.screenBottomBoundary=u.height+Ef,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.fogState=E}placeCollisionBox(u,E,B,_e,St,mr,qr,ss){let tl=B.projectedAnchorX,il=B.projectedAnchorY,Qu=B.projectedAnchorZ;const fh=B.elevation,wh=B.tileID,Sh=u.getProjection();if(fh&&wh){const[Fh,Hh,ld]=Sh.upVector(wh.canonical,B.tileAnchorX,B.tileAnchorY),xd=Sh.upVectorScale(wh.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;tl+=Fh*fh*xd,il+=Hh*fh*xd,Qu+=ld*fh*xd}const Th=this.projectAndGetPerspectiveRatio(qr,tl,il,Qu,B.tileID,Sh.name==="globe"||!!fh||this.transform.pitch>0,Sh),Ch=mr*Th.perspectiveRatio,hh=(B.x1*E+_e.x-B.padding)*Ch+Th.point.x,Oh=(B.y1*E+_e.y-B.padding)*Ch+Th.point.y,Rh=(B.x2*E+_e.x+B.padding)*Ch+Th.point.x,Nh=(B.y2*E+_e.y+B.padding)*Ch+Th.point.y,qh=Th.perspectiveRatio<=.55||Th.occluded;return!this.isInsideGrid(hh,Oh,Rh,Nh)||!St&&this.grid.hitTest(hh,Oh,Rh,Nh,ss)||qh?{box:[],offscreen:!1,occluded:Th.occluded}:{box:[hh,Oh,Rh,Nh],offscreen:this.isOffscreen(hh,Oh,Rh,Nh),occluded:!1}}placeCollisionCircles(u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th){const Ch=[],hh=this.transform.elevation,Oh=u.getProjection(),Rh=hh?hh.getAtTileOffsetFunc(Th,this.transform.center.lat,this.transform.worldSize,Oh):null,Nh=new o.pointGeometry(B.tileAnchorX,B.tileAnchorY);let{x:qh,y:Fh,z:Hh}=Oh.projectTilePoint(Nh.x,Nh.y,Th.canonical);if(Rh){const[pd,$d,yf]=Rh(Nh);qh+=pd,Fh+=$d,Hh+=yf}const ld=Oh.name==="globe",xd=this.projectAndGetPerspectiveRatio(qr,qh,Fh,Hh,Th,ld||!!hh||this.transform.pitch>0,Oh),{perspectiveRatio:gd}=xd,Vf=(Qu?mr/gd:mr*gd)/o.ONE_EM,_d=ep(qh,Fh,Hh,ss),Cf=xd.signedDistanceFromCamera>0?yr(Vf,St,B.lineOffsetX*Vf,B.lineOffsetY*Vf,!1,_d,Nh,B,_e,ss,{},hh&&!Qu?Rh:null,Qu&&!!hh,Oh,Th,Qu):null;let Ud=!1,Lf=!1,Cd=!0;if(Cf&&!xd.occluded){const pd=.5*wh*gd+Sh,$d=new o.pointGeometry(-100,-100),yf=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$f=new I_,{first:Dp,last:nm}=Cf,Cp=Dp.path.length;let xp=[];for(let zp=Cp-1;zp>=1;zp--)xp.push(Dp.path[zp]);for(let zp=1;zp<nm.path.length;zp++)xp.push(nm.path[zp]);const Lp=2.5*pd;tl&&(xp=xp.map(([zp,km,Am],jm)=>(Rh&&!ld&&(Am=Rh(jm<Cp-1?Dp.tilePath[Cp-1-jm]:nm.tilePath[jm-Cp+2])[2]),ep(zp,km,Am,tl))),xp.some(zp=>zp[3]<=0)&&(xp=[]));let dm=[];if(xp.length>0){let zp=1/0,km=-1/0,Am=1/0,jm=-1/0;for(const zm of xp)zp=Math.min(zp,zm[0]),Am=Math.min(Am,zm[1]),km=Math.max(km,zm[0]),jm=Math.max(jm,zm[1]);km>=$d.x&&zp<=yf.x&&jm>=$d.y&&Am<=yf.y&&(dm=[xp.map(zm=>new o.pointGeometry(zm[0],zm[1]))],(zp<$d.x||km>yf.x||Am<$d.y||jm>yf.y)&&(dm=o.clipLine(dm,$d.x,$d.y,yf.x,yf.y)))}for(const zp of dm){$f.reset(zp,.25*pd);let km=0;km=$f.length<=.5*pd?1:Math.ceil($f.paddedLength/Lp)+1;for(let Am=0;Am<km;Am++){const jm=Am/Math.max(km-1,1),zm=$f.lerp(jm),gg=zm.x+Ef,lg=zm.y+Ef;Ch.push(gg,lg,pd,0);const Cy=gg-pd,V0=lg-pd,ig=gg+pd,qm=lg+pd;if(Cd=Cd&&this.isOffscreen(Cy,V0,ig,qm),Lf=Lf||this.isInsideGrid(Cy,V0,ig,qm),!E&&this.grid.hitTestCircle(gg,lg,pd,fh)&&(Ud=!0,!il))return{circles:[],offscreen:!1,collisionDetected:Ud,occluded:!1}}}}return{circles:!il&&Ud||!Lf?[]:Ch,offscreen:Cd,collisionDetected:Ud,occluded:xd.occluded}}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const E=[];let B=1/0,_e=1/0,St=-1/0,mr=-1/0;for(const il of u){const Qu=new o.pointGeometry(il.x+Ef,il.y+Ef);B=Math.min(B,Qu.x),_e=Math.min(_e,Qu.y),St=Math.max(St,Qu.x),mr=Math.max(mr,Qu.y),E.push(Qu)}const qr=this.grid.query(B,_e,St,mr).concat(this.ignoredGrid.query(B,_e,St,mr)),ss={},tl={};for(const il of qr){const Qu=il.key;if(ss[Qu.bucketInstanceId]===void 0&&(ss[Qu.bucketInstanceId]={}),ss[Qu.bucketInstanceId][Qu.featureIndex])continue;const fh=[new o.pointGeometry(il.x1,il.y1),new o.pointGeometry(il.x2,il.y1),new o.pointGeometry(il.x2,il.y2),new o.pointGeometry(il.x1,il.y2)];o.polygonIntersectsPolygon(E,fh)&&(ss[Qu.bucketInstanceId][Qu.featureIndex]=!0,tl[Qu.bucketInstanceId]===void 0&&(tl[Qu.bucketInstanceId]=[]),tl[Qu.bucketInstanceId].push(Qu.featureIndex))}return tl}insertCollisionBox(u,E,B,_e,St){(E?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:_e,collisionGroupID:St},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,E,B,_e,St){const mr=E?this.ignoredGrid:this.grid,qr={bucketInstanceId:B,featureIndex:_e,collisionGroupID:St};for(let ss=0;ss<u.length;ss+=4)mr.insertCircle(qr,u[ss],u[ss+1],u[ss+2])}projectAndGetPerspectiveRatio(u,E,B,_e,St,mr,qr){const ss=[E,B,_e,1];let tl=!1;if(_e||this.transform.pitch>0){o.transformMat4$1(ss,ss,u);const Qu=qr.name==="globe";this.fogState&&St&&!Qu&&(tl=function(wh,Sh,Th,Ch,hh,Oh){const Rh=Oh.calculateFogTileMatrix(hh),Nh=[Sh,Th,Ch];return o.transformMat4(Nh,Nh,Rh),Kd(wh,Nh,Oh.pitch,Oh._fov)}(this.fogState,E,B,_e,St.toUnwrapped(),this.transform)>.9)}else Gf(ss,ss,u);const il=ss[3];return{point:new o.pointGeometry((ss[0]/il+1)/2*this.transform.width+Ef,(-ss[1]/il+1)/2*this.transform.height+Ef),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(qr)/il*.5,1.5),signedDistanceFromCamera:il,occluded:mr&&ss[2]>il||tl}}isOffscreen(u,E,B,_e){return B<Ef||u>=this.screenRightBoundary||_e<Ef||E>this.screenBottomBoundary}isInsideGrid(u,E,B,_e){return B>=0&&u<this.gridRightBoundary&&_e>=0&&E<this.gridBottomBoundary}getViewportMatrix(){const u=o.identity([]);return o.translate(u,u,[-100,-100,0]),u}}function ap(L,u,E){const B=u.createTileMatrix(L,L.worldSize,E.toUnwrapped());return o.multiply(new Float32Array(16),L.projMatrix,B)}function lp(L,u,E){if(u.projection.name===E.projection.name)return L.projMatrix;const B=E.clone();return B.setProjection(u.projection),ap(B,u.getProjection(),L)}function Zp(L,u,E){return u.name===E.projection.name?L.projMatrix:ap(E,u,L)}class Rm{constructor(u,E,B,_e){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?E:-E))):_e&&B?1:0,this.placed=B}isHidden(){return this.opacity===0&&!this.placed}}class Yp{constructor(u,E,B,_e,St,mr=!1){this.text=new Rm(u?u.text:null,E,B,St),this.icon=new Rm(u?u.icon:null,E,_e,St),this.clipped=mr}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pm{constructor(u,E,B,_e=!1){this.text=u,this.icon=E,this.skipFade=B,this.clipped=_e}}class kf{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Tp{constructor(u,E,B,_e,St){this.bucketInstanceId=u,this.featureIndex=E,this.sourceLayerIndex=B,this.bucketIndex=_e,this.tileID=St}}class Np{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const E=++this.maxGroupID;this.collisionGroups[u]={ID:E,predicate:B=>B.collisionGroupID===E}}return this.collisionGroups[u]}}function Jm(L,u,E,B,_e){const{horizontalAlign:St,verticalAlign:mr}=o.getAnchorAlignment(L),qr=-(St-.5)*u,ss=-(mr-.5)*E,tl=o.evaluateVariableOffset(L,B);return new o.pointGeometry(qr+tl[0]*_e,ss+tl[1]*_e)}function Um(L,u,E,B,_e){const St=new o.pointGeometry(L,u);return E&&St._rotate(B?_e:-_e),St}class bg{constructor(u,E,B,_e,St){this.transform=u.clone(),this.projection=u.projection.name,this.collisionIndex=new _p(this.transform,St),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=E,this.retainedQueryData={},this.collisionGroups=new Np(B),this.collisionCircleArrays={},this.prevPlacement=_e,_e&&(_e.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(u,E,B,_e){const St=B.getBucket(E),mr=B.latestFeatureIndex;if(!St||!mr||E.id!==St.layerIds[0])return;const qr=St.layers[0].layout,ss=B.collisionBoxArray,tl=Math.pow(2,this.transform.zoom-B.tileID.overscaledZ),il=B.tileSize/o.EXTENT,Qu=B.tileID.toUnwrapped();this.transform.setProjection(St.projection);const fh=(wh=B.tileID,Sh=St.getProjection(),Th=this.transform,Sh.name===this.projection?Th.calculateProjMatrix(wh.toUnwrapped()):ap(Th,Sh,wh));var wh,Sh,Th;const Ch=qr.get("text-pitch-alignment")==="map",hh=qr.get("text-rotation-alignment")==="map";E.compileFilter();const Oh=E.dynamicFilter(),Rh=E.dynamicFilterNeedsFeature(),Nh=this.transform.calculatePixelsToTileUnitsMatrix(B),qh=ev(fh,B.tileID.canonical,Ch,hh,this.transform,St.getProjection(),Nh);let Fh=null;if(Ch){const xd=c_(fh,B.tileID.canonical,Ch,hh,this.transform,St.getProjection(),Nh);Fh=o.multiply([],this.transform.labelPlaneMatrix,xd)}let Hh=null;Oh&&B.latestFeatureIndex&&(Hh={unwrappedTileID:Qu,dynamicFilter:Oh,dynamicFilterNeedsFeature:Rh,featureIndex:B.latestFeatureIndex}),this.retainedQueryData[St.bucketInstanceId]=new Tp(St.bucketInstanceId,mr,St.sourceLayerIndex,St.index,B.tileID);const ld={bucket:St,layout:qr,posMatrix:fh,textLabelPlaneMatrix:qh,labelToScreenMatrix:Fh,clippingData:Hh,scale:tl,textPixelRatio:il,holdingForFade:B.holdingForFade(),collisionBoxArray:ss,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(St.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(St.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(St.sourceID)};if(_e)for(const xd of St.sortKeyRanges){const{sortKey:gd,symbolInstanceStart:Vf,symbolInstanceEnd:_d}=xd;u.push({sortKey:gd,symbolInstanceStart:Vf,symbolInstanceEnd:_d,parameters:ld})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:St.symbolInstances.length,parameters:ld})}attemptAnchorPlacement(u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th,Ch,hh,Oh){const{textOffset0:Rh,textOffset1:Nh,crossTileID:qh}=fh,Fh=[Rh,Nh],Hh=Jm(u,B,_e,Fh,St),ld=this.collisionIndex.placeCollisionBox(Sh,St,E,Um(Hh.x,Hh.y,mr,qr,this.transform.angle),Qu,ss,tl,il.predicate);if(Ch){const xd=Sh.getSymbolInstanceIconSize(Oh,this.transform.zoom,fh.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Sh,xd,Ch,Um(Hh.x,Hh.y,mr,qr,this.transform.angle),Qu,ss,tl,il.predicate).box.length===0)return}if(ld.box.length>0){let xd;return this.prevPlacement&&this.prevPlacement.variableOffsets[qh]&&this.prevPlacement.placements[qh]&&this.prevPlacement.placements[qh].text&&(xd=this.prevPlacement.variableOffsets[qh].anchor),this.variableOffsets[qh]={textOffset:Fh,width:B,height:_e,anchor:u,textScale:St,prevAnchor:xd},this.markUsedJustification(Sh,u,fh,Th),Sh.allowVerticalPlacement&&(this.markUsedOrientation(Sh,Th,fh),this.placedOrientations[qh]=Th),{shift:Hh,placedGlyphBoxes:ld}}}placeLayerBucketPart(u,E,B,_e){const{bucket:St,layout:mr,posMatrix:qr,textLabelPlaneMatrix:ss,labelToScreenMatrix:tl,clippingData:il,textPixelRatio:Qu,holdingForFade:fh,collisionBoxArray:wh,partiallyEvaluatedTextSize:Sh,partiallyEvaluatedIconSize:Th,collisionGroup:Ch}=u.parameters,hh=mr.get("text-optional"),Oh=mr.get("icon-optional"),Rh=mr.get("text-allow-overlap"),Nh=mr.get("icon-allow-overlap"),qh=mr.get("text-rotation-alignment")==="map",Fh=mr.get("text-pitch-alignment")==="map",Hh=mr.get("icon-text-fit")!=="none",ld=mr.get("symbol-z-order")==="viewport-y";this.transform.setProjection(St.projection);let xd=Rh&&(Nh||!St.hasIconData()||Oh),gd=Nh&&(Rh||!St.hasTextData()||hh);!St.collisionArrays&&wh&&St.deserializeCollisionBoxes(wh),B&&_e&&St.updateCollisionDebugBuffers(this.transform.zoom,wh);const Vf=(_d,Cf,Ud)=>{const{crossTileID:Lf,numVerticalGlyphVertices:Cd}=_d;if(il){const ig={zoom:this.transform.zoom,pitch:this.transform.pitch};let qm=null;if(il.dynamicFilterNeedsFeature){const _m=this.retainedQueryData[St.bucketInstanceId];qm=il.featureIndex.loadFeature({featureIndex:_d.featureIndex,bucketIndex:_m.bucketIndex,sourceLayerIndex:_m.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,il.dynamicFilter)(ig,qm,this.retainedQueryData[St.bucketInstanceId].tileID.canonical,new o.pointGeometry(_d.tileAnchorX,_d.tileAnchorY),this.transform.calculateDistanceTileData(il.unwrappedTileID)))return this.placements[Lf]=new Pm(!1,!1,!1,!0),void(E[Lf]=!0)}if(E[Lf])return;if(fh)return void(this.placements[Lf]=new Pm(!1,!1,!1));let pd=!1,$d=!1,yf=!0,$f=!1,Dp=!1,nm=null,Cp={box:null,offscreen:null,occluded:null},xp={box:null,offscreen:null,occluded:null},Lp=null,dm=null,zp=null,km=0,Am=0,jm=0;Ud.textFeatureIndex?km=Ud.textFeatureIndex:_d.useRuntimeCollisionCircles&&(km=_d.featureIndex),Ud.verticalTextFeatureIndex&&(Am=Ud.verticalTextFeatureIndex);const zm=ig=>{ig.tileID=this.retainedQueryData[St.bucketInstanceId].tileID;const qm=this.transform.elevation;(qm||ig.elevation)&&(ig.elevation=qm?qm.getAtTileOffset(ig.tileID,ig.tileAnchorX,ig.tileAnchorY):0)},gg=Ud.textBox;if(gg){zm(gg);const ig=_m=>{let cg=o.WritingMode.horizontal;if(St.allowVerticalPlacement&&!_m&&this.prevPlacement){const n_=this.prevPlacement.placedOrientations[Lf];n_&&(this.placedOrientations[Lf]=n_,cg=n_,this.markUsedOrientation(St,cg,_d))}return cg},qm=(_m,cg)=>{if(St.allowVerticalPlacement&&Cd>0&&Ud.verticalTextBox){for(const n_ of St.writingModes)if(n_===o.WritingMode.vertical?(Cp=cg(),xp=Cp):Cp=_m(),Cp&&Cp.box&&Cp.box.length)break}else Cp=_m()};if(mr.get("text-variable-anchor")){let _m=mr.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lf]){const Dm=this.prevPlacement.variableOffsets[Lf];_m.indexOf(Dm.anchor)>0&&(_m=_m.filter(jg=>jg!==Dm.anchor),_m.unshift(Dm.anchor))}const cg=(Dm,jg,y_)=>{const hv=St.getSymbolInstanceTextSize(Sh,_d,this.transform.zoom,Cf),Hv=(Dm.x2-Dm.x1)*hv+2*Dm.padding,uy=(Dm.y2-Dm.y1)*hv+2*Dm.padding,My=Hh&&!Nh?jg:null;My&&zm(My);let G0={box:[],offscreen:!1,occluded:!1};const dv=Rh?2*_m.length:_m.length;for(let I0=0;I0<dv;++I0){const Xv=this.attemptAnchorPlacement(_m[I0%_m.length],Dm,Hv,uy,hv,qh,Fh,Qu,qr,Ch,I0>=_m.length,_d,Cf,St,y_,My,Sh,Th);if(Xv&&(G0=Xv.placedGlyphBoxes,G0&&G0.box&&G0.box.length)){pd=!0,nm=Xv.shift;break}}return G0};qm(()=>cg(gg,Ud.iconBox,o.WritingMode.horizontal),()=>{const Dm=Ud.verticalTextBox;return Dm&&zm(Dm),St.allowVerticalPlacement&&!(Cp&&Cp.box&&Cp.box.length)&&Cd>0&&Dm?cg(Dm,Ud.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Cp&&(pd=Cp.box,yf=Cp.offscreen,$f=Cp.occluded);const n_=ig(Cp&&Cp.box);if(!pd&&this.prevPlacement){const Dm=this.prevPlacement.variableOffsets[Lf];Dm&&(this.variableOffsets[Lf]=Dm,this.markUsedJustification(St,Dm.anchor,_d,n_))}}else{const _m=(cg,n_)=>{const Dm=St.getSymbolInstanceTextSize(Sh,_d,this.transform.zoom,Cf),jg=this.collisionIndex.placeCollisionBox(St,Dm,cg,new o.pointGeometry(0,0),Rh,Qu,qr,Ch.predicate);return jg&&jg.box&&jg.box.length&&(this.markUsedOrientation(St,n_,_d),this.placedOrientations[Lf]=n_),jg};qm(()=>_m(gg,o.WritingMode.horizontal),()=>{const cg=Ud.verticalTextBox;return St.allowVerticalPlacement&&Cd>0&&cg?(zm(cg),_m(cg,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ig(Cp&&Cp.box&&Cp.box.length)}}if(Lp=Cp,pd=Lp&&Lp.box&&Lp.box.length>0,yf=Lp&&Lp.offscreen,$f=Lp&&Lp.occluded,_d.useRuntimeCollisionCircles){const ig=St.text.placedSymbolArray.get(_d.centerJustifiedTextSymbolIndex>=0?_d.centerJustifiedTextSymbolIndex:_d.verticalPlacedTextSymbolIndex),qm=o.evaluateSizeForFeature(St.textSizeData,Sh,ig),_m=mr.get("text-padding");dm=this.collisionIndex.placeCollisionCircles(St,Rh,ig,St.lineVertexArray,St.glyphOffsetArray,qm,qr,ss,tl,B,Fh,Ch.predicate,_d.collisionCircleDiameter*qm/o.ONE_EM,_m,this.retainedQueryData[St.bucketInstanceId].tileID),pd=Rh||dm.circles.length>0&&!dm.collisionDetected,yf=yf&&dm.offscreen,$f=dm.occluded}if(Ud.iconFeatureIndex&&(jm=Ud.iconFeatureIndex),Ud.iconBox){const ig=qm=>{zm(qm);const _m=Hh&&nm?Um(nm.x,nm.y,qh,Fh,this.transform.angle):new o.pointGeometry(0,0),cg=St.getSymbolInstanceIconSize(Th,this.transform.zoom,_d.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(St,cg,qm,_m,Nh,Qu,qr,Ch.predicate)};xp&&xp.box&&xp.box.length&&Ud.verticalIconBox?(zp=ig(Ud.verticalIconBox),$d=zp.box.length>0):(zp=ig(Ud.iconBox),$d=zp.box.length>0),yf=yf&&zp.offscreen,Dp=zp.occluded}const lg=hh||_d.numHorizontalGlyphVertices===0&&Cd===0,Cy=Oh||_d.numIconVertices===0;if(lg||Cy?Cy?lg||($d=$d&&pd):pd=$d&&pd:$d=pd=$d&&pd,pd&&Lp&&Lp.box&&this.collisionIndex.insertCollisionBox(Lp.box,mr.get("text-ignore-placement"),St.bucketInstanceId,xp&&xp.box&&Am?Am:km,Ch.ID),$d&&zp&&this.collisionIndex.insertCollisionBox(zp.box,mr.get("icon-ignore-placement"),St.bucketInstanceId,jm,Ch.ID),dm&&(pd&&this.collisionIndex.insertCollisionCircles(dm.circles,mr.get("text-ignore-placement"),St.bucketInstanceId,km,Ch.ID),B)){const ig=St.bucketInstanceId;let qm=this.collisionCircleArrays[ig];qm===void 0&&(qm=this.collisionCircleArrays[ig]=new kf);for(let _m=0;_m<dm.circles.length;_m+=4)qm.circles.push(dm.circles[_m+0]),qm.circles.push(dm.circles[_m+1]),qm.circles.push(dm.circles[_m+2]),qm.circles.push(dm.collisionDetected?1:0)}const V0=St.projection.name!=="globe";xd=xd&&(V0||!$f),gd=gd&&(V0||!Dp),this.placements[Lf]=new Pm(pd||xd,$d||gd,yf||St.justReloaded),E[Lf]=!0};if(ld){const _d=St.getSortedSymbolIndexes(this.transform.angle);for(let Cf=_d.length-1;Cf>=0;--Cf){const Ud=_d[Cf];Vf(St.symbolInstances.get(Ud),Ud,St.collisionArrays[Ud])}}else for(let _d=u.symbolInstanceStart;_d<u.symbolInstanceEnd;_d++)Vf(St.symbolInstances.get(_d),_d,St.collisionArrays[_d]);if(B&&St.bucketInstanceId in this.collisionCircleArrays){const _d=this.collisionCircleArrays[St.bucketInstanceId];o.invert(_d.invProjMatrix,qr),_d.viewportMatrix=this.collisionIndex.getViewportMatrix()}St.justReloaded=!1}markUsedJustification(u,E,B,_e){const{leftJustifiedTextSymbolIndex:St,centerJustifiedTextSymbolIndex:mr,rightJustifiedTextSymbolIndex:qr,verticalPlacedTextSymbolIndex:ss,crossTileID:tl}=B,il=o.getAnchorJustification(E),Qu=_e===o.WritingMode.vertical?ss:il==="left"?St:il==="center"?mr:il==="right"?qr:-1;St>=0&&(u.text.placedSymbolArray.get(St).crossTileID=Qu>=0&&St!==Qu?0:tl),mr>=0&&(u.text.placedSymbolArray.get(mr).crossTileID=Qu>=0&&mr!==Qu?0:tl),qr>=0&&(u.text.placedSymbolArray.get(qr).crossTileID=Qu>=0&&qr!==Qu?0:tl),ss>=0&&(u.text.placedSymbolArray.get(ss).crossTileID=Qu>=0&&ss!==Qu?0:tl)}markUsedOrientation(u,E,B){const _e=E===o.WritingMode.horizontal||E===o.WritingMode.horizontalOnly?E:0,St=E===o.WritingMode.vertical?E:0,{leftJustifiedTextSymbolIndex:mr,centerJustifiedTextSymbolIndex:qr,rightJustifiedTextSymbolIndex:ss,verticalPlacedTextSymbolIndex:tl}=B,il=u.text.placedSymbolArray;mr>=0&&(il.get(mr).placedOrientation=_e),qr>=0&&(il.get(qr).placedOrientation=_e),ss>=0&&(il.get(ss).placedOrientation=_e),tl>=0&&(il.get(tl).placedOrientation=St)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const E=this.prevPlacement;let B=!1;this.prevZoomAdjustment=E?E.zoomAdjustment(this.transform.zoom):0;const _e=E?E.symbolFadeChange(u):1,St=E?E.opacities:{},mr=E?E.variableOffsets:{},qr=E?E.placedOrientations:{};for(const ss in this.placements){const tl=this.placements[ss],il=St[ss];il?(this.opacities[ss]=new Yp(il,_e,tl.text,tl.icon,null,tl.clipped),B=B||tl.text!==il.text.placed||tl.icon!==il.icon.placed):(this.opacities[ss]=new Yp(null,_e,tl.text,tl.icon,tl.skipFade,tl.clipped),B=B||tl.text||tl.icon)}for(const ss in St){const tl=St[ss];if(!this.opacities[ss]){const il=new Yp(tl,_e,!1,!1);il.isHidden()||(this.opacities[ss]=il,B=B||tl.text.placed||tl.icon.placed)}}for(const ss in mr)this.variableOffsets[ss]||!this.opacities[ss]||this.opacities[ss].isHidden()||(this.variableOffsets[ss]=mr[ss]);for(const ss in qr)this.placedOrientations[ss]||!this.opacities[ss]||this.opacities[ss].isHidden()||(this.placedOrientations[ss]=qr[ss]);B?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=E?E.lastPlacementChangeTime:u)}updateLayerOpacities(u,E){const B={};for(const _e of E){const St=_e.getBucket(u);St&&_e.latestFeatureIndex&&u.id===St.layerIds[0]&&this.updateBucketOpacities(St,B,_e.collisionBoxArray)}}updateBucketOpacities(u,E,B){u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const _e=u.layers[0].layout,St=!!u.layers[0].dynamicFilter(),mr=new Yp(null,0,!1,!1,!0),qr=_e.get("text-allow-overlap"),ss=_e.get("icon-allow-overlap"),tl=_e.get("text-variable-anchor"),il=_e.get("text-rotation-alignment")==="map",Qu=_e.get("text-pitch-alignment")==="map",fh=_e.get("icon-text-fit")!=="none",wh=new Yp(null,0,qr&&(ss||!u.hasIconData()||_e.get("icon-optional")),ss&&(qr||!u.hasTextData()||_e.get("text-optional")),!0);!u.collisionArrays&&B&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(B);const Sh=(Ch,hh,Oh)=>{for(let Rh=0;Rh<hh/4;Rh++)Ch.opacityVertexArray.emplaceBack(Oh)};let Th=0;for(let Ch=0;Ch<u.symbolInstances.length;Ch++){const hh=u.symbolInstances.get(Ch),{numHorizontalGlyphVertices:Oh,numVerticalGlyphVertices:Rh,crossTileID:Nh,numIconVertices:qh}=hh;let Fh=this.opacities[Nh];E[Nh]?Fh=mr:Fh||(Fh=wh,this.opacities[Nh]=Fh),E[Nh]=!0;const Hh=Oh>0||Rh>0,ld=qh>0,xd=this.placedOrientations[Nh],gd=xd===o.WritingMode.vertical,Vf=xd===o.WritingMode.horizontal||xd===o.WritingMode.horizontalOnly;if(!Hh&&!ld||Fh.isHidden()||Th++,Hh){const _d=u_(Fh.text);Sh(u.text,Oh,gd?Oy:_d),Sh(u.text,Rh,Vf?Oy:_d);const Cf=Fh.text.isHidden(),{leftJustifiedTextSymbolIndex:Ud,centerJustifiedTextSymbolIndex:Lf,rightJustifiedTextSymbolIndex:Cd,verticalPlacedTextSymbolIndex:pd}=hh,$d=u.text.placedSymbolArray,yf=Cf||gd?1:0;Ud>=0&&($d.get(Ud).hidden=yf),Lf>=0&&($d.get(Lf).hidden=yf),Cd>=0&&($d.get(Cd).hidden=yf),pd>=0&&($d.get(pd).hidden=Cf||Vf?1:0);const $f=this.variableOffsets[Nh];$f&&this.markUsedJustification(u,$f.anchor,hh,xd);const Dp=this.placedOrientations[Nh];Dp&&(this.markUsedJustification(u,"left",hh,Dp),this.markUsedOrientation(u,Dp,hh))}if(ld){const _d=u_(Fh.icon),{placedIconSymbolIndex:Cf,verticalPlacedIconSymbolIndex:Ud}=hh,Lf=u.icon.placedSymbolArray,Cd=Fh.icon.isHidden()?1:0;Cf>=0&&(Sh(u.icon,qh,gd?Oy:_d),Lf.get(Cf).hidden=Cd),Ud>=0&&(Sh(u.icon,hh.numVerticalIconVertices,Vf?Oy:_d),Lf.get(Ud).hidden=Cd)}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const _d=u.collisionArrays[Ch];if(_d){let Cf=new o.pointGeometry(0,0),Ud=!0;if(_d.textBox||_d.verticalTextBox){if(tl){const Cd=this.variableOffsets[Nh];Cd?(Cf=Jm(Cd.anchor,Cd.width,Cd.height,Cd.textOffset,Cd.textScale),il&&Cf._rotate(Qu?this.transform.angle:-this.transform.angle)):Ud=!1}St&&(Ud=!Fh.clipped),_d.textBox&&kg(u.textCollisionBox.collisionVertexArray,Fh.text.placed,!Ud||gd,Cf.x,Cf.y),_d.verticalTextBox&&kg(u.textCollisionBox.collisionVertexArray,Fh.text.placed,!Ud||Vf,Cf.x,Cf.y)}const Lf=Ud&&!!(!Vf&&_d.verticalIconBox);_d.iconBox&&kg(u.iconCollisionBox.collisionVertexArray,Fh.icon.placed,Lf,fh?Cf.x:0,fh?Cf.y:0),_d.verticalIconBox&&kg(u.iconCollisionBox.collisionVertexArray,Fh.icon.placed,!Lf,fh?Cf.x:0,fh?Cf.y:0)}}}if(u.fullyClipped=Th===0,u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){const Ch=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=Ch.invProjMatrix,u.placementViewportMatrix=Ch.viewportMatrix,u.collisionCircleArray=Ch.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,E){const B=this.zoomAtLastRecencyCheck===E?1-this.zoomAdjustment(E):1;return this.zoomAtLastRecencyCheck=E,this.commitTime+this.fadeDuration*B>u}setStale(){this.stale=!0}}function kg(L,u,E,B,_e){L.emplaceBack(u?1:0,E?1:0,B||0,_e||0),L.emplaceBack(u?1:0,E?1:0,B||0,_e||0),L.emplaceBack(u?1:0,E?1:0,B||0,_e||0),L.emplaceBack(u?1:0,E?1:0,B||0,_e||0)}const $m=Math.pow(2,25),fy=Math.pow(2,24),Km=Math.pow(2,17),Xg=Math.pow(2,16),Ly=Math.pow(2,9),Ry=Math.pow(2,8),wg=Math.pow(2,1);function u_(L){if(L.opacity===0&&!L.placed)return 0;if(L.opacity===1&&L.placed)return 4294967295;const u=L.placed?1:0,E=Math.floor(127*L.opacity);return E*$m+u*fy+E*Km+u*Xg+E*Ly+u*Ry+E*wg+u}const Oy=0;class V_{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,E,B,_e,St){const mr=this._bucketParts;for(;this._currentTileIndex<u.length;)if(E.getBucketParts(mr,_e,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,St())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,mr.sort((qr,ss)=>qr.sortKey-ss.sortKey));this._currentPartIndex<mr.length;){const qr=mr[this._currentPartIndex];if(E.placeLayerBucketPart(qr,this._seenCrossTileIDs,B,qr.symbolInstanceStart===0),this._currentPartIndex++,St())return!0}return!1}}class n0{constructor(u,E,B,_e,St,mr,qr,ss){this.placement=new bg(u,St,mr,qr,ss),this._currentPlacementIndex=E.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=_e,this._done=!1}isDone(){return this._done}continuePlacement(u,E,B){const _e=o.exported.now(),St=()=>{const mr=o.exported.now()-_e;return!this._forceFullPlacement&&mr>2};for(;this._currentPlacementIndex>=0;){const mr=E[u[this._currentPlacementIndex]],qr=this.placement.collisionIndex.transform.zoom;if(mr.type==="symbol"&&(!mr.minzoom||mr.minzoom<=qr)&&(!mr.maxzoom||mr.maxzoom>qr)){if(this._inProgressLayer||(this._inProgressLayer=new V_(mr)),this._inProgressLayer.continuePlacement(B[mr.source],this.placement,this._showCollisionBoxes,mr,St))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const O0=512/o.EXTENT/2;class l1{constructor(u,E,B){this.tileID=u,this.indexedSymbolInstances={},this.bucketInstanceId=B;for(let _e=0;_e<E.length;_e++){const St=E.get(_e),mr=St.key;this.indexedSymbolInstances[mr]||(this.indexedSymbolInstances[mr]=[]),this.indexedSymbolInstances[mr].push({crossTileID:St.crossTileID,coord:this.getScaledCoordinates(St,u)})}}getScaledCoordinates(u,E){const B=O0/Math.pow(2,E.canonical.z-this.tileID.canonical.z);return{x:Math.floor((E.canonical.x*o.EXTENT+u.tileAnchorX)*B),y:Math.floor((E.canonical.y*o.EXTENT+u.tileAnchorY)*B)}}findMatches(u,E,B){const _e=this.tileID.canonical.z<E.canonical.z?1:Math.pow(2,this.tileID.canonical.z-E.canonical.z);for(let St=0;St<u.length;St++){const mr=u.get(St);if(mr.crossTileID)continue;const qr=this.indexedSymbolInstances[mr.key];if(!qr)continue;const ss=this.getScaledCoordinates(mr,E);for(const tl of qr)if(Math.abs(tl.coord.x-ss.x)<=_e&&Math.abs(tl.coord.y-ss.y)<=_e&&!B[tl.crossTileID]){B[tl.crossTileID]=!0,mr.crossTileID=tl.crossTileID;break}}}}class tv{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const E=Math.round((u-this.lng)/360);if(E!==0)for(const B in this.indexes){const _e=this.indexes[B],St={};for(const mr in _e){const qr=_e[mr];qr.tileID=qr.tileID.unwrapTo(qr.tileID.wrap+E),St[qr.tileID.key]=qr}this.indexes[B]=St}this.lng=u}addBucket(u,E,B){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===E.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let St=0;St<E.symbolInstances.length;St++)E.symbolInstances.get(St).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const _e=this.usedCrossTileIDs[u.overscaledZ];for(const St in this.indexes){const mr=this.indexes[St];if(Number(St)>u.overscaledZ)for(const qr in mr){const ss=mr[qr];ss.tileID.isChildOf(u)&&ss.findMatches(E.symbolInstances,u,_e)}else{const qr=mr[u.scaledTo(Number(St)).key];qr&&qr.findMatches(E.symbolInstances,u,_e)}}for(let St=0;St<E.symbolInstances.length;St++){const mr=E.symbolInstances.get(St);mr.crossTileID||(mr.crossTileID=B.generate(),_e[mr.crossTileID]=!0)}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new l1(u,E.symbolInstances,E.bucketInstanceId),!0}removeBucketCrossTileIDs(u,E){for(const B in E.indexedSymbolInstances)for(const _e of E.indexedSymbolInstances[B])delete this.usedCrossTileIDs[u][_e.crossTileID]}removeStaleBuckets(u){let E=!1;for(const B in this.indexes){const _e=this.indexes[B];for(const St in _e)u[_e[St].bucketInstanceId]||(this.removeBucketCrossTileIDs(B,_e[St]),delete _e[St],E=!0)}return E}}class o0{constructor(){this.layerIndexes={},this.crossTileIDs=new tv,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,E,B,_e){let St=this.layerIndexes[u.id];St===void 0&&(St=this.layerIndexes[u.id]=new oy);let mr=!1;const qr={};_e.name!=="globe"&&St.handleWrapJump(B);for(const ss of E){const tl=ss.getBucket(u);tl&&u.id===tl.layerIds[0]&&(tl.bucketInstanceId||(tl.bucketInstanceId=++this.maxBucketInstanceId),St.addBucket(ss.tileID,tl,this.crossTileIDs)&&(mr=!0),qr[tl.bucketInstanceId]=!0)}return St.removeStaleBuckets(qr)&&(mr=!0),mr}pruneUnusedLayers(u){const E={};u.forEach(B=>{E[B]=!0});for(const B in this.layerIndexes)E[B]||delete this.layerIndexes[B]}}const $y=(L,u)=>o.emitValidationErrors(L,u&&u.filter(E=>E.identifier!=="source.canvas")),py=o.pick(Od,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Vg=o.pick(Od,["setCenter","setZoom","setBearing","setPitch"]),fm={version:8,layers:[],sources:{}},G_={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class eg extends o.Evented{constructor(u,E={}){super(),this.map=u,this.dispatcher=new Ed(np(),this),this.imageManager=new sh,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(u._requestManager,E.localFontFamily?o.LocalGlyphMode.all:E.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,E.localFontFamily||E.localIdeographFontFamily),this.crossTileSymbolIndex=new o0,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const B=this;this._rtlTextPluginCallback=eg.registerForPluginStateChange(_e=>{B.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_e.pluginStatus,pluginURL:_e.pluginURL},(St,mr)=>{if(o.triggerPluginCompletionEvent(St),mr&&mr.every(qr=>qr))for(const qr in B._sourceCaches){const ss=B._sourceCaches[qr],tl=ss.getSource().type;tl!=="vector"&&tl!=="geojson"||ss.reload()}})}),this.on("data",_e=>{if(_e.dataType!=="source"||_e.sourceDataType!=="metadata")return;const St=this.getSource(_e.sourceId);if(St&&St.vectorLayerIds)for(const mr in this._layers){const qr=this._layers[mr];qr.source===St.id&&this._validateLayer(qr)}})}loadURL(u,E={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const B=typeof E.validate=="boolean"?E.validate:!o.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,E.accessToken);const _e=this.map._requestManager.transformRequest(u,o.ResourceType.Style);this._request=o.getJSON(_e,(St,mr)=>{this._request=null,St?this.fire(new o.ErrorEvent(St)):mr&&this._load(mr,B)})}loadJSON(u,E={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(u,E.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(fm,!1)}_updateLayerCount(u,E){const B=E?1:-1;u.is3D()&&(this._num3DLayers+=B),u.type==="circle"&&(this._numCircleLayers+=B),u.type==="symbol"&&(this._numSymbolLayers+=B)}_load(u,E){if(E&&$y(this,o.validateStyle(u)))return;this._loaded=!0,this.stylesheet=o.clone$1(u),this._updateMapProjection();for(const _e in u.sources)this.addSource(_e,u.sources[_e],{validate:!1});this._changed=!1,u.sprite?this._loadSprite(u.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(u.glyphs);const B=mf(this.stylesheet.layers);this._order=B.map(_e=>_e.id),this._layers={},this._serializedLayers={};for(const _e of B){const St=o.createStyleLayer(_e);St.setEventedParent(this,{layer:{id:St.id}}),this._layers[St.id]=St,this._serializedLayers[St.id]=St.serialize(),this._updateLayerCount(St,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Lh(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(u){u?this.stylesheet.projection=u:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(u){this._spriteRequest=function(E,B,_e){let St,mr,qr;const ss=o.exported.devicePixelRatio>1?"@2x":"";let tl=o.getJSON(B.transformRequest(B.normalizeSpriteURL(E,ss,".json"),o.ResourceType.SpriteJSON),(fh,wh)=>{tl=null,qr||(qr=fh,St=wh,Qu())}),il=o.getImage(B.transformRequest(B.normalizeSpriteURL(E,ss,".png"),o.ResourceType.SpriteImage),(fh,wh)=>{il=null,qr||(qr=fh,mr=wh,Qu())});function Qu(){if(qr)_e(qr);else if(St&&mr){const fh=o.exported.getImageData(mr),wh={};for(const Sh in St){const{width:Th,height:Ch,x:hh,y:Oh,sdf:Rh,pixelRatio:Nh,stretchX:qh,stretchY:Fh,content:Hh}=St[Sh],ld=new o.RGBAImage({width:Th,height:Ch});o.RGBAImage.copy(fh,ld,{x:hh,y:Oh},{x:0,y:0},{width:Th,height:Ch}),wh[Sh]={data:ld,pixelRatio:Nh,sdf:Rh,stretchX:qh,stretchY:Fh,content:Hh}}_e(null,wh)}}return{cancel(){tl&&(tl.cancel(),tl=null),il&&(il.cancel(),il=null)}}}(u,this.map._requestManager,(E,B)=>{if(this._spriteRequest=null,E)this.fire(new o.ErrorEvent(E));else if(B)for(const _e in B)this.imageManager.addImage(_e,B[_e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(u){const E=this.getSource(u.source);if(!E)return;const B=u.sourceLayer;B&&(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(B)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${B}" does not exist on source "${E.id}" as specified by style layer "${u.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const u in this._sourceCaches)if(!this._sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(u){const E=[];for(const B of u){const _e=this._layers[B];_e.type!=="custom"&&E.push(_e.serialize())}return E}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const u in this._sourceCaches)if(this._sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(u){return!!this.terrain&&(typeof u.isLayerDraped=="function"?u.isLayerDraped():G_[u.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(u){if(!this._loaded)return;const E=this._changed;if(this._changed){const _e=Object.keys(this._updatedLayers),St=Object.keys(this._removedLayers);(_e.length||St.length)&&this._updateWorkerLayers(_e,St);for(const mr in this._updatedSources){const qr=this._updatedSources[mr];qr==="reload"?this._reloadSource(mr):qr==="clear"&&this._clearSource(mr)}this._updateTilesForChangedImages();for(const mr in this._updatedPaintProps)this._layers[mr].updateTransitions(u);this.light.updateTransitions(u),this.fog&&this.fog.updateTransitions(u),this._resetUpdates()}const B={};for(const _e in this._sourceCaches){const St=this._sourceCaches[_e];B[_e]=St.used,St.used=!1}for(const _e of this._order){const St=this._layers[_e];if(St.recalculate(u,this._availableImages),!St.isHidden(u.zoom)){const qr=this._getLayerSourceCache(St);qr&&(qr.used=!0)}const mr=this.map.painter;if(mr){const qr=St.getProgramIds();if(!qr)continue;const ss=St.getProgramConfiguration(u.zoom);for(const tl of qr)mr.useProgram(tl,ss)}}for(const _e in B){const St=this._sourceCaches[_e];B[_e]!==St.used&&St.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:St.getSource().id}))}this.light.recalculate(u),this.terrain&&this.terrain.recalculate(u),this.fog&&this.fog.recalculate(u),this.z=u.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),E&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const E in this._sourceCaches)this._sourceCaches[E].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateWorkerLayers(u,E){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:E})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(u){if(this._checkLoaded(),$y(this,o.validateStyle(u)))return!1;(u=o.clone$1(u)).layers=mf(u.layers);const E=function(_e,St){if(!_e)return[{command:Od.setStyle,args:[St]}];let mr=[];try{if(!x(_e.version,St.version))return[{command:Od.setStyle,args:[St]}];x(_e.center,St.center)||mr.push({command:Od.setCenter,args:[St.center]}),x(_e.zoom,St.zoom)||mr.push({command:Od.setZoom,args:[St.zoom]}),x(_e.bearing,St.bearing)||mr.push({command:Od.setBearing,args:[St.bearing]}),x(_e.pitch,St.pitch)||mr.push({command:Od.setPitch,args:[St.pitch]}),x(_e.sprite,St.sprite)||mr.push({command:Od.setSprite,args:[St.sprite]}),x(_e.glyphs,St.glyphs)||mr.push({command:Od.setGlyphs,args:[St.glyphs]}),x(_e.transition,St.transition)||mr.push({command:Od.setTransition,args:[St.transition]}),x(_e.light,St.light)||mr.push({command:Od.setLight,args:[St.light]}),x(_e.fog,St.fog)||mr.push({command:Od.setFog,args:[St.fog]}),x(_e.projection,St.projection)||mr.push({command:Od.setProjection,args:[St.projection]});const qr={},ss=[];(function(Qu,fh,wh,Sh){let Th;for(Th in fh=fh||{},Qu=Qu||{})Qu.hasOwnProperty(Th)&&(fh.hasOwnProperty(Th)||mp(Th,wh,Sh));for(Th in fh){if(!fh.hasOwnProperty(Th))continue;const Ch=fh[Th];Qu.hasOwnProperty(Th)?x(Qu[Th],Ch)||(Qu[Th].type==="geojson"&&Ch.type==="geojson"&&om(Qu,fh,Th)?wh.push({command:Od.setGeoJSONSourceData,args:[Th,Ch.data]}):Vp(Th,fh,wh,Sh)):qf(Th,fh,wh)}})(_e.sources,St.sources,ss,qr);const tl=[];_e.layers&&_e.layers.forEach(Qu=>{Qu.source&&qr[Qu.source]?mr.push({command:Od.removeLayer,args:[Qu.id]}):tl.push(Qu)});let il=_e.terrain;il&&qr[il.source]&&(mr.push({command:Od.setTerrain,args:[void 0]}),il=void 0),mr=mr.concat(ss),x(il,St.terrain)||mr.push({command:Od.setTerrain,args:[St.terrain]}),function(Qu,fh,wh){fh=fh||[];const Sh=(Qu=Qu||[]).map(Hg),Th=fh.map(Hg),Ch=Qu.reduce(Fm,{}),hh=fh.reduce(Fm,{}),Oh=Sh.slice(),Rh=Object.create(null);let Nh,qh,Fh,Hh,ld,xd,gd;for(Nh=0,qh=0;Nh<Sh.length;Nh++)Fh=Sh[Nh],hh.hasOwnProperty(Fh)?qh++:(wh.push({command:Od.removeLayer,args:[Fh]}),Oh.splice(Oh.indexOf(Fh,qh),1));for(Nh=0,qh=0;Nh<Th.length;Nh++)Fh=Th[Th.length-1-Nh],Oh[Oh.length-1-Nh]!==Fh&&(Ch.hasOwnProperty(Fh)?(wh.push({command:Od.removeLayer,args:[Fh]}),Oh.splice(Oh.lastIndexOf(Fh,Oh.length-qh),1)):qh++,xd=Oh[Oh.length-Nh],wh.push({command:Od.addLayer,args:[hh[Fh],xd]}),Oh.splice(Oh.length-Nh,0,Fh),Rh[Fh]=!0);for(Nh=0;Nh<Th.length;Nh++)if(Fh=Th[Nh],Hh=Ch[Fh],ld=hh[Fh],!Rh[Fh]&&!x(Hh,ld))if(x(Hh.source,ld.source)&&x(Hh["source-layer"],ld["source-layer"])&&x(Hh.type,ld.type)){for(gd in Pd(Hh.layout,ld.layout,wh,Fh,null,Od.setLayoutProperty),Pd(Hh.paint,ld.paint,wh,Fh,null,Od.setPaintProperty),x(Hh.filter,ld.filter)||wh.push({command:Od.setFilter,args:[Fh,ld.filter]}),x(Hh.minzoom,ld.minzoom)&&x(Hh.maxzoom,ld.maxzoom)||wh.push({command:Od.setLayerZoomRange,args:[Fh,ld.minzoom,ld.maxzoom]}),Hh)Hh.hasOwnProperty(gd)&&gd!=="layout"&&gd!=="paint"&&gd!=="filter"&&gd!=="metadata"&&gd!=="minzoom"&&gd!=="maxzoom"&&(gd.indexOf("paint.")===0?Pd(Hh[gd],ld[gd],wh,Fh,gd.slice(6),Od.setPaintProperty):x(Hh[gd],ld[gd])||wh.push({command:Od.setLayerProperty,args:[Fh,gd,ld[gd]]}));for(gd in ld)ld.hasOwnProperty(gd)&&!Hh.hasOwnProperty(gd)&&gd!=="layout"&&gd!=="paint"&&gd!=="filter"&&gd!=="metadata"&&gd!=="minzoom"&&gd!=="maxzoom"&&(gd.indexOf("paint.")===0?Pd(Hh[gd],ld[gd],wh,Fh,gd.slice(6),Od.setPaintProperty):x(Hh[gd],ld[gd])||wh.push({command:Od.setLayerProperty,args:[Fh,gd,ld[gd]]}))}else wh.push({command:Od.removeLayer,args:[Fh]}),xd=Oh[Oh.lastIndexOf(Fh)+1],wh.push({command:Od.addLayer,args:[ld,xd]})}(tl,St.layers,mr)}catch(qr){console.warn("Unable to compute style diff:",qr),mr=[{command:Od.setStyle,args:[St]}]}return mr}(this.serialize(),u).filter(_e=>!(_e.command in Vg));if(E.length===0)return!1;const B=E.filter(_e=>!(_e.command in py));if(B.length>0)throw new Error(`Unimplemented: ${B.map(_e=>_e.command).join(", ")}.`);return E.forEach(_e=>{_e.command!=="setTransition"&&_e.command!=="setProjection"&&this[_e.command].apply(this,_e.args)}),this.stylesheet=u,this._updateMapProjection(),!0}addImage(u,E){return this.getImage(u)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(u,E),this._afterImageUpdated(u),this)}updateImage(u,E){this.imageManager.updateImage(u,E)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){return this.getImage(u)?(this.imageManager.removeImage(u),this._afterImageUpdated(u),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(u,E,B={}){if(this._checkLoaded(),this.getSource(u)!==void 0)throw new Error("There is already a source with this ID");if(!E.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(E).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(E.type)>=0&&this._validate(o.validateSource,`sources.${u}`,E,null,B))return;this.map&&this.map._collectResourceTiming&&(E.collectResourceTiming=!0);const _e=dh(u,E,this.dispatcher,this);_e.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(u),source:_e.serialize(),sourceId:u}));const St=mr=>{const qr=(mr?"symbol:":"other:")+u,ss=this._sourceCaches[qr]=new o.SourceCache(qr,_e,mr);(mr?this._symbolSourceCaches:this._otherSourceCaches)[u]=ss,ss.style=this,ss.onAdd(this.map)};St(!1),E.type!=="vector"&&E.type!=="geojson"||St(!0),_e.onAdd&&_e.onAdd(this.map),this._changed=!0}removeSource(u){this._checkLoaded();const E=this.getSource(u);if(!E)throw new Error("There is no source with this ID");for(const _e in this._layers)if(this._layers[_e].source===u)return this.fire(new o.ErrorEvent(new Error(`Source "${u}" cannot be removed while layer "${_e}" is using it.`)));if(this.terrain&&this.terrain.get().source===u)return this.fire(new o.ErrorEvent(new Error(`Source "${u}" cannot be removed while terrain is using it.`)));const B=this._getSourceCaches(u);for(const _e of B)delete this._sourceCaches[_e.id],delete this._updatedSources[_e.id],_e.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_e.getSource().id})),_e.setEventedParent(null),_e.clearTiles();return delete this._otherSourceCaches[u],delete this._symbolSourceCaches[u],E.setEventedParent(null),E.onRemove&&E.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(u,E){this._checkLoaded(),this.getSource(u).setData(E),this._changed=!0}getSource(u){const E=this._getSourceCache(u);return E&&E.getSource()}_getSources(){const u=[];for(const E in this._otherSourceCaches){const B=this._getSourceCache(E);B&&u.push(B.getSource())}return u}addLayer(u,E,B={}){this._checkLoaded();const _e=u.id;if(this.getLayer(_e))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${_e}" already exists on this map`)));let St;if(u.type==="custom"){if($y(this,o.validateCustomStyleLayer(u)))return;St=o.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(_e,u.source),u=o.clone$1(u),u=o.extend(u,{source:_e})),this._validate(o.validateLayer,`layers.${_e}`,u,{arrayIndex:-1},B))return;St=o.createStyleLayer(u),this._validateLayer(St),St.setEventedParent(this,{layer:{id:_e}}),this._serializedLayers[St.id]=St.serialize(),this._updateLayerCount(St,!0)}const mr=E?this._order.indexOf(E):this._order.length;if(E&&mr===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" does not exist on this map.`)));this._order.splice(mr,0,_e),this._layerOrderChanged=!0,this._layers[_e]=St;const qr=this._getLayerSourceCache(St);if(this._removedLayers[_e]&&St.source&&qr&&St.type!=="custom"){const ss=this._removedLayers[_e];delete this._removedLayers[_e],ss.type!==St.type?this._updatedSources[St.source]="clear":(this._updatedSources[St.source]="reload",qr.pause())}this._updateLayer(St),St.onAdd&&St.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(u,E){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===E)return;const B=this._order.indexOf(u);this._order.splice(B,1);const _e=E?this._order.indexOf(E):this._order.length;E&&_e===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" does not exist on this map.`))):(this._order.splice(_e,0,u),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(u){this._checkLoaded();const E=this._layers[u];if(!E)return void this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be removed.`)));E.setEventedParent(null),this._updateLayerCount(E,!1);const B=this._order.indexOf(u);this._order.splice(B,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=E,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],E.onRemove&&E.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(u){return this._layers[u]}hasLayer(u){return u in this._layers}hasLayerType(u){for(const E in this._layers)if(this._layers[E].type===u)return!0;return!1}setLayerZoomRange(u,E,B){this._checkLoaded();const _e=this.getLayer(u);_e?_e.minzoom===E&&_e.maxzoom===B||(E!=null&&(_e.minzoom=E),B!=null&&(_e.maxzoom=B),this._updateLayer(_e)):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(u,E,B={}){this._checkLoaded();const _e=this.getLayer(u);if(_e){if(!x(_e.filter,E))return E==null?(_e.filter=void 0,void this._updateLayer(_e)):void(this._validate(o.validateFilter,`layers.${_e.id}.filter`,E,{layerType:_e.type},B)||(_e.filter=o.clone$1(E),this._updateLayer(_e)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be filtered.`)))}getFilter(u){const E=this.getLayer(u);return E&&o.clone$1(E.filter)}setLayoutProperty(u,E,B,_e={}){this._checkLoaded();const St=this.getLayer(u);St?x(St.getLayoutProperty(E),B)||(St.setLayoutProperty(E,B,_e),this._updateLayer(St)):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(u,E){const B=this.getLayer(u);if(B)return B.getLayoutProperty(E);this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style.`)))}setPaintProperty(u,E,B,_e={}){this._checkLoaded();const St=this.getLayer(u);St?x(St.getPaintProperty(E),B)||(St.setPaintProperty(E,B,_e)&&this._updateLayer(St),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(u,E){const B=this.getLayer(u);return B&&B.getPaintProperty(E)}setFeatureState(u,E){this._checkLoaded();const B=u.source,_e=u.sourceLayer,St=this.getSource(B);if(!St)return void this.fire(new o.ErrorEvent(new Error(`The source '${B}' does not exist in the map's style.`)));const mr=St.type;if(mr==="geojson"&&_e)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(mr==="vector"&&!_e)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const qr=this._getSourceCaches(B);for(const ss of qr)ss.setFeatureState(_e,u.id,E)}removeFeatureState(u,E){this._checkLoaded();const B=u.source,_e=this.getSource(B);if(!_e)return void this.fire(new o.ErrorEvent(new Error(`The source '${B}' does not exist in the map's style.`)));const St=_e.type,mr=St==="vector"?u.sourceLayer:void 0;if(St==="vector"&&!mr)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(E&&typeof u.id!="string"&&typeof u.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const qr=this._getSourceCaches(B);for(const ss of qr)ss.removeFeatureState(mr,u.id,E)}getFeatureState(u){this._checkLoaded();const E=u.source,B=u.sourceLayer,_e=this.getSource(E);if(_e){if(_e.type!=="vector"||B)return u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(E)[0].getFeatureState(B,u.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${E}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const u={};for(const E in this._sourceCaches){const B=this._sourceCaches[E].getSource();u[B.id]||(u[B.id]=B.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:u,layers:this._serializeLayers(this._order)},E=>E!==void 0)}_updateLayer(u){this._updatedLayers[u.id]=!0;const E=this._getLayerSourceCache(u);u.source&&!this._updatedSources[u.source]&&E&&E.getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",E.pause()),this._changed=!0,u.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(u){const E=mr=>this._layers[mr].type==="fill-extrusion",B={},_e=[];for(let mr=this._order.length-1;mr>=0;mr--){const qr=this._order[mr];if(E(qr)){B[qr]=mr;for(const ss of u){const tl=ss[qr];if(tl)for(const il of tl)_e.push(il)}}}_e.sort((mr,qr)=>qr.intersectionZ-mr.intersectionZ);const St=[];for(let mr=this._order.length-1;mr>=0;mr--){const qr=this._order[mr];if(E(qr))for(let ss=_e.length-1;ss>=0;ss--){const tl=_e[ss].feature;if(B[tl.layer.id]<mr)break;St.push(tl),_e.pop()}else for(const ss of u){const tl=ss[qr];if(tl)for(const il of tl)St.push(il.feature)}}return St}queryRenderedFeatures(u,E,B){E&&E.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",E.filter,null,E);const _e={};if(E&&E.layers){if(!Array.isArray(E.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const ss of E.layers){const tl=this._layers[ss];if(!tl)return this.fire(new o.ErrorEvent(new Error(`The layer '${ss}' does not exist in the map's style and cannot be queried for features.`))),[];_e[tl.source]=!0}}const St=[];E.availableImages=this._availableImages;const mr=E&&E.layers?E.layers.some(ss=>{const tl=this.getLayer(ss);return tl&&tl.is3D()}):this.has3DLayers(),qr=zd.createFromScreenPoints(u,B);for(const ss in this._sourceCaches){const tl=this._sourceCaches[ss].getSource().id;E.layers&&!_e[tl]||St.push(Ph(this._sourceCaches[ss],this._layers,this._serializedLayers,qr,E,B,mr,!!this.map._showQueryGeometry))}return this.placement&&St.push(function(ss,tl,il,Qu,fh,wh,Sh){const Th={},Ch=wh.queryRenderedSymbols(Qu),hh=[];for(const Oh of Object.keys(Ch).map(Number))hh.push(Sh[Oh]);hh.sort(Ad);for(const Oh of hh){const Rh=Oh.featureIndex.lookupSymbolFeatures(Ch[Oh.bucketInstanceId],tl,Oh.bucketIndex,Oh.sourceLayerIndex,fh.filter,fh.layers,fh.availableImages,ss);for(const Nh in Rh){const qh=Th[Nh]=Th[Nh]||[],Fh=Rh[Nh];Fh.sort((Hh,ld)=>{const xd=Oh.featureSortOrder;if(xd){const gd=xd.indexOf(Hh.featureIndex);return xd.indexOf(ld.featureIndex)-gd}return ld.featureIndex-Hh.featureIndex});for(const Hh of Fh)qh.push(Hh)}}for(const Oh in Th)Th[Oh].forEach(Rh=>{const Nh=Rh.feature,qh=il(ss[Oh]);if(!qh)return;const Fh=qh.getFeatureState(Nh.layer["source-layer"],Nh.id);Nh.source=Nh.layer.source,Nh.layer["source-layer"]&&(Nh.sourceLayer=Nh.layer["source-layer"]),Nh.state=Fh});return Th}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),qr.screenGeometry,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(St)}querySourceFeatures(u,E){E&&E.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",E.filter,null,E);const B=this._getSourceCaches(u);let _e=[];for(const St of B)_e=_e.concat(zh(St,E));return _e}addSourceType(u,E,B){return eg.getSourceType(u)?B(new Error(`A source type called "${u}" already exists.`)):(eg.setSourceType(u,E),E.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:E.workerSourceURL},B):B(null,null))}getLight(){return this.light.getLight()}setLight(u,E={}){this._checkLoaded();const B=this.light.getLight();let _e=!1;for(const mr in u)if(!x(u[mr],B[mr])){_e=!0;break}if(!_e)return;const St=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(u,E),this.light.updateTransitions(St)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(u,E=1){if(this._checkLoaded(),!u)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let B=u;if(E===1){if(typeof B.source=="object"){const _e="terrain-dem-src";this.addSource(_e,B.source),B=o.clone$1(B),B=o.extend(B,{source:_e})}if(this._validate(o.validateTerrain,"terrain",B))return}if(!this.terrain||this.terrain&&E!==this.terrain.drapeRenderMode){if(!B)return;this._createTerrain(B,E)}else{const _e=this.terrain,St=_e.get();for(const mr of Object.keys(o.spec.terrain))!B.hasOwnProperty(mr)&&o.spec.terrain[mr].default&&(B[mr]=o.spec.terrain[mr].default);for(const mr in B)if(!x(B[mr],St[mr])){_e.set(B),this.stylesheet.terrain=B;const qr=this._setTransitionParameters({duration:0});_e.updateTransitions(qr);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(u){const E=this.fog=new qd(u,this.map.transform);this.stylesheet.fog=u;const B=this._setTransitionParameters({duration:0});E.updateTransitions(B)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const u of this.map._markers)u._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(u){if(this._checkLoaded(),!u)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const E=this.fog,B=E.get();Object.keys(u).length===0&&E.set(u);for(const _e in u)if(!x(u[_e],B[_e])){E.set(u),this.stylesheet.fog=u;const St=this._setTransitionParameters({duration:0});E.updateTransitions(St);break}}else this._createFog(u);this._markersNeedUpdate=!0}_setTransitionParameters(u){return{now:o.exported.now(),transition:o.extend(u,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const u=this._order.filter(B=>this.isLayerDraped(this._layers[B])),E=this._order.filter(B=>!this.isLayerDraped(this._layers[B]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...u),this._drapedFirstOrder.push(...E)}_createTerrain(u,E){const B=this.terrain=new Tf(u,E);this.stylesheet.terrain=u,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _e=this._setTransitionParameters({duration:0});B.updateTransitions(_e)}_force3DLayerUpdate(){for(const u in this._layers){const E=this._layers[u];E.type==="fill-extrusion"&&this._updateLayer(E)}}_forceSymbolLayerUpdate(){for(const u in this._layers){const E=this._layers[u];E.type==="symbol"&&this._updateLayer(E)}}_validate(u,E,B,_e,St={}){return(!St||St.validate!==!1)&&$y(this,u.call(o.validateStyle,o.extend({key:E,style:this.serialize(),value:B,styleSpec:o.spec},_e)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this._sourceCaches)this._sourceCaches[u].clearTiles(),this._sourceCaches[u].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(u){const E=this._getSourceCaches(u);for(const B of E)B.clearTiles()}_reloadSource(u){const E=this._getSourceCaches(u);for(const B of E)B.resume(),B.reload()}_reloadSources(){for(const u of this._getSources())u.reload&&u.reload()}_updateSources(u){for(const E in this._sourceCaches)this._sourceCaches[E].update(u)}_generateCollisionBoxes(){for(const u in this._sourceCaches){const E=this._sourceCaches[u];E.resume(),E.reload()}}_updatePlacement(u,E,B,_e,St=!1){let mr=!1,qr=!1;const ss={};for(const tl of this._order){const il=this._layers[tl];if(il.type!=="symbol")continue;if(!ss[il.source]){const fh=this._getLayerSourceCache(il);if(!fh)continue;ss[il.source]=fh.getRenderableIds(!0).map(wh=>fh.getTileByID(wh)).sort((wh,Sh)=>Sh.tileID.overscaledZ-wh.tileID.overscaledZ||(wh.tileID.isLessThan(Sh.tileID)?-1:1))}const Qu=this.crossTileSymbolIndex.addLayer(il,ss[il.source],u.center.lng,u.projection);mr=mr||Qu}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),St=St||this._layerOrderChanged||B===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(St||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),u.zoom))&&(this.pauseablePlacement=new n0(u,this._order,St,E,B,_e,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ss),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),qr=!0),mr&&this.pauseablePlacement.placement.setStale()),qr||mr)for(const tl of this._order){const il=this._layers[tl];il.type==="symbol"&&this.placement.updateLayerOpacities(il,ss[il.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const u in this._sourceCaches)this._sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,E,B){this.imageManager.getImages(E.icons,B),this._updateTilesForChangedImages();const _e=St=>{St&&St.setDependencies(E.tileID.key,E.type,E.icons)};_e(this._otherSourceCaches[E.source]),_e(this._symbolSourceCaches[E.source])}getGlyphs(u,E,B){this.glyphManager.getGlyphs(E.stacks,B)}getResource(u,E,B){return o.makeRequest(E,B)}_getSourceCache(u){return this._otherSourceCaches[u]}_getLayerSourceCache(u){return u.type==="symbol"?this._symbolSourceCaches[u.source]:this._otherSourceCaches[u.source]}_getSourceCaches(u){const E=[];return this._otherSourceCaches[u]&&E.push(this._otherSourceCaches[u]),this._symbolSourceCaches[u]&&E.push(this._symbolSourceCaches[u]),E}_isSourceCacheLoaded(u){const E=this._getSourceCaches(u);return E.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${u}'`))),!1):E.every(B=>B.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}eg.getSourceType=function(L){return uh[L]},eg.setSourceType=function(L,u){uh[L]=u},eg.registerForPluginStateChange=o.registerForPluginStateChange;var h_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,iv="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",By=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,j_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,a0=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let s0={},wm={};const ay=[];sy(h_,ay),sy(By,ay),sy(j_,ay),sy(a0,ay),s0=cm("",By),wm=cm(a0,j_);const my=cm(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),l0=h_,gy=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var vv={background:cm(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cm(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:cm(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cm("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cm(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cm(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cm("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cm("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cm("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:cm(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:cm(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cm(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cm(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cm(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:cm(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:cm(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cm(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cm(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:cm(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:cm(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:cm(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:cm(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:cm(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:cm(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:cm(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:cm(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,iv),skyboxGradient:cm(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,iv),skyboxCapture:cm(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cm(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cm(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function sy(L,u){const E=L.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let B of E)if(B=B.trim(),B[0]==="#"&&B.includes("if")&&!B.includes("endif")){B=B.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _e=B.split(" ");for(const St of _e)u.includes(St)||u.push(St)}}function cm(L,u){const E=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,B=u.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_e={},St=[...ay];return sy(L,St),sy(u,St),{fragmentSource:L=L.replace(E,(mr,qr,ss,tl,il)=>(_e[il]=!0,qr==="define"?`
#ifndef HAS_UNIFORM_u_${il}
varying ${ss} ${tl} ${il};
#else
uniform ${ss} ${tl} u_${il};
#endif
`:`
#ifdef HAS_UNIFORM_u_${il}
    ${ss} ${tl} ${il} = u_${il};
#endif
`)),vertexSource:u=u.replace(E,(mr,qr,ss,tl,il)=>{const Qu=tl==="float"?"vec2":"vec4",fh=il.match(/color/)?"color":Qu;return _e[il]?qr==="define"?`
#ifndef HAS_UNIFORM_u_${il}
uniform lowp float u_${il}_t;
attribute ${ss} ${Qu} a_${il};
varying ${ss} ${tl} ${il};
#else
uniform ${ss} ${tl} u_${il};
#endif
`:fh==="vec4"?`
#ifndef HAS_UNIFORM_u_${il}
    ${il} = a_${il};
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`:`
#ifndef HAS_UNIFORM_u_${il}
    ${il} = unpack_mix_${fh}(a_${il}, u_${il}_t);
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`:qr==="define"?`
#ifndef HAS_UNIFORM_u_${il}
uniform lowp float u_${il}_t;
attribute ${ss} ${Qu} a_${il};
#else
uniform ${ss} ${tl} u_${il};
#endif
`:fh==="vec4"?`
#ifndef HAS_UNIFORM_u_${il}
    ${ss} ${tl} ${il} = a_${il};
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`:`
#ifndef HAS_UNIFORM_u_${il}
    ${ss} ${tl} ${il} = unpack_mix_${fh}(a_${il}, u_${il}_t);
#else
    ${ss} ${tl} ${il} = u_${il};
#endif
`}),staticAttributes:B,usedDefines:St}}class Ny{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(u,E,B,_e,St,mr,qr){this.context=u;let ss=this.boundPaintVertexBuffers.length!==_e.length;for(let il=0;!ss&&il<_e.length;il++)this.boundPaintVertexBuffers[il]!==_e[il]&&(ss=!0);let tl=this.boundDynamicVertexBuffers.length!==qr.length;for(let il=0;!tl&&il<qr.length;il++)this.boundDynamicVertexBuffers[il]!==qr[il]&&(tl=!0);if(!u.extVertexArrayObject||!this.vao||this.boundProgram!==E||this.boundLayoutVertexBuffer!==B||ss||tl||this.boundIndexBuffer!==St||this.boundVertexOffset!==mr)this.freshBind(E,B,_e,St,mr,qr);else{u.bindVertexArrayOES.set(this.vao);for(const il of qr)il&&il.bind();St&&St.dynamicDraw&&St.bind()}}freshBind(u,E,B,_e,St,mr){let qr;const ss=u.numAttributes,tl=this.context,il=tl.gl;if(tl.extVertexArrayObject)this.vao&&this.destroy(),this.vao=tl.extVertexArrayObject.createVertexArrayOES(),tl.bindVertexArrayOES.set(this.vao),qr=0,this.boundProgram=u,this.boundLayoutVertexBuffer=E,this.boundPaintVertexBuffers=B,this.boundIndexBuffer=_e,this.boundVertexOffset=St,this.boundDynamicVertexBuffers=mr;else{qr=tl.currentNumAttributes||0;for(let Qu=ss;Qu<qr;Qu++)il.disableVertexAttribArray(Qu)}E.enableAttributes(il,u),E.bind(),E.setVertexAttribPointers(il,u,St);for(const Qu of B)Qu.enableAttributes(il,u),Qu.bind(),Qu.setVertexAttribPointers(il,u,St);for(const Qu of mr)Qu&&(Qu.enableAttributes(il,u),Qu.bind(),Qu.setVertexAttribPointers(il,u,St));_e&&_e.bind(),tl.currentNumAttributes=ss}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function zy(L,u){const E=Math.pow(2,u.canonical.z),B=u.canonical.y;return[new o.MercatorCoordinate(0,B/E).toLngLat().lat,new o.MercatorCoordinate(0,(B+1)/E).toLngLat().lat]}function q_(L,u,E,B,_e,St,mr){const qr=L.context,ss=qr.gl,tl=E.fbo;if(!tl)return;L.prepareDrawTile();const il=L.useProgram("hillshade");qr.activeTexture.set(ss.TEXTURE0),ss.bindTexture(ss.TEXTURE_2D,tl.colorAttachment.get());const Qu=((Th,Ch,hh,Oh)=>{const Rh=hh.paint.get("hillshade-shadow-color"),Nh=hh.paint.get("hillshade-highlight-color"),qh=hh.paint.get("hillshade-accent-color");let Fh=hh.paint.get("hillshade-illumination-direction")*(Math.PI/180);hh.paint.get("hillshade-illumination-anchor")==="viewport"&&(Fh-=Th.transform.angle);const Hh=!Th.options.moving;return{u_matrix:Oh||Th.transform.calculateProjMatrix(Ch.tileID.toUnwrapped(),Hh),u_image:0,u_latrange:zy(0,Ch.tileID),u_light:[hh.paint.get("hillshade-exaggeration"),Fh],u_shadow:Rh,u_highlight:Nh,u_accent:qh}})(L,E,B,L.terrain?u.projMatrix:null);L.prepareDrawProgram(qr,il,u.toUnwrapped());const{tileBoundsBuffer:fh,tileBoundsIndexBuffer:wh,tileBoundsSegments:Sh}=L.getTileBoundsBuffers(E);il.draw(qr,ss.TRIANGLES,_e,St,mr,o.CullFaceMode.disabled,Qu,B.id,fh,wh,Sh)}function d_(L,u,E){if(!u.needsDEMTextureUpload)return;const B=L.context,_e=B.gl;B.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||L.getTileTexture(E.stride);const St=E.getPixels();u.demTexture?u.demTexture.update(St,{premultiply:!1}):u.demTexture=new o.Texture(B,St,_e.RGBA,{premultiply:!1}),u.needsDEMTextureUpload=!1}function c0(L,u,E,B,_e,St){const mr=L.context,qr=mr.gl;if(!u.dem)return;const ss=u.dem;if(mr.activeTexture.set(qr.TEXTURE1),d_(L,u,ss),!u.demTexture)return;u.demTexture.bind(qr.NEAREST,qr.CLAMP_TO_EDGE);const tl=ss.dim;mr.activeTexture.set(qr.TEXTURE0);let il=u.fbo;if(!il){const Sh=new o.Texture(mr,{width:tl,height:tl,data:null},qr.RGBA);Sh.bind(qr.LINEAR,qr.CLAMP_TO_EDGE),il=u.fbo=mr.createFramebuffer(tl,tl,!0),il.colorAttachment.set(Sh.texture)}mr.bindFramebuffer.set(il.framebuffer),mr.viewport.set([0,0,tl,tl]);const{tileBoundsBuffer:Qu,tileBoundsIndexBuffer:fh,tileBoundsSegments:wh}=L.getMercatorTileBoundsBuffers();L.useProgram("hillshadePrepare").draw(mr,qr.TRIANGLES,B,_e,St,o.CullFaceMode.disabled,((Sh,Th)=>{const Ch=Th.stride,hh=o.create();return o.ortho(hh,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(hh,hh,[0,-o.EXTENT,0]),{u_matrix:hh,u_image:1,u_dimension:[Ch,Ch],u_zoom:Sh.overscaledZ,u_unpack:Th.unpackVector}})(u.tileID,ss),E.id,Qu,fh,wh),u.needsHillshadePrepare=!1}const u0=L=>({u_matrix:new o.UniformMatrix4f(L),u_image0:new o.Uniform1i(L),u_skirt_height:new o.Uniform1f(L)}),rv=(L,u)=>({u_matrix:L,u_image0:0,u_skirt_height:u}),Fy=(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh)=>({u_proj_matrix:Float32Array.from(L),u_globe_matrix:u,u_normalize_matrix:Float32Array.from(B),u_merc_matrix:E,u_zoom_transition:_e,u_merc_center:St,u_image0:0,u_frustum_tl:mr,u_frustum_tr:qr,u_frustum_br:ss,u_frustum_bl:tl,u_globe_pos:il,u_globe_radius:Qu,u_viewport:fh,u_grid_matrix:Sh?Float32Array.from(Sh):new Float32Array(9),u_skirt_height:wh});function h0(L,u){return L!=null&&u!=null&&!(!L.hasData()||!u.hasData())&&L.demTexture!=null&&u.demTexture!=null&&L.tileID.key!==u.tileID.key}const Eg=new class{constructor(){this.operations={}}newMorphing(L,u,E,B,_e){if(L in this.operations){const St=this.operations[L];St.to.tileID.key!==E.tileID.key&&(St.queued=E)}else this.operations[L]={startTime:B,phase:0,duration:_e,from:u,to:E,queued:null}}getMorphValuesForProxy(L){if(!(L in this.operations))return null;const u=this.operations[L];return{from:u.from,to:u.to,phase:u.phase}}update(L){for(const u in this.operations){const E=this.operations[u];for(E.phase=(L-E.startTime)/E.duration;E.phase>=1||!this._validOp(E);)if(!this._nextOp(E,L)){delete this.operations[u];break}}}_nextOp(L,u){return!!L.queued&&(L.from=L.to,L.to=L.queued,L.queued=null,L.phase=0,L.startTime=u,!0)}_validOp(L){return L.from.hasData()&&L.to.hasData()}},Z_={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function f_(L){return 6*Math.pow(1.5,22-L)}function p_(L,u){const E=1<<L.z;return!u&&(L.x===0||L.x===E-1)||L.y===0||L.y===E-1}const Kp=L=>({u_matrix:L});function C_(L,u,E,B,_e){if(_e>0){const St=o.exported.now(),mr=(St-L.timeAdded)/_e,qr=u?(St-u.timeAdded)/_e:-1,ss=E.getSource(),tl=B.coveringZoomLevel({tileSize:ss.tileSize,roundZoom:ss.roundZoom}),il=!u||Math.abs(u.tileID.overscaledZ-tl)>Math.abs(L.tileID.overscaledZ-tl),Qu=il&&L.refreshedUponExpiration?1:o.clamp(il?mr:1-qr,0,1);return L.refreshedUponExpiration&&mr>=1&&(L.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Qu}:{opacity:Qu,mix:0}}return{opacity:1,mix:0}}class m_ extends o.SourceCache{constructor(u){const E={type:"raster-dem",maxzoom:u.transform.maxZoom},B=new Ed(np(),null),_e=dh("mock-dem",E,B,u.style);super("mock-dem",_e,!1),_e.setEventedParent(this),this._sourceLoaded=!0}_loadTile(u,E){u.state="loaded",E(null)}}class Nv extends o.SourceCache{constructor(u){const E=dh("proxy",{type:"geojson",maxzoom:u.transform.maxZoom},new Ed(np(),null),u.style);super("proxy",E,!1),E.setEventedParent(this),this.map=this.getSource().map=u,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(u,E,B){if(u.freezeTileCoverage)return;this.transform=u;const _e=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((St,mr)=>{if(St[mr.key]="",!this._tiles[mr.key]){const qr=new o.Tile(mr,this._source.tileSize*mr.overscaleFactor(),u.tileZoom);qr.state="loaded",this._tiles[mr.key]=qr}return St},{});for(const St in this._tiles)St in _e||(this.freeFBO(St),this._tiles[St].unloadVectorData(),delete this._tiles[St])}freeFBO(u){const E=this.proxyCachedFBO[u];if(E!==void 0){const B=Object.values(E);this.renderCachePool.push(...B),delete this.proxyCachedFBO[u]}}deallocRenderCache(){this.renderCache.forEach(u=>u.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _y extends o.OverscaledTileID{constructor(u,E,B){super(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y),this.proxyTileKey=E,this.projMatrix=B}}class Uy extends o.Elevation{constructor(u,E){super(),this.painter=u,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[B,_e,St]=function(ss){const tl=new o.StructArrayLayout2i4,il=new o.StructArrayLayout3ui6,Qu=131;tl.reserve(17161),il.reserve(33800);const fh=o.EXTENT/128,wh=o.EXTENT+fh/2,Sh=wh+fh;for(let Ch=-fh;Ch<Sh;Ch+=fh)for(let hh=-fh;hh<Sh;hh+=fh){const Oh=hh<0||hh>wh||Ch<0||Ch>wh?24575:0,Rh=o.clamp(Math.round(hh),0,o.EXTENT),Nh=o.clamp(Math.round(Ch),0,o.EXTENT);tl.emplaceBack(Rh+Oh,Nh)}const Th=(Ch,hh)=>{const Oh=hh*Qu+Ch;il.emplaceBack(Oh+1,Oh,Oh+Qu),il.emplaceBack(Oh+Qu,Oh+Qu+1,Oh+1)};for(let Ch=1;Ch<129;Ch++)for(let hh=1;hh<129;hh++)Th(hh,Ch);return[0,129].forEach(Ch=>{for(let hh=0;hh<130;hh++)Th(hh,Ch),Th(Ch,hh)}),[tl,il,32768]}(),mr=u.context;this.gridBuffer=mr.createVertexBuffer(B,o.posAttributes.members),this.gridIndexBuffer=mr.createIndexBuffer(_e),this.gridSegments=o.SegmentVector.simpleSegment(0,0,B.length,_e.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,B.length,St),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nv(E.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const qr=mr.gl;this._overlapStencilMode=new o.StencilMode({func:qr.GEQUAL,mask:255},0,255,qr.KEEP,qr.KEEP,qr.REPLACE),this._previousZoom=u.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=E,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new m_(E.map)}set style(u){u.on("data",this._onStyleDataEvent.bind(this)),u.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=u,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(u,E,B){if(u&&u.terrain){this._style!==u&&(this.style=u),this.enabled=!0;const _e=u.terrain.properties;this.sourceCache=u.terrain.drapeRenderMode===0?this._mockSourceCache:u._getSourceCache(_e.get("source")),this._exaggeration=_e.get("exaggeration");const St=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const mr=this.getScaledDemTileSize();this.sourceCache.update(E,mr,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,St(),this._initializing=!0),St(),E.updateElevation(!0,B),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(E),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(u){this._findCoveringTileCache[u]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const u=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||u.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${u.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${u.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(u){u.coord&&u.dataType==="source"?this._clearRenderCacheForTile(u.sourceCacheId,u.coord):u.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const u in this._style._sourceCaches)this._style._sourceCaches[u].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(u=>u.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const u=2*this.proxySourceCache.getSource().tileSize;return[u,u]}set useVertexMorphing(u){this._useVertexMorphing=u}updateTileBinding(u){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const E=this.proxySourceCache,B=this.painter.transform;this._initializing&&(this._initializing=B._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(B.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _e=this.proxyCoords=E.getIds().map(ss=>{const tl=E.getTileByID(ss).tileID;return tl.projMatrix=B.calculateProjMatrix(tl.toUnwrapped()),tl});(function(ss,tl){const il=tl.transform.pointCoordinate(tl.transform.getCameraPoint()),Qu=new o.pointGeometry(il.x,il.y);ss.sort((fh,wh)=>{if(wh.overscaledZ-fh.overscaledZ)return wh.overscaledZ-fh.overscaledZ;const Sh=new o.pointGeometry(fh.canonical.x+(1<<fh.canonical.z)*fh.wrap,fh.canonical.y),Th=new o.pointGeometry(wh.canonical.x+(1<<wh.canonical.z)*wh.wrap,wh.canonical.y),Ch=Qu.mult(1<<fh.canonical.z);return Ch.x-=.5,Ch.y-=.5,Ch.distSqr(Sh)-Ch.distSqr(Th)})})(_e,this.painter),this._previousZoom=B.zoom;const St=this.proxyToSource||{};this.proxyToSource={},_e.forEach(ss=>{this.proxyToSource[ss.key]={}}),this.terrainTileForTile={};const mr=this._style._sourceCaches;for(const ss in mr){const tl=mr[ss];if(!tl.used||(tl!==this.sourceCache&&this.resetTileLookupCache(tl.id),this._setupProxiedCoordsForOrtho(tl,u[ss],St),tl.usedForTerrain))continue;const il=u[ss];tl.getSource().reparseOverscaled&&this._assignTerrainTiles(il)}this.proxiedCoords[E.id]=_e.map(ss=>new _y(ss,ss.key,this.orthoMatrix)),this._assignTerrainTiles(_e),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(St),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const qr={};this._visibleDemTiles=[];for(const ss of this.proxyCoords){const tl=this.terrainTileForTile[ss.key];if(!tl)continue;const il=tl.tileID.key;il in qr||(this._visibleDemTiles.push(tl),qr[il]=il)}}_assignTerrainTiles(u){this._initializing||u.forEach(E=>{if(this.terrainTileForTile[E.key])return;const B=this._findTileCoveringTileID(E,this.sourceCache);B&&(this.terrainTileForTile[E.key]=B)})}_prepareDEMTextures(){const u=this.painter.context,E=u.gl;for(const B in this.terrainTileForTile){const _e=this.terrainTileForTile[B],St=_e.dem;!St||_e.demTexture&&!_e.needsDEMTextureUpload||(u.activeTexture.set(E.TEXTURE1),d_(this.painter,_e,St))}}_prepareDemTileUniforms(u,E,B,_e){if(!E||E.demTexture==null)return!1;const St=u.tileID.canonical,mr=Math.pow(2,E.tileID.canonical.z-St.z),qr=_e||"";return B[`u_dem_tl${qr}`]=[St.x*mr%1,St.y*mr%1],B[`u_dem_scale${qr}`]=mr,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const u=this.painter.context,E=u.gl;if(!this._emptyDepthBufferTexture){const B=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(u,B,E.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let u=0;const E=this._visibleDemTiles.reduce((B,_e)=>{if(!_e.dem)return B;const St=_e.dem.tree.minimums[0];return St>0&&u++,B+St},0);return u?E/u:0}_updateEmptyDEMTexture(){const u=this.painter.context,E=u.gl;u.activeTexture.set(E.TEXTURE2);const B=this._getLoadedAreaMinimum(),_e=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(B,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let St=this._emptyDEMTexture;return St?St.update(_e,{premultiply:!1}):St=this._emptyDEMTexture=new o.Texture(u,_e,E.RGBA,{premultiply:!1}),St}setupElevationDraw(u,E,B){const _e=this.painter.context,St=_e.gl,mr=(qr=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(qr),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var qr;mr.u_dem_size=this.sourceCache.getSource().tileSize,mr.u_exaggeration=this.exaggeration();let ss=null,tl=null,il=1;if(B&&B.morphing&&this._useVertexMorphing){const Qu=B.morphing.srcDemTile,fh=B.morphing.dstDemTile;il=B.morphing.phase,Qu&&fh&&(this._prepareDemTileUniforms(u,Qu,mr,"_prev")&&(tl=Qu),this._prepareDemTileUniforms(u,fh,mr)&&(ss=fh))}if(tl&&ss?(_e.activeTexture.set(St.TEXTURE2),ss.demTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE,St.NEAREST),_e.activeTexture.set(St.TEXTURE4),tl.demTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE,St.NEAREST),mr.u_dem_lerp=il):(ss=this.terrainTileForTile[u.tileID.key],_e.activeTexture.set(St.TEXTURE2),(this._prepareDemTileUniforms(u,ss,mr)?ss.demTexture:this.emptyDEMTexture).bind(St.NEAREST,St.CLAMP_TO_EDGE)),_e.activeTexture.set(St.TEXTURE3),B&&B.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE),this._depthFBO&&(mr.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE),mr.u_depth_size_inv=[1,1]),B&&B.useMeterToDem&&ss){const Qu=(1<<ss.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;mr.u_meter_to_dem=Qu}if(B&&B.labelPlaneMatrixInv&&(mr.u_label_plane_matrix_inv=B.labelPlaneMatrixInv),E.setTerrainUniformValues(_e,mr),this.painter.transform.projection.name==="globe"){const Qu=this.globeUniformValues(this.painter.transform,u.tileID.canonical,B&&B.useDenormalizedUpVectorScale);E.setGlobeUniformValues(_e,Qu)}}globeUniformValues(u,E,B){const _e=u.projection;return{u_tile_tl_up:_e.upVector(E,0,0),u_tile_tr_up:_e.upVector(E,o.EXTENT,0),u_tile_br_up:_e.upVector(E,o.EXTENT,o.EXTENT),u_tile_bl_up:_e.upVector(E,0,o.EXTENT),u_tile_up_scale:B?o.globeMetersToEcef(1):_e.upVectorScale(E,u.center.lat,u.worldSize).metersToTile}}renderToBackBuffer(u){const E=this.painter,B=this.painter.context;u.length!==0&&(B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]),E.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_e,St,mr,qr,ss){if(_e.transform.projection.name==="globe")(function(tl,il,Qu,fh,wh){const Sh=tl.context,Th=Sh.gl;let Ch,hh;const Oh=tl.options.showTerrainWireframe?2:0,Rh=tl.transform,Nh=o.globeUseCustomAntiAliasing(tl,Sh,Rh),qh=(Lf,Cd)=>{if(hh===Lf)return;const pd=[Z_[Lf],"PROJECTION_GLOBE_VIEW"];Nh&&pd.push("CUSTOM_ANTIALIASING"),Cd&&pd.push(Z_[Oh]),Ch=tl.useProgram("globeRaster",null,pd),hh=Lf},Fh=tl.colorModeForRenderPass(),Hh=new o.DepthMode(Th.LEQUAL,o.DepthMode.ReadWrite,tl.depthRangeFor3D);Eg.update(wh);const ld=o.calculateGlobeMercatorMatrix(Rh),xd=[o.mercatorXfromLng(Rh.center.lng),o.mercatorYfromLat(Rh.center.lat)],gd=Oh?[!1,!0]:[!1],Vf=tl.globeSharedBuffers,_d=[Rh.width*o.exported.devicePixelRatio,Rh.height*o.exported.devicePixelRatio],Cf=Float32Array.from(Rh.globeMatrix),Ud={useDenormalizedUpVectorScale:!0};if(gd.forEach(Lf=>{const Cd=tl.transform,pd=f_(Cd.zoom)*il.exaggeration();hh=-1;const $d=Lf?Th.LINES:Th.TRIANGLES;for(const yf of fh){const $f=Qu.getTile(yf),Dp=o.StencilMode.disabled,nm=il.prevTerrainTileForTile[yf.key],Cp=il.terrainTileForTile[yf.key];h0(nm,Cp)&&Eg.newMorphing(yf.key,nm,Cp,wh,250),Sh.activeTexture.set(Th.TEXTURE0),$f.texture.bind(Th.LINEAR,Th.CLAMP_TO_EDGE);const xp=Eg.getMorphValuesForProxy(yf.key),Lp=xp?1:0;xp&&o.extend$1(Ud,{morphing:{srcDemTile:xp.from,dstDemTile:xp.to,phase:o.easeCubicInOut(xp.phase)}});const dm=o.tileCornersToBounds(yf.canonical),zp=o.getLatitudinalLod(dm.getCenter().lat),km=o.getGridMatrix(yf.canonical,dm,zp,Cd.worldSize/Cd._pixelsPerMercatorPixel),Am=o.globeNormalizeECEF(o.globeTileBounds(yf.canonical)),jm=Fy(Cd.projMatrix,Cf,ld,Am,o.globeToMercatorTransition(Cd.zoom),xd,Cd.frustumCorners.TL,Cd.frustumCorners.TR,Cd.frustumCorners.BR,Cd.frustumCorners.BL,Cd.globeCenterInViewSpace,Cd.globeRadius,_d,pd,km);if(qh(Lp,Lf),il.setupElevationDraw($f,Ch,Ud),tl.prepareDrawProgram(Sh,Ch,yf.toUnwrapped()),Vf){const[zm,gg,lg]=Lf?Vf.getWirefameBuffers(tl.context,zp):Vf.getGridBuffers(zp,pd!==0);Ch.draw(Sh,$d,Hh,Dp,Fh,o.CullFaceMode.backCCW,jm,"globe_raster",zm,gg,lg)}}}),Vf){const Lf=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Nh&&Lf.push("CUSTOM_ANTIALIASING"),Ch=tl.useProgram("globeRaster",null,Lf);for(const Cd of fh){const{x:pd,y:$d,z:yf}=Cd.canonical,$f=$d===0,Dp=$d===(1<<yf)-1,[nm,Cp,xp,Lp]=Vf.getPoleBuffers(yf);if(Lp&&($f||Dp)){const dm=Qu.getTile(Cd);Sh.activeTexture.set(Th.TEXTURE0),dm.texture.bind(Th.LINEAR,Th.CLAMP_TO_EDGE);let zp=o.globePoleMatrixForTile(yf,pd,Rh);const km=o.globeNormalizeECEF(o.globeTileBounds(Cd.canonical)),Am=(jm,zm)=>jm.draw(Sh,Th.TRIANGLES,Hh,o.StencilMode.disabled,Fh,o.CullFaceMode.disabled,Fy(Rh.projMatrix,zp,zp,km,0,xd,Rh.frustumCorners.TL,Rh.frustumCorners.TR,Rh.frustumCorners.BR,Rh.frustumCorners.BL,Rh.globeCenterInViewSpace,Rh.globeRadius,_d,0),"globe_pole_raster",zm,xp,Lp);il.setupElevationDraw(dm,Ch,Ud),tl.prepareDrawProgram(Sh,Ch,Cd.toUnwrapped()),$f&&Am(Ch,nm),Dp&&(zp=o.scale(o.create(),zp,[1,-1,1]),Am(Ch,Cp))}}}})(_e,St,mr,qr,ss);else{const tl=_e.context,il=tl.gl;let Qu,fh;const wh=_e.options.showTerrainWireframe?2:0,Sh=(Rh,Nh)=>{if(fh===Rh)return;const qh=[Z_[Rh]];Nh&&qh.push(Z_[wh]),Qu=_e.useProgram("terrainRaster",null,qh),fh=Rh},Th=_e.colorModeForRenderPass(),Ch=new o.DepthMode(il.LEQUAL,o.DepthMode.ReadWrite,_e.depthRangeFor3D);Eg.update(ss);const hh=_e.transform,Oh=f_(hh.zoom)*St.exaggeration();(wh?[!1,!0]:[!1]).forEach(Rh=>{fh=-1;const Nh=Rh?il.LINES:il.TRIANGLES,[qh,Fh]=Rh?St.getWirefameBuffer():[St.gridIndexBuffer,St.gridSegments];for(const Hh of qr){const ld=mr.getTile(Hh),xd=o.StencilMode.disabled,gd=St.prevTerrainTileForTile[Hh.key],Vf=St.terrainTileForTile[Hh.key];h0(gd,Vf)&&Eg.newMorphing(Hh.key,gd,Vf,ss,250),tl.activeTexture.set(il.TEXTURE0),ld.texture.bind(il.LINEAR,il.CLAMP_TO_EDGE,il.LINEAR_MIPMAP_NEAREST);const _d=Eg.getMorphValuesForProxy(Hh.key),Cf=_d?1:0;let Ud;_d&&(Ud={morphing:{srcDemTile:_d.from,dstDemTile:_d.to,phase:o.easeCubicInOut(_d.phase)}});const Lf=rv(Hh.projMatrix,p_(Hh.canonical,hh.renderWorldCopies)?Oh/10:Oh);Sh(Cf,Rh),St.setupElevationDraw(ld,Qu,Ud),_e.prepareDrawProgram(tl,Qu,Hh.toUnwrapped()),Qu.draw(tl,Nh,Ch,xd,Th,o.CullFaceMode.backCCW,Lf,"terrain_raster",St.gridBuffer,qh,Fh)}})}}(E,this,this.proxySourceCache,u,this._updateTimestamp),this.renderingToTexture=!0,E.gpuTimingDeferredRenderEnd(),u.splice(0,u.length))}renderBatch(u){if(this._drapedRenderBatches.length===0)return u+1;this.renderingToTexture=!0;const E=this.painter,B=this.painter.context,_e=this.proxySourceCache,St=this.proxiedCoords[_e.id],mr=this._drapedRenderBatches.shift(),qr=[],ss=E.style.order;let tl=0;for(const il of St){const Qu=_e.getTileByID(il.proxyTileKey),fh=_e.proxyCachedFBO[il.key]?_e.proxyCachedFBO[il.key][u]:void 0,wh=fh!==void 0?_e.renderCache[fh]:this.pool[tl++],Sh=fh!==void 0;if(Qu.texture=wh.tex,Sh&&!wh.dirty){qr.push(Qu.tileID);continue}let Th;B.bindFramebuffer.set(wh.fb.framebuffer),this.renderedToTile=!1,wh.dirty&&(B.clear({color:o.Color.transparent,stencil:0}),wh.dirty=!1);for(let Ch=mr.start;Ch<=mr.end;++Ch){const hh=E.style._layers[ss[Ch]];if(hh.isHidden(E.transform.zoom))continue;const Oh=E.style._getLayerSourceCache(hh),Rh=Oh?this.proxyToSource[il.key][Oh.id]:[il];if(!Rh)continue;const Nh=Rh;B.viewport.set([0,0,wh.fb.width,wh.fb.height]),Th!==(Oh?Oh.id:null)&&(this._setupStencil(wh,Rh,hh,Oh),Th=Oh?Oh.id:null),E.renderLayer(E,Oh,hh,Nh)}this.renderedToTile?(wh.dirty=!0,qr.push(Qu.tileID)):Sh||--tl,tl===5&&(tl=0,this.renderToBackBuffer(qr))}return this.renderToBackBuffer(qr),this.renderingToTexture=!1,B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]),mr.end+1}postRender(){}renderCacheEfficiency(u){const E=u.order.length;if(E===0)return{efficiency:100};let B,_e=0,St=0,mr=!1;for(let qr=0;qr<E;++qr){const ss=u._layers[u.order[qr]];this._style.isLayerDraped(ss)?(mr&&++_e,++St):mr||(mr=!0,B=ss.id)}return St===0?{efficiency:100}:{efficiency:100*(1-_e/St),firstUndrapedLayer:B}}getMinElevationBelowMSL(){let u=0;return this._visibleDemTiles.filter(E=>E.dem).forEach(E=>{u=Math.min(u,E.dem.tree.minimums[0])}),u===0?u:(u-30)*this._exaggeration}raycast(u,E,B){if(!this._visibleDemTiles)return null;const _e=this._visibleDemTiles.filter(St=>St.dem).map(St=>{const mr=St.tileID,qr=1<<mr.overscaledZ,{x:ss,y:tl}=mr.canonical,il=ss/qr,Qu=(ss+1)/qr,fh=tl/qr,wh=(tl+1)/qr;return{minx:il,miny:fh,maxx:Qu,maxy:wh,t:St.dem.tree.raycastRoot(il,fh,Qu,wh,u,E,B),tile:St}});_e.sort((St,mr)=>(St.t!==null?St.t:Number.MAX_VALUE)-(mr.t!==null?mr.t:Number.MAX_VALUE));for(const St of _e){if(St.t==null)return null;const mr=St.tile.dem.tree.raycast(St.minx,St.miny,St.maxx,St.maxy,u,E,B);if(mr!=null)return mr}return null}_createFBO(){const u=this.painter.context,E=u.gl,B=this.drapeBufferSize;u.activeTexture.set(E.TEXTURE0);const _e=new o.Texture(u,{width:B[0],height:B[1],data:null},E.RGBA);_e.bind(E.LINEAR,E.CLAMP_TO_EDGE);const St=u.createFramebuffer(B[0],B[1],!1);return St.colorAttachment.set(_e.texture),St.depthAttachment=new Wu(u,St.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=u.createRenderbuffer(u.gl.DEPTH_STENCIL,B[0],B[1]),this._stencilRef=0,St.depthAttachment.set(this._sharedDepthStencil),u.clear({stencil:0})):St.depthAttachment.set(this._sharedDepthStencil),u.extTextureFilterAnisotropic&&!u.extTextureFilterAnisotropicForceOff&&E.texParameterf(E.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax),{fb:St,tex:_e,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u].hasTransition())return!0;return this._style.order.some(u=>{const E=this._style._layers[u],B=E.isHidden(this.painter.transform.zoom);return E.type==="custom"?!B&&E.shouldRedrape():!B&&E.hasTransition()})}_clearLineLayersFromRenderCache(){let u=!1;for(const B of this._style._getSources())if(B instanceof _n){u=!0;break}if(!u)return;const E={};for(let B=0;B<this._style.order.length;++B){const _e=this._style._layers[this._style.order[B]],St=this._style._getLayerSourceCache(_e);if(St&&!E[St.id]&&!_e.isHidden(this.painter.transform.zoom)&&_e.type==="line"&&_e.widthExpression()instanceof o.ZoomDependentExpression){E[St.id]=!0;for(const mr of this.proxyCoords){const qr=this.proxyToSource[mr.key][St.id];if(qr)for(const ss of qr)this._clearRenderCacheForTile(St.id,ss)}}}}_clearRasterLayersFromRenderCache(){let u=!1;for(const B in this._style._sourceCaches)if(this._style._sourceCaches[B]._source instanceof cs){u=!0;break}if(!u)return;const E={};for(let B=0;B<this._style.order.length;++B){const _e=this._style._layers[this._style.order[B]],St=this._style._getLayerSourceCache(_e);if(!St||E[St.id]||_e.isHidden(this.painter.transform.zoom)||_e.type!=="raster")continue;const mr=_e.paint.get("raster-fade-duration");for(const qr of this.proxyCoords){const ss=this.proxyToSource[qr.key][St.id];if(ss)for(const tl of ss){const il=C_(St.getTile(tl),St.findLoadedParent(tl,0),St,this.painter.transform,mr);(il.opacity!==1||il.mix!==0)&&this._clearRenderCacheForTile(St.id,tl)}}}}_setupDrapedRenderBatches(){const u=this._style.order,E=u.length;if(E===0)return;const B=[];let _e,St=0,mr=this._style._layers[u[St]];for(;!this._style.isLayerDraped(mr)&&mr.isHidden(this.painter.transform.zoom)&&++St<E;)mr=this._style._layers[u[St]];for(;St<E;++St){const qr=this._style._layers[u[St]];qr.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(qr)?_e===void 0&&(_e=St):_e!==void 0&&(B.push({start:_e,end:St-1}),_e=void 0))}_e!==void 0&&B.push({start:_e,end:St-1}),this._drapedRenderBatches=B}_setupRenderCache(u){const E=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,E.renderCache.length>E.renderCachePool.length){const mr=Object.values(E.proxyCachedFBO);E.proxyCachedFBO={};for(let qr=0;qr<mr.length;++qr){const ss=Object.values(mr[qr]);E.renderCachePool.push(...ss)}}return}this._clearRasterLayersFromRenderCache();const B=this.proxyCoords,_e=this._tilesDirty;for(let mr=B.length-1;mr>=0;mr--){const qr=B[mr];if(E.getTileByID(qr.key),E.proxyCachedFBO[qr.key]!==void 0){const ss=u[qr.key],tl=this.proxyToSource[qr.key];let il=0;for(const Qu in tl){const fh=tl[Qu],wh=ss[Qu];if(!wh||wh.length!==fh.length||fh.some((Sh,Th)=>Sh!==wh[Th]||_e[Qu]&&_e[Qu].hasOwnProperty(Sh.key))){il=-1;break}++il}for(const Qu in E.proxyCachedFBO[qr.key])E.renderCache[E.proxyCachedFBO[qr.key][Qu]].dirty=il<0||il!==Object.values(ss).length}}const St=[...this._drapedRenderBatches];St.sort((mr,qr)=>qr.end-qr.start-(mr.end-mr.start));for(const mr of St)for(const qr of B){if(E.proxyCachedFBO[qr.key])continue;let ss=E.renderCachePool.pop();ss===void 0&&E.renderCache.length<50&&(ss=E.renderCache.length,E.renderCache.push(this._createFBO())),ss!==void 0&&(E.proxyCachedFBO[qr.key]={},E.proxyCachedFBO[qr.key][mr.start]=ss,E.renderCache[ss].dirty=!0)}this._tilesDirty={}}_setupStencil(u,E,B,_e){if(!_e||!this._sourceTilesOverlap[_e.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const St=this.painter.context,mr=St.gl;if(E.length<=1)return void(this._overlapStencilType=!1);let qr;if(B.isTileClipped())qr=E.length,this._overlapStencilMode.test={func:mr.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(E[0].overscaledZ>E[E.length-1].overscaledZ))return void(this._overlapStencilType=!1);qr=1,this._overlapStencilMode.test={func:mr.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+qr>255&&(St.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=qr,this._overlapStencilMode.ref=this._stencilRef,B.isTileClipped()&&this._renderTileClippingMasks(E,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(u){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[u.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(u,E){const B=this.painter,_e=this.painter.context,St=_e.gl;B._tileClippingMaskIDs={},_e.setColorMode(o.ColorMode.disabled),_e.setDepthMode(o.DepthMode.disabled);const mr=B.useProgram("clippingMask");for(const qr of u){const ss=B._tileClippingMaskIDs[qr.key]=--E;mr.draw(_e,St.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:St.ALWAYS,mask:0},ss,255,St.KEEP,St.KEEP,St.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Kp(qr.projMatrix),"$clipping",B.tileExtentBuffer,B.quadTriangleIndexBuffer,B.tileExtentSegments)}}pointCoordinate(u){const E=this.painter.transform;if(u.x<0||u.x>E.width||u.y<0||u.y>E.height)return null;const B=[u.x,u.y,1,1];o.transformMat4$1(B,B,E.pixelMatrixInverse),o.scale$1(B,B,1/B[3]),B[0]/=E.worldSize,B[1]/=E.worldSize;const _e=E._camera.position,St=o.mercatorZfromAltitude(1,E.center.lat),mr=[_e[0],_e[1],_e[2]/St,0],qr=o.subtract([],B.slice(0,3),mr);o.normalize(qr,qr);const ss=this.raycast(mr,qr,this._exaggeration);return ss!==null&&ss?(o.scaleAndAdd(mr,mr,qr,ss),mr[3]=mr[2],mr[2]*=St,mr):null}drawDepth(){const u=this.painter,E=u.context,B=this.proxySourceCache,_e=Math.ceil(u.width),St=Math.ceil(u.height);if(!this._depthFBO||this._depthFBO.width===_e&&this._depthFBO.height===St||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const mr=E.gl,qr=E.createFramebuffer(_e,St,!0);E.activeTexture.set(mr.TEXTURE0);const ss=new o.Texture(E,{width:_e,height:St,data:null},mr.RGBA);ss.bind(mr.NEAREST,mr.CLAMP_TO_EDGE),qr.colorAttachment.set(ss.texture);const tl=E.createRenderbuffer(E.gl.DEPTH_COMPONENT16,_e,St);qr.depthAttachment.set(tl),this._depthFBO=qr,this._depthTexture=ss}E.bindFramebuffer.set(this._depthFBO.framebuffer),E.viewport.set([0,0,_e,St]),function(mr,qr,ss,tl){if(mr.transform.projection.name==="globe")return;const il=mr.context,Qu=il.gl;il.clear({depth:1});const fh=mr.useProgram("terrainDepth"),wh=new o.DepthMode(Qu.LESS,o.DepthMode.ReadWrite,mr.depthRangeFor3D);for(const Sh of tl){const Th=ss.getTile(Sh),Ch=rv(Sh.projMatrix,0);qr.setupElevationDraw(Th,fh),fh.draw(il,Qu.TRIANGLES,wh,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Ch,"terrain_depth",qr.gridBuffer,qr.gridIndexBuffer,qr.gridNoSkirtSegments)}}(u,this,B,this.proxyCoords)}_setupProxiedCoordsForOrtho(u,E,B){if(u.getSource()instanceof nh)return this._setupProxiedCoordsForImageSource(u,E,B);this._findCoveringTileCache[u.id]=this._findCoveringTileCache[u.id]||{};const _e=this.proxiedCoords[u.id]=[],St=this.proxyCoords;for(let qr=0;qr<St.length;qr++){const ss=St[qr],tl=this._findTileCoveringTileID(ss,u);if(tl){const il=this._createProxiedId(ss,tl,B[ss.key]&&B[ss.key][u.id]);_e.push(il),this.proxyToSource[ss.key][u.id]=[il]}}let mr=!1;for(let qr=0;qr<E.length;qr++){const ss=u.getTile(E[qr]);if(!ss||!ss.hasData())continue;const tl=this._findTileCoveringTileID(ss.tileID,this.proxySourceCache);if(tl&&tl.tileID.canonical.z!==ss.tileID.canonical.z){const il=this.proxyToSource[tl.tileID.key][u.id],Qu=this._createProxiedId(tl.tileID,ss,B[tl.tileID.key]&&B[tl.tileID.key][u.id]);il?il.splice(il.length-1,0,Qu):this.proxyToSource[tl.tileID.key][u.id]=[Qu],_e.push(Qu),mr=!0}}this._sourceTilesOverlap[u.id]=mr}_setupProxiedCoordsForImageSource(u,E,B){if(!u.getSource().loaded())return;const _e=this.proxiedCoords[u.id]=[],St=this.proxyCoords,mr=u.getSource(),qr=new o.pointGeometry(mr.tileID.x,mr.tileID.y)._div(1<<mr.tileID.z),ss=mr.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((il,Qu)=>(il.min.x=Math.min(il.min.x,Qu.x-qr.x),il.min.y=Math.min(il.min.y,Qu.y-qr.y),il.max.x=Math.max(il.max.x,Qu.x-qr.x),il.max.y=Math.max(il.max.y,Qu.y-qr.y),il),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),tl=(il,Qu)=>{const fh=il.wrap+il.canonical.x/(1<<il.canonical.z),wh=il.canonical.y/(1<<il.canonical.z),Sh=o.EXTENT/(1<<il.canonical.z),Th=Qu.wrap+Qu.canonical.x/(1<<Qu.canonical.z),Ch=Qu.canonical.y/(1<<Qu.canonical.z);return fh+Sh<Th+ss.min.x||fh>Th+ss.max.x||wh+Sh<Ch+ss.min.y||wh>Ch+ss.max.y};for(let il=0;il<St.length;il++){const Qu=St[il];for(let fh=0;fh<E.length;fh++){const wh=u.getTile(E[fh]);if(!wh||!wh.hasData()||tl(Qu,wh.tileID))continue;const Sh=this._createProxiedId(Qu,wh,B[Qu.key]&&B[Qu.key][u.id]),Th=this.proxyToSource[Qu.key][u.id];Th?Th.push(Sh):this.proxyToSource[Qu.key][u.id]=[Sh],_e.push(Sh)}}}_createProxiedId(u,E,B){let _e=this.orthoMatrix;if(B){const St=B.find(mr=>mr.key===E.tileID.key);if(St)return St}if(E.tileID.key!==u.key){const St=u.canonical.z-E.tileID.canonical.z;let mr,qr,ss;_e=o.create();const tl=E.tileID.wrap-u.wrap<<u.overscaledZ;St>0?(mr=o.EXTENT>>St,qr=mr*((E.tileID.canonical.x<<St)-u.canonical.x+tl),ss=mr*((E.tileID.canonical.y<<St)-u.canonical.y)):(mr=o.EXTENT<<-St,qr=o.EXTENT*(E.tileID.canonical.x-(u.canonical.x+tl<<-St)),ss=o.EXTENT*(E.tileID.canonical.y-(u.canonical.y<<-St))),o.ortho(_e,0,mr,0,mr,0,1),o.translate(_e,_e,[qr,ss,0])}return new _y(E.tileID,u.key,_e)}_findTileCoveringTileID(u,E){let B=E.getTile(u);if(B&&B.hasData())return B;const _e=this._findCoveringTileCache[E.id],St=_e[u.key];if(B=St?E.getTileByID(St):null,B&&B.hasData()||St===null)return B;let mr=B?B.tileID:u,qr=mr.overscaledZ;const ss=E.getSource().minzoom,tl=[];if(!St){const Qu=E.getSource().maxzoom;if(u.canonical.z>=Qu){const fh=u.canonical.z-Qu;E.getSource().reparseOverscaled?(qr=Math.max(u.canonical.z+2,E.transform.tileZoom),mr=new o.OverscaledTileID(qr,u.wrap,Qu,u.canonical.x>>fh,u.canonical.y>>fh)):fh!==0&&(qr=Qu,mr=new o.OverscaledTileID(qr,u.wrap,Qu,u.canonical.x>>fh,u.canonical.y>>fh))}mr.key!==u.key&&(tl.push(mr.key),B=E.getTile(mr))}const il=Qu=>{tl.forEach(fh=>{_e[fh]=Qu}),tl.length=0};for(qr-=1;qr>=ss&&(!B||!B.hasData());qr--){B&&il(B.tileID.key);const Qu=mr.calculateScaledKey(qr);if(B=E.getTileByID(Qu),B&&B.hasData())break;const fh=_e[Qu];if(fh===null)break;fh===void 0?tl.push(Qu):B=E.getTileByID(fh)}return il(B?B.tileID.key:null),B&&B.hasData()?B:null}findDEMTileFor(u){return this.enabled?this._findTileCoveringTileID(u,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(u,E){let B=this._tilesDirty[u];B||(B=this._tilesDirty[u]={}),B[E.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const u=function(E){let B=0;const _e=new o.StructArrayLayout2ui4,St=131;for(let mr=1;mr<129;mr++){for(let qr=1;qr<129;qr++)B=mr*St+qr,_e.emplaceBack(B,B+1),_e.emplaceBack(B,B+St),_e.emplaceBack(B+1,B+St),mr===128&&_e.emplaceBack(B+St,B+St+1);_e.emplaceBack(B+1,B+1+St)}return _e}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(u),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,u.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Xm{static cacheKey(u,E,B,_e){let St=`${E}${_e?_e.cacheKey:""}`;for(const mr of B)u.usedDefines.includes(mr)&&(St+=`/${mr}`);return St}constructor(u,E,B,_e,St,mr){const qr=u.gl;this.program=qr.createProgram();const ss=function(hh){const Oh=[];for(let Rh=0;Rh<hh.length;Rh++){if(hh[Rh]===null)continue;const Nh=hh[Rh].split(" ");Oh.push(Nh.pop())}return Oh}(B.staticAttributes),tl=_e?_e.getBinderAttributes():[],il=ss.concat(tl);let Qu=_e?_e.defines():[];Qu=Qu.concat(mr.map(hh=>`#define ${hh}`));const fh=u.isWebGL2?`#version 300 es
`:"",wh=fh+Qu.concat(u.extStandardDerivatives&&fh.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(gy):gy,gy,l0,my.fragmentSource,wm.fragmentSource,B.fragmentSource).join(`
`),Sh=fh+Qu.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,l0,my.vertexSource,wm.vertexSource,s0.vertexSource,B.vertexSource).join(`
`),Th=qr.createShader(qr.FRAGMENT_SHADER);if(qr.isContextLost())return void(this.failedToCreate=!0);qr.shaderSource(Th,wh),qr.compileShader(Th),qr.attachShader(this.program,Th);const Ch=qr.createShader(qr.VERTEX_SHADER);if(qr.isContextLost())this.failedToCreate=!0;else{qr.shaderSource(Ch,Sh),qr.compileShader(Ch),qr.attachShader(this.program,Ch),this.attributes={},this.numAttributes=il.length;for(let hh=0;hh<this.numAttributes;hh++)il[hh]&&(qr.bindAttribLocation(this.program,hh,il[hh]),this.attributes[il[hh]]=hh);qr.linkProgram(this.program),qr.deleteShader(Ch),qr.deleteShader(Th),this.fixedUniforms=St(u),this.binderUniforms=_e?_e.getUniforms(u):[],mr.includes("TERRAIN")&&(this.terrainUniforms=(hh=>({u_dem:new o.Uniform1i(hh),u_dem_prev:new o.Uniform1i(hh),u_dem_unpack:new o.Uniform4f(hh),u_dem_tl:new o.Uniform2f(hh),u_dem_scale:new o.Uniform1f(hh),u_dem_tl_prev:new o.Uniform2f(hh),u_dem_scale_prev:new o.Uniform1f(hh),u_dem_size:new o.Uniform1f(hh),u_dem_lerp:new o.Uniform1f(hh),u_exaggeration:new o.Uniform1f(hh),u_depth:new o.Uniform1i(hh),u_depth_size_inv:new o.Uniform2f(hh),u_meter_to_dem:new o.Uniform1f(hh),u_label_plane_matrix_inv:new o.UniformMatrix4f(hh)}))(u)),mr.includes("GLOBE")&&(this.globeUniforms=(hh=>({u_tile_tl_up:new o.Uniform3f(hh),u_tile_tr_up:new o.Uniform3f(hh),u_tile_br_up:new o.Uniform3f(hh),u_tile_bl_up:new o.Uniform3f(hh),u_tile_up_scale:new o.Uniform1f(hh)}))(u)),mr.includes("FOG")&&(this.fogUniforms=(hh=>({u_fog_matrix:new o.UniformMatrix4f(hh),u_fog_range:new o.Uniform2f(hh),u_fog_color:new o.Uniform4f(hh),u_fog_horizon_blend:new o.Uniform1f(hh),u_fog_temporal_offset:new o.Uniform1f(hh),u_frustum_tl:new o.Uniform3f(hh),u_frustum_tr:new o.Uniform3f(hh),u_frustum_br:new o.Uniform3f(hh),u_frustum_bl:new o.Uniform3f(hh),u_globe_pos:new o.Uniform3f(hh),u_globe_radius:new o.Uniform1f(hh),u_globe_transition:new o.Uniform1f(hh),u_is_globe:new o.Uniform1i(hh),u_viewport:new o.Uniform2f(hh)}))(u))}}setTerrainUniformValues(u,E){if(!this.terrainUniforms)return;const B=this.terrainUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const _e in E)B[_e]&&B[_e].set(this.program,_e,E[_e])}}setGlobeUniformValues(u,E){if(!this.globeUniforms)return;const B=this.globeUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const _e in E)B[_e]&&B[_e].set(this.program,_e,E[_e])}}setFogUniformValues(u,E){if(!this.fogUniforms)return;const B=this.fogUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const _e in E)B[_e].set(this.program,_e,E[_e])}}draw(u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th){const Ch=u.gl;if(this.failedToCreate)return;u.program.set(this.program),u.setDepthMode(B),u.setStencilMode(_e),u.setColorMode(St),u.setCullFace(mr);for(const Oh of Object.keys(this.fixedUniforms))this.fixedUniforms[Oh].set(this.program,Oh,qr[Oh]);Sh&&Sh.setUniforms(this.program,u,this.binderUniforms,fh,{zoom:wh});const hh={[Ch.LINES]:2,[Ch.TRIANGLES]:3,[Ch.LINE_STRIP]:1}[E];for(const Oh of Qu.get()){const Rh=Oh.vaos||(Oh.vaos={});(Rh[ss]||(Rh[ss]=new Ny)).bind(u,this,tl,Sh?Sh.getPaintVertexBuffers():[],il,Oh.vertexOffset,Th||[]),Ch.drawElements(E,Oh.primitiveLength*hh,Ch.UNSIGNED_SHORT,Oh.primitiveOffset*hh*2)}}}function d0(L,u){const E=Math.pow(2,u.tileID.overscaledZ),B=u.tileSize*Math.pow(2,L.transform.tileZoom)/E,_e=B*(u.tileID.canonical.x+u.tileID.wrap*E),St=B*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_tile_units_to_pixels:1/Sd(u,1,L.transform.tileZoom),u_pixel_coord_upper:[_e>>16,St>>16],u_pixel_coord_lower:[65535&_e,65535&St]}}const um=o.create(),Vy=(L,u,E,B,_e,St,mr,qr,ss,tl,il)=>{const Qu=u.style.light,fh=Qu.properties.get("position"),wh=[fh.x,fh.y,fh.z],Sh=o.create$1();Qu.properties.get("anchor")==="viewport"&&(o.fromRotation(Sh,-u.transform.angle),o.transformMat3(wh,wh,Sh));const Th=Qu.properties.get("color"),Ch=u.transform,hh={u_matrix:L,u_lightpos:wh,u_lightintensity:Qu.properties.get("intensity"),u_lightcolor:[Th.r,Th.g,Th.b],u_vertical_gradient:+E,u_opacity:B,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:um,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_e,u_edge_radius:St};return Ch.projection.name==="globe"&&(hh.u_tile_id=[mr.canonical.x,mr.canonical.y,1<<mr.canonical.z],hh.u_zoom_transition=ss,hh.u_inv_rot_matrix=il,hh.u_merc_center=tl,hh.u_up_dir=Ch.projection.upVector(new o.CanonicalTileID(0,0,0),tl[0]*o.EXTENT,tl[1]*o.EXTENT),hh.u_height_lift=qr),hh},Bm=(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu)=>{const fh=Vy(L,u,E,B,_e,St,mr,ss,tl,il,Qu),wh={u_height_factor:-Math.pow(2,mr.overscaledZ)/qr.tileSize/8};return o.extend(fh,d0(u,qr),wh)},Im=L=>({u_matrix:L}),g_=(L,u,E)=>o.extend(Im(L),d0(u,E)),ly=(L,u)=>({u_matrix:L,u_world:u}),xv=(L,u,E,B)=>o.extend(g_(L,u,E),{u_world:B}),cy=o.create(),f0=(L,u,E,B,_e,St)=>{const mr=L.transform,qr=mr.projection.name==="globe";let ss;if(St.paint.get("circle-pitch-alignment")==="map")if(qr){const il=o.globePixelsToTileUnits(mr.zoom,u.canonical)*mr._pixelsPerMercatorPixel;ss=Float32Array.from([il,0,0,il])}else ss=mr.calculatePixelsToTileUnitsMatrix(E);else ss=new Float32Array([mr.pixelsToGLUnits[0],0,0,mr.pixelsToGLUnits[1]]);const tl={u_camera_to_center_distance:mr.cameraToCenterDistance,u_matrix:L.translatePosMatrix(u.projMatrix,E,St.paint.get("circle-translate"),St.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:ss,u_inv_rot_matrix:cy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(qr){tl.u_inv_rot_matrix=B,tl.u_merc_center=_e,tl.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],tl.u_zoom_transition=o.globeToMercatorTransition(mr.zoom);const il=_e[0]*o.EXTENT,Qu=_e[1]*o.EXTENT;tl.u_up_dir=mr.projection.upVector(new o.CanonicalTileID(0,0,0),il,Qu)}return tl},__=L=>{const u=[];return L.paint.get("circle-pitch-alignment")==="map"&&u.push("PITCH_WITH_MAP"),L.paint.get("circle-pitch-scale")==="map"&&u.push("SCALE_WITH_MAP"),u},H_=(L,u,E,B)=>{const _e=o.EXTENT/E.tileSize;return{u_matrix:L,u_camera_to_center_distance:u.getCameraToCenterDistance(B),u_extrude_scale:[u.pixelsToGLUnits[0]/_e,u.pixelsToGLUnits[1]/_e]}},jy=(L,u,E=1)=>({u_matrix:L,u_color:u,u_overlay:0,u_overlay_scale:E}),yy=o.create(),Qg=(L,u,E,B,_e,St,mr)=>{const qr=L.transform,ss=qr.projection.name==="globe",tl=ss?o.globePixelsToTileUnits(qr.zoom,u.canonical)*qr._pixelsPerMercatorPixel:Sd(E,1,St),il={u_matrix:u.projMatrix,u_extrude_scale:tl,u_intensity:mr,u_inv_rot_matrix:yy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(ss){il.u_inv_rot_matrix=B,il.u_merc_center=_e,il.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],il.u_zoom_transition=o.globeToMercatorTransition(qr.zoom);const Qu=_e[0]*o.EXTENT,fh=_e[1]*o.EXTENT;il.u_up_dir=qr.projection.upVector(new o.CanonicalTileID(0,0,0),Qu,fh)}return il},qy=(L,u,E,B,_e,St,mr)=>{const qr=L.transform,ss=qr.calculatePixelsToTileUnitsMatrix(u);return{u_matrix:M_(L,u,E,B),u_pixels_to_tile_units:ss,u_device_pixel_ratio:St,u_units_to_pixels:[1/qr.pixelsToGLUnits[0],1/qr.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_e,u_texsize:m0(E)?u.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:p0(u,L.transform),u_alpha_discard_threshold:0,u_trim_offset:mr}},nv=(L,u,E,B,_e)=>{const St=L.transform;return{u_matrix:M_(L,u,E,B),u_texsize:u.imageAtlasTexture.size,u_pixels_to_tile_units:St.calculatePixelsToTileUnitsMatrix(u),u_device_pixel_ratio:_e,u_image:0,u_tile_units_to_pixels:p0(u,St),u_units_to_pixels:[1/St.pixelsToGLUnits[0],1/St.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function p0(L,u){return 1/Sd(L,1,u.tileZoom)}function M_(L,u,E,B){return L.translatePosMatrix(B||u.tileID.projMatrix,u,E.paint.get("line-translate"),E.paint.get("line-translate-anchor"))}function m0(L){const u=L.paint.get("line-dasharray").value;return u.value||u.kind!=="constant"}const X_=(L,u,E,B,_e,St)=>{return{u_matrix:L,u_tl_parent:u,u_scale_parent:E,u_fade_t:B.mix,u_opacity:B.opacity*_e.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_e.paint.get("raster-brightness-min"),u_brightness_high:_e.paint.get("raster-brightness-max"),u_saturation_factor:(qr=_e.paint.get("raster-saturation"),qr>0?1-1/(1.001-qr):-qr),u_contrast_factor:(mr=_e.paint.get("raster-contrast"),mr>0?1/(1-mr):1+mr),u_spin_weights:hd(_e.paint.get("raster-hue-rotate")),u_perspective_transform:St};var mr,qr};function hd(L){L*=Math.PI/180;const u=Math.sin(L),E=Math.cos(L);return[(2*E+1)/3,(-Math.sqrt(3)*u-E+1)/3,(Math.sqrt(3)*u-E+1)/3]}const wf=o.create(),ip=(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th)=>{const Ch=_e.transform,hh={u_is_size_zoom_constant:+(L==="constant"||L==="source"),u_is_size_feature_constant:+(L==="constant"||L==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ch.cameraToCenterDistance,u_rotate_symbol:+E,u_aspect_ratio:Ch.width/Ch.height,u_fade_change:_e.options.fadeDuration?_e.symbolFadeChange:1,u_matrix:St,u_label_plane_matrix:mr,u_coord_matrix:qr,u_is_text:+ss,u_pitch_with_map:+B,u_texsize:tl,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wf,u_up_vector:[0,-1,0]};return Th.name==="globe"&&(hh.u_tile_id=[il.canonical.x,il.canonical.y,1<<il.canonical.z],hh.u_zoom_transition=Qu,hh.u_inv_rot_matrix=wh,hh.u_merc_center=fh,hh.u_camera_forward=Ch._camera.forward(),hh.u_ecef_origin=o.globeECEFOrigin(Ch.globeMatrix,il.toUnwrapped()),hh.u_tile_matrix=Float32Array.from(Ch.globeMatrix),hh.u_up_vector=Sh),hh},$p=(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th,Ch)=>o.extend(ip(L,u,E,B,_e,St,mr,qr,ss,tl,Qu,fh,wh,Sh,Th,Ch),{u_gamma_scale:B?_e.transform.cameraToCenterDistance*Math.cos(_e.terrain?0:_e.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+il}),Nm=(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu,fh,wh,Sh,Th)=>o.extend($p(L,u,E,B,_e,St,mr,qr,!0,ss,!0,il,Qu,fh,wh,Sh,Th),{u_texsize_icon:tl,u_texture_icon:1}),hm=(L,u,E)=>({u_matrix:L,u_opacity:u,u_color:E}),Qm=(L,u,E,B,_e)=>o.extend(function(St,mr,qr){const ss=mr.imageManager.getPattern(St.toString()),{width:tl,height:il}=mr.imageManager.getPixelSize(),Qu=Math.pow(2,qr.tileID.overscaledZ),fh=qr.tileSize*Math.pow(2,mr.transform.tileZoom)/Qu,wh=fh*(qr.tileID.canonical.x+qr.tileID.wrap*Qu),Sh=fh*qr.tileID.canonical.y;return{u_image:0,u_pattern_tl:ss.tl,u_pattern_br:ss.br,u_texsize:[tl,il],u_pattern_size:ss.displaySize,u_tile_units_to_pixels:1/Sd(qr,1,mr.transform.tileZoom),u_pixel_coord_upper:[wh>>16,Sh>>16],u_pixel_coord_lower:[65535&wh,65535&Sh]}}(B,E,_e),{u_matrix:L,u_opacity:u}),og={fillExtrusion:L=>({u_matrix:new o.UniformMatrix4f(L),u_lightpos:new o.Uniform3f(L),u_lightintensity:new o.Uniform1f(L),u_lightcolor:new o.Uniform3f(L),u_vertical_gradient:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_edge_radius:new o.Uniform1f(L),u_ao:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_up_dir:new o.Uniform3f(L),u_height_lift:new o.Uniform1f(L)}),fillExtrusionPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_lightpos:new o.Uniform3f(L),u_lightintensity:new o.Uniform1f(L),u_lightcolor:new o.Uniform3f(L),u_vertical_gradient:new o.Uniform1f(L),u_height_factor:new o.Uniform1f(L),u_edge_radius:new o.Uniform1f(L),u_ao:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_up_dir:new o.Uniform3f(L),u_height_lift:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L)}),fill:L=>({u_matrix:new o.UniformMatrix4f(L)}),fillPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),fillOutline:L=>({u_matrix:new o.UniformMatrix4f(L),u_world:new o.Uniform2f(L)}),fillOutlinePattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_world:new o.Uniform2f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),circle:L=>({u_camera_to_center_distance:new o.Uniform1f(L),u_extrude_scale:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_up_dir:new o.Uniform3f(L)}),collisionBox:L=>({u_matrix:new o.UniformMatrix4f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_extrude_scale:new o.Uniform2f(L)}),collisionCircle:L=>({u_matrix:new o.UniformMatrix4f(L),u_inv_matrix:new o.UniformMatrix4f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_viewport_size:new o.Uniform2f(L)}),debug:L=>({u_color:new o.UniformColor(L),u_matrix:new o.UniformMatrix4f(L),u_overlay:new o.Uniform1i(L),u_overlay_scale:new o.Uniform1f(L)}),clippingMask:L=>({u_matrix:new o.UniformMatrix4f(L)}),heatmap:L=>({u_extrude_scale:new o.Uniform1f(L),u_intensity:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_up_dir:new o.Uniform3f(L)}),heatmapTexture:L=>({u_image:new o.Uniform1i(L),u_color_ramp:new o.Uniform1i(L),u_opacity:new o.Uniform1f(L)}),hillshade:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_latrange:new o.Uniform2f(L),u_light:new o.Uniform2f(L),u_shadow:new o.UniformColor(L),u_highlight:new o.UniformColor(L),u_accent:new o.UniformColor(L)}),hillshadePrepare:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_dimension:new o.Uniform2f(L),u_zoom:new o.Uniform1f(L),u_unpack:new o.Uniform4f(L)}),line:L=>({u_matrix:new o.UniformMatrix4f(L),u_pixels_to_tile_units:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_units_to_pixels:new o.Uniform2f(L),u_dash_image:new o.Uniform1i(L),u_gradient_image:new o.Uniform1i(L),u_image_height:new o.Uniform1f(L),u_texsize:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_alpha_discard_threshold:new o.Uniform1f(L),u_trim_offset:new o.Uniform2f(L)}),linePattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_texsize:new o.Uniform2f(L),u_pixels_to_tile_units:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_units_to_pixels:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_alpha_discard_threshold:new o.Uniform1f(L)}),raster:L=>({u_matrix:new o.UniformMatrix4f(L),u_tl_parent:new o.Uniform2f(L),u_scale_parent:new o.Uniform1f(L),u_fade_t:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_image0:new o.Uniform1i(L),u_image1:new o.Uniform1i(L),u_brightness_low:new o.Uniform1f(L),u_brightness_high:new o.Uniform1f(L),u_saturation_factor:new o.Uniform1f(L),u_contrast_factor:new o.Uniform1f(L),u_spin_weights:new o.Uniform3f(L),u_perspective_transform:new o.Uniform2f(L)}),symbolIcon:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_camera_forward:new o.Uniform3f(L),u_tile_matrix:new o.UniformMatrix4f(L),u_up_vector:new o.Uniform3f(L),u_ecef_origin:new o.Uniform3f(L),u_texture:new o.Uniform1i(L)}),symbolSDF:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_texture:new o.Uniform1i(L),u_gamma_scale:new o.Uniform1f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_camera_forward:new o.Uniform3f(L),u_tile_matrix:new o.UniformMatrix4f(L),u_up_vector:new o.Uniform3f(L),u_ecef_origin:new o.Uniform3f(L),u_is_halo:new o.Uniform1i(L)}),symbolTextAndIcon:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_texsize_icon:new o.Uniform2f(L),u_texture:new o.Uniform1i(L),u_texture_icon:new o.Uniform1i(L),u_gamma_scale:new o.Uniform1f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_is_halo:new o.Uniform1i(L)}),background:L=>({u_matrix:new o.UniformMatrix4f(L),u_opacity:new o.Uniform1f(L),u_color:new o.UniformColor(L)}),backgroundPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_opacity:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_pattern_tl:new o.Uniform2f(L),u_pattern_br:new o.Uniform2f(L),u_texsize:new o.Uniform2f(L),u_pattern_size:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),terrainRaster:u0,terrainDepth:u0,skybox:L=>({u_matrix:new o.UniformMatrix4f(L),u_sun_direction:new o.Uniform3f(L),u_cubemap:new o.Uniform1i(L),u_opacity:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L)}),skyboxGradient:L=>({u_matrix:new o.UniformMatrix4f(L),u_color_ramp:new o.Uniform1i(L),u_center_direction:new o.Uniform3f(L),u_radius:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L)}),skyboxCapture:L=>({u_matrix_3f:new o.UniformMatrix3f(L),u_sun_direction:new o.Uniform3f(L),u_sun_intensity:new o.Uniform1f(L),u_color_tint_r:new o.Uniform4f(L),u_color_tint_m:new o.Uniform4f(L),u_luminance:new o.Uniform1f(L)}),globeRaster:L=>({u_proj_matrix:new o.UniformMatrix4f(L),u_globe_matrix:new o.UniformMatrix4f(L),u_normalize_matrix:new o.UniformMatrix4f(L),u_merc_matrix:new o.UniformMatrix4f(L),u_zoom_transition:new o.Uniform1f(L),u_merc_center:new o.Uniform2f(L),u_image0:new o.Uniform1i(L),u_grid_matrix:new o.UniformMatrix3f(L),u_skirt_height:new o.Uniform1f(L),u_frustum_tl:new o.Uniform3f(L),u_frustum_tr:new o.Uniform3f(L),u_frustum_br:new o.Uniform3f(L),u_frustum_bl:new o.Uniform3f(L),u_globe_pos:new o.Uniform3f(L),u_globe_radius:new o.Uniform1f(L),u_viewport:new o.Uniform2f(L)}),globeAtmosphere:L=>({u_frustum_tl:new o.Uniform3f(L),u_frustum_tr:new o.Uniform3f(L),u_frustum_br:new o.Uniform3f(L),u_frustum_bl:new o.Uniform3f(L),u_horizon:new o.Uniform1f(L),u_transition:new o.Uniform1f(L),u_fadeout_range:new o.Uniform1f(L),u_color:new o.Uniform4f(L),u_high_color:new o.Uniform4f(L),u_space_color:new o.Uniform4f(L),u_star_intensity:new o.Uniform1f(L),u_star_density:new o.Uniform1f(L),u_star_size:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L),u_horizon_angle:new o.Uniform1f(L),u_rotation_matrix:new o.UniformMatrix4f(L)})};let ag;function Vm(L,u,E,B,_e,St,mr){const qr=L.context,ss=qr.gl,tl=L.transform,il=L.useProgram("collisionBox"),Qu=[];let fh=0,wh=0;for(let Nh=0;Nh<B.length;Nh++){const qh=B[Nh],Fh=u.getTile(qh),Hh=Fh.getBucket(E);if(!Hh)continue;const ld=lp(qh,Hh,tl);let xd=ld;_e[0]===0&&_e[1]===0||(xd=L.translatePosMatrix(ld,Fh,_e,St));const gd=mr?Hh.textCollisionBox:Hh.iconCollisionBox,Vf=Hh.collisionCircleArray;if(Vf.length>0){const _d=o.create(),Cf=xd;o.mul(_d,Hh.placementInvProjMatrix,tl.glCoordMatrix),o.mul(_d,_d,Hh.placementViewportMatrix),Qu.push({circleArray:Vf,circleOffset:wh,transform:Cf,invTransform:_d,projection:Hh.getProjection()}),fh+=Vf.length/4,wh=fh}gd&&(L.terrain&&L.terrain.setupElevationDraw(Fh,il),il.draw(qr,ss.LINES,o.DepthMode.disabled,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.disabled,H_(xd,tl,Fh,Hh.getProjection()),E.id,gd.layoutVertexBuffer,gd.indexBuffer,gd.segments,null,tl.zoom,null,[gd.collisionVertexBuffer,gd.collisionVertexBufferExt]))}if(!mr||!Qu.length)return;const Sh=L.useProgram("collisionCircle"),Th=new o.StructArrayLayout2f1f2i16;Th.resize(4*fh),Th._trim();let Ch=0;for(const Nh of Qu)for(let qh=0;qh<Nh.circleArray.length/4;qh++){const Fh=4*qh,Hh=Nh.circleArray[Fh+0],ld=Nh.circleArray[Fh+1],xd=Nh.circleArray[Fh+2],gd=Nh.circleArray[Fh+3];Th.emplace(Ch++,Hh,ld,xd,gd,0),Th.emplace(Ch++,Hh,ld,xd,gd,1),Th.emplace(Ch++,Hh,ld,xd,gd,2),Th.emplace(Ch++,Hh,ld,xd,gd,3)}(!ag||ag.length<2*fh)&&(ag=function(Nh){const qh=2*Nh,Fh=new o.StructArrayLayout3ui6;Fh.resize(qh),Fh._trim();for(let Hh=0;Hh<qh;Hh++){const ld=6*Hh;Fh.uint16[ld+0]=4*Hh+0,Fh.uint16[ld+1]=4*Hh+1,Fh.uint16[ld+2]=4*Hh+2,Fh.uint16[ld+3]=4*Hh+2,Fh.uint16[ld+4]=4*Hh+3,Fh.uint16[ld+5]=4*Hh+0}return Fh}(fh));const hh=qr.createIndexBuffer(ag,!0),Oh=qr.createVertexBuffer(Th,o.collisionCircleLayout.members,!0);for(const Nh of Qu){const qh={u_matrix:Nh.transform,u_inv_matrix:Nh.invTransform,u_camera_to_center_distance:(Rh=tl).getCameraToCenterDistance(Nh.projection),u_viewport_size:[Rh.width,Rh.height]};Sh.draw(qr,ss.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.disabled,qh,E.id,Oh,hh,o.SegmentVector.simpleSegment(0,2*Nh.circleOffset,Nh.circleArray.length,Nh.circleArray.length/2),null,tl.zoom)}var Rh;Oh.destroy(),hh.destroy()}const tp=o.create();function Wg({width:L,height:u,anchor:E,textOffset:B,textScale:_e},St){const{horizontalAlign:mr,verticalAlign:qr}=o.getAnchorAlignment(E),ss=-(mr-.5)*L,tl=-(qr-.5)*u,il=o.evaluateVariableOffset(E,B);return new o.pointGeometry((ss/_e+il[0])*St,(tl/_e+il[1])*St)}function Tg(L,u,E,B,_e,St,mr,qr,ss,tl,il){const Qu=L.text.placedSymbolArray,fh=L.text.dynamicLayoutVertexArray,wh=L.icon.dynamicLayoutVertexArray,Sh={},Th=L.getProjection(),Ch=Zp(qr,Th,St),hh=St.elevation,Oh=Th.upVectorScale(qr.canonical,St.center.lat,St.worldSize).metersToTile;fh.clear();for(let Rh=0;Rh<Qu.length;Rh++){const Nh=Qu.get(Rh),{tileAnchorX:qh,tileAnchorY:Fh,numGlyphs:Hh}=Nh,ld=L.allowVerticalPlacement&&!Nh.placedOrientation,xd=Nh.hidden||!Nh.crossTileID||ld?null:B[Nh.crossTileID];if(xd){let gd=0,Vf=0,_d=0;if(hh){const Dp=hh?hh.getAtTileOffset(qr,qh,Fh):0,[nm,Cp,xp]=Th.upVector(qr.canonical,qh,Fh);gd=Dp*nm*Oh,Vf=Dp*Cp*Oh,_d=Dp*xp*Oh}let[Cf,Ud,Lf,Cd]=ep(Nh.projectedAnchorX+gd,Nh.projectedAnchorY+Vf,Nh.projectedAnchorZ+_d,E?Ch:mr);const pd=im(St.getCameraToCenterDistance(Th),Cd);let $d=_e.evaluateSizeForFeature(L.textSizeData,tl,Nh)*pd/o.ONE_EM;E&&($d*=L.tilePixelRatio/ss);const yf=Wg(xd,$d);E?({x:Cf,y:Ud,z:Lf}=Th.projectTilePoint(qh+yf.x,Fh+yf.y,qr.canonical),[Cf,Ud,Lf]=ep(Cf+gd,Ud+Vf,Lf+_d,mr)):(u&&yf._rotate(-St.angle),Cf+=yf.x,Ud+=yf.y,Lf=0);const $f=L.allowVerticalPlacement&&Nh.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Dp=0;Dp<Hh;Dp++)o.addDynamicAttributes(fh,Cf,Ud,Lf,$f);il&&Nh.associatedIconIndex>=0&&(Sh[Nh.associatedIconIndex]={x:Cf,y:Ud,z:Lf,angle:$f})}else ad(Hh,fh)}if(il){wh.clear();const Rh=L.icon.placedSymbolArray;for(let Nh=0;Nh<Rh.length;Nh++){const qh=Rh.get(Nh),{numGlyphs:Fh}=qh,Hh=Sh[Nh];if(qh.hidden||!Hh)ad(Fh,wh);else{const{x:ld,y:xd,z:gd,angle:Vf}=Hh;for(let _d=0;_d<Fh;_d++)o.addDynamicAttributes(wh,ld,xd,gd,Vf)}}L.icon.dynamicLayoutVertexBuffer.updateData(wh)}L.text.dynamicLayoutVertexBuffer.updateData(fh)}function fg(L,u,E){return E.iconsInText&&u?"symbolTextAndIcon":L?"symbolSDF":"symbolIcon"}function A_(L,u,E,B,_e,St,mr,qr,ss,tl,il,Qu){const fh=L.context,wh=fh.gl,Sh=L.transform,Th=qr==="map",Ch=ss==="map",hh=Th&&E.layout.get("symbol-placement")!=="point",Oh=Th&&!Ch&&!hh,Rh=E.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Nh=!1;const qh=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),Fh=[o.mercatorXfromLng(Sh.center.lng),o.mercatorYfromLat(Sh.center.lat)],Hh=E.layout.get("text-variable-anchor"),ld=Sh.projection.name==="globe",xd=[],gd=[0,-1,0];let Vf=gd;!ld&&!Sh.mercatorFromTransition||Th||(Vf=function(_d){const Cf=_d._camera.getWorldToCamera(_d.worldSize,1),Ud=o.multiply([],Cf,_d.globeMatrix);o.invert(Ud,Ud);const Lf=[0,0,0],Cd=[0,1,0,0];return o.transformMat4$1(Cd,Cd,Ud),Lf[0]=Cd[0],Lf[1]=Cd[1],Lf[2]=Cd[2],o.normalize(Lf,Lf),Lf}(Sh));for(const _d of B){const Cf=u.getTile(_d),Ud=Cf.getBucket(E);if(!Ud||Ud.projection.name==="mercator"&&ld)continue;const Lf=_e?Ud.text:Ud.icon;if(!Lf||Ud.fullyClipped||!Lf.segments.get().length)continue;const Cd=Lf.programConfigurations.get(E.id),pd=_e||Ud.sdfIcons,$d=_e?Ud.textSizeData:Ud.iconSizeData,yf=Ch||Sh.pitch!==0,$f=o.evaluateSizeForZoom($d,Sh.zoom);let Dp,nm,Cp,xp,Lp=[0,0],dm=null;if(_e){if(nm=Cf.glyphAtlasTexture,Cp=wh.LINEAR,Dp=Cf.glyphAtlasTexture.size,Ud.iconsInText){Lp=Cf.imageAtlasTexture.size,dm=Cf.imageAtlasTexture;const uy=$d.kind==="composite"||$d.kind==="camera";xp=yf||L.options.rotating||L.options.zooming||uy?wh.LINEAR:wh.NEAREST}}else{const uy=E.layout.get("icon-size").constantOr(0)!==1||Ud.iconsNeedLinear;nm=Cf.imageAtlasTexture,Cp=pd||L.options.rotating||L.options.zooming||uy||yf?wh.LINEAR:wh.NEAREST,Dp=Cf.imageAtlasTexture.size}const zp=Ud.projection.name==="globe",km=zp?Vf:gd,Am=zp?o.globeToMercatorTransition(Sh.zoom):0,jm=Zp(_d,Ud.getProjection(),Sh),zm=Sh.calculatePixelsToTileUnitsMatrix(Cf),gg=l_(jm,Cf.tileID.canonical,Ch,Th,Sh,Ud.getProjection(),zm),lg=L.terrain&&Ch&&hh?o.invert(o.create(),gg):tp,Cy=c_(jm,Cf.tileID.canonical,Ch,Th,Sh,Ud.getProjection(),zm),V0=Hh&&Ud.hasTextData(),ig=E.layout.get("icon-text-fit")!=="none"&&V0&&Ud.hasIconData();if(hh){const uy=Sh.elevation,My=uy?uy.getAtTileOffsetFunc(_d,Sh.center.lat,Sh.worldSize,Ud.getProjection()):null,G0=ev(jm,Cf.tileID.canonical,Ch,Th,Sh,Ud.getProjection(),zm);mm(Ud,jm,L,_e,G0,Cy,Ch,tl,My,_d)}const qm=hh||_e&&Hh||ig,_m=L.translatePosMatrix(jm,Cf,St,mr),cg=qm?tp:gg,n_=L.translatePosMatrix(Cy,Cf,St,mr,!0),Dm=Ud.getProjection().createInversionMatrix(Sh,_d.canonical),jg=[];L.terrainRenderModeElevated()&&Ch&&jg.push("PITCH_WITH_MAP_TERRAIN"),zp&&jg.push("PROJECTION_GLOBE_VIEW"),qm&&jg.push("PROJECTED_POS_ON_VIEWPORT");const y_=pd&&E.paint.get(_e?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let hv;hv=pd?Ud.iconsInText?Nm($d.kind,$f,Oh,Ch,L,_m,cg,n_,Dp,Lp,_d,Am,Fh,Dm,km,Ud.getProjection()):$p($d.kind,$f,Oh,Ch,L,_m,cg,n_,_e,Dp,!0,_d,Am,Fh,Dm,km,Ud.getProjection()):ip($d.kind,$f,Oh,Ch,L,_m,cg,n_,_e,Dp,_d,Am,Fh,Dm,km,Ud.getProjection());const Hv={program:L.useProgram(fg(pd,_e,Ud),Cd,jg),buffers:Lf,uniformValues:hv,atlasTexture:nm,atlasTextureIcon:dm,atlasInterpolation:Cp,atlasInterpolationIcon:xp,isSDF:pd,hasHalo:y_,tile:Cf,labelPlaneMatrixInv:lg};if(Rh&&Ud.canOverlap){Nh=!0;const uy=Lf.segments.get();for(const My of uy)xd.push({segments:new o.SegmentVector([My]),sortKey:My.sortKey,state:Hv})}else xd.push({segments:Lf.segments,sortKey:0,state:Hv})}Nh&&xd.sort((_d,Cf)=>_d.sortKey-Cf.sortKey);for(const _d of xd){const Cf=_d.state;if(L.terrain&&L.terrain.setupElevationDraw(Cf.tile,Cf.program,{useDepthForOcclusion:!ld,labelPlaneMatrixInv:Cf.labelPlaneMatrixInv}),fh.activeTexture.set(wh.TEXTURE0),Cf.atlasTexture.bind(Cf.atlasInterpolation,wh.CLAMP_TO_EDGE),Cf.atlasTextureIcon&&(fh.activeTexture.set(wh.TEXTURE1),Cf.atlasTextureIcon&&Cf.atlasTextureIcon.bind(Cf.atlasInterpolationIcon,wh.CLAMP_TO_EDGE)),Cf.isSDF){const Ud=Cf.uniformValues;Cf.hasHalo&&(Ud.u_is_halo=1,sp(Cf.buffers,_d.segments,E,L,Cf.program,qh,il,Qu,Ud)),Ud.u_is_halo=0}sp(Cf.buffers,_d.segments,E,L,Cf.program,qh,il,Qu,Cf.uniformValues)}}function sp(L,u,E,B,_e,St,mr,qr,ss){const tl=B.context,il=[L.dynamicLayoutVertexBuffer,L.opacityVertexBuffer,L.globeExtVertexBuffer];_e.draw(tl,tl.gl.TRIANGLES,St,mr,qr,o.CullFaceMode.disabled,ss,E.id,L.layoutVertexBuffer,L.indexBuffer,u,E.paint,B.transform.zoom,L.programConfigurations.get(E.id),il)}function Zy(L,u,E,B,_e,St,mr){const qr=L.context.gl,ss=E.paint.get("fill-pattern"),tl=ss&&ss.constantOr(1);let il,Qu,fh,wh,Sh;mr?(Qu=tl&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",il=qr.LINES):(Qu=tl?"fillPattern":"fill",il=qr.TRIANGLES);for(const Th of B){const Ch=u.getTile(Th);if(tl&&!Ch.patternsLoaded())continue;const hh=Ch.getBucket(E);if(!hh)continue;L.prepareDrawTile();const Oh=hh.programConfigurations.get(E.id),Rh=L.useProgram(Qu,Oh);tl&&(L.context.activeTexture.set(qr.TEXTURE0),Ch.imageAtlasTexture.bind(qr.LINEAR,qr.CLAMP_TO_EDGE),Oh.updatePaintBuffers());const Nh=ss.constantOr(null);if(Nh&&Ch.imageAtlas){const Fh=Ch.imageAtlas.patternPositions[Nh.toString()];Fh&&Oh.setConstantPatternPositions(Fh)}const qh=L.translatePosMatrix(Th.projMatrix,Ch,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));if(mr){wh=hh.indexBuffer2,Sh=hh.segments2;const Fh=L.terrain&&L.terrain.renderingToTexture?L.terrain.drapeBufferSize:[qr.drawingBufferWidth,qr.drawingBufferHeight];fh=Qu==="fillOutlinePattern"&&tl?xv(qh,L,Ch,Fh):ly(qh,Fh)}else wh=hh.indexBuffer,Sh=hh.segments,fh=tl?g_(qh,L,Ch):Im(qh);L.prepareDrawProgram(L.context,Rh,Th.toUnwrapped()),Rh.draw(L.context,il,_e,L.stencilModeForClipping(Th),St,o.CullFaceMode.disabled,fh,E.id,hh.layoutVertexBuffer,wh,Sh,E.paint,L.transform.zoom,Oh)}}function vy(L,u,E,B,_e,St,mr){const qr=L.context,ss=qr.gl,tl=L.transform,il=E.paint.get("fill-extrusion-pattern"),Qu=il.constantOr(1),fh=E.paint.get("fill-extrusion-opacity"),wh=[E.paint.get("fill-extrusion-ambient-occlusion-intensity"),E.paint.get("fill-extrusion-ambient-occlusion-radius")],Sh=E.layout.get("fill-extrusion-edge-radius"),Th=tl.projection.name==="globe"?o.fillExtrusionHeightLift():0,Ch=tl.projection.name==="globe",hh=Ch?o.globeToMercatorTransition(tl.zoom):0,Oh=[o.mercatorXfromLng(tl.center.lng),o.mercatorYfromLat(tl.center.lat)],Rh=[];Ch&&Rh.push("PROJECTION_GLOBE_VIEW"),wh[0]>0&&Rh.push("FAUX_AO");for(const Nh of B){const qh=u.getTile(Nh),Fh=qh.getBucket(E);if(!Fh||Fh.projection.name!==tl.projection.name)continue;const Hh=Fh.programConfigurations.get(E.id),ld=L.useProgram(Qu?"fillExtrusionPattern":"fillExtrusion",Hh,Rh);if(L.terrain){const Lf=L.terrain;if(L.style.terrainSetForDrapingOnly())Lf.setupElevationDraw(qh,ld,{useMeterToDem:!0});else{if(!Fh.enableTerrain)continue;if(Lf.setupElevationDraw(qh,ld,{useMeterToDem:!0}),$0(qr,u,Nh,Fh,E,Lf),!Fh.centroidVertexBuffer){const Cd=ld.attributes.a_centroid_pos;Cd!==void 0&&ss.vertexAttrib2f(Cd,0,0)}}}Qu&&(L.context.activeTexture.set(ss.TEXTURE0),qh.imageAtlasTexture.bind(ss.LINEAR,ss.CLAMP_TO_EDGE),Hh.updatePaintBuffers());const xd=il.constantOr(null);if(xd&&qh.imageAtlas){const Lf=qh.imageAtlas.patternPositions[xd.toString()];Lf&&Hh.setConstantPatternPositions(Lf)}const gd=L.translatePosMatrix(Nh.projMatrix,qh,E.paint.get("fill-extrusion-translate"),E.paint.get("fill-extrusion-translate-anchor")),Vf=tl.projection.createInversionMatrix(tl,Nh.canonical),_d=E.paint.get("fill-extrusion-vertical-gradient"),Cf=Qu?Bm(gd,L,_d,fh,wh,Sh,Nh,qh,Th,hh,Oh,Vf):Vy(gd,L,_d,fh,wh,Sh,Nh,Th,hh,Oh,Vf);L.prepareDrawProgram(qr,ld,Nh.toUnwrapped());const Ud=[];L.terrain&&Ud.push(Fh.centroidVertexBuffer),Ch&&Ud.push(Fh.layoutVertexExtBuffer),ld.draw(qr,qr.gl.TRIANGLES,_e,St,mr,o.CullFaceMode.backCCW,Cf,E.id,Fh.layoutVertexBuffer,Fh.indexBuffer,Fh.segments,E.paint,L.transform.zoom,Hh,Ud)}}function $0(L,u,E,B,_e,St){const mr=[hh=>{let Oh=hh.canonical.x-1,Rh=hh.wrap;return Oh<0&&(Oh=(1<<hh.canonical.z)-1,Rh--),new o.OverscaledTileID(hh.overscaledZ,Rh,hh.canonical.z,Oh,hh.canonical.y)},hh=>{let Oh=hh.canonical.x+1,Rh=hh.wrap;return Oh===1<<hh.canonical.z&&(Oh=0,Rh++),new o.OverscaledTileID(hh.overscaledZ,Rh,hh.canonical.z,Oh,hh.canonical.y)},hh=>new o.OverscaledTileID(hh.overscaledZ,hh.wrap,hh.canonical.z,hh.canonical.x,(hh.canonical.y===0?1<<hh.canonical.z:hh.canonical.y)-1),hh=>new o.OverscaledTileID(hh.overscaledZ,hh.wrap,hh.canonical.z,hh.canonical.x,hh.canonical.y===(1<<hh.canonical.z)-1?0:hh.canonical.y+1)],qr=hh=>{const Oh=u.getSource().minzoom,Rh=qh=>{const Fh=u.getTileByID(qh);if(Fh&&Fh.hasData())return Fh.getBucket(_e)},Nh=[0,-1,1];for(const qh of Nh){if(hh.overscaledZ+qh<Oh)continue;const Fh=Rh(hh.calculateScaledKey(hh.overscaledZ+qh));if(Fh)return Fh}},ss=[0,0,0],tl=(hh,Oh)=>(ss[0]=Math.min(hh.min.y,Oh.min.y),ss[1]=Math.max(hh.max.y,Oh.max.y),ss[2]=o.EXTENT-Oh.min.x>hh.max.x?Oh.min.x-o.EXTENT:hh.max.x,ss),il=(hh,Oh)=>(ss[0]=Math.min(hh.min.x,Oh.min.x),ss[1]=Math.max(hh.max.x,Oh.max.x),ss[2]=o.EXTENT-Oh.min.y>hh.max.y?Oh.min.y-o.EXTENT:hh.max.y,ss),Qu=[(hh,Oh)=>tl(hh,Oh),(hh,Oh)=>tl(Oh,hh),(hh,Oh)=>il(hh,Oh),(hh,Oh)=>il(Oh,hh)],fh=new o.pointGeometry(0,0);let wh,Sh,Th;const Ch=(hh,Oh,Rh,Nh,qh)=>{const Fh=[[Nh?Rh:hh,Nh?hh:Rh,0],[Nh?Rh:Oh,Nh?Oh:Rh,0]],Hh=qh<0?o.EXTENT+qh:qh,ld=[Nh?Hh:(hh+Oh)/2,Nh?(hh+Oh)/2:Hh,0];return Rh===0&&qh<0||Rh!==0&&qh>0?St.getForTilePoints(Th,[ld],!0,Sh):Fh.push(ld),St.getForTilePoints(E,Fh,!0,wh),Math.max(Fh[0][2],Fh[1][2],ld[2])/St.exaggeration()};for(let hh=0;hh<4;hh++){const Oh=(hh<2?1:5)-hh,Rh=B.borders[hh];if(Rh.length===0)continue;const Nh=Th=mr[hh](E),qh=qr(Nh);if(!(qh&&qh instanceof o.FillExtrusionBucket&&qh.enableTerrain)||B.borderDoneWithNeighborZ[hh]===qh.canonical.z&&qh.borderDoneWithNeighborZ[Oh]===B.canonical.z||(Sh=St.findDEMTileFor(Nh),!Sh||!Sh.dem))continue;if(!wh){const xd=St.findDEMTileFor(E);if(!xd||!xd.dem)return;wh=xd}const Fh=qh.borders[Oh];let Hh=0;const ld=qh.borderDoneWithNeighborZ[Oh]!==B.canonical.z;if(B.canonical.z===qh.canonical.z){for(let xd=0;xd<Rh.length;xd++){const gd=B.featuresOnBorder[Rh[xd]],Vf=gd.borders[hh];let _d;for(;Hh<Fh.length&&(_d=qh.featuresOnBorder[Fh[Hh]],!(_d.borders[Oh][1]>Vf[0]+3));)ld&&qh.encodeCentroid(void 0,_d,!1),Hh++;if(_d&&Hh<Fh.length){const Cf=Hh;let Ud=0;for(;!(_d.borders[Oh][0]>Vf[1]-3)&&(Ud++,++Hh!==Fh.length);)_d=qh.featuresOnBorder[Fh[Hh]];if(_d=qh.featuresOnBorder[Fh[Cf]],gd.intersectsCount()>1||_d.intersectsCount()>1||Ud!==1){Ud!==1&&(Hh=Cf),B.encodeCentroid(void 0,gd,!1),ld&&qh.encodeCentroid(void 0,_d,!1);continue}const Lf=Qu[hh](gd,_d),Cd=hh%2?o.EXTENT-1:0;fh.x=Ch(Lf[0],Math.min(o.EXTENT-1,Lf[1]),Cd,hh<2,Lf[2]),fh.y=0,B.encodeCentroid(fh,gd,!1),ld&&qh.encodeCentroid(fh,_d,!1)}else B.encodeCentroid(void 0,gd,!1)}B.borderDoneWithNeighborZ[hh]=qh.canonical.z,B.needsCentroidUpdate=!0,ld&&(qh.borderDoneWithNeighborZ[Oh]=B.canonical.z,qh.needsCentroidUpdate=!0)}else{for(const xd of Rh)B.encodeCentroid(void 0,B.featuresOnBorder[xd],!1);if(ld){for(const xd of Fh)qh.encodeCentroid(void 0,qh.featuresOnBorder[xd],!1);qh.borderDoneWithNeighborZ[Oh]=B.canonical.z,qh.needsCentroidUpdate=!0}B.borderDoneWithNeighborZ[hh]=qh.canonical.z,B.needsCentroidUpdate=!0}}(B.needsCentroidUpdate||!B.centroidVertexBuffer&&B.centroidVertexArray.length!==0)&&B.uploadCentroid(L)}const g0=new o.Color(1,0,0,1),ov=new o.Color(0,1,0,1),_0=new o.Color(0,0,1,1),Mm=new o.Color(1,0,1,1),am=new o.Color(0,1,1,1);function P_(L,u,E){const B=L.context,_e=L.transform,St=B.gl,mr=_e.projection.name==="globe",qr=mr?["PROJECTION_GLOBE_VIEW"]:null;let ss=E.projMatrix;if(mr&&o.globeToMercatorTransition(_e.zoom)>0){const gd=o.transitionTileAABBinECEF(E.canonical,_e),Vf=o.globeDenormalizeECEF(gd);ss=o.multiply(new Float32Array(16),_e.globeMatrix,Vf),o.multiply(ss,_e.projMatrix,ss)}const tl=L.useProgram("debug",null,qr),il=u.getTileByID(E.key);L.terrain&&L.terrain.setupElevationDraw(il,tl);const Qu=o.DepthMode.disabled,fh=o.StencilMode.disabled,wh=L.colorModeForRenderPass(),Sh="$debug";B.activeTexture.set(St.TEXTURE0),L.emptyTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE),mr?il._makeGlobeTileDebugBuffers(L.context,_e):il._makeDebugTileBoundsBuffers(L.context,_e.projection);const Th=il._tileDebugBuffer||L.debugBuffer,Ch=il._tileDebugIndexBuffer||L.debugIndexBuffer,hh=il._tileDebugSegments||L.debugSegments;tl.draw(B,St.LINE_STRIP,Qu,fh,wh,o.CullFaceMode.disabled,jy(ss,o.Color.red),Sh,Th,Ch,hh,null,null,null,[il._globeTileDebugBorderBuffer]);const Oh=il.latestRawTileData,Rh=Math.floor((Oh&&Oh.byteLength||0)/1024),Nh=u.getTile(E).tileSize,qh=512/Math.min(Nh,512)*(E.overscaledZ/_e.zoom)*.5;let Fh=E.canonical.toString();E.overscaledZ!==E.canonical.z&&(Fh+=` => ${E.overscaledZ}`),Fh+=` ${Rh}kb`,function(gd,Vf){gd.initDebugOverlayCanvas();const _d=gd.debugOverlayCanvas,Cf=gd.context.gl,Ud=gd.debugOverlayCanvas.getContext("2d");Ud.clearRect(0,0,_d.width,_d.height),Ud.shadowColor="white",Ud.shadowBlur=2,Ud.lineWidth=1.5,Ud.strokeStyle="white",Ud.textBaseline="top",Ud.font="bold 36px Open Sans, sans-serif",Ud.fillText(Vf,5,5),Ud.strokeText(Vf,5,5),gd.debugOverlayTexture.update(_d),gd.debugOverlayTexture.bind(Cf.LINEAR,Cf.CLAMP_TO_EDGE)}(L,Fh);const Hh=il._tileDebugTextBuffer||L.debugBuffer,ld=il._tileDebugTextIndexBuffer||L.quadTriangleIndexBuffer,xd=il._tileDebugTextSegments||L.debugSegments;tl.draw(B,St.TRIANGLES,Qu,fh,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,jy(ss,o.Color.transparent,qh),Sh,Hh,ld,xd,null,null,null,[il._globeTileDebugTextBuffer])}function Ng(L,u,E,B){Dg(L,0,u+E/2,L.transform.width,E,B)}function W_(L,u,E,B){Dg(L,u-E/2,0,E,L.transform.height,B)}function Dg(L,u,E,B,_e,St){const mr=L.context,qr=mr.gl;qr.enable(qr.SCISSOR_TEST),qr.scissor(u*o.exported.devicePixelRatio,E*o.exported.devicePixelRatio,B*o.exported.devicePixelRatio,_e*o.exported.devicePixelRatio),mr.clear({color:St}),qr.disable(qr.SCISSOR_TEST)}const Gm=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:sg}=Gm;function Jg(L,u,E,B){L.emplaceBack(u,E,B)}class k_{constructor(u){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Jg(this.vertexArray,-1,-1,1),Jg(this.vertexArray,1,-1,1),Jg(this.vertexArray,-1,1,1),Jg(this.vertexArray,1,1,1),Jg(this.vertexArray,-1,-1,-1),Jg(this.vertexArray,1,-1,-1),Jg(this.vertexArray,-1,1,-1),Jg(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=u.createVertexBuffer(this.vertexArray,sg),this.indexBuffer=u.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function em(L,u,E,B,_e,St){const mr=L.gl,qr=u.paint.get("sky-atmosphere-color"),ss=u.paint.get("sky-atmosphere-halo-color"),tl=u.paint.get("sky-atmosphere-sun-intensity"),il=((Qu,fh,wh,Sh,Th)=>({u_matrix_3f:Qu,u_sun_direction:fh,u_sun_intensity:wh,u_color_tint_r:[Sh.r,Sh.g,Sh.b,Sh.a],u_color_tint_m:[Th.r,Th.g,Th.b,Th.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),B),_e,tl,qr,ss);mr.framebufferTexture2D(mr.FRAMEBUFFER,mr.COLOR_ATTACHMENT0,mr.TEXTURE_CUBE_MAP_POSITIVE_X+St,u.skyboxTexture,0),E.draw(L,mr.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,il,"skyboxCapture",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}const Gg=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bv{constructor(u){const E=new o.StructArrayLayout5f20;E.emplaceBack(-1,1,1,0,0),E.emplaceBack(1,1,1,1,0),E.emplaceBack(1,-1,1,1,1),E.emplaceBack(-1,-1,1,0,1);const B=new o.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,3,0),this.vertexBuffer=u.createVertexBuffer(E,Gg.members),this.indexBuffer=u.createIndexBuffer(B),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ig={symbol:function(L,u,E,B,_e){if(L.renderPass!=="translucent")return;const St=o.StencilMode.disabled,mr=L.colorModeForRenderPass();E.layout.get("text-variable-anchor")&&function(qr,ss,tl,il,Qu,fh,wh){const Sh=ss.transform,Th=Qu==="map",Ch=fh==="map";for(const hh of qr){const Oh=il.getTile(hh),Rh=Oh.getBucket(tl);if(!Rh||!Rh.text||!Rh.text.segments.get().length)continue;const Nh=o.evaluateSizeForZoom(Rh.textSizeData,Sh.zoom),qh=Zp(hh,Rh.getProjection(),Sh),Fh=Sh.calculatePixelsToTileUnitsMatrix(Oh),Hh=l_(qh,Oh.tileID.canonical,Ch,Th,Sh,Rh.getProjection(),Fh),ld=tl.layout.get("icon-text-fit")!=="none"&&Rh.hasIconData();if(Nh){const xd=Math.pow(2,Sh.zoom-Oh.tileID.overscaledZ);Tg(Rh,Th,Ch,wh,o.symbolSize,Sh,Hh,hh,xd,Nh,ld)}}}(B,L,E,u,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),_e),E.paint.get("icon-opacity").constantOr(1)!==0&&A_(L,u,E,B,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),St,mr),E.paint.get("text-opacity").constantOr(1)!==0&&A_(L,u,E,B,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),St,mr),u.map.showCollisionBoxes&&(Vm(L,u,E,B,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),Vm(L,u,E,B,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))},circle:function(L,u,E,B){if(L.renderPass!=="translucent")return;const _e=E.paint.get("circle-opacity"),St=E.paint.get("circle-stroke-width"),mr=E.paint.get("circle-stroke-opacity"),qr=E.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_e.constantOr(1)===0&&(St.constantOr(1)===0||mr.constantOr(1)===0))return;const ss=L.context,tl=ss.gl,il=L.transform,Qu=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),fh=o.StencilMode.disabled,wh=L.colorModeForRenderPass(),Sh=il.projection.name==="globe",Th=[o.mercatorXfromLng(il.center.lng),o.mercatorYfromLat(il.center.lat)],Ch=[];for(let Oh=0;Oh<B.length;Oh++){const Rh=B[Oh],Nh=u.getTile(Rh),qh=Nh.getBucket(E);if(!qh||qh.projection.name!==il.projection.name)continue;const Fh=qh.programConfigurations.get(E.id),Hh=__(E);Sh&&Hh.push("PROJECTION_GLOBE_VIEW");const ld=L.useProgram("circle",Fh,Hh),xd=qh.layoutVertexBuffer,gd=qh.globeExtVertexBuffer,Vf=qh.indexBuffer,_d=il.projection.createInversionMatrix(il,Rh.canonical),Cf={programConfiguration:Fh,program:ld,layoutVertexBuffer:xd,globeExtVertexBuffer:gd,indexBuffer:Vf,uniformValues:f0(L,Rh,Nh,_d,Th,E),tile:Nh};if(qr){const Ud=qh.segments.get();for(const Lf of Ud)Ch.push({segments:new o.SegmentVector([Lf]),sortKey:Lf.sortKey,state:Cf})}else Ch.push({segments:qh.segments,sortKey:0,state:Cf})}qr&&Ch.sort((Oh,Rh)=>Oh.sortKey-Rh.sortKey);const hh={useDepthForOcclusion:!Sh};for(const Oh of Ch){const{programConfiguration:Rh,program:Nh,layoutVertexBuffer:qh,globeExtVertexBuffer:Fh,indexBuffer:Hh,uniformValues:ld,tile:xd}=Oh.state,gd=Oh.segments;L.terrain&&L.terrain.setupElevationDraw(xd,Nh,hh),L.prepareDrawProgram(ss,Nh,xd.tileID.toUnwrapped()),Nh.draw(ss,tl.TRIANGLES,Qu,fh,wh,o.CullFaceMode.disabled,ld,E.id,qh,Hh,gd,E.paint,il.zoom,Rh,[Fh])}},heatmap:function(L,u,E,B){if(E.paint.get("heatmap-opacity")!==0)if(L.renderPass==="offscreen"){const _e=L.context,St=_e.gl,mr=o.StencilMode.disabled,qr=new o.ColorMode([St.ONE,St.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(wh,Sh,Th,Ch){const hh=wh.gl,Oh=Sh.width*Ch,Rh=Sh.height*Ch;wh.activeTexture.set(hh.TEXTURE1),wh.viewport.set([0,0,Oh,Rh]);let Nh=Th.heatmapFbo;if(!Nh||Nh&&(Nh.width!==Oh||Nh.height!==Rh)){Nh&&Nh.destroy();const qh=hh.createTexture();hh.bindTexture(hh.TEXTURE_2D,qh),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_WRAP_S,hh.CLAMP_TO_EDGE),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_WRAP_T,hh.CLAMP_TO_EDGE),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_MIN_FILTER,hh.LINEAR),hh.texParameteri(hh.TEXTURE_2D,hh.TEXTURE_MAG_FILTER,hh.LINEAR),Nh=Th.heatmapFbo=wh.createFramebuffer(Oh,Rh,!1),function(Fh,Hh,ld,xd,gd,Vf){const _d=Fh.gl;_d.texImage2D(_d.TEXTURE_2D,0,Fh.isWebGL2&&Fh.extRenderToTextureHalfFloat?_d.RGBA16F:_d.RGBA,gd,Vf,0,_d.RGBA,Fh.extRenderToTextureHalfFloat?Fh.isWebGL2?_d.HALF_FLOAT:Fh.extTextureHalfFloat.HALF_FLOAT_OES:_d.UNSIGNED_BYTE,null),xd.colorAttachment.set(ld)}(wh,0,qh,Nh,Oh,Rh)}else hh.bindTexture(hh.TEXTURE_2D,Nh.colorAttachment.get()),wh.bindFramebuffer.set(Nh.framebuffer)})(_e,L,E,L.transform.projection.name==="globe"?.5:.25),_e.clear({color:o.Color.transparent});const ss=L.transform,tl=ss.projection.name==="globe",il=tl?["PROJECTION_GLOBE_VIEW"]:null,Qu=tl?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,fh=[o.mercatorXfromLng(ss.center.lng),o.mercatorYfromLat(ss.center.lat)];for(let wh=0;wh<B.length;wh++){const Sh=B[wh];if(u.hasRenderableParent(Sh))continue;const Th=u.getTile(Sh),Ch=Th.getBucket(E);if(!Ch||Ch.projection.name!==ss.projection.name)continue;const hh=Ch.programConfigurations.get(E.id),Oh=L.useProgram("heatmap",hh,il),{zoom:Rh}=L.transform;L.terrain&&L.terrain.setupElevationDraw(Th,Oh),L.prepareDrawProgram(_e,Oh,Sh.toUnwrapped());const Nh=ss.projection.createInversionMatrix(ss,Sh.canonical);Oh.draw(_e,St.TRIANGLES,o.DepthMode.disabled,mr,qr,Qu,Qg(L,Sh,Th,Nh,fh,Rh,E.paint.get("heatmap-intensity")),E.id,Ch.layoutVertexBuffer,Ch.indexBuffer,Ch.segments,E.paint,L.transform.zoom,hh,tl?[Ch.globeExtVertexBuffer]:null)}_e.viewport.set([0,0,L.width,L.height])}else L.renderPass==="translucent"&&(L.context.setColorMode(L.colorModeForRenderPass()),function(_e,St){const mr=_e.context,qr=mr.gl,ss=St.heatmapFbo;if(!ss)return;mr.activeTexture.set(qr.TEXTURE0),qr.bindTexture(qr.TEXTURE_2D,ss.colorAttachment.get()),mr.activeTexture.set(qr.TEXTURE1);let tl=St.colorRampTexture;tl||(tl=St.colorRampTexture=new o.Texture(mr,St.colorRamp,qr.RGBA)),tl.bind(qr.LINEAR,qr.CLAMP_TO_EDGE),_e.useProgram("heatmapTexture").draw(mr,qr.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,_e.colorModeForRenderPass(),o.CullFaceMode.disabled,((il,Qu,fh,wh)=>({u_image:0,u_color_ramp:1,u_opacity:Qu.paint.get("heatmap-opacity")}))(0,St),St.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments,St.paint,_e.transform.zoom)}(L,E))},line:function(L,u,E,B){if(L.renderPass!=="translucent")return;const _e=E.paint.get("line-opacity"),St=E.paint.get("line-width");if(_e.constantOr(1)===0||St.constantOr(1)===0)return;const mr=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),qr=L.colorModeForRenderPass(),ss=L.terrain&&L.terrain.renderingToTexture?1:o.exported.devicePixelRatio,tl=E.paint.get("line-dasharray"),il=tl.constantOr(1),Qu=E.layout.get("line-cap"),fh=E.paint.get("line-pattern"),wh=fh.constantOr(1),Sh=E.paint.get("line-gradient"),Th=wh?"linePattern":"line",Ch=L.context,hh=Ch.gl,Oh=(Nh=>{const qh=[];m0(Nh)&&qh.push("RENDER_LINE_DASH"),Nh.paint.get("line-gradient")&&qh.push("RENDER_LINE_GRADIENT");const Fh=Nh.paint.get("line-trim-offset");Fh[0]===0&&Fh[1]===0||qh.push("RENDER_LINE_TRIM_OFFSET");const Hh=Nh.paint.get("line-pattern").constantOr(1),ld=Nh.paint.get("line-opacity").constantOr(1)!==1;return!Hh&&ld&&qh.push("RENDER_LINE_ALPHA_DISCARD"),qh})(E);let Rh=Oh.includes("RENDER_LINE_ALPHA_DISCARD");L.terrain&&L.terrain.clipOrMaskOverlapStencilType()&&(Rh=!1);for(const Nh of B){const qh=u.getTile(Nh);if(wh&&!qh.patternsLoaded())continue;const Fh=qh.getBucket(E);if(!Fh)continue;L.prepareDrawTile();const Hh=Fh.programConfigurations.get(E.id),ld=L.useProgram(Th,Hh,Oh),xd=fh.constantOr(null);if(xd&&qh.imageAtlas){const pd=qh.imageAtlas.patternPositions[xd.toString()];pd&&Hh.setConstantPatternPositions(pd)}const gd=tl.constantOr(null),Vf=Qu.constantOr(null);if(!wh&&gd&&Vf&&qh.lineAtlas){const pd=qh.lineAtlas.getDash(gd,Vf);pd&&Hh.setConstantPatternPositions(pd)}let[_d,Cf]=E.paint.get("line-trim-offset");(Vf==="round"||Vf==="square")&&_d!==Cf&&(_d===0&&(_d-=1),Cf===1&&(Cf+=1));const Ud=L.terrain?Nh.projMatrix:null,Lf=wh?nv(L,qh,E,Ud,ss):qy(L,qh,E,Ud,Fh.lineClipsArray.length,ss,[_d,Cf]);if(Sh){const pd=Fh.gradients[E.id];let $d=pd.texture;if(E.gradientVersion!==pd.version){let yf=256;if(E.stepInterpolant){const $f=u.getSource().maxzoom,Dp=Nh.canonical.z===$f?Math.ceil(1<<L.transform.maxZoom-Nh.canonical.z):1;yf=o.clamp(o.nextPowerOfTwo(Fh.maxLineLength/o.EXTENT*1024*Dp),256,Ch.maxTextureSize)}pd.gradient=o.renderColorRamp({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:yf,image:pd.gradient||void 0,clips:Fh.lineClipsArray}),pd.texture?pd.texture.update(pd.gradient):pd.texture=new o.Texture(Ch,pd.gradient,hh.RGBA),pd.version=E.gradientVersion,$d=pd.texture}Ch.activeTexture.set(hh.TEXTURE1),$d.bind(E.stepInterpolant?hh.NEAREST:hh.LINEAR,hh.CLAMP_TO_EDGE)}il&&(Ch.activeTexture.set(hh.TEXTURE0),qh.lineAtlasTexture.bind(hh.LINEAR,hh.REPEAT),Hh.updatePaintBuffers()),wh&&(Ch.activeTexture.set(hh.TEXTURE0),qh.imageAtlasTexture.bind(hh.LINEAR,hh.CLAMP_TO_EDGE),Hh.updatePaintBuffers()),L.prepareDrawProgram(Ch,ld,Nh.toUnwrapped());const Cd=pd=>{ld.draw(Ch,hh.TRIANGLES,mr,pd,qr,o.CullFaceMode.disabled,Lf,E.id,Fh.layoutVertexBuffer,Fh.indexBuffer,Fh.segments,E.paint,L.transform.zoom,Hh,[Fh.layoutVertexBuffer2])};if(Rh){const pd=L.stencilModeForClipping(Nh).ref;pd===0&&L.terrain&&Ch.clear({stencil:0});const $d={func:hh.EQUAL,mask:255};Lf.u_alpha_discard_threshold=.8,Cd(new o.StencilMode($d,pd,255,hh.KEEP,hh.KEEP,hh.INVERT)),Lf.u_alpha_discard_threshold=0,Cd(new o.StencilMode($d,pd,255,hh.KEEP,hh.KEEP,hh.KEEP))}else Cd(L.stencilModeForClipping(Nh))}Rh&&(L.resetStencilClippingMasks(),L.terrain&&Ch.clear({stencil:0}))},fill:function(L,u,E,B){const _e=E.paint.get("fill-color"),St=E.paint.get("fill-opacity");if(St.constantOr(1)===0)return;const mr=L.colorModeForRenderPass(),qr=E.paint.get("fill-pattern"),ss=L.opaquePassEnabledForLayer()&&!qr.constantOr(1)&&_e.constantOr(o.Color.transparent).a===1&&St.constantOr(0)===1?"opaque":"translucent";if(L.renderPass===ss){const tl=L.depthModeForSublayer(1,L.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Zy(L,u,E,B,tl,mr,!1)}if(L.renderPass==="translucent"&&E.paint.get("fill-antialias")){const tl=L.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Zy(L,u,E,B,tl,mr,!0)}},"fill-extrusion":function(L,u,E,B){const _e=E.paint.get("fill-extrusion-opacity");if(_e!==0&&L.renderPass==="translucent"){const St=new o.DepthMode(L.context.gl.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D);if(_e!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))vy(L,u,E,B,St,o.StencilMode.disabled,o.ColorMode.disabled),vy(L,u,E,B,St,L.stencilModeFor3D(),L.colorModeForRenderPass()),L.resetStencilClippingMasks();else{const mr=L.colorModeForRenderPass();vy(L,u,E,B,St,o.StencilMode.disabled,mr)}}},hillshade:function(L,u,E,B){if(L.renderPass!=="offscreen"&&L.renderPass!=="translucent")return;const _e=L.context,St=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),mr=L.colorModeForRenderPass(),qr=L.terrain&&L.terrain.renderingToTexture,[ss,tl]=L.renderPass!=="translucent"||qr?[{},B]:L.stencilConfigForOverlap(B);for(const il of tl){const Qu=u.getTile(il);if(Qu.needsHillshadePrepare&&L.renderPass==="offscreen")c0(L,Qu,E,St,o.StencilMode.disabled,mr);else if(L.renderPass==="translucent"){const fh=qr&&L.terrain?L.terrain.stencilModeForRTTOverlap(il):ss[il.overscaledZ];q_(L,il,Qu,E,St,fh,mr)}}_e.viewport.set([0,0,L.width,L.height]),L.resetStencilClippingMasks()},raster:function(L,u,E,B,_e,St){if(L.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!B.length)return;const mr=L.context,qr=mr.gl,ss=u.getSource(),tl=L.useProgram("raster"),il=L.colorModeForRenderPass(),Qu=L.terrain&&L.terrain.renderingToTexture,[fh,wh]=ss instanceof nh||Qu?[{},B]:L.stencilConfigForOverlap(B),Sh=wh[wh.length-1].overscaledZ,Th=!L.options.moving;for(const Ch of wh){const hh=Qu?o.DepthMode.disabled:L.depthModeForSublayer(Ch.overscaledZ-Sh,E.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,qr.LESS),Oh=Ch.toUnwrapped(),Rh=u.getTile(Ch);if(Qu&&(!Rh||!Rh.hasData()))continue;const Nh=Qu?Ch.projMatrix:L.transform.calculateProjMatrix(Oh,Th),qh=L.terrain&&Qu?L.terrain.stencilModeForRTTOverlap(Ch):fh[Ch.overscaledZ],Fh=St?0:E.paint.get("raster-fade-duration");Rh.registerFadeDuration(Fh);const Hh=u.findLoadedParent(Ch,0),ld=C_(Rh,Hh,u,L.transform,Fh);let xd,gd;L.terrain&&L.terrain.prepareDrawTile();const Vf=E.paint.get("raster-resampling")==="nearest"?qr.NEAREST:qr.LINEAR;mr.activeTexture.set(qr.TEXTURE0),Rh.texture.bind(Vf,qr.CLAMP_TO_EDGE),mr.activeTexture.set(qr.TEXTURE1),Hh?(Hh.texture.bind(Vf,qr.CLAMP_TO_EDGE),xd=Math.pow(2,Hh.tileID.overscaledZ-Rh.tileID.overscaledZ),gd=[Rh.tileID.canonical.x*xd%1,Rh.tileID.canonical.y*xd%1]):Rh.texture.bind(Vf,qr.CLAMP_TO_EDGE),Rh.texture.useMipmap&&mr.extTextureFilterAnisotropic&&L.transform.pitch>20&&qr.texParameterf(qr.TEXTURE_2D,mr.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,mr.extTextureFilterAnisotropicMax);const _d=X_(Nh,gd||[0,0],xd||1,ld,E,ss instanceof nh?ss.perspectiveTransform:[0,0]);if(L.prepareDrawProgram(mr,tl,Oh),ss instanceof nh)ss.boundsBuffer&&ss.boundsSegments&&tl.draw(mr,qr.TRIANGLES,hh,o.StencilMode.disabled,il,o.CullFaceMode.disabled,_d,E.id,ss.boundsBuffer,L.quadTriangleIndexBuffer,ss.boundsSegments);else{const{tileBoundsBuffer:Cf,tileBoundsIndexBuffer:Ud,tileBoundsSegments:Lf}=L.getTileBoundsBuffers(Rh);tl.draw(mr,qr.TRIANGLES,hh,qh,il,o.CullFaceMode.disabled,_d,E.id,Cf,Ud,Lf)}}L.resetStencilClippingMasks()},background:function(L,u,E,B){const _e=E.paint.get("background-color"),St=E.paint.get("background-opacity");if(St===0)return;const mr=L.context,qr=mr.gl,ss=L.transform,tl=ss.tileSize,il=E.paint.get("background-pattern");if(L.isPatternMissing(il))return;const Qu=!il&&_e.a===1&&St===1&&L.opaquePassEnabledForLayer()?"opaque":"translucent";if(L.renderPass!==Qu)return;const fh=o.StencilMode.disabled,wh=L.depthModeForSublayer(0,Qu==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Sh=L.colorModeForRenderPass(),Th=L.useProgram(il?"backgroundPattern":"background");let Ch,hh=B;hh||(Ch=L.getBackgroundTiles(),hh=Object.values(Ch).map(Oh=>Oh.tileID)),il&&(mr.activeTexture.set(qr.TEXTURE0),L.imageManager.bind(L.context));for(const Oh of hh){const Rh=Oh.toUnwrapped(),Nh=B?Oh.projMatrix:L.transform.calculateProjMatrix(Rh);L.prepareDrawTile();const qh=u?u.getTile(Oh):Ch?Ch[Oh.key]:new o.Tile(Oh,tl,ss.zoom,L),Fh=il?Qm(Nh,St,L,il,{tileID:Oh,tileSize:tl}):hm(Nh,St,_e);L.prepareDrawProgram(mr,Th,Rh);const{tileBoundsBuffer:Hh,tileBoundsIndexBuffer:ld,tileBoundsSegments:xd}=L.getTileBoundsBuffers(qh);Th.draw(mr,qr.TRIANGLES,wh,fh,Sh,o.CullFaceMode.disabled,Fh,E.id,Hh,ld,xd)}},sky:function(L,u,E){const B=L.transform,_e=B.projection.name==="mercator"||B.projection.name==="globe"?1:o.smoothstep(7,8,B.zoom),St=E.paint.get("sky-opacity")*_e;if(St===0)return;const mr=L.context,qr=E.paint.get("sky-type"),ss=new o.DepthMode(mr.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),tl=L.frameCounter/1e3%1;qr==="atmosphere"?L.renderPass==="offscreen"?E.needsSkyboxCapture(L)&&(function(il,Qu,fh,wh){const Sh=il.context,Th=Sh.gl;let Ch=Qu.skyboxFbo;if(!Ch){Ch=Qu.skyboxFbo=Sh.createFramebuffer(32,32,!1),Qu.skyboxGeometry=new k_(Sh),Qu.skyboxTexture=Sh.gl.createTexture(),Th.bindTexture(Th.TEXTURE_CUBE_MAP,Qu.skyboxTexture),Th.texParameteri(Th.TEXTURE_CUBE_MAP,Th.TEXTURE_WRAP_S,Th.CLAMP_TO_EDGE),Th.texParameteri(Th.TEXTURE_CUBE_MAP,Th.TEXTURE_WRAP_T,Th.CLAMP_TO_EDGE),Th.texParameteri(Th.TEXTURE_CUBE_MAP,Th.TEXTURE_MIN_FILTER,Th.LINEAR),Th.texParameteri(Th.TEXTURE_CUBE_MAP,Th.TEXTURE_MAG_FILTER,Th.LINEAR);for(let Nh=0;Nh<6;++Nh)Th.texImage2D(Th.TEXTURE_CUBE_MAP_POSITIVE_X+Nh,0,Th.RGBA,32,32,0,Th.RGBA,Th.UNSIGNED_BYTE,null)}Sh.bindFramebuffer.set(Ch.framebuffer),Sh.viewport.set([0,0,32,32]);const hh=Qu.getCenter(il,!0),Oh=il.useProgram("skyboxCapture"),Rh=new Float64Array(16);o.identity(Rh),o.rotateY(Rh,Rh,.5*-Math.PI),em(Sh,Qu,Oh,Rh,hh,0),o.identity(Rh),o.rotateY(Rh,Rh,.5*Math.PI),em(Sh,Qu,Oh,Rh,hh,1),o.identity(Rh),o.rotateX(Rh,Rh,.5*-Math.PI),em(Sh,Qu,Oh,Rh,hh,2),o.identity(Rh),o.rotateX(Rh,Rh,.5*Math.PI),em(Sh,Qu,Oh,Rh,hh,3),o.identity(Rh),em(Sh,Qu,Oh,Rh,hh,4),o.identity(Rh),o.rotateY(Rh,Rh,Math.PI),em(Sh,Qu,Oh,Rh,hh,5),Sh.viewport.set([0,0,il.width,il.height])}(L,E),E.markSkyboxValid(L)):L.renderPass==="sky"&&function(il,Qu,fh,wh,Sh){const Th=il.context,Ch=Th.gl,hh=il.transform,Oh=il.useProgram("skybox");Th.activeTexture.set(Ch.TEXTURE0),Ch.bindTexture(Ch.TEXTURE_CUBE_MAP,Qu.skyboxTexture);const Rh=((Nh,qh,Fh,Hh,ld)=>({u_matrix:Nh,u_sun_direction:qh,u_cubemap:0,u_opacity:Hh,u_temporal_offset:ld}))(hh.skyboxMatrix,Qu.getCenter(il,!1),0,wh,Sh);il.prepareDrawProgram(Th,Oh),Oh.draw(Th,Ch.TRIANGLES,fh,o.StencilMode.disabled,il.colorModeForRenderPass(),o.CullFaceMode.backCW,Rh,"skybox",Qu.skyboxGeometry.vertexBuffer,Qu.skyboxGeometry.indexBuffer,Qu.skyboxGeometry.segment)}(L,E,ss,St,tl):qr==="gradient"&&L.renderPass==="sky"&&function(il,Qu,fh,wh,Sh){const Th=il.context,Ch=Th.gl,hh=il.transform,Oh=il.useProgram("skyboxGradient");Qu.skyboxGeometry||(Qu.skyboxGeometry=new k_(Th)),Th.activeTexture.set(Ch.TEXTURE0);let Rh=Qu.colorRampTexture;Rh||(Rh=Qu.colorRampTexture=new o.Texture(Th,Qu.colorRamp,Ch.RGBA)),Rh.bind(Ch.LINEAR,Ch.CLAMP_TO_EDGE);const Nh=((qh,Fh,Hh,ld,xd)=>({u_matrix:qh,u_color_ramp:0,u_center_direction:Fh,u_radius:o.degToRad(Hh),u_opacity:ld,u_temporal_offset:xd}))(hh.skyboxMatrix,Qu.getCenter(il,!1),Qu.paint.get("sky-gradient-radius"),wh,Sh);il.prepareDrawProgram(Th,Oh),Oh.draw(Th,Ch.TRIANGLES,fh,o.StencilMode.disabled,il.colorModeForRenderPass(),o.CullFaceMode.backCW,Nh,"skyboxGradient",Qu.skyboxGeometry.vertexBuffer,Qu.skyboxGeometry.indexBuffer,Qu.skyboxGeometry.segment)}(L,E,ss,St,tl)},debug:function(L,u,E){for(let B=0;B<E.length;B++)P_(L,u,E[B])},custom:function(L,u,E,B){const _e=L.context,St=E.implementation;if(!L.transform.projection.unsupportedLayers||!L.transform.projection.unsupportedLayers.includes("custom")||L.terrain&&(L.terrain.renderingToTexture||L.renderPass==="offscreen")&&E.isLayerDraped()){if(L.renderPass==="offscreen"){const mr=St.prerender;if(mr){if(L.setCustomLayerDefaults(),_e.setColorMode(L.colorModeForRenderPass()),L.transform.projection.name==="globe"){const qr=L.transform.pointMerc;mr.call(St,_e.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(L.transform.zoom),[qr.x,qr.y],L.transform.pixelsPerMeterRatio)}else mr.call(St,_e.gl,L.transform.customLayerMatrix());_e.setDirty(),L.setBaseState()}}else if(L.renderPass==="translucent"){if(L.terrain&&L.terrain.renderingToTexture){const qr=St.renderToTile;if(qr){const ss=B[0].canonical,tl=new o.MercatorCoordinate(ss.x+B[0].wrap*(1<<ss.z),ss.y,ss.z);_e.setDepthMode(o.DepthMode.disabled),_e.setStencilMode(o.StencilMode.disabled),_e.setColorMode(L.colorModeForRenderPass()),L.setCustomLayerDefaults(),qr.call(St,_e.gl,tl),_e.setDirty(),L.setBaseState()}return}L.setCustomLayerDefaults(),_e.setColorMode(L.colorModeForRenderPass()),_e.setStencilMode(o.StencilMode.disabled);const mr=St.renderingMode==="3d"?new o.DepthMode(L.context.gl.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D):L.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(_e.setDepthMode(mr),L.transform.projection.name==="globe"){const qr=L.transform.pointMerc;St.render(_e.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(L.transform.zoom),[qr.x,qr.y],L.transform.pixelsPerMeterRatio)}else St.render(_e.gl,L.transform.customLayerMatrix());_e.setDirty(),L.setBaseState(),_e.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Cm{constructor(u,E,B=!1){this.context=new Gn(u,B),this.transform=E,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new o0,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(u,E){const B=!!u&&!!u.terrain&&this.transform.projection.supportsTerrain;if(!(B||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Uy(this,u));const _e=this._terrain;this.transform.elevation=B?_e:null,_e.update(u,this.transform,E)}_updateFog(u){const E=u.fog;if(!E||this.transform.projection.name==="globe"||E.getOpacity(this.transform.pitch)<1||E.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[B,_e]=E.getFovAdjustedRange(this.transform._fov);if(B>_e)return void(this.transform.fogCullDistSq=null);const St=B+.78*(_e-B);this.transform.fogCullDistSq=St*St}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(u,E){if(this.width=u*o.exported.devicePixelRatio,this.height=E*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style.order)this.style._layers[B].resize()}setup(){const u=this.context,E=new o.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(o.EXTENT,0),E.emplaceBack(0,o.EXTENT),E.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=u.createVertexBuffer(E,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const B=new o.StructArrayLayout2i4;B.emplaceBack(0,0),B.emplaceBack(o.EXTENT,0),B.emplaceBack(0,o.EXTENT),B.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=u.createVertexBuffer(B,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _e=new o.StructArrayLayout2i4;_e.emplaceBack(-1,-1),_e.emplaceBack(1,-1),_e.emplaceBack(-1,1),_e.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(_e,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const St=new o.StructArrayLayout4i8;St.emplaceBack(0,0,0,0),St.emplaceBack(o.EXTENT,0,o.EXTENT,0),St.emplaceBack(0,o.EXTENT,0,o.EXTENT),St.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=u.createVertexBuffer(St,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const mr=new o.StructArrayLayout3ui6;mr.emplaceBack(0,1,2),mr.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(mr);const qr=new o.StructArrayLayout1ui2;for(const tl of[0,1,3,2,0])qr.emplaceBack(tl);this.debugIndexBuffer=u.createIndexBuffer(qr),this.emptyTexture=new o.Texture(u,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),u.gl.RGBA),this.identityMat=o.create();const ss=this.context.gl;this.stencilClearMode=new o.StencilMode({func:ss.ALWAYS,mask:0},0,255,ss.ZERO,ss.ZERO,ss.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new bv(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(u){return u._makeTileBoundsBuffers(this.context,this.transform.projection),u._tileBoundsBuffer?{tileBoundsBuffer:u._tileBoundsBuffer,tileBoundsIndexBuffer:u._tileBoundsIndexBuffer,tileBoundsSegments:u._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const u=this.context,E=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(u,E.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Kp(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(u,E,B){if(!E||this.currentStencilSource===E.id||!u.isTileClipped()||!B||B.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let qr=!1;for(const ss of B)if(this._tileClippingMaskIDs[ss.key]===void 0){qr=!0;break}if(!qr)return}this.currentStencilSource=E.id;const _e=this.context,St=_e.gl;this.nextStencilID+B.length>256&&this.clearStencil(),_e.setColorMode(o.ColorMode.disabled),_e.setDepthMode(o.DepthMode.disabled);const mr=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const qr of B){const ss=E.getTile(qr),tl=this._tileClippingMaskIDs[qr.key]=this.nextStencilID++,{tileBoundsBuffer:il,tileBoundsIndexBuffer:Qu,tileBoundsSegments:fh}=this.getTileBoundsBuffers(ss);mr.draw(_e,St.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:St.ALWAYS,mask:0},tl,255,St.KEEP,St.KEEP,St.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Kp(qr.projMatrix),"$clipping",il,Qu,fh)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,E=this.context.gl;return new o.StencilMode({func:E.NOTEQUAL,mask:255},u,255,E.KEEP,E.KEEP,E.REPLACE)}stencilModeForClipping(u){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(u);const E=this.context.gl;return new o.StencilMode({func:E.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,E.KEEP,E.KEEP,E.REPLACE)}stencilConfigForOverlap(u){const E=this.context.gl,B=u.sort((mr,qr)=>qr.overscaledZ-mr.overscaledZ),_e=B[B.length-1].overscaledZ,St=B[0].overscaledZ-_e+1;if(St>1){this.currentStencilSource=void 0,this.nextStencilID+St>256&&this.clearStencil();const mr={};for(let qr=0;qr<St;qr++)mr[qr+_e]=new o.StencilMode({func:E.GEQUAL,mask:255},qr+this.nextStencilID,255,E.KEEP,E.KEEP,E.REPLACE);return this.nextStencilID+=St,[mr,B]}return[{[_e]:o.StencilMode.disabled},B]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([u.CONSTANT_COLOR,u.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(u,E,B){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const _e=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new o.DepthMode(B||this.context.gl.LEQUAL,E,[_e,_e])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,E){this.style=u,this.options=E,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const B=this.style.order,_e=this.style._sourceCaches;for(const tl in _e){const il=_e[tl];il.used&&il.prepare(this.context)}const St={},mr={},qr={};for(const tl in _e){const il=_e[tl];St[tl]=il.getVisibleCoordinates(),mr[tl]=St[tl].slice().reverse(),qr[tl]=il.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let tl=0;tl<B.length;tl++)if(this.style._layers[B[tl]].is3D()){this.opaquePassCutoff=tl;break}if(this.terrain&&(this.terrain.updateTileBinding(qr),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const tl of B){const il=this.style._layers[tl],Qu=u._getLayerSourceCache(il);if(!il.hasOffscreenPass()||il.isHidden(this.transform.zoom))continue;const fh=Qu?mr[Qu.id]:void 0;(il.type==="custom"||il.isSky()||fh&&fh.length)&&this.renderLayer(this,Qu,il,fh)}this.depthRangeFor3D=[0,1-(u.order.length+2)*this.numSublayers*this.depthEpsilon];const ss=this.terrain;if(ss&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&ss.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:E.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=E.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const tl=this.style._layers[B[this.currentLayer]],il=u._getLayerSourceCache(tl);if(tl.isSky())continue;const Qu=il?mr[il.id]:void 0;this._renderTileClippingMasks(tl,il,Qu),this.renderLayer(this,il,tl,Qu)}if(this.style.fog&&this.transform.projection.supportsFog&&function(tl,il){const Qu=tl.context,fh=Qu.gl,wh=tl.transform,Sh=new o.DepthMode(fh.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Th=tl.useProgram("globeAtmosphere",null,wh.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ch=o.globeToMercatorTransition(wh.zoom),hh=il.properties.get("color").toArray01(),Oh=il.properties.get("high-color").toArray01(),Rh=il.properties.get("space-color").toArray01PremultipliedAlpha(),Nh=o.identity$1([]);o.rotateY$1(Nh,Nh,-o.degToRad(wh._center.lng)),o.rotateX$1(Nh,Nh,o.degToRad(wh._center.lat)),o.rotateZ$1(Nh,Nh,wh.angle),o.rotateX$1(Nh,Nh,-wh._pitch);const qh=o.fromQuat(new Float32Array(16),Nh),Fh=o.mapValue(il.properties.get("star-intensity"),0,1,0,.25),Hh=5e-4,ld=o.mapValue(il.properties.get("horizon-blend"),0,1,Hh,.25),xd=o.globeUseCustomAntiAliasing(tl,Qu,wh)&&ld===Hh?wh.worldSize/(2*Math.PI*1.025)-1:wh.globeRadius,gd=tl.frameCounter/1e3%1,Vf=o.length(wh.globeCenterInViewSpace),_d=Math.sqrt(Math.pow(Vf,2)-Math.pow(xd,2)),Cf=Math.acos(_d/Vf),Ud=((Cd,pd,$d,yf,$f,Dp,nm,Cp,xp,Lp,dm,zp,km,Am)=>({u_frustum_tl:Cd,u_frustum_tr:pd,u_frustum_br:$d,u_frustum_bl:yf,u_horizon:$f,u_transition:Dp,u_fadeout_range:nm,u_color:Cp,u_high_color:xp,u_space_color:Lp,u_star_intensity:dm,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:zp,u_horizon_angle:km,u_rotation_matrix:Am}))(wh.frustumCorners.TL,wh.frustumCorners.TR,wh.frustumCorners.BR,wh.frustumCorners.BL,wh.frustumCorners.horizon,Ch,ld,hh,Oh,Rh,Fh,gd,Cf,qh);tl.prepareDrawProgram(Qu,Th);const Lf=tl.atmosphereBuffer;Lf&&Th.draw(Qu,fh.TRIANGLES,Sh,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ud,"skybox",Lf.vertexBuffer,Lf.indexBuffer,Lf.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const tl=this.style._layers[B[this.currentLayer]],il=u._getLayerSourceCache(tl);tl.isSky()&&this.renderLayer(this,il,tl,il?mr[il.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<B.length;){const tl=this.style._layers[B[this.currentLayer]],il=u._getLayerSourceCache(tl);if(tl.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(tl)){if(tl.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Qu=il?(tl.type==="symbol"?qr:mr)[il.id]:void 0;this._renderTileClippingMasks(tl,il,il?St[il.id]:void 0),this.renderLayer(this,il,tl,Qu),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let tl=null;o.values(this.style._layers).forEach(il=>{const Qu=u._getLayerSourceCache(il);Qu&&!il.isHidden(this.transform.zoom)&&(!tl||tl.getSource().maxzoom<Qu.getSource().maxzoom)&&(tl=Qu)}),tl&&this.options.showTileBoundaries&&Ig.debug(this,tl,tl.getVisibleCoordinates())}this.options.showPadding&&function(tl){const il=tl.transform.padding;Ng(tl,tl.transform.height-(il.top||0),3,g0),Ng(tl,il.bottom||0,3,ov),W_(tl,il.left||0,3,_0),W_(tl,tl.transform.width-(il.right||0),3,Mm);const Qu=tl.transform.centerPoint;(function(fh,wh,Sh,Th){Dg(fh,wh-1,Sh-10,2,20,Th),Dg(fh,wh-10,Sh-1,20,2,Th)})(tl,Qu.x,tl.transform.height-Qu.y,am)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(u,E,B,_e){B.isHidden(this.transform.zoom)||(B.type==="background"||B.type==="sky"||B.type==="custom"||_e&&_e.length)&&(this.id=B.id,this.gpuTimingStart(B),(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes(B.type)||u.terrain&&B.type==="custom")&&Ig[B.type](u,E,B,_e,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(u){if(!this.options.gpuTiming)return;const E=this.context.extTimerQuery;let B=this.gpuTimers[u.id];B||(B=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:E.createQueryEXT()}),B.calls++,E.beginQueryEXT(E.TIME_ELAPSED_EXT,B.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const u=this.context.extTimerQuery,E=u.createQueryEXT();this.deferredRenderGpuTimeQueries.push(E),u.beginQueryEXT(u.TIME_ELAPSED_EXT,E)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}collectGpuTimers(){const u=this.gpuTimers;return this.gpuTimers={},u}collectDeferredRenderGpuQueries(){const u=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],u}queryGpuTimers(u){const E={};for(const B in u){const _e=u[B],St=this.context.extTimerQuery,mr=St.getQueryObjectEXT(_e.query,St.QUERY_RESULT_EXT)/1e6;St.deleteQueryEXT(_e.query),E[B]=mr}return E}queryGpuTimeDeferredRender(u){if(!this.options.gpuTimingDeferredRender)return 0;const E=this.context.extTimerQuery;let B=0;for(const _e of u)B+=E.getQueryObjectEXT(_e,E.QUERY_RESULT_EXT)/1e6,E.deleteQueryEXT(_e);return B}translatePosMatrix(u,E,B,_e,St){if(!B[0]&&!B[1])return u;const mr=St?_e==="map"?this.transform.angle:0:_e==="viewport"?-this.transform.angle:0;if(mr){const tl=Math.sin(mr),il=Math.cos(mr);B=[B[0]*il-B[1]*tl,B[0]*tl+B[1]*il]}const qr=[St?B[0]:Sd(E,B[0],this.transform.zoom),St?B[1]:Sd(E,B[1],this.transform.zoom),0],ss=new Float32Array(16);return o.translate(ss,u,qr),ss}saveTileTexture(u){const E=this._tileTextures[u.size[0]];E?E.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const E=this._tileTextures[u];return E&&E.length>0?E.pop():null}isPatternMissing(u){return u===null||u!==void 0&&!this.imageManager.getPattern(u.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const u=this.terrain&&this.terrain.renderingToTexture,E=this.terrain&&this.terrain.exaggeration()===0,B=this.style&&this.style.fog,_e=[];return this.terrainRenderModeElevated()&&_e.push("TERRAIN"),this.transform.projection.name==="globe"&&_e.push("GLOBE"),E&&_e.push("ZERO_EXAGGERATION"),B&&!u&&B.getOpacity(this.transform.pitch)!==0&&_e.push("FOG"),u&&_e.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_e.push("OVERDRAW_INSPECTOR"),_e}useProgram(u,E,B){this.cache=this.cache||{};const _e=B||[],St=this.currentGlobalDefines().concat(_e),mr=Xm.cacheKey(vv[u],u,St,E);return this.cache[mr]||(this.cache[mr]=new Xm(this.context,u,vv[u],E,og[u],St)),this.cache[mr]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(u,E,B){if(this.terrain&&this.terrain.renderingToTexture)return;const _e=this.style.fog;if(_e){const St=_e.getOpacity(this.transform.pitch),mr=((qr,ss,tl,il,Qu,fh,wh,Sh,Th,Ch,hh)=>{const Oh=qr.transform,Rh=ss.properties.get("color").toArray01();Rh[3]=il;const Nh=qr.frameCounter/1e3%1;return{u_fog_matrix:tl?Oh.calculateFogTileMatrix(tl):qr.identityMat,u_fog_range:ss.getFovAdjustedRange(Oh._fov),u_fog_color:Rh,u_fog_horizon_blend:ss.properties.get("horizon-blend"),u_fog_temporal_offset:Nh,u_frustum_tl:Qu,u_frustum_tr:fh,u_frustum_br:wh,u_frustum_bl:Sh,u_globe_pos:Th,u_globe_radius:Ch,u_viewport:hh,u_globe_transition:o.globeToMercatorTransition(Oh.zoom),u_is_globe:+(Oh.projection.name==="globe")}})(this,_e,B,St,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);E.setFogUniformValues(u,mr)}}setTileLoadedFlag(u){this.tileLoaded=u}saveCanvasCopy(){const u=this.canvasCopy();u&&(this.frameCopies.push(u),this.tileLoaded=!1)}canvasCopy(){const u=this.context.gl,E=u.createTexture();return u.bindTexture(u.TEXTURE_2D,E),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,u.drawingBufferWidth,u.drawingBufferHeight,0),E}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const u=this.style&&this.style.fog;return!!u&&u.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const u=this._backgroundTiles,E=this._backgroundTiles={},B=this.transform.coveringTiles({tileSize:512});for(const _e of B)E[_e.key]=u[_e.key]||new o.Tile(_e,512,this.transform.tileZoom,this);return E}clearBackgroundTiles(){this._backgroundTiles={}}}class D_{constructor(u=0,E=0,B=0,_e=0){if(isNaN(u)||u<0||isNaN(E)||E<0||isNaN(B)||B<0||isNaN(_e)||_e<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=E,this.left=B,this.right=_e}interpolate(u,E,B){return E.top!=null&&u.top!=null&&(this.top=o.number(u.top,E.top,B)),E.bottom!=null&&u.bottom!=null&&(this.bottom=o.number(u.bottom,E.bottom,B)),E.left!=null&&u.left!=null&&(this.left=o.number(u.left,E.left,B)),E.right!=null&&u.right!=null&&(this.right=o.number(u.right,E.right,B)),this}getCenter(u,E){const B=o.clamp((this.left+u-this.right)/2,0,u),_e=o.clamp((this.top+E-this.bottom)/2,0,E);return new o.pointGeometry(B,_e)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new D_(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function xy(L,u){const E=o.getColumn(L,3);o.fromQuat(L,u),o.setColumn(L,3,E)}function Hy(L,u){const E=o.identity$1([]);return o.rotateZ$1(E,E,-u),o.rotateX$1(E,E,-L),E}function y0(L,u){const E=[L[0],L[1],0],B=[u[0],u[1],0];if(o.length(E)>=1e-15){const mr=o.normalize([],E);o.scale$2(B,mr,o.dot(B,mr)),u[0]=B[0],u[1]=B[1]}const _e=o.cross([],u,L);if(o.len(_e)<1e-15)return null;const St=Math.atan2(-_e[1],_e[0]);return Hy(Math.atan2(Math.sqrt(L[0]*L[0]+L[1]*L[1]),-L[2]),St)}class Y_{constructor(u,E){this.position=u,this.orientation=E}get position(){return this._position}set position(u){if(u){const E=u instanceof o.MercatorCoordinate?u:new o.MercatorCoordinate(u[0],u[1],u[2]);this._renderWorldCopies&&(E.x=o.wrap(E.x,0,1)),this._position=E}else this._position=null}lookAtPoint(u,E){if(this.orientation=null,!this.position)return;const B=this.position,_e=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(u)):0,St=o.MercatorCoordinate.fromLngLat(u,_e),mr=[St.x-B.x,St.y-B.y,St.z-B.z];E||(E=[0,0,1]),E[2]=Math.abs(E[2]),this.orientation=y0(mr,E)}setPitchBearing(u,E){this.orientation=Hy(o.degToRad(u),o.degToRad(-E))}}class Xy{constructor(u,E){this._transform=o.identity([]),this.orientation=E,this.position=u}get mercatorPosition(){const u=this.position;return new o.MercatorCoordinate(u[0],u[1],u[2])}get position(){const u=o.getColumn(this._transform,3);return[u[0],u[1],u[2]]}set position(u){var E;u&&o.setColumn(this._transform,3,[(E=u)[0],E[1],E[2],1])}get orientation(){return this._orientation}set orientation(u){this._orientation=u||o.identity$1([]),u&&xy(this._transform,this._orientation)}getPitchBearing(){const u=this.forward(),E=this.right();return{bearing:Math.atan2(-E[1],E[0]),pitch:Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2])}}setPitchBearing(u,E){this._orientation=Hy(u,E),xy(this._transform,this._orientation)}forward(){const u=o.getColumn(this._transform,2);return[-u[0],-u[1],-u[2]]}up(){const u=o.getColumn(this._transform,1);return[-u[0],-u[1],-u[2]]}right(){const u=o.getColumn(this._transform,0);return[u[0],u[1],u[2]]}getCameraToWorld(u,E){const B=new Float64Array(16);return o.invert(B,this.getWorldToCamera(u,E)),B}getWorldToCameraPosition(u,E,B){const _e=this.position;o.scale$2(_e,_e,-u);const St=new Float64Array(16);return o.fromScaling(St,[B,B,B]),o.translate(St,St,_e),St[10]*=E,St}getWorldToCamera(u,E){const B=new Float64Array(16),_e=new Float64Array(4),St=this.position;return o.conjugate(_e,this._orientation),o.scale$2(St,St,-u),o.fromQuat(B,_e),o.translate(B,B,St),B[1]*=-1,B[5]*=-1,B[9]*=-1,B[13]*=-1,B[8]*=E,B[9]*=E,B[10]*=E,B[11]*=E,B}getCameraToClipPerspective(u,E,B,_e){const St=new Float64Array(16);return o.perspective(St,u,E,B,_e),St}getDistanceToElevation(u,E=!1){const B=u===0?0:o.mercatorZfromAltitude(u,E?o.latFromMercatorY(this.position[1]):this.position[1]),_e=this.forward();return(B-this.position[2])/_e[2]}clone(){return new Xy([...this.position],[...this.orientation])}}function e_(L,u){const E=kp(L.projection,L.zoom,L.width,L.height),B=function(St,mr,qr,ss,tl){const il=new o.LngLat(qr.lng-180*Up,qr.lat),Qu=new o.LngLat(qr.lng+180*Up,qr.lat),fh=St.project(il.lng,il.lat),wh=St.project(Qu.lng,Qu.lat),Sh=-Math.atan2(wh.y-fh.y,wh.x-fh.x),Th=o.MercatorCoordinate.fromLngLat(qr);Th.y=o.clamp(Th.y,-.999975,.999975);const Ch=Th.toLngLat(),hh=St.project(Ch.lng,Ch.lat),Oh=o.MercatorCoordinate.fromLngLat(Ch);Oh.x+=Up;const Rh=Oh.toLngLat(),Nh=St.project(Rh.lng,Rh.lat),qh=N0(Nh.x-hh.x,Nh.y-hh.y,Sh),Fh=o.MercatorCoordinate.fromLngLat(Ch);Fh.y+=Up;const Hh=Fh.toLngLat(),ld=St.project(Hh.lng,Hh.lat),xd=N0(ld.x-hh.x,ld.y-hh.y,Sh),gd=Math.abs(qh.x)/Math.abs(xd.y),Vf=o.identity([]);o.rotateZ(Vf,Vf,-Sh*(1-(tl?0:ss)));const _d=o.identity([]);return o.scale(_d,_d,[1,1-(1-gd)*ss,1]),_d[4]=-xd.x/xd.y*ss,o.rotateZ(_d,_d,Sh),o.multiply(_d,Vf,_d),_d}(L.projection,0,L.center,E,u),_e=B0(L);return o.scale(B,B,[_e,_e,1]),B}function B0(L){const u=L.projection,E=kp(L.projection,L.zoom,L.width,L.height),B=by(u,L.center),_e=by(u,o.LngLat.convert(u.center));return Math.pow(2,B*E+(1-E)*_e)}function kp(L,u,E,B,_e=1/0){const St=L.range;if(!St)return 0;const mr=Math.min(_e,Math.max(E,B)),qr=Math.log(mr/1024)/Math.LN2;return o.smoothstep(St[0]+qr,St[1]+qr,u)}const Up=1/4e4;function by(L,u){const E=o.clamp(u.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),B=new o.LngLat(u.lng-180*Up,E),_e=new o.LngLat(u.lng+180*Up,E),St=L.project(B.lng,E),mr=L.project(_e.lng,E),qr=o.MercatorCoordinate.fromLngLat(B),ss=o.MercatorCoordinate.fromLngLat(_e),tl=mr.x-St.x,il=mr.y-St.y,Qu=ss.x-qr.x,fh=ss.y-qr.y,wh=Math.sqrt((Qu*Qu+fh*fh)/(tl*tl+il*il));return Math.log(wh)/Math.LN2}function N0(L,u,E){const B=Math.cos(E),_e=Math.sin(E);return{x:L*B-u*_e,y:L*_e+u*B}}class pp{constructor(u,E,B,_e,St,mr,qr){this.tileSize=512,this._renderWorldCopies=St===void 0||St,this._minZoom=u||0,this._maxZoom=E||22,this._minPitch=B??0,this._maxPitch=_e??60,this.setProjection(mr),this.setMaxBounds(qr),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new D_,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xy,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const u=new pp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return u._elevation=this._elevation,u._centerAltitude=this._centerAltitude,u._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,u.tileSize=this.tileSize,u.mercatorFromTransition=this.mercatorFromTransition,u.width=this.width,u.height=this.height,u.cameraElevationReference=this.cameraElevationReference,u._center=this._center,u._setZoom(this.zoom),u._seaLevelZoom=this._seaLevelZoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._nearZ=this._nearZ,u._farZ=this._farZ,u._averageElevation=this._averageElevation,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._camera=this._camera.clone(),u._calcMatrices(),u.freezeTileCoverage=this.freezeTileCoverage,u.frustumCorners=this.frustumCorners,u}get elevation(){return this._elevation}set elevation(u){this._elevation!==u&&(this._elevation=u,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(u,E=!1){const B=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||B)&&this._updateCameraOnTerrain(),(u||B)&&this._constrainCamera(E),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(u){this.projectionOptions=u||{name:"mercator"};const E=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const B=!x(E,this.getProjection());return B&&this._calcMatrices(),this.mercatorFromTransition=!1,B}setMercatorFromTransition(){const u=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const E=u!==this.projection.name;return E&&this._calcMatrices(),E}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get cameraWorldSize(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(u){this.rotation=u}get rotation(){return-this.angle/Math.PI*180}set rotation(u){const E=-u*Math.PI/180;var B;this.angle!==E&&(this._unmodified=!1,this.angle=E,this._calcMatrices(),this.rotationMatrix=(B=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(B[1]=0,B[2]=0),B[0]=1,B[3]=1,B),function(_e,St,mr){var qr=St[0],ss=St[1],tl=St[2],il=St[3],Qu=Math.sin(mr),fh=Math.cos(mr);_e[0]=qr*fh+tl*Qu,_e[1]=ss*fh+il*Qu,_e[2]=qr*-Qu+tl*fh,_e[3]=ss*-Qu+il*fh}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const E=o.clamp(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==E&&(this._unmodified=!1,this._pitch=E,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const u=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/u)}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=o.degToRad(u),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(u){this._averageElevation=u,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(u){const E=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==E&&(this._unmodified=!1,this._setZoom(E),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(u){this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;this._centerAltitude=u.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=u.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const u=this._elevation,E=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],B=this.horizonLineFromTop();let _e=0,St=0;for(let mr=0;mr<E.length;mr++){const qr=new o.pointGeometry(E[mr][0]*this.width,B+E[mr][1]*(this.height-B)),ss=u.pointCoordinate(qr);if(!ss)continue;const tl=1/Math.hypot(ss[0]-this._camera.position[0],ss[1]-this._camera.position[1]);_e+=ss[3]*tl,St+=tl}return St===0?NaN:_e/St}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const u=this._seaLevelZoom,E=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),B=this.pixelsPerMeter/this.worldSize*E,_e=this._mercatorZfromZoom(u),St=this._mercatorZfromZoom(this._maxZoom),mr=Math.max(_e-B,St);this._setZoom(this._zoomFromMercatorZ(mr))}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}computeZoomRelativeTo(u){const E=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,u.toAltitude()));let B;B=u.z<this._camera.position[2]?[E.x,E.y,E.z]:[u.x,u.y,u.z];const _e=o.length(o.sub([],this._camera.position,B));return o.clamp(this._zoomFromMercatorZ(_e),this._minZoom,this._maxZoom)}setFreeCameraOptions(u){if(!this.height||!u.position&&!u.orientation)return;this._updateCameraState();let E=!1;if(u.orientation&&!o.exactEquals(u.orientation,this._camera.orientation)&&(E=this._setCameraOrientation(u.orientation)),u.position){const B=[u.position.x,u.position.y,u.position.z];o.exactEquals$1(B,this._camera.position)||(this._setCameraPosition(B),E=!0)}E&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const u=this._camera.position,E=new Y_;return E.position=new o.MercatorCoordinate(u[0],u[1],u[2]),E.orientation=this._camera.orientation,E._elevation=this.elevation,E._renderWorldCopies=this.renderWorldCopies,E}_setCameraOrientation(u){if(!o.length$1(u))return!1;o.normalize$1(u,u);const E=o.transformQuat([],[0,0,-1],u),B=o.transformQuat([],[0,-1,0],u);if(B[2]<0)return!1;const _e=y0(E,B);return!!_e&&(this._camera.orientation=_e,!0)}_setCameraPosition(u){const E=this.zoomScale(this.minZoom)*this.tileSize,B=this.zoomScale(this.maxZoom)*this.tileSize,_e=this.cameraToCenterDistance;u[2]=o.clamp(u[2],_e/B,_e/E),this._camera.position=u}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,E,B){this._unmodified=!1,this._edgeInsets.interpolate(u,E,B),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const E=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,E)}getVisibleUnwrappedCoordinates(u){const E=[new o.UnwrappedTileID(0,u)];if(this.renderWorldCopies){const B=this.pointCoordinate(new o.pointGeometry(0,0)),_e=this.pointCoordinate(new o.pointGeometry(this.width,0)),St=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),mr=this.pointCoordinate(new o.pointGeometry(0,this.height)),qr=Math.floor(Math.min(B.x,_e.x,St.x,mr.x)),ss=Math.floor(Math.max(B.x,_e.x,St.x,mr.x)),tl=1;for(let il=qr-tl;il<=ss+tl;il++)il!==0&&E.push(new o.UnwrappedTileID(il,u))}return E}coveringTiles(u){let E=this.coveringZoomLevel(u);const B=E,_e=this.elevation&&!u.isTerrainDEM,St=this.projection.name==="mercator";if(u.minzoom!==void 0&&E<u.minzoom)return[];u.maxzoom!==void 0&&E>u.maxzoom&&(E=u.maxzoom);const mr=this.locationCoordinate(this.center),qr=this.center.lat,ss=1<<E,tl=[ss*mr.x,ss*mr.y,0],il=this.projection.name==="globe",Qu=!il,fh=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,E,Qu),wh=il?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Sh=ss*o.mercatorZfromAltitude(1,this.center.lat),Th=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Ch=[ss*wh.x,ss*wh.y,Th*(Qu?1:Sh)],hh=this.cameraToCenterDistance/u.tileSize*(u.roundZoom?1:.502),Oh=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?E:0,Rh=u.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Nh=u.isTerrainDEM?-Rh:this._elevation?this._elevation.getMinElevationBelowMSL():0,qh=this.projection.isReprojectedInTileSpace?B0(this):1,Fh=Cd=>{const $d=new o.MercatorCoordinate(Cd.x+25e-6,Cd.y,Cd.z),yf=new o.MercatorCoordinate(Cd.x,Cd.y+25e-6,Cd.z),$f=Cd.toLngLat(),Dp=$d.toLngLat(),nm=yf.toLngLat(),Cp=this.locationCoordinate($f),xp=this.locationCoordinate(Dp),Lp=this.locationCoordinate(nm),dm=Math.hypot(xp.x-Cp.x,xp.y-Cp.y),zp=Math.hypot(Lp.x-Cp.x,Lp.y-Cp.y);return Math.sqrt(dm*zp)*qh/25e-6},Hh=Cd=>{const pd=Rh,$d=Nh;return{aabb:o.tileAABB(this,ss,0,0,0,Cd,$d,pd,this.projection),zoom:0,x:0,y:0,minZ:$d,maxZ:pd,wrap:Cd,fullyVisible:!1}},ld=[];let xd=[];const gd=E,Vf=u.reparseOverscaled?B:E,_d=Cd=>Cd*Cd,Cf=_d((Th-this._centerAltitude)*Sh),Ud=Cd=>{if(!this._elevation||!Cd.tileID||!St)return;const pd=this._elevation.getMinMaxForTile(Cd.tileID),$d=Cd.aabb;pd?($d.min[2]=pd.min,$d.max[2]=pd.max,$d.center[2]=($d.min[2]+$d.max[2])/2):(Cd.shouldSplit=Lf(Cd),Cd.shouldSplit||($d.min[2]=$d.max[2]=$d.center[2]=this._centerAltitude))},Lf=Cd=>{if(Cd.zoom<Oh)return!0;if(Cd.zoom===gd)return!1;if(Cd.shouldSplit!=null)return Cd.shouldSplit;const pd=Cd.aabb.distanceX(Ch),$d=Cd.aabb.distanceY(Ch);let yf=Cf,$f=1;if(il){yf=_d(Cd.aabb.distanceZ(Ch));const Cp=Math.pow(2,Cd.zoom),xp=o.latFromMercatorY((Cd.y+1)/Cp),Lp=o.latFromMercatorY(Cd.y/Cp),dm=Math.min(Math.max(qr,xp),Lp),zp=o.circumferenceAtLatitude(dm)/o.circumferenceAtLatitude(qr);if($f=dm===qr?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zp/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Cd.zoom===gd-1&&zp>=.9)return!0}else if(_e&&(yf=_d(Cd.aabb.distanceZ(Ch)*Sh)),this.projection.isReprojectedInTileSpace&&B<=5){const Cp=Math.pow(2,Cd.zoom),xp=Fh(new o.MercatorCoordinate((Cd.x+.5)/Cp,(Cd.y+.5)/Cp));$f=xp>.85?1:xp}const Dp=pd*pd+$d*$d+yf,nm=_d((1<<gd-Cd.zoom)*hh*$f*((Cp,xp)=>{if(xp*_d(.707)<Cp)return 1;const Lp=Math.sqrt(xp/Cp);return Lp/(1.4144271570014144+(Math.pow(1.1,Lp-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(yf,Cf),Dp));return Dp<nm};if(this.renderWorldCopies)for(let Cd=1;Cd<=3;Cd++)ld.push(Hh(-Cd)),ld.push(Hh(Cd));for(ld.push(Hh(0));ld.length>0;){const Cd=ld.pop(),pd=Cd.x,$d=Cd.y;let yf=Cd.fullyVisible;if(!yf){const $f=Cd.aabb.intersects(fh);if($f===0)continue;yf=$f===2}if(Cd.zoom!==gd&&Lf(Cd))for(let $f=0;$f<4;$f++){const Dp=(pd<<1)+$f%2,nm=($d<<1)+($f>>1),Cp={aabb:St?Cd.aabb.quadrant($f):o.tileAABB(this,ss,Cd.zoom+1,Dp,nm,Cd.wrap,Cd.minZ,Cd.maxZ,this.projection),zoom:Cd.zoom+1,x:Dp,y:nm,wrap:Cd.wrap,fullyVisible:yf,tileID:void 0,shouldSplit:void 0,minZ:Cd.minZ,maxZ:Cd.maxZ};_e&&!il&&(Cp.tileID=new o.OverscaledTileID(Cd.zoom+1===gd?Vf:Cd.zoom+1,Cd.wrap,Cd.zoom+1,Dp,nm),Ud(Cp)),ld.push(Cp)}else{const $f=Cd.zoom===gd?Vf:Cd.zoom;if(u.minzoom&&u.minzoom>$f)continue;const Dp=tl[0]-(.5+pd+(Cd.wrap<<Cd.zoom))*(1<<E-Cd.zoom),nm=tl[1]-.5-$d,Cp=Cd.tileID?Cd.tileID:new o.OverscaledTileID($f,Cd.wrap,Cd.zoom,pd,$d);xd.push({tileID:Cp,distanceSq:Dp*Dp+nm*nm})}}if(this.fogCullDistSq){const Cd=this.fogCullDistSq,pd=this.horizonLineFromTop();xd=xd.filter($d=>{const yf=[0,0,0,1],$f=[o.EXTENT,o.EXTENT,0,1],Dp=this.calculateFogTileMatrix($d.tileID.toUnwrapped());o.transformMat4$1(yf,yf,Dp),o.transformMat4$1($f,$f,Dp);const nm=o.getAABBPointSquareDist(yf,$f);if(nm===0)return!0;let Cp=!1;const xp=this._elevation;if(xp&&nm>Cd&&pd!==0){const Lp=this.calculateProjMatrix($d.tileID.toUnwrapped());let dm;u.isTerrainDEM||(dm=xp.getMinMaxForTile($d.tileID)),dm||(dm={min:Nh,max:Rh});const zp=o.furthestTileCorner(this.rotation),km=[zp[0]*o.EXTENT,zp[1]*o.EXTENT,dm.max];o.transformMat4(km,km,Lp),Cp=(1-km[1])*this.height*.5<pd}return nm<Cd||Cp})}return xd.sort((Cd,pd)=>Cd.distanceSq-pd.distanceSq).map(Cd=>Cd.tileID)}resize(u,E){this.width=u,this.height=E,this.pixelsToGLUnits=[2/u,-2/E],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const E=o.clamp(u.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),B=this.projection.project(u.lng,E);return new o.pointGeometry(B.x*this.worldSize,B.y*this.worldSize)}unproject(u){return this.projection.unproject(u.x/this.worldSize,u.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(u,E){let B,_e;const St=this.centerPoint;if(this.projection.name==="globe"){const qr=this.worldSize;B=(E.x-St.x)/qr,_e=(E.y-St.y)/qr}else{const qr=this.pointCoordinate(E),ss=this.pointCoordinate(St);B=qr.x-ss.x,_e=qr.y-ss.y}const mr=this.locationCoordinate(u);this.setLocation(new o.MercatorCoordinate(mr.x-B,mr.y-_e))}setLocation(u){this.center=this.coordinateLocation(u),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(u){return this.projection.locationPoint(this,u)}locationPoint3D(u){return this.projection.locationPoint(this,u,!0)}pointLocation(u){return this.coordinateLocation(this.pointCoordinate(u))}pointLocation3D(u){return this.coordinateLocation(this.pointCoordinate3D(u))}locationCoordinate(u,E){const B=E?o.mercatorZfromAltitude(E,u.lat):void 0,_e=this.projection.project(u.lng,u.lat);return new o.MercatorCoordinate(_e.x,_e.y,B)}coordinateLocation(u){return this.projection.unproject(u.x,u.y)}pointRayIntersection(u,E){const B=E??this._centerAltitude,_e=[u.x,u.y,0,1],St=[u.x,u.y,1,1];o.transformMat4$1(_e,_e,this.pixelMatrixInverse),o.transformMat4$1(St,St,this.pixelMatrixInverse);const mr=St[3];o.scale$1(_e,_e,1/_e[3]),o.scale$1(St,St,1/mr);const qr=_e[2],ss=St[2];return{p0:_e,p1:St,t:qr===ss?0:(B-qr)/(ss-qr)}}screenPointToMercatorRay(u){const E=[u.x,u.y,0,1],B=[u.x,u.y,1,1];return o.transformMat4$1(E,E,this.pixelMatrixInverse),o.transformMat4$1(B,B,this.pixelMatrixInverse),o.scale$1(E,E,1/E[3]),o.scale$1(B,B,1/B[3]),E[2]=o.mercatorZfromAltitude(E[2],this._center.lat)*this.worldSize,B[2]=o.mercatorZfromAltitude(B[2],this._center.lat)*this.worldSize,o.scale$1(E,E,1/this.worldSize),o.scale$1(B,B,1/this.worldSize),new o.Ray([E[0],E[1],E[2]],o.normalize([],o.sub([],B,E)))}rayIntersectionCoordinate(u){const{p0:E,p1:B,t:_e}=u,St=o.mercatorZfromAltitude(E[2],this._center.lat),mr=o.mercatorZfromAltitude(B[2],this._center.lat);return new o.MercatorCoordinate(o.number(E[0],B[0],_e)/this.worldSize,o.number(E[1],B[1],_e)/this.worldSize,o.number(St,mr,_e))}pointCoordinate(u,E=this._centerAltitude){return this.projection.pointCoordinate(this,u.x,u.y,E)}pointCoordinate3D(u){if(!this.elevation)return this.pointCoordinate(u);let E=this.projection.pointCoordinate3D(this,u.x,u.y);if(E)return new o.MercatorCoordinate(E[0],E[1],E[2]);let B=0,_e=this.horizonLineFromTop();if(u.y>_e)return this.pointCoordinate(u);const St=.02*_e,mr=u.clone();for(let qr=0;qr<10&&_e-B>St;qr++){mr.y=o.number(B,_e,.66);const ss=this.projection.pointCoordinate3D(this,mr.x,mr.y);ss?(_e=mr.y,E=ss):B=mr.y}return E?new o.MercatorCoordinate(E[0],E[1],E[2]):this.pointCoordinate(u)}isPointAboveHorizon(u){return this.projection.isPointAboveHorizon(this,u)}_coordinatePoint(u,E){const B=E&&this.elevation?this.elevation.getAtPointOrZero(u,this._centerAltitude):this._centerAltitude,_e=[u.x*this.worldSize,u.y*this.worldSize,B+u.toAltitude(),1];return o.transformMat4$1(_e,_e,this.pixelMatrix),_e[3]>0?new o.pointGeometry(_e[0]/_e[3],_e[1]/_e[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:u,left:E}=this._edgeInsets,B=this.height-this._edgeInsets.bottom,_e=this.width-this._edgeInsets.right,St=this.pointLocation3D(new o.pointGeometry(E,u)),mr=this.pointLocation3D(new o.pointGeometry(_e,u)),qr=this.pointLocation3D(new o.pointGeometry(_e,B)),ss=this.pointLocation3D(new o.pointGeometry(E,B));let tl=Math.min(St.lng,mr.lng,qr.lng,ss.lng),il=Math.max(St.lng,mr.lng,qr.lng,ss.lng),Qu=Math.min(St.lat,mr.lat,qr.lat,ss.lat),fh=Math.max(St.lat,mr.lat,qr.lat,ss.lat);const wh=Math.pow(2,-this.zoom)/16*270,Sh=this.projection.name==="globe"?1:4,Th=(Ch,hh,Oh,Rh,Nh)=>{const qh=(Ch+Oh)/2,Fh=(hh+Rh)/2,Hh=new o.pointGeometry(qh,Fh),{lng:ld,lat:xd}=this.pointLocation3D(Hh),gd=Math.max(0,tl-ld,Qu-xd,ld-il,xd-fh);tl=Math.min(tl,ld),il=Math.max(il,ld),Qu=Math.min(Qu,xd),fh=Math.max(fh,xd),(Nh<Sh||gd>wh)&&(Th(Ch,hh,qh,Fh,Nh+1),Th(qh,Fh,Oh,Rh,Nh+1))};if(Th(E,u,_e,u,1),Th(_e,u,_e,B,1),Th(_e,B,E,B,1),Th(E,B,E,u,1),this.projection.name==="globe"){const[Ch,hh]=o.polesInViewport(this);Ch?(fh=90,il=180,tl=-180):hh&&(Qu=-90,il=180,tl=-180)}return new o.LngLatBounds(new o.LngLat(tl,Qu),new o.LngLat(il,fh))}_getBoundsRectangular(u,E){const{top:B,left:_e}=this._edgeInsets,St=this.height-this._edgeInsets.bottom,mr=this.width-this._edgeInsets.right,qr=new o.pointGeometry(_e,B),ss=new o.pointGeometry(mr,B),tl=new o.pointGeometry(mr,St),il=new o.pointGeometry(_e,St);let Qu=this.pointCoordinate(qr,u),fh=this.pointCoordinate(ss,u);const wh=this.pointCoordinate(tl,E),Sh=this.pointCoordinate(il,E),Th=(Ch,hh)=>(hh.y-Ch.y)/(hh.x-Ch.x);return Qu.y>1&&fh.y>=0?Qu=new o.MercatorCoordinate((1-Sh.y)/Th(Sh,Qu)+Sh.x,1):Qu.y<0&&fh.y<=1&&(Qu=new o.MercatorCoordinate(-Sh.y/Th(Sh,Qu)+Sh.x,0)),fh.y>1&&Qu.y>=0?fh=new o.MercatorCoordinate((1-wh.y)/Th(wh,fh)+wh.x,1):fh.y<0&&Qu.y<=1&&(fh=new o.MercatorCoordinate(-wh.y/Th(wh,fh)+wh.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(Qu)).extend(this.coordinateLocation(fh)).extend(this.coordinateLocation(Sh)).extend(this.coordinateLocation(wh))}_getBoundsRectangularTerrain(){const u=this.elevation;if(!u.visibleDemTiles.length||u.isUsingMockSource())return this._getBoundsRectangular(0,0);const E=u.visibleDemTiles.reduce((B,_e)=>{if(_e.dem){const St=_e.dem.tree;B.min=Math.min(B.min,St.minimums[0]),B.max=Math.max(B.max,St.maximums[0])}return B},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(E.min*u.exaggeration(),E.max*u.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(u=!0){const E=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,B=this.height/2-E*(1-this._horizonShift);return u?Math.max(0,B):B}getMaxBounds(){return this.maxBounds}setMaxBounds(u){this.maxBounds=u,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,u&&(this.minLat=u.getSouth(),this.maxLat=u.getNorth(),this.minLng=u.getWest(),this.maxLng=u.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(u,E){return this.projection.createTileMatrix(this,E,u)}calculateDistanceTileData(u){const E=u.key,B=this._distanceTileDataCache;if(B[E])return B[E];const _e=u.canonical,St=1/this.height,mr=this.cameraWorldSize,qr=mr/this.zoomScale(_e.z),ss=(_e.x+Math.pow(2,_e.z)*u.wrap)*qr,tl=_e.y*qr,il=this.point;il.x*=mr/this.worldSize,il.y*=mr/this.worldSize;const Qu=this.angle,fh=Math.sin(-Qu),wh=-Math.cos(-Qu);return B[E]={bearing:[fh,wh],center:[(il.x-ss)*St,(il.y-tl)*St],scale:qr/o.EXTENT*St},B[E]}calculateFogTileMatrix(u){const E=u.key,B=this._fogTileMatrixCache;if(B[E])return B[E];const _e=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,u);return o.multiply(_e,this.worldToFogMatrix,_e),B[E]=new Float32Array(_e),B[E]}calculateProjMatrix(u,E=!1){const B=u.key,_e=E?this._alignedProjMatrixCache:this._projMatrixCache;if(_e[B])return _e[B];const St=this.calculatePosMatrix(u,this.worldSize);return o.multiply(St,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:E?this.alignedProjMatrix:this.projMatrix,St),_e[B]=new Float32Array(St),_e[B]}calculatePixelsToTileUnitsMatrix(u){const E=u.tileID.key,B=this._pixelsToTileUnitsCache;if(B[E])return B[E];const _e=function(St,mr){const{scale:qr}=St.tileTransform,ss=qr*o.EXTENT/(St.tileSize*Math.pow(2,mr.zoom-St.tileID.overscaledZ+St.tileID.canonical.z));return tl=new Float32Array(4),fh=(il=mr.inverseAdjustmentMatrix)[1],wh=il[2],Sh=il[3],Ch=(Qu=[ss,ss])[1],tl[0]=il[0]*(Th=Qu[0]),tl[1]=fh*Th,tl[2]=wh*Ch,tl[3]=Sh*Ch,tl;var tl,il,Qu,fh,wh,Sh,Th,Ch}(u,this);return B[E]=_e,B[E]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const u=1/this.worldSize,E=o.fromScaling([],[u,u,u]);return o.multiply(E,E,this.globeMatrix),E}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const u=this._elevation;this._updateCameraState();const E=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,B=this._computeCameraPosition(E),_e=this._camera.forward(),St=o.mercatorZfromAltitude(1,this._center.lat);B[2]/=St,_e[2]/=St,o.normalize(_e,_e);const mr=u.raycast(B,_e,u.exaggeration());if(mr){const qr=o.scaleAndAdd([],B,_e,mr),ss=new o.MercatorCoordinate(qr[0],qr[1],o.mercatorZfromAltitude(qr[2],o.latFromMercatorY(qr[1]))),tl=(ss.z+o.length([ss.x-B[0],ss.y-B[1],ss.z-B[2]*St]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(tl),this._centerAltitude=ss.toAltitude(),this._center=this.coordinateLocation(ss),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(u=!1){if(!this._elevation)return;const E=this._elevation,B=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_e=this._computeCameraPosition(B),St=E.getAtPointOrZero(new o.MercatorCoordinate(..._e)),mr=this.pixelsPerMeter/this.worldSize*St,qr=this._minimumHeightOverTerrain(),ss=_e[2]-mr;if(ss<=qr)if(ss<0||u){const tl=this.locationCoordinate(this._center,this._centerAltitude),il=[_e[0],_e[1],tl.z-_e[2]],Qu=o.length(il);il[2]-=(qr-ss)/this._pixelsPerMercatorPixel;const fh=o.length(il);if(fh===0)return;o.scale$2(il,il,Qu/fh*this._pixelsPerMercatorPixel),this._camera.position=[_e[0],_e[1],tl.z*this._pixelsPerMercatorPixel-il[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||u){const fh=this.center;return fh.lat=o.clamp(fh.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!u)&&(fh.lng=o.clamp(fh.lng,this.minLng,this.maxLng)),this.center=fh,void(this._constraining=!1)}const E=this._unmodified,{x:B,y:_e}=this.point;let St=0,mr=B,qr=_e;const ss=this.width/2,tl=this.height/2,il=this.worldMinY*this.scale,Qu=this.worldMaxY*this.scale;if(_e-tl<il&&(qr=il+tl),_e+tl>Qu&&(qr=Qu-tl),Qu-il<this.height&&(St=Math.max(St,this.height/(Qu-il)),qr=(Qu+il)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const fh=this.worldMinX*this.scale,wh=this.worldMaxX*this.scale,Sh=this.worldSize/2-(fh+wh)/2;mr=(B+Sh+this.worldSize)%this.worldSize-Sh,mr-ss<fh&&(mr=fh+ss),mr+ss>wh&&(mr=wh-ss),wh-fh<this.width&&(St=Math.max(St,this.width/(wh-fh)),mr=(wh+fh)/2)}mr===B&&qr===_e||(this.center=this.unproject(new o.pointGeometry(mr,qr))),St&&(this.zoom+=this.scaleZoom(St)),this._constrainCamera(),this._unmodified=E,this._constraining=!1}_minZoomForBounds(){let u=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(u=Math.max(u,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),u}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,E=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const B=kp(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,B),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _e=this.projection.zAxisUnit==="meters"?E:1,St=this._camera.getWorldToCamera(this.worldSize,_e),mr=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);mr[8]=2*-u.x/this.width,mr[9]=2*u.y/this.height;let qr=o.mul([],mr,St);if(this.projection.isReprojectedInTileSpace){const Fh=this.locationCoordinate(this.center),Hh=o.identity([]);o.translate(Hh,Hh,[Fh.x*this.worldSize,Fh.y*this.worldSize,0]),o.multiply(Hh,Hh,e_(this)),o.translate(Hh,Hh,[-Fh.x*this.worldSize,-Fh.y*this.worldSize,0]),o.multiply(qr,qr,Hh),this.inverseAdjustmentMatrix=function(ld){const xd=e_(ld,!0);return ih([],[xd[0],xd[1],xd[4],xd[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],qr,[this.worldSize,this.worldSize,this.worldSize/_e,1]),this.projMatrix=qr,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const ss=o.invert([],mr);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(ss,this.horizonLineFromTop(),this.height);const tl=new Float32Array(16);o.identity(tl),o.scale(tl,tl,[1,-1,1]),o.rotateX(tl,tl,this._pitch),o.rotateZ(tl,tl,this.angle);const il=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Qu=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;il[8]=2*-u.x/this.width,il[9]=2*(u.y+Qu)/this.height,this.skyboxMatrix=o.multiply(tl,il,tl);const fh=this.point,wh=fh.x,Sh=fh.y,Th=this.width%2/2,Ch=this.height%2/2,hh=Math.cos(this.angle),Oh=Math.sin(this.angle),Rh=wh-Math.round(wh)+hh*Th+Oh*Ch,Nh=Sh-Math.round(Sh)+hh*Ch+Oh*Th,qh=new Float64Array(qr);if(o.translate(qh,qh,[Rh>.5?Rh-1:Rh,Nh>.5?Nh-1:Nh,0]),this.alignedProjMatrix=qh,qr=o.create(),o.scale(qr,qr,[this.width/2,-this.height/2,1]),o.translate(qr,qr,[1,-1,0]),this.labelPlaneMatrix=qr,qr=o.create(),o.scale(qr,qr,[1,-1,1]),o.translate(qr,qr,[-1,-1,0]),o.scale(qr,qr,[2/this.width,2/this.height,1]),this.glCoordMatrix=qr,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},qr=o.invert(new Float64Array(16),this.pixelMatrix),!qr)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=qr,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const Fh=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(Fh,Fh,St),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=qr;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const u=this.cameraWorldSizeForFog,E=this.cameraPixelsPerMeter,B=this._camera.position,_e=1/this.height/this._pixelsPerMercatorPixel,St=[u,u,E];o.scale$2(St,St,_e),o.scale$2(B,B,-1),o.multiply$2(B,B,St);const mr=o.create();o.translate(mr,mr,B),o.scale(mr,mr,St),this.mercatorFogMatrix=mr,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(u,E,_e)}_computeCameraPosition(u){const E=(u=u||this.pixelsPerMeter)/this.pixelsPerMeter,B=this._camera.forward(),_e=this.point,St=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*E-u/this.worldSize*this._centerAltitude;return[_e.x/this.worldSize-B[0]*St,_e.y/this.worldSize-B[1]*St,u/this.worldSize*this._centerAltitude-B[2]*St]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(u){const E=this._maxCameraBoundsDistance()*Math.cos(this._pitch),B=this._camera.position[2],_e=u[2];let St=1;this.projection.wrap&&(this.center=this.center.wrap()),_e>0&&(St=Math.min((E-B)/_e,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,u,St),this._updateStateFromCamera()}_updateStateFromCamera(){const u=this._camera.position,E=this._camera.forward(),{pitch:B,bearing:_e}=this._camera.getPitchBearing(),St=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,mr=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),qr=Math.max((u[2]-St)/Math.cos(B),mr),ss=this._zoomFromMercatorZ(qr);o.scaleAndAdd(u,u,E,qr),this._pitch=o.clamp(B,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(_e,-Math.PI,Math.PI),this._setZoom(o.clamp(ss,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(u[0],u[1],u[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(u){return Math.pow(2,u)*this.tileSize}_mercatorZfromZoom(u){return this.cameraToCenterDistance/this._worldSizeFromZoom(u)}_minimumHeightOverTerrain(){const u=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(u)}_zoomFromMercatorZ(u){return this.scaleZoom(this.cameraToCenterDistance/(u*this.tileSize))}zoomFromMercatorZAdjusted(u){let E=0,B=o.GLOBE_ZOOM_THRESHOLD_MAX,_e=0,St=1/0;for(;B-E>1e-6&&B>E;){const mr=E+.5*(B-E),qr=this.tileSize*Math.pow(2,mr),ss=this.getCameraToCenterDistance(this.projection,mr,qr),tl=this.scaleZoom(ss/(u*this.tileSize)),il=Math.abs(mr-tl);il<St&&(St=il,_e=mr),mr<tl?E=mr:B=mr}return _e}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(u,E){const B=Math.min(u.x,E.x),_e=Math.max(u.x,E.x),St=Math.min(u.y,E.y),mr=Math.max(u.y,E.y);if(St<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const qr=[new o.pointGeometry(B,St),new o.pointGeometry(_e,mr),new o.pointGeometry(B,mr),new o.pointGeometry(_e,St)],ss=this.renderWorldCopies?-3:0,tl=this.renderWorldCopies?4:1;for(const il of qr){const Qu=this.pointRayIntersection(il);if(Qu.t<0)return!0;const fh=this.rayIntersectionCoordinate(Qu);if(fh.x<ss||fh.y<0||fh.x>tl||fh.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(u,E){const B=o.length(o.sub([],this._camera.position,u)),_e=this._zoomFromMercatorZ(B)+E;return B-this._mercatorZfromZoom(_e)}getCameraPoint(){if(this.projection.name==="globe"){const u=function([E,B,_e],St){const mr=[E,B,_e,1];o.transformMat4$1(mr,mr,St);const qr=mr[3]=Math.max(mr[3],1e-6);return mr[0]/=qr,mr[1]/=qr,mr[2]/=qr,mr}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(u[0],u[1])}{const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,u))}}getCameraToCenterDistance(u,E=this.zoom,B=this.worldSize){const _e=kp(u,E,this.width,this.height,1024),St=u.pixelSpaceConversion(this.center.lat,B,_e);return .5/Math.tan(.5*this._fov)*this.height*St}getWorldToCameraMatrix(){const u=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(u,u,this.globeMatrix),u}}function tg(L,u){let E=!1,B=null;const _e=()=>{B=null,E&&(L(),B=setTimeout(_e,u),E=!1)};return()=>(E=!0,B||_e(),B)}class wv{constructor(u){this._hashName=u&&encodeURIComponent(u),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=tg(this._updateHashUnthrottled.bind(this),300)}addTo(u){return this._map=u,o.window.addEventListener("hashchange",this._onHashChange,!1),u.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const u=this._map;if(!u)return"";const E=L_(u);if(this._hashName){const B=this._hashName;let _e=!1;const St=o.window.location.hash.slice(1).split("&").map(mr=>{const qr=mr.split("=")[0];return qr===B?(_e=!0,`${qr}=${E}`):mr}).filter(mr=>mr);return _e||St.push(`${B}=${E}`),`#${St.join("&")}`}return`#${E}`}_getCurrentHash(){const u=o.window.location.hash.replace("#","");if(this._hashName){let E;return u.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(E=B)}),(E&&E[1]||"").split("/")}return u.split("/")}_onHashChange(){const u=this._map;if(!u)return!1;const E=this._getCurrentHash();if(E.length>=3&&!E.some(B=>isNaN(B))){const B=u.dragRotate.isEnabled()&&u.touchZoomRotate.isEnabled()?+(E[3]||0):u.getBearing();return u.jumpTo({center:[+E[2],+E[1]],zoom:+E[0],bearing:B,pitch:+(E[4]||0)}),!0}return!1}_updateHashUnthrottled(){const u=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,u)}}function L_(L,u){const E=L.getCenter(),B=Math.round(100*L.getZoom())/100,_e=Math.ceil((B*Math.LN2+Math.log(512/360/.5))/Math.LN10),St=Math.pow(10,_e),mr=Math.round(E.lng*St)/St,qr=Math.round(E.lat*St)/St,ss=L.getBearing(),tl=L.getPitch();let il=u?`/${mr}/${qr}/${B}`:`${B}/${qr}/${mr}`;return(ss||tl)&&(il+="/"+Math.round(10*ss)/10),tl&&(il+=`/${Math.round(tl)}`),il}const Ev={linearity:.3,easing:o.bezier(0,0,.3,1)},Wy=o.extend({deceleration:2500,maxSpeed:1400},Ev),pg=o.extend({deceleration:20,maxSpeed:1400},Ev),mg=o.extend({deceleration:1e3,maxSpeed:360},Ev),zv=o.extend({deceleration:1e3,maxSpeed:90},Ev);class v0{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,E=o.exported.now();for(;u.length>0&&E-u[0].time>160;)u.shift()}_onMoveEnd(u){if(o.exported.prefersReducedMotion||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const E={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:St}of this._inertiaBuffer)E.zoom+=St.zoomDelta||0,E.bearing+=St.bearingDelta||0,E.pitch+=St.pitchDelta||0,St.panDelta&&E.pan._add(St.panDelta),St.around&&(E.around=St.around),St.pinchAround&&(E.pinchAround=St.pinchAround);const B=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_e={};if(E.pan.mag()){const St=wy(E.pan.mag(),B,o.extend({},Wy,u||{}));_e.offset=E.pan.mult(St.amount/E.pan.mag()),_e.center=this._map.transform.center,x0(_e,St)}if(E.zoom){const St=wy(E.zoom,B,pg);_e.zoom=this._map.transform.zoom+St.amount,x0(_e,St)}if(E.bearing){const St=wy(E.bearing,B,mg);_e.bearing=this._map.transform.bearing+o.clamp(St.amount,-179,179),x0(_e,St)}if(E.pitch){const St=wy(E.pitch,B,zv);_e.pitch=this._map.transform.pitch+St.amount,x0(_e,St)}if(_e.zoom||_e.bearing){const St=E.pinchAround===void 0?E.around:E.pinchAround;_e.around=St?this._map.unproject(St):this._map.getCenter()}return this.clear(),_e.noMoveStart=!0,_e}}function x0(L,u){(!L.duration||L.duration<u.duration)&&(L.duration=u.duration,L.easing=u.easing)}function wy(L,u,E){const{maxSpeed:B,linearity:_e,deceleration:St}=E,mr=o.clamp(L*_e/(u/1e3),-B,B),qr=Math.abs(mr)/(St*_e);return{easing:E.easing,duration:1e3*qr,amount:mr*(qr/2)}}class Lg extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B,_e={}){const St=$s(E.getCanvasContainer(),B),mr=E.unproject(St);super(u,o.extend({point:St,lngLat:mr,originalEvent:B},_e)),this._defaultPrevented=!1,this.target=E}}class b0 extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B){const _e=u==="touchend"?B.changedTouches:B.touches,St=ah(E.getCanvasContainer(),_e),mr=St.map(ss=>E.unproject(ss)),qr=St.reduce((ss,tl,il,Qu)=>ss.add(tl.div(Qu.length)),new o.pointGeometry(0,0));super(u,{points:St,point:qr,lngLats:mr,lngLat:E.unproject(qr),originalEvent:B}),this._defaultPrevented=!1}}class Tv extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B){super(u,{originalEvent:B}),this._defaultPrevented=!1}}class Fv{constructor(u,E){this._map=u,this._clickTolerance=E.clickTolerance}reset(){this._mousedownPos=void 0}wheel(u){return this._firePreventable(new Tv(u.type,this._map,u))}mousedown(u,E){return this._mousedownPos=E,this._firePreventable(new Lg(u.type,this._map,u))}mouseup(u){this._map.fire(new Lg(u.type,this._map,u))}preclick(u){const E=o.extend({},u);E.type="preclick",this._map.fire(new Lg(E.type,this._map,E))}click(u,E){this._mousedownPos&&this._mousedownPos.dist(E)>=this._clickTolerance||(this.preclick(u),this._map.fire(new Lg(u.type,this._map,u)))}dblclick(u){return this._firePreventable(new Lg(u.type,this._map,u))}mouseover(u){this._map.fire(new Lg(u.type,this._map,u))}mouseout(u){this._map.fire(new Lg(u.type,this._map,u))}touchstart(u){return this._firePreventable(new b0(u.type,this._map,u))}touchmove(u){this._map.fire(new b0(u.type,this._map,u))}touchend(u){this._map.fire(new b0(u.type,this._map,u))}touchcancel(u){this._map.fire(new b0(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class av{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(u){this._map.fire(new Lg(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lg("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new Lg(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sv{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=E.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,E){this.isEnabled()&&u.shiftKey&&u.button===0&&(Io(),this._startPos=this._lastPos=E,this._active=!0)}mousemoveWindow(u,E){if(!this._active)return;const B=E,_e=this._startPos,St=this._lastPos;if(!_e||!St||St.equals(B)||!this._box&&B.dist(_e)<this._clickTolerance)return;this._lastPos=B,this._box||(this._box=ze("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));const mr=Math.min(_e.x,B.x),qr=Math.max(_e.x,B.x),ss=Math.min(_e.y,B.y),tl=Math.max(_e.y,B.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${mr}px,${ss}px)`,this._box.style.width=qr-mr+"px",this._box.style.height=tl-ss+"px")})}mouseupWindow(u,E){if(!this._active)return;const B=this._startPos,_e=E;if(B&&u.button===0){if(this.reset(),as(),B.x!==_e.x||B.y!==_e.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:u})),{cameraAnimation:St=>St.fitScreenCoordinates(B,_e,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",u)}}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),rl(),delete this._startPos,delete this._lastPos}_fireEvent(u,E){return this._map.fire(new o.Event(u,{originalEvent:E}))}}function z0(L,u){const E={};for(let B=0;B<L.length;B++)E[L[B].identifier]=u[B];return E}class Uv{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(u,E,B){(this.centroid||B.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=u.timeStamp),B.length===this.numTouches&&(this.centroid=function(_e){const St=new o.pointGeometry(0,0);for(const mr of _e)St._add(mr);return St.div(_e.length)}(E),this.touches=z0(B,E)))}touchmove(u,E,B){if(this.aborted||!this.centroid)return;const _e=z0(B,E);for(const St in this.touches){const mr=this.touches[St],qr=_e[St];(!qr||qr.dist(mr)>30)&&(this.aborted=!0)}}touchend(u,E,B){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),B.length===0){const _e=!this.aborted&&this.centroid;if(this.reset(),_e)return _e}}}class w0{constructor(u){this.singleTap=new Uv(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(u,E,B){this.singleTap.touchstart(u,E,B)}touchmove(u,E,B){this.singleTap.touchmove(u,E,B)}touchend(u,E,B){const _e=this.singleTap.touchend(u,E,B);if(_e){const St=u.timeStamp-this.lastTime<500,mr=!this.lastTap||this.lastTap.dist(_e)<30;if(St&&mr||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=_e,this.count===this.numTaps)return this.reset(),_e}}}class Sv{constructor(){this._zoomIn=new w0({numTouches:1,numTaps:2}),this._zoomOut=new w0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,E,B){this._zoomIn.touchstart(u,E,B),this._zoomOut.touchstart(u,E,B)}touchmove(u,E,B){this._zoomIn.touchmove(u,E,B),this._zoomOut.touchmove(u,E,B)}touchend(u,E,B){const _e=this._zoomIn.touchend(u,E,B),St=this._zoomOut.touchend(u,E,B);return _e?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:mr=>mr.easeTo({duration:300,zoom:mr.getZoom()+1,around:mr.unproject(_e)},{originalEvent:u})}):St?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:mr=>mr.easeTo({duration:300,zoom:mr.getZoom()-1,around:mr.unproject(St)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vv={0:1,2:2};class F0{constructor(u){this.reset(),this._clickTolerance=u.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(u,E){return!1}_move(u,E){return{}}mousedown(u,E){if(this._lastPoint)return;const B=ch(u);this._correctButton(u,B)&&(this._lastPoint=E,this._eventButton=B)}mousemoveWindow(u,E){const B=this._lastPoint;if(B){if(u.preventDefault(),this._eventButton!=null&&function(_e,St){const mr=Vv[St];return _e.buttons===void 0||(_e.buttons&mr)!==mr}(u,this._eventButton))this.reset();else if(this._moved||!(E.dist(B)<this._clickTolerance))return this._moved=!0,this._lastPoint=E,this._move(B,E)}}mouseupWindow(u){this._lastPoint&&ch(u)===this._eventButton&&(this._moved&&as(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gv extends F0{mousedown(u,E){super.mousedown(u,E),this._lastPoint&&(this._active=!0)}_correctButton(u,E){return E===0&&!u.ctrlKey}_move(u,E){return{around:E,panDelta:E.sub(u)}}}class Ey extends F0{_correctButton(u,E){return E===0&&u.ctrlKey||E===2}_move(u,E){const B=.8*(E.x-u.x);if(B)return this._active=!0,{bearingDelta:B}}contextmenu(u){u.preventDefault()}}class lv extends F0{_correctButton(u,E){return E===0&&u.ctrlKey||E===2}_move(u,E){const B=-.5*(E.y-u.y);if(B)return this._active=!0,{pitchDelta:B}}contextmenu(u){u.preventDefault()}}class E0{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._minTouches=1,this._clickTolerance=E.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(u,E,B){return this._calculateTransform(u,E,B)}touchmove(u,E,B){if(this._active&&!(B.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(B.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return u.cancelable&&u.preventDefault(),this._calculateTransform(u,E,B)}}touchend(u,E,B){this._calculateTransform(u,E,B),this._active&&B.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,E,B){B.length>0&&(this._active=!0);const _e=z0(B,E),St=new o.pointGeometry(0,0),mr=new o.pointGeometry(0,0);let qr=0;for(const tl in _e){const il=_e[tl],Qu=this._touches[tl];Qu&&(St._add(il),mr._add(il.sub(Qu)),qr++,_e[tl]=il)}if(this._touches=_e,qr<this._minTouches||!mr.mag())return;const ss=mr.div(qr);return this._sum._add(ss),this._sum.mag()<this._clickTolerance?void 0:{around:St.div(qr),panDelta:ss}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class cv{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(u){}_move(u,E,B){return{}}touchstart(u,E,B){this._firstTwoTouches||B.length<2||(this._firstTwoTouches=[B[0].identifier,B[1].identifier],this._start([E[0],E[1]]))}touchmove(u,E,B){const _e=this._firstTwoTouches;if(!_e)return;u.preventDefault();const[St,mr]=_e,qr=T0(B,E,St),ss=T0(B,E,mr);if(!qr||!ss)return;const tl=this._aroundCenter?null:qr.add(ss).div(2);return this._move([qr,ss],tl,u)}touchend(u,E,B){if(!this._firstTwoTouches)return;const[_e,St]=this._firstTwoTouches,mr=T0(B,E,_e),qr=T0(B,E,St);mr&&qr||(this._active&&as(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function T0(L,u,E){for(let B=0;B<L.length;B++)if(L[B].identifier===E)return u[B]}function jv(L,u){return Math.log(L/u)/Math.LN2}class c1 extends cv{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,E){const B=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(jv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jv(this._distance,B),pinchAround:E}}}function Iv(L,u){return 180*L.angleWith(u)/Math.PI}class Cv extends cv{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,E){const B=this._vector;if(this._vector=u[0].sub(u[1]),B&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Iv(this._vector,B),pinchAround:E}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const E=25/(Math.PI*this._minDiameter)*360,B=this._startVector;if(!B)return!1;const _e=Iv(u,B);return Math.abs(_e)<E}}function uv(L){return Math.abs(L.y)>Math.abs(L.x)}class zg extends cv{constructor(u){super(),this._map=u}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(u){this._lastPoints=u,uv(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,E,B){const _e=this._lastPoints;if(!_e)return;const St=u[0].sub(_e[0]),mr=u[1].sub(_e[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&B.touches.length<3||(this._valid=this.gestureBeginsVertically(St,mr,B.timeStamp),!this._valid)?void 0:(this._lastPoints=u,this._active=!0,{pitchDelta:(St.y+mr.y)/2*-.5})}gestureBeginsVertically(u,E,B){if(this._valid!==void 0)return this._valid;const _e=u.mag()>=2,St=E.mag()>=2;if(!_e&&!St)return;if(!_e||!St)return this._firstMove==null&&(this._firstMove=B),B-this._firstMove<100&&void 0;const mr=u.y>0==E.y>0;return uv(u)&&uv(E)&&mr}}const R1={panStep:100,bearingStep:15,pitchStep:10};class S0{constructor(){const u=R1;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let E=0,B=0,_e=0,St=0,mr=0;switch(u.keyCode){case 61:case 107:case 171:case 187:E=1;break;case 189:case 109:case 173:E=-1;break;case 37:u.shiftKey?B=-1:(u.preventDefault(),St=-1);break;case 39:u.shiftKey?B=1:(u.preventDefault(),St=1);break;case 38:u.shiftKey?_e=1:(u.preventDefault(),mr=-1);break;case 40:u.shiftKey?_e=-1:(u.preventDefault(),mr=1);break;default:return}return this._rotationDisabled&&(B=0,_e=0),{cameraAnimation:qr=>{const ss=qr.getZoom();qr.easeTo({duration:300,easeId:"keyboardHandler",easing:Mv,zoom:E?Math.round(ss)+E*(u.shiftKey?2:1):ss,bearing:qr.getBearing()+B*this._bearingStep,pitch:qr.getPitch()+_e*this._pitchStep,offset:[-St*this._panStep,-mr*this._panStep],center:qr.getCenter()},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mv(L){return L*(2-L)}const U0=4.000244140625;class Ty{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._handler=E,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(u){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(u.ctrlKey||u.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let E=u.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const B=o.exported.now(),_e=B-(this._lastWheelEventTime||0);this._lastWheelEventTime=B,E!==0&&E%U0==0?this._type="wheel":E!==0&&Math.abs(E)<4?this._type="trackpad":_e>400?(this._type=null,this._lastValue=E,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(_e*E)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,E+=this._lastValue)),u.shiftKey&&E&&(E/=4),this._type&&(this._lastWheelEvent=u,this._delta-=E,this._active||this._start(u)),u.preventDefault()}_onTimeout(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const E=$s(this._el,u);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:E,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._map.transform;this._type==="wheel"&&u.projection.wrap&&(u._center.lng>=180||u._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const E=()=>u._terrainEnabled()&&this._aroundCoord?u.computeZoomRelativeTo(this._aroundCoord):u.zoom;if(this._delta!==0){const ss=this._type==="wheel"&&Math.abs(this._delta)>U0?this._wheelZoomRate:this._defaultZoomRate;let tl=2/(1+Math.exp(-Math.abs(this._delta*ss)));this._delta<0&&tl!==0&&(tl=1/tl);const il=E(),Qu=Math.pow(2,il),fh=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):Qu;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(fh*tl))),this._type==="wheel"&&(this._startZoom=il,this._easing=this._smoothOutEasing(200)),this._delta=0}const B=typeof this._targetZoom=="number"?this._targetZoom:E(),_e=this._startZoom,St=this._easing;let mr,qr=!1;if(this._type==="wheel"&&_e&&St){const ss=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),tl=St(ss);mr=o.number(_e,B,tl),ss<1?this._frameId||(this._frameId=!0):qr=!0}else mr=B,qr=!0;return this._active=!0,qr&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!qr,zoomDelta:mr-E(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let E=o.ease;if(this._prevEase){const B=this._prevEase,_e=(o.exported.now()-B.start)/B.duration,St=B.easing(_e+.01)-B.easing(_e),mr=.27/Math.sqrt(St*St+1e-4)*.01,qr=Math.sqrt(.0729-mr*mr);E=o.bezier(mr,qr,.25,1)}return this._prevEase={start:o.exported.now(),duration:u,easing:E},E}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class qv{constructor(u,E){this._clickZoom=u,this._tapZoom=E}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(u,E){return u.preventDefault(),{cameraAnimation:B=>{B.easeTo({duration:300,zoom:B.getZoom()+(u.shiftKey?-1:1),around:B.unproject(E)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Iy{constructor(){this._tap=new w0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(u,E,B){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?B.length>0&&(this._swipePoint=E[0],this._swipeTouch=B[0].identifier):this._tap.touchstart(u,E,B))}touchmove(u,E,B){if(this._tapTime){if(this._swipePoint){if(B[0].identifier!==this._swipeTouch)return;const _e=E[0],St=_e.y-this._swipePoint.y;return this._swipePoint=_e,u.preventDefault(),this._active=!0,{zoomDelta:St/128}}}else this._tap.touchmove(u,E,B)}touchend(u,E,B){this._tapTime?this._swipePoint&&B.length===0&&this.reset():this._tap.touchend(u,E,B)&&(this._tapTime=u.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zv{constructor(u,E,B){this._el=u,this._mousePan=E,this._touchPan=B}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ip{constructor(u,E,B){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=E,this._mousePitch=B}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class O1{constructor(u,E,B,_e){this._el=u,this._touchZoom=E,this._touchRotate=B,this._tapDragZoom=_e,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const K_=L=>L.zoom||L.drag||L.pitch||L.rotate;class he extends o.Event{}class g{constructor(){this.constants=[1,1,.01],this.radius=0}setup(u,E){const B=o.sub([],E,u);this.radius=o.length(B[2]<0?o.div([],B,this.constants):[B[0],B[1],0])}projectRay(u){o.div(u,u,this.constants),o.normalize(u,u),o.mul$1(u,u,this.constants);const E=o.scale$2([],u,this.radius);if(E[2]>0){const B=o.scale$2([],[0,0,1],o.dot(E,[0,0,1])),_e=o.scale$2([],o.normalize([],[E[0],E[1],0]),this.radius),St=o.add([],E,o.scale$2([],o.sub([],o.add([],_e,B),E),2));E[0]=St[0],E[1]=St[1]}return E}}function A(L){return L.panDelta&&L.panDelta.mag()||L.zoomDelta||L.bearingDelta||L.pitchDelta}class q{constructor(u,E){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new v0(u),this._bearingSnap=E.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new g,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(E),o.bindAll(["handleEvent","handleWindowEvent"],this);const B=this._el;this._listeners=[[B,"touchstart",{passive:!0}],[B,"touchmove",{passive:!1}],[B,"touchend",void 0],[B,"touchcancel",void 0],[B,"mousedown",void 0],[B,"mousemove",void 0],[B,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[B,"mouseover",void 0],[B,"mouseout",void 0],[B,"dblclick",void 0],[B,"click",void 0],[B,"keydown",{capture:!1}],[B,"keyup",void 0],[B,"wheel",{passive:!1}],[B,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[_e,St,mr]of this._listeners)_e.addEventListener(St,_e===o.window.document?this.handleWindowEvent:this.handleEvent,mr)}destroy(){for(const[u,E,B]of this._listeners)u.removeEventListener(E,u===o.window.document?this.handleWindowEvent:this.handleEvent,B)}_addDefaultHandlers(u){const E=this._map,B=E.getCanvasContainer();this._add("mapEvent",new Fv(E,u));const _e=E.boxZoom=new sv(E,u);this._add("boxZoom",_e);const St=new Sv,mr=new Sy;E.doubleClickZoom=new qv(mr,St),this._add("tapZoom",St),this._add("clickZoom",mr);const qr=new Iy;this._add("tapDragZoom",qr);const ss=E.touchPitch=new zg(E);this._add("touchPitch",ss);const tl=new Ey(u),il=new lv(u);E.dragRotate=new Ip(u,tl,il),this._add("mouseRotate",tl,["mousePitch"]),this._add("mousePitch",il,["mouseRotate"]);const Qu=new Gv(u),fh=new E0(E,u);E.dragPan=new Zv(B,Qu,fh),this._add("mousePan",Qu),this._add("touchPan",fh,["touchZoom","touchRotate"]);const wh=new Cv,Sh=new c1;E.touchZoomRotate=new O1(B,Sh,wh,qr),this._add("touchRotate",wh,["touchPan","touchZoom"]),this._add("touchZoom",Sh,["touchPan","touchRotate"]),this._add("blockableMapEvent",new av(E));const Th=E.scrollZoom=new Ty(E,this);this._add("scrollZoom",Th,["mousePan"]);const Ch=E.keyboard=new S0;this._add("keyboard",Ch);for(const hh of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])u.interactive&&u[hh]&&E[hh].enable(u[hh])}_add(u,E,B){this._handlers.push({handlerName:u,handler:E,allowed:B}),this._handlersById[u]=E}stop(u){if(!this._updatingCamera){for(const{handler:E}of this._handlers)E.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!K_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(u,E,B){for(const _e in u)if(_e!==B&&(!E||E.indexOf(_e)<0))return!0;return!1}handleWindowEvent(u){this.handleEvent(u,`${u.type}Window`)}_getMapTouches(u){const E=[];for(const B of u)this._el.contains(B.target)&&E.push(B);return E}handleEvent(u,E){this._updatingCamera=!0;const B=u.type==="renderFrame",_e=B?void 0:u,St={needsRenderFrame:!1},mr={},qr={},ss=u.touches?this._getMapTouches(u.touches):void 0,tl=ss?ah(this._el,ss):B?void 0:$s(this._el,u);for(const{handlerName:fh,handler:wh,allowed:Sh}of this._handlers){if(!wh.isEnabled())continue;let Th;this._blockedByActive(qr,Sh,fh)?wh.reset():wh[E||u.type]&&(Th=wh[E||u.type](u,tl,ss),this.mergeHandlerResult(St,mr,Th,fh,_e),Th&&Th.needsRenderFrame&&this._triggerRenderFrame()),(Th||wh.isActive())&&(qr[fh]=wh)}const il={};for(const fh in this._previousActiveHandlers)qr[fh]||(il[fh]=_e);this._previousActiveHandlers=qr,(Object.keys(il).length||A(St))&&(this._changes.push([St,mr,il]),this._triggerRenderFrame()),(Object.keys(qr).length||A(St))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Qu}=St;Qu&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Qu(this._map))}mergeHandlerResult(u,E,B,_e,St){if(!B)return;o.extend(u,B);const mr={handlerName:_e,originalEvent:B.originalEvent||St};B.zoomDelta!==void 0&&(E.zoom=mr),B.panDelta!==void 0&&(E.drag=mr),B.pitchDelta!==void 0&&(E.pitch=mr),B.bearingDelta!==void 0&&(E.rotate=mr)}_applyChanges(){const u={},E={},B={};for(const[_e,St,mr]of this._changes)_e.panDelta&&(u.panDelta=(u.panDelta||new o.pointGeometry(0,0))._add(_e.panDelta)),_e.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+_e.zoomDelta),_e.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+_e.bearingDelta),_e.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+_e.pitchDelta),_e.around!==void 0&&(u.around=_e.around),_e.aroundCoord!==void 0&&(u.aroundCoord=_e.aroundCoord),_e.pinchAround!==void 0&&(u.pinchAround=_e.pinchAround),_e.noInertia&&(u.noInertia=_e.noInertia),o.extend(E,St),o.extend(B,mr);this._updateMapTransform(u,E,B),this._changes=[]}_updateMapTransform(u,E,B){const _e=this._map,St=_e.transform,mr=Oh=>[Oh.x,Oh.y,Oh.z];if((Oh=>{const Rh=this._eventsInProgress.drag;return Rh&&!this._handlersById[Rh.handlerName].isActive()})()&&!A(u)){const Oh=St.zoom;St.cameraElevationReference="sea",St.recenterOnTerrain(),St.cameraElevationReference="ground",Oh!==St.zoom&&this._map._update(!0)}if(St._isCameraConstrained&&_e._stop(!0),!A(u))return void this._fireEvents(E,B,!0);let{panDelta:qr,zoomDelta:ss,bearingDelta:tl,pitchDelta:il,around:Qu,aroundCoord:fh,pinchAround:wh}=u;St._isCameraConstrained&&(ss>0&&(ss=0),St._isCameraConstrained=!1),wh!==void 0&&(Qu=wh),(ss||(Oh=>E.drag&&!this._eventsInProgress.drag)())&&Qu&&(this._dragOrigin=mr(St.pointCoordinate3D(Qu)),this._trackingEllipsoid.setup(St._camera.position,this._dragOrigin)),St.cameraElevationReference="sea",_e._stop(!0),Qu=Qu||_e.transform.centerPoint,tl&&(St.bearing+=tl),il&&(St.pitch+=il),St._updateCameraState();const Sh=[0,0,0];if(qr)if(St.projection.name==="mercator"){const Oh=this._trackingEllipsoid.projectRay(St.screenPointToMercatorRay(Qu).dir),Rh=this._trackingEllipsoid.projectRay(St.screenPointToMercatorRay(Qu.sub(qr)).dir);Sh[0]=Rh[0]-Oh[0],Sh[1]=Rh[1]-Oh[1]}else{const Oh=St.pointCoordinate(Qu);if(St.projection.name==="globe"){qr=qr.rotate(-St.angle);const Rh=St._pixelsPerMercatorPixel/St.worldSize;Sh[0]=-qr.x*o.mercatorScale(o.latFromMercatorY(Oh.y))*Rh,Sh[1]=-qr.y*o.mercatorScale(St.center.lat)*Rh}else{const Rh=St.pointCoordinate(Qu.sub(qr));Oh&&Rh&&(Sh[0]=Rh.x-Oh.x,Sh[1]=Rh.y-Oh.y)}}const Th=St.zoom,Ch=[0,0,0];if(ss){const Oh=mr(fh||St.pointCoordinate3D(Qu)),Rh={dir:o.normalize([],o.sub([],Oh,St._camera.position))};if(Rh.dir[2]<0){const Nh=St.zoomDeltaToMovement(Oh,ss);o.scale$2(Ch,Rh.dir,Nh)}}const hh=o.add(Sh,Sh,Ch);St._translateCameraConstrained(hh),ss&&Math.abs(St.zoom-Th)>1e-4&&St.recenterOnTerrain(),St.cameraElevationReference="ground",this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(E,B,!0)}_fireEvents(u,E,B){const _e=K_(this._eventsInProgress),St=K_(u),mr={};for(const il in u){const{originalEvent:Qu}=u[il];this._eventsInProgress[il]||(mr[`${il}start`]=Qu),this._eventsInProgress[il]=u[il]}!_e&&St&&this._fireEvent("movestart",St.originalEvent);for(const il in mr)this._fireEvent(il,mr[il]);St&&this._fireEvent("move",St.originalEvent);for(const il in u){const{originalEvent:Qu}=u[il];this._fireEvent(il,Qu)}const qr={};let ss;for(const il in this._eventsInProgress){const{handlerName:Qu,originalEvent:fh}=this._eventsInProgress[il];this._handlersById[Qu].isActive()||(delete this._eventsInProgress[il],ss=E[Qu]||fh,qr[`${il}end`]=ss)}for(const il in qr)this._fireEvent(il,qr[il]);const tl=K_(this._eventsInProgress);if(B&&(_e||St)&&!tl){this._updatingCamera=!0;const il=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Qu=fh=>fh!==0&&-this._bearingSnap<fh&&fh<this._bearingSnap;il?(Qu(il.bearing||this._map.getBearing())&&(il.bearing=0),this._map.easeTo(il,{originalEvent:ss})):(this._map.fire(new o.Event("moveend",{originalEvent:ss})),Qu(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(u,E){this._map.fire(new o.Event(u,E?{originalEvent:E}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(u=>{this._frameId=void 0,this.handleEvent(new he("renderFrame",{timeStamp:u})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const nt="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ft extends o.Evented{constructor(u,E){super(),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=E.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(u,E){return this.jumpTo({center:u},E)}panBy(u,E,B){return u=o.pointGeometry.convert(u).mult(-1),this.panTo(this.transform.center,o.extend({offset:u},E),B)}panTo(u,E,B){return this.easeTo(o.extend({center:u},E),B)}getZoom(){return this.transform.zoom}setZoom(u,E){return this.jumpTo({zoom:u},E),this}zoomTo(u,E,B){return this.easeTo(o.extend({zoom:u},E),B)}zoomIn(u,E){return this.zoomTo(this.getZoom()+1,u,E),this}zoomOut(u,E){return this.zoomTo(this.getZoom()-1,u,E),this}getBearing(){return this.transform.bearing}setBearing(u,E){return this.jumpTo({bearing:u},E),this}getPadding(){return this.transform.padding}setPadding(u,E){return this.jumpTo({padding:u},E),this}rotateTo(u,E,B){return this.easeTo(o.extend({bearing:u},E),B)}resetNorth(u,E){return this.rotateTo(0,o.extend({duration:1e3},u),E),this}resetNorthPitch(u,E){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},u),E),this}snapToNorth(u,E){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,E):this}getPitch(){return this.transform.pitch}setPitch(u,E){return this.jumpTo({pitch:u},E),this}cameraForBounds(u,E){u=o.LngLatBounds.convert(u);const B=E&&E.bearing||0,_e=E&&E.pitch||0,St=u.getNorthWest(),mr=u.getSouthEast();return this._cameraForBounds(this.transform,St,mr,B,_e,E)}_extendCameraOptions(u){const E={top:0,bottom:0,right:0,left:0};if(typeof(u=o.extend({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const B=u.padding;u.padding={top:B,bottom:B,right:B,left:B}}return u.padding=o.extend(E,u.padding),u}_minimumAABBFrustumDistance(u,E){const B=E.max[0]-E.min[0],_e=E.max[1]-E.min[1];return B/_e>u.aspect?B/(2*Math.tan(.5*u.fovX)*u.aspect):_e/(2*Math.tan(.5*u.fovY)*u.aspect)}_cameraForBoundsOnGlobe(u,E,B,_e,St,mr){const qr=u.clone(),ss=this._extendCameraOptions(mr);qr.bearing=_e,qr.pitch=St;const tl=o.LngLat.convert(E),il=o.LngLat.convert(B),Qu=.5*(tl.lat+il.lat),fh=.5*(tl.lng+il.lng),wh=o.latLngToECEF(Qu,fh),Sh=o.normalize([],wh),Th=o.normalize([],o.cross([],Sh,[0,1,0])),Ch=o.cross([],Th,Sh),hh=[Th[0],Th[1],Th[2],0,Ch[0],Ch[1],Ch[2],0,Sh[0],Sh[1],Sh[2],0,0,0,0,1],Oh=[wh,o.latLngToECEF(tl.lat,tl.lng),o.latLngToECEF(il.lat,tl.lng),o.latLngToECEF(il.lat,il.lng),o.latLngToECEF(tl.lat,il.lng),o.latLngToECEF(Qu,tl.lng),o.latLngToECEF(Qu,il.lng),o.latLngToECEF(tl.lat,fh),o.latLngToECEF(il.lat,fh)];let Rh=o.Aabb.fromPoints(Oh.map(yf=>[o.dot(Th,yf),o.dot(Ch,yf),o.dot(Sh,yf)]));const Nh=o.transformMat4([],Rh.center,hh);o.squaredLength(Nh)===0&&o.set(Nh,0,0,1),o.normalize(Nh,Nh),o.scale$2(Nh,Nh,o.GLOBE_RADIUS),qr.center=o.ecefToLatLng(Nh);const qh=qr.getWorldToCameraMatrix(),Fh=o.invert(new Float64Array(16),qh);Rh=o.Aabb.applyTransform(Rh,o.multiply([],qh,hh)),o.transformMat4(Nh,Nh,qh);const Hh=.5*(Rh.max[2]-Rh.min[2]),ld=this._minimumAABBFrustumDistance(qr,Rh),xd=o.scale$2([],[0,0,1],Hh),gd=o.add(xd,Nh,xd),Vf=ld+(qr.pitch===0?0:o.distance(Nh,gd)),_d=qr.globeCenterInViewSpace,Cf=o.sub([],Nh,[_d[0],_d[1],_d[2]]);o.normalize(Cf,Cf),o.scale$2(Cf,Cf,Vf);const Ud=o.add([],Nh,Cf);o.transformMat4(Ud,Ud,Fh);const Lf=o.earthRadius/o.GLOBE_RADIUS,Cd=o.length(Ud),pd=o.mercatorZfromAltitude(Math.max(Cd*Lf-o.earthRadius,Number.EPSILON),0),$d=Math.min(qr.zoomFromMercatorZAdjusted(pd),ss.maxZoom);return $d>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(qr.setProjection({name:"mercator"}),qr.zoom=$d,this._cameraForBounds(qr,E,B,_e,St,mr)):{center:qr.center,zoom:$d,bearing:_e,pitch:St}}queryTerrainElevation(u,E){const B=this.transform.elevation;return B?(E=o.extend({},{exaggerated:!0},E),B.getAtPoint(o.MercatorCoordinate.fromLngLat(u),null,E.exaggerated)):null}_cameraForBounds(u,E,B,_e,St,mr){if(u.projection.name==="globe")return this._cameraForBoundsOnGlobe(u,E,B,_e,St,mr);const qr=u.clone(),ss=this._extendCameraOptions(mr),tl=qr.padding;qr.bearing=_e,qr.pitch=St;const il=o.LngLat.convert(E),Qu=o.LngLat.convert(B),fh=new o.LngLat(il.lng,Qu.lat),wh=new o.LngLat(Qu.lng,il.lat),Sh=qr.project(il),Th=qr.project(Qu),Ch=this.queryTerrainElevation(il),hh=this.queryTerrainElevation(Qu),Oh=this.queryTerrainElevation(fh),Rh=this.queryTerrainElevation(wh),Nh=[[Sh.x,Sh.y,Math.min(Ch||0,hh||0,Oh||0,Rh||0)],[Th.x,Th.y,Math.max(Ch||0,hh||0,Oh||0,Rh||0)]];let qh=o.Aabb.fromPoints(Nh);const Fh=qr.getWorldToCameraMatrix(),Hh=o.invert(new Float64Array(16),Fh);qh=o.Aabb.applyTransform(qh,Fh);const ld=o.sub([],qh.max,qh.min),xd=tl.left||0,gd=tl.right||0,Vf=tl.bottom||0,_d=tl.top||0,{left:Cf,right:Ud,top:Lf,bottom:Cd}=ss.padding,pd=.5*(xd+gd),$d=.5*(_d+Vf),yf=Math.min(qr.scaleZoom(qr.scale*Math.min((qr.width-(xd+gd+Cf+Ud))/ld[0],(qr.height-(Vf+_d+Cd+Lf))/ld[1])),ss.maxZoom),$f=qr.scale/qr.zoomScale(yf);qh=new o.Aabb([qh.min[0]-(Cf+pd)*$f,qh.min[1]-(Cd+$d)*$f,qh.min[2]],[qh.max[0]+(Ud+pd)*$f,qh.max[1]+(Lf+$d)*$f,qh.max[2]]);const Dp=.5*ld[2],nm=this._minimumAABBFrustumDistance(qr,qh),Cp=[0,0,1,0];o.transformMat4$1(Cp,Cp,Fh),o.normalize$2(Cp,Cp);const xp=o.scale$2([],Cp,nm+Dp),Lp=o.add([],qh.center,xp),dm=(typeof ss.offset.x=="number"&&typeof ss.offset.y=="number"?new o.pointGeometry(ss.offset.x,ss.offset.y):o.pointGeometry.convert(ss.offset)).rotate(-o.degToRad(_e));qh.center[0]-=dm.x*$f,qh.center[1]+=dm.y*$f,o.transformMat4(qh.center,qh.center,Hh),o.transformMat4(Lp,Lp,Hh);const zp=[qh.center[0],qh.center[1],Lp[2]*qr.pixelsPerMeter];o.scale$2(zp,zp,1/qr.worldSize);const km=o.lngFromMercatorX(zp[0]),Am=o.latFromMercatorY(zp[1]),jm=Math.min(qr._zoomFromMercatorZ(zp[2]),ss.maxZoom),zm=new o.LngLat(km,Am);return qr.mercatorFromTransition&&jm<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(qr.setProjection({name:"globe"}),qr.zoom=jm,this._cameraForBounds(qr,E,B,_e,St,mr)):{center:zm,zoom:jm,bearing:_e,pitch:St}}fitBounds(u,E,B){const _e=this.cameraForBounds(u,E);return this._fitInternal(_e,E,B)}fitScreenCoordinates(u,E,B,_e,St){const mr=o.pointGeometry.convert(u),qr=o.pointGeometry.convert(E),ss=new o.pointGeometry(Math.min(mr.x,qr.x),Math.min(mr.y,qr.y)),tl=new o.pointGeometry(Math.max(mr.x,qr.x),Math.max(mr.y,qr.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(mr,qr))return this;const il=this.transform.pointLocation3D(ss),Qu=this.transform.pointLocation3D(tl),fh=this.transform.pointLocation3D(new o.pointGeometry(ss.x,tl.y)),wh=this.transform.pointLocation3D(new o.pointGeometry(tl.x,ss.y)),Sh=[Math.min(il.lng,Qu.lng,fh.lng,wh.lng),Math.min(il.lat,Qu.lat,fh.lat,wh.lat)],Th=[Math.max(il.lng,Qu.lng,fh.lng,wh.lng),Math.max(il.lat,Qu.lat,fh.lat,wh.lat)],Ch=_e&&_e.pitch?_e.pitch:this.getPitch(),hh=this._cameraForBounds(this.transform,Sh,Th,B,Ch,_e);return this._fitInternal(hh,_e,St)}_fitInternal(u,E,B){return u?(delete(E=o.extend(u,E)).padding,E.linear?this.easeTo(E,B):this.flyTo(E,B)):this}jumpTo(u,E){this.stop();const B=u.preloadOnly?this.transform.clone():this.transform;let _e=!1,St=!1,mr=!1;return"zoom"in u&&B.zoom!==+u.zoom&&(_e=!0,B.zoom=+u.zoom),u.center!==void 0&&(B.center=o.LngLat.convert(u.center)),"bearing"in u&&B.bearing!==+u.bearing&&(St=!0,B.bearing=+u.bearing),"pitch"in u&&B.pitch!==+u.pitch&&(mr=!0,B.pitch=+u.pitch),u.padding==null||B.isPaddingEqual(u.padding)||(B.padding=u.padding),u.preloadOnly?(this._preloadTiles(B),this):(this.fire(new o.Event("movestart",E)).fire(new o.Event("move",E)),_e&&this.fire(new o.Event("zoomstart",E)).fire(new o.Event("zoom",E)).fire(new o.Event("zoomend",E)),St&&this.fire(new o.Event("rotatestart",E)).fire(new o.Event("rotate",E)).fire(new o.Event("rotateend",E)),mr&&this.fire(new o.Event("pitchstart",E)).fire(new o.Event("pitch",E)).fire(new o.Event("pitchend",E)),this.fire(new o.Event("moveend",E)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(nt),this.transform.getFreeCameraOptions()}setFreeCameraOptions(u,E){const B=this.transform;if(!B.projection.supportsFreeCamera)return o.warnOnce(nt),this;this.stop();const _e=B.zoom,St=B.pitch,mr=B.bearing;B.setFreeCameraOptions(u);const qr=_e!==B.zoom,ss=St!==B.pitch,tl=mr!==B.bearing;return this.fire(new o.Event("movestart",E)).fire(new o.Event("move",E)),qr&&this.fire(new o.Event("zoomstart",E)).fire(new o.Event("zoom",E)).fire(new o.Event("zoomend",E)),tl&&this.fire(new o.Event("rotatestart",E)).fire(new o.Event("rotate",E)).fire(new o.Event("rotateend",E)),ss&&this.fire(new o.Event("pitchstart",E)).fire(new o.Event("pitch",E)).fire(new o.Event("pitchend",E)),this.fire(new o.Event("moveend",E)),this}easeTo(u,E){this._stop(!1,u.easeId),((u=o.extend({offset:[0,0],duration:500,easing:o.ease},u)).animate===!1||!u.essential&&o.exported.prefersReducedMotion)&&(u.duration=0);const B=this.transform,_e=this.getZoom(),St=this.getBearing(),mr=this.getPitch(),qr=this.getPadding(),ss="zoom"in u?+u.zoom:_e,tl="bearing"in u?this._normalizeBearing(u.bearing,St):St,il="pitch"in u?+u.pitch:mr,Qu="padding"in u?u.padding:B.padding,fh=o.pointGeometry.convert(u.offset);let wh,Sh,Th;if(B.projection.name==="globe"){const xd=o.MercatorCoordinate.fromLngLat(B.center),gd=fh.rotate(-B.angle);xd.x+=gd.x/B.worldSize,xd.y+=gd.y/B.worldSize;const Vf=xd.toLngLat(),_d=o.LngLat.convert(u.center||Vf);this._normalizeCenter(_d),wh=B.centerPoint.add(gd),Sh=new o.pointGeometry(xd.x,xd.y).mult(B.worldSize),Th=new o.pointGeometry(o.mercatorXfromLng(_d.lng),o.mercatorYfromLat(_d.lat)).mult(B.worldSize).sub(Sh)}else{wh=B.centerPoint.add(fh);const xd=B.pointLocation(wh),gd=o.LngLat.convert(u.center||xd);this._normalizeCenter(gd),Sh=B.project(xd),Th=B.project(gd).sub(Sh)}const Ch=B.zoomScale(ss-_e);let hh,Oh;u.around&&(hh=o.LngLat.convert(u.around),Oh=B.locationPoint(hh));const Rh=this._zooming||ss!==_e,Nh=this._rotating||St!==tl,qh=this._pitching||il!==mr,Fh=!B.isPaddingEqual(Qu),Hh=xd=>gd=>{if(Rh&&(xd.zoom=o.number(_e,ss,gd)),Nh&&(xd.bearing=o.number(St,tl,gd)),qh&&(xd.pitch=o.number(mr,il,gd)),Fh&&(xd.interpolatePadding(qr,Qu,gd),wh=xd.centerPoint.add(fh)),hh)xd.setLocationAtPoint(hh,Oh);else{const Vf=xd.zoomScale(xd.zoom-_e),_d=ss>_e?Math.min(2,Ch):Math.max(.5,Ch),Cf=Math.pow(_d,1-gd),Ud=xd.unproject(Sh.add(Th.mult(gd*Cf)).mult(Vf));xd.setLocationAtPoint(xd.renderWorldCopies?Ud.wrap():Ud,wh)}return u.preloadOnly||this._fireMoveEvents(E),xd};if(u.preloadOnly){const xd=this._emulate(Hh,u.duration,B);return this._preloadTiles(xd),this}const ld={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Rh,this._rotating=Nh,this._pitching=qh,this._padding=Fh,this._easeId=u.easeId,this._prepareEase(E,u.noMoveStart,ld),this._ease(Hh(B),xd=>{B.recenterOnTerrain(),this._afterEase(E,xd)},u),this}_prepareEase(u,E,B={}){this._moving=!0,this.transform.cameraElevationReference="sea",E||B.moving||this.fire(new o.Event("movestart",u)),this._zooming&&!B.zooming&&this.fire(new o.Event("zoomstart",u)),this._rotating&&!B.rotating&&this.fire(new o.Event("rotatestart",u)),this._pitching&&!B.pitching&&this.fire(new o.Event("pitchstart",u))}_fireMoveEvents(u){this.fire(new o.Event("move",u)),this._zooming&&this.fire(new o.Event("zoom",u)),this._rotating&&this.fire(new o.Event("rotate",u)),this._pitching&&this.fire(new o.Event("pitch",u))}_afterEase(u,E){if(this._easeId&&E&&this._easeId===E)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const B=this._zooming,_e=this._rotating,St=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,B&&this.fire(new o.Event("zoomend",u)),_e&&this.fire(new o.Event("rotateend",u)),St&&this.fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u))}flyTo(u,E){if(!u.essential&&o.exported.prefersReducedMotion){const yf=o.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yf,E)}this.stop(),u=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},u);const B=this.transform,_e=this.getZoom(),St=this.getBearing(),mr=this.getPitch(),qr=this.getPadding(),ss="zoom"in u?o.clamp(+u.zoom,B.minZoom,B.maxZoom):_e,tl="bearing"in u?this._normalizeBearing(u.bearing,St):St,il="pitch"in u?+u.pitch:mr,Qu="padding"in u?u.padding:B.padding,fh=B.zoomScale(ss-_e),wh=o.pointGeometry.convert(u.offset);let Sh=B.centerPoint.add(wh);const Th=B.pointLocation(Sh),Ch=o.LngLat.convert(u.center||Th);this._normalizeCenter(Ch);const hh=B.project(Th),Oh=B.project(Ch).sub(hh);let Rh=u.curve;const Nh=Math.max(B.width,B.height),qh=Nh/fh,Fh=Oh.mag();if("minZoom"in u){const yf=o.clamp(Math.min(u.minZoom,_e,ss),B.minZoom,B.maxZoom),$f=Nh/B.zoomScale(yf-_e);Rh=Math.sqrt($f/Fh*2)}const Hh=Rh*Rh;function ld(yf){const $f=(qh*qh-Nh*Nh+(yf?-1:1)*Hh*Hh*Fh*Fh)/(2*(yf?qh:Nh)*Hh*Fh);return Math.log(Math.sqrt($f*$f+1)-$f)}function xd(yf){return(Math.exp(yf)-Math.exp(-yf))/2}function gd(yf){return(Math.exp(yf)+Math.exp(-yf))/2}const Vf=ld(0);let _d=function(yf){return gd(Vf)/gd(Vf+Rh*yf)},Cf=function(yf){return Nh*((gd(Vf)*(xd($f=Vf+Rh*yf)/gd($f))-xd(Vf))/Hh)/Fh;var $f},Ud=(ld(1)-Vf)/Rh;if(Math.abs(Fh)<1e-6||!isFinite(Ud)){if(Math.abs(Nh-qh)<1e-6)return this.easeTo(u,E);const yf=qh<Nh?-1:1;Ud=Math.abs(Math.log(qh/Nh))/Rh,Cf=function(){return 0},_d=function($f){return Math.exp(yf*Rh*$f)}}u.duration="duration"in u?+u.duration:1e3*Ud/("screenSpeed"in u?+u.screenSpeed/Rh:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0);const Lf=St!==tl,Cd=il!==mr,pd=!B.isPaddingEqual(Qu),$d=yf=>$f=>{const Dp=$f*Ud,nm=1/_d(Dp);yf.zoom=$f===1?ss:_e+yf.scaleZoom(nm),Lf&&(yf.bearing=o.number(St,tl,$f)),Cd&&(yf.pitch=o.number(mr,il,$f)),pd&&(yf.interpolatePadding(qr,Qu,$f),Sh=yf.centerPoint.add(wh));const Cp=$f===1?Ch:yf.unproject(hh.add(Oh.mult(Cf(Dp))).mult(nm));return yf.setLocationAtPoint(yf.renderWorldCopies?Cp.wrap():Cp,Sh),yf._updateCameraOnTerrain(),u.preloadOnly||this._fireMoveEvents(E),yf};if(u.preloadOnly){const yf=this._emulate($d,u.duration,B);return this._preloadTiles(yf),this}return this._zooming=!0,this._rotating=Lf,this._pitching=Cd,this._padding=pd,this._prepareEase(E,!1),this._ease($d(B),()=>this._afterEase(E),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,E){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const B=this._onEaseEnd;this._onEaseEnd=void 0,B.call(this,E)}if(!u){const B=this.handlers;B&&B.stop(!1)}return this}_ease(u,E,B){B.animate===!1||B.duration===0?(u(1),E()):(this._easeStart=o.exported.now(),this._easeOptions=B,this._onEaseFrame=u,this._onEaseEnd=E,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const u=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),E=this._onEaseFrame;E&&E(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(u,E){u=o.wrap(u,-180,180);const B=Math.abs(u-E);return Math.abs(u-360-E)<B&&(u-=360),Math.abs(u+360-E)<B&&(u+=360),u}_normalizeCenter(u){const E=this.transform;if(!E.renderWorldCopies||E.maxBounds)return;const B=u.lng-E.center.lng;u.lng+=B>180?-360:B<-180?360:0}_emulate(u,E,B){const _e=Math.ceil(15*E/1e3),St=[],mr=u(B.clone());for(let qr=0;qr<=_e;qr++){const ss=mr(qr/_e);St.push(ss.clone())}return St}}class Xr{constructor(u={}){this.options=u,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(u){const E=this.options&&this.options.compact;return this._map=u,this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ze("button","mapboxgl-ctrl-attrib-button",this._container),ze("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ze("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),E&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),E===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(u,E){const B=this._map._getUIString(`AttributionControl.${E}`);u.setAttribute("aria-label",B),u.removeAttribute("title"),u.firstElementChild&&u.firstElementChild.setAttribute("title",B)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));const E=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(u){const B=E.reduce((_e,St,mr)=>(St.value&&(_e+=`${St.key}=${St.value}${mr<E.length-1?"&":""}`),_e),"?");u.href=`${o.config.FEEDBACK_URL}/${B}#${L_(this._map,!0)}`,u.rel="noopener nofollow",this._setElementTitle(u,"MapFeedback")}}_updateData(u){!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let u=[];if(this._map.style.stylesheet){const _e=this._map.style.stylesheet;this.styleOwner=_e.owner,this.styleId=_e.id}const E=this._map.style._sourceCaches;for(const _e in E){const St=E[_e];if(St.used){const mr=St.getSource();mr.attribution&&u.indexOf(mr.attribution)<0&&u.push(mr.attribution)}}u.sort((_e,St)=>_e.length-St.length),u=u.filter((_e,St)=>{for(let mr=St+1;mr<u.length;mr++)if(u[mr].indexOf(_e)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=[...this.options.customAttribution,...u]:u.unshift(this.options.customAttribution));const B=u.join(" | ");B!==this._attribHTML&&(this._attribHTML=B,u.length?(this._innerContainer.innerHTML=B,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ls{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(u){this._map=u,this._container=ze("div","mapboxgl-ctrl");const E=ze("a","mapboxgl-ctrl-logo");return E.target="_blank",E.rel="noopener nofollow",E.href="https://www.mapbox.com/",E.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),E.setAttribute("rel","noopener nofollow"),this._container.appendChild(E),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const u=this._map.style._sourceCaches;if(Object.entries(u).length===0)return!0;for(const E in u){const B=u[E].getSource();if(B.hasOwnProperty("mapbox_logo")&&!B.mapbox_logo)return!1}return!0}_updateCompact(){const u=this._container.children;if(u.length){const E=u[0];this._map.getCanvasContainer().offsetWidth<250?E.classList.add("mapboxgl-compact"):E.classList.remove("mapboxgl-compact")}}}class Zs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const E=++this._id;return this._queue.push({callback:u,id:E,cancelled:!1}),E}remove(u){const E=this._currentlyRunning,B=E?this._queue.concat(E):this._queue;for(const _e of B)if(_e.id===u)return void(_e.cancelled=!0)}run(u=0){const E=this._currentlyRunning=this._queue;this._queue=[];for(const B of E)if(!B.cancelled&&(B.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ol(L,u,E){if(L=new o.LngLat(L.lng,L.lat),u){const B=new o.LngLat(L.lng-360,L.lat),_e=new o.LngLat(L.lng+360,L.lat),St=360*Math.ceil(Math.abs(L.lng-E.center.lng)/360),mr=E.locationPoint(L).distSqr(u),qr=u.x<0||u.y<0||u.x>E.width||u.y>E.height;E.locationPoint(B).distSqr(u)<mr&&(qr||Math.abs(B.lng-E.center.lng)<St)?L=B:E.locationPoint(_e).distSqr(u)<mr&&(qr||Math.abs(_e.lng-E.center.lng)<St)&&(L=_e)}for(;Math.abs(L.lng-E.center.lng)>180;){const B=E.locationPoint(L);if(B.x>=0&&B.y>=0&&B.x<=E.width&&B.y<=E.height)break;L.lng>E.center.lng?L.lng-=360:L.lng+=360}return L}const rh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class th extends o.Evented{constructor(u,E){if(super(),(u instanceof o.window.HTMLElement||E)&&(u=o.extend({element:u},E)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=u&&u.occludedOpacity||.2,u&&u.element)this._element=u.element,this._offset=o.pointGeometry.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=ze("div");const _e=41,St=27,mr=ge("svg",{display:"block",height:_e*this._scale+"px",width:St*this._scale+"px",viewBox:`0 0 ${St} ${_e}`},this._element),qr=ge("radialGradient",{id:"shadowGradient"},ge("defs",{},mr));ge("stop",{offset:"10%","stop-opacity":.4},qr),ge("stop",{offset:"100%","stop-opacity":.05},qr),ge("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},mr),ge("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},mr),ge("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},mr),ge("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},mr),this._offset=o.pointGeometry.convert(u&&u.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_e=>{_e.preventDefault()}),this._element.addEventListener("mousedown",_e=>{_e.preventDefault()});const B=this._element.classList;for(const _e in rh)B.remove(`mapboxgl-marker-anchor-${_e}`);B.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(u){return u===this._map||(this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._updateMoving),u.on("moveend",this._update),u.on("remove",this._clearFadeTimer),u._addMarker(this),this.setDraggable(this._draggable),this._update(),u.on("click",this._onMapClick)),this}remove(){const u=this._map;return u&&(u.off("click",this._onMapClick),u.off("move",this._updateMoving),u.off("moveend",this._update),u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler),u.off("mouseup",this._onUp),u.off("touchend",this._onUp),u.off("mousemove",this._onMove),u.off("touchmove",this._onMove),u.off("remove",this._clearFadeTimer),u._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const _e=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_e,-1*(38.1-13.5+_e)],"bottom-right":[-_e,-1*(38.1-13.5+_e)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,u._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(u){const E=u.code,B=u.charCode||u.keyCode;E!=="Space"&&E!=="Enter"&&B!==32&&B!==13||this.togglePopup()}_onMapClick(u){const E=u.originalEvent.target,B=this._element;this._popup&&(E===B||B.contains(E))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const u=this._popup;return u?(u.isOpen()?(u.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(u.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const u=this._map,E=this._pos;if(!u||!E)return!1;const B=u.unproject(E),_e=u.getFreeCameraOptions();if(!_e.position)return!1;const St=_e.position.toLngLat();return St.distanceTo(B)<.9*St.distanceTo(this._lngLat)}_evaluateOpacity(){const u=this._map;if(!u)return;const E=this._pos;if(!E||E.x<0||E.x>u.transform.width||E.y<0||E.y>u.transform.height)return void this._clearFadeTimer();const B=u.unproject(E);let _e;u._showingGlobe()&&o.isLngLatBehindGlobe(u.transform,this._lngLat)?_e=0:(_e=1-u._queryFogOpacity(B),u.transform._terrainEnabled()&&u.getTerrain()&&this._behindTerrain()&&(_e*=this._occludedOpacity)),this._element.style.opacity=`${_e}`,this._element.style.pointerEvents=_e>0?"auto":"none",this._popup&&this._popup._setOpacity(_e),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const u=this._pos;if(!u||!this._map)return;const E=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${u.x}px,${u.y}px)
            ${rh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${E.x}px,${E.y}px)
        `}_calculateXYTransform(){const u=this._pos,E=this._map,B=this.getPitchAlignment();if(!E||!u||B!=="map")return"";if(!E._showingGlobe()){const ss=E.getPitch();return ss?`rotateX(${ss}deg)`:""}const _e=o.radToDeg(o.globeTiltAtLngLat(E.transform,this._lngLat)),St=u.sub(o.globeCenterToScreenPoint(E.transform)),mr=Math.abs(St.x)+Math.abs(St.y);if(mr===0)return"";const qr=_e/mr;return`rotateX(${-St.y*qr}deg) rotateY(${St.x*qr}deg)`}_calculateZTransform(){const u=this._pos,E=this._map;if(!E||!u)return"";let B=0;const _e=this.getRotationAlignment();if(_e==="map")if(E._showingGlobe()){const St=E.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),mr=E.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(St);B=o.radToDeg(Math.atan2(mr.y,mr.x))-90}else B=-E.getBearing();else if(_e==="horizon"){const St=o.smoothstep(4,6,E.getZoom()),mr=o.globeCenterToScreenPoint(E.transform);mr.y+=St*E.transform.height;const qr=u.sub(mr),ss=o.radToDeg(Math.atan2(qr.y,qr.x));B=(ss>90?ss-270:ss+90)*(1-St)}return B+=this._rotation,B?`rotateZ(${B}deg)`:""}_update(u){o.window.cancelAnimationFrame(this._updateFrameId);const E=this._map;E&&(E.transform.renderWorldCopies&&(this._lngLat=ol(this._lngLat,this._pos,E.transform)),this._pos=E.project(this._lngLat),u===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),E._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(E._showingGlobe()||E.getTerrain()||E.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(u){return this._offset=o.pointGeometry.convert(u),this._update(),this}_onMove(u){const E=this._map;if(!E)return;const B=this._pointerdownPos,_e=this._positionDelta;if(B&&_e){if(!this._isDragging){const St=this._clickTolerance||E._clickTolerance;if(u.point.dist(B)<St)return;this._isDragging=!0}this._pos=u.point.sub(_e),this._lngLat=E.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const u=this._map;u&&(u.off("mousemove",this._onMove),u.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(u){const E=this._map,B=this._pos;E&&B&&this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(B),this._pointerdownPos=u.point,this._state="pending",E.on("mousemove",this._onMove),E.on("touchmove",this._onMove),E.once("mouseup",this._onUp),E.once("touchend",this._onUp))}setDraggable(u){this._draggable=!!u;const E=this._map;return E&&(u?(E.on("mousedown",this._addDragHandler),E.on("touchstart",this._addDragHandler)):(E.off("mousedown",this._addDragHandler),E.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(u){return this._occludedOpacity=u||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ph={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Dh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $h(L=new o.pointGeometry(0,0),u="bottom"){if(typeof L=="number"){const E=Math.round(Math.sqrt(.5*Math.pow(L,2)));switch(u){case"top":return new o.pointGeometry(0,L);case"top-left":return new o.pointGeometry(E,E);case"top-right":return new o.pointGeometry(-E,E);case"bottom":return new o.pointGeometry(0,-L);case"bottom-left":return new o.pointGeometry(E,-E);case"bottom-right":return new o.pointGeometry(-E,-E);case"left":return new o.pointGeometry(L,0);case"right":return new o.pointGeometry(-L,0)}return new o.pointGeometry(0,0)}return L instanceof o.pointGeometry||Array.isArray(L)?o.pointGeometry.convert(L):o.pointGeometry.convert(L[u]||[0,0])}class Mh{constructor(u){this.jumpTo(u)}getValue(u){if(u<=this._startTime)return this._start;if(u>=this._endTime)return this._end;const E=o.easeCubicInOut((u-this._startTime)/(this._endTime-this._startTime));return this._start*(1-E)+this._end*E}isEasing(u){return u>=this._startTime&&u<=this._endTime}jumpTo(u){this._startTime=-1/0,this._endTime=-1/0,this._start=u,this._end=u}easeTo(u,E,B){this._start=this.getValue(E),this._end=u,this._startTime=E,this._endTime=E+B}}const Kh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},cd={showCompass:!0,showZoom:!0,visualizePitch:!1};class jh{constructor(u,E,B=!1){this._clickTolerance=10,this.element=E,this.mouseRotate=new Ey({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,B&&(this.mousePitch=new lv({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),E.addEventListener("mousedown",this.mousedown),E.addEventListener("touchstart",this.touchstart,{passive:!1}),E.addEventListener("touchmove",this.touchmove),E.addEventListener("touchend",this.touchend),E.addEventListener("touchcancel",this.reset)}down(u,E){this.mouseRotate.mousedown(u,E),this.mousePitch&&this.mousePitch.mousedown(u,E),Io()}move(u,E){const B=this.map,_e=this.mouseRotate.mousemoveWindow(u,E),St=_e&&_e.bearingDelta;if(St&&B.setBearing(B.getBearing()+St),this.mousePitch){const mr=this.mousePitch.mousemoveWindow(u,E),qr=mr&&mr.pitchDelta;qr&&B.setPitch(B.getPitch()+qr)}}off(){const u=this.element;u.removeEventListener("mousedown",this.mousedown),u.removeEventListener("touchstart",this.touchstart,{passive:!1}),u.removeEventListener("touchmove",this.touchmove),u.removeEventListener("touchend",this.touchend),u.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){rl(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(u){this.down(o.extend({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),$s(this.element,u)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(u){this.move(u,$s(this.element,u))}mouseup(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()}touchstart(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ah(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>u.preventDefault()},this._startPos))}touchmove(u){u.targetTouches.length!==1?this.reset():(this._lastPos=ah(this.element,u.targetTouches)[0],this.move({preventDefault:()=>u.preventDefault()},this._lastPos))}touchend(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Td={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vd={maxWidth:100,unit:"metric"};function Wd(L,u,E){const B=Mf(u),_e=B/u,St={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[E];this._map._requestDomTask(()=>{this._container.style.width=L*_e+"px",this._container.innerHTML=`${B}&nbsp;${St}`})}function Mf(L){const u=Math.pow(10,`${Math.floor(L)}`.length-1);let E=L/u;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(B){const _e=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*_e)/_e}(E),u*E}const Of={version:o.version,supported:C,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Ft{constructor(L){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(L=o.extend({},fd,L)).minZoom!=null&&L.maxZoom!=null&&L.minZoom>L.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(L.minPitch!=null&&L.maxPitch!=null&&L.minPitch>L.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(L.minPitch!=null&&L.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(L.maxPitch!=null&&L.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(L.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(L.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pp(L.minZoom,L.maxZoom,L.minPitch,L.maxPitch,L.renderWorldCopies),L),this._interactive=L.interactive,this._minTileCacheSize=L.minTileCacheSize,this._maxTileCacheSize=L.maxTileCacheSize,this._failIfMajorPerformanceCaveat=L.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=L.preserveDrawingBuffer,this._antialias=L.antialias,this._useWebGL2=L.useWebGL2,this._trackResize=L.trackResize,this._bearingSnap=L.bearingSnap,this._refreshExpiredTiles=L.refreshExpiredTiles,this._fadeDuration=L.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=L.crossSourceCollisions,this._collectResourceTiming=L.collectResourceTiming,this._optimizeForTerrain=L.optimizeForTerrain,this._language=this._parseLanguage(L.language),this._worldview=L.worldview,this._renderTaskQueue=new Zs,this._domRenderTaskQueue=new Zs,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Kh,L.locale),this._clickTolerance=L.clickTolerance,this._cooperativeGestures=L.cooperativeGestures,this._performanceMetricsCollection=L.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Mh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(L.transformRequest,L.accessToken,L.testMode),this._silenceAuthErrors=!!L.testMode,typeof L.container=="string"){if(this._container=o.window.document.getElementById(L.container),!this._container)throw new Error(`Container '${L.container}' not found.`)}else{if(!(L.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=L.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),L.maxBounds&&this.setMaxBounds(L.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new q(this,L),this._localFontFamily=L.localFontFamily,this._localIdeographFontFamily=L.localIdeographFontFamily,L.style&&this.setStyle(L.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),L.projection&&this.setProjection(L.projection),this._hash=L.hash&&new wv(typeof L.hash=="string"&&L.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:L.center,zoom:L.zoom,bearing:L.bearing,pitch:L.pitch}),L.bounds&&(this.resize(),this.fitBounds(L.bounds,o.extend({},L.fitBoundsOptions,{duration:0})))),this.resize(),L.attributionControl&&this.addControl(new Xr({customAttribution:L.customAttribution})),this._logoControl=new ls,this.addControl(this._logoControl,L.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.Event(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(L,u){if(u===void 0&&(u=L.getDefaultPosition?L.getDefaultPosition():"top-right"),!L||!L.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const E=L.onAdd(this);this._controls.push(L);const B=this._controlPositions[u];return u.indexOf("bottom")!==-1?B.insertBefore(E,B.firstChild):B.appendChild(E),this}removeControl(L){if(!L||!L.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(L);return u>-1&&this._controls.splice(u,1),L.onRemove(this),this}hasControl(L){return this._controls.indexOf(L)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(L){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const u=!this._moving;return u&&this.fire(new o.Event("movestart",L)).fire(new o.Event("move",L)),this.fire(new o.Event("resize",L)),u&&this.fire(new o.Event("moveend",L)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(L){return this.transform.setMaxBounds(o.LngLatBounds.convert(L)),this._update()}setMinZoom(L){if((L=L??-2)>=-2&&L<=this.transform.maxZoom)return this.transform.minZoom=L,this._update(),this.getZoom()<L?this.setZoom(L):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(L){if((L=L??22)>=this.transform.minZoom)return this.transform.maxZoom=L,this._update(),this.getZoom()>L?this.setZoom(L):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(L){if((L=L??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(L>=0&&L<=this.transform.maxPitch)return this.transform.minPitch=L,this._update(),this.getPitch()<L?this.setPitch(L):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(L){if((L=L??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(L>=this.transform.minPitch)return this.transform.maxPitch=L,this._update(),this.getPitch()>L?this.setPitch(L):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(L){return this.transform.renderWorldCopies=L,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(L){return L==="auto"?o.window.navigator.language:Array.isArray(L)?L.length===0?void 0:L.map(u=>u==="auto"?o.window.navigator.language:u):L}setLanguage(L){const u=this._parseLanguage(L);if(!this.style||u===this._language)return this;this._language=u,this.style._reloadSources();for(const E of this._controls)E._setLanguage&&E._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(L){return this.style&&L!==this._worldview?(this._worldview=L,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(L){return this._lazyInitEmptyStyle(),L?typeof L=="string"&&(L={name:L}):L=null,this._useExplicitProjection=!!L,this._prioritizeAndUpdateProjection(L,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const L=this.transform,u=L.projection.name;let E;u==="globe"&&L.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(L.setMercatorFromTransition(),E=!0):u==="mercator"&&L.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(L.setProjection({name:"globe"}),E=!0),E&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(L,u){return this._updateProjection(L||u||{name:"mercator"})}_updateProjection(L){let u;if(u=L.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(L),this.style.applyProjectionUpdate(),u){this.painter.clearBackgroundTiles();for(const E in this.style._sourceCaches)this.style._sourceCaches[E].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(L){return this.transform.locationPoint3D(o.LngLat.convert(L))}unproject(L){return this.transform.pointLocation3D(o.pointGeometry.convert(L))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(L,u,E){if(L==="mouseenter"||L==="mouseover"){let B=!1;const _e=mr=>{const qr=u.filter(tl=>this.getLayer(tl)),ss=qr.length?this.queryRenderedFeatures(mr.point,{layers:qr}):[];ss.length?B||(B=!0,E.call(this,new Lg(L,this,mr.originalEvent,{features:ss}))):B=!1},St=()=>{B=!1};return{layers:new Set(u),listener:E,delegates:{mousemove:_e,mouseout:St}}}if(L==="mouseleave"||L==="mouseout"){let B=!1;const _e=mr=>{const qr=u.filter(ss=>this.getLayer(ss));(qr.length?this.queryRenderedFeatures(mr.point,{layers:qr}):[]).length?B=!0:B&&(B=!1,E.call(this,new Lg(L,this,mr.originalEvent)))},St=mr=>{B&&(B=!1,E.call(this,new Lg(L,this,mr.originalEvent)))};return{layers:new Set(u),listener:E,delegates:{mousemove:_e,mouseout:St}}}{const B=_e=>{const St=u.filter(qr=>this.getLayer(qr)),mr=St.length?this.queryRenderedFeatures(_e.point,{layers:St}):[];mr.length&&(_e.features=mr,E.call(this,_e),delete _e.features)};return{layers:new Set(u),listener:E,delegates:{[L]:B}}}}on(L,u,E){if(E===void 0)return super.on(L,u);Array.isArray(u)||(u=[u]);const B=this._createDelegatedListener(L,u,E);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[L]=this._delegatedListeners[L]||[],this._delegatedListeners[L].push(B);for(const _e in B.delegates)this.on(_e,B.delegates[_e]);return this}once(L,u,E){if(E===void 0)return super.once(L,u);Array.isArray(u)||(u=[u]);const B=this._createDelegatedListener(L,u,E);for(const _e in B.delegates)this.once(_e,B.delegates[_e]);return this}off(L,u,E){if(E===void 0)return super.off(L,u);u=new Set(Array.isArray(u)?u:[u]);const B=(St,mr)=>{if(St.size!==mr.size)return!1;for(const qr of St)if(!mr.has(qr))return!1;return!0},_e=this._delegatedListeners?this._delegatedListeners[L]:void 0;return _e&&(St=>{for(let mr=0;mr<St.length;mr++){const qr=St[mr];if(qr.listener===E&&B(qr.layers,u)){for(const ss in qr.delegates)this.off(ss,qr.delegates[ss]);return St.splice(mr,1),this}}})(_e),this}queryRenderedFeatures(L,u){return this.style?(u!==void 0||L===void 0||L instanceof o.pointGeometry||Array.isArray(L)||(u=L,L=void 0),this.style.queryRenderedFeatures(L=L||[[0,0],[this.transform.width,this.transform.height]],u=u||{},this.transform)):[]}querySourceFeatures(L,u){return this.style.querySourceFeatures(L,u)}setStyle(L,u){return(u=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},u)).diff!==!1&&u.localIdeographFontFamily===this._localIdeographFontFamily&&u.localFontFamily===this._localFontFamily&&this.style&&L?(this._diffStyle(L,u),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._localFontFamily=u.localFontFamily,this._updateStyle(L,u))}_getUIString(L){const u=this._locale[L];if(u==null)throw new Error(`Missing UI string '${L}'`);return u}_updateStyle(L,u){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),L&&(this.style=new eg(this,u||{}),this.style.setEventedParent(this,{style:this.style}),typeof L=="string"?this.style.loadURL(L):this.style.loadJSON(L)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new eg(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(L,u){if(typeof L=="string"){const E=this._requestManager.normalizeStyleURL(L),B=this._requestManager.transformRequest(E,o.ResourceType.Style);o.getJSON(B,(_e,St)=>{_e?this.fire(new o.ErrorEvent(_e)):St&&this._updateDiff(St,u)})}else typeof L=="object"&&this._updateDiff(L,u)}_updateDiff(L,u){try{this.style.setState(L)&&this._update(!0)}catch(E){o.warnOnce(`Unable to perform style diff: ${E.message||E.error||E}.  Rebuilding the style from scratch.`),this._updateStyle(L,u)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(L,u){return this._lazyInitEmptyStyle(),this.style.addSource(L,u),this._update(!0)}isSourceLoaded(L){return!!this.style&&this.style._isSourceCacheLoaded(L)}areTilesLoaded(){const L=this.style&&this.style._sourceCaches;for(const u in L){const E=L[u]._tiles;for(const B in E){const _e=E[B];if(_e.state!=="loaded"&&_e.state!=="errored")return!1}}return!0}addSourceType(L,u,E){this._lazyInitEmptyStyle(),this.style.addSourceType(L,u,E)}removeSource(L){return this.style.removeSource(L),this._updateTerrain(),this._update(!0)}getSource(L){return this.style.getSource(L)}addImage(L,u,{pixelRatio:E=1,sdf:B=!1,stretchX:_e,stretchY:St,content:mr}={}){if(this._lazyInitEmptyStyle(),u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap){const{width:qr,height:ss,data:tl}=o.exported.getImageData(u);this.style.addImage(L,{data:new o.RGBAImage({width:qr,height:ss},tl),pixelRatio:E,stretchX:_e,stretchY:St,content:mr,sdf:B,version:0})}else if(u.width===void 0||u.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:qr,height:ss}=u,tl=u;this.style.addImage(L,{data:new o.RGBAImage({width:qr,height:ss},new Uint8Array(tl.data)),pixelRatio:E,stretchX:_e,stretchY:St,content:mr,sdf:B,version:0,userImage:tl}),tl.onAdd&&tl.onAdd(this,L)}}updateImage(L,u){const E=this.style.getImage(L);if(!E)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const B=u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap?o.exported.getImageData(u):u,{width:_e,height:St}=B;_e!==void 0&&St!==void 0?_e===E.data.width&&St===E.data.height?(E.data.replace(B.data,!(u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap)),this.style.updateImage(L,E)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${_e}, ${St})
                must be that same as the previous version of the image
                (${E.data.width}, ${E.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(L){return L?!!this.style.getImage(L):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(L){this.style.removeImage(L)}loadImage(L,u){o.getImage(this._requestManager.transformRequest(L,o.ResourceType.Image),(E,B)=>{u(E,B instanceof o.window.HTMLImageElement?o.exported.getImageData(B):B)})}listImages(){return this.style.listImages()}addLayer(L,u){return this._lazyInitEmptyStyle(),this.style.addLayer(L,u),this._update(!0)}moveLayer(L,u){return this.style.moveLayer(L,u),this._update(!0)}removeLayer(L){return this.style.removeLayer(L),this._update(!0)}getLayer(L){return this.style.getLayer(L)}setLayerZoomRange(L,u,E){return this.style.setLayerZoomRange(L,u,E),this._update(!0)}setFilter(L,u,E={}){return this.style.setFilter(L,u,E),this._update(!0)}getFilter(L){return this.style.getFilter(L)}setPaintProperty(L,u,E,B={}){return this.style.setPaintProperty(L,u,E,B),this._update(!0)}getPaintProperty(L,u){return this.style.getPaintProperty(L,u)}setLayoutProperty(L,u,E,B={}){return this.style.setLayoutProperty(L,u,E,B),this._update(!0)}getLayoutProperty(L,u){return this.style.getLayoutProperty(L,u)}setLight(L,u={}){return this._lazyInitEmptyStyle(),this.style.setLight(L,u),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(L){return this._lazyInitEmptyStyle(),!L&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(L),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(L){return this._lazyInitEmptyStyle(),this.style.setFog(L),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(L){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(L),this.transform):0}setFeatureState(L,u){return this.style.setFeatureState(L,u),this._update()}removeFeatureState(L,u){return this.style.removeFeatureState(L,u),this._update()}getFeatureState(L){return this.style.getFeatureState(L)}_updateContainerDimensions(){if(!this._container)return;const L=this._container.getBoundingClientRect().width||400,u=this._container.getBoundingClientRect().height||300;let E,B,_e,St=this._container;for(;St&&(!B||!_e);){const mr=o.window.getComputedStyle(St).transform;mr&&mr!=="none"&&(E=mr.match(/matrix.*\((.+)\)/)[1].split(", "),E[0]&&E[0]!=="0"&&E[0]!=="1"&&(B=E[0]),E[3]&&E[3]!=="0"&&E[3]!=="1"&&(_e=E[3])),St=St.parentElement}this._containerWidth=B?Math.abs(L/B):L,this._containerHeight=_e?Math.abs(u/_e):u}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const L=this._container;L.classList.add("mapboxgl-map"),(this._missingCSSCanary=ze("div","mapboxgl-canary",L)).style.visibility="hidden",this._detectMissingCSS();const u=this._canvasContainer=ze("div","mapboxgl-canvas-container",L);this._interactive&&u.classList.add("mapboxgl-interactive"),this._canvas=ze("canvas","mapboxgl-canvas",u),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const E=this._controlContainer=ze("div","mapboxgl-control-container",L),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_e=>{B[_e]=ze("div",`mapboxgl-ctrl-${_e}`,E)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(L,u){const E=o.exported.devicePixelRatio||1;this._canvas.width=E*Math.ceil(L),this._canvas.height=E*Math.ceil(u),this._canvas.style.width=`${L}px`,this._canvas.style.height=`${u}px`}_addMarker(L){this._markers.push(L)}_removeMarker(L){const u=this._markers.indexOf(L);u!==-1&&this._markers.splice(u,1)}_addPopup(L){this._popups.push(L)}_removePopup(L){const u=this._popups.indexOf(L);u!==-1&&this._popups.splice(u,1)}_setupPainter(){const L=o.extend({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),u=this._useWebGL2&&this._canvas.getContext("webgl2",L),E=u||this._canvas.getContext("webgl",L)||this._canvas.getContext("experimental-webgl",L);E?(this._useWebGL2&&!u&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(E,!0),this.painter=new Cm(E,this.transform,!!u),this.on("data",B=>{B.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(E)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(L){L.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:L}))}_contextRestored(L){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:L}))}_onMapScroll(L){if(L.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(L){return this.style?(this._styleDirty=this._styleDirty||L,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(L){return this._update(),this._renderTaskQueue.add(L)}_cancelRenderFrame(L){this._renderTaskQueue.remove(L)}_requestDomTask(L){!this.loaded()||this.loaded()&&!this.isMoving()?L():this._domRenderTaskQueue.add(L)}_render(L){let u;const E=this.painter.context.extTimerQuery,B=o.exported.now();if(this.listens("gpu-timing-frame")&&(u=E.createQueryEXT(),E.beginQueryEXT(E.TIME_ELAPSED_EXT,u)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(L),this._domRenderTaskQueue.run(L),this._removed)return;this._updateProjectionTransition();const _e=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const qr=this.transform.zoom,ss=this.transform.pitch,tl=o.exported.now(),il=new o.EvaluationParameters(qr,{now:tl,fadeDuration:_e,pitch:ss,transition:this.style.getTransition()});this.style.update(il)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let St=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),St=this._updateAverageElevation(B),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):St=this._updateAverageElevation(B),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_e,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_e,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),u){const qr=o.exported.now()-B;E.endQueryEXT(E.TIME_ELAPSED_EXT,u),setTimeout(()=>{const ss=E.getQueryObjectEXT(u,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(u),this.fire(new o.Event("gpu-timing-frame",{cpuTime:qr,gpuTime:ss})),o.window.performance.mark("frame-gpu",{startTime:B,detail:{gpuTime:ss}})},50)}if(this.listens("gpu-timing-layer")){const qr=this.painter.collectGpuTimers();setTimeout(()=>{const ss=this.painter.queryGpuTimers(qr);this.fire(new o.Event("gpu-timing-layer",{layerTimes:ss}))},50)}if(this.listens("gpu-timing-deferred-render")){const qr=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const ss=this.painter.queryGpuTimeDeferredRender(qr);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:ss}))},50)}const mr=this._sourcesDirty||this._styleDirty||this._placementDirty||St;if(mr||this._repaint)this.triggerRepaint();else{const qr=!this.isMoving()&&this.loaded();if(qr&&(St=this._updateAverageElevation(B,!0)),St)this.triggerRepaint();else if(this._triggerFrame(!1),qr&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ss=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:ss})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||mr||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(L){for(const u of this._markers)L&&!this.getRenderWorldCopies()&&(u._lngLat=u._lngLat.wrap()),u._update();for(const u of this._popups)!L||this.getRenderWorldCopies()||u._trackPointer||(u._lngLat=u._lngLat.wrap()),u._update()}_updateAverageElevation(L,u=!1){const E=B=>(this.transform.averageElevation=B,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&E(0);if((u||L-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(L)){const B=this.transform.averageElevation;let _e=this.transform.sampleAverageElevation(),St=!1;this.transform.elevation&&(St=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_e)?_e=0:this._averageElevationLastSampledAt=L;const mr=Math.abs(B-_e);if(mr>1){if(this._isInitialLoad||St)return this._averageElevation.jumpTo(_e),E(_e);this._averageElevation.easeTo(_e,L,300)}else if(mr>1e-4)return this._averageElevation.jumpTo(_e),E(_e)}return!!this._averageElevation.isEasing(L)&&E(this._averageElevation.getValue(L))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,L=>{if(L&&(L.message===o.AUTH_ERR_MSG||L.status===401)){const u=this.painter.context.gl;o.storeAuthState(u,!1),this._logoControl instanceof ls&&this._logoControl._updateLogo(),u&&u.clear(u.DEPTH_BUFFER_BIT|u.COLOR_BUFFER_BIT|u.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const L=this._isDragging();this.painter.updateTerrain(this.style,L)}_calculateSpeedIndex(){const L=this.painter.canvasCopy(),u=this.painter.getCanvasCopiesAndTimestamps();u.timeStamps.push(performance.now());const E=this.painter.context.gl,B=E.createFramebuffer();function _e(St){E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,St,0);const mr=new Uint8Array(E.drawingBufferWidth*E.drawingBufferHeight*4);return E.readPixels(0,0,E.drawingBufferWidth,E.drawingBufferHeight,E.RGBA,E.UNSIGNED_BYTE,mr),mr}return E.bindFramebuffer(E.FRAMEBUFFER,B),this._canvasPixelComparison(_e(L),u.canvasCopies.map(_e),u.timeStamps)}_canvasPixelComparison(L,u,E){let B=E[1]-E[0];const _e=L.length/4;for(let St=0;St<u.length;St++){const mr=u[St];let qr=0;for(let ss=0;ss<mr.length;ss+=4)mr[ss]===L[ss]&&mr[ss+1]===L[ss+1]&&mr[ss+2]===L[ss+2]&&mr[ss+3]===L[ss+3]&&(qr+=1);B+=(E[St+2]-E[St+1])*(1-qr/_e)}return B}remove(){this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const L=this.painter.context.gl.getExtension("WEBGL_lose_context");L&&L.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(L){this._renderNextFrame=this._renderNextFrame||L,this.style&&!this._frame&&(this._frame=o.exported.frame(u=>{const E=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,E&&this._render(u)}))}_preloadTiles(L){const u=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(u,(E,B)=>E._preloadTiles(L,B),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(L){this._trackResize&&this.resize({originalEvent:L})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(L){this._showTileBoundaries!==L&&(this._showTileBoundaries=L,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(L){this._showTerrainWireframe!==L&&(this._showTerrainWireframe=L,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(L){this._speedIndexTiming!==L&&(this._speedIndexTiming=L,this._update())}get showPadding(){return!!this._showPadding}set showPadding(L){this._showPadding!==L&&(this._showPadding=L,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(L){this._showCollisionBoxes!==L&&(this._showCollisionBoxes=L,L?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(L){this._showOverdrawInspector!==L&&(this._showOverdrawInspector=L,this._update())}get repaint(){return!!this._repaint}set repaint(L){this._repaint!==L&&(this._repaint=L,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(L){this._vertices=L,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(L){this._showTileAABBs!==L&&(this._showTileAABBs=L,L&&this._update())}_setCacheLimits(L,u){o.setCacheLimits(L,u)}get version(){return o.version}},NavigationControl:class{constructor(L){this.options=o.extend({},cd,L),this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",u=>{this._map&&this._map.zoomIn({},{originalEvent:u})}),ze("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",u=>{this._map&&this._map.zoomOut({},{originalEvent:u})}),ze("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",u=>{const E=this._map;E&&(this.options.visualizePitch?E.resetNorthPitch({},{originalEvent:u}):E.resetNorth({},{originalEvent:u}))}),this._compassIcon=ze("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const L=this._map;if(!L)return;const u=L.getZoom(),E=u===L.getMaxZoom(),B=u===L.getMinZoom();this._zoomInButton.disabled=E,this._zoomOutButton.disabled=B,this._zoomInButton.setAttribute("aria-disabled",E.toString()),this._zoomOutButton.setAttribute("aria-disabled",B.toString())}_rotateCompassArrow(){const L=this._map;if(!L)return;const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(L.transform.pitch*(Math.PI/180)),.5)}) rotateX(${L.transform.pitch}deg) rotateZ(${L.transform.angle*(180/Math.PI)}deg)`:`rotate(${L.transform.angle*(180/Math.PI)}deg)`;L._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(L){return this._map=L,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),L.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&L.on("pitch",this._rotateCompassArrow),L.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jh(L,this._compass,this.options.visualizePitch)),this._container}onRemove(){const L=this._map;L&&(this._container.remove(),this.options.showZoom&&L.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&L.off("pitch",this._rotateCompassArrow),L.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(L,u){const E=ze("button",L,this._container);return E.type="button",E.addEventListener("click",u),E}_setButtonTitle(L,u){if(!this._map)return;const E=this._map._getUIString(`NavigationControl.${u}`);L.setAttribute("aria-label",E),L.firstElementChild&&L.firstElementChild.setAttribute("title",E)}},GeolocateControl:class extends o.Evented{constructor(L){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Td,L),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=tg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(L){return this._map=L,this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(L){const u=(E=!!this.options.geolocation)=>{this._supportsGeolocation=E,L(E)};this._supportsGeolocation!==void 0?L(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(E=>u(E.state!=="denied")).catch(()=>u()):u()}_isOutOfMapMaxBounds(L){const u=this._map.getMaxBounds(),E=L.coords;return!!u&&(E.longitude<u.getWest()||E.longitude>u.getEast()||E.latitude<u.getSouth()||E.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(L){if(this._map){if(this._isOutOfMapMaxBounds(L))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",L)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=L,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(L),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(L),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",L)),this._finish()}}_updateCamera(L){const u=new o.LngLat(L.coords.longitude,L.coords.latitude),E=L.coords.accuracy,B=this._map.getBearing(),_e=o.extend({bearing:B},this.options.fitBoundsOptions);this._map.fitBounds(u.toBounds(E),_e,{geolocateSource:!0})}_updateMarker(L){if(L){const u=new o.LngLat(L.coords.longitude,L.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=L.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const L=this._map.transform,u=o.mercatorZfromAltitude(1,L._center.lat)*L.worldSize,E=Math.ceil(2*this._accuracy*u);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(L){if(this._map){if(this.options.trackUserLocation)if(L.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(L.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",L)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(L){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=ze("button","mapboxgl-ctrl-geolocate",this._container),ze("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",L===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ze("div","mapboxgl-user-location"),this._dotElement.appendChild(ze("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ze("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new th({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ze("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new th({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(L){this._userLocationDotMarker&&(L.webkitCompassHeading?this._heading=L.webkitCompassHeading:L.absolute===!0&&(this._heading=-1*L.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let L;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(L={maximumAge:6e5,timeout:0},this._noTimeout=!0):(L=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,L),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const L=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(u=>{u==="granted"&&L()}).catch(console.error):L()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xr,ScaleControl:class{constructor(L){this.options=o.extend({},Vd,L),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Wd.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const L=this.options.maxWidth||100,u=this._map,E=u._containerHeight/2,B=u._containerWidth/2-L/2,_e=u.unproject([B,E]),St=u.unproject([B+L,E]),mr=_e.distanceTo(St);if(this.options.unit==="imperial"){const qr=3.2808*mr;qr>5280?this._setScale(L,qr/5280,"mile"):this._setScale(L,qr,"foot")}else this.options.unit==="nautical"?this._setScale(L,mr/1852,"nautical-mile"):mr>=1e3?this._setScale(L,mr/1e3,"kilometer"):this._setScale(L,mr,"meter")}_setScale(L,u,E){const B=Mf(u),_e=B/u;this._map._requestDomTask(()=>{this._container.style.width=L*_e+"px",this._container.innerHTML=E!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:E}).format(B):`${B}&nbsp;nm`})}onAdd(L){return this._map=L,this._language=L.getLanguage(),this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-scale",L.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(L){this._language=L,this._update()}setUnit(L){this.options.unit=L,this._update()}},FullscreenControl:class{constructor(L){this._fullscreen=!1,L&&L.container&&(L.container instanceof o.window.HTMLElement?this._container=L.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(L){return this._map=L,this._container||(this._container=this._map.getContainer()),this._controlContainer=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const L=this._fullscreenButton=ze("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ze("span","mapboxgl-ctrl-icon",L).setAttribute("aria-hidden","true"),L.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const L=this._getTitle();this._fullscreenButton.setAttribute("aria-label",L),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",L)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(L){super(),this.options=o.extend(Object.create(ph),L),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(L&&L.className?L.className.trim().split(/\s+/):[])}addTo(L){return this._map&&this.remove(),this._map=L,this.options.closeOnClick&&L.on("preclick",this._onClose),this.options.closeOnMove&&L.on("move",this._onClose),L.on("remove",this.remove),this._update(),L._addPopup(this),this._focusFirstElement(),this._trackPointer?(L.on("mousemove",this._onMouseEvent),L.on("mouseup",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")):L.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const L=this._map;return L&&(L.off("move",this._update),L.off("move",this._onClose),L.off("preclick",this._onClose),L.off("click",this._onClose),L.off("remove",this.remove),L.off("mousemove",this._onMouseEvent),L.off("mouseup",this._onMouseEvent),L.off("drag",this._onMouseEvent),L._canvasContainer&&L._canvasContainer.classList.remove("mapboxgl-track-pointer"),L._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(L){this._lngLat=o.LngLat.convert(L),this._pos=null,this._trackPointer=!1,this._update();const u=this._map;return u&&(u.on("move",this._update),u.off("mousemove",this._onMouseEvent),u._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const L=this._map;return L&&(L.off("move",this._update),L.on("mousemove",this._onMouseEvent),L.on("drag",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(L){return this.setDOMContent(o.window.document.createTextNode(L))}setHTML(L){const u=o.window.document.createDocumentFragment(),E=o.window.document.createElement("body");let B;for(E.innerHTML=L;B=E.firstChild,B;)u.appendChild(B);return this.setDOMContent(u)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(L){return this.options.maxWidth=L,this._update(),this}setDOMContent(L){let u=this._content;if(u)for(;u.hasChildNodes();)u.firstChild&&u.removeChild(u.firstChild);else u=this._content=ze("div","mapboxgl-popup-content",this._container||void 0);if(u.appendChild(L),this.options.closeButton){const E=this._closeButton=ze("button","mapboxgl-popup-close-button",u);E.type="button",E.setAttribute("aria-label","Close popup"),E.setAttribute("aria-hidden","true"),E.innerHTML="&#215;",E.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(L){return this._classList.add(L),this._updateClassList(),this}removeClassName(L){return this._classList.delete(L),this._updateClassList(),this}setOffset(L){return this.options.offset=L,this._update(),this}toggleClassName(L){let u;return this._classList.delete(L)?u=!1:(this._classList.add(L),u=!0),this._updateClassList(),u}_onMouseEvent(L){this._update(L.point)}_getAnchor(L){if(this.options.anchor)return this.options.anchor;const u=this._map,E=this._container,B=this._pos;if(!u||!E||!B)return"bottom";const _e=E.offsetWidth,St=E.offsetHeight,mr=B.x<_e/2,qr=B.x>u.transform.width-_e/2;if(B.y+L<St)return mr?"top-left":qr?"top-right":"top";if(B.y>u.transform.height-St){if(mr)return"bottom-left";if(qr)return"bottom-right"}return mr?"left":qr?"right":"bottom"}_updateClassList(){const L=this._container;if(!L)return;const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),L.className=u.join(" ")}_update(L){const u=this._map,E=this._content;if(!u||!this._lngLat&&!this._trackPointer||!E)return;let B=this._container;if(B||(B=this._container=ze("div","mapboxgl-popup",u.getContainer()),this._tip=ze("div","mapboxgl-popup-tip",B),B.appendChild(E)),this.options.maxWidth&&B.style.maxWidth!==this.options.maxWidth&&(B.style.maxWidth=this.options.maxWidth),u.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ol(this._lngLat,this._pos,u.transform)),!this._trackPointer||L){const _e=this._pos=this._trackPointer&&L?L:u.project(this._lngLat),St=$h(this.options.offset),mr=this._anchor=this._getAnchor(St.y),qr=$h(this.options.offset,mr),ss=_e.add(qr).round();u._requestDomTask(()=>{this._container&&mr&&(this._container.style.transform=`${rh[mr]} translate(${ss.x}px,${ss.y}px)`)})}if(!this._marker&&u._showingGlobe()){const _e=o.isLngLatBehindGlobe(u.transform,this._lngLat)?0:1;this._setOpacity(_e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const L=this._container.querySelector(Dh);L&&L.focus()}_onClose(){this.remove()}_setOpacity(L){this._container&&(this._container.style.opacity=`${L}`),this._content&&(this._content.style.pointerEvents=L?"auto":"none")}},Marker:th,Style:eg,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Y_,Evented:o.Evented,config:o.config,prewarm:function(){np().acquire(Qd)},clearPrewarmedResources:function(){const L=zf;L&&(L.isPreloaded()&&L.numActive()===1?(L.release(Qd),zf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(L){o.config.ACCESS_TOKEN=L},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(L){o.config.API_URL=L},get workerCount(){return xf.workerCount},set workerCount(L){xf.workerCount=L},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(L){o.config.MAX_PARALLEL_IMAGE_REQUESTS=L},clearStorage(L){o.clearTileCache(L)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Of});var f=a;return f})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);var d2r=Math.PI/180,r2d=180/Math.PI;function tileToBBOX(e){var t=tile2lon(e[0]+1,e[2]),r=tile2lon(e[0],e[2]),n=tile2lat(e[1]+1,e[2]),a=tile2lat(e[1],e[2]);return[r,n,t,a]}function tileToGeoJSON(e){var t=tileToBBOX(e),r={type:"Polygon",coordinates:[[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]]};return r}function tile2lon(e,t){return e/Math.pow(2,t)*360-180}function tile2lat(e,t){var r=Math.PI-2*Math.PI*e/Math.pow(2,t);return r2d*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}function pointToTile(e,t,r){var n=pointToTileFraction(e,t,r);return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n}function getChildren(e){return[[e[0]*2,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2+1,e[2]+1],[e[0]*2,e[1]*2+1,e[2]+1]]}function getParent(e){return[e[0]>>1,e[1]>>1,e[2]-1]}function getSiblings(e){return getChildren(getParent(e))}function hasSiblings(e,t){for(var r=getSiblings(e),n=0;n<r.length;n++)if(!hasTile(t,r[n]))return!1;return!0}function hasTile(e,t){for(var r=0;r<e.length;r++)if(tilesEqual(e[r],t))return!0;return!1}function tilesEqual(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function tileToQuadkey(e){for(var t="",r=e[2];r>0;r--){var n=0,a=1<<r-1;e[0]&a&&n++,e[1]&a&&(n+=2),t+=n.toString()}return t}function quadkeyToTile(e){for(var t=0,r=0,n=e.length,a=n;a>0;a--){var s=1<<a-1,f=+e[n-a];f===1&&(t|=s),f===2&&(r|=s),f===3&&(t|=s,r|=s)}return[t,r,n]}function bboxToTile(e){var t=pointToTile(e[0],e[1],32),r=pointToTile(e[2],e[3],32),n=[t[0],t[1],r[0],r[1]],a=getBboxZoom(n);if(a===0)return[0,0,0];var s=n[0]>>>32-a,f=n[1]>>>32-a;return[s,f,a]}function getBboxZoom(e){for(var t=28,r=0;r<t;r++){var n=1<<32-(r+1);if((e[0]&n)!==(e[2]&n)||(e[1]&n)!==(e[3]&n))return r}return t}function pointToTileFraction(e,t,r){var n=Math.sin(t*d2r),a=Math.pow(2,r),s=a*(e/360+.5),f=a*(.5-.25*Math.log((1+n)/(1-n))/Math.PI);return s=s%a,s<0&&(s=s+a),[s,f,r]}var tilebelt={tileToGeoJSON,tileToBBOX,getChildren,getParent,getSiblings,hasTile,hasSiblings,tilesEqual,tileToQuadkey,quadkeyToTile,pointToTile,bboxToTile,pointToTileFraction};const tilebelt$1=getDefaultExportFromCjs(tilebelt);var earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936};function feature(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function point(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(e[0])||!isNumber(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return feature(n,t,r)}function polygon(e,t,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:e};return feature(o,t,r)}function radiansToLength(e,t){t===void 0&&(t="kilometers");var r=factors[t];if(!r)throw new Error(t+" units is invalid");return e*r}function lengthToRadians(e,t){t===void 0&&(t="kilometers");var r=factors[t];if(!r)throw new Error(t+" units is invalid");return e/r}function radiansToDegrees(e){var t=e%(2*Math.PI);return t*180/Math.PI}function degreesToRadians(e){var t=e%360;return t*Math.PI/180}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function geomEach(e,t){var r,n,a,s,f,o,x,C,P,Y,ze=0,ge=e.type==="FeatureCollection",Bt=e.type==="Feature",Ur=ge?e.features.length:1;for(r=0;r<Ur;r++){for(o=ge?e.features[r].geometry:Bt?e.geometry:e,C=ge?e.features[r].properties:Bt?e.properties:{},P=ge?e.features[r].bbox:Bt?e.bbox:void 0,Y=ge?e.features[r].id:Bt?e.id:void 0,x=o?o.type==="GeometryCollection":!1,f=x?o.geometries.length:1,a=0;a<f;a++){if(s=x?o.geometries[a]:o,s===null){if(t(null,ze,C,P,Y)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,ze,C,P,Y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(t(s.geometries[n],ze,C,P,Y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ze++}}function geomReduce(e,t,r){var n=r;return geomEach(e,function(a,s,f,o,x){s===0&&r===void 0?n=a:n=t(n,a,s,f,o,x)}),n}function getCoord(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function distance(e,t,r){r===void 0&&(r={});var n=getCoord(e),a=getCoord(t),s=degreesToRadians(a[1]-n[1]),f=degreesToRadians(a[0]-n[0]),o=degreesToRadians(n[1]),x=degreesToRadians(a[1]),C=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(o)*Math.cos(x);return radiansToLength(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),r.units)}function bboxPolygon(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],o=[r,s],x=[a,s],C=[a,n];return polygon([[f,C,x,o,f]],t.properties,{bbox:e,id:t.id})}function destination(e,t,r,n){n===void 0&&(n={});var a=getCoord(e),s=degreesToRadians(a[0]),f=degreesToRadians(a[1]),o=degreesToRadians(r),x=lengthToRadians(t,n.units),C=Math.asin(Math.sin(f)*Math.cos(x)+Math.cos(f)*Math.sin(x)*Math.cos(o)),P=s+Math.atan2(Math.sin(o)*Math.sin(x)*Math.cos(f),Math.cos(x)-Math.sin(f)*Math.sin(C)),Y=radiansToDegrees(P),ze=radiansToDegrees(C);return point([Y,ze],n.properties)}function bearing(e,t,r){if(r===void 0&&(r={}),r.final===!0)return calculateFinalBearing(e,t);var n=getCoord(e),a=getCoord(t),s=degreesToRadians(n[0]),f=degreesToRadians(a[0]),o=degreesToRadians(n[1]),x=degreesToRadians(a[1]),C=Math.sin(f-s)*Math.cos(x),P=Math.cos(o)*Math.sin(x)-Math.sin(o)*Math.cos(x)*Math.cos(f-s);return radiansToDegrees(Math.atan2(C,P))}function calculateFinalBearing(e,t){var r=bearing(t,e);return r=(r+180)%360,r}function midpoint(e,t){var r=distance(e,t),n=bearing(e,t),a=destination(e,r/2,n);return a}var RADIUS=6378137;function area(e){return geomReduce(e,function(t,r){return t+calculateArea(r)},0)}function calculateArea(e){var t=0,r;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=polygonArea(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function polygonArea(e){var t=0;if(e&&e.length>0){t+=Math.abs(ringArea(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(ringArea(e[r]))}return t}function ringArea(e){var t,r,n,a,s,f,o,x=0,C=e.length;if(C>2){for(o=0;o<C;o++)o===C-2?(a=C-2,s=C-1,f=0):o===C-1?(a=C-1,s=0,f=1):(a=o,s=o+1,f=o+2),t=e[a],r=e[s],n=e[f],x+=(rad(n[0])-rad(t[0]))*Math.sin(rad(r[1]));x=x*RADIUS*RADIUS/2}return x}function rad(e){return e*Math.PI/180}const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,t){return e>=this.width||t>=this.height?0:this.getBit(t*this.width+e)},setBitXY(e,t){this.setBit(t*this.width+e)},clearBitXY(e,t){this.clearBit(t*this.width+e)},toggleBitXY(e,t){this.toggleBit(t*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const t in bitMethods)e.prototype[t]=bitMethods[t]}function checkProcessable(e,t={}){let{bitDepth:r,alpha:n,colorModel:a,components:s,channels:f}=t;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${r}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${n}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${a}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let o=`The process: ${e} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${o}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(o)}if(f&&(Array.isArray(f)||(f=[f]),!f.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${f}`)}function createBlob(e,t){e=e||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(e,t)}catch(s){if(s.name!=="TypeError")throw s;for(var r=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new r,a=0;a<e.length;a+=1)n.append(e[a]);return n.getBlob(t.type)}}function dataURLToBlob(e){var t=e.match(/data:([^;]+)/)[1],r=e.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(r));return createBlob([n],{type:t})}function canvasToBlob(e,t,r){return typeof e.toBlob=="function"?new Promise(function(n){e.toBlob(n,t,r)}):Promise.resolve(dataURLToBlob(e.toDataURL(t,r)))}function binaryStringToArrayBuffer(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=-1;++a<t;)n[a]=e.charCodeAt(a);return r}(function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function t(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;const f=n.length;let o=0,x=Math.max(32,f+(f>>1)+7),C=new Uint8Array(x>>3<<3);for(;s<f;){let P=n.charCodeAt(s++);if(P>=55296&&P<=56319){if(s<f){const Y=n.charCodeAt(s);(Y&64512)===56320&&(++s,P=((P&1023)<<10)+(Y&1023)+65536)}if(P>=55296&&P<=56319)continue}if(o+4>C.length){x+=8,x*=1+s/n.length*2,x=x>>3<<3;const Y=new Uint8Array(x);Y.set(C),C=Y}if(P&4294967168)if(!(P&4294965248))C[o++]=P>>6&31|192;else if(!(P&4294901760))C[o++]=P>>12&15|224,C[o++]=P>>6&63|128;else if(!(P&4292870144))C[o++]=P>>18&7|240,C[o++]=P>>12&63|128,C[o++]=P>>6&63|128;else continue;else{C[o++]=P;continue}C[o++]=P&63|128}return C.slice(0,o)};function r(n="utf-8",a={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(a.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const s=new Uint8Array(n);let f=0;const o=s.length,x=[];for(;f<o;){const C=s[f++];if(C===0)break;if(!(C&128))x.push(C);else if((C&224)===192){const P=s[f++]&63;x.push((C&31)<<6|P)}else if((C&240)===224){const P=s[f++]&63,Y=s[f++]&63;x.push((C&31)<<12|P<<6|Y)}else if((C&248)===240){const P=s[f++]&63,Y=s[f++]&63,ze=s[f++]&63;let ge=(C&7)<<18|P<<12|Y<<6|ze;ge>65535&&(ge-=65536,x.push(ge>>>10&1023|55296),ge=56320|ge&1023),x.push(ge)}}return String.fromCharCode.apply(null,x)},e.TextEncoder=t,e.TextDecoder=r})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$6(e,t="utf8"){return new TextDecoder(t).decode(e)}const encoder$1=new TextEncoder;function encode$4(e){return encoder$1.encode(e)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class KE{constructor(t=defaultByteLength$1,r={}){let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const a=r.offset?r.offset>>>0:0,s=t.byteLength-a;let f=a;(ArrayBuffer.isView(t)||t instanceof KE)&&(t.byteLength!==t.buffer.byteLength&&(f=t.byteOffset+a),t=t.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=t,this.length=s,this.byteLength=s,this.byteOffset=f,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,f,s),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const n=typedArrays[r].BYTES_PER_ELEMENT*t,a=this.byteOffset+this.offset,s=this.buffer.slice(a,a+n);if(this.littleEndian===hostBigEndian&&r!=="uint8"&&r!=="int8"){const o=new Uint8Array(this.buffer.slice(a,a+n));o.reverse();const x=new typedArrays[r](o.buffer);return this.offset+=n,x.reverse(),x}const f=new typedArrays[r](s);return this.offset+=n,f}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let n=0;n<t;n++)r+=this.readChar();return r}readUtf8(t=1){return decode$6(this.readBytes(t))}decodeText(t=1,r="utf-8"){return decode$6(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(encode$4(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(IOBuffer$5);var constants$d={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$4,constants$c=constants$d,tableLeft=[];for(let e=0;e<=8;e++)tableLeft.push(255<<e);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const r=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),a=r-n,s=this.bitDepth*this.width%8,f=s===0?0:8-s,o=r*this.height;let x,C,P=0,Y=0,ze=8;t.mark(),C=this.readUint8();for(let ge=this.height-1;ge>=0;ge--){const Bt=ge===0;t.reset(),t.skip(ge*r);for(let Ur=0;Ur<n;Ur++){const kn=Ur===n-1;Y<=f&&kn?(t.writeByte(C<<Y),(f===0||f===Y)&&!Bt&&(x=C,C=this.readByte())):Y===0?(x=C,C=this.readUint8(),t.writeByte(x)):(x=C,C=this.readUint8(),t.writeByte(x<<Y&tableLeft[Y]|C>>ze)),kn&&(P+=s||0,t.skip(a),Y=P%8,ze=8-Y)}}r>n&&(t.reset(),t.skip(o-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const r=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$c.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(r).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$c.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$c.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$3=function(t){return new Encoder(t).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1$1=4,Z_BINARY$1=0,Z_TEXT$1=1,Z_UNKNOWN$1$1=2;function zero$1$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK$1=0,STATIC_TREES$1=1,DYN_TREES$1=2,MIN_MATCH$1$1=3,MAX_MATCH$1$1=258,LENGTH_CODES$1$1=29,LITERALS$1$1=256,L_CODES$1$1=LITERALS$1$1+1+LENGTH_CODES$1$1,D_CODES$1$1=30,BL_CODES$1$1=19,HEAP_SIZE$1$1=2*L_CODES$1$1+1,MAX_BITS$1$1=15,Buf_size$1=16,MAX_BL_BITS$1=7,END_BLOCK$1=256,REP_3_6$1=16,REPZ_3_10$1=17,REPZ_11_138$1=18,extra_lbits$1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits$1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits$1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order$1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN$1=512,static_ltree$1=new Array((L_CODES$1$1+2)*2);zero$1$1(static_ltree$1);const static_dtree$1=new Array(D_CODES$1$1*2);zero$1$1(static_dtree$1);const _dist_code$1=new Array(DIST_CODE_LEN$1);zero$1$1(_dist_code$1);const _length_code$1=new Array(MAX_MATCH$1$1-MIN_MATCH$1$1+1);zero$1$1(_length_code$1);const base_length$1=new Array(LENGTH_CODES$1$1);zero$1$1(base_length$1);const base_dist$1=new Array(D_CODES$1$1);zero$1$1(base_dist$1);function StaticTreeDesc$1(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let static_l_desc$1,static_d_desc$1,static_bl_desc$1;function TreeDesc$1(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code$1=e=>e<256?_dist_code$1[e]:_dist_code$1[256+(e>>>7)],put_short$1=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits$1=(e,t,r)=>{e.bi_valid>Buf_size$1-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short$1(e,e.bi_buf),e.bi_buf=t>>Buf_size$1-e.bi_valid,e.bi_valid+=r-Buf_size$1):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},send_code$1=(e,t,r)=>{send_bits$1(e,r[t*2],r[t*2+1])},bi_reverse$1=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},bi_flush$1=e=>{e.bi_valid===16?(put_short$1(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen$1=(e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,x=t.stat_desc.max_length;let C,P,Y,ze,ge,Bt,Ur=0;for(ze=0;ze<=MAX_BITS$1$1;ze++)e.bl_count[ze]=0;for(r[e.heap[e.heap_max]*2+1]=0,C=e.heap_max+1;C<HEAP_SIZE$1$1;C++)P=e.heap[C],ze=r[r[P*2+1]*2+1]+1,ze>x&&(ze=x,Ur++),r[P*2+1]=ze,!(P>n)&&(e.bl_count[ze]++,ge=0,P>=o&&(ge=f[P-o]),Bt=r[P*2],e.opt_len+=Bt*(ze+ge),s&&(e.static_len+=Bt*(a[P*2+1]+ge)));if(Ur!==0){do{for(ze=x-1;e.bl_count[ze]===0;)ze--;e.bl_count[ze]--,e.bl_count[ze+1]+=2,e.bl_count[x]--,Ur-=2}while(Ur>0);for(ze=x;ze!==0;ze--)for(P=e.bl_count[ze];P!==0;)Y=e.heap[--C],!(Y>n)&&(r[Y*2+1]!==ze&&(e.opt_len+=(ze-r[Y*2+1])*r[Y*2],r[Y*2+1]=ze),P--)}},gen_codes$1=(e,t,r)=>{const n=new Array(MAX_BITS$1$1+1);let a=0,s,f;for(s=1;s<=MAX_BITS$1$1;s++)a=a+r[s-1]<<1,n[s]=a;for(f=0;f<=t;f++){let o=e[f*2+1];o!==0&&(e[f*2]=bi_reverse$1(n[o]++,o))}},tr_static_init$1=()=>{let e,t,r,n,a;const s=new Array(MAX_BITS$1$1+1);for(r=0,n=0;n<LENGTH_CODES$1$1-1;n++)for(base_length$1[n]=r,e=0;e<1<<extra_lbits$1[n];e++)_length_code$1[r++]=n;for(_length_code$1[r-1]=n,a=0,n=0;n<16;n++)for(base_dist$1[n]=a,e=0;e<1<<extra_dbits$1[n];e++)_dist_code$1[a++]=n;for(a>>=7;n<D_CODES$1$1;n++)for(base_dist$1[n]=a<<7,e=0;e<1<<extra_dbits$1[n]-7;e++)_dist_code$1[256+a++]=n;for(t=0;t<=MAX_BITS$1$1;t++)s[t]=0;for(e=0;e<=143;)static_ltree$1[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree$1[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree$1[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree$1[e*2+1]=8,e++,s[8]++;for(gen_codes$1(static_ltree$1,L_CODES$1$1+1,s),e=0;e<D_CODES$1$1;e++)static_dtree$1[e*2+1]=5,static_dtree$1[e*2]=bi_reverse$1(e,5);static_l_desc$1=new StaticTreeDesc$1(static_ltree$1,extra_lbits$1,LITERALS$1$1+1,L_CODES$1$1,MAX_BITS$1$1),static_d_desc$1=new StaticTreeDesc$1(static_dtree$1,extra_dbits$1,0,D_CODES$1$1,MAX_BITS$1$1),static_bl_desc$1=new StaticTreeDesc$1(new Array(0),extra_blbits$1,0,BL_CODES$1$1,MAX_BL_BITS$1)},init_block$1=e=>{let t;for(t=0;t<L_CODES$1$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK$1*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup$1=e=>{e.bi_valid>8?put_short$1(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller$1=(e,t,r,n)=>{const a=t*2,s=r*2;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[r]},pqdownheap$1=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&smaller$1(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller$1(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},compress_block$1=(e,t,r)=>{let n,a,s=0,f,o;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+s++]&255,n+=(e.pending_buf[e.sym_buf+s++]&255)<<8,a=e.pending_buf[e.sym_buf+s++],n===0?send_code$1(e,a,t):(f=_length_code$1[a],send_code$1(e,f+LITERALS$1$1+1,t),o=extra_lbits$1[f],o!==0&&(a-=base_length$1[f],send_bits$1(e,a,o)),n--,f=d_code$1(n),send_code$1(e,f,r),o=extra_dbits$1[f],o!==0&&(n-=base_dist$1[f],send_bits$1(e,n,o)));while(s<e.sym_next);send_code$1(e,END_BLOCK$1,t)},build_tree$1=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let f,o,x=-1,C;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1$1,f=0;f<s;f++)r[f*2]!==0?(e.heap[++e.heap_len]=x=f,e.depth[f]=0):r[f*2+1]=0;for(;e.heap_len<2;)C=e.heap[++e.heap_len]=x<2?++x:0,r[C*2]=1,e.depth[C]=0,e.opt_len--,a&&(e.static_len-=n[C*2+1]);for(t.max_code=x,f=e.heap_len>>1;f>=1;f--)pqdownheap$1(e,r,f);C=s;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap$1(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=o,r[C*2]=r[f*2]+r[o*2],e.depth[C]=(e.depth[f]>=e.depth[o]?e.depth[f]:e.depth[o])+1,r[f*2+1]=r[o*2+1]=C,e.heap[1]=C++,pqdownheap$1(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen$1(e,t),gen_codes$1(r,x,e.bl_count)},scan_tree$1=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)&&(o<C?e.bl_tree[s*2]+=o:s!==0?(s!==a&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6$1*2]++):o<=10?e.bl_tree[REPZ_3_10$1*2]++:e.bl_tree[REPZ_11_138$1*2]++,o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4))},send_tree$1=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),n=0;n<=r;n++)if(s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)){if(o<C)do send_code$1(e,s,e.bl_tree);while(--o!==0);else s!==0?(s!==a&&(send_code$1(e,s,e.bl_tree),o--),send_code$1(e,REP_3_6$1,e.bl_tree),send_bits$1(e,o-3,2)):o<=10?(send_code$1(e,REPZ_3_10$1,e.bl_tree),send_bits$1(e,o-3,3)):(send_code$1(e,REPZ_11_138$1,e.bl_tree),send_bits$1(e,o-11,7));o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4)}},build_bl_tree$1=e=>{let t;for(scan_tree$1(e,e.dyn_ltree,e.l_desc.max_code),scan_tree$1(e,e.dyn_dtree,e.d_desc.max_code),build_tree$1(e,e.bl_desc),t=BL_CODES$1$1-1;t>=3&&e.bl_tree[bl_order$1[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees$1=(e,t,r,n)=>{let a;for(send_bits$1(e,t-257,5),send_bits$1(e,r-1,5),send_bits$1(e,n-4,4),a=0;a<n;a++)send_bits$1(e,e.bl_tree[bl_order$1[a]*2+1],3);send_tree$1(e,e.dyn_ltree,t-1),send_tree$1(e,e.dyn_dtree,r-1)},detect_data_type$1=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return Z_BINARY$1;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT$1;for(r=32;r<LITERALS$1$1;r++)if(e.dyn_ltree[r*2]!==0)return Z_TEXT$1;return Z_BINARY$1};let static_init_done$1=!1;const _tr_init$1$1=e=>{static_init_done$1||(tr_static_init$1(),static_init_done$1=!0),e.l_desc=new TreeDesc$1(e.dyn_ltree,static_l_desc$1),e.d_desc=new TreeDesc$1(e.dyn_dtree,static_d_desc$1),e.bl_desc=new TreeDesc$1(e.bl_tree,static_bl_desc$1),e.bi_buf=0,e.bi_valid=0,init_block$1(e)},_tr_stored_block$1$1=(e,t,r,n)=>{send_bits$1(e,(STORED_BLOCK$1<<1)+(n?1:0),3),bi_windup$1(e),put_short$1(e,r),put_short$1(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},_tr_align$1$1=e=>{send_bits$1(e,STATIC_TREES$1<<1,3),send_code$1(e,END_BLOCK$1,static_ltree$1),bi_flush$1(e)},_tr_flush_block$1$1=(e,t,r,n)=>{let a,s,f=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1$1&&(e.strm.data_type=detect_data_type$1(e)),build_tree$1(e,e.l_desc),build_tree$1(e,e.d_desc),f=build_bl_tree$1(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=r+5,r+4<=a&&t!==-1?_tr_stored_block$1$1(e,t,r,n):e.strategy===Z_FIXED$1$1||s===a?(send_bits$1(e,(STATIC_TREES$1<<1)+(n?1:0),3),compress_block$1(e,static_ltree$1,static_dtree$1)):(send_bits$1(e,(DYN_TREES$1<<1)+(n?1:0),3),send_all_trees$1(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),compress_block$1(e,e.dyn_ltree,e.dyn_dtree)),init_block$1(e),n&&bi_windup$1(e)},_tr_tally$1$1=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code$1[r]+LITERALS$1$1+1)*2]++,e.dyn_dtree[d_code$1(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1$1=_tr_init$1$1,_tr_stored_block_1$1=_tr_stored_block$1$1,_tr_flush_block_1$1=_tr_flush_block$1$1,_tr_tally_1$1=_tr_tally$1$1,_tr_align_1$1=_tr_align$1$1,trees$1={_tr_init:_tr_init_1$1,_tr_stored_block:_tr_stored_block_1$1,_tr_flush_block:_tr_flush_block_1$1,_tr_tally:_tr_tally_1$1,_tr_align:_tr_align_1$1};const adler32$1=(e,t,r,n)=>{let a=e&65535|0,s=e>>>16&65535|0,f=0;for(;r!==0;){f=r>2e3?2e3:r,r-=f;do a=a+t[n++]|0,s=s+a|0;while(--f);a%=65521,s%=65521}return a|s<<16|0};var adler32_1$1=adler32$1;const makeTable$1=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable$2=new Uint32Array(makeTable$1()),crc32$1=(e,t,r,n)=>{const a=crcTable$2,s=n+r;e^=-1;for(let f=n;f<s;f++)e=e>>>8^a[(e^t[f])&255];return e^-1};var crc32_1$1=crc32$1,messages$1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_tr_init$2,_tr_stored_block:_tr_stored_block$2,_tr_flush_block:_tr_flush_block$2,_tr_tally:_tr_tally$2,_tr_align:_tr_align$2}=trees$1,{Z_NO_FLUSH:Z_NO_FLUSH$2$1,Z_PARTIAL_FLUSH:Z_PARTIAL_FLUSH$1,Z_FULL_FLUSH:Z_FULL_FLUSH$1$1,Z_FINISH:Z_FINISH$3$1,Z_BLOCK:Z_BLOCK$1$1,Z_OK:Z_OK$3$1,Z_STREAM_END:Z_STREAM_END$3$1,Z_STREAM_ERROR:Z_STREAM_ERROR$2$1,Z_DATA_ERROR:Z_DATA_ERROR$2$1,Z_BUF_ERROR:Z_BUF_ERROR$1$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1$1,Z_FILTERED:Z_FILTERED$1,Z_HUFFMAN_ONLY:Z_HUFFMAN_ONLY$1,Z_RLE:Z_RLE$1,Z_FIXED:Z_FIXED$2,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1$1,Z_UNKNOWN:Z_UNKNOWN$2,Z_DEFLATED:Z_DEFLATED$2$1}=constants$2$2,MAX_MEM_LEVEL$1=9,MAX_WBITS$1$1=15,DEF_MEM_LEVEL$1=8,LENGTH_CODES$2=29,LITERALS$2=256,L_CODES$2=LITERALS$2+1+LENGTH_CODES$2,D_CODES$2=30,BL_CODES$2=19,HEAP_SIZE$2=2*L_CODES$2+1,MAX_BITS$2=15,MIN_MATCH$2=3,MAX_MATCH$2=258,MIN_LOOKAHEAD$1=MAX_MATCH$2+MIN_MATCH$2+1,PRESET_DICT$1=32,INIT_STATE$1=42,GZIP_STATE$1=57,EXTRA_STATE$1=69,NAME_STATE$1=73,COMMENT_STATE$1=91,HCRC_STATE$1=103,BUSY_STATE$1=113,FINISH_STATE$1=666,BS_NEED_MORE$1=1,BS_BLOCK_DONE$1=2,BS_FINISH_STARTED$1=3,BS_FINISH_DONE$1=4,OS_CODE$1=3,err$1=(e,t)=>(e.msg=messages$1[t],t),rank$1=e=>e*2-(e>4?9:0),zero$2=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash$1=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=a?r-a:0;while(--t);t=a,n=t;do r=e.prev[--n],e.prev[n]=r>=a?r-a:0;while(--t)};let HASH_ZLIB$1=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,HASH$1=HASH_ZLIB$1;const flush_pending$1=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},flush_block_only$1=(e,t)=>{_tr_flush_block$2(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending$1(e.strm)},put_byte$1=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB$1=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf$1=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),e.state.wrap===1?e.adler=adler32_1$1(e.adler,t,a,r):e.state.wrap===2&&(e.adler=crc32_1$1(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},longest_match$1=(e,t)=>{let r=e.max_chain_length,n=e.strstart,a,s,f=e.prev_length,o=e.nice_match;const x=e.strstart>e.w_size-MIN_LOOKAHEAD$1?e.strstart-(e.w_size-MIN_LOOKAHEAD$1):0,C=e.window,P=e.w_mask,Y=e.prev,ze=e.strstart+MAX_MATCH$2;let ge=C[n+f-1],Bt=C[n+f];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do if(a=t,!(C[a+f]!==Bt||C[a+f-1]!==ge||C[a]!==C[n]||C[++a]!==C[n+1])){n+=2,a++;do;while(C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&n<ze);if(s=MAX_MATCH$2-(ze-n),n=ze-MAX_MATCH$2,s>f){if(e.match_start=t,f=s,s>=o)break;ge=C[n+f-1],Bt=C[n+f]}}while((t=Y[t&P])>x&&--r!==0);return f<=e.lookahead?f:e.lookahead},fill_window$1=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD$1)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash$1(e),n+=t),e.strm.avail_in===0)break;if(r=read_buf$1(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH$2)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=HASH$1(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=HASH$1(e,e.ins_h,e.window[a+MIN_MATCH$2-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH$2)););}while(e.lookahead<MIN_LOOKAHEAD$1&&e.strm.avail_in!==0)},deflate_stored$1=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,s,f=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(n===0&&t!==Z_FINISH$3$1||t===Z_NO_FLUSH$2$1||n!==a+e.strm.avail_in)))break;f=t===Z_FINISH$3$1&&n===a+e.strm.avail_in?1:0,_tr_stored_block$2(e,0,0,f),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,flush_pending$1(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(read_buf$1(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(f===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?BS_FINISH_DONE$1:t!==Z_NO_FLUSH$2$1&&t!==Z_FINISH$3$1&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE$1:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf$1(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Z_FINISH$3$1)&&t!==Z_NO_FLUSH$2$1&&e.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,f=t===Z_FINISH$3$1&&e.strm.avail_in===0&&n===a?1:0,_tr_stored_block$2(e,e.block_start,n,f),e.block_start+=n,flush_pending$1(e.strm)),f?BS_FINISH_STARTED$1:BS_NEED_MORE$1)},deflate_fast$1=(e,t)=>{let r,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD$1){if(fill_window$1(e),e.lookahead<MIN_LOOKAHEAD$1&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH$2&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD$1&&(e.match_length=longest_match$1(e,r)),e.match_length>=MIN_MATCH$2)if(n=_tr_tally$2(e,e.strstart-e.match_start,e.match_length-MIN_MATCH$2),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH$2){e.match_length--;do e.strstart++,e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=e.strstart<MIN_MATCH$2-1?e.strstart:MIN_MATCH$2-1,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_slow$1=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<MIN_LOOKAHEAD$1){if(fill_window$1(e),e.lookahead<MIN_LOOKAHEAD$1&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH$2&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH$2-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD$1&&(e.match_length=longest_match$1(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED$1||e.match_length===MIN_MATCH$2&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH$2-1)),e.prev_length>=MIN_MATCH$2&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-MIN_MATCH$2,n=_tr_tally$2(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH$2),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH$2-1,e.strstart++,n&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}else if(e.match_available){if(n=_tr_tally$2(e,0,e.window[e.strstart-1]),n&&flush_block_only$1(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE$1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally$2(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH$2-1?e.strstart:MIN_MATCH$2-1,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_rle$1=(e,t)=>{let r,n,a,s;const f=e.window;for(;;){if(e.lookahead<=MAX_MATCH$2){if(fill_window$1(e),e.lookahead<=MAX_MATCH$2&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH$2&&e.strstart>0&&(a=e.strstart-1,n=f[a],n===f[++a]&&n===f[++a]&&n===f[++a])){s=e.strstart+MAX_MATCH$2;do;while(n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&a<s);e.match_length=MAX_MATCH$2-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH$2?(r=_tr_tally$2(e,1,e.match_length-MIN_MATCH$2),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=0,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_huff$1=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(fill_window$1(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;break}if(e.match_length=0,r=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=0,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1};function Config$1(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const configuration_table$1=[new Config$1(0,0,0,0,deflate_stored$1),new Config$1(4,4,8,4,deflate_fast$1),new Config$1(4,5,16,8,deflate_fast$1),new Config$1(4,6,32,32,deflate_fast$1),new Config$1(4,4,16,16,deflate_slow$1),new Config$1(8,16,32,32,deflate_slow$1),new Config$1(8,16,128,128,deflate_slow$1),new Config$1(8,32,128,256,deflate_slow$1),new Config$1(32,128,258,1024,deflate_slow$1),new Config$1(32,258,258,4096,deflate_slow$1)],lm_init$1=e=>{e.window_size=2*e.w_size,zero$2(e.head),e.max_lazy_match=configuration_table$1[e.level].max_lazy,e.good_match=configuration_table$1[e.level].good_length,e.nice_match=configuration_table$1[e.level].nice_length,e.max_chain_length=configuration_table$1[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH$2-1,e.match_available=0,e.ins_h=0};function DeflateState$1(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2$1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE$2*2),this.dyn_dtree=new Uint16Array((2*D_CODES$2+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES$2+1)*2),zero$2(this.dyn_ltree),zero$2(this.dyn_dtree),zero$2(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS$2+1),this.heap=new Uint16Array(2*L_CODES$2+1),zero$2(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES$2+1),zero$2(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck$1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE$1&&t.status!==GZIP_STATE$1&&t.status!==EXTRA_STATE$1&&t.status!==NAME_STATE$1&&t.status!==COMMENT_STATE$1&&t.status!==HCRC_STATE$1&&t.status!==BUSY_STATE$1&&t.status!==FINISH_STATE$1?1:0},deflateResetKeep$1=e=>{if(deflateStateCheck$1(e))return err$1(e,Z_STREAM_ERROR$2$1);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN$2;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE$1:t.wrap?INIT_STATE$1:BUSY_STATE$1,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init$2(t),Z_OK$3$1},deflateReset$1=e=>{const t=deflateResetKeep$1(e);return t===Z_OK$3$1&&lm_init$1(e.state),t},deflateSetHeader$1=(e,t)=>deflateStateCheck$1(e)||e.state.wrap!==2?Z_STREAM_ERROR$2$1:(e.state.gzhead=t,Z_OK$3$1),deflateInit2$1=(e,t,r,n,a,s)=>{if(!e)return Z_STREAM_ERROR$2$1;let f=1;if(t===Z_DEFAULT_COMPRESSION$1$1&&(t=6),n<0?(f=0,n=-n):n>15&&(f=2,n-=16),a<1||a>MAX_MEM_LEVEL$1||r!==Z_DEFLATED$2$1||n<8||n>15||t<0||t>9||s<0||s>Z_FIXED$2||n===8&&f!==1)return err$1(e,Z_STREAM_ERROR$2$1);n===8&&(n=9);const o=new DeflateState$1;return e.state=o,o.strm=e,o.status=INIT_STATE$1,o.wrap=f,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH$2-1)/MIN_MATCH$2),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=s,o.method=r,deflateReset$1(e)},deflateInit$1=(e,t)=>deflateInit2$1(e,t,Z_DEFLATED$2$1,MAX_WBITS$1$1,DEF_MEM_LEVEL$1,Z_DEFAULT_STRATEGY$1$1),deflate$2$1=(e,t)=>{if(deflateStateCheck$1(e)||t>Z_BLOCK$1$1||t<0)return e?err$1(e,Z_STREAM_ERROR$2$1):Z_STREAM_ERROR$2$1;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===FINISH_STATE$1&&t!==Z_FINISH$3$1)return err$1(e,e.avail_out===0?Z_BUF_ERROR$1$1:Z_STREAM_ERROR$2$1);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(flush_pending$1(e),e.avail_out===0)return r.last_flush=-1,Z_OK$3$1}else if(e.avail_in===0&&rank$1(t)<=rank$1(n)&&t!==Z_FINISH$3$1)return err$1(e,Z_BUF_ERROR$1$1);if(r.status===FINISH_STATE$1&&e.avail_in!==0)return err$1(e,Z_BUF_ERROR$1$1);if(r.status===INIT_STATE$1&&r.wrap===0&&(r.status=BUSY_STATE$1),r.status===INIT_STATE$1){let a=Z_DEFLATED$2$1+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=Z_HUFFMAN_ONLY$1||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=PRESET_DICT$1),a+=31-a%31,putShortMSB$1(r,a),r.strstart!==0&&(putShortMSB$1(r,e.adler>>>16),putShortMSB$1(r,e.adler&65535)),e.adler=1,r.status=BUSY_STATE$1,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1}if(r.status===GZIP_STATE$1){if(e.adler=0,put_byte$1(r,31),put_byte$1(r,139),put_byte$1(r,8),r.gzhead)put_byte$1(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),put_byte$1(r,r.gzhead.time&255),put_byte$1(r,r.gzhead.time>>8&255),put_byte$1(r,r.gzhead.time>>16&255),put_byte$1(r,r.gzhead.time>>24&255),put_byte$1(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY$1||r.level<2?4:0),put_byte$1(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(put_byte$1(r,r.gzhead.extra.length&255),put_byte$1(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=EXTRA_STATE$1;else if(put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY$1||r.level<2?4:0),put_byte$1(r,OS_CODE$1),r.status=BUSY_STATE$1,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1}if(r.status===EXTRA_STATE$1){if(r.gzhead.extra){let a=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let o=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex+=o,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1;a=0,s-=o}let f=new Uint8Array(r.gzhead.extra);r.pending_buf.set(f.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=NAME_STATE$1}if(r.status===NAME_STATE$1){if(r.gzhead.name){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1;a=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,put_byte$1(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=COMMENT_STATE$1}if(r.status===COMMENT_STATE$1){if(r.gzhead.comment){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1;a=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,put_byte$1(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a))}r.status=HCRC_STATE$1}if(r.status===HCRC_STATE$1){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(flush_pending$1(e),r.pending!==0))return r.last_flush=-1,Z_OK$3$1;put_byte$1(r,e.adler&255),put_byte$1(r,e.adler>>8&255),e.adler=0}if(r.status=BUSY_STATE$1,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1}if(e.avail_in!==0||r.lookahead!==0||t!==Z_NO_FLUSH$2$1&&r.status!==FINISH_STATE$1){let a=r.level===0?deflate_stored$1(r,t):r.strategy===Z_HUFFMAN_ONLY$1?deflate_huff$1(r,t):r.strategy===Z_RLE$1?deflate_rle$1(r,t):configuration_table$1[r.level].func(r,t);if((a===BS_FINISH_STARTED$1||a===BS_FINISH_DONE$1)&&(r.status=FINISH_STATE$1),a===BS_NEED_MORE$1||a===BS_FINISH_STARTED$1)return e.avail_out===0&&(r.last_flush=-1),Z_OK$3$1;if(a===BS_BLOCK_DONE$1&&(t===Z_PARTIAL_FLUSH$1?_tr_align$2(r):t!==Z_BLOCK$1$1&&(_tr_stored_block$2(r,0,0,!1),t===Z_FULL_FLUSH$1$1&&(zero$2(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),flush_pending$1(e),e.avail_out===0))return r.last_flush=-1,Z_OK$3$1}return t!==Z_FINISH$3$1?Z_OK$3$1:r.wrap<=0?Z_STREAM_END$3$1:(r.wrap===2?(put_byte$1(r,e.adler&255),put_byte$1(r,e.adler>>8&255),put_byte$1(r,e.adler>>16&255),put_byte$1(r,e.adler>>24&255),put_byte$1(r,e.total_in&255),put_byte$1(r,e.total_in>>8&255),put_byte$1(r,e.total_in>>16&255),put_byte$1(r,e.total_in>>24&255)):(putShortMSB$1(r,e.adler>>>16),putShortMSB$1(r,e.adler&65535)),flush_pending$1(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Z_OK$3$1:Z_STREAM_END$3$1)},deflateEnd$1=e=>{if(deflateStateCheck$1(e))return Z_STREAM_ERROR$2$1;const t=e.state.status;return e.state=null,t===BUSY_STATE$1?err$1(e,Z_DATA_ERROR$2$1):Z_OK$3$1},deflateSetDictionary$1=(e,t)=>{let r=t.length;if(deflateStateCheck$1(e))return Z_STREAM_ERROR$2$1;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==INIT_STATE$1||n.lookahead)return Z_STREAM_ERROR$2$1;if(a===1&&(e.adler=adler32_1$1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){a===0&&(zero$2(n.head),n.strstart=0,n.block_start=0,n.insert=0);let x=new Uint8Array(n.w_size);x.set(t.subarray(r-n.w_size,r),0),t=x,r=n.w_size}const s=e.avail_in,f=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,fill_window$1(n);n.lookahead>=MIN_MATCH$2;){let x=n.strstart,C=n.lookahead-(MIN_MATCH$2-1);do n.ins_h=HASH$1(n,n.ins_h,n.window[x+MIN_MATCH$2-1]),n.prev[x&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=x,x++;while(--C);n.strstart=x,n.lookahead=MIN_MATCH$2-1,fill_window$1(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH$2-1,n.match_available=0,e.next_in=f,e.input=o,e.avail_in=s,n.wrap=a,Z_OK$3$1};var deflateInit_1$1=deflateInit$1,deflateInit2_1$1=deflateInit2$1,deflateReset_1$1=deflateReset$1,deflateResetKeep_1$1=deflateResetKeep$1,deflateSetHeader_1$1=deflateSetHeader$1,deflate_2$1$1=deflate$2$1,deflateEnd_1$1=deflateEnd$1,deflateSetDictionary_1$1=deflateSetDictionary$1,deflateInfo$1="pako deflate (from Nodeca project)",deflate_1$2$1={deflateInit:deflateInit_1$1,deflateInit2:deflateInit2_1$1,deflateReset:deflateReset_1$1,deflateResetKeep:deflateResetKeep_1$1,deflateSetHeader:deflateSetHeader_1$1,deflate:deflate_2$1$1,deflateEnd:deflateEnd_1$1,deflateSetDictionary:deflateSetDictionary_1$1,deflateInfo:deflateInfo$1};const _has$1=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign$1=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)_has$1(r,n)&&(e[n]=r[n])}}return e},flattenChunks$1=e=>{let t=0;for(let n=0,a=e.length;n<a;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,a=0,s=e.length;n<s;n++){let f=e[n];r.set(f,a),a+=f.length}return r},common$1={assign:assign$1,flattenChunks:flattenChunks$1};let STR_APPLY_UIA_OK$1=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK$1=!1}const _utf8len$1=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len$1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len$1[254]=_utf8len$1[254]=1;var string2buf$1=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,a,s,f=e.length,o=0;for(a=0;a<f;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),s=0,a=0;s<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|r&63):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|r&63):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|r&63);return t};const buf2binstring$1=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK$1)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var buf2string$1=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,a;const s=new Array(r*2);for(a=0,n=0;n<r;){let f=e[n++];if(f<128){s[a++]=f;continue}let o=_utf8len$1[f];if(o>4){s[a++]=65533,n+=o-1;continue}for(f&=o===2?31:o===3?15:7;o>1&&n<r;)f=f<<6|e[n++]&63,o--;if(o>1){s[a++]=65533;continue}f<65536?s[a++]=f:(f-=65536,s[a++]=55296|f>>10&1023,s[a++]=56320|f&1023)}return buf2binstring$1(s,a)},utf8border$1=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+_utf8len$1[e[r]]>t?r:t},strings$1={string2buf:string2buf$1,buf2string:buf2string$1,utf8border:utf8border$1};function ZStream$1(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream$1=ZStream$1;const toString$1$2=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1$1,Z_SYNC_FLUSH:Z_SYNC_FLUSH$1,Z_FULL_FLUSH:Z_FULL_FLUSH$2,Z_FINISH:Z_FINISH$2$1,Z_OK:Z_OK$2$1,Z_STREAM_END:Z_STREAM_END$2$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$2,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$2,Z_DEFLATED:Z_DEFLATED$1$1}=constants$2$2;function Deflate$1$1(e){this.options=common$1.assign({level:Z_DEFAULT_COMPRESSION$2,method:Z_DEFLATED$1$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$2},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream$1,this.strm.avail_out=0;let r=deflate_1$2$1.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$2$1)throw new Error(messages$1[r]);if(t.header&&deflate_1$2$1.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings$1.string2buf(t.dictionary):toString$1$2.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=deflate_1$2$1.deflateSetDictionary(this.strm,n),r!==Z_OK$2$1)throw new Error(messages$1[r]);this._dict_set=!0}}Deflate$1$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH$2$1:Z_NO_FLUSH$1$1,typeof e=="string"?r.input=strings$1.string2buf(e):toString$1$2.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===Z_SYNC_FLUSH$1||s===Z_FULL_FLUSH$2)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(a=deflate_1$2$1.deflate(r,s),a===Z_STREAM_END$2$1)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=deflate_1$2$1.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z_OK$2$1;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Deflate$1$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1$1.prototype.onEnd=function(e){e===Z_OK$2$1&&(this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,t){const r=new Deflate$1$1(t);if(r.push(e,!0),r.err)throw r.msg||messages$1[r.err];return r.result}function deflateRaw$1(e,t){return t=t||{},t.raw=!0,deflate$1(e,t)}function gzip$1(e,t){return t=t||{},t.gzip=!0,deflate$1(e,t)}var Deflate_1$1=Deflate$1$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1$1=constants$2$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1$1};const BAD$1$1=16209,TYPE$1$1=16191;var inffast$1=function(t,r){let n,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn,Io,rl,Co,as,$s,ah,ch,Zu,ih,al;const sh=t.state;n=t.next_in,ih=t.input,a=n+(t.avail_in-5),s=t.next_out,al=t.output,f=s-(r-t.avail_out),o=s+(t.avail_out-257),x=sh.dmax,C=sh.wsize,P=sh.whave,Y=sh.wnext,ze=sh.window,ge=sh.hold,Bt=sh.bits,Ur=sh.lencode,kn=sh.distcode,Io=(1<<sh.lenbits)-1,rl=(1<<sh.distbits)-1;e:do{Bt<15&&(ge+=ih[n++]<<Bt,Bt+=8,ge+=ih[n++]<<Bt,Bt+=8),Co=Ur[ge&Io];t:for(;;){if(as=Co>>>24,ge>>>=as,Bt-=as,as=Co>>>16&255,as===0)al[s++]=Co&65535;else if(as&16){$s=Co&65535,as&=15,as&&(Bt<as&&(ge+=ih[n++]<<Bt,Bt+=8),$s+=ge&(1<<as)-1,ge>>>=as,Bt-=as),Bt<15&&(ge+=ih[n++]<<Bt,Bt+=8,ge+=ih[n++]<<Bt,Bt+=8),Co=kn[ge&rl];i:for(;;){if(as=Co>>>24,ge>>>=as,Bt-=as,as=Co>>>16&255,as&16){if(ah=Co&65535,as&=15,Bt<as&&(ge+=ih[n++]<<Bt,Bt+=8,Bt<as&&(ge+=ih[n++]<<Bt,Bt+=8)),ah+=ge&(1<<as)-1,ah>x){t.msg="invalid distance too far back",sh.mode=BAD$1$1;break e}if(ge>>>=as,Bt-=as,as=s-f,ah>as){if(as=ah-as,as>P&&sh.sane){t.msg="invalid distance too far back",sh.mode=BAD$1$1;break e}if(ch=0,Zu=ze,Y===0){if(ch+=C-as,as<$s){$s-=as;do al[s++]=ze[ch++];while(--as);ch=s-ah,Zu=al}}else if(Y<as){if(ch+=C+Y-as,as-=Y,as<$s){$s-=as;do al[s++]=ze[ch++];while(--as);if(ch=0,Y<$s){as=Y,$s-=as;do al[s++]=ze[ch++];while(--as);ch=s-ah,Zu=al}}}else if(ch+=Y-as,as<$s){$s-=as;do al[s++]=ze[ch++];while(--as);ch=s-ah,Zu=al}for(;$s>2;)al[s++]=Zu[ch++],al[s++]=Zu[ch++],al[s++]=Zu[ch++],$s-=3;$s&&(al[s++]=Zu[ch++],$s>1&&(al[s++]=Zu[ch++]))}else{ch=s-ah;do al[s++]=al[ch++],al[s++]=al[ch++],al[s++]=al[ch++],$s-=3;while($s>2);$s&&(al[s++]=al[ch++],$s>1&&(al[s++]=al[ch++]))}}else if(as&64){t.msg="invalid distance code",sh.mode=BAD$1$1;break e}else{Co=kn[(Co&65535)+(ge&(1<<as)-1)];continue i}break}}else if(as&64)if(as&32){sh.mode=TYPE$1$1;break e}else{t.msg="invalid literal/length code",sh.mode=BAD$1$1;break e}else{Co=Ur[(Co&65535)+(ge&(1<<as)-1)];continue t}break}}while(n<a&&s<o);$s=Bt>>3,n-=$s,Bt-=$s<<3,ge&=(1<<Bt)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?5+(a-n):5-(n-a),t.avail_out=s<o?257+(o-s):257-(s-o),sh.hold=ge,sh.bits=Bt};const MAXBITS$1=15,ENOUGH_LENS$1$1=852,ENOUGH_DISTS$1$1=592,CODES$1$1=0,LENS$1$1=1,DISTS$1$1=2,lbase$1=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext$1=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase$1=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext$1=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table$1=(e,t,r,n,a,s,f,o)=>{const x=o.bits;let C=0,P=0,Y=0,ze=0,ge=0,Bt=0,Ur=0,kn=0,Io=0,rl=0,Co,as,$s,ah,ch,Zu=null,ih;const al=new Uint16Array(MAXBITS$1+1),sh=new Uint16Array(MAXBITS$1+1);let _h=null,Ih,Lh,Gh;for(C=0;C<=MAXBITS$1;C++)al[C]=0;for(P=0;P<n;P++)al[t[r+P]]++;for(ge=x,ze=MAXBITS$1;ze>=1&&al[ze]===0;ze--);if(ge>ze&&(ge=ze),ze===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,o.bits=1,0;for(Y=1;Y<ze&&al[Y]===0;Y++);for(ge<Y&&(ge=Y),kn=1,C=1;C<=MAXBITS$1;C++)if(kn<<=1,kn-=al[C],kn<0)return-1;if(kn>0&&(e===CODES$1$1||ze!==1))return-1;for(sh[1]=0,C=1;C<MAXBITS$1;C++)sh[C+1]=sh[C]+al[C];for(P=0;P<n;P++)t[r+P]!==0&&(f[sh[t[r+P]]++]=P);if(e===CODES$1$1?(Zu=_h=f,ih=20):e===LENS$1$1?(Zu=lbase$1,_h=lext$1,ih=257):(Zu=dbase$1,_h=dext$1,ih=0),rl=0,P=0,C=Y,ch=s,Bt=ge,Ur=0,$s=-1,Io=1<<ge,ah=Io-1,e===LENS$1$1&&Io>ENOUGH_LENS$1$1||e===DISTS$1$1&&Io>ENOUGH_DISTS$1$1)return 1;for(;;){Ih=C-Ur,f[P]+1<ih?(Lh=0,Gh=f[P]):f[P]>=ih?(Lh=_h[f[P]-ih],Gh=Zu[f[P]-ih]):(Lh=32+64,Gh=0),Co=1<<C-Ur,as=1<<Bt,Y=as;do as-=Co,a[ch+(rl>>Ur)+as]=Ih<<24|Lh<<16|Gh|0;while(as!==0);for(Co=1<<C-1;rl&Co;)Co>>=1;if(Co!==0?(rl&=Co-1,rl+=Co):rl=0,P++,--al[C]===0){if(C===ze)break;C=t[r+f[P]]}if(C>ge&&(rl&ah)!==$s){for(Ur===0&&(Ur=ge),ch+=Y,Bt=C-Ur,kn=1<<Bt;Bt+Ur<ze&&(kn-=al[Bt+Ur],!(kn<=0));)Bt++,kn<<=1;if(Io+=1<<Bt,e===LENS$1$1&&Io>ENOUGH_LENS$1$1||e===DISTS$1$1&&Io>ENOUGH_DISTS$1$1)return 1;$s=rl&ah,a[$s]=ge<<24|Bt<<16|ch-s|0}}return rl!==0&&(a[ch+rl]=C-Ur<<24|64<<16|0),o.bits=ge,0};var inftrees$1=inflate_table$1;const CODES$2=0,LENS$2=1,DISTS$2=2,{Z_FINISH:Z_FINISH$1$1,Z_BLOCK:Z_BLOCK$2,Z_TREES:Z_TREES$1,Z_OK:Z_OK$1$1,Z_STREAM_END:Z_STREAM_END$1$1,Z_NEED_DICT:Z_NEED_DICT$1$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1$1,Z_DATA_ERROR:Z_DATA_ERROR$1$1,Z_MEM_ERROR:Z_MEM_ERROR$1$1,Z_BUF_ERROR:Z_BUF_ERROR$2,Z_DEFLATED:Z_DEFLATED$3}=constants$2$2,HEAD$1=16180,FLAGS$1=16181,TIME$1=16182,OS$1=16183,EXLEN$1=16184,EXTRA$1=16185,NAME$1=16186,COMMENT$1=16187,HCRC$1=16188,DICTID$1=16189,DICT$1=16190,TYPE$2=16191,TYPEDO$1=16192,STORED$1=16193,COPY_$1=16194,COPY$1=16195,TABLE$1=16196,LENLENS$1=16197,CODELENS$1=16198,LEN_$1=16199,LEN$1=16200,LENEXT$1=16201,DIST$1=16202,DISTEXT$1=16203,MATCH$1=16204,LIT$1=16205,CHECK$1=16206,LENGTH$1=16207,DONE$1=16208,BAD$2=16209,MEM$1=16210,SYNC$1=16211,ENOUGH_LENS$2=852,ENOUGH_DISTS$2=592,MAX_WBITS$2=15,DEF_WBITS$1=MAX_WBITS$2,zswap32$1=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState$1(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck$1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD$1||t.mode>SYNC$1?1:0},inflateResetKeep$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD$1,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS$2),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS$2),t.sane=1,t.back=-1,Z_OK$1$1},inflateReset$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep$1(e)},inflateReset2$1=(e,t)=>{let r;if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset$1(e))},inflateInit2$1=(e,t)=>{if(!e)return Z_STREAM_ERROR$1$1;const r=new InflateState$1;e.state=r,r.strm=e,r.window=null,r.mode=HEAD$1;const n=inflateReset2$1(e,t);return n!==Z_OK$1$1&&(e.state=null),n},inflateInit$1=e=>inflateInit2$1(e,DEF_WBITS$1);let virgin$1=!0,lenfix$1,distfix$1;const fixedtables$1=e=>{if(virgin$1){lenfix$1=new Int32Array(512),distfix$1=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees$1(LENS$2,e.lens,0,288,lenfix$1,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees$1(DISTS$2,e.lens,0,32,distfix$1,0,e.work,{bits:5}),virgin$1=!1}e.lencode=lenfix$1,e.lenbits=9,e.distcode=distfix$1,e.distbits=5},updatewindow$1=(e,t,r,n)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(r-n,r-n+a),s.wnext),n-=a,n?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},inflate$2$1=(e,t)=>{let r,n,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn=0,Io,rl,Co,as,$s,ah,ch,Zu;const ih=new Uint8Array(4);let al,sh;const _h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck$1(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1$1;r=e.state,r.mode===TYPE$2&&(r.mode=TYPEDO$1),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,Y=o,ze=x,Zu=Z_OK$1$1;e:for(;;)switch(r.mode){case HEAD$1:if(r.wrap===0){r.mode=TYPEDO$1;break}for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&2&&C===35615){r.wbits===0&&(r.wbits=15),r.check=0,ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1$1(r.check,ih,2,0),C=0,P=0,r.mode=FLAGS$1;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((C&255)<<8)+(C>>8))%31){e.msg="incorrect header check",r.mode=BAD$2;break}if((C&15)!==Z_DEFLATED$3){e.msg="unknown compression method",r.mode=BAD$2;break}if(C>>>=4,P-=4,ch=(C&15)+8,r.wbits===0&&(r.wbits=ch),ch>15||ch>r.wbits){e.msg="invalid window size",r.mode=BAD$2;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=C&512?DICTID$1:TYPE$2,C=0,P=0;break;case FLAGS$1:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.flags=C,(r.flags&255)!==Z_DEFLATED$3){e.msg="unknown compression method",r.mode=BAD$2;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=BAD$2;break}r.head&&(r.head.text=C>>8&1),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1$1(r.check,ih,2,0)),C=0,P=0,r.mode=TIME$1;case TIME$1:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.time=C),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,ih[2]=C>>>16&255,ih[3]=C>>>24&255,r.check=crc32_1$1(r.check,ih,4,0)),C=0,P=0,r.mode=OS$1;case OS$1:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.xflags=C&255,r.head.os=C>>8),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1$1(r.check,ih,2,0)),C=0,P=0,r.mode=EXLEN$1;case EXLEN$1:if(r.flags&1024){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length=C,r.head&&(r.head.extra_len=C),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1$1(r.check,ih,2,0)),C=0,P=0}else r.head&&(r.head.extra=null);r.mode=EXTRA$1;case EXTRA$1:if(r.flags&1024&&(ge=r.length,ge>o&&(ge=o),ge&&(r.head&&(ch=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+ge),ch)),r.flags&512&&r.wrap&4&&(r.check=crc32_1$1(r.check,n,ge,s)),o-=ge,s+=ge,r.length-=ge),r.length))break e;r.length=0,r.mode=NAME$1;case NAME$1:if(r.flags&2048){if(o===0)break e;ge=0;do ch=n[s+ge++],r.head&&ch&&r.length<65536&&(r.head.name+=String.fromCharCode(ch));while(ch&&ge<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1$1(r.check,n,ge,s)),o-=ge,s+=ge,ch)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT$1;case COMMENT$1:if(r.flags&4096){if(o===0)break e;ge=0;do ch=n[s+ge++],r.head&&ch&&r.length<65536&&(r.head.comment+=String.fromCharCode(ch));while(ch&&ge<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1$1(r.check,n,ge,s)),o-=ge,s+=ge,ch)break e}else r.head&&(r.head.comment=null);r.mode=HCRC$1;case HCRC$1:if(r.flags&512){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.check&65535)){e.msg="header crc mismatch",r.mode=BAD$2;break}C=0,P=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE$2;break;case DICTID$1:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}e.adler=r.check=zswap32$1(C),C=0,P=0,r.mode=DICT$1;case DICT$1:if(r.havedict===0)return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,Z_NEED_DICT$1$1;e.adler=r.check=1,r.mode=TYPE$2;case TYPE$2:if(t===Z_BLOCK$2||t===Z_TREES$1)break e;case TYPEDO$1:if(r.last){C>>>=P&7,P-=P&7,r.mode=CHECK$1;break}for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}switch(r.last=C&1,C>>>=1,P-=1,C&3){case 0:r.mode=STORED$1;break;case 1:if(fixedtables$1(r),r.mode=LEN_$1,t===Z_TREES$1){C>>>=2,P-=2;break e}break;case 2:r.mode=TABLE$1;break;case 3:e.msg="invalid block type",r.mode=BAD$2}C>>>=2,P-=2;break;case STORED$1:for(C>>>=P&7,P-=P&7;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if((C&65535)!==(C>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD$2;break}if(r.length=C&65535,C=0,P=0,r.mode=COPY_$1,t===Z_TREES$1)break e;case COPY_$1:r.mode=COPY$1;case COPY$1:if(ge=r.length,ge){if(ge>o&&(ge=o),ge>x&&(ge=x),ge===0)break e;a.set(n.subarray(s,s+ge),f),o-=ge,s+=ge,x-=ge,f+=ge,r.length-=ge;break}r.mode=TYPE$2;break;case TABLE$1:for(;P<14;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.nlen=(C&31)+257,C>>>=5,P-=5,r.ndist=(C&31)+1,C>>>=5,P-=5,r.ncode=(C&15)+4,C>>>=4,P-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD$2;break}r.have=0,r.mode=LENLENS$1;case LENLENS$1:for(;r.have<r.ncode;){for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.lens[_h[r.have++]]=C&7,C>>>=3,P-=3}for(;r.have<19;)r.lens[_h[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,al={bits:r.lenbits},Zu=inftrees$1(CODES$2,r.lens,0,19,r.lencode,0,r.work,al),r.lenbits=al.bits,Zu){e.msg="invalid code lengths set",r.mode=BAD$2;break}r.have=0,r.mode=CODELENS$1;case CODELENS$1:for(;r.have<r.nlen+r.ndist;){for(;kn=r.lencode[C&(1<<r.lenbits)-1],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(Co<16)C>>>=Io,P-=Io,r.lens[r.have++]=Co;else{if(Co===16){for(sh=Io+2;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(C>>>=Io,P-=Io,r.have===0){e.msg="invalid bit length repeat",r.mode=BAD$2;break}ch=r.lens[r.have-1],ge=3+(C&3),C>>>=2,P-=2}else if(Co===17){for(sh=Io+3;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Io,P-=Io,ch=0,ge=3+(C&7),C>>>=3,P-=3}else{for(sh=Io+7;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Io,P-=Io,ch=0,ge=11+(C&127),C>>>=7,P-=7}if(r.have+ge>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD$2;break}for(;ge--;)r.lens[r.have++]=ch}}if(r.mode===BAD$2)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=BAD$2;break}if(r.lenbits=9,al={bits:r.lenbits},Zu=inftrees$1(LENS$2,r.lens,0,r.nlen,r.lencode,0,r.work,al),r.lenbits=al.bits,Zu){e.msg="invalid literal/lengths set",r.mode=BAD$2;break}if(r.distbits=6,r.distcode=r.distdyn,al={bits:r.distbits},Zu=inftrees$1(DISTS$2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,al),r.distbits=al.bits,Zu){e.msg="invalid distances set",r.mode=BAD$2;break}if(r.mode=LEN_$1,t===Z_TREES$1)break e;case LEN_$1:r.mode=LEN$1;case LEN$1:if(o>=6&&x>=258){e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,inffast$1(e,ze),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,r.mode===TYPE$2&&(r.back=-1);break}for(r.back=0;kn=r.lencode[C&(1<<r.lenbits)-1],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(rl&&!(rl&240)){for(as=Io,$s=rl,ah=Co;kn=r.lencode[ah+((C&(1<<as+$s)-1)>>as)],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(as+Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=as,P-=as,r.back+=as}if(C>>>=Io,P-=Io,r.back+=Io,r.length=Co,rl===0){r.mode=LIT$1;break}if(rl&32){r.back=-1,r.mode=TYPE$2;break}if(rl&64){e.msg="invalid literal/length code",r.mode=BAD$2;break}r.extra=rl&15,r.mode=LENEXT$1;case LENEXT$1:if(r.extra){for(sh=r.extra;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST$1;case DIST$1:for(;kn=r.distcode[C&(1<<r.distbits)-1],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(!(rl&240)){for(as=Io,$s=rl,ah=Co;kn=r.distcode[ah+((C&(1<<as+$s)-1)>>as)],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(as+Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=as,P-=as,r.back+=as}if(C>>>=Io,P-=Io,r.back+=Io,rl&64){e.msg="invalid distance code",r.mode=BAD$2;break}r.offset=Co,r.extra=rl&15,r.mode=DISTEXT$1;case DISTEXT$1:if(r.extra){for(sh=r.extra;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.offset+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD$2;break}r.mode=MATCH$1;case MATCH$1:if(x===0)break e;if(ge=ze-x,r.offset>ge){if(ge=r.offset-ge,ge>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD$2;break}ge>r.wnext?(ge-=r.wnext,Bt=r.wsize-ge):Bt=r.wnext-ge,ge>r.length&&(ge=r.length),Ur=r.window}else Ur=a,Bt=f-r.offset,ge=r.length;ge>x&&(ge=x),x-=ge,r.length-=ge;do a[f++]=Ur[Bt++];while(--ge);r.length===0&&(r.mode=LEN$1);break;case LIT$1:if(x===0)break e;a[f++]=r.length,x--,r.mode=LEN$1;break;case CHECK$1:if(r.wrap){for(;P<32;){if(o===0)break e;o--,C|=n[s++]<<P,P+=8}if(ze-=x,e.total_out+=ze,r.total+=ze,r.wrap&4&&ze&&(e.adler=r.check=r.flags?crc32_1$1(r.check,a,ze,f-ze):adler32_1$1(r.check,a,ze,f-ze)),ze=x,r.wrap&4&&(r.flags?C:zswap32$1(C))!==r.check){e.msg="incorrect data check",r.mode=BAD$2;break}C=0,P=0}r.mode=LENGTH$1;case LENGTH$1:if(r.wrap&&r.flags){for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=BAD$2;break}C=0,P=0}r.mode=DONE$1;case DONE$1:Zu=Z_STREAM_END$1$1;break e;case BAD$2:Zu=Z_DATA_ERROR$1$1;break e;case MEM$1:return Z_MEM_ERROR$1$1;case SYNC$1:default:return Z_STREAM_ERROR$1$1}return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,(r.wsize||ze!==e.avail_out&&r.mode<BAD$2&&(r.mode<CHECK$1||t!==Z_FINISH$1$1))&&updatewindow$1(e,e.output,e.next_out,ze-e.avail_out),Y-=e.avail_in,ze-=e.avail_out,e.total_in+=Y,e.total_out+=ze,r.total+=ze,r.wrap&4&&ze&&(e.adler=r.check=r.flags?crc32_1$1(r.check,a,ze,e.next_out-ze):adler32_1$1(r.check,a,ze,e.next_out-ze)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$2?128:0)+(r.mode===LEN_$1||r.mode===COPY_$1?256:0),(Y===0&&ze===0||t===Z_FINISH$1$1)&&Zu===Z_OK$1$1&&(Zu=Z_BUF_ERROR$2),Zu},inflateEnd$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1$1},inflateGetHeader$1=(e,t)=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,Z_OK$1$1):Z_STREAM_ERROR$1$1},inflateSetDictionary$1=(e,t)=>{const r=t.length;let n,a,s;return inflateStateCheck$1(e)||(n=e.state,n.wrap!==0&&n.mode!==DICT$1)?Z_STREAM_ERROR$1$1:n.mode===DICT$1&&(a=1,a=adler32_1$1(a,t,r,0),a!==n.check)?Z_DATA_ERROR$1$1:(s=updatewindow$1(e,t,r,r),s?(n.mode=MEM$1,Z_MEM_ERROR$1$1):(n.havedict=1,Z_OK$1$1))};var inflateReset_1$1=inflateReset$1,inflateReset2_1$1=inflateReset2$1,inflateResetKeep_1$1=inflateResetKeep$1,inflateInit_1$1=inflateInit$1,inflateInit2_1$1=inflateInit2$1,inflate_2$1$1=inflate$2$1,inflateEnd_1$1=inflateEnd$1,inflateGetHeader_1$1=inflateGetHeader$1,inflateSetDictionary_1$1=inflateSetDictionary$1,inflateInfo$1="pako inflate (from Nodeca project)",inflate_1$2$1={inflateReset:inflateReset_1$1,inflateReset2:inflateReset2_1$1,inflateResetKeep:inflateResetKeep_1$1,inflateInit:inflateInit_1$1,inflateInit2:inflateInit2_1$1,inflate:inflate_2$1$1,inflateEnd:inflateEnd_1$1,inflateGetHeader:inflateGetHeader_1$1,inflateSetDictionary:inflateSetDictionary_1$1,inflateInfo:inflateInfo$1};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader$1=GZheader$1;const toString$6=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$3,Z_FINISH:Z_FINISH$4,Z_OK:Z_OK$4,Z_STREAM_END:Z_STREAM_END$4,Z_NEED_DICT:Z_NEED_DICT$2,Z_STREAM_ERROR:Z_STREAM_ERROR$3,Z_DATA_ERROR:Z_DATA_ERROR$3,Z_MEM_ERROR:Z_MEM_ERROR$2}=constants$2$2;function Inflate$1$1(e){this.options=common$1.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream$1,this.strm.avail_out=0;let r=inflate_1$2$1.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK$4)throw new Error(messages$1[r]);if(this.header=new gzheader$1,inflate_1$2$1.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings$1.string2buf(t.dictionary):toString$6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1$2$1.inflateSetDictionary(this.strm,t.dictionary),r!==Z_OK$4)))throw new Error(messages$1[r])}Inflate$1$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,f,o;if(this.ended)return!1;for(t===~~t?f=t:f=t===!0?Z_FINISH$4:Z_NO_FLUSH$3,toString$6.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=inflate_1$2$1.inflate(r,f),s===Z_NEED_DICT$2&&a&&(s=inflate_1$2$1.inflateSetDictionary(r,a),s===Z_OK$4?s=inflate_1$2$1.inflate(r,f):s===Z_DATA_ERROR$3&&(s=Z_NEED_DICT$2));r.avail_in>0&&s===Z_STREAM_END$4&&r.state.wrap>0&&e[r.next_in]!==0;)inflate_1$2$1.inflateReset(r),s=inflate_1$2$1.inflate(r,f);switch(s){case Z_STREAM_ERROR$3:case Z_DATA_ERROR$3:case Z_NEED_DICT$2:case Z_MEM_ERROR$2:return this.onEnd(s),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(r.avail_out===0||s===Z_STREAM_END$4))if(this.options.to==="string"){let x=strings$1.utf8border(r.output,r.next_out),C=r.next_out-x,P=strings$1.buf2string(r.output,x);r.next_out=C,r.avail_out=n-C,C&&r.output.set(r.output.subarray(x,x+C),0),this.onData(P)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===Z_OK$4&&o===0)){if(s===Z_STREAM_END$4)return s=inflate_1$2$1.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Inflate$1$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1$1.prototype.onEnd=function(e){e===Z_OK$4&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1$1(e,t){const r=new Inflate$1$1(t);if(r.push(e),r.err)throw r.msg||messages$1[r.err];return r.result}function inflateRaw$1$1(e,t){return t=t||{},t.raw=!0,inflate$1$1(e,t)}var Inflate_1$1$1=Inflate$1$1,inflate_2$2=inflate$1$1,inflateRaw_1$1$1=inflateRaw$1$1,ungzip$1$1=inflate$1$1,constants$b=constants$2$2,inflate_1$1$1={Inflate:Inflate_1$1$1,inflate:inflate_2$2,inflateRaw:inflateRaw_1$1$1,ungzip:ungzip$1$1,constants:constants$b};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate:Inflate$2,inflate:inflate$3,inflateRaw:inflateRaw$2,ungzip:ungzip$2}=inflate_1$1$1;var deflate_1=deflate,Inflate_1=Inflate$2,inflate_1$3=inflate$3;const pngSignature=[137,80,78,71,13,10,26,10],crcTable$1=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable$1[e]=t}const initialCrc=4294967295;function updateCrc(e,t,r){let n=e;for(let a=0;a<r;a++)n=crcTable$1[(n^t[a])&255]^n>>>8;return n}function crc(e,t){return(updateCrc(initialCrc,e,t)^initialCrc)>>>0}var ColorType;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,r={}){super(t);const{checkCrc:n=!1}=r;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),r=this.readChars(4),n=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${r}`);if(this._checkCrc){const a=this.readUint32(),s=t+4,f=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(f!==a)throw new Error(`CRC mismatch for chunk ${r}. Expected ${a}, found ${f}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const r=this.readUint8();this._colorType=r;let n;switch(r){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const r=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let a=0;a<r;a++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(this._colorType===3){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let r=0;for(;r<t;r++){const n=this.readByte();this._palette[r].push(n)}for(;r<this._palette.length;r++)this._palette[r].push(255)}}decodeiCCP(t){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;const a=this.readUint8();if(a!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const s=this.readBytes(t-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:inflate_1$3(s)}}decodetEXt(t){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;this._png.text[r]=this.readChars(t-r.length-1)}decodepHYs(){const t=this.readUint32(),r=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:r,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const r=this._png.height,n=this._png.channels*this._png.depth/8,a=this._png.width*n,s=new Uint8Array(this._png.height*a);let f=empty,o=0,x,C;for(let P=0;P<r;P++){switch(x=t.subarray(o+1,o+1+a),C=s.subarray(P*a,(P+1)*a),t[o]){case 0:unfilterNone(x,C,a);break;case 1:unfilterSub(x,C,a,n);break;case 2:unfilterUp(x,C,f,a);break;case 3:unfilterAverage(x,C,f,a,n);break;case 4:unfilterPaeth(x,C,f,a,n);break;default:throw new Error(`Unsupported filter: ${t[o]}`)}f=C,o+=a+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const P=new Uint16Array(s.buffer);if(osIsLittleEndian)for(let Y=0;Y<P.length;Y++)P[Y]=swap16(P[Y]);this._png.data=P}else this._png.data=s}}function unfilterNone(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function unfilterSub(e,t,r,n){let a=0;for(;a<n;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+t[a-n]&255}function unfilterUp(e,t,r,n){let a=0;if(r.length===0)for(;a<n;a++)t[a]=e[a];else for(;a<n;a++)t[a]=e[a]+r[a]&255}function unfilterAverage(e,t,r,n,a){let s=0;if(r.length===0){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+(t[s-a]>>1)&255}else{for(;s<a;s++)t[s]=e[s]+(r[s]>>1)&255;for(;s<n;s++)t[s]=e[s]+(t[s-a]+r[s]>>1)&255}}function unfilterPaeth(e,t,r,n,a){let s=0;if(r.length===0){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-a]&255}else{for(;s<a;s++)t[s]=e[s]+r[s]&255;for(;s<n;s++)t[s]=e[s]+paethPredictor(t[s-a],r[s],r[s-a])&255}}function paethPredictor(e,t,r){const n=e+t-r,a=Math.abs(n-e),s=Math.abs(n-t),f=Math.abs(n-r);return a<=s&&a<=f?e:s<=f?t:r}function swap16(e){return(e&255)<<8|e>>8&255}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,r={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,r.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:r,channels:n,depth:a,data:s}=this._png,f=n*t,o=new IOBuffer$4().setBigEndian();let x=0;for(let Y=0;Y<r;Y++)if(o.writeByte(0),a===8)x=writeDataBytes(s,o,f,x);else if(a===16)x=writeDataUint16(s,o,f,x);else throw new Error("unreachable");const C=o.toArray(),P=deflate_1(C,this._zlibOptions);this.encodeIDAT(P)}_checkData(t){const{colorType:r,channels:n,depth:a}=getColorType(t),s={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:n,data:t.data,depth:a,text:{}};this._colorType=r;const f=s.width*s.height*n;if(s.data.length!==f)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${f}`);return s}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function getColorType(e){const{channels:t=4,depth:r=8}=e;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(r!==8&&r!==16)throw new RangeError(`unsupported bit depth: ${r}`);const n={channels:t,depth:r,colorType:ColorType.UNKNOWN};switch(t){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(e,t,r,n){for(let a=0;a<r;a++)t.writeByte(e[n++]);return n}function writeDataUint16(e,t,r,n){for(let a=0;a<r;a++)t.writeUint16(e[n++]);return n}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,t){return new PngDecoder(e,t).decode()}function encodePng$1(e,t){return new PngEncoder(e,t).encode()}var encoder={exports:{}};(function(e){function t(n){var a=Math.floor,s=new Array(64),f=new Array(64),o=new Array(64),x=new Array(64),C,P,Y,ze,ge=new Array(65535),Bt=new Array(65535),Ur=new Array(64),kn=new Array(64),Io=[],rl=0,Co=7,as=new Array(64),$s=new Array(64),ah=new Array(64),ch=new Array(256),Zu=new Array(2048),ih,al=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],sh=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],_h=[0,1,2,3,4,5,6,7,8,9,10,11],Ih=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Lh=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Gh=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ud=[0,1,2,3,4,5,6,7,8,9,10,11],Tf=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Kd=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Af(Qh){for(var Yd=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],sd=0;sd<64;sd++){var Zd=a((Yd[sd]*Qh+50)/100);Zd<1?Zd=1:Zd>255&&(Zd=255),s[al[sd]]=Zd}for(var Xh=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ld=0;Ld<64;Ld++){var Kf=a((Xh[Ld]*Qh+50)/100);Kf<1?Kf=1:Kf>255&&(Kf=255),f[al[Ld]]=Kf}for(var If=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Df=0,Jf=0;Jf<8;Jf++)for(var Nf=0;Nf<8;Nf++)o[Df]=1/(s[al[Df]]*If[Jf]*If[Nf]*8),x[Df]=1/(f[al[Df]]*If[Jf]*If[Nf]*8),Df++}function md(Qh,Yd){for(var sd=0,Zd=0,Xh=new Array,Ld=1;Ld<=16;Ld++){for(var Kf=1;Kf<=Qh[Ld];Kf++)Xh[Yd[Zd]]=[],Xh[Yd[Zd]][0]=sd,Xh[Yd[Zd]][1]=Ld,Zd++,sd++;sd*=2}return Xh}function vd(){C=md(sh,_h),P=md(Gh,ud),Y=md(Ih,Lh),ze=md(Tf,Kd)}function qd(){for(var Qh=1,Yd=2,sd=1;sd<=15;sd++){for(var Zd=Qh;Zd<Yd;Zd++)Bt[32767+Zd]=sd,ge[32767+Zd]=[],ge[32767+Zd][1]=sd,ge[32767+Zd][0]=Zd;for(var Xh=-(Yd-1);Xh<=-Qh;Xh++)Bt[32767+Xh]=sd,ge[32767+Xh]=[],ge[32767+Xh][1]=sd,ge[32767+Xh][0]=Yd-1+Xh;Qh<<=1,Yd<<=1}}function Ed(){for(var Qh=0;Qh<256;Qh++)Zu[Qh]=19595*Qh,Zu[Qh+256>>0]=38470*Qh,Zu[Qh+512>>0]=7471*Qh+32768,Zu[Qh+768>>0]=-11059*Qh,Zu[Qh+1024>>0]=-21709*Qh,Zu[Qh+1280>>0]=32768*Qh+8421375,Zu[Qh+1536>>0]=-27439*Qh,Zu[Qh+1792>>0]=-5329*Qh}function Sd(Qh){for(var Yd=Qh[0],sd=Qh[1]-1;sd>=0;)Yd&1<<sd&&(rl|=1<<Co),sd--,Co--,Co<0&&(rl==255?(zd(255),zd(0)):zd(rl),Co=7,rl=0)}function zd(Qh){Io.push(Qh)}function Md(Qh){zd(Qh>>8&255),zd(Qh&255)}function Gd(Qh,Yd){var sd,Zd,Xh,Ld,Kf,If,Df,Jf,Nf=0,Wf,Mp=8,Sp=64;for(Wf=0;Wf<Mp;++Wf){sd=Qh[Nf],Zd=Qh[Nf+1],Xh=Qh[Nf+2],Ld=Qh[Nf+3],Kf=Qh[Nf+4],If=Qh[Nf+5],Df=Qh[Nf+6],Jf=Qh[Nf+7];var Pp=sd+Jf,Yf=sd-Jf,qp=Zd+Df,sm=Zd-Df,Xd=Xh+If,Op=Xh-If,rm=Ld+Kf,Sm=Ld-Kf,hp=Pp+rm,Em=Pp-rm,Qp=qp+Xd,lm=qp-Xd;Qh[Nf]=hp+Qp,Qh[Nf+4]=hp-Qp;var Dd=(lm+Em)*.707106781;Qh[Nf+2]=Em+Dd,Qh[Nf+6]=Em-Dd,hp=Sm+Op,Qp=Op+sm,lm=sm+Yf;var Hf=(hp-lm)*.382683433,mh=.5411961*hp+Hf,Jh=1.306562965*lm+Hf,Wu=Qp*.707106781,sl=Yf+Wu,Gn=Yf-Wu;Qh[Nf+5]=Gn+mh,Qh[Nf+3]=Gn-mh,Qh[Nf+1]=sl+Jh,Qh[Nf+7]=sl-Jh,Nf+=8}for(Nf=0,Wf=0;Wf<Mp;++Wf){sd=Qh[Nf],Zd=Qh[Nf+8],Xh=Qh[Nf+16],Ld=Qh[Nf+24],Kf=Qh[Nf+32],If=Qh[Nf+40],Df=Qh[Nf+48],Jf=Qh[Nf+56];var _n=sd+Jf,cs=sd-Jf,$u=Zd+Df,eh=Zd-Df,nh=Xh+If,uh=Xh-If,dh=Ld+Kf,vh=Ld-Kf,Ph=_n+dh,zh=_n-dh,Ad=$u+nh,wd=$u-nh;Qh[Nf]=Ph+Ad,Qh[Nf+32]=Ph-Ad;var Qd=(wd+zh)*.707106781;Qh[Nf+16]=zh+Qd,Qh[Nf+48]=zh-Qd,Ph=vh+uh,Ad=uh+eh,wd=eh+cs;var xf=(Ph-wd)*.382683433,zf=.5411961*Ph+xf,np=1.306562965*wd+xf,Ah=Ad*.707106781,mf=cs+Ah,Od=cs-Ah;Qh[Nf+40]=Od+zf,Qh[Nf+24]=Od-zf,Qh[Nf+8]=mf+np,Qh[Nf+56]=mf-np,Nf++}var qf;for(Wf=0;Wf<Sp;++Wf)qf=Qh[Wf]*Yd[Wf],Ur[Wf]=qf>0?qf+.5|0:qf-.5|0;return Ur}function bf(){Md(65504),Md(16),zd(74),zd(70),zd(73),zd(70),zd(0),zd(1),zd(1),zd(0),Md(1),Md(1),zd(0),zd(0)}function Id(Qh){if(Qh){Md(65505),Qh[0]===69&&Qh[1]===120&&Qh[2]===105&&Qh[3]===102?Md(Qh.length+2):(Md(Qh.length+5+2),zd(69),zd(120),zd(105),zd(102),zd(0));for(var Yd=0;Yd<Qh.length;Yd++)zd(Qh[Yd])}}function td(Qh,Yd){Md(65472),Md(17),zd(8),Md(Yd),Md(Qh),zd(3),zd(1),zd(17),zd(0),zd(2),zd(17),zd(1),zd(3),zd(17),zd(1)}function Fd(){Md(65499),Md(132),zd(0);for(var Qh=0;Qh<64;Qh++)zd(s[Qh]);zd(1);for(var Yd=0;Yd<64;Yd++)zd(f[Yd])}function rp(){Md(65476),Md(418),zd(0);for(var Qh=0;Qh<16;Qh++)zd(sh[Qh+1]);for(var Yd=0;Yd<=11;Yd++)zd(_h[Yd]);zd(16);for(var sd=0;sd<16;sd++)zd(Ih[sd+1]);for(var Zd=0;Zd<=161;Zd++)zd(Lh[Zd]);zd(1);for(var Xh=0;Xh<16;Xh++)zd(Gh[Xh+1]);for(var Ld=0;Ld<=11;Ld++)zd(ud[Ld]);zd(17);for(var Kf=0;Kf<16;Kf++)zd(Tf[Kf+1]);for(var If=0;If<=161;If++)zd(Kd[If])}function jf(Qh){typeof Qh>"u"||Qh.constructor!==Array||Qh.forEach(Yd=>{if(typeof Yd=="string"){Md(65534);var sd=Yd.length;Md(sd+2);var Zd;for(Zd=0;Zd<sd;Zd++)zd(Yd.charCodeAt(Zd))}})}function yd(){Md(65498),Md(12),zd(3),zd(1),zd(0),zd(2),zd(17),zd(3),zd(17),zd(0),zd(63),zd(0)}function Jd(Qh,Yd,sd,Zd,Xh){for(var Ld=Xh[0],Kf=Xh[240],If,Df=16,Jf=63,Nf=64,Wf=Gd(Qh,Yd),Mp=0;Mp<Nf;++Mp)kn[al[Mp]]=Wf[Mp];var Sp=kn[0]-sd;sd=kn[0],Sp==0?Sd(Zd[0]):(If=32767+Sp,Sd(Zd[Bt[If]]),Sd(ge[If]));for(var Pp=63;Pp>0&&kn[Pp]==0;Pp--);if(Pp==0)return Sd(Ld),sd;for(var Yf=1,qp;Yf<=Pp;){for(var sm=Yf;kn[Yf]==0&&Yf<=Pp;++Yf);var Xd=Yf-sm;if(Xd>=Df){qp=Xd>>4;for(var Op=1;Op<=qp;++Op)Sd(Kf);Xd=Xd&15}If=32767+kn[Yf],Sd(Xh[(Xd<<4)+Bt[If]]),Sd(ge[If]),Yf++}return Pp!=Jf&&Sd(Ld),sd}function op(){for(var Qh=String.fromCharCode,Yd=0;Yd<256;Yd++)ch[Yd]=Qh(Yd)}this.encode=function(Qh,Yd){new Date().getTime(),Yd&&bp(Yd),Io=new Array,rl=0,Co=7,Md(65496),bf(),jf(Qh.comments),Id(Qh.exifBuffer),Fd(),td(Qh.width,Qh.height),rp(),yd();var sd=0,Zd=0,Xh=0;rl=0,Co=7,this.encode.displayName="_encode_";for(var Ld=Qh.data,Kf=Qh.width,If=Qh.height,Df=Kf*4,Jf,Nf=0,Wf,Mp,Sp,Pp,Yf,qp,sm,Xd;Nf<If;){for(Jf=0;Jf<Df;){for(Pp=Df*Nf+Jf,Yf=Pp,qp=-1,sm=0,Xd=0;Xd<64;Xd++)sm=Xd>>3,qp=(Xd&7)*4,Yf=Pp+sm*Df+qp,Nf+sm>=If&&(Yf-=Df*(Nf+1+sm-If)),Jf+qp>=Df&&(Yf-=Jf+qp-Df+4),Wf=Ld[Yf++],Mp=Ld[Yf++],Sp=Ld[Yf++],as[Xd]=(Zu[Wf]+Zu[Mp+256>>0]+Zu[Sp+512>>0]>>16)-128,$s[Xd]=(Zu[Wf+768>>0]+Zu[Mp+1024>>0]+Zu[Sp+1280>>0]>>16)-128,ah[Xd]=(Zu[Wf+1280>>0]+Zu[Mp+1536>>0]+Zu[Sp+1792>>0]>>16)-128;sd=Jd(as,o,sd,C,Y),Zd=Jd($s,x,Zd,P,ze),Xh=Jd(ah,x,Xh,P,ze),Jf+=32}Nf+=8}if(Co>=0){var Op=[];Op[1]=Co+1,Op[0]=(1<<Co+1)-1,Sd(Op)}return Md(65497),Buffer.from(Io)};function bp(Qh){if(Qh<=0&&(Qh=1),Qh>100&&(Qh=100),ih!=Qh){var Yd=0;Qh<50?Yd=Math.floor(5e3/Qh):Yd=Math.floor(200-Qh*2),Af(Yd),ih=Qh}}function fp(){var Qh=new Date().getTime();n||(n=50),op(),vd(),qd(),Ed(),bp(n),new Date().getTime()-Qh}fp()}e.exports=r;function r(n,a){typeof a>"u"&&(a=50);var s=new t(a),f=s.encode(n,a);return{data:f,width:n.width,height:n.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(e){var t=function(){var a=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,f=799,o=3406,x=2276,C=1567,P=3784,Y=5793,ze=2896;function ge(){}function Bt($s,ah){for(var ch=0,Zu=[],ih,al,sh=16;sh>0&&!$s[sh-1];)sh--;Zu.push({children:[],index:0});var _h=Zu[0],Ih;for(ih=0;ih<sh;ih++){for(al=0;al<$s[ih];al++){for(_h=Zu.pop(),_h.children[_h.index]=ah[ch];_h.index>0;){if(Zu.length===0)throw new Error("Could not recreate Huffman Table");_h=Zu.pop()}for(_h.index++,Zu.push(_h);Zu.length<=ih;)Zu.push(Ih={children:[],index:0}),_h.children[_h.index]=Ih.children,_h=Ih;ch++}ih+1<sh&&(Zu.push(Ih={children:[],index:0}),_h.children[_h.index]=Ih.children,_h=Ih)}return Zu[0].children}function Ur($s,ah,ch,Zu,ih,al,sh,_h,Ih,Lh){ch.precision,ch.samplesPerLine,ch.scanLines;var Gh=ch.mcusPerLine,ud=ch.progressive;ch.maxH,ch.maxV;var Tf=ah,Kd=0,Af=0;function md(){if(Af>0)return Af--,Kd>>Af&1;if(Kd=$s[ah++],Kd==255){var If=$s[ah++];if(If)throw new Error("unexpected marker: "+(Kd<<8|If).toString(16))}return Af=7,Kd>>>7}function vd(If){for(var Df=If,Jf;(Jf=md())!==null;){if(Df=Df[Jf],typeof Df=="number")return Df;if(typeof Df!="object")throw new Error("invalid huffman sequence")}return null}function qd(If){for(var Df=0;If>0;){var Jf=md();if(Jf===null)return;Df=Df<<1|Jf,If--}return Df}function Ed(If){var Df=qd(If);return Df>=1<<If-1?Df:Df+(-1<<If)+1}function Sd(If,Df){var Jf=vd(If.huffmanTableDC),Nf=Jf===0?0:Ed(Jf);Df[0]=If.pred+=Nf;for(var Wf=1;Wf<64;){var Mp=vd(If.huffmanTableAC),Sp=Mp&15,Pp=Mp>>4;if(Sp===0){if(Pp<15)break;Wf+=16;continue}Wf+=Pp;var Yf=a[Wf];Df[Yf]=Ed(Sp),Wf++}}function zd(If,Df){var Jf=vd(If.huffmanTableDC),Nf=Jf===0?0:Ed(Jf)<<Ih;Df[0]=If.pred+=Nf}function Md(If,Df){Df[0]|=md()<<Ih}var Gd=0;function bf(If,Df){if(Gd>0){Gd--;return}for(var Jf=al,Nf=sh;Jf<=Nf;){var Wf=vd(If.huffmanTableAC),Mp=Wf&15,Sp=Wf>>4;if(Mp===0){if(Sp<15){Gd=qd(Sp)+(1<<Sp)-1;break}Jf+=16;continue}Jf+=Sp;var Pp=a[Jf];Df[Pp]=Ed(Mp)*(1<<Ih),Jf++}}var Id=0,td;function Fd(If,Df){for(var Jf=al,Nf=sh,Wf=0;Jf<=Nf;){var Mp=a[Jf],Sp=Df[Mp]<0?-1:1;switch(Id){case 0:var Pp=vd(If.huffmanTableAC),Yf=Pp&15,Wf=Pp>>4;if(Yf===0)Wf<15?(Gd=qd(Wf)+(1<<Wf),Id=4):(Wf=16,Id=1);else{if(Yf!==1)throw new Error("invalid ACn encoding");td=Ed(Yf),Id=Wf?2:3}continue;case 1:case 2:Df[Mp]?Df[Mp]+=(md()<<Ih)*Sp:(Wf--,Wf===0&&(Id=Id==2?3:0));break;case 3:Df[Mp]?Df[Mp]+=(md()<<Ih)*Sp:(Df[Mp]=td<<Ih,Id=0);break;case 4:Df[Mp]&&(Df[Mp]+=(md()<<Ih)*Sp);break}Jf++}Id===4&&(Gd--,Gd===0&&(Id=0))}function rp(If,Df,Jf,Nf,Wf){var Mp=Jf/Gh|0,Sp=Jf%Gh,Pp=Mp*If.v+Nf,Yf=Sp*If.h+Wf;If.blocks[Pp]===void 0&&Lh.tolerantDecoding||Df(If,If.blocks[Pp][Yf])}function jf(If,Df,Jf){var Nf=Jf/If.blocksPerLine|0,Wf=Jf%If.blocksPerLine;If.blocks[Nf]===void 0&&Lh.tolerantDecoding||Df(If,If.blocks[Nf][Wf])}var yd=Zu.length,Jd,op,bp,fp,Qh,Yd;ud?al===0?Yd=_h===0?zd:Md:Yd=_h===0?bf:Fd:Yd=Sd;var sd=0,Zd,Xh;yd==1?Xh=Zu[0].blocksPerLine*Zu[0].blocksPerColumn:Xh=Gh*ch.mcusPerColumn,ih||(ih=Xh);for(var Ld,Kf;sd<Xh;){for(op=0;op<yd;op++)Zu[op].pred=0;if(Gd=0,yd==1)for(Jd=Zu[0],Qh=0;Qh<ih;Qh++)jf(Jd,Yd,sd),sd++;else for(Qh=0;Qh<ih;Qh++){for(op=0;op<yd;op++)for(Jd=Zu[op],Ld=Jd.h,Kf=Jd.v,bp=0;bp<Kf;bp++)for(fp=0;fp<Ld;fp++)rp(Jd,Yd,sd,bp,fp);if(sd++,sd===Xh)break}if(sd===Xh)do{if($s[ah]===255&&$s[ah+1]!==0)break;ah+=1}while(ah<$s.length-2);if(Af=0,Zd=$s[ah]<<8|$s[ah+1],Zd<65280)throw new Error("marker was not found");if(Zd>=65488&&Zd<=65495)ah+=2;else break}return ah-Tf}function kn($s,ah){var ch=[],Zu=ah.blocksPerLine,ih=ah.blocksPerColumn,al=Zu<<3,sh=new Int32Array(64),_h=new Uint8Array(64);function Ih(qd,Ed,Sd){var zd=ah.quantizationTable,Md,Gd,bf,Id,td,Fd,rp,jf,yd,Jd=Sd,op;for(op=0;op<64;op++)Jd[op]=qd[op]*zd[op];for(op=0;op<8;++op){var bp=8*op;if(Jd[1+bp]==0&&Jd[2+bp]==0&&Jd[3+bp]==0&&Jd[4+bp]==0&&Jd[5+bp]==0&&Jd[6+bp]==0&&Jd[7+bp]==0){yd=Y*Jd[0+bp]+512>>10,Jd[0+bp]=yd,Jd[1+bp]=yd,Jd[2+bp]=yd,Jd[3+bp]=yd,Jd[4+bp]=yd,Jd[5+bp]=yd,Jd[6+bp]=yd,Jd[7+bp]=yd;continue}Md=Y*Jd[0+bp]+128>>8,Gd=Y*Jd[4+bp]+128>>8,bf=Jd[2+bp],Id=Jd[6+bp],td=ze*(Jd[1+bp]-Jd[7+bp])+128>>8,jf=ze*(Jd[1+bp]+Jd[7+bp])+128>>8,Fd=Jd[3+bp]<<4,rp=Jd[5+bp]<<4,yd=Md-Gd+1>>1,Md=Md+Gd+1>>1,Gd=yd,yd=bf*P+Id*C+128>>8,bf=bf*C-Id*P+128>>8,Id=yd,yd=td-rp+1>>1,td=td+rp+1>>1,rp=yd,yd=jf+Fd+1>>1,Fd=jf-Fd+1>>1,jf=yd,yd=Md-Id+1>>1,Md=Md+Id+1>>1,Id=yd,yd=Gd-bf+1>>1,Gd=Gd+bf+1>>1,bf=yd,yd=td*x+jf*o+2048>>12,td=td*o-jf*x+2048>>12,jf=yd,yd=Fd*f+rp*s+2048>>12,Fd=Fd*s-rp*f+2048>>12,rp=yd,Jd[0+bp]=Md+jf,Jd[7+bp]=Md-jf,Jd[1+bp]=Gd+rp,Jd[6+bp]=Gd-rp,Jd[2+bp]=bf+Fd,Jd[5+bp]=bf-Fd,Jd[3+bp]=Id+td,Jd[4+bp]=Id-td}for(op=0;op<8;++op){var fp=op;if(Jd[8+fp]==0&&Jd[16+fp]==0&&Jd[24+fp]==0&&Jd[32+fp]==0&&Jd[40+fp]==0&&Jd[48+fp]==0&&Jd[56+fp]==0){yd=Y*Sd[op+0]+8192>>14,Jd[0+fp]=yd,Jd[8+fp]=yd,Jd[16+fp]=yd,Jd[24+fp]=yd,Jd[32+fp]=yd,Jd[40+fp]=yd,Jd[48+fp]=yd,Jd[56+fp]=yd;continue}Md=Y*Jd[0+fp]+2048>>12,Gd=Y*Jd[32+fp]+2048>>12,bf=Jd[16+fp],Id=Jd[48+fp],td=ze*(Jd[8+fp]-Jd[56+fp])+2048>>12,jf=ze*(Jd[8+fp]+Jd[56+fp])+2048>>12,Fd=Jd[24+fp],rp=Jd[40+fp],yd=Md-Gd+1>>1,Md=Md+Gd+1>>1,Gd=yd,yd=bf*P+Id*C+2048>>12,bf=bf*C-Id*P+2048>>12,Id=yd,yd=td-rp+1>>1,td=td+rp+1>>1,rp=yd,yd=jf+Fd+1>>1,Fd=jf-Fd+1>>1,jf=yd,yd=Md-Id+1>>1,Md=Md+Id+1>>1,Id=yd,yd=Gd-bf+1>>1,Gd=Gd+bf+1>>1,bf=yd,yd=td*x+jf*o+2048>>12,td=td*o-jf*x+2048>>12,jf=yd,yd=Fd*f+rp*s+2048>>12,Fd=Fd*s-rp*f+2048>>12,rp=yd,Jd[0+fp]=Md+jf,Jd[56+fp]=Md-jf,Jd[8+fp]=Gd+rp,Jd[48+fp]=Gd-rp,Jd[16+fp]=bf+Fd,Jd[40+fp]=bf-Fd,Jd[24+fp]=Id+td,Jd[32+fp]=Id-td}for(op=0;op<64;++op){var Qh=128+(Jd[op]+8>>4);Ed[op]=Qh<0?0:Qh>255?255:Qh}}as(al*ih*8);for(var Lh,Gh,ud=0;ud<ih;ud++){var Tf=ud<<3;for(Lh=0;Lh<8;Lh++)ch.push(new Uint8Array(al));for(var Kd=0;Kd<Zu;Kd++){Ih(ah.blocks[ud][Kd],_h,sh);var Af=0,md=Kd<<3;for(Gh=0;Gh<8;Gh++){var vd=ch[Tf+Gh];for(Lh=0;Lh<8;Lh++)vd[md+Lh]=_h[Af++]}}}return ch}function Io($s){return $s<0?0:$s>255?255:$s}ge.prototype={load:function(ah){var ch=new XMLHttpRequest;ch.open("GET",ah,!0),ch.responseType="arraybuffer",ch.onload=function(){var Zu=new Uint8Array(ch.response||ch.mozResponseArrayBuffer);this.parse(Zu),this.onload&&this.onload()}.bind(this),ch.send(null)},parse:function(ah){var ch=this.opts.maxResolutionInMP*1e3*1e3,Zu=0;ah.length;function ih(){var Sp=ah[Zu]<<8|ah[Zu+1];return Zu+=2,Sp}function al(){var Sp=ih(),Pp=ah.subarray(Zu,Zu+Sp-2);return Zu+=Pp.length,Pp}function sh(Sp){var Pp=1,Yf=1,qp,sm;for(sm in Sp.components)Sp.components.hasOwnProperty(sm)&&(qp=Sp.components[sm],Pp<qp.h&&(Pp=qp.h),Yf<qp.v&&(Yf=qp.v));var Xd=Math.ceil(Sp.samplesPerLine/8/Pp),Op=Math.ceil(Sp.scanLines/8/Yf);for(sm in Sp.components)if(Sp.components.hasOwnProperty(sm)){qp=Sp.components[sm];var rm=Math.ceil(Math.ceil(Sp.samplesPerLine/8)*qp.h/Pp),Sm=Math.ceil(Math.ceil(Sp.scanLines/8)*qp.v/Yf),hp=Xd*qp.h,Em=Op*qp.v,Qp=Em*hp,lm=[];as(Qp*256);for(var Dd=0;Dd<Em;Dd++){for(var Hf=[],mh=0;mh<hp;mh++)Hf.push(new Int32Array(64));lm.push(Hf)}qp.blocksPerLine=rm,qp.blocksPerColumn=Sm,qp.blocks=lm}Sp.maxH=Pp,Sp.maxV=Yf,Sp.mcusPerLine=Xd,Sp.mcusPerColumn=Op}var _h=null,Ih=null,Lh,Gh,ud=[],Tf=[],Kd=[],Af=[],md=ih(),vd=-1;if(this.comments=[],md!=65496)throw new Error("SOI not found");for(md=ih();md!=65497;){var qd,Ed;switch(md){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Sd=al();if(md===65534){var zd=String.fromCharCode.apply(null,Sd);this.comments.push(zd)}md===65504&&Sd[0]===74&&Sd[1]===70&&Sd[2]===73&&Sd[3]===70&&Sd[4]===0&&(_h={version:{major:Sd[5],minor:Sd[6]},densityUnits:Sd[7],xDensity:Sd[8]<<8|Sd[9],yDensity:Sd[10]<<8|Sd[11],thumbWidth:Sd[12],thumbHeight:Sd[13],thumbData:Sd.subarray(14,14+3*Sd[12]*Sd[13])}),md===65505&&Sd[0]===69&&Sd[1]===120&&Sd[2]===105&&Sd[3]===102&&Sd[4]===0&&(this.exifBuffer=Sd.subarray(5,Sd.length)),md===65518&&Sd[0]===65&&Sd[1]===100&&Sd[2]===111&&Sd[3]===98&&Sd[4]===101&&Sd[5]===0&&(Ih={version:Sd[6],flags0:Sd[7]<<8|Sd[8],flags1:Sd[9]<<8|Sd[10],transformCode:Sd[11]});break;case 65499:for(var Md=ih(),Gd=Md+Zu-2;Zu<Gd;){var bf=ah[Zu++];as(256);var Id=new Int32Array(64);if(bf>>4)if(bf>>4===1)for(Ed=0;Ed<64;Ed++){var td=a[Ed];Id[td]=ih()}else throw new Error("DQT: invalid table spec");else for(Ed=0;Ed<64;Ed++){var td=a[Ed];Id[td]=ah[Zu++]}ud[bf&15]=Id}break;case 65472:case 65473:case 65474:ih(),Lh={},Lh.extended=md===65473,Lh.progressive=md===65474,Lh.precision=ah[Zu++],Lh.scanLines=ih(),Lh.samplesPerLine=ih(),Lh.components={},Lh.componentsOrder=[];var Fd=Lh.scanLines*Lh.samplesPerLine;if(Fd>ch){var rp=Math.ceil((Fd-ch)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${rp}MP`)}var jf=ah[Zu++],yd;for(qd=0;qd<jf;qd++){yd=ah[Zu];var Jd=ah[Zu+1]>>4,op=ah[Zu+1]&15,bp=ah[Zu+2];if(Jd<=0||op<=0)throw new Error("Invalid sampling factor, expected values above 0");Lh.componentsOrder.push(yd),Lh.components[yd]={h:Jd,v:op,quantizationIdx:bp},Zu+=3}sh(Lh),Tf.push(Lh);break;case 65476:var fp=ih();for(qd=2;qd<fp;){var Qh=ah[Zu++],Yd=new Uint8Array(16),sd=0;for(Ed=0;Ed<16;Ed++,Zu++)sd+=Yd[Ed]=ah[Zu];as(16+sd);var Zd=new Uint8Array(sd);for(Ed=0;Ed<sd;Ed++,Zu++)Zd[Ed]=ah[Zu];qd+=17+sd,(Qh>>4?Kd:Af)[Qh&15]=Bt(Yd,Zd)}break;case 65501:ih(),Gh=ih();break;case 65500:ih(),ih();break;case 65498:ih();var Xh=ah[Zu++],Ld=[],Kf;for(qd=0;qd<Xh;qd++){Kf=Lh.components[ah[Zu++]];var If=ah[Zu++];Kf.huffmanTableDC=Af[If>>4],Kf.huffmanTableAC=Kd[If&15],Ld.push(Kf)}var Df=ah[Zu++],Jf=ah[Zu++],Nf=ah[Zu++],Wf=Ur(ah,Zu,Lh,Ld,Gh,Df,Jf,Nf>>4,Nf&15,this.opts);Zu+=Wf;break;case 65535:ah[Zu]!==255&&Zu--;break;default:if(ah[Zu-3]==255&&ah[Zu-2]>=192&&ah[Zu-2]<=254){Zu-=3;break}else if(md===224||md==225){if(vd!==-1)throw new Error(`first unknown JPEG marker at offset ${vd.toString(16)}, second unknown JPEG marker ${md.toString(16)} at offset ${(Zu-1).toString(16)}`);vd=Zu-1;const Sp=ih();if(ah[Zu+Sp-2]===255){Zu+=Sp-2;break}}throw new Error("unknown JPEG marker "+md.toString(16))}md=ih()}if(Tf.length!=1)throw new Error("only single frame JPEGs supported");for(var qd=0;qd<Tf.length;qd++){var Mp=Tf[qd].components;for(var Ed in Mp)Mp[Ed].quantizationTable=ud[Mp[Ed].quantizationIdx],delete Mp[Ed].quantizationIdx}this.width=Lh.samplesPerLine,this.height=Lh.scanLines,this.jfif=_h,this.adobe=Ih,this.components=[];for(var qd=0;qd<Lh.componentsOrder.length;qd++){var Kf=Lh.components[Lh.componentsOrder[qd]];this.components.push({lines:kn(Lh,Kf),scaleX:Kf.h/Lh.maxH,scaleY:Kf.v/Lh.maxV})}},getData:function(ah,ch){var Zu=this.width/ah,ih=this.height/ch,al,sh,_h,Ih,Lh,Gh,ud,Tf,Kd,Af,md=0,vd,qd,Ed,Sd,zd,Md,Gd,bf,Id,td,Fd,rp=ah*ch*this.components.length;as(rp);var jf=new Uint8Array(rp);switch(this.components.length){case 1:for(al=this.components[0],Af=0;Af<ch;Af++)for(Lh=al.lines[0|Af*al.scaleY*ih],Kd=0;Kd<ah;Kd++)vd=Lh[0|Kd*al.scaleX*Zu],jf[md++]=vd;break;case 2:for(al=this.components[0],sh=this.components[1],Af=0;Af<ch;Af++)for(Lh=al.lines[0|Af*al.scaleY*ih],Gh=sh.lines[0|Af*sh.scaleY*ih],Kd=0;Kd<ah;Kd++)vd=Lh[0|Kd*al.scaleX*Zu],jf[md++]=vd,vd=Gh[0|Kd*sh.scaleX*Zu],jf[md++]=vd;break;case 3:for(Fd=!0,this.adobe&&this.adobe.transformCode?Fd=!0:typeof this.opts.colorTransform<"u"&&(Fd=!!this.opts.colorTransform),al=this.components[0],sh=this.components[1],_h=this.components[2],Af=0;Af<ch;Af++)for(Lh=al.lines[0|Af*al.scaleY*ih],Gh=sh.lines[0|Af*sh.scaleY*ih],ud=_h.lines[0|Af*_h.scaleY*ih],Kd=0;Kd<ah;Kd++)Fd?(vd=Lh[0|Kd*al.scaleX*Zu],qd=Gh[0|Kd*sh.scaleX*Zu],Ed=ud[0|Kd*_h.scaleX*Zu],bf=Io(vd+1.402*(Ed-128)),Id=Io(vd-.3441363*(qd-128)-.71413636*(Ed-128)),td=Io(vd+1.772*(qd-128))):(bf=Lh[0|Kd*al.scaleX*Zu],Id=Gh[0|Kd*sh.scaleX*Zu],td=ud[0|Kd*_h.scaleX*Zu]),jf[md++]=bf,jf[md++]=Id,jf[md++]=td;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(Fd=!1,this.adobe&&this.adobe.transformCode?Fd=!0:typeof this.opts.colorTransform<"u"&&(Fd=!!this.opts.colorTransform),al=this.components[0],sh=this.components[1],_h=this.components[2],Ih=this.components[3],Af=0;Af<ch;Af++)for(Lh=al.lines[0|Af*al.scaleY*ih],Gh=sh.lines[0|Af*sh.scaleY*ih],ud=_h.lines[0|Af*_h.scaleY*ih],Tf=Ih.lines[0|Af*Ih.scaleY*ih],Kd=0;Kd<ah;Kd++)Fd?(vd=Lh[0|Kd*al.scaleX*Zu],qd=Gh[0|Kd*sh.scaleX*Zu],Ed=ud[0|Kd*_h.scaleX*Zu],Sd=Tf[0|Kd*Ih.scaleX*Zu],zd=255-Io(vd+1.402*(Ed-128)),Md=255-Io(vd-.3441363*(qd-128)-.71413636*(Ed-128)),Gd=255-Io(vd+1.772*(qd-128))):(zd=Lh[0|Kd*al.scaleX*Zu],Md=Gh[0|Kd*sh.scaleX*Zu],Gd=ud[0|Kd*_h.scaleX*Zu],Sd=Tf[0|Kd*Ih.scaleX*Zu]),jf[md++]=255-zd,jf[md++]=255-Md,jf[md++]=255-Gd,jf[md++]=255-Sd;break;default:throw new Error("Unsupported color mode")}return jf},copyToImageData:function(ah,ch){var Zu=ah.width,ih=ah.height,al=ah.data,sh=this.getData(Zu,ih),_h=0,Ih=0,Lh,Gh,ud,Tf,Kd,Af,md,vd,qd;switch(this.components.length){case 1:for(Gh=0;Gh<ih;Gh++)for(Lh=0;Lh<Zu;Lh++)ud=sh[_h++],al[Ih++]=ud,al[Ih++]=ud,al[Ih++]=ud,ch&&(al[Ih++]=255);break;case 3:for(Gh=0;Gh<ih;Gh++)for(Lh=0;Lh<Zu;Lh++)md=sh[_h++],vd=sh[_h++],qd=sh[_h++],al[Ih++]=md,al[Ih++]=vd,al[Ih++]=qd,ch&&(al[Ih++]=255);break;case 4:for(Gh=0;Gh<ih;Gh++)for(Lh=0;Lh<Zu;Lh++)Kd=sh[_h++],Af=sh[_h++],ud=sh[_h++],Tf=sh[_h++],md=255-Io(Kd*(1-Tf/255)+Tf),vd=255-Io(Af*(1-Tf/255)+Tf),qd=255-Io(ud*(1-Tf/255)+Tf),al[Ih++]=md,al[Ih++]=vd,al[Ih++]=qd,ch&&(al[Ih++]=255);break;default:throw new Error("Unsupported color mode")}}};var rl=0,Co=0;function as($s=0){var ah=rl+$s;if(ah>Co){var ch=Math.ceil((ah-Co)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ch}MB`)}rl=ah}return ge.resetMaxMemoryUsage=function($s){rl=0,Co=$s},ge.getBytesAllocated=function(){return rl},ge.requestMemoryAllocation=as,ge}();e.exports=r;function r(n,a={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},f={...s,...a},o=new Uint8Array(n),x=new t;x.opts=f,t.resetMaxMemoryUsage(f.maxMemoryUsageInMB*1024*1024),x.parse(o);var C=f.formatAsRGBA?4:3,P=x.width*x.height*C;try{t.requestMemoryAllocation(P);var Y={width:x.width,height:x.height,exifBuffer:x.exifBuffer,data:f.useTArray?new Uint8Array(P):Buffer.alloc(P)};x.comments.length>0&&(Y.comments=x.comments)}catch(ze){throw ze instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+P):ze instanceof ReferenceError&&ze.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):ze}return x.copyToImageData(Y,f.formatAsRGBA),Y}})(decoder);var decoderExports=decoder.exports,encode$2=encoderExports,decode$5=decoderExports,jpegJs={encode:encode$2,decode:decode$5};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode$1(e){let t,r=e.length,n="";for(t=0;t<r;t+=3)n+=chars[e[t]>>2],n+=chars[(e[t]&3)<<4|e[t+1]>>4],n+=chars[(e[t+1]&15)<<2|e[t+2]>>6],n+=chars[e[t+2]&63];return r%3===2?n=`${n.substring(0,n.length-1)}=`:r%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$4(e){let t=e.length*.75,r=e.length,n=0,a,s,f,o;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const x=new Uint8Array(t);for(let C=0;C<r;C+=4)a=lookup[e.charCodeAt(C)],s=lookup[e.charCodeAt(C+1)],f=lookup[e.charCodeAt(C+2)],o=lookup[e.charCodeAt(C+3)],x[n++]=a<<2|s>>4,x[n++]=(s&15)<<4|f>>2,x[n++]=(f&3)<<6|o&63;return x}function toBase64URL(e,t){const r=encode$1(e);return`data:${t};base64,${r}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(e,t){let r=self.document.createElement("canvas");return r.width=e,r.height=t,r}function fetchBinary(e,{withCredentials:t=!1}={}){return new Promise(function(r,n){let a=new self.XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.withCredentials=t,a.onload=function(s){this.status!==200?n(s):r(this.response)},a.onerror=n,a.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,t={}){const r={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJs.encode(r,t.quality).data}function encodePng(e,t){const r={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(r.depth===1||r.depth===32)&&(r.depth=8,r.channels=4,r.data=e.getRGBAData()),encodePng$1(r,t)}const exportMethods={save(e,t={}){const{useCanvas:r=!1,encoder:n=void 0}=t;let{format:a}=t;if(!a){const s=/\.(?<format>[a-zA-Z]+)$/.exec(e);s&&(a=s.groups.format.toLowerCase())}if(!a)throw new Error("file format not provided");return new Promise((s,f)=>{let o,x;switch(a.toLowerCase()){case"png":{r?o=this.getCanvas().pngStream():x=encodePng(this,n);break}case"jpg":case"jpeg":r?o=this.getCanvas().jpegStream():x=encodeJpeg(this,n);break;case"bmp":x=encode$3(this,n);break;default:throw new RangeError(`invalid output format: ${a}`)}if(o){let C=createWriteStream();C.on("finish",s),C.on("error",f),o.pipe(C)}else x&&writeFile()})},toDataURL(e="image/png",t={}){typeof e=="object"&&(t=e,e="image/png");const{useCanvas:r=!1,encoder:n=void 0}=t;e=getType(e);function a(s,f){const o=s(f,n);return toBase64URL(o,e)}return e==="image/bmp"?a(encode$3,this):e==="image/png"&&!r?a(encodePng,this):e==="image/jpeg"&&!r?a(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:t="png",encoder:r=void 0}=e;switch(t.toLowerCase()){case"png":return encodePng(this,r);case"jpeg":case"jpg":return encodeJpeg(this,r);case"bmp":return encode$3(this,r);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(e="image/png",t={}){if(t.async)return this.toDataURL(e,t).then(function(r){return r.substring(r.indexOf(",")+1)});{const r=this.toDataURL(e,t);return r.substring(r.indexOf(",")+1)}},toBlob(e="image/png",t=.8){return canvasToBlob(this.getCanvas(),e,t)},getCanvas(){const e=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(e,0,0),t}};function setExportMethods(e){for(const t in exportMethods)e.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name="has-own",version$3="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$3={name,version:version$3,description,main,scripts,author,license,repository,homepage,devDependencies};(function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=t=function(a,s){return r.call(s,a)},t.version=require$$0$3.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,t,r={}){let{inPlace:n=!1,returnThis:a=!0,partialArgs:s=[]}=r;return n?Image$1.prototype[e]=function(...f){this.computed=null;let o=t.apply(this,[...s,...f]);return a?this:o}:Image$1.prototype[e]=function(...f){return t.apply(this,[...s,...f])},Image$1}function extendProperty(e,t,r={}){let{partialArgs:n=[]}=r;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let a=t.apply(this,n);return this.computed[e]=a,a},Object.defineProperty(Image$1.prototype,e,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(e={}){const{clamped:t}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const r=this.width*this.height*4;let n=t?new Uint8ClampedArray(r):new Uint8Array(r);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(e,t){for(let r=0;r<e.size;r++){const n=e.getBit(r);t[r*4]=n*255,t[r*4+1]=n*255,t[r*4+2]=n*255}}function fillDataFromGrey32(e,t){const r=e.min[0],a=e.max[0]-r;for(let s=0;s<e.size;s++){const f=Math.floor(255*(e.data[s]-r)/a);t[s*4]=f,t[s*4+1]=f,t[s*4+2]=f}}function fillDataFromRGB32(e,t){const r=Math.min(...e.min),a=Math.max(...e.max)-r;for(let s=0;s<e.size;s++){const f=Math.floor(255*(e.data[s*3]-r)/a),o=Math.floor(255*(e.data[s*3+1]-r)/a),x=Math.floor(255*(e.data[s*3+2]-r)/a);t[s*4]=f,t[s*4+1]=o,t[s*4+2]=x}}function fillDataFromGrey(e,t){for(let r=0;r<e.size;r++)t[r*4]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+1]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+2]=e.data[r*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,t){for(let r=0;r<e.size;r++)t[r*4]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+1]=e.data[r*e.channels+1]>>>e.bitDepth-8,t[r*4+2]=e.data[r*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,t){for(let r=0;r<e.size;r++)t[r*4+3]=e.data[r*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,t){for(let r=0;r<e.size;r++)t[r*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const t=kinds[e];if(!t)throw new RangeError(`invalid image kind: ${e}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:t,alpha:r,bitDepth:n,colorModel:a}=e;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(r!==0&&r!==1&&typeof r!="boolean")throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[a])throw new RangeError(`invalid colorModel: ${a}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,t,r){let n=t*e;return r===1&&(n=Math.ceil(n/8)),n}function createPixelArray(e,t,r,n,a,s){const f=n*e;let o;switch(a){case 1:o=new Uint8Array(Math.ceil(f/8));break;case 8:o=new Uint8Array(f);break;case 16:o=new Uint16Array(f);break;case 32:o=new Float32Array(f);break;default:throw new Error(`Cannot create pixel array for bit depth ${a}`)}if(r)for(let x=t;x<o.length;x+=n)o[x]=s;return o}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(t,r){r=r||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let n=t.byteLength;const a=r.offset?r.offset>>>0:0;t.buffer&&(n=t.byteLength-a,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+a,t.byteOffset+t.byteLength):a?t=t.buffer.slice(a):t=t.buffer),this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const r=this._increment+this._increment;this._increment=r;const n=this.length+r,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=this.readByte();return r}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var r=0;r<t;r++)charArray[r]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const r=tags$1[this.kind].tagsById;for(var t of this.fields.keys())r[t]&&(this._map[r[t]]=this.fields.get(t))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,r=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(r[1],r[2]-1,r[3]),t.setHours(r[4],r[5],r[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(e){return typeof e=="number"?[e]:e}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(e,t){return types$1.get(e)[0]*t};ifdValue.readData=function(e,t,r){return types$1.get(t)[1](e,r)};function readByte$1(e,t){if(t===1)return e.readUint8();for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.readUint8();return r}function readASCII$1(e,t){for(var r=[],n="",a=0;a<t;a++){var s=String.fromCharCode(e.readUint8());s==="\0"?(r.push(n),n=""):n+=s}return r.length===1?r[0]:r}function readShort$1(e,t){if(t===1)return e.readUint16();for(var r=new Uint16Array(t),n=0;n<t;n++)r[n]=e.readUint16();return r}function readLong$1(e,t){if(t===1)return e.readUint32();for(var r=new Uint32Array(t),n=0;n<t;n++)r[n]=e.readUint32();return r}function readRational$1(e,t){if(t===1)return e.readUint32()/e.readUint32();for(var r=new Array(t),n=0;n<t;n++)r[n]=e.readUint32()/e.readUint32();return r}function readSByte$1(e,t){if(t===1)return e.readInt8();for(var r=new Int8Array(t),n=0;n<t;n++)r[n]=e.readInt8();return r}function readSShort$1(e,t){if(t===1)return e.readInt16();for(var r=new Int16Array(t),n=0;n<t;n++)r[n]=e.readInt16();return r}function readSLong$1(e,t){if(t===1)return e.readInt32();for(var r=new Int32Array(t),n=0;n<t;n++)r[n]=e.readInt32();return r}function readSRational$1(e,t){if(t===1)return e.readInt32()/e.readInt32();for(var r=new Array(t),n=0;n<t;n++)r[n]=e.readInt32()/e.readInt32();return r}function readFloat$1(e,t){if(t===1)return e.readFloat32();for(var r=new Float32Array(t),n=0;n<t;n++)r[n]=e.readFloat32();return r}function readDouble$1(e,t){if(t===1)return e.readFloat64();for(var r=new Float64Array(t),n=0;n<t;n++)r[n]=e.readFloat64();return r}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(t,r){super(t,r),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$d,t);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(t)),t.onlyFirst)return r[0];return r}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var r;t.kind?r=new IFD$1(t.kind):r=new TiffIFD;const n=this.readUint16();for(var a=0;a<n;a++)this.decodeIFDEntry(r);return t.ignoreImageData||this.decodeImageData(r),this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const r=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}IFDValue.getByteLength(a,s)>4&&this.seek(this.readUint32());const o=IFDValue.readData(this,a,s);if(t.fields.set(n,o),n===34665||n===34853){let x=this.offset,C;n===34665?C="exif":n===34853&&(C="gps"),this._nextIFD=o,t[C]=this.decodeIFD({kind:C,ignoreImageData:!0}),this.offset=x}this.seek(r),this.skip(12)}decodeImageData(t){const r=t.orientation;switch(r&&r!==1&&unsupported$1("orientation",r),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const r=t.width,n=t.height,a=validateBitDepth(t.bitsPerSample),s=t.sampleFormat;let f=r*n;const o=getDataArray$1(f,1,a,s),x=t.compression,P=t.rowsPerStrip*r,Y=t.stripOffsets,ze=t.stripByteCounts;for(var ge=0,Bt=0;Bt<Y.length;Bt++){var Ur=this.getStripData(x,Y[Bt],ze[Bt]),kn=f>P?P:f;f-=kn,a===8?ge=fill8bit$1(o,Ur,ge,kn):a===16?ge=fill16bit$1(o,Ur,ge,kn,this.isLittleEndian()):a===32&&s===3?ge=fillFloat32$1(o,Ur,ge,kn,this.isLittleEndian()):unsupported$1("bitDepth",a)}t.data=o}getStripData(t,r,n){switch(t){case 1:return new DataView(this.buffer,r,n);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(e,t,r,n){return r===8?new Uint8Array(e*t):r===16?new Uint16Array(e*t):r===32&&n===3?new Float32Array(e*t):unsupported$1("bit depth / sample format",r+" / "+n)}function fill8bit$1(e,t,r,n){for(var a=0;a<n;a++)e[r++]=t.getUint8(a);return r}function fill16bit$1(e,t,r,n,a){for(var s=0;s<n*2;s+=2)e[r++]=t.getUint16(s,a);return r}function fillFloat32$1(e,t,r,n,a){for(var s=0;s<n*4;s+=4)e[r++]=t.getFloat32(s,a);return r}function unsupported$1(e,t){throw new Error("Unsupported "+e+": "+t)}function validateBitDepth(e){if(e.length){const r=e;e=r[0];for(var t=0;t<r.length;t++)r[t]!==e&&unsupported$1("bit depth",r)}return e}const TIFFDecoder$1=tiffDecoder;var decode$3=function(t,r){return new TIFFDecoder$1(t,r).decode(r)};src$4.decode=decode$3;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$2(e){const t=new IOBuffer(e),r={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const s=t.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){const f=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});r.exif=f}}return r}var decode_1=decode$2,decode$1=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=e=>[...e].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,t=0){let r=e[t],n=1,a=0;for(;++a<8;)n*=256,r+=e[t+a]*n;return r}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(!(t&&t.length>1))return null;const r=(a,s)=>{s=Object.assign({offset:0},s);for(let f=0;f<a.length;f++)if(s.mask){if(a[f]!==(s.mask[f]&t[f+s.offset]))return!1}else if(a[f]!==t[f+s.offset])return!1;return!0},n=(a,s)=>r(toBytes(a),s);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const a=(x,C=0)=>x.findIndex((P,Y,ze)=>Y>=C&&ze[Y]===80&&ze[Y+1]===75&&ze[Y+2]===3&&ze[Y+3]===4);let s=0,f=!1,o=null;do{const x=s+30;if(f||(f=r(oxmlContentTypes,{offset:x})||r(oxmlRels,{offset:x})),o||(n("word/",{offset:x})?o={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:x})?o={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:x})&&(o={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),f&&o)return o;s=a(t,x)}while(s>=0);if(o)return o}if(r([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const a=t.subarray(4,4100),s=a.findIndex((f,o,x)=>x[o]===66&&x[o+1]===130);if(s!==-1){const f=s+3,o=x=>[...x].every((C,P)=>a[f+P]===C.charCodeAt(0));if(o("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(o("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let a=30;do{const s=readUInt64LE(t,a+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:a})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}a+=s}while(a+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let a=0;a<2&&a<t.length-16;a++){if(r([73,68,51],{offset:a})||r([255,226],{offset:a,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:a,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:a,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:a,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(t)}catch(r){reject(r)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=e=>{const t=fileType(e);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(e,t,r){let n=0;for(;n<e.length;){for(let a=r;a<t*r;a+=r)for(let s=0;s<r;s++)e[n+a+s]=e[n+a+s]+e[n+a-(r-s)]&255;n+=t*r}}function applyHorizontalDifferencing16Bit(e,t,r){let n=0;for(;n<e.length;){for(let a=r;a<t*r;a+=r)for(let s=0;s<r;s++)e[n+a+s]=e[n+a+s]+e[n+a-(r-s)]&65535;n+=t*r}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let r of this.fields.keys())t[r]&&(this._map[t[r]]=this.fields.get(r));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,t){const r=types.get(e);if(!r)throw new Error(`type not found: ${e}`);return r[0]*t}function readData(e,t,r){const n=types.get(t);if(!n)throw new Error(`type not found: ${t}`);return n[1](e,r)}function readByte(e,t){if(t===1)return e.readUint8();let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.readUint8();return r}function readASCII(e,t){let r=[],n="";for(let a=0;a<t;a++){let s=String.fromCharCode(e.readUint8());s==="\0"?(r.push(n),n=""):n+=s}return r.length===1?r[0]:r}function readShort(e,t){if(t===1)return e.readUint16();let r=new Uint16Array(t);for(let n=0;n<t;n++)r[n]=e.readUint16();return r}function readLong(e,t){if(t===1)return e.readUint32();let r=new Uint32Array(t);for(let n=0;n<t;n++)r[n]=e.readUint32();return r}function readRational(e,t){if(t===1)return e.readUint32()/e.readUint32();let r=new Array(t);for(let n=0;n<t;n++)r[n]=e.readUint32()/e.readUint32();return r}function readSByte(e,t){if(t===1)return e.readInt8();let r=new Int8Array(t);for(let n=0;n<t;n++)r[n]=e.readInt8();return r}function readSShort(e,t){if(t===1)return e.readInt16();let r=new Int16Array(t);for(let n=0;n<t;n++)r[n]=e.readInt16();return r}function readSLong(e,t){if(t===1)return e.readInt32();let r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.readInt32();return r}function readSRational(e,t){if(t===1)return e.readInt32()/e.readInt32();let r=new Array(t);for(let n=0;n<t;n++)r[n]=e.readInt32()/e.readInt32();return r}function readFloat(e,t){if(t===1)return e.readFloat32();let r=new Float32Array(t);for(let n=0;n<t;n++)r[n]=e.readFloat32();return r}function readDouble(e,t){if(t===1)return e.readFloat64();let r=new Float64Array(t);for(let n=0;n<t;n++)r[n]=e.readFloat64();return r}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const e=[];for(let t=256;t<4096;t++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,r=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),r=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(r).concat(this.stringFromCode(t)[0])),r=t;else{const a=this.stringFromCode(r).concat(this.stringFromCode(r)[0]);this.writeString(a),this.addStringToTable(a),r=t}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,r=dateTimeRegex.exec(this.dateTime);if(r===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(r[1]),Number(r[2])-1,Number(r[3])),t.setHours(Number(r[4]),Number(r[5]),Number(r[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,r=this.get("ColorMap");if(!r)return;if(r.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const n=[];for(let a=0;a<t;a++)n.push([r[a],r[a+t],r[a+2*t]]);return n}}function alwaysArray(e){return typeof e=="number"?[e]:e}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,r)=>{e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},send_code=(e,t,r)=>{send_bits(e,r[t*2],r[t*2+1])},bi_reverse=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,x=t.stat_desc.max_length;let C,P,Y,ze,ge,Bt,Ur=0;for(ze=0;ze<=MAX_BITS$1;ze++)e.bl_count[ze]=0;for(r[e.heap[e.heap_max]*2+1]=0,C=e.heap_max+1;C<HEAP_SIZE$1;C++)P=e.heap[C],ze=r[r[P*2+1]*2+1]+1,ze>x&&(ze=x,Ur++),r[P*2+1]=ze,!(P>n)&&(e.bl_count[ze]++,ge=0,P>=o&&(ge=f[P-o]),Bt=r[P*2],e.opt_len+=Bt*(ze+ge),s&&(e.static_len+=Bt*(a[P*2+1]+ge)));if(Ur!==0){do{for(ze=x-1;e.bl_count[ze]===0;)ze--;e.bl_count[ze]--,e.bl_count[ze+1]+=2,e.bl_count[x]--,Ur-=2}while(Ur>0);for(ze=x;ze!==0;ze--)for(P=e.bl_count[ze];P!==0;)Y=e.heap[--C],!(Y>n)&&(r[Y*2+1]!==ze&&(e.opt_len+=(ze-r[Y*2+1])*r[Y*2],r[Y*2+1]=ze),P--)}},gen_codes=(e,t,r)=>{const n=new Array(MAX_BITS$1+1);let a=0,s,f;for(s=1;s<=MAX_BITS$1;s++)a=a+r[s-1]<<1,n[s]=a;for(f=0;f<=t;f++){let o=e[f*2+1];o!==0&&(e[f*2]=bi_reverse(n[o]++,o))}},tr_static_init=()=>{let e,t,r,n,a;const s=new Array(MAX_BITS$1+1);for(r=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,a=0,n=0;n<16;n++)for(base_dist[n]=a,e=0;e<1<<extra_dbits[n];e++)_dist_code[a++]=n;for(a>>=7;n<D_CODES$1;n++)for(base_dist[n]=a<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+a++]=n;for(t=0;t<=MAX_BITS$1;t++)s[t]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,t,r,n)=>{const a=t*2,s=r*2;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[r]},pqdownheap=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&smaller(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},compress_block=(e,t,r)=>{let n,a,s=0,f,o;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+s++]&255,n+=(e.pending_buf[e.sym_buf+s++]&255)<<8,a=e.pending_buf[e.sym_buf+s++],n===0?send_code(e,a,t):(f=_length_code[a],send_code(e,f+LITERALS$1+1,t),o=extra_lbits[f],o!==0&&(a-=base_length[f],send_bits(e,a,o)),n--,f=d_code(n),send_code(e,f,r),o=extra_dbits[f],o!==0&&(n-=base_dist[f],send_bits(e,n,o)));while(s<e.sym_next);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let f,o,x=-1,C;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,f=0;f<s;f++)r[f*2]!==0?(e.heap[++e.heap_len]=x=f,e.depth[f]=0):r[f*2+1]=0;for(;e.heap_len<2;)C=e.heap[++e.heap_len]=x<2?++x:0,r[C*2]=1,e.depth[C]=0,e.opt_len--,a&&(e.static_len-=n[C*2+1]);for(t.max_code=x,f=e.heap_len>>1;f>=1;f--)pqdownheap(e,r,f);C=s;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=o,r[C*2]=r[f*2]+r[o*2],e.depth[C]=(e.depth[f]>=e.depth[o]?e.depth[f]:e.depth[o])+1,r[f*2+1]=r[o*2+1]=C,e.heap[1]=C++,pqdownheap(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(r,x,e.bl_count)},scan_tree=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)&&(o<C?e.bl_tree[s*2]+=o:s!==0?(s!==a&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6*2]++):o<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4))},send_tree=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),n=0;n<=r;n++)if(s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)){if(o<C)do send_code(e,s,e.bl_tree);while(--o!==0);else s!==0?(s!==a&&(send_code(e,s,e.bl_tree),o--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,o-3,2)):o<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,o-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,o-11,7));o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&e.bl_tree[bl_order[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,r,n)=>{let a;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),a=0;a<n;a++)send_bits(e,e.bl_tree[bl_order[a]*2+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)},detect_data_type=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(r=32;r<LITERALS$1;r++)if(e.dyn_ltree[r*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,t,r,n)=>{send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(e),put_short(e,r),put_short(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,t,r,n)=>{let a,s,f=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),f=build_bl_tree(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=r+5,r+4<=a&&t!==-1?_tr_stored_block$1(e,t,r,n):e.strategy===Z_FIXED$1||s===a?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},_tr_tally$1=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code[r]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,t,r,n)=>{let a=e&65535|0,s=e>>>16&65535|0,f=0;for(;r!==0;){f=r>2e3?2e3:r,r-=f;do a=a+t[n++]|0,s=s+a|0;while(--f);a%=65521,s%=65521}return a|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable=new Uint32Array(makeTable()),crc32=(e,t,r,n)=>{const a=crcTable,s=n+r;e^=-1;for(let f=n;f<s;f++)e=e>>>8^a[(e^t[f])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2$1,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=messages[t],t),rank=e=>e*2-(e>4?9:0),zero=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=a?r-a:0;while(--t);t=a,n=t;do r=e.prev[--n],e.prev[n]=r>=a?r-a:0;while(--t)};let HASH_ZLIB=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),e.state.wrap===1?e.adler=adler32_1(e.adler,t,a,r):e.state.wrap===2&&(e.adler=crc32_1(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},longest_match=(e,t)=>{let r=e.max_chain_length,n=e.strstart,a,s,f=e.prev_length,o=e.nice_match;const x=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,C=e.window,P=e.w_mask,Y=e.prev,ze=e.strstart+MAX_MATCH;let ge=C[n+f-1],Bt=C[n+f];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do if(a=t,!(C[a+f]!==Bt||C[a+f-1]!==ge||C[a]!==C[n]||C[++a]!==C[n+1])){n+=2,a++;do;while(C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&n<ze);if(s=MAX_MATCH-(ze-n),n=ze-MAX_MATCH,s>f){if(e.match_start=t,f=s,s>=o)break;ge=C[n+f-1],Bt=C[n+f]}}while((t=Y[t&P])>x&&--r!==0);return f<=e.lookahead?f:e.lookahead},fill_window=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),n+=t),e.strm.avail_in===0)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=HASH(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[a+MIN_MATCH-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,s,f=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(n===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||n!==a+e.strm.avail_in)))break;f=t===Z_FINISH$3&&n===a+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,f),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,flush_pending(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(read_buf(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(f===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&e.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,f=t===Z_FINISH$3&&e.strm.avail_in===0&&n===a?1:0,_tr_stored_block(e,e.block_start,n,f),e.block_start+=n,flush_pending(e.strm)),f?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,t)=>{let r,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH)if(n=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-MIN_MATCH,n=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(n=_tr_tally(e,0,e.window[e.strstart-1]),n&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let r,n,a,s;const f=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(a=e.strstart-1,n=f[a],n===f[++a]&&n===f[++a]&&n===f[++a])){s=e.strstart+MAX_MATCH;do;while(n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&a<s);e.match_length=MAX_MATCH-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(r=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK$3&&lm_init(e.state),t},deflateSetHeader=(e,t)=>deflateStateCheck(e)||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=t,Z_OK$3),deflateInit2=(e,t,r,n,a,s)=>{if(!e)return Z_STREAM_ERROR$2;let f=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(f=0,n=-n):n>15&&(f=2,n-=16),a<1||a>MAX_MEM_LEVEL||r!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||s<0||s>Z_FIXED||n===8&&f!==1)return err(e,Z_STREAM_ERROR$2);n===8&&(n=9);const o=new DeflateState;return e.state=o,o.strm=e,o.status=INIT_STATE,o.wrap=f,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH-1)/MIN_MATCH),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=s,o.method=r,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,t)=>{if(deflateStateCheck(e)||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===FINISH_STATE&&t!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(flush_pending(e),e.avail_out===0)return r.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(t)<=rank(n)&&t!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(r.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(r.status===INIT_STATE&&r.wrap===0&&(r.status=BUSY_STATE),r.status===INIT_STATE){let a=Z_DEFLATED$2+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=Z_HUFFMAN_ONLY||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=PRESET_DICT),a+=31-a%31,putShortMSB(r,a),r.strstart!==0&&(putShortMSB(r,e.adler>>>16),putShortMSB(r,e.adler&65535)),e.adler=1,r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(r.status===GZIP_STATE){if(e.adler=0,put_byte(r,31),put_byte(r,139),put_byte(r,8),r.gzhead)put_byte(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),put_byte(r,r.gzhead.time&255),put_byte(r,r.gzhead.time>>8&255),put_byte(r,r.gzhead.time>>16&255),put_byte(r,r.gzhead.time>>24&255),put_byte(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(put_byte(r,r.gzhead.extra.length&255),put_byte(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=EXTRA_STATE;else if(put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,OS_CODE),r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(r.status===EXTRA_STATE){if(r.gzhead.extra){let a=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let o=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex+=o,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0,s-=o}let f=new Uint8Array(r.gzhead.extra);r.pending_buf.set(f.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=NAME_STATE}if(r.status===NAME_STATE){if(r.gzhead.name){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,put_byte(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=COMMENT_STATE}if(r.status===COMMENT_STATE){if(r.gzhead.comment){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,put_byte(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a))}r.status=HCRC_STATE}if(r.status===HCRC_STATE){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(flush_pending(e),r.pending!==0))return r.last_flush=-1,Z_OK$3;put_byte(r,e.adler&255),put_byte(r,e.adler>>8&255),e.adler=0}if(r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(e.avail_in!==0||r.lookahead!==0||t!==Z_NO_FLUSH$2&&r.status!==FINISH_STATE){let a=r.level===0?deflate_stored(r,t):r.strategy===Z_HUFFMAN_ONLY?deflate_huff(r,t):r.strategy===Z_RLE?deflate_rle(r,t):configuration_table[r.level].func(r,t);if((a===BS_FINISH_STARTED||a===BS_FINISH_DONE)&&(r.status=FINISH_STATE),a===BS_NEED_MORE||a===BS_FINISH_STARTED)return e.avail_out===0&&(r.last_flush=-1),Z_OK$3;if(a===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(r):t!==Z_BLOCK$1&&(_tr_stored_block(r,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),flush_pending(e),e.avail_out===0))return r.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:r.wrap<=0?Z_STREAM_END$3:(r.wrap===2?(put_byte(r,e.adler&255),put_byte(r,e.adler>>8&255),put_byte(r,e.adler>>16&255),put_byte(r,e.adler>>24&255),put_byte(r,e.total_in&255),put_byte(r,e.total_in>>8&255),put_byte(r,e.total_in>>16&255),put_byte(r,e.total_in>>24&255)):(putShortMSB(r,e.adler>>>16),putShortMSB(r,e.adler&65535)),flush_pending(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const t=e.state.status;return e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,t)=>{let r=t.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(a===1&&(e.adler=adler32_1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){a===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let x=new Uint8Array(n.w_size);x.set(t.subarray(r-n.w_size,r),0),t=x,r=n.w_size}const s=e.avail_in,f=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,fill_window(n);n.lookahead>=MIN_MATCH;){let x=n.strstart,C=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[x+MIN_MATCH-1]),n.prev[x&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=x,x++;while(--C);n.strstart=x,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,e.next_in=f,e.input=o,e.avail_in=s,n.wrap=a,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)_has(r,n)&&(e[n]=r[n])}}return e},flattenChunks=e=>{let t=0;for(let n=0,a=e.length;n<a;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,a=0,s=e.length;n<s;n++){let f=e[n];r.set(f,a),a+=f.length}return r},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,a,s,f=e.length,o=0;for(a=0;a<f;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),s=0,a=0;s<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|r&63):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|r&63):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|r&63);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var buf2string=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,a;const s=new Array(r*2);for(a=0,n=0;n<r;){let f=e[n++];if(f<128){s[a++]=f;continue}let o=_utf8len[f];if(o>4){s[a++]=65533,n+=o-1;continue}for(f&=o===2?31:o===3?15:7;o>1&&n<r;)f=f<<6|e[n++]&63,o--;if(o>1){s[a++]=65533;continue}f<65536?s[a++]=f:(f-=65536,s[a++]=55296|f>>10&1023,s[a++]=56320|f&1023)}return buf2binstring(s,a)},utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+_utf8len[e[r]]>t?r:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2$1;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$2)throw new Error(messages[r]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=deflate_1$2.deflateSetDictionary(this.strm,n),r!==Z_OK$2)throw new Error(messages[r]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?r.input=strings.string2buf(e):toString$1$1.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(a=deflate_1$2.deflate(r,s),a===Z_STREAM_END$2)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=deflate_1$2.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z_OK$2;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const BAD$1=16209,TYPE$1=16191;var inffast=function e(t,r){let n,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn,Io,rl,Co,as,$s,ah,ch,Zu,ih,al;const sh=t.state;n=t.next_in,ih=t.input,a=n+(t.avail_in-5),s=t.next_out,al=t.output,f=s-(r-t.avail_out),o=s+(t.avail_out-257),x=sh.dmax,C=sh.wsize,P=sh.whave,Y=sh.wnext,ze=sh.window,ge=sh.hold,Bt=sh.bits,Ur=sh.lencode,kn=sh.distcode,Io=(1<<sh.lenbits)-1,rl=(1<<sh.distbits)-1;e:do{Bt<15&&(ge+=ih[n++]<<Bt,Bt+=8,ge+=ih[n++]<<Bt,Bt+=8),Co=Ur[ge&Io];t:for(;;){if(as=Co>>>24,ge>>>=as,Bt-=as,as=Co>>>16&255,as===0)al[s++]=Co&65535;else if(as&16){$s=Co&65535,as&=15,as&&(Bt<as&&(ge+=ih[n++]<<Bt,Bt+=8),$s+=ge&(1<<as)-1,ge>>>=as,Bt-=as),Bt<15&&(ge+=ih[n++]<<Bt,Bt+=8,ge+=ih[n++]<<Bt,Bt+=8),Co=kn[ge&rl];i:for(;;){if(as=Co>>>24,ge>>>=as,Bt-=as,as=Co>>>16&255,as&16){if(ah=Co&65535,as&=15,Bt<as&&(ge+=ih[n++]<<Bt,Bt+=8,Bt<as&&(ge+=ih[n++]<<Bt,Bt+=8)),ah+=ge&(1<<as)-1,ah>x){t.msg="invalid distance too far back",sh.mode=BAD$1;break e}if(ge>>>=as,Bt-=as,as=s-f,ah>as){if(as=ah-as,as>P&&sh.sane){t.msg="invalid distance too far back",sh.mode=BAD$1;break e}if(ch=0,Zu=ze,Y===0){if(ch+=C-as,as<$s){$s-=as;do al[s++]=ze[ch++];while(--as);ch=s-ah,Zu=al}}else if(Y<as){if(ch+=C+Y-as,as-=Y,as<$s){$s-=as;do al[s++]=ze[ch++];while(--as);if(ch=0,Y<$s){as=Y,$s-=as;do al[s++]=ze[ch++];while(--as);ch=s-ah,Zu=al}}}else if(ch+=Y-as,as<$s){$s-=as;do al[s++]=ze[ch++];while(--as);ch=s-ah,Zu=al}for(;$s>2;)al[s++]=Zu[ch++],al[s++]=Zu[ch++],al[s++]=Zu[ch++],$s-=3;$s&&(al[s++]=Zu[ch++],$s>1&&(al[s++]=Zu[ch++]))}else{ch=s-ah;do al[s++]=al[ch++],al[s++]=al[ch++],al[s++]=al[ch++],$s-=3;while($s>2);$s&&(al[s++]=al[ch++],$s>1&&(al[s++]=al[ch++]))}}else if(as&64){t.msg="invalid distance code",sh.mode=BAD$1;break e}else{Co=kn[(Co&65535)+(ge&(1<<as)-1)];continue i}break}}else if(as&64)if(as&32){sh.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",sh.mode=BAD$1;break e}else{Co=Ur[(Co&65535)+(ge&(1<<as)-1)];continue t}break}}while(n<a&&s<o);$s=Bt>>3,n-=$s,Bt-=$s<<3,ge&=(1<<Bt)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?5+(a-n):5-(n-a),t.avail_out=s<o?257+(o-s):257-(s-o),sh.hold=ge,sh.bits=Bt};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,t,r,n,a,s,f,o)=>{const x=o.bits;let C=0,P=0,Y=0,ze=0,ge=0,Bt=0,Ur=0,kn=0,Io=0,rl=0,Co,as,$s,ah,ch,Zu=null,ih;const al=new Uint16Array(MAXBITS+1),sh=new Uint16Array(MAXBITS+1);let _h=null,Ih,Lh,Gh;for(C=0;C<=MAXBITS;C++)al[C]=0;for(P=0;P<n;P++)al[t[r+P]]++;for(ge=x,ze=MAXBITS;ze>=1&&al[ze]===0;ze--);if(ge>ze&&(ge=ze),ze===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,o.bits=1,0;for(Y=1;Y<ze&&al[Y]===0;Y++);for(ge<Y&&(ge=Y),kn=1,C=1;C<=MAXBITS;C++)if(kn<<=1,kn-=al[C],kn<0)return-1;if(kn>0&&(e===CODES$1||ze!==1))return-1;for(sh[1]=0,C=1;C<MAXBITS;C++)sh[C+1]=sh[C]+al[C];for(P=0;P<n;P++)t[r+P]!==0&&(f[sh[t[r+P]]++]=P);if(e===CODES$1?(Zu=_h=f,ih=20):e===LENS$1?(Zu=lbase,_h=lext,ih=257):(Zu=dbase,_h=dext,ih=0),rl=0,P=0,C=Y,ch=s,Bt=ge,Ur=0,$s=-1,Io=1<<ge,ah=Io-1,e===LENS$1&&Io>ENOUGH_LENS$1||e===DISTS$1&&Io>ENOUGH_DISTS$1)return 1;for(;;){Ih=C-Ur,f[P]+1<ih?(Lh=0,Gh=f[P]):f[P]>=ih?(Lh=_h[f[P]-ih],Gh=Zu[f[P]-ih]):(Lh=32+64,Gh=0),Co=1<<C-Ur,as=1<<Bt,Y=as;do as-=Co,a[ch+(rl>>Ur)+as]=Ih<<24|Lh<<16|Gh|0;while(as!==0);for(Co=1<<C-1;rl&Co;)Co>>=1;if(Co!==0?(rl&=Co-1,rl+=Co):rl=0,P++,--al[C]===0){if(C===ze)break;C=t[r+f[P]]}if(C>ge&&(rl&ah)!==$s){for(Ur===0&&(Ur=ge),ch+=Y,Bt=C-Ur,kn=1<<Bt;Bt+Ur<ze&&(kn-=al[Bt+Ur],!(kn<=0));)Bt++,kn<<=1;if(Io+=1<<Bt,e===LENS$1&&Io>ENOUGH_LENS$1||e===DISTS$1&&Io>ENOUGH_DISTS$1)return 1;$s=rl&ah,a[$s]=ge<<24|Bt<<16|ch-s|0}}return rl!==0&&(a[ch+rl]=C-Ur<<24|64<<16|0),o.bits=ge,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2$1,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let r;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const r=new InflateState;e.state=r,r.strm=e,r.window=null,r.mode=HEAD;const n=inflateReset2(e,t);return n!==Z_OK$1&&(e.state=null),n},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,r,n)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(r-n,r-n+a),s.wnext),n-=a,n?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},inflate$2=(e,t)=>{let r,n,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn=0,Io,rl,Co,as,$s,ah,ch,Zu;const ih=new Uint8Array(4);let al,sh;const _h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;r=e.state,r.mode===TYPE&&(r.mode=TYPEDO),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,Y=o,ze=x,Zu=Z_OK$1;e:for(;;)switch(r.mode){case HEAD:if(r.wrap===0){r.mode=TYPEDO;break}for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&2&&C===35615){r.wbits===0&&(r.wbits=15),r.check=0,ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1(r.check,ih,2,0),C=0,P=0,r.mode=FLAGS;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((C&255)<<8)+(C>>8))%31){e.msg="incorrect header check",r.mode=BAD;break}if((C&15)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(C>>>=4,P-=4,ch=(C&15)+8,r.wbits===0&&(r.wbits=ch),ch>15||ch>r.wbits){e.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=C&512?DICTID:TYPE,C=0,P=0;break;case FLAGS:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.flags=C,(r.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=C>>8&1),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1(r.check,ih,2,0)),C=0,P=0,r.mode=TIME;case TIME:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.time=C),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,ih[2]=C>>>16&255,ih[3]=C>>>24&255,r.check=crc32_1(r.check,ih,4,0)),C=0,P=0,r.mode=OS;case OS:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.xflags=C&255,r.head.os=C>>8),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1(r.check,ih,2,0)),C=0,P=0,r.mode=EXLEN;case EXLEN:if(r.flags&1024){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length=C,r.head&&(r.head.extra_len=C),r.flags&512&&r.wrap&4&&(ih[0]=C&255,ih[1]=C>>>8&255,r.check=crc32_1(r.check,ih,2,0)),C=0,P=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(r.flags&1024&&(ge=r.length,ge>o&&(ge=o),ge&&(r.head&&(ch=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+ge),ch)),r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,ge,s)),o-=ge,s+=ge,r.length-=ge),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(r.flags&2048){if(o===0)break e;ge=0;do ch=n[s+ge++],r.head&&ch&&r.length<65536&&(r.head.name+=String.fromCharCode(ch));while(ch&&ge<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,ge,s)),o-=ge,s+=ge,ch)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(r.flags&4096){if(o===0)break e;ge=0;do ch=n[s+ge++],r.head&&ch&&r.length<65536&&(r.head.comment+=String.fromCharCode(ch));while(ch&&ge<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,ge,s)),o-=ge,s+=ge,ch)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(r.flags&512){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.check&65535)){e.msg="header crc mismatch",r.mode=BAD;break}C=0,P=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}e.adler=r.check=zswap32(C),C=0,P=0,r.mode=DICT;case DICT:if(r.havedict===0)return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,Z_NEED_DICT$1;e.adler=r.check=1,r.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(r.last){C>>>=P&7,P-=P&7,r.mode=CHECK;break}for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}switch(r.last=C&1,C>>>=1,P-=1,C&3){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){C>>>=2,P-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD}C>>>=2,P-=2;break;case STORED:for(C>>>=P&7,P-=P&7;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if((C&65535)!==(C>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=C&65535,C=0,P=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(ge=r.length,ge){if(ge>o&&(ge=o),ge>x&&(ge=x),ge===0)break e;a.set(n.subarray(s,s+ge),f),o-=ge,s+=ge,x-=ge,f+=ge,r.length-=ge;break}r.mode=TYPE;break;case TABLE:for(;P<14;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.nlen=(C&31)+257,C>>>=5,P-=5,r.ndist=(C&31)+1,C>>>=5,P-=5,r.ncode=(C&15)+4,C>>>=4,P-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.lens[_h[r.have++]]=C&7,C>>>=3,P-=3}for(;r.have<19;)r.lens[_h[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,al={bits:r.lenbits},Zu=inftrees(CODES,r.lens,0,19,r.lencode,0,r.work,al),r.lenbits=al.bits,Zu){e.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;kn=r.lencode[C&(1<<r.lenbits)-1],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(Co<16)C>>>=Io,P-=Io,r.lens[r.have++]=Co;else{if(Co===16){for(sh=Io+2;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(C>>>=Io,P-=Io,r.have===0){e.msg="invalid bit length repeat",r.mode=BAD;break}ch=r.lens[r.have-1],ge=3+(C&3),C>>>=2,P-=2}else if(Co===17){for(sh=Io+3;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Io,P-=Io,ch=0,ge=3+(C&7),C>>>=3,P-=3}else{for(sh=Io+7;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Io,P-=Io,ch=0,ge=11+(C&127),C>>>=7,P-=7}if(r.have+ge>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD;break}for(;ge--;)r.lens[r.have++]=ch}}if(r.mode===BAD)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,al={bits:r.lenbits},Zu=inftrees(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,al),r.lenbits=al.bits,Zu){e.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,al={bits:r.distbits},Zu=inftrees(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,al),r.distbits=al.bits,Zu){e.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(o>=6&&x>=258){e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,inffast(e,ze),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;kn=r.lencode[C&(1<<r.lenbits)-1],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(rl&&!(rl&240)){for(as=Io,$s=rl,ah=Co;kn=r.lencode[ah+((C&(1<<as+$s)-1)>>as)],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(as+Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=as,P-=as,r.back+=as}if(C>>>=Io,P-=Io,r.back+=Io,r.length=Co,rl===0){r.mode=LIT;break}if(rl&32){r.back=-1,r.mode=TYPE;break}if(rl&64){e.msg="invalid literal/length code",r.mode=BAD;break}r.extra=rl&15,r.mode=LENEXT;case LENEXT:if(r.extra){for(sh=r.extra;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;kn=r.distcode[C&(1<<r.distbits)-1],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(!(rl&240)){for(as=Io,$s=rl,ah=Co;kn=r.distcode[ah+((C&(1<<as+$s)-1)>>as)],Io=kn>>>24,rl=kn>>>16&255,Co=kn&65535,!(as+Io<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=as,P-=as,r.back+=as}if(C>>>=Io,P-=Io,r.back+=Io,rl&64){e.msg="invalid distance code",r.mode=BAD;break}r.offset=Co,r.extra=rl&15,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(sh=r.extra;P<sh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.offset+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(x===0)break e;if(ge=ze-x,r.offset>ge){if(ge=r.offset-ge,ge>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break}ge>r.wnext?(ge-=r.wnext,Bt=r.wsize-ge):Bt=r.wnext-ge,ge>r.length&&(ge=r.length),Ur=r.window}else Ur=a,Bt=f-r.offset,ge=r.length;ge>x&&(ge=x),x-=ge,r.length-=ge;do a[f++]=Ur[Bt++];while(--ge);r.length===0&&(r.mode=LEN);break;case LIT:if(x===0)break e;a[f++]=r.length,x--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;P<32;){if(o===0)break e;o--,C|=n[s++]<<P,P+=8}if(ze-=x,e.total_out+=ze,r.total+=ze,r.wrap&4&&ze&&(e.adler=r.check=r.flags?crc32_1(r.check,a,ze,f-ze):adler32_1(r.check,a,ze,f-ze)),ze=x,r.wrap&4&&(r.flags?C:zswap32(C))!==r.check){e.msg="incorrect data check",r.mode=BAD;break}C=0,P=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=BAD;break}C=0,P=0}r.mode=DONE;case DONE:Zu=Z_STREAM_END$1;break e;case BAD:Zu=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,(r.wsize||ze!==e.avail_out&&r.mode<BAD&&(r.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,ze-e.avail_out),Y-=e.avail_in,ze-=e.avail_out,e.total_in+=Y,e.total_out+=ze,r.total+=ze,r.wrap&4&&ze&&(e.adler=r.check=r.flags?crc32_1(r.check,a,ze,e.next_out-ze):adler32_1(r.check,a,ze,e.next_out-ze)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(Y===0&&ze===0||t===Z_FINISH$1)&&Zu===Z_OK$1&&(Zu=Z_BUF_ERROR),Zu},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,t)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(e,t)=>{const r=t.length;let n,a,s;return inflateStateCheck(e)||(n=e.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(a=1,a=adler32_1(a,t,r,0),a!==n.check)?Z_DATA_ERROR$1:(s=updatewindow(e,t,r,r),s?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$5=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2$1;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$5.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),r!==Z_OK)))throw new Error(messages[r])}Inflate$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,f,o;if(this.ended)return!1;for(t===~~t?f=t:f=t===!0?Z_FINISH:Z_NO_FLUSH,toString$5.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=inflate_1$2.inflate(r,f),s===Z_NEED_DICT&&a&&(s=inflate_1$2.inflateSetDictionary(r,a),s===Z_OK?s=inflate_1$2.inflate(r,f):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));r.avail_in>0&&s===Z_STREAM_END&&r.state.wrap>0&&e[r.next_in]!==0;)inflate_1$2.inflateReset(r),s=inflate_1$2.inflate(r,f);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(r.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let x=strings.utf8border(r.output,r.next_out),C=r.next_out-x,P=strings.buf2string(r.output,x);r.next_out=C,r.avail_out=n-C,C&&r.output.set(r.output.subarray(x,x+C),0),this.onData(P)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===Z_OK&&o===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,t){const r=new Inflate$1(t);if(r.push(e),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw$1(e,t){return t=t||{},t.raw=!0,inflate$1(e,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants$a=constants$2$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants$a};const{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var inflate_1=inflate;function decompressZlib(e){const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=inflate_1(t);return new DataView(r.buffer,r.byteOffset,r.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$c,t);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(t,!0)),t.onlyFirst)return[r[0]];return r}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,r){this.seek(this._nextIFD);let n;if(r)n=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");n=new IFD(t.kind)}const a=this.readUint16();for(let s=0;s<a;s++)this.decodeIFDEntry(n);if(!t.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const r=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}getByteLength(a,s)>4&&this.seek(this.readUint32());const o=readData(this,a,s);if(t.fields.set(n,o),n===34665||n===34853){let x=this.offset,C="exif";n===34665?C="exif":n===34853&&(C="gps"),this._nextIFD=o,t[C]=this.decodeIFD({kind:C,ignoreImageData:!0},!1),this.offset=x}this.seek(r),this.skip(12)}decodeImageData(t){const r=t.orientation;if(r&&r!==1)throw unsupported("orientation",r);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const n=t.bitsPerSample,a=Math.pow(2,n)-1;for(let s=0;s<t.data.length;s++)t.data[s]=a-t.data[s]}}readStripData(t){const r=t.width,n=t.height,a=t.bitsPerSample,s=t.sampleFormat,f=r*n*t.samplesPerPixel,o=getDataArray(f,a,s),C=t.rowsPerStrip*r*t.samplesPerPixel,P=t.stripOffsets,Y=t.stripByteCounts||guessStripByteCounts(t);let ze=f,ge=0;for(let Bt=0;Bt<P.length;Bt++){let Ur=new DataView(this.buffer,this.byteOffset+P[Bt],Y[Bt]),kn=ze>C?C:ze;ze-=kn;let Io=Ur;switch(t.compression){case 1:break;case 5:{Io=decompressLzw(Ur);break}case 8:{Io=decompressZlib(Ur);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}ge=this.fillUncompressed(a,s,o,Io,ge,kn)}t.data=o}fillUncompressed(t,r,n,a,s,f){if(t===8)return fill8bit(n,a,s,f);if(t===16)return fill16bit(n,a,s,f,this.isLittleEndian());if(t===32&&r===3)return fillFloat32(n,a,s,f,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const r=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(r===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(r===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${r}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:r,components:n,maxSampleValue:a}=t;for(let s=0;s<r.length;s+=n){const f=r[s+n-1];for(let o=0;o<n-1;o++)r[s+o]=Math.round(r[s+o]*a/f)}}}}function getDataArray(e,t,r){if(t===8)return new Uint8Array(e);if(t===16)return new Uint16Array(e);if(t===32&&r===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${t} / ${r}`)}function fill8bit(e,t,r,n){for(let a=0;a<n;a++)e[r++]=t.getUint8(a);return r}function fill16bit(e,t,r,n,a){for(let s=0;s<n*2;s+=2)e[r++]=t.getUint16(s,a);return r}function fillFloat32(e,t,r,n,a){for(let s=0;s<n*4;s+=4)e[r++]=t.getFloat32(s,a);return r}function unsupported(e,t){return new Error(`Unsupported ${e}: ${t}`)}function decodeTIFF(e,t){return new TIFFDecoder(e).decode(t)}function matchAndCrop(e={}){let{algorithm:t="matchToPrevious",ignoreBorder:r=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=t==="matchToPrevious",a=this[0],s=[];s[0]={position:[0,0],image:this[0]};let f=[0,0];for(let ze=1;ze<this.length;ze++){let ge=a.getBestMatch(this[ze],{border:r});s[ze]={position:[ge[0]+f[0],ge[1]+f[1]],image:this[ze]},n&&(f[0]+=ge[0],f[1]+=ge[1],a=this[ze])}let o=0,x=0,C=0,P=0;for(let ze=0;ze<s.length;ze++){let ge=s[ze];ge.position[0]>o&&(o=ge.position[0]),ge.position[0]<x&&(x=ge.position[0]),ge.position[1]>C&&(C=ge.position[1]),ge.position[1]<P&&(P=ge.position[1])}x=0-x,P=0-P;for(let ze=0;ze<s.length;ze++){let ge=s[ze];ge.crop=ge.image.crop({x:o-ge.position[0],y:C-ge.position[1],width:a.width-x-o,height:a.height-P-C})}let Y=[];for(let ze=0;ze<s.length;ze++)Y[ze]=s[ze].crop;return new Stack$3(Y)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let t=1;t<this.length;t++)for(let r=0;r<e.length;r++)e[r]=Math.min(e[r],this[t].min[r]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let t=1;t<this.length;t++)for(let r=0;r<e.length;r++)e[r]=Math.max(e[r],this[t].max[r]);return e}function median$2(e){let t=e.reduce((f,o)=>f+o);if(t===0)throw new Error("unreachable");let r=0,n=0,a=t/2,s;for(;;){if(e[r]>0){if(s!==void 0)return(s+r)/2;if(n+=e[r],n>a)return r;n===a&&(s=r)}r++}}function mean$2(e){let t=0,r=0;for(let n=0;n<e.length;n++)t+=e[n],r+=e[n]*n;return t===0?0:r/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=median$2(n)}return t}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(e);for(let r=1;r<this.length;r++){let n=this[r].getHistogram(e);for(let a=0;a<t.length;a++)t[a]+=n[a]}return t}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(e),r=t[0].length;for(let n=1;n<this.length;n++){let a=this[n].getHistograms(e);for(let s=0;s<t.length;s++)for(let f=0;f<r;f++)t[s][f]+=a[s][f]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let a=this[n];for(let s=0;s<this[0].data.length;s++)e[s]+=a.data[s]}let t=Image$1.createFrom(this[0]),r=t.data;for(let n=0;n<this[0].data.length;n++)r[n]=e[n]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(0);for(const t of this)for(let r=0;r<e.data.length;r++)e.data[r]=Math.max(t.data[r],e.data[r]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(e.maxValue);for(const t of this)for(let r=0;r<e.data.length;r++)e.data[r]=Math.min(t.data[r],e.data[r]);return e}function extend$5(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0},Stack$3=class Ox extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let r=0;r<t.length;r++)this[r]=t[r]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image$1.load)).then(r=>new Ox(r))}static extendMethod(t,r,n={}){let{inPlace:a=!1,returnThis:s=!0,partialArgs:f=[]}=n;return a?Ox.prototype[t]=function(...o){this.computed=null;let x=r.apply(this,[...f,...o]);return s?this:x}:Ox.prototype[t]=function(...o){return r.apply(this,[...f,...o])},Ox}static extendProperty(t,r,n={}){let{partialArgs:a=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let s=r.apply(this,a);return this.computed[t]=s,s},Object.defineProperty(Ox.prototype,t,computedPropertyDescriptor),Ox}checkProcessable(t,r={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,r);for(let n=1;n<this.length;n++){if((r.sameSize===void 0||r.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((r.sameSize===void 0||r.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((r.sameAlpha===void 0||r.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((r.sameBitDepth===void 0||r.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((r.sameColorModel===void 0||r.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((r.sameNumberChannels===void 0||r.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}};Array[Symbol.species]||(Stack$3.prototype.map=function(e,t){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let r=new Stack$3(this.length);for(let n=0;n<this.length;n++)r[n]=e.call(t,this[n],n,this);return r});extend$5(Stack$3);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(e,t){if(typeof e=="string")return loadURL(e,t);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,t&&t.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,t,r){const n=imageType$1(e);if(n)switch(n.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,r);default:return loadGeneric(a(n.mime))}return loadGeneric(a("application/octet-stream"));function a(s){return t||toBase64URL(e,s)}}function loadURL(e,t){const r=e.slice(0,64).match(isDataURL);let n;return r!==null?n=Promise.resolve(decode$4(e.slice(r[0].length))):n=fetchBinary(e,t),n.then(a=>{const s=new Uint8Array(a);return loadBinary(s,r?e:void 0,t&&t.ignorePalette)})}function loadPNG(e){const t=decodePng(e);let r=t.channels,n,a=0;return r===2||r===4?(n=r-1,a=1):n=r,t.palette?loadPNGFromPalette(t):new Image$1(t.width,t.height,t.data,{components:n,alpha:a,bitDepth:t.depth})}function loadPNGFromPalette(e){const t=e.width*e.height,r=e.palette[0].length,n=new Uint8Array(t*r),a=8/e.depth,s=e.depth<8?a:1,f=parseInt("1".repeat(e.depth),2),o=r===4;let x=0;for(let C=0;C<t;C++){const P=Math.floor(C/s);let Y=e.data[P];e.depth<8&&(Y=Y>>>e.depth*(a-1-C%a)&f);const ze=e.palette[Y];n[x++]=ze[0],n[x++]=ze[1],n[x++]=ze[2],o&&(n[x++]=ze[3])}return new Image$1(e.width,e.height,n,{components:3,alpha:o,bitDepth:8})}function loadJPEG(e){const t=decode$1(e);let r;t.exif&&(r=getMetadata(t.exif));const n=jpegJs.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let a=new Image$1(n.width,n.height,n.data,{meta:r});if(r&&r.tiff.tags.Orientation){const s=r.tiff.tags.Orientation;s>2&&(a=a.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(a=a.flipX())}return a}function loadTIFF(e,t){let r=decodeTIFF(e);return r.length===1?getImageFromIFD(r[0],t):new Stack$3(r.map(function(n){return getImageFromIFD(n,t)}))}function getMetadata(e){const t={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(t.exif=e.exif),e.gps&&(t.gps=e.gps),t}function getImageFromIFD(e,t){if(!t&&e.type===3){const r=new Uint16Array(3*e.width*e.height),n=e.palette;let a=0;for(let s=0;s<e.data.length;s++){const f=e.data[s],o=n[f];r[a++]=o[0],r[a++]=o[1],r[a++]=o[2]}return new Image$1(e.width,e.height,r,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image$1(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,t){return t=t||{},new Promise(function(r,n){let a=new DOMImage;a.onload=function(){let s=a.width,f=a.height,x=createCanvas(s,f).getContext("2d");x.drawImage(a,0,0,s,f);let C=x.getImageData(0,0,s,f).data;r(new Image$1(s,f,C,t))},a.onerror=function(){n(new Error(`Could not load ${e}`))},a.src=e})}const valueMethods={getValueXY(e,t,r){return this.data[(t*this.width+e)*this.channels+r]},setValueXY(e,t,r,n){return this.data[(t*this.width+e)*this.channels+r]=n,this.computed=null,this},getValue(e,t){return this.data[e*this.channels+t]},setValue(e,t,r){return this.data[e*this.channels+t]=r,this.computed=null,this},getPixelXY(e,t){return this.getPixel(t*this.width+e)},setPixelXY(e,t,r){return this.setPixel(t*this.width+e,r)},getPixel(e){const t=new Array(this.channels),r=e*this.channels;for(let n=0;n<this.channels;n++)t[n]=this.data[r+n];return t},setPixel(e,t){const r=e*this.channels;for(let n=0;n<t.length;n++)this.data[r+n]=t[n];return this.computed=null,this}};function setValueMethods(e){for(const t in valueMethods)e.prototype[t]=valueMethods[t]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,t,r,n={}){const{out:a}=t;if(a===void 0)return n.copy?e.clone():Image$1.createFrom(e,r);{if(!Image$1.isImage(a))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(e),r);for(const f in s)if(a[f]!==s[f])throw new RangeError(`cannot use out. Its ${f} must be "${s[f]}" (found "${a[f]}")`);return a}}function getOutputImageOrInPlace(e,t,r){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,t,null,r)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,e);return absolute(this,t),t}function absolute(e,t){for(let r=0;r<e.data.length;r++)t.data[r]=Math.abs(e.data[r])}function copyAlphaChannel(e,t){if(e.alpha===1&&t.alpha===1)for(let r=0;r<e.size;r++)t.data[r*t.channels+t.components]=e.data[r*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(e,t){for(let r=0;r<e.data.length;r++)t.data[r]=~e.data[r]}function invertColor(e,t){for(let r=0;r<e.data.length;r+=e.channels)for(let n=0;n<e.components;n++)t.data[r+n]=e.maxValue-e.data[r+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let t=e*this.width*this.channels;for(let r=0;r<Math.floor(this.width/2);r++){let n=r*this.channels+t,a=(this.width-r-1)*this.channels+t;for(let s=0;s<this.channels;s++){let f=this.data[n+s];this.data[n+s]=this.data[a+s],this.data[a+s]=f}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let t=0;t<this.width;t++){let r=t*this.channels+e*this.width*this.channels,n=t*this.channels+(this.height-1-e)*this.channels*this.width;for(let a=0;a<this.channels;a++){let s=this.data[r+a];this.data[r+a]=this.data[n+a],this.data[n+a]=s}}return this}function blurFilter(e={}){const{radius:t=1}=e;if(t<1)throw new Error("radius must be greater than 1");const r=2*t+1,n=new Array(r);for(let a=0;a<r;a++){n[a]=new Array(r);for(let s=0;s<r;s++)n[a][s]=1/(r*r)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(e){(function(){function t(a){for(var s=0,f=a.length-1,o=void 0,x=void 0,C=void 0,P=n(s,f);;){if(f<=s)return a[P];if(f==s+1)return a[s]>a[f]&&r(a,s,f),a[P];for(o=n(s,f),a[o]>a[f]&&r(a,o,f),a[s]>a[f]&&r(a,s,f),a[o]>a[s]&&r(a,o,s),r(a,o,s+1),x=s+1,C=f;;){do x++;while(a[s]>a[x]);do C--;while(a[C]>a[s]);if(C<x)break;r(a,x,C)}r(a,s,C),C<=P&&(s=x),C>=P&&(f=C-1)}}var r=function(s,f,o){var x;return x=[s[o],s[f]],s[f]=x[0],s[o]=x[1],x},n=function(s,f){return~~((s+f)/2)};e.exports?e.exports=t:window.median=t})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(e,t={}){let{channels:r,allowAlpha:n,defaultAlpha:a}=t;return typeof n!="boolean"&&(n=!0),typeof r>"u"?allChannels(e,a):validateChannels(e,r,n)}function allChannels(e,t){let r=t?e.channels:e.components,n=new Array(r);for(let a=0;a<r;a++)n[a]=a;return n}function validateChannels(e,t,r){Array.isArray(t)||(t=[t]);for(let n=0;n<t.length;n++)t[n]=validateChannel(e,t[n],r);return t}function validateChannel(e,t,r=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof t=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(t==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=e.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!r&&t>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(e={}){let{radius:t=1,border:r="copy",channels:n}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let a=t,s=t,f=Image$1.createFrom(this),o=(a*2+1)*(s*2+1),x=new Array(o);for(let C=0;C<n.length;C++){let P=n[C];for(let Y=s;Y<this.height-s;Y++)for(let ze=a;ze<this.width-a;ze++){let ge=0;for(let Ur=-s;Ur<=s;Ur++)for(let kn=-a;kn<=a;kn++){let Io=((Y+Ur)*this.width+ze+kn)*this.channels+P;x[ge++]=this.data[Io]}let Bt=(Y*this.width+ze)*this.channels+P;f.data[Bt]=quickSelectMedian(x)}}if(this.alpha&&!n.includes(this.channels))for(let C=this.components;C<this.data.length;C=C+this.channels)f.data[C]=this.data[C];return f.setBorder({size:[a,s],algorithm:r}),f}function gaussianFilter(e={}){let{radius:t=1,sigma:r,channels:n,border:a="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(t,r);return this.convolution([s,s],{border:a,channels:n,algorithm:"separable"})}function getKernel(e,t){const r=e*2+1,n=new Array(r),a=t||((r-1)*.5-1)*.3+.8,s=-.5/(a*a);let f=0;for(let o=0;o<r;o++){const x=o-e,C=Math.exp(s*x*x);n[o]=C,f+=C}for(let o=0;o<r;o++)n[o]/=f;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(e){(function(){var t;t=e;var r={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+r.release+", released "+r.date};for(var n=0,a=null,s=null,f={init:function(C){if(C!==0&&!(C&C-1))n=C,f._initArray(),f._makeBitReversalTable(),f._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(C,P){f.fft(C,P,1)},ifft1d:function(C,P){var Y=1/n;f.fft(C,P,-1);for(var ze=0;ze<n;ze++)C[ze]*=Y,P[ze]*=Y},bt1d:function(C,P){f.fft(C,P,-1)},fft2d:function(C,P){for(var Y=[],ze=[],ge=0,Bt=0;Bt<n;Bt++){ge=Bt*n;for(var Ur=0;Ur<n;Ur++)Y[Ur]=C[Ur+ge],ze[Ur]=P[Ur+ge];f.fft1d(Y,ze);for(var kn=0;kn<n;kn++)C[kn+ge]=Y[kn],P[kn+ge]=ze[kn]}for(var Io=0;Io<n;Io++){for(var rl=0;rl<n;rl++)ge=Io+rl*n,Y[rl]=C[ge],ze[rl]=P[ge];f.fft1d(Y,ze);for(var Co=0;Co<n;Co++)ge=Io+Co*n,C[ge]=Y[Co],P[ge]=ze[Co]}},ifft2d:function(C,P){for(var Y=[],ze=[],ge=0,Bt=0;Bt<n;Bt++){ge=Bt*n;for(var Ur=0;Ur<n;Ur++)Y[Ur]=C[Ur+ge],ze[Ur]=P[Ur+ge];f.ifft1d(Y,ze);for(var kn=0;kn<n;kn++)C[kn+ge]=Y[kn],P[kn+ge]=ze[kn]}for(var Io=0;Io<n;Io++){for(var rl=0;rl<n;rl++)ge=Io+rl*n,Y[rl]=C[ge],ze[rl]=P[ge];f.ifft1d(Y,ze);for(var Co=0;Co<n;Co++)ge=Io+Co*n,C[ge]=Y[Co],P[ge]=ze[Co]}},fft:function(C,P,Y){for(var ze,ge,Bt,Ur,kn,Io,rl,Co,as,$s=n>>2,ah=0;ah<n;ah++)Ur=a[ah],ah<Ur&&(kn=C[ah],C[ah]=C[Ur],C[Ur]=kn,kn=P[ah],P[ah]=P[Ur],P[Ur]=kn);for(var ch=1;ch<n;ch<<=1){ge=0,ze=n/(ch<<1);for(var Zu=0;Zu<ch;Zu++){Io=s[ge+$s],rl=Y*s[ge];for(var ih=Zu;ih<n;ih+=ch<<1)Bt=ih+ch,Co=Io*C[Bt]+rl*P[Bt],as=Io*P[Bt]-rl*C[Bt],C[Bt]=C[ih]-Co,C[ih]+=Co,P[Bt]=P[ih]-as,P[ih]+=as;ge+=ze}}},_initArray:function(){typeof Uint32Array<"u"?a=new Uint32Array(n):a=[],typeof Float64Array<"u"?s=new Float64Array(n*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var C=0,P=0,Y=0;for(a[0]=0;++C<n;){for(Y=n>>1;Y<=P;)P-=Y,Y>>=1;P+=Y,a[C]=P}},_makeCosSinTable:function(){var C=n>>1,P=n>>2,Y=n>>3,ze=C+P,ge=Math.sin(Math.PI/n),Bt=2*ge*ge,Ur=Math.sqrt(Bt*(2-Bt)),kn=s[P]=1,Io=s[0]=0;ge=2*Bt;for(var rl=1;rl<Y;rl++)kn-=Bt,Bt+=ge*kn,Io+=Ur,Ur-=ge*Io,s[rl]=Io,s[P-rl]=kn;Y!==0&&(s[Y]=Math.sqrt(.5));for(var Co=0;Co<P;Co++)s[C-Co]=s[Co];for(var as=0;as<ze;as++)s[as+C]=-s[as]}},o=["init","fft1d","ifft1d","fft2d","ifft2d"],x=0;x<o.length;x++)t[o[x]]=f[o[x]];return t.bt=f.bt1d,t.fft=f.fft1d,t.ifft=f.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(e,t,r){var n=new Array(t*r),a=t/2,s=(r-1)*2;FFT$1.init(a);for(var f={re:new Array(a),im:new Array(a)},o=0;o<r;o++){for(var x=a-1;x>=0;x--)f.re[x]=e[x*2*r+o],f.im[x]=e[(x*2+1)*r+o];FFT$1.bt(f.re,f.im);for(var x=a-1;x>=0;x--)n[x*2*r+o]=f.re[x],n[(x*2+1)*r+o]=f.im[x]}var C=new Array(a*s);FFT$1.init(s);for(var P={re:new Array(s),im:new Array(s)},Y=s*a,x=0;x<t;x+=2){P.re[0]=n[x*r],P.im[0]=n[(x+1)*r];for(var o=1;o<r;o++)P.re[o]=n[x*r+o],P.im[o]=n[(x+1)*r+o],P.re[s-o]=n[x*r+o],P.im[s-o]=-n[(x+1)*r+o];FFT$1.bt(P.re,P.im);for(var ze=x/2*s,o=s-1;o>=0;o--)C[ze+o]=P.re[o]/Y}return C},fft2DArray:function(e,t,r,n){Object.assign({},{inplace:!0});var a=r/2+1,s=t*2,f=new Array(s*a);FFT$1.init(r);for(var o={re:new Array(r),im:new Array(r)},x={re:new Array(r),im:new Array(r)},C={re:new Array(r),im:new Array(r)},P,Y,ze,ge,Bt,Ur=0;Ur<t/2;Ur++){P=Ur*2*r,o.re=e.slice(P,P+r),P=(Ur*2+1)*r,o.im=e.slice(P,P+r),FFT$1.fft1d(o.re,o.im),this.reconstructTwoRealFFT(o,x,C),Y=Ur*4*a,ze=(Ur*4+1)*a,ge=(Ur*4+2)*a,Bt=(Ur*4+3)*a;for(var kn=a-1;kn>=0;kn--)f[Y+kn]=x.re[kn],f[ze+kn]=x.im[kn],f[ge+kn]=C.re[kn],f[Bt+kn]=C.im[kn]}x=null,C=null;var Io=new Array(s*a);FFT$1.init(t);for(var rl={re:new Array(t),im:new Array(t)},Co=a-1;Co>=0;Co--){for(var Ur=t-1;Ur>=0;Ur--)rl.re[Ur]=f[Ur*2*a+Co],rl.im[Ur]=f[(Ur*2+1)*a+Co],isNaN(rl.re[Ur])&&(rl.re[Ur]=0),isNaN(rl.im[Ur])&&(rl.im[Ur]=0);FFT$1.fft1d(rl.re,rl.im);for(var Ur=t-1;Ur>=0;Ur--)Io[Ur*2*a+Co]=rl.re[Ur],Io[(Ur*2+1)*a+Co]=rl.im[Ur]}return Io},reconstructTwoRealFFT:function(e,t,r){var n=e.re.length;t.re[0]=e.re[0],t.im[0]=0,r.re[0]=e.im[0],r.im[0]=0;for(var a,s,f,o,x,C=n/2;C>0;C--)x=n-C,a=.5*(e.re[C]-e.re[x]),s=.5*(e.re[C]+e.re[x]),f=.5*(e.im[C]-e.im[x]),o=.5*(e.im[C]+e.im[x]),t.re[C]=s,t.im[C]=f,t.re[x]=s,t.im[x]=-f,r.re[C]=o,r.im[C]=-a,r.re[x]=o,r.im[x]=a},convolute2DI:function(e,t,r,n){for(var a,s,f=0;f<r/2;f++)for(var o=0;o<n;o++)a=e[f*2*n+o]*t[f*2*n+o]-e[(f*2+1)*n+o]*t[(f*2+1)*n+o],s=e[f*2*n+o]*t[(f*2+1)*n+o]+e[(f*2+1)*n+o]*t[f*2*n+o],e[f*2*n+o]=a,e[(f*2+1)*n+o]=s},convolute:function(e,t,r,n,a){for(var s=new Array(n*r),f=0;f<r*n;f++)s[f]=e[f];s=this.fft2DArray(s,r,n);for(var o=t.length,x=t[0].length,C=new Array(n*r),f=0;f<n*r;f++)C[f]=0;for(var P,Y,ze=Math.floor((o-1)/2),ge=Math.floor((x-1)/2),Bt=0;Bt<o;Bt++){P=(Bt-ze+r)%r;for(var Ur=0;Ur<x;Ur++)Y=(Ur-ge+n)%n,C[P*n+Y]=t[Bt][Ur]}C=this.fft2DArray(C,r,n);var kn=r*2,Io=n/2+1;return this.convolute2DI(s,C,kn,Io),this.ifft2DArray(s,kn,Io)},toRadix2:function(e,t,r){var n,a,s,f,o=r,x=t;if(!(r!==0&&!(r&r-1))){for(o=0;r>>++o;);o=1<<o}if(!(t!==0&&!(t&t-1))){for(x=0;t>>++x;);x=1<<x}if(x==t&&o==r)return{data:e,rows:t,cols:r};var C=new Array(x*o),P=Math.floor((x-t)/2)-t,Y=Math.floor((o-r)/2)-r;for(n=0;n<x;n++)for(s=n*o,f=(n-P)%t*r,a=0;a<o;a++)C[s+a]=e[f+(a-Y)%r];return{data:C,rows:x,cols:o}},crop:function(e,t,r,n,a,s){if(t==n&&r==a)return e;Object.assign({},s);var f=new Array(a*n),o=Math.floor((t-n)/2),x=Math.floor((r-a)/2),C,P,Y,ze;for(Y=0;Y<n;Y++)for(C=Y*a,P=(Y+o)*r,ze=0;ze<a;ze++)f[C+ze]=e[P+(ze+x)];return f}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(e,t,r){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),f,o;if(s.rows&&s.cols)f=s.rows,o=s.cols;else throw new Error("Invalid number of rows or columns "+f+" "+o);var x=s.divisor,C,P,Y=t.length,ze=t[0].length;if(s.normalize)for(x=0,C=0;C<Y;C++)for(P=0;P<ze;P++)x+=t[C][P];if(x===0)throw new RangeError("convolution: The divisor is equal to zero");var ge=FFTUtils.toRadix2(a,f,o),Bt=FFTUtils.convolute(ge.data,t,ge.rows,ge.cols);if(Bt=FFTUtils.crop(Bt,ge.rows,ge.cols,f,o),x!=0&&x!=1)for(C=0;C<Bt.length;C++)Bt[C]/=x;return Bt}function convolutionDirect(e,t,r){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),f,o;if(s.rows&&s.cols)f=s.rows,o=s.cols;else throw new Error("Invalid number of rows or columns "+f+" "+o);var x=s.divisor,C=t.length,P=t[0].length,Y,ze,ge,Bt,Ur,kn,Io,rl,Co;if(s.normalize)for(x=0,Y=0;Y<C;Y++)for(ze=0;ze<P;ze++)x+=t[Y][ze];if(x===0)throw new RangeError("convolution: The divisor is equal to zero");var as=new Array(f*o),$s=Math.floor(C/2),ah=Math.floor(P/2);for(Bt=0;Bt<f;Bt++)for(ge=0;ge<o;ge++){for(kn=0,ze=0;ze<C;ze++)for(Y=0;Y<P;Y++)Io=t[C-ze-1][P-Y-1],rl=(Bt+ze-$s+f)%f,Co=(ge+Y-ah+o)%o,Ur=rl*o+Co,kn+=a[Ur]*Io;Ur=Bt*o+ge,as[Ur]=kn/x}return as}function LoG(e,t,r){var n=1e3;r&&r.factor&&(n=r.factor);var a=new Array(t),s,f,o,x;n*=-1;var C=(t-1)/2,P=2*e*e;for(s=0;s<t;s++)for(a[s]=new Array(t),x=(s-C)*(s-C),f=0;f<t;f++)o=-((f-C)*(f-C)+x)/P,a[s][f]=Math.round(n*(1+o)*Math.exp(o));return a}function matrix2Array(e){var t=e,r,n;if(typeof e[0]!="number"){r=e.length,n=e[0].length,t=new Array(r*n);for(var a=0;a<r;a++)for(var s=0;s<n;s++)t[a*n+s]=e[a][s]}else{var f=Math.sqrt(e.length);Number.isInteger(f)&&(r=f,n=f)}return{data:t,rows:r,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite$1(e)&&Math.floor(e)===e};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(e){let t,r;if(Array.isArray(e))if(Array.isArray(e[0])){if(!(e.length&1)||!(e[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(e.length/2),r=Math.floor(e[0].length/2)}else{let n=Math.sqrt(e.length);if(isInteger$1(n))r=t=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let a=new Array(n);for(let s=0;s<n;s++){a[s]=new Array(n);for(let f=0;f<n;f++)a[s][f]=e[s*n+f]}e=a}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:r,kHeight:t}}function clamp(e,t){return Math.round(Math.min(Math.max(e,0),t.maxValue))}function directConvolution(e,t,r){if(r===void 0){const s=e.length+t.length-1;r=new Array(s)}fill(r);for(var n=0;n<e.length;n++)for(var a=0;a<t.length;a++)r[n+a]+=e[n]*t[a];return r}function fill(e){for(var t=0;t<e.length;t++)e[t]=0}function FFT(e){if(this.size=e|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(this.size*2),r=0;r<t.length;r+=2){const x=Math.PI*r/this.size;t[r]=Math.cos(x),t[r+1]=-Math.sin(x)}this.table=t;for(var n=0,a=1;this.size>a;a<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var f=0;f<this._width;f+=2){var o=this._width-f-2;this._bitrev[s]|=(s>>>f&3)<<o}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function e(t,r){for(var n=r||new Array(t.length>>>1),a=0;a<t.length;a+=2)n[a>>>1]=t[a];return n};FFT.prototype.createComplexArray=function e(){const t=new Array(this._csize);for(var r=0;r<t.length;r++)t[r]=0;return t};FFT.prototype.toComplexArray=function e(t,r){for(var n=r||this.createComplexArray(),a=0;a<n.length;a+=2)n[a]=t[a>>>1],n[a+1]=0;return n};FFT.prototype.completeSpectrum=function e(t){for(var r=this._csize,n=r>>>1,a=2;a<n;a+=2)t[r-a]=t[a],t[r-a+1]=-t[a+1]};FFT.prototype.transform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function e(){var t=this._out,r=this._csize,n=this._width,a=1<<n,s=r/a<<1,f,o,x=this._bitrev;if(s===4)for(f=0,o=0;f<r;f+=s,o++){const Ur=x[o];this._singleTransform2(f,Ur,a)}else for(f=0,o=0;f<r;f+=s,o++){const Ur=x[o];this._singleTransform4(f,Ur,a)}var C=this._inv?-1:1,P=this.table;for(a>>=2;a>=2;a>>=2){s=r/a<<1;var Y=s>>>2;for(f=0;f<r;f+=s)for(var ze=f+Y,ge=f,Bt=0;ge<ze;ge+=2,Bt+=a){const Ur=ge,kn=Ur+Y,Io=kn+Y,rl=Io+Y,Co=t[Ur],as=t[Ur+1],$s=t[kn],ah=t[kn+1],ch=t[Io],Zu=t[Io+1],ih=t[rl],al=t[rl+1],sh=Co,_h=as,Ih=P[Bt],Lh=C*P[Bt+1],Gh=$s*Ih-ah*Lh,ud=$s*Lh+ah*Ih,Tf=P[2*Bt],Kd=C*P[2*Bt+1],Af=ch*Tf-Zu*Kd,md=ch*Kd+Zu*Tf,vd=P[3*Bt],qd=C*P[3*Bt+1],Ed=ih*vd-al*qd,Sd=ih*qd+al*vd,zd=sh+Af,Md=_h+md,Gd=sh-Af,bf=_h-md,Id=Gh+Ed,td=ud+Sd,Fd=C*(Gh-Ed),rp=C*(ud-Sd),jf=zd+Id,yd=Md+td,Jd=zd-Id,op=Md-td,bp=Gd+rp,fp=bf-Fd,Qh=Gd-rp,Yd=bf+Fd;t[Ur]=jf,t[Ur+1]=yd,t[kn]=bp,t[kn+1]=fp,t[Io]=Jd,t[Io+1]=op,t[rl]=Qh,t[rl+1]=Yd}}};FFT.prototype._singleTransform2=function e(t,r,n){const a=this._out,s=this._data,f=s[r],o=s[r+1],x=s[r+n],C=s[r+n+1],P=f+x,Y=o+C,ze=f-x,ge=o-C;a[t]=P,a[t+1]=Y,a[t+2]=ze,a[t+3]=ge};FFT.prototype._singleTransform4=function e(t,r,n){const a=this._out,s=this._data,f=this._inv?-1:1,o=n*2,x=n*3,C=s[r],P=s[r+1],Y=s[r+n],ze=s[r+n+1],ge=s[r+o],Bt=s[r+o+1],Ur=s[r+x],kn=s[r+x+1],Io=C+ge,rl=P+Bt,Co=C-ge,as=P-Bt,$s=Y+Ur,ah=ze+kn,ch=f*(Y-Ur),Zu=f*(ze-kn),ih=Io+$s,al=rl+ah,sh=Co+Zu,_h=as-ch,Ih=Io-$s,Lh=rl-ah,Gh=Co-Zu,ud=as+ch;a[t]=ih,a[t+1]=al,a[t+2]=sh,a[t+3]=_h,a[t+4]=Ih,a[t+5]=Lh,a[t+6]=Gh,a[t+7]=ud};FFT.prototype._realTransform4=function e(){var t=this._out,r=this._csize,n=this._width,a=1<<n,s=r/a<<1,f,o,x=this._bitrev;if(s===4)for(f=0,o=0;f<r;f+=s,o++){const Yf=x[o];this._singleRealTransform2(f,Yf>>>1,a>>>1)}else for(f=0,o=0;f<r;f+=s,o++){const Yf=x[o];this._singleRealTransform4(f,Yf>>>1,a>>>1)}var C=this._inv?-1:1,P=this.table;for(a>>=2;a>=2;a>>=2){s=r/a<<1;var Y=s>>>1,ze=Y>>>1,ge=ze>>>1;for(f=0;f<r;f+=s)for(var Bt=0,Ur=0;Bt<=ge;Bt+=2,Ur+=a){var kn=f+Bt,Io=kn+ze,rl=Io+ze,Co=rl+ze,as=t[kn],$s=t[kn+1],ah=t[Io],ch=t[Io+1],Zu=t[rl],ih=t[rl+1],al=t[Co],sh=t[Co+1],_h=as,Ih=$s,Lh=P[Ur],Gh=C*P[Ur+1],ud=ah*Lh-ch*Gh,Tf=ah*Gh+ch*Lh,Kd=P[2*Ur],Af=C*P[2*Ur+1],md=Zu*Kd-ih*Af,vd=Zu*Af+ih*Kd,qd=P[3*Ur],Ed=C*P[3*Ur+1],Sd=al*qd-sh*Ed,zd=al*Ed+sh*qd,Md=_h+md,Gd=Ih+vd,bf=_h-md,Id=Ih-vd,td=ud+Sd,Fd=Tf+zd,rp=C*(ud-Sd),jf=C*(Tf-zd),yd=Md+td,Jd=Gd+Fd,op=bf+jf,bp=Id-rp;if(t[kn]=yd,t[kn+1]=Jd,t[Io]=op,t[Io+1]=bp,Bt===0){var fp=Md-td,Qh=Gd-Fd;t[rl]=fp,t[rl+1]=Qh;continue}if(Bt!==ge){var Yd=bf,sd=-Id,Zd=Md,Xh=-Gd,Ld=-C*jf,Kf=-C*rp,If=-C*Fd,Df=-C*td,Jf=Yd+Ld,Nf=sd+Kf,Wf=Zd+Df,Mp=Xh-If,Sp=f+ze-Bt,Pp=f+Y-Bt;t[Sp]=Jf,t[Sp+1]=Nf,t[Pp]=Wf,t[Pp+1]=Mp}}}};FFT.prototype._singleRealTransform2=function e(t,r,n){const a=this._out,s=this._data,f=s[r],o=s[r+n],x=f+o,C=f-o;a[t]=x,a[t+1]=0,a[t+2]=C,a[t+3]=0};FFT.prototype._singleRealTransform4=function e(t,r,n){const a=this._out,s=this._data,f=this._inv?-1:1,o=n*2,x=n*3,C=s[r],P=s[r+n],Y=s[r+o],ze=s[r+x],ge=C+Y,Bt=C-Y,Ur=P+ze,kn=f*(P-ze),Io=ge+Ur,rl=Bt,Co=-kn,as=ge-Ur,$s=Bt,ah=kn;a[t]=Io,a[t+1]=0,a[t+2]=rl,a[t+3]=Co,a[t+4]=as,a[t+5]=0,a[t+6]=$s,a[t+7]=ah};function convolutionSeparable(e,t,r,n){const a=new Array(e.length);let s,f,o,x;x=t[1],o=(x.length-1)/2,f=new Array(r+x.length-1),s=new Array(r);for(let C=0;C<n;C++){for(let P=0;P<r;P++)s[P]=e[C*r+P];directConvolution(s,x,f);for(let P=0;P<r;P++)a[C*r+P]=f[o+P]}x=t[0],o=(x.length-1)/2,f=new Array(n+x.length-1),s=new Array(n);for(let C=0;C<r;C++){for(let P=0;P<n;P++)s[P]=a[P*r+C];directConvolution(s,x,f);for(let P=0;P<n;P++)a[P*r+C]=f[o+P]}return a}const toString$4=Object.prototype.toString;function isAnyArray(e){return toString$4.call(e).endsWith("Array]")}function max$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,a=t.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var f=e[n],o=n+1;o<s;o++)e[o]>f&&(f=e[o]);return f}function min$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,a=t.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var f=e[n],o=n+1;o<s;o++)e[o]<f&&(f=e[o]);return f}function rescale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(t.output!==void 0){if(!isAnyArray(t.output))throw new TypeError("output option must be an array if specified");r=t.output}else r=new Array(e.length);var n=min$1(e),a=max$1(e);if(n===a)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=t.min,f=s===void 0?t.autoMinMax?n:0:s,o=t.max,x=o===void 0?t.autoMinMax?a:1:o;if(f>=x)throw new RangeError("min option must be smaller than max option");for(var C=(x-f)/(a-n),P=0;P<e.length;P++)r[P]=(e[P]-n)*C+f;return r}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(e,t={}){const{maxRows:r=15,maxColumns:n=10,maxNumSize:a=8,padMinus:s="auto"}=t;return`${e.constructor.name} {
${indent}[
${indentData}${inspectData(e,r,n,a,s)}
${indent}]
${indent}rows: ${e.rows}
${indent}columns: ${e.columns}
}`}function inspectData(e,t,r,n,a){const{rows:s,columns:f}=e,o=Math.min(s,t),x=Math.min(f,r),C=[];if(a==="auto"){a=!1;e:for(let P=0;P<o;P++)for(let Y=0;Y<x;Y++)if(e.get(P,Y)<0){a=!0;break e}}for(let P=0;P<o;P++){let Y=[];for(let ze=0;ze<x;ze++)Y.push(formatNumber(e.get(P,ze),n,a));C.push(`${Y.join(" ")}`)}return x!==f&&(C[C.length-1]+=` ... ${f-r} more columns`),o!==s&&C.push(`... ${s-t} more rows`),C.join(`
${indentData}`)}function formatNumber(e,t,r){return(e>=0&&r?` ${formatNumber2(e,t-1)}`:formatNumber2(e,t)).padEnd(t)}function formatNumber2(e,t){let r=e.toString();if(r.length<=t)return r;let n=e.toFixed(t);if(n.length>t&&(n=e.toFixed(Math.max(0,t-(n.length-t)))),n.length<=t&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let a=e.toExponential(t);return a.length>t&&(a=e.toExponential(Math.max(0,t-(a.length-t)))),a.slice(0)}function installMathOperations(e,t){e.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},e.prototype.addS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n);return this},e.prototype.addM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n.get(a,s));return this},e.add=function(n,a){return new t(n).add(a)},e.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},e.prototype.subS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n);return this},e.prototype.subM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n.get(a,s));return this},e.sub=function(n,a){return new t(n).sub(a)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},e.prototype.mulS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n);return this},e.prototype.mulM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n.get(a,s));return this},e.mul=function(n,a){return new t(n).mul(a)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},e.prototype.divS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n);return this},e.prototype.divM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n.get(a,s));return this},e.div=function(n,a){return new t(n).div(a)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},e.prototype.modS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n);return this},e.prototype.modM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n.get(a,s));return this},e.mod=function(n,a){return new t(n).mod(a)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},e.prototype.andS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n);return this},e.prototype.andM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n.get(a,s));return this},e.and=function(n,a){return new t(n).and(a)},e.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},e.prototype.orS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n);return this},e.prototype.orM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n.get(a,s));return this},e.or=function(n,a){return new t(n).or(a)},e.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},e.prototype.xorS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n);return this},e.prototype.xorM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n.get(a,s));return this},e.xor=function(n,a){return new t(n).xor(a)},e.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},e.prototype.leftShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n);return this},e.prototype.leftShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n.get(a,s));return this},e.leftShift=function(n,a){return new t(n).leftShift(a)},e.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},e.prototype.signPropagatingRightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n);return this},e.prototype.signPropagatingRightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n.get(a,s));return this},e.signPropagatingRightShift=function(n,a){return new t(n).signPropagatingRightShift(a)},e.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},e.prototype.rightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n);return this},e.prototype.rightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n.get(a,s));return this},e.rightShift=function(n,a){return new t(n).rightShift(a)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,~this.get(n,a));return this},e.not=function(n){return new t(n).not()},e.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.abs(this.get(n,a)));return this},e.abs=function(n){return new t(n).abs()},e.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acos(this.get(n,a)));return this},e.acos=function(n){return new t(n).acos()},e.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acosh(this.get(n,a)));return this},e.acosh=function(n){return new t(n).acosh()},e.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asin(this.get(n,a)));return this},e.asin=function(n){return new t(n).asin()},e.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asinh(this.get(n,a)));return this},e.asinh=function(n){return new t(n).asinh()},e.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atan(this.get(n,a)));return this},e.atan=function(n){return new t(n).atan()},e.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atanh(this.get(n,a)));return this},e.atanh=function(n){return new t(n).atanh()},e.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cbrt(this.get(n,a)));return this},e.cbrt=function(n){return new t(n).cbrt()},e.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.ceil(this.get(n,a)));return this},e.ceil=function(n){return new t(n).ceil()},e.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.clz32(this.get(n,a)));return this},e.clz32=function(n){return new t(n).clz32()},e.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cos(this.get(n,a)));return this},e.cos=function(n){return new t(n).cos()},e.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cosh(this.get(n,a)));return this},e.cosh=function(n){return new t(n).cosh()},e.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.exp(this.get(n,a)));return this},e.exp=function(n){return new t(n).exp()},e.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.expm1(this.get(n,a)));return this},e.expm1=function(n){return new t(n).expm1()},e.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.floor(this.get(n,a)));return this},e.floor=function(n){return new t(n).floor()},e.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.fround(this.get(n,a)));return this},e.fround=function(n){return new t(n).fround()},e.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log(this.get(n,a)));return this},e.log=function(n){return new t(n).log()},e.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log1p(this.get(n,a)));return this},e.log1p=function(n){return new t(n).log1p()},e.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log10(this.get(n,a)));return this},e.log10=function(n){return new t(n).log10()},e.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log2(this.get(n,a)));return this},e.log2=function(n){return new t(n).log2()},e.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.round(this.get(n,a)));return this},e.round=function(n){return new t(n).round()},e.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sign(this.get(n,a)));return this},e.sign=function(n){return new t(n).sign()},e.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sin(this.get(n,a)));return this},e.sin=function(n){return new t(n).sin()},e.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sinh(this.get(n,a)));return this},e.sinh=function(n){return new t(n).sinh()},e.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sqrt(this.get(n,a)));return this},e.sqrt=function(n){return new t(n).sqrt()},e.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tan(this.get(n,a)));return this},e.tan=function(n){return new t(n).tan()},e.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tanh(this.get(n,a)));return this},e.tanh=function(n){return new t(n).tanh()},e.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.trunc(this.get(n,a)));return this},e.trunc=function(n){return new t(n).trunc()},e.pow=function(n,a){return new t(n).pow(a)},e.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},e.prototype.powS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n));return this},e.prototype.powM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n.get(a,s)));return this}}function checkRowIndex(e,t,r){let n=r?e.rows:e.rows-1;if(t<0||t>n)throw new RangeError("Row index out of range")}function checkColumnIndex(e,t,r){let n=r?e.columns:e.columns-1;if(t<0||t>n)throw new RangeError("Column index out of range")}function checkRowVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(e,t){if(!isAnyArray(t))throw new TypeError("row indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(e,t){if(!isAnyArray(t))throw new TypeError("column indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.columns)throw new RangeError("column indices are out of range")}function checkRange(e,t,r,n,a){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",r),checkNumber("startColumn",n),checkNumber("endColumn",a),t>r||n>a||t<0||t>=e.rows||r<0||r>=e.rows||n<0||n>=e.columns||a<0||a>=e.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(e,t=0){let r=[];for(let n=0;n<e;n++)r.push(t);return r}function checkNumber(e,t){if(typeof t!="number")throw new TypeError(`${e} must be a number`)}function checkNonEmpty(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(e){let t=newArray$2(e.rows);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]+=e.get(r,n);return t}function sumByColumn(e){let t=newArray$2(e.columns);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]+=e.get(r,n);return t}function sumAll(e){let t=0;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t+=e.get(r,n);return t}function productByRow(e){let t=newArray$2(e.rows,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]*=e.get(r,n);return t}function productByColumn(e){let t=newArray$2(e.columns,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]*=e.get(r,n);return t}function productAll(e){let t=1;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t*=e.get(r,n);return t}function varianceByRow(e,t,r){const n=e.rows,a=e.columns,s=[];for(let f=0;f<n;f++){let o=0,x=0,C=0;for(let P=0;P<a;P++)C=e.get(f,P)-r[f],o+=C,x+=C*C;t?s.push((x-o*o/a)/(a-1)):s.push((x-o*o/a)/a)}return s}function varianceByColumn(e,t,r){const n=e.rows,a=e.columns,s=[];for(let f=0;f<a;f++){let o=0,x=0,C=0;for(let P=0;P<n;P++)C=e.get(P,f)-r[f],o+=C,x+=C*C;t?s.push((x-o*o/n)/(n-1)):s.push((x-o*o/n)/n)}return s}function varianceAll(e,t,r){const n=e.rows,a=e.columns,s=n*a;let f=0,o=0,x=0;for(let C=0;C<n;C++)for(let P=0;P<a;P++)x=e.get(C,P)-r,f+=x,o+=x*x;return t?(o-f*f/s)/(s-1):(o-f*f/s)/s}function centerByRow(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[r])}function centerByColumn(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[n])}function centerAll(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t)}function getScaleByRow(e){const t=[];for(let r=0;r<e.rows;r++){let n=0;for(let a=0;a<e.columns;a++)n+=Math.pow(e.get(r,a),2)/(e.columns-1);t.push(Math.sqrt(n))}return t}function scaleByRow(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[r])}function getScaleByColumn(e){const t=[];for(let r=0;r<e.columns;r++){let n=0;for(let a=0;a<e.rows;a++)n+=Math.pow(e.get(a,r),2)/(e.rows-1);t.push(Math.sqrt(n))}return t}function scaleByColumn(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[n])}function getScaleAll(e){const t=e.size-1;let r=0;for(let n=0;n<e.columns;n++)for(let a=0;a<e.rows;a++)r+=Math.pow(e.get(a,n),2)/t;return Math.sqrt(r)}function scaleAll(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t)}class AbstractMatrix{static from1DArray(t,r,n){if(t*r!==n.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix$2(t,r);for(let f=0;f<t;f++)for(let o=0;o<r;o++)s.set(f,o,n[f*r+o]);return s}static rowVector(t){let r=new Matrix$2(1,t.length);for(let n=0;n<t.length;n++)r.set(0,n,t[n]);return r}static columnVector(t){let r=new Matrix$2(t.length,1);for(let n=0;n<t.length;n++)r.set(n,0,t[n]);return r}static zeros(t,r){return new Matrix$2(t,r)}static ones(t,r){return new Matrix$2(t,r).fill(1)}static rand(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:a=Math.random}=n;let s=new Matrix$2(t,r);for(let f=0;f<t;f++)for(let o=0;o<r;o++)s.set(f,o,a());return s}static randInt(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:a=0,max:s=1e3,random:f=Math.random}=n;if(!Number.isInteger(a))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(a>=s)throw new RangeError("min must be smaller than max");let o=s-a,x=new Matrix$2(t,r);for(let C=0;C<t;C++)for(let P=0;P<r;P++){let Y=a+Math.round(f()*o);x.set(C,P,Y)}return x}static eye(t,r,n){r===void 0&&(r=t),n===void 0&&(n=1);let a=Math.min(t,r),s=this.zeros(t,r);for(let f=0;f<a;f++)s.set(f,f,n);return s}static diag(t,r,n){let a=t.length;r===void 0&&(r=a),n===void 0&&(n=r);let s=Math.min(a,r,n),f=this.zeros(r,n);for(let o=0;o<s;o++)f.set(o,o,t[o]);return f}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,a=t.columns,s=new Matrix$2(n,a);for(let f=0;f<n;f++)for(let o=0;o<a;o++)s.set(f,o,Math.min(t.get(f,o),r.get(f,o)));return s}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,a=t.columns,s=new this(n,a);for(let f=0;f<n;f++)for(let o=0;o<a;o++)s.set(f,o,Math.max(t.get(f,o),r.get(f,o)));return s}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix$2(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.call(this,r,n);return this}to1DArray(){let t=[];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.push(this.get(r,n));return t}to2DArray(){let t=[];for(let r=0;r<this.rows;r++){t.push([]);for(let n=0;n<this.columns;n++)t[r].push(this.get(r,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}isEchelonForm(){let t=0,r=0,n=-1,a=!0,s=!1;for(;t<this.rows&&a;){for(r=0,s=!1;r<this.columns&&s===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(s=!0,n=r):(a=!1,s=!0);t++}return a}isReducedEchelonForm(){let t=0,r=0,n=-1,a=!0,s=!1;for(;t<this.rows&&a;){for(r=0,s=!1;r<this.columns&&s===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(s=!0,n=r):(a=!1,s=!0);for(let f=r+1;f<this.rows;f++)this.get(t,f)!==0&&(a=!1);t++}return a}echelonForm(){let t=this.clone(),r=0,n=0;for(;r<t.rows&&n<t.columns;){let a=r;for(let s=r;s<t.rows;s++)t.get(s,n)>t.get(a,n)&&(a=s);if(t.get(a,n)===0)n++;else{t.swapRows(r,a);let s=t.get(r,n);for(let f=n;f<t.columns;f++)t.set(r,f,t.get(r,f)/s);for(let f=r+1;f<t.rows;f++){let o=t.get(f,n)/t.get(r,n);t.set(f,n,0);for(let x=n+1;x<t.columns;x++)t.set(f,x,t.get(f,x)-t.get(r,x)*o)}r++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),r=t.columns,n=t.rows,a=n-1;for(;a>=0;)if(t.maxRow(a)===0)a--;else{let s=0,f=!1;for(;s<n&&f===!1;)t.get(a,s)===1?f=!0:s++;for(let o=0;o<a;o++){let x=t.get(o,s);for(let C=s;C<r;C++){let P=t.get(o,C)-x*t.get(a,C);t.set(o,C,P)}}a--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:n=1}=t;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let a=new Matrix$2(this.rows*r,this.columns*n);for(let s=0;s<r;s++)for(let f=0;f<n;f++)a.setSubMatrix(this,this.rows*s,this.columns*f);return a}fill(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let r=[];for(let n=0;n<this.columns;n++)r.push(this.get(t,n));return r}getRowVector(t){return Matrix$2.rowVector(this.getRow(t))}setRow(t,r){checkRowIndex(this,t),r=checkRowVector(this,r);for(let n=0;n<this.columns;n++)this.set(t,n,r[n]);return this}swapRows(t,r){checkRowIndex(this,t),checkRowIndex(this,r);for(let n=0;n<this.columns;n++){let a=this.get(t,n);this.set(t,n,this.get(r,n)),this.set(r,n,a)}return this}getColumn(t){checkColumnIndex(this,t);let r=[];for(let n=0;n<this.rows;n++)r.push(this.get(n,t));return r}getColumnVector(t){return Matrix$2.columnVector(this.getColumn(t))}setColumn(t,r){checkColumnIndex(this,t),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++)this.set(n,t,r[n]);return this}swapColumns(t,r){checkColumnIndex(this,t),checkColumnIndex(this,r);for(let n=0;n<this.rows;n++){let a=this.get(n,t);this.set(n,t,this.get(n,r)),this.set(n,r,a)}return this}addRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[n]);return this}subRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[n]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[n]);return this}divRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[n]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[r]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[r]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[r]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[r]);return this}mulRow(t,r){checkRowIndex(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*r);return this}mulColumn(t,r){checkColumnIndex(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*r);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r[n]&&(r[n]=this.get(n,a));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r[a]&&(r[a]=this.get(n,a));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r&&(r=this.get(n,a));return r}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>t&&(t=this.get(n,a),r[0]=n,r[1]=a);return r}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r[n]&&(r[n]=this.get(n,a));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r[a]&&(r[a]=this.get(n,a));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r&&(r=this.get(n,a));return r}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<t&&(t=this.get(n,a),r[0]=n,r[1]=a);return r}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n));return r}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let r=this.get(t,0),n=[t,0];for(let a=1;a<this.columns;a++)this.get(t,a)>r&&(r=this.get(t,a),n[1]=a);return n}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n));return r}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let r=this.get(t,0),n=[t,0];for(let a=1;a<this.columns;a++)this.get(t,a)<r&&(r=this.get(t,a),n[1]=a);return n}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>r&&(r=this.get(n,t));return r}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let r=this.get(0,t),n=[0,t];for(let a=1;a<this.rows;a++)this.get(a,t)>r&&(r=this.get(a,t),n[0]=a);return n}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<r&&(r=this.get(n,t));return r}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let r=this.get(0,t),n=[0,t];for(let a=1;a<this.rows;a++)this.get(a,t)<r&&(r=this.get(a,t),n[0]=a);return n}diag(){let t=Math.min(this.rows,this.columns),r=[];for(let n=0;n<t;n++)r.push(this.get(n,n));return r}norm(t="frobenius"){let r=0;if(t==="max")return this.max();if(t==="frobenius"){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)r=r+this.get(n,a)*this.get(n,a);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t+=this.get(r,n),this.set(r,n,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let r=this.to1DArray();if(r.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let a=0;a<r.length;a++)n+=r[a]*t[a];return n}mmul(t){t=Matrix$2.checkMatrix(t);let r=this.rows,n=this.columns,a=t.columns,s=new Matrix$2(r,a),f=new Float64Array(n);for(let o=0;o<a;o++){for(let x=0;x<n;x++)f[x]=t.get(x,o);for(let x=0;x<r;x++){let C=0;for(let P=0;P<n;P++)C+=this.get(x,P)*f[P];s.set(x,o,C)}}return s}strassen2x2(t){t=Matrix$2.checkMatrix(t);let r=new Matrix$2(2,2);const n=this.get(0,0),a=t.get(0,0),s=this.get(0,1),f=t.get(0,1),o=this.get(1,0),x=t.get(1,0),C=this.get(1,1),P=t.get(1,1),Y=(n+C)*(a+P),ze=(o+C)*a,ge=n*(f-P),Bt=C*(x-a),Ur=(n+s)*P,kn=(o-n)*(a+f),Io=(s-C)*(x+P),rl=Y+Bt-Ur+Io,Co=ge+Ur,as=ze+Bt,$s=Y-ze+ge+kn;return r.set(0,0,rl),r.set(0,1,Co),r.set(1,0,as),r.set(1,1,$s),r}strassen3x3(t){t=Matrix$2.checkMatrix(t);let r=new Matrix$2(3,3);const n=this.get(0,0),a=this.get(0,1),s=this.get(0,2),f=this.get(1,0),o=this.get(1,1),x=this.get(1,2),C=this.get(2,0),P=this.get(2,1),Y=this.get(2,2),ze=t.get(0,0),ge=t.get(0,1),Bt=t.get(0,2),Ur=t.get(1,0),kn=t.get(1,1),Io=t.get(1,2),rl=t.get(2,0),Co=t.get(2,1),as=t.get(2,2),$s=(n+a+s-f-o-P-Y)*kn,ah=(n-f)*(-ge+kn),ch=o*(-ze+ge+Ur-kn-Io-rl+as),Zu=(-n+f+o)*(ze-ge+kn),ih=(f+o)*(-ze+ge),al=n*ze,sh=(-n+C+P)*(ze-Bt+Io),_h=(-n+C)*(Bt-Io),Ih=(C+P)*(-ze+Bt),Lh=(n+a+s-o-x-C-P)*Io,Gh=P*(-ze+Bt+Ur-kn-Io-rl+Co),ud=(-s+P+Y)*(kn+rl-Co),Tf=(s-Y)*(kn-Co),Kd=s*rl,Af=(P+Y)*(-rl+Co),md=(-s+o+x)*(Io+rl-as),vd=(s-x)*(Io-as),qd=(o+x)*(-rl+as),Ed=a*Ur,Sd=x*Co,zd=f*Bt,Md=C*ge,Gd=Y*as,bf=al+Kd+Ed,Id=$s+Zu+ih+al+ud+Kd+Af,td=al+sh+Ih+Lh+Kd+md+qd,Fd=ah+ch+Zu+al+Kd+md+vd,rp=ah+Zu+ih+al+Sd,jf=Kd+md+vd+qd+zd,yd=al+sh+_h+Gh+ud+Tf+Kd,Jd=ud+Tf+Kd+Af+Md,op=al+sh+_h+Ih+Gd;return r.set(0,0,bf),r.set(0,1,Id),r.set(0,2,td),r.set(1,0,Fd),r.set(1,1,rp),r.set(1,2,jf),r.set(2,0,yd),r.set(2,1,Jd),r.set(2,2,op),r}mmulStrassen(t){t=Matrix$2.checkMatrix(t);let r=this.clone(),n=r.rows,a=r.columns,s=t.rows,f=t.columns;a!==s&&console.warn(`Multiplying ${n} x ${a} and ${s} x ${f} matrix: dimensions do not match.`);function o(Y,ze,ge){let Bt=Y.rows,Ur=Y.columns;if(Bt===ze&&Ur===ge)return Y;{let kn=AbstractMatrix.zeros(ze,ge);return kn=kn.setSubMatrix(Y,0,0),kn}}let x=Math.max(n,s),C=Math.max(a,f);r=o(r,x,C),t=o(t,x,C);function P(Y,ze,ge,Bt){if(ge<=512||Bt<=512)return Y.mmul(ze);ge%2===1&&Bt%2===1?(Y=o(Y,ge+1,Bt+1),ze=o(ze,ge+1,Bt+1)):ge%2===1?(Y=o(Y,ge+1,Bt),ze=o(ze,ge+1,Bt)):Bt%2===1&&(Y=o(Y,ge,Bt+1),ze=o(ze,ge,Bt+1));let Ur=parseInt(Y.rows/2,10),kn=parseInt(Y.columns/2,10),Io=Y.subMatrix(0,Ur-1,0,kn-1),rl=ze.subMatrix(0,Ur-1,0,kn-1),Co=Y.subMatrix(0,Ur-1,kn,Y.columns-1),as=ze.subMatrix(0,Ur-1,kn,ze.columns-1),$s=Y.subMatrix(Ur,Y.rows-1,0,kn-1),ah=ze.subMatrix(Ur,ze.rows-1,0,kn-1),ch=Y.subMatrix(Ur,Y.rows-1,kn,Y.columns-1),Zu=ze.subMatrix(Ur,ze.rows-1,kn,ze.columns-1),ih=P(AbstractMatrix.add(Io,ch),AbstractMatrix.add(rl,Zu),Ur,kn),al=P(AbstractMatrix.add($s,ch),rl,Ur,kn),sh=P(Io,AbstractMatrix.sub(as,Zu),Ur,kn),_h=P(ch,AbstractMatrix.sub(ah,rl),Ur,kn),Ih=P(AbstractMatrix.add(Io,Co),Zu,Ur,kn),Lh=P(AbstractMatrix.sub($s,Io),AbstractMatrix.add(rl,as),Ur,kn),Gh=P(AbstractMatrix.sub(Co,ch),AbstractMatrix.add(ah,Zu),Ur,kn),ud=AbstractMatrix.add(ih,_h);ud.sub(Ih),ud.add(Gh);let Tf=AbstractMatrix.add(sh,Ih),Kd=AbstractMatrix.add(al,_h),Af=AbstractMatrix.sub(ih,al);Af.add(sh),Af.add(Lh);let md=AbstractMatrix.zeros(2*ud.rows,2*ud.columns);return md=md.setSubMatrix(ud,0,0),md=md.setSubMatrix(Tf,ud.rows,0),md=md.setSubMatrix(Kd,0,ud.columns),md=md.setSubMatrix(Af,ud.rows,ud.columns),md.subMatrix(0,ge-1,0,Bt-1)}return P(r,t,x,C)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.rows;s++){const f=this.getRow(s);f.length>0&&rescale(f,{min:r,max:n,output:f}),a.setRow(s,f)}return a}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.columns;s++){const f=this.getColumn(s);f.length&&rescale(f,{min:r,max:n,output:f}),a.setColumn(s,f)}return a}flipRows(){const t=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let n=0;n<t;n++){let a=this.get(r,n),s=this.get(r,this.columns-1-n);this.set(r,n,s),this.set(r,this.columns-1-n,a)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let n=0;n<t;n++){let a=this.get(n,r),s=this.get(this.rows-1-n,r);this.set(n,r,s),this.set(this.rows-1-n,r,a)}return this}kroneckerProduct(t){t=Matrix$2.checkMatrix(t);let r=this.rows,n=this.columns,a=t.rows,s=t.columns,f=new Matrix$2(r*a,n*s);for(let o=0;o<r;o++)for(let x=0;x<n;x++)for(let C=0;C<a;C++)for(let P=0;P<s;P++)f.set(a*o+C,s*x+P,this.get(o,x)*t.get(C,P));return f}kroneckerSum(t){if(t=Matrix$2.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,n=t.rows,a=this.kroneckerProduct(Matrix$2.eye(n,n)),s=Matrix$2.eye(r,r).kroneckerProduct(t);return a.add(s)}transpose(){let t=new Matrix$2(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(n,r,this.get(r,n));return t}sortRows(t=compareNumbers){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t=compareNumbers){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,n,a){checkRange(this,t,r,n,a);let s=new Matrix$2(r-t+1,a-n+1);for(let f=t;f<=r;f++)for(let o=n;o<=a;o++)s.set(f-t,o-n,this.get(f,o));return s}subMatrixRow(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.columns-1),r>n||r<0||r>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let a=new Matrix$2(t.length,n-r+1);for(let s=0;s<t.length;s++)for(let f=r;f<=n;f++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);a.set(s,f-r,this.get(t[s],f))}return a}subMatrixColumn(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.rows-1),r>n||r<0||r>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let a=new Matrix$2(n-r+1,t.length);for(let s=0;s<t.length;s++)for(let f=r;f<=n;f++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);a.set(f-r,s,this.get(f,t[s]))}return a}setSubMatrix(t,r,n){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return this;let a=r+t.rows-1,s=n+t.columns-1;checkRange(this,r,a,n,s);for(let f=0;f<t.rows;f++)for(let o=0;o<t.columns;o++)this.set(r+f,n+o,t.get(f,o));return this}selection(t,r){checkRowIndices(this,t),checkColumnIndices(this,r);let n=new Matrix$2(t.length,r.length);for(let a=0;a<t.length;a++){let s=t[a];for(let f=0;f<r.length;f++){let o=r[f];n.set(a,f,this.get(s,o))}}return n}trace(){let t=Math.min(this.rows,this.columns),r=0;for(let n=0;n<t;n++)r+=this.get(n,n);return r}clone(){let t=new Matrix$2(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(r,n,this.get(r,n));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const r=this.sum(t);switch(t){case"row":{for(let n=0;n<this.rows;n++)r[n]/=this.columns;return r}case"column":{for(let n=0;n<this.columns;n++)r[n]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:a=this.mean(t)}=r;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByRow(this,n,a)}case"column":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByColumn(this,n,a)}case void 0:{if(typeof a!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,a)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,r){typeof t=="object"&&(r=t,t=void 0);const n=this.variance(t,r);if(t===void 0)return Math.sqrt(n);for(let a=0;a<n.length;a++)n[a]=Math.sqrt(n[a]);return n}center(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:n=this.mean(t)}=r;switch(t){case"row":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");let n=r.scale;switch(t){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(e,t){return e-t}function isArrayOfNumbers(e){return e.every(t=>typeof t=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;let Matrix$2=class QE extends AbstractMatrix{constructor(t,r){if(super(),QE.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let n=0;n<t;n++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(t)){const n=t;if(t=n.length,r=t?n[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let a=0;a<t;a++){if(n[a].length!==r)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(n[a]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[a]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=t,this.columns=r}set(t,r,n){return this.data[t][r]=n,this}get(t,r){return this.data[t][r]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,r){return r===void 0&&(r=t,t=this.rows),checkRowIndex(this,t,!0),r=Float64Array.from(checkRowVector(this,r)),this.data.splice(t,0,r),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns-1);for(let a=0;a<t;a++)n[a]=this.data[r][a];for(let a=t+1;a<this.columns;a++)n[a-1]=this.data[r][a];this.data[r]=n}return this.columns-=1,this}addColumn(t,r){typeof r>"u"&&(r=t,t=this.columns),checkColumnIndex(this,t,!0),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++){const a=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)a[s]=this.data[n][s];for(a[s++]=r[n];s<this.columns+1;s++)a[s]=this.data[n][s-1];this.data[n]=a}return this.columns+=1,this}};installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(t,r,n){super(),this.matrix=t,this.rows=r,this.columns=n}}class MatrixColumnView extends BaseView{constructor(t,r){checkColumnIndex(t,r),super(t,t.rows,1),this.column=r}set(t,r,n){return this.matrix.set(t,this.column,n),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,r){checkColumnIndices(t,r),super(t,t.rows,r.length),this.columnIndices=r}set(t,r,n){return this.matrix.set(t,this.columnIndices[r],n),this}get(t,r){return this.matrix.get(t,this.columnIndices[r])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(t,this.columns-r-1,n),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(this.rows-t-1,r,n),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}class MatrixRowView extends BaseView{constructor(t,r){checkRowIndex(t,r),super(t,1,t.columns),this.row=r}set(t,r,n){return this.matrix.set(this.row,r,n),this}get(t,r){return this.matrix.get(this.row,r)}}class MatrixRowSelectionView extends BaseView{constructor(t,r){checkRowIndices(t,r),super(t,r.length,t.columns),this.rowIndices=r}set(t,r,n){return this.matrix.set(this.rowIndices[t],r,n),this}get(t,r){return this.matrix.get(this.rowIndices[t],r)}}class MatrixSelectionView extends BaseView{constructor(t,r,n){checkRowIndices(t,r),checkColumnIndices(t,n),super(t,r.length,n.length),this.rowIndices=r,this.columnIndices=n}set(t,r,n){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],n),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}}class MatrixSubView extends BaseView{constructor(t,r,n,a,s){checkRange(t,r,n,a,s),super(t,n-r+1,s-a+1),this.startRow=r,this.startColumn=a}set(t,r,n){return this.matrix.set(this.startRow+t,this.startColumn+r,n),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}let MatrixTransposeView$1=class extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,r,n){return this.matrix.set(r,t,n),this}get(t,r){return this.matrix.get(r,t)}};class WrapperMatrix1D extends AbstractMatrix{constructor(t,r={}){const{rows:n=1}=r;if(t.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=t.length/n,this.data=t}set(t,r,n){let a=this._calculateIndex(t,r);return this.data[a]=n,this}get(t,r){let n=this._calculateIndex(t,r);return this.data[n]}_calculateIndex(t,r){return t*this.columns+r}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,r,n){return this.data[t][r]=n,this}get(t,r){return this.data[t][r]}}function wrap(e,t){if(isAnyArray(e))return e[0]&&isAnyArray(e[0])?new WrapperMatrix2D(e):new WrapperMatrix1D(e,t);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let r=t.clone(),n=r.rows,a=r.columns,s=new Float64Array(n),f=1,o,x,C,P,Y,ze,ge,Bt,Ur;for(o=0;o<n;o++)s[o]=o;for(Bt=new Float64Array(n),x=0;x<a;x++){for(o=0;o<n;o++)Bt[o]=r.get(o,x);for(o=0;o<n;o++){for(Ur=Math.min(o,x),Y=0,C=0;C<Ur;C++)Y+=r.get(o,C)*Bt[C];Bt[o]-=Y,r.set(o,x,Bt[o])}for(P=x,o=x+1;o<n;o++)Math.abs(Bt[o])>Math.abs(Bt[P])&&(P=o);if(P!==x){for(C=0;C<a;C++)ze=r.get(P,C),r.set(P,C,r.get(x,C)),r.set(x,C,ze);ge=s[P],s[P]=s[x],s[x]=ge,f=-f}if(x<n&&r.get(x,x)!==0)for(o=x+1;o<n;o++)r.set(o,x,r.get(o,x)/r.get(x,x))}this.LU=r,this.pivotVector=s,this.pivotSign=f}isSingular(){let t=this.LU,r=t.columns;for(let n=0;n<r;n++)if(t.get(n,n)===0)return!0;return!1}solve(t){t=Matrix$2.checkMatrix(t);let r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let a=t.columns,s=t.subMatrixRow(this.pivotVector,0,a-1),f=r.columns,o,x,C;for(C=0;C<f;C++)for(o=C+1;o<f;o++)for(x=0;x<a;x++)s.set(o,x,s.get(o,x)-s.get(C,x)*r.get(o,C));for(C=f-1;C>=0;C--){for(x=0;x<a;x++)s.set(C,x,s.get(C,x)/r.get(C,C));for(o=0;o<C;o++)for(x=0;x<a;x++)s.set(o,x,s.get(o,x)-s.get(C,x)*r.get(o,C))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,n=t.columns;for(let a=0;a<n;a++)r*=t.get(a,a);return r}get lowerTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,a=new Matrix$2(r,n);for(let s=0;s<r;s++)for(let f=0;f<n;f++)s>f?a.set(s,f,t.get(s,f)):s===f?a.set(s,f,1):a.set(s,f,0);return a}get upperTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,a=new Matrix$2(r,n);for(let s=0;s<r;s++)for(let f=0;f<n;f++)s<=f?a.set(s,f,t.get(s,f)):a.set(s,f,0);return a}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):t!==0?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}class QrDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let r=t.clone(),n=t.rows,a=t.columns,s=new Float64Array(a),f,o,x,C;for(x=0;x<a;x++){let P=0;for(f=x;f<n;f++)P=hypotenuse$1(P,r.get(f,x));if(P!==0){for(r.get(x,x)<0&&(P=-P),f=x;f<n;f++)r.set(f,x,r.get(f,x)/P);for(r.set(x,x,r.get(x,x)+1),o=x+1;o<a;o++){for(C=0,f=x;f<n;f++)C+=r.get(f,x)*r.get(f,o);for(C=-C/r.get(x,x),f=x;f<n;f++)r.set(f,o,r.get(f,o)+C*r.get(f,x))}}s[x]=-P}this.QR=r,this.Rdiag=s}solve(t){t=Matrix$2.checkMatrix(t);let r=this.QR,n=r.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let a=t.columns,s=t.clone(),f=r.columns,o,x,C,P;for(C=0;C<f;C++)for(x=0;x<a;x++){for(P=0,o=C;o<n;o++)P+=r.get(o,C)*s.get(o,x);for(P=-P/r.get(C,C),o=C;o<n;o++)s.set(o,x,s.get(o,x)+P*r.get(o,C))}for(C=f-1;C>=0;C--){for(x=0;x<a;x++)s.set(C,x,s.get(C,x)/this.Rdiag[C]);for(o=0;o<C;o++)for(x=0;x<a;x++)s.set(o,x,s.get(o,x)-s.get(C,x)*r.get(o,C))}return s.subMatrix(0,f-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let r=0;r<t;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,r=t.columns,n=new Matrix$2(r,r),a,s;for(a=0;a<r;a++)for(s=0;s<r;s++)a<s?n.set(a,s,t.get(a,s)):a===s?n.set(a,s,this.Rdiag[a]):n.set(a,s,0);return n}get orthogonalMatrix(){let t=this.QR,r=t.rows,n=t.columns,a=new Matrix$2(r,n),s,f,o,x;for(o=n-1;o>=0;o--){for(s=0;s<r;s++)a.set(s,o,0);for(a.set(o,o,1),f=o;f<n;f++)if(t.get(o,o)!==0){for(x=0,s=o;s<r;s++)x+=t.get(s,o)*a.get(s,f);for(x=-x/t.get(o,o),s=o;s<r;s++)a.set(s,f,a.get(s,f)+x*t.get(s,o))}}return a}}class SingularValueDecomposition{constructor(t,r={}){if(t=WrapperMatrix2D.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,a=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:f=!0,autoTranspose:o=!1}=r;let x=!!s,C=!!f,P=!1,Y;if(n<a)if(!o)Y=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{Y=t.transpose(),n=Y.rows,a=Y.columns,P=!0;let al=x;x=C,C=al}else Y=t.clone();let ze=Math.min(n,a),ge=Math.min(n+1,a),Bt=new Float64Array(ge),Ur=new Matrix$2(n,ze),kn=new Matrix$2(a,a),Io=new Float64Array(a),rl=new Float64Array(n),Co=new Float64Array(ge);for(let al=0;al<ge;al++)Co[al]=al;let as=Math.min(n-1,a),$s=Math.max(0,Math.min(a-2,n)),ah=Math.max(as,$s);for(let al=0;al<ah;al++){if(al<as){Bt[al]=0;for(let sh=al;sh<n;sh++)Bt[al]=hypotenuse$1(Bt[al],Y.get(sh,al));if(Bt[al]!==0){Y.get(al,al)<0&&(Bt[al]=-Bt[al]);for(let sh=al;sh<n;sh++)Y.set(sh,al,Y.get(sh,al)/Bt[al]);Y.set(al,al,Y.get(al,al)+1)}Bt[al]=-Bt[al]}for(let sh=al+1;sh<a;sh++){if(al<as&&Bt[al]!==0){let _h=0;for(let Ih=al;Ih<n;Ih++)_h+=Y.get(Ih,al)*Y.get(Ih,sh);_h=-_h/Y.get(al,al);for(let Ih=al;Ih<n;Ih++)Y.set(Ih,sh,Y.get(Ih,sh)+_h*Y.get(Ih,al))}Io[sh]=Y.get(al,sh)}if(x&&al<as)for(let sh=al;sh<n;sh++)Ur.set(sh,al,Y.get(sh,al));if(al<$s){Io[al]=0;for(let sh=al+1;sh<a;sh++)Io[al]=hypotenuse$1(Io[al],Io[sh]);if(Io[al]!==0){Io[al+1]<0&&(Io[al]=0-Io[al]);for(let sh=al+1;sh<a;sh++)Io[sh]/=Io[al];Io[al+1]+=1}if(Io[al]=-Io[al],al+1<n&&Io[al]!==0){for(let sh=al+1;sh<n;sh++)rl[sh]=0;for(let sh=al+1;sh<n;sh++)for(let _h=al+1;_h<a;_h++)rl[sh]+=Io[_h]*Y.get(sh,_h);for(let sh=al+1;sh<a;sh++){let _h=-Io[sh]/Io[al+1];for(let Ih=al+1;Ih<n;Ih++)Y.set(Ih,sh,Y.get(Ih,sh)+_h*rl[Ih])}}if(C)for(let sh=al+1;sh<a;sh++)kn.set(sh,al,Io[sh])}}let ch=Math.min(a,n+1);if(as<a&&(Bt[as]=Y.get(as,as)),n<ch&&(Bt[ch-1]=0),$s+1<ch&&(Io[$s]=Y.get($s,ch-1)),Io[ch-1]=0,x){for(let al=as;al<ze;al++){for(let sh=0;sh<n;sh++)Ur.set(sh,al,0);Ur.set(al,al,1)}for(let al=as-1;al>=0;al--)if(Bt[al]!==0){for(let sh=al+1;sh<ze;sh++){let _h=0;for(let Ih=al;Ih<n;Ih++)_h+=Ur.get(Ih,al)*Ur.get(Ih,sh);_h=-_h/Ur.get(al,al);for(let Ih=al;Ih<n;Ih++)Ur.set(Ih,sh,Ur.get(Ih,sh)+_h*Ur.get(Ih,al))}for(let sh=al;sh<n;sh++)Ur.set(sh,al,-Ur.get(sh,al));Ur.set(al,al,1+Ur.get(al,al));for(let sh=0;sh<al-1;sh++)Ur.set(sh,al,0)}else{for(let sh=0;sh<n;sh++)Ur.set(sh,al,0);Ur.set(al,al,1)}}if(C)for(let al=a-1;al>=0;al--){if(al<$s&&Io[al]!==0)for(let sh=al+1;sh<a;sh++){let _h=0;for(let Ih=al+1;Ih<a;Ih++)_h+=kn.get(Ih,al)*kn.get(Ih,sh);_h=-_h/kn.get(al+1,al);for(let Ih=al+1;Ih<a;Ih++)kn.set(Ih,sh,kn.get(Ih,sh)+_h*kn.get(Ih,al))}for(let sh=0;sh<a;sh++)kn.set(sh,al,0);kn.set(al,al,1)}let Zu=ch-1,ih=Number.EPSILON;for(;ch>0;){let al,sh;for(al=ch-2;al>=-1&&al!==-1;al--){const _h=Number.MIN_VALUE+ih*Math.abs(Bt[al]+Math.abs(Bt[al+1]));if(Math.abs(Io[al])<=_h||Number.isNaN(Io[al])){Io[al]=0;break}}if(al===ch-2)sh=4;else{let _h;for(_h=ch-1;_h>=al&&_h!==al;_h--){let Ih=(_h!==ch?Math.abs(Io[_h]):0)+(_h!==al+1?Math.abs(Io[_h-1]):0);if(Math.abs(Bt[_h])<=ih*Ih){Bt[_h]=0;break}}_h===al?sh=3:_h===ch-1?sh=1:(sh=2,al=_h)}switch(al++,sh){case 1:{let _h=Io[ch-2];Io[ch-2]=0;for(let Ih=ch-2;Ih>=al;Ih--){let Lh=hypotenuse$1(Bt[Ih],_h),Gh=Bt[Ih]/Lh,ud=_h/Lh;if(Bt[Ih]=Lh,Ih!==al&&(_h=-ud*Io[Ih-1],Io[Ih-1]=Gh*Io[Ih-1]),C)for(let Tf=0;Tf<a;Tf++)Lh=Gh*kn.get(Tf,Ih)+ud*kn.get(Tf,ch-1),kn.set(Tf,ch-1,-ud*kn.get(Tf,Ih)+Gh*kn.get(Tf,ch-1)),kn.set(Tf,Ih,Lh)}break}case 2:{let _h=Io[al-1];Io[al-1]=0;for(let Ih=al;Ih<ch;Ih++){let Lh=hypotenuse$1(Bt[Ih],_h),Gh=Bt[Ih]/Lh,ud=_h/Lh;if(Bt[Ih]=Lh,_h=-ud*Io[Ih],Io[Ih]=Gh*Io[Ih],x)for(let Tf=0;Tf<n;Tf++)Lh=Gh*Ur.get(Tf,Ih)+ud*Ur.get(Tf,al-1),Ur.set(Tf,al-1,-ud*Ur.get(Tf,Ih)+Gh*Ur.get(Tf,al-1)),Ur.set(Tf,Ih,Lh)}break}case 3:{const _h=Math.max(Math.abs(Bt[ch-1]),Math.abs(Bt[ch-2]),Math.abs(Io[ch-2]),Math.abs(Bt[al]),Math.abs(Io[al])),Ih=Bt[ch-1]/_h,Lh=Bt[ch-2]/_h,Gh=Io[ch-2]/_h,ud=Bt[al]/_h,Tf=Io[al]/_h,Kd=((Lh+Ih)*(Lh-Ih)+Gh*Gh)/2,Af=Ih*Gh*(Ih*Gh);let md=0;(Kd!==0||Af!==0)&&(Kd<0?md=0-Math.sqrt(Kd*Kd+Af):md=Math.sqrt(Kd*Kd+Af),md=Af/(Kd+md));let vd=(ud+Ih)*(ud-Ih)+md,qd=ud*Tf;for(let Ed=al;Ed<ch-1;Ed++){let Sd=hypotenuse$1(vd,qd);Sd===0&&(Sd=Number.MIN_VALUE);let zd=vd/Sd,Md=qd/Sd;if(Ed!==al&&(Io[Ed-1]=Sd),vd=zd*Bt[Ed]+Md*Io[Ed],Io[Ed]=zd*Io[Ed]-Md*Bt[Ed],qd=Md*Bt[Ed+1],Bt[Ed+1]=zd*Bt[Ed+1],C)for(let Gd=0;Gd<a;Gd++)Sd=zd*kn.get(Gd,Ed)+Md*kn.get(Gd,Ed+1),kn.set(Gd,Ed+1,-Md*kn.get(Gd,Ed)+zd*kn.get(Gd,Ed+1)),kn.set(Gd,Ed,Sd);if(Sd=hypotenuse$1(vd,qd),Sd===0&&(Sd=Number.MIN_VALUE),zd=vd/Sd,Md=qd/Sd,Bt[Ed]=Sd,vd=zd*Io[Ed]+Md*Bt[Ed+1],Bt[Ed+1]=-Md*Io[Ed]+zd*Bt[Ed+1],qd=Md*Io[Ed+1],Io[Ed+1]=zd*Io[Ed+1],x&&Ed<n-1)for(let Gd=0;Gd<n;Gd++)Sd=zd*Ur.get(Gd,Ed)+Md*Ur.get(Gd,Ed+1),Ur.set(Gd,Ed+1,-Md*Ur.get(Gd,Ed)+zd*Ur.get(Gd,Ed+1)),Ur.set(Gd,Ed,Sd)}Io[ch-2]=vd;break}case 4:{if(Bt[al]<=0&&(Bt[al]=Bt[al]<0?-Bt[al]:0,C))for(let _h=0;_h<=Zu;_h++)kn.set(_h,al,-kn.get(_h,al));for(;al<Zu&&!(Bt[al]>=Bt[al+1]);){let _h=Bt[al];if(Bt[al]=Bt[al+1],Bt[al+1]=_h,C&&al<a-1)for(let Ih=0;Ih<a;Ih++)_h=kn.get(Ih,al+1),kn.set(Ih,al+1,kn.get(Ih,al)),kn.set(Ih,al,_h);if(x&&al<n-1)for(let Ih=0;Ih<n;Ih++)_h=Ur.get(Ih,al+1),Ur.set(Ih,al+1,Ur.get(Ih,al)),Ur.set(Ih,al,_h);al++}ch--;break}}}if(P){let al=kn;kn=Ur,Ur=al}this.m=n,this.n=a,this.s=Bt,this.U=Ur,this.V=kn}solve(t){let r=t,n=this.threshold,a=this.s.length,s=Matrix$2.zeros(a,a);for(let ze=0;ze<a;ze++)Math.abs(this.s[ze])<=n?s.set(ze,ze,0):s.set(ze,ze,1/this.s[ze]);let f=this.U,o=this.rightSingularVectors,x=o.mmul(s),C=o.rows,P=f.rows,Y=Matrix$2.zeros(C,P);for(let ze=0;ze<C;ze++)for(let ge=0;ge<P;ge++){let Bt=0;for(let Ur=0;Ur<a;Ur++)Bt+=x.get(ze,Ur)*f.get(ge,Ur);Y.set(ze,ge,Bt)}return Y.mmul(r)}solveForDiagonal(t){return this.solve(Matrix$2.diag(t))}inverse(){let t=this.V,r=this.threshold,n=t.rows,a=t.columns,s=new Matrix$2(n,this.s.length);for(let P=0;P<n;P++)for(let Y=0;Y<a;Y++)Math.abs(this.s[Y])>r&&s.set(P,Y,t.get(P,Y)/this.s[Y]);let f=this.U,o=f.rows,x=f.columns,C=new Matrix$2(n,o);for(let P=0;P<n;P++)for(let Y=0;Y<o;Y++){let ze=0;for(let ge=0;ge<x;ge++)ze+=s.get(P,ge)*f.get(Y,ge);C.set(P,Y,ze)}return C}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,n=this.s;for(let a=0,s=n.length;a<s;a++)n[a]>t&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(e,t=!1){return e=WrapperMatrix2D.checkMatrix(e),t?new SingularValueDecomposition(e).inverse():solve(e,Matrix$2.eye(e.rows))}function solve(e,t,r=!1){return e=WrapperMatrix2D.checkMatrix(e),t=WrapperMatrix2D.checkMatrix(t),r?new SingularValueDecomposition(e).solve(t):e.isSquare()?new LuDecomposition(e).solve(t):new QrDecomposition(e).solve(t)}function determinant(e){if(e=Matrix$2.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let t,r,n,a;if(e.columns===2)return t=e.get(0,0),r=e.get(0,1),n=e.get(1,0),a=e.get(1,1),t*a-r*n;if(e.columns===3){let s,f,o;return s=new MatrixSelectionView(e,[1,2],[1,2]),f=new MatrixSelectionView(e,[1,2],[0,2]),o=new MatrixSelectionView(e,[1,2],[0,1]),t=e.get(0,0),r=e.get(0,1),n=e.get(0,2),t*determinant(s)-r*determinant(f)+n*determinant(o)}else return new LuDecomposition(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(e,t){let r=[];for(let n=0;n<e;n++)n!==t&&r.push(n);return r}function dependenciesOneRow(e,t,r,n=1e-9,a=1e-9){if(e>a)return new Array(t.rows+1).fill(0);{let s=t.addRow(r,[0]);for(let f=0;f<s.rows;f++)Math.abs(s.get(f,0))<n&&s.set(f,0,0);return s.to1DArray()}}function linearDependencies(e,t={}){const{thresholdValue:r=1e-9,thresholdError:n=1e-9}=t;e=Matrix$2.checkMatrix(e);let a=e.rows,s=new Matrix$2(a,a);for(let f=0;f<a;f++){let o=Matrix$2.columnVector(e.getRow(f)),x=e.subMatrixRow(xrange(a,f)).transpose(),P=new SingularValueDecomposition(x).solve(o),Y=Matrix$2.sub(o,x.mmul(P)).abs().max();s.setRow(f,dependenciesOneRow(Y,P,f,r,n))}return s}function pseudoInverse(e,t=Number.EPSILON){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return e.transpose();let r=new SingularValueDecomposition(e,{autoTranspose:!0}),n=r.leftSingularVectors,a=r.rightSingularVectors,s=r.diagonal;for(let f=0;f<s.length;f++)Math.abs(s[f])>t?s[f]=1/s[f]:s[f]=0;return a.mmul(Matrix$2.diag(s).mmul(n.transpose()))}function covariance(e,t=e,r={}){e=new Matrix$2(e);let n=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(r=t,t=e,n=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0}=r;a&&(e=e.center("column"),n||(t=t.center("column")));const s=e.transpose().mmul(t);for(let f=0;f<s.rows;f++)for(let o=0;o<s.columns;o++)s.set(f,o,s.get(f,o)*(1/(e.rows-1)));return s}function correlation(e,t=e,r={}){e=new Matrix$2(e);let n=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(r=t,t=e,n=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0,scale:s=!0}=r;a&&(e.center("column"),n||t.center("column")),s&&(e.scale("column"),n||t.scale("column"));const f=e.standardDeviation("column",{unbiased:!0}),o=n?f:t.standardDeviation("column",{unbiased:!0}),x=e.transpose().mmul(t);for(let C=0;C<x.rows;C++)for(let P=0;P<x.columns;P++)x.set(C,P,x.get(C,P)*(1/(f[C]*o[P]))*(1/(e.rows-1)));return x}class EigenvalueDecomposition{constructor(t,r={}){const{assumeSymmetric:n=!1}=r;if(t=WrapperMatrix2D.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let a=t.columns,s=new Matrix$2(a,a),f=new Float64Array(a),o=new Float64Array(a),x=t,C,P,Y=!1;if(n?Y=!0:Y=t.isSymmetric(),Y){for(C=0;C<a;C++)for(P=0;P<a;P++)s.set(C,P,x.get(C,P));tred2(a,o,f,s),tql2(a,o,f,s)}else{let ze=new Matrix$2(a,a),ge=new Float64Array(a);for(P=0;P<a;P++)for(C=0;C<a;C++)ze.set(C,P,x.get(C,P));orthes(a,ze,ge,s),hqr2(a,o,f,s,ze)}this.n=a,this.e=o,this.d=f,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,r=this.e,n=this.d,a=new Matrix$2(t,t),s,f;for(s=0;s<t;s++){for(f=0;f<t;f++)a.set(s,f,0);a.set(s,s,n[s]),r[s]>0?a.set(s,s+1,r[s]):r[s]<0&&a.set(s,s-1,r[s])}return a}}function tred2(e,t,r,n){let a,s,f,o,x,C,P,Y;for(x=0;x<e;x++)r[x]=n.get(e-1,x);for(o=e-1;o>0;o--){for(Y=0,f=0,C=0;C<o;C++)Y=Y+Math.abs(r[C]);if(Y===0)for(t[o]=r[o-1],x=0;x<o;x++)r[x]=n.get(o-1,x),n.set(o,x,0),n.set(x,o,0);else{for(C=0;C<o;C++)r[C]/=Y,f+=r[C]*r[C];for(a=r[o-1],s=Math.sqrt(f),a>0&&(s=-s),t[o]=Y*s,f=f-a*s,r[o-1]=a-s,x=0;x<o;x++)t[x]=0;for(x=0;x<o;x++){for(a=r[x],n.set(x,o,a),s=t[x]+n.get(x,x)*a,C=x+1;C<=o-1;C++)s+=n.get(C,x)*r[C],t[C]+=n.get(C,x)*a;t[x]=s}for(a=0,x=0;x<o;x++)t[x]/=f,a+=t[x]*r[x];for(P=a/(f+f),x=0;x<o;x++)t[x]-=P*r[x];for(x=0;x<o;x++){for(a=r[x],s=t[x],C=x;C<=o-1;C++)n.set(C,x,n.get(C,x)-(a*t[C]+s*r[C]));r[x]=n.get(o-1,x),n.set(o,x,0)}}r[o]=f}for(o=0;o<e-1;o++){if(n.set(e-1,o,n.get(o,o)),n.set(o,o,1),f=r[o+1],f!==0){for(C=0;C<=o;C++)r[C]=n.get(C,o+1)/f;for(x=0;x<=o;x++){for(s=0,C=0;C<=o;C++)s+=n.get(C,o+1)*n.get(C,x);for(C=0;C<=o;C++)n.set(C,x,n.get(C,x)-s*r[C])}}for(C=0;C<=o;C++)n.set(C,o+1,0)}for(x=0;x<e;x++)r[x]=n.get(e-1,x),n.set(e-1,x,0);n.set(e-1,e-1,1),t[0]=0}function tql2(e,t,r,n){let a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn,Io,rl,Co;for(f=1;f<e;f++)t[f-1]=t[f];t[e-1]=0;let as=0,$s=0,ah=Number.EPSILON;for(C=0;C<e;C++){for($s=Math.max($s,Math.abs(r[C])+Math.abs(t[C])),P=C;P<e&&!(Math.abs(t[P])<=ah*$s);)P++;if(P>C)do{for(a=r[C],Y=(r[C+1]-a)/(2*t[C]),ze=hypotenuse$1(Y,1),Y<0&&(ze=-ze),r[C]=t[C]/(Y+ze),r[C+1]=t[C]*(Y+ze),ge=r[C+1],s=a-r[C],f=C+2;f<e;f++)r[f]-=s;for(as=as+s,Y=r[P],Bt=1,Ur=Bt,kn=Bt,Io=t[C+1],rl=0,Co=0,f=P-1;f>=C;f--)for(kn=Ur,Ur=Bt,Co=rl,a=Bt*t[f],s=Bt*Y,ze=hypotenuse$1(Y,t[f]),t[f+1]=rl*ze,rl=t[f]/ze,Bt=Y/ze,Y=Bt*r[f]-rl*a,r[f+1]=s+rl*(Bt*a+rl*r[f]),x=0;x<e;x++)s=n.get(x,f+1),n.set(x,f+1,rl*n.get(x,f)+Bt*s),n.set(x,f,Bt*n.get(x,f)-rl*s);Y=-rl*Co*kn*Io*t[C]/ge,t[C]=rl*Y,r[C]=Bt*Y}while(Math.abs(t[C])>ah*$s);r[C]=r[C]+as,t[C]=0}for(f=0;f<e-1;f++){for(x=f,Y=r[f],o=f+1;o<e;o++)r[o]<Y&&(x=o,Y=r[o]);if(x!==f)for(r[x]=r[f],r[f]=Y,o=0;o<e;o++)Y=n.get(o,f),n.set(o,f,n.get(o,x)),n.set(o,x,Y)}}function orthes(e,t,r,n){let a=0,s=e-1,f,o,x,C,P,Y,ze;for(Y=a+1;Y<=s-1;Y++){for(ze=0,C=Y;C<=s;C++)ze=ze+Math.abs(t.get(C,Y-1));if(ze!==0){for(x=0,C=s;C>=Y;C--)r[C]=t.get(C,Y-1)/ze,x+=r[C]*r[C];for(o=Math.sqrt(x),r[Y]>0&&(o=-o),x=x-r[Y]*o,r[Y]=r[Y]-o,P=Y;P<e;P++){for(f=0,C=s;C>=Y;C--)f+=r[C]*t.get(C,P);for(f=f/x,C=Y;C<=s;C++)t.set(C,P,t.get(C,P)-f*r[C])}for(C=0;C<=s;C++){for(f=0,P=s;P>=Y;P--)f+=r[P]*t.get(C,P);for(f=f/x,P=Y;P<=s;P++)t.set(C,P,t.get(C,P)-f*r[P])}r[Y]=ze*r[Y],t.set(Y,Y-1,ze*o)}}for(C=0;C<e;C++)for(P=0;P<e;P++)n.set(C,P,C===P?1:0);for(Y=s-1;Y>=a+1;Y--)if(t.get(Y,Y-1)!==0){for(C=Y+1;C<=s;C++)r[C]=t.get(C,Y-1);for(P=Y;P<=s;P++){for(o=0,C=Y;C<=s;C++)o+=r[C]*n.get(C,P);for(o=o/r[Y]/t.get(Y,Y-1),C=Y;C<=s;C++)n.set(C,P,n.get(C,P)+o*r[C])}}}function hqr2(e,t,r,n,a){let s=e-1,f=0,o=e-1,x=Number.EPSILON,C=0,P=0,Y=0,ze=0,ge=0,Bt=0,Ur=0,kn=0,Io,rl,Co,as,$s,ah,ch,Zu,ih,al,sh,_h,Ih,Lh,Gh;for(Io=0;Io<e;Io++)for((Io<f||Io>o)&&(r[Io]=a.get(Io,Io),t[Io]=0),rl=Math.max(Io-1,0);rl<e;rl++)P=P+Math.abs(a.get(Io,rl));for(;s>=f;){for(as=s;as>f&&(Bt=Math.abs(a.get(as-1,as-1))+Math.abs(a.get(as,as)),Bt===0&&(Bt=P),!(Math.abs(a.get(as,as-1))<x*Bt));)as--;if(as===s)a.set(s,s,a.get(s,s)+C),r[s]=a.get(s,s),t[s]=0,s--,kn=0;else if(as===s-1){if(ch=a.get(s,s-1)*a.get(s-1,s),Y=(a.get(s-1,s-1)-a.get(s,s))/2,ze=Y*Y+ch,Ur=Math.sqrt(Math.abs(ze)),a.set(s,s,a.get(s,s)+C),a.set(s-1,s-1,a.get(s-1,s-1)+C),Zu=a.get(s,s),ze>=0){for(Ur=Y>=0?Y+Ur:Y-Ur,r[s-1]=Zu+Ur,r[s]=r[s-1],Ur!==0&&(r[s]=Zu-ch/Ur),t[s-1]=0,t[s]=0,Zu=a.get(s,s-1),Bt=Math.abs(Zu)+Math.abs(Ur),Y=Zu/Bt,ze=Ur/Bt,ge=Math.sqrt(Y*Y+ze*ze),Y=Y/ge,ze=ze/ge,rl=s-1;rl<e;rl++)Ur=a.get(s-1,rl),a.set(s-1,rl,ze*Ur+Y*a.get(s,rl)),a.set(s,rl,ze*a.get(s,rl)-Y*Ur);for(Io=0;Io<=s;Io++)Ur=a.get(Io,s-1),a.set(Io,s-1,ze*Ur+Y*a.get(Io,s)),a.set(Io,s,ze*a.get(Io,s)-Y*Ur);for(Io=f;Io<=o;Io++)Ur=n.get(Io,s-1),n.set(Io,s-1,ze*Ur+Y*n.get(Io,s)),n.set(Io,s,ze*n.get(Io,s)-Y*Ur)}else r[s-1]=Zu+Y,r[s]=Zu+Y,t[s-1]=Ur,t[s]=-Ur;s=s-2,kn=0}else{if(Zu=a.get(s,s),ih=0,ch=0,as<s&&(ih=a.get(s-1,s-1),ch=a.get(s,s-1)*a.get(s-1,s)),kn===10){for(C+=Zu,Io=f;Io<=s;Io++)a.set(Io,Io,a.get(Io,Io)-Zu);Bt=Math.abs(a.get(s,s-1))+Math.abs(a.get(s-1,s-2)),Zu=ih=.75*Bt,ch=-.4375*Bt*Bt}if(kn===30&&(Bt=(ih-Zu)/2,Bt=Bt*Bt+ch,Bt>0)){for(Bt=Math.sqrt(Bt),ih<Zu&&(Bt=-Bt),Bt=Zu-ch/((ih-Zu)/2+Bt),Io=f;Io<=s;Io++)a.set(Io,Io,a.get(Io,Io)-Bt);C+=Bt,Zu=ih=ch=.964}for(kn=kn+1,$s=s-2;$s>=as&&(Ur=a.get($s,$s),ge=Zu-Ur,Bt=ih-Ur,Y=(ge*Bt-ch)/a.get($s+1,$s)+a.get($s,$s+1),ze=a.get($s+1,$s+1)-Ur-ge-Bt,ge=a.get($s+2,$s+1),Bt=Math.abs(Y)+Math.abs(ze)+Math.abs(ge),Y=Y/Bt,ze=ze/Bt,ge=ge/Bt,!($s===as||Math.abs(a.get($s,$s-1))*(Math.abs(ze)+Math.abs(ge))<x*(Math.abs(Y)*(Math.abs(a.get($s-1,$s-1))+Math.abs(Ur)+Math.abs(a.get($s+1,$s+1))))));)$s--;for(Io=$s+2;Io<=s;Io++)a.set(Io,Io-2,0),Io>$s+2&&a.set(Io,Io-3,0);for(Co=$s;Co<=s-1&&(Lh=Co!==s-1,Co!==$s&&(Y=a.get(Co,Co-1),ze=a.get(Co+1,Co-1),ge=Lh?a.get(Co+2,Co-1):0,Zu=Math.abs(Y)+Math.abs(ze)+Math.abs(ge),Zu!==0&&(Y=Y/Zu,ze=ze/Zu,ge=ge/Zu)),Zu!==0);Co++)if(Bt=Math.sqrt(Y*Y+ze*ze+ge*ge),Y<0&&(Bt=-Bt),Bt!==0){for(Co!==$s?a.set(Co,Co-1,-Bt*Zu):as!==$s&&a.set(Co,Co-1,-a.get(Co,Co-1)),Y=Y+Bt,Zu=Y/Bt,ih=ze/Bt,Ur=ge/Bt,ze=ze/Y,ge=ge/Y,rl=Co;rl<e;rl++)Y=a.get(Co,rl)+ze*a.get(Co+1,rl),Lh&&(Y=Y+ge*a.get(Co+2,rl),a.set(Co+2,rl,a.get(Co+2,rl)-Y*Ur)),a.set(Co,rl,a.get(Co,rl)-Y*Zu),a.set(Co+1,rl,a.get(Co+1,rl)-Y*ih);for(Io=0;Io<=Math.min(s,Co+3);Io++)Y=Zu*a.get(Io,Co)+ih*a.get(Io,Co+1),Lh&&(Y=Y+Ur*a.get(Io,Co+2),a.set(Io,Co+2,a.get(Io,Co+2)-Y*ge)),a.set(Io,Co,a.get(Io,Co)-Y),a.set(Io,Co+1,a.get(Io,Co+1)-Y*ze);for(Io=f;Io<=o;Io++)Y=Zu*n.get(Io,Co)+ih*n.get(Io,Co+1),Lh&&(Y=Y+Ur*n.get(Io,Co+2),n.set(Io,Co+2,n.get(Io,Co+2)-Y*ge)),n.set(Io,Co,n.get(Io,Co)-Y),n.set(Io,Co+1,n.get(Io,Co+1)-Y*ze)}}}if(P!==0){for(s=e-1;s>=0;s--)if(Y=r[s],ze=t[s],ze===0)for(as=s,a.set(s,s,1),Io=s-1;Io>=0;Io--){for(ch=a.get(Io,Io)-Y,ge=0,rl=as;rl<=s;rl++)ge=ge+a.get(Io,rl)*a.get(rl,s);if(t[Io]<0)Ur=ch,Bt=ge;else if(as=Io,t[Io]===0?a.set(Io,s,ch!==0?-ge/ch:-ge/(x*P)):(Zu=a.get(Io,Io+1),ih=a.get(Io+1,Io),ze=(r[Io]-Y)*(r[Io]-Y)+t[Io]*t[Io],ah=(Zu*Bt-Ur*ge)/ze,a.set(Io,s,ah),a.set(Io+1,s,Math.abs(Zu)>Math.abs(Ur)?(-ge-ch*ah)/Zu:(-Bt-ih*ah)/Ur)),ah=Math.abs(a.get(Io,s)),x*ah*ah>1)for(rl=Io;rl<=s;rl++)a.set(rl,s,a.get(rl,s)/ah)}else if(ze<0)for(as=s-1,Math.abs(a.get(s,s-1))>Math.abs(a.get(s-1,s))?(a.set(s-1,s-1,ze/a.get(s,s-1)),a.set(s-1,s,-(a.get(s,s)-Y)/a.get(s,s-1))):(Gh=cdiv(0,-a.get(s-1,s),a.get(s-1,s-1)-Y,ze),a.set(s-1,s-1,Gh[0]),a.set(s-1,s,Gh[1])),a.set(s,s-1,0),a.set(s,s,1),Io=s-2;Io>=0;Io--){for(al=0,sh=0,rl=as;rl<=s;rl++)al=al+a.get(Io,rl)*a.get(rl,s-1),sh=sh+a.get(Io,rl)*a.get(rl,s);if(ch=a.get(Io,Io)-Y,t[Io]<0)Ur=ch,ge=al,Bt=sh;else if(as=Io,t[Io]===0?(Gh=cdiv(-al,-sh,ch,ze),a.set(Io,s-1,Gh[0]),a.set(Io,s,Gh[1])):(Zu=a.get(Io,Io+1),ih=a.get(Io+1,Io),_h=(r[Io]-Y)*(r[Io]-Y)+t[Io]*t[Io]-ze*ze,Ih=(r[Io]-Y)*2*ze,_h===0&&Ih===0&&(_h=x*P*(Math.abs(ch)+Math.abs(ze)+Math.abs(Zu)+Math.abs(ih)+Math.abs(Ur))),Gh=cdiv(Zu*ge-Ur*al+ze*sh,Zu*Bt-Ur*sh-ze*al,_h,Ih),a.set(Io,s-1,Gh[0]),a.set(Io,s,Gh[1]),Math.abs(Zu)>Math.abs(Ur)+Math.abs(ze)?(a.set(Io+1,s-1,(-al-ch*a.get(Io,s-1)+ze*a.get(Io,s))/Zu),a.set(Io+1,s,(-sh-ch*a.get(Io,s)-ze*a.get(Io,s-1))/Zu)):(Gh=cdiv(-ge-ih*a.get(Io,s-1),-Bt-ih*a.get(Io,s),Ur,ze),a.set(Io+1,s-1,Gh[0]),a.set(Io+1,s,Gh[1]))),ah=Math.max(Math.abs(a.get(Io,s-1)),Math.abs(a.get(Io,s))),x*ah*ah>1)for(rl=Io;rl<=s;rl++)a.set(rl,s-1,a.get(rl,s-1)/ah),a.set(rl,s,a.get(rl,s)/ah)}for(Io=0;Io<e;Io++)if(Io<f||Io>o)for(rl=Io;rl<e;rl++)n.set(Io,rl,a.get(Io,rl));for(rl=e-1;rl>=f;rl--)for(Io=f;Io<=o;Io++){for(Ur=0,Co=f;Co<=Math.min(rl,o);Co++)Ur=Ur+n.get(Io,Co)*a.get(Co,rl);n.set(Io,rl,Ur)}}}function cdiv(e,t,r,n){let a,s;return Math.abs(r)>Math.abs(n)?(a=n/r,s=r+a*n,[(e+a*t)/s,(t-a*e)/s]):(a=r/n,s=n+a*r,[(a*e+t)/s,(a*t-e)/s])}class CholeskyDecomposition{constructor(t){if(t=WrapperMatrix2D.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let r=t,n=r.rows,a=new Matrix$2(n,n),s=!0,f,o,x;for(o=0;o<n;o++){let C=0;for(x=0;x<o;x++){let P=0;for(f=0;f<x;f++)P+=a.get(x,f)*a.get(o,f);P=(r.get(o,x)-P)/a.get(x,x),a.set(o,x,P),C=C+P*P}for(C=r.get(o,o)-C,s&=C>0,a.set(o,o,Math.sqrt(Math.max(C,0))),x=o+1;x<n;x++)a.set(o,x,0)}this.L=a,this.positiveDefinite=!!s}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let r=this.L,n=r.rows;if(t.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let a=t.columns,s=t.clone(),f,o,x;for(x=0;x<n;x++)for(o=0;o<a;o++){for(f=0;f<x;f++)s.set(x,o,s.get(x,o)-s.get(f,o)*r.get(x,f));s.set(x,o,s.get(x,o)/r.get(x,x))}for(x=n-1;x>=0;x--)for(o=0;o<a;o++){for(f=x+1;f<n;f++)s.set(x,o,s.get(x,o)-s.get(f,o)*r.get(f,x));s.set(x,o,s.get(x,o)/r.get(x,x))}return s}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,r={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:n}=r;const{scaleScores:a=!1,maxIterations:s=1e3,terminationCriteria:f=1e-10}=r;let o;if(n){if(isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$2.columnVector(n):n=WrapperMatrix2D.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");o=n.getColumnVector(0)}else o=t.getColumnVector(0);let x=1,C,P,Y,ze;for(let ge=0;ge<s&&x>f;ge++)Y=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),Y=Y.div(Y.norm()),C=t.mmul(Y).div(Y.transpose().mmul(Y).get(0,0)),ge>0&&(x=C.clone().sub(ze).pow(2).sum()),ze=C.clone(),n?(P=n.transpose().mmul(C).div(C.transpose().mmul(C).get(0,0)),P=P.div(P.norm()),o=n.mmul(P).div(P.transpose().mmul(P).get(0,0))):o=C;if(n){let ge=t.transpose().mmul(C).div(C.transpose().mmul(C).get(0,0));ge=ge.div(ge.norm());let Bt=t.clone().sub(C.clone().mmul(ge.transpose())),Ur=o.transpose().mmul(C).div(C.transpose().mmul(C).get(0,0)),kn=n.clone().sub(C.clone().mulS(Ur.get(0,0)).mmul(P.transpose()));this.t=C,this.p=ge.transpose(),this.w=Y.transpose(),this.q=P,this.u=o,this.s=C.transpose().mmul(C),this.xResidual=Bt,this.yResidual=kn,this.betas=Ur}else this.w=Y.transpose(),this.s=C.transpose().mmul(C).sqrt(),a?this.t=C.clone().div(this.s.get(0,0)):this.t=C,this.xResidual=t.sub(C.mmul(Y.transpose()))}}const src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO:CholeskyDecomposition,CholeskyDecomposition,EVD:EigenvalueDecomposition,EigenvalueDecomposition,LU:LuDecomposition,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS:nipals,Nipals:nipals,QR:QrDecomposition,QrDecomposition,SVD:SingularValueDecomposition,SingularValueDecomposition,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:Matrix$2,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(e){const t=new SingularValueDecomposition(e,{autoTranspose:!0});if(t.rank!==1)return null;const r=Math.sqrt(t.s[0]),n=t.U.to2DArray().map(s=>s[0]*r),a=t.V.to2DArray().map(s=>s[0]*r);return[n,a]}function convolution(e,t={}){let{channels:r,bitDepth:n,normalize:a=!1,divisor:s=1,border:f="copy",algorithm:o="auto"}=t,x={};n&&(x.bitDepth=n);let C=Image$1.createFrom(this,x);if(r=validateArrayOfChannels(this,r),o!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(o==="auto"){let as=getSeparatedKernel(e);as!==null?(o="separable",e=as):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?o="fft":o="direct"}let P,Y;o==="separable"?(P=Math.floor(e[0].length/2),Y=Math.floor(e[1].length/2)):(P=Math.floor(e.length/2),Y=Math.floor(e[0].length/2));let ze=C.isClamped,ge=new Array(this.height*this.width),Bt,Ur,kn,Io,rl,Co;for(Io=0;Io<r.length;Io++){for(rl=r[Io],kn=0;kn<this.height;kn++)for(Ur=0;Ur<this.width;Ur++)Bt=kn*this.width+Ur,ge[Bt]=this.data[Bt*this.channels+rl];if(o==="direct")Co=src$2.direct(ge,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});else if(o==="separable"){if(Co=convolutionSeparable(ge,e,this.width,this.height),a){s=0;for(let as=0;as<e[0].length;as++)for(let $s=0;$s<e[1].length;$s++)s+=e[0][as]*e[1][$s]}if(s!==1)for(let as=0;as<Co.length;as++)Co[as]/=s}else Co=src$2.fft(ge,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});for(kn=0;kn<this.height;kn++)for(Ur=0;Ur<this.width;Ur++)Bt=kn*this.width+Ur,ze?C.data[Bt*this.channels+rl]=clamp(Co[Bt],C):C.data[Bt*this.channels+rl]=Co[Bt]}if(this.alpha&&!r.includes(this.channels))for(Ur=this.components;Ur<this.data.length;Ur=Ur+this.channels)C.data[Ur]=this.data[Ur];return f!=="periodic"&&C.setBorder({size:[Y,P],algorithm:f}),C}function gradientFilter(e={}){let{direction:t="xy",border:r="copy",kernelX:n,kernelY:a,channels:s,bitDepth:f=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:s,border:r,bitDepth:f});case"y":if(!a)throw new Error("kernelY option is missing");return convolution.call(this,a,{channels:s,border:r,bitDepth:f});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!a)throw new Error("kernelY option is missing");const o=convolution.call(this,n,{channels:s,border:r,bitDepth:32}),x=convolution.call(this,a,{channels:s,border:r,bitDepth:32});return o.hypotenuse(x,{bitDepth:f,channels:s})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(e,t){e=e||0;for(var r=new Array(e),n=0;n<e;n++)r[n]=t;return r}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(e={}){let{algorithm:t="range",channels:r,min:n=this.min,max:a=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),r=validateArrayOfChannels(this,{channels:r}),r.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((s,f)=>r.includes(f))),Array.isArray(a)&&a.length===this.channels&&(a=a.filter((s,f)=>r.includes(f)))),t){case"range":n<0&&(n=0),a>this.maxValue&&(a=this.maxValue),Array.isArray(n)||(n=newArray$1(r.length,n)),Array.isArray(a)||(a=newArray$1(r.length,a)),processImage(this,n,a,r);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(e,t,r,n){let a=1e-5,s=new Array(n.length);for(let f=0;f<n.length;f++)t[f]===0&&r[f]===e.maxValue||r[f]===t[f]?s[f]=0:s[f]=(e.maxValue+1-a)/(r[f]-t[f]),t[f]+=(.5-a/2)/s[f];for(let f=0;f<n.length;f++){let o=n[f];if(s[f]!==0)for(let x=0;x<e.data.length;x+=e.channels)e.data[x+o]=Math.min(Math.max(0,(e.data[x+o]-t[f])*s[f]+.5|0),e.maxValue)}}var toString$3=Object.prototype.toString,isArrayType=function e(t){return toString$3.call(t).substr(-6,5)==="Array"};const isArray$b=getDefaultExportFromCjs(isArrayType);function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image$1)return e.data;if(!isArray$b(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,t={}){let{channels:r}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]+e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]+e>>0)}return this}function subtract(e,t={}){let{channels:r}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]-e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,this.data[s+a]-e>>0)}return this}function subtractImage(e,t={}){let{channels:r,absolute:n=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let a=this.clone();r=validateArrayOfChannels(this,{channels:r});for(let s=0;s<r.length;s++){let f=r[s];for(let o=f;o<this.data.length;o+=this.channels){let x=this.data[o]-e.data[o];n?a.data[o]=Math.abs(x):a.data[o]=Math.max(x,0)}}return a}function hypotenuse(e,t={}){let{bitDepth:r=this.bitDepth,channels:n}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let a=Image$1.createFrom(this,{bitDepth:r});n=validateArrayOfChannels(this,{channels:n});let s=a.isClamped;for(let f=0;f<n.length;f++){let o=n[f];for(let x=o;x<this.data.length;x+=this.channels){let C=Math.hypot(this.data[x],e.data[x]);s?a.data[x]=Math.min(Math.max(Math.round(C),0),a.maxValue):a.data[x]=C}}return a}function multiply(e,t={}){let{channels:r}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]*e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]*e>>0)}return this}function divide(e,t={}){let{channels:r}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]/e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray(t)){const r=[];for(let n=0;n<t.length;n++)r.push(this._predict(t[n]));return r}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,r){if(!isAnyArray(t)||!isAnyArray(r)||t.length!==r.length)throw new Error("x and y must be arrays of the same length");const n=t.length,a=new Array(n);for(let ge=0;ge<n;ge++)a[ge]=this._predict(t[ge]);let s=0,f=0,o=0,x=0,C=0,P=0,Y=0;for(let ge=0;ge<n;ge++)s+=a[ge],f+=r[ge],C+=a[ge]*a[ge],P+=r[ge]*r[ge],Y+=a[ge]*r[ge],r[ge]!==0&&(o+=(r[ge]-a[ge])*(r[ge]-a[ge])/r[ge]),x+=(r[ge]-a[ge])*(r[ge]-a[ge]);const ze=(n*Y-s*f)/Math.sqrt((n*C-s*s)*(n*P-f*f));return{r:ze,r2:ze*ze,chi2:o,rmsd:Math.sqrt(x/n)}}}const require$$0$2=getAugmentedNamespace(src$1);function squaredEuclidean$4(e,t){let r=0;for(let n=0;n<e.length;n++)r+=(e[n]-t[n])*(e[n]-t[n]);return r}function euclidean$2(e,t){return Math.sqrt(squaredEuclidean$4(e,t))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,r){const n=squaredEuclidean$3(t,r);return Math.exp(-n/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$a,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,r){for(var n=0,a=0;a<t.length;a++)n+=t[a]*r[a];return Math.pow(this.scale*n+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$9,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,r){for(var n=0,a=0;a<t.length;a++)n+=t[a]*r[a];return Math.tanh(this.alpha*n+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,r){for(var n=0,a=Math.min(t.length,r.length),s=1;s<=a;++s)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[s-1],s)-Math.pow(r[s-1],s),2)),this.degree);return n}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma}compute(t,r){return 1/(1+squaredEuclidean$2(t,r)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0$1,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,r){const n=euclidean$1(t,r);return Math.exp(-n/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,r){for(var n=Math.min(t.length,r.length),a=0,s=0;s<n;++s)a+=Math.min(t[s],r[s]);return a}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0$1,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma}compute(t,r){const n=euclidean(t,r);return Math.exp(-n/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$4,t),this.constant=t.constant}compute(t,r){return Math.sqrt(squaredEuclidean$1(t,r)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0$1,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.constant=t.constant}compute(t,r){const n=squaredEuclidean(t,r);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$2,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,r){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var n=kernelType[t];if(n)this.kernelFunction=new n(r);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,r){if(t=Matrix$1.checkMatrix(t),r===void 0?r=t:r=Matrix$1.checkMatrix(r),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(r));const n=new Matrix$1(t.rows,r.rows);if(t===r)for(let a=0;a<t.rows;a++)for(let s=a;s<t.rows;s++){const f=this.kernelFunction.compute(t.getRow(a),t.getRow(s));n.set(a,s,f),n.set(s,a,f)}else for(let a=0;a<t.rows;a++)for(let s=0;s<r.rows;s++)n.set(a,s,this.kernelFunction.compute(t.getRow(a),r.getRow(s)));return n}}var kernel=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,r,n){if(super(),t===!0)this.alpha=r.alpha,this.inputs=r.inputs,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=new Kernel$1(r.kernelType,r.kernelOptions);else{t=Matrix$2.checkMatrix(t),n=Object.assign({},defaultOptions$2,n);const a=new Kernel$1(n.kernelType,n.kernelOptions),s=a.compute(t),f=t.rows;s.add(Matrix$2.eye(f,f).mul(n.lambda)),this.alpha=solve(s,r),this.inputs=t,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=a}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(e,t,r){const n=new KernelRidgeRegression(e,t,r),a=new Array(this.size);for(let o=0;o<this.width;o++)for(let x=0;x<this.height;x++)a[x*this.width+o]=[o,x];const s=n.predict(a),f=Image$1.createFrom(this);for(let o=0;o<this.size;o++)f.data[o]=Math.min(this.maxValue,Math.max(0,s[o][0]));return f}function dilate(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of t)for(const f of s)if(f!==1){n=!1;break e}let a=this;for(let s=0;s<r;s++)if(this.bitDepth===1)if(n){const f=a.clone();a=dilateOnceBinaryOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=dilateOnceBinary(a,f,t)}else if(n){const f=Image$1.createFrom(a);a=dilateOnceGreyOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=dilateOnceGrey(a,f,t)}return a}function dilateOnceGrey(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=0;for(let P=0;P<a;P++)for(let Y=0;Y<n;Y++){if(r[Y][P]!==1)continue;let ze=Y-s+x,ge=P-f+o;if(ze<0||ge<0||ze>=e.width||ge>=e.height)continue;const Bt=e.getValueXY(ze,ge,0);Bt>C&&(C=Bt)}t.setValueXY(x,o,0,C)}return t}function dilateOnceGreyOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){let C=0;for(let P=Math.max(0,o-s);P<Math.min(e.height,o+s+1);P++){const Y=e.getValueXY(x,P,0);Y>C&&(C=Y)}f[x]=C}for(let x=0;x<e.width;x++){let C=0;for(let P=Math.max(0,x-a);P<Math.min(e.width,x+a+1);P++)f[P]>C&&(C=f[P]);t.setValueXY(x,o,0,C)}}return t}function dilateOnceBinary(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=0;e:for(let P=0;P<a;P++)for(let Y=0;Y<n;Y++){if(r[Y][P]!==1)continue;let ze=Y-s+x,ge=P-f+o;if(ge<0||ze<0||ze>=e.width||ge>=e.height)continue;if(e.getBitXY(ze,ge)===1){C=1;break e}}C===1&&t.setBitXY(x,o)}return t}function dilateOnceBinaryOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(1);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){f[x]=0;for(let C=Math.max(0,o-s);C<Math.min(e.height,o+s+1);C++)if(e.getBitXY(x,C)===1){f[x]=1;break}}for(let x=0;x<e.width;x++)if(t.getBitXY(x,o)!==1){for(let C=Math.max(0,x-a);C<Math.min(e.width,x+a+1);C++)if(f[C]===1){t.setBitXY(x,o);break}}}return t}function erode(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of t)for(const f of s)if(f!==1){n=!1;break e}let a=this;for(let s=0;s<r;s++)if(this.bitDepth===1)if(n){const f=a.clone();a=erodeOnceBinaryOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=erodeOnceBinary(a,f,t)}else if(n){const f=Image$1.createFrom(a);a=erodeOnceGreyOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=erodeOnceGrey(a,f,t)}return a}function erodeOnceGrey(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=e.maxValue;for(let P=0;P<a;P++)for(let Y=0;Y<n;Y++){if(r[Y][P]!==1)continue;let ze=Y-s+x,ge=P-f+o;if(ze<0||ge<0||ze>=e.width||ge>=e.height)continue;const Bt=e.getValueXY(ze,ge,0);Bt<C&&(C=Bt)}t.setValueXY(x,o,0,C)}return t}function erodeOnceGreyOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){let C=e.maxValue;for(let P=Math.max(0,o-s);P<Math.min(e.height,o+s+1);P++){const Y=e.getValueXY(x,P,0);Y<C&&(C=Y)}f[x]=C}for(let x=0;x<e.width;x++){let C=e.maxValue;for(let P=Math.max(0,x-a);P<Math.min(e.width,x+a+1);P++)f[P]<C&&(C=f[P]);t.setValueXY(x,o,0,C)}}return t}function erodeOnceBinary(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=1;e:for(let P=0;P<a;P++)for(let Y=0;Y<n;Y++){if(r[Y][P]!==1)continue;let ze=Y-s+x,ge=P-f+o;if(ge<0||ze<0||ze>=e.width||ge>=e.height)continue;if(e.getBitXY(ze,ge)===0){C=0;break e}}C===1&&t.setBitXY(x,o)}return t}function erodeOnceBinaryOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){f[x]=1;for(let C=Math.max(0,o-s);C<Math.min(e.height,o+s+1);C++)if(e.getBitXY(x,C)===0){f[x]=0;break}}for(let x=0;x<e.width;x++)if(t.getBitXY(x,o)!==0){for(let C=Math.max(0,x-a);C<Math.min(e.width,x+a+1);C++)if(f[C]===0){t.clearBitXY(x,o);break}}}return t}function open(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.erode({kernel:t}),n=n.dilate({kernel:t});return n}function close(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.dilate({kernel:t}).erode({kernel:t});return n}function topHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.open({kernel:t}).subtractImage(n,{absolute:!0});return n}function blackHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.close({kernel:t}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++){let s=n.dilate({kernel:t}),f=n.erode({kernel:t});n=s.subtractImage(f,{absolute:!0})}return n}function order4Points(e){let t=0,r=0,n=0,a=0,s=e[0][0],f=0;for(let C=1;C<e.length;C++)e[C][0]<s&&(s=e[C][0],f=C);let o=e[(f+1)%e.length][0],x=(f+1)%e.length;for(let C=1;C<e.length;C++)e[C][0]<o&&C!==f&&(o=e[C][0],x=C);return e[x][1]<e[f][1]?(t=e[x],a=e[f],f!==(x+1)%4?(r=e[(x+1)%4],n=e[(x+2)%4]):(r=e[(x+2)%4],n=e[(x+3)%4])):(a=e[x],t=e[f],x!==(f+1)%4?(r=e[(f+1)%4],n=e[(f+2)%4]):(r=e[(f+2)%4],n=e[(f+3)%4])),[t,r,n,a]}function distance2Points(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function crossVect(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dotVect(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function computeWidthAndHeigth(e,t,r,n,a,s){let f=Math.max(distance2Points(e,t),distance2Points(n,r)),o=Math.max(distance2Points(e,n),distance2Points(t,r)),x=0,C=0,P=Math.ceil(a/2),Y=Math.ceil(s/2),ze=f/o,ge=[e[0],e[1],1],Bt=[t[0],t[1],1],Ur=[n[0],n[1],1],kn=[r[0],r[1],1],Io=dotVect(crossVect(ge,kn),Ur)/dotVect(crossVect(Bt,kn),Ur),rl=dotVect(crossVect(ge,kn),Bt)/dotVect(crossVect(Ur,kn),Bt),Co=[Io*Bt[0]-ge[0],Io*Bt[1]-ge[1],Io*Bt[2]-ge[2]],as=[rl*Ur[0]-ge[0],rl*Ur[1]-ge[1],rl*Ur[2]-ge[2]],$s=Co[0],ah=Co[1],ch=Co[2],Zu=as[0],ih=as[1],al=as[2],sh=1/(ch*al)*($s*Zu-($s*al+ch*Zu)*P+ch*al*P*P+(ah*ih-(ah*al+ch*ih)*Y+ch*al*Y*Y));sh>=0?sh=Math.sqrt(sh):sh=Math.sqrt(-sh);let _h=new Matrix$2([[sh,0,P],[0,sh,Y],[0,0,1]]),Ih=_h.transpose(),Lh=inverse(Ih),Gh=inverse(_h),ud=Matrix$2.rowVector(Co),Tf=Matrix$2.rowVector(as),Kd=Math.sqrt(dotVect(ud.mmul(Lh).mmul(Gh).to1DArray(),Co)/dotVect(Tf.mmul(Lh).mmul(Gh).to1DArray(),as));return Kd===0||ze===0?(x=Math.ceil(f),C=Math.ceil(o)):Kd<ze?(x=Math.ceil(f),C=Math.ceil(x/Kd)):(C=Math.ceil(o),x=Math.ceil(Kd*C)),[x,C]}function projectionPoint(e,t,r,n,a,s,f,o,x,C,P,Y){let[ze,ge]=[(r*e+n*t+a)/(x*e+C*t+1),(s*e+f*t+o)/(x*e+C*t+1)];return P.getValueXY(Math.floor(ze),Math.floor(ge),Y)}function warpingFourPoints(e,t={}){let{calculateRatio:r=!0}=t;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[n,a,s,f]=e,o=[n,a,s,f],[x,C,P,Y]=order4Points(o),ze,ge;r?[ze,ge]=computeWidthAndHeigth(x,C,P,Y,this.width,this.height):(ze=Math.ceil(Math.max(distance2Points(x,C),distance2Points(Y,P))),ge=Math.ceil(Math.max(distance2Points(x,Y),distance2Points(C,P))));let Bt=Image$1.createFrom(this,{width:ze,height:ge}),[Ur,kn]=x,[Io,rl]=C,[Co,as]=P,[$s,ah]=Y,[ch,Zu]=[0,0],[ih,al]=[0,ze-1],[sh,_h]=[ge-1,ze-1],[Ih,Lh]=[ge-1,0],Gh=new Matrix$2([[ch,Zu,1,0,0,0,-ch*Ur,-Zu*Ur],[ih,al,1,0,0,0,-ih*Io,-al*Io],[sh,_h,1,0,0,0,-sh*Co,-Zu*Co],[Ih,Lh,1,0,0,0,-Ih*$s,-Lh*$s],[0,0,0,ch,Zu,1,-ch*kn,-Zu*kn],[0,0,0,ih,al,1,-ih*rl,-al*rl],[0,0,0,sh,_h,1,-sh*as,-_h*as],[0,0,0,Ih,Lh,1,-Ih*ah,-Lh*ah]]),ud=Matrix$2.columnVector([Ur,Io,Co,$s,kn,rl,as,ah]),Kd=new SingularValueDecomposition(Gh).solve(ud),[Af,md,vd,qd,Ed,Sd,zd,Md]=Kd.to1DArray(),Gd=new Matrix$2(ge,ze);for(let bf=0;bf<this.channels;bf++){for(let Id=0;Id<ge;Id++)for(let td=0;td<ze;td++)Gd.set(Id,td,projectionPoint(Id,td,Af,md,vd,qd,Ed,Sd,zd,Md,this,bf));Bt.setMatrix(Gd,{channel:bf})}return Bt}function crop(e={}){let{x:t=0,y:r=0,width:n=this.width-t,height:a=this.height-r}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a),t>this.width-1||r>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${r}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||a<=0)throw new RangeError(`crop: width and height (width:${n}; height:${a}) must be positive numbers`);if(t<0||r<0)throw new RangeError(`crop: x and y (x:${t}, y:${r}) must be positive numbers`);if(n>this.width-t||a>this.height-r)throw new RangeError(`crop: (x: ${t}, y:${r}, width:${n}, height:${a}) size is out of range`);let s=this;if(this.bitDepth===1){const f=new Image$1(n,a,{kind:"BINARY",parent:this});s=cropBinary(this,f,t,r,n,a)}else{const f=Image$1.createFrom(this,{width:n,height:a,position:[t,r]});s=cropDefault(this,f,t,r,n,a)}return s}function cropDefault(e,t,r,n,a,s){let f=a*e.channels,o=n+s,x=0,C=r*e.channels;for(let P=n;P<o;P++){let Y=P*e.width*e.channels+C,ze=Y+f;for(;Y<ze;Y++)t.data[x++]=e.data[Y]}return t}function cropBinary(e,t,r,n,a,s){let f=a*e.channels,o=n+s,x=0,C=r*e.channels;for(let P=n;P<o;P++){let Y=P*e.width*e.channels+C,ze=Y+f;for(;Y<ze;Y++)e.getBit(Y)&&t.setBit(x),++x}return t}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=e;let r=findLeft(this,t,this.components);if(r===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,t,this.components,r),a=findBottom(this,t,this.components,r),s=findRight(this,t,this.components,r,n,a);return this.crop({x:r,y:n,width:s-r+1,height:a-n+1})}function findLeft(e,t,r){for(let n=0;n<e.width;n++)for(let a=0;a<e.height;a++)if(e.getValueXY(n,a,r)>=t)return n;return-1}function findTop(e,t,r,n){for(let a=0;a<e.height;a++)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,r)>=t)return a;return-1}function findBottom(e,t,r,n){for(let a=e.height-1;a>=0;a--)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,r)>=t)return a;return-1}function findRight(e,t,r,n,a,s){for(let f=e.width-1;f>=n;f--)for(let o=a;o<=s;o++)if(e.getValueXY(f,o,r)>=t)return f;return-1}function getFactor(e){if(typeof e=="string"){const t=e[e.length-1];e=parseFloat(e),t==="%"&&(e/=100)}return e}function getThreshold$1(e,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*t}else{if(typeof e=="number")return e<1?e*t:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,t,r){e=getFactor(e);let n=Math.round(e*t),a=Math.round(e*r);return n<=0&&(n=1),a<=0&&(a=1),{width:n,height:a}}function checkRow(e,t){if(t<0||t>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${t}`)}function checkColumn(e,t){if(t<0||t>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${t}`)}function checkChannel(e,t){if(t<0||t>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,t,r){const n=this.width/t,a=this.height/r;if(this.bitDepth>1)for(let s=0;s<t;s++){const f=Math.floor((s+.5)*n);for(let o=0;o<r;o++){const x=Math.floor((o+.5)*a);for(let C=0;C<this.channels;C++)e.setValueXY(s,o,C,this.getValueXY(f,x,C))}}else for(let s=0;s<t;s++){const f=Math.floor((s+.5)*n);for(let o=0;o<r;o++){const x=Math.floor((o+.5)*a);this.getBitXY(f,x)&&e.setBitXY(s,o)}}}function resize(e={}){const{factor:t=1,interpolation:r=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=e,a=checkInterpolation(r);let s=e.width,f=e.height;if(s||(f&&n?s=Math.round(f*(this.width/this.height)):s=this.width),f||(n?f=Math.round(s*(this.height/this.width)):f=this.height),{width:s,height:f}=factorDimensions(t,s,f),s===this.width&&f===this.height){const P=this.clone();return P.position=[0,0],P}let o=Math.round((this.width-s)/2),x=Math.round((this.height-f)/2);const C=Image$1.createFrom(this,{width:s,height:f,position:[o,x]});switch(a){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,C,s,f);break;default:throw new Error(`unsupported resize interpolation: ${a}`)}return C}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSV}),t=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let a=r[n],s=r[n+1],f=r[n+2],o=Math.min(a,s,f),x=Math.max(a,s,f),C=x-o,P=0,Y=x===0?0:C/x,ze=x;if(x!==o){switch(x){case a:P=(s-f)/C+(s<f?6:0);break;case s:P=(f-a)/C+2;break;case f:P=(a-s)/C+4;break;default:throw new Error("unreachable")}P/=6}e.data[t++]=P*this.maxValue,e.data[t++]=Y*this.maxValue,e.data[t++]=ze,this.alpha&&(e.data[t++]=r[n+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),r=0,n=this.data;for(let a=0;a<n.length;a+=this.channels){let s=n[a],f=n[a+1],o=n[a+2],x=Math.max(s,f,o),C=Math.min(s,f,o),P=0,Y=0,ze=(x+C)/2;if(x!==C){let ge=x-C;switch(Y=ze>t?ge/(2-x-C):ge/(x+C),x){case s:P=(f-o)/ge+(f<o?6:0);break;case f:P=(o-s)/ge+2;break;case o:P=(s-f)/ge+4;break;default:throw new Error("unreachable")}P/=6}e.data[r++]=P*this.maxValue,e.data[r++]=Y*this.maxValue,e.data[r++]=ze,this.alpha&&(e.data[r++]=n[a+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let a=r[n],s=r[n+1],f=r[n+2],o=Math.min(this.maxValue-a,this.maxValue-s,this.maxValue-f),x=(this.maxValue-a-o)/(1-o/this.maxValue),C=(this.maxValue-s-o)/(1-o/this.maxValue),P=(this.maxValue-f-o)/(1-o/this.maxValue);e.data[t++]=Math.round(x),e.data[t++]=Math.round(C),e.data[t++]=Math.round(P),e.data[t++]=Math.round(o),this.alpha&&(e.data[t++]=r[n+3])}return e}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,t,r){return e*6966+t*23436+r*2366>>15},luma601(e,t,r){return e*9798+t*19235+r*3735>>15},maximum(e,t,r){return Math.max(e,t,r)},minimum(e,t,r){return Math.min(e,t,r)},average(e,t,r){return(e+t+r)/3>>0},minmax(e,t,r){return(Math.max(e,t,r)+Math.min(e,t,r))/2},red(e){return e},green(e,t){return t},blue(e,t,r){return r},cyan(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-e-a)/(1-a/n.maxValue)>>0},magenta(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-t-a)/(1-a/n.maxValue)>>0},yellow(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-r-a)/(1-a/n.maxValue)>>0},black(e,t,r,n){return Math.min(n.maxValue-e,n.maxValue-t,n.maxValue-r)},hue(e,t,r,n){let a=methods$1.min(e,t,r),s=methods$1.max(e,t,r);if(s===a)return 0;let f=0,o=s-a;switch(s){case e:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-e)/o+2;break;case r:f=(e-t)/o+4;break;default:throw new Error("unreachable")}return f/6*n.maxValue>>0},saturation(e,t,r,n){let a=methods$1.min(e,t,r),s=methods$1.max(e,t,r),f=s-a;return s===0?0:f/s*n.maxValue},lightness(e,t,r){let n=methods$1.min(e,t,r);return(methods$1.max(e,t,r)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:t="luma709",keepAlpha:r=!1,mergeAlpha:n=!0}=e;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),r&=this.alpha,n&=this.alpha,r&&(n=!1);let a=getOutputImage(this,e,{components:1,alpha:r,colorModel:GREY$1}),s;if(typeof t=="function")s=t;else if(s=methods$1[t.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${t}`);let f=0;for(let o=0;o<this.data.length;o+=this.channels)n?a.data[f++]=clamp(s(this.data[o],this.data[o+1],this.data[o+2],this)*this.data[o+this.components]/this.maxValue,this):(a.data[f++]=clamp(s(this.data[o],this.data[o+1],this.data[o+2],this),this),a.alpha&&(a.data[f++]=this.data[o+this.components]));return a}function huang(e){let t=0;for(let P=0;P<e.length;P++)if(e[P]!==0){t=P;break}let r=e.length-1;for(let P=e.length-1;P>=t;P--)if(e[P]!==0){r=P;break}let n=1/(r-t),a=new Array(e.length),s=0,f=0;for(let P=t;P<e.length;P++)s+=P*e[P],f+=e[P],a[P]=s/f;let o=new Array(e.length);s=f=0;for(let P=r;P>0;P--)s+=P*e[P],f+=e[P],o[P-1]=s/f;let x=-1,C=Number.MAX_VALUE;for(let P=0;P<e.length;P++){let Y=0,ze;for(let ge=0;ge<=P;ge++)ze=1/(1+n*Math.abs(ge-a[P])),ze<1e-6||ze>.999999||(Y+=e[ge]*(-ze*Math.log(ze)-(1-ze)*Math.log(1-ze)));for(let ge=P+1;ge<e.length;ge++)ze=1/(1+n*Math.abs(ge-o[P])),ze<1e-6||ze>.999999||(Y+=e[ge]*(-ze*Math.log(ze)-(1-ze)*Math.log(1-ze)));Y<C&&(C=Y,x=P)}return x}function intermodes(e){let t=e.slice(),r=0;for(;!bimodalTest$1(t);){let a=0,s=0,f=t[0];for(let o=0;o<e.length-1;o++)a=s,s=f,f=t[o+1],t[o]=(a+s+f)/3;if(t[e.length-1]=(s+f)/3,r++,r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let a=1;a<e.length-1;a++)t[a-1]<t[a]&&t[a+1]<t[a]&&(n+=a);return Math.floor(n/2)}function bimodalTest$1(e){let t=!1,r=0;for(let n=1;n<e.length-1;n++)if(e[n-1]<e[n]&&e[n+1]<e[n]&&(r++,r>2))return!1;return r===2&&(t=!0),t}function isodata(e){let t,r,n,a,s=0;for(let f=1;f<e.length;f++)if(e[f]>0){s=f+1;break}for(;;){t=0,n=0;for(let f=0;f<s;f++)n=n+e[f],t=t+e[f]*f;a=0,r=0;for(let f=s+1;f<e.length;f++)r+=e[f],a+=e[f]*f;if(n>0&&r>0&&(t/=n,a/=r,s===Math.round((t+a)/2)))break;if(s++,s>e.length-2)throw new Error("Threshold not found")}return s}function li$1(e,t){let r,n,a,s,f,o,x,C,P,Y,ze,ge;ze=.5,Y=0;for(let Bt=0;Bt<e.length;Bt++)Y+=Bt*e[Bt];Y/=t,x=Y;do{o=x,r=o+.5|0,n=0,s=0;for(let Bt=0;Bt<=r;Bt++)n+=Bt*e[Bt],s+=e[Bt];C=s===0?0:n/s,a=0,f=0;for(let Bt=r+1;Bt<e.length;Bt++)a+=Bt*e[Bt],f+=e[Bt];P=f===0?0:a/f,ge=(C-P)/(Math.log(C)-Math.log(P)),ge<-Number.EPSILON?x=ge-.5|0:x=ge+.5|0}while(Math.abs(x-o)>ze);return r}function maxEntropy(e,t){let r=new Array(e.length);for(let ze=0;ze<e.length;ze++)r[ze]=e[ze]/t;let n=new Array(e.length),a=new Array(e.length);n[0]=r[0],a[0]=1-n[0];for(let ze=1;ze<e.length;ze++)n[ze]=n[ze-1]+r[ze],a[ze]=1-n[ze];let s=0;for(let ze=0;ze<e.length;ze++)if(Math.abs(n[ze])>=Number.EPSILON){s=ze;break}let f=e.length-1;for(let ze=e.length-1;ze>=s;ze--)if(Math.abs(a[ze])>=Number.EPSILON){f=ze;break}let o=-1,x,C=Number.MIN_VALUE,P,Y;for(let ze=s;ze<=f;ze++){P=0;for(let ge=0;ge<=ze;ge++)e[ge]!==0&&(P-=r[ge]/n[ze]*Math.log(r[ge]/n[ze]));Y=0;for(let ge=ze+1;ge<e.length;ge++)e[ge]!==0&&(Y-=r[ge]/a[ze]*Math.log(r[ge]/a[ze]));x=P+Y,C<x&&(C=x,o=ze)}return o}function mean$1(e,t){let r=0;for(let n=0;n<e.length;n++)r+=n*e[n];return Math.floor(r/t)}function minError(e,t){let r,n=-2,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur=0;for(let kn=0;kn<e.length;kn++)Ur+=kn*e[kn];for(Ur/=t,r=Ur;r!==n;){let kn=sumA(e,r),Io=sumA(e,e.length-1),rl=sumB(e,r),Co=sumB(e,e.length-1),as=sumC(e,r),$s=sumC(e,e.length-1);if(a=rl/kn,s=(Co-rl)/(Io-kn),f=kn/Io,o=(Io-kn)/Io,x=as/kn-a*a,C=($s-as)/(Io-kn)-s*s,P=1/x-1/C,Y=a/x-s/C,ze=a*a/x-s*s/C+Math.log10(x*(o*o)/(C*(f*f))),ge=Y*Y-P*ze,ge<0)return r;n=r,Bt=(Y+Math.sqrt(ge))/P,isNaN(Bt)?r=n:r=Math.floor(Bt)}return r}function sumA(e,t){let r=0;for(let n=0;n<=t;n++)r+=e[n];return r}function sumB(e,t){let r=0;for(let n=0;n<=t;n++)r+=n*e[n];return r}function sumC(e,t){let r=0;for(let n=0;n<=t;n++)r+=n*n*e[n];return r}function minimum(e){if(e.length<2)return 0;let t=0,r=-1,n=-1,a=new Array(e.length);for(let s=0;s<e.length;s++)a[s]=e[s],e[s]>0&&(n=s);for(;!bimodalTest(a);)if(a=smoothed(a),t++,t>1e4)return r;return r=minimumBetweenPeeks(a,n),r}function smoothed(e){let t=new Array(e.length);for(let r=1;r<e.length-1;r++)t[r]=(e[r-1]+e[r]+e[r+1])/3;return t[0]=(e[0]+e[1])/3,t[e.length-1]=(e[e.length-2]+e[e.length-1])/3,t}function minimumBetweenPeeks(e,t){let r;for(let n=1;n<t;n++)if(e[n-1]>e[n]&&e[n+1]>=e[n]){r=n;break}return r}function bimodalTest(e){let t=e.length,r=!1,n=0;for(let a=1;a<t-1;a++)if(e[a-1]<e[a]&&e[a+1]<e[a]&&(n++,n>2))return!1;return n===2&&(r=!0),r}function moments(e,t){let r=1,n=0,a=0,s=0,f=0,o,x,C,P,Y,ze,ge=-1,Bt=e.length,Ur=new Array(Bt);for(let kn=0;kn<Bt;kn++)Ur[kn]=e[kn]/t;for(let kn=0;kn<Bt;kn++)n+=kn*Ur[kn],a+=kn*kn*Ur[kn],s+=kn*kn*kn*Ur[kn];x=r*a-n*n,C=(-a*a+n*s)/x,P=(r*-s+a*n)/x,Y=.5*(-P-Math.sqrt(P*P-4*C)),ze=.5*(-P+Math.sqrt(P*P-4*C)),o=(ze-n)/(ze-Y);for(let kn=0;kn<Bt;kn++)if(f+=Ur[kn],f>o){ge=kn;break}return ge}function otsu(e,t){let r=0,n=0,a=0,s=0,f=0;for(let o=0;o<e.length;o++)f+=o*e[o];for(let o=0;o<e.length;o++){n=n+e[o];const x=t-n;if(n===0||x===0)continue;r=r+o*e[o];const C=(f-r)/x,P=n*x*(r/n-C)*(r/n-C);P>=a&&(s=o,a=P)}return s}function percentile(e){let t=-1,r=.5,n=new Array(e.length),a=partialSum(e,e.length-1),s=1;for(let f=0;f<e.length;f++)n[f]=Math.abs(partialSum(e,f)/a-r),n[f]<s&&(s=n[f],t=f);return t}function partialSum(e,t){let r=0;for(let n=0;n<=t;n++)r+=e[n];return r}function renyiEntropy(e,t){let r,n,a,s=new Array(e.length),f=new Array(e.length),o=new Array(e.length),x=0,C=0,P=0,Y=0,ze=0,ge=0,Ur=1/(1-.5),Io=1/(1-2);for(let $s=0;$s<e.length;$s++)s[$s]=e[$s]/t;f[0]=s[0],o[0]=1-f[0];for(let $s=1;$s<e.length;$s++)f[$s]=f[$s-1]+s[$s],o[$s]=1-f[$s];n=0;for(let $s=0;$s<e.length;$s++)if(Math.abs(f[$s])>=Number.EPSILON){n=$s;break}a=e.length-1;for(let $s=e.length-1;$s>=n;$s--)if(Math.abs(o[$s])>=Number.EPSILON){a=$s;break}for(let $s=n;$s<=a;$s++){let ah=0,ch=0,Zu=0;for(let Gh=0;Gh<=$s;Gh++)e[Gh]!==0&&(ah-=s[Gh]/f[$s]*Math.log(s[Gh]/f[$s])),ch+=Math.sqrt(s[Gh]/f[$s]),Zu+=s[Gh]*s[Gh]/(f[$s]*f[$s]);let ih=0,al=0,sh=0;for(let Gh=$s+1;Gh<e.length;Gh++)e[Gh]!==0&&(ih-=s[Gh]/o[$s]*Math.log(s[Gh]/o[$s])),al+=Math.sqrt(s[Gh]/o[$s]),sh+=s[Gh]*s[Gh]/(o[$s]*o[$s]);let _h=ah+ih,Ih=Ur*(ch*al>0?Math.log(ch*al):0),Lh=Io*(Zu*sh>0?Math.log(Zu*sh):0);_h>Y&&(Y=_h,x=$s),Ih>ze&&(ze=Ih,C=$s),Lh>ge&&(ge=Lh,P=$s)}let rl=[x,C,P];rl.sort(($s,ah)=>$s-ah);let Co;Math.abs(rl[0]-rl[1])<=5?Math.abs(rl[1]-rl[2])<=5?Co=[1,2,1]:Co=[0,1,3]:Math.abs(rl[1]-rl[2])<=5?Co=[3,1,0]:Co=[1,2,1];let as=f[rl[2]]-f[rl[0]];return r=Math.round(rl[0]*(f[rl[0]]+.25*as*Co[0])+.25*rl[1]*as*Co[1]+rl[2]*(o[rl[2]]+.25*as*Co[2])),r}function shanbhag(e,t){let r=new Array(e.length);for(let ge=0;ge<e.length;ge++)r[ge]=e[ge]/t;let n=new Array(e.length),a=new Array(e.length);n[0]=r[0],a[0]=1-n[0];for(let ge=1;ge<e.length;ge++)n[ge]=n[ge-1]+r[ge],a[ge]=1-n[ge];let s=0;for(let ge=0;ge<e.length;ge++)if(Math.abs(n[ge])>=Number.EPSILON){s=ge;break}let f=e.length-1;for(let ge=e.length-1;ge>=s;ge--)if(Math.abs(a[ge])>=Number.EPSILON){f=ge;break}let o=-1,x=Number.MAX_VALUE,C,P,Y,ze;for(let ge=s;ge<=f;ge++){Y=0,C=.5/n[ge];for(let Bt=1;Bt<=ge;Bt++)Y-=r[Bt]*Math.log(1-C*n[Bt-1]);Y*=C,ze=0,C=.5/a[ge];for(let Bt=ge+1;Bt<e.length;Bt++)ze-=r[Bt]*Math.log(1-C*a[Bt]);ze*=C,P=Math.abs(Y-ze),P<x&&(x=P,o=ge)}return o}function triangle$1(e){let t=0,r=0,n=0,a=0;for(let Y=0;Y<e.length;Y++)if(e[Y]>0){t=Y;break}t>0&&t--;for(let Y=e.length-1;Y>0;Y--)if(e[Y]>0){a=Y;break}a<e.length-1&&a++;for(let Y=0;Y<e.length;Y++)e[Y]>r&&(n=Y,r=e[Y]);let s=!1;if(n-t<a-n){s=!0;let Y=0,ze=e.length-1;for(;Y<ze;){let ge=e[Y];e[Y]=e[ze],e[ze]=ge,Y++,ze--}t=e.length-1-a,n=e.length-1-n}if(t===n)return t;let f,o,x;f=e[n],o=t-n,x=Math.sqrt(f*f+o*o),f/=x,o/=x,x=f*t+o*e[t];let C=t,P=0;for(let Y=t+1;Y<=n;Y++){let ze=f*Y+o*e[Y]-x;ze>P&&(C=Y,P=ze)}if(C--,s){let Y=0,ze=e.length-1;for(;Y<ze;){let ge=e[Y];e[Y]=e[ze],e[ze]=ge,Y++,ze--}return e.length-1-C}else return C}function yen(e,t){let r=new Array(e.length);for(let C=0;C<e.length;C++)r[C]=e[C]/t;let n=new Array(e.length);n[0]=r[0];for(let C=1;C<e.length;C++)n[C]=n[C-1]+r[C];let a=new Array(e.length);a[0]=r[0]*r[0];for(let C=1;C<e.length;C++)a[C]=a[C-1]+r[C]*r[C];let s=new Array(e.length);s[e.length-1]=0;for(let C=e.length-2;C>=0;C--)s[C]=s[C+1]+r[C+1]*r[C+1];let f=-1,o=Number.MIN_VALUE,x;for(let C=0;C<e.length;C++)x=-1*(a[C]*s[C]>0?Math.log(a[C]*s[C]):0)+2*(n[C]*(1-n[C])>0?Math.log(n[C]*(1-n[C])):0),x>o&&(o=x,f=C);return f}const methods={huang,intermodes,isodata,li:li$1,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:t=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let r=methods[t.toLowerCase()];if(r){let n=this.getHistogram();return r(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:t=THRESHOLD,threshold:r=.5,useAlpha:n=!0,invert:a=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?r=getThreshold$1(r,this.maxValue):r=getThreshold.call(this,e);let s=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),f=0;if(this.alpha&&n)for(let o=0;o<this.data.length;o+=this.channels){let x=this.data[o]+(this.maxValue-this.data[o])*(this.maxValue-this.data[o+1])/this.maxValue;(a&&x<=r||!a&&x>=r)&&s.setBit(f),f++}else for(let o=0;o<this.data.length;o+=this.channels)(a&&this.data[o]<=r||!a&&this.data[o]>=r)&&s.setBit(f),f++;return s}function copyImage(e,t,r,n){let a=e.width,s=e.height,f=t.width,o=e.channels;for(let x=0;x<a;x++)for(let C=0;C<s;C++)for(let P=0;P<o;P++){let Y=(C*a+x)*o+P,ze=((n+C)*f+r+x)*o+P;t.data[ze]=e.data[Y]}}function pad(e={}){let{size:t=0,algorithm:r="copy",color:n}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),r==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let x=0;x<n.length;x++)n[x]===0&&(n[x]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let a=this.width+t[0]*2,s=this.height+t[1]*2,f=this.channels,o=Image$1.createFrom(this,{width:a,height:s});copyImage(this,o,t[0],t[1]);for(let x=t[0];x<a-t[0];x++)for(let C=0;C<f;C++){let P=n[C]||o.data[(t[1]*a+x)*f+C];for(let Y=0;Y<t[1];Y++)o.data[(Y*a+x)*f+C]=P;P=n[C]||o.data[((s-t[1]-1)*a+x)*f+C];for(let Y=s-t[1];Y<s;Y++)o.data[(Y*a+x)*f+C]=P}for(let x=0;x<s;x++)for(let C=0;C<f;C++){let P=n[C]||o.data[(x*a+t[0])*f+C];for(let Y=0;Y<t[0];Y++)o.data[(x*a+Y)*f+C]=P;P=n[C]||o.data[(x*a+a-t[0]-1)*f+C];for(let Y=a-t[0];Y<a;Y++)o.data[(x*a+Y)*f+C]=P}return o}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let t=Image$1.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(t.data[r]=255);else for(let r=0;r<this.data.length;r++)t.data[r]=this.data[r]>>8;break;case 16:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(t.data[r]=65535);else for(let r=0;r<this.data.length;r++)t.data[r]=this.data[r]<<8|this.data[r];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(e,t={}){const{interpolation:r=validInterpolations.nearestneighbor,width:n=this.width,height:a=this.height}=t;if(typeof e!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(r),f=e*Math.PI/180,o=Math.floor(Math.abs(n*Math.cos(f))+Math.abs(a*Math.sin(f))),x=Math.floor(Math.abs(a*Math.cos(f))+Math.abs(n*Math.sin(f))),C=Math.cos(-f),P=Math.sin(-f);let Y=o/2,ze=x/2;o%2===0?(Y=Y-.5,x%2===0?ze=ze-.5:ze=Math.floor(ze)):(Y=Math.floor(Y),x%2===0?ze=ze-.5:ze=Math.floor(ze));const ge=Math.floor(n/2-Y),Bt=Math.floor(a/2-ze);if(this.bitDepth===1){const Ur=new Image$1(o,x,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,Ur,ge,Bt,Y,ze,C,P);case validInterpolations.bilinear:return rotateBinaryBilinear(this,Ur,ge,Bt,Y,ze,C,P);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const Ur=Image$1.createFrom(this,{width:o,height:x});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,Ur,ge,Bt,Y,ze,C,P);case validInterpolations.bilinear:return rotateBilinear(this,Ur,ge,Bt,Y,ze,C,P);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(e,t,r,n,a,s,f,o){for(let x=0;x<t.width;x+=1)for(let C=0;C<t.height;C+=1)for(let P=0;P<e.channels;P++){let Y=Math.round((x-a)*f-(C-s)*o+a)+r,ze=Math.round((C-s)*f+(x-a)*o+s)+n;Y<0||Y>=e.width||ze<0||ze>=e.height?e.alpha===1&&P===e.channels-1?t.setValueXY(x,C,P,0):t.setValueXY(x,C,P,e.maxValue):t.setValueXY(x,C,P,e.getValueXY(Y,ze,P))}return t}function rotateBinaryNearestNeighbor(e,t,r,n,a,s,f,o){for(let x=0;x<t.width;x+=1)for(let C=0;C<t.height;C+=1){let P=Math.round((x-a)*f-(C-s)*o+a)+r,Y=Math.round((C-s)*f+(x-a)*o+s)+n;(P<0||P>=e.width||Y<0||Y>=e.height||e.getBitXY(P,Y))&&t.setBitXY(x,C)}return t}function rotateBilinear(e,t,r,n,a,s,f,o){let x=e.width*e.channels;for(let C=0;C<t.height;C++)for(let P=0;P<t.width;P++){let Y=(P-a)*f-(C-s)*o+a+r,ze=(C-s)*f+(P-a)*o+s+n,ge=Y|0,Bt=ze|0,Ur=Y-ge,kn=ze-Bt;for(let Io=0;Io<e.channels;Io++)if(Y<0||Y>=e.width||ze<0||ze>=e.height)e.alpha===1&&Io===e.channels-1?t.setValueXY(P,C,Io,0):t.setValueXY(P,C,Io,e.maxValue);else{let rl=(Bt*e.width+ge)*e.channels+Io,Co=e.data[rl],as=e.data[rl+e.channels],$s=e.data[rl+x],ah=e.data[rl+x+e.channels],ch=Co+Ur*(as-Co)+kn*($s-Co)+Ur*kn*(Co-as-$s+ah)|0;t.setValueXY(P,C,Io,ch)}}return t}function rotateBinaryBilinear(e,t,r,n,a,s,f,o){let x=e.width;for(let C=0;C<t.height;C++)for(let P=0;P<t.width;P++){let Y=(P-a)*f-(C-s)*o+a+r,ze=(C-s)*f+(P-a)*o+s+n,ge=Y|0,Bt=ze|0,Ur=Y-ge,kn=ze-Bt;if(Y<0||Y>=e.width||ze<0||ze>=e.height)t.setBitXY(P,C);else{let Io=Bt*e.width+ge,rl=e.getBit(Io),Co=e.getBit(Io+1),as=e.getBit(Io+x),$s=e.getBit(Io+1+x);(rl|Ur&Co-rl|kn&as-rl|Ur&kn&rl-Co-as+$s)>0&&t.setBitXY(P,C)}}return t}function rotate$1(e,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,t)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=e.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)this.getBitXY(n,r)&&e.setBitXY(r,t-n);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),t=e.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(r,t-n,a,this.getValueXY(n,r,a));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=e.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)this.getBitXY(n,r)&&e.setBitXY(t-r,n);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),t=e.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(t-r,n,a,this.getValueXY(n,r,a));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),t=e.width-1,r=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.getBitXY(a,n)&&e.setBitXY(t-a,r-n);return e}else{const e=Image$1.createFrom(this),t=e.width-1,r=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)for(let s=0;s<this.channels;s++)e.setValueXY(t-a,r-n,s,this.getValueXY(a,n,s));return e}}function insert(e,t={}){const r=getImageParameters(e);this.checkProcessable("insert",r);let{x:n=0,y:a=0}=t;const s=getOutputImageOrInPlace(this,t,{copy:!0}),f=Math.min(s.height,a+e.height),o=Math.min(s.width,n+e.width);if(s.bitDepth===1)for(let x=a;x<f;x++)for(let C=n;C<o;C++)e.getBitXY(C-n,x-a)?s.setBitXY(C,x):s.clearBitXY(C,x);else for(let x=a;x<f;x++)for(let C=n;C<o;C++)s.setPixelXY(C,x,e.getPixelXY(C-n,x-a));return s}function setBorder(e={}){let{size:t=0,algorithm:r="copy",color:n}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),r==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let o=0;o<n.length;o++)n[o]===0&&(n[o]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let a=t[0],s=t[1],f=this.channels;for(let o=a;o<this.width-a;o++)for(let x=0;x<f;x++){let C=n[x]||this.data[(o+this.width*s)*f+x];for(let P=0;P<s;P++)this.data[(P*this.width+o)*f+x]=C;C=n[x]||this.data[(o+this.width*(this.height-s-1))*f+x];for(let P=this.height-s;P<this.height;P++)this.data[(P*this.width+o)*f+x]=C}for(let o=0;o<this.height;o++)for(let x=0;x<f;x++){let C=n[x]||this.data[(o*this.width+a)*f+x];for(let P=0;P<a;P++)this.data[(o*this.width+P)*f+x]=C;C=n[x]||this.data[(o*this.width+this.width-a-1)*f+x];for(let P=this.width-a;P<this.width;P++)this.data[(o*this.width+P)*f+x]=C}return this}function split(e={}){let{preserveAlpha:t=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack$3([this.clone()]);let r=new Stack$3,n=this.data;if(this.alpha&&t)for(let a=0;a<this.components;a++){let s=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),f=0;for(let o=0;o<n.length;o+=this.channels)s.data[f++]=n[o+a],s.data[f++]=n[o+this.components];r.push(s)}else for(let a=0;a<this.channels;a++){let s=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),f=0;for(let o=0;o<n.length;o+=this.channels)s.data[f++]=n[o+a];r.push(s)}return r}function getChannel(e,t={}){let{keepAlpha:r=!1,mergeAlpha:n=!1}=t;r&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let a=Image$1.createFrom(this,{components:1,alpha:r,colorModel:GREY$1}),s=0;for(let f=0;f<this.data.length;f+=this.channels)n?a.data[s++]=this.data[f+e]*this.data[f+this.components]/this.maxValue:(a.data[s++]=this.data[f+e],r&&(a.data[s++]=this.data[f+this.components]));return a}function combineChannels(e=defaultCombineMethod,t={}){let{mergeAlpha:r=!1,keepAlpha:n=!1}=t;r&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let a=Image$1.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),s=0;for(let f=0;f<this.size;f++){let o=e(this.getPixel(f));r?a.data[s++]=o*this.data[f*this.channels+this.components]/this.maxValue:(a.data[s++]=o,n&&(a.data[s++]=this.data[f*this.channels+this.components]))}return a}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let r=e;for(let n=0;n<t.data.length;n++)this.data[r]=t.data[n],r+=this.channels;return this}function getSimilarity(e,t={}){let{shift:r=[0,0],average:n,channels:a,defaultAlpha:s,normalize:f,border:o=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(o)||(o=[o,o]),a=validateArrayOfChannels(this,{channels:a,defaultAlpha:s}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let x=Math.max(o[0],-r[0]),C=Math.min(this.width-o[0],this.width-r[0]),P=Math.max(o[1],-r[1]),Y=Math.min(this.height-o[1],this.height-r[1]),ze=newArray$1(a.length,0);for(let ge=0;ge<a.length;ge++){let Bt=a[ge],Ur=f?this.sum[Bt]:Math.max(this.sum[Bt],e.sum[Bt]),kn=f?e.sum[Bt]:Math.max(this.sum[Bt],e.sum[Bt]);if(Ur!==0&&kn!==0)for(let Io=x;Io<C;Io++)for(let rl=P;rl<Y;rl++){let Co=Io*this.multiplierX+rl*this.multiplierY+Bt,as=Co+r[0]*this.multiplierX+r[1]*this.multiplierY;ze[ge]+=Math.min(this.data[Co]/Ur,e.data[as]/kn)}}return n?ze.reduce((ge,Bt)=>ge+Bt)/ze.length:ze}function getPixelsGrid(e={}){let{sampling:t=[10,10],painted:r=!1,mask:n}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const a=t[0],s=t[1],f=[],o=[],x=this.width/a,C=this.height/s;let P=Math.floor(x/2);for(let ze=0;ze<a;ze++){let ge=Math.floor(C/2);for(let Bt=0;Bt<s;Bt++){let Ur=Math.round(P),kn=Math.round(ge);(!n||n.getBitXY(Ur,kn))&&(f.push([Ur,kn]),o.push(this.getPixelXY(Ur,kn))),ge+=C}P+=x}const Y={xyS:f,zS:o};return r&&(Y.painted=this.rgba8().paintPoints(f)),Y}function Matrix(e,t,r){const n=new Array(e);for(let a=0;a<e;a++)n[a]=new Array(t);if(r)for(let a=0;a<e;a++)for(let s=0;s<t;s++)n[a][s]=r;return n.width=e,n.height=t,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(e,t){let r=this[e][t],n=[e,t];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]<r&&(r=this[a][s],n=[a,s]);return{position:n,value:r}};Matrix.prototype.localMax=function(e,t){let r=this[e][t],n=[e,t];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]>r&&(r=this[a][s],n=[a,s]);return{position:n,value:r}};Matrix.prototype.localSearch=function(e,t,r){let n=[];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]===r&&n.push([a,s]);return n};function getBestMatch(e,t={}){let{border:r}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(e.width,e.height,-1/0),a=Math.floor(e.width/2),s=Math.floor(e.height/2),f=a,o=s,x=!1;for(;!x;){let C=n.localSearch(a,s,-1/0);for(let Y=0;Y<C.length;Y++){let ze=C[Y],ge=this.getSimilarity(e,{border:r,shift:[f-ze[0],o-ze[1]]});n[ze[0]][ze[1]]=ge}let P=n.localMax(a,s);P.position[0]!==a||P.position[1]!==s?(a=P.position[0],s=P.position[1]):x=!0}return[a-f,s-o]}function getRow(e,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,t);let r=new Array(this.width),n=0,a=e*this.width*this.channels+t,s=a+this.width*this.channels;for(let f=a;f<s;f+=this.channels)r[n++]=this.data[f];return r}function getColumn(e,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,t);let r=new Array(this.height),n=0,a=this.width*this.channels;for(let s=t+e*this.channels;s<this.data.length;s+=a)r[n++]=this.data[s];return r}function getMatrix(e={}){let{channel:t}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let r=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)r.set(n,a,this.getValueXY(a,n,t));return r}function setMatrix(e,t={}){e=new Matrix$2(e);let{channel:r}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.setValueXY(a,n,r,e.get(n,a))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),t=0;for(let r=0;r<this.data.length;r+=this.channels){let n=new Array(this.components);for(let a=0;a<this.components;a++)n[a]=this.data[r+a];e[t++]=n}return e}function getIntersection(e){let t=this,r=t.getClosestCommonParent(e),n=t.getRelativePosition(r,{defaultFurther:!0}),a=getRelativePositionForAllPixels(t,n),s=e.getRelativePosition(r,{defaultFurther:!0}),f=getRelativePositionForAllPixels(e,s),o=getCommonSurface(a,f),x={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let C=0;C<o.length;C++){let P=o[C],Y=[P[0]-n[0],P[1]-n[1]],ze=[P[0]-s[0],P[1]-s[1]],ge=t.getBitXY(Y[0],Y[1]),Bt=e.getBitXY(ze[0],ze[1]);ge===1&&Bt===1&&x.commonWhitePixels.push(P)}for(let C=0;C<a.length;C++){let P,Y;C!==0&&(P=Math.floor(C/t.width),Y=C%t.width),t.getBitXY(P,Y)===1&&x.whitePixelsMask1.push(a[C])}for(let C=0;C<f.length;C++){let P=0,Y=0;C!==0&&(P=Math.floor(C/e.width),Y=C%e.width),e.getBitXY(P,Y)===1&&x.whitePixelsMask2.push(f[C])}return x}function getRelativePositionForAllPixels(e,t){let r=[];for(let n=0;n<e.height;n++)for(let a=0;a<e.width;a++){let s=[n,a];r.push([s[0]+t[0],s[1]+t[1]])}return r}function getCommonSurface(e,t){let r=0,n=0,a=[];for(;r<e.length&&n<t.length;)e[r][0]===t[n][0]&&e[r][1]===t[n][1]?(a.push(e[r]),r++,n++):e[r][0]<t[n][0]||e[r][0]===t[n][0]&&e[r][1]<t[n][1]?r++:n++;return a}function getClosestCommonParent(e){let t=getDepth(this),r=getDepth(e),n;if(t>=r?n=getFurthestParent(this,t):n=getFurthestParent(e,r),t===0||r===0)return n;let a=this,s=e;for(;t!==r;)if(t>r){if(a=a.parent,a===null)return n;t=t-1}else{if(s=s.parent,s===null)return n;r=r-1}for(;a!==s&&a!==null&&s!==null;)if(a=a.parent,s=s.parent,a===null||s===null)return n;return a!==s?n:a}function getDepth(e){let t=0,r=e;for(;r.parent!=null;)r=r.parent,t++;return t}function getFurthestParent(e,t){let r=e;for(;t>0;)r=r.parent,t=t-1;return r}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,t){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$1,t);const r=e.width,n=e.height,a=e.maxValue,s={sigma:t.gaussianBlur,radius:3},f=e.gaussianFilter(s),o=f.convolution(Gy,convOptions),x=f.convolution(Gx,convOptions),C=x.hypotenuse(o),P=e.constructor,Y=new P(r,n,{kind:"GREY",bitDepth:32}),ze=new P(r,n,{kind:"GREY",bitDepth:32}),ge=new P(r,n,{kind:"GREY"});for(var Bt=1;Bt<r-1;Bt++)for(var Ur=1;Ur<n-1;Ur++){var kn=(Math.round(Math.atan2(x.getValueXY(Bt,Ur,0),o.getValueXY(Bt,Ur,0))*(5/Math.PI))+5)%5;kn===0&&(C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt,Ur-1,0)||C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt,Ur+1,0))||kn===1&&(C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt-1,Ur+1,0)||C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt+1,Ur-1,0))||kn===2&&(C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt-1,Ur,0)||C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt+1,Ur,0))||kn===3&&(C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt-1,Ur-1,0)||C.getValueXY(Bt,Ur,0)<=C.getValueXY(Bt+1,Ur+1,0))||Y.setValueXY(Bt,Ur,0,C.getValueXY(Bt,Ur,0))}for(Bt=0;Bt<r*n;++Bt){var Io=Y.data[Bt],rl=0;Io>t.highThreshold&&(rl++,ge.data[Bt]=a),Io>t.lowThreshold&&rl++,ze.data[Bt]=rl}var Co=[];for(Bt=1;Bt<r-1;++Bt)for(Ur=1;Ur<n-1;++Ur)if(ze.getValueXY(Bt,Ur,0)===1){e:for(var as=Bt-1;as<Bt+2;++as)for(var $s=Ur-1;$s<Ur+2;++$s)if(ze.getValueXY(as,$s,0)===2){Co.push([Bt,Ur]),ge.setValueXY(Bt,Ur,0,a);break e}}for(;Co.length>0;){var ah=[];for(Bt=0;Bt<Co.length;++Bt)for(Ur=-1;Ur<2;++Ur)for(as=-1;as<2;++as)if(!(Ur===0&&as===0)){var ch=Co[Bt][0]+Ur,Zu=Co[Bt][1]+as;ze.getValueXY(ch,Zu,0)===1&&ge.getValueXY(ch,Zu,0)===0&&(ah.push([ch,Zu]),ge.setValueXY(ch,Zu,0,a))}Co=ah}return ge}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,t={}){let{position:r}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&(r=e.getRelativePosition(this),!r))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image$1.createFrom(this,{width:e.width,height:e.height,alpha:1,position:r,parent:this});for(let a=0;a<e.width;a++)for(let s=0;s<e.height;s++){for(let f=0;f<this.channels;f++){let o=this.getValueXY(a+r[0],s+r[1],f);n.setValueXY(a,s,f,o)}e.getBitXY(a,s)||n.setValueXY(a,s,this.components,0)}return n}else{let n=Image$1.createFrom(this,{width:e.width,height:e.height,position:r,parent:this});for(let a=0;a<e.height;a++)for(let s=0;s<e.width;s++)e.getBitXY(s,a)&&this.getBitXY(s+r[0],a+r[1])&&n.setBitXY(s,a);return n}}var fastList={exports:{}};(function(e,t){(function(){function r(a,s,f){this.next=f,f&&(f.prev=this),this.prev=s,s&&(s.next=this),this.data=a}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(a){this._tail=new r(a,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var a=this._tail;return this._tail=a.prev,a.prev&&(a.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),a.data}},unshift:function(a){this._head=new r(a,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var a=this._head;return this._head=a.next,a.next&&(a.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),a.data}},item:function(a){a<0&&(a=this.length+a);for(var s=this._head;a-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(a,s){if(a||(a=0),s||(s=this.length),s<0&&(s=this.length+s),a<0&&(a=this.length+a),s===a)return[];if(s<a)throw new Error("invalid offset: "+a+","+s+" (length="+this.length+")");for(var f=s-a,o=new Array(f),x=0,C=this._head;a-- >0&&C;)C=C.next;for(;x<f&&C;)o[x++]=C.data,C=C.next;return o},drop:function(){n.call(this)},forEach:function(a,s){for(var f=this._head,o=0,x=this.length;o<x&&f;)a.call(s||this,f.data,o,this),f=f.next,o++},map:function(a,s){var f=new n;return this.forEach(function(o,x,C){f.push(a.call(s||C,o,x,C))}),f},filter:function(a,s){var f=new n;return this.forEach(function(o,x,C){a.call(s||C,o,x,C)&&f.push(o)}),f},reduce:function(a,s,f){var o=0,x=this._head,C=this.length;for(s||(o=1,s=x&&x.data,x=x&&x.next);o<C&&x;)s=a.call(f||this,s,x.data,this),o++,x=x.next;return s}},e.exports=n})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(e={}){const{x:t=0,y:r=0,inPlace:n=!0}=e,a=n?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,r))return a;const f=new LinkedList;for(f.push(new Node(t,r));f.length>0;){const o=f.shift();a.setBitXY(o.x,o.y);for(let x=o.x+1;x<this.width&&(!a.getBitXY(x,o.y)&&!this.getBitXY(x,o.y));x++)a.setBitXY(x,o.y),o.y+1<this.height&&!this.getBitXY(x,o.y+1)&&f.push(new Node(x,o.y+1)),o.y-1>=0&&!this.getBitXY(x,o.y-1)&&f.push(new Node(x,o.y-1));for(let x=o.x-1;x>=0&&(!a.getBitXY(x,o.y)&&!this.getBitXY(x,o.y));x++)a.setBitXY(x,o.y),o.y+1<this.height&&!this.getBitXY(x,o.y+1)&&f.push(new Node(x,o.y+1)),o.y-1>=0&&!this.getBitXY(x,o.y-1)&&f.push(new Node(x,o.y-1))}return a}function Node(e,t){this.x=e,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function hsv2rgb(e,t,r){t=t/100,r=r/100;var n=[],a=r*t,s=e/60,f=a*(1-Math.abs(s%2-1)),o=r-a;return s>=0&&s<1?n=[a,f,0]:s>=1&&s<2?n=[f,a,0]:s>=2&&s<3?n=[0,a,f]:e>=3&&s<4?n=[0,f,a]:e>=4&&s<5?n=[f,0,a]:e>=5&&s<=6?n=[a,0,f]:n=[0,0,0],{r:Math.round(255*(n[0]+o)),g:Math.round(255*(n[1]+o)),b:Math.round(255*(n[2]+o))}}function hsl2hsv(e,t,r){return t*=(r<50?r:100-r)/100,{h:e,s:2*t/(r+t)*100,v:r+t}}function hsl2rgb$1(e,t,r){var n=hsl2hsv(e,t,r);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var t=colors[e.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(e){var t=e.match(/rgb\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function rgba$1(e){var t=e.match(/rgba\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:r[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var t=e.match(/hsl\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */),n=parseInt(r[0],10),a=parseInt(r[1],10),s=parseInt(r[2],10),f=hsl2rgb$1(n,a,s);return _extends({},f,{a:100})}}function hsla(e){var t=e.match(/hsla\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */),n=parseInt(r[0],10),a=parseInt(r[1],10),s=parseInt(r[2],10),f=parseInt(parseFloat(r[3])*100,10),o=hsl2rgb$1(n,a,s);return _extends({},o,{a:f})}}function css2array(e){let t=parse(e);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hsl2rgb(e,t,r){let n,a,s,f,o,x;return t/=100,r/=100,t===0?f=o=x=r*255:(r<=.5?a=r*(t+1):a=r+t-r*t,n=r*2-a,s=e/360,f=hue2rgb(n,a,s+1/3),o=hue2rgb(n,a,s),x=hue2rgb(n,a,s-1/3)),{r:f,g:o,b:x}}function getDistinctColors(e){let t=new Array(e),r=0;for(let n=0;n<360;n+=360/e){r++;let a=hsl2rgb(n,100,30+r%4*15);t[r-1]=[Math.round(a.r*255),Math.round(a.g*255),Math.round(a.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:t,colors:r,randomColors:n,numberColors:a=50}=e;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(r)return r=r.map(function(s){return Array.isArray(s)?s:css2array(s)}),r;if(n){r=new Array(a);for(let s=0;s<a;s++)r[s]=getRandomColor()}return getDistinctColors(a)}function paintLabels(e,t,r={}){let{color:n="blue",colors:a,font:s="12px Helvetica",rotate:f=0}=r;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),a?a=a.map(function(C){return Array.isArray(C)?C:css2array(C)}):a=[n],e.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(f)||(f=[f]);let x=this.getCanvas().getContext("2d");for(let C=0;C<e.length;C++){x.save();let P=a[C%a.length];x.fillStyle=`rgba(${P[0]},${P[1]},${P[2]},${P[3]/this.maxValue})`,x.font=s[C%s.length];let Y=t[C];x.translate(Y[0],Y[1]),x.rotate(f[C%f.length]/180*Math.PI),x.fillText(e[C],0,0),x.restore()}return this.data=Uint8Array.from(x.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,t={}){let{alpha:r=255,labels:n=[],labelsPosition:a=[],labelColor:s="blue",labelFont:f="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let o=getColors(Object.assign({},t,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let x=0;x<e.length;x++){let C=e[x],P=o[x%o.length];for(let Y=0;Y<C.width;Y++)for(let ze=0;ze<C.height;ze++)if(C.getBitXY(Y,ze))for(let ge=0;ge<Math.min(this.components,P.length);ge++)if(r===255)this.setValueXY(Y+C.position[0],ze+C.position[1],ge,P[ge]);else{let Bt=this.getValueXY(Y+C.position[0],ze+C.position[1],ge);Bt=Math.round((Bt*(255-r)+P[ge]*r)/255),this.setValueXY(Y+C.position[0],ze+C.position[1],ge,Bt)}}if(Array.isArray(n)&&n.length>0){let C=this.getCanvas().getContext("2d");C.fillStyle=s,C.font=f;for(let P=0;P<Math.min(e.length,n.length);P++){let Y=a[P]?a[P]:e[P].position;C.fillText(n[P],Y[0],Y[1])}this.data=Uint8Array.from(C.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,t){let r=new Array(e);for(let n=0;n<e;n++)r[n]=new Array(t).fill(0);return r}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:r="cross",shape:n,size:a,width:s,height:f,filled:o=!0}=t;if(a&&(s=a,f=a),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,f,{filled:o});break;case"circle":case"ellipse":this.matrix=ellipse(s,f,{filled:o});break;case"triangle":this.matrix=triangle(s,f,{filled:o});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(r)switch(r.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${r}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,r=[];for(let n=0;n<t.length;n++)for(let a=0;a<t[0].length;a++)t[n][a]&&r.push([a-this.halfWidth,n-this.halfHeight]);return r}getMask(){let t=new Image$1(this.width,this.height,{kind:BINARY});for(let r=0;r<this.matrix.length;r++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[r][n]&&t.setBitXY(n,r);return t}}function rectangle(e,t,r){const n=zerosMatrix(t,e);if(r.filled)for(let a=0;a<t;a++)for(let s=0;s<e;s++)n[a][s]=1;else{for(let a of[0,t-1])for(let s=0;s<e;s++)n[a][s]=1;for(let a=0;a<t;a++)for(let s of[0,e-1])n[a][s]=1}return n}function ellipse(e,t,r){const n=zerosMatrix(t,e);let a=1-t%2,s=1-e%2,f=Math.floor((e-1)/2),o=Math.floor((t-1)/2),x=f*f,C=o*o;if(r.filled)for(let P=0;P<=o;P++){let Y=Math.floor(Math.sqrt(x-x*P*P/C));for(let ze=f-Y;ze<=f;ze++)n[o-P][ze]=1,n[o+P+a][ze]=1,n[o-P][e-ze-1]=1,n[o+P+a][e-ze-1]=1}else{for(let P=0;P<=o;P++){let Y=Math.floor(Math.sqrt(x-x*P*P/C)),ze=f-Y;n[o-P][ze]=1,n[o+P+a][ze]=1,n[o-P][e-ze-1]=1,n[o+P+a][e-ze-1]=1}for(let P=0;P<=f;P++){let Y=Math.floor(Math.sqrt(C-C*P*P/x)),ze=o-Y;n[ze][f-P]=1,n[ze][f+P+s]=1,n[t-ze-1][f-P]=1,n[t-ze-1][f+P+s]=1}}return n}function triangle(e,t,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(t,e);for(let a=0;a<t;a++){let s=Math.floor((1-a/t)*e/2);for(let f=s;f<e-s;f++)n[a][f]=1}return n}function paintPoints(e,t={}){let{shape:r}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length})),a=new Shape(r).getPoints(),s=Math.min(this.channels,n[0].length);for(let f=0;f<e.length;f++){let o=n[f%n.length],x=e[f][0],C=e[f][1];for(let P=0;P<a.length;P++){let Y=a[P][0],ze=a[P][1];if(x+Y>=0&&C+ze>=0&&x+Y<this.width&&C+ze<this.height){let ge=(x+Y+(C+ze)*this.width)*this.channels;for(let Bt=0;Bt<s;Bt++)this.data[ge+Bt]=o[Bt]}}}return this}function paintPolyline(e,t={}){let{color:r=[this.maxValue,0,0],closed:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let a=Math.min(this.channels,r.length);for(let s=0;s<e.length-1+n;s++){let f=e[s],o=e[(s+1)%e.length],x=o[0]-f[0],C=o[1]-f[1],P=Math.max(Math.abs(x),Math.abs(C)),Y=x/P,ze=C/P,ge=f[0],Bt=f[1];for(let Ur=0;Ur<=P;Ur++){let kn=Math.round(ge),Io=Math.round(Bt);if(kn>=0&&Io>=0&&kn<this.width&&Io<this.height)if(this.bitDepth===1)this.setBitXY(kn,Io);else{let rl=(kn+Io*this.width)*this.channels;for(let Co=0;Co<a;Co++)this.data[rl+Co]=r[Co]}ge=ge+Y,Bt=Bt+ze}}return this}function paintPolylines(e,t={}){let r=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length}));for(let a=0;a<e.length;a++)r.color=n[a%n.length],this.paintPolyline(e[a],r);return this}function paintPolygon(e,t={}){let{color:r=[this.maxValue,0,0],filled:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let a=deleteDouble(e);if(n===!1)return this.paintPolyline(e,t);{let s=Array(this.height);for(let f=0;f<this.height;f++){s[f]=[];for(let o=0;o<this.width;o++)s[f].push(0)}for(let f=0;f<a.length;f++){const o=lineBetweenTwoPoints(a[f],a[(f+1)%a.length]);for(let x=0;x<this.height;x++)for(let C=0;C<this.width;C++)isAtTheRightOfTheLine(C,x,o,this.height)&&(s[x][C]=s[x][C]===0?1:0)}for(let f=0;f<this.height;f++)for(let o=0;o<this.width;o++)if(s[f][o]===1)if(this.bitDepth===1)this.setBitXY(o,f);else{let x=Math.min(this.channels,r.length),C=(o+f*this.width)*this.channels;for(let P=0;P<x;P++)this.data[C+P]=r[P]}return this.paintPolyline(e,t)}}function deleteDouble(e){let t=[];for(let r=0;r<e.length;r++)if(!(e[r][0]===e[(r+1)%e.length][0]&&e[r][1]===e[(r+1)%e.length][1])){if(e[r][0]===e[(r-1+e.length)%e.length][0]&&e[r][1]===e[(r-1+e.length)%e.length][1])continue;if(e[(r+1)%e.length][0]===e[(r-1+e.length)%e.length][0]&&e[(r-1+e.length)%e.length][1]===e[(r+1)%e.length][1])continue;t.push(e[r])}return t}function lineBetweenTwoPoints(e,t){if(e[0]===t[0])return{a:0,b:e[0],vertical:!0};{const r=(t[1]-e[1])/(t[0]-e[0]),n=e[1]-r*e[0];return{a:r,b:n,vertical:!1}}}function isAtTheRightOfTheLine(e,t,r,n){if(r.vertical===!0)return r.b<=e;if(r.a===0)return!1;{const a=(t-r.b)/r.a;return a<e&&a>=0&&a<=n}}function paintPolygons(e,t={}){let r=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length}));for(let a=0;a<e.length;a++)r.color=n[a%n.length],this.paintPolygon(e[a],r);return this}function getHistogram(e={}){let{maxSlots:t=256,channel:r,useAlpha:n=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}return getChannelHistogram.call(this,r,{useAlpha:n,maxSlots:t})}function getHistograms(e={}){const{maxSlots:t=256,useAlpha:r=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(r?this.components:this.channels);for(let a=0;a<n.length;a++)n[a]=getChannelHistogram.call(this,a,{useAlpha:r,maxSlots:t});return n}function getChannelHistogram(e,t){let{useAlpha:r,maxSlots:n}=t;if(this.bitDepth===1){let x=[0,0];for(let C=0;C<this.height;C++)for(let P=0;P<this.width;P++){let Y=this.getBitXY(C,P);Y===0?x[0]+=1:Y===1&&(x[1]+=1)}return x}let a=Math.log2(n);if(!isInteger$1(a))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>a&&(s=this.bitDepth-a);let f=this.data,o=newArray$1(Math.pow(2,Math.min(this.bitDepth,a)),0);if(r&&this.alpha){let x=this.channels-e-1;for(let C=e;C<f.length;C+=this.channels)o[f[C]>>s]+=f[C+x]/this.maxValue}else for(let x=e;x<f.length;x+=this.channels)o[f[x]>>s]++;return o}function getColorHistogram(e={}){let{useAlpha:t=!0,nbSlots:r=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(r)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let a=this.bitDepth-n,s=this.data,f=newArray$1(Math.pow(8,n),0),o=Math.pow(2,n*2),x=Math.pow(2,n);for(let C=0;C<s.length;C+=this.channels){let P=(s[C]>>a)*o+(s[C+1]>>a)*x+(s[C+2]>>a);t&&this.alpha?f[P]+=s[C+this.channels-1]/this.maxValue:f[P]++}return f}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)this.data[t+r]<e[r]&&(e[r]=this.data[t+r]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)this.data[t+r]>e[r]&&(e[r]=this.data[t+r]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray$1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)e[r]+=this.data[t+r];return e}function getMoment(e=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let r=0;for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.getBitXY(n,a)===1&&(r+=n**e*a**t);return r}function localMaxima(e={}){let{mask:t,region:r=3,removeClosePoints:n=0,invert:a=!1,maxEquals:s=2}=e,f=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),r*=4;let o=a?0:1,x=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],C=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],P=r<=8?1:2,Y=[];for(let ze=P;ze<f.height-P;ze++)for(let ge=P;ge<f.width-P;ge++){if(t&&t.getBitXY(ge,ze)!==o)continue;let Bt=0,Ur=0,kn=f.data[ge+ze*f.width];for(let Io=0;Io<r;Io++)a?f.data[ge+x[Io]+(ze+C[Io])*f.width]>kn&&Bt++:f.data[ge+x[Io]+(ze+C[Io])*f.width]<kn&&Bt++,f.data[ge+x[Io]+(ze+C[Io])*f.width]===kn&&Ur++;Bt+Ur===r&&Ur<=s&&Y.push([ge,ze])}if(n>0)for(let ze=0;ze<Y.length;ze++)for(let ge=ze+1;ge<Y.length;ge++)Math.sqrt(Math.pow(Y[ze][0]-Y[ge][0],2)+Math.pow(Y[ze][1]-Y[ge][1],2))<n&&(Y[ze][0]=Y[ze][0]+Y[ge][0]>>1,Y[ze][1]=Y[ze][1]+Y[ge][1]>>1,Y.splice(ge,1),ge--);return Y}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=mean$2(n)}return t}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=median$2(n)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let t=0;t<this.width;t++)for(let r=0;r<this.height;r++)this.getBitXY(t,r)===1&&e.push([t,r]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let t=0;t<this.height;t++)for(let r=0;r<this.width;r++)if(this.getBitXY(r,t)===1)for(e.push([r,t]),this.getBitXY(r+1,t)!==1?(e.push([r+1,t]),e.push([r+1,t+1]),this.getBitXY(r,t+1)!==1&&e.push([r,t+1])):this.getBitXY(r,t+1)!==1&&(e.push([r,t+1]),e.push([r+1,t+1]));r<this.width-2&&this.getBitXY(r+1,t)===1&&this.getBitXY(r+2,t)===1;)r++;return e}function getRelativePosition(e,t={}){if(this===e)return[0,0];let r=[0,0],n=this;for(;n;){if(n===e)return r;n.position&&(r[0]+=n.position[0],r[1]+=n.position[1]),n=n.parent}return t.defaultFurther?r:!1}function countAlphaPixels(e={}){let{alpha:t=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let r=0;if(t!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===t&&r++;return r}else return this.size}function monotoneChainConvexHull$1(e,t={}){const{sorted:r}=t;r||(e=e.slice().sort(byXThenY));const n=e.length,a=new Array(n*2);let s=0;for(let o=0;o<n;o++){const x=e[o];for(;s>=2&&cw(a[s-2],a[s-1],x)<=0;)s--;a[s++]=x}const f=s+1;for(let o=n-2;o>=0;o--){const x=e[o];for(;s>=f&&cw(a[s-2],a[s-1],x)<=0;)s--;a[s++]=x}return a.slice(0,s-1)}function cw(e,t,r){return(t[1]-e[1])*(r[0]-e[0])-(t[0]-e[0])*(r[1]-e[1])}function byXThenY(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let t=0;t<e.length;t++)e[t][0]=Math.round(e[t][0]),e[t][1]=Math.round(e[t][1]);return e}function difference(e,t){return[e[0]-t[0],e[1]-t[1]]}function normalize(e){let t=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/t,e[1]/t]}function rotate(e,t,r){r===void 0&&(r=new Array(t.length));let n=Math.cos(e),a=Math.sin(e);for(let s=0;s<r.length;++s)r[s]=[n*t[s][0]-a*t[s][1],a*t[s][0]+n*t[s][1]];return r}function perimeter(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r][0],a=e[r][1],s=e[r===e.length-1?0:r+1][0],f=e[r===e.length-1?0:r+1][1];t+=Math.sqrt((s-n)**2+(f-a)**2)}return t}function surface(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r][0],a=e[r===e.length-1?0:r+1][1],s=e[r===e.length-1?0:r+1][0],f=e[r][1];t+=n*a*.5,t-=s*f*.5}return Math.abs(t)}function minMax(e){let t=1/0,r=1/0,n=-1/0,a=-1/0;for(let s=0;s<e.length;s++)e[s][0]<t&&(t=e[s][0]),e[s][0]>n&&(n=e[s][0]),e[s][1]<r&&(r=e[s][1]),e[s][1]>a&&(a=e[s][1]);return[[t,r],[n,a]]}function moveToZeroZero(e,t){t===void 0&&(t=new Array(e.length).fill(0).map(()=>[]));let r=minMax(e),n=r[0][0],a=r[0][1];for(let s=0;s<e.length;s++)t[s][0]=e[s][0]-n,t[s][1]=e[s][1]-a;return t}function minimalBoundingRectangle(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const r=new Array(t.length);let n=1/0,a=0,s;for(let f=0;f<r.length;f++){let o=getAngle$1(t[f],t[(f+1)%r.length]);rotate(-o,t,r);let x=r[f][0],C=r[f][1],P=r[(f+1)%r.length][0],Y=r[(f+1)%r.length][1],ze=!0,ge=0,Bt=0,Ur=0;for(let Co=0;Co<r.length;Co++){let as=r[Co][0],$s=r[Co][1],ah=(as-x)/(P-x);ze===!0?(ze=!1,ge=ah,Bt=ah):(ah<ge&&(ge=ah),ah>Bt&&(Bt=ah));let ch=(-(P-x)*$s+P*C-Y*x)/(P-x);Math.abs(ch)>Math.abs(Ur)&&(Ur=ch)}let kn=[x+ge*(P-x),C],Io=[x+Bt*(P-x),C],rl=Math.abs(Ur*(ge-Bt)*(P-x));rl<n&&(a=o,n=rl,s=[kn,Io,[Io[0],Io[1]-Ur],[kn[0],kn[1]-Ur]])}return rotate(a,s,s),s}function getAngle$1(e,t){let r=difference(t,e),n=normalize(r),a=Math.acos(n[0]);return n[1]<0?-a:a}function extend$4(e){let t={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,t),e.extendMethod("add",add,t),e.extendMethod("subtract",subtract,t),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,t),e.extendMethod("divide",divide,t),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,t),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,t),e.extendMethod("paintMasks",paintMasks,t),e.extendMethod("paintPoints",paintPoints,t),e.extendMethod("paintPolyline",paintPolyline,t),e.extendMethod("paintPolylines",paintPolylines,t),e.extendMethod("paintPolygon",paintPolygon,t),e.extendMethod("paintPolygons",paintPolygons,t),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){function r(mh){return typeof mh=="string"||mh instanceof String}var n=Number.isFinite||window.isFinite;function a(mh){return n(mh)}function s(mh){return mh}function f(mh){var Jh={};return mh.filter(function(Wu){return Jh.hasOwnProperty(Wu)?!1:Jh[Wu]=!0})}function o(mh,Jh){if(Jh.length!==mh.length)return!1;for(var Wu=0;Wu<mh.length;Wu++)if(Jh[Wu].compareArray&&!Jh[Wu].compareArray(mh[Wu])||Jh[Wu]!==mh[Wu])return!1;return!0}function x(mh,Jh){Object.keys(Jh).forEach(function(Wu){mh[Wu]=Jh[Wu]})}function C(){for(var mh=1,Jh=0,Wu=0;Wu<arguments.length;Wu++){var sl=arguments[Wu];Jh=Jh+ze(sl),mh*=sl}return Jh!==0?Y(mh,Jh):mh}function P(mh,Jh){if(Jh===0)throw new Error("Divide by zero");var Wu=Math.pow(10,ze(Jh)),sl=Wu/(Wu*Jh);return C(mh,sl)}function Y(mh,Jh){return Math.round(mh*Math.pow(10,Jh))/Math.pow(10,Jh)}function ze(mh){if(!isFinite(mh))return 0;for(var Jh=0;mh%1!==0;)mh*=10,Jh++;return Jh}function ge(){var mh;if(!this)return mh=Object.create(ge.prototype),ge.apply(mh,arguments),mh;mh=Error.apply(this,arguments),this.name="QtyError",this.message=mh.message,this.stack=mh.stack}ge.prototype=Object.create(Error.prototype,{constructor:{value:ge}});function Bt(mh,Jh){throw new ge("Incompatible units: "+mh+" and "+Jh)}var Ur={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},kn=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],Io="<1>",rl=[Io];function Co(mh,Jh){var Wu=Jh[1],sl=Jh[3]||[],Gn=Jh[4]||[];if(!a(Wu))throw new ge(mh+": Invalid unit definition. 'scalar' must be a number");sl.forEach(function(_n){if(Ur[_n]===void 0)throw new ge(mh+": Invalid unit definition. Unit "+_n+" in 'numerator' is not recognized")}),Gn.forEach(function(_n){if(Ur[_n]===void 0)throw new ge(mh+": Invalid unit definition. Unit "+_n+" in 'denominator' is not recognized")})}var as={},$s={},ah={},ch={},Zu={};for(var ih in Ur)if(Ur.hasOwnProperty(ih)){var al=Ur[ih];if(al[2]==="prefix"){as[ih]=al[1];for(var sh=0;sh<al[0].length;sh++)$s[al[0][sh]]=ih}else{Co(ih,al),ah[ih]={scalar:al[1],numerator:al[3],denominator:al[4]};for(var _h=0;_h<al[0].length;_h++)ch[al[0][_h]]=ih}Zu[ih]=al[0][0]}function Ih(mh){var Jh,Wu=[],sl=Object.keys(Ur);if(typeof mh>"u")for(Jh=0;Jh<sl.length;Jh++)["","prefix"].indexOf(Ur[sl[Jh]][2])===-1&&Wu.push(sl[Jh].substr(1,sl[Jh].length-2));else{if(this.getKinds().indexOf(mh)===-1)throw new ge("Kind not recognized");for(Jh=0;Jh<sl.length;Jh++)Ur[sl[Jh]][2]===mh&&Wu.push(sl[Jh].substr(1,sl[Jh].length-2))}return Wu.sort(function(Gn,_n){return Gn.toLowerCase()<_n.toLowerCase()?-1:Gn.toLowerCase()>_n.toLowerCase()?1:0})}function Lh(mh){if(!ch[mh])throw new ge("Unit not recognized");return Ur[ch[mh]][0]}var Gh=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function ud(){if(this.signature)return this.signature;for(var mh=Tf.call(this),Jh=0;Jh<mh.length;Jh++)mh[Jh]*=Math.pow(20,Jh);return mh.reduce(function(Wu,sl){return Wu+sl},0)}function Tf(){if(!this.isBase())return Tf.call(this.toBase());for(var mh=new Array(Gh.length),Jh=0;Jh<mh.length;Jh++)mh[Jh]=0;for(var Wu,sl,Gn=0;Gn<this.numerator.length;Gn++)(Wu=Ur[this.numerator[Gn]])&&(sl=Gh.indexOf(Wu[2]),sl>=0&&(mh[sl]=mh[sl]+1));for(var _n=0;_n<this.denominator.length;_n++)(Wu=Ur[this.denominator[_n]])&&(sl=Gh.indexOf(Wu[2]),sl>=0&&(mh[sl]=mh[sl]-1));return mh}var Kd="[+-]",Af="\\d+",md=Kd+"?"+Af,vd="\\."+Af,qd="(?:"+Af+"(?:"+vd+")?)|(?:"+vd+")",Ed="[Ee]"+md,Sd="(?:"+qd+")(?:"+Ed+")?",zd=Kd+"?\\s*"+Sd,Md="("+zd+")?\\s*([^/]*)(?:/(.+))?",Gd=new RegExp("^"+Md+"$"),bf="\\^|\\*{2}",Id="[01234]",td=new RegExp("([^ \\*\\d]+?)(?:"+bf+")?(-?"+Id+"(?![a-zA-Z]))"),Fd=new RegExp("([^ \\*\\d]+?)(?:"+bf+")?("+Id+"(?![a-zA-Z]))");function rp(mh){r(mh)||(mh=mh.toString()),mh=mh.trim();var Jh=Gd.exec(mh);if(!Jh)throw new ge(mh+": Quantity not recognized");var Wu=Jh[1];Wu?(Wu=Wu.replace(/\s/g,""),this.scalar=parseFloat(Wu)):this.scalar=1;for(var sl=Jh[2],Gn=Jh[3],_n,cs,$u;Jh=td.exec(sl);){if(_n=parseFloat(Jh[2]),isNaN(_n))throw new ge("Unit exponent is not a number");if(_n===0&&!bp.test(Jh[1]))throw new ge("Unit not recognized");cs=Jh[1]+" ",$u="";for(var eh=0;eh<Math.abs(_n);eh++)$u+=cs;_n>=0?sl=sl.replace(Jh[0],$u):(Gn=Gn?Gn+$u:$u,sl=sl.replace(Jh[0],""))}for(;Jh=Fd.exec(Gn);){if(_n=parseFloat(Jh[2]),isNaN(_n))throw new ge("Unit exponent is not a number");if(_n===0&&!bp.test(Jh[1]))throw new ge("Unit not recognized");cs=Jh[1]+" ",$u="";for(var nh=0;nh<_n;nh++)$u+=cs;Gn=Gn.replace(Jh[0],$u)}sl&&(this.numerator=Yd(sl.trim())),Gn&&(this.denominator=Yd(Gn.trim()))}var jf=Object.keys($s).sort(function(mh,Jh){return Jh.length-mh.length}).join("|"),yd=Object.keys(ch).sort(function(mh,Jh){return Jh.length-mh.length}).join("|"),Jd="\\b|$",op="("+jf+")??("+yd+")(?:"+Jd+")",bp=new RegExp("^\\s*("+op+"[\\s\\*]*)+$"),fp=new RegExp(op,"g"),Qh={};function Yd(mh){var Jh=Qh[mh];if(Jh)return Jh;var Wu,sl=[];if(!bp.test(mh))throw new ge("Unit not recognized");for(;Wu=fp.exec(mh);)sl.push(Wu.slice(1));return sl=sl.map(function(Gn){return $s[Gn[0]]?[$s[Gn[0]],ch[Gn[1]]]:[ch[Gn[1]]]}),sl=sl.reduce(function(Gn,_n){return Gn.concat(_n)},[]),sl=sl.filter(function(Gn){return Gn}),Qh[mh]=sl,sl}function sd(mh){if(!r(mh))throw new ge("Argument should be a string");try{return this(mh)}catch{return null}}function Zd(mh){return mh instanceof Xh}function Xh(mh,Jh){if(Ld.apply(null,arguments),!Zd(this))return new Xh(mh,Jh);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=rl,this.denominator=rl,Kf(mh)?(this.scalar=mh.scalar,this.numerator=mh.numerator&&mh.numerator.length!==0?mh.numerator:rl,this.denominator=mh.denominator&&mh.denominator.length!==0?mh.denominator:rl):Jh?(rp.call(this,Jh),this.scalar=mh):rp.call(this,mh),this.denominator.join("*").indexOf("temp")>=0)throw new ge("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new ge("Cannot multiply by temperatures");if(!o(this.denominator,rl))throw new ge("Cannot divide with temperatures")}if(this.initValue=mh,If.call(this),this.isTemperature()&&this.baseScalar<0)throw new ge("Temperatures must not be less than absolute zero")}Xh.prototype={constructor:Xh};function Ld(mh,Jh){if(Jh){if(!(a(mh)&&r(Jh)))throw new ge("Only number accepted as initialization value when units are explicitly provided")}else if(!(r(mh)||a(mh)||Zd(mh)||Kf(mh)))throw new ge("Only string, number or quantity accepted as single initialization value")}function Kf(mh){return mh&&typeof mh=="object"&&mh.hasOwnProperty("scalar")}function If(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=ud.call(this);else{var mh=this.toBase();this.baseScalar=mh.scalar,this.signature=mh.signature}}var Df={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function Jf(){return f(Object.keys(Df).map(function(mh){return Df[mh]}))}Xh.prototype.kind=function(){return Df[this.signature.toString()]},x(Xh.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&o(this.denominator,rl)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Nf(mh,Jh){var Wu=mh.units(),sl=Jh.to(Wu),Gn=Xh(Sp(Wu));return Xh({scalar:mh.scalar-sl.scalar,numerator:Gn.numerator,denominator:Gn.denominator})}function Wf(mh,Jh){var Wu=Jh.to(Sp(mh.units()));return Xh({scalar:mh.scalar-Wu.scalar,numerator:mh.numerator,denominator:mh.denominator})}function Mp(mh,Jh){var Wu=Jh.to(Sp(mh.units()));return Xh({scalar:mh.scalar+Wu.scalar,numerator:mh.numerator,denominator:mh.denominator})}function Sp(mh){if(mh==="tempK")return"degK";if(mh==="tempC")return"degC";if(mh==="tempF")return"degF";if(mh==="tempR")return"degR";throw new ge("Unknown type for temp conversion from: "+mh)}function Pp(mh,Jh){var Wu=Yf(mh),sl=Jh.units(),Gn;if(sl==="degK")Gn=Wu.scalar;else if(sl==="degC")Gn=Wu.scalar;else if(sl==="degF")Gn=Wu.scalar*9/5;else if(sl==="degR")Gn=Wu.scalar*9/5;else throw new ge("Unknown type for degree conversion to: "+sl);return Xh({scalar:Gn,numerator:Jh.numerator,denominator:Jh.denominator})}function Yf(mh){var Jh=mh.units(),Wu;if(Jh.match(/(deg)[CFRK]/))Wu=mh.baseScalar;else if(Jh==="tempK")Wu=mh.scalar;else if(Jh==="tempC")Wu=mh.scalar;else if(Jh==="tempF")Wu=mh.scalar*5/9;else if(Jh==="tempR")Wu=mh.scalar*5/9;else throw new ge("Unknown type for temp conversion from: "+Jh);return Xh({scalar:Wu,numerator:["<kelvin>"],denominator:rl})}function qp(mh,Jh){var Wu=Jh.units(),sl;if(Wu==="tempK")sl=mh.baseScalar;else if(Wu==="tempC")sl=mh.baseScalar-273.15;else if(Wu==="tempF")sl=mh.baseScalar*9/5-459.67;else if(Wu==="tempR")sl=mh.baseScalar*9/5;else throw new ge("Unknown type for temp conversion to: "+Wu);return Xh({scalar:sl,numerator:Jh.numerator,denominator:Jh.denominator})}function sm(mh){var Jh=mh.units(),Wu;if(Jh.match(/(deg)[CFRK]/))Wu=mh.baseScalar;else if(Jh==="tempK")Wu=mh.scalar;else if(Jh==="tempC")Wu=mh.scalar+273.15;else if(Jh==="tempF")Wu=(mh.scalar+459.67)*5/9;else if(Jh==="tempR")Wu=mh.scalar*5/9;else throw new ge("Unknown type for temp conversion from: "+Jh);return Xh({scalar:Wu,numerator:["<temp-K>"],denominator:rl})}x(Xh.prototype,{to:function(mh){var Jh,Wu;if(mh==null)return this;if(!r(mh))return this.to(mh.units());if(Jh=this._conversionCache[mh],Jh)return Jh;if(Wu=Xh(mh),Wu.units()===this.units())return this;if(!this.isCompatible(Wu))this.isInverse(Wu)?Wu=this.inverse().to(mh):Bt(this.units(),Wu.units());else if(Wu.isTemperature())Wu=qp(this,Wu);else if(Wu.isDegrees())Wu=Pp(this,Wu);else{var sl=P(this.baseScalar,Wu.baseScalar);Wu=Xh({scalar:sl,numerator:Wu.numerator,denominator:Wu.denominator})}return this._conversionCache[mh]=Wu,Wu},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return sm(this);var mh=Op[this.units()];return mh||(mh=rm(this.numerator,this.denominator),Op[this.units()]=mh),mh.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new ge("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(mh){if(r(mh)&&(mh=Xh(mh)),a(mh)&&(mh=Xh(mh+" "+this.units())),this.isUnitless()?mh.isUnitless()||Bt(this.units(),mh.units()):mh=mh.to(this.units()),mh.scalar===0)throw new ge("Divide by zero");var Jh=C(Math.round(this.scalar/mh.scalar),mh.scalar);return Xh(Jh+this.units())}});function Xd(mh,Jh){var Wu=Xh(mh),sl=Xh(Jh);if(Wu.eq(sl))return s;var Gn;return Wu.isTemperature()?Gn=function(_n){return Wu.mul(_n).to(sl).scalar}:Gn=function(_n){return _n*Wu.baseScalar/sl.baseScalar},function(cs){var $u,eh,nh;if(Array.isArray(cs)){for(eh=cs.length,nh=[],$u=0;$u<eh;$u++)nh.push(Gn(cs[$u]));return nh}else return Gn(cs)}}var Op={};function rm(mh,Jh){for(var Wu=[],sl=[],Gn=1,_n,cs=0;cs<mh.length;cs++)_n=mh[cs],as[_n]?Gn=C(Gn,as[_n]):ah[_n]&&(Gn*=ah[_n].scalar,ah[_n].numerator&&Wu.push(ah[_n].numerator),ah[_n].denominator&&sl.push(ah[_n].denominator));for(var $u=0;$u<Jh.length;$u++)_n=Jh[$u],as[_n]?Gn/=as[_n]:ah[_n]&&(Gn/=ah[_n].scalar,ah[_n].numerator&&sl.push(ah[_n].numerator),ah[_n].denominator&&Wu.push(ah[_n].denominator));return Wu=Wu.reduce(function(eh,nh){return eh.concat(nh)},[]),sl=sl.reduce(function(eh,nh){return eh.concat(nh)},[]),Xh({scalar:Gn,numerator:Wu,denominator:sl})}Xh.parse=sd,Xh.getUnits=Ih,Xh.getAliases=Lh,Xh.mulSafe=C,Xh.divSafe=P,Xh.getKinds=Jf,Xh.swiftConverter=Xd,Xh.Error=ge,x(Xh.prototype,{add:function(mh){if(r(mh)&&(mh=Xh(mh)),this.isCompatible(mh)||Bt(this.units(),mh.units()),this.isTemperature()&&mh.isTemperature())throw new ge("Cannot add two temperatures");return this.isTemperature()?Mp(this,mh):mh.isTemperature()?Mp(mh,this):Xh({scalar:this.scalar+mh.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(mh){if(r(mh)&&(mh=Xh(mh)),this.isCompatible(mh)||Bt(this.units(),mh.units()),this.isTemperature()&&mh.isTemperature())return Nf(this,mh);if(this.isTemperature())return Wf(this,mh);if(mh.isTemperature())throw new ge("Cannot subtract a temperature from a differential degree unit");return Xh({scalar:this.scalar-mh.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(mh){if(a(mh))return Xh({scalar:C(this.scalar,mh),numerator:this.numerator,denominator:this.denominator});if(r(mh)&&(mh=Xh(mh)),(this.isTemperature()||mh.isTemperature())&&!(this.isUnitless()||mh.isUnitless()))throw new ge("Cannot multiply by temperatures");var Jh=this,Wu=mh;Jh.isCompatible(Wu)&&Jh.signature!==400&&(Wu=Wu.to(Jh));var sl=Sm(Jh.numerator,Jh.denominator,Wu.numerator,Wu.denominator);return Xh({scalar:C(Jh.scalar,Wu.scalar,sl[2]),numerator:sl[0],denominator:sl[1]})},div:function(mh){if(a(mh)){if(mh===0)throw new ge("Divide by zero");return Xh({scalar:this.scalar/mh,numerator:this.numerator,denominator:this.denominator})}else r(mh)&&(mh=Xh(mh));if(mh.scalar===0)throw new ge("Divide by zero");if(mh.isTemperature())throw new ge("Cannot divide with temperatures");if(this.isTemperature()&&!mh.isUnitless())throw new ge("Cannot divide with temperatures");var Jh=this,Wu=mh;Jh.isCompatible(Wu)&&Jh.signature!==400&&(Wu=Wu.to(Jh));var sl=Sm(Jh.numerator,Jh.denominator,Wu.denominator,Wu.numerator);return Xh({scalar:C(Jh.scalar,sl[2])/Wu.scalar,numerator:sl[0],denominator:sl[1]})},inverse:function(){if(this.isTemperature())throw new ge("Cannot divide with temperatures");if(this.scalar===0)throw new ge("Divide by zero");return Xh({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Sm(mh,Jh,Wu,sl){function Gn(Ph){return Ph!==Io}mh=mh.filter(Gn),Wu=Wu.filter(Gn),Jh=Jh.filter(Gn),sl=sl.filter(Gn);var _n={};function cs(Ph,zh){for(var Ad,wd,Qd,xf=0;xf<Ph.length;xf++)if(as[Ph[xf]]?(Ad=Ph[xf+1],wd=Ph[xf],Qd=as[wd],xf++):(Ad=Ph[xf],wd=null,Qd=1),Ad&&Ad!==Io)if(_n[Ad]){_n[Ad][0]+=zh;var zf=_n[Ad][2]?as[_n[Ad][2]]:1;_n[Ad][zh===1?3:4]*=P(Qd,zf)}else _n[Ad]=[zh,Ad,wd,1,1]}cs(mh,1),cs(Jh,-1),cs(Wu,1),cs(sl,-1);var $u=[],eh=[],nh=1;for(var uh in _n)if(_n.hasOwnProperty(uh)){var dh=_n[uh],vh;if(dh[0]>0)for(vh=0;vh<dh[0];vh++)$u.push(dh[2]===null?dh[1]:[dh[2],dh[1]]);else if(dh[0]<0)for(vh=0;vh<-dh[0];vh++)eh.push(dh[2]===null?dh[1]:[dh[2],dh[1]]);nh*=P(dh[3],dh[4])}return $u.length===0&&($u=rl),eh.length===0&&(eh=rl),$u=$u.reduce(function(Ph,zh){return Ph.concat(zh)},[]),eh=eh.reduce(function(Ph,zh){return Ph.concat(zh)},[]),[$u,eh,nh]}x(Xh.prototype,{eq:function(mh){return this.compareTo(mh)===0},lt:function(mh){return this.compareTo(mh)===-1},lte:function(mh){return this.eq(mh)||this.lt(mh)},gt:function(mh){return this.compareTo(mh)===1},gte:function(mh){return this.eq(mh)||this.gt(mh)},compareTo:function(mh){if(r(mh))return this.compareTo(Xh(mh));if(this.isCompatible(mh)||Bt(this.units(),mh.units()),this.baseScalar<mh.baseScalar)return-1;if(this.baseScalar===mh.baseScalar)return 0;if(this.baseScalar>mh.baseScalar)return 1},same:function(mh){return this.scalar===mh.scalar&&this.units()===mh.units()}}),x(Xh.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(mh){return o(mh,rl)})},isCompatible:function(mh){return r(mh)?this.isCompatible(Xh(mh)):Zd(mh)&&mh.signature!==void 0?this.signature===mh.signature:!1},isInverse:function(mh){return this.inverse().isCompatible(mh)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(mh){mh!==Io&&kn.indexOf(mh)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function hp(){}hp.prototype.get=function(mh){return arguments.length>1&&(mh=Array.apply(null,arguments)),mh.reduce(function(Jh,Wu,sl){if(Jh){var Gn=Jh[Wu];return sl===mh.length-1?Gn?Gn.data:void 0:Gn}},this)},hp.prototype.set=function(mh,Jh){return arguments.length>2&&(mh=Array.prototype.slice.call(arguments,0,-1),Jh=arguments[arguments.length-1]),mh.reduce(function(Wu,sl,Gn){var _n=Wu[sl];return _n===void 0&&(_n=Wu[sl]={}),Gn===mh.length-1?(_n.data=Jh,Jh):_n},this)};function Em(mh,Jh){return(mh+" "+Jh).trim()}Xh.formatter=Em,x(Xh.prototype,{units:function(){if(this._units!==void 0)return this._units;var mh=o(this.numerator,rl),Jh=o(this.denominator,rl);if(mh&&Jh)return this._units="",this._units;var Wu=lm(this.numerator),sl=lm(this.denominator);return this._units=Wu+(Jh?"":"/"+sl),this._units},toString:function(mh,Jh){var Wu;if(a(mh))Wu=this.units(),Jh=mh;else if(r(mh))Wu=mh;else if(Zd(mh))return this.toPrec(mh).toString(Jh);var sl=this.to(Wu),Gn=Jh!==void 0?Y(sl.scalar,Jh):sl.scalar;return sl=(Gn+" "+sl.units()).trim(),sl},format:function(mh,Jh){arguments.length===1&&typeof mh=="function"&&(Jh=mh,mh=void 0),Jh=Jh||Xh.formatter;var Wu=this.to(mh);return Jh.call(this,Wu.scalar,Wu.units())}});var Qp=new hp;function lm(mh){var Jh=Qp.get(mh);if(Jh)return Jh;var Wu=o(mh,rl);return Wu?Jh="1":Jh=Hf(Dd(mh)).join("*"),Qp.set(mh,Jh),Jh}function Dd(mh){for(var Jh=[],Wu,sl,Gn=0;Gn<mh.length;Gn++)Wu=mh[Gn],sl=mh[Gn+1],as[Wu]?(Jh.push(Zu[Wu]+Zu[sl]),Gn++):Jh.push(Zu[Wu]);return Jh}function Hf(mh){var Jh=mh.reduce(function(Wu,sl){var Gn=Wu[sl];return Gn||Wu.push(Gn=Wu[sl]=[sl,0]),Gn[1]++,Wu},[]);return Jh.map(function(Wu){return Wu[0]+(Wu[1]>1?Wu[1]:"")})}return Xh.version="1.7.6",Xh})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(e,t=""){let r=t.split(".");for(let n of r){if(e[n]===void 0)return;e=e[n]}return e}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(e,t,r){var n=e*t,a=SPLITTER*e,s=a-e,f=a-s,o=e-f,x=SPLITTER*t,C=x-t,P=x-C,Y=t-P,ze=n-f*P,ge=ze-o*P,Bt=ge-f*Y,Ur=o*Y-Bt;return r?(r[0]=Ur,r[1]=n,r):[Ur,n]}var robustSum=linearExpansionSum;function scalarScalar$1(e,t){var r=e+t,n=r-e,a=r-n,s=t-n,f=e-a,o=f+s;return o?[o,r]:[r]}function linearExpansionSum(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return scalarScalar$1(e[0],t[0]);var a=r+n,s=new Array(a),f=0,o=0,x=0,C=Math.abs,P=e[o],Y=C(P),ze=t[x],ge=C(ze),Bt,Ur;Y<ge?(Ur=P,o+=1,o<r&&(P=e[o],Y=C(P))):(Ur=ze,x+=1,x<n&&(ze=t[x],ge=C(ze))),o<r&&Y<ge||x>=n?(Bt=P,o+=1,o<r&&(P=e[o],Y=C(P))):(Bt=ze,x+=1,x<n&&(ze=t[x],ge=C(ze)));for(var kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,Co=rl,as=kn,$s,ah,ch,Zu,ih;o<r&&x<n;)Y<ge?(Bt=P,o+=1,o<r&&(P=e[o],Y=C(P))):(Bt=ze,x+=1,x<n&&(ze=t[x],ge=C(ze))),Ur=Co,kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,rl&&(s[f++]=rl),$s=as+kn,ah=$s-as,ch=$s-ah,Zu=kn-ah,ih=as-ch,Co=ih+Zu,as=$s;for(;o<r;)Bt=P,Ur=Co,kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,rl&&(s[f++]=rl),$s=as+kn,ah=$s-as,ch=$s-ah,Zu=kn-ah,ih=as-ch,Co=ih+Zu,as=$s,o+=1,o<r&&(P=e[o]);for(;x<n;)Bt=ze,Ur=Co,kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,rl&&(s[f++]=rl),$s=as+kn,ah=$s-as,ch=$s-ah,Zu=kn-ah,ih=as-ch,Co=ih+Zu,as=$s,x+=1,x<n&&(ze=t[x]);return Co&&(s[f++]=Co),as&&(s[f++]=as),f||(s[f++]=0),s.length=f,s}var twoSum$1=fastTwoSum;function fastTwoSum(e,t,r){var n=e+t,a=n-e,s=n-a,f=t-a,o=e-s;return r?(r[0]=o+f,r[1]=n,r):[o+f,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,t){var r=e.length;if(r===1){var n=twoProduct(e[0],t);return n[0]?n:[n[1]]}var a=new Array(2*r),s=[.1,.1],f=[.1,.1],o=0;twoProduct(e[0],t,s),s[0]&&(a[o++]=s[0]);for(var x=1;x<r;++x){twoProduct(e[x],t,f);var C=s[1];twoSum(C,f[0],s),s[0]&&(a[o++]=s[0]);var P=f[1],Y=s[1],ze=P+Y,ge=ze-P,Bt=Y-ge;s[1]=ze,Bt&&(a[o++]=Bt)}return s[1]&&(a[o++]=s[1]),o===0&&(a[o++]=0),a.length=o,a}var robustDiff=robustSubtract;function scalarScalar(e,t){var r=e+t,n=r-e,a=r-n,s=t-n,f=e-a,o=f+s;return o?[o,r]:[r]}function robustSubtract(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return scalarScalar(e[0],-t[0]);var a=r+n,s=new Array(a),f=0,o=0,x=0,C=Math.abs,P=e[o],Y=C(P),ze=-t[x],ge=C(ze),Bt,Ur;Y<ge?(Ur=P,o+=1,o<r&&(P=e[o],Y=C(P))):(Ur=ze,x+=1,x<n&&(ze=-t[x],ge=C(ze))),o<r&&Y<ge||x>=n?(Bt=P,o+=1,o<r&&(P=e[o],Y=C(P))):(Bt=ze,x+=1,x<n&&(ze=-t[x],ge=C(ze)));for(var kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,Co=rl,as=kn,$s,ah,ch,Zu,ih;o<r&&x<n;)Y<ge?(Bt=P,o+=1,o<r&&(P=e[o],Y=C(P))):(Bt=ze,x+=1,x<n&&(ze=-t[x],ge=C(ze))),Ur=Co,kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,rl&&(s[f++]=rl),$s=as+kn,ah=$s-as,ch=$s-ah,Zu=kn-ah,ih=as-ch,Co=ih+Zu,as=$s;for(;o<r;)Bt=P,Ur=Co,kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,rl&&(s[f++]=rl),$s=as+kn,ah=$s-as,ch=$s-ah,Zu=kn-ah,ih=as-ch,Co=ih+Zu,as=$s,o+=1,o<r&&(P=e[o]);for(;x<n;)Bt=ze,Ur=Co,kn=Bt+Ur,Io=kn-Bt,rl=Ur-Io,rl&&(s[f++]=rl),$s=as+kn,ah=$s-as,ch=$s-ah,Zu=kn-ah,ih=as-ch,Co=ih+Zu,as=$s,x+=1,x<n&&(ze=-t[x]);return Co&&(s[f++]=Co),as&&(s[f++]=as),f||(s[f++]=0),s.length=f,s}(function(e){var t=twoProduct_1,r=robustSum,n=robustScale,a=robustDiff,s=5,f=11102230246251565e-32,o=(3+16*f)*f,x=(7+56*f)*f;function C(Co,as,$s,ah){return function(Zu,ih,al){var sh=Co(Co(as(ih[1],al[0]),as(-al[1],ih[0])),Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0]))),_h=Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),Ih=ah(sh,_h);return Ih[Ih.length-1]}}function P(Co,as,$s,ah){return function(Zu,ih,al,sh){var _h=Co(Co($s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),ih[2]),Co($s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),-al[2]),$s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),sh[2]))),Co($s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),sh[2])))),Ih=Co(Co($s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),Zu[2]),Co($s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-al[2]),$s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),sh[2]))),Co($s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),al[2])))),Lh=ah(_h,Ih);return Lh[Lh.length-1]}}function Y(Co,as,$s,ah){return function(Zu,ih,al,sh,_h){var Ih=Co(Co(Co($s(Co($s(Co(as(sh[1],_h[0]),as(-_h[1],sh[0])),al[2]),Co($s(Co(as(al[1],_h[0]),as(-_h[1],al[0])),-sh[2]),$s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),_h[2]))),ih[3]),Co($s(Co($s(Co(as(sh[1],_h[0]),as(-_h[1],sh[0])),ih[2]),Co($s(Co(as(ih[1],_h[0]),as(-_h[1],ih[0])),-sh[2]),$s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),_h[2]))),-al[3]),$s(Co($s(Co(as(al[1],_h[0]),as(-_h[1],al[0])),ih[2]),Co($s(Co(as(ih[1],_h[0]),as(-_h[1],ih[0])),-al[2]),$s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),_h[2]))),sh[3]))),Co($s(Co($s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),ih[2]),Co($s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),-al[2]),$s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),sh[2]))),-_h[3]),Co($s(Co($s(Co(as(sh[1],_h[0]),as(-_h[1],sh[0])),ih[2]),Co($s(Co(as(ih[1],_h[0]),as(-_h[1],ih[0])),-sh[2]),$s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),_h[2]))),Zu[3]),$s(Co($s(Co(as(sh[1],_h[0]),as(-_h[1],sh[0])),Zu[2]),Co($s(Co(as(Zu[1],_h[0]),as(-_h[1],Zu[0])),-sh[2]),$s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),_h[2]))),-ih[3])))),Co(Co($s(Co($s(Co(as(ih[1],_h[0]),as(-_h[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],_h[0]),as(-_h[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),_h[2]))),sh[3]),Co($s(Co($s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),sh[2]))),-_h[3]),$s(Co($s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),ih[2]),Co($s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),-al[2]),$s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),sh[2]))),Zu[3]))),Co($s(Co($s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),Zu[2]),Co($s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-al[2]),$s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),sh[2]))),-ih[3]),Co($s(Co($s(Co(as(ih[1],sh[0]),as(-sh[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),sh[2]))),al[3]),$s(Co($s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),al[2]))),-sh[3]))))),Lh=Co(Co(Co($s(Co($s(Co(as(sh[1],_h[0]),as(-_h[1],sh[0])),al[2]),Co($s(Co(as(al[1],_h[0]),as(-_h[1],al[0])),-sh[2]),$s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),_h[2]))),Zu[3]),$s(Co($s(Co(as(sh[1],_h[0]),as(-_h[1],sh[0])),Zu[2]),Co($s(Co(as(Zu[1],_h[0]),as(-_h[1],Zu[0])),-sh[2]),$s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),_h[2]))),-al[3])),Co($s(Co($s(Co(as(al[1],_h[0]),as(-_h[1],al[0])),Zu[2]),Co($s(Co(as(Zu[1],_h[0]),as(-_h[1],Zu[0])),-al[2]),$s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),_h[2]))),sh[3]),$s(Co($s(Co(as(al[1],sh[0]),as(-sh[1],al[0])),Zu[2]),Co($s(Co(as(Zu[1],sh[0]),as(-sh[1],Zu[0])),-al[2]),$s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),sh[2]))),-_h[3]))),Co(Co($s(Co($s(Co(as(al[1],_h[0]),as(-_h[1],al[0])),ih[2]),Co($s(Co(as(ih[1],_h[0]),as(-_h[1],ih[0])),-al[2]),$s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),_h[2]))),Zu[3]),$s(Co($s(Co(as(al[1],_h[0]),as(-_h[1],al[0])),Zu[2]),Co($s(Co(as(Zu[1],_h[0]),as(-_h[1],Zu[0])),-al[2]),$s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),_h[2]))),-ih[3])),Co($s(Co($s(Co(as(ih[1],_h[0]),as(-_h[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],_h[0]),as(-_h[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),_h[2]))),al[3]),$s(Co($s(Co(as(ih[1],al[0]),as(-al[1],ih[0])),Zu[2]),Co($s(Co(as(Zu[1],al[0]),as(-al[1],Zu[0])),-ih[2]),$s(Co(as(Zu[1],ih[0]),as(-ih[1],Zu[0])),al[2]))),-_h[3])))),Gh=ah(Ih,Lh);return Gh[Gh.length-1]}}function ze(Co){var as=Co===3?C:Co===4?P:Y;return as(r,t,n,a)}var ge=ze(3),Bt=ze(4),Ur=[function(){return 0},function(){return 0},function(as,$s){return $s[0]-as[0]},function(as,$s,ah){var ch=(as[1]-ah[1])*($s[0]-ah[0]),Zu=(as[0]-ah[0])*($s[1]-ah[1]),ih=ch-Zu,al;if(ch>0){if(Zu<=0)return ih;al=ch+Zu}else if(ch<0){if(Zu>=0)return ih;al=-(ch+Zu)}else return ih;var sh=o*al;return ih>=sh||ih<=-sh?ih:ge(as,$s,ah)},function(as,$s,ah,ch){var Zu=as[0]-ch[0],ih=$s[0]-ch[0],al=ah[0]-ch[0],sh=as[1]-ch[1],_h=$s[1]-ch[1],Ih=ah[1]-ch[1],Lh=as[2]-ch[2],Gh=$s[2]-ch[2],ud=ah[2]-ch[2],Tf=ih*Ih,Kd=al*_h,Af=al*sh,md=Zu*Ih,vd=Zu*_h,qd=ih*sh,Ed=Lh*(Tf-Kd)+Gh*(Af-md)+ud*(vd-qd),Sd=(Math.abs(Tf)+Math.abs(Kd))*Math.abs(Lh)+(Math.abs(Af)+Math.abs(md))*Math.abs(Gh)+(Math.abs(vd)+Math.abs(qd))*Math.abs(ud),zd=x*Sd;return Ed>zd||-Ed>zd?Ed:Bt(as,$s,ah,ch)}];function kn(Co){var as=Ur[Co.length];return as||(as=Ur[Co.length]=ze(Co.length)),as.apply(void 0,Co)}function Io(Co,as,$s,ah,ch,Zu,ih){return function(sh,_h,Ih,Lh,Gh){switch(arguments.length){case 0:case 1:return 0;case 2:return ah(sh,_h);case 3:return ch(sh,_h,Ih);case 4:return Zu(sh,_h,Ih,Lh);case 5:return ih(sh,_h,Ih,Lh,Gh)}for(var ud=new Array(arguments.length),Tf=0;Tf<arguments.length;++Tf)ud[Tf]=arguments[Tf];return Co(ud)}}function rl(){for(;Ur.length<=s;)Ur.push(ze(Ur.length));e.exports=Io.apply(void 0,[kn].concat(Ur));for(var Co=0;Co<=s;++Co)e.exports[Co]=Ur[Co]}rl()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(e,t){for(var r=t[0],n=t[1],a=e.length,s=1,f=a,o=0,x=a-1;o<f;x=o++){var C=e[o],P=e[x],Y=C[1],ze=P[1];if(ze<Y){if(ze<n&&n<Y){var ge=orient(C,P,t);if(ge===0)return 0;s^=0<ge|0}else if(n===Y){var Bt=e[(o+1)%a],Ur=Bt[1];if(Y<Ur){var ge=orient(C,P,t);if(ge===0)return 0;s^=0<ge|0}}}else if(Y<ze){if(Y<n&&n<ze){var ge=orient(C,P,t);if(ge===0)return 0;s^=ge<0|0}else if(n===Y){var Bt=e[(o+1)%a],Ur=Bt[1];if(Ur<Y){var ge=orient(C,P,t);if(ge===0)return 0;s^=ge<0|0}}}else if(n===Y){var kn=Math.min(C[0],P[0]),Io=Math.max(C[0],P[0]);if(o===0){for(;x>0;){var rl=(x+a-1)%a,Co=e[rl];if(Co[1]!==n)break;var as=Co[0];kn=Math.min(kn,as),Io=Math.max(Io,as),x=rl}if(x===0)return kn<=r&&r<=Io?0:1;f=x+1}for(var $s=e[(x+a-1)%a][1];o+1<f;){var Co=e[o+1];if(Co[1]!==n)break;var as=Co[0];kn=Math.min(kn,as),Io=Math.max(Io,as),o+=1}if(kn<=r&&r<=Io)return 0;var ah=e[(o+1)%a][1];r<kn&&$s<n!=ah<n&&(s^=1)}}return 2*s-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const r=new Array(t.length);let n=1/0,a=0,s=[];for(let C=0;C<t.length;C++){let P=getAngle(t[C],t[(C+1)%t.length]);rotate(-P,t,r);let Y=0,ze=[];for(let ge=0;ge<t.length;ge++){let Bt=Math.abs(r[C][1]-r[ge][1]);Bt>Y&&(Y=Bt,ze=[],ze.push([r[ge][0],r[C][1]],[r[ge][0],r[ge][1]]))}Y<n&&(n=Y,a=P,s=ze)}rotate(a,s,s);let f=0,o=[],x=0;for(let C=0;C<t.length-1;C++)for(let P=C+1;P<t.length;P++){let Y=(t[C][0]-t[P][0])**2+(t[C][1]-t[P][1])**2;Y>x&&(x=Y,f=Math.sqrt(Y),o=[t[C],t[P]])}return{min:n,minLine:s,max:f,maxLine:o,aspectRatio:n/f}}function getAngle(e,t){let r=difference(t,e),n=normalize(r),a=Math.acos(n[0]);return n[1]<0?-a:a}class Roi{constructor(t,r){this.map=t,this.id=r,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:r=1,kind:n=""}=t;let a;switch(n){case"contour":a=this.contourMask;break;case"box":a=this.boxMask;break;case"filled":a=this.filledMask;break;case"center":a=this.centerMask;break;case"mbr":a=this.mbrFilledMask;break;case"hull":a=this.convexHullFilledMask;break;case"hullContour":a=this.convexHullMask;break;case"mbrContour":a=this.mbrMask;break;case"feret":a=this.feretMask;break;default:a=this.mask}return r<1&&(a=a.resize({factor:r}),a.parent=this.mask.parent,a.position[0]+=this.minX,a.position[1]+=this.minY),a}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,r=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let a=0;a<t.length;a++)n.includes(t[a])||(this.computed.externalIDs.push(t[a]),this.computed.externalLengths.push(r[a]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&n>0&&n<this.height-1?(this.map.data[r-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(r,n):t.setBitXY(r,n));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)t.setBitXY(r,0),t.setBitXY(r,this.height-1);for(let r=0;r<this.height;r++)t.setBitXY(0,r),t.setBitXY(this.width-1,r);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&t.setBitXY(r,n);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++){let a=r+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[a])&&t.setBitXY(r,n)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.map.data[n+this.minX+(a+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&a>0&&a<this.height-1?(this.map.data[n-1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a+1+this.minY)*this.map.width]!==this.id)&&(t.push([n,a]),t.push([n+1,a]),t.push([n,a+1]),t.push([n+1,a+1])):(t.push([n,a]),t.push([n+1,a]),t.push([n,a+1]),t.push([n+1,a+1])));const r=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:r,surface:surface(r),perimeter:perimeter(r)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,r=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=r}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(t.polyline,[n,a])!==1&&r.setBitXY(n,a);this.computed.convexHullFilledMask=r}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let r=t[0],n=t[1],a=t[2],s=Math.sqrt((r[0]-n[0])**2+(r[1]-n[1])**2),f=Math.sqrt((a[0]-n[0])**2+(a[1]-n[1])**2);this.computed.mbr={width:s,height:f,elongation:1-s/f,aspectRatio:s/f,surface:s*f,perimeter:(s+f)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,r=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-r*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const r=minMax(t),n=new Image$1(r[1][0]-r[0][0]+1,r[1][1]-r[0][1]+1,{kind:BINARY,position:[this.minX+r[0][0],this.minY+r[0][1]],parent:this.map.parent});t=moveToZeroZero(t),n.paintPolyline(t,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),r=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(r,[n,a])!==1&&t.setBitXY(n,a);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let a=(r+this.minY)*this.map.width+n+this.minX;this.map.data[a]===this.id&&t.push([n,r])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,r;const n=this.points;for(let a=0;a<n.length;a++)for(let s=a+1;s<n.length;s++){let f=Math.pow(n[a][0]-n[s][0],2)+Math.pow(n[a][1]-n[s][1],2);f>=t&&(t=f,r=[n[a],n[s]])}this.computed.maxLengthPoints=r}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,r=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=r}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let t=e.map,r=t.data,n=new Set,a=new Map,s=new Set,f=[1,0,-1,0],o=[0,1,0,-1];for(let P=e.minX;P<=e.maxX;P++)for(let Y=e.minY;Y<=e.maxY;Y++){let ze=P+Y*t.width;if(r[ze]===e.id)for(let ge=0;ge<4;ge++){let Bt=P+f[ge],Ur=Y+o[ge];if(Bt>=0&&Ur>=0&&Bt<t.width&&Ur<t.height){let kn=Bt+Ur*t.width;if(r[kn]!==e.id&&!s.has(kn)){s.add(kn),n.add(r[kn]);let Io=a.get(r[kn]);Io?a.set(r[kn],++Io):a.set(r[kn],1)}}}}let x=Array.from(n),C=x.map(function(P){return a.get(P)});return{ids:x,lengths:C}}function getBoxIDs(e){let t=new Set,r=e.map,n=r.data;for(let a of[0,e.height-1])for(let s=0;s<e.width;s++){let f=(a+e.minY)*r.width+s+e.minX;if(s-e.minX>0&&n[f]===e.id&&n[f-1]!==e.id){let o=n[f-1];t.add(o)}if(r.width-s-e.minX>1&&n[f]===e.id&&n[f+1]!==e.id){let o=n[f+1];t.add(o)}}for(let a of[0,e.width-1])for(let s=0;s<e.height;s++){let f=(s+e.minY)*r.width+a+e.minX;if(s-e.minY>0&&n[f]===e.id&&n[f-r.width]!==e.id){let o=n[f-r.width];t.add(o)}if(r.height-s-e.minY>1&&n[f]===e.id&&n[f+r.width]!==e.id){let o=n[f+r.width];t.add(o)}}return Array.from(t)}function getBox(e){let t=0,r=e.map,n=r.data,a=[0];e.height>1&&(a[1]=e.height-1);for(let f of a)for(let o=1;o<e.width-1;o++){let x=(f+e.minY)*r.width+o+e.minX;n[x]===e.id&&t++}let s=[0];e.width>1&&(s[1]=e.width-1);for(let f of s)for(let o=0;o<e.height;o++){let x=(o+e.minY)*r.width+f+e.minX;n[x]===e.id&&t++}return t}function getBorder(e){let t=0,r=e.map,n=r.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let f=(s+e.minY)*r.width+a+e.minX;n[f]===e.id&&(n[f-1]!==e.id||n[f+1]!==e.id||n[f-r.width]!==e.id||n[f+r.width]!==e.id)&&t++}return t+e.box}function getPerimeterInfo(e){let t=e.map,r=t.data,n=0,a=0,s=0,f=0;for(let o=0;o<e.width;o++)for(let x=0;x<e.height;x++){let C=(x+e.minY)*t.width+o+e.minX;if(r[C]===e.id){let P=0;switch((o===0||e.externalIDs.includes(r[C-1]))&&P++,(o===e.width-1||e.externalIDs.includes(r[C+1]))&&P++,(x===0||e.externalIDs.includes(r[C-t.width]))&&P++,(x===e.height-1||e.externalIDs.includes(r[C+t.width]))&&P++,P){case 1:n++;break;case 2:a++;break;case 3:s++;break;case 4:f++;break}}}return{one:n,two:a,three:s,four:f}}function getExternal(e){let t=0,r=e.map,n=r.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let f=(s+e.minY)*r.width+a+e.minX;n[f]===e.id&&(e.externalIDs.includes(n[f-1])||e.externalIDs.includes(n[f+1])||e.externalIDs.includes(n[f-r.width])||e.externalIDs.includes(n[f+r.width]))&&t++}return t+e.box}function getHolesInfo(e){let t=0,r=e.map.width,n=e.map.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let f=(s+e.minY)*r+a+e.minX;e.internalIDs.includes(n[f])&&n[f]!==e.id&&t++}return{number:e.internalIDs.length-1,surface:t}}function getInternalIDs(e){let t=[e.id],r=e.map,n=r.data;if(e.height>2)for(let s=0;s<e.width;s++){let f=e.minY*r.width+s+e.minX;if(t.includes(n[f])){let o=n[f+r.width];!t.includes(o)&&!e.boxIDs.includes(o)&&t.push(o)}}let a=new Array(4);for(let s=1;s<e.width-1;s++)for(let f=1;f<e.height-1;f++){let o=(f+e.minY)*r.width+s+e.minX;if(t.includes(n[o])){a[0]=n[o-1],a[1]=n[o+1],a[2]=n[o-r.width],a[3]=n[o+r.width];for(let x=0;x<4;x++){let C=a[x];!t.includes(C)&&!e.boxIDs.includes(C)&&t.push(C)}}}return t}class RoiLayer{constructor(t,r){this.roiMap=t,this.options=r,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,r={};this.roiMap.positive=0,this.roiMap.negative=0;for(let o=0;o<t.length;o++)t[o]&&!r[t[o]]&&(r[t[o]]=!0,t[o]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let o in r)n[o]=new Roi(this.roiMap,o*1);let a=this.roiMap.width,s=this.roiMap.height;for(let o=0;o<s;o++)for(let x=0;x<a;x++){let C=o*a+x;if(t[C]!==0){const P=t[C],Y=n[P];x<Y.minX&&(Y.minX=x),x>Y.maxX&&(Y.maxX=x),o<Y.minY&&(Y.minY=o),o>Y.maxY&&(Y.maxY=o),Y.meanX+=x,Y.meanY+=o,Y.surface++}}let f=[];for(let o in r)n[o].meanX/=n[o].surface,n[o].meanY/=n[o].surface,f.push(n[o]);return f}}function commonBorderLength(e){let t=e.data,r=[1,0,-1,0],n=[0,1,0,-1],a=e.minMax,s=-a.min,f=a.max+s,o=[];for(let C=0;C<=f;C++)o.push(Object.create(null));for(let C=0;C<e.width;C++)for(let P=0;P<e.height;P++){let Y=C+P*e.width,ze=t[Y];if(ze!==0){let ge=Object.create(null),Bt=!1;for(let Ur=0;Ur<4;Ur++){let kn=C+r[Ur],Io=P+n[Ur];if(kn>=0&&Io>=0&&kn<e.width&&Io<e.height){let rl=t[kn+Io*e.width];ze!==rl&&(Bt=!0,rl!==0&&ge[rl]===void 0&&(ge[rl]=!0,o[rl+s][ze]?o[rl+s][ze]++:o[rl+s][ze]=1))}else Bt=!0}Bt&&(o[ze+s][ze]?o[ze+s][ze]++:o[ze+s][ze]=1)}}let x={};for(let C=0;C<o.length;C++)Object.keys(o[C]).length>0&&(x[C-s]=o[C]);return x}function mergeRoi(e={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:r=5,maxCommonBorderLength:n=100,minCommonBorderRatio:a=.3,maxCommonBorderRatio:s=1}=e;let f=function(kn,Io,rl){return kn[rl]>=r&&kn[rl]<=n};typeof t=="function"&&(f=t),t.toLowerCase()==="commonborderratio"&&(f=function(kn,Io,rl){let Co=Math.min(kn[rl]/kn[Io],1);return Co>=a&&Co<=s});const o=this,x=o.commonBorderLength;let C={},P={};for(let kn of Object.keys(x)){let Io=x[kn],rl=Object.keys(Io);for(let Co of rl)if(Co!==kn&&f(Io,kn,Co)){let as=Co;P[Co]&&(as=P[Co]);let $s=kn;if(P[kn]&&($s=P[kn]),Number(as)!==$s){let ah=Math.min(as,$s),ch=Math.max(as,$s);if(C[ah]||(C[ah]={}),C[ah][ch]=!0,P[ch]=ah,C[ch]){for(let Zu of Object.keys(C[ch]))C[ah][Zu]=!0,P[Zu]=ah;delete C[ch]}}}}let Y=o.minMax,ze=-Y.min,ge=Y.max+ze,Bt=new Array(ge+1).fill(0);for(let kn of Object.keys(P))Bt[Number(kn)+ze]=P[kn];let Ur=o.data;for(let kn=0;kn<Ur.length;kn++){let Io=Ur[kn];if(Io!==0){let rl=Bt[Io+ze];rl!==0&&(Ur[kn]=rl)}}return o.computed={},o}class RoiMap{constructor(t,r){this.parent=t,this.width=t.width,this.height=t.height,this.data=r,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<t&&(t=this.data[n]),this.data[n]>r&&(r=this.data[n]);return{min:t,max:r}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const r=t[0],n=t.slice(1);for(let a=0;a<this.data.length;a++)n.includes(this.data[a])&&(this.data[a]=r)}rowsInfo(){let t=new Array(this.height),r=0;for(let n=0;n<this.data.length;n+=this.width){let a={row:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[r++]=a;let s={},f={},o=[],x=this.data[n],C=0;for(let P=n;P<n+this.width;P++){let Y=this.data[P];x!==Y&&(x=Y,o.push(C),C=0),C++,Y>0?(a.positivePixel++,s[Y]||(s[Y]=!0)):Y<0?(a.negativePixel++,f[Y]||(f[Y]=!0)):a.zeroPixel++}o.push(C),a.medianChange=o.sort((P,Y)=>P-Y)[Math.floor(o.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(f),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),r=0;for(let n=0;n<this.width;n++){let a={col:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[r++]=a;let s={},f={},o=[],x=this.data[n],C=0;for(let P=n;P<n+this.data.length;P+=this.width){let Y=this.data[P];x!==Y&&(x=Y,o.push(C),C=0),C++,Y>0?(a.positivePixel++,s[Y]||(s[Y]=!0)):Y<0?(a.negativePixel++,f[Y]||(f[Y]=!0)):a.zeroPixel++}o.push(C),a.medianChange=o.sort((P,Y)=>P-Y)[Math.floor(o.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(f),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return t}}function fromMask(e,t={}){const{allowCorners:r=!1}=t,n=65535;let a=new Int16Array(e.size),s=0,f=0,o=new Uint16Array(n+1),x=new Uint16Array(n+1);for(let P=0;P<e.width;P++)for(let Y=0;Y<e.height;Y++)a[Y*e.width+P]===0&&C(P,Y);function C(P,Y){let ze=0,ge=0,Bt=e.getBitXY(P,Y),Ur=Bt?++s:--f;if(s>32767||f<-32768)throw new Error("Too many regions of interest");for(o[0]=P,x[0]=Y;ze<=ge;){let kn=o[ze&n],Io=x[ze&n];if(a[Io*e.width+kn]=Ur,kn>0&&a[Io*e.width+kn-1]===0&&e.getBitXY(kn-1,Io)===Bt&&(ge++,o[ge&n]=kn-1,x[ge&n]=Io,a[Io*e.width+kn-1]=-32768),Io>0&&a[(Io-1)*e.width+kn]===0&&e.getBitXY(kn,Io-1)===Bt&&(ge++,o[ge&n]=kn,x[ge&n]=Io-1,a[(Io-1)*e.width+kn]=-32768),kn<e.width-1&&a[Io*e.width+kn+1]===0&&e.getBitXY(kn+1,Io)===Bt&&(ge++,o[ge&n]=kn+1,x[ge&n]=Io,a[Io*e.width+kn+1]=-32768),Io<e.height-1&&a[(Io+1)*e.width+kn]===0&&e.getBitXY(kn,Io+1)===Bt&&(ge++,o[ge&n]=kn,x[ge&n]=Io+1,a[(Io+1)*e.width+kn]=-32768),r&&(kn>0&&Io>0&&a[(Io-1)*e.width+kn-1]===0&&e.getBitXY(kn-1,Io-1)===Bt&&(ge++,o[ge&n]=kn-1,x[ge&n]=Io-1,a[(Io-1)*e.width+kn-1]=-32768),kn<e.width-1&&Io>0&&a[(Io-1)*e.width+kn+1]===0&&e.getBitXY(kn+1,Io-1)===Bt&&(ge++,o[ge&n]=kn+1,x[ge&n]=Io-1,a[(Io-1)*e.width+kn+1]=-32768),kn>0&&Io<e.height-1&&a[(Io+1)*e.width+kn-1]===0&&e.getBitXY(kn-1,Io+1)===Bt&&(ge++,o[ge&n]=kn-1,x[ge&n]=Io+1,a[(Io+1)*e.width+kn-1]=-32768),kn<e.width-1&&Io<e.height-1&&a[(Io+1)*e.width+kn+1]===0&&e.getBitXY(kn+1,Io+1)===Bt&&(ge++,o[ge&n]=kn+1,x[ge&n]=Io+1,a[(Io+1)*e.width+kn+1]=-32768)),ze++,ge-ze>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,a)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var r=this.nodes.get(t);return r||(r=new DisjointSetNode(t),this.nodes.set(t,r)),r}union(t,r){const n=this.find(t),a=this.find(r);n!==a&&(n.rank<a.rank?n.parent=a:n.rank>a.rank?a.parent=n:(a.parent=n,n.rank++))}find(t){for(var r=t;r.parent!==null;)r=r.parent;for(var n=t;n.parent!==null;){var a=n;n=n.parent,a.parent=r}return r}connected(t,r){return this.find(t)===this.find(r)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(e){this.value=e,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,t={}){const{allowCorners:r=!1}=t;let n=4;r&&(n=8);let a,s,f;if(n===8)a=direction8X,s=direction8Y,f=neighbours8;else if(n===4)a=direction4X,s=direction4Y,f=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const o=e.size,x=e.width,C=e.height,P=new Array(o),Y=new Uint32Array(o),ze=new DisjointSet$1;let ge=1;for(let Bt=0;Bt<C;Bt++)for(let Ur=0;Ur<x;Ur++){const kn=Ur+Bt*x;if(e.getBit(kn)){let Io=null;for(let rl=0;rl<f.length;rl++){const Co=Ur+a[rl],as=Bt+s[rl];if(Co>=0&&as>=0&&Co<x&&as<C){const $s=Co+as*x;let ah=P[$s];ah?(f[rl]=ah,(!Io||f[rl].value<Io.value)&&(Io=f[rl])):f[rl]=null}}if(!Io)P[kn]=ze.add(ge++);else{P[kn]=Io;for(let rl=0;rl<f.length;rl++)f[rl]&&f[rl]!==Io&&ze.union(Io,f[rl])}}}for(let Bt=0;Bt<C;Bt++)for(let Ur=0;Ur<x;Ur++){const kn=Ur+Bt*x;e.getBit(kn)&&(Y[kn]=ze.find(P[kn]).value)}return new RoiMap(e,Y)}function fromMaxima(e={}){let{allowCorner:t=!0,onlyTop:r=!1,invert:n=!1}=e,a=this;a.checkProcessable("fromMaxima",{components:[1]});const s=1,f=2;let o=0,x=0,C=new Int16Array(a.size),P=new Int8Array(a.size),Y=new Float32Array(a.size),ze=1048575,ge=new Uint16Array(ze+1),Bt=new Uint16Array(ze+1),Ur=0,kn=0,Io=new Uint16Array(ze+1),rl=new Uint16Array(ze+1),Co=0,as=0;for($s(a);Ur<kn;){let Zu=ge[Ur&ze],ih=Bt[Ur&ze];ch(Zu,ih,f),Ur++}return new RoiMap(a,C);function $s({maxima:Zu=!0}){for(let ih=1;ih<a.height-1;ih++)for(let al=1;al<a.width-1;al++){let sh=al+ih*a.width;if(P[sh]===0){let _h=Zu?a.data[sh]:-a.data[al+ih*a.width];if(a.data[ih*a.width+al-1]>_h||a.data[ih*a.width+al+1]>_h||a.data[(ih-1)*a.width+al]>_h||a.data[(ih+1)*a.width+al]>_h||t&&(a.data[(ih-1)*a.width+al-1]>_h||a.data[(ih-1)*a.width+al+1]>_h||a.data[(ih+1)*a.width+al-1]>_h||a.data[(ih+1)*a.width+al+1]>_h))continue;C[sh]=Zu?++o:--x,ah(al,ih)||(Zu?--o:++x)}}}function ah(Zu,ih){let al=kn;Co=0,as=1,Io[0]=Zu,rl[0]=ih;let sh=!0;for(;Co<as;){let _h=Io[Co&ze],Ih=rl[Co&ze];sh&=ch(_h,Ih,s),Co++}if(!sh){for(let _h=0;_h<as;_h++){let Ih=Io[_h&ze],Gh=rl[_h&ze]*a.width+Ih;C[Gh]=0}kn=al}return sh}function ch(Zu,ih,al){let sh=C[ih*a.width+Zu],_h=a.data[ih*a.width+Zu];for(let Ih=ih-1;Ih<=ih+1;Ih++)for(let Lh=Zu-1;Lh<=Zu+1;Lh++){let Gh=Ih*a.width+Lh;if(P[Gh]===0)switch(P[Gh]=1,Y[Gh]=a.data[Gh]-_h,al){case s:if(Y[Gh]===0){if(Lh===0||Ih===0||Lh===a.width-1||Ih===a.height-1)return!1;C[Gh]=sh,Io[as&ze]=Lh,rl[as&ze]=Ih,as++}else{if(Y[Gh]>0)return!1;r||(C[Gh]=sh,ge[kn&ze]=Lh,Bt[kn&ze]=Ih,kn++)}break;case f:Y[Gh]<=0&&(C[Gh]=sh,ge[kn&ze]=Lh,Bt[kn&ze]=Ih,kn++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,t={}){let r=new Shape(t),n=new Int16Array(this.size),a=0,s=r.getPoints();for(let f=0;f<e.length;f++){a++;let o=e[f][0],x=e[f][1];for(let C=0;C<s.length;C++){let P=s[C][0],Y=s[C][1];o+P>=0&&x+Y>=0&&o+P<this.width&&x+Y<this.height&&(n[o+P+(x+Y)*this.width]=a)}}return new RoiMap(this,n)}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,a,s){function f(C,P){if(!a[C]){if(!n[C]){var Y=typeof commonjsRequire=="function"&&commonjsRequire;if(!P&&Y)return Y(C,!0);if(o)return o(C,!0);var ze=new Error("Cannot find module '"+C+"'");throw ze.code="MODULE_NOT_FOUND",ze}var ge=a[C]={exports:{}};n[C][0].call(ge.exports,function(Bt){var Ur=n[C][1][Bt];return f(Ur||Bt)},ge,ge.exports,r,n,a,s)}return a[C].exports}for(var o=typeof commonjsRequire=="function"&&commonjsRequire,x=0;x<s.length;x++)f(s[x]);return f}({1:[function(r,n,a){var s,f,o,x,C,P=function(ze,ge){for(var Bt in ge)Y.call(ge,Bt)&&(ze[Bt]=ge[Bt]);function Ur(){this.constructor=ze}return Ur.prototype=ge.prototype,ze.prototype=new Ur,ze.__super__=ge.prototype,ze},Y={}.hasOwnProperty;s=r("./PriorityQueue/AbstractPriorityQueue"),f=r("./PriorityQueue/ArrayStrategy"),x=r("./PriorityQueue/BinaryHeapStrategy"),o=r("./PriorityQueue/BHeapStrategy"),C=function(ze){P(ge,ze);function ge(Bt){Bt||(Bt={}),Bt.strategy||(Bt.strategy=x),Bt.comparator||(Bt.comparator=function(Ur,kn){return(Ur||0)-(kn||0)}),ge.__super__.constructor.call(this,Bt)}return ge}(s),C.ArrayStrategy=f,C.BinaryHeapStrategy=x,C.BHeapStrategy=o,n.exports=C},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(r,n,a){n.exports=function(){function s(f){var o;if(f?.strategy==null)throw"Must pass options.strategy, a strategy";if(f?.comparator==null)throw"Must pass options.comparator, a comparator";this.priv=new f.strategy(f),this.length=(f!=null&&(o=f.initialValues)!=null?o.length:void 0)||0}return s.prototype.queue=function(f){this.length++,this.priv.queue(f)},s.prototype.dequeue=function(f){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(f){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(r,n,a){var s;s=function(f,o,x){var C,P,Y;for(P=0,C=f.length;P<C;)Y=P+C>>>1,x(f[Y],o)>=0?P=Y+1:C=Y;return P},n.exports=function(){function f(o){var x;this.options=o,this.comparator=this.options.comparator,this.data=((x=this.options.initialValues)!=null?x.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return f.prototype.queue=function(o){var x;x=s(this.data,o,this.comparator),this.data.splice(x,0,o)},f.prototype.dequeue=function(){return this.data.pop()},f.prototype.peek=function(){return this.data[this.data.length-1]},f.prototype.clear=function(){this.data.length=0},f}()},{}],4:[function(r,n,a){n.exports=function(){function s(f){var o,x,C,P,Y,ze,ge,Bt;for(this.comparator=f?.comparator||function(Ur,kn){return Ur-kn},this.pageSize=f?.pageSize||512,this.length=0,ge=0;1<<ge<this.pageSize;)ge+=1;if(1<<ge!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=ge,this._emptyMemoryPageTemplate=o=[],x=0,Y=this.pageSize;0<=Y?x<Y:x>Y;0<=Y?++x:--x)o.push(null);if(this._memory=[],this._mask=this.pageSize-1,f.initialValues)for(ze=f.initialValues,C=0,P=ze.length;C<P;C++)Bt=ze[C],this.queue(Bt)}return s.prototype.queue=function(f){this.length+=1,this._write(this.length,f),this._bubbleUp(this.length,f)},s.prototype.dequeue=function(){var f,o;return f=this._read(1),o=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,o),this._bubbleDown(1,o)),f},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(f,o){var x;for(x=f>>this._shift;x>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[x][f&this._mask]=o},s.prototype._read=function(f){return this._memory[f>>this._shift][f&this._mask]},s.prototype._bubbleUp=function(f,o){var x,C,P,Y;for(x=this.comparator;f>1&&(C=f&this._mask,f<this.pageSize||C>3?P=f&~this._mask|C>>1:C<2?(P=f-this.pageSize>>this._shift,P+=P&~(this._mask>>1),P|=this.pageSize>>1):P=f-2,Y=this._read(P),!(x(Y,o)<0));)this._write(P,o),this._write(f,Y),f=P},s.prototype._bubbleDown=function(f,o){var x,C,P,Y,ze;for(ze=this.comparator;f<this.length;)if(f>this._mask&&!(f&this._mask-1)?x=C=f+2:f&this.pageSize>>1?(x=(f&~this._mask)>>1,x|=f&this._mask>>1,x=x+1<<this._shift,C=x+1):(x=f+(f&this._mask),C=x+1),x!==C&&C<=this.length)if(P=this._read(x),Y=this._read(C),ze(P,o)<0&&ze(P,Y)<=0)this._write(x,o),this._write(f,P),f=x;else if(ze(Y,o)<0)this._write(C,o),this._write(f,Y),f=C;else break;else if(x<=this.length)if(P=this._read(x),ze(P,o)<0)this._write(x,o),this._write(f,P),f=x;else break;else break},s}()},{}],5:[function(r,n,a){n.exports=function(){function s(f){var o;this.comparator=f?.comparator||function(x,C){return x-C},this.length=0,this.data=((o=f.initialValues)!=null?o.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var f,o,x;if(this.data.length>0)for(f=o=1,x=this.data.length;1<=x?o<x:o>x;f=1<=x?++o:--o)this._bubbleUp(f)},s.prototype.queue=function(f){this.data.push(f),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var f,o;return o=this.data[0],f=this.data.pop(),this.data.length>0&&(this.data[0]=f,this._bubbleDown(0)),o},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(f){for(var o,x;f>0&&(o=f-1>>>1,this.comparator(this.data[f],this.data[o])<0);)x=this.data[o],this.data[o]=this.data[f],this.data[f]=x,f=o},s.prototype._bubbleDown=function(f){var o,x,C,P,Y;for(o=this.data.length-1;x=(f<<1)+1,P=x+1,C=f,x<=o&&this.comparator(this.data[x],this.data[C])<0&&(C=x),P<=o&&this.comparator(this.data[P],this.data[C])<0&&(C=P),C!==f;)Y=this.data[C],this.data[C]=this.data[f],this.data[f]=Y,f=C},s}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:t,mask:r,image:n,fillMaxValue:a=this.maxValue,invert:s=!1}=e,f=n||this;f.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,t||(t=f.getLocalMaxima({invert:s,mask:r}));let o=s?0:1,x=new Int16Array(f.size),C=f.width,P=f.height,Y=new PriorityQueue({comparator:(ze,ge)=>ze[2]-ge[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let ze=0;ze<t.length;ze++){let ge=t[ze][0]+t[ze][1]*C;x[ge]=ze+1;let Bt=f.data[ge];(s&&Bt<=a||!s&&Bt>=a)&&Y.queue([t[ze][0],t[ze][1],Bt])}for(;Y.length>0;){let ze=Y.dequeue(),ge=ze[0]+ze[1]*C;for(let Bt=0;Bt<4;Bt++){let Ur=ze[0]+dxs[Bt],kn=ze[1]+dys[Bt];if(Ur>=0&&kn>=0&&Ur<C&&kn<P){let Io=Ur+kn*C;if(!r||r.getBit(Io)===o){let rl=f.data[Io];(s&&rl<=a||!s&&rl>=a)&&x[Io]===0&&(x[Io]=x[ge],Y.queue([ze[0]+dxs[Bt],ze[1]+dys[Bt],rl]))}}}}return new RoiMap(f,x)}class RoiManager{constructor(t,r={}){this._image=t,this._options=r,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let r=Object.assign({},this._options,t),n=fromMaxima.call(this._image,t);this._layers[r.label]=new RoiLayer(n,r)}fromPoints(t,r={}){let n=Object.assign({},this._options,r),a=fromPoints.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}putMap(t,r={}){let n=new RoiMap(this._image,t),a=Object.assign({},this._options,r);return this._layers[a.label]=new RoiLayer(n,a),this}fromWaterShed(t={}){let r=Object.assign({},this._options,t),n=fromWaterShed.call(this._image,t);this._layers[r.label]=new RoiLayer(n,r)}fromMask(t,r={}){let n=Object.assign({},this._options,r),a=fromMask.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}fromMaskConnectedComponentLabelingAlgorithm(t,r={}){let n=Object.assign({},this._options,r),a=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}getMap(t={}){let r=Object.assign({},this._options,t);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let r=this.getRois(t);if(r){let n=new Array(r.length);for(let a=0;a<r.length;a++)n[a]=r[a].id;return n}throw new Error("ROIs not found")}getRois(t={}){let{label:r=this._options.label,positive:n=!0,negative:a=!0,minSurface:s=0,maxSurface:f=Number.POSITIVE_INFINITY,minWidth:o=0,maxWidth:x=Number.POSITIVE_INFINITY,minHeight:C=0,maxHeight:P=Number.POSITIVE_INFINITY,minRatio:Y=0,maxRatio:ze=Number.POSITIVE_INFINITY}=t;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const ge=this._layers[r].roi,Bt=[];for(const Ur of ge)(Ur.id<0&&a||Ur.id>0&&n)&&Ur.surface>=s&&Ur.surface<=f&&Ur.width>=o&&Ur.width<=x&&Ur.height>=C&&Ur.height<=P&&Ur.ratio>=Y&&Ur.ratio<=ze&&Bt.push(Ur);return Bt}getRoi(t,r={}){const{label:n=this._options.label}=r;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const a=this._layers[n].roi.find(s=>s.id===t);if(!a)throw new Error(`found no Roi with id ${t}`);return a}getMasks(t={}){let r=this.getRois(t),n=new Array(r.length);for(let a=0;a<r.length;a++)n[a]=r[a].getMask(t);return n}getAnalysisMasks(t={}){const{analysisProperty:r}=t;let n=`${r}Mask`,a=this.getRois(t);return a.length===0||!a[0][n]?[]:a.map(s=>s[n])}getData(t={}){let r=Object.assign({},this._options,t);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap.data}paint(t={}){let{labelProperty:r,analysisProperty:n}=t;this._painted||(this._painted=this._image.rgba8());let a=this.getMasks(t);if(r){const s=this.getRois(t);t.labels=s.map(C=>deepValue(C,r));const f=Math.max(...t.labels);let o=!1,x=!1;if(r.includes("surface")?o=!0:/(?:perimeter|min|max|external|width|height|length)/.test(r)&&(x=!0),isFinite(f)){let C="";if(t.unit!=="pixel"&&t.pixelSize&&(x||o)){C=o?`${t.unit}^2`:t.unit;let P=o?"m^2":"m",Y=o?t.pixelSize**2:t.pixelSize;const ze=Qty.swiftConverter(P,C);t.labels=t.labels.map(ge=>ze(Y*ge))}f>50?t.labels=t.labels.map(P=>Math.round(P)+C):f>10?t.labels=t.labels.map(P=>P.toFixed(1)+C):t.labels=t.labels.map(P=>P.toFixed(2)+C)}t.labelsPosition=s.map(C=>[C.meanX,C.meanY])}if(this._painted.paintMasks(a,t),n){let s=this.getAnalysisMasks(t);this._painted.paintMasks(s,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let r=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(t);for(let a=0;a<n.length;a++){let s=n[a];for(let f=0;f<s.width;f++)for(let o=0;o<s.height;o++)s.getBitXY(f,o)&&r.setBitXY(f+s.position[0],o+s.position[1])}return r}resetPainted(t={}){const{image:r}=t;r?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const r=this.getMap(t);return r.mergeRoi(t),this.putMap(r.data,t),this}mergeRois(t,r={}){if(!Array.isArray(t)||t.some(a=>!Number.isInteger(a)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(a=>this.getRoi(a));const n=this.getMap(r);return n.mergeRois(t),this.putMap(n.data,r),this}findCorrespondingRoi(t,r={}){let n=this.getRois(r),a=[];for(let s=0;s<n.length;s++){let f=n[s],o=f.minX,x=f.minY,C=f.points,P=Math.sign(f.id),Y=correspondingRoisInformation(o,x,C,t,P);a.push(Y)}return a}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(e,t,r,n,a){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let f=0;f<r.length;f++){let o=r[f],x=o[0],C=o[1],P=x+e+(C+t)*n.width,Y=n.data[P];(Y>0||Y<0)&&(s.id.includes(Y)?s.surface[s.id.indexOf(Y)]+=1:(s.id.push(Y),s.surface.push(1)))}for(let f=0;f<s.id.length;f++)Math.sign(s.id[f])===a?s.same+=s.surface[f]:s.opposite+=s.surface[f],s.roiSurfaceCovered[f]=s.surface[f]/r.length;return s.total=s.opposite+s.same,s}const objectToString$3=Object.prototype.toString;let Image$1=class Yw{constructor(t,r,n,a){if(arguments.length===1?(a=t,{width:t,height:r,data:n}=a):n&&!n.length&&(a=n,{data:n}=a),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a={}),typeof a!="object"||a===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=a;if(typeof s!="string")throw new TypeError("kind must be a string");const f=getKind(s),o=Object.assign({},a);for(const Ur in f)o[Ur]===void 0&&(o[Ur]=f[Ur]);verifyKindDefinition(o);const{components:x,bitDepth:C,colorModel:P}=o,Y=o.alpha+0,ze=t*r,ge=x+Y,Bt=C===32?Number.MAX_VALUE:2**C-1;if(n===void 0)n=createPixelArray(ze,x,Y,ge,C,Bt);else{const Ur=getTheoreticalPixelArraySize(ze,ge,C);if(n.length!==Ur)throw new RangeError(`incorrect data size: ${n.length}. Should be ${Ur}`)}this.width=t,this.height=r,this.data=n,this.size=ze,this.components=x,this.alpha=Y,this.bitDepth=C,this.maxValue=Bt,this.colorModel=P,this.channels=ge,this.meta=a.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:a.parent||null}),this.position=a.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString$3.call(t)==="[object IJSImage]"}static fromCanvas(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Yw(n.width,n.height,n.data)}static createFrom(t,r){const n=getImageParameters(t);return Object.assign(n,{parent:t,position:[0,0]},r),new Yw(n)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Yw(this.width,this.height,t,this)}apply(t){for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let a=(r*this.width+n)*this.channels;t.call(this,a)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$4(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function e(){this._listeners={}}e.prototype.on=function(r,n){if(this._listeners[r])throw new RangeError("there is already a listener for "+r);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[r]=n},e.prototype._send=function(r,n,a){a===void 0?a=[]:Array.isArray(a)||(a=[a]),self.postMessage({id:r,data:n},a)},e.prototype._trigger=function(r,n){if(!this._listeners[r])throw new Error("event "+r+" is not defined");this._listeners[r].apply(null,n)};var t=new e;self.onmessage=function(r){switch(r.data.action){case"exec":r.data.args.unshift(function(n,a){t._send(r.data.id,n,a)}),t._trigger(r.data.event,r.data.args);break;case"ping":t._send(r.data.id,"pong");break;default:throw new Error("unexpected action: "+r.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function e(t,r){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(r)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(e,t){if(typeof e!="string"&&typeof e!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=e.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var r=t.deps;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}WorkerManager.prototype._init=function(e){for(var t=workerTemplate.newWorkerURL(this._workerCode,e),r=0;r<this._numWorkers;r++){var n=new Worker(t);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=r,this._workers.set(n,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(e,t){if(!this._terminated){this._working--,e.running=!1;var r=this._workers.get(e);r&&r[1](t.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(e,t){if(!this._terminated){this._working--,e.running=!1;var r=this._workers.get(e);r&&r[0](t.data.data),this._workers.set(e,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!e.running)for(var t=0;t<this._waiting.length;t++){var r=this._waiting[t];if(!(typeof r[4]=="number"&&r[4]!==e.id)){this._waiting.splice(t,1),e.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,r[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(e,t){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var n of this._workers.keys())r.push(this.post(e,t,[],n.id));return Promise.all(r)};WorkerManager.prototype.post=function(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);var a=this;return new Promise(function(s,f){if(a._terminated)throw new Error("Cannot post (terminated)");a._waiting.push([e,t,r,[s,f],n]),a._exec()})};var src=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,t,r){t=Object.assign({},defaultOptions,t);const n=this.manager;return Array.isArray(e)?Promise.all(e.map(function(a){const s=runOnce(n,a,t);return typeof r=="function"&&s.then(r),s})):runOnce(n,e,t)}function runOnce(e,t,r){return e.post("data",[t,r]).then(function(n){for(let a in n)n[a]=new Image$1(n[a]);return n})}function work(){worker.on("data",function(e,t,r){t=new IJS(t);const n={},a=[],s=t.grey(),f=s.sobelFilter();ge("sobel",f);const o=f.level().mask({threshold:r.threshold});ge("mask",o);const x=f.getRoiManager();x.fromMask(o);const C=x.getMask(r.roi);ge("realMask",C);const P=s.getPixelsGrid({sampling:r.sampling,mask:C}),Y=t.getBackground(P.xyS,P.zS,r.regression);ge("background",Y);const ze=t.subtract(Y);n.result=ze,a.push(ze.data.buffer),e(n,a);function ge(Bt,Ur){r.include.includes(Bt)&&(n[Bt]=Ur,a.push(Ur.data.buffer))}})}const background={run,work};function extend$3(e){e.extendMethod("background",background)}let Worker$1=class JE{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,r){let n,a,s={};function f(...o){return n||(this.checkUrl(),a=this.url,n=new WorkerManager$1(r.work,{deps:a}),s.manager=n),r.run.call(s,...o)}f.reset=function(){n&&(n.terminate(),n=new WorkerManager$1(r.work,{deps:a}),s.manager=n)},JE.prototype[t]=f}};extend$3(Worker$1);function getTileInfo(e,t,r,n,a,s,f){let o={},x;r===!1&&(x=tilebelt$1.pointToTile(e,t,s),n=x[0],a=x[1]);let C=40075016686e-3*Math.abs(Math.cos(t))/Math.pow(2,s),P=C/512;o.z=s,o.x=n,o.y=a,o.pointLng=e,o.pointLat=t,o.tileWidthInMeters=C,o.metersPerPixel=P,o.mapboxTileName=o.z+"-"+o.x+"-"+o.y,o.tile=[o.x,o.y,o.z],r===!1?o.bbox=tilebelt$1.tileToBBOX(o.tile):o.bbox=f,o.polygon_bb=getTileGeoJsonBB(o.bbox),o.area_bb=getAreaBB(o.bbox);const Y=new mapboxgl.LngLatBounds(o.bbox);o.bboxCT=Y.getCenter(),o.bboxSW=Y.getSouthWest(),o.bboxNE=Y.getNorthEast(),o.bboxNW=Y.getNorthWest(),o.bboxSE=Y.getSouthEast(),o.bboxW=Y.getWest().toFixed(5),o.bboxS=Y.getSouth().toFixed(5),o.bboxE=Y.getEast().toFixed(5),o.bboxN=Y.getNorth().toFixed(5),o.topLeft=o.bboxNW,o.bottomLeft=o.bboxSW,o.topRight=o.bboxNE,o.bottomRight=o.bboxSE,o.center=o.bboxCT;const ze=point([o.bboxNE.lng,o.bboxNE.lat]),ge=point([o.bboxSW.lng,o.bboxNE.lat]),Bt=point([o.bboxNE.lng,o.bboxSW.lat]),Ur=point([o.bboxSW.lng,o.bboxSW.lat]),kn=midpoint(ze,Bt),Io=midpoint(ge,Ur);return o.distance=distance(kn,Io,"kilometers").toFixed(2),o.maxPngValue=65535,o.rgbFileName="terrain-rgb-"+o.mapboxTileName+".png",o.mapFileName="map-"+o.mapboxTileName+".png",o.satFileName="sat-"+o.mapboxTileName+".png",o.thirtyTwoFileName="thirtytwo-"+o.mapboxTileName+".png",o.tileInfoFileName="tile-info-"+o.mapboxTileName+".json",o.geoJsonFileName="geojson-"+o.mapboxTileName+".json",o}function getAreaBB(e){let t=bboxPolygon(e);return area(t)}function getTileGeoJsonBB(e){let t=bboxPolygon(e);return{type:"Feature",geometry:{type:t.geometry.type,coordinates:t.geometry.coordinates}}}function getFeaturesFromBB(e,t,r){t.swPt=e.project(t.bboxSW),t.nePt=e.project(t.bboxNE),t.nwPt=e.project(t.bboxNW),t.sePt=e.project(t.bboxSE);let n=e.queryRenderedFeatures([t.swPt,t.nePt]);return r===!0&&(n=getUniqueFeatures(n)),n}function getUniqueFeatures(e){const t=new Set,r=[];for(const n of e){const a=n.properties.name,s=n.geometry.type;let f=a+"-"+s;t.has(f)||(t.add(f),r.push(n))}return r}async function loadImageFromArray(e){try{return await Image$1.load(e)}catch(t){console.log(t)}}function getHeightFromRgb(e,t,r){return-1e4+(e*256*256+t*256+r)*.1}function getHeightArray(e){let t=[],r=e.getPixelsArray();for(const n of r){let a=n[0],s=n[1],f=n[2],o=getHeightFromRgb(a,s,f);o=parseFloat(o),t.push(o)}return t}async function downloadTerrainRgb(e){return await(await fetch(e)).arrayBuffer()}async function unrealRemoteControl(e,t){let r,n={},a="";const s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{r=await fetch(t,s)}catch(f){a=f}return n.response=r,n.error=a,n}async function getMapboxTerrainRgb(e){let t,r;return t=await downloadTerrainRgb(e),r=await loadImageFromArray(t),idbKeyval.set("rgbImageArrayBuffer",t),r}function convertImage(e,t,r,n,a){return new Image$1(e,t,r,{kind:a,bitDepth:n})}function createHeightMapImage(e,t,r){let n={},a=getHeightArray(e);idbKeyval.set("decodedHeightArray",a);let s=convertImage(e.width,e.height,a,t,r);return n.minElevation=s.min[0],n.maxElevation=s.max[0],n.image=s,n.decodedHeightArray=a,n}const mapUtils={getTileInfo,getFeaturesFromBB,getMapboxTerrainRgb,createHeightMapImage,loadImageFromArray,unrealRemoteControl,downloadTerrainRgb,convertImage,getTileGeoJsonBB};function mitt(e){return{all:e=e||new Map,on:function(t,r){var n=e.get(t);n?n.push(r):e.set(t,[r])},off:function(t,r){var n=e.get(t);n&&(r?n.splice(n.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var n=e.get(t);n&&n.slice().map(function(a){a(r)}),(n=e.get("*"))&&n.slice().map(function(a){a(t,r)})}}}const emitter=mitt();var immutable=extend$2,hasOwnProperty$9=Object.prototype.hasOwnProperty;function extend$2(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)hasOwnProperty$9.call(r,n)&&(e[n]=r[n])}return e}var fuzzy$1={exports:{}};(function(e,t){(function(){var r={};e.exports=r,r.simpleFilter=function(n,a){return a.filter(function(s){return r.test(n,s)})},r.test=function(n,a){return r.match(n,a)!==null},r.match=function(n,a,s){s=s||{};var f=0,o=[],x=a.length,C=0,P=0,Y=s.pre||"",ze=s.post||"",ge=s.caseSensitive&&a||a.toLowerCase(),Bt;n=s.caseSensitive&&n||n.toLowerCase();for(var Ur=0;Ur<x;Ur++)Bt=a[Ur],ge[Ur]===n[f]?(Bt=Y+Bt+ze,f+=1,P+=1+P):P=0,C+=P,o[o.length]=Bt;return f===n.length?(C=ge===n?1/0:C,{rendered:o.join(""),score:C}):null},r.filter=function(n,a,s){return!a||a.length===0?[]:typeof n!="string"?a:(s=s||{},a.reduce(function(f,o,x,C){var P=o;s.extract&&(P=s.extract(o));var Y=r.match(n,P,s);return Y!=null&&(f[f.length]={string:Y.rendered,score:Y.score,index:x,original:o}),f},[]).sort(function(f,o){var x=o.score-f.score;return x||f.index-o.index}))}})()})(fuzzy$1);var fuzzyExports=fuzzy$1.exports,List$1=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(e){this.items.push(e)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};List$1.prototype.drawItem=function(e,t){var r=document.createElement("li"),n=document.createElement("a");t&&(r.className+=" active"),n.innerHTML=e.string,r.appendChild(n),this.element.appendChild(r),r.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),r.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};List$1.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};List$1.prototype.move=function(e){this.active=e,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var list=List$1,extend$1=immutable,fuzzy=fuzzyExports,List=list,Suggestions$1=function(e,t,r){return r=r||{},this.options=extend$1({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r),this.el=e,this.data=t||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(n){this.handleKeyUp(n.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(n){this.handleKeyDown(n)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(n){this.handlePaste(n)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(t){for(var r=0;r<t.length&&(this.list.add(t[r]),r!==this.options.limit-1);r++);this.list.draw()}.bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(e){this.data=e,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(e){return e=e.toLowerCase(),e};Suggestions$1.prototype.match=function(e,t){return e.indexOf(t)>-1};Suggestions$1.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(n){return this.getItemValue(n)}.bind(this)},r;this.options.filter?(r=fuzzy.filter(this.query,this.data,t),r=r.map(function(n){return{original:n.original,string:this.render(n.original,n.string)}}.bind(this))):r=this.data.map(function(n){var a=this.render(n);return{original:n,string:a}}.bind(this)),e(r)};Suggestions$1.prototype.getItemValue=function(e){return e};Suggestions$1.prototype.render=function(e,t){if(t)return t;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),n=this.normalize(r),a=n.lastIndexOf(this.query);a>-1;){var s=a+this.query.length;r=r.slice(0,a)+"<strong>"+r.slice(a,s)+"</strong>"+r.slice(s),a=n.slice(0,a).lastIndexOf(this.query)}return r};Suggestions$1.prototype.renderError=function(e){this.list.drawError(e)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window<"u"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT$1="Expected a function",NAN=0/0,symbolTag$2="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal$2=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf$1=typeof self=="object"&&self&&self.Object===Object&&self,root$9=freeGlobal$2||freeSelf$1||Function("return this")(),objectProto$c=Object.prototype,objectToString$2=objectProto$c.toString,nativeMax$1=Math.max,nativeMin=Math.min,now=function(){return root$9.Date.now()};function debounce$1(e,t,r){var n,a,s,f,o,x,C=0,P=!1,Y=!1,ze=!0;if(typeof e!="function")throw new TypeError(FUNC_ERROR_TEXT$1);t=toNumber(t)||0,isObject$5(r)&&(P=!!r.leading,Y="maxWait"in r,s=Y?nativeMax$1(toNumber(r.maxWait)||0,t):s,ze="trailing"in r?!!r.trailing:ze);function ge(ah){var ch=n,Zu=a;return n=a=void 0,C=ah,f=e.apply(Zu,ch),f}function Bt(ah){return C=ah,o=setTimeout(Io,t),P?ge(ah):f}function Ur(ah){var ch=ah-x,Zu=ah-C,ih=t-ch;return Y?nativeMin(ih,s-Zu):ih}function kn(ah){var ch=ah-x,Zu=ah-C;return x===void 0||ch>=t||ch<0||Y&&Zu>=s}function Io(){var ah=now();if(kn(ah))return rl(ah);o=setTimeout(Io,Ur(ah))}function rl(ah){return o=void 0,ze&&n?ge(ah):(n=a=void 0,f)}function Co(){o!==void 0&&clearTimeout(o),C=0,n=x=a=o=void 0}function as(){return o===void 0?f:rl(now())}function $s(){var ah=now(),ch=kn(ah);if(n=arguments,a=this,x=ah,ch){if(o===void 0)return Bt(x);if(Y)return o=setTimeout(Io,t),ge(x)}return o===void 0&&(o=setTimeout(Io,t)),f}return $s.cancel=Co,$s.flush=as,$s}function isObject$5(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function isObjectLike$6(e){return!!e&&typeof e=="object"}function isSymbol$6(e){return typeof e=="symbol"||isObjectLike$6(e)&&objectToString$2.call(e)==symbolTag$2}function toNumber(e){if(typeof e=="number")return e;if(isSymbol$6(e))return NAN;if(isObject$5(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=isObject$5(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var lodash_debounce=debounce$1,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function e(t,r,n){return Function.prototype.apply.call(t,r,n)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}var NumberIsNaN=Number.isNaN||function e(t){return t!==t};function EventEmitter$3(){EventEmitter$3.init.call(this)}events$1.exports=EventEmitter$3;events$1.exports.once=once;EventEmitter$3.EventEmitter=EventEmitter$3;EventEmitter$3.prototype._events=void 0;EventEmitter$3.prototype._eventsCount=0;EventEmitter$3.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(EventEmitter$3,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}});EventEmitter$3.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$3.prototype.setMaxListeners=function e(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(e){return e._maxListeners===void 0?EventEmitter$3.defaultMaxListeners:e._maxListeners}EventEmitter$3.prototype.getMaxListeners=function e(){return _getMaxListeners(this)};EventEmitter$3.prototype.emit=function e(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var a=t==="error",s=this._events;if(s!==void 0)a=a&&s.error===void 0;else if(!a)return!1;if(a){var f;if(r.length>0&&(f=r[0]),f instanceof Error)throw f;var o=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw o.context=f,o}var x=s[t];if(x===void 0)return!1;if(typeof x=="function")ReflectApply(x,this,r);else for(var C=x.length,P=arrayClone(x,C),n=0;n<C;++n)ReflectApply(P[n],this,r);return!0};function _addListener(e,t,r,n){var a,s,f;if(checkListener(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),f=s[t]),f===void 0)f=s[t]=r,++e._eventsCount;else if(typeof f=="function"?f=s[t]=n?[r,f]:[f,r]:n?f.unshift(r):f.push(r),a=_getMaxListeners(e),a>0&&f.length>a&&!f.warned){f.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=f.length,ProcessEmitWarning(o)}return e}EventEmitter$3.prototype.addListener=function e(t,r){return _addListener(this,t,r,!1)};EventEmitter$3.prototype.on=EventEmitter$3.prototype.addListener;EventEmitter$3.prototype.prependListener=function e(t,r){return _addListener(this,t,r,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=onceWrapper.bind(n);return a.listener=r,n.wrapFn=a,a}EventEmitter$3.prototype.once=function e(t,r){return checkListener(r),this.on(t,_onceWrap(this,t,r)),this};EventEmitter$3.prototype.prependOnceListener=function e(t,r){return checkListener(r),this.prependListener(t,_onceWrap(this,t,r)),this};EventEmitter$3.prototype.removeListener=function e(t,r){var n,a,s,f,o;if(checkListener(r),a=this._events,a===void 0)return this;if(n=a[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete a[t],a.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(s=-1,f=n.length-1;f>=0;f--)if(n[f]===r||n[f].listener===r){o=n[f].listener,s=f;break}if(s<0)return this;s===0?n.shift():spliceOne(n,s),n.length===1&&(a[t]=n[0]),a.removeListener!==void 0&&this.emit("removeListener",t,o||r)}return this};EventEmitter$3.prototype.off=EventEmitter$3.prototype.removeListener;EventEmitter$3.prototype.removeAllListeners=function e(t){var r,n,a;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),f;for(a=0;a<s.length;++a)f=s[a],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(a=r.length-1;a>=0;a--)this.removeListener(t,r[a]);return this};function _listeners(e,t,r){var n=e._events;if(n===void 0)return[];var a=n[t];return a===void 0?[]:typeof a=="function"?r?[a.listener||a]:[a]:r?unwrapListeners(a):arrayClone(a,a.length)}EventEmitter$3.prototype.listeners=function e(t){return _listeners(this,t,!0)};EventEmitter$3.prototype.rawListeners=function e(t){return _listeners(this,t,!1)};EventEmitter$3.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):listenerCount.call(e,t)};EventEmitter$3.prototype.listenerCount=listenerCount;function listenerCount(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}EventEmitter$3.prototype.eventNames=function e(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function once(e,t){return new Promise(function(r,n){function a(f){e.removeListener(t,s),n(f)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",a),r([].slice.call(arguments))}eventTargetAgnosticAddListener(e,t,s,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(e,a,{once:!0})})}function addErrorHandlerIfEventEmitter(e,t,r){typeof e.on=="function"&&eventTargetAgnosticAddListener(e,"error",t,r)}function eventTargetAgnosticAddListener(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function a(s){n.once&&e.removeEventListener(t,a),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var eventsExports=events$1.exports;const EventEmitter$4=getDefaultExportFromCjs(eventsExports);var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam$1(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink$1(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var r=t[1],n=t[2].split(";"),a=null,s=n.reduce(function(f,o){var x=parseParam$1(o);return x?x.key==="rel"?(a||(a=x.value),f):(f[x.key]=x.value,f):f},{});return a?{url:r,rel:a,params:s}:null}function parseLinkHeader$3(e){return e?e.split(/,\s*</).reduce(function(t,r){var n=parseLink$1(r);if(!n)return t;var a=n.rel.split(/\s+/);return a.forEach(function(s){t[s]||(t[s]={url:n.url,params:n.params})}),t},{}):{}}var parseLinkHeader_1$1=parseLinkHeader$3,parseLinkHeader$2=parseLinkHeader_1$1;function MapiResponse$3(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader$2(this.headers.link)}MapiResponse$3.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$3.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse$1=MapiResponse$3,constants$9={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$8=constants$9;function MapiError$3(e){var t=e.type||constants$8.ERROR_HTTP,r;if(e.body)try{r=JSON.parse(e.body)}catch{r=e.body}else r=null;var n=e.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:t===constants$8.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=r}var mapiError$1=MapiError$3;function parseSingleHeader$1(e){var t=e.indexOf(":"),r=e.substring(0,t).trim().toLowerCase(),n=e.substring(t+1).trim();return{name:r,value:n}}function parseHeaders$3(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(r){var n=parseSingleHeader$1(r);t[n.name]=n.value}),t}var parseHeaders_1$1=parseHeaders$3,MapiResponse$2=mapiResponse$1,MapiError$2=mapiError$1,constants$7=constants$9,parseHeaders$2=parseHeaders_1$1,requestsUnderway$1={};function browserAbort$1(e){var t=requestsUnderway$1[e.id];t&&(t.abort(),delete requestsUnderway$1[e.id])}function createResponse$1(e,t){return new MapiResponse$2(e,{body:t.response,headers:parseHeaders$2(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent$1(e){var t=e.total,r=e.loaded,n=100*r/t;return{total:t,transferred:r,percent:n}}function sendRequestXhr$1(e,t){return new Promise(function(r,n){t.onprogress=function(f){e.emitter.emit(constants$7.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent$1(f))};var a=e.file;a&&(t.upload.onprogress=function(f){e.emitter.emit(constants$7.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent$1(f))}),t.onerror=function(f){n(f)},t.onabort=function(){var f=new MapiError$2({request:e,type:constants$7.ERROR_REQUEST_ABORTED});n(f)},t.onload=function(){if(delete requestsUnderway$1[e.id],t.status<200||t.status>=400){var f=new MapiError$2({request:e,body:t.response,statusCode:t.status});n(f);return}r(t)};var s=e.body;typeof s=="string"?t.send(s):s?t.send(JSON.stringify(s)):a?t.send(a):t.send(),requestsUnderway$1[e.id]=t}).then(function(r){return createResponse$1(e,r)})}function createRequestXhr$1(e,t){var r=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(a){n.setRequestHeader(a,e.headers[a])}),n}function browserSend$1(e){return Promise.resolve().then(function(){var t=createRequestXhr$1(e,e.client.accessToken);return sendRequestXhr$1(e,t)})}var browserLayer$1={browserAbort:browserAbort$1,sendRequestXhr:sendRequestXhr$1,browserSend:browserSend$1,createRequestXhr:createRequestXhr$1},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */base64$1.exports;(function(e,t){(function(r){var n=t,a=e&&e.exports==n&&e,s=typeof commonjsGlobal=="object"&&commonjsGlobal;(s.global===s||s.window===s)&&(r=s);var f=function(Bt){this.message=Bt};f.prototype=new Error,f.prototype.name="InvalidCharacterError";var o=function(Bt){throw new f(Bt)},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/[\t\n\f\r ]/g,P=function(Bt){Bt=String(Bt).replace(C,"");var Ur=Bt.length;Ur%4==0&&(Bt=Bt.replace(/==?$/,""),Ur=Bt.length),(Ur%4==1||/[^+a-zA-Z0-9/]/.test(Bt))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var kn=0,Io,rl,Co="",as=-1;++as<Ur;)rl=x.indexOf(Bt.charAt(as)),Io=kn%4?Io*64+rl:rl,kn++%4&&(Co+=String.fromCharCode(255&Io>>(-2*kn&6)));return Co},Y=function(Bt){Bt=String(Bt),/[^\0-\xFF]/.test(Bt)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var Ur=Bt.length%3,kn="",Io=-1,rl,Co,as,$s,ah=Bt.length-Ur;++Io<ah;)rl=Bt.charCodeAt(Io)<<16,Co=Bt.charCodeAt(++Io)<<8,as=Bt.charCodeAt(++Io),$s=rl+Co+as,kn+=x.charAt($s>>18&63)+x.charAt($s>>12&63)+x.charAt($s>>6&63)+x.charAt($s&63);return Ur==2?(rl=Bt.charCodeAt(Io)<<8,Co=Bt.charCodeAt(++Io),$s=rl+Co,kn+=x.charAt($s>>10)+x.charAt($s>>4&63)+x.charAt($s<<2&63)+"="):Ur==1&&($s=Bt.charCodeAt(Io),kn+=x.charAt($s>>2)+x.charAt($s<<4&63)+"=="),kn},ze={encode:Y,decode:P,version:"0.1.0"};if(n&&!n.nodeType)if(a)a.exports=ze;else for(var ge in ze)ze.hasOwnProperty(ge)&&(n[ge]=ze[ge]);else r.base64=ze})(commonjsGlobal)})(base64$1,base64$1.exports);var base64Exports=base64$1.exports,base64=base64Exports,tokenCache={};function parseToken$4(e){if(tokenCache[e])return tokenCache[e];var t=e.split("."),r=t[0],n=t[1];if(!n)throw new Error("Invalid token");var a=parsePaylod(n),s={usage:r,user:a.u};return has(a,"a")&&(s.authorization=a.a),has(a,"exp")&&(s.expires=a.exp*1e3),has(a,"iat")&&(s.created=a.iat*1e3),has(a,"scopes")&&(s.scopes=a.scopes),has(a,"client")&&(s.client=a.client),has(a,"ll")&&(s.lastLogin=a.ll),has(a,"iu")&&(s.impersonator=a.iu),tokenCache[e]=s,s}function parsePaylod(e){try{return JSON.parse(base64.decode(e))}catch{throw new Error("Invalid token")}}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var parseMapboxToken=parseToken$4,eventemitter3={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(x,C,P){this.fn=x,this.context=C,this.once=P||!1}function s(x,C,P,Y,ze){if(typeof P!="function")throw new TypeError("The listener must be a function");var ge=new a(P,Y||x,ze),Bt=r?r+C:C;return x._events[Bt]?x._events[Bt].fn?x._events[Bt]=[x._events[Bt],ge]:x._events[Bt].push(ge):(x._events[Bt]=ge,x._eventsCount++),x}function f(x,C){--x._eventsCount===0?x._events=new n:delete x._events[C]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var C=[],P,Y;if(this._eventsCount===0)return C;for(Y in P=this._events)t.call(P,Y)&&C.push(r?Y.slice(1):Y);return Object.getOwnPropertySymbols?C.concat(Object.getOwnPropertySymbols(P)):C},o.prototype.listeners=function(C){var P=r?r+C:C,Y=this._events[P];if(!Y)return[];if(Y.fn)return[Y.fn];for(var ze=0,ge=Y.length,Bt=new Array(ge);ze<ge;ze++)Bt[ze]=Y[ze].fn;return Bt},o.prototype.listenerCount=function(C){var P=r?r+C:C,Y=this._events[P];return Y?Y.fn?1:Y.length:0},o.prototype.emit=function(C,P,Y,ze,ge,Bt){var Ur=r?r+C:C;if(!this._events[Ur])return!1;var kn=this._events[Ur],Io=arguments.length,rl,Co;if(kn.fn){switch(kn.once&&this.removeListener(C,kn.fn,void 0,!0),Io){case 1:return kn.fn.call(kn.context),!0;case 2:return kn.fn.call(kn.context,P),!0;case 3:return kn.fn.call(kn.context,P,Y),!0;case 4:return kn.fn.call(kn.context,P,Y,ze),!0;case 5:return kn.fn.call(kn.context,P,Y,ze,ge),!0;case 6:return kn.fn.call(kn.context,P,Y,ze,ge,Bt),!0}for(Co=1,rl=new Array(Io-1);Co<Io;Co++)rl[Co-1]=arguments[Co];kn.fn.apply(kn.context,rl)}else{var as=kn.length,$s;for(Co=0;Co<as;Co++)switch(kn[Co].once&&this.removeListener(C,kn[Co].fn,void 0,!0),Io){case 1:kn[Co].fn.call(kn[Co].context);break;case 2:kn[Co].fn.call(kn[Co].context,P);break;case 3:kn[Co].fn.call(kn[Co].context,P,Y);break;case 4:kn[Co].fn.call(kn[Co].context,P,Y,ze);break;default:if(!rl)for($s=1,rl=new Array(Io-1);$s<Io;$s++)rl[$s-1]=arguments[$s];kn[Co].fn.apply(kn[Co].context,rl)}}return!0},o.prototype.on=function(C,P,Y){return s(this,C,P,Y,!1)},o.prototype.once=function(C,P,Y){return s(this,C,P,Y,!0)},o.prototype.removeListener=function(C,P,Y,ze){var ge=r?r+C:C;if(!this._events[ge])return this;if(!P)return f(this,ge),this;var Bt=this._events[ge];if(Bt.fn)Bt.fn===P&&(!ze||Bt.once)&&(!Y||Bt.context===Y)&&f(this,ge);else{for(var Ur=0,kn=[],Io=Bt.length;Ur<Io;Ur++)(Bt[Ur].fn!==P||ze&&!Bt[Ur].once||Y&&Bt[Ur].context!==Y)&&kn.push(Bt[Ur]);kn.length?this._events[ge]=kn.length===1?kn[0]:kn:f(this,ge)}return this},o.prototype.removeAllListeners=function(C){var P;return C?(P=r?r+C:C,this._events[P]&&f(this,P)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;function encodeArray$1(e){return e.map(encodeURIComponent).join(",")}function encodeValue$1(e){return Array.isArray(e)?encodeArray$1(e):encodeURIComponent(String(e))}function appendQueryParam$1(e,t,r){if(r===!1||r===null)return e;var n=/\?/.test(e)?"&":"?",a=encodeURIComponent(t);return r!==void 0&&r!==""&&r!==!0&&(a+="="+encodeValue$1(r)),""+e+n+a}function appendQueryObject$1(e,t){if(!t)return e;var r=e;return Object.keys(t).forEach(function(n){var a=t[n];a!==void 0&&(Array.isArray(a)&&(a=a.filter(function(s){return s!=null}).join(",")),r=appendQueryParam$1(r,n,a))}),r}function prependOrigin$1(e,t){if(!t||e.slice(0,4)==="http")return e;var r=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+r+e}function interpolateRouteParams$1(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var a=t[n];if(a===void 0)throw new Error("Unspecified route parameter "+n);var s=encodeValue$1(a);return"/"+s}):e}var urlUtils$3={appendQueryObject:appendQueryObject$1,appendQueryParam:appendQueryParam$1,prependOrigin:prependOrigin$1,interpolateRouteParams:interpolateRouteParams$1},parseToken$3=parseMapboxToken,xtend$6=immutable,EventEmitter$2=eventemitter3Exports,urlUtils$2=urlUtils$3,constants$6=constants$9,requestId$1=1;function MapiRequest$3(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};t.body&&(r["content-type"]="application/json");var n=xtend$6(r,t.headers),a=Object.keys(n).reduce(function(s,f){return s[f.toLowerCase()]=n[f],s},{});this.id=requestId$1++,this._options=t,this.emitter=new EventEmitter$2,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=a}MapiRequest$3.prototype.url=function e(t){var r=urlUtils$2.prependOrigin(this.path,this.origin);r=urlUtils$2.appendQueryObject(r,this.query);var n=this.params,a=t??this.client.accessToken;if(a){r=urlUtils$2.appendQueryParam(r,"access_token",a);var s=parseToken$3(a).user;n=xtend$6({ownerId:s},n)}return r=urlUtils$2.interpolateRouteParams(r,n),r};MapiRequest$3.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(r){return t.response=r,t.emitter.emit(constants$6.EVENT_RESPONSE,r),r},function(r){throw t.error=r,t.emitter.emit(constants$6.EVENT_ERROR,r),r})};MapiRequest$3.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$3.prototype.eachPage=function e(t){var r=this;function n(f){function o(){delete r._nextPageRequest;var x=f.nextPage();x&&(r._nextPageRequest=x,s(x))}t(null,f,o)}function a(f){t(f,null,function(){})}function s(f){f.send().then(n,a)}s(this)};MapiRequest$3.prototype.clone=function e(){return this._extend()};MapiRequest$3.prototype._extend=function e(t){var r=xtend$6(this._options,t);return new MapiRequest$3(this.client,r)};var mapiRequest$1=MapiRequest$3,parseToken$2=parseMapboxToken,MapiRequest$2=mapiRequest$1,constants$5=constants$9;function MapiClient$5(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken$2(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$5.API_ORIGIN}MapiClient$5.prototype.createRequest=function e(t){return new MapiRequest$2(this,t)};var mapiClient$1=MapiClient$5,browser$1=browserLayer$1,MapiClient$4=mapiClient$1;function BrowserClient$1(e){MapiClient$4.call(this,e)}BrowserClient$1.prototype=Object.create(MapiClient$4.prototype);BrowserClient$1.prototype.constructor=BrowserClient$1;BrowserClient$1.prototype.sendRequest=browser$1.browserSend;BrowserClient$1.prototype.abortRequest=browser$1.browserAbort;function createBrowserClient$1(e){return new BrowserClient$1(e)}var browserClient$1=createBrowserClient$1,client=browserClient$1,mapboxSdk=client,toString$2=Object.prototype.toString,isPlainObj=function(e){var t;return toString$2.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$5=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$5={};v$5.assert=function(e,t){return t=t||{},function(r){var n=validate(e,r);if(n){var a=processMessage(n,t);throw t.apiName&&(a=t.apiName+": "+a),new Error(a)}}};v$5.shape=function e(t){var r=objectEntries(t);return function(a){var s=validate(v$5.plainObject,a);if(s)return s;for(var f,o,x=[],C=0;C<r.length;C++)f=r[C].key,o=r[C].value,s=validate(o,a[f]),s&&x.push([f].concat(s));return x.length<2?x[0]:function(P){x=x.map(function(ge){var Bt=ge[0],Ur=processMessage(ge,P).split(`
`).join(NEWLINE_INDENT);return"- "+Bt+": "+Ur});var Y=P.path.join("."),ze=Y===DEFAULT_ERROR_PATH?"":" of "+Y;return"The following properties"+ze+" have invalid values:"+NEWLINE_INDENT+x.join(NEWLINE_INDENT)}}};v$5.strictShape=function e(t){var r=v$5.shape(t);return function(a){var s=r(a);if(s)return s;var f=Object.keys(a).reduce(function(o,x){return t[x]===void 0&&o.push(x),o},[]);if(f.length!==0)return function(){return"The following keys are invalid: "+f.join(", ")}}};v$5.arrayOf=function e(t){return createArrayValidator(t)};v$5.tuple=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(t)};function createArrayValidator(e){var t=Array.isArray(e),r=function(n){return t?e[n]:e};return function(a){var s=validate(v$5.plainArray,a);if(s)return s;if(t&&a.length!==e.length)return"an array with "+e.length+" items";for(var f=0;f<a.length;f++)if(s=validate(r(f),a[f]),s)return[f].concat(s)}}v$5.required=function e(t){function r(n){return n==null?function(a){return formatErrorMessage(a,isArrayCulprit(a.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return r.__required=!0,r};v$5.oneOfType=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var a=t.map(function(s){return validate(s,n)}).filter(Boolean);if(a.length===t.length)return a.every(function(s){return s.length===1&&typeof s[0]=="string"})?orList(a.map(function(s){return s[0]})):a.reduce(function(s,f){return f.length>s.length?f:s})}};v$5.equal=function e(t){return function(n){if(n!==t)return JSON.stringify(t)}};v$5.oneOf=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),r=t.map(function(n){return v$5.equal(n)});return v$5.oneOfType.apply(this,r)};v$5.range=function e(t){var r=t[0],n=t[1];return function(s){var f=validate(v$5.number,s);if(f||s<r||s>n)return"number between "+r+" & "+n+" (inclusive)"}};v$5.any=function e(){};v$5.boolean=function e(t){if(typeof t!="boolean")return"boolean"};v$5.number=function e(t){if(typeof t!="number")return"number"};v$5.plainArray=function e(t){if(!Array.isArray(t))return"array"};v$5.plainObject=function e(t){if(!isPlainObject(t))return"object"};v$5.string=function e(t){if(typeof t!="string")return"string"};v$5.func=function e(t){if(typeof t!="function")return"function"};function validate(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var r=e(t);if(r)return Array.isArray(r)?r:[r]}}function processMessage(e,t){var r=e.length,n=e[r-1],a=e.slice(0,r-1);return a.length===0&&(a=[DEFAULT_ERROR_PATH]),t=xtend$5(t,{path:a}),typeof n=="function"?n(t):formatErrorMessage(t,prettifyResult(n))}function orList(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function prettifyResult(e){return"must be "+addArticle(e)+"."}function addArticle(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function formatErrorMessage(e,t){var r=isArrayCulprit(e.path),n=e.path.join(".")+" "+t,a=r?"Item at position ":"";return a+n}function isArrayCulprit(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function objectEntries(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}v$5.validate=validate;v$5.processMessage=processMessage;var lib$1=v$5,xtend$4=immutable,v$4=lib$1;function file$1(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape$1(e,t){return v$4.assert(v$4.strictShape(e),t)}function date$1(e){var t="date";if(typeof e=="boolean")return t;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return t}catch{return t}}function coordinates$2(e){return v$4.tuple(v$4.number,v$4.number)(e)}var validator$1=xtend$4(v$4,{file:file$1,date:date$1,coordinates:coordinates$2,assertShape:assertShape$1});function pick$3(e,t){var r=function(n,a){return t.indexOf(n)!==-1&&a!==void 0};return typeof t=="function"&&(r=t),Object.keys(e).filter(function(n){return r(n,e[n])}).reduce(function(n,a){return n[a]=e[a],n},{})}var pick_1$1=pick$3;function objectMap$3(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(n,e[n]),r},{})}var objectMap_1$1=objectMap$3,objectMap$2=objectMap_1$1;function stringifyBoolean$1(e){return objectMap$2(e,function(t,r){return typeof r=="boolean"?JSON.stringify(r):r})}var stringifyBooleans$3=stringifyBoolean$1,MapiClient$3=mapiClient$1,createClient$1=browserClient$1;function createServiceFactory$3(e){return function(t){var r;MapiClient$3.prototype.isPrototypeOf(t)?r=t:r=createClient$1(t);var n=Object.create(e);return n.client=r,n}}var createServiceFactory_1$1=createServiceFactory$3,xtend$3=immutable,v$3=validator$1,pick$2=pick_1$1,stringifyBooleans$2=stringifyBooleans$3,createServiceFactory$2=createServiceFactory_1$1,Geocoding$1={},featureTypes$1=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding$1.forwardGeocode=function(e){v$3.assertShape({query:v$3.required(v$3.string),mode:v$3.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$3.arrayOf(v$3.string),proximity:v$3.oneOf(v$3.coordinates,"ip"),types:v$3.arrayOf(v$3.oneOf(featureTypes$1)),autocomplete:v$3.boolean,bbox:v$3.arrayOf(v$3.number),limit:v$3.number,language:v$3.arrayOf(v$3.string),routing:v$3.boolean,fuzzyMatch:v$3.boolean,worldview:v$3.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};Geocoding$1.reverseGeocode=function(e){v$3.assertShape({query:v$3.required(v$3.coordinates),mode:v$3.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$3.arrayOf(v$3.string),types:v$3.arrayOf(v$3.oneOf(featureTypes$1)),bbox:v$3.arrayOf(v$3.number),limit:v$3.number,language:v$3.arrayOf(v$3.string),reverseMode:v$3.oneOf("distance","score"),routing:v$3.boolean,worldview:v$3.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};var geocoding$2=createServiceFactory$2(Geocoding$1);let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random=e=>crypto.getRandomValues(new Uint8Array(e)),customRandom=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,a=-~(1.6*n*t/e.length);return(s=t)=>{let f="";for(;;){let o=r(a),x=a;for(;x--;)if(f+=e[o[x]&n]||"",f.length===s)return f}}},customAlphabet=(e,t=21)=>customRandom(e,t,random),nanoid$1=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,r)=>(r&=63,r<36?t+=r.toString(36):r<62?t+=(r-26).toString(36).toUpperCase():r>62?t+="-":t+="_",t),"");const index_browser=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet,customRandom,nanoid:nanoid$1,random,urlAlphabet},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(index_browser);var nanoid=require$$0.nanoid;function MapboxEventManager$1(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(e,t){var r=this.getSelectedIndex(e,t),n=this.getEventPayload("search.select",t);if(n.resultIndex=r,n.resultPlaceName=e.place_name,n.resultId=e.id,!(r===this.lastSentIndex&&n.queryString===this.lastSentInput||r==-1)&&(this.lastSentIndex=r,this.lastSentInput=n.queryString,!!n.queryString))return this.push(n)},start:function(e){var t=this.getEventPayload("search.start",e);if(t.queryString)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var r=this.getEventPayload("search.keystroke",t);if(r.lastAction=e.key,!!r.queryString)return this.push(r)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var r=this.getRequestOptions(e);this.request(r,function(n){if(n)return this.handleError(n,t);if(t)return t()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t){var r;t.options.proximity?typeof t.options.proximity=="object"?r=[t.options.proximity.longitude,t.options.proximity.latitude]:t.options.proximity==="ip"?r=[999,999]:r=t.options.proximity:r=null;var n=t._map?t._map.getZoom():void 0,a={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:r,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:n,keyboardLocale:this.locale};return e==="search.select"?a.queryString=t.inputString:e!="search.select"&&t._inputEl?a.queryString=t._inputEl.value:a.queryString=t.inputString,a},request:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},r.open(e.method,e.host+"/"+e.path,!0);for(var n in e.headers){var a=e.headers[n];r.setRequestHeader(n,a)}r.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var r=t._typeahead.data,n=e.id,a=r.map(function(f){return f.id}),s=a.indexOf(n);return s}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},localization$1={placeholder},subtag$1={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():t[r]=n()})(commonjsGlobal,"subtag",function(){var t="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(x){return x.match(r)||[]}function a(x){return n(x).filter(function(C,P){return C&&P})}function s(x){return x=n(x),{language:x[1]||t,extlang:x[2]||t,script:x[3]||t,region:x[4]||t}}function f(x,C,P){Object.defineProperty(x,C,{value:P,enumerable:!0})}function o(x,C,P){function Y(ze){return n(ze)[x]||t}f(Y,"pattern",C),f(s,P,Y)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),f(s,"split",a),s})})(subtag$1);var subtagExports=subtag$1.exports;function Geolocation$1(){}Geolocation$1.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,r){window.navigator.geolocation.getCurrentPosition(t,r,e)})}};var geolocation$1=Geolocation$1;function transformFeatureToGeolocationText(e,t){const r=getAddressInfo(e),n=["address","street","place","country"];var a;if(typeof t=="function")return t(r);const s=n.indexOf(t);return s===-1?a=n:a=n.slice(s),a.reduce(function(f,o){return r[o]?(f!==""&&(f=f+", "),f+r[o]):f},"")}function getAddressInfo(e){const t=e.address||"",r=e.text||"",n=e.place_name||"",s={address:n.split(",")[0],houseNumber:t,street:r,placeName:n};return e.context.forEach(function(f){const o=f.id.split(".")[0];s[o]=f.text}),s}const REVERSE_GEOCODE_COORD_RGX=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var utils$1={transformFeatureToGeolocationText,getAddressInfo,REVERSE_GEOCODE_COORD_RGX},Typeahead=suggestions,debounce=lodash_debounce,extend=immutable,EventEmitter$1=eventsExports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding$2,MapboxEventManager=events,localization=localization$1,subtag=subtagExports,Geolocation=geolocation$1,utils=utils$1;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function getFooterNode(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function MapboxGeocoder(e){this._eventEmitter=new EventEmitter$1,this.options=extend({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Geolocation}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const a=r.onAdd();n.appendChild(a)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const r=document.querySelectorAll(e);if(r.length===0)throw new Error("Element ",e,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(C){this.eventManager.keyevent(C,this)}.bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(r),t.appendChild(this._inputEl),t.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(s),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var f=this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),f.getItemValue=this.options.getItemValue;var o=f.list.draw,x=this._footerNode=getFooterNode();return f.list.draw=function(){o.call(this),x.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),x.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(x)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const r={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(r).send().then(function(n){const a=n.body.features[0];if(a){const s=utils.transformFeatureToGeolocationText(a,this.options.addressAccuracy);this._setInputValue(s),a.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:a})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=t,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,r=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var n=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,a=n?n.value:"";if(!a)return this.fresh=!0,e.keyCode!==r&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[r,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&exceptions[e.properties.short_code])t=extend({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[e.properties.short_code].bbox,t);else if(e.bbox){var r=e.bbox;t=extend({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)}else{var n={zoom:this.options.zoom};t=extend({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var r;return e.localGeocoderOnly?r=GEOCODE_REQUEST_TYPE.LOCAL:e.reverseGeocode&&utils.REVERSE_GEOCODE_COORD_RGX.test(t)?r=GEOCODE_REQUEST_TYPE.REVERSE:r=GEOCODE_REQUEST_TYPE.FORWARD,r},_setupConfig:function(e,t){const r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var a=this,s=r.reduce(function(o,x){if(a.options[x]===void 0||a.options[x]===null)return o;["countries","types","language"].indexOf(x)>-1?o[x]=a.options[x].split(n):o[x]=a.options[x];const C=typeof a.options[x].longitude=="number"&&typeof a.options[x].latitude=="number";if(x==="proximity"&&C){const P=a.options[x].longitude,Y=a.options[x].latitude;o[x]=[P,Y]}return o},{});switch(e){case GEOCODE_REQUEST_TYPE.REVERSE:{var f=t.split(n).map(function(o){return parseFloat(o,10)});a.options.flipCoordinates||f.reverse(),s.types&&s.types[0],s=extend(s,{query:f,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(o){o in s&&delete s[o]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:{const o=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(o)&&(t=t.replace(/,/g," ")),s=extend(s,{query:t})}break}return s},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),r=this._setupConfig(t,e);var n;switch(t){case GEOCODE_REQUEST_TYPE.LOCAL:n=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:n=this.geocoderService.forwardGeocode(r).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:n=this.geocoderService.reverseGeocode(r).send();break}var a=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],s=[],f=null;return n.catch(function(o){f=o}.bind(this)).then(function(o){this._hideLoadingIcon();var x={};return o?o.statusCode=="200"&&(x=o.body,x.request=o.request,x.headers=o.headers):x={type:"FeatureCollection",features:[]},x.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),x.features=x.features?a.concat(x.features):a,this.options.externalGeocoder?(s=this.options.externalGeocoder(e,x.features)||Promise.resolve([]),s.then(function(C){return x.features=x.features?C.concat(x.features):C,x},function(){return x})):x}.bind(this)).then(function(o){if(f)throw f;this.options.filter&&o.features.length&&(o.features=o.features.filter(this.options.filter)),o.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",o),this._typeahead.update(o.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",o))}.bind(this)).catch(function(o){this._hideLoadingIcon(),this._hideAttribution(),a.length&&this.options.localGeocoder||s.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(a)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:a}),this._eventEmitter.emit("error",{error:o})}.bind(this)),n},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var r=t.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=subtag.language(e),r=localization.placeholder[t];if(r)return r}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},r=extend({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(r),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var lib=MapboxGeocoder;const MapboxGeocoder$1=getDefaultExportFromCjs(lib);var xtend$2=immutable,v$2=lib$1;function file(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape(e,t){return v$2.assert(v$2.strictShape(e),t)}function date(e){var t="date";if(typeof e=="boolean")return t;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return t}catch{return t}}function coordinates$1(e){return v$2.tuple(v$2.number,v$2.number)(e)}var validator=xtend$2(v$2,{file,date,coordinates:coordinates$1,assertShape});function pick$1(e,t){var r=function(n,a){return t.indexOf(n)!==-1&&a!==void 0};return typeof t=="function"&&(r=t),Object.keys(e).filter(function(n){return r(n,e[n])}).reduce(function(n,a){return n[a]=e[a],n},{})}var pick_1=pick$1;function objectMap$1(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(n,e[n]),r},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(e){return objectMap(e,function(t,r){return typeof r=="boolean"?JSON.stringify(r):r})}var stringifyBooleans$1=stringifyBoolean;function encodeArray(e){return e.map(encodeURIComponent).join(",")}function encodeValue(e){return Array.isArray(e)?encodeArray(e):encodeURIComponent(String(e))}function appendQueryParam(e,t,r){if(r===!1||r===null)return e;var n=/\?/.test(e)?"&":"?",a=encodeURIComponent(t);return r!==void 0&&r!==""&&r!==!0&&(a+="="+encodeValue(r)),""+e+n+a}function appendQueryObject(e,t){if(!t)return e;var r=e;return Object.keys(t).forEach(function(n){var a=t[n];a!==void 0&&(Array.isArray(a)&&(a=a.filter(function(s){return s!=null}).join(",")),r=appendQueryParam(r,n,a))}),r}function prependOrigin(e,t){if(!t||e.slice(0,4)==="http")return e;var r=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+r+e}function interpolateRouteParams(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var a=t[n];if(a===void 0)throw new Error("Unspecified route parameter "+n);var s=encodeValue(a);return"/"+s}):e}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},constants$4={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},parseToken$1=parseMapboxToken,xtend$1=immutable,EventEmitter=eventemitter3Exports,urlUtils=urlUtils$1,constants$3=constants$4,requestId=1;function MapiRequest$1(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};t.body&&(r["content-type"]="application/json");var n=xtend$1(r,t.headers),a=Object.keys(n).reduce(function(s,f){return s[f.toLowerCase()]=n[f],s},{});this.id=requestId++,this._options=t,this.emitter=new EventEmitter,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=a}MapiRequest$1.prototype.url=function e(t){var r=urlUtils.prependOrigin(this.path,this.origin);r=urlUtils.appendQueryObject(r,this.query);var n=this.params,a=t??this.client.accessToken;if(a){r=urlUtils.appendQueryParam(r,"access_token",a);var s=parseToken$1(a).user;n=xtend$1({ownerId:s},n)}return r=urlUtils.interpolateRouteParams(r,n),r};MapiRequest$1.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(r){return t.response=r,t.emitter.emit(constants$3.EVENT_RESPONSE,r),r},function(r){throw t.error=r,t.emitter.emit(constants$3.EVENT_ERROR,r),r})};MapiRequest$1.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function e(t){var r=this;function n(f){function o(){delete r._nextPageRequest;var x=f.nextPage();x&&(r._nextPageRequest=x,s(x))}t(null,f,o)}function a(f){t(f,null,function(){})}function s(f){f.send().then(n,a)}s(this)};MapiRequest$1.prototype.clone=function e(){return this._extend()};MapiRequest$1.prototype._extend=function e(t){var r=xtend$1(this._options,t);return new MapiRequest$1(this.client,r)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants$2=constants$4;function MapiClient$2(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$2.API_ORIGIN}MapiClient$2.prototype.createRequest=function e(t){return new MapiRequest(this,t)};var mapiClient=MapiClient$2;function parseParam(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var r=t[1],n=t[2].split(";"),a=null,s=n.reduce(function(f,o){var x=parseParam(o);return x?x.key==="rel"?(a||(a=x.value),f):(f[x.key]=x.value,f):f},{});return a?{url:r,rel:a,params:s}:null}function parseLinkHeader$1(e){return e?e.split(/,\s*</).reduce(function(t,r){var n=parseLink(r);if(!n)return t;var a=n.rel.split(/\s+/);return a.forEach(function(s){t[s]||(t[s]={url:n.url,params:n.params})}),t},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$1=constants$4;function MapiError$1(e){var t=e.type||constants$1.ERROR_HTTP,r;if(e.body)try{r=JSON.parse(e.body)}catch{r=e.body}else r=null;var n=e.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:t===constants$1.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=r}var mapiError=MapiError$1;function parseSingleHeader(e){var t=e.indexOf(":"),r=e.substring(0,t).trim().toLowerCase(),n=e.substring(t+1).trim();return{name:r,value:n}}function parseHeaders$1(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(r){var n=parseSingleHeader(r);t[n.name]=n.value}),t}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants=constants$4,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(e){var t=requestsUnderway[e.id];t&&(t.abort(),delete requestsUnderway[e.id])}function createResponse(e,t){return new MapiResponse(e,{body:t.response,headers:parseHeaders(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent(e){var t=e.total,r=e.loaded,n=100*r/t;return{total:t,transferred:r,percent:n}}function sendRequestXhr(e,t){return new Promise(function(r,n){t.onprogress=function(f){e.emitter.emit(constants.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(f))};var a=e.file;a&&(t.upload.onprogress=function(f){e.emitter.emit(constants.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(f))}),t.onerror=function(f){n(f)},t.onabort=function(){var f=new MapiError({request:e,type:constants.ERROR_REQUEST_ABORTED});n(f)},t.onload=function(){if(delete requestsUnderway[e.id],t.status<200||t.status>=400){var f=new MapiError({request:e,body:t.response,statusCode:t.status});n(f);return}r(t)};var s=e.body;typeof s=="string"?t.send(s):s?t.send(JSON.stringify(s)):a?t.send(a):t.send(),requestsUnderway[e.id]=t}).then(function(r){return createResponse(e,r)})}function createRequestXhr(e,t){var r=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(a){n.setRequestHeader(a,e.headers[a])}),n}function browserSend(e){return Promise.resolve().then(function(){var t=createRequestXhr(e,e.client.accessToken);return sendRequestXhr(e,t)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(e){MapiClient$1.call(this,e)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(e){return new BrowserClient(e)}var browserClient=createBrowserClient,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(e){return function(t){var r;MapiClient.prototype.isPrototypeOf(t)?r=t:r=createClient(t);var n=Object.create(e);return n.client=r,n}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v$1=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(e){v$1.assertShape({query:v$1.required(v$1.string),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),proximity:v$1.oneOf(v$1.coordinates,"ip"),types:v$1.arrayOf(v$1.oneOf(featureTypes)),autocomplete:v$1.boolean,bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),routing:v$1.boolean,fuzzyMatch:v$1.boolean,worldview:v$1.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};Geocoding.reverseGeocode=function(e){v$1.assertShape({query:v$1.required(v$1.coordinates),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),types:v$1.arrayOf(v$1.oneOf(featureTypes)),bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),reverseMode:v$1.oneOf("distance","score"),routing:v$1.boolean,worldview:v$1.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};var geocoding$1=createServiceFactory(Geocoding);const mbxGeocoding=getDefaultExportFromCjs(geocoding$1);var mapboxGlDraw$1={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){var r=function(yr,el){var yh={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Uh={on:function(od,ad,Gf){if(yh[od]===void 0)throw new Error("Invalid event type: "+od);yh[od].push({selector:ad,fn:Gf})},render:function(od){el.store.featureChanged(od)}},nd=function(od,ad){for(var Gf=yh[od],Ef=Gf.length;Ef--;){var _p=Gf[Ef];if(_p.selector(ad)){_p.fn.call(Uh,ad)||el.store.render(),el.ui.updateMapClasses();break}}};return yr.start.call(Uh),{render:yr.render,stop:function(){yr.stop&&yr.stop()},trash:function(){yr.trash&&(yr.trash(),el.store.render())},combineFeatures:function(){yr.combineFeatures&&yr.combineFeatures()},uncombineFeatures:function(){yr.uncombineFeatures&&yr.uncombineFeatures()},drag:function(od){nd("drag",od)},click:function(od){nd("click",od)},mousemove:function(od){nd("mousemove",od)},mousedown:function(od){nd("mousedown",od)},mouseup:function(od){nd("mouseup",od)},mouseout:function(od){nd("mouseout",od)},keydown:function(od){nd("keydown",od)},keyup:function(od){nd("keyup",od)},touchstart:function(od){nd("touchstart",od)},touchmove:function(od){nd("touchmove",od)},touchend:function(od){nd("touchend",od)},tap:function(od){nd("tap",od)}}};function n(yr){if(yr.__esModule)return yr;var el=yr.default;if(typeof el=="function"){var yh=function Uh(){if(this instanceof Uh){var nd=[null];nd.push.apply(nd,arguments);var od=Function.bind.apply(el,nd);return new od}return el.apply(this,arguments)};yh.prototype=el.prototype}else yh={};return Object.defineProperty(yh,"__esModule",{value:!0}),Object.keys(yr).forEach(function(Uh){var nd=Object.getOwnPropertyDescriptor(yr,Uh);Object.defineProperty(yh,Uh,nd.get?nd:{enumerable:!0,get:function(){return yr[Uh]}})}),yh}var a={},s={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},f=s;function o(yr){var el=0;if(yr&&yr.length>0){el+=Math.abs(x(yr[0]));for(var yh=1;yh<yr.length;yh++)el-=Math.abs(x(yr[yh]))}return el}function x(yr){var el,yh,Uh,nd,od,ad,Gf=0,Ef=yr.length;if(Ef>2){for(ad=0;ad<Ef;ad++)ad===Ef-2?(Uh=Ef-2,nd=Ef-1,od=0):ad===Ef-1?(Uh=Ef-1,nd=0,od=1):(Uh=ad,nd=ad+1,od=ad+2),el=yr[Uh],yh=yr[nd],Gf+=(C(yr[od][0])-C(el[0]))*Math.sin(C(yh[1]));Gf=Gf*f.RADIUS*f.RADIUS/2}return Gf}function C(yr){return yr*Math.PI/180}a.geometry=function yr(el){var yh,Uh=0;switch(el.type){case"Polygon":return o(el.coordinates);case"MultiPolygon":for(yh=0;yh<el.coordinates.length;yh++)Uh+=o(el.coordinates[yh]);return Uh;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(yh=0;yh<el.geometries.length;yh++)Uh+=yr(el.geometries[yh]);return Uh}},a.ring=x;var P={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Y={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},ze={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ge={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Bt={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Ur={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},kn={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Io={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},rl={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Co={ACTIVE:"true",INACTIVE:"false"},as=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],$s=-85,ah=Object.freeze({__proto__:null,classes:P,sources:Y,cursors:ze,types:ge,geojsonTypes:Bt,modes:Ur,events:kn,updateActions:Io,meta:rl,activeStates:Co,interactions:as,LAT_MIN:-90,LAT_RENDERED_MIN:$s,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ch={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Zu(yr,el){var yh=ch[yr.geometry.type]-ch[el.geometry.type];return yh===0&&yr.geometry.type===Bt.POLYGON?yr.area-el.area:yh}function ih(yr){return yr.map(function(el){return el.geometry.type===Bt.POLYGON&&(el.area=a.geometry({type:Bt.FEATURE,property:{},geometry:el.geometry})),el}).sort(Zu).map(function(el){return delete el.area,el})}function al(yr,el){return el===void 0&&(el=0),[[yr.point.x-el,yr.point.y-el],[yr.point.x+el,yr.point.y+el]]}function sh(yr){if(this._items={},this._nums={},this._length=yr?yr.length:0,yr)for(var el=0,yh=yr.length;el<yh;el++)this.add(yr[el]),yr[el]!==void 0&&(typeof yr[el]=="string"?this._items[yr[el]]=el:this._nums[yr[el]]=el)}sh.prototype.add=function(yr){return this.has(yr)||(this._length++,typeof yr=="string"?this._items[yr]=this._length:this._nums[yr]=this._length),this},sh.prototype.delete=function(yr){return this.has(yr)===!1||(this._length--,delete this._items[yr],delete this._nums[yr]),this},sh.prototype.has=function(yr){return(typeof yr=="string"||typeof yr=="number")&&(this._items[yr]!==void 0||this._nums[yr]!==void 0)},sh.prototype.values=function(){var yr=this,el=[];return Object.keys(this._items).forEach(function(yh){el.push({k:yh,v:yr._items[yh]})}),Object.keys(this._nums).forEach(function(yh){el.push({k:JSON.parse(yh),v:yr._nums[yh]})}),el.sort(function(yh,Uh){return yh.v-Uh.v}).map(function(yh){return yh.k})},sh.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var _h=[rl.FEATURE,rl.MIDPOINT,rl.VERTEX],Ih={click:function(yr,el,yh){return Lh(yr,el,yh,yh.options.clickBuffer)},touch:function(yr,el,yh){return Lh(yr,el,yh,yh.options.touchBuffer)}};function Lh(yr,el,yh,Uh){if(yh.map===null)return[];var nd=yr?al(yr,Uh):el,od={};yh.options.styles&&(od.layers=yh.options.styles.map(function(_p){return _p.id}));var ad=yh.map.queryRenderedFeatures(nd,od).filter(function(_p){return _h.indexOf(_p.properties.meta)!==-1}),Gf=new sh,Ef=[];return ad.forEach(function(_p){var ap=_p.properties.id;Gf.has(ap)||(Gf.add(ap),Ef.push(_p))}),ih(Ef)}function Gh(yr,el){var yh=Ih.click(yr,null,el),Uh={mouse:ze.NONE};return yh[0]&&(Uh.mouse=yh[0].properties.active===Co.ACTIVE?ze.MOVE:ze.POINTER,Uh.feature=yh[0].properties.meta),el.events.currentModeName().indexOf("draw")!==-1&&(Uh.mouse=ze.ADD),el.ui.queueMapClasses(Uh),el.ui.updateMapClasses(),yh[0]}function ud(yr,el){var yh=yr.x-el.x,Uh=yr.y-el.y;return Math.sqrt(yh*yh+Uh*Uh)}function Tf(yr,el,yh){yh===void 0&&(yh={});var Uh=yh.fineTolerance!=null?yh.fineTolerance:4,nd=yh.grossTolerance!=null?yh.grossTolerance:12,od=yh.interval!=null?yh.interval:500;yr.point=yr.point||el.point,yr.time=yr.time||el.time;var ad=ud(yr.point,el.point);return ad<Uh||ad<nd&&el.time-yr.time<od}function Kd(yr,el,yh){yh===void 0&&(yh={});var Uh=yh.tolerance!=null?yh.tolerance:25,nd=yh.interval!=null?yh.interval:250;return yr.point=yr.point||el.point,yr.time=yr.time||el.time,ud(yr.point,el.point)<Uh&&el.time-yr.time<nd}var Af={},md={get exports(){return Af},set exports(yr){Af=yr}}.exports=function(yr,el){if(el||(el=16),yr===void 0&&(yr=128),yr<=0)return"0";for(var yh=Math.log(Math.pow(2,yr))/Math.log(el),Uh=2;yh===1/0;Uh*=2)yh=Math.log(Math.pow(2,yr/Uh))/Math.log(el)*Uh;var nd=yh-Math.floor(yh),od="";for(Uh=0;Uh<Math.floor(yh);Uh++)od=Math.floor(Math.random()*el).toString(el)+od;if(nd){var ad=Math.pow(el,nd);od=Math.floor(Math.random()*ad).toString(el)+od}var Gf=parseInt(od,el);return Gf!==1/0&&Gf>=Math.pow(2,yr)?md(yr,el):od};md.rack=function(yr,el,yh){var Uh=function(od){var ad=0;do{if(ad++>10){if(!yh)throw new Error("too many ID collisions, use more bits");yr+=yh}var Gf=md(yr,el)}while(Object.hasOwnProperty.call(nd,Gf));return nd[Gf]=od,Gf},nd=Uh.hats={};return Uh.get=function(od){return Uh.hats[od]},Uh.set=function(od,ad){return Uh.hats[od]=ad,Uh},Uh.bits=yr||128,Uh.base=el||16,Uh};var vd=function(yr,el){this.ctx=yr,this.properties=el.properties||{},this.coordinates=el.geometry.coordinates,this.id=el.id||Af(),this.type=el.geometry.type};vd.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},vd.prototype.incomingCoords=function(yr){this.setCoordinates(yr)},vd.prototype.setCoordinates=function(yr){this.coordinates=yr,this.changed()},vd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},vd.prototype.setProperty=function(yr,el){this.properties[yr]=el},vd.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Bt.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},vd.prototype.internal=function(yr){var el={id:this.id,meta:rl.FEATURE,"meta:type":this.type,active:Co.INACTIVE,mode:yr};if(this.ctx.options.userProperties)for(var yh in this.properties)el["user_"+yh]=this.properties[yh];return{type:Bt.FEATURE,properties:el,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var qd=function(yr,el){vd.call(this,yr,el)};(qd.prototype=Object.create(vd.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},qd.prototype.updateCoordinate=function(yr,el,yh){this.coordinates=arguments.length===3?[el,yh]:[yr,el],this.changed()},qd.prototype.getCoordinate=function(){return this.getCoordinates()};var Ed=function(yr,el){vd.call(this,yr,el)};(Ed.prototype=Object.create(vd.prototype)).isValid=function(){return this.coordinates.length>1},Ed.prototype.addCoordinate=function(yr,el,yh){this.changed();var Uh=parseInt(yr,10);this.coordinates.splice(Uh,0,[el,yh])},Ed.prototype.getCoordinate=function(yr){var el=parseInt(yr,10);return JSON.parse(JSON.stringify(this.coordinates[el]))},Ed.prototype.removeCoordinate=function(yr){this.changed(),this.coordinates.splice(parseInt(yr,10),1)},Ed.prototype.updateCoordinate=function(yr,el,yh){var Uh=parseInt(yr,10);this.coordinates[Uh]=[el,yh],this.changed()};var Sd=function(yr,el){vd.call(this,yr,el),this.coordinates=this.coordinates.map(function(yh){return yh.slice(0,-1)})};(Sd.prototype=Object.create(vd.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(yr){return yr.length>2})},Sd.prototype.incomingCoords=function(yr){this.coordinates=yr.map(function(el){return el.slice(0,-1)}),this.changed()},Sd.prototype.setCoordinates=function(yr){this.coordinates=yr,this.changed()},Sd.prototype.addCoordinate=function(yr,el,yh){this.changed();var Uh=yr.split(".").map(function(nd){return parseInt(nd,10)});this.coordinates[Uh[0]].splice(Uh[1],0,[el,yh])},Sd.prototype.removeCoordinate=function(yr){this.changed();var el=yr.split(".").map(function(Uh){return parseInt(Uh,10)}),yh=this.coordinates[el[0]];yh&&(yh.splice(el[1],1),yh.length<3&&this.coordinates.splice(el[0],1))},Sd.prototype.getCoordinate=function(yr){var el=yr.split(".").map(function(Uh){return parseInt(Uh,10)}),yh=this.coordinates[el[0]];return JSON.parse(JSON.stringify(yh[el[1]]))},Sd.prototype.getCoordinates=function(){return this.coordinates.map(function(yr){return yr.concat([yr[0]])})},Sd.prototype.updateCoordinate=function(yr,el,yh){this.changed();var Uh=yr.split("."),nd=parseInt(Uh[0],10),od=parseInt(Uh[1],10);this.coordinates[nd]===void 0&&(this.coordinates[nd]=[]),this.coordinates[nd][od]=[el,yh]};var zd={MultiPoint:qd,MultiLineString:Ed,MultiPolygon:Sd},Md=function(yr,el,yh,Uh,nd){var od=yh.split("."),ad=parseInt(od[0],10),Gf=od[1]?od.slice(1).join("."):null;return yr[ad][el](Gf,Uh,nd)},Gd=function(yr,el){if(vd.call(this,yr,el),delete this.coordinates,this.model=zd[el.geometry.type],this.model===void 0)throw new TypeError(el.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(el.geometry.coordinates)};function bf(yr){this.map=yr.map,this.drawConfig=JSON.parse(JSON.stringify(yr.options||{})),this._ctx=yr}(Gd.prototype=Object.create(vd.prototype))._coordinatesToFeatures=function(yr){var el=this,yh=this.model.bind(this);return yr.map(function(Uh){return new yh(el.ctx,{id:Af(),type:Bt.FEATURE,properties:{},geometry:{coordinates:Uh,type:el.type.replace("Multi","")}})})},Gd.prototype.isValid=function(){return this.features.every(function(yr){return yr.isValid()})},Gd.prototype.setCoordinates=function(yr){this.features=this._coordinatesToFeatures(yr),this.changed()},Gd.prototype.getCoordinate=function(yr){return Md(this.features,"getCoordinate",yr)},Gd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(yr){return yr.type===Bt.POLYGON?yr.getCoordinates():yr.coordinates})))},Gd.prototype.updateCoordinate=function(yr,el,yh){Md(this.features,"updateCoordinate",yr,el,yh),this.changed()},Gd.prototype.addCoordinate=function(yr,el,yh){Md(this.features,"addCoordinate",yr,el,yh),this.changed()},Gd.prototype.removeCoordinate=function(yr){Md(this.features,"removeCoordinate",yr),this.changed()},Gd.prototype.getFeatures=function(){return this.features},bf.prototype.setSelected=function(yr){return this._ctx.store.setSelected(yr)},bf.prototype.setSelectedCoordinates=function(yr){var el=this;this._ctx.store.setSelectedCoordinates(yr),yr.reduce(function(yh,Uh){return yh[Uh.feature_id]===void 0&&(yh[Uh.feature_id]=!0,el._ctx.store.get(Uh.feature_id).changed()),yh},{})},bf.prototype.getSelected=function(){return this._ctx.store.getSelected()},bf.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},bf.prototype.isSelected=function(yr){return this._ctx.store.isSelected(yr)},bf.prototype.getFeature=function(yr){return this._ctx.store.get(yr)},bf.prototype.select=function(yr){return this._ctx.store.select(yr)},bf.prototype.deselect=function(yr){return this._ctx.store.deselect(yr)},bf.prototype.deleteFeature=function(yr,el){return el===void 0&&(el={}),this._ctx.store.delete(yr,el)},bf.prototype.addFeature=function(yr){return this._ctx.store.add(yr)},bf.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},bf.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},bf.prototype.setActionableState=function(yr){yr===void 0&&(yr={});var el={trash:yr.trash||!1,combineFeatures:yr.combineFeatures||!1,uncombineFeatures:yr.uncombineFeatures||!1};return this._ctx.events.actionable(el)},bf.prototype.changeMode=function(yr,el,yh){return el===void 0&&(el={}),yh===void 0&&(yh={}),this._ctx.events.changeMode(yr,el,yh)},bf.prototype.updateUIClasses=function(yr){return this._ctx.ui.queueMapClasses(yr)},bf.prototype.activateUIButton=function(yr){return this._ctx.ui.setActiveButton(yr)},bf.prototype.featuresAt=function(yr,el,yh){if(yh===void 0&&(yh="click"),yh!=="click"&&yh!=="touch")throw new Error("invalid buffer type");return Ih[yh](yr,el,this._ctx)},bf.prototype.newFeature=function(yr){var el=yr.geometry.type;return el===Bt.POINT?new qd(this._ctx,yr):el===Bt.LINE_STRING?new Ed(this._ctx,yr):el===Bt.POLYGON?new Sd(this._ctx,yr):new Gd(this._ctx,yr)},bf.prototype.isInstanceOf=function(yr,el){if(yr===Bt.POINT)return el instanceof qd;if(yr===Bt.LINE_STRING)return el instanceof Ed;if(yr===Bt.POLYGON)return el instanceof Sd;if(yr==="MultiFeature")return el instanceof Gd;throw new Error("Unknown feature class: "+yr)},bf.prototype.doRender=function(yr){return this._ctx.store.featureChanged(yr)},bf.prototype.onSetup=function(){},bf.prototype.onDrag=function(){},bf.prototype.onClick=function(){},bf.prototype.onMouseMove=function(){},bf.prototype.onMouseDown=function(){},bf.prototype.onMouseUp=function(){},bf.prototype.onMouseOut=function(){},bf.prototype.onKeyUp=function(){},bf.prototype.onKeyDown=function(){},bf.prototype.onTouchStart=function(){},bf.prototype.onTouchMove=function(){},bf.prototype.onTouchEnd=function(){},bf.prototype.onTap=function(){},bf.prototype.onStop=function(){},bf.prototype.onTrash=function(){},bf.prototype.onCombineFeature=function(){},bf.prototype.onUncombineFeature=function(){},bf.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Id={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},td=Object.keys(Id);function Fd(yr){var el=Object.keys(yr);return function(yh,Uh){Uh===void 0&&(Uh={});var nd={},od=el.reduce(function(ad,Gf){return ad[Gf]=yr[Gf],ad},new bf(yh));return{start:function(){var ad=this;nd=od.onSetup(Uh),td.forEach(function(Gf){var Ef,_p=Id[Gf],ap=function(){return!1};yr[_p]&&(ap=function(){return!0}),ad.on(Gf,ap,(Ef=_p,function(lp){return od[Ef](nd,lp)}))})},stop:function(){od.onStop(nd)},trash:function(){od.onTrash(nd)},combineFeatures:function(){od.onCombineFeatures(nd)},uncombineFeatures:function(){od.onUncombineFeatures(nd)},render:function(ad,Gf){od.toDisplayFeatures(nd,ad,Gf)}}}}function rp(yr){return[].concat(yr).filter(function(el){return el!==void 0})}function jf(){var yr=this;if(!(yr.ctx.map&&yr.ctx.map.getSource(Y.HOT)!==void 0))return Ef();var el=yr.ctx.events.currentModeName();yr.ctx.ui.queueMapClasses({mode:el});var yh=[],Uh=[];yr.isDirty?Uh=yr.getAllIds():(yh=yr.getChangedIds().filter(function(_p){return yr.get(_p)!==void 0}),Uh=yr.sources.hot.filter(function(_p){return _p.properties.id&&yh.indexOf(_p.properties.id)===-1&&yr.get(_p.properties.id)!==void 0}).map(function(_p){return _p.properties.id})),yr.sources.hot=[];var nd=yr.sources.cold.length;yr.sources.cold=yr.isDirty?[]:yr.sources.cold.filter(function(_p){var ap=_p.properties.id||_p.properties.parent;return yh.indexOf(ap)===-1});var od=nd!==yr.sources.cold.length||Uh.length>0;function ad(_p,ap){var lp=yr.get(_p).internal(el);yr.ctx.events.currentModeRender(lp,function(Zp){yr.sources[ap].push(Zp)})}if(yh.forEach(function(_p){return ad(_p,"hot")}),Uh.forEach(function(_p){return ad(_p,"cold")}),od&&yr.ctx.map.getSource(Y.COLD).setData({type:Bt.FEATURE_COLLECTION,features:yr.sources.cold}),yr.ctx.map.getSource(Y.HOT).setData({type:Bt.FEATURE_COLLECTION,features:yr.sources.hot}),yr._emitSelectionChange&&(yr.ctx.map.fire(kn.SELECTION_CHANGE,{features:yr.getSelected().map(function(_p){return _p.toGeoJSON()}),points:yr.getSelectedCoordinates().map(function(_p){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:_p.coordinates}}})}),yr._emitSelectionChange=!1),yr._deletedFeaturesToEmit.length){var Gf=yr._deletedFeaturesToEmit.map(function(_p){return _p.toGeoJSON()});yr._deletedFeaturesToEmit=[],yr.ctx.map.fire(kn.DELETE,{features:Gf})}function Ef(){yr.isDirty=!1,yr.clearChangedIds()}Ef(),yr.ctx.map.fire(kn.RENDER,{})}function yd(yr){var el,yh=this;this._features={},this._featureIds=new sh,this._selectedFeatureIds=new sh,this._selectedCoordinates=[],this._changedFeatureIds=new sh,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=yr,this.sources={hot:[],cold:[]},this.render=function(){el||(el=requestAnimationFrame(function(){el=null,jf.call(yh)}))},this.isDirty=!1}function Jd(yr,el){var yh=yr._selectedCoordinates.filter(function(Uh){return yr._selectedFeatureIds.has(Uh.feature_id)});yr._selectedCoordinates.length===yh.length||el.silent||(yr._emitSelectionChange=!0),yr._selectedCoordinates=yh}yd.prototype.createRenderBatch=function(){var yr=this,el=this.render,yh=0;return this.render=function(){yh++},function(){yr.render=el,yh>0&&yr.render()}},yd.prototype.setDirty=function(){return this.isDirty=!0,this},yd.prototype.featureChanged=function(yr){return this._changedFeatureIds.add(yr),this},yd.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},yd.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},yd.prototype.getAllIds=function(){return this._featureIds.values()},yd.prototype.add=function(yr){return this.featureChanged(yr.id),this._features[yr.id]=yr,this._featureIds.add(yr.id),this},yd.prototype.delete=function(yr,el){var yh=this;return el===void 0&&(el={}),rp(yr).forEach(function(Uh){yh._featureIds.has(Uh)&&(yh._featureIds.delete(Uh),yh._selectedFeatureIds.delete(Uh),el.silent||yh._deletedFeaturesToEmit.indexOf(yh._features[Uh])===-1&&yh._deletedFeaturesToEmit.push(yh._features[Uh]),delete yh._features[Uh],yh.isDirty=!0)}),Jd(this,el),this},yd.prototype.get=function(yr){return this._features[yr]},yd.prototype.getAll=function(){var yr=this;return Object.keys(this._features).map(function(el){return yr._features[el]})},yd.prototype.select=function(yr,el){var yh=this;return el===void 0&&(el={}),rp(yr).forEach(function(Uh){yh._selectedFeatureIds.has(Uh)||(yh._selectedFeatureIds.add(Uh),yh._changedFeatureIds.add(Uh),el.silent||(yh._emitSelectionChange=!0))}),this},yd.prototype.deselect=function(yr,el){var yh=this;return el===void 0&&(el={}),rp(yr).forEach(function(Uh){yh._selectedFeatureIds.has(Uh)&&(yh._selectedFeatureIds.delete(Uh),yh._changedFeatureIds.add(Uh),el.silent||(yh._emitSelectionChange=!0))}),Jd(this,el),this},yd.prototype.clearSelected=function(yr){return yr===void 0&&(yr={}),this.deselect(this._selectedFeatureIds.values(),{silent:yr.silent}),this},yd.prototype.setSelected=function(yr,el){var yh=this;return el===void 0&&(el={}),yr=rp(yr),this.deselect(this._selectedFeatureIds.values().filter(function(Uh){return yr.indexOf(Uh)===-1}),{silent:el.silent}),this.select(yr.filter(function(Uh){return!yh._selectedFeatureIds.has(Uh)}),{silent:el.silent}),this},yd.prototype.setSelectedCoordinates=function(yr){return this._selectedCoordinates=yr,this._emitSelectionChange=!0,this},yd.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},yd.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},yd.prototype.getSelected=function(){var yr=this;return this._selectedFeatureIds.values().map(function(el){return yr.get(el)})},yd.prototype.getSelectedCoordinates=function(){var yr=this;return this._selectedCoordinates.map(function(el){return{coordinates:yr.get(el.feature_id).getCoordinate(el.coord_path)}})},yd.prototype.isSelected=function(yr){return this._selectedFeatureIds.has(yr)},yd.prototype.setFeatureProperty=function(yr,el,yh){this.get(yr).setProperty(el,yh),this.featureChanged(yr)},yd.prototype.storeMapConfig=function(){var yr=this;as.forEach(function(el){yr.ctx.map[el]&&(yr._mapInitialConfig[el]=yr.ctx.map[el].isEnabled())})},yd.prototype.restoreMapConfig=function(){var yr=this;Object.keys(this._mapInitialConfig).forEach(function(el){yr._mapInitialConfig[el]?yr.ctx.map[el].enable():yr.ctx.map[el].disable()})},yd.prototype.getInitialConfigValue=function(yr){return this._mapInitialConfig[yr]===void 0||this._mapInitialConfig[yr]};var op=function(){for(var yr=arguments,el={},yh=0;yh<arguments.length;yh++){var Uh=yr[yh];for(var nd in Uh)bp.call(Uh,nd)&&(el[nd]=Uh[nd])}return el},bp=Object.prototype.hasOwnProperty,fp=["mode","feature","mouse"];function Qh(yr){var el=null,yh=null,Uh={onRemove:function(){return yr.map.off("load",Uh.connect),clearInterval(yh),Uh.removeLayers(),yr.store.restoreMapConfig(),yr.ui.removeButtons(),yr.events.removeEventListeners(),yr.ui.clearMapClasses(),yr.map=null,yr.container=null,yr.store=null,el&&el.parentNode&&el.parentNode.removeChild(el),el=null,this},connect:function(){yr.map.off("load",Uh.connect),clearInterval(yh),Uh.addLayers(),yr.store.storeMapConfig(),yr.events.addEventListeners()},onAdd:function(nd){var od=nd.fire;return nd.fire=function(ad,Gf){var Ef=arguments;return od.length===1&&arguments.length!==1&&(Ef=[op({},{type:ad},Gf)]),od.apply(nd,Ef)},yr.map=nd,yr.events=function(ad){var Gf=Object.keys(ad.options.modes).reduce(function(kf,Tp){return kf[Tp]=Fd(ad.options.modes[Tp]),kf},{}),Ef={},_p={},ap={},lp=null,Zp=null;ap.drag=function(kf,Tp){Tp({point:kf.point,time:new Date().getTime()})?(ad.ui.queueMapClasses({mouse:ze.DRAG}),Zp.drag(kf)):kf.originalEvent.stopPropagation()},ap.mousedrag=function(kf){ap.drag(kf,function(Tp){return!Tf(Ef,Tp)})},ap.touchdrag=function(kf){ap.drag(kf,function(Tp){return!Kd(_p,Tp)})},ap.mousemove=function(kf){if((kf.originalEvent.buttons!==void 0?kf.originalEvent.buttons:kf.originalEvent.which)===1)return ap.mousedrag(kf);var Tp=Gh(kf,ad);kf.featureTarget=Tp,Zp.mousemove(kf)},ap.mousedown=function(kf){Ef={time:new Date().getTime(),point:kf.point};var Tp=Gh(kf,ad);kf.featureTarget=Tp,Zp.mousedown(kf)},ap.mouseup=function(kf){var Tp=Gh(kf,ad);kf.featureTarget=Tp,Tf(Ef,{point:kf.point,time:new Date().getTime()})?Zp.click(kf):Zp.mouseup(kf)},ap.mouseout=function(kf){Zp.mouseout(kf)},ap.touchstart=function(kf){if(kf.originalEvent.preventDefault(),ad.options.touchEnabled){_p={time:new Date().getTime(),point:kf.point};var Tp=Ih.touch(kf,null,ad)[0];kf.featureTarget=Tp,Zp.touchstart(kf)}},ap.touchmove=function(kf){if(kf.originalEvent.preventDefault(),ad.options.touchEnabled)return Zp.touchmove(kf),ap.touchdrag(kf)},ap.touchend=function(kf){if(kf.originalEvent.preventDefault(),ad.options.touchEnabled){var Tp=Ih.touch(kf,null,ad)[0];kf.featureTarget=Tp,Kd(_p,{time:new Date().getTime(),point:kf.point})?Zp.tap(kf):Zp.touchend(kf)}};var Rm=function(kf){return!(kf===8||kf===46||kf>=48&&kf<=57)};function Yp(kf,Tp,Np){Np===void 0&&(Np={}),Zp.stop();var Jm=Gf[kf];if(Jm===void 0)throw new Error(kf+" is not valid");lp=kf;var Um=Jm(ad,Tp);Zp=r(Um,ad),Np.silent||ad.map.fire(kn.MODE_CHANGE,{mode:kf}),ad.store.setDirty(),ad.store.render()}ap.keydown=function(kf){(kf.srcElement||kf.target).classList[0]==="mapboxgl-canvas"&&(kf.keyCode!==8&&kf.keyCode!==46||!ad.options.controls.trash?Rm(kf.keyCode)?Zp.keydown(kf):kf.keyCode===49&&ad.options.controls.point?Yp(Ur.DRAW_POINT):kf.keyCode===50&&ad.options.controls.line_string?Yp(Ur.DRAW_LINE_STRING):kf.keyCode===51&&ad.options.controls.polygon&&Yp(Ur.DRAW_POLYGON):(kf.preventDefault(),Zp.trash()))},ap.keyup=function(kf){Rm(kf.keyCode)&&Zp.keyup(kf)},ap.zoomend=function(){ad.store.changeZoom()},ap.data=function(kf){if(kf.dataType==="style"){var Tp=ad.setup,Np=ad.map,Jm=ad.options,Um=ad.store;Jm.styles.some(function(bg){return Np.getLayer(bg.id)})||(Tp.addLayers(),Um.setDirty(),Um.render())}};var Pm={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){lp=ad.options.defaultMode,Zp=r(Gf[lp](ad),ad)},changeMode:Yp,actionable:function(kf){var Tp=!1;Object.keys(kf).forEach(function(Np){if(Pm[Np]===void 0)throw new Error("Invalid action type");Pm[Np]!==kf[Np]&&(Tp=!0),Pm[Np]=kf[Np]}),Tp&&ad.map.fire(kn.ACTIONABLE,{actions:Pm})},currentModeName:function(){return lp},currentModeRender:function(kf,Tp){return Zp.render(kf,Tp)},fire:function(kf,Tp){ap[kf]&&ap[kf](Tp)},addEventListeners:function(){ad.map.on("mousemove",ap.mousemove),ad.map.on("mousedown",ap.mousedown),ad.map.on("mouseup",ap.mouseup),ad.map.on("data",ap.data),ad.map.on("touchmove",ap.touchmove),ad.map.on("touchstart",ap.touchstart),ad.map.on("touchend",ap.touchend),ad.container.addEventListener("mouseout",ap.mouseout),ad.options.keybindings&&(ad.container.addEventListener("keydown",ap.keydown),ad.container.addEventListener("keyup",ap.keyup))},removeEventListeners:function(){ad.map.off("mousemove",ap.mousemove),ad.map.off("mousedown",ap.mousedown),ad.map.off("mouseup",ap.mouseup),ad.map.off("data",ap.data),ad.map.off("touchmove",ap.touchmove),ad.map.off("touchstart",ap.touchstart),ad.map.off("touchend",ap.touchend),ad.container.removeEventListener("mouseout",ap.mouseout),ad.options.keybindings&&(ad.container.removeEventListener("keydown",ap.keydown),ad.container.removeEventListener("keyup",ap.keyup))},trash:function(kf){Zp.trash(kf)},combineFeatures:function(){Zp.combineFeatures()},uncombineFeatures:function(){Zp.uncombineFeatures()},getMode:function(){return lp}}}(yr),yr.ui=function(ad){var Gf={},Ef=null,_p={mode:null,feature:null,mouse:null},ap={mode:null,feature:null,mouse:null};function lp(kf){ap=op(ap,kf)}function Zp(){var kf,Tp;if(ad.container){var Np=[],Jm=[];fp.forEach(function(Um){ap[Um]!==_p[Um]&&(Np.push(Um+"-"+_p[Um]),ap[Um]!==null&&Jm.push(Um+"-"+ap[Um]))}),Np.length>0&&(kf=ad.container.classList).remove.apply(kf,Np),Jm.length>0&&(Tp=ad.container.classList).add.apply(Tp,Jm),_p=op(_p,ap)}}function Rm(kf,Tp){Tp===void 0&&(Tp={});var Np=document.createElement("button");return Np.className=P.CONTROL_BUTTON+" "+Tp.className,Np.setAttribute("title",Tp.title),Tp.container.appendChild(Np),Np.addEventListener("click",function(Jm){if(Jm.preventDefault(),Jm.stopPropagation(),Jm.target===Ef)return Yp(),void Tp.onDeactivate();Pm(kf),Tp.onActivate()},!0),Np}function Yp(){Ef&&(Ef.classList.remove(P.ACTIVE_BUTTON),Ef=null)}function Pm(kf){Yp();var Tp=Gf[kf];Tp&&Tp&&kf!=="trash"&&(Tp.classList.add(P.ACTIVE_BUTTON),Ef=Tp)}return{setActiveButton:Pm,queueMapClasses:lp,updateMapClasses:Zp,clearMapClasses:function(){lp({mode:null,feature:null,mouse:null}),Zp()},addButtons:function(){var kf=ad.options.controls,Tp=document.createElement("div");return Tp.className=P.CONTROL_GROUP+" "+P.CONTROL_BASE,kf&&(kf[ge.LINE]&&(Gf[ge.LINE]=Rm(ge.LINE,{container:Tp,className:P.CONTROL_BUTTON_LINE,title:"LineString tool "+(ad.options.keybindings?"(l)":""),onActivate:function(){return ad.events.changeMode(Ur.DRAW_LINE_STRING)},onDeactivate:function(){return ad.events.trash()}})),kf[ge.POLYGON]&&(Gf[ge.POLYGON]=Rm(ge.POLYGON,{container:Tp,className:P.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(ad.options.keybindings?"(p)":""),onActivate:function(){return ad.events.changeMode(Ur.DRAW_POLYGON)},onDeactivate:function(){return ad.events.trash()}})),kf[ge.POINT]&&(Gf[ge.POINT]=Rm(ge.POINT,{container:Tp,className:P.CONTROL_BUTTON_POINT,title:"Marker tool "+(ad.options.keybindings?"(m)":""),onActivate:function(){return ad.events.changeMode(Ur.DRAW_POINT)},onDeactivate:function(){return ad.events.trash()}})),kf.trash&&(Gf.trash=Rm("trash",{container:Tp,className:P.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){ad.events.trash()}})),kf.combine_features&&(Gf.combine_features=Rm("combineFeatures",{container:Tp,className:P.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){ad.events.combineFeatures()}})),kf.uncombine_features&&(Gf.uncombine_features=Rm("uncombineFeatures",{container:Tp,className:P.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){ad.events.uncombineFeatures()}}))),Tp},removeButtons:function(){Object.keys(Gf).forEach(function(kf){var Tp=Gf[kf];Tp.parentNode&&Tp.parentNode.removeChild(Tp),delete Gf[kf]})}}}(yr),yr.container=nd.getContainer(),yr.store=new yd(yr),el=yr.ui.addButtons(),yr.options.boxSelect&&(nd.boxZoom.disable(),nd.dragPan.disable(),nd.dragPan.enable()),nd.loaded()?Uh.connect():(nd.on("load",Uh.connect),yh=setInterval(function(){nd.loaded()&&Uh.connect()},16)),yr.events.start(),el},addLayers:function(){yr.map.addSource(Y.COLD,{data:{type:Bt.FEATURE_COLLECTION,features:[]},type:"geojson"}),yr.map.addSource(Y.HOT,{data:{type:Bt.FEATURE_COLLECTION,features:[]},type:"geojson"}),yr.options.styles.forEach(function(nd){yr.map.addLayer(nd)}),yr.store.setDirty(!0),yr.store.render()},removeLayers:function(){yr.options.styles.forEach(function(nd){yr.map.getLayer(nd.id)&&yr.map.removeLayer(nd.id)}),yr.map.getSource(Y.COLD)&&yr.map.removeSource(Y.COLD),yr.map.getSource(Y.HOT)&&yr.map.removeSource(Y.HOT)}};return yr.setup=Uh,Uh}var Yd=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function sd(yr){return function(el){var yh=el.featureTarget;return!!yh&&!!yh.properties&&yh.properties.meta===yr}}function Zd(yr){return!!yr.originalEvent&&!!yr.originalEvent.shiftKey&&yr.originalEvent.button===0}function Xh(yr){return!!yr.featureTarget&&!!yr.featureTarget.properties&&yr.featureTarget.properties.active===Co.ACTIVE&&yr.featureTarget.properties.meta===rl.FEATURE}function Ld(yr){return!!yr.featureTarget&&!!yr.featureTarget.properties&&yr.featureTarget.properties.active===Co.INACTIVE&&yr.featureTarget.properties.meta===rl.FEATURE}function Kf(yr){return yr.featureTarget===void 0}function If(yr){return!!yr.featureTarget&&!!yr.featureTarget.properties&&yr.featureTarget.properties.meta===rl.FEATURE}function Df(yr){var el=yr.featureTarget;return!!el&&!!el.properties&&el.properties.meta===rl.VERTEX}function Jf(yr){return!!yr.originalEvent&&yr.originalEvent.shiftKey===!0}function Nf(yr){return yr.keyCode===27}function Wf(yr){return yr.keyCode===13}var Mp=Object.freeze({__proto__:null,isOfMetaType:sd,isShiftMousedown:Zd,isActiveFeature:Xh,isInactiveFeature:Ld,noTarget:Kf,isFeature:If,isVertex:Df,isShiftDown:Jf,isEscapeKey:Nf,isEnterKey:Wf,isTrue:function(){return!0}}),Sp=Pp;function Pp(yr,el){this.x=yr,this.y=el}function Yf(yr,el){var yh=el.getBoundingClientRect();return new Sp(yr.clientX-yh.left-(el.clientLeft||0),yr.clientY-yh.top-(el.clientTop||0))}function qp(yr,el,yh,Uh){return{type:Bt.FEATURE,properties:{meta:rl.VERTEX,parent:yr,coord_path:yh,active:Uh?Co.ACTIVE:Co.INACTIVE},geometry:{type:Bt.POINT,coordinates:el}}}function sm(yr,el,yh){var Uh=el.geometry.coordinates,nd=yh.geometry.coordinates;if(Uh[1]>85||Uh[1]<$s||nd[1]>85||nd[1]<$s)return null;var od={lng:(Uh[0]+nd[0])/2,lat:(Uh[1]+nd[1])/2};return{type:Bt.FEATURE,properties:{meta:rl.MIDPOINT,parent:yr,lng:od.lng,lat:od.lat,coord_path:yh.properties.coord_path},geometry:{type:Bt.POINT,coordinates:[od.lng,od.lat]}}}function Xd(yr,el,yh){el===void 0&&(el={}),yh===void 0&&(yh=null);var Uh,nd=yr.geometry,od=nd.type,ad=nd.coordinates,Gf=yr.properties&&yr.properties.id,Ef=[];function _p(lp,Zp){var Rm="",Yp=null;lp.forEach(function(Pm,kf){var Tp=Zp!=null?Zp+"."+kf:String(kf),Np=qp(Gf,Pm,Tp,ap(Tp));if(el.midpoints&&Yp){var Jm=sm(Gf,Yp,Np);Jm&&Ef.push(Jm)}Yp=Np;var Um=JSON.stringify(Pm);Rm!==Um&&Ef.push(Np),kf===0&&(Rm=Um)})}function ap(lp){return!!el.selectedPaths&&el.selectedPaths.indexOf(lp)!==-1}return od===Bt.POINT?Ef.push(qp(Gf,ad,yh,ap(yh))):od===Bt.POLYGON?ad.forEach(function(lp,Zp){_p(lp,yh!==null?yh+"."+Zp:String(Zp))}):od===Bt.LINE_STRING?_p(ad,yh):od.indexOf(Bt.MULTI_PREFIX)===0&&(Uh=od.replace(Bt.MULTI_PREFIX,""),ad.forEach(function(lp,Zp){var Rm={type:Bt.FEATURE,properties:yr.properties,geometry:{type:Uh,coordinates:lp}};Ef=Ef.concat(Xd(Rm,el,Zp))})),Ef}Pp.prototype={clone:function(){return new Pp(this.x,this.y)},add:function(yr){return this.clone()._add(yr)},sub:function(yr){return this.clone()._sub(yr)},multByPoint:function(yr){return this.clone()._multByPoint(yr)},divByPoint:function(yr){return this.clone()._divByPoint(yr)},mult:function(yr){return this.clone()._mult(yr)},div:function(yr){return this.clone()._div(yr)},rotate:function(yr){return this.clone()._rotate(yr)},rotateAround:function(yr,el){return this.clone()._rotateAround(yr,el)},matMult:function(yr){return this.clone()._matMult(yr)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(yr){return this.x===yr.x&&this.y===yr.y},dist:function(yr){return Math.sqrt(this.distSqr(yr))},distSqr:function(yr){var el=yr.x-this.x,yh=yr.y-this.y;return el*el+yh*yh},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(yr){return Math.atan2(this.y-yr.y,this.x-yr.x)},angleWith:function(yr){return this.angleWithSep(yr.x,yr.y)},angleWithSep:function(yr,el){return Math.atan2(this.x*el-this.y*yr,this.x*yr+this.y*el)},_matMult:function(yr){var el=yr[0]*this.x+yr[1]*this.y,yh=yr[2]*this.x+yr[3]*this.y;return this.x=el,this.y=yh,this},_add:function(yr){return this.x+=yr.x,this.y+=yr.y,this},_sub:function(yr){return this.x-=yr.x,this.y-=yr.y,this},_mult:function(yr){return this.x*=yr,this.y*=yr,this},_div:function(yr){return this.x/=yr,this.y/=yr,this},_multByPoint:function(yr){return this.x*=yr.x,this.y*=yr.y,this},_divByPoint:function(yr){return this.x/=yr.x,this.y/=yr.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var yr=this.y;return this.y=this.x,this.x=-yr,this},_rotate:function(yr){var el=Math.cos(yr),yh=Math.sin(yr),Uh=el*this.x-yh*this.y,nd=yh*this.x+el*this.y;return this.x=Uh,this.y=nd,this},_rotateAround:function(yr,el){var yh=Math.cos(yr),Uh=Math.sin(yr),nd=el.x+yh*(this.x-el.x)-Uh*(this.y-el.y),od=el.y+Uh*(this.x-el.x)+yh*(this.y-el.y);return this.x=nd,this.y=od,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pp.convert=function(yr){return yr instanceof Pp?yr:Array.isArray(yr)?new Pp(yr[0],yr[1]):yr};var Op={enable:function(yr){setTimeout(function(){yr.map&&yr.map.doubleClickZoom&&yr._ctx&&yr._ctx.store&&yr._ctx.store.getInitialConfigValue&&yr._ctx.store.getInitialConfigValue("doubleClickZoom")&&yr.map.doubleClickZoom.enable()},0)},disable:function(yr){setTimeout(function(){yr.map&&yr.map.doubleClickZoom&&yr.map.doubleClickZoom.disable()},0)}},rm={},Sm={get exports(){return rm},set exports(yr){rm=yr}},hp=function(yr){if(!yr||!yr.type)return null;var el=Em[yr.type];if(!el)return null;if(el==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:yr}]};if(el==="feature")return{type:"FeatureCollection",features:[yr]};if(el==="featurecollection")return yr},Em={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Qp=Object.freeze({__proto__:null,default:function yr(el){switch(el&&el.type||null){case"FeatureCollection":return el.features=el.features.reduce(function(yh,Uh){return yh.concat(yr(Uh))},[]),el;case"Feature":return el.geometry?yr(el.geometry).map(function(yh){var Uh={type:"Feature",properties:JSON.parse(JSON.stringify(el.properties)),geometry:yh};return el.id!==void 0&&(Uh.id=el.id),Uh}):[el];case"MultiPoint":return el.coordinates.map(function(yh){return{type:"Point",coordinates:yh}});case"MultiPolygon":return el.coordinates.map(function(yh){return{type:"Polygon",coordinates:yh}});case"MultiLineString":return el.coordinates.map(function(yh){return{type:"LineString",coordinates:yh}});case"GeometryCollection":return el.geometries.map(yr).reduce(function(yh,Uh){return yh.concat(Uh)},[]);case"Point":case"Polygon":case"LineString":return[el]}}}),lm=hp,Dd=n(Qp),Hf=function(yr){return function el(yh){return Array.isArray(yh)&&yh.length&&typeof yh[0]=="number"?[yh]:yh.reduce(function(Uh,nd){return Array.isArray(nd)&&Array.isArray(nd[0])?Uh.concat(el(nd)):(Uh.push(nd),Uh)},[])}(yr)};Dd instanceof Function||(Dd=Dd.default);var mh={},Jh={get exports(){return mh},set exports(yr){mh=yr}}.exports=function(yr){return new Wu(yr)};function Wu(yr){this.value=yr}function sl(yr,el,yh){var Uh=[],nd=[],od=!0;return function ad(Gf){var Ef=yh?Gn(Gf):Gf,_p={},ap=!0,lp={node:Ef,node_:Gf,path:[].concat(Uh),parent:nd[nd.length-1],parents:nd,key:Uh.slice(-1)[0],isRoot:Uh.length===0,level:Uh.length,circular:null,update:function(Yp,Pm){lp.isRoot||(lp.parent.node[lp.key]=Yp),lp.node=Yp,Pm&&(ap=!1)},delete:function(Yp){delete lp.parent.node[lp.key],Yp&&(ap=!1)},remove:function(Yp){$u(lp.parent.node)?lp.parent.node.splice(lp.key,1):delete lp.parent.node[lp.key],Yp&&(ap=!1)},keys:null,before:function(Yp){_p.before=Yp},after:function(Yp){_p.after=Yp},pre:function(Yp){_p.pre=Yp},post:function(Yp){_p.post=Yp},stop:function(){od=!1},block:function(){ap=!1}};if(!od)return lp;function Zp(){if(typeof lp.node=="object"&&lp.node!==null){lp.keys&&lp.node_===lp.node||(lp.keys=_n(lp.node)),lp.isLeaf=lp.keys.length==0;for(var Yp=0;Yp<nd.length;Yp++)if(nd[Yp].node_===Gf){lp.circular=nd[Yp];break}}else lp.isLeaf=!0,lp.keys=null;lp.notLeaf=!lp.isLeaf,lp.notRoot=!lp.isRoot}Zp();var Rm=el.call(lp,lp.node);return Rm!==void 0&&lp.update&&lp.update(Rm),_p.before&&_p.before.call(lp,lp.node),ap&&(typeof lp.node!="object"||lp.node===null||lp.circular||(nd.push(lp),Zp(),eh(lp.keys,function(Yp,Pm){Uh.push(Yp),_p.pre&&_p.pre.call(lp,lp.node[Yp],Yp);var kf=ad(lp.node[Yp]);yh&&nh.call(lp.node,Yp)&&(lp.node[Yp]=kf.node),kf.isLast=Pm==lp.keys.length-1,kf.isFirst=Pm==0,_p.post&&_p.post.call(lp,kf),Uh.pop()}),nd.pop()),_p.after&&_p.after.call(lp,lp.node)),lp}(yr).node}function Gn(yr){if(typeof yr=="object"&&yr!==null){var el;if($u(yr))el=[];else if(cs(yr)==="[object Date]")el=new Date(yr.getTime?yr.getTime():yr);else if(function(nd){return cs(nd)==="[object RegExp]"}(yr))el=new RegExp(yr);else if(function(nd){return cs(nd)==="[object Error]"}(yr))el={message:yr.message};else if(function(nd){return cs(nd)==="[object Boolean]"}(yr))el=new Boolean(yr);else if(function(nd){return cs(nd)==="[object Number]"}(yr))el=new Number(yr);else if(function(nd){return cs(nd)==="[object String]"}(yr))el=new String(yr);else if(Object.create&&Object.getPrototypeOf)el=Object.create(Object.getPrototypeOf(yr));else if(yr.constructor===Object)el={};else{var yh=yr.constructor&&yr.constructor.prototype||yr.__proto__||{},Uh=function(){};Uh.prototype=yh,el=new Uh}return eh(_n(yr),function(nd){el[nd]=yr[nd]}),el}return yr}Wu.prototype.get=function(yr){for(var el=this.value,yh=0;yh<yr.length;yh++){var Uh=yr[yh];if(!el||!nh.call(el,Uh)){el=void 0;break}el=el[Uh]}return el},Wu.prototype.has=function(yr){for(var el=this.value,yh=0;yh<yr.length;yh++){var Uh=yr[yh];if(!el||!nh.call(el,Uh))return!1;el=el[Uh]}return!0},Wu.prototype.set=function(yr,el){for(var yh=this.value,Uh=0;Uh<yr.length-1;Uh++){var nd=yr[Uh];nh.call(yh,nd)||(yh[nd]={}),yh=yh[nd]}return yh[yr[Uh]]=el,el},Wu.prototype.map=function(yr){return sl(this.value,yr,!0)},Wu.prototype.forEach=function(yr){return this.value=sl(this.value,yr,!1),this.value},Wu.prototype.reduce=function(yr,el){var yh=arguments.length===1,Uh=yh?this.value:el;return this.forEach(function(nd){this.isRoot&&yh||(Uh=yr.call(this,Uh,nd))}),Uh},Wu.prototype.paths=function(){var yr=[];return this.forEach(function(el){yr.push(this.path)}),yr},Wu.prototype.nodes=function(){var yr=[];return this.forEach(function(el){yr.push(this.node)}),yr},Wu.prototype.clone=function(){var yr=[],el=[];return function yh(Uh){for(var nd=0;nd<yr.length;nd++)if(yr[nd]===Uh)return el[nd];if(typeof Uh=="object"&&Uh!==null){var od=Gn(Uh);return yr.push(Uh),el.push(od),eh(_n(Uh),function(ad){od[ad]=yh(Uh[ad])}),yr.pop(),el.pop(),od}return Uh}(this.value)};var _n=Object.keys||function(yr){var el=[];for(var yh in yr)el.push(yh);return el};function cs(yr){return Object.prototype.toString.call(yr)}var $u=Array.isArray||function(yr){return Object.prototype.toString.call(yr)==="[object Array]"},eh=function(yr,el){if(yr.forEach)return yr.forEach(el);for(var yh=0;yh<yr.length;yh++)el(yr[yh],yh,yr)};eh(_n(Wu.prototype),function(yr){Jh[yr]=function(el){var yh=[].slice.call(arguments,1),Uh=new Wu(el);return Uh[yr].apply(Uh,yh)}});var nh=Object.hasOwnProperty||function(yr,el){return el in yr},uh=dh;function dh(yr){if(!(this instanceof dh))return new dh(yr);this._bbox=yr||[1/0,1/0,-1/0,-1/0],this._valid=!!yr}dh.prototype.include=function(yr){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],yr[0]),this._bbox[1]=Math.min(this._bbox[1],yr[1]),this._bbox[2]=Math.max(this._bbox[2],yr[0]),this._bbox[3]=Math.max(this._bbox[3],yr[1]),this},dh.prototype.equals=function(yr){var el;return el=yr instanceof dh?yr.bbox():yr,this._bbox[0]==el[0]&&this._bbox[1]==el[1]&&this._bbox[2]==el[2]&&this._bbox[3]==el[3]},dh.prototype.center=function(yr){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},dh.prototype.union=function(yr){var el;return this._valid=!0,el=yr instanceof dh?yr.bbox():yr,this._bbox[0]=Math.min(this._bbox[0],el[0]),this._bbox[1]=Math.min(this._bbox[1],el[1]),this._bbox[2]=Math.max(this._bbox[2],el[2]),this._bbox[3]=Math.max(this._bbox[3],el[3]),this},dh.prototype.bbox=function(){return this._valid?this._bbox:null},dh.prototype.contains=function(yr){if(!yr)return this._fastContains();if(!this._valid)return null;var el=yr[0],yh=yr[1];return this._bbox[0]<=el&&this._bbox[1]<=yh&&this._bbox[2]>=el&&this._bbox[3]>=yh},dh.prototype.intersect=function(yr){return this._valid?(el=yr instanceof dh?yr.bbox():yr,!(this._bbox[0]>el[2]||this._bbox[2]<el[0]||this._bbox[3]<el[1]||this._bbox[1]>el[3])):null;var el},dh.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var yr="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",yr)},dh.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var vh=function(yr){if(!yr)return[];var el=Dd(lm(yr)),yh=[];return el.features.forEach(function(Uh){Uh.geometry&&(yh=yh.concat(Hf(Uh.geometry.coordinates)))}),yh},Ph=mh,zh=uh,Ad={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},wd=Object.keys(Ad);function Qd(yr){for(var el=zh(),yh=vh(yr),Uh=0;Uh<yh.length;Uh++)el.include(yh[Uh]);return el}Sm.exports=function(yr){return Qd(yr).bbox()},rm.polygon=function(yr){return Qd(yr).polygon()},rm.bboxify=function(yr){return Ph(yr).map(function(el){el&&wd.some(function(yh){return!!el[yh]&&Ad[yh].indexOf(el.type)!==-1})&&(el.bbox=Qd(el).bbox(),this.update(el))})};var xf=-90;function zf(yr,el){var yh=xf,Uh=90,nd=xf,od=90,ad=270,Gf=-270;yr.forEach(function(_p){var ap=rm(_p),lp=ap[1],Zp=ap[3],Rm=ap[0],Yp=ap[2];lp>yh&&(yh=lp),Zp<Uh&&(Uh=Zp),Zp>nd&&(nd=Zp),lp<od&&(od=lp),Rm<ad&&(ad=Rm),Yp>Gf&&(Gf=Yp)});var Ef=el;return yh+Ef.lat>85&&(Ef.lat=85-yh),nd+Ef.lat>90&&(Ef.lat=90-nd),Uh+Ef.lat<-85&&(Ef.lat=-85-Uh),od+Ef.lat<xf&&(Ef.lat=xf-od),ad+Ef.lng<=-270&&(Ef.lng+=360*Math.ceil(Math.abs(Ef.lng)/360)),Gf+Ef.lng>=270&&(Ef.lng-=360*Math.ceil(Math.abs(Ef.lng)/360)),Ef}function np(yr,el){var yh=zf(yr.map(function(Uh){return Uh.toGeoJSON()}),el);yr.forEach(function(Uh){var nd,od=Uh.getCoordinates(),ad=function(Ef){var _p={lng:Ef[0]+yh.lng,lat:Ef[1]+yh.lat};return[_p.lng,_p.lat]},Gf=function(Ef){return Ef.map(function(_p){return ad(_p)})};Uh.type===Bt.POINT?nd=ad(od):Uh.type===Bt.LINE_STRING||Uh.type===Bt.MULTI_POINT?nd=od.map(ad):Uh.type===Bt.POLYGON||Uh.type===Bt.MULTI_LINE_STRING?nd=od.map(Gf):Uh.type===Bt.MULTI_POLYGON&&(nd=od.map(function(Ef){return Ef.map(function(_p){return Gf(_p)})})),Uh.incomingCoords(nd)})}var Ah={onSetup:function(yr){var el=this,yh={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:yr.featureIds||[]};return this.setSelected(yh.initiallySelectedFeatureIds.filter(function(Uh){return el.getFeature(Uh)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),yh},fireUpdate:function(){this.map.fire(kn.UPDATE,{action:Io.MOVE,features:this.getSelected().map(function(yr){return yr.toGeoJSON()})})},fireActionable:function(){var yr=this,el=this.getSelected(),yh=el.filter(function(Gf){return yr.isInstanceOf("MultiFeature",Gf)}),Uh=!1;if(el.length>1){Uh=!0;var nd=el[0].type.replace("Multi","");el.forEach(function(Gf){Gf.type.replace("Multi","")!==nd&&(Uh=!1)})}var od=yh.length>0,ad=el.length>0;this.setActionableState({combineFeatures:Uh,uncombineFeatures:od,trash:ad})},getUniqueIds:function(yr){return yr.length?yr.map(function(el){return el.properties.id}).filter(function(el){return el!==void 0}).reduce(function(el,yh){return el.add(yh),el},new sh).values():[]},stopExtendedInteractions:function(yr){yr.boxSelectElement&&(yr.boxSelectElement.parentNode&&yr.boxSelectElement.parentNode.removeChild(yr.boxSelectElement),yr.boxSelectElement=null),this.map.dragPan.enable(),yr.boxSelecting=!1,yr.canBoxSelect=!1,yr.dragMoving=!1,yr.canDragMove=!1},onStop:function(){Op.enable(this)},onMouseMove:function(yr){return this.stopExtendedInteractions(yr),!0},onMouseOut:function(yr){return!yr.dragMoving||this.fireUpdate()}};Ah.onTap=Ah.onClick=function(yr,el){return Kf(el)?this.clickAnywhere(yr,el):sd(rl.VERTEX)(el)?this.clickOnVertex(yr,el):If(el)?this.clickOnFeature(yr,el):void 0},Ah.clickAnywhere=function(yr){var el=this,yh=this.getSelectedIds();yh.length&&(this.clearSelectedFeatures(),yh.forEach(function(Uh){return el.doRender(Uh)})),Op.enable(this),this.stopExtendedInteractions(yr)},Ah.clickOnVertex=function(yr,el){this.changeMode(Ur.DIRECT_SELECT,{featureId:el.featureTarget.properties.parent,coordPath:el.featureTarget.properties.coord_path,startPos:el.lngLat}),this.updateUIClasses({mouse:ze.MOVE})},Ah.startOnActiveFeature=function(yr,el){this.stopExtendedInteractions(yr),this.map.dragPan.disable(),this.doRender(el.featureTarget.properties.id),yr.canDragMove=!0,yr.dragMoveLocation=el.lngLat},Ah.clickOnFeature=function(yr,el){var yh=this;Op.disable(this),this.stopExtendedInteractions(yr);var Uh=Jf(el),nd=this.getSelectedIds(),od=el.featureTarget.properties.id,ad=this.isSelected(od);if(!Uh&&ad&&this.getFeature(od).type!==Bt.POINT)return this.changeMode(Ur.DIRECT_SELECT,{featureId:od});ad&&Uh?(this.deselect(od),this.updateUIClasses({mouse:ze.POINTER}),nd.length===1&&Op.enable(this)):!ad&&Uh?(this.select(od),this.updateUIClasses({mouse:ze.MOVE})):ad||Uh||(nd.forEach(function(Gf){return yh.doRender(Gf)}),this.setSelected(od),this.updateUIClasses({mouse:ze.MOVE})),this.doRender(od)},Ah.onMouseDown=function(yr,el){return Xh(el)?this.startOnActiveFeature(yr,el):this.drawConfig.boxSelect&&Zd(el)?this.startBoxSelect(yr,el):void 0},Ah.startBoxSelect=function(yr,el){this.stopExtendedInteractions(yr),this.map.dragPan.disable(),yr.boxSelectStartLocation=Yf(el.originalEvent,this.map.getContainer()),yr.canBoxSelect=!0},Ah.onTouchStart=function(yr,el){if(Xh(el))return this.startOnActiveFeature(yr,el)},Ah.onDrag=function(yr,el){return yr.canDragMove?this.dragMove(yr,el):this.drawConfig.boxSelect&&yr.canBoxSelect?this.whileBoxSelect(yr,el):void 0},Ah.whileBoxSelect=function(yr,el){yr.boxSelecting=!0,this.updateUIClasses({mouse:ze.ADD}),yr.boxSelectElement||(yr.boxSelectElement=document.createElement("div"),yr.boxSelectElement.classList.add(P.BOX_SELECT),this.map.getContainer().appendChild(yr.boxSelectElement));var yh=Yf(el.originalEvent,this.map.getContainer()),Uh=Math.min(yr.boxSelectStartLocation.x,yh.x),nd=Math.max(yr.boxSelectStartLocation.x,yh.x),od=Math.min(yr.boxSelectStartLocation.y,yh.y),ad=Math.max(yr.boxSelectStartLocation.y,yh.y),Gf="translate("+Uh+"px, "+od+"px)";yr.boxSelectElement.style.transform=Gf,yr.boxSelectElement.style.WebkitTransform=Gf,yr.boxSelectElement.style.width=nd-Uh+"px",yr.boxSelectElement.style.height=ad-od+"px"},Ah.dragMove=function(yr,el){yr.dragMoving=!0,el.originalEvent.stopPropagation();var yh={lng:el.lngLat.lng-yr.dragMoveLocation.lng,lat:el.lngLat.lat-yr.dragMoveLocation.lat};np(this.getSelected(),yh),yr.dragMoveLocation=el.lngLat},Ah.onTouchEnd=Ah.onMouseUp=function(yr,el){var yh=this;if(yr.dragMoving)this.fireUpdate();else if(yr.boxSelecting){var Uh=[yr.boxSelectStartLocation,Yf(el.originalEvent,this.map.getContainer())],nd=this.featuresAt(null,Uh,"click"),od=this.getUniqueIds(nd).filter(function(ad){return!yh.isSelected(ad)});od.length&&(this.select(od),od.forEach(function(ad){return yh.doRender(ad)}),this.updateUIClasses({mouse:ze.MOVE}))}this.stopExtendedInteractions(yr)},Ah.toDisplayFeatures=function(yr,el,yh){el.properties.active=this.isSelected(el.properties.id)?Co.ACTIVE:Co.INACTIVE,yh(el),this.fireActionable(),el.properties.active===Co.ACTIVE&&el.geometry.type!==Bt.POINT&&Xd(el).forEach(yh)},Ah.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ah.onCombineFeatures=function(){var yr=this.getSelected();if(!(yr.length===0||yr.length<2)){for(var el=[],yh=[],Uh=yr[0].type.replace("Multi",""),nd=0;nd<yr.length;nd++){var od=yr[nd];if(od.type.replace("Multi","")!==Uh)return;od.type.includes("Multi")?od.getCoordinates().forEach(function(Gf){el.push(Gf)}):el.push(od.getCoordinates()),yh.push(od.toGeoJSON())}if(yh.length>1){var ad=this.newFeature({type:Bt.FEATURE,properties:yh[0].properties,geometry:{type:"Multi"+Uh,coordinates:el}});this.addFeature(ad),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ad.id]),this.map.fire(kn.COMBINE_FEATURES,{createdFeatures:[ad.toGeoJSON()],deletedFeatures:yh})}this.fireActionable()}},Ah.onUncombineFeatures=function(){var yr=this,el=this.getSelected();if(el.length!==0){for(var yh=[],Uh=[],nd=function(ad){var Gf=el[ad];yr.isInstanceOf("MultiFeature",Gf)&&(Gf.getFeatures().forEach(function(Ef){yr.addFeature(Ef),Ef.properties=Gf.properties,yh.push(Ef.toGeoJSON()),yr.select([Ef.id])}),yr.deleteFeature(Gf.id,{silent:!0}),Uh.push(Gf.toGeoJSON()))},od=0;od<el.length;od++)nd(od);yh.length>1&&this.map.fire(kn.UNCOMBINE_FEATURES,{createdFeatures:yh,deletedFeatures:Uh}),this.fireActionable()}};var mf=sd(rl.VERTEX),Od=sd(rl.MIDPOINT),qf={fireUpdate:function(){this.map.fire(kn.UPDATE,{action:Io.CHANGE_COORDINATES,features:this.getSelected().map(function(yr){return yr.toGeoJSON()})})},fireActionable:function(yr){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:yr.selectedCoordPaths.length>0})},startDragging:function(yr,el){this.map.dragPan.disable(),yr.canDragMove=!0,yr.dragMoveLocation=el.lngLat},stopDragging:function(yr){this.map.dragPan.enable(),yr.dragMoving=!1,yr.canDragMove=!1,yr.dragMoveLocation=null},onVertex:function(yr,el){this.startDragging(yr,el);var yh=el.featureTarget.properties,Uh=yr.selectedCoordPaths.indexOf(yh.coord_path);Jf(el)||Uh!==-1?Jf(el)&&Uh===-1&&yr.selectedCoordPaths.push(yh.coord_path):yr.selectedCoordPaths=[yh.coord_path];var nd=this.pathsToCoordinates(yr.featureId,yr.selectedCoordPaths);this.setSelectedCoordinates(nd)},onMidpoint:function(yr,el){this.startDragging(yr,el);var yh=el.featureTarget.properties;yr.feature.addCoordinate(yh.coord_path,yh.lng,yh.lat),this.fireUpdate(),yr.selectedCoordPaths=[yh.coord_path]},pathsToCoordinates:function(yr,el){return el.map(function(yh){return{feature_id:yr,coord_path:yh}})},onFeature:function(yr,el){yr.selectedCoordPaths.length===0?this.startDragging(yr,el):this.stopDragging(yr)},dragFeature:function(yr,el,yh){np(this.getSelected(),yh),yr.dragMoveLocation=el.lngLat},dragVertex:function(yr,el,yh){for(var Uh=yr.selectedCoordPaths.map(function(Gf){return yr.feature.getCoordinate(Gf)}),nd=zf(Uh.map(function(Gf){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:Gf}}}),yh),od=0;od<Uh.length;od++){var ad=Uh[od];yr.feature.updateCoordinate(yr.selectedCoordPaths[od],ad[0]+nd.lng,ad[1]+nd.lat)}},clickNoTarget:function(){this.changeMode(Ur.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Ur.SIMPLE_SELECT)},clickActiveFeature:function(yr){yr.selectedCoordPaths=[],this.clearSelectedCoordinates(),yr.feature.changed()},onSetup:function(yr){var el=yr.featureId,yh=this.getFeature(el);if(!yh)throw new Error("You must provide a featureId to enter direct_select mode");if(yh.type===Bt.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Uh={featureId:el,feature:yh,dragMoveLocation:yr.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:yr.coordPath?[yr.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(el,Uh.selectedCoordPaths)),this.setSelected(el),Op.disable(this),this.setActionableState({trash:!0}),Uh},onStop:function(){Op.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(yr,el,yh){yr.featureId===el.properties.id?(el.properties.active=Co.ACTIVE,yh(el),Xd(el,{map:this.map,midpoints:!0,selectedPaths:yr.selectedCoordPaths}).forEach(yh)):(el.properties.active=Co.INACTIVE,yh(el)),this.fireActionable(yr)},onTrash:function(yr){yr.selectedCoordPaths.sort(function(el,yh){return yh.localeCompare(el,"en",{numeric:!0})}).forEach(function(el){return yr.feature.removeCoordinate(el)}),this.fireUpdate(),yr.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(yr),yr.feature.isValid()===!1&&(this.deleteFeature([yr.featureId]),this.changeMode(Ur.SIMPLE_SELECT,{}))},onMouseMove:function(yr,el){var yh=Xh(el),Uh=mf(el),nd=yr.selectedCoordPaths.length===0;return yh&&nd||Uh&&!nd?this.updateUIClasses({mouse:ze.MOVE}):this.updateUIClasses({mouse:ze.NONE}),this.stopDragging(yr),!0},onMouseOut:function(yr){return yr.dragMoving&&this.fireUpdate(),!0}};qf.onTouchStart=qf.onMouseDown=function(yr,el){return mf(el)?this.onVertex(yr,el):Xh(el)?this.onFeature(yr,el):Od(el)?this.onMidpoint(yr,el):void 0},qf.onDrag=function(yr,el){if(yr.canDragMove===!0){yr.dragMoving=!0,el.originalEvent.stopPropagation();var yh={lng:el.lngLat.lng-yr.dragMoveLocation.lng,lat:el.lngLat.lat-yr.dragMoveLocation.lat};yr.selectedCoordPaths.length>0?this.dragVertex(yr,el,yh):this.dragFeature(yr,el,yh),yr.dragMoveLocation=el.lngLat}},qf.onClick=function(yr,el){return Kf(el)?this.clickNoTarget(yr,el):Xh(el)?this.clickActiveFeature(yr,el):Ld(el)?this.clickInactive(yr,el):void this.stopDragging(yr)},qf.onTap=function(yr,el){return Kf(el)?this.clickNoTarget(yr,el):Xh(el)?this.clickActiveFeature(yr,el):Ld(el)?this.clickInactive(yr,el):void 0},qf.onTouchEnd=qf.onMouseUp=function(yr){yr.dragMoving&&this.fireUpdate(),this.stopDragging(yr)};var mp={};function Vp(yr,el){return!!yr.lngLat&&yr.lngLat.lng===el[0]&&yr.lngLat.lat===el[1]}mp.onSetup=function(){var yr=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:[]}});return this.addFeature(yr),this.clearSelectedFeatures(),this.updateUIClasses({mouse:ze.ADD}),this.activateUIButton(ge.POINT),this.setActionableState({trash:!0}),{point:yr}},mp.stopDrawingAndRemove=function(yr){this.deleteFeature([yr.point.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)},mp.onTap=mp.onClick=function(yr,el){this.updateUIClasses({mouse:ze.MOVE}),yr.point.updateCoordinate("",el.lngLat.lng,el.lngLat.lat),this.map.fire(kn.CREATE,{features:[yr.point.toGeoJSON()]}),this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.point.id]})},mp.onStop=function(yr){this.activateUIButton(),yr.point.getCoordinate().length||this.deleteFeature([yr.point.id],{silent:!0})},mp.toDisplayFeatures=function(yr,el,yh){var Uh=el.properties.id===yr.point.id;if(el.properties.active=Uh?Co.ACTIVE:Co.INACTIVE,!Uh)return yh(el)},mp.onTrash=mp.stopDrawingAndRemove,mp.onKeyUp=function(yr,el){if(Nf(el)||Wf(el))return this.stopDrawingAndRemove(yr,el)};var om={onSetup:function(){var yr=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.POLYGON,coordinates:[[]]}});return this.addFeature(yr),this.clearSelectedFeatures(),Op.disable(this),this.updateUIClasses({mouse:ze.ADD}),this.activateUIButton(ge.POLYGON),this.setActionableState({trash:!0}),{polygon:yr,currentVertexPosition:0}},clickAnywhere:function(yr,el){if(yr.currentVertexPosition>0&&Vp(el,yr.polygon.coordinates[0][yr.currentVertexPosition-1]))return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.polygon.id]});this.updateUIClasses({mouse:ze.ADD}),yr.polygon.updateCoordinate("0."+yr.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),yr.currentVertexPosition++,yr.polygon.updateCoordinate("0."+yr.currentVertexPosition,el.lngLat.lng,el.lngLat.lat)},clickOnVertex:function(yr){return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.polygon.id]})},onMouseMove:function(yr,el){yr.polygon.updateCoordinate("0."+yr.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),Df(el)&&this.updateUIClasses({mouse:ze.POINTER})}};om.onTap=om.onClick=function(yr,el){return Df(el)?this.clickOnVertex(yr,el):this.clickAnywhere(yr,el)},om.onKeyUp=function(yr,el){Nf(el)?(this.deleteFeature([yr.polygon.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)):Wf(el)&&this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.polygon.id]})},om.onStop=function(yr){this.updateUIClasses({mouse:ze.NONE}),Op.enable(this),this.activateUIButton(),this.getFeature(yr.polygon.id)!==void 0&&(yr.polygon.removeCoordinate("0."+yr.currentVertexPosition),yr.polygon.isValid()?this.map.fire(kn.CREATE,{features:[yr.polygon.toGeoJSON()]}):(this.deleteFeature([yr.polygon.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT,{},{silent:!0})))},om.toDisplayFeatures=function(yr,el,yh){var Uh=el.properties.id===yr.polygon.id;if(el.properties.active=Uh?Co.ACTIVE:Co.INACTIVE,!Uh)return yh(el);if(el.geometry.coordinates.length!==0){var nd=el.geometry.coordinates[0].length;if(!(nd<3)){if(el.properties.meta=rl.FEATURE,yh(qp(yr.polygon.id,el.geometry.coordinates[0][0],"0.0",!1)),nd>3){var od=el.geometry.coordinates[0].length-3;yh(qp(yr.polygon.id,el.geometry.coordinates[0][od],"0."+od,!1))}if(nd<=4){var ad=[[el.geometry.coordinates[0][0][0],el.geometry.coordinates[0][0][1]],[el.geometry.coordinates[0][1][0],el.geometry.coordinates[0][1][1]]];if(yh({type:Bt.FEATURE,properties:el.properties,geometry:{coordinates:ad,type:Bt.LINE_STRING}}),nd===3)return}return yh(el)}}},om.onTrash=function(yr){this.deleteFeature([yr.polygon.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)};var Pd={onSetup:function(yr){var el,yh,Uh=(yr=yr||{}).featureId,nd="forward";if(Uh){if(!(el=this.getFeature(Uh)))throw new Error("Could not find a feature with the provided featureId");var od=yr.from;if(od&&od.type==="Feature"&&od.geometry&&od.geometry.type==="Point"&&(od=od.geometry),od&&od.type==="Point"&&od.coordinates&&od.coordinates.length===2&&(od=od.coordinates),!od||!Array.isArray(od))throw new Error("Please use the `from` property to indicate which point to continue the line from");var ad=el.coordinates.length-1;if(el.coordinates[ad][0]===od[0]&&el.coordinates[ad][1]===od[1])yh=ad+1,el.addCoordinate.apply(el,[yh].concat(el.coordinates[ad]));else{if(el.coordinates[0][0]!==od[0]||el.coordinates[0][1]!==od[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");nd="backwards",yh=0,el.addCoordinate.apply(el,[yh].concat(el.coordinates[0]))}}else el=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.LINE_STRING,coordinates:[]}}),yh=0,this.addFeature(el);return this.clearSelectedFeatures(),Op.disable(this),this.updateUIClasses({mouse:ze.ADD}),this.activateUIButton(ge.LINE),this.setActionableState({trash:!0}),{line:el,currentVertexPosition:yh,direction:nd}},clickAnywhere:function(yr,el){if(yr.currentVertexPosition>0&&Vp(el,yr.line.coordinates[yr.currentVertexPosition-1])||yr.direction==="backwards"&&Vp(el,yr.line.coordinates[yr.currentVertexPosition+1]))return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.line.id]});this.updateUIClasses({mouse:ze.ADD}),yr.line.updateCoordinate(yr.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),yr.direction==="forward"?(yr.currentVertexPosition++,yr.line.updateCoordinate(yr.currentVertexPosition,el.lngLat.lng,el.lngLat.lat)):yr.line.addCoordinate(0,el.lngLat.lng,el.lngLat.lat)},clickOnVertex:function(yr){return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.line.id]})},onMouseMove:function(yr,el){yr.line.updateCoordinate(yr.currentVertexPosition,el.lngLat.lng,el.lngLat.lat),Df(el)&&this.updateUIClasses({mouse:ze.POINTER})}};Pd.onTap=Pd.onClick=function(yr,el){if(Df(el))return this.clickOnVertex(yr,el);this.clickAnywhere(yr,el)},Pd.onKeyUp=function(yr,el){Wf(el)?this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[yr.line.id]}):Nf(el)&&(this.deleteFeature([yr.line.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT))},Pd.onStop=function(yr){Op.enable(this),this.activateUIButton(),this.getFeature(yr.line.id)!==void 0&&(yr.line.removeCoordinate(""+yr.currentVertexPosition),yr.line.isValid()?this.map.fire(kn.CREATE,{features:[yr.line.toGeoJSON()]}):(this.deleteFeature([yr.line.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT,{},{silent:!0})))},Pd.onTrash=function(yr){this.deleteFeature([yr.line.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)},Pd.toDisplayFeatures=function(yr,el,yh){var Uh=el.properties.id===yr.line.id;if(el.properties.active=Uh?Co.ACTIVE:Co.INACTIVE,!Uh)return yh(el);el.geometry.coordinates.length<2||(el.properties.meta=rl.FEATURE,yh(qp(yr.line.id,el.geometry.coordinates[yr.direction==="forward"?el.geometry.coordinates.length-2:1],""+(yr.direction==="forward"?el.geometry.coordinates.length-2:1),!1)),yh(el))};var Hg={simple_select:Ah,direct_select:qf,draw_point:mp,draw_polygon:om,draw_line_string:Pd},Fm={defaultMode:Ur.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Yd,modes:Hg,controls:{},userProperties:!1},I_={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Dy={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Pg(yr,el){return yr.map(function(yh){return yh.source?yh:op(yh,{id:yh.id+"."+el,source:el==="hot"?Y.HOT:Y.COLD})})}var l_={};(function(yr,el){var yh="__lodash_hash_undefined__",Uh=9007199254740991,nd="[object Arguments]",od="[object Array]",ad="[object Boolean]",Gf="[object Date]",Ef="[object Error]",_p="[object Function]",ap="[object Map]",lp="[object Number]",Zp="[object Object]",Rm="[object Promise]",Yp="[object RegExp]",Pm="[object Set]",kf="[object String]",Tp="[object Symbol]",Np="[object WeakMap]",Jm="[object ArrayBuffer]",Um="[object DataView]",bg=/^\[object .+?Constructor\]$/,kg=/^(?:0|[1-9]\d*)$/,$m={};$m["[object Float32Array]"]=$m["[object Float64Array]"]=$m["[object Int8Array]"]=$m["[object Int16Array]"]=$m["[object Int32Array]"]=$m["[object Uint8Array]"]=$m["[object Uint8ClampedArray]"]=$m["[object Uint16Array]"]=$m["[object Uint32Array]"]=!0,$m[nd]=$m[od]=$m[Jm]=$m[ad]=$m[Um]=$m[Gf]=$m[Ef]=$m[_p]=$m[ap]=$m[lp]=$m[Zp]=$m[Yp]=$m[Pm]=$m[kf]=$m[Np]=!1;var fy=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Km=typeof self=="object"&&self&&self.Object===Object&&self,Xg=fy||Km||Function("return this")(),Ly=el&&!el.nodeType&&el,Ry=Ly&&yr&&!yr.nodeType&&yr,wg=Ry&&Ry.exports===Ly,u_=wg&&fy.process,Oy=function(){try{return u_&&u_.binding&&u_.binding("util")}catch{}}(),V_=Oy&&Oy.isTypedArray;function n0(hd,wf){for(var ip=-1,$p=hd==null?0:hd.length;++ip<$p;)if(wf(hd[ip],ip,hd))return!0;return!1}function O0(hd){var wf=-1,ip=Array(hd.size);return hd.forEach(function($p,Nm){ip[++wf]=[Nm,$p]}),ip}function l1(hd){var wf=-1,ip=Array(hd.size);return hd.forEach(function($p){ip[++wf]=$p}),ip}var tv,oy,o0,$y=Array.prototype,py=Function.prototype,Vg=Object.prototype,fm=Xg["__core-js_shared__"],G_=py.toString,eg=Vg.hasOwnProperty,h_=(tv=/[^.]+$/.exec(fm&&fm.keys&&fm.keys.IE_PROTO||""))?"Symbol(src)_1."+tv:"",iv=Vg.toString,By=RegExp("^"+G_.call(eg).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j_=wg?Xg.Buffer:void 0,a0=Xg.Symbol,s0=Xg.Uint8Array,wm=Vg.propertyIsEnumerable,ay=$y.splice,my=a0?a0.toStringTag:void 0,l0=Object.getOwnPropertySymbols,gy=j_?j_.isBuffer:void 0,vv=(oy=Object.keys,o0=Object,function(hd){return oy(o0(hd))}),sy=ly(Xg,"DataView"),cm=ly(Xg,"Map"),Ny=ly(Xg,"Promise"),zy=ly(Xg,"Set"),q_=ly(Xg,"WeakMap"),d_=ly(Object,"create"),c0=__(sy),u0=__(cm),rv=__(Ny),Fy=__(zy),h0=__(q_),Eg=a0?a0.prototype:void 0,Z_=Eg?Eg.valueOf:void 0;function f_(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.clear();++wf<ip;){var $p=hd[wf];this.set($p[0],$p[1])}}function p_(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.clear();++wf<ip;){var $p=hd[wf];this.set($p[0],$p[1])}}function Kp(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.clear();++wf<ip;){var $p=hd[wf];this.set($p[0],$p[1])}}function C_(hd){var wf=-1,ip=hd==null?0:hd.length;for(this.__data__=new Kp;++wf<ip;)this.add(hd[wf])}function m_(hd){var wf=this.__data__=new p_(hd);this.size=wf.size}function Nv(hd,wf){var ip=yy(hd),$p=!ip&&jy(hd),Nm=!ip&&!$p&&Qg(hd),hm=!ip&&!$p&&!Nm&&m0(hd),Qm=ip||$p||Nm||hm,og=Qm?function(tp,Wg){for(var Tg=-1,fg=Array(tp);++Tg<tp;)fg[Tg]=Wg(Tg);return fg}(hd.length,String):[],ag=og.length;for(var Vm in hd)!wf&&!eg.call(hd,Vm)||Qm&&(Vm=="length"||Nm&&(Vm=="offset"||Vm=="parent")||hm&&(Vm=="buffer"||Vm=="byteLength"||Vm=="byteOffset")||f0(Vm,ag))||og.push(Vm);return og}function _y(hd,wf){for(var ip=hd.length;ip--;)if(H_(hd[ip][0],wf))return ip;return-1}function Uy(hd){return hd==null?hd===void 0?"[object Undefined]":"[object Null]":my&&my in Object(hd)?function(wf){var ip=eg.call(wf,my),$p=wf[my];try{wf[my]=void 0;var Nm=!0}catch{}var hm=iv.call(wf);return Nm&&(ip?wf[my]=$p:delete wf[my]),hm}(hd):function(wf){return iv.call(wf)}(hd)}function Xm(hd){return M_(hd)&&Uy(hd)==nd}function d0(hd,wf,ip,$p,Nm){return hd===wf||(hd==null||wf==null||!M_(hd)&&!M_(wf)?hd!=hd&&wf!=wf:function(hm,Qm,og,ag,Vm,tp){var Wg=yy(hm),Tg=yy(Qm),fg=Wg?od:cy(hm),A_=Tg?od:cy(Qm),sp=(fg=fg==nd?Zp:fg)==Zp,Zy=(A_=A_==nd?Zp:A_)==Zp,vy=fg==A_;if(vy&&Qg(hm)){if(!Qg(Qm))return!1;Wg=!0,sp=!1}if(vy&&!sp)return tp||(tp=new m_),Wg||m0(hm)?Bm(hm,Qm,og,ag,Vm,tp):function(Mm,am,P_,Ng,W_,Dg,Gm){switch(P_){case Um:if(Mm.byteLength!=am.byteLength||Mm.byteOffset!=am.byteOffset)return!1;Mm=Mm.buffer,am=am.buffer;case Jm:return!(Mm.byteLength!=am.byteLength||!Dg(new s0(Mm),new s0(am)));case ad:case Gf:case lp:return H_(+Mm,+am);case Ef:return Mm.name==am.name&&Mm.message==am.message;case Yp:case kf:return Mm==am+"";case ap:var sg=O0;case Pm:var Jg=1&Ng;if(sg||(sg=l1),Mm.size!=am.size&&!Jg)return!1;var k_=Gm.get(Mm);if(k_)return k_==am;Ng|=2,Gm.set(Mm,am);var em=Bm(sg(Mm),sg(am),Ng,W_,Dg,Gm);return Gm.delete(Mm),em;case Tp:if(Z_)return Z_.call(Mm)==Z_.call(am)}return!1}(hm,Qm,fg,og,ag,Vm,tp);if(!(1&og)){var $0=sp&&eg.call(hm,"__wrapped__"),g0=Zy&&eg.call(Qm,"__wrapped__");if($0||g0){var ov=$0?hm.value():hm,_0=g0?Qm.value():Qm;return tp||(tp=new m_),Vm(ov,_0,og,ag,tp)}}return vy?(tp||(tp=new m_),function(Mm,am,P_,Ng,W_,Dg){var Gm=1&P_,sg=Im(Mm),Jg=sg.length,k_=Im(am).length;if(Jg!=k_&&!Gm)return!1;for(var em=Jg;em--;){var Gg=sg[em];if(!(Gm?Gg in am:eg.call(am,Gg)))return!1}var bv=Dg.get(Mm);if(bv&&Dg.get(am))return bv==am;var Ig=!0;Dg.set(Mm,am),Dg.set(am,Mm);for(var Cm=Gm;++em<Jg;){var D_=Mm[Gg=sg[em]],xy=am[Gg];if(Ng)var Hy=Gm?Ng(xy,D_,Gg,am,Mm,Dg):Ng(D_,xy,Gg,Mm,am,Dg);if(!(Hy===void 0?D_===xy||W_(D_,xy,P_,Ng,Dg):Hy)){Ig=!1;break}Cm||(Cm=Gg=="constructor")}if(Ig&&!Cm){var y0=Mm.constructor,Y_=am.constructor;y0==Y_||!("constructor"in Mm)||!("constructor"in am)||typeof y0=="function"&&y0 instanceof y0&&typeof Y_=="function"&&Y_ instanceof Y_||(Ig=!1)}return Dg.delete(Mm),Dg.delete(am),Ig}(hm,Qm,og,ag,Vm,tp)):!1}(hd,wf,ip,$p,d0,Nm))}function um(hd){return!(!p0(hd)||function(wf){return!!h_&&h_ in wf}(hd))&&(qy(hd)?By:bg).test(__(hd))}function Vy(hd){if(ip=(wf=hd)&&wf.constructor,$p=typeof ip=="function"&&ip.prototype||Vg,wf!==$p)return vv(hd);var wf,ip,$p,Nm=[];for(var hm in Object(hd))eg.call(hd,hm)&&hm!="constructor"&&Nm.push(hm);return Nm}function Bm(hd,wf,ip,$p,Nm,hm){var Qm=1&ip,og=hd.length,ag=wf.length;if(og!=ag&&!(Qm&&ag>og))return!1;var Vm=hm.get(hd);if(Vm&&hm.get(wf))return Vm==wf;var tp=-1,Wg=!0,Tg=2&ip?new C_:void 0;for(hm.set(hd,wf),hm.set(wf,hd);++tp<og;){var fg=hd[tp],A_=wf[tp];if($p)var sp=Qm?$p(A_,fg,tp,wf,hd,hm):$p(fg,A_,tp,hd,wf,hm);if(sp!==void 0){if(sp)continue;Wg=!1;break}if(Tg){if(!n0(wf,function(Zy,vy){if($0=vy,!Tg.has($0)&&(fg===Zy||Nm(fg,Zy,ip,$p,hm)))return Tg.push(vy);var $0})){Wg=!1;break}}else if(fg!==A_&&!Nm(fg,A_,ip,$p,hm)){Wg=!1;break}}return hm.delete(hd),hm.delete(wf),Wg}function Im(hd){return function(wf,ip,$p){var Nm=ip(wf);return yy(wf)?Nm:function(hm,Qm){for(var og=-1,ag=Qm.length,Vm=hm.length;++og<ag;)hm[Vm+og]=Qm[og];return hm}(Nm,$p(wf))}(hd,X_,xv)}function g_(hd,wf){var ip,$p,Nm=hd.__data__;return(($p=typeof(ip=wf))=="string"||$p=="number"||$p=="symbol"||$p=="boolean"?ip!=="__proto__":ip===null)?Nm[typeof wf=="string"?"string":"hash"]:Nm.map}function ly(hd,wf){var ip=function($p,Nm){return $p?.[Nm]}(hd,wf);return um(ip)?ip:void 0}f_.prototype.clear=function(){this.__data__=d_?d_(null):{},this.size=0},f_.prototype.delete=function(hd){var wf=this.has(hd)&&delete this.__data__[hd];return this.size-=wf?1:0,wf},f_.prototype.get=function(hd){var wf=this.__data__;if(d_){var ip=wf[hd];return ip===yh?void 0:ip}return eg.call(wf,hd)?wf[hd]:void 0},f_.prototype.has=function(hd){var wf=this.__data__;return d_?wf[hd]!==void 0:eg.call(wf,hd)},f_.prototype.set=function(hd,wf){var ip=this.__data__;return this.size+=this.has(hd)?0:1,ip[hd]=d_&&wf===void 0?yh:wf,this},p_.prototype.clear=function(){this.__data__=[],this.size=0},p_.prototype.delete=function(hd){var wf=this.__data__,ip=_y(wf,hd);return!(ip<0)&&(ip==wf.length-1?wf.pop():ay.call(wf,ip,1),--this.size,!0)},p_.prototype.get=function(hd){var wf=this.__data__,ip=_y(wf,hd);return ip<0?void 0:wf[ip][1]},p_.prototype.has=function(hd){return _y(this.__data__,hd)>-1},p_.prototype.set=function(hd,wf){var ip=this.__data__,$p=_y(ip,hd);return $p<0?(++this.size,ip.push([hd,wf])):ip[$p][1]=wf,this},Kp.prototype.clear=function(){this.size=0,this.__data__={hash:new f_,map:new(cm||p_),string:new f_}},Kp.prototype.delete=function(hd){var wf=g_(this,hd).delete(hd);return this.size-=wf?1:0,wf},Kp.prototype.get=function(hd){return g_(this,hd).get(hd)},Kp.prototype.has=function(hd){return g_(this,hd).has(hd)},Kp.prototype.set=function(hd,wf){var ip=g_(this,hd),$p=ip.size;return ip.set(hd,wf),this.size+=ip.size==$p?0:1,this},C_.prototype.add=C_.prototype.push=function(hd){return this.__data__.set(hd,yh),this},C_.prototype.has=function(hd){return this.__data__.has(hd)},m_.prototype.clear=function(){this.__data__=new p_,this.size=0},m_.prototype.delete=function(hd){var wf=this.__data__,ip=wf.delete(hd);return this.size=wf.size,ip},m_.prototype.get=function(hd){return this.__data__.get(hd)},m_.prototype.has=function(hd){return this.__data__.has(hd)},m_.prototype.set=function(hd,wf){var ip=this.__data__;if(ip instanceof p_){var $p=ip.__data__;if(!cm||$p.length<199)return $p.push([hd,wf]),this.size=++ip.size,this;ip=this.__data__=new Kp($p)}return ip.set(hd,wf),this.size=ip.size,this};var xv=l0?function(hd){return hd==null?[]:(hd=Object(hd),function(wf,ip){for(var $p=-1,Nm=wf==null?0:wf.length,hm=0,Qm=[];++$p<Nm;){var og=wf[$p];ip(og,$p,wf)&&(Qm[hm++]=og)}return Qm}(l0(hd),function(wf){return wm.call(hd,wf)}))}:function(){return[]},cy=Uy;function f0(hd,wf){return!!(wf=wf??Uh)&&(typeof hd=="number"||kg.test(hd))&&hd>-1&&hd%1==0&&hd<wf}function __(hd){if(hd!=null){try{return G_.call(hd)}catch{}try{return hd+""}catch{}}return""}function H_(hd,wf){return hd===wf||hd!=hd&&wf!=wf}(sy&&cy(new sy(new ArrayBuffer(1)))!=Um||cm&&cy(new cm)!=ap||Ny&&cy(Ny.resolve())!=Rm||zy&&cy(new zy)!=Pm||q_&&cy(new q_)!=Np)&&(cy=function(hd){var wf=Uy(hd),ip=wf==Zp?hd.constructor:void 0,$p=ip?__(ip):"";if($p)switch($p){case c0:return Um;case u0:return ap;case rv:return Rm;case Fy:return Pm;case h0:return Np}return wf});var jy=Xm(function(){return arguments}())?Xm:function(hd){return M_(hd)&&eg.call(hd,"callee")&&!wm.call(hd,"callee")},yy=Array.isArray,Qg=gy||function(){return!1};function qy(hd){if(!p0(hd))return!1;var wf=Uy(hd);return wf==_p||wf=="[object GeneratorFunction]"||wf=="[object AsyncFunction]"||wf=="[object Proxy]"}function nv(hd){return typeof hd=="number"&&hd>-1&&hd%1==0&&hd<=Uh}function p0(hd){var wf=typeof hd;return hd!=null&&(wf=="object"||wf=="function")}function M_(hd){return hd!=null&&typeof hd=="object"}var m0=V_?function(hd){return function(wf){return hd(wf)}}(V_):function(hd){return M_(hd)&&nv(hd.length)&&!!$m[Uy(hd)]};function X_(hd){return(wf=hd)!=null&&nv(wf.length)&&!qy(wf)?Nv(hd):Vy(hd);var wf}yr.exports=function(hd,wf){return d0(hd,wf)}})({get exports(){return l_},set exports(yr){l_=yr}},l_);var ev=l_;function c_(yr,el){return yr.length===el.length&&JSON.stringify(yr.map(function(yh){return yh}).sort())===JSON.stringify(el.map(function(yh){return yh}).sort())}var ep={Polygon:Sd,LineString:Ed,Point:qd,MultiPolygon:Gd,MultiLineString:Gd,MultiPoint:Gd},im=Object.freeze({__proto__:null,CommonSelectors:Mp,constrainFeatureMovement:zf,createMidPoint:sm,createSupplementaryPoints:Xd,createVertex:qp,doubleClickZoom:Op,euclideanDistance:ud,featuresAt:Ih,getFeatureAtAndSetCursors:Gh,isClick:Tf,isEventAtCoordinates:Vp,isTap:Kd,mapEventToBoundingBox:al,ModeHandler:r,moveFeatures:np,sortFeatures:ih,stringSetsAreEqual:c_,StringSet:sh,theme:Yd,toDenseArray:rp}),Jp=function(yr,el){var yh={options:yr=function(nd){nd===void 0&&(nd={});var od=op(nd);return nd.controls||(od.controls={}),nd.displayControlsDefault===!1?od.controls=op(Dy,nd.controls):od.controls=op(I_,nd.controls),(od=op(Fm,od)).styles=Pg(od.styles,"cold").concat(Pg(od.styles,"hot")),od}(yr)};el=function(nd,od){return od.modes=Ur,od.getFeatureIdsAt=function(ad){return Ih.click({point:ad},null,nd).map(function(Gf){return Gf.properties.id})},od.getSelectedIds=function(){return nd.store.getSelectedIds()},od.getSelected=function(){return{type:Bt.FEATURE_COLLECTION,features:nd.store.getSelectedIds().map(function(ad){return nd.store.get(ad)}).map(function(ad){return ad.toGeoJSON()})}},od.getSelectedPoints=function(){return{type:Bt.FEATURE_COLLECTION,features:nd.store.getSelectedCoordinates().map(function(ad){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:ad.coordinates}}})}},od.set=function(ad){if(ad.type===void 0||ad.type!==Bt.FEATURE_COLLECTION||!Array.isArray(ad.features))throw new Error("Invalid FeatureCollection");var Gf=nd.store.createRenderBatch(),Ef=nd.store.getAllIds().slice(),_p=od.add(ad),ap=new sh(_p);return(Ef=Ef.filter(function(lp){return!ap.has(lp)})).length&&od.delete(Ef),Gf(),_p},od.add=function(ad){var Gf=JSON.parse(JSON.stringify(hp(ad))).features.map(function(Ef){if(Ef.id=Ef.id||Af(),Ef.geometry===null)throw new Error("Invalid geometry: null");if(nd.store.get(Ef.id)===void 0||nd.store.get(Ef.id).type!==Ef.geometry.type){var _p=ep[Ef.geometry.type];if(_p===void 0)throw new Error("Invalid geometry type: "+Ef.geometry.type+".");var ap=new _p(nd,Ef);nd.store.add(ap)}else{var lp=nd.store.get(Ef.id);lp.properties=Ef.properties,ev(lp.getCoordinates(),Ef.geometry.coordinates)||lp.incomingCoords(Ef.geometry.coordinates)}return Ef.id});return nd.store.render(),Gf},od.get=function(ad){var Gf=nd.store.get(ad);if(Gf)return Gf.toGeoJSON()},od.getAll=function(){return{type:Bt.FEATURE_COLLECTION,features:nd.store.getAll().map(function(ad){return ad.toGeoJSON()})}},od.delete=function(ad){return nd.store.delete(ad,{silent:!0}),od.getMode()!==Ur.DIRECT_SELECT||nd.store.getSelectedIds().length?nd.store.render():nd.events.changeMode(Ur.SIMPLE_SELECT,void 0,{silent:!0}),od},od.deleteAll=function(){return nd.store.delete(nd.store.getAllIds(),{silent:!0}),od.getMode()===Ur.DIRECT_SELECT?nd.events.changeMode(Ur.SIMPLE_SELECT,void 0,{silent:!0}):nd.store.render(),od},od.changeMode=function(ad,Gf){return Gf===void 0&&(Gf={}),ad===Ur.SIMPLE_SELECT&&od.getMode()===Ur.SIMPLE_SELECT?(c_(Gf.featureIds||[],nd.store.getSelectedIds())||(nd.store.setSelected(Gf.featureIds,{silent:!0}),nd.store.render()),od):(ad===Ur.DIRECT_SELECT&&od.getMode()===Ur.DIRECT_SELECT&&Gf.featureId===nd.store.getSelectedIds()[0]||nd.events.changeMode(ad,Gf,{silent:!0}),od)},od.getMode=function(){return nd.events.getMode()},od.trash=function(){return nd.events.trash({silent:!0}),od},od.combineFeatures=function(){return nd.events.combineFeatures({silent:!0}),od},od.uncombineFeatures=function(){return nd.events.uncombineFeatures({silent:!0}),od},od.setFeatureProperty=function(ad,Gf,Ef){return nd.store.setFeatureProperty(ad,Gf,Ef),od},od}(yh,el),yh.api=el;var Uh=Qh(yh);return el.onAdd=Uh.onAdd,el.onRemove=Uh.onRemove,el.types=ge,el.options=yr,el};function mm(yr){Jp(yr,this)}return mm.modes=Hg,mm.constants=ah,mm.lib=im,mm})})(mapboxGlDraw$1);var mapboxGlDrawExports=mapboxGlDraw$1.exports;const MapboxDraw=getDefaultExportFromCjs(mapboxGlDrawExports),mapboxGlDraw="";var DrawAssistedRectangle$2={};Object.defineProperty(DrawAssistedRectangle$2,"__esModule",{value:!0});var doubleClickZoom$1={enable:function e(t){setTimeout(function(){!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable:function e(t){setTimeout(function(){!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}},DrawAssistedRectangle$1={onSetup:function e(t){var r=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(r),this.clearSelectedFeatures(),doubleClickZoom$1.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:r,currentVertexPosition:0}},onTap:function e(t,r){this.onClick(t,r)},onClick:function e(t,r){if(t.currentVertexPosition===2){var n=this.calculatepXY3(t,r,!1);return n&&t.rectangle.updateCoordinate("0."+(t.currentVertexPosition+1),n[0],n[1]),this.updateUIClasses({mouse:"pointer"}),this.changeMode("simple_select",{featuresId:t.rectangle.id})}else t.rectangle.updateCoordinate("0."+t.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),t.currentVertexPosition++,t.rectangle.updateCoordinate("0."+t.currentVertexPosition,r.lngLat.lng,r.lngLat.lat)},onMouseMove:function e(t,r){if(t.rectangle.updateCoordinate("0."+t.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),t.currentVertexPosition&&t.currentVertexPosition>0&&this.calculateOrientedAnglePolygon(t),t.currentVertexPosition===2){var n=this.calculatepXY3(t,r,!0);n&&t.rectangle.updateCoordinate("0."+(t.currentVertexPosition+1),n[0],n[1])}},deegrees2meters:function e(t){var r=t[0]*2003750834e-2/180,n=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return n=n*2003750834e-2/180,[r,n]},meters2degress:function e(t){var r=t[0]*180/2003750834e-2,n=Math.atan(Math.exp(t[1]*Math.PI/2003750834e-2))*360/Math.PI-90;return[r,n]},calculateOrientedAnglePolygon:function e(t){var r=t.rectangle.getCoordinate("0.0"),n=this.deegrees2meters(r),a=t.rectangle.getCoordinate("0.1"),s=this.deegrees2meters(a),f=Math.atan2(s[1]-n[1],s[0]-n[0])*180/Math.PI,o=-1*(f+90),x=o<0?o+360:o;t.angle=parseFloat(x.toFixed(2))},calculatepXY3:function e(t,r,n){var a=t.rectangle.getCoordinate("0.0"),s=this.deegrees2meters(a),f=t.rectangle.getCoordinate("0.1"),o=this.deegrees2meters(f),x=this.deegrees2meters([r.lngLat.lng,r.lngLat.lat]),C=this.deegrees2meters([r.lngLat.lng,r.lngLat.lat]);if(s[0]===o[0])x=[C[0],o[1]];else if(s[1]===o[1])x=[o[0],C[1]];else{var P=(o[1]-s[1])/(o[0]-s[0]),Y=-1/P;Math.abs(Y)<1?x[1]=Y*(C[0]-o[0])+o[1]:x[0]=o[0]+(x[1]-o[1])/Y}var ze=[o[0]-s[0],o[1]-s[1]],ge=[x[0]-ze[0],x[1]-ze[1]],Bt=this.meters2degress(x),Ur=this.meters2degress(ge);return t.rectangle.updateCoordinate("0.2",Bt[0],Bt[1]),t.rectangle.updateCoordinate("0.3",Ur[0],Ur[1]),Ur},onKeyUp:function e(t,r){if(r.keyCode===27)return this.changeMode("simple_select")},onStop:function e(t){doubleClickZoom$1.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.getFeature(t.rectangle.id)!==void 0&&(t.rectangle.removeCoordinate("0.4"),t.rectangle.isValid()?this.map.fire("draw.create",{features:[t.rectangle.toGeoJSON()]}):(this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function e(t,r,n){var a=r.properties.id===t.rectangle.id;if(r.properties.active=a?"true":"false",r.properties.angle=t.angle,r.angle=t.angle,!a)return n(r);var s=r.geometry.coordinates[0].length;if(s<3){var f=r.geometry.coordinates[0][0],o={type:"Feature",properties:r.properties,angle:t.angle,geometry:{coordinates:r.geometry.coordinates[0][0],type:"Point"}};f&&n(o);return}if(s>=3&&s<=4){var x=[[r.geometry.coordinates[0][0][0],r.geometry.coordinates[0][0][1]],[r.geometry.coordinates[0][1][0],r.geometry.coordinates[0][1][1]]];if(n({type:"Feature",properties:r.properties,angle:t.angle,geometry:{coordinates:x,type:"LineString"}}),s===3)return}return n(r)},onTrash:function e(t){this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select")}},_default=DrawAssistedRectangle$2.default=DrawAssistedRectangle$1;class MapboxGLButtonControl{constructor({className:t="",title:r="",eventHandler:n=evtHndlr}){this._className=t,this._title=r,this._eventHandler=n}onAdd(t){return this._btn=document.createElement("button"),this._btn.className="mapboxgl-ctrl-icon "+this._className,this._btn.type="button",this._btn.title=this._title,this._btn.onclick=this._eventHandler,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const styles="";var tilesInBbox={};function lonToX(e,t){var r=Math.pow(2,t),n=Math.floor((e+180)/360*r);return n}function latToY(e,t){var r=e*Math.PI/180,n=Math.pow(2,t),a=Math.floor((1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*n);return a}tilesInBbox.tilesInBbox=function(e,t){for(var r=[],n=lonToX(e.left,t),a=lonToX(e.right,t),s=latToY(e.top,t),f=latToY(e.bottom,t),o=n;o<=a;){for(var x=s;x<=f;)r.push({x:o,y:x,z:t}),x++;o++}return r};function useQuasar(){return inject(quasarKey)}var freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$6=root$7.Symbol,_Symbol=Symbol$6,Symbol$5=_Symbol,objectProto$b=Object.prototype,hasOwnProperty$8=objectProto$b.hasOwnProperty,nativeObjectToString$1=objectProto$b.toString,symToStringTag$1=Symbol$5?Symbol$5.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$8.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch{}var a=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),a}var _getRawTag=getRawTag$1,objectProto$a=Object.prototype,nativeObjectToString=objectProto$a.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$4=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$4?Symbol$4.toStringTag:void 0;function baseGetTag$5(e){return e==null?e===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$5;function isObjectLike$5(e){return e!=null&&typeof e=="object"}var isObjectLike_1=isObjectLike$5,baseGetTag$4=_baseGetTag,isObjectLike$4=isObjectLike_1,symbolTag$1="[object Symbol]";function isSymbol$5(e){return typeof e=="symbol"||isObjectLike$4(e)&&baseGetTag$4(e)==symbolTag$1}var isSymbol_1=isSymbol$5,isSymbol$4=isSymbol_1;function baseExtremum$2(e,t,r){for(var n=-1,a=e.length;++n<a;){var s=e[n],f=t(s);if(f!=null&&(o===void 0?f===f&&!isSymbol$4(f):r(f,o)))var o=f,x=s}return x}var _baseExtremum=baseExtremum$2;function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$3(e,t){return e===t||e!==e&&t!==t}var eq_1=eq$3,eq$2=eq_1;function assocIndexOf$4(e,t){for(var r=e.length;r--;)if(eq$2(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():splice.call(t,r,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$4.prototype.clear=listCacheClear;ListCache$4.prototype.delete=listCacheDelete;ListCache$4.prototype.get=listCacheGet;ListCache$4.prototype.has=listCacheHas;ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1;function isObject$4(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var isObject_1=isObject$4,baseGetTag$3=_baseGetTag,isObject$3=isObject_1,asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$3(e))return!1;var t=baseGetTag$3(e);return t==funcTag$1||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$2(e){if(e!=null){try{return funcToString$1.call(e)}catch{}try{return e+""}catch{}}return""}var _toSource=toSource$2,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$2=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$9=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$7=objectProto$9.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$7).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){if(!isObject$2(e)||isMasked(e))return!1;var t=isFunction$1(e)?reIsNative:reIsHostCtor;return t.test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return e?.[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$7(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$7,getNative$6=_getNative,root$5=_root,Map$5=getNative$6(root$5,"Map"),_Map=Map$5,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$6.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?t[e]!==void 0:hasOwnProperty$5.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&t===void 0?HASH_UNDEFINED$1:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash$1.prototype.clear=hashClear;Hash$1.prototype.delete=hashDelete;Hash$1.prototype.get=hashGet;Hash$1.prototype.has=hashHas;Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$4=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$4||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r[typeof t=="string"?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$3(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache$3.prototype.clear=mapCacheClear;MapCache$3.prototype.delete=mapCacheDelete;MapCache$3.prototype.get=mapCacheGet;MapCache$3.prototype.has=mapCacheHas;MapCache$3.prototype.set=mapCacheSet;var _MapCache=MapCache$3,ListCache$1=_ListCache,Map$3=_Map,MapCache$2=_MapCache,LARGE_ARRAY_SIZE=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var n=r.__data__;if(!Map$3||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$2(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$2(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$2.prototype.clear=stackClear;Stack$2.prototype.delete=stackDelete;Stack$2.prototype.get=stackGet;Stack$2.prototype.has=stackHas;Stack$2.prototype.set=stackSet;var _Stack=Stack$2,HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd$1(e){return this.__data__.set(e,HASH_UNDEFINED),this}var _setCacheAdd=setCacheAdd$1;function setCacheHas$1(e){return this.__data__.has(e)}var _setCacheHas=setCacheHas$1,MapCache$1=_MapCache,setCacheAdd=_setCacheAdd,setCacheHas=_setCacheHas;function SetCache$1(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new MapCache$1;++t<r;)this.add(e[t])}SetCache$1.prototype.add=SetCache$1.prototype.push=setCacheAdd;SetCache$1.prototype.has=setCacheHas;var _SetCache=SetCache$1;function arraySome$1(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _arraySome=arraySome$1;function cacheHas$1(e,t){return e.has(t)}var _cacheHas=cacheHas$1,SetCache=_SetCache,arraySome=_arraySome,cacheHas=_cacheHas,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays$2(e,t,r,n,a,s){var f=r&COMPARE_PARTIAL_FLAG$5,o=e.length,x=t.length;if(o!=x&&!(f&&x>o))return!1;var C=s.get(e),P=s.get(t);if(C&&P)return C==t&&P==e;var Y=-1,ze=!0,ge=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(s.set(e,t),s.set(t,e);++Y<o;){var Bt=e[Y],Ur=t[Y];if(n)var kn=f?n(Ur,Bt,Y,t,e,s):n(Bt,Ur,Y,e,t,s);if(kn!==void 0){if(kn)continue;ze=!1;break}if(ge){if(!arraySome(t,function(Io,rl){if(!cacheHas(ge,rl)&&(Bt===Io||a(Bt,Io,r,n,s)))return ge.push(rl)})){ze=!1;break}}else if(!(Bt===Ur||a(Bt,Ur,r,n,s))){ze=!1;break}}return s.delete(e),s.delete(t),ze}var _equalArrays=equalArrays$2,root$4=_root,Uint8Array$2=root$4.Uint8Array,_Uint8Array=Uint8Array$2;function mapToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var _mapToArray=mapToArray$1;function setToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var _setToArray=setToArray$1,Symbol$3=_Symbol,Uint8Array$1=_Uint8Array,eq$1=eq_1,equalArrays$1=_equalArrays,mapToArray=_mapToArray,setToArray=_setToArray,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",mapTag$2="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$2="[object DataView]",symbolProto$1=Symbol$3?Symbol$3.prototype:void 0,symbolValueOf=symbolProto$1?symbolProto$1.valueOf:void 0;function equalByTag$1(e,t,r,n,a,s,f){switch(r){case dataViewTag$2:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag$1:return!(e.byteLength!=t.byteLength||!s(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag$1:case dateTag$1:case numberTag$1:return eq$1(+e,+t);case errorTag$1:return e.name==t.name&&e.message==t.message;case regexpTag$1:case stringTag$1:return e==t+"";case mapTag$2:var o=mapToArray;case setTag$2:var x=n&COMPARE_PARTIAL_FLAG$4;if(o||(o=setToArray),e.size!=t.size&&!x)return!1;var C=f.get(e);if(C)return C==t;n|=COMPARE_UNORDERED_FLAG$2,f.set(e,t);var P=equalArrays$1(o(e),o(t),n,a,s,f);return f.delete(e),P;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var _equalByTag=equalByTag$1;function arrayPush$2(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var _arrayPush=arrayPush$2,isArray$a=Array.isArray,isArray_1=isArray$a,arrayPush$1=_arrayPush,isArray$9=isArray_1;function baseGetAllKeys$1(e,t,r){var n=t(e);return isArray$9(e)?n:arrayPush$1(n,r(e))}var _baseGetAllKeys=baseGetAllKeys$1;function arrayFilter$1(e,t){for(var r=-1,n=e==null?0:e.length,a=0,s=[];++r<n;){var f=e[r];t(f,r,e)&&(s[a++]=f)}return s}var _arrayFilter=arrayFilter$1;function stubArray$1(){return[]}var stubArray_1=stubArray$1,arrayFilter=_arrayFilter,stubArray=stubArray_1,objectProto$6=Object.prototype,propertyIsEnumerable$1=objectProto$6.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols$1=nativeGetSymbols?function(e){return e==null?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable$1.call(e,t)}))}:stubArray,_getSymbols=getSymbols$1;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1,baseGetTag$2=_baseGetTag,isObjectLike$3=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$3(e)&&baseGetTag$2(e)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$2=isObjectLike_1,objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty,propertyIsEnumerable=objectProto$5.propertyIsEnumerable,isArguments$3=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$2(e)&&hasOwnProperty$4.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments$3,isBuffer$2={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;isBuffer$2.exports;(function(e,t){var r=_root,n=stubFalse_1,a=t&&!t.nodeType&&t,s=a&&!0&&e&&!e.nodeType&&e,f=s&&s.exports===a,o=f?r.Buffer:void 0,x=o?o.isBuffer:void 0,C=x||n;e.exports=C})(isBuffer$2,isBuffer$2.exports);var isBufferExports=isBuffer$2.exports,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$3(e,t){var r=typeof e;return t=t??MAX_SAFE_INTEGER$1,!!t&&(r=="number"||r!="symbol"&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$3,MAX_SAFE_INTEGER=9007199254740991;function isLength$3(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$3,baseGetTag$1=_baseGetTag,isLength$2=isLength_1,isObjectLike$1=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag$1="[object Map]",numberTag="[object Number]",objectTag$2="[object Object]",regexpTag="[object RegExp]",setTag$1="[object Set]",stringTag="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag$1]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag$1]=typedArrayTags[numberTag]=typedArrayTags[objectTag$2]=typedArrayTags[regexpTag]=typedArrayTags[setTag$1]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag$1]=!1;function baseIsTypedArray$1(e){return isObjectLike$1(e)&&isLength$2(e.length)&&!!typedArrayTags[baseGetTag$1(e)]}var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$2(e){return function(t){return e(t)}}var _baseUnary=baseUnary$2,_nodeUtil={exports:{}};_nodeUtil.exports;(function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,s=a&&a.exports===n,f=s&&r.process,o=function(){try{var x=a&&a.require&&a.require("util").types;return x||f&&f.binding&&f.binding("util")}catch{}}();e.exports=o})(_nodeUtil,_nodeUtil.exports);var _nodeUtilExports=_nodeUtil.exports,baseIsTypedArray=_baseIsTypedArray,baseUnary$1=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary$1(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$2,baseTimes=_baseTimes,isArguments$2=isArguments_1,isArray$8=isArray_1,isBuffer$1=isBufferExports,isIndex$2=_isIndex,isTypedArray$1=isTypedArray_1,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function arrayLikeKeys$1(e,t){var r=isArray$8(e),n=!r&&isArguments$2(e),a=!r&&!n&&isBuffer$1(e),s=!r&&!n&&!a&&isTypedArray$1(e),f=r||n||a||s,o=f?baseTimes(e.length,String):[],x=o.length;for(var C in e)(t||hasOwnProperty$3.call(e,C))&&!(f&&(C=="length"||a&&(C=="offset"||C=="parent")||s&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||isIndex$2(C,x)))&&o.push(C);return o}var _arrayLikeKeys=arrayLikeKeys$1,objectProto$3=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||objectProto$3;return e===r}var _isPrototype=isPrototype$1;function overArg$1(e,t){return function(r){return e(t(r))}}var _overArg=overArg$1,overArg=_overArg,nativeKeys$1=overArg(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype=_isPrototype,nativeKeys=_nativeKeys,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function baseKeys$1(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$2.call(e,r)&&r!="constructor"&&t.push(r);return t}var _baseKeys=baseKeys$1,isFunction=isFunction_1,isLength$1=isLength_1;function isArrayLike$4(e){return e!=null&&isLength$1(e.length)&&!isFunction(e)}var isArrayLike_1=isArrayLike$4,arrayLikeKeys=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$3=isArrayLike_1;function keys$3(e){return isArrayLike$3(e)?arrayLikeKeys(e):baseKeys(e)}var keys_1=keys$3,baseGetAllKeys=_baseGetAllKeys,getSymbols=_getSymbols,keys$2=keys_1;function getAllKeys$1(e){return baseGetAllKeys(e,keys$2,getSymbols)}var _getAllKeys=getAllKeys$1,getAllKeys=_getAllKeys,COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects$1(e,t,r,n,a,s){var f=r&COMPARE_PARTIAL_FLAG$3,o=getAllKeys(e),x=o.length,C=getAllKeys(t),P=C.length;if(x!=P&&!f)return!1;for(var Y=x;Y--;){var ze=o[Y];if(!(f?ze in t:hasOwnProperty$1.call(t,ze)))return!1}var ge=s.get(e),Bt=s.get(t);if(ge&&Bt)return ge==t&&Bt==e;var Ur=!0;s.set(e,t),s.set(t,e);for(var kn=f;++Y<x;){ze=o[Y];var Io=e[ze],rl=t[ze];if(n)var Co=f?n(rl,Io,ze,t,e,s):n(Io,rl,ze,e,t,s);if(!(Co===void 0?Io===rl||a(Io,rl,r,n,s):Co)){Ur=!1;break}kn||(kn=ze=="constructor")}if(Ur&&!kn){var as=e.constructor,$s=t.constructor;as!=$s&&"constructor"in e&&"constructor"in t&&!(typeof as=="function"&&as instanceof as&&typeof $s=="function"&&$s instanceof $s)&&(Ur=!1)}return s.delete(e),s.delete(t),Ur}var _equalObjects=equalObjects$1,getNative$4=_getNative,root$3=_root,DataView$2=getNative$4(root$3,"DataView"),_DataView=DataView$2,getNative$3=_getNative,root$2=_root,Promise$2=getNative$3(root$2,"Promise"),_Promise=Promise$2,getNative$2=_getNative,root$1=_root,Set$2=getNative$2(root$1,"Set"),_Set=Set$2,getNative$1=_getNative,root=_root,WeakMap$2=getNative$1(root,"WeakMap"),_WeakMap=WeakMap$2,DataView$1=_DataView,Map$2=_Map,Promise$1=_Promise,Set$1=_Set,WeakMap$1=_WeakMap,baseGetTag=_baseGetTag,toSource=_toSource,mapTag="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$2),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag$1=baseGetTag;(DataView$1&&getTag$1(new DataView$1(new ArrayBuffer(1)))!=dataViewTag||Map$2&&getTag$1(new Map$2)!=mapTag||Promise$1&&getTag$1(Promise$1.resolve())!=promiseTag||Set$1&&getTag$1(new Set$1)!=setTag||WeakMap$1&&getTag$1(new WeakMap$1)!=weakMapTag)&&(getTag$1=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return t});var _getTag=getTag$1,Stack$1=_Stack,equalArrays=_equalArrays,equalByTag=_equalByTag,equalObjects=_equalObjects,getTag=_getTag,isArray$7=isArray_1,isBuffer=isBufferExports,isTypedArray=isTypedArray_1,COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep$1(e,t,r,n,a,s){var f=isArray$7(e),o=isArray$7(t),x=f?arrayTag:getTag(e),C=o?arrayTag:getTag(t);x=x==argsTag?objectTag:x,C=C==argsTag?objectTag:C;var P=x==objectTag,Y=C==objectTag,ze=x==C;if(ze&&isBuffer(e)){if(!isBuffer(t))return!1;f=!0,P=!1}if(ze&&!P)return s||(s=new Stack$1),f||isTypedArray(e)?equalArrays(e,t,r,n,a,s):equalByTag(e,t,x,r,n,a,s);if(!(r&COMPARE_PARTIAL_FLAG$2)){var ge=P&&hasOwnProperty.call(e,"__wrapped__"),Bt=Y&&hasOwnProperty.call(t,"__wrapped__");if(ge||Bt){var Ur=ge?e.value():e,kn=Bt?t.value():t;return s||(s=new Stack$1),a(Ur,kn,r,n,s)}}return ze?(s||(s=new Stack$1),equalObjects(e,t,r,n,a,s)):!1}var _baseIsEqualDeep=baseIsEqualDeep$1,baseIsEqualDeep=_baseIsEqualDeep,isObjectLike=isObjectLike_1;function baseIsEqual$2(e,t,r,n,a){return e===t?!0:e==null||t==null||!isObjectLike(e)&&!isObjectLike(t)?e!==e&&t!==t:baseIsEqualDeep(e,t,r,n,baseIsEqual$2,a)}var _baseIsEqual=baseIsEqual$2,Stack=_Stack,baseIsEqual$1=_baseIsEqual,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch$1(e,t,r,n){var a=r.length,s=a,f=!n;if(e==null)return!s;for(e=Object(e);a--;){var o=r[a];if(f&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++a<s;){o=r[a];var x=o[0],C=e[x],P=o[1];if(f&&o[2]){if(C===void 0&&!(x in e))return!1}else{var Y=new Stack;if(n)var ze=n(C,P,x,e,t,Y);if(!(ze===void 0?baseIsEqual$1(P,C,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,Y):ze))return!1}}return!0}var _baseIsMatch=baseIsMatch$1,isObject$1=isObject_1;function isStrictComparable$2(e){return e===e&&!isObject$1(e)}var _isStrictComparable=isStrictComparable$2,isStrictComparable$1=_isStrictComparable,keys$1=keys_1;function getMatchData$1(e){for(var t=keys$1(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,isStrictComparable$1(a)]}return t}var _getMatchData=getMatchData$1;function matchesStrictComparable$2(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var _matchesStrictComparable=matchesStrictComparable$2,baseIsMatch=_baseIsMatch,getMatchData=_getMatchData,matchesStrictComparable$1=_matchesStrictComparable;function baseMatches$1(e){var t=getMatchData(e);return t.length==1&&t[0][2]?matchesStrictComparable$1(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}var _baseMatches=baseMatches$1,isArray$6=isArray_1,isSymbol$3=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$3(e,t){if(isArray$6(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||isSymbol$3(e)?!0:reIsPlainProp.test(e)||!reIsDeepProp.test(e)||t!=null&&e in Object(t)}var _isKey=isKey$3,MapCache=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var f=e.apply(this,n);return r.cache=s.set(a,f)||s,f};return r.cache=new(memoize$1.Cache||MapCache),r}memoize$1.Cache=MapCache;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(e){var t=memoize(e,function(n){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),n}),r=t.cache;return t}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rePropName,function(r,n,a,s){t.push(a?s.replace(reEscapeChar,"$1"):n||r)}),t}),_stringToPath=stringToPath$1;function arrayMap$2(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var _arrayMap=arrayMap$2,Symbol$2=_Symbol,arrayMap$1=_arrayMap,isArray$5=isArray_1,isSymbol$2=isSymbol_1,INFINITY$1=1/0,symbolProto=Symbol$2?Symbol$2.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString$1(e){if(typeof e=="string")return e;if(isArray$5(e))return arrayMap$1(e,baseToString$1)+"";if(isSymbol$2(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return t=="0"&&1/e==-INFINITY$1?"-0":t}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$1(e){return e==null?"":baseToString(e)}var toString_1=toString$1,isArray$4=isArray_1,isKey$2=_isKey,stringToPath=_stringToPath,toString=toString_1;function castPath$2(e,t){return isArray$4(e)?e:isKey$2(e,t)?[e]:stringToPath(toString(e))}var _castPath=castPath$2,isSymbol$1=isSymbol_1,INFINITY=1/0;function toKey$4(e){if(typeof e=="string"||isSymbol$1(e))return e;var t=e+"";return t=="0"&&1/e==-INFINITY?"-0":t}var _toKey=toKey$4,castPath$1=_castPath,toKey$3=_toKey;function baseGet$3(e,t){t=castPath$1(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[toKey$3(t[r++])];return r&&r==n?e:void 0}var _baseGet=baseGet$3,baseGet$2=_baseGet;function get$2(e,t,r){var n=e==null?void 0:baseGet$2(e,t);return n===void 0?r:n}var get_1=get$2;function baseHasIn$1(e,t){return e!=null&&t in Object(e)}var _baseHasIn=baseHasIn$1,castPath=_castPath,isArguments$1=isArguments_1,isArray$3=isArray_1,isIndex$1=_isIndex,isLength=isLength_1,toKey$2=_toKey;function hasPath$1(e,t,r){t=castPath(t,e);for(var n=-1,a=t.length,s=!1;++n<a;){var f=toKey$2(t[n]);if(!(s=e!=null&&r(e,f)))break;e=e[f]}return s||++n!=a?s:(a=e==null?0:e.length,!!a&&isLength(a)&&isIndex$1(f,a)&&(isArray$3(e)||isArguments$1(e)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$1(e,t){return e!=null&&hasPath(e,t,baseHasIn)}var hasIn_1=hasIn$1,baseIsEqual=_baseIsEqual,get$1=get_1,hasIn=hasIn_1,isKey$1=_isKey,isStrictComparable=_isStrictComparable,matchesStrictComparable=_matchesStrictComparable,toKey$1=_toKey,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty$1(e,t){return isKey$1(e)&&isStrictComparable(t)?matchesStrictComparable(toKey$1(e),t):function(r){var n=get$1(r,e);return n===void 0&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var _baseMatchesProperty=baseMatchesProperty$1;function identity$4(e){return e}var identity_1=identity$4;function baseProperty$1(e){return function(t){return t?.[e]}}var _baseProperty=baseProperty$1,baseGet$1=_baseGet;function basePropertyDeep$1(e){return function(t){return baseGet$1(t,e)}}var _basePropertyDeep=basePropertyDeep$1,baseProperty=_baseProperty,basePropertyDeep=_basePropertyDeep,isKey=_isKey,toKey=_toKey;function property$1(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}var property_1=property$1,baseMatches=_baseMatches,baseMatchesProperty=_baseMatchesProperty,identity$3=identity_1,isArray$2=isArray_1,property=property_1;function baseIteratee$3(e){return typeof e=="function"?e:e==null?identity$3:typeof e=="object"?isArray$2(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var _baseIteratee=baseIteratee$3;function baseLt$1(e,t){return e<t}var _baseLt=baseLt$1,baseExtremum$1=_baseExtremum,baseIteratee$2=_baseIteratee,baseLt=_baseLt;function minBy(e,t){return e&&e.length?baseExtremum$1(e,baseIteratee$2(t),baseLt):void 0}var minBy_1=minBy;const minBy$1=getDefaultExportFromCjs(minBy_1);function baseGt$1(e,t){return e>t}var _baseGt=baseGt$1,baseExtremum=_baseExtremum,baseGt=_baseGt,baseIteratee$1=_baseIteratee;function maxBy(e,t){return e&&e.length?baseExtremum(e,baseIteratee$1(t),baseGt):void 0}var maxBy_1=maxBy;const maxBy$1=getDefaultExportFromCjs(maxBy_1);var Symbol$1=_Symbol,isArguments=isArguments_1,isArray$1=isArray_1,spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable$1(e){return isArray$1(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$1(e,t,r,n,a){var s=-1,f=e.length;for(r||(r=isFlattenable),a||(a=[]);++s<f;){var o=e[s];t>0&&r(o)?t>1?baseFlatten$1(o,t-1,r,n,a):arrayPush(a,o):n||(a[a.length]=o)}return a}var _baseFlatten=baseFlatten$1;function createBaseFor$1(e){return function(t,r,n){for(var a=-1,s=Object(t),f=n(t),o=f.length;o--;){var x=f[e?o:++a];if(r(s[x],x,s)===!1)break}return t}}var _createBaseFor=createBaseFor$1,createBaseFor=_createBaseFor,baseFor$1=createBaseFor(),_baseFor=baseFor$1,baseFor=_baseFor,keys=keys_1;function baseForOwn$1(e,t){return e&&baseFor(e,t,keys)}var _baseForOwn=baseForOwn$1,isArrayLike$2=isArrayLike_1;function createBaseEach$1(e,t){return function(r,n){if(r==null)return r;if(!isArrayLike$2(r))return e(r,n);for(var a=r.length,s=t?a:-1,f=Object(r);(t?s--:++s<a)&&n(f[s],s,f)!==!1;);return r}}var _createBaseEach=createBaseEach$1,baseForOwn=_baseForOwn,createBaseEach=_createBaseEach,baseEach$1=createBaseEach(baseForOwn),_baseEach=baseEach$1,baseEach=_baseEach,isArrayLike$1=isArrayLike_1;function baseMap$1(e,t){var r=-1,n=isArrayLike$1(e)?Array(e.length):[];return baseEach(e,function(a,s,f){n[++r]=t(a,s,f)}),n}var _baseMap=baseMap$1;function baseSortBy$1(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var _baseSortBy=baseSortBy$1,isSymbol=isSymbol_1;function compareAscending$1(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,s=isSymbol(e),f=t!==void 0,o=t===null,x=t===t,C=isSymbol(t);if(!o&&!C&&!s&&e>t||s&&f&&x&&!o&&!C||n&&f&&x||!r&&x||!a)return 1;if(!n&&!s&&!C&&e<t||C&&r&&a&&!n&&!s||o&&r&&a||!f&&a||!x)return-1}return 0}var _compareAscending=compareAscending$1,compareAscending=_compareAscending;function compareMultiple$1(e,t,r){for(var n=-1,a=e.criteria,s=t.criteria,f=a.length,o=r.length;++n<f;){var x=compareAscending(a[n],s[n]);if(x){if(n>=o)return x;var C=r[n];return x*(C=="desc"?-1:1)}}return e.index-t.index}var _compareMultiple=compareMultiple$1,arrayMap=_arrayMap,baseGet=_baseGet,baseIteratee=_baseIteratee,baseMap=_baseMap,baseSortBy=_baseSortBy,baseUnary=_baseUnary,compareMultiple=_compareMultiple,identity$2=identity_1,isArray=isArray_1;function baseOrderBy$1(e,t,r){t.length?t=arrayMap(t,function(s){return isArray(s)?function(f){return baseGet(f,s.length===1?s[0]:s)}:s}):t=[identity$2];var n=-1;t=arrayMap(t,baseUnary(baseIteratee));var a=baseMap(e,function(s,f,o){var x=arrayMap(t,function(C){return C(s)});return{criteria:x,index:++n,value:s}});return baseSortBy(a,function(s,f){return compareMultiple(s,f,r)})}var _baseOrderBy=baseOrderBy$1;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax=Math.max;function overRest$1(e,t,r){return t=nativeMax(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,s=nativeMax(n.length-t,0),f=Array(s);++a<s;)f[a]=n[t+a];a=-1;for(var o=Array(t+1);++a<t;)o[a]=n[a];return o[t]=r(f),apply(e,this,o)}}var _overRest=overRest$1;function constant$1(e){return function(){return e}}var constant_1=constant$1,getNative=_getNative,defineProperty$1=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch{}}(),_defineProperty=defineProperty$1,constant=constant_1,defineProperty=_defineProperty,identity$1=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$1,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var n=nativeNow(),a=HOT_SPAN-(n-r);if(r=n,a>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$1=shortOut(baseSetToString),_setToString=setToString$1,identity=identity_1,overRest=_overRest,setToString=_setToString;function baseRest$1(e,t){return setToString(overRest(e,t,identity),e+"")}var _baseRest=baseRest$1,eq=eq_1,isArrayLike=isArrayLike_1,isIndex=_isIndex,isObject=isObject_1;function isIterateeCall$1(e,t,r){if(!isObject(r))return!1;var n=typeof t;return(n=="number"?isArrayLike(r)&&isIndex(t,r.length):n=="string"&&t in r)?eq(r[t],e):!1}var _isIterateeCall=isIterateeCall$1,baseFlatten=_baseFlatten,baseOrderBy=_baseOrderBy,baseRest=_baseRest,isIterateeCall=_isIterateeCall,sortBy=baseRest(function(e,t){if(e==null)return[];var r=t.length;return r>1&&isIterateeCall(e,t[0],t[1])?t=[]:r>2&&isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),baseOrderBy(e,baseFlatten(t,1),[])}),sortBy_1=sortBy;const sortBy$1=getDefaultExportFromCjs(sortBy_1);async function combineTilesJimp(e,t,r){const n=minBy$1(e,Ur=>Ur.x).x,a=minBy$1(e,Ur=>Ur.y).y,s=Ur=>({x:Ur.x-n,y:Ur.y-a,buffer:Ur.buffer}),f=sortBy$1(e.map(s),["y","x"]),o=1+maxBy$1(f,Ur=>Ur.x).x,x=1+maxBy$1(f,Ur=>Ur.y).y,C=t*o,P=r*x;async function Y(Ur){for(let kn of f){let Io=Buffer.from(kn.buffer),rl=kn.y*r,Co=kn.x*t,as=await Jimp.read(Io);Ur.composite(as,Co,rl)}return Ur}let ze=await Jimp.read(Buffer.from(f[0].buffer));return ze.background(4294967295),ze.resize(C,P),await(await Y(ze)).getBufferAsync(Jimp.MIME_PNG)}const mapboxMapViewer_vue_vue_type_style_index_0_lang="";let draw$1,geocoder;const STYLES_DRAW$1=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#FF0000","fill-outline-color":"#D20C0C","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":3}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#ee0508","fill-opacity":.8}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c40b0b","line-width":2}}],_sfc_main$5={name:"mapbox-map-viewer",setup(){const e=useQuasar();return{alert:ref(!1),alertMsg:ref(""),tileInfoString:ref(""),dirHandle:ref(""),qt:e,style_url:ref(""),zoom:ref(""),access_token:ref(""),rasterFromStyle:ref(!1),mapbox_raster_png_dem:ref(""),mapbox_api_url:ref(""),drawmode:ref("simple_select"),mapbox_rgb_image_url:ref(""),map:ref(""),features:ref([]),threedview:ref(!1),layers:ref(["hillshading","bounding_box","undersea-features-lines","undersea-features-points","undersea-features-points-label","10m-bathymetry-81bsvj"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Undersea Lines",value:"undersea-features-lines"},{label:"Undersea Points",value:"undersea-features-points"},{label:"Undersea Labels",value:"undersea-features-points-label"},{label:"Depth",value:"10m-bathymetry-81bsvj"},{label:"Satellite",value:"satellite"},{label:"3D",value:"3d"}]}},mounted(){},methods:{async changeLayers(e){for(const t of this.layer_type)e.includes(t.value)?t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","visible"):this.map.setTerrain({source:"mapbox-3d",exaggeration:1.5}):t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","none"):this.map.setTerrain(null)},changeDrawMode(e){let t=document.getElementsByClassName("mapbox-gl-draw_polygon")[0],r=document.getElementsByClassName("mapbox-gl-draw_line")[0],n=e.target;n.title==="Select single tile"?(r.style.backgroundColor="white",t.style.backgroundColor="green",draw$1.deleteAll(),draw$1.changeMode("simple_select"),this.drawmode="simple_select"):n.title==="Draw Rectangle to select multiple tiles"&&(r.style.backgroundColor="green",t.style.backgroundColor="white",draw$1.deleteAll(),draw$1.changeMode("draw_assisted_rectangle"),this.drawmode="draw_assisted_rectangle",this.map.setPaintProperty("bounding_box","fill-opacity",0)),console.log(this.drawmode)},loadMapSourcesLayers(e){this.rasterFromStyle===!1&&(e.addSource("mapbox_terrain_dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1"}),e.addSource("satellite",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:512}),e.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}}),e.addLayer({id:"hillshading",source:"mapbox_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),e.addSource("bathymetry",{type:"vector",url:"mapbox://mapbox-public.bathymetry"}),e.addLayer({id:"undersea-features-lines",type:"line",source:"bathymetry","source-layer":"undersea-features-lines",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff69b4","line-width":2}}),e.addLayer({id:"undersea-features-points",type:"circle",source:"bathymetry","source-layer":"undersea-features-points",paint:{"circle-radius":4,"circle-color":"#01fe01"}}),e.addLayer({id:"undersea-features-points-label",type:"symbol",source:"bathymetry","source-layer":"undersea-features-points",layout:{"text-field":"{name}","text-anchor":"top-left","text-size":12}}),e.addSource("10m-bathymetry-81bsvj",{type:"vector",url:"mapbox://mapbox.9tm8dx88"}),e.addSource("mapbox-3d",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:15}),e.addLayer({id:"10m-bathymetry-81bsvj",type:"fill",source:"10m-bathymetry-81bsvj","source-layer":"10m-bathymetry-81bsvj",layout:{},paint:{"fill-outline-color":"hsla(337, 82%, 62%, 0)","fill-color":["interpolate",["cubic-bezier",0,.5,1,.5],["get","DEPTH"],200,"#78bced",9e3,"#15659f"]}},"land-structure-polygon"))},coordinateFeature(e,t){return{center:[e,t],geometry:{type:"Point",coordinates:[e,t]},place_name:"Lat: "+t+" Lng: "+e,place_type:["coordinate"],properties:{},type:"Feature"}},resizeMap(){this.map.resize()},async geoCodeReverse(e){mbxGeocoding({accessToken:mapboxgl.accessToken}).reverseGeocode({query:[e.pointLng,e.pointLat]}).send().then(function(r){if(r&&r.body&&r.body.features){e.address=r.body.features[0].place_name;let n=r.body.features[0].context;for(let a of n){let s=a.id;switch(s.substring(0,s.indexOf("."))){case"neighborhood":e.neighborhood=a.text;break;case"postcode":e.postcode=a.text;break;case"locality":e.locality=a.text;break;case"place":e.place=a.text;break;case"district":e.district=a.text;break;case"region":e.region=a.text;break;case"country":e.country=a.text;break}}}})},updateBBox(e){let t=e.features[0].geometry.coordinates[0],r,n,a,s;r=t[3][0],n=t[3][1],a=t[1][0],s=t[1][1];let f=[r,n,a,s],o=mapUtils.getTileInfo(0,0,!0,0,0,0,f);idbKeyval.set("tile_info",o)},async loadMapboxMap(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken,this.mapbox_api_url=await idbKeyval.get("mapbox_api_url"),this.dirHandle=await idbKeyval.get("dirHandle"),this.style_url=await idbKeyval.get("mapbox_style_url"),this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem");let e=this;if(!mapboxgl.supported())this.alertMsg="Your browser does not support Mapbox GL",this.alert=!0;else{let o=function(x){return x*(2-x)},t=new mapboxgl.Map({container:"map",trackResize:!0,style:e.style_url,center:[-121.7598,46.876],zoom:9,maxZoom:14,doubleClickZoom:!1,antialias:!0,boxZoom:!0,failIfMajorPerformanceCaveat:!0});this.map=t,this.map.doubleClickZoom.disable();const r=function(x){const C=x.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!C)return null;const P=Number(C[1]),Y=Number(C[2]),ze=[];return(P<-90||P>90)&&ze.push(e.coordinateFeature(P,Y)),(Y<-90||Y>90)&&ze.push(e.coordinateFeature(Y,P)),ze.length===0&&(ze.push(e.coordinateFeature(P,Y)),ze.push(e.coordinateFeature(Y,P))),ze};geocoder=new MapboxGeocoder$1({accessToken:this.access_token,mapboxgl,localGeocoder:r,zoom:10,placeholder:"Try: Lng , Lat or Name",reverseGeocode:!0}),t.addControl(geocoder),t.addControl(new mapboxgl.FullscreenControl({})),t.addControl(new mapboxgl.NavigationControl),draw$1=new MapboxDraw({modes:{...MapboxDraw.modes,draw_assisted_rectangle:_default},displayControlsDefault:!1,controls:{},userProperties:!0,styles:STYLES_DRAW$1}),t.addControl(draw$1);const n=new MapboxGLButtonControl({className:"mapbox-gl-draw_polygon",title:"Select single tile",eventHandler:e.changeDrawMode});t.addControl(n);const a=new MapboxGLButtonControl({className:"mapbox-gl-draw_line",title:"Draw Rectangle to select multiple tiles",eventHandler:e.changeDrawMode});t.addControl(a);const s=100,f=25;t.on("wheel",()=>{e.zoom=Math.floor(t.getZoom())}),t.on("load",function(){let x=document.getElementsByClassName("mapbox-gl-draw_polygon")[0];x.style.backgroundColor="green",draw$1.changeMode("simple_select"),this.drawmode="simple_select",e.loadMapSourcesLayers(t),t.getCanvas().focus(),t.getCanvas().addEventListener("keydown",C=>{C.preventDefault(),C.which===87?t.panBy([0,-s],{easing:o}):C.which===83?t.panBy([0,s],{easing:o}):C.which===65?t.easeTo({bearing:t.getBearing()-f,easing:o}):C.which===68&&t.easeTo({bearing:t.getBearing()+f,easing:o})},!0)}),t.on("error",x=>{console.error(x)}),t.on("draw.create",function(x){console.log("draw mode create "+x.type),e.updateBBox(x)}),t.on("draw.update",function(x){console.log("draw mode update "+x.type),e.updateBBox(x)}),t.on("draw.selectionchange",function(x){console.log("draw mode selectionchange "+x.type)}),t.on("draw.delete",function(x){console.log("draw mode delete "+x.type)}),t.on("draw.modechange",x=>{console.log("draw mode CHANGE "+x.mode)}),t.on("click",async function(x){if(e.drawmode==="simple_select"){let C=x.lngLat.lng,P=x.lngLat.lat,Y=Math.floor(t.getZoom());e.zoom=Y;let ze=mapUtils.getTileInfo(C,P,!1,0,0,Y);idbKeyval.set("tile_info",ze),e.tileInfoString="Slippy Tile Info String: "+ze.x+","+ze.y+","+ze.z+" Bounding Box sides in KM: "+ze.distance,t.getSource("bounding_box_source").setData(ze.polygon_bb),t.setPaintProperty("bounding_box","fill-opacity",.45)}}),t.on("dblclick",async function(x){let C=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(C,!0)===!1){console.error(`User did not grant permission to '${C.name}'`);return}let P=await idbKeyval.get("tile_info"),Y=!0;if(e.tileInfoString="Slippy Tile Info String: "+P.x+","+P.y+","+P.z+" Bounding Box sides in KM: "+P.distance,e.drawmode==="simple_select"){e.qt.loading.show(),e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${P.z}/${P.x}/${P.y}@2x.pngraw?access_token=`+e.access_token;let ze=await mapUtils.getMapboxTerrainRgb(e.mapbox_rgb_image_url),ge=await ze.toBuffer();await idbKeyval.set("rgb_image_buffer",ge),await fileUtils.writeFileToDisk(C,P.rgbFileName,ge);let Bt=mapUtils.createHeightMapImage(ze,32,"GREY");if(await fileUtils.fileExists(C,P.thirtyTwoFileName)===!1){let kn=await Bt.image.toBuffer();await fileUtils.writeFileToDisk(C,P.thirtyTwoFileName,kn)}emitter.emit("updatePreviewImage",{dir_handle:C,tile_info:P,preview_image_info:Bt,map:t,updateStats:Y}),e.qt.loading.hide()}else if(e.drawmode==="draw_assisted_rectangle"){e.qt.loading.show();let ze=await idbKeyval.get("exportOptionsModel"),ge=await idbKeyval.get("saveStitchingFiles"),Bt=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",Ur=await idbKeyval.get("mapbox_raster_style_url")||"",kn=Math.floor(t.getZoom()),Io={left:P.bbox[0],bottom:P.bbox[1],right:P.bbox[2],top:P.bbox[3]},rl=tilesInBbox.tilesInBbox(Io,kn),Co=[],as=[],$s=[];try{for(let _h of rl){let Ih={};P=mapUtils.getTileInfo(0,0,!0,_h.x,_h.y,_h.z,P.bbox),e.tileInfoString="Slippy Tile Info String: "+P.x+","+P.y+","+P.z+" Bounding Box sides in KM: "+P.distance,e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${P.z}/${P.x}/${P.y}@2x.pngraw?access_token=`+e.access_token;let Gh=await(await mapUtils.getMapboxTerrainRgb(e.mapbox_rgb_image_url)).toBuffer();if(ge===!0&&await fileUtils.writeFileToDisk(C,P.rgbFileName,Gh),Ih.x=P.x,Ih.y=P.y,Ih.buffer=Gh,Co.push(Ih),ze.includes("raster_style")){let ud=Bt+"/"+Ur+`/tiles/512/${P.z}/${P.x}/${P.y}@2x?access_token=`+e.access_token,Kd=await(await mapUtils.getMapboxTerrainRgb(ud)).toBuffer();Ih={},Ih.x=P.x,Ih.y=P.y,Ih.buffer=Kd,as.push(Ih)}if(ze.includes("satellite")){let Tf=await idbKeyval.get("mapbox_satellite_endpoint")+`/${P.z}/${P.x}/${P.y}@2x?access_token=`+e.access_token,Af=await(await mapUtils.getMapboxTerrainRgb(Tf)).toBuffer();Ih={},Ih.x=P.x,Ih.y=P.y,Ih.buffer=Af,$s.push(Ih)}}idbKeyval.set("tile_info",P);const ah=512;let ch=await combineTilesJimp(Co,ah,ah);if(await idbKeyval.set("rgb_image_buffer",ch),await fileUtils.writeFileToDisk(C,P.rgbFileName,ch),ze.includes("raster_style")){let _h=await combineTilesJimp(as,ah,ah);await idbKeyval.set("splat_image_buffer",_h),await fileUtils.writeFileToDisk(C,"splat_"+P.rgbFileName,_h)}if(ze.includes("satellite")){let _h=await combineTilesJimp($s,ah,ah);await idbKeyval.set("sat_image_buffer",_h),await fileUtils.writeFileToDisk(C,"sat_"+P.rgbFileName,_h)}let Zu=await idbKeyval.get("rgb_image_buffer"),ih=await mapUtils.loadImageFromArray(Zu),al=mapUtils.createHeightMapImage(ih,32,"GREY");if(await fileUtils.fileExists(C,P.thirtyTwoFileName)===!1){let _h=await al.image.toBuffer();await fileUtils.writeFileToDisk(C,P.thirtyTwoFileName,_h)}emitter.emit("updatePreviewImage",{dir_handle:C,tile_info:P,preview_image_info:al,map:t,updateStats:Y}),e.qt.loading.hide()}catch(ah){console.log(ah),e.alertMsg=ah,e.alert=!0,e.qt.loading.hide()}e.qt.loading.hide()}})}}}},_hoisted_1$5={id:"map"},_hoisted_2$4=createBaseVNode("pre",{id:"features"},null,-1),_hoisted_3$4={class:"row no-wrap q-pa-md"},_hoisted_4$4={class:"column"},_hoisted_5$4=createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1),_hoisted_6$4=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$5(e,t,r,n,a,s){return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$5,[_hoisted_2$4,createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("div",_hoisted_4$4,[_hoisted_5$4,createVNode(QOptionGroup,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:n.layer_type,type:"toggle",modelValue:n.layers,"onUpdate:modelValue":[t[0]||(t[0]=f=>n.layers=f),s.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),createTextVNode("       "+toDisplayString(" Zoom: "+this.zoom+" "+this.tileInfoString),1)]),_:1})]),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[1]||(t[1]=f=>n.alert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_6$4]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const MapboxMapViewer=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),maptilerSdk="";var maplibreGl={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){var r,n,a;function s(o,x){if(!r)r=x;else if(!n)n=x;else{var C="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",P={};r(P),a=x(P),typeof window<"u"&&(a.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}s(["exports"],function(o){var x=C;function C(_,p,S,j){this.cx=3*_,this.bx=3*(S-_)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p,this.by=3*(j-p)-this.cy,this.ay=1-this.cy-this.by,this.p1x=_,this.p1y=p,this.p2x=S,this.p2y=j}function P(_,p,S,j){const ut=new x(_,p,S,j);return function(Ot){return ut.solve(Ot)}}C.prototype={sampleCurveX:function(_){return((this.ax*_+this.bx)*_+this.cx)*_},sampleCurveY:function(_){return((this.ay*_+this.by)*_+this.cy)*_},sampleCurveDerivativeX:function(_){return(3*this.ax*_+2*this.bx)*_+this.cx},solveCurveX:function(_,p){if(p===void 0&&(p=1e-6),_<0)return 0;if(_>1)return 1;for(var S=_,j=0;j<8;j++){var ut=this.sampleCurveX(S)-_;if(Math.abs(ut)<p)return S;var Ot=this.sampleCurveDerivativeX(S);if(Math.abs(Ot)<1e-6)break;S-=ut/Ot}var fi=0,Bn=1;for(S=_,j=0;j<20&&(ut=this.sampleCurveX(S),!(Math.abs(ut-_)<p));j++)_>ut?fi=S:Bn=S,S=.5*(Bn-fi)+fi;return S},solve:function(_,p){return this.sampleCurveY(this.solveCurveX(_,p))}};const Y=P(.25,.1,.25,1);function ze(_,p,S){return Math.min(S,Math.max(p,_))}function ge(_,p,S){const j=S-p,ut=((_-p)%j+j)%j+p;return ut===p?S:ut}function Bt(_,...p){for(const S of p)for(const j in S)_[j]=S[j];return _}let Ur=1;function kn(_,p){_.forEach(S=>{p[S]&&(p[S]=p[S].bind(p))})}function Io(_,p,S){const j={};for(const ut in _)j[ut]=p.call(S||this,_[ut],ut,_);return j}function rl(_,p,S){const j={};for(const ut in _)p.call(S||this,_[ut],ut,_)&&(j[ut]=_[ut]);return j}function Co(_){return Array.isArray(_)?_.map(Co):typeof _=="object"&&_?Io(_,Co):_}const as={};function $s(_){as[_]||(typeof console<"u"&&console.warn(_),as[_]=!0)}function ah(_,p,S){return(S.y-_.y)*(p.x-_.x)>(p.y-_.y)*(S.x-_.x)}function ch(_){let p=0;for(let S,j,ut=0,Ot=_.length,fi=Ot-1;ut<Ot;fi=ut++)S=_[ut],j=_[fi],p+=(j.x-S.x)*(S.y+j.y);return p}function Zu(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ih=null;function al(_){if(ih==null){const p=_.navigator?_.navigator.userAgent:null;ih=!!_.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return ih}function sh(_){return typeof ImageBitmap<"u"&&_ instanceof ImageBitmap}const _h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ih,Lh;const Gh={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_){const p=requestAnimationFrame(_);return{cancel:()=>cancelAnimationFrame(p)}},getImageData(_,p=0){return this.getImageCanvasContext(_).getImageData(-p,-p,_.width+2*p,_.height+2*p)},getImageCanvasContext(_){const p=window.document.createElement("canvas"),S=p.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("failed to create canvas 2d context");return p.width=_.width,p.height=_.height,S.drawImage(_,0,0,_.width,_.height),S},resolveURL:_=>(Ih||(Ih=document.createElement("a")),Ih.href=_,Ih.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Lh==null&&(Lh=matchMedia("(prefers-reduced-motion: reduce)")),Lh.matches)}};var ud=Tf;function Tf(_,p){this.x=_,this.y=p}Tf.prototype={clone:function(){return new Tf(this.x,this.y)},add:function(_){return this.clone()._add(_)},sub:function(_){return this.clone()._sub(_)},multByPoint:function(_){return this.clone()._multByPoint(_)},divByPoint:function(_){return this.clone()._divByPoint(_)},mult:function(_){return this.clone()._mult(_)},div:function(_){return this.clone()._div(_)},rotate:function(_){return this.clone()._rotate(_)},rotateAround:function(_,p){return this.clone()._rotateAround(_,p)},matMult:function(_){return this.clone()._matMult(_)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(_){return this.x===_.x&&this.y===_.y},dist:function(_){return Math.sqrt(this.distSqr(_))},distSqr:function(_){var p=_.x-this.x,S=_.y-this.y;return p*p+S*S},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(_){return Math.atan2(this.y-_.y,this.x-_.x)},angleWith:function(_){return this.angleWithSep(_.x,_.y)},angleWithSep:function(_,p){return Math.atan2(this.x*p-this.y*_,this.x*_+this.y*p)},_matMult:function(_){var p=_[2]*this.x+_[3]*this.y;return this.x=_[0]*this.x+_[1]*this.y,this.y=p,this},_add:function(_){return this.x+=_.x,this.y+=_.y,this},_sub:function(_){return this.x-=_.x,this.y-=_.y,this},_mult:function(_){return this.x*=_,this.y*=_,this},_div:function(_){return this.x/=_,this.y/=_,this},_multByPoint:function(_){return this.x*=_.x,this.y*=_.y,this},_divByPoint:function(_){return this.x/=_.x,this.y/=_.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var _=this.y;return this.y=this.x,this.x=-_,this},_rotate:function(_){var p=Math.cos(_),S=Math.sin(_),j=S*this.x+p*this.y;return this.x=p*this.x-S*this.y,this.y=j,this},_rotateAround:function(_,p){var S=Math.cos(_),j=Math.sin(_),ut=p.y+j*(this.x-p.x)+S*(this.y-p.y);return this.x=p.x+S*(this.x-p.x)-j*(this.y-p.y),this.y=ut,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tf.convert=function(_){return _ instanceof Tf?_:Array.isArray(_)?new Tf(_[0],_[1]):_};const Kd={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,REGISTERED_PROTOCOLS:{}};class Af extends Error{constructor(p,S,j,ut){super(`AJAXError: ${S} (${p}): ${j}`),this.status=p,this.statusText=S,this.url=j,this.body=ut}}const md=Zu()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function vd(_,p){const S=new AbortController,j=new Request(_.url,{method:_.method||"GET",body:_.body,credentials:_.credentials,headers:_.headers,referrer:md(),signal:S.signal});let ut=!1,Ot=!1;return _.type==="json"&&j.headers.set("Accept","application/json"),Ot||fetch(j).then(fi=>fi.ok?(Bn=>{(_.type==="arrayBuffer"?Bn.arrayBuffer():_.type==="json"?Bn.json():Bn.text()).then(us=>{Ot||(ut=!0,p(null,us,Bn.headers.get("Cache-Control"),Bn.headers.get("Expires")))}).catch(us=>{Ot||p(new Error(us.message))})})(fi):fi.blob().then(Bn=>p(new Af(fi.status,fi.statusText,_.url,Bn)))).catch(fi=>{fi.code!==20&&p(new Error(fi.message))}),{cancel:()=>{Ot=!0,ut||S.abort()}}}const qd=function(_,p){if(/:\/\//.test(_.url)&&!/^https?:|^file:/.test(_.url)){if(Zu()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",_,p);if(!Zu()){const j=_.url.substring(0,_.url.indexOf("://"));return(Kd.REGISTERED_PROTOCOLS[j]||vd)(_,p)}}if(!(/^file:/.test(S=_.url)||/^file:/.test(md())&&!/^\w+:/.test(S))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return vd(_,p);if(Zu()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",_,p,void 0,!0)}var S;return function(j,ut){const Ot=new XMLHttpRequest;Ot.open(j.method||"GET",j.url,!0),j.type==="arrayBuffer"&&(Ot.responseType="arraybuffer");for(const fi in j.headers)Ot.setRequestHeader(fi,j.headers[fi]);return j.type==="json"&&(Ot.responseType="text",Ot.setRequestHeader("Accept","application/json")),Ot.withCredentials=j.credentials==="include",Ot.onerror=()=>{ut(new Error(Ot.statusText))},Ot.onload=()=>{if((Ot.status>=200&&Ot.status<300||Ot.status===0)&&Ot.response!==null){let fi=Ot.response;if(j.type==="json")try{fi=JSON.parse(Ot.response)}catch(Bn){return ut(Bn)}ut(null,fi,Ot.getResponseHeader("Cache-Control"),Ot.getResponseHeader("Expires"))}else{const fi=new Blob([Ot.response],{type:Ot.getResponseHeader("Content-Type")});ut(new Af(Ot.status,Ot.statusText,j.url,fi))}},Ot.send(j.body),{cancel:()=>Ot.abort()}}(_,p)},Ed=function(_,p){return qd(Bt(_,{type:"arrayBuffer"}),p)};function Sd(_){const p=window.document.createElement("a");return p.href=_,p.protocol===window.document.location.protocol&&p.host===window.document.location.host}function zd(_,p,S){S[_]&&S[_].indexOf(p)!==-1||(S[_]=S[_]||[],S[_].push(p))}function Md(_,p,S){if(S&&S[_]){const j=S[_].indexOf(p);j!==-1&&S[_].splice(j,1)}}class Gd{constructor(p,S={}){Bt(this,S),this.type=p}}class bf extends Gd{constructor(p,S={}){super("error",Bt({error:p},S))}}class Id{on(p,S){return this._listeners=this._listeners||{},zd(p,S,this._listeners),this}off(p,S){return Md(p,S,this._listeners),Md(p,S,this._oneTimeListeners),this}once(p,S){return S?(this._oneTimeListeners=this._oneTimeListeners||{},zd(p,S,this._oneTimeListeners),this):new Promise(j=>this.once(p,j))}fire(p,S){typeof p=="string"&&(p=new Gd(p,S||{}));const j=p.type;if(this.listens(j)){p.target=this;const ut=this._listeners&&this._listeners[j]?this._listeners[j].slice():[];for(const Bn of ut)Bn.call(this,p);const Ot=this._oneTimeListeners&&this._oneTimeListeners[j]?this._oneTimeListeners[j].slice():[];for(const Bn of Ot)Md(j,Bn,this._oneTimeListeners),Bn.call(this,p);const fi=this._eventedParent;fi&&(Bt(p,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),fi.fire(p))}else p instanceof bf&&console.error(p.error);return this}listens(p){return this._listeners&&this._listeners[p]&&this._listeners[p].length>0||this._oneTimeListeners&&this._oneTimeListeners[p]&&this._oneTimeListeners[p].length>0||this._eventedParent&&this._eventedParent.listens(p)}setEventedParent(p,S){return this._eventedParent=p,this._eventedParentData=S,this}}var td={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Fd{constructor(p,S,j,ut){this.message=(p?`${p}: `:"")+j,ut&&(this.identifier=ut),S!=null&&S.__line__&&(this.line=S.__line__)}}function rp(_){const p=_.value;return p?[new Fd(_.key,p,"constants have been deprecated as of v8")]:[]}function jf(_,...p){for(const S of p)for(const j in S)_[j]=S[j];return _}function yd(_){return _ instanceof Number||_ instanceof String||_ instanceof Boolean?_.valueOf():_}function Jd(_){if(Array.isArray(_))return _.map(Jd);if(_ instanceof Object&&!(_ instanceof Number||_ instanceof String||_ instanceof Boolean)){const p={};for(const S in _)p[S]=Jd(_[S]);return p}return yd(_)}class op extends Error{constructor(p,S){super(S),this.message=S,this.key=p}}class bp{constructor(p,S=[]){this.parent=p,this.bindings={};for(const[j,ut]of S)this.bindings[j]=ut}concat(p){return new bp(this,p)}get(p){if(this.bindings[p])return this.bindings[p];if(this.parent)return this.parent.get(p);throw new Error(`${p} not found in scope.`)}has(p){return!!this.bindings[p]||!!this.parent&&this.parent.has(p)}}const fp={kind:"null"},Qh={kind:"number"},Yd={kind:"string"},sd={kind:"boolean"},Zd={kind:"color"},Xh={kind:"object"},Ld={kind:"value"},Kf={kind:"collator"},If={kind:"formatted"},Df={kind:"padding"},Jf={kind:"resolvedImage"};function Nf(_,p){return{kind:"array",itemType:_,N:p}}function Wf(_){if(_.kind==="array"){const p=Wf(_.itemType);return typeof _.N=="number"?`array<${p}, ${_.N}>`:_.itemType.kind==="value"?"array":`array<${p}>`}return _.kind}const Mp=[fp,Qh,Yd,sd,Zd,If,Xh,Nf(Ld),Df,Jf];function Sp(_,p){if(p.kind==="error")return null;if(_.kind==="array"){if(p.kind==="array"&&(p.N===0&&p.itemType.kind==="value"||!Sp(_.itemType,p.itemType))&&(typeof _.N!="number"||_.N===p.N))return null}else{if(_.kind===p.kind)return null;if(_.kind==="value"){for(const S of Mp)if(!Sp(S,p))return null}}return`Expected ${Wf(_)} but found ${Wf(p)} instead.`}function Pp(_,p){return p.some(S=>S.kind===_.kind)}function Yf(_,p){return p.some(S=>S==="null"?_===null:S==="array"?Array.isArray(_):S==="object"?_&&!Array.isArray(_)&&typeof _=="object":S===typeof _)}var qp,sm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Xd(_){return(_=Math.round(_))<0?0:_>255?255:_}function Op(_){return Xd(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function rm(_){return(p=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:p>1?1:p;var p}function Sm(_,p,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?_+(p-_)*S*6:2*S<1?p:3*S<2?_+(p-_)*(2/3-S)*6:_}try{qp={}.parseCSSColor=function(_){var p,S=_.replace(/ /g,"").toLowerCase();if(S in sm)return sm[S].slice();if(S[0]==="#")return S.length===4?(p=parseInt(S.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:S.length===7&&(p=parseInt(S.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var j=S.indexOf("("),ut=S.indexOf(")");if(j!==-1&&ut+1===S.length){var Ot=S.substr(0,j),fi=S.substr(j+1,ut-(j+1)).split(","),Bn=1;switch(Ot){case"rgba":if(fi.length!==4)return null;Bn=rm(fi.pop());case"rgb":return fi.length!==3?null:[Op(fi[0]),Op(fi[1]),Op(fi[2]),Bn];case"hsla":if(fi.length!==4)return null;Bn=rm(fi.pop());case"hsl":if(fi.length!==3)return null;var us=(parseFloat(fi[0])%360+360)%360/360,ul=rm(fi[1]),Ju=rm(fi[2]),oh=Ju<=.5?Ju*(ul+1):Ju+ul-Ju*ul,gh=2*Ju-oh;return[Xd(255*Sm(gh,oh,us+1/3)),Xd(255*Sm(gh,oh,us)),Xd(255*Sm(gh,oh,us-1/3)),Bn];default:return null}}return null}}catch{}class hp{constructor(p,S,j,ut=1){this.r=p,this.g=S,this.b=j,this.a=ut}static parse(p){if(!p)return;if(p instanceof hp)return p;if(typeof p!="string")return;const S=qp(p);return S?new hp(S[0]/255*S[3],S[1]/255*S[3],S[2]/255*S[3],S[3]):void 0}toString(){const[p,S,j,ut]=this.toArray();return`rgba(${Math.round(p)},${Math.round(S)},${Math.round(j)},${ut})`}toArray(){const{r:p,g:S,b:j,a:ut}=this;return ut===0?[0,0,0,0]:[255*p/ut,255*S/ut,255*j/ut,ut]}}hp.black=new hp(0,0,0,1),hp.white=new hp(1,1,1,1),hp.transparent=new hp(0,0,0,0),hp.red=new hp(1,0,0,1);class Em{constructor(p,S,j){this.sensitivity=p?S?"variant":"case":S?"accent":"base",this.locale=j,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(p,S){return this.collator.compare(p,S)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qp{constructor(p,S,j,ut,Ot){this.text=p,this.image=S,this.scale=j,this.fontStack=ut,this.textColor=Ot}}class lm{constructor(p){this.sections=p}static fromString(p){return new lm([new Qp(p,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(p=>p.text.length!==0||p.image&&p.image.name.length!==0)}static factory(p){return p instanceof lm?p:lm.fromString(p)}toString(){return this.sections.length===0?"":this.sections.map(p=>p.text).join("")}}class Dd{constructor(p){this.values=p.slice()}static parse(p){if(p instanceof Dd)return p;if(typeof p=="number")return new Dd([p,p,p,p]);if(Array.isArray(p)&&!(p.length<1||p.length>4)){for(const S of p)if(typeof S!="number")return;switch(p.length){case 1:p=[p[0],p[0],p[0],p[0]];break;case 2:p=[p[0],p[1],p[0],p[1]];break;case 3:p=[p[0],p[1],p[2],p[1]]}return new Dd(p)}}toString(){return JSON.stringify(this.values)}}class Hf{constructor(p){this.name=p.name,this.available=p.available}toString(){return this.name}static fromString(p){return p?new Hf({name:p,available:!1}):null}}function mh(_,p,S,j){return typeof _=="number"&&_>=0&&_<=255&&typeof p=="number"&&p>=0&&p<=255&&typeof S=="number"&&S>=0&&S<=255?j===void 0||typeof j=="number"&&j>=0&&j<=1?null:`Invalid rgba value [${[_,p,S,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof j=="number"?[_,p,S,j]:[_,p,S]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Jh(_){if(_===null||typeof _=="string"||typeof _=="boolean"||typeof _=="number"||_ instanceof hp||_ instanceof Em||_ instanceof lm||_ instanceof Dd||_ instanceof Hf)return!0;if(Array.isArray(_)){for(const p of _)if(!Jh(p))return!1;return!0}if(typeof _=="object"){for(const p in _)if(!Jh(_[p]))return!1;return!0}return!1}function Wu(_){if(_===null)return fp;if(typeof _=="string")return Yd;if(typeof _=="boolean")return sd;if(typeof _=="number")return Qh;if(_ instanceof hp)return Zd;if(_ instanceof Em)return Kf;if(_ instanceof lm)return If;if(_ instanceof Dd)return Df;if(_ instanceof Hf)return Jf;if(Array.isArray(_)){const p=_.length;let S;for(const j of _){const ut=Wu(j);if(S){if(S===ut)continue;S=Ld;break}S=ut}return Nf(S||Ld,p)}return Xh}function sl(_){const p=typeof _;return _===null?"":p==="string"||p==="number"||p==="boolean"?String(_):_ instanceof hp||_ instanceof lm||_ instanceof Dd||_ instanceof Hf?_.toString():JSON.stringify(_)}class Gn{constructor(p,S){this.type=p,this.value=S}static parse(p,S){if(p.length!==2)return S.error(`'literal' expression requires exactly one argument, but found ${p.length-1} instead.`);if(!Jh(p[1]))return S.error("invalid value");const j=p[1];let ut=Wu(j);const Ot=S.expectedType;return ut.kind!=="array"||ut.N!==0||!Ot||Ot.kind!=="array"||typeof Ot.N=="number"&&Ot.N!==0||(ut=Ot),new Gn(ut,j)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _n{constructor(p){this.name="ExpressionEvaluationError",this.message=p}toJSON(){return this.message}}const cs={string:Yd,number:Qh,boolean:sd,object:Xh};class $u{constructor(p,S){this.type=p,this.args=S}static parse(p,S){if(p.length<2)return S.error("Expected at least one argument.");let j,ut=1;const Ot=p[0];if(Ot==="array"){let Bn,us;if(p.length>2){const ul=p[1];if(typeof ul!="string"||!(ul in cs)||ul==="object")return S.error('The item type argument of "array" must be one of string, number, boolean',1);Bn=cs[ul],ut++}else Bn=Ld;if(p.length>3){if(p[2]!==null&&(typeof p[2]!="number"||p[2]<0||p[2]!==Math.floor(p[2])))return S.error('The length argument to "array" must be a positive integer literal',2);us=p[2],ut++}j=Nf(Bn,us)}else{if(!cs[Ot])throw new Error(`Types doesn't contain name = ${Ot}`);j=cs[Ot]}const fi=[];for(;ut<p.length;ut++){const Bn=S.parse(p[ut],ut,Ld);if(!Bn)return null;fi.push(Bn)}return new $u(j,fi)}evaluate(p){for(let S=0;S<this.args.length;S++){const j=this.args[S].evaluate(p);if(!Sp(this.type,Wu(j)))return j;if(S===this.args.length-1)throw new _n(`Expected value to be of type ${Wf(this.type)}, but found ${Wf(Wu(j))} instead.`)}throw new Error}eachChild(p){this.args.forEach(p)}outputDefined(){return this.args.every(p=>p.outputDefined())}}const eh={"to-boolean":sd,"to-color":Zd,"to-number":Qh,"to-string":Yd};class nh{constructor(p,S){this.type=p,this.args=S}static parse(p,S){if(p.length<2)return S.error("Expected at least one argument.");const j=p[0];if(!eh[j])throw new Error(`Can't parse ${j} as it is not part of the known types`);if((j==="to-boolean"||j==="to-string")&&p.length!==2)return S.error("Expected one argument.");const ut=eh[j],Ot=[];for(let fi=1;fi<p.length;fi++){const Bn=S.parse(p[fi],fi,Ld);if(!Bn)return null;Ot.push(Bn)}return new nh(ut,Ot)}evaluate(p){if(this.type.kind==="boolean")return!!this.args[0].evaluate(p);if(this.type.kind==="color"){let S,j;for(const ut of this.args){if(S=ut.evaluate(p),j=null,S instanceof hp)return S;if(typeof S=="string"){const Ot=p.parseColor(S);if(Ot)return Ot}else if(Array.isArray(S)&&(j=S.length<3||S.length>4?`Invalid rbga value ${JSON.stringify(S)}: expected an array containing either three or four numeric values.`:mh(S[0],S[1],S[2],S[3]),!j))return new hp(S[0]/255,S[1]/255,S[2]/255,S[3])}throw new _n(j||`Could not parse color from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="padding"){let S;for(const j of this.args){S=j.evaluate(p);const ut=Dd.parse(S);if(ut)return ut}throw new _n(`Could not parse padding from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="number"){let S=null;for(const j of this.args){if(S=j.evaluate(p),S===null)return 0;const ut=Number(S);if(!isNaN(ut))return ut}throw new _n(`Could not convert ${JSON.stringify(S)} to number.`)}return this.type.kind==="formatted"?lm.fromString(sl(this.args[0].evaluate(p))):this.type.kind==="resolvedImage"?Hf.fromString(sl(this.args[0].evaluate(p))):sl(this.args[0].evaluate(p))}eachChild(p){this.args.forEach(p)}outputDefined(){return this.args.every(p=>p.outputDefined())}}const uh=["Unknown","Point","LineString","Polygon"];class dh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(p){let S=this._parseColorCache[p];return S||(S=this._parseColorCache[p]=hp.parse(p)),S}}class vh{constructor(p,S,j,ut){this.name=p,this.type=S,this._evaluate=j,this.args=ut}evaluate(p){return this._evaluate(p,this.args)}eachChild(p){this.args.forEach(p)}outputDefined(){return!1}static parse(p,S){const j=p[0],ut=vh.definitions[j];if(!ut)return S.error(`Unknown expression "${j}". If you wanted a literal array, use ["literal", [...]].`,0);const Ot=Array.isArray(ut)?ut[0]:ut.type,fi=Array.isArray(ut)?[[ut[1],ut[2]]]:ut.overloads,Bn=fi.filter(([ul])=>!Array.isArray(ul)||ul.length===p.length-1);let us=null;for(const[ul,Ju]of Bn){us=new c_(S.registry,S.path,null,S.scope);const oh=[];let gh=!1;for(let xh=1;xh<p.length;xh++){const bh=p[xh],Wh=Array.isArray(ul)?ul[xh-1]:ul.type,Zh=us.parse(bh,1+oh.length,Wh);if(!Zh){gh=!0;break}oh.push(Zh)}if(!gh)if(Array.isArray(ul)&&ul.length!==oh.length)us.error(`Expected ${ul.length} arguments, but found ${oh.length} instead.`);else{for(let xh=0;xh<oh.length;xh++){const bh=Array.isArray(ul)?ul[xh]:ul.type,Wh=oh[xh];us.concat(xh+1).checkSubtype(bh,Wh.type)}if(us.errors.length===0)return new vh(j,Ot,Ju,oh)}}if(Bn.length===1)S.errors.push(...us.errors);else{const ul=(Bn.length?Bn:fi).map(([oh])=>{return gh=oh,Array.isArray(gh)?`(${gh.map(Wf).join(", ")})`:`(${Wf(gh.type)}...)`;var gh}).join(" | "),Ju=[];for(let oh=1;oh<p.length;oh++){const gh=S.parse(p[oh],1+Ju.length);if(!gh)return null;Ju.push(Wf(gh.type))}S.error(`Expected arguments of type ${ul}, but found (${Ju.join(", ")}) instead.`)}return null}static register(p,S){vh.definitions=S;for(const j in S)p[j]=vh}}class Ph{constructor(p,S,j){this.type=Kf,this.locale=j,this.caseSensitive=p,this.diacriticSensitive=S}static parse(p,S){if(p.length!==2)return S.error("Expected one argument.");const j=p[1];if(typeof j!="object"||Array.isArray(j))return S.error("Collator options argument must be an object.");const ut=S.parse(j["case-sensitive"]!==void 0&&j["case-sensitive"],1,sd);if(!ut)return null;const Ot=S.parse(j["diacritic-sensitive"]!==void 0&&j["diacritic-sensitive"],1,sd);if(!Ot)return null;let fi=null;return j.locale&&(fi=S.parse(j.locale,1,Yd),!fi)?null:new Ph(ut,Ot,fi)}evaluate(p){return new Em(this.caseSensitive.evaluate(p),this.diacriticSensitive.evaluate(p),this.locale?this.locale.evaluate(p):null)}eachChild(p){p(this.caseSensitive),p(this.diacriticSensitive),this.locale&&p(this.locale)}outputDefined(){return!1}}const zh=8192;function Ad(_,p){_[0]=Math.min(_[0],p[0]),_[1]=Math.min(_[1],p[1]),_[2]=Math.max(_[2],p[0]),_[3]=Math.max(_[3],p[1])}function wd(_,p){return!(_[0]<=p[0]||_[2]>=p[2]||_[1]<=p[1]||_[3]>=p[3])}function Qd(_,p){const S=(180+_[0])/360,j=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_[1]*Math.PI/360)))/360,ut=Math.pow(2,p.z);return[Math.round(S*ut*zh),Math.round(j*ut*zh)]}function xf(_,p,S){const j=_[0]-p[0],ut=_[1]-p[1],Ot=_[0]-S[0],fi=_[1]-S[1];return j*fi-Ot*ut==0&&j*Ot<=0&&ut*fi<=0}function zf(_,p){let S=!1;for(let fi=0,Bn=p.length;fi<Bn;fi++){const us=p[fi];for(let ul=0,Ju=us.length;ul<Ju-1;ul++){if(xf(_,us[ul],us[ul+1]))return!1;(ut=us[ul])[1]>(j=_)[1]!=(Ot=us[ul+1])[1]>j[1]&&j[0]<(Ot[0]-ut[0])*(j[1]-ut[1])/(Ot[1]-ut[1])+ut[0]&&(S=!S)}}var j,ut,Ot;return S}function np(_,p){for(let S=0;S<p.length;S++)if(zf(_,p[S]))return!0;return!1}function Ah(_,p,S,j){const ut=j[0]-S[0],Ot=j[1]-S[1],fi=(_[0]-S[0])*Ot-ut*(_[1]-S[1]),Bn=(p[0]-S[0])*Ot-ut*(p[1]-S[1]);return fi>0&&Bn<0||fi<0&&Bn>0}function mf(_,p,S){for(const ul of S)for(let Ju=0;Ju<ul.length-1;++Ju)if((Bn=[(fi=ul[Ju+1])[0]-(Ot=ul[Ju])[0],fi[1]-Ot[1]])[0]*(us=[(ut=p)[0]-(j=_)[0],ut[1]-j[1]])[1]-Bn[1]*us[0]!=0&&Ah(j,ut,Ot,fi)&&Ah(Ot,fi,j,ut))return!0;var j,ut,Ot,fi,Bn,us;return!1}function Od(_,p){for(let S=0;S<_.length;++S)if(!zf(_[S],p))return!1;for(let S=0;S<_.length-1;++S)if(mf(_[S],_[S+1],p))return!1;return!0}function qf(_,p){for(let S=0;S<p.length;S++)if(Od(_,p[S]))return!0;return!1}function mp(_,p,S){const j=[];for(let ut=0;ut<_.length;ut++){const Ot=[];for(let fi=0;fi<_[ut].length;fi++){const Bn=Qd(_[ut][fi],S);Ad(p,Bn),Ot.push(Bn)}j.push(Ot)}return j}function Vp(_,p,S){const j=[];for(let ut=0;ut<_.length;ut++){const Ot=mp(_[ut],p,S);j.push(Ot)}return j}function om(_,p,S,j){if(_[0]<S[0]||_[0]>S[2]){const ut=.5*j;let Ot=_[0]-S[0]>ut?-j:S[0]-_[0]>ut?j:0;Ot===0&&(Ot=_[0]-S[2]>ut?-j:S[2]-_[0]>ut?j:0),_[0]+=Ot}Ad(p,_)}function Pd(_,p,S,j){const ut=Math.pow(2,j.z)*zh,Ot=[j.x*zh,j.y*zh],fi=[];for(const Bn of _)for(const us of Bn){const ul=[us.x+Ot[0],us.y+Ot[1]];om(ul,p,S,ut),fi.push(ul)}return fi}function Hg(_,p,S,j){const ut=Math.pow(2,j.z)*zh,Ot=[j.x*zh,j.y*zh],fi=[];for(const us of _){const ul=[];for(const Ju of us){const oh=[Ju.x+Ot[0],Ju.y+Ot[1]];Ad(p,oh),ul.push(oh)}fi.push(ul)}if(p[2]-p[0]<=ut/2){(Bn=p)[0]=Bn[1]=1/0,Bn[2]=Bn[3]=-1/0;for(const us of fi)for(const ul of us)om(ul,p,S,ut)}var Bn;return fi}class Fm{constructor(p,S){this.type=sd,this.geojson=p,this.geometries=S}static parse(p,S){if(p.length!==2)return S.error(`'within' expression requires exactly one argument, but found ${p.length-1} instead.`);if(Jh(p[1])){const j=p[1];if(j.type==="FeatureCollection")for(let ut=0;ut<j.features.length;++ut){const Ot=j.features[ut].geometry.type;if(Ot==="Polygon"||Ot==="MultiPolygon")return new Fm(j,j.features[ut].geometry)}else if(j.type==="Feature"){const ut=j.geometry.type;if(ut==="Polygon"||ut==="MultiPolygon")return new Fm(j,j.geometry)}else if(j.type==="Polygon"||j.type==="MultiPolygon")return new Fm(j,j)}return S.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(p){if(p.geometry()!=null&&p.canonicalID()!=null){if(p.geometryType()==="Point")return function(S,j){const ut=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],fi=S.canonicalID();if(j.type==="Polygon"){const Bn=mp(j.coordinates,Ot,fi),us=Pd(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!zf(ul,Bn))return!1}if(j.type==="MultiPolygon"){const Bn=Vp(j.coordinates,Ot,fi),us=Pd(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!np(ul,Bn))return!1}return!0}(p,this.geometries);if(p.geometryType()==="LineString")return function(S,j){const ut=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],fi=S.canonicalID();if(j.type==="Polygon"){const Bn=mp(j.coordinates,Ot,fi),us=Hg(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!Od(ul,Bn))return!1}if(j.type==="MultiPolygon"){const Bn=Vp(j.coordinates,Ot,fi),us=Hg(S.geometry(),ut,Ot,fi);if(!wd(ut,Ot))return!1;for(const ul of us)if(!qf(ul,Bn))return!1}return!0}(p,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function I_(_){if(_ instanceof vh&&(_.name==="get"&&_.args.length===1||_.name==="feature-state"||_.name==="has"&&_.args.length===1||_.name==="properties"||_.name==="geometry-type"||_.name==="id"||/^filter-/.test(_.name))||_ instanceof Fm)return!1;let p=!0;return _.eachChild(S=>{p&&!I_(S)&&(p=!1)}),p}function Dy(_){if(_ instanceof vh&&_.name==="feature-state")return!1;let p=!0;return _.eachChild(S=>{p&&!Dy(S)&&(p=!1)}),p}function Pg(_,p){if(_ instanceof vh&&p.indexOf(_.name)>=0)return!1;let S=!0;return _.eachChild(j=>{S&&!Pg(j,p)&&(S=!1)}),S}class l_{constructor(p,S){this.type=S.type,this.name=p,this.boundExpression=S}static parse(p,S){if(p.length!==2||typeof p[1]!="string")return S.error("'var' expression requires exactly one string literal argument.");const j=p[1];return S.scope.has(j)?new l_(j,S.scope.get(j)):S.error(`Unknown variable "${j}". Make sure "${j}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(p){return this.boundExpression.evaluate(p)}eachChild(){}outputDefined(){return!1}}class ev{constructor(p,S=[],j,ut=new bp,Ot=[]){this.registry=p,this.path=S,this.key=S.map(fi=>`[${fi}]`).join(""),this.scope=ut,this.errors=Ot,this.expectedType=j}parse(p,S,j,ut,Ot={}){return S?this.concat(S,j,ut)._parse(p,Ot):this._parse(p,Ot)}_parse(p,S){function j(ut,Ot,fi){return fi==="assert"?new $u(Ot,[ut]):fi==="coerce"?new nh(Ot,[ut]):ut}if(p!==null&&typeof p!="string"&&typeof p!="boolean"&&typeof p!="number"||(p=["literal",p]),Array.isArray(p)){if(p.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ut=p[0];if(typeof ut!="string")return this.error(`Expression name must be a string, but found ${typeof ut} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Ot=this.registry[ut];if(Ot){let fi=Ot.parse(p,this);if(!fi)return null;if(this.expectedType){const Bn=this.expectedType,us=fi.type;if(Bn.kind!=="string"&&Bn.kind!=="number"&&Bn.kind!=="boolean"&&Bn.kind!=="object"&&Bn.kind!=="array"||us.kind!=="value")if(Bn.kind!=="color"&&Bn.kind!=="formatted"&&Bn.kind!=="resolvedImage"||us.kind!=="value"&&us.kind!=="string")if(Bn.kind!=="padding"||us.kind!=="value"&&us.kind!=="number"&&us.kind!=="array"){if(this.checkSubtype(Bn,us))return null}else fi=j(fi,Bn,S.typeAnnotation||"coerce");else fi=j(fi,Bn,S.typeAnnotation||"coerce");else fi=j(fi,Bn,S.typeAnnotation||"assert")}if(!(fi instanceof Gn)&&fi.type.kind!=="resolvedImage"&&ep(fi)){const Bn=new dh;try{fi=new Gn(fi.type,fi.evaluate(Bn))}catch(us){return this.error(us.message),null}}return fi}return this.error(`Unknown expression "${ut}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(p===void 0?"'undefined' value invalid. Use null instead.":typeof p=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof p} instead.`)}concat(p,S,j){const ut=typeof p=="number"?this.path.concat(p):this.path,Ot=j?this.scope.concat(j):this.scope;return new ev(this.registry,ut,S||null,Ot,this.errors)}error(p,...S){const j=`${this.key}${S.map(ut=>`[${ut}]`).join("")}`;this.errors.push(new op(j,p))}checkSubtype(p,S){const j=Sp(p,S);return j&&this.error(j),j}}var c_=ev;function ep(_){if(_ instanceof l_)return ep(_.boundExpression);if(_ instanceof vh&&_.name==="error"||_ instanceof Ph||_ instanceof Fm)return!1;const p=_ instanceof nh||_ instanceof $u;let S=!0;return _.eachChild(j=>{S=p?S&&ep(j):S&&j instanceof Gn}),!!S&&I_(_)&&Pg(_,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function im(_,p){const S=_.length-1;let j,ut,Ot=0,fi=S,Bn=0;for(;Ot<=fi;)if(Bn=Math.floor((Ot+fi)/2),j=_[Bn],ut=_[Bn+1],j<=p){if(Bn===S||p<ut)return Bn;Ot=Bn+1}else{if(!(j>p))throw new _n("Input is not a number.");fi=Bn-1}return 0}class Jp{constructor(p,S,j){this.type=p,this.input=S,this.labels=[],this.outputs=[];for(const[ut,Ot]of j)this.labels.push(ut),this.outputs.push(Ot)}static parse(p,S){if(p.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${p.length-1}.`);if((p.length-1)%2!=0)return S.error("Expected an even number of arguments.");const j=S.parse(p[1],1,Qh);if(!j)return null;const ut=[];let Ot=null;S.expectedType&&S.expectedType.kind!=="value"&&(Ot=S.expectedType);for(let fi=1;fi<p.length;fi+=2){const Bn=fi===1?-1/0:p[fi],us=p[fi+1],ul=fi,Ju=fi+1;if(typeof Bn!="number")return S.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ul);if(ut.length&&ut[ut.length-1][0]>=Bn)return S.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ul);const oh=S.parse(us,Ju,Ot);if(!oh)return null;Ot=Ot||oh.type,ut.push([Bn,oh])}return new Jp(Ot,j,ut)}evaluate(p){const S=this.labels,j=this.outputs;if(S.length===1)return j[0].evaluate(p);const ut=this.input.evaluate(p);if(ut<=S[0])return j[0].evaluate(p);const Ot=S.length;return ut>=S[Ot-1]?j[Ot-1].evaluate(p):j[im(S,ut)].evaluate(p)}eachChild(p){p(this.input);for(const S of this.outputs)p(S)}outputDefined(){return this.outputs.every(p=>p.outputDefined())}}function mm(_,p,S){return _*(1-S)+p*S}var yr=Object.freeze({__proto__:null,array:function(_,p,S){return _.map((j,ut)=>mm(j,p[ut],S))},color:function(_,p,S){return new hp(mm(_.r,p.r,S),mm(_.g,p.g,S),mm(_.b,p.b,S),mm(_.a,p.a,S))},number:mm,padding:function(_,p,S){const j=_.values,ut=p.values;return new Dd([mm(j[0],ut[0],S),mm(j[1],ut[1],S),mm(j[2],ut[2],S),mm(j[3],ut[3],S)])}});const el=.95047,yh=1.08883,Uh=4/29,nd=6/29,od=3*nd*nd,ad=Math.PI/180,Gf=180/Math.PI;function Ef(_){return _>.008856451679035631?Math.pow(_,1/3):_/od+Uh}function _p(_){return _>nd?_*_*_:od*(_-Uh)}function ap(_){return 255*(_<=.0031308?12.92*_:1.055*Math.pow(_,1/2.4)-.055)}function lp(_){return(_/=255)<=.04045?_/12.92:Math.pow((_+.055)/1.055,2.4)}function Zp(_){const p=lp(_.r),S=lp(_.g),j=lp(_.b),ut=Ef((.4124564*p+.3575761*S+.1804375*j)/el),Ot=Ef((.2126729*p+.7151522*S+.072175*j)/1);return{l:116*Ot-16,a:500*(ut-Ot),b:200*(Ot-Ef((.0193339*p+.119192*S+.9503041*j)/yh)),alpha:_.a}}function Rm(_){let p=(_.l+16)/116,S=isNaN(_.a)?p:p+_.a/500,j=isNaN(_.b)?p:p-_.b/200;return p=1*_p(p),S=el*_p(S),j=yh*_p(j),new hp(ap(3.2404542*S-1.5371385*p-.4985314*j),ap(-.969266*S+1.8760108*p+.041556*j),ap(.0556434*S-.2040259*p+1.0572252*j),_.alpha)}function Yp(_,p,S){const j=p-_;return _+S*(j>180||j<-180?j-360*Math.round(j/360):j)}const Pm={forward:Zp,reverse:Rm,interpolate:function(_,p,S){return{l:mm(_.l,p.l,S),a:mm(_.a,p.a,S),b:mm(_.b,p.b,S),alpha:mm(_.alpha,p.alpha,S)}}},kf={forward:function(_){const{l:p,a:S,b:j}=Zp(_),ut=Math.atan2(j,S)*Gf;return{h:ut<0?ut+360:ut,c:Math.sqrt(S*S+j*j),l:p,alpha:_.a}},reverse:function(_){const p=_.h*ad,S=_.c;return Rm({l:_.l,a:Math.cos(p)*S,b:Math.sin(p)*S,alpha:_.alpha})},interpolate:function(_,p,S){return{h:Yp(_.h,p.h,S),c:mm(_.c,p.c,S),l:mm(_.l,p.l,S),alpha:mm(_.alpha,p.alpha,S)}}};var Tp=Object.freeze({__proto__:null,hcl:kf,lab:Pm});class Np{constructor(p,S,j,ut,Ot){this.type=p,this.operator=S,this.interpolation=j,this.input=ut,this.labels=[],this.outputs=[];for(const[fi,Bn]of Ot)this.labels.push(fi),this.outputs.push(Bn)}static interpolationFactor(p,S,j,ut){let Ot=0;if(p.name==="exponential")Ot=Jm(S,p.base,j,ut);else if(p.name==="linear")Ot=Jm(S,1,j,ut);else if(p.name==="cubic-bezier"){const fi=p.controlPoints;Ot=new x(fi[0],fi[1],fi[2],fi[3]).solve(Jm(S,1,j,ut))}return Ot}static parse(p,S){let[j,ut,Ot,...fi]=p;if(!Array.isArray(ut)||ut.length===0)return S.error("Expected an interpolation type expression.",1);if(ut[0]==="linear")ut={name:"linear"};else if(ut[0]==="exponential"){const ul=ut[1];if(typeof ul!="number")return S.error("Exponential interpolation requires a numeric base.",1,1);ut={name:"exponential",base:ul}}else{if(ut[0]!=="cubic-bezier")return S.error(`Unknown interpolation type ${String(ut[0])}`,1,0);{const ul=ut.slice(1);if(ul.length!==4||ul.some(Ju=>typeof Ju!="number"||Ju<0||Ju>1))return S.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ut={name:"cubic-bezier",controlPoints:ul}}}if(p.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${p.length-1}.`);if((p.length-1)%2!=0)return S.error("Expected an even number of arguments.");if(Ot=S.parse(Ot,2,Qh),!Ot)return null;const Bn=[];let us=null;j==="interpolate-hcl"||j==="interpolate-lab"?us=Zd:S.expectedType&&S.expectedType.kind!=="value"&&(us=S.expectedType);for(let ul=0;ul<fi.length;ul+=2){const Ju=fi[ul],oh=fi[ul+1],gh=ul+3,xh=ul+4;if(typeof Ju!="number")return S.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',gh);if(Bn.length&&Bn[Bn.length-1][0]>=Ju)return S.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',gh);const bh=S.parse(oh,xh,us);if(!bh)return null;us=us||bh.type,Bn.push([Ju,bh])}return us.kind==="number"||us.kind==="color"||us.kind==="padding"||us.kind==="array"&&us.itemType.kind==="number"&&typeof us.N=="number"?new Np(us,j,ut,Ot,Bn):S.error(`Type ${Wf(us)} is not interpolatable.`)}evaluate(p){const S=this.labels,j=this.outputs;if(S.length===1)return j[0].evaluate(p);const ut=this.input.evaluate(p);if(ut<=S[0])return j[0].evaluate(p);const Ot=S.length;if(ut>=S[Ot-1])return j[Ot-1].evaluate(p);const fi=im(S,ut),Bn=Np.interpolationFactor(this.interpolation,ut,S[fi],S[fi+1]),us=j[fi].evaluate(p),ul=j[fi+1].evaluate(p);return this.operator==="interpolate"?yr[this.type.kind.toLowerCase()](us,ul,Bn):this.operator==="interpolate-hcl"?kf.reverse(kf.interpolate(kf.forward(us),kf.forward(ul),Bn)):Pm.reverse(Pm.interpolate(Pm.forward(us),Pm.forward(ul),Bn))}eachChild(p){p(this.input);for(const S of this.outputs)p(S)}outputDefined(){return this.outputs.every(p=>p.outputDefined())}}function Jm(_,p,S,j){const ut=j-S,Ot=_-S;return ut===0?0:p===1?Ot/ut:(Math.pow(p,Ot)-1)/(Math.pow(p,ut)-1)}class Um{constructor(p,S){this.type=p,this.args=S}static parse(p,S){if(p.length<2)return S.error("Expectected at least one argument.");let j=null;const ut=S.expectedType;ut&&ut.kind!=="value"&&(j=ut);const Ot=[];for(const Bn of p.slice(1)){const us=S.parse(Bn,1+Ot.length,j,void 0,{typeAnnotation:"omit"});if(!us)return null;j=j||us.type,Ot.push(us)}if(!j)throw new Error("No output type");const fi=ut&&Ot.some(Bn=>Sp(ut,Bn.type));return new Um(fi?Ld:j,Ot)}evaluate(p){let S,j=null,ut=0;for(const Ot of this.args)if(ut++,j=Ot.evaluate(p),j&&j instanceof Hf&&!j.available&&(S||(S=j.name),j=null,ut===this.args.length&&(j=S)),j!==null)break;return j}eachChild(p){this.args.forEach(p)}outputDefined(){return this.args.every(p=>p.outputDefined())}}class bg{constructor(p,S){this.type=S.type,this.bindings=[].concat(p),this.result=S}evaluate(p){return this.result.evaluate(p)}eachChild(p){for(const S of this.bindings)p(S[1]);p(this.result)}static parse(p,S){if(p.length<4)return S.error(`Expected at least 3 arguments, but found ${p.length-1} instead.`);const j=[];for(let Ot=1;Ot<p.length-1;Ot+=2){const fi=p[Ot];if(typeof fi!="string")return S.error(`Expected string, but found ${typeof fi} instead.`,Ot);if(/[^a-zA-Z0-9_]/.test(fi))return S.error("Variable names must contain only alphanumeric characters or '_'.",Ot);const Bn=S.parse(p[Ot+1],Ot+1);if(!Bn)return null;j.push([fi,Bn])}const ut=S.parse(p[p.length-1],p.length-1,S.expectedType,j);return ut?new bg(j,ut):null}outputDefined(){return this.result.outputDefined()}}class kg{constructor(p,S,j){this.type=p,this.index=S,this.input=j}static parse(p,S){if(p.length!==3)return S.error(`Expected 2 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,Qh),ut=S.parse(p[2],2,Nf(S.expectedType||Ld));return j&&ut?new kg(ut.type.itemType,j,ut):null}evaluate(p){const S=this.index.evaluate(p),j=this.input.evaluate(p);if(S<0)throw new _n(`Array index out of bounds: ${S} < 0.`);if(S>=j.length)throw new _n(`Array index out of bounds: ${S} > ${j.length-1}.`);if(S!==Math.floor(S))throw new _n(`Array index must be an integer, but found ${S} instead.`);return j[S]}eachChild(p){p(this.index),p(this.input)}outputDefined(){return!1}}class $m{constructor(p,S){this.type=sd,this.needle=p,this.haystack=S}static parse(p,S){if(p.length!==3)return S.error(`Expected 2 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,Ld),ut=S.parse(p[2],2,Ld);return j&&ut?Pp(j.type,[sd,Yd,Qh,fp,Ld])?new $m(j,ut):S.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(j.type)} instead`):null}evaluate(p){const S=this.needle.evaluate(p),j=this.haystack.evaluate(p);if(!j)return!1;if(!Yf(S,["boolean","string","number","null"]))throw new _n(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(Wu(S))} instead.`);if(!Yf(j,["string","array"]))throw new _n(`Expected second argument to be of type array or string, but found ${Wf(Wu(j))} instead.`);return j.indexOf(S)>=0}eachChild(p){p(this.needle),p(this.haystack)}outputDefined(){return!0}}class fy{constructor(p,S,j){this.type=Qh,this.needle=p,this.haystack=S,this.fromIndex=j}static parse(p,S){if(p.length<=2||p.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,Ld),ut=S.parse(p[2],2,Ld);if(!j||!ut)return null;if(!Pp(j.type,[sd,Yd,Qh,fp,Ld]))return S.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(j.type)} instead`);if(p.length===4){const Ot=S.parse(p[3],3,Qh);return Ot?new fy(j,ut,Ot):null}return new fy(j,ut)}evaluate(p){const S=this.needle.evaluate(p),j=this.haystack.evaluate(p);if(!Yf(S,["boolean","string","number","null"]))throw new _n(`Expected first argument to be of type boolean, string, number or null, but found ${Wf(Wu(S))} instead.`);if(!Yf(j,["string","array"]))throw new _n(`Expected second argument to be of type array or string, but found ${Wf(Wu(j))} instead.`);if(this.fromIndex){const ut=this.fromIndex.evaluate(p);return j.indexOf(S,ut)}return j.indexOf(S)}eachChild(p){p(this.needle),p(this.haystack),this.fromIndex&&p(this.fromIndex)}outputDefined(){return!1}}class Km{constructor(p,S,j,ut,Ot,fi){this.inputType=p,this.type=S,this.input=j,this.cases=ut,this.outputs=Ot,this.otherwise=fi}static parse(p,S){if(p.length<5)return S.error(`Expected at least 4 arguments, but found only ${p.length-1}.`);if(p.length%2!=1)return S.error("Expected an even number of arguments.");let j,ut;S.expectedType&&S.expectedType.kind!=="value"&&(ut=S.expectedType);const Ot={},fi=[];for(let ul=2;ul<p.length-1;ul+=2){let Ju=p[ul];const oh=p[ul+1];Array.isArray(Ju)||(Ju=[Ju]);const gh=S.concat(ul);if(Ju.length===0)return gh.error("Expected at least one branch label.");for(const bh of Ju){if(typeof bh!="number"&&typeof bh!="string")return gh.error("Branch labels must be numbers or strings.");if(typeof bh=="number"&&Math.abs(bh)>Number.MAX_SAFE_INTEGER)return gh.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof bh=="number"&&Math.floor(bh)!==bh)return gh.error("Numeric branch labels must be integer values.");if(j){if(gh.checkSubtype(j,Wu(bh)))return null}else j=Wu(bh);if(Ot[String(bh)]!==void 0)return gh.error("Branch labels must be unique.");Ot[String(bh)]=fi.length}const xh=S.parse(oh,ul,ut);if(!xh)return null;ut=ut||xh.type,fi.push(xh)}const Bn=S.parse(p[1],1,Ld);if(!Bn)return null;const us=S.parse(p[p.length-1],p.length-1,ut);return us?Bn.type.kind!=="value"&&S.concat(1).checkSubtype(j,Bn.type)?null:new Km(j,ut,Bn,Ot,fi,us):null}evaluate(p){const S=this.input.evaluate(p);return(Wu(S)===this.inputType&&this.outputs[this.cases[S]]||this.otherwise).evaluate(p)}eachChild(p){p(this.input),this.outputs.forEach(p),p(this.otherwise)}outputDefined(){return this.outputs.every(p=>p.outputDefined())&&this.otherwise.outputDefined()}}class Xg{constructor(p,S,j){this.type=p,this.branches=S,this.otherwise=j}static parse(p,S){if(p.length<4)return S.error(`Expected at least 3 arguments, but found only ${p.length-1}.`);if(p.length%2!=0)return S.error("Expected an odd number of arguments.");let j;S.expectedType&&S.expectedType.kind!=="value"&&(j=S.expectedType);const ut=[];for(let fi=1;fi<p.length-1;fi+=2){const Bn=S.parse(p[fi],fi,sd);if(!Bn)return null;const us=S.parse(p[fi+1],fi+1,j);if(!us)return null;ut.push([Bn,us]),j=j||us.type}const Ot=S.parse(p[p.length-1],p.length-1,j);if(!Ot)return null;if(!j)throw new Error("Can't infer output type");return new Xg(j,ut,Ot)}evaluate(p){for(const[S,j]of this.branches)if(S.evaluate(p))return j.evaluate(p);return this.otherwise.evaluate(p)}eachChild(p){for(const[S,j]of this.branches)p(S),p(j);p(this.otherwise)}outputDefined(){return this.branches.every(([p,S])=>S.outputDefined())&&this.otherwise.outputDefined()}}class Ly{constructor(p,S,j,ut){this.type=p,this.input=S,this.beginIndex=j,this.endIndex=ut}static parse(p,S){if(p.length<=2||p.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,Ld),ut=S.parse(p[2],2,Qh);if(!j||!ut)return null;if(!Pp(j.type,[Nf(Ld),Yd,Ld]))return S.error(`Expected first argument to be of type array or string, but found ${Wf(j.type)} instead`);if(p.length===4){const Ot=S.parse(p[3],3,Qh);return Ot?new Ly(j.type,j,ut,Ot):null}return new Ly(j.type,j,ut)}evaluate(p){const S=this.input.evaluate(p),j=this.beginIndex.evaluate(p);if(!Yf(S,["string","array"]))throw new _n(`Expected first argument to be of type array or string, but found ${Wf(Wu(S))} instead.`);if(this.endIndex){const ut=this.endIndex.evaluate(p);return S.slice(j,ut)}return S.slice(j)}eachChild(p){p(this.input),p(this.beginIndex),this.endIndex&&p(this.endIndex)}outputDefined(){return!1}}function Ry(_,p){return _==="=="||_==="!="?p.kind==="boolean"||p.kind==="string"||p.kind==="number"||p.kind==="null"||p.kind==="value":p.kind==="string"||p.kind==="number"||p.kind==="value"}function wg(_,p,S,j){return j.compare(p,S)===0}function u_(_,p,S){const j=_!=="=="&&_!=="!=";return class eT{constructor(Ot,fi,Bn){this.type=sd,this.lhs=Ot,this.rhs=fi,this.collator=Bn,this.hasUntypedArgument=Ot.type.kind==="value"||fi.type.kind==="value"}static parse(Ot,fi){if(Ot.length!==3&&Ot.length!==4)return fi.error("Expected two or three arguments.");const Bn=Ot[0];let us=fi.parse(Ot[1],1,Ld);if(!us)return null;if(!Ry(Bn,us.type))return fi.concat(1).error(`"${Bn}" comparisons are not supported for type '${Wf(us.type)}'.`);let ul=fi.parse(Ot[2],2,Ld);if(!ul)return null;if(!Ry(Bn,ul.type))return fi.concat(2).error(`"${Bn}" comparisons are not supported for type '${Wf(ul.type)}'.`);if(us.type.kind!==ul.type.kind&&us.type.kind!=="value"&&ul.type.kind!=="value")return fi.error(`Cannot compare types '${Wf(us.type)}' and '${Wf(ul.type)}'.`);j&&(us.type.kind==="value"&&ul.type.kind!=="value"?us=new $u(ul.type,[us]):us.type.kind!=="value"&&ul.type.kind==="value"&&(ul=new $u(us.type,[ul])));let Ju=null;if(Ot.length===4){if(us.type.kind!=="string"&&ul.type.kind!=="string"&&us.type.kind!=="value"&&ul.type.kind!=="value")return fi.error("Cannot use collator to compare non-string types.");if(Ju=fi.parse(Ot[3],3,Kf),!Ju)return null}return new eT(us,ul,Ju)}evaluate(Ot){const fi=this.lhs.evaluate(Ot),Bn=this.rhs.evaluate(Ot);if(j&&this.hasUntypedArgument){const us=Wu(fi),ul=Wu(Bn);if(us.kind!==ul.kind||us.kind!=="string"&&us.kind!=="number")throw new _n(`Expected arguments for "${_}" to be (string, string) or (number, number), but found (${us.kind}, ${ul.kind}) instead.`)}if(this.collator&&!j&&this.hasUntypedArgument){const us=Wu(fi),ul=Wu(Bn);if(us.kind!=="string"||ul.kind!=="string")return p(Ot,fi,Bn)}return this.collator?S(Ot,fi,Bn,this.collator.evaluate(Ot)):p(Ot,fi,Bn)}eachChild(Ot){Ot(this.lhs),Ot(this.rhs),this.collator&&Ot(this.collator)}outputDefined(){return!0}}}const Oy=u_("==",function(_,p,S){return p===S},wg),V_=u_("!=",function(_,p,S){return p!==S},function(_,p,S,j){return!wg(0,p,S,j)}),n0=u_("<",function(_,p,S){return p<S},function(_,p,S,j){return j.compare(p,S)<0}),O0=u_(">",function(_,p,S){return p>S},function(_,p,S,j){return j.compare(p,S)>0}),l1=u_("<=",function(_,p,S){return p<=S},function(_,p,S,j){return j.compare(p,S)<=0}),tv=u_(">=",function(_,p,S){return p>=S},function(_,p,S,j){return j.compare(p,S)>=0});class oy{constructor(p,S,j,ut,Ot){this.type=Yd,this.number=p,this.locale=S,this.currency=j,this.minFractionDigits=ut,this.maxFractionDigits=Ot}static parse(p,S){if(p.length!==3)return S.error("Expected two arguments.");const j=S.parse(p[1],1,Qh);if(!j)return null;const ut=p[2];if(typeof ut!="object"||Array.isArray(ut))return S.error("NumberFormat options argument must be an object.");let Ot=null;if(ut.locale&&(Ot=S.parse(ut.locale,1,Yd),!Ot))return null;let fi=null;if(ut.currency&&(fi=S.parse(ut.currency,1,Yd),!fi))return null;let Bn=null;if(ut["min-fraction-digits"]&&(Bn=S.parse(ut["min-fraction-digits"],1,Qh),!Bn))return null;let us=null;return ut["max-fraction-digits"]&&(us=S.parse(ut["max-fraction-digits"],1,Qh),!us)?null:new oy(j,Ot,fi,Bn,us)}evaluate(p){return new Intl.NumberFormat(this.locale?this.locale.evaluate(p):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(p):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(p):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(p):void 0}).format(this.number.evaluate(p))}eachChild(p){p(this.number),this.locale&&p(this.locale),this.currency&&p(this.currency),this.minFractionDigits&&p(this.minFractionDigits),this.maxFractionDigits&&p(this.maxFractionDigits)}outputDefined(){return!1}}class o0{constructor(p){this.type=If,this.sections=p}static parse(p,S){if(p.length<2)return S.error("Expected at least one argument.");const j=p[1];if(!Array.isArray(j)&&typeof j=="object")return S.error("First argument must be an image or text section.");const ut=[];let Ot=!1;for(let fi=1;fi<=p.length-1;++fi){const Bn=p[fi];if(Ot&&typeof Bn=="object"&&!Array.isArray(Bn)){Ot=!1;let us=null;if(Bn["font-scale"]&&(us=S.parse(Bn["font-scale"],1,Qh),!us))return null;let ul=null;if(Bn["text-font"]&&(ul=S.parse(Bn["text-font"],1,Nf(Yd)),!ul))return null;let Ju=null;if(Bn["text-color"]&&(Ju=S.parse(Bn["text-color"],1,Zd),!Ju))return null;const oh=ut[ut.length-1];oh.scale=us,oh.font=ul,oh.textColor=Ju}else{const us=S.parse(p[fi],1,Ld);if(!us)return null;const ul=us.type.kind;if(ul!=="string"&&ul!=="value"&&ul!=="null"&&ul!=="resolvedImage")return S.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Ot=!0,ut.push({content:us,scale:null,font:null,textColor:null})}}return new o0(ut)}evaluate(p){return new lm(this.sections.map(S=>{const j=S.content.evaluate(p);return Wu(j)===Jf?new Qp("",j,null,null,null):new Qp(sl(j),null,S.scale?S.scale.evaluate(p):null,S.font?S.font.evaluate(p).join(","):null,S.textColor?S.textColor.evaluate(p):null)}))}eachChild(p){for(const S of this.sections)p(S.content),S.scale&&p(S.scale),S.font&&p(S.font),S.textColor&&p(S.textColor)}outputDefined(){return!1}}class $y{constructor(p){this.type=Jf,this.input=p}static parse(p,S){if(p.length!==2)return S.error("Expected two arguments.");const j=S.parse(p[1],1,Yd);return j?new $y(j):S.error("No image name provided.")}evaluate(p){const S=this.input.evaluate(p),j=Hf.fromString(S);return j&&p.availableImages&&(j.available=p.availableImages.indexOf(S)>-1),j}eachChild(p){p(this.input)}outputDefined(){return!1}}class py{constructor(p){this.type=Qh,this.input=p}static parse(p,S){if(p.length!==2)return S.error(`Expected 1 argument, but found ${p.length-1} instead.`);const j=S.parse(p[1],1);return j?j.type.kind!=="array"&&j.type.kind!=="string"&&j.type.kind!=="value"?S.error(`Expected argument of type string or array, but found ${Wf(j.type)} instead.`):new py(j):null}evaluate(p){const S=this.input.evaluate(p);if(typeof S=="string"||Array.isArray(S))return S.length;throw new _n(`Expected value to be of type string or array, but found ${Wf(Wu(S))} instead.`)}eachChild(p){p(this.input)}outputDefined(){return!1}}const Vg={"==":Oy,"!=":V_,">":O0,"<":n0,">=":tv,"<=":l1,array:$u,at:kg,boolean:$u,case:Xg,coalesce:Um,collator:Ph,format:o0,image:$y,in:$m,"index-of":fy,interpolate:Np,"interpolate-hcl":Np,"interpolate-lab":Np,length:py,let:bg,literal:Gn,match:Km,number:$u,"number-format":oy,object:$u,slice:Ly,step:Jp,string:$u,"to-boolean":nh,"to-color":nh,"to-number":nh,"to-string":nh,var:l_,within:Fm};function fm(_,[p,S,j,ut]){p=p.evaluate(_),S=S.evaluate(_),j=j.evaluate(_);const Ot=ut?ut.evaluate(_):1,fi=mh(p,S,j,Ot);if(fi)throw new _n(fi);return new hp(p/255*Ot,S/255*Ot,j/255*Ot,Ot)}function G_(_,p){return _ in p}function eg(_,p){const S=p[_];return S===void 0?null:S}function h_(_){return{type:_}}function iv(_){return{result:"success",value:_}}function By(_){return{result:"error",value:_}}function j_(_){return _["property-type"]==="data-driven"||_["property-type"]==="cross-faded-data-driven"}function a0(_){return!!_.expression&&_.expression.parameters.indexOf("zoom")>-1}function s0(_){return!!_.expression&&_.expression.interpolated}function wm(_){return _ instanceof Number?"number":_ instanceof String?"string":_ instanceof Boolean?"boolean":Array.isArray(_)?"array":_===null?"null":typeof _}function ay(_){return typeof _=="object"&&_!==null&&!Array.isArray(_)}function my(_){return _}function l0(_,p){const S=p.type==="color",j=_.stops&&typeof _.stops[0][0]=="object",ut=j||!(j||_.property!==void 0),Ot=_.type||(s0(p)?"exponential":"interval");if(S||p.type==="padding"){const ul=S?hp.parse:Dd.parse;(_=jf({},_)).stops&&(_.stops=_.stops.map(Ju=>[Ju[0],ul(Ju[1])])),_.default=ul(_.default?_.default:p.default)}if(_.colorSpace&&_.colorSpace!=="rgb"&&!Tp[_.colorSpace])throw new Error(`Unknown color space: ${_.colorSpace}`);let fi,Bn,us;if(Ot==="exponential")fi=cm;else if(Ot==="interval")fi=sy;else if(Ot==="categorical"){fi=vv,Bn=Object.create(null);for(const ul of _.stops)Bn[ul[0]]=ul[1];us=typeof _.stops[0][0]}else{if(Ot!=="identity")throw new Error(`Unknown function type "${Ot}"`);fi=Ny}if(j){const ul={},Ju=[];for(let xh=0;xh<_.stops.length;xh++){const bh=_.stops[xh],Wh=bh[0].zoom;ul[Wh]===void 0&&(ul[Wh]={zoom:Wh,type:_.type,property:_.property,default:_.default,stops:[]},Ju.push(Wh)),ul[Wh].stops.push([bh[0].value,bh[1]])}const oh=[];for(const xh of Ju)oh.push([ul[xh].zoom,l0(ul[xh],p)]);const gh={name:"linear"};return{kind:"composite",interpolationType:gh,interpolationFactor:Np.interpolationFactor.bind(void 0,gh),zoomStops:oh.map(xh=>xh[0]),evaluate:({zoom:xh},bh)=>cm({stops:oh,base:_.base},p,xh).evaluate(xh,bh)}}if(ut){const ul=Ot==="exponential"?{name:"exponential",base:_.base!==void 0?_.base:1}:null;return{kind:"camera",interpolationType:ul,interpolationFactor:Np.interpolationFactor.bind(void 0,ul),zoomStops:_.stops.map(Ju=>Ju[0]),evaluate:({zoom:Ju})=>fi(_,p,Ju,Bn,us)}}return{kind:"source",evaluate(ul,Ju){const oh=Ju&&Ju.properties?Ju.properties[_.property]:void 0;return oh===void 0?gy(_.default,p.default):fi(_,p,oh,Bn,us)}}}function gy(_,p,S){return _!==void 0?_:p!==void 0?p:S!==void 0?S:void 0}function vv(_,p,S,j,ut){return gy(typeof S===ut?j[S]:void 0,_.default,p.default)}function sy(_,p,S){if(wm(S)!=="number")return gy(_.default,p.default);const j=_.stops.length;if(j===1||S<=_.stops[0][0])return _.stops[0][1];if(S>=_.stops[j-1][0])return _.stops[j-1][1];const ut=im(_.stops.map(Ot=>Ot[0]),S);return _.stops[ut][1]}function cm(_,p,S){const j=_.base!==void 0?_.base:1;if(wm(S)!=="number")return gy(_.default,p.default);const ut=_.stops.length;if(ut===1||S<=_.stops[0][0])return _.stops[0][1];if(S>=_.stops[ut-1][0])return _.stops[ut-1][1];const Ot=im(_.stops.map(Ju=>Ju[0]),S),fi=function(Ju,oh,gh,xh){const bh=xh-gh,Wh=Ju-gh;return bh===0?0:oh===1?Wh/bh:(Math.pow(oh,Wh)-1)/(Math.pow(oh,bh)-1)}(S,j,_.stops[Ot][0],_.stops[Ot+1][0]),Bn=_.stops[Ot][1],us=_.stops[Ot+1][1];let ul=yr[p.type]||my;if(_.colorSpace&&_.colorSpace!=="rgb"){const Ju=Tp[_.colorSpace];ul=(oh,gh)=>Ju.reverse(Ju.interpolate(Ju.forward(oh),Ju.forward(gh),fi))}return typeof Bn.evaluate=="function"?{evaluate(...Ju){const oh=Bn.evaluate.apply(void 0,Ju),gh=us.evaluate.apply(void 0,Ju);if(oh!==void 0&&gh!==void 0)return ul(oh,gh,fi)}}:ul(Bn,us,fi)}function Ny(_,p,S){switch(p.type){case"color":S=hp.parse(S);break;case"formatted":S=lm.fromString(S.toString());break;case"resolvedImage":S=Hf.fromString(S.toString());break;case"padding":S=Dd.parse(S);break;default:wm(S)===p.type||p.type==="enum"&&p.values[S]||(S=void 0)}return gy(S,_.default,p.default)}vh.register(Vg,{error:[{kind:"error"},[Yd],(_,[p])=>{throw new _n(p.evaluate(_))}],typeof:[Yd,[Ld],(_,[p])=>Wf(Wu(p.evaluate(_)))],"to-rgba":[Nf(Qh,4),[Zd],(_,[p])=>p.evaluate(_).toArray()],rgb:[Zd,[Qh,Qh,Qh],fm],rgba:[Zd,[Qh,Qh,Qh,Qh],fm],has:{type:sd,overloads:[[[Yd],(_,[p])=>G_(p.evaluate(_),_.properties())],[[Yd,Xh],(_,[p,S])=>G_(p.evaluate(_),S.evaluate(_))]]},get:{type:Ld,overloads:[[[Yd],(_,[p])=>eg(p.evaluate(_),_.properties())],[[Yd,Xh],(_,[p,S])=>eg(p.evaluate(_),S.evaluate(_))]]},"feature-state":[Ld,[Yd],(_,[p])=>eg(p.evaluate(_),_.featureState||{})],properties:[Xh,[],_=>_.properties()],"geometry-type":[Yd,[],_=>_.geometryType()],id:[Ld,[],_=>_.id()],zoom:[Qh,[],_=>_.globals.zoom],"heatmap-density":[Qh,[],_=>_.globals.heatmapDensity||0],"line-progress":[Qh,[],_=>_.globals.lineProgress||0],accumulated:[Ld,[],_=>_.globals.accumulated===void 0?null:_.globals.accumulated],"+":[Qh,h_(Qh),(_,p)=>{let S=0;for(const j of p)S+=j.evaluate(_);return S}],"*":[Qh,h_(Qh),(_,p)=>{let S=1;for(const j of p)S*=j.evaluate(_);return S}],"-":{type:Qh,overloads:[[[Qh,Qh],(_,[p,S])=>p.evaluate(_)-S.evaluate(_)],[[Qh],(_,[p])=>-p.evaluate(_)]]},"/":[Qh,[Qh,Qh],(_,[p,S])=>p.evaluate(_)/S.evaluate(_)],"%":[Qh,[Qh,Qh],(_,[p,S])=>p.evaluate(_)%S.evaluate(_)],ln2:[Qh,[],()=>Math.LN2],pi:[Qh,[],()=>Math.PI],e:[Qh,[],()=>Math.E],"^":[Qh,[Qh,Qh],(_,[p,S])=>Math.pow(p.evaluate(_),S.evaluate(_))],sqrt:[Qh,[Qh],(_,[p])=>Math.sqrt(p.evaluate(_))],log10:[Qh,[Qh],(_,[p])=>Math.log(p.evaluate(_))/Math.LN10],ln:[Qh,[Qh],(_,[p])=>Math.log(p.evaluate(_))],log2:[Qh,[Qh],(_,[p])=>Math.log(p.evaluate(_))/Math.LN2],sin:[Qh,[Qh],(_,[p])=>Math.sin(p.evaluate(_))],cos:[Qh,[Qh],(_,[p])=>Math.cos(p.evaluate(_))],tan:[Qh,[Qh],(_,[p])=>Math.tan(p.evaluate(_))],asin:[Qh,[Qh],(_,[p])=>Math.asin(p.evaluate(_))],acos:[Qh,[Qh],(_,[p])=>Math.acos(p.evaluate(_))],atan:[Qh,[Qh],(_,[p])=>Math.atan(p.evaluate(_))],min:[Qh,h_(Qh),(_,p)=>Math.min(...p.map(S=>S.evaluate(_)))],max:[Qh,h_(Qh),(_,p)=>Math.max(...p.map(S=>S.evaluate(_)))],abs:[Qh,[Qh],(_,[p])=>Math.abs(p.evaluate(_))],round:[Qh,[Qh],(_,[p])=>{const S=p.evaluate(_);return S<0?-Math.round(-S):Math.round(S)}],floor:[Qh,[Qh],(_,[p])=>Math.floor(p.evaluate(_))],ceil:[Qh,[Qh],(_,[p])=>Math.ceil(p.evaluate(_))],"filter-==":[sd,[Yd,Ld],(_,[p,S])=>_.properties()[p.value]===S.value],"filter-id-==":[sd,[Ld],(_,[p])=>_.id()===p.value],"filter-type-==":[sd,[Yd],(_,[p])=>_.geometryType()===p.value],"filter-<":[sd,[Yd,Ld],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j<ut}],"filter-id-<":[sd,[Ld],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S<j}],"filter->":[sd,[Yd,Ld],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j>ut}],"filter-id->":[sd,[Ld],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S>j}],"filter-<=":[sd,[Yd,Ld],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j<=ut}],"filter-id-<=":[sd,[Ld],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S<=j}],"filter->=":[sd,[Yd,Ld],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j>=ut}],"filter-id->=":[sd,[Ld],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S>=j}],"filter-has":[sd,[Ld],(_,[p])=>p.value in _.properties()],"filter-has-id":[sd,[],_=>_.id()!==null&&_.id()!==void 0],"filter-type-in":[sd,[Nf(Yd)],(_,[p])=>p.value.indexOf(_.geometryType())>=0],"filter-id-in":[sd,[Nf(Ld)],(_,[p])=>p.value.indexOf(_.id())>=0],"filter-in-small":[sd,[Yd,Nf(Ld)],(_,[p,S])=>S.value.indexOf(_.properties()[p.value])>=0],"filter-in-large":[sd,[Yd,Nf(Ld)],(_,[p,S])=>function(j,ut,Ot,fi){for(;Ot<=fi;){const Bn=Ot+fi>>1;if(ut[Bn]===j)return!0;ut[Bn]>j?fi=Bn-1:Ot=Bn+1}return!1}(_.properties()[p.value],S.value,0,S.value.length-1)],all:{type:sd,overloads:[[[sd,sd],(_,[p,S])=>p.evaluate(_)&&S.evaluate(_)],[h_(sd),(_,p)=>{for(const S of p)if(!S.evaluate(_))return!1;return!0}]]},any:{type:sd,overloads:[[[sd,sd],(_,[p,S])=>p.evaluate(_)||S.evaluate(_)],[h_(sd),(_,p)=>{for(const S of p)if(S.evaluate(_))return!0;return!1}]]},"!":[sd,[sd],(_,[p])=>!p.evaluate(_)],"is-supported-script":[sd,[Yd],(_,[p])=>{const S=_.globals&&_.globals.isSupportedScript;return!S||S(p.evaluate(_))}],upcase:[Yd,[Yd],(_,[p])=>p.evaluate(_).toUpperCase()],downcase:[Yd,[Yd],(_,[p])=>p.evaluate(_).toLowerCase()],concat:[Yd,h_(Ld),(_,p)=>p.map(S=>sl(S.evaluate(_))).join("")],"resolved-locale":[Yd,[Kf],(_,[p])=>p.evaluate(_).resolvedLocale()]});class zy{constructor(p,S){this.expression=p,this._warningHistory={},this._evaluator=new dh,this._defaultValue=S?function(j){return j.type==="color"&&ay(j.default)?new hp(0,0,0,0):j.type==="color"?hp.parse(j.default)||null:j.type==="padding"?Dd.parse(j.default)||null:j.default===void 0?null:j.default}(S):null,this._enumValues=S&&S.type==="enum"?S.values:null}evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi){return this._evaluator.globals=p,this._evaluator.feature=S,this._evaluator.featureState=j,this._evaluator.canonical=ut,this._evaluator.availableImages=Ot||null,this._evaluator.formattedSection=fi,this.expression.evaluate(this._evaluator)}evaluate(p,S,j,ut,Ot,fi){this._evaluator.globals=p,this._evaluator.feature=S||null,this._evaluator.featureState=j||null,this._evaluator.canonical=ut,this._evaluator.availableImages=Ot||null,this._evaluator.formattedSection=fi||null;try{const Bn=this.expression.evaluate(this._evaluator);if(Bn==null||typeof Bn=="number"&&Bn!=Bn)return this._defaultValue;if(this._enumValues&&!(Bn in this._enumValues))throw new _n(`Expected value to be one of ${Object.keys(this._enumValues).map(us=>JSON.stringify(us)).join(", ")}, but found ${JSON.stringify(Bn)} instead.`);return Bn}catch(Bn){return this._warningHistory[Bn.message]||(this._warningHistory[Bn.message]=!0,typeof console<"u"&&console.warn(Bn.message)),this._defaultValue}}}function q_(_){return Array.isArray(_)&&_.length>0&&typeof _[0]=="string"&&_[0]in Vg}function d_(_,p){const S=new c_(Vg,[],p?function(ut){const Ot={color:Zd,string:Yd,number:Qh,enum:Yd,boolean:sd,formatted:If,padding:Df,resolvedImage:Jf};return ut.type==="array"?Nf(Ot[ut.value]||Ld,ut.length):Ot[ut.type]}(p):void 0),j=S.parse(_,void 0,void 0,void 0,p&&p.type==="string"?{typeAnnotation:"coerce"}:void 0);return j?iv(new zy(j,p)):By(S.errors)}class c0{constructor(p,S){this.kind=p,this._styleExpression=S,this.isStateDependent=p!=="constant"&&!Dy(S.expression)}evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi){return this._styleExpression.evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi)}evaluate(p,S,j,ut,Ot,fi){return this._styleExpression.evaluate(p,S,j,ut,Ot,fi)}}class u0{constructor(p,S,j,ut){this.kind=p,this.zoomStops=j,this._styleExpression=S,this.isStateDependent=p!=="camera"&&!Dy(S.expression),this.interpolationType=ut}evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi){return this._styleExpression.evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi)}evaluate(p,S,j,ut,Ot,fi){return this._styleExpression.evaluate(p,S,j,ut,Ot,fi)}interpolationFactor(p,S,j){return this.interpolationType?Np.interpolationFactor(this.interpolationType,p,S,j):0}}function rv(_,p){const S=d_(_,p);if(S.result==="error")return S;const j=S.value.expression,ut=I_(j);if(!ut&&!j_(p))return By([new op("","data expressions not supported")]);const Ot=Pg(j,["zoom"]);if(!Ot&&!a0(p))return By([new op("","zoom expressions not supported")]);const fi=h0(j);return fi||Ot?fi instanceof op?By([fi]):fi instanceof Np&&!s0(p)?By([new op("",'"interpolate" expressions cannot be used with this property')]):iv(fi?new u0(ut?"camera":"composite",S.value,fi.labels,fi instanceof Np?fi.interpolation:void 0):new c0(ut?"constant":"source",S.value)):By([new op("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fy{constructor(p,S){this._parameters=p,this._specification=S,jf(this,l0(this._parameters,this._specification))}static deserialize(p){return new Fy(p._parameters,p._specification)}static serialize(p){return{_parameters:p._parameters,_specification:p._specification}}}function h0(_){let p=null;if(_ instanceof bg)p=h0(_.result);else if(_ instanceof Um){for(const S of _.args)if(p=h0(S),p)break}else(_ instanceof Jp||_ instanceof Np)&&_.input instanceof vh&&_.input.name==="zoom"&&(p=_);return p instanceof op||_.eachChild(S=>{const j=h0(S);j instanceof op?p=j:!p&&j?p=new op("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):p&&j&&p!==j&&(p=new op("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),p}function Eg(_){const p=_.key,S=_.value,j=_.valueSpec||{},ut=_.objectElementValidators||{},Ot=_.style,fi=_.styleSpec,Bn=_.validateSpec;let us=[];const ul=wm(S);if(ul!=="object")return[new Fd(p,S,`object expected, ${ul} found`)];for(const Ju in S){const oh=Ju.split(".")[0],gh=j[oh]||j["*"];let xh;if(ut[oh])xh=ut[oh];else if(j[oh])xh=Bn;else if(ut["*"])xh=ut["*"];else{if(!j["*"]){us.push(new Fd(p,S[Ju],`unknown property "${Ju}"`));continue}xh=Bn}us=us.concat(xh({key:(p&&`${p}.`)+Ju,value:S[Ju],valueSpec:gh,style:Ot,styleSpec:fi,object:S,objectKey:Ju,validateSpec:Bn},S))}for(const Ju in j)ut[Ju]||j[Ju].required&&j[Ju].default===void 0&&S[Ju]===void 0&&us.push(new Fd(p,S,`missing required property "${Ju}"`));return us}function Z_(_){const p=_.value,S=_.valueSpec,j=_.style,ut=_.styleSpec,Ot=_.key,fi=_.arrayElementValidator||_.validateSpec;if(wm(p)!=="array")return[new Fd(Ot,p,`array expected, ${wm(p)} found`)];if(S.length&&p.length!==S.length)return[new Fd(Ot,p,`array length ${S.length} expected, length ${p.length} found`)];if(S["min-length"]&&p.length<S["min-length"])return[new Fd(Ot,p,`array length at least ${S["min-length"]} expected, length ${p.length} found`)];let Bn={type:S.value,values:S.values};ut.$version<7&&(Bn.function=S.function),wm(S.value)==="object"&&(Bn=S.value);let us=[];for(let ul=0;ul<p.length;ul++)us=us.concat(fi({array:p,arrayIndex:ul,value:p[ul],valueSpec:Bn,validateSpec:_.validateSpec,style:j,styleSpec:ut,key:`${Ot}[${ul}]`}));return us}function f_(_){const p=_.key,S=_.value,j=_.valueSpec;let ut=wm(S);return ut==="number"&&S!=S&&(ut="NaN"),ut!=="number"?[new Fd(p,S,`number expected, ${ut} found`)]:"minimum"in j&&S<j.minimum?[new Fd(p,S,`${S} is less than the minimum value ${j.minimum}`)]:"maximum"in j&&S>j.maximum?[new Fd(p,S,`${S} is greater than the maximum value ${j.maximum}`)]:[]}function p_(_){const p=_.valueSpec,S=yd(_.value.type);let j,ut,Ot,fi={};const Bn=S!=="categorical"&&_.value.property===void 0,us=!Bn,ul=wm(_.value.stops)==="array"&&wm(_.value.stops[0])==="array"&&wm(_.value.stops[0][0])==="object",Ju=Eg({key:_.key,value:_.value,valueSpec:_.styleSpec.function,validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{stops:function(xh){if(S==="identity")return[new Fd(xh.key,xh.value,'identity function may not have a "stops" property')];let bh=[];const Wh=xh.value;return bh=bh.concat(Z_({key:xh.key,value:Wh,valueSpec:xh.valueSpec,validateSpec:xh.validateSpec,style:xh.style,styleSpec:xh.styleSpec,arrayElementValidator:oh})),wm(Wh)==="array"&&Wh.length===0&&bh.push(new Fd(xh.key,Wh,"array must have at least one stop")),bh},default:function(xh){return xh.validateSpec({key:xh.key,value:xh.value,valueSpec:p,validateSpec:xh.validateSpec,style:xh.style,styleSpec:xh.styleSpec})}}});return S==="identity"&&Bn&&Ju.push(new Fd(_.key,_.value,'missing required property "property"')),S==="identity"||_.value.stops||Ju.push(new Fd(_.key,_.value,'missing required property "stops"')),S==="exponential"&&_.valueSpec.expression&&!s0(_.valueSpec)&&Ju.push(new Fd(_.key,_.value,"exponential functions not supported")),_.styleSpec.$version>=8&&(us&&!j_(_.valueSpec)?Ju.push(new Fd(_.key,_.value,"property functions not supported")):Bn&&!a0(_.valueSpec)&&Ju.push(new Fd(_.key,_.value,"zoom functions not supported"))),S!=="categorical"&&!ul||_.value.property!==void 0||Ju.push(new Fd(_.key,_.value,'"property" property is required')),Ju;function oh(xh){let bh=[];const Wh=xh.value,Zh=xh.key;if(wm(Wh)!=="array")return[new Fd(Zh,Wh,`array expected, ${wm(Wh)} found`)];if(Wh.length!==2)return[new Fd(Zh,Wh,`array length 2 expected, length ${Wh.length} found`)];if(ul){if(wm(Wh[0])!=="object")return[new Fd(Zh,Wh,`object expected, ${wm(Wh[0])} found`)];if(Wh[0].zoom===void 0)return[new Fd(Zh,Wh,"object stop key must have zoom")];if(Wh[0].value===void 0)return[new Fd(Zh,Wh,"object stop key must have value")];if(Ot&&Ot>yd(Wh[0].zoom))return[new Fd(Zh,Wh[0].zoom,"stop zoom values must appear in ascending order")];yd(Wh[0].zoom)!==Ot&&(Ot=yd(Wh[0].zoom),ut=void 0,fi={}),bh=bh.concat(Eg({key:`${Zh}[0]`,value:Wh[0],valueSpec:{zoom:{}},validateSpec:xh.validateSpec,style:xh.style,styleSpec:xh.styleSpec,objectElementValidators:{zoom:f_,value:gh}}))}else bh=bh.concat(gh({key:`${Zh}[0]`,value:Wh[0],valueSpec:{},validateSpec:xh.validateSpec,style:xh.style,styleSpec:xh.styleSpec},Wh));return q_(Jd(Wh[1]))?bh.concat([new Fd(`${Zh}[1]`,Wh[1],"expressions are not allowed in function stops.")]):bh.concat(xh.validateSpec({key:`${Zh}[1]`,value:Wh[1],valueSpec:p,validateSpec:xh.validateSpec,style:xh.style,styleSpec:xh.styleSpec}))}function gh(xh,bh){const Wh=wm(xh.value),Zh=yd(xh.value),bd=xh.value!==null?xh.value:bh;if(j){if(Wh!==j)return[new Fd(xh.key,bd,`${Wh} stop domain type must match previous stop domain type ${j}`)]}else j=Wh;if(Wh!=="number"&&Wh!=="string"&&Wh!=="boolean")return[new Fd(xh.key,bd,"stop domain value must be a number, string, or boolean")];if(Wh!=="number"&&S!=="categorical"){let Bd=`number expected, ${Wh} found`;return j_(p)&&S===void 0&&(Bd+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fd(xh.key,bd,Bd)]}return S!=="categorical"||Wh!=="number"||isFinite(Zh)&&Math.floor(Zh)===Zh?S!=="categorical"&&Wh==="number"&&ut!==void 0&&Zh<ut?[new Fd(xh.key,bd,"stop domain values must appear in ascending order")]:(ut=Zh,S==="categorical"&&Zh in fi?[new Fd(xh.key,bd,"stop domain values must be unique")]:(fi[Zh]=!0,[])):[new Fd(xh.key,bd,`integer expected, found ${Zh}`)]}}function Kp(_){const p=(_.expressionContext==="property"?rv:d_)(Jd(_.value),_.valueSpec);if(p.result==="error")return p.value.map(j=>new Fd(`${_.key}${j.key}`,_.value,j.message));const S=p.value.expression||p.value._styleExpression.expression;if(_.expressionContext==="property"&&_.propertyKey==="text-font"&&!S.outputDefined())return[new Fd(_.key,_.value,`Invalid data expression for "${_.propertyKey}". Output values must be contained as literals within the expression.`)];if(_.expressionContext==="property"&&_.propertyType==="layout"&&!Dy(S))return[new Fd(_.key,_.value,'"feature-state" data expressions are not supported with layout properties.')];if(_.expressionContext==="filter"&&!Dy(S))return[new Fd(_.key,_.value,'"feature-state" data expressions are not supported with filters.')];if(_.expressionContext&&_.expressionContext.indexOf("cluster")===0){if(!Pg(S,["zoom","feature-state"]))return[new Fd(_.key,_.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(_.expressionContext==="cluster-initial"&&!I_(S))return[new Fd(_.key,_.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function C_(_){const p=_.key,S=_.value,j=_.valueSpec,ut=[];return Array.isArray(j.values)?j.values.indexOf(yd(S))===-1&&ut.push(new Fd(p,S,`expected one of [${j.values.join(", ")}], ${JSON.stringify(S)} found`)):Object.keys(j.values).indexOf(yd(S))===-1&&ut.push(new Fd(p,S,`expected one of [${Object.keys(j.values).join(", ")}], ${JSON.stringify(S)} found`)),ut}function m_(_){if(_===!0||_===!1)return!0;if(!Array.isArray(_)||_.length===0)return!1;switch(_[0]){case"has":return _.length>=2&&_[1]!=="$id"&&_[1]!=="$type";case"in":return _.length>=3&&(typeof _[1]!="string"||Array.isArray(_[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return _.length!==3||Array.isArray(_[1])||Array.isArray(_[2]);case"any":case"all":for(const p of _.slice(1))if(!m_(p)&&typeof p!="boolean")return!1;return!0;default:return!0}}const Nv={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _y(_){if(_==null)return{filter:()=>!0,needGeometry:!1};m_(_)||(_=d0(_));const p=d_(_,Nv);if(p.result==="error")throw new Error(p.value.map(S=>`${S.key}: ${S.message}`).join(", "));return{filter:(S,j,ut)=>p.value.evaluate(S,j,{},ut),needGeometry:Xm(_)}}function Uy(_,p){return _<p?-1:_>p?1:0}function Xm(_){if(!Array.isArray(_))return!1;if(_[0]==="within")return!0;for(let p=1;p<_.length;p++)if(Xm(_[p]))return!0;return!1}function d0(_){if(!_)return!0;const p=_[0];return _.length<=1?p!=="any":p==="=="?um(_[1],_[2],"=="):p==="!="?Im(um(_[1],_[2],"==")):p==="<"||p===">"||p==="<="||p===">="?um(_[1],_[2],p):p==="any"?(S=_.slice(1),["any"].concat(S.map(d0))):p==="all"?["all"].concat(_.slice(1).map(d0)):p==="none"?["all"].concat(_.slice(1).map(d0).map(Im)):p==="in"?Vy(_[1],_.slice(2)):p==="!in"?Im(Vy(_[1],_.slice(2))):p==="has"?Bm(_[1]):p==="!has"?Im(Bm(_[1])):p!=="within"||_;var S}function um(_,p,S){switch(_){case"$type":return[`filter-type-${S}`,p];case"$id":return[`filter-id-${S}`,p];default:return[`filter-${S}`,_,p]}}function Vy(_,p){if(p.length===0)return!1;switch(_){case"$type":return["filter-type-in",["literal",p]];case"$id":return["filter-id-in",["literal",p]];default:return p.length>200&&!p.some(S=>typeof S!=typeof p[0])?["filter-in-large",_,["literal",p.sort(Uy)]]:["filter-in-small",_,["literal",p]]}}function Bm(_){switch(_){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",_]}}function Im(_){return["!",_]}function g_(_){return m_(Jd(_.value))?Kp(jf({},_,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ly(_)}function ly(_){const p=_.value,S=_.key;if(wm(p)!=="array")return[new Fd(S,p,`array expected, ${wm(p)} found`)];const j=_.styleSpec;let ut,Ot=[];if(p.length<1)return[new Fd(S,p,"filter array must have at least 1 element")];switch(Ot=Ot.concat(C_({key:`${S}[0]`,value:p[0],valueSpec:j.filter_operator,style:_.style,styleSpec:_.styleSpec})),yd(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&yd(p[1])==="$type"&&Ot.push(new Fd(S,p,`"$type" cannot be use with operator "${p[0]}"`));case"==":case"!=":p.length!==3&&Ot.push(new Fd(S,p,`filter array for operator "${p[0]}" must have 3 elements`));case"in":case"!in":p.length>=2&&(ut=wm(p[1]),ut!=="string"&&Ot.push(new Fd(`${S}[1]`,p[1],`string expected, ${ut} found`)));for(let fi=2;fi<p.length;fi++)ut=wm(p[fi]),yd(p[1])==="$type"?Ot=Ot.concat(C_({key:`${S}[${fi}]`,value:p[fi],valueSpec:j.geometry_type,style:_.style,styleSpec:_.styleSpec})):ut!=="string"&&ut!=="number"&&ut!=="boolean"&&Ot.push(new Fd(`${S}[${fi}]`,p[fi],`string, number, or boolean expected, ${ut} found`));break;case"any":case"all":case"none":for(let fi=1;fi<p.length;fi++)Ot=Ot.concat(ly({key:`${S}[${fi}]`,value:p[fi],style:_.style,styleSpec:_.styleSpec}));break;case"has":case"!has":ut=wm(p[1]),p.length!==2?Ot.push(new Fd(S,p,`filter array for "${p[0]}" operator must have 2 elements`)):ut!=="string"&&Ot.push(new Fd(`${S}[1]`,p[1],`string expected, ${ut} found`));break;case"within":ut=wm(p[1]),p.length!==2?Ot.push(new Fd(S,p,`filter array for "${p[0]}" operator must have 2 elements`)):ut!=="object"&&Ot.push(new Fd(`${S}[1]`,p[1],`object expected, ${ut} found`))}return Ot}function xv(_,p){const S=_.key,j=_.validateSpec,ut=_.style,Ot=_.styleSpec,fi=_.value,Bn=_.objectKey,us=Ot[`${p}_${_.layerType}`];if(!us)return[];const ul=Bn.match(/^(.*)-transition$/);if(p==="paint"&&ul&&us[ul[1]]&&us[ul[1]].transition)return j({key:S,value:fi,valueSpec:Ot.transition,style:ut,styleSpec:Ot});const Ju=_.valueSpec||us[Bn];if(!Ju)return[new Fd(S,fi,`unknown property "${Bn}"`)];let oh;if(wm(fi)==="string"&&j_(Ju)&&!Ju.tokens&&(oh=/^{([^}]+)}$/.exec(fi)))return[new Fd(S,fi,`"${Bn}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(oh[1])} }\`.`)];const gh=[];return _.layerType==="symbol"&&(Bn==="text-field"&&ut&&!ut.glyphs&&gh.push(new Fd(S,fi,'use of "text-field" requires a style "glyphs" property')),Bn==="text-font"&&ay(Jd(fi))&&yd(fi.type)==="identity"&&gh.push(new Fd(S,fi,'"text-font" does not support identity functions'))),gh.concat(j({key:_.key,value:fi,valueSpec:Ju,style:ut,styleSpec:Ot,expressionContext:"property",propertyType:p,propertyKey:Bn}))}function cy(_){return xv(_,"paint")}function f0(_){return xv(_,"layout")}function __(_){let p=[];const S=_.value,j=_.key,ut=_.style,Ot=_.styleSpec;S.type||S.ref||p.push(new Fd(j,S,'either "type" or "ref" is required'));let fi=yd(S.type);const Bn=yd(S.ref);if(S.id){const us=yd(S.id);for(let ul=0;ul<_.arrayIndex;ul++){const Ju=ut.layers[ul];yd(Ju.id)===us&&p.push(new Fd(j,S.id,`duplicate layer id "${S.id}", previously used at line ${Ju.id.__line__}`))}}if("ref"in S){let us;["type","source","source-layer","filter","layout"].forEach(ul=>{ul in S&&p.push(new Fd(j,S[ul],`"${ul}" is prohibited for ref layers`))}),ut.layers.forEach(ul=>{yd(ul.id)===Bn&&(us=ul)}),us?us.ref?p.push(new Fd(j,S.ref,"ref cannot reference another ref layer")):fi=yd(us.type):p.push(new Fd(j,S.ref,`ref layer "${Bn}" not found`))}else if(fi!=="background")if(S.source){const us=ut.sources&&ut.sources[S.source],ul=us&&yd(us.type);us?ul==="vector"&&fi==="raster"?p.push(new Fd(j,S.source,`layer "${S.id}" requires a raster source`)):ul==="raster"&&fi!=="raster"?p.push(new Fd(j,S.source,`layer "${S.id}" requires a vector source`)):ul!=="vector"||S["source-layer"]?ul==="raster-dem"&&fi!=="hillshade"?p.push(new Fd(j,S.source,"raster-dem source can only be used with layer type 'hillshade'.")):fi!=="line"||!S.paint||!S.paint["line-gradient"]||ul==="geojson"&&us.lineMetrics||p.push(new Fd(j,S,`layer "${S.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):p.push(new Fd(j,S,`layer "${S.id}" must specify a "source-layer"`)):p.push(new Fd(j,S.source,`source "${S.source}" not found`))}else p.push(new Fd(j,S,'missing required property "source"'));return p=p.concat(Eg({key:j,value:S,valueSpec:Ot.layer,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":()=>[],type:()=>_.validateSpec({key:`${j}.type`,value:S.type,valueSpec:Ot.layer.type,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,object:S,objectKey:"type"}),filter:g_,layout:us=>Eg({layer:S,key:us.key,value:us.value,style:us.style,styleSpec:us.styleSpec,validateSpec:us.validateSpec,objectElementValidators:{"*":ul=>f0(jf({layerType:fi},ul))}}),paint:us=>Eg({layer:S,key:us.key,value:us.value,style:us.style,styleSpec:us.styleSpec,validateSpec:us.validateSpec,objectElementValidators:{"*":ul=>cy(jf({layerType:fi},ul))}})}})),p}function H_(_){const p=_.value,S=_.key,j=wm(p);return j!=="string"?[new Fd(S,p,`string expected, ${j} found`)]:[]}const jy={promoteId:function({key:_,value:p}){if(wm(p)==="string")return H_({key:_,value:p});{const S=[];for(const j in p)S.push(...H_({key:`${_}.${j}`,value:p[j]}));return S}}};function yy(_){const p=_.value,S=_.key,j=_.styleSpec,ut=_.style,Ot=_.validateSpec;if(!p.type)return[new Fd(S,p,'"type" is required')];const fi=yd(p.type);let Bn;switch(fi){case"vector":case"raster":case"raster-dem":return Bn=Eg({key:S,value:p,valueSpec:j[`source_${fi.replace("-","_")}`],style:_.style,styleSpec:j,objectElementValidators:jy,validateSpec:Ot}),Bn;case"geojson":if(Bn=Eg({key:S,value:p,valueSpec:j.source_geojson,style:ut,styleSpec:j,validateSpec:Ot,objectElementValidators:jy}),p.cluster)for(const us in p.clusterProperties){const[ul,Ju]=p.clusterProperties[us],oh=typeof ul=="string"?[ul,["accumulated"],["get",us]]:ul;Bn.push(...Kp({key:`${S}.${us}.map`,value:Ju,validateSpec:Ot,expressionContext:"cluster-map"})),Bn.push(...Kp({key:`${S}.${us}.reduce`,value:oh,validateSpec:Ot,expressionContext:"cluster-reduce"}))}return Bn;case"video":return Eg({key:S,value:p,valueSpec:j.source_video,style:ut,validateSpec:Ot,styleSpec:j});case"image":return Eg({key:S,value:p,valueSpec:j.source_image,style:ut,validateSpec:Ot,styleSpec:j});case"canvas":return[new Fd(S,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return C_({key:`${S}.type`,value:p.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ut,validateSpec:Ot,styleSpec:j})}}function Qg(_){const p=_.value,S=_.styleSpec,j=S.light,ut=_.style;let Ot=[];const fi=wm(p);if(p===void 0)return Ot;if(fi!=="object")return Ot=Ot.concat([new Fd("light",p,`object expected, ${fi} found`)]),Ot;for(const Bn in p){const us=Bn.match(/^(.*)-transition$/);Ot=Ot.concat(us&&j[us[1]]&&j[us[1]].transition?_.validateSpec({key:Bn,value:p[Bn],valueSpec:S.transition,validateSpec:_.validateSpec,style:ut,styleSpec:S}):j[Bn]?_.validateSpec({key:Bn,value:p[Bn],valueSpec:j[Bn],validateSpec:_.validateSpec,style:ut,styleSpec:S}):[new Fd(Bn,p[Bn],`unknown property "${Bn}"`)])}return Ot}function qy(_){const p=_.value,S=_.styleSpec,j=S.terrain,ut=_.style;let Ot=[];const fi=wm(p);if(p===void 0)return Ot;if(fi!=="object")return Ot=Ot.concat([new Fd("terrain",p,`object expected, ${fi} found`)]),Ot;for(const Bn in p)Ot=Ot.concat(j[Bn]?_.validateSpec({key:Bn,value:p[Bn],valueSpec:j[Bn],validateSpec:_.validateSpec,style:ut,styleSpec:S}):[new Fd(Bn,p[Bn],`unknown property "${Bn}"`)]);return Ot}function nv(_){let p=[];const S=_.value,j=_.key;if(Array.isArray(S)){const ut=[],Ot=[];for(const fi in S)S[fi].id&&ut.includes(S[fi].id)&&p.push(new Fd(j,S,`all the sprites' ids must be unique, but ${S[fi].id} is duplicated`)),ut.push(S[fi].id),S[fi].url&&Ot.includes(S[fi].url)&&p.push(new Fd(j,S,`all the sprites' URLs must be unique, but ${S[fi].url} is duplicated`)),Ot.push(S[fi].url),p=p.concat(Eg({key:`${j}[${fi}]`,value:S[fi],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:_.validateSpec}));return p}return H_({key:j,value:S})}const p0={"*":()=>[],array:Z_,boolean:function(_){const p=_.value,S=_.key,j=wm(p);return j!=="boolean"?[new Fd(S,p,`boolean expected, ${j} found`)]:[]},number:f_,color:function(_){const p=_.key,S=_.value,j=wm(S);return j!=="string"?[new Fd(p,S,`color expected, ${j} found`)]:qp(S)===null?[new Fd(p,S,`color expected, "${S}" found`)]:[]},constants:rp,enum:C_,filter:g_,function:p_,layer:__,object:Eg,source:yy,light:Qg,terrain:qy,string:H_,formatted:function(_){return H_(_).length===0?[]:Kp(_)},resolvedImage:function(_){return H_(_).length===0?[]:Kp(_)},padding:function(_){const p=_.key,S=_.value;if(wm(S)==="array"){if(S.length<1||S.length>4)return[new Fd(p,S,`padding requires 1 to 4 values; ${S.length} values found`)];const j={type:"number"};let ut=[];for(let Ot=0;Ot<S.length;Ot++)ut=ut.concat(_.validateSpec({key:`${p}[${Ot}]`,value:S[Ot],validateSpec:_.validateSpec,valueSpec:j}));return ut}return f_({key:p,value:S,valueSpec:{}})},sprite:nv};function M_(_){const p=_.value,S=_.valueSpec,j=_.styleSpec;return _.validateSpec=M_,S.expression&&ay(yd(p))?p_(_):S.expression&&q_(Jd(p))?Kp(_):S.type&&p0[S.type]?p0[S.type](_):Eg(jf({},_,{valueSpec:S.type?j[S.type]:S}))}function m0(_){const p=_.value,S=_.key,j=H_(_);return j.length||(p.indexOf("{fontstack}")===-1&&j.push(new Fd(S,p,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&j.push(new Fd(S,p,'"glyphs" url must include a "{range}" token'))),j}function X_(_,p=td){let S=[];return S=S.concat(M_({key:"",value:_,valueSpec:p.$root,styleSpec:p,style:_,validateSpec:M_,objectElementValidators:{glyphs:m0,"*":()=>[]}})),_.constants&&(S=S.concat(rp({key:"constants",value:_.constants,style:_,styleSpec:p,validateSpec:M_}))),wf(S)}function hd(_){return function(p){return _({...p,validateSpec:M_})}}function wf(_){return[].concat(_).sort((p,S)=>p.line-S.line)}function ip(_){return function(...p){return wf(_.apply(this,p))}}X_.source=ip(hd(yy)),X_.sprite=ip(hd(nv)),X_.glyphs=ip(hd(m0)),X_.light=ip(hd(Qg)),X_.terrain=ip(hd(qy)),X_.layer=ip(hd(__)),X_.filter=ip(hd(g_)),X_.paintProperty=ip(hd(cy)),X_.layoutProperty=ip(hd(f0));const $p=X_,Nm=$p.light,hm=$p.paintProperty,Qm=$p.layoutProperty;function og(_,p){let S=!1;if(p&&p.length)for(const j of p)_.fire(new bf(new Error(j.message))),S=!0;return S}class ag{constructor(p,S,j){const ut=this.cells=[];if(p instanceof ArrayBuffer){this.arrayBuffer=p;const fi=new Int32Array(this.arrayBuffer);p=fi[0],this.d=(S=fi[1])+2*(j=fi[2]);for(let us=0;us<this.d*this.d;us++){const ul=fi[3+us],Ju=fi[3+us+1];ut.push(ul===Ju?null:fi.subarray(ul,Ju))}const Bn=fi[3+ut.length+1];this.keys=fi.subarray(fi[3+ut.length],Bn),this.bboxes=fi.subarray(Bn),this.insert=this._insertReadonly}else{this.d=S+2*j;for(let fi=0;fi<this.d*this.d;fi++)ut.push([]);this.keys=[],this.bboxes=[]}this.n=S,this.extent=p,this.padding=j,this.scale=S/p,this.uid=0;const Ot=j/S*p;this.min=-Ot,this.max=p+Ot}insert(p,S,j,ut,Ot){this._forEachCell(S,j,ut,Ot,this._insertCell,this.uid++,void 0,void 0),this.keys.push(p),this.bboxes.push(S),this.bboxes.push(j),this.bboxes.push(ut),this.bboxes.push(Ot)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(p,S,j,ut,Ot,fi){this.cells[Ot].push(fi)}query(p,S,j,ut,Ot){const fi=this.min,Bn=this.max;if(p<=fi&&S<=fi&&Bn<=j&&Bn<=ut&&!Ot)return Array.prototype.slice.call(this.keys);{const us=[];return this._forEachCell(p,S,j,ut,this._queryCell,us,{},Ot),us}}_queryCell(p,S,j,ut,Ot,fi,Bn,us){const ul=this.cells[Ot];if(ul!==null){const Ju=this.keys,oh=this.bboxes;for(let gh=0;gh<ul.length;gh++){const xh=ul[gh];if(Bn[xh]===void 0){const bh=4*xh;(us?us(oh[bh+0],oh[bh+1],oh[bh+2],oh[bh+3]):p<=oh[bh+2]&&S<=oh[bh+3]&&j>=oh[bh+0]&&ut>=oh[bh+1])?(Bn[xh]=!0,fi.push(Ju[xh])):Bn[xh]=!1}}}}_forEachCell(p,S,j,ut,Ot,fi,Bn,us){const ul=this._convertToCellCoord(p),Ju=this._convertToCellCoord(S),oh=this._convertToCellCoord(j),gh=this._convertToCellCoord(ut);for(let xh=ul;xh<=oh;xh++)for(let bh=Ju;bh<=gh;bh++){const Wh=this.d*bh+xh;if((!us||us(this._convertFromCellCoord(xh),this._convertFromCellCoord(bh),this._convertFromCellCoord(xh+1),this._convertFromCellCoord(bh+1)))&&Ot.call(this,p,S,j,ut,Wh,fi,Bn,us))return}}_convertFromCellCoord(p){return(p-this.padding)/this.scale}_convertToCellCoord(p){return Math.max(0,Math.min(this.d-1,Math.floor(p*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const p=this.cells,S=3+this.cells.length+1+1;let j=0;for(let fi=0;fi<this.cells.length;fi++)j+=this.cells[fi].length;const ut=new Int32Array(S+j+this.keys.length+this.bboxes.length);ut[0]=this.extent,ut[1]=this.n,ut[2]=this.padding;let Ot=S;for(let fi=0;fi<p.length;fi++){const Bn=p[fi];ut[3+fi]=Ot,ut.set(Bn,Ot),Ot+=Bn.length}return ut[3+p.length]=Ot,ut.set(this.keys,Ot),Ot+=this.keys.length,ut[3+p.length+1]=Ot,ut.set(this.bboxes,Ot),Ot+=this.bboxes.length,ut.buffer}static serialize(p,S){const j=p.toArrayBuffer();return S&&S.push(j),{buffer:j}}static deserialize(p){return new ag(p.buffer)}}const Vm={};function tp(_,p,S={}){if(Vm[_])throw new Error(`${_} is already registered.`);Object.defineProperty(p,"_classRegistryKey",{value:_,writeable:!1}),Vm[_]={klass:p,omit:S.omit||[],shallow:S.shallow||[]}}tp("Object",Object),tp("TransferableGridIndex",ag),tp("Color",hp),tp("Error",Error),tp("AJAXError",Af),tp("ResolvedImage",Hf),tp("StylePropertyFunction",Fy),tp("StyleExpression",zy,{omit:["_evaluator"]}),tp("ZoomDependentExpression",u0),tp("ZoomConstantExpression",c0),tp("CompoundExpression",vh,{omit:["_evaluate"]});for(const _ in Vg)Vg[_]._classRegistryKey||tp(`Expression_${_}`,Vg[_]);function Wg(_){return _&&typeof ArrayBuffer<"u"&&(_ instanceof ArrayBuffer||_.constructor&&_.constructor.name==="ArrayBuffer")}function Tg(_,p){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||_ instanceof Blob)return _;if(Wg(_)||sh(_))return p&&p.push(_),_;if(ArrayBuffer.isView(_)){const S=_;return p&&p.push(S.buffer),S}if(_ instanceof ImageData)return p&&p.push(_.data.buffer),_;if(Array.isArray(_)){const S=[];for(const j of _)S.push(Tg(j,p));return S}if(typeof _=="object"){const S=_.constructor,j=S._classRegistryKey;if(!j)throw new Error("can't serialize object of unregistered class");if(!Vm[j])throw new Error(`${j} is not registered.`);const ut=S.serialize?S.serialize(_,p):{};if(S.serialize){if(p&&ut===p[p.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Ot in _){if(!_.hasOwnProperty(Ot)||Vm[j].omit.indexOf(Ot)>=0)continue;const fi=_[Ot];ut[Ot]=Vm[j].shallow.indexOf(Ot)>=0?fi:Tg(fi,p)}_ instanceof Error&&(ut.message=_.message)}if(ut.$name)throw new Error("$name property is reserved for worker serialization logic.");return j!=="Object"&&(ut.$name=j),ut}throw new Error("can't serialize object of type "+typeof _)}function fg(_){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||_ instanceof Blob||Wg(_)||sh(_)||ArrayBuffer.isView(_)||_ instanceof ImageData)return _;if(Array.isArray(_))return _.map(fg);if(typeof _=="object"){const p=_.$name||"Object";if(!Vm[p])throw new Error(`can't deserialize unregistered class ${p}`);const{klass:S}=Vm[p];if(!S)throw new Error(`can't deserialize unregistered class ${p}`);if(S.deserialize)return S.deserialize(_);const j=Object.create(S.prototype);for(const ut of Object.keys(_)){if(ut==="$name")continue;const Ot=_[ut];j[ut]=Vm[p].shallow.indexOf(ut)>=0?Ot:fg(Ot)}return j}throw new Error("can't deserialize object of type "+typeof _)}class A_{constructor(){this.first=!0}update(p,S){const j=Math.floor(p);return this.first?(this.first=!1,this.lastIntegerZoom=j,this.lastIntegerZoomTime=0,this.lastZoom=p,this.lastFloorZoom=j,!0):(this.lastFloorZoom>j?(this.lastIntegerZoom=j+1,this.lastIntegerZoomTime=S):this.lastFloorZoom<j&&(this.lastIntegerZoom=j,this.lastIntegerZoomTime=S),p!==this.lastZoom&&(this.lastZoom=p,this.lastFloorZoom=j,!0))}}const sp={"Latin-1 Supplement":_=>_>=128&&_<=255,Arabic:_=>_>=1536&&_<=1791,"Arabic Supplement":_=>_>=1872&&_<=1919,"Arabic Extended-A":_=>_>=2208&&_<=2303,"Hangul Jamo":_=>_>=4352&&_<=4607,"Unified Canadian Aboriginal Syllabics":_=>_>=5120&&_<=5759,Khmer:_=>_>=6016&&_<=6143,"Unified Canadian Aboriginal Syllabics Extended":_=>_>=6320&&_<=6399,"General Punctuation":_=>_>=8192&&_<=8303,"Letterlike Symbols":_=>_>=8448&&_<=8527,"Number Forms":_=>_>=8528&&_<=8591,"Miscellaneous Technical":_=>_>=8960&&_<=9215,"Control Pictures":_=>_>=9216&&_<=9279,"Optical Character Recognition":_=>_>=9280&&_<=9311,"Enclosed Alphanumerics":_=>_>=9312&&_<=9471,"Geometric Shapes":_=>_>=9632&&_<=9727,"Miscellaneous Symbols":_=>_>=9728&&_<=9983,"Miscellaneous Symbols and Arrows":_=>_>=11008&&_<=11263,"CJK Radicals Supplement":_=>_>=11904&&_<=12031,"Kangxi Radicals":_=>_>=12032&&_<=12255,"Ideographic Description Characters":_=>_>=12272&&_<=12287,"CJK Symbols and Punctuation":_=>_>=12288&&_<=12351,Hiragana:_=>_>=12352&&_<=12447,Katakana:_=>_>=12448&&_<=12543,Bopomofo:_=>_>=12544&&_<=12591,"Hangul Compatibility Jamo":_=>_>=12592&&_<=12687,Kanbun:_=>_>=12688&&_<=12703,"Bopomofo Extended":_=>_>=12704&&_<=12735,"CJK Strokes":_=>_>=12736&&_<=12783,"Katakana Phonetic Extensions":_=>_>=12784&&_<=12799,"Enclosed CJK Letters and Months":_=>_>=12800&&_<=13055,"CJK Compatibility":_=>_>=13056&&_<=13311,"CJK Unified Ideographs Extension A":_=>_>=13312&&_<=19903,"Yijing Hexagram Symbols":_=>_>=19904&&_<=19967,"CJK Unified Ideographs":_=>_>=19968&&_<=40959,"Yi Syllables":_=>_>=40960&&_<=42127,"Yi Radicals":_=>_>=42128&&_<=42191,"Hangul Jamo Extended-A":_=>_>=43360&&_<=43391,"Hangul Syllables":_=>_>=44032&&_<=55215,"Hangul Jamo Extended-B":_=>_>=55216&&_<=55295,"Private Use Area":_=>_>=57344&&_<=63743,"CJK Compatibility Ideographs":_=>_>=63744&&_<=64255,"Arabic Presentation Forms-A":_=>_>=64336&&_<=65023,"Vertical Forms":_=>_>=65040&&_<=65055,"CJK Compatibility Forms":_=>_>=65072&&_<=65103,"Small Form Variants":_=>_>=65104&&_<=65135,"Arabic Presentation Forms-B":_=>_>=65136&&_<=65279,"Halfwidth and Fullwidth Forms":_=>_>=65280&&_<=65519};function Zy(_){for(const p of _)if(g0(p.charCodeAt(0)))return!0;return!1}function vy(_){for(const p of _)if(!$0(p.charCodeAt(0)))return!1;return!0}function $0(_){return!(sp.Arabic(_)||sp["Arabic Supplement"](_)||sp["Arabic Extended-A"](_)||sp["Arabic Presentation Forms-A"](_)||sp["Arabic Presentation Forms-B"](_))}function g0(_){return!(_!==746&&_!==747&&(_<4352||!(sp["Bopomofo Extended"](_)||sp.Bopomofo(_)||sp["CJK Compatibility Forms"](_)&&!(_>=65097&&_<=65103)||sp["CJK Compatibility Ideographs"](_)||sp["CJK Compatibility"](_)||sp["CJK Radicals Supplement"](_)||sp["CJK Strokes"](_)||!(!sp["CJK Symbols and Punctuation"](_)||_>=12296&&_<=12305||_>=12308&&_<=12319||_===12336)||sp["CJK Unified Ideographs Extension A"](_)||sp["CJK Unified Ideographs"](_)||sp["Enclosed CJK Letters and Months"](_)||sp["Hangul Compatibility Jamo"](_)||sp["Hangul Jamo Extended-A"](_)||sp["Hangul Jamo Extended-B"](_)||sp["Hangul Jamo"](_)||sp["Hangul Syllables"](_)||sp.Hiragana(_)||sp["Ideographic Description Characters"](_)||sp.Kanbun(_)||sp["Kangxi Radicals"](_)||sp["Katakana Phonetic Extensions"](_)||sp.Katakana(_)&&_!==12540||!(!sp["Halfwidth and Fullwidth Forms"](_)||_===65288||_===65289||_===65293||_>=65306&&_<=65310||_===65339||_===65341||_===65343||_>=65371&&_<=65503||_===65507||_>=65512&&_<=65519)||!(!sp["Small Form Variants"](_)||_>=65112&&_<=65118||_>=65123&&_<=65126)||sp["Unified Canadian Aboriginal Syllabics"](_)||sp["Unified Canadian Aboriginal Syllabics Extended"](_)||sp["Vertical Forms"](_)||sp["Yijing Hexagram Symbols"](_)||sp["Yi Syllables"](_)||sp["Yi Radicals"](_))))}function ov(_){return!(g0(_)||function(p){return!!(sp["Latin-1 Supplement"](p)&&(p===167||p===169||p===174||p===177||p===188||p===189||p===190||p===215||p===247)||sp["General Punctuation"](p)&&(p===8214||p===8224||p===8225||p===8240||p===8241||p===8251||p===8252||p===8258||p===8263||p===8264||p===8265||p===8273)||sp["Letterlike Symbols"](p)||sp["Number Forms"](p)||sp["Miscellaneous Technical"](p)&&(p>=8960&&p<=8967||p>=8972&&p<=8991||p>=8996&&p<=9e3||p===9003||p>=9085&&p<=9114||p>=9150&&p<=9165||p===9167||p>=9169&&p<=9179||p>=9186&&p<=9215)||sp["Control Pictures"](p)&&p!==9251||sp["Optical Character Recognition"](p)||sp["Enclosed Alphanumerics"](p)||sp["Geometric Shapes"](p)||sp["Miscellaneous Symbols"](p)&&!(p>=9754&&p<=9759)||sp["Miscellaneous Symbols and Arrows"](p)&&(p>=11026&&p<=11055||p>=11088&&p<=11097||p>=11192&&p<=11243)||sp["CJK Symbols and Punctuation"](p)||sp.Katakana(p)||sp["Private Use Area"](p)||sp["CJK Compatibility Forms"](p)||sp["Small Form Variants"](p)||sp["Halfwidth and Fullwidth Forms"](p)||p===8734||p===8756||p===8757||p>=9984&&p<=10087||p>=10102&&p<=10131||p===65532||p===65533)}(_))}function _0(_){return _>=1424&&_<=2303||sp["Arabic Presentation Forms-A"](_)||sp["Arabic Presentation Forms-B"](_)}function Mm(_,p){return!(!p&&_0(_)||_>=2304&&_<=3583||_>=3840&&_<=4255||sp.Khmer(_))}function am(_){for(const p of _)if(_0(p.charCodeAt(0)))return!0;return!1}const P_="deferred",Ng="loading",W_="loaded";let Dg=null,Gm="unavailable",sg=null;const Jg=function(_){_&&typeof _=="string"&&_.indexOf("NetworkError")>-1&&(Gm="error"),Dg&&Dg(_)};function k_(){em.fire(new Gd("pluginStateChange",{pluginStatus:Gm,pluginURL:sg}))}const em=new Id,Gg=function(){return Gm},bv=function(){if(Gm!==P_||!sg)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gm=Ng,k_(),sg&&Ed({url:sg},_=>{_?Jg(_):(Gm=W_,k_())})},Ig={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gm===W_||Ig.applyArabicShaping!=null,isLoading:()=>Gm===Ng,setState(_){if(!Zu())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gm=_.pluginStatus,sg=_.pluginURL},isParsed(){if(!Zu())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ig.applyArabicShaping!=null&&Ig.processBidirectionalText!=null&&Ig.processStyledBidirectionalText!=null},getPluginURL(){if(!Zu())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return sg}};class Cm{constructor(p,S){this.zoom=p,S?(this.now=S.now,this.fadeDuration=S.fadeDuration,this.zoomHistory=S.zoomHistory,this.transition=S.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new A_,this.transition={})}isSupportedScript(p){return function(S,j){for(const ut of S)if(!Mm(ut.charCodeAt(0),j))return!1;return!0}(p,Ig.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const p=this.zoom,S=p-Math.floor(p),j=this.crossFadingFactor();return p>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:S+(1-S)*j}:{fromScale:.5,toScale:1,t:1-(1-j)*S}}}class D_{constructor(p,S){this.property=p,this.value=S,this.expression=function(j,ut){if(ay(j))return new Fy(j,ut);if(q_(j)){const Ot=rv(j,ut);if(Ot.result==="error")throw new Error(Ot.value.map(fi=>`${fi.key}: ${fi.message}`).join(", "));return Ot.value}{let Ot=j;return ut.type==="color"&&typeof j=="string"?Ot=hp.parse(j):ut.type!=="padding"||typeof j!="number"&&!Array.isArray(j)||(Ot=Dd.parse(j)),{kind:"constant",evaluate:()=>Ot}}}(S===void 0?p.specification.default:S,p.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(p,S,j){return this.property.possiblyEvaluate(this,p,S,j)}}class xy{constructor(p){this.property=p,this.value=new D_(p,void 0)}transitioned(p,S){return new y0(this.property,this.value,S,Bt({},p.transition,this.transition),p.now)}untransitioned(){return new y0(this.property,this.value,null,{},0)}}class Hy{constructor(p){this._properties=p,this._values=Object.create(p.defaultTransitionablePropertyValues)}getValue(p){return Co(this._values[p].value.value)}setValue(p,S){Object.prototype.hasOwnProperty.call(this._values,p)||(this._values[p]=new xy(this._values[p].property)),this._values[p].value=new D_(this._values[p].property,S===null?void 0:Co(S))}getTransition(p){return Co(this._values[p].transition)}setTransition(p,S){Object.prototype.hasOwnProperty.call(this._values,p)||(this._values[p]=new xy(this._values[p].property)),this._values[p].transition=Co(S)||void 0}serialize(){const p={};for(const S of Object.keys(this._values)){const j=this.getValue(S);j!==void 0&&(p[S]=j);const ut=this.getTransition(S);ut!==void 0&&(p[`${S}-transition`]=ut)}return p}transitioned(p,S){const j=new Y_(this._properties);for(const ut of Object.keys(this._values))j._values[ut]=this._values[ut].transitioned(p,S._values[ut]);return j}untransitioned(){const p=new Y_(this._properties);for(const S of Object.keys(this._values))p._values[S]=this._values[S].untransitioned();return p}}class y0{constructor(p,S,j,ut,Ot){this.property=p,this.value=S,this.begin=Ot+ut.delay||0,this.end=this.begin+ut.duration||0,p.specification.transition&&(ut.delay||ut.duration)&&(this.prior=j)}possiblyEvaluate(p,S,j){const ut=p.now||0,Ot=this.value.possiblyEvaluate(p,S,j),fi=this.prior;if(fi){if(ut>this.end)return this.prior=null,Ot;if(this.value.isDataDriven())return this.prior=null,Ot;if(ut<this.begin)return fi.possiblyEvaluate(p,S,j);{const Bn=(ut-this.begin)/(this.end-this.begin);return this.property.interpolate(fi.possiblyEvaluate(p,S,j),Ot,function(us){if(us<=0)return 0;if(us>=1)return 1;const ul=us*us,Ju=ul*us;return 4*(us<.5?Ju:3*(us-ul)+Ju-.75)}(Bn))}}return Ot}}class Y_{constructor(p){this._properties=p,this._values=Object.create(p.defaultTransitioningPropertyValues)}possiblyEvaluate(p,S,j){const ut=new B0(this._properties);for(const Ot of Object.keys(this._values))ut._values[Ot]=this._values[Ot].possiblyEvaluate(p,S,j);return ut}hasTransition(){for(const p of Object.keys(this._values))if(this._values[p].prior)return!0;return!1}}class Xy{constructor(p){this._properties=p,this._values=Object.create(p.defaultPropertyValues)}getValue(p){return Co(this._values[p].value)}setValue(p,S){this._values[p]=new D_(this._values[p].property,S===null?void 0:Co(S))}serialize(){const p={};for(const S of Object.keys(this._values)){const j=this.getValue(S);j!==void 0&&(p[S]=j)}return p}possiblyEvaluate(p,S,j){const ut=new B0(this._properties);for(const Ot of Object.keys(this._values))ut._values[Ot]=this._values[Ot].possiblyEvaluate(p,S,j);return ut}}class e_{constructor(p,S,j){this.property=p,this.value=S,this.parameters=j}isConstant(){return this.value.kind==="constant"}constantOr(p){return this.value.kind==="constant"?this.value.value:p}evaluate(p,S,j,ut){return this.property.evaluate(this.value,this.parameters,p,S,j,ut)}}class B0{constructor(p){this._properties=p,this._values=Object.create(p.defaultPossiblyEvaluatedValues)}get(p){return this._values[p]}}class kp{constructor(p){this.specification=p}possiblyEvaluate(p,S){if(p.isDataDriven())throw new Error("Value should not be data driven");return p.expression.evaluate(S)}interpolate(p,S,j){const ut=yr[this.specification.type];return ut?ut(p,S,j):p}}class Up{constructor(p,S){this.specification=p,this.overrides=S}possiblyEvaluate(p,S,j,ut){return new e_(this,p.expression.kind==="constant"||p.expression.kind==="camera"?{kind:"constant",value:p.expression.evaluate(S,null,{},j,ut)}:p.expression,S)}interpolate(p,S,j){if(p.value.kind!=="constant"||S.value.kind!=="constant")return p;if(p.value.value===void 0||S.value.value===void 0)return new e_(this,{kind:"constant",value:void 0},p.parameters);const ut=yr[this.specification.type];return ut?new e_(this,{kind:"constant",value:ut(p.value.value,S.value.value,j)},p.parameters):p}evaluate(p,S,j,ut,Ot,fi){return p.kind==="constant"?p.value:p.evaluate(S,j,ut,Ot,fi)}}class by extends Up{possiblyEvaluate(p,S,j,ut){if(p.value===void 0)return new e_(this,{kind:"constant",value:void 0},S);if(p.expression.kind==="constant"){const Ot=p.expression.evaluate(S,null,{},j,ut),fi=p.property.specification.type==="resolvedImage"&&typeof Ot!="string"?Ot.name:Ot,Bn=this._calculate(fi,fi,fi,S);return new e_(this,{kind:"constant",value:Bn},S)}if(p.expression.kind==="camera"){const Ot=this._calculate(p.expression.evaluate({zoom:S.zoom-1}),p.expression.evaluate({zoom:S.zoom}),p.expression.evaluate({zoom:S.zoom+1}),S);return new e_(this,{kind:"constant",value:Ot},S)}return new e_(this,p.expression,S)}evaluate(p,S,j,ut,Ot,fi){if(p.kind==="source"){const Bn=p.evaluate(S,j,ut,Ot,fi);return this._calculate(Bn,Bn,Bn,S)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(S.zoom)-1},j,ut),p.evaluate({zoom:Math.floor(S.zoom)},j,ut),p.evaluate({zoom:Math.floor(S.zoom)+1},j,ut),S):p.value}_calculate(p,S,j,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:p,to:S}:{from:j,to:S}}interpolate(p){return p}}class N0{constructor(p){this.specification=p}possiblyEvaluate(p,S,j,ut){if(p.value!==void 0){if(p.expression.kind==="constant"){const Ot=p.expression.evaluate(S,null,{},j,ut);return this._calculate(Ot,Ot,Ot,S)}return this._calculate(p.expression.evaluate(new Cm(Math.floor(S.zoom-1),S)),p.expression.evaluate(new Cm(Math.floor(S.zoom),S)),p.expression.evaluate(new Cm(Math.floor(S.zoom+1),S)),S)}}_calculate(p,S,j,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:p,to:S}:{from:j,to:S}}interpolate(p){return p}}class pp{constructor(p){this.specification=p}possiblyEvaluate(p,S,j,ut){return!!p.expression.evaluate(S,null,{},j,ut)}interpolate(){return!1}}class tg{constructor(p){this.properties=p,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const S in p){const j=p[S];j.specification.overridable&&this.overridableProperties.push(S);const ut=this.defaultPropertyValues[S]=new D_(j,void 0),Ot=this.defaultTransitionablePropertyValues[S]=new xy(j);this.defaultTransitioningPropertyValues[S]=Ot.untransitioned(),this.defaultPossiblyEvaluatedValues[S]=ut.possiblyEvaluate({})}}}tp("DataDrivenProperty",Up),tp("DataConstantProperty",kp),tp("CrossFadedDataDrivenProperty",by),tp("CrossFadedProperty",N0),tp("ColorRampProperty",pp);const wv="-transition";class L_ extends Id{constructor(p,S){if(super(),this.id=p.id,this.type=p.type,this._featureFilter={filter:()=>!0,needGeometry:!1},p.type!=="custom"&&(this.metadata=p.metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),S.layout&&(this._unevaluatedLayout=new Xy(S.layout)),S.paint)){this._transitionablePaint=new Hy(S.paint);for(const j in p.paint)this.setPaintProperty(j,p.paint[j],{validate:!1});for(const j in p.layout)this.setLayoutProperty(j,p.layout[j],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new B0(S.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)}setLayoutProperty(p,S,j={}){S!=null&&this._validate(Qm,`layers.${this.id}.layout.${p}`,p,S,j)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,S):this.visibility=S)}getPaintProperty(p){return p.endsWith(wv)?this._transitionablePaint.getTransition(p.slice(0,-wv.length)):this._transitionablePaint.getValue(p)}setPaintProperty(p,S,j={}){if(S!=null&&this._validate(hm,`layers.${this.id}.paint.${p}`,p,S,j))return!1;if(p.endsWith(wv))return this._transitionablePaint.setTransition(p.slice(0,-wv.length),S||void 0),!1;{const ut=this._transitionablePaint._values[p],Ot=ut.property.specification["property-type"]==="cross-faded-data-driven",fi=ut.value.isDataDriven(),Bn=ut.value;this._transitionablePaint.setValue(p,S),this._handleSpecialPaintPropertyUpdate(p);const us=this._transitionablePaint._values[p].value;return us.isDataDriven()||fi||Ot||this._handleOverridablePaintPropertyUpdate(p,Bn,us)}}_handleSpecialPaintPropertyUpdate(p){}_handleOverridablePaintPropertyUpdate(p,S,j){return!1}isHidden(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"}updateTransitions(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(p,S){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,S)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,S)}serialize(){const p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),rl(p,(S,j)=>!(S===void 0||j==="layout"&&!Object.keys(S).length||j==="paint"&&!Object.keys(S).length))}_validate(p,S,j,ut,Ot={}){return(!Ot||Ot.validate!==!1)&&og(this,p.call($p,{key:S,layerType:this.type,objectKey:j,value:ut,styleSpec:td,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const p in this.paint._values){const S=this.paint.get(p);if(S instanceof e_&&j_(S.property.specification)&&(S.value.kind==="source"||S.value.kind==="composite")&&S.value.isStateDependent)return!0}return!1}}const Ev={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wy{constructor(p,S){this._structArray=p,this._pos1=S*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pg{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(p,S){return p._trim(),S&&(p.isTransferred=!0,S.push(p.arrayBuffer)),{length:p.length,arrayBuffer:p.arrayBuffer}}static deserialize(p){const S=Object.create(this.prototype);return S.arrayBuffer=p.arrayBuffer,S.length=p.length,S.capacity=p.arrayBuffer.byteLength/S.bytesPerElement,S._refreshViews(),S}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(p){this.reserve(p),this.length=p}reserve(p){if(p>this.capacity){this.capacity=Math.max(p,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const S=this.uint8;this._refreshViews(),S&&this.uint8.set(S)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mg(_,p=1){let S=0,j=0;return{members:_.map(ut=>{const Ot=Ev[ut.type].BYTES_PER_ELEMENT,fi=S=zv(S,Math.max(p,Ot)),Bn=ut.components||1;return j=Math.max(j,Ot),S+=Ot*Bn,{name:ut.name,type:ut.type,components:Bn,offset:fi}}),size:zv(S,Math.max(j,p)),alignment:p}}function zv(_,p){return Math.ceil(_/p)*p}class v0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S){const j=this.length;return this.resize(j+1),this.emplace(j,p,S)}emplace(p,S,j){const ut=2*p;return this.int16[ut+0]=S,this.int16[ut+1]=j,p}}v0.prototype.bytesPerElement=4,tp("StructArrayLayout2i4",v0);class x0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=3*p;return this.int16[Ot+0]=S,this.int16[Ot+1]=j,this.int16[Ot+2]=ut,p}}x0.prototype.bytesPerElement=6,tp("StructArrayLayout3i6",x0);class wy extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,p,S,j,ut)}emplace(p,S,j,ut,Ot){const fi=4*p;return this.int16[fi+0]=S,this.int16[fi+1]=j,this.int16[fi+2]=ut,this.int16[fi+3]=Ot,p}}wy.prototype.bytesPerElement=8,tp("StructArrayLayout4i8",wy);class Lg extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi){const Bn=this.length;return this.resize(Bn+1),this.emplace(Bn,p,S,j,ut,Ot,fi)}emplace(p,S,j,ut,Ot,fi,Bn){const us=6*p;return this.int16[us+0]=S,this.int16[us+1]=j,this.int16[us+2]=ut,this.int16[us+3]=Ot,this.int16[us+4]=fi,this.int16[us+5]=Bn,p}}Lg.prototype.bytesPerElement=12,tp("StructArrayLayout2i4i12",Lg);class b0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi){const Bn=this.length;return this.resize(Bn+1),this.emplace(Bn,p,S,j,ut,Ot,fi)}emplace(p,S,j,ut,Ot,fi,Bn){const us=4*p,ul=8*p;return this.int16[us+0]=S,this.int16[us+1]=j,this.uint8[ul+4]=ut,this.uint8[ul+5]=Ot,this.uint8[ul+6]=fi,this.uint8[ul+7]=Bn,p}}b0.prototype.bytesPerElement=8,tp("StructArrayLayout2i4ub8",b0);class Tv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S){const j=this.length;return this.resize(j+1),this.emplace(j,p,S)}emplace(p,S,j){const ut=2*p;return this.float32[ut+0]=S,this.float32[ut+1]=j,p}}Tv.prototype.bytesPerElement=8,tp("StructArrayLayout2f8",Tv);class Fv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,Bn,us,ul,Ju){const oh=this.length;return this.resize(oh+1),this.emplace(oh,p,S,j,ut,Ot,fi,Bn,us,ul,Ju)}emplace(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh){const gh=10*p;return this.uint16[gh+0]=S,this.uint16[gh+1]=j,this.uint16[gh+2]=ut,this.uint16[gh+3]=Ot,this.uint16[gh+4]=fi,this.uint16[gh+5]=Bn,this.uint16[gh+6]=us,this.uint16[gh+7]=ul,this.uint16[gh+8]=Ju,this.uint16[gh+9]=oh,p}}Fv.prototype.bytesPerElement=20,tp("StructArrayLayout10ui20",Fv);class av extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh){const xh=this.length;return this.resize(xh+1),this.emplace(xh,p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh)}emplace(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh){const bh=12*p;return this.int16[bh+0]=S,this.int16[bh+1]=j,this.int16[bh+2]=ut,this.int16[bh+3]=Ot,this.uint16[bh+4]=fi,this.uint16[bh+5]=Bn,this.uint16[bh+6]=us,this.uint16[bh+7]=ul,this.int16[bh+8]=Ju,this.int16[bh+9]=oh,this.int16[bh+10]=gh,this.int16[bh+11]=xh,p}}av.prototype.bytesPerElement=24,tp("StructArrayLayout4i4ui4i24",av);class sv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=3*p;return this.float32[Ot+0]=S,this.float32[Ot+1]=j,this.float32[Ot+2]=ut,p}}sv.prototype.bytesPerElement=12,tp("StructArrayLayout3f12",sv);class z0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(p){const S=this.length;return this.resize(S+1),this.emplace(S,p)}emplace(p,S){return this.uint32[1*p+0]=S,p}}z0.prototype.bytesPerElement=4,tp("StructArrayLayout1ul4",z0);class Uv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,Bn,us,ul){const Ju=this.length;return this.resize(Ju+1),this.emplace(Ju,p,S,j,ut,Ot,fi,Bn,us,ul)}emplace(p,S,j,ut,Ot,fi,Bn,us,ul,Ju){const oh=10*p,gh=5*p;return this.int16[oh+0]=S,this.int16[oh+1]=j,this.int16[oh+2]=ut,this.int16[oh+3]=Ot,this.int16[oh+4]=fi,this.int16[oh+5]=Bn,this.uint32[gh+3]=us,this.uint16[oh+8]=ul,this.uint16[oh+9]=Ju,p}}Uv.prototype.bytesPerElement=20,tp("StructArrayLayout6i1ul2ui20",Uv);class w0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi){const Bn=this.length;return this.resize(Bn+1),this.emplace(Bn,p,S,j,ut,Ot,fi)}emplace(p,S,j,ut,Ot,fi,Bn){const us=6*p;return this.int16[us+0]=S,this.int16[us+1]=j,this.int16[us+2]=ut,this.int16[us+3]=Ot,this.int16[us+4]=fi,this.int16[us+5]=Bn,p}}w0.prototype.bytesPerElement=12,tp("StructArrayLayout2i2i2i12",w0);class Sv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot){const fi=this.length;return this.resize(fi+1),this.emplace(fi,p,S,j,ut,Ot)}emplace(p,S,j,ut,Ot,fi){const Bn=4*p,us=8*p;return this.float32[Bn+0]=S,this.float32[Bn+1]=j,this.float32[Bn+2]=ut,this.int16[us+6]=Ot,this.int16[us+7]=fi,p}}Sv.prototype.bytesPerElement=16,tp("StructArrayLayout2f1f2i16",Sv);class Vv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,p,S,j,ut)}emplace(p,S,j,ut,Ot){const fi=12*p,Bn=3*p;return this.uint8[fi+0]=S,this.uint8[fi+1]=j,this.float32[Bn+1]=ut,this.float32[Bn+2]=Ot,p}}Vv.prototype.bytesPerElement=12,tp("StructArrayLayout2ub2f12",Vv);class F0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=3*p;return this.uint16[Ot+0]=S,this.uint16[Ot+1]=j,this.uint16[Ot+2]=ut,p}}F0.prototype.bytesPerElement=6,tp("StructArrayLayout3ui6",F0);class Gv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh,Zh,bd){const Bd=this.length;return this.resize(Bd+1),this.emplace(Bd,p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh,Zh,bd)}emplace(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh,Zh,bd,Bd){const dd=24*p,Nd=12*p,Ff=48*p;return this.int16[dd+0]=S,this.int16[dd+1]=j,this.uint16[dd+2]=ut,this.uint16[dd+3]=Ot,this.uint32[Nd+2]=fi,this.uint32[Nd+3]=Bn,this.uint32[Nd+4]=us,this.uint16[dd+10]=ul,this.uint16[dd+11]=Ju,this.uint16[dd+12]=oh,this.float32[Nd+7]=gh,this.float32[Nd+8]=xh,this.uint8[Ff+36]=bh,this.uint8[Ff+37]=Wh,this.uint8[Ff+38]=Zh,this.uint32[Nd+10]=bd,this.int16[dd+22]=Bd,p}}Gv.prototype.bytesPerElement=48,tp("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gv);class Ey extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh,Zh,bd,Bd,dd,Nd,Ff,Bf,Ap,Bp,wp,yp,cp,Ep){const gp=this.length;return this.resize(gp+1),this.emplace(gp,p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh,Zh,bd,Bd,dd,Nd,Ff,Bf,Ap,Bp,wp,yp,cp,Ep)}emplace(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh,Zh,bd,Bd,dd,Nd,Ff,Bf,Ap,Bp,wp,yp,cp,Ep,gp){const Qf=34*p,Gp=17*p;return this.int16[Qf+0]=S,this.int16[Qf+1]=j,this.int16[Qf+2]=ut,this.int16[Qf+3]=Ot,this.int16[Qf+4]=fi,this.int16[Qf+5]=Bn,this.int16[Qf+6]=us,this.int16[Qf+7]=ul,this.uint16[Qf+8]=Ju,this.uint16[Qf+9]=oh,this.uint16[Qf+10]=gh,this.uint16[Qf+11]=xh,this.uint16[Qf+12]=bh,this.uint16[Qf+13]=Wh,this.uint16[Qf+14]=Zh,this.uint16[Qf+15]=bd,this.uint16[Qf+16]=Bd,this.uint16[Qf+17]=dd,this.uint16[Qf+18]=Nd,this.uint16[Qf+19]=Ff,this.uint16[Qf+20]=Bf,this.uint16[Qf+21]=Ap,this.uint16[Qf+22]=Bp,this.uint32[Gp+12]=wp,this.float32[Gp+13]=yp,this.float32[Gp+14]=cp,this.float32[Gp+15]=Ep,this.float32[Gp+16]=gp,p}}Ey.prototype.bytesPerElement=68,tp("StructArrayLayout8i15ui1ul4f68",Ey);class lv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p){const S=this.length;return this.resize(S+1),this.emplace(S,p)}emplace(p,S){return this.float32[1*p+0]=S,p}}lv.prototype.bytesPerElement=4,tp("StructArrayLayout1f4",lv);class E0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=4*p;return this.uint32[2*p+0]=S,this.uint16[Ot+2]=j,this.uint16[Ot+3]=ut,p}}E0.prototype.bytesPerElement=8,tp("StructArrayLayout1ul2ui8",E0);class cv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S){const j=this.length;return this.resize(j+1),this.emplace(j,p,S)}emplace(p,S,j){const ut=2*p;return this.uint16[ut+0]=S,this.uint16[ut+1]=j,p}}cv.prototype.bytesPerElement=4,tp("StructArrayLayout2ui4",cv);class T0 extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p){const S=this.length;return this.resize(S+1),this.emplace(S,p)}emplace(p,S){return this.uint16[1*p+0]=S,p}}T0.prototype.bytesPerElement=2,tp("StructArrayLayout1ui2",T0);class jv extends pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,p,S,j,ut)}emplace(p,S,j,ut,Ot){const fi=4*p;return this.float32[fi+0]=S,this.float32[fi+1]=j,this.float32[fi+2]=ut,this.float32[fi+3]=Ot,p}}jv.prototype.bytesPerElement=16,tp("StructArrayLayout4f16",jv);class c1 extends Wy{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ud(this.anchorPointX,this.anchorPointY)}}c1.prototype.size=20;class Iv extends Uv{get(p){return new c1(this,p)}}tp("CollisionBoxArray",Iv);class Cv extends Wy{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(p){this._structArray.uint8[this._pos1+37]=p}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(p){this._structArray.uint8[this._pos1+38]=p}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(p){this._structArray.uint32[this._pos4+10]=p}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Cv.prototype.size=48;class uv extends Gv{get(p){return new Cv(this,p)}}tp("PlacedSymbolArray",uv);class zg extends Wy{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(p){this._structArray.uint32[this._pos4+12]=p}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}zg.prototype.size=68;class R1 extends Ey{get(p){return new zg(this,p)}}tp("SymbolInstanceArray",R1);class S0 extends lv{getoffsetX(p){return this.float32[1*p+0]}}tp("GlyphOffsetArray",S0);class Mv extends x0{getx(p){return this.int16[3*p+0]}gety(p){return this.int16[3*p+1]}gettileUnitDistanceFromAnchor(p){return this.int16[3*p+2]}}tp("SymbolLineVertexArray",Mv);class U0 extends Wy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}U0.prototype.size=8;class Ty extends E0{get(p){return new U0(this,p)}}tp("FeatureIndexArray",Ty);class qv extends v0{}class Sy extends v0{}class Iy extends v0{}class Zv extends Lg{}class Ip extends b0{}class O1 extends Tv{}class K_ extends Fv{}class he extends av{}class g extends sv{}class A extends z0{}class q extends w0{}class nt extends Vv{}class Ft extends F0{}class Xr extends cv{}const ls=mg([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zs}=ls;class ol{constructor(p=[]){this.segments=p}prepareSegment(p,S,j,ut){let Ot=this.segments[this.segments.length-1];return p>ol.MAX_VERTEX_ARRAY_LENGTH&&$s(`Max vertices per segment is ${ol.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${p}`),(!Ot||Ot.vertexLength+p>ol.MAX_VERTEX_ARRAY_LENGTH||Ot.sortKey!==ut)&&(Ot={vertexOffset:S.length,primitiveOffset:j.length,vertexLength:0,primitiveLength:0},ut!==void 0&&(Ot.sortKey=ut),this.segments.push(Ot)),Ot}get(){return this.segments}destroy(){for(const p of this.segments)for(const S in p.vaos)p.vaos[S].destroy()}static simpleSegment(p,S,j,ut){return new ol([{vertexOffset:p,primitiveOffset:S,vertexLength:j,primitiveLength:ut,vaos:{},sortKey:0}])}}function rh(_,p){return 256*(_=ze(Math.floor(_),0,255))+ze(Math.floor(p),0,255)}ol.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tp("SegmentVector",ol);const th=mg([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ph={},Dh={get exports(){return ph},set exports(_){ph=_}},$h={};({get exports(){return $h},set exports(_){$h=_}}).exports=function(_,p){var S,j,ut,Ot,fi,Bn,us,ul;for(j=_.length-(S=3&_.length),ut=p,fi=3432918353,Bn=461845907,ul=0;ul<j;)us=255&_.charCodeAt(ul)|(255&_.charCodeAt(++ul))<<8|(255&_.charCodeAt(++ul))<<16|(255&_.charCodeAt(++ul))<<24,++ul,ut=27492+(65535&(Ot=5*(65535&(ut=(ut^=us=(65535&(us=(us=(65535&us)*fi+(((us>>>16)*fi&65535)<<16)&4294967295)<<15|us>>>17))*Bn+(((us>>>16)*Bn&65535)<<16)&4294967295)<<13|ut>>>19))+((5*(ut>>>16)&65535)<<16)&4294967295))+((58964+(Ot>>>16)&65535)<<16);switch(us=0,S){case 3:us^=(255&_.charCodeAt(ul+2))<<16;case 2:us^=(255&_.charCodeAt(ul+1))<<8;case 1:ut^=us=(65535&(us=(us=(65535&(us^=255&_.charCodeAt(ul)))*fi+(((us>>>16)*fi&65535)<<16)&4294967295)<<15|us>>>17))*Bn+(((us>>>16)*Bn&65535)<<16)&4294967295}return ut^=_.length,ut=2246822507*(65535&(ut^=ut>>>16))+((2246822507*(ut>>>16)&65535)<<16)&4294967295,ut=3266489909*(65535&(ut^=ut>>>13))+((3266489909*(ut>>>16)&65535)<<16)&4294967295,(ut^=ut>>>16)>>>0};var Mh={};({get exports(){return Mh},set exports(_){Mh=_}}).exports=function(_,p){for(var S,j=_.length,ut=p^j,Ot=0;j>=4;)S=1540483477*(65535&(S=255&_.charCodeAt(Ot)|(255&_.charCodeAt(++Ot))<<8|(255&_.charCodeAt(++Ot))<<16|(255&_.charCodeAt(++Ot))<<24))+((1540483477*(S>>>16)&65535)<<16),ut=1540483477*(65535&ut)+((1540483477*(ut>>>16)&65535)<<16)^(S=1540483477*(65535&(S^=S>>>24))+((1540483477*(S>>>16)&65535)<<16)),j-=4,++Ot;switch(j){case 3:ut^=(255&_.charCodeAt(Ot+2))<<16;case 2:ut^=(255&_.charCodeAt(Ot+1))<<8;case 1:ut=1540483477*(65535&(ut^=255&_.charCodeAt(Ot)))+((1540483477*(ut>>>16)&65535)<<16)}return ut=1540483477*(65535&(ut^=ut>>>13))+((1540483477*(ut>>>16)&65535)<<16),(ut^=ut>>>15)>>>0};var Kh=$h,fd=Mh;Dh.exports=Kh,ph.murmur3=Kh,ph.murmur2=fd;class cd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(p,S,j,ut){this.ids.push(jh(p)),this.positions.push(S,j,ut)}getPositions(p){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const S=jh(p);let j=0,ut=this.ids.length-1;for(;j<ut;){const fi=j+ut>>1;this.ids[fi]>=S?ut=fi:j=fi+1}const Ot=[];for(;this.ids[j]===S;)Ot.push({index:this.positions[3*j],start:this.positions[3*j+1],end:this.positions[3*j+2]}),j++;return Ot}static serialize(p,S){const j=new Float64Array(p.ids),ut=new Uint32Array(p.positions);return Td(j,ut,0,j.length-1),S&&S.push(j.buffer,ut.buffer),{ids:j,positions:ut}}static deserialize(p){const S=new cd;return S.ids=p.ids,S.positions=p.positions,S.indexed=!0,S}}function jh(_){const p=+_;return!isNaN(p)&&p<=Number.MAX_SAFE_INTEGER?p:ph(String(_))}function Td(_,p,S,j){for(;S<j;){const ut=_[S+j>>1];let Ot=S-1,fi=j+1;for(;;){do Ot++;while(_[Ot]<ut);do fi--;while(_[fi]>ut);if(Ot>=fi)break;Vd(_,Ot,fi),Vd(p,3*Ot,3*fi),Vd(p,3*Ot+1,3*fi+1),Vd(p,3*Ot+2,3*fi+2)}fi-S<j-fi?(Td(_,p,S,fi),S=fi+1):(Td(_,p,fi+1,j),j=fi)}}function Vd(_,p,S){const j=_[p];_[p]=_[S],_[S]=j}tp("FeaturePositionMap",cd);class Wd{constructor(p,S){this.gl=p.gl,this.location=S}}class Mf extends Wd{constructor(p,S){super(p,S),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class Of extends Wd{constructor(p,S){super(p,S),this.current=[0,0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))}}class L extends Wd{constructor(p,S){super(p,S),this.current=hp.transparent}set(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))}}const u=new Float32Array(16);function E(_){return[rh(255*_.r,255*_.g),rh(255*_.b,255*_.a)]}class B{constructor(p,S,j){this.value=p,this.uniformNames=S.map(ut=>`u_${ut}`),this.type=j}setUniform(p,S,j){p.set(j.constantOr(this.value))}getBinding(p,S,j){return this.type==="color"?new L(p,S):new Mf(p,S)}}class _e{constructor(p,S){this.uniformNames=S.map(j=>`u_${j}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(p,S){this.pixelRatioFrom=S.pixelRatio,this.pixelRatioTo=p.pixelRatio,this.patternFrom=S.tlbr,this.patternTo=p.tlbr}setUniform(p,S,j,ut){const Ot=ut==="u_pattern_to"?this.patternTo:ut==="u_pattern_from"?this.patternFrom:ut==="u_pixel_ratio_to"?this.pixelRatioTo:ut==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Ot&&p.set(Ot)}getBinding(p,S,j){return j.substr(0,9)==="u_pattern"?new Of(p,S):new Mf(p,S)}}class St{constructor(p,S,j,ut){this.expression=p,this.type=j,this.maxValue=0,this.paintVertexAttributes=S.map(Ot=>({name:`a_${Ot}`,type:"Float32",components:j==="color"?2:1,offset:0})),this.paintVertexArray=new ut}populatePaintArray(p,S,j,ut,Ot){const fi=this.paintVertexArray.length,Bn=this.expression.evaluate(new Cm(0),S,{},ut,[],Ot);this.paintVertexArray.resize(p),this._setPaintValue(fi,p,Bn)}updatePaintArray(p,S,j,ut){const Ot=this.expression.evaluate({zoom:0},j,ut);this._setPaintValue(p,S,Ot)}_setPaintValue(p,S,j){if(this.type==="color"){const ut=E(j);for(let Ot=p;Ot<S;Ot++)this.paintVertexArray.emplace(Ot,ut[0],ut[1])}else{for(let ut=p;ut<S;ut++)this.paintVertexArray.emplace(ut,j);this.maxValue=Math.max(this.maxValue,Math.abs(j))}}upload(p){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=p.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mr{constructor(p,S,j,ut,Ot,fi){this.expression=p,this.uniformNames=S.map(Bn=>`u_${Bn}_t`),this.type=j,this.useIntegerZoom=ut,this.zoom=Ot,this.maxValue=0,this.paintVertexAttributes=S.map(Bn=>({name:`a_${Bn}`,type:"Float32",components:j==="color"?4:2,offset:0})),this.paintVertexArray=new fi}populatePaintArray(p,S,j,ut,Ot){const fi=this.expression.evaluate(new Cm(this.zoom),S,{},ut,[],Ot),Bn=this.expression.evaluate(new Cm(this.zoom+1),S,{},ut,[],Ot),us=this.paintVertexArray.length;this.paintVertexArray.resize(p),this._setPaintValue(us,p,fi,Bn)}updatePaintArray(p,S,j,ut){const Ot=this.expression.evaluate({zoom:this.zoom},j,ut),fi=this.expression.evaluate({zoom:this.zoom+1},j,ut);this._setPaintValue(p,S,Ot,fi)}_setPaintValue(p,S,j,ut){if(this.type==="color"){const Ot=E(j),fi=E(ut);for(let Bn=p;Bn<S;Bn++)this.paintVertexArray.emplace(Bn,Ot[0],Ot[1],fi[0],fi[1])}else{for(let Ot=p;Ot<S;Ot++)this.paintVertexArray.emplace(Ot,j,ut);this.maxValue=Math.max(this.maxValue,Math.abs(j),Math.abs(ut))}}upload(p){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=p.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(p,S){const j=this.useIntegerZoom?Math.floor(S.zoom):S.zoom,ut=ze(this.expression.interpolationFactor(j,this.zoom,this.zoom+1),0,1);p.set(ut)}getBinding(p,S,j){return new Mf(p,S)}}class qr{constructor(p,S,j,ut,Ot,fi){this.expression=p,this.type=S,this.useIntegerZoom=j,this.zoom=ut,this.layerId=fi,this.zoomInPaintVertexArray=new Ot,this.zoomOutPaintVertexArray=new Ot}populatePaintArray(p,S,j){const ut=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(p),this.zoomOutPaintVertexArray.resize(p),this._setPaintValues(ut,p,S.patterns&&S.patterns[this.layerId],j)}updatePaintArray(p,S,j,ut,Ot){this._setPaintValues(p,S,j.patterns&&j.patterns[this.layerId],Ot)}_setPaintValues(p,S,j,ut){if(!ut||!j)return;const{min:Ot,mid:fi,max:Bn}=j,us=ut[Ot],ul=ut[fi],Ju=ut[Bn];if(us&&ul&&Ju)for(let oh=p;oh<S;oh++)this.zoomInPaintVertexArray.emplace(oh,ul.tl[0],ul.tl[1],ul.br[0],ul.br[1],us.tl[0],us.tl[1],us.br[0],us.br[1],ul.pixelRatio,us.pixelRatio),this.zoomOutPaintVertexArray.emplace(oh,ul.tl[0],ul.tl[1],ul.br[0],ul.br[1],Ju.tl[0],Ju.tl[1],Ju.br[0],Ju.br[1],ul.pixelRatio,Ju.pixelRatio)}upload(p){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=p.createVertexBuffer(this.zoomInPaintVertexArray,th.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=p.createVertexBuffer(this.zoomOutPaintVertexArray,th.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ss{constructor(p,S,j){this.binders={},this._buffers=[];const ut=[];for(const Ot in p.paint._values){if(!j(Ot))continue;const fi=p.paint.get(Ot);if(!(fi instanceof e_&&j_(fi.property.specification)))continue;const Bn=il(Ot,p.type),us=fi.value,ul=fi.property.specification.type,Ju=fi.property.useIntegerZoom,oh=fi.property.specification["property-type"],gh=oh==="cross-faded"||oh==="cross-faded-data-driven";if(us.kind==="constant")this.binders[Ot]=gh?new _e(us.value,Bn):new B(us.value,Bn,ul),ut.push(`/u_${Ot}`);else if(us.kind==="source"||gh){const xh=Qu(Ot,ul,"source");this.binders[Ot]=gh?new qr(us,ul,Ju,S,xh,p.id):new St(us,Bn,ul,xh),ut.push(`/a_${Ot}`)}else{const xh=Qu(Ot,ul,"composite");this.binders[Ot]=new mr(us,Bn,ul,Ju,S,xh),ut.push(`/z_${Ot}`)}}this.cacheKey=ut.sort().join("")}getMaxValue(p){const S=this.binders[p];return S instanceof St||S instanceof mr?S.maxValue:0}populatePaintArrays(p,S,j,ut,Ot){for(const fi in this.binders){const Bn=this.binders[fi];(Bn instanceof St||Bn instanceof mr||Bn instanceof qr)&&Bn.populatePaintArray(p,S,j,ut,Ot)}}setConstantPatternPositions(p,S){for(const j in this.binders){const ut=this.binders[j];ut instanceof _e&&ut.setConstantPatternPositions(p,S)}}updatePaintArrays(p,S,j,ut,Ot){let fi=!1;for(const Bn in p){const us=S.getPositions(Bn);for(const ul of us){const Ju=j.feature(ul.index);for(const oh in this.binders){const gh=this.binders[oh];if((gh instanceof St||gh instanceof mr||gh instanceof qr)&&gh.expression.isStateDependent===!0){const xh=ut.paint.get(oh);gh.expression=xh.value,gh.updatePaintArray(ul.start,ul.end,Ju,p[Bn],Ot),fi=!0}}}}return fi}defines(){const p=[];for(const S in this.binders){const j=this.binders[S];(j instanceof B||j instanceof _e)&&p.push(...j.uniformNames.map(ut=>`#define HAS_UNIFORM_${ut}`))}return p}getBinderAttributes(){const p=[];for(const S in this.binders){const j=this.binders[S];if(j instanceof St||j instanceof mr)for(let ut=0;ut<j.paintVertexAttributes.length;ut++)p.push(j.paintVertexAttributes[ut].name);else if(j instanceof qr)for(let ut=0;ut<th.members.length;ut++)p.push(th.members[ut].name)}return p}getBinderUniforms(){const p=[];for(const S in this.binders){const j=this.binders[S];if(j instanceof B||j instanceof _e||j instanceof mr)for(const ut of j.uniformNames)p.push(ut)}return p}getPaintVertexBuffers(){return this._buffers}getUniforms(p,S){const j=[];for(const ut in this.binders){const Ot=this.binders[ut];if(Ot instanceof B||Ot instanceof _e||Ot instanceof mr){for(const fi of Ot.uniformNames)if(S[fi]){const Bn=Ot.getBinding(p,S[fi],fi);j.push({name:fi,property:ut,binding:Bn})}}}return j}setUniforms(p,S,j,ut){for(const{name:Ot,property:fi,binding:Bn}of S)this.binders[fi].setUniform(Bn,ut,j.get(fi),Ot)}updatePaintBuffers(p){this._buffers=[];for(const S in this.binders){const j=this.binders[S];if(p&&j instanceof qr){const ut=p.fromScale===2?j.zoomInPaintVertexBuffer:j.zoomOutPaintVertexBuffer;ut&&this._buffers.push(ut)}else(j instanceof St||j instanceof mr)&&j.paintVertexBuffer&&this._buffers.push(j.paintVertexBuffer)}}upload(p){for(const S in this.binders){const j=this.binders[S];(j instanceof St||j instanceof mr||j instanceof qr)&&j.upload(p)}this.updatePaintBuffers()}destroy(){for(const p in this.binders){const S=this.binders[p];(S instanceof St||S instanceof mr||S instanceof qr)&&S.destroy()}}}class tl{constructor(p,S,j=()=>!0){this.programConfigurations={};for(const ut of p)this.programConfigurations[ut.id]=new ss(ut,S,j);this.needsUpload=!1,this._featureMap=new cd,this._bufferOffset=0}populatePaintArrays(p,S,j,ut,Ot,fi){for(const Bn in this.programConfigurations)this.programConfigurations[Bn].populatePaintArrays(p,S,ut,Ot,fi);S.id!==void 0&&this._featureMap.add(S.id,j,this._bufferOffset,p),this._bufferOffset=p,this.needsUpload=!0}updatePaintArrays(p,S,j,ut){for(const Ot of j)this.needsUpload=this.programConfigurations[Ot.id].updatePaintArrays(p,this._featureMap,S,Ot,ut)||this.needsUpload}get(p){return this.programConfigurations[p]}upload(p){if(this.needsUpload){for(const S in this.programConfigurations)this.programConfigurations[S].upload(p);this.needsUpload=!1}}destroy(){for(const p in this.programConfigurations)this.programConfigurations[p].destroy()}}function il(_,p){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[_]||[_.replace(`${p}-`,"").replace(/-/g,"_")]}function Qu(_,p,S){const j={color:{source:Tv,composite:jv},number:{source:lv,composite:Tv}},ut=function(Ot){return{"line-pattern":{source:K_,composite:K_},"fill-pattern":{source:K_,composite:K_},"fill-extrusion-pattern":{source:K_,composite:K_}}[Ot]}(_);return ut&&ut[S]||j[p][S]}tp("ConstantBinder",B),tp("CrossFadedConstantBinder",_e),tp("SourceExpressionBinder",St),tp("CrossFadedCompositeBinder",qr),tp("CompositeExpressionBinder",mr),tp("ProgramConfiguration",ss,{omit:["_buffers"]}),tp("ProgramConfigurationSet",tl);var fh=8192;const wh=Math.pow(2,14)-1,Sh=-wh-1;function Th(_){const p=fh/_.extent,S=_.loadGeometry();for(let j=0;j<S.length;j++){const ut=S[j];for(let Ot=0;Ot<ut.length;Ot++){const fi=ut[Ot],Bn=Math.round(fi.x*p),us=Math.round(fi.y*p);fi.x=ze(Bn,Sh,wh),fi.y=ze(us,Sh,wh),(Bn<fi.x||Bn>fi.x+1||us<fi.y||us>fi.y+1)&&$s("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return S}function Ch(_,p){return{type:_.type,id:_.id,properties:_.properties,geometry:p?Th(_):[]}}function hh(_,p,S,j,ut){_.emplaceBack(2*p+(j+1)/2,2*S+(ut+1)/2)}class Oh{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.layoutVertexArray=new Sy,this.indexArray=new Ft,this.segments=new ol,this.programConfigurations=new tl(p.layers,p.zoom),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){const ut=this.layers[0],Ot=[];let fi=null,Bn=!1;ut.type==="circle"&&(fi=ut.layout.get("circle-sort-key"),Bn=!fi.isConstant());for(const{feature:us,id:ul,index:Ju,sourceLayerIndex:oh}of p){const gh=this.layers[0]._featureFilter.needGeometry,xh=Ch(us,gh);if(!this.layers[0]._featureFilter.filter(new Cm(this.zoom),xh,j))continue;const bh=Bn?fi.evaluate(xh,{},j):void 0,Wh={id:ul,properties:us.properties,type:us.type,sourceLayerIndex:oh,index:Ju,geometry:gh?xh.geometry:Th(us),patterns:{},sortKey:bh};Ot.push(Wh)}Bn&&Ot.sort((us,ul)=>us.sortKey-ul.sortKey);for(const us of Ot){const{geometry:ul,index:Ju,sourceLayerIndex:oh}=us,gh=p[Ju].feature;this.addFeature(us,ul,Ju,j),S.featureIndex.insert(gh,ul,Ju,oh,this.index)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,Zs),this.indexBuffer=p.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(p,S,j,ut){for(const Ot of S)for(const fi of Ot){const Bn=fi.x,us=fi.y;if(Bn<0||Bn>=fh||us<0||us>=fh)continue;const ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,p.sortKey),Ju=ul.vertexLength;hh(this.layoutVertexArray,Bn,us,-1,-1),hh(this.layoutVertexArray,Bn,us,1,-1),hh(this.layoutVertexArray,Bn,us,1,1),hh(this.layoutVertexArray,Bn,us,-1,1),this.indexArray.emplaceBack(Ju,Ju+1,Ju+2),this.indexArray.emplaceBack(Ju,Ju+3,Ju+2),ul.vertexLength+=4,ul.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,{},ut)}}function Rh(_,p){for(let S=0;S<_.length;S++)if(_d(p,_[S]))return!0;for(let S=0;S<p.length;S++)if(_d(_,p[S]))return!0;return!!Hh(_,p)}function Nh(_,p,S){return!!_d(_,p)||!!xd(p,_,S)}function qh(_,p){if(_.length===1)return Vf(p,_[0]);for(let S=0;S<p.length;S++){const j=p[S];for(let ut=0;ut<j.length;ut++)if(_d(_,j[ut]))return!0}for(let S=0;S<_.length;S++)if(Vf(p,_[S]))return!0;for(let S=0;S<p.length;S++)if(Hh(_,p[S]))return!0;return!1}function Fh(_,p,S){if(_.length>1){if(Hh(_,p))return!0;for(let j=0;j<p.length;j++)if(xd(p[j],_,S))return!0}for(let j=0;j<_.length;j++)if(xd(_[j],p,S))return!0;return!1}function Hh(_,p){if(_.length===0||p.length===0)return!1;for(let S=0;S<_.length-1;S++){const j=_[S],ut=_[S+1];for(let Ot=0;Ot<p.length-1;Ot++)if(ld(j,ut,p[Ot],p[Ot+1]))return!0}return!1}function ld(_,p,S,j){return ah(_,S,j)!==ah(p,S,j)&&ah(_,p,S)!==ah(_,p,j)}function xd(_,p,S){const j=S*S;if(p.length===1)return _.distSqr(p[0])<j;for(let ut=1;ut<p.length;ut++)if(gd(_,p[ut-1],p[ut])<j)return!0;return!1}function gd(_,p,S){const j=p.distSqr(S);if(j===0)return _.distSqr(p);const ut=((_.x-p.x)*(S.x-p.x)+(_.y-p.y)*(S.y-p.y))/j;return _.distSqr(ut<0?p:ut>1?S:S.sub(p)._mult(ut)._add(p))}function Vf(_,p){let S,j,ut,Ot=!1;for(let fi=0;fi<_.length;fi++){S=_[fi];for(let Bn=0,us=S.length-1;Bn<S.length;us=Bn++)j=S[Bn],ut=S[us],j.y>p.y!=ut.y>p.y&&p.x<(ut.x-j.x)*(p.y-j.y)/(ut.y-j.y)+j.x&&(Ot=!Ot)}return Ot}function _d(_,p){let S=!1;for(let j=0,ut=_.length-1;j<_.length;ut=j++){const Ot=_[j],fi=_[ut];Ot.y>p.y!=fi.y>p.y&&p.x<(fi.x-Ot.x)*(p.y-Ot.y)/(fi.y-Ot.y)+Ot.x&&(S=!S)}return S}function Cf(_,p,S){const j=S[0],ut=S[2];if(_.x<j.x&&p.x<j.x||_.x>ut.x&&p.x>ut.x||_.y<j.y&&p.y<j.y||_.y>ut.y&&p.y>ut.y)return!1;const Ot=ah(_,p,S[0]);return Ot!==ah(_,p,S[1])||Ot!==ah(_,p,S[2])||Ot!==ah(_,p,S[3])}function Ud(_,p,S){const j=p.paint.get(_).value;return j.kind==="constant"?j.value:S.programConfigurations.get(p.id).getMaxValue(_)}function Lf(_){return Math.sqrt(_[0]*_[0]+_[1]*_[1])}function Cd(_,p,S,j,ut){if(!p[0]&&!p[1])return _;const Ot=ud.convert(p)._mult(ut);S==="viewport"&&Ot._rotate(-j);const fi=[];for(let Bn=0;Bn<_.length;Bn++)fi.push(_[Bn].sub(Ot));return fi}tp("CircleBucket",Oh,{omit:["layers"]});const pd=new tg({"circle-sort-key":new Up(td.layout_circle["circle-sort-key"])});var $d={paint:new tg({"circle-radius":new Up(td.paint_circle["circle-radius"]),"circle-color":new Up(td.paint_circle["circle-color"]),"circle-blur":new Up(td.paint_circle["circle-blur"]),"circle-opacity":new Up(td.paint_circle["circle-opacity"]),"circle-translate":new kp(td.paint_circle["circle-translate"]),"circle-translate-anchor":new kp(td.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kp(td.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kp(td.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Up(td.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Up(td.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Up(td.paint_circle["circle-stroke-opacity"])}),layout:pd},yf=1e-6,$f=typeof Float32Array<"u"?Float32Array:Array;function Dp(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function nm(_,p,S){var j=p[0],ut=p[1],Ot=p[2],fi=p[3],Bn=p[4],us=p[5],ul=p[6],Ju=p[7],oh=p[8],gh=p[9],xh=p[10],bh=p[11],Wh=p[12],Zh=p[13],bd=p[14],Bd=p[15],dd=S[0],Nd=S[1],Ff=S[2],Bf=S[3];return _[0]=dd*j+Nd*Bn+Ff*oh+Bf*Wh,_[1]=dd*ut+Nd*us+Ff*gh+Bf*Zh,_[2]=dd*Ot+Nd*ul+Ff*xh+Bf*bd,_[3]=dd*fi+Nd*Ju+Ff*bh+Bf*Bd,_[4]=(dd=S[4])*j+(Nd=S[5])*Bn+(Ff=S[6])*oh+(Bf=S[7])*Wh,_[5]=dd*ut+Nd*us+Ff*gh+Bf*Zh,_[6]=dd*Ot+Nd*ul+Ff*xh+Bf*bd,_[7]=dd*fi+Nd*Ju+Ff*bh+Bf*Bd,_[8]=(dd=S[8])*j+(Nd=S[9])*Bn+(Ff=S[10])*oh+(Bf=S[11])*Wh,_[9]=dd*ut+Nd*us+Ff*gh+Bf*Zh,_[10]=dd*Ot+Nd*ul+Ff*xh+Bf*bd,_[11]=dd*fi+Nd*Ju+Ff*bh+Bf*Bd,_[12]=(dd=S[12])*j+(Nd=S[13])*Bn+(Ff=S[14])*oh+(Bf=S[15])*Wh,_[13]=dd*ut+Nd*us+Ff*gh+Bf*Zh,_[14]=dd*Ot+Nd*ul+Ff*xh+Bf*bd,_[15]=dd*fi+Nd*Ju+Ff*bh+Bf*Bd,_}Math.hypot||(Math.hypot=function(){for(var _=0,p=arguments.length;p--;)_+=arguments[p]*arguments[p];return Math.sqrt(_)});var Cp,xp=nm;function Lp(_,p,S){var j=p[0],ut=p[1],Ot=p[2],fi=p[3];return _[0]=S[0]*j+S[4]*ut+S[8]*Ot+S[12]*fi,_[1]=S[1]*j+S[5]*ut+S[9]*Ot+S[13]*fi,_[2]=S[2]*j+S[6]*ut+S[10]*Ot+S[14]*fi,_[3]=S[3]*j+S[7]*ut+S[11]*Ot+S[15]*fi,_}function dm(_,p){const S=Lp([],[_.x,_.y,0,1],p);return new ud(S[0]/S[3],S[1]/S[3])}Cp=new $f(4),$f!=Float32Array&&(Cp[0]=0,Cp[1]=0,Cp[2]=0,Cp[3]=0);class zp extends Oh{}tp("HeatmapBucket",zp,{omit:["layers"]});var km={paint:new tg({"heatmap-radius":new Up(td.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Up(td.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kp(td.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pp(td.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kp(td.paint_heatmap["heatmap-opacity"])})};function Am(_,{width:p,height:S},j,ut){if(ut){if(ut instanceof Uint8ClampedArray)ut=new Uint8Array(ut.buffer);else if(ut.length!==p*S*j)throw new RangeError(`mismatched image size. expected: ${ut.length} but got: ${p*S*j}`)}else ut=new Uint8Array(p*S*j);return _.width=p,_.height=S,_.data=ut,_}function jm(_,{width:p,height:S},j){if(p===_.width&&S===_.height)return;const ut=Am({},{width:p,height:S},j);zm(_,ut,{x:0,y:0},{x:0,y:0},{width:Math.min(_.width,p),height:Math.min(_.height,S)},j),_.width=p,_.height=S,_.data=ut.data}function zm(_,p,S,j,ut,Ot){if(ut.width===0||ut.height===0)return p;if(ut.width>_.width||ut.height>_.height||S.x>_.width-ut.width||S.y>_.height-ut.height)throw new RangeError("out of range source coordinates for image copy");if(ut.width>p.width||ut.height>p.height||j.x>p.width-ut.width||j.y>p.height-ut.height)throw new RangeError("out of range destination coordinates for image copy");const fi=_.data,Bn=p.data;if(fi===Bn)throw new Error("srcData equals dstData, so image is already copied");for(let us=0;us<ut.height;us++){const ul=((S.y+us)*_.width+S.x)*Ot,Ju=((j.y+us)*p.width+j.x)*Ot;for(let oh=0;oh<ut.width*Ot;oh++)Bn[Ju+oh]=fi[ul+oh]}return p}class gg{constructor(p,S){Am(this,p,1,S)}resize(p){jm(this,p,1)}clone(){return new gg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(p,S,j,ut,Ot){zm(p,S,j,ut,Ot,1)}}class lg{constructor(p,S){Am(this,p,4,S)}resize(p){jm(this,p,4)}replace(p,S){S?this.data.set(p):this.data=p instanceof Uint8ClampedArray?new Uint8Array(p.buffer):p}clone(){return new lg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(p,S,j,ut,Ot){zm(p,S,j,ut,Ot,4)}}function Cy(_){const p={},S=_.resolution||256,j=_.clips?_.clips.length:1,ut=_.image||new lg({width:S,height:j});if(Math.log(S)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${S}`);const Ot=(fi,Bn,us)=>{p[_.evaluationKey]=us;const ul=_.expression.evaluate(p);ut.data[fi+Bn+0]=Math.floor(255*ul.r/ul.a),ut.data[fi+Bn+1]=Math.floor(255*ul.g/ul.a),ut.data[fi+Bn+2]=Math.floor(255*ul.b/ul.a),ut.data[fi+Bn+3]=Math.floor(255*ul.a)};if(_.clips)for(let fi=0,Bn=0;fi<j;++fi,Bn+=4*S)for(let us=0,ul=0;us<S;us++,ul+=4){const Ju=us/(S-1),{start:oh,end:gh}=_.clips[fi];Ot(Bn,ul,oh*(1-Ju)+gh*Ju)}else for(let fi=0,Bn=0;fi<S;fi++,Bn+=4)Ot(0,Bn,fi/(S-1));return ut}tp("AlphaImage",gg),tp("RGBAImage",lg);var V0={paint:new tg({"hillshade-illumination-direction":new kp(td.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kp(td.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kp(td.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kp(td.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kp(td.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kp(td.paint_hillshade["hillshade-accent-color"])})};const ig=mg([{name:"a_pos",components:2,type:"Int16"}],4),{members:qm}=ig;var _m={};function cg(_,p,S){S=S||2;var j,ut,Ot,fi,Bn,us,ul,Ju=p&&p.length,oh=Ju?p[0]*S:_.length,gh=n_(_,0,oh,S,!0),xh=[];if(!gh||gh.next===gh.prev)return xh;if(Ju&&(gh=function(Wh,Zh,bd,Bd){var dd,Nd,Ff,Bf=[];for(dd=0,Nd=Zh.length;dd<Nd;dd++)(Ff=n_(Wh,Zh[dd]*Bd,dd<Nd-1?Zh[dd+1]*Bd:Wh.length,Bd,!1))===Ff.next&&(Ff.steiner=!0),Bf.push(Xv(Ff));for(Bf.sort(My),dd=0;dd<Bf.length;dd++)bd=G0(Bf[dd],bd);return bd}(_,p,gh,S)),_.length>80*S){j=Ot=_[0],ut=fi=_[1];for(var bh=S;bh<oh;bh+=S)(Bn=_[bh])<j&&(j=Bn),(us=_[bh+1])<ut&&(ut=us),Bn>Ot&&(Ot=Bn),us>fi&&(fi=us);ul=(ul=Math.max(Ot-j,fi-ut))!==0?32767/ul:0}return jg(gh,xh,S,j,ut,ul,0),xh}function n_(_,p,S,j,ut){var Ot,fi;if(ut===gb(_,p,S,j)>0)for(Ot=p;Ot<S;Ot+=j)fi=pb(Ot,_[Ot],_[Ot+1],fi);else for(Ot=S-j;Ot>=p;Ot-=j)fi=pb(Ot,_[Ot],_[Ot+1],fi);return fi&&ax(fi,fi.next)&&(B1(fi),fi=fi.next),fi}function Dm(_,p){if(!_)return _;p||(p=_);var S,j=_;do if(S=!1,j.steiner||!ax(j,j.next)&&Rg(j.prev,j,j.next)!==0)j=j.next;else{if(B1(j),(j=p=j.prev)===j.next)break;S=!0}while(S||j!==p);return p}function jg(_,p,S,j,ut,Ot,fi){if(_){!fi&&Ot&&function(Ju,oh,gh,xh){var bh=Ju;do bh.z===0&&(bh.z=I0(bh.x,bh.y,oh,gh,xh)),bh.prevZ=bh.prev,bh.nextZ=bh.next,bh=bh.next;while(bh!==Ju);bh.prevZ.nextZ=null,bh.prevZ=null,function(Wh){var Zh,bd,Bd,dd,Nd,Ff,Bf,Ap,Bp=1;do{for(bd=Wh,Wh=null,Nd=null,Ff=0;bd;){for(Ff++,Bd=bd,Bf=0,Zh=0;Zh<Bp&&(Bf++,Bd=Bd.nextZ);Zh++);for(Ap=Bp;Bf>0||Ap>0&&Bd;)Bf!==0&&(Ap===0||!Bd||bd.z<=Bd.z)?(dd=bd,bd=bd.nextZ,Bf--):(dd=Bd,Bd=Bd.nextZ,Ap--),Nd?Nd.nextZ=dd:Wh=dd,dd.prevZ=Nd,Nd=dd;bd=Bd}Nd.nextZ=null,Bp*=2}while(Ff>1)}(bh)}(_,j,ut,Ot);for(var Bn,us,ul=_;_.prev!==_.next;)if(Bn=_.prev,us=_.next,Ot?hv(_,j,ut,Ot):y_(_))p.push(Bn.i/S|0),p.push(_.i/S|0),p.push(us.i/S|0),B1(_),_=us.next,ul=us.next;else if((_=us)===ul){fi?fi===1?jg(_=Hv(Dm(_),p,S),p,S,j,ut,Ot,2):fi===2&&uy(_,p,S,j,ut,Ot):jg(Dm(_),p,S,j,ut,Ot,1);break}}}function y_(_){var p=_.prev,S=_,j=_.next;if(Rg(p,S,j)>=0)return!1;for(var ut=p.x,Ot=S.x,fi=j.x,Bn=p.y,us=S.y,ul=j.y,Ju=ut<Ot?ut<fi?ut:fi:Ot<fi?Ot:fi,oh=Bn<us?Bn<ul?Bn:ul:us<ul?us:ul,gh=ut>Ot?ut>fi?ut:fi:Ot>fi?Ot:fi,xh=Bn>us?Bn>ul?Bn:ul:us>ul?us:ul,bh=j.next;bh!==p;){if(bh.x>=Ju&&bh.x<=gh&&bh.y>=oh&&bh.y<=xh&&u1(ut,Bn,Ot,us,fi,ul,bh.x,bh.y)&&Rg(bh.prev,bh,bh.next)>=0)return!1;bh=bh.next}return!0}function hv(_,p,S,j){var ut=_.prev,Ot=_,fi=_.next;if(Rg(ut,Ot,fi)>=0)return!1;for(var Bn=ut.x,us=Ot.x,ul=fi.x,Ju=ut.y,oh=Ot.y,gh=fi.y,xh=Bn<us?Bn<ul?Bn:ul:us<ul?us:ul,bh=Ju<oh?Ju<gh?Ju:gh:oh<gh?oh:gh,Wh=Bn>us?Bn>ul?Bn:ul:us>ul?us:ul,Zh=Ju>oh?Ju>gh?Ju:gh:oh>gh?oh:gh,bd=I0(xh,bh,p,S,j),Bd=I0(Wh,Zh,p,S,j),dd=_.prevZ,Nd=_.nextZ;dd&&dd.z>=bd&&Nd&&Nd.z<=Bd;){if(dd.x>=xh&&dd.x<=Wh&&dd.y>=bh&&dd.y<=Zh&&dd!==ut&&dd!==fi&&u1(Bn,Ju,us,oh,ul,gh,dd.x,dd.y)&&Rg(dd.prev,dd,dd.next)>=0||(dd=dd.prevZ,Nd.x>=xh&&Nd.x<=Wh&&Nd.y>=bh&&Nd.y<=Zh&&Nd!==ut&&Nd!==fi&&u1(Bn,Ju,us,oh,ul,gh,Nd.x,Nd.y)&&Rg(Nd.prev,Nd,Nd.next)>=0))return!1;Nd=Nd.nextZ}for(;dd&&dd.z>=bd;){if(dd.x>=xh&&dd.x<=Wh&&dd.y>=bh&&dd.y<=Zh&&dd!==ut&&dd!==fi&&u1(Bn,Ju,us,oh,ul,gh,dd.x,dd.y)&&Rg(dd.prev,dd,dd.next)>=0)return!1;dd=dd.prevZ}for(;Nd&&Nd.z<=Bd;){if(Nd.x>=xh&&Nd.x<=Wh&&Nd.y>=bh&&Nd.y<=Zh&&Nd!==ut&&Nd!==fi&&u1(Bn,Ju,us,oh,ul,gh,Nd.x,Nd.y)&&Rg(Nd.prev,Nd,Nd.next)>=0)return!1;Nd=Nd.nextZ}return!0}function Hv(_,p,S){var j=_;do{var ut=j.prev,Ot=j.next.next;!ax(ut,Ot)&&db(ut,j,j.next,Ot)&&$1(ut,Ot)&&$1(Ot,ut)&&(p.push(ut.i/S|0),p.push(j.i/S|0),p.push(Ot.i/S|0),B1(j),B1(j.next),j=_=Ot),j=j.next}while(j!==_);return Dm(j)}function uy(_,p,S,j,ut,Ot){var fi=_;do{for(var Bn=fi.next.next;Bn!==fi.prev;){if(fi.i!==Bn.i&&hb(fi,Bn)){var us=fb(fi,Bn);return fi=Dm(fi,fi.next),us=Dm(us,us.next),jg(fi,p,S,j,ut,Ot,0),void jg(us,p,S,j,ut,Ot,0)}Bn=Bn.next}fi=fi.next}while(fi!==_)}function My(_,p){return _.x-p.x}function G0(_,p){var S=function(ut,Ot){var fi,Bn=Ot,us=ut.x,ul=ut.y,Ju=-1/0;do{if(ul<=Bn.y&&ul>=Bn.next.y&&Bn.next.y!==Bn.y){var oh=Bn.x+(ul-Bn.y)*(Bn.next.x-Bn.x)/(Bn.next.y-Bn.y);if(oh<=us&&oh>Ju&&(Ju=oh,fi=Bn.x<Bn.next.x?Bn:Bn.next,oh===us))return fi}Bn=Bn.next}while(Bn!==Ot);if(!fi)return null;var gh,xh=fi,bh=fi.x,Wh=fi.y,Zh=1/0;Bn=fi;do us>=Bn.x&&Bn.x>=bh&&us!==Bn.x&&u1(ul<Wh?us:Ju,ul,bh,Wh,ul<Wh?Ju:us,ul,Bn.x,Bn.y)&&(gh=Math.abs(ul-Bn.y)/(us-Bn.x),$1(Bn,ut)&&(gh<Zh||gh===Zh&&(Bn.x>fi.x||Bn.x===fi.x&&dv(fi,Bn)))&&(fi=Bn,Zh=gh)),Bn=Bn.next;while(Bn!==xh);return fi}(_,p);if(!S)return p;var j=fb(S,_);return Dm(j,j.next),Dm(S,S.next)}function dv(_,p){return Rg(_.prev,_,p.prev)<0&&Rg(p.next,_,_.next)<0}function I0(_,p,S,j,ut){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-S)*ut|0)|_<<8))|_<<4))|_<<2))|_<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-j)*ut|0)|p<<8))|p<<4))|p<<2))|p<<1))<<1}function Xv(_){var p=_,S=_;do(p.x<S.x||p.x===S.x&&p.y<S.y)&&(S=p),p=p.next;while(p!==_);return S}function u1(_,p,S,j,ut,Ot,fi,Bn){return(ut-fi)*(p-Bn)>=(_-fi)*(Ot-Bn)&&(_-fi)*(j-Bn)>=(S-fi)*(p-Bn)&&(S-fi)*(Ot-Bn)>=(ut-fi)*(j-Bn)}function hb(_,p){return _.next.i!==p.i&&_.prev.i!==p.i&&!function(S,j){var ut=S;do{if(ut.i!==S.i&&ut.next.i!==S.i&&ut.i!==j.i&&ut.next.i!==j.i&&db(ut,ut.next,S,j))return!0;ut=ut.next}while(ut!==S);return!1}(_,p)&&($1(_,p)&&$1(p,_)&&function(S,j){var ut=S,Ot=!1,fi=(S.x+j.x)/2,Bn=(S.y+j.y)/2;do ut.y>Bn!=ut.next.y>Bn&&ut.next.y!==ut.y&&fi<(ut.next.x-ut.x)*(Bn-ut.y)/(ut.next.y-ut.y)+ut.x&&(Ot=!Ot),ut=ut.next;while(ut!==S);return Ot}(_,p)&&(Rg(_.prev,_,p.prev)||Rg(_,p.prev,p))||ax(_,p)&&Rg(_.prev,_,_.next)>0&&Rg(p.prev,p,p.next)>0)}function Rg(_,p,S){return(p.y-_.y)*(S.x-p.x)-(p.x-_.x)*(S.y-p.y)}function ax(_,p){return _.x===p.x&&_.y===p.y}function db(_,p,S,j){var ut=lx(Rg(_,p,S)),Ot=lx(Rg(_,p,j)),fi=lx(Rg(S,j,_)),Bn=lx(Rg(S,j,p));return ut!==Ot&&fi!==Bn||!(ut!==0||!sx(_,S,p))||!(Ot!==0||!sx(_,j,p))||!(fi!==0||!sx(S,_,j))||!(Bn!==0||!sx(S,p,j))}function sx(_,p,S){return p.x<=Math.max(_.x,S.x)&&p.x>=Math.min(_.x,S.x)&&p.y<=Math.max(_.y,S.y)&&p.y>=Math.min(_.y,S.y)}function lx(_){return _>0?1:_<0?-1:0}function $1(_,p){return Rg(_.prev,_,_.next)<0?Rg(_,p,_.next)>=0&&Rg(_,_.prev,p)>=0:Rg(_,p,_.prev)<0||Rg(_,_.next,p)<0}function fb(_,p){var S=new mb(_.i,_.x,_.y),j=new mb(p.i,p.x,p.y),ut=_.next,Ot=p.prev;return _.next=p,p.prev=_,S.next=ut,ut.prev=S,j.next=S,S.prev=j,Ot.next=j,j.prev=Ot,j}function pb(_,p,S,j){var ut=new mb(_,p,S);return j?(ut.next=j.next,ut.prev=j,j.next.prev=ut,j.next=ut):(ut.prev=ut,ut.next=ut),ut}function B1(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function mb(_,p,S){this.i=_,this.x=p,this.y=S,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gb(_,p,S,j){for(var ut=0,Ot=p,fi=S-j;Ot<S;Ot+=j)ut+=(_[fi]-_[Ot])*(_[Ot+1]+_[fi+1]),fi=Ot;return ut}function h1(_,p,S,j,ut){tw(_,p,S||0,j||_.length-1,ut||_b)}function tw(_,p,S,j,ut){for(;j>S;){if(j-S>600){var Ot=j-S+1,fi=p-S+1,Bn=Math.log(Ot),us=.5*Math.exp(2*Bn/3),ul=.5*Math.sqrt(Bn*us*(Ot-us)/Ot)*(fi-Ot/2<0?-1:1);tw(_,p,Math.max(S,Math.floor(p-fi*us/Ot+ul)),Math.min(j,Math.floor(p+(Ot-fi)*us/Ot+ul)),ut)}var Ju=_[p],oh=S,gh=j;for(d1(_,S,p),ut(_[j],Ju)>0&&d1(_,S,j);oh<gh;){for(d1(_,oh,gh),oh++,gh--;ut(_[oh],Ju)<0;)oh++;for(;ut(_[gh],Ju)>0;)gh--}ut(_[S],Ju)===0?d1(_,S,gh):d1(_,++gh,j),gh<=p&&(S=gh+1),p<=gh&&(j=gh-1)}}function d1(_,p,S){var j=_[p];_[p]=_[S],_[S]=j}function _b(_,p){return _<p?-1:_>p?1:0}function $x(_,p){const S=_.length;if(S<=1)return[_];const j=[];let ut,Ot;for(let fi=0;fi<S;fi++){const Bn=ch(_[fi]);Bn!==0&&(_[fi].area=Math.abs(Bn),Ot===void 0&&(Ot=Bn<0),Ot===Bn<0?(ut&&j.push(ut),ut=[_[fi]]):ut.push(_[fi]))}if(ut&&j.push(ut),p>1)for(let fi=0;fi<j.length;fi++)j[fi].length<=p||(h1(j[fi],p,1,j[fi].length-1,Kw),j[fi]=j[fi].slice(0,p));return j}function Kw(_,p){return p.area-_.area}function N1(_,p,S){const j=S.patternDependencies;let ut=!1;for(const Ot of p){const fi=Ot.paint.get(`${_}-pattern`);fi.isConstant()||(ut=!0);const Bn=fi.constantOr(null);Bn&&(ut=!0,j[Bn.to]=!0,j[Bn.from]=!0)}return ut}function Bx(_,p,S,j,ut){const Ot=ut.patternDependencies;for(const fi of p){const Bn=fi.paint.get(`${_}-pattern`).value;if(Bn.kind!=="constant"){let us=Bn.evaluate({zoom:j-1},S,{},ut.availableImages),ul=Bn.evaluate({zoom:j},S,{},ut.availableImages),Ju=Bn.evaluate({zoom:j+1},S,{},ut.availableImages);us=us&&us.name?us.name:us,ul=ul&&ul.name?ul.name:ul,Ju=Ju&&Ju.name?Ju.name:Ju,Ot[us]=!0,Ot[ul]=!0,Ot[Ju]=!0,S.patterns[fi.id]={min:us,mid:ul,max:Ju}}}return S}({get exports(){return _m},set exports(_){_m=_}}).exports=cg,_m.default=cg,cg.deviation=function(_,p,S,j){var ut=p&&p.length,Ot=Math.abs(gb(_,0,ut?p[0]*S:_.length,S));if(ut)for(var fi=0,Bn=p.length;fi<Bn;fi++)Ot-=Math.abs(gb(_,p[fi]*S,fi<Bn-1?p[fi+1]*S:_.length,S));var us=0;for(fi=0;fi<j.length;fi+=3){var ul=j[fi]*S,Ju=j[fi+1]*S,oh=j[fi+2]*S;us+=Math.abs((_[ul]-_[oh])*(_[Ju+1]-_[ul+1])-(_[ul]-_[Ju])*(_[oh+1]-_[ul+1]))}return Ot===0&&us===0?0:Math.abs((us-Ot)/Ot)},cg.flatten=function(_){for(var p=_[0][0].length,S={vertices:[],holes:[],dimensions:p},j=0,ut=0;ut<_.length;ut++){for(var Ot=0;Ot<_[ut].length;Ot++)for(var fi=0;fi<p;fi++)S.vertices.push(_[ut][Ot][fi]);ut>0&&S.holes.push(j+=_[ut-1].length)}return S};class cx{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Iy,this.indexArray=new Ft,this.indexArray2=new Xr,this.programConfigurations=new tl(p.layers,p.zoom),this.segments=new ol,this.segments2=new ol,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){this.hasPattern=N1("fill",this.layers,S);const ut=this.layers[0].layout.get("fill-sort-key"),Ot=!ut.isConstant(),fi=[];for(const{feature:Bn,id:us,index:ul,sourceLayerIndex:Ju}of p){const oh=this.layers[0]._featureFilter.needGeometry,gh=Ch(Bn,oh);if(!this.layers[0]._featureFilter.filter(new Cm(this.zoom),gh,j))continue;const xh=Ot?ut.evaluate(gh,{},j,S.availableImages):void 0,bh={id:us,properties:Bn.properties,type:Bn.type,sourceLayerIndex:Ju,index:ul,geometry:oh?gh.geometry:Th(Bn),patterns:{},sortKey:xh};fi.push(bh)}Ot&&fi.sort((Bn,us)=>Bn.sortKey-us.sortKey);for(const Bn of fi){const{geometry:us,index:ul,sourceLayerIndex:Ju}=Bn;if(this.hasPattern){const oh=Bx("fill",this.layers,Bn,this.zoom,S);this.patternFeatures.push(oh)}else this.addFeature(Bn,us,ul,j,{});S.featureIndex.insert(p[ul].feature,us,ul,Ju,this.index)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}addFeatures(p,S,j){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,qm),this.indexBuffer=p.createIndexBuffer(this.indexArray),this.indexBuffer2=p.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(p,S,j,ut,Ot){for(const fi of $x(S,500)){let Bn=0;for(const xh of fi)Bn+=xh.length;const us=this.segments.prepareSegment(Bn,this.layoutVertexArray,this.indexArray),ul=us.vertexLength,Ju=[],oh=[];for(const xh of fi){if(xh.length===0)continue;xh!==fi[0]&&oh.push(Ju.length/2);const bh=this.segments2.prepareSegment(xh.length,this.layoutVertexArray,this.indexArray2),Wh=bh.vertexLength;this.layoutVertexArray.emplaceBack(xh[0].x,xh[0].y),this.indexArray2.emplaceBack(Wh+xh.length-1,Wh),Ju.push(xh[0].x),Ju.push(xh[0].y);for(let Zh=1;Zh<xh.length;Zh++)this.layoutVertexArray.emplaceBack(xh[Zh].x,xh[Zh].y),this.indexArray2.emplaceBack(Wh+Zh-1,Wh+Zh),Ju.push(xh[Zh].x),Ju.push(xh[Zh].y);bh.vertexLength+=xh.length,bh.primitiveLength+=xh.length}const gh=_m(Ju,oh);for(let xh=0;xh<gh.length;xh+=3)this.indexArray.emplaceBack(ul+gh[xh],ul+gh[xh+1],ul+gh[xh+2]);us.vertexLength+=Bn,us.primitiveLength+=gh.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,Ot,ut)}}tp("FillBucket",cx,{omit:["layers","patternFeatures"]});const Nx=new tg({"fill-sort-key":new Up(td.layout_fill["fill-sort-key"])});var Av={paint:new tg({"fill-antialias":new kp(td.paint_fill["fill-antialias"]),"fill-opacity":new Up(td.paint_fill["fill-opacity"]),"fill-color":new Up(td.paint_fill["fill-color"]),"fill-outline-color":new Up(td.paint_fill["fill-outline-color"]),"fill-translate":new kp(td.paint_fill["fill-translate"]),"fill-translate-anchor":new kp(td.paint_fill["fill-translate-anchor"]),"fill-pattern":new by(td.paint_fill["fill-pattern"])}),layout:Nx};const zx=mg([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),iw=mg([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rw}=zx;var Wv={},Qw=ud,nw=Yv;function Yv(_,p,S,j,ut){this.properties={},this.extent=S,this.type=0,this._pbf=_,this._geometry=-1,this._keys=j,this._values=ut,_.readFields(ux,this,p)}function ux(_,p,S){_==1?p.id=S.readVarint():_==2?function(j,ut){for(var Ot=j.readVarint()+j.pos;j.pos<Ot;){var fi=ut._keys[j.readVarint()],Bn=ut._values[j.readVarint()];ut.properties[fi]=Bn}}(S,p):_==3?p.type=S.readVarint():_==4&&(p._geometry=S.pos)}function z1(_){for(var p,S,j=0,ut=0,Ot=_.length,fi=Ot-1;ut<Ot;fi=ut++)j+=((S=_[fi]).x-(p=_[ut]).x)*(p.y+S.y);return j}Yv.types=["Unknown","Point","LineString","Polygon"],Yv.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var p,S=_.readVarint()+_.pos,j=1,ut=0,Ot=0,fi=0,Bn=[];_.pos<S;){if(ut<=0){var us=_.readVarint();j=7&us,ut=us>>3}if(ut--,j===1||j===2)Ot+=_.readSVarint(),fi+=_.readSVarint(),j===1&&(p&&Bn.push(p),p=[]),p.push(new Qw(Ot,fi));else{if(j!==7)throw new Error("unknown command "+j);p&&p.push(p[0].clone())}}return p&&Bn.push(p),Bn},Yv.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var p=_.readVarint()+_.pos,S=1,j=0,ut=0,Ot=0,fi=1/0,Bn=-1/0,us=1/0,ul=-1/0;_.pos<p;){if(j<=0){var Ju=_.readVarint();S=7&Ju,j=Ju>>3}if(j--,S===1||S===2)(ut+=_.readSVarint())<fi&&(fi=ut),ut>Bn&&(Bn=ut),(Ot+=_.readSVarint())<us&&(us=Ot),Ot>ul&&(ul=Ot);else if(S!==7)throw new Error("unknown command "+S)}return[fi,us,Bn,ul]},Yv.prototype.toGeoJSON=function(_,p,S){var j,ut,Ot=this.extent*Math.pow(2,S),fi=this.extent*_,Bn=this.extent*p,us=this.loadGeometry(),ul=Yv.types[this.type];function Ju(xh){for(var bh=0;bh<xh.length;bh++){var Wh=xh[bh];xh[bh]=[360*(Wh.x+fi)/Ot-180,360/Math.PI*Math.atan(Math.exp((180-360*(Wh.y+Bn)/Ot)*Math.PI/180))-90]}}switch(this.type){case 1:var oh=[];for(j=0;j<us.length;j++)oh[j]=us[j][0];Ju(us=oh);break;case 2:for(j=0;j<us.length;j++)Ju(us[j]);break;case 3:for(us=function(xh){var bh=xh.length;if(bh<=1)return[xh];for(var Wh,Zh,bd=[],Bd=0;Bd<bh;Bd++){var dd=z1(xh[Bd]);dd!==0&&(Zh===void 0&&(Zh=dd<0),Zh===dd<0?(Wh&&bd.push(Wh),Wh=[xh[Bd]]):Wh.push(xh[Bd]))}return Wh&&bd.push(Wh),bd}(us),j=0;j<us.length;j++)for(ut=0;ut<us[j].length;ut++)Ju(us[j][ut])}us.length===1?us=us[0]:ul="Multi"+ul;var gh={type:"Feature",geometry:{type:ul,coordinates:us},properties:this.properties};return"id"in this&&(gh.id=this.id),gh};var Pv=nw,C0=kv;function kv(_,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=_,this._keys=[],this._values=[],this._features=[],_.readFields(Kv,this,p),this.length=this._features.length}function Kv(_,p,S){_===15?p.version=S.readVarint():_===1?p.name=S.readString():_===5?p.extent=S.readVarint():_===2?p._features.push(S.pos):_===3?p._keys.push(S.readString()):_===4&&p._values.push(function(j){for(var ut=null,Ot=j.readVarint()+j.pos;j.pos<Ot;){var fi=j.readVarint()>>3;ut=fi===1?j.readString():fi===2?j.readFloat():fi===3?j.readDouble():fi===4?j.readVarint64():fi===5?j.readVarint():fi===6?j.readSVarint():fi===7?j.readBoolean():null}return ut}(S))}kv.prototype.feature=function(_){if(_<0||_>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[_];var p=this._pbf.readVarint()+this._pbf.pos;return new Pv(this._pbf,p,this.extent,this._keys,this._values)};var f1=C0;function Jw(_,p,S){if(_===3){var j=new f1(S,S.readVarint()+S.pos);j.length&&(p[j.name]=j)}}Wv.VectorTile=function(_,p){this.layers=_.readFields(Jw,{},p)},Wv.VectorTileFeature=nw,Wv.VectorTileLayer=C0;const e2=Wv.VectorTileFeature.types,yb=Math.pow(2,13);function hx(_,p,S,j,ut,Ot,fi,Bn){_.emplaceBack(p,S,2*Math.floor(j*yb)+fi,ut*yb*2,Ot*yb*2,Math.round(Bn))}class Fx{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.layoutVertexArray=new Zv,this.centroidVertexArray=new qv,this.indexArray=new Ft,this.programConfigurations=new tl(p.layers,p.zoom),this.segments=new ol,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){this.features=[],this.hasPattern=N1("fill-extrusion",this.layers,S);for(const{feature:ut,id:Ot,index:fi,sourceLayerIndex:Bn}of p){const us=this.layers[0]._featureFilter.needGeometry,ul=Ch(ut,us);if(!this.layers[0]._featureFilter.filter(new Cm(this.zoom),ul,j))continue;const Ju={id:Ot,sourceLayerIndex:Bn,index:fi,geometry:us?ul.geometry:Th(ut),properties:ut.properties,type:ut.type,patterns:{}};this.hasPattern?this.features.push(Bx("fill-extrusion",this.layers,Ju,this.zoom,S)):this.addFeature(Ju,Ju.geometry,fi,j,{}),S.featureIndex.insert(ut,Ju.geometry,fi,Bn,this.index,!0)}}addFeatures(p,S,j){for(const ut of this.features){const{geometry:Ot}=ut;this.addFeature(ut,Ot,ut.index,S,j)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,rw),this.centroidVertexBuffer=p.createVertexBuffer(this.centroidVertexArray,iw.members,!0),this.indexBuffer=p.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(p,S,j,ut,Ot){const fi={x:0,y:0,vertexCount:0};for(const Bn of $x(S,500)){let us=0;for(const bh of Bn)us+=bh.length;let ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const bh of Bn){if(bh.length===0||j0(bh))continue;let Wh=0;for(let Zh=0;Zh<bh.length;Zh++){const bd=bh[Zh];if(Zh>=1){const Bd=bh[Zh-1];if(!Ux(bd,Bd)){ul.vertexLength+4>ol.MAX_VERTEX_ARRAY_LENGTH&&(ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const dd=bd.sub(Bd)._perp()._unit(),Nd=Bd.dist(bd);Wh+Nd>32768&&(Wh=0),hx(this.layoutVertexArray,bd.x,bd.y,dd.x,dd.y,0,0,Wh),hx(this.layoutVertexArray,bd.x,bd.y,dd.x,dd.y,0,1,Wh),fi.x+=2*bd.x,fi.y+=2*bd.y,fi.vertexCount+=2,Wh+=Nd,hx(this.layoutVertexArray,Bd.x,Bd.y,dd.x,dd.y,0,0,Wh),hx(this.layoutVertexArray,Bd.x,Bd.y,dd.x,dd.y,0,1,Wh),fi.x+=2*Bd.x,fi.y+=2*Bd.y,fi.vertexCount+=2;const Ff=ul.vertexLength;this.indexArray.emplaceBack(Ff,Ff+2,Ff+1),this.indexArray.emplaceBack(Ff+1,Ff+2,Ff+3),ul.vertexLength+=4,ul.primitiveLength+=2}}}}if(ul.vertexLength+us>ol.MAX_VERTEX_ARRAY_LENGTH&&(ul=this.segments.prepareSegment(us,this.layoutVertexArray,this.indexArray)),e2[p.type]!=="Polygon")continue;const Ju=[],oh=[],gh=ul.vertexLength;for(const bh of Bn)if(bh.length!==0){bh!==Bn[0]&&oh.push(Ju.length/2);for(let Wh=0;Wh<bh.length;Wh++){const Zh=bh[Wh];hx(this.layoutVertexArray,Zh.x,Zh.y,0,0,1,1,0),fi.x+=Zh.x,fi.y+=Zh.y,fi.vertexCount+=1,Ju.push(Zh.x),Ju.push(Zh.y)}}const xh=_m(Ju,oh);for(let bh=0;bh<xh.length;bh+=3)this.indexArray.emplaceBack(gh+xh[bh],gh+xh[bh+2],gh+xh[bh+1]);ul.primitiveLength+=xh.length/3,ul.vertexLength+=us}for(let Bn=0;Bn<fi.vertexCount;Bn++)this.centroidVertexArray.emplaceBack(Math.floor(fi.x/fi.vertexCount),Math.floor(fi.y/fi.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,Ot,ut)}}function Ux(_,p){return _.x===p.x&&(_.x<0||_.x>fh)||_.y===p.y&&(_.y<0||_.y>fh)}function j0(_){return _.every(p=>p.x<0)||_.every(p=>p.x>fh)||_.every(p=>p.y<0)||_.every(p=>p.y>fh)}tp("FillExtrusionBucket",Fx,{omit:["layers","features"]});var t2={paint:new tg({"fill-extrusion-opacity":new kp(td["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Up(td["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kp(td["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kp(td["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new by(td["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Up(td["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Up(td["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kp(td["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function dx(_,p){return _.x*p.x+_.y*p.y}function Og(_,p){if(_.length===1){let S=0;const j=p[S++];let ut;for(;!ut||j.equals(ut);)if(ut=p[S++],!ut)return 1/0;for(;S<p.length;S++){const Ot=p[S],fi=_[0],Bn=ut.sub(j),us=Ot.sub(j),ul=fi.sub(j),Ju=dx(Bn,Bn),oh=dx(Bn,us),gh=dx(us,us),xh=dx(ul,Bn),bh=dx(ul,us),Wh=Ju*gh-oh*oh,Zh=(gh*xh-oh*bh)/Wh,bd=(Ju*bh-oh*xh)/Wh,Bd=j.z*(1-Zh-bd)+ut.z*Zh+Ot.z*bd;if(isFinite(Bd))return Bd}return 1/0}{let S=1/0;for(const j of p)S=Math.min(S,j.z);return S}}const Hp=mg([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Qv}=Hp,Vx=mg([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ay}=Vx,ow=Wv.VectorTileFeature.types,aw=Math.cos(Math.PI/180*37.5),M0=Math.pow(2,14)/.5;class fx{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(S=>{this.gradients[S.id]={}}),this.layoutVertexArray=new Ip,this.layoutVertexArray2=new O1,this.indexArray=new Ft,this.programConfigurations=new tl(p.layers,p.zoom),this.segments=new ol,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){this.hasPattern=N1("line",this.layers,S);const ut=this.layers[0].layout.get("line-sort-key"),Ot=!ut.isConstant(),fi=[];for(const{feature:Bn,id:us,index:ul,sourceLayerIndex:Ju}of p){const oh=this.layers[0]._featureFilter.needGeometry,gh=Ch(Bn,oh);if(!this.layers[0]._featureFilter.filter(new Cm(this.zoom),gh,j))continue;const xh=Ot?ut.evaluate(gh,{},j):void 0,bh={id:us,properties:Bn.properties,type:Bn.type,sourceLayerIndex:Ju,index:ul,geometry:oh?gh.geometry:Th(Bn),patterns:{},sortKey:xh};fi.push(bh)}Ot&&fi.sort((Bn,us)=>Bn.sortKey-us.sortKey);for(const Bn of fi){const{geometry:us,index:ul,sourceLayerIndex:Ju}=Bn;if(this.hasPattern){const oh=Bx("line",this.layers,Bn,this.zoom,S);this.patternFeatures.push(oh)}else this.addFeature(Bn,us,ul,j,{});S.featureIndex.insert(p[ul].feature,us,ul,Ju,this.index)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}addFeatures(p,S,j){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=p.createVertexBuffer(this.layoutVertexArray2,Ay)),this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,Qv),this.indexBuffer=p.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(p){if(p.properties&&Object.prototype.hasOwnProperty.call(p.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(p.properties,"mapbox_clip_end"))return{start:+p.properties.mapbox_clip_start,end:+p.properties.mapbox_clip_end}}addFeature(p,S,j,ut,Ot){const fi=this.layers[0].layout,Bn=fi.get("line-join").evaluate(p,{}),us=fi.get("line-cap"),ul=fi.get("line-miter-limit"),Ju=fi.get("line-round-limit");this.lineClips=this.lineFeatureClips(p);for(const oh of S)this.addLine(oh,p,Bn,us,ul,Ju);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,Ot,ut)}addLine(p,S,j,ut,Ot,fi){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let bd=0;bd<p.length-1;bd++)this.totalDistance+=p[bd].dist(p[bd+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const Bn=ow[S.type]==="Polygon";let us=p.length;for(;us>=2&&p[us-1].equals(p[us-2]);)us--;let ul=0;for(;ul<us-1&&p[ul].equals(p[ul+1]);)ul++;if(us<(Bn?3:2))return;j==="bevel"&&(Ot=1.05);const Ju=this.overscaling<=16?122880/(512*this.overscaling):0,oh=this.segments.prepareSegment(10*us,this.layoutVertexArray,this.indexArray);let gh,xh,bh,Wh,Zh;this.e1=this.e2=-1,Bn&&(gh=p[us-2],Zh=p[ul].sub(gh)._unit()._perp());for(let bd=ul;bd<us;bd++){if(bh=bd===us-1?Bn?p[ul+1]:void 0:p[bd+1],bh&&p[bd].equals(bh))continue;Zh&&(Wh=Zh),gh&&(xh=gh),gh=p[bd],Zh=bh?bh.sub(gh)._unit()._perp():Wh,Wh=Wh||Zh;let Bd=Wh.add(Zh);Bd.x===0&&Bd.y===0||Bd._unit();const dd=Wh.x*Zh.x+Wh.y*Zh.y,Nd=Bd.x*Zh.x+Bd.y*Zh.y,Ff=Nd!==0?1/Nd:1/0,Bf=2*Math.sqrt(2-2*Nd),Ap=Nd<aw&&xh&&bh,Bp=Wh.x*Zh.y-Wh.y*Zh.x>0;if(Ap&&bd>ul){const cp=gh.dist(xh);if(cp>2*Ju){const Ep=gh.sub(gh.sub(xh)._mult(Ju/cp)._round());this.updateDistance(xh,Ep),this.addCurrentVertex(Ep,Wh,0,0,oh),xh=Ep}}const wp=xh&&bh;let yp=wp?j:Bn?"butt":ut;if(wp&&yp==="round"&&(Ff<fi?yp="miter":Ff<=2&&(yp="fakeround")),yp==="miter"&&Ff>Ot&&(yp="bevel"),yp==="bevel"&&(Ff>2&&(yp="flipbevel"),Ff<Ot&&(yp="miter")),xh&&this.updateDistance(xh,gh),yp==="miter")Bd._mult(Ff),this.addCurrentVertex(gh,Bd,0,0,oh);else if(yp==="flipbevel"){if(Ff>100)Bd=Zh.mult(-1);else{const cp=Ff*Wh.add(Zh).mag()/Wh.sub(Zh).mag();Bd._perp()._mult(cp*(Bp?-1:1))}this.addCurrentVertex(gh,Bd,0,0,oh),this.addCurrentVertex(gh,Bd.mult(-1),0,0,oh)}else if(yp==="bevel"||yp==="fakeround"){const cp=-Math.sqrt(Ff*Ff-1),Ep=Bp?cp:0,gp=Bp?0:cp;if(xh&&this.addCurrentVertex(gh,Wh,Ep,gp,oh),yp==="fakeround"){const Qf=Math.round(180*Bf/Math.PI/20);for(let Gp=1;Gp<Qf;Gp++){let Fp=Gp/Qf;if(Fp!==.5){const ug=Fp-.5;Fp+=Fp*ug*(Fp-1)*((1.0904+dd*(dd*(3.55645-1.43519*dd)-3.2452))*ug*ug+(.848013+dd*(.215638*dd-1.06021)))}const ym=Zh.sub(Wh)._mult(Fp)._add(Wh)._unit()._mult(Bp?-1:1);this.addHalfVertex(gh,ym.x,ym.y,!1,Bp,0,oh)}}bh&&this.addCurrentVertex(gh,Zh,-Ep,-gp,oh)}else if(yp==="butt")this.addCurrentVertex(gh,Bd,0,0,oh);else if(yp==="square"){const cp=xh?1:-1;this.addCurrentVertex(gh,Bd,cp,cp,oh)}else yp==="round"&&(xh&&(this.addCurrentVertex(gh,Wh,0,0,oh),this.addCurrentVertex(gh,Wh,1,1,oh,!0)),bh&&(this.addCurrentVertex(gh,Zh,-1,-1,oh,!0),this.addCurrentVertex(gh,Zh,0,0,oh)));if(Ap&&bd<us-1){const cp=gh.dist(bh);if(cp>2*Ju){const Ep=gh.add(bh.sub(gh)._mult(Ju/cp)._round());this.updateDistance(gh,Ep),this.addCurrentVertex(Ep,Zh,0,0,oh),gh=Ep}}}}addCurrentVertex(p,S,j,ut,Ot,fi=!1){const Bn=S.y*ut-S.x,us=-S.y-S.x*ut;this.addHalfVertex(p,S.x+S.y*j,S.y-S.x*j,fi,!1,j,Ot),this.addHalfVertex(p,Bn,us,fi,!0,-ut,Ot),this.distance>M0/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(p,S,j,ut,Ot,fi))}addHalfVertex({x:p,y:S},j,ut,Ot,fi,Bn,us){const ul=.5*(this.lineClips?this.scaledDistance*(M0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((p<<1)+(Ot?1:0),(S<<1)+(fi?1:0),Math.round(63*j)+128,Math.round(63*ut)+128,1+(Bn===0?0:Bn<0?-1:1)|(63&ul)<<2,ul>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ju=us.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ju),us.primitiveLength++),fi?this.e2=Ju:this.e1=Ju}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(p,S){this.distance+=p.dist(S),this.updateScaledDistance()}}tp("LineBucket",fx,{omit:["layers","patternFeatures"]});const p1=new tg({"line-cap":new kp(td.layout_line["line-cap"]),"line-join":new Up(td.layout_line["line-join"]),"line-miter-limit":new kp(td.layout_line["line-miter-limit"]),"line-round-limit":new kp(td.layout_line["line-round-limit"]),"line-sort-key":new Up(td.layout_line["line-sort-key"])});var F1={paint:new tg({"line-opacity":new Up(td.paint_line["line-opacity"]),"line-color":new Up(td.paint_line["line-color"]),"line-translate":new kp(td.paint_line["line-translate"]),"line-translate-anchor":new kp(td.paint_line["line-translate-anchor"]),"line-width":new Up(td.paint_line["line-width"]),"line-gap-width":new Up(td.paint_line["line-gap-width"]),"line-offset":new Up(td.paint_line["line-offset"]),"line-blur":new Up(td.paint_line["line-blur"]),"line-dasharray":new N0(td.paint_line["line-dasharray"]),"line-pattern":new by(td.paint_line["line-pattern"]),"line-gradient":new pp(td.paint_line["line-gradient"])}),layout:p1};const Jv=new class extends Up{possiblyEvaluate(_,p){return p=new Cm(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),super.possiblyEvaluate(_,p)}evaluate(_,p,S,j){return p=Bt({},p,{zoom:Math.floor(p.zoom)}),super.evaluate(_,p,S,j)}}(F1.paint.properties["line-width"].specification);function jx(_,p){return p>0?p+2*_:_}Jv.useIntegerZoom=!0;const qx=mg([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sw=mg([{name:"a_projected_pos",components:3,type:"Float32"}],4);mg([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lw=mg([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);mg([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uw=mg([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vb=mg([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function hw(_,p,S){return _.sections.forEach(j=>{j.text=function(ut,Ot,fi){const Bn=Ot.layout.get("text-transform").evaluate(fi,{});return Bn==="uppercase"?ut=ut.toLocaleUpperCase():Bn==="lowercase"&&(ut=ut.toLocaleLowerCase()),Ig.applyArabicShaping&&(ut=Ig.applyArabicShaping(ut)),ut}(j.text,p,S)}),_}mg([{name:"triangle",components:3,type:"Uint16"}]),mg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mg([{type:"Float32",name:"offsetX"}]),mg([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Dv={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var $g=24,q0=Om,Zx=function(_,p,S,j,ut){var Ot,fi,Bn=8*ut-j-1,us=(1<<Bn)-1,ul=us>>1,Ju=-7,oh=S?ut-1:0,gh=S?-1:1,xh=_[p+oh];for(oh+=gh,Ot=xh&(1<<-Ju)-1,xh>>=-Ju,Ju+=Bn;Ju>0;Ot=256*Ot+_[p+oh],oh+=gh,Ju-=8);for(fi=Ot&(1<<-Ju)-1,Ot>>=-Ju,Ju+=j;Ju>0;fi=256*fi+_[p+oh],oh+=gh,Ju-=8);if(Ot===0)Ot=1-ul;else{if(Ot===us)return fi?NaN:1/0*(xh?-1:1);fi+=Math.pow(2,j),Ot-=ul}return(xh?-1:1)*fi*Math.pow(2,Ot-j)},xb=function(_,p,S,j,ut,Ot){var fi,Bn,us,ul=8*Ot-ut-1,Ju=(1<<ul)-1,oh=Ju>>1,gh=ut===23?Math.pow(2,-24)-Math.pow(2,-77):0,xh=j?0:Ot-1,bh=j?1:-1,Wh=p<0||p===0&&1/p<0?1:0;for(p=Math.abs(p),isNaN(p)||p===1/0?(Bn=isNaN(p)?1:0,fi=Ju):(fi=Math.floor(Math.log(p)/Math.LN2),p*(us=Math.pow(2,-fi))<1&&(fi--,us*=2),(p+=fi+oh>=1?gh/us:gh*Math.pow(2,1-oh))*us>=2&&(fi++,us/=2),fi+oh>=Ju?(Bn=0,fi=Ju):fi+oh>=1?(Bn=(p*us-1)*Math.pow(2,ut),fi+=oh):(Bn=p*Math.pow(2,oh-1)*Math.pow(2,ut),fi=0));ut>=8;_[S+xh]=255&Bn,xh+=bh,Bn/=256,ut-=8);for(fi=fi<<ut|Bn,ul+=ut;ul>0;_[S+xh]=255&fi,xh+=bh,fi/=256,ul-=8);_[S+xh-bh]|=128*Wh};function Om(_){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(_)?_:new Uint8Array(_||0),this.pos=0,this.type=0,this.length=this.buf.length}Om.Varint=0,Om.Fixed64=1,Om.Bytes=2,Om.Fixed32=5;var A0,hy=4294967296,U1=1/hy,R_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function t_(_){return _.type===Om.Bytes?_.readVarint()+_.pos:_.pos+1}function e1(_,p,S){return S?4294967296*p+(_>>>0):4294967296*(p>>>0)+(_>>>0)}function Cg(_,p,S){var j=p<=16383?1:p<=2097151?2:p<=268435455?3:Math.floor(Math.log(p)/(7*Math.LN2));S.realloc(j);for(var ut=S.pos-1;ut>=_;ut--)S.buf[ut+j]=S.buf[ut]}function dw(_,p){for(var S=0;S<_.length;S++)p.writeVarint(_[S])}function px(_,p){for(var S=0;S<_.length;S++)p.writeSVarint(_[S])}function Z0(_,p){for(var S=0;S<_.length;S++)p.writeFloat(_[S])}function i2(_,p){for(var S=0;S<_.length;S++)p.writeDouble(_[S])}function r2(_,p){for(var S=0;S<_.length;S++)p.writeBoolean(_[S])}function fw(_,p){for(var S=0;S<_.length;S++)p.writeFixed32(_[S])}function pw(_,p){for(var S=0;S<_.length;S++)p.writeSFixed32(_[S])}function m1(_,p){for(var S=0;S<_.length;S++)p.writeFixed64(_[S])}function mw(_,p){for(var S=0;S<_.length;S++)p.writeSFixed64(_[S])}function mx(_,p){return(_[p]|_[p+1]<<8|_[p+2]<<16)+16777216*_[p+3]}function g1(_,p,S){_[S]=p,_[S+1]=p>>>8,_[S+2]=p>>>16,_[S+3]=p>>>24}function bb(_,p){return(_[p]|_[p+1]<<8|_[p+2]<<16)+(_[p+3]<<24)}function n2(_,p,S){_===1&&S.readMessage(o2,p)}function o2(_,p,S){if(_===3){const{id:j,bitmap:ut,width:Ot,height:fi,left:Bn,top:us,advance:ul}=S.readMessage(gw,{});p.push({id:j,bitmap:new gg({width:Ot+6,height:fi+6},ut),metrics:{width:Ot,height:fi,left:Bn,top:us,advance:ul}})}}function gw(_,p,S){_===1?p.id=S.readVarint():_===2?p.bitmap=S.readBytes():_===3?p.width=S.readVarint():_===4?p.height=S.readVarint():_===5?p.left=S.readSVarint():_===6?p.top=S.readSVarint():_===7&&(p.advance=S.readVarint())}function wb(_){let p=0,S=0;for(const fi of _)p+=fi.w*fi.h,S=Math.max(S,fi.w);_.sort((fi,Bn)=>Bn.h-fi.h);const j=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(p/.95)),S),h:1/0}];let ut=0,Ot=0;for(const fi of _)for(let Bn=j.length-1;Bn>=0;Bn--){const us=j[Bn];if(!(fi.w>us.w||fi.h>us.h)){if(fi.x=us.x,fi.y=us.y,Ot=Math.max(Ot,fi.y+fi.h),ut=Math.max(ut,fi.x+fi.w),fi.w===us.w&&fi.h===us.h){const ul=j.pop();Bn<j.length&&(j[Bn]=ul)}else fi.h===us.h?(us.x+=fi.w,us.w-=fi.w):fi.w===us.w?(us.y+=fi.h,us.h-=fi.h):(j.push({x:us.x+fi.w,y:us.y,w:us.w-fi.w,h:fi.h}),us.y+=fi.h,us.h-=fi.h);break}}return{w:ut,h:Ot,fill:p/(ut*Ot)||0}}Om.prototype={destroy:function(){this.buf=null},readFields:function(_,p,S){for(S=S||this.length;this.pos<S;){var j=this.readVarint(),ut=j>>3,Ot=this.pos;this.type=7&j,_(ut,p,this),this.pos===Ot&&this.skip(j)}return p},readMessage:function(_,p){return this.readFields(_,p,this.readVarint()+this.pos)},readFixed32:function(){var _=mx(this.buf,this.pos);return this.pos+=4,_},readSFixed32:function(){var _=bb(this.buf,this.pos);return this.pos+=4,_},readFixed64:function(){var _=mx(this.buf,this.pos)+mx(this.buf,this.pos+4)*hy;return this.pos+=8,_},readSFixed64:function(){var _=mx(this.buf,this.pos)+bb(this.buf,this.pos+4)*hy;return this.pos+=8,_},readFloat:function(){var _=Zx(this.buf,this.pos,!0,23,4);return this.pos+=4,_},readDouble:function(){var _=Zx(this.buf,this.pos,!0,52,8);return this.pos+=8,_},readVarint:function(_){var p,S,j=this.buf;return p=127&(S=j[this.pos++]),S<128?p:(p|=(127&(S=j[this.pos++]))<<7,S<128?p:(p|=(127&(S=j[this.pos++]))<<14,S<128?p:(p|=(127&(S=j[this.pos++]))<<21,S<128?p:function(ut,Ot,fi){var Bn,us,ul=fi.buf;if(Bn=(112&(us=ul[fi.pos++]))>>4,us<128||(Bn|=(127&(us=ul[fi.pos++]))<<3,us<128)||(Bn|=(127&(us=ul[fi.pos++]))<<10,us<128)||(Bn|=(127&(us=ul[fi.pos++]))<<17,us<128)||(Bn|=(127&(us=ul[fi.pos++]))<<24,us<128)||(Bn|=(1&(us=ul[fi.pos++]))<<31,us<128))return e1(ut,Bn,Ot);throw new Error("Expected varint not more than 10 bytes")}(p|=(15&(S=j[this.pos]))<<28,_,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var _=this.readVarint();return _%2==1?(_+1)/-2:_/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var _=this.readVarint()+this.pos,p=this.pos;return this.pos=_,_-p>=12&&R_?function(S,j,ut){return R_.decode(S.subarray(j,ut))}(this.buf,p,_):function(S,j,ut){for(var Ot="",fi=j;fi<ut;){var Bn,us,ul,Ju=S[fi],oh=null,gh=Ju>239?4:Ju>223?3:Ju>191?2:1;if(fi+gh>ut)break;gh===1?Ju<128&&(oh=Ju):gh===2?(192&(Bn=S[fi+1]))==128&&(oh=(31&Ju)<<6|63&Bn)<=127&&(oh=null):gh===3?(us=S[fi+2],(192&(Bn=S[fi+1]))==128&&(192&us)==128&&((oh=(15&Ju)<<12|(63&Bn)<<6|63&us)<=2047||oh>=55296&&oh<=57343)&&(oh=null)):gh===4&&(us=S[fi+2],ul=S[fi+3],(192&(Bn=S[fi+1]))==128&&(192&us)==128&&(192&ul)==128&&((oh=(15&Ju)<<18|(63&Bn)<<12|(63&us)<<6|63&ul)<=65535||oh>=1114112)&&(oh=null)),oh===null?(oh=65533,gh=1):oh>65535&&(oh-=65536,Ot+=String.fromCharCode(oh>>>10&1023|55296),oh=56320|1023&oh),Ot+=String.fromCharCode(oh),fi+=gh}return Ot}(this.buf,p,_)},readBytes:function(){var _=this.readVarint()+this.pos,p=this.buf.subarray(this.pos,_);return this.pos=_,p},readPackedVarint:function(_,p){if(this.type!==Om.Bytes)return _.push(this.readVarint(p));var S=t_(this);for(_=_||[];this.pos<S;)_.push(this.readVarint(p));return _},readPackedSVarint:function(_){if(this.type!==Om.Bytes)return _.push(this.readSVarint());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readSVarint());return _},readPackedBoolean:function(_){if(this.type!==Om.Bytes)return _.push(this.readBoolean());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readBoolean());return _},readPackedFloat:function(_){if(this.type!==Om.Bytes)return _.push(this.readFloat());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readFloat());return _},readPackedDouble:function(_){if(this.type!==Om.Bytes)return _.push(this.readDouble());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readDouble());return _},readPackedFixed32:function(_){if(this.type!==Om.Bytes)return _.push(this.readFixed32());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readFixed32());return _},readPackedSFixed32:function(_){if(this.type!==Om.Bytes)return _.push(this.readSFixed32());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readSFixed32());return _},readPackedFixed64:function(_){if(this.type!==Om.Bytes)return _.push(this.readFixed64());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readFixed64());return _},readPackedSFixed64:function(_){if(this.type!==Om.Bytes)return _.push(this.readSFixed64());var p=t_(this);for(_=_||[];this.pos<p;)_.push(this.readSFixed64());return _},skip:function(_){var p=7&_;if(p===Om.Varint)for(;this.buf[this.pos++]>127;);else if(p===Om.Bytes)this.pos=this.readVarint()+this.pos;else if(p===Om.Fixed32)this.pos+=4;else{if(p!==Om.Fixed64)throw new Error("Unimplemented type: "+p);this.pos+=8}},writeTag:function(_,p){this.writeVarint(_<<3|p)},realloc:function(_){for(var p=this.length||16;p<this.pos+_;)p*=2;if(p!==this.length){var S=new Uint8Array(p);S.set(this.buf),this.buf=S,this.length=p}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(_){this.realloc(4),g1(this.buf,_,this.pos),this.pos+=4},writeSFixed32:function(_){this.realloc(4),g1(this.buf,_,this.pos),this.pos+=4},writeFixed64:function(_){this.realloc(8),g1(this.buf,-1&_,this.pos),g1(this.buf,Math.floor(_*U1),this.pos+4),this.pos+=8},writeSFixed64:function(_){this.realloc(8),g1(this.buf,-1&_,this.pos),g1(this.buf,Math.floor(_*U1),this.pos+4),this.pos+=8},writeVarint:function(_){(_=+_||0)>268435455||_<0?function(p,S){var j,ut;if(p>=0?(j=p%4294967296|0,ut=p/4294967296|0):(ut=~(-p/4294967296),4294967295^(j=~(-p%4294967296))?j=j+1|0:(j=0,ut=ut+1|0)),p>=18446744073709552e3||p<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");S.realloc(10),function(Ot,fi,Bn){Bn.buf[Bn.pos++]=127&Ot|128,Ot>>>=7,Bn.buf[Bn.pos++]=127&Ot|128,Ot>>>=7,Bn.buf[Bn.pos++]=127&Ot|128,Ot>>>=7,Bn.buf[Bn.pos++]=127&Ot|128,Bn.buf[Bn.pos]=127&(Ot>>>=7)}(j,0,S),function(Ot,fi){var Bn=(7&Ot)<<4;fi.buf[fi.pos++]|=Bn|((Ot>>>=3)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot)))))}(ut,S)}(_,this):(this.realloc(4),this.buf[this.pos++]=127&_|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=_>>>7&127))))},writeSVarint:function(_){this.writeVarint(_<0?2*-_-1:2*_)},writeBoolean:function(_){this.writeVarint(!!_)},writeString:function(_){_=String(_),this.realloc(4*_.length),this.pos++;var p=this.pos;this.pos=function(j,ut,Ot){for(var fi,Bn,us=0;us<ut.length;us++){if((fi=ut.charCodeAt(us))>55295&&fi<57344){if(!Bn){fi>56319||us+1===ut.length?(j[Ot++]=239,j[Ot++]=191,j[Ot++]=189):Bn=fi;continue}if(fi<56320){j[Ot++]=239,j[Ot++]=191,j[Ot++]=189,Bn=fi;continue}fi=Bn-55296<<10|fi-56320|65536,Bn=null}else Bn&&(j[Ot++]=239,j[Ot++]=191,j[Ot++]=189,Bn=null);fi<128?j[Ot++]=fi:(fi<2048?j[Ot++]=fi>>6|192:(fi<65536?j[Ot++]=fi>>12|224:(j[Ot++]=fi>>18|240,j[Ot++]=fi>>12&63|128),j[Ot++]=fi>>6&63|128),j[Ot++]=63&fi|128)}return Ot}(this.buf,_,this.pos);var S=this.pos-p;S>=128&&Cg(p,S,this),this.pos=p-1,this.writeVarint(S),this.pos+=S},writeFloat:function(_){this.realloc(4),xb(this.buf,_,this.pos,!0,23,4),this.pos+=4},writeDouble:function(_){this.realloc(8),xb(this.buf,_,this.pos,!0,52,8),this.pos+=8},writeBytes:function(_){var p=_.length;this.writeVarint(p),this.realloc(p);for(var S=0;S<p;S++)this.buf[this.pos++]=_[S]},writeRawMessage:function(_,p){this.pos++;var S=this.pos;_(p,this);var j=this.pos-S;j>=128&&Cg(S,j,this),this.pos=S-1,this.writeVarint(j),this.pos+=j},writeMessage:function(_,p,S){this.writeTag(_,Om.Bytes),this.writeRawMessage(p,S)},writePackedVarint:function(_,p){p.length&&this.writeMessage(_,dw,p)},writePackedSVarint:function(_,p){p.length&&this.writeMessage(_,px,p)},writePackedBoolean:function(_,p){p.length&&this.writeMessage(_,r2,p)},writePackedFloat:function(_,p){p.length&&this.writeMessage(_,Z0,p)},writePackedDouble:function(_,p){p.length&&this.writeMessage(_,i2,p)},writePackedFixed32:function(_,p){p.length&&this.writeMessage(_,fw,p)},writePackedSFixed32:function(_,p){p.length&&this.writeMessage(_,pw,p)},writePackedFixed64:function(_,p){p.length&&this.writeMessage(_,m1,p)},writePackedSFixed64:function(_,p){p.length&&this.writeMessage(_,mw,p)},writeBytesField:function(_,p){this.writeTag(_,Om.Bytes),this.writeBytes(p)},writeFixed32Field:function(_,p){this.writeTag(_,Om.Fixed32),this.writeFixed32(p)},writeSFixed32Field:function(_,p){this.writeTag(_,Om.Fixed32),this.writeSFixed32(p)},writeFixed64Field:function(_,p){this.writeTag(_,Om.Fixed64),this.writeFixed64(p)},writeSFixed64Field:function(_,p){this.writeTag(_,Om.Fixed64),this.writeSFixed64(p)},writeVarintField:function(_,p){this.writeTag(_,Om.Varint),this.writeVarint(p)},writeSVarintField:function(_,p){this.writeTag(_,Om.Varint),this.writeSVarint(p)},writeStringField:function(_,p){this.writeTag(_,Om.Bytes),this.writeString(p)},writeFloatField:function(_,p){this.writeTag(_,Om.Fixed32),this.writeFloat(p)},writeDoubleField:function(_,p){this.writeTag(_,Om.Fixed64),this.writeDouble(p)},writeBooleanField:function(_,p){this.writeVarintField(_,!!p)}};class _1{constructor(p,{pixelRatio:S,version:j,stretchX:ut,stretchY:Ot,content:fi}){this.paddedRect=p,this.pixelRatio=S,this.stretchX=ut,this.stretchY=Ot,this.content=fi,this.version=j}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hx{constructor(p,S){const j={},ut={};this.haveRenderCallbacks=[];const Ot=[];this.addImages(p,j,Ot),this.addImages(S,ut,Ot);const{w:fi,h:Bn}=wb(Ot),us=new lg({width:fi||1,height:Bn||1});for(const ul in p){const Ju=p[ul],oh=j[ul].paddedRect;lg.copy(Ju.data,us,{x:0,y:0},{x:oh.x+1,y:oh.y+1},Ju.data)}for(const ul in S){const Ju=S[ul],oh=ut[ul].paddedRect,gh=oh.x+1,xh=oh.y+1,bh=Ju.data.width,Wh=Ju.data.height;lg.copy(Ju.data,us,{x:0,y:0},{x:gh,y:xh},Ju.data),lg.copy(Ju.data,us,{x:0,y:Wh-1},{x:gh,y:xh-1},{width:bh,height:1}),lg.copy(Ju.data,us,{x:0,y:0},{x:gh,y:xh+Wh},{width:bh,height:1}),lg.copy(Ju.data,us,{x:bh-1,y:0},{x:gh-1,y:xh},{width:1,height:Wh}),lg.copy(Ju.data,us,{x:0,y:0},{x:gh+bh,y:xh},{width:1,height:Wh})}this.image=us,this.iconPositions=j,this.patternPositions=ut}addImages(p,S,j){for(const ut in p){const Ot=p[ut],fi={x:0,y:0,w:Ot.data.width+2,h:Ot.data.height+2};j.push(fi),S[ut]=new _1(fi,Ot),Ot.hasRenderCallback&&this.haveRenderCallbacks.push(ut)}}patchUpdatedImages(p,S){p.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const j in p.updatedImages)this.patchUpdatedImage(this.iconPositions[j],p.getImage(j),S),this.patchUpdatedImage(this.patternPositions[j],p.getImage(j),S)}patchUpdatedImage(p,S,j){if(!p||!S||p.version===S.version)return;p.version=S.version;const[ut,Ot]=p.tl;j.update(S.data,void 0,{x:ut,y:Ot})}}tp("ImagePosition",_1),tp("ImageAtlas",Hx),o.WritingMode=void 0,(A0=o.WritingMode||(o.WritingMode={}))[A0.none=0]="none",A0[A0.horizontal=1]="horizontal",A0[A0.vertical=2]="vertical",A0[A0.horizontalOnly=3]="horizontalOnly";const V1=-17;class y1{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(p,S){const j=new y1;return j.scale=p||1,j.fontStack=S,j}static forImage(p){const S=new y1;return S.imageName=p,S}}class Yg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(p,S){const j=new Yg;for(let ut=0;ut<p.sections.length;ut++){const Ot=p.sections[ut];Ot.image?j.addImageSection(Ot):j.addTextSection(Ot,S)}return j}length(){return this.text.length}getSection(p){return this.sections[this.sectionIndex[p]]}getSectionIndex(p){return this.sectionIndex[p]}getCharCode(p){return this.text.charCodeAt(p)}verticalizePunctuation(){this.text=function(p){let S="";for(let j=0;j<p.length;j++){const ut=p.charCodeAt(j+1)||null,Ot=p.charCodeAt(j-1)||null;S+=ut&&ov(ut)&&!Dv[p[j+1]]||Ot&&ov(Ot)&&!Dv[p[j-1]]||!Dv[p[j]]?p[j]:Dv[p[j]]}return S}(this.text)}trim(){let p=0;for(let j=0;j<this.text.length&&fv[this.text.charCodeAt(j)];j++)p++;let S=this.text.length;for(let j=this.text.length-1;j>=0&&j>=p&&fv[this.text.charCodeAt(j)];j--)S--;this.text=this.text.substring(p,S),this.sectionIndex=this.sectionIndex.slice(p,S)}substring(p,S){const j=new Yg;return j.text=this.text.substring(p,S),j.sectionIndex=this.sectionIndex.slice(p,S),j.sections=this.sections,j}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((p,S)=>Math.max(p,this.sections[S].scale),0)}addTextSection(p,S){this.text+=p.text,this.sections.push(y1.forText(p.scale,p.fontStack||S));const j=this.sections.length-1;for(let ut=0;ut<p.text.length;++ut)this.sectionIndex.push(j)}addImageSection(p){const S=p.image?p.image.name:"";if(S.length===0)return void $s("Can't add FormattedSection with an empty image.");const j=this.getNextImageSectionCharCode();j?(this.text+=String.fromCharCode(j),this.sections.push(y1.forImage(S)),this.sectionIndex.push(this.sections.length-1)):$s("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yy(_,p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh){const Zh=Yg.fromFeature(_,ut);let bd;oh===o.WritingMode.vertical&&Zh.verticalizePunctuation();const{processBidirectionalText:Bd,processStyledBidirectionalText:dd}=Ig;if(Bd&&Zh.sections.length===1){bd=[];const Bf=Bd(Zh.toString(),Tb(Zh,ul,Ot,p,j,xh,bh));for(const Ap of Bf){const Bp=new Yg;Bp.text=Ap,Bp.sections=Zh.sections;for(let wp=0;wp<Ap.length;wp++)Bp.sectionIndex.push(0);bd.push(Bp)}}else if(dd){bd=[];const Bf=dd(Zh.text,Zh.sectionIndex,Tb(Zh,ul,Ot,p,j,xh,bh));for(const Ap of Bf){const Bp=new Yg;Bp.text=Ap[0],Bp.sectionIndex=Ap[1],Bp.sections=Zh.sections,bd.push(Bp)}}else bd=function(Bf,Ap){const Bp=[],wp=Bf.text;let yp=0;for(const cp of Ap)Bp.push(Bf.substring(yp,cp)),yp=cp;return yp<wp.length&&Bp.push(Bf.substring(yp,wp.length)),Bp}(Zh,Tb(Zh,ul,Ot,p,j,xh,bh));const Nd=[],Ff={positionedLines:Nd,text:Zh.toString(),top:Ju[1],bottom:Ju[1],left:Ju[0],right:Ju[0],writingMode:oh,iconsInText:!1,verticalizable:!1};return function(Bf,Ap,Bp,wp,yp,cp,Ep,gp,Qf,Gp,Fp,ym){let ug=0,_g=V1,Bg=0,i0=0;const a_=gp==="right"?1:gp==="left"?0:.5;let yg=0;for(const Fg of yp){Fg.trim();const x_=Fg.getMaxScale(),$_=(x_-1)*$g,ey={positionedGlyphs:[],lineOffset:0};Bf.positionedLines[yg]=ey;const B_=ey.positionedGlyphs;let b_=0;if(!Fg.length()){_g+=cp,++yg;continue}for(let w_=0;w_<Fg.length();w_++){const vm=Fg.getSection(w_),E_=Fg.getSectionIndex(w_),qg=Fg.getCharCode(w_);let T_=0,ty=null,k0=null,Y0=null,gv=$g;const r0=!(Qf===o.WritingMode.horizontal||!Fp&&!g0(qg)||Fp&&(fv[qg]||(i_=qg,sp.Arabic(i_)||sp["Arabic Supplement"](i_)||sp["Arabic Extended-A"](i_)||sp["Arabic Presentation Forms-A"](i_)||sp["Arabic Presentation Forms-B"](i_))));if(vm.imageName){const Py=wp[vm.imageName];if(!Py)continue;Y0=vm.imageName,Bf.iconsInText=Bf.iconsInText||!0,k0=Py.paddedRect;const iy=Py.displaySize;vm.scale=vm.scale*$g/ym,ty={width:iy[0],height:iy[1],left:1,top:-3,advance:r0?iy[1]:iy[0]},T_=$_+($g-iy[1]*vm.scale),gv=ty.advance;const _v=r0?iy[0]*vm.scale-$g*x_:iy[1]*vm.scale-$g*x_;_v>0&&_v>b_&&(b_=_v)}else{const Py=Bp[vm.fontStack],iy=Py&&Py[qg];if(iy&&iy.rect)k0=iy.rect,ty=iy.metrics;else{const _v=Ap[vm.fontStack],K1=_v&&_v[qg];if(!K1)continue;ty=K1.metrics}T_=(x_-vm.scale)*$g}r0?(Bf.verticalizable=!0,B_.push({glyph:qg,imageName:Y0,x:ug,y:_g+T_,vertical:r0,scale:vm.scale,fontStack:vm.fontStack,sectionIndex:E_,metrics:ty,rect:k0}),ug+=gv*vm.scale+Gp):(B_.push({glyph:qg,imageName:Y0,x:ug,y:_g+T_,vertical:r0,scale:vm.scale,fontStack:vm.fontStack,sectionIndex:E_,metrics:ty,rect:k0}),ug+=ty.advance*vm.scale+Gp)}B_.length!==0&&(Bg=Math.max(ug-Gp,Bg),pv(B_,0,B_.length-1,a_,b_)),ug=0;const vg=cp*x_+b_;ey.lineOffset=Math.max(b_,$_),_g+=vg,i0=Math.max(vg,i0),++yg}var i_;const v_=_g-V1,{horizontalAlign:O_,verticalAlign:J_}=yx(Ep);(function(Fg,x_,$_,ey,B_,b_,vg,w_,vm){const E_=(x_-$_)*B_;let qg=0;qg=b_!==vg?-w_*ey-V1:(-ey*vm+.5)*vg;for(const T_ of Fg)for(const ty of T_.positionedGlyphs)ty.x+=E_,ty.y+=qg})(Bf.positionedLines,a_,O_,J_,Bg,i0,cp,v_,yp.length),Bf.top+=-J_*v_,Bf.bottom=Bf.top+v_,Bf.left+=-O_*Bg,Bf.right=Bf.left+Bg}(Ff,p,S,j,bd,fi,Bn,us,oh,ul,gh,Wh),!function(Bf){for(const Ap of Bf)if(Ap.positionedGlyphs.length!==0)return!1;return!0}(Nd)&&Ff}const fv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ky(_,p,S,j,ut,Ot){if(p.imageName){const fi=j[p.imageName];return fi?fi.displaySize[0]*p.scale*$g/Ot+ut:0}{const fi=S[p.fontStack],Bn=fi&&fi[_];return Bn?Bn.metrics.advance*p.scale+ut:0}}function Qy(_,p,S,j){const ut=Math.pow(_-p,2);return j?_<p?ut/2:2*ut:ut+Math.abs(S)*S}function a2(_,p,S){let j=0;return _===10&&(j-=1e4),S&&(j+=150),_!==40&&_!==65288||(j+=50),p!==41&&p!==65289||(j+=50),j}function _x(_,p,S,j,ut,Ot){let fi=null,Bn=Qy(p,S,ut,Ot);for(const us of j){const ul=Qy(p-us.x,S,ut,Ot)+us.badness;ul<=Bn&&(fi=us,Bn=ul)}return{index:_,x:p,priorBreak:fi,badness:Bn}}function Eb(_){return _?Eb(_.priorBreak).concat(_.index):[]}function Tb(_,p,S,j,ut,Ot,fi){if(Ot!=="point")return[];if(!_)return[];const Bn=[],us=function(gh,xh,bh,Wh,Zh,bd){let Bd=0;for(let dd=0;dd<gh.length();dd++){const Nd=gh.getSection(dd);Bd+=Ky(gh.getCharCode(dd),Nd,Wh,Zh,xh,bd)}return Bd/Math.max(1,Math.ceil(Bd/bh))}(_,p,S,j,ut,fi),ul=_.text.indexOf("​")>=0;let Ju=0;for(let gh=0;gh<_.length();gh++){const xh=_.getSection(gh),bh=_.getCharCode(gh);if(fv[bh]||(Ju+=Ky(bh,xh,j,ut,p,fi)),gh<_.length()-1){const Wh=!((oh=bh)<11904||!(sp["Bopomofo Extended"](oh)||sp.Bopomofo(oh)||sp["CJK Compatibility Forms"](oh)||sp["CJK Compatibility Ideographs"](oh)||sp["CJK Compatibility"](oh)||sp["CJK Radicals Supplement"](oh)||sp["CJK Strokes"](oh)||sp["CJK Symbols and Punctuation"](oh)||sp["CJK Unified Ideographs Extension A"](oh)||sp["CJK Unified Ideographs"](oh)||sp["Enclosed CJK Letters and Months"](oh)||sp["Halfwidth and Fullwidth Forms"](oh)||sp.Hiragana(oh)||sp["Ideographic Description Characters"](oh)||sp["Kangxi Radicals"](oh)||sp["Katakana Phonetic Extensions"](oh)||sp.Katakana(oh)||sp["Vertical Forms"](oh)||sp["Yi Radicals"](oh)||sp["Yi Syllables"](oh)));(gx[bh]||Wh||xh.imageName)&&Bn.push(_x(gh+1,Ju,us,Bn,a2(bh,_.getCharCode(gh+1),Wh&&ul),!1))}}var oh;return Eb(_x(_.length(),Ju,us,Bn,0,!0))}function yx(_){let p=.5,S=.5;switch(_){case"right":case"top-right":case"bottom-right":p=1;break;case"left":case"top-left":case"bottom-left":p=0}switch(_){case"bottom":case"bottom-right":case"bottom-left":S=1;break;case"top":case"top-right":case"top-left":S=0}return{horizontalAlign:p,verticalAlign:S}}function pv(_,p,S,j,ut){if(!j&&!ut)return;const Ot=_[S],fi=(_[S].x+Ot.metrics.advance*Ot.scale)*j;for(let Bn=p;Bn<=S;Bn++)_[Bn].x-=fi,_[Bn].y+=ut}function v1(_,p,S){const{horizontalAlign:j,verticalAlign:ut}=yx(S),Ot=p[0]-_.displaySize[0]*j,fi=p[1]-_.displaySize[1]*ut;return{image:_,top:fi,bottom:fi+_.displaySize[1],left:Ot,right:Ot+_.displaySize[0]}}function Sb(_,p,S,j,ut,Ot){const fi=_.image;let Bn;if(fi.content){const Zh=fi.content,bd=fi.pixelRatio||1;Bn=[Zh[0]/bd,Zh[1]/bd,fi.displaySize[0]-Zh[2]/bd,fi.displaySize[1]-Zh[3]/bd]}const us=p.left*Ot,ul=p.right*Ot;let Ju,oh,gh,xh;S==="width"||S==="both"?(xh=ut[0]+us-j[3],oh=ut[0]+ul+j[1]):(xh=ut[0]+(us+ul-fi.displaySize[0])/2,oh=xh+fi.displaySize[0]);const bh=p.top*Ot,Wh=p.bottom*Ot;return S==="height"||S==="both"?(Ju=ut[1]+bh-j[0],gh=ut[1]+Wh+j[2]):(Ju=ut[1]+(bh+Wh-fi.displaySize[1])/2,gh=Ju+fi.displaySize[1]),{image:fi,top:Ju,right:oh,bottom:gh,left:xh,collisionPadding:Bn}}const mv=128;function _w(_,p){const{expression:S}=p;if(S.kind==="constant")return{kind:"constant",layoutSize:S.evaluate(new Cm(_+1))};if(S.kind==="source")return{kind:"source"};{const{zoomStops:j,interpolationType:ut}=S;let Ot=0;for(;Ot<j.length&&j[Ot]<=_;)Ot++;Ot=Math.max(0,Ot-1);let fi=Ot;for(;fi<j.length&&j[fi]<_+1;)fi++;fi=Math.min(j.length-1,fi);const Bn=j[Ot],us=j[fi];return S.kind==="composite"?{kind:"composite",minZoom:Bn,maxZoom:us,interpolationType:ut}:{kind:"camera",minZoom:Bn,maxZoom:us,minSize:S.evaluate(new Cm(Bn)),maxSize:S.evaluate(new Cm(us)),interpolationType:ut}}}class H0 extends ud{constructor(p,S,j,ut){super(p,S),this.angle=j,ut!==void 0&&(this.segment=ut)}clone(){return new H0(this.x,this.y,this.angle,this.segment)}}function Xx(_,p,S,j,ut){if(p.segment===void 0)return!0;let Ot=p,fi=p.segment+1,Bn=0;for(;Bn>-S/2;){if(fi--,fi<0)return!1;Bn-=_[fi].dist(Ot),Ot=_[fi]}Bn+=_[fi].dist(_[fi+1]),fi++;const us=[];let ul=0;for(;Bn<S/2;){const Ju=_[fi],oh=_[fi+1];if(!oh)return!1;let gh=_[fi-1].angleTo(Ju)-Ju.angleTo(oh);for(gh=Math.abs((gh+3*Math.PI)%(2*Math.PI)-Math.PI),us.push({distance:Bn,angleDelta:gh}),ul+=gh;Bn-us[0].distance>j;)ul-=us.shift().angleDelta;if(ul>ut)return!1;fi++,Bn+=Ju.dist(oh)}return!0}function x1(_){let p=0;for(let S=0;S<_.length-1;S++)p+=_[S].dist(_[S+1]);return p}function b1(_,p,S){return _?.6*p*S:0}function G1(_,p){return Math.max(_?_.right-_.left:0,p?p.right-p.left:0)}function Wx(_,p,S,j,ut,Ot){const fi=b1(S,ut,Ot),Bn=G1(S,j)*Ot;let us=0;const ul=x1(_)/2;for(let Ju=0;Ju<_.length-1;Ju++){const oh=_[Ju],gh=_[Ju+1],xh=oh.dist(gh);if(us+xh>ul){const bh=(ul-us)/xh,Wh=mm(oh.x,gh.x,bh),Zh=mm(oh.y,gh.y,bh),bd=new H0(Wh,Zh,gh.angleTo(oh),Ju);return bd._round(),!fi||Xx(_,bd,Bn,fi,p)?bd:void 0}us+=xh}}function yw(_,p,S,j,ut,Ot,fi,Bn,us){const ul=b1(j,Ot,fi),Ju=G1(j,ut),oh=Ju*fi,gh=_[0].x===0||_[0].x===us||_[0].y===0||_[0].y===us;return p-oh<p/4&&(p=oh+p/4),j1(_,gh?p/2*Bn%p:(Ju/2+2*Ot)*fi*Bn%p,p,ul,S,oh,gh,!1,us)}function j1(_,p,S,j,ut,Ot,fi,Bn,us){const ul=Ot/2,Ju=x1(_);let oh=0,gh=p-S,xh=[];for(let bh=0;bh<_.length-1;bh++){const Wh=_[bh],Zh=_[bh+1],bd=Wh.dist(Zh),Bd=Zh.angleTo(Wh);for(;gh+S<oh+bd;){gh+=S;const dd=(gh-oh)/bd,Nd=mm(Wh.x,Zh.x,dd),Ff=mm(Wh.y,Zh.y,dd);if(Nd>=0&&Nd<us&&Ff>=0&&Ff<us&&gh-ul>=0&&gh+ul<=Ju){const Bf=new H0(Nd,Ff,Bd,bh);Bf._round(),j&&!Xx(_,Bf,Ot,j,ut)||xh.push(Bf)}}oh+=bd}return Bn||xh.length||fi||(xh=j1(_,oh/2,S,j,ut,Ot,fi,!0,us)),xh}function Yx(_,p,S,j,ut){const Ot=[];for(let fi=0;fi<_.length;fi++){const Bn=_[fi];let us;for(let ul=0;ul<Bn.length-1;ul++){let Ju=Bn[ul],oh=Bn[ul+1];Ju.x<p&&oh.x<p||(Ju.x<p?Ju=new ud(p,Ju.y+(p-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round():oh.x<p&&(oh=new ud(p,Ju.y+(p-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round()),Ju.y<S&&oh.y<S||(Ju.y<S?Ju=new ud(Ju.x+(S-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),S)._round():oh.y<S&&(oh=new ud(Ju.x+(S-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),S)._round()),Ju.x>=j&&oh.x>=j||(Ju.x>=j?Ju=new ud(j,Ju.y+(j-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round():oh.x>=j&&(oh=new ud(j,Ju.y+(j-Ju.x)/(oh.x-Ju.x)*(oh.y-Ju.y))._round()),Ju.y>=ut&&oh.y>=ut||(Ju.y>=ut?Ju=new ud(Ju.x+(ut-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),ut)._round():oh.y>=ut&&(oh=new ud(Ju.x+(ut-Ju.y)/(oh.y-Ju.y)*(oh.x-Ju.x),ut)._round()),us&&Ju.equals(us[us.length-1])||(us=[Ju],Ot.push(us)),us.push(oh)))))}}return Ot}function Ib(_,p,S,j){const ut=[],Ot=_.image,fi=Ot.pixelRatio,Bn=Ot.paddedRect.w-2,us=Ot.paddedRect.h-2,ul=_.right-_.left,Ju=_.bottom-_.top,oh=Ot.stretchX||[[0,Bn]],gh=Ot.stretchY||[[0,us]],xh=(cp,Ep)=>cp+Ep[1]-Ep[0],bh=oh.reduce(xh,0),Wh=gh.reduce(xh,0),Zh=Bn-bh,bd=us-Wh;let Bd=0,dd=bh,Nd=0,Ff=Wh,Bf=0,Ap=Zh,Bp=0,wp=bd;if(Ot.content&&j){const cp=Ot.content;Bd=Lv(oh,0,cp[0]),Nd=Lv(gh,0,cp[1]),dd=Lv(oh,cp[0],cp[2]),Ff=Lv(gh,cp[1],cp[3]),Bf=cp[0]-Bd,Bp=cp[1]-Nd,Ap=cp[2]-cp[0]-dd,wp=cp[3]-cp[1]-Ff}const yp=(cp,Ep,gp,Qf)=>{const Gp=q1(cp.stretch-Bd,dd,ul,_.left),Fp=vx(cp.fixed-Bf,Ap,cp.stretch,bh),ym=q1(Ep.stretch-Nd,Ff,Ju,_.top),ug=vx(Ep.fixed-Bp,wp,Ep.stretch,Wh),_g=q1(gp.stretch-Bd,dd,ul,_.left),Bg=vx(gp.fixed-Bf,Ap,gp.stretch,bh),i0=q1(Qf.stretch-Nd,Ff,Ju,_.top),a_=vx(Qf.fixed-Bp,wp,Qf.stretch,Wh),yg=new ud(Gp,ym),i_=new ud(_g,ym),v_=new ud(_g,i0),O_=new ud(Gp,i0),J_=new ud(Fp/fi,ug/fi),Fg=new ud(Bg/fi,a_/fi),x_=p*Math.PI/180;if(x_){const B_=Math.sin(x_),b_=Math.cos(x_),vg=[b_,-B_,B_,b_];yg._matMult(vg),i_._matMult(vg),O_._matMult(vg),v_._matMult(vg)}const $_=cp.stretch+cp.fixed,ey=Ep.stretch+Ep.fixed;return{tl:yg,tr:i_,bl:O_,br:v_,tex:{x:Ot.paddedRect.x+1+$_,y:Ot.paddedRect.y+1+ey,w:gp.stretch+gp.fixed-$_,h:Qf.stretch+Qf.fixed-ey},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:J_,pixelOffsetBR:Fg,minFontScaleX:Ap/fi/ul,minFontScaleY:wp/fi/Ju,isSDF:S}};if(j&&(Ot.stretchX||Ot.stretchY)){const cp=Cb(oh,Zh,bh),Ep=Cb(gh,bd,Wh);for(let gp=0;gp<cp.length-1;gp++){const Qf=cp[gp],Gp=cp[gp+1];for(let Fp=0;Fp<Ep.length-1;Fp++)ut.push(yp(Qf,Ep[Fp],Gp,Ep[Fp+1]))}}else ut.push(yp({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Bn+1},{fixed:0,stretch:us+1}));return ut}function Lv(_,p,S){let j=0;for(const ut of _)j+=Math.max(p,Math.min(S,ut[1]))-Math.max(p,Math.min(S,ut[0]));return j}function Cb(_,p,S){const j=[{fixed:-1,stretch:0}];for(const[ut,Ot]of _){const fi=j[j.length-1];j.push({fixed:ut-fi.stretch,stretch:fi.stretch}),j.push({fixed:ut-fi.stretch,stretch:fi.stretch+(Ot-ut)})}return j.push({fixed:p+1,stretch:S}),j}function q1(_,p,S,j){return _/p*S+j}function vx(_,p,S,j){return _-p*S/j}tp("Anchor",H0);class Kx{constructor(p,S,j,ut,Ot,fi,Bn,us,ul,Ju){if(this.boxStartIndex=p.length,ul){let oh=fi.top,gh=fi.bottom;const xh=fi.collisionPadding;xh&&(oh-=xh[1],gh+=xh[3]);let bh=gh-oh;bh>0&&(bh=Math.max(10,bh),this.circleDiameter=bh)}else{let oh=fi.top*Bn-us[0],gh=fi.bottom*Bn+us[2],xh=fi.left*Bn-us[3],bh=fi.right*Bn+us[1];const Wh=fi.collisionPadding;if(Wh&&(xh-=Wh[0]*Bn,oh-=Wh[1]*Bn,bh+=Wh[2]*Bn,gh+=Wh[3]*Bn),Ju){const Zh=new ud(xh,oh),bd=new ud(bh,oh),Bd=new ud(xh,gh),dd=new ud(bh,gh),Nd=Ju*Math.PI/180;Zh._rotate(Nd),bd._rotate(Nd),Bd._rotate(Nd),dd._rotate(Nd),xh=Math.min(Zh.x,bd.x,Bd.x,dd.x),bh=Math.max(Zh.x,bd.x,Bd.x,dd.x),oh=Math.min(Zh.y,bd.y,Bd.y,dd.y),gh=Math.max(Zh.y,bd.y,Bd.y,dd.y)}p.emplaceBack(S.x,S.y,xh,oh,bh,gh,j,ut,Ot)}this.boxEndIndex=p.length}}class s2{constructor(p=[],S=xx){if(this.data=p,this.length=this.data.length,this.compare=S,this.length>0)for(let j=(this.length>>1)-1;j>=0;j--)this._down(j)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const p=this.data[0],S=this.data.pop();return this.length--,this.length>0&&(this.data[0]=S,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:S,compare:j}=this,ut=S[p];for(;p>0;){const Ot=p-1>>1,fi=S[Ot];if(j(ut,fi)>=0)break;S[p]=fi,p=Ot}S[p]=ut}_down(p){const{data:S,compare:j}=this,ut=this.length>>1,Ot=S[p];for(;p<ut;){let fi=1+(p<<1),Bn=S[fi];const us=fi+1;if(us<this.length&&j(S[us],Bn)<0&&(fi=us,Bn=S[us]),j(Bn,Ot)>=0)break;S[p]=Bn,p=fi}S[p]=Ot}}function xx(_,p){return _<p?-1:_>p?1:0}function vw(_,p=1,S=!1){let j=1/0,ut=1/0,Ot=-1/0,fi=-1/0;const Bn=_[0];for(let xh=0;xh<Bn.length;xh++){const bh=Bn[xh];(!xh||bh.x<j)&&(j=bh.x),(!xh||bh.y<ut)&&(ut=bh.y),(!xh||bh.x>Ot)&&(Ot=bh.x),(!xh||bh.y>fi)&&(fi=bh.y)}const us=Math.min(Ot-j,fi-ut);let ul=us/2;const Ju=new s2([],Tm);if(us===0)return new ud(j,ut);for(let xh=j;xh<Ot;xh+=us)for(let bh=ut;bh<fi;bh+=us)Ju.push(new t1(xh+ul,bh+ul,ul,_));let oh=function(xh){let bh=0,Wh=0,Zh=0;const bd=xh[0];for(let Bd=0,dd=bd.length,Nd=dd-1;Bd<dd;Nd=Bd++){const Ff=bd[Bd],Bf=bd[Nd],Ap=Ff.x*Bf.y-Bf.x*Ff.y;Wh+=(Ff.x+Bf.x)*Ap,Zh+=(Ff.y+Bf.y)*Ap,bh+=3*Ap}return new t1(Wh/bh,Zh/bh,0,xh)}(_),gh=Ju.length;for(;Ju.length;){const xh=Ju.pop();(xh.d>oh.d||!oh.d)&&(oh=xh,S&&console.log("found best %d after %d probes",Math.round(1e4*xh.d)/1e4,gh)),xh.max-oh.d<=p||(ul=xh.h/2,Ju.push(new t1(xh.p.x-ul,xh.p.y-ul,ul,_)),Ju.push(new t1(xh.p.x+ul,xh.p.y-ul,ul,_)),Ju.push(new t1(xh.p.x-ul,xh.p.y+ul,ul,_)),Ju.push(new t1(xh.p.x+ul,xh.p.y+ul,ul,_)),gh+=4)}return S&&(console.log(`num probes: ${gh}`),console.log(`best distance: ${oh.d}`)),oh.p}function Tm(_,p){return p.max-_.max}function t1(_,p,S,j){this.p=new ud(_,p),this.h=S,this.d=function(ut,Ot){let fi=!1,Bn=1/0;for(let us=0;us<Ot.length;us++){const ul=Ot[us];for(let Ju=0,oh=ul.length,gh=oh-1;Ju<oh;gh=Ju++){const xh=ul[Ju],bh=ul[gh];xh.y>ut.y!=bh.y>ut.y&&ut.x<(bh.x-xh.x)*(ut.y-xh.y)/(bh.y-xh.y)+xh.x&&(fi=!fi),Bn=Math.min(Bn,gd(ut,xh,bh))}}return(fi?1:-1)*Math.sqrt(Bn)}(this.p,j),this.max=this.d+this.h*Math.SQRT2}const P0=Number.POSITIVE_INFINITY;function X0(_,p){return p[1]!==P0?function(S,j,ut){let Ot=0,fi=0;switch(j=Math.abs(j),ut=Math.abs(ut),S){case"top-right":case"top-left":case"top":fi=ut-7;break;case"bottom-right":case"bottom-left":case"bottom":fi=7-ut}switch(S){case"top-right":case"bottom-right":case"right":Ot=-j;break;case"top-left":case"bottom-left":case"left":Ot=j}return[Ot,fi]}(_,p[0],p[1]):function(S,j){let ut=0,Ot=0;j<0&&(j=0);const fi=j/Math.sqrt(2);switch(S){case"top-right":case"top-left":Ot=fi-7;break;case"bottom-right":case"bottom-left":Ot=7-fi;break;case"bottom":Ot=7-j;break;case"top":Ot=j-7}switch(S){case"top-right":case"bottom-right":ut=-fi;break;case"top-left":case"bottom-left":ut=fi;break;case"left":ut=j;break;case"right":ut=-j}return[ut,Ot]}(_,p[0])}function Jy(_){switch(_){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e0(_,p,S,j,ut,Ot,fi,Bn,us,ul,Ju){let oh=Ot.textMaxSize.evaluate(p,{});oh===void 0&&(oh=fi);const gh=_.layers[0].layout,xh=gh.get("icon-offset").evaluate(p,{},Ju),bh=o_(S.horizontal),Wh=fi/24,Zh=_.tilePixelRatio*Wh,bd=_.tilePixelRatio*oh/24,Bd=_.tilePixelRatio*Bn,dd=_.tilePixelRatio*gh.get("symbol-spacing"),Nd=gh.get("text-padding")*_.tilePixelRatio,Ff=function(Qf,Gp,Fp,ym=1){const ug=Qf.get("icon-padding").evaluate(Gp,{},Fp),_g=ug&&ug.values;return[_g[0]*ym,_g[1]*ym,_g[2]*ym,_g[3]*ym]}(gh,p,Ju,_.tilePixelRatio),Bf=gh.get("text-max-angle")/180*Math.PI,Ap=gh.get("text-rotation-alignment")!=="viewport"&&gh.get("symbol-placement")!=="point",Bp=gh.get("icon-rotation-alignment")==="map"&&gh.get("symbol-placement")!=="point",wp=gh.get("symbol-placement"),yp=dd/2,cp=gh.get("icon-text-fit");let Ep;j&&cp!=="none"&&(_.allowVerticalPlacement&&S.vertical&&(Ep=Sb(j,S.vertical,cp,gh.get("icon-text-fit-padding"),xh,Wh)),bh&&(j=Sb(j,bh,cp,gh.get("icon-text-fit-padding"),xh,Wh)));const gp=(Qf,Gp)=>{Gp.x<0||Gp.x>=fh||Gp.y<0||Gp.y>=fh||function(Fp,ym,ug,_g,Bg,i0,a_,yg,i_,v_,O_,J_,Fg,x_,$_,ey,B_,b_,vg,w_,vm,E_,qg,T_,ty){const k0=Fp.addToLineVertexArray(ym,ug);let Y0,gv,r0,Py,iy=0,_v=0,K1=0,Aw=0,Fb=-1,tb=-1;const D0={};let Ub=ph(""),S_=0,C1=0;if(yg._unevaluatedLayout.getValue("text-radial-offset")===void 0?[S_,C1]=yg.layout.get("text-offset").evaluate(vm,{},T_).map(ry=>ry*$g):(S_=yg.layout.get("text-radial-offset").evaluate(vm,{},T_)*$g,C1=P0),Fp.allowVerticalPlacement&&_g.vertical){const ry=yg.layout.get("text-rotate").evaluate(vm,{},T_)+90;r0=new Kx(i_,ym,v_,O_,J_,_g.vertical,Fg,x_,$_,ry),a_&&(Py=new Kx(i_,ym,v_,O_,J_,a_,B_,b_,$_,ry))}if(Bg){const ry=yg.layout.get("icon-rotate").evaluate(vm,{}),Q0=yg.layout.get("icon-text-fit")!=="none",Q1=Ib(Bg,ry,qg,Q0),Px=a_?Ib(a_,ry,qg,Q0):void 0;gv=new Kx(i_,ym,v_,O_,J_,Bg,B_,b_,!1,ry),iy=4*Q1.length;const Lw=Fp.iconSizeData;let P1=null;Lw.kind==="source"?(P1=[mv*yg.layout.get("icon-size").evaluate(vm,{})],P1[0]>Mg&&$s(`${Fp.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Lw.kind==="composite"&&(P1=[mv*E_.compositeIconSizes[0].evaluate(vm,{},T_),mv*E_.compositeIconSizes[1].evaluate(vm,{},T_)],(P1[0]>Mg||P1[1]>Mg)&&$s(`${Fp.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Fp.addSymbols(Fp.icon,Q1,P1,w_,vg,vm,o.WritingMode.none,ym,k0.lineStartIndex,k0.lineLength,-1,T_),Fb=Fp.icon.placedSymbolArray.length-1,Px&&(_v=4*Px.length,Fp.addSymbols(Fp.icon,Px,P1,w_,vg,vm,o.WritingMode.vertical,ym,k0.lineStartIndex,k0.lineLength,-1,T_),tb=Fp.icon.placedSymbolArray.length-1)}const M1=Object.keys(_g.horizontal);for(const ry of M1){const Q0=_g.horizontal[ry];if(!Y0){Ub=ph(Q0.text);const Px=yg.layout.get("text-rotate").evaluate(vm,{},T_);Y0=new Kx(i_,ym,v_,O_,J_,Q0,Fg,x_,$_,Px)}const Q1=Q0.positionedLines.length===1;if(K1+=Mb(Fp,ym,Q0,i0,yg,$_,vm,ey,k0,_g.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Q1?M1:[ry],D0,Fb,E_,T_),Q1)break}_g.vertical&&(Aw+=Mb(Fp,ym,_g.vertical,i0,yg,$_,vm,ey,k0,o.WritingMode.vertical,["vertical"],D0,tb,E_,T_));const Ax=Y0?Y0.boxStartIndex:Fp.collisionBoxArray.length,Pw=Y0?Y0.boxEndIndex:Fp.collisionBoxArray.length,kw=r0?r0.boxStartIndex:Fp.collisionBoxArray.length,f2=r0?r0.boxEndIndex:Fp.collisionBoxArray.length,p2=gv?gv.boxStartIndex:Fp.collisionBoxArray.length,m2=gv?gv.boxEndIndex:Fp.collisionBoxArray.length,g2=Py?Py.boxStartIndex:Fp.collisionBoxArray.length,_2=Py?Py.boxEndIndex:Fp.collisionBoxArray.length;let K0=-1;const A1=(ry,Q0)=>ry&&ry.circleDiameter?Math.max(ry.circleDiameter,Q0):Q0;K0=A1(Y0,K0),K0=A1(r0,K0),K0=A1(gv,K0),K0=A1(Py,K0);const Dw=K0>-1?1:0;Dw&&(K0*=ty/$g),Fp.glyphOffsetArray.length>=H1.MAX_GLYPHS&&$s("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vm.sortKey!==void 0&&Fp.addToSortKeyRanges(Fp.symbolInstances.length,vm.sortKey),Fp.symbolInstances.emplaceBack(ym.x,ym.y,D0.right>=0?D0.right:-1,D0.center>=0?D0.center:-1,D0.left>=0?D0.left:-1,D0.vertical||-1,Fb,tb,Ub,Ax,Pw,kw,f2,p2,m2,g2,_2,v_,K1,Aw,iy,_v,Dw,0,Fg,S_,C1,K0)}(_,Gp,Qf,S,j,ut,Ep,_.layers[0],_.collisionBoxArray,p.index,p.sourceLayerIndex,_.index,Zh,[Nd,Nd,Nd,Nd],Ap,us,Bd,Ff,Bp,xh,p,Ot,ul,Ju,fi)};if(wp==="line")for(const Qf of Yx(p.geometry,0,0,fh,fh)){const Gp=yw(Qf,dd,Bf,S.vertical||bh,j,24,bd,_.overscaling,fh);for(const Fp of Gp)bh&&xw(_,bh.text,yp,Fp)||gp(Qf,Fp)}else if(wp==="line-center"){for(const Qf of p.geometry)if(Qf.length>1){const Gp=Wx(Qf,Bf,S.vertical||bh,j,24,bd);Gp&&gp(Qf,Gp)}}else if(p.type==="Polygon")for(const Qf of $x(p.geometry,0)){const Gp=vw(Qf,16);gp(Qf[0],new H0(Gp.x,Gp.y,0))}else if(p.type==="LineString")for(const Qf of p.geometry)gp(Qf,new H0(Qf[0].x,Qf[0].y,0));else if(p.type==="Point")for(const Qf of p.geometry)for(const Gp of Qf)gp([Gp],new H0(Gp.x,Gp.y,0))}const Mg=32640;function Mb(_,p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh){const Wh=function(Bd,dd,Nd,Ff,Bf,Ap,Bp,wp){const yp=Ff.layout.get("text-rotate").evaluate(Ap,{})*Math.PI/180,cp=[];for(const Ep of dd.positionedLines)for(const gp of Ep.positionedGlyphs){if(!gp.rect)continue;const Qf=gp.rect||{};let Gp=4,Fp=!0,ym=1,ug=0;const _g=(Bf||wp)&&gp.vertical,Bg=gp.metrics.advance*gp.scale/2;if(wp&&dd.verticalizable&&(ug=Ep.lineOffset/2-(gp.imageName?-($g-gp.metrics.width*gp.scale)/2:(gp.scale-1)*$g)),gp.imageName){const vg=Bp[gp.imageName];Fp=vg.sdf,ym=vg.pixelRatio,Gp=1/ym}const i0=Bf?[gp.x+Bg,gp.y]:[0,0];let a_=Bf?[0,0]:[gp.x+Bg+Nd[0],gp.y+Nd[1]-ug],yg=[0,0];_g&&(yg=a_,a_=[0,0]);const i_=(gp.metrics.left-Gp)*gp.scale-Bg+a_[0],v_=(-gp.metrics.top-Gp)*gp.scale+a_[1],O_=i_+Qf.w*gp.scale/ym,J_=v_+Qf.h*gp.scale/ym,Fg=new ud(i_,v_),x_=new ud(O_,v_),$_=new ud(i_,J_),ey=new ud(O_,J_);if(_g){const vg=new ud(-Bg,Bg-V1),w_=-Math.PI/2,vm=12-Bg,E_=new ud(22-vm,-(gp.imageName?vm:0)),qg=new ud(...yg);Fg._rotateAround(w_,vg)._add(E_)._add(qg),x_._rotateAround(w_,vg)._add(E_)._add(qg),$_._rotateAround(w_,vg)._add(E_)._add(qg),ey._rotateAround(w_,vg)._add(E_)._add(qg)}if(yp){const vg=Math.sin(yp),w_=Math.cos(yp),vm=[w_,-vg,vg,w_];Fg._matMult(vm),x_._matMult(vm),$_._matMult(vm),ey._matMult(vm)}const B_=new ud(0,0),b_=new ud(0,0);cp.push({tl:Fg,tr:x_,bl:$_,br:ey,tex:Qf,writingMode:dd.writingMode,glyphOffset:i0,sectionIndex:gp.sectionIndex,isSDF:Fp,pixelOffsetTL:B_,pixelOffsetBR:b_,minFontScaleX:0,minFontScaleY:0})}return cp}(0,S,Bn,ut,Ot,fi,j,_.allowVerticalPlacement),Zh=_.textSizeData;let bd=null;Zh.kind==="source"?(bd=[mv*ut.layout.get("text-size").evaluate(fi,{})],bd[0]>Mg&&$s(`${_.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Zh.kind==="composite"&&(bd=[mv*xh.compositeTextSizes[0].evaluate(fi,{},bh),mv*xh.compositeTextSizes[1].evaluate(fi,{},bh)],(bd[0]>Mg||bd[1]>Mg)&&$s(`${_.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),_.addSymbols(_.text,Wh,bd,Bn,Ot,fi,ul,p,us.lineStartIndex,us.lineLength,gh,bh);for(const Bd of Ju)oh[Bd]=_.text.placedSymbolArray.length-1;return 4*Wh.length}function o_(_){for(const p in _)return _[p];return null}function xw(_,p,S,j){const ut=_.compareText;if(p in ut){const Ot=ut[p];for(let fi=Ot.length-1;fi>=0;fi--)if(j.dist(Ot[fi])<S)return!0}else ut[p]=[];return ut[p].push(j),!1}const Z1=Wv.VectorTileFeature.types,Ab=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bx(_,p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh){const xh=Bn?Math.min(Mg,Math.round(Bn[0])):0,bh=Bn?Math.min(Mg,Math.round(Bn[1])):0;_.emplaceBack(p,S,Math.round(32*j),Math.round(32*ut),Ot,fi,(xh<<1)+(us?1:0),bh,16*ul,16*Ju,256*oh,256*gh)}function wx(_,p,S){_.emplaceBack(p.x,p.y,S),_.emplaceBack(p.x,p.y,S),_.emplaceBack(p.x,p.y,S),_.emplaceBack(p.x,p.y,S)}function l2(_){for(const p of _.sections)if(am(p.text))return!0;return!1}class Ex{constructor(p){this.layoutVertexArray=new he,this.indexArray=new Ft,this.programConfigurations=p,this.segments=new ol,this.dynamicLayoutVertexArray=new g,this.opacityVertexArray=new A,this.hasVisibleVertices=!1,this.placedSymbolArray=new uv}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(p,S,j,ut){this.isEmpty()||(j&&(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,qx.members),this.indexBuffer=p.createIndexBuffer(this.indexArray,S),this.dynamicLayoutVertexBuffer=p.createVertexBuffer(this.dynamicLayoutVertexArray,sw.members,!0),this.opacityVertexBuffer=p.createVertexBuffer(this.opacityVertexArray,Ab,!0),this.opacityVertexBuffer.itemSize=1),(j||ut)&&this.programConfigurations.upload(p))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tp("SymbolBuffers",Ex);class Qx{constructor(p,S,j){this.layoutVertexArray=new p,this.layoutAttributes=S,this.indexArray=new j,this.segments=new ol,this.collisionVertexArray=new nt}upload(p){this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=p.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=p.createVertexBuffer(this.collisionVertexArray,lw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tp("CollisionBuffers",Qx);class H1{constructor(p){this.collisionBoxArray=p.collisionBoxArray,this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(fi=>fi.id),this.index=p.index,this.pixelRatio=p.pixelRatio,this.sourceLayerIndex=p.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Dp([]),this.placementViewportMatrix=Dp([]);const S=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_w(this.zoom,S["text-size"]),this.iconSizeData=_w(this.zoom,S["icon-size"]);const j=this.layers[0].layout,ut=j.get("symbol-sort-key"),Ot=j.get("symbol-z-order");this.canOverlap=Sx(j,"text-overlap","text-allow-overlap")!=="never"||Sx(j,"icon-overlap","icon-allow-overlap")!=="never"||j.get("text-ignore-placement")||j.get("icon-ignore-placement"),this.sortFeaturesByKey=Ot!=="viewport-y"&&!ut.isConstant(),this.sortFeaturesByY=(Ot==="viewport-y"||Ot==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,j.get("symbol-placement")==="point"&&(this.writingModes=j.get("text-writing-mode").map(fi=>o.WritingMode[fi])),this.stateDependentLayerIds=this.layers.filter(fi=>fi.isStateDependent()).map(fi=>fi.id),this.sourceID=p.sourceID}createArrays(){this.text=new Ex(new tl(this.layers,this.zoom,p=>/^text/.test(p))),this.icon=new Ex(new tl(this.layers,this.zoom,p=>/^icon/.test(p))),this.glyphOffsetArray=new S0,this.lineVertexArray=new Mv,this.symbolInstances=new R1}calculateGlyphDependencies(p,S,j,ut,Ot){for(let fi=0;fi<p.length;fi++)if(S[p.charCodeAt(fi)]=!0,(j||ut)&&Ot){const Bn=Dv[p.charAt(fi)];Bn&&(S[Bn.charCodeAt(0)]=!0)}}populate(p,S,j){const ut=this.layers[0],Ot=ut.layout,fi=Ot.get("text-font"),Bn=Ot.get("text-field"),us=Ot.get("icon-image"),ul=(Bn.value.kind!=="constant"||Bn.value.value instanceof lm&&!Bn.value.value.isEmpty()||Bn.value.value.toString().length>0)&&(fi.value.kind!=="constant"||fi.value.value.length>0),Ju=us.value.kind!=="constant"||!!us.value.value||Object.keys(us.parameters).length>0,oh=Ot.get("symbol-sort-key");if(this.features=[],!ul&&!Ju)return;const gh=S.iconDependencies,xh=S.glyphDependencies,bh=S.availableImages,Wh=new Cm(this.zoom);for(const{feature:Zh,id:bd,index:Bd,sourceLayerIndex:dd}of p){const Nd=ut._featureFilter.needGeometry,Ff=Ch(Zh,Nd);if(!ut._featureFilter.filter(Wh,Ff,j))continue;let Bf,Ap;if(Nd||(Ff.geometry=Th(Zh)),ul){const wp=ut.getValueAndResolveTokens("text-field",Ff,j,bh),yp=lm.factory(wp);l2(yp)&&(this.hasRTLText=!0),(!this.hasRTLText||Gg()==="unavailable"||this.hasRTLText&&Ig.isParsed())&&(Bf=hw(yp,ut,Ff))}if(Ju){const wp=ut.getValueAndResolveTokens("icon-image",Ff,j,bh);Ap=wp instanceof Hf?wp:Hf.fromString(wp)}if(!Bf&&!Ap)continue;const Bp=this.sortFeaturesByKey?oh.evaluate(Ff,{},j):void 0;if(this.features.push({id:bd,text:Bf,icon:Ap,index:Bd,sourceLayerIndex:dd,geometry:Ff.geometry,properties:Zh.properties,type:Z1[Zh.type],sortKey:Bp}),Ap&&(gh[Ap.name]=!0),Bf){const wp=fi.evaluate(Ff,{},j).join(","),yp=Ot.get("text-rotation-alignment")!=="viewport"&&Ot.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const cp of Bf.sections)if(cp.image)gh[cp.image.name]=!0;else{const Ep=Zy(Bf.toString()),gp=cp.fontStack||wp,Qf=xh[gp]=xh[gp]||{};this.calculateGlyphDependencies(cp.text,Qf,yp,this.allowVerticalPlacement,Ep)}}}Ot.get("symbol-placement")==="line"&&(this.features=function(Zh){const bd={},Bd={},dd=[];let Nd=0;function Ff(wp){dd.push(Zh[wp]),Nd++}function Bf(wp,yp,cp){const Ep=Bd[wp];return delete Bd[wp],Bd[yp]=Ep,dd[Ep].geometry[0].pop(),dd[Ep].geometry[0]=dd[Ep].geometry[0].concat(cp[0]),Ep}function Ap(wp,yp,cp){const Ep=bd[yp];return delete bd[yp],bd[wp]=Ep,dd[Ep].geometry[0].shift(),dd[Ep].geometry[0]=cp[0].concat(dd[Ep].geometry[0]),Ep}function Bp(wp,yp,cp){const Ep=cp?yp[0][yp[0].length-1]:yp[0][0];return`${wp}:${Ep.x}:${Ep.y}`}for(let wp=0;wp<Zh.length;wp++){const yp=Zh[wp],cp=yp.geometry,Ep=yp.text?yp.text.toString():null;if(!Ep){Ff(wp);continue}const gp=Bp(Ep,cp),Qf=Bp(Ep,cp,!0);if(gp in Bd&&Qf in bd&&Bd[gp]!==bd[Qf]){const Gp=Ap(gp,Qf,cp),Fp=Bf(gp,Qf,dd[Gp].geometry);delete bd[gp],delete Bd[Qf],Bd[Bp(Ep,dd[Fp].geometry,!0)]=Fp,dd[Gp].geometry=null}else gp in Bd?Bf(gp,Qf,cp):Qf in bd?Ap(gp,Qf,cp):(Ff(wp),bd[gp]=Nd-1,Bd[Qf]=Nd-1)}return dd.filter(wp=>wp.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Zh,bd)=>Zh.sortKey-bd.sortKey)}update(p,S,j){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(p,S,this.layers,j),this.icon.programConfigurations.updatePaintArrays(p,S,this.layers,j))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(p){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(p),this.iconCollisionBox.upload(p)),this.text.upload(p,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(p,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(p,S){const j=this.lineVertexArray.length;if(p.segment!==void 0){let ut=p.dist(S[p.segment+1]),Ot=p.dist(S[p.segment]);const fi={};for(let Bn=p.segment+1;Bn<S.length;Bn++)fi[Bn]={x:S[Bn].x,y:S[Bn].y,tileUnitDistanceFromAnchor:ut},Bn<S.length-1&&(ut+=S[Bn+1].dist(S[Bn]));for(let Bn=p.segment||0;Bn>=0;Bn--)fi[Bn]={x:S[Bn].x,y:S[Bn].y,tileUnitDistanceFromAnchor:Ot},Bn>0&&(Ot+=S[Bn-1].dist(S[Bn]));for(let Bn=0;Bn<S.length;Bn++){const us=fi[Bn];this.lineVertexArray.emplaceBack(us.x,us.y,us.tileUnitDistanceFromAnchor)}}return{lineStartIndex:j,lineLength:this.lineVertexArray.length-j}}addSymbols(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh){const xh=p.indexArray,bh=p.layoutVertexArray,Wh=p.segments.prepareSegment(4*S.length,bh,xh,this.canOverlap?fi.sortKey:void 0),Zh=this.glyphOffsetArray.length,bd=Wh.vertexLength,Bd=this.allowVerticalPlacement&&Bn===o.WritingMode.vertical?Math.PI/2:0,dd=fi.text&&fi.text.sections;for(let Nd=0;Nd<S.length;Nd++){const{tl:Ff,tr:Bf,bl:Ap,br:Bp,tex:wp,pixelOffsetTL:yp,pixelOffsetBR:cp,minFontScaleX:Ep,minFontScaleY:gp,glyphOffset:Qf,isSDF:Gp,sectionIndex:Fp}=S[Nd],ym=Wh.vertexLength,ug=Qf[1];bx(bh,us.x,us.y,Ff.x,ug+Ff.y,wp.x,wp.y,j,Gp,yp.x,yp.y,Ep,gp),bx(bh,us.x,us.y,Bf.x,ug+Bf.y,wp.x+wp.w,wp.y,j,Gp,cp.x,yp.y,Ep,gp),bx(bh,us.x,us.y,Ap.x,ug+Ap.y,wp.x,wp.y+wp.h,j,Gp,yp.x,cp.y,Ep,gp),bx(bh,us.x,us.y,Bp.x,ug+Bp.y,wp.x+wp.w,wp.y+wp.h,j,Gp,cp.x,cp.y,Ep,gp),wx(p.dynamicLayoutVertexArray,us,Bd),xh.emplaceBack(ym,ym+1,ym+2),xh.emplaceBack(ym+1,ym+2,ym+3),Wh.vertexLength+=4,Wh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qf[0]),Nd!==S.length-1&&Fp===S[Nd+1].sectionIndex||p.programConfigurations.populatePaintArrays(bh.length,fi,fi.index,{},gh,dd&&dd[Fp])}p.placedSymbolArray.emplaceBack(us.x,us.y,Zh,this.glyphOffsetArray.length-Zh,bd,ul,Ju,us.segment,j?j[0]:0,j?j[1]:0,ut[0],ut[1],Bn,0,!1,0,oh)}_addCollisionDebugVertex(p,S,j,ut,Ot,fi){return S.emplaceBack(0,0),p.emplaceBack(j.x,j.y,ut,Ot,Math.round(fi.x),Math.round(fi.y))}addCollisionDebugVertices(p,S,j,ut,Ot,fi,Bn){const us=Ot.segments.prepareSegment(4,Ot.layoutVertexArray,Ot.indexArray),ul=us.vertexLength,Ju=Ot.layoutVertexArray,oh=Ot.collisionVertexArray,gh=Bn.anchorX,xh=Bn.anchorY;this._addCollisionDebugVertex(Ju,oh,fi,gh,xh,new ud(p,S)),this._addCollisionDebugVertex(Ju,oh,fi,gh,xh,new ud(j,S)),this._addCollisionDebugVertex(Ju,oh,fi,gh,xh,new ud(j,ut)),this._addCollisionDebugVertex(Ju,oh,fi,gh,xh,new ud(p,ut)),us.vertexLength+=4;const bh=Ot.indexArray;bh.emplaceBack(ul,ul+1),bh.emplaceBack(ul+1,ul+2),bh.emplaceBack(ul+2,ul+3),bh.emplaceBack(ul+3,ul),us.primitiveLength+=4}addDebugCollisionBoxes(p,S,j,ut){for(let Ot=p;Ot<S;Ot++){const fi=this.collisionBoxArray.get(Ot);this.addCollisionDebugVertices(fi.x1,fi.y1,fi.x2,fi.y2,ut?this.textCollisionBox:this.iconCollisionBox,fi.anchorPoint,j)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qx(q,uw.members,Xr),this.iconCollisionBox=new Qx(q,uw.members,Xr);for(let p=0;p<this.symbolInstances.length;p++){const S=this.symbolInstances.get(p);this.addDebugCollisionBoxes(S.textBoxStartIndex,S.textBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.iconBoxStartIndex,S.iconBoxEndIndex,S,!1),this.addDebugCollisionBoxes(S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,!1)}}_deserializeCollisionBoxesForSymbol(p,S,j,ut,Ot,fi,Bn,us,ul){const Ju={};for(let oh=S;oh<j;oh++){const gh=p.get(oh);Ju.textBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.textFeatureIndex=gh.featureIndex;break}for(let oh=ut;oh<Ot;oh++){const gh=p.get(oh);Ju.verticalTextBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.verticalTextFeatureIndex=gh.featureIndex;break}for(let oh=fi;oh<Bn;oh++){const gh=p.get(oh);Ju.iconBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.iconFeatureIndex=gh.featureIndex;break}for(let oh=us;oh<ul;oh++){const gh=p.get(oh);Ju.verticalIconBox={x1:gh.x1,y1:gh.y1,x2:gh.x2,y2:gh.y2,anchorPointX:gh.anchorPointX,anchorPointY:gh.anchorPointY},Ju.verticalIconFeatureIndex=gh.featureIndex;break}return Ju}deserializeCollisionBoxes(p){this.collisionArrays=[];for(let S=0;S<this.symbolInstances.length;S++){const j=this.symbolInstances.get(S);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(p,j.textBoxStartIndex,j.textBoxEndIndex,j.verticalTextBoxStartIndex,j.verticalTextBoxEndIndex,j.iconBoxStartIndex,j.iconBoxEndIndex,j.verticalIconBoxStartIndex,j.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(p,S){const j=p.placedSymbolArray.get(S),ut=j.vertexStartIndex+4*j.numGlyphs;for(let Ot=j.vertexStartIndex;Ot<ut;Ot+=4)p.indexArray.emplaceBack(Ot,Ot+1,Ot+2),p.indexArray.emplaceBack(Ot+1,Ot+2,Ot+3)}getSortedSymbolIndexes(p){if(this.sortedAngle===p&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const S=Math.sin(p),j=Math.cos(p),ut=[],Ot=[],fi=[];for(let Bn=0;Bn<this.symbolInstances.length;++Bn){fi.push(Bn);const us=this.symbolInstances.get(Bn);ut.push(0|Math.round(S*us.anchorX+j*us.anchorY)),Ot.push(us.featureIndex)}return fi.sort((Bn,us)=>ut[Bn]-ut[us]||Ot[us]-Ot[Bn]),fi}addToSortKeyRanges(p,S){const j=this.sortKeyRanges[this.sortKeyRanges.length-1];j&&j.sortKey===S?j.symbolInstanceEnd=p+1:this.sortKeyRanges.push({sortKey:S,symbolInstanceStart:p,symbolInstanceEnd:p+1})}sortFeatures(p){if(this.sortFeaturesByY&&this.sortedAngle!==p&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(p),this.sortedAngle=p,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const S of this.symbolInstanceIndexes){const j=this.symbolInstances.get(S);this.featureSortOrder.push(j.featureIndex),[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach((ut,Ot,fi)=>{ut>=0&&fi.indexOf(ut)===Ot&&this.addIndicesForPlacedSymbol(this.text,ut)}),j.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,j.verticalPlacedTextSymbolIndex),j.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,j.placedIconSymbolIndex),j.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,j.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tp("SymbolBucket",H1,{omit:["layers","collisionBoxArray","features","compareText"]}),H1.MAX_GLYPHS=65535,H1.addDynamicAttributes=wx;const Rv=new tg({"symbol-placement":new kp(td.layout_symbol["symbol-placement"]),"symbol-spacing":new kp(td.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kp(td.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Up(td.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kp(td.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new kp(td.layout_symbol["icon-allow-overlap"]),"icon-overlap":new kp(td.layout_symbol["icon-overlap"]),"icon-ignore-placement":new kp(td.layout_symbol["icon-ignore-placement"]),"icon-optional":new kp(td.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kp(td.layout_symbol["icon-rotation-alignment"]),"icon-size":new Up(td.layout_symbol["icon-size"]),"icon-text-fit":new kp(td.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kp(td.layout_symbol["icon-text-fit-padding"]),"icon-image":new Up(td.layout_symbol["icon-image"]),"icon-rotate":new Up(td.layout_symbol["icon-rotate"]),"icon-padding":new Up(td.layout_symbol["icon-padding"]),"icon-keep-upright":new kp(td.layout_symbol["icon-keep-upright"]),"icon-offset":new Up(td.layout_symbol["icon-offset"]),"icon-anchor":new Up(td.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kp(td.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kp(td.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kp(td.layout_symbol["text-rotation-alignment"]),"text-field":new Up(td.layout_symbol["text-field"]),"text-font":new Up(td.layout_symbol["text-font"]),"text-size":new Up(td.layout_symbol["text-size"]),"text-max-width":new Up(td.layout_symbol["text-max-width"]),"text-line-height":new kp(td.layout_symbol["text-line-height"]),"text-letter-spacing":new Up(td.layout_symbol["text-letter-spacing"]),"text-justify":new Up(td.layout_symbol["text-justify"]),"text-radial-offset":new Up(td.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kp(td.layout_symbol["text-variable-anchor"]),"text-anchor":new Up(td.layout_symbol["text-anchor"]),"text-max-angle":new kp(td.layout_symbol["text-max-angle"]),"text-writing-mode":new kp(td.layout_symbol["text-writing-mode"]),"text-rotate":new Up(td.layout_symbol["text-rotate"]),"text-padding":new kp(td.layout_symbol["text-padding"]),"text-keep-upright":new kp(td.layout_symbol["text-keep-upright"]),"text-transform":new Up(td.layout_symbol["text-transform"]),"text-offset":new Up(td.layout_symbol["text-offset"]),"text-allow-overlap":new kp(td.layout_symbol["text-allow-overlap"]),"text-overlap":new kp(td.layout_symbol["text-overlap"]),"text-ignore-placement":new kp(td.layout_symbol["text-ignore-placement"]),"text-optional":new kp(td.layout_symbol["text-optional"])});var Ov={paint:new tg({"icon-opacity":new Up(td.paint_symbol["icon-opacity"]),"icon-color":new Up(td.paint_symbol["icon-color"]),"icon-halo-color":new Up(td.paint_symbol["icon-halo-color"]),"icon-halo-width":new Up(td.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Up(td.paint_symbol["icon-halo-blur"]),"icon-translate":new kp(td.paint_symbol["icon-translate"]),"icon-translate-anchor":new kp(td.paint_symbol["icon-translate-anchor"]),"text-opacity":new Up(td.paint_symbol["text-opacity"]),"text-color":new Up(td.paint_symbol["text-color"],{runtimeType:Zd,getOverride:_=>_.textColor,hasOverride:_=>!!_.textColor}),"text-halo-color":new Up(td.paint_symbol["text-halo-color"]),"text-halo-width":new Up(td.paint_symbol["text-halo-width"]),"text-halo-blur":new Up(td.paint_symbol["text-halo-blur"]),"text-translate":new kp(td.paint_symbol["text-translate"]),"text-translate-anchor":new kp(td.paint_symbol["text-translate-anchor"])}),layout:Rv};class Tx{constructor(p){if(p.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=p.property.overrides?p.property.overrides.runtimeType:fp,this.defaultValue=p}evaluate(p){if(p.formattedSection){const S=this.defaultValue.property.overrides;if(S&&S.hasOverride(p.formattedSection))return S.getOverride(p.formattedSection)}return p.feature&&p.featureState?this.defaultValue.evaluate(p.feature,p.featureState):this.defaultValue.property.specification.default}eachChild(p){this.defaultValue.isConstant()||p(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tp("FormatSectionOverride",Tx,{omit:["defaultValue"]});class w1 extends L_{constructor(p){super(p,Ov)}recalculate(p,S){if(super.recalculate(p,S),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const j=this.layout.get("text-writing-mode");if(j){const ut=[];for(const Ot of j)ut.indexOf(Ot)<0&&ut.push(Ot);this.layout._values["text-writing-mode"]=ut}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(p,S,j,ut){const Ot=this.layout.get(p).evaluate(S,{},j,ut),fi=this._unevaluatedLayout._values[p];return fi.isDataDriven()||q_(fi.value)||!Ot?Ot:function(Bn,us){return us.replace(/{([^{}]+)}/g,(ul,Ju)=>Ju in Bn?String(Bn[Ju]):"")}(S.properties,Ot)}createBucket(p){return new H1(p)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const p of Ov.paint.overridableProperties){if(!w1.hasPaintOverride(this.layout,p))continue;const S=this.paint.get(p),j=new Tx(S),ut=new zy(j,S.property.specification);let Ot=null;Ot=S.value.kind==="constant"||S.value.kind==="source"?new c0("source",ut):new u0("composite",ut,S.value.zoomStops),this.paint._values[p]=new e_(S.property,Ot,S.parameters)}}_handleOverridablePaintPropertyUpdate(p,S,j){return!(!this.layout||S.isDataDriven()||j.isDataDriven())&&w1.hasPaintOverride(this.layout,p)}static hasPaintOverride(p,S){const j=p.get("text-field"),ut=Ov.paint.properties[S];let Ot=!1;const fi=Bn=>{for(const us of Bn)if(ut.overrides&&ut.overrides.hasOverride(us))return void(Ot=!0)};if(j.value.kind==="constant"&&j.value.value instanceof lm)fi(j.value.value.sections);else if(j.value.kind==="source"){const Bn=ul=>{Ot||(ul instanceof Gn&&Wu(ul.value)===If?fi(ul.value.sections):ul instanceof o0?fi(ul.sections):ul.eachChild(Bn))},us=j.value;us._styleExpression&&Bn(us._styleExpression.expression)}return Ot}}function Sx(_,p,S){let j="never";const ut=_.get(p);return ut?j=ut:_.get(S)&&(j="always"),j}var bw={paint:new tg({"background-color":new kp(td.paint_background["background-color"]),"background-pattern":new N0(td.paint_background["background-pattern"]),"background-opacity":new kp(td.paint_background["background-opacity"])})},c2={paint:new tg({"raster-opacity":new kp(td.paint_raster["raster-opacity"]),"raster-hue-rotate":new kp(td.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kp(td.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kp(td.paint_raster["raster-brightness-max"]),"raster-saturation":new kp(td.paint_raster["raster-saturation"]),"raster-contrast":new kp(td.paint_raster["raster-contrast"]),"raster-resampling":new kp(td.paint_raster["raster-resampling"]),"raster-fade-duration":new kp(td.paint_raster["raster-fade-duration"])})};class ww extends L_{constructor(p){super(p,{}),this.onAdd=S=>{this.implementation.onAdd&&this.implementation.onAdd(S,S.painter.context.gl)},this.onRemove=S=>{this.implementation.onRemove&&this.implementation.onRemove(S,S.painter.context.gl)},this.implementation=p}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const u2={circle:class extends L_{constructor(_){super(_,$d)}createBucket(_){return new Oh(_)}queryRadius(_){const p=_;return Ud("circle-radius",this,p)+Ud("circle-stroke-width",this,p)+Lf(this.paint.get("circle-translate"))}queryIntersectsFeature(_,p,S,j,ut,Ot,fi,Bn){const us=Cd(_,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),Ot.angle,fi),ul=this.paint.get("circle-radius").evaluate(p,S)+this.paint.get("circle-stroke-width").evaluate(p,S),Ju=this.paint.get("circle-pitch-alignment")==="map",oh=Ju?us:function(xh,bh){return xh.map(Wh=>dm(Wh,bh))}(us,Bn),gh=Ju?ul*fi:ul;for(const xh of j)for(const bh of xh){const Wh=Ju?bh:dm(bh,Bn);let Zh=gh;const bd=Lp([],[bh.x,bh.y,0,1],Bn);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Zh*=bd[3]/Ot.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Zh*=Ot.cameraToCenterDistance/bd[3]),Nh(oh,Wh,Zh))return!0}return!1}},heatmap:class extends L_{createBucket(_){return new zp(_)}constructor(_){super(_,km),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(_){_==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends L_{constructor(_){super(_,V0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends L_{constructor(_){super(_,Av)}recalculate(_,p){super.recalculate(_,p);const S=this.paint._values["fill-outline-color"];S.value.kind==="constant"&&S.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(_){return new cx(_)}queryRadius(){return Lf(this.paint.get("fill-translate"))}queryIntersectsFeature(_,p,S,j,ut,Ot,fi){return qh(Cd(_,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),Ot.angle,fi),j)}isTileClipped(){return!0}},"fill-extrusion":class extends L_{constructor(_){super(_,t2)}createBucket(_){return new Fx(_)}queryRadius(){return Lf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(_,p,S,j,ut,Ot,fi,Bn){const us=Cd(_,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),Ot.angle,fi),ul=this.paint.get("fill-extrusion-height").evaluate(p,S),Ju=this.paint.get("fill-extrusion-base").evaluate(p,S),oh=function(xh,bh,Wh,Zh){const bd=[];for(const Bd of xh){const dd=[Bd.x,Bd.y,0,1];Lp(dd,dd,bh),bd.push(new ud(dd[0]/dd[3],dd[1]/dd[3]))}return bd}(us,Bn),gh=function(xh,bh,Wh,Zh){const bd=[],Bd=[],dd=Zh[8]*bh,Nd=Zh[9]*bh,Ff=Zh[10]*bh,Bf=Zh[11]*bh,Ap=Zh[8]*Wh,Bp=Zh[9]*Wh,wp=Zh[10]*Wh,yp=Zh[11]*Wh;for(const cp of xh){const Ep=[],gp=[];for(const Qf of cp){const Gp=Qf.x,Fp=Qf.y,ym=Zh[0]*Gp+Zh[4]*Fp+Zh[12],ug=Zh[1]*Gp+Zh[5]*Fp+Zh[13],_g=Zh[2]*Gp+Zh[6]*Fp+Zh[14],Bg=Zh[3]*Gp+Zh[7]*Fp+Zh[15],i0=_g+Ff,a_=Bg+Bf,yg=ym+Ap,i_=ug+Bp,v_=_g+wp,O_=Bg+yp,J_=new ud((ym+dd)/a_,(ug+Nd)/a_);J_.z=i0/a_,Ep.push(J_);const Fg=new ud(yg/O_,i_/O_);Fg.z=v_/O_,gp.push(Fg)}bd.push(Ep),Bd.push(gp)}return[bd,Bd]}(j,Ju,ul,Bn);return function(xh,bh,Wh){let Zh=1/0;qh(Wh,bh)&&(Zh=Og(Wh,bh[0]));for(let bd=0;bd<bh.length;bd++){const Bd=bh[bd],dd=xh[bd];for(let Nd=0;Nd<Bd.length-1;Nd++){const Ff=Bd[Nd],Bf=[Ff,Bd[Nd+1],dd[Nd+1],dd[Nd],Ff];Rh(Wh,Bf)&&(Zh=Math.min(Zh,Og(Wh,Bf)))}}return Zh!==1/0&&Zh}(gh[0],gh[1],oh)}},line:class extends L_{constructor(_){super(_,F1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(_){_==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Jp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(_,p){super.recalculate(_,p),this.paint._values["line-floorwidth"]=Jv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,_)}createBucket(_){return new fx(_)}queryRadius(_){const p=_,S=jx(Ud("line-width",this,p),Ud("line-gap-width",this,p)),j=Ud("line-offset",this,p);return S/2+Math.abs(j)+Lf(this.paint.get("line-translate"))}queryIntersectsFeature(_,p,S,j,ut,Ot,fi){const Bn=Cd(_,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),Ot.angle,fi),us=fi/2*jx(this.paint.get("line-width").evaluate(p,S),this.paint.get("line-gap-width").evaluate(p,S)),ul=this.paint.get("line-offset").evaluate(p,S);return ul&&(j=function(Ju,oh){const gh=[];for(let xh=0;xh<Ju.length;xh++){const bh=Ju[xh],Wh=[];for(let Zh=0;Zh<bh.length;Zh++){const bd=bh[Zh-1],Bd=bh[Zh],dd=bh[Zh+1],Nd=Zh===0?new ud(0,0):Bd.sub(bd)._unit()._perp(),Ff=Zh===bh.length-1?new ud(0,0):dd.sub(Bd)._unit()._perp(),Bf=Nd._add(Ff)._unit(),Ap=Bf.x*Ff.x+Bf.y*Ff.y;Ap!==0&&Bf._mult(1/Ap),Wh.push(Bf._mult(oh)._add(Bd))}gh.push(Wh)}return gh}(j,ul*fi)),function(Ju,oh,gh){for(let xh=0;xh<oh.length;xh++){const bh=oh[xh];if(Ju.length>=3){for(let Wh=0;Wh<bh.length;Wh++)if(_d(Ju,bh[Wh]))return!0}if(Fh(Ju,bh,gh))return!0}return!1}(Bn,j,us)}isTileClipped(){return!0}},symbol:w1,background:class extends L_{constructor(_){super(_,bw)}},raster:class extends L_{constructor(_){super(_,c2)}}};class Pb{constructor(p){this._callback=p,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const kb=63710088e-1;class Sg{constructor(p,S){if(isNaN(p)||isNaN(S))throw new Error(`Invalid LngLat object: (${p}, ${S})`);if(this.lng=+p,this.lat=+S,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sg(ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(p){const S=Math.PI/180,j=this.lat*S,ut=p.lat*S,Ot=Math.sin(j)*Math.sin(ut)+Math.cos(j)*Math.cos(ut)*Math.cos((p.lng-this.lng)*S);return kb*Math.acos(Math.min(Ot,1))}toBounds(p=0){const S=360*p/40075017,j=S/Math.cos(Math.PI/180*this.lat);return new Db(new Sg(this.lng-j,this.lat-S),new Sg(this.lng+j,this.lat+S))}static convert(p){if(p instanceof Sg)return p;if(Array.isArray(p)&&(p.length===2||p.length===3))return new Sg(Number(p[0]),Number(p[1]));if(!Array.isArray(p)&&typeof p=="object"&&p!==null)return new Sg(Number("lng"in p?p.lng:p.lon),Number(p.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class E1{constructor(p,S){p&&(S?this.setSouthWest(p).setNorthEast(S):p.length===4?this.setSouthWest([p[0],p[1]]).setNorthEast([p[2],p[3]]):this.setSouthWest(p[0]).setNorthEast(p[1]))}setNorthEast(p){return this._ne=p instanceof Sg?new Sg(p.lng,p.lat):Sg.convert(p),this}setSouthWest(p){return this._sw=p instanceof Sg?new Sg(p.lng,p.lat):Sg.convert(p),this}extend(p){const S=this._sw,j=this._ne;let ut,Ot;if(p instanceof Sg)ut=p,Ot=p;else{if(!(p instanceof E1))return Array.isArray(p)?p.length===4||p.every(Array.isArray)?this.extend(E1.convert(p)):this.extend(Sg.convert(p)):this;if(ut=p._sw,Ot=p._ne,!ut||!Ot)return this}return S||j?(S.lng=Math.min(ut.lng,S.lng),S.lat=Math.min(ut.lat,S.lat),j.lng=Math.max(Ot.lng,j.lng),j.lat=Math.max(Ot.lat,j.lat)):(this._sw=new Sg(ut.lng,ut.lat),this._ne=new Sg(Ot.lng,Ot.lat)),this}getCenter(){return new Sg((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sg(this.getWest(),this.getNorth())}getSouthEast(){return new Sg(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(p){const{lng:S,lat:j}=Sg.convert(p);let ut=this._sw.lng<=S&&S<=this._ne.lng;return this._sw.lng>this._ne.lng&&(ut=this._sw.lng>=S&&S>=this._ne.lng),this._sw.lat<=j&&j<=this._ne.lat&&ut}static convert(p){return p instanceof E1?p:p&&new E1(p)}}var Db=E1;const i1=2*Math.PI*kb;function Lb(_){return i1*Math.cos(_*Math.PI/180)}function Ew(_){return(180+_)/360}function T1(_){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_*Math.PI/360)))/360}function Ix(_,p){return _/Lb(p)}function Jx(_){return 360/Math.PI*Math.atan(Math.exp((180-360*_)*Math.PI/180))-90}class Cx{constructor(p,S,j=0){this.x=+p,this.y=+S,this.z=+j}static fromLngLat(p,S=0){const j=Sg.convert(p);return new Cx(Ew(j.lng),T1(j.lat),Ix(S,j.lat))}toLngLat(){return new Sg(360*this.x-180,Jx(this.y))}toAltitude(){return this.z*Lb(Jx(this.y))}meterInMercatorCoordinateUnits(){return 1/i1*(p=Jx(this.y),1/Math.cos(p*Math.PI/180));var p}}function Tw(_,p,S){var j=2*Math.PI*6378137/256/Math.pow(2,S);return[_*j-2*Math.PI*6378137/2,p*j-2*Math.PI*6378137/2]}class Rb{constructor(p,S,j){if(p<0||p>25||j<0||j>=Math.pow(2,p)||S<0||S>=Math.pow(2,p))throw new Error(`x=${S}, y=${j}, z=${p} outside of bounds. 0<=x<${Math.pow(2,p)}, 0<=y<${Math.pow(2,p)} 0<=z<=25 `);this.z=p,this.x=S,this.y=j,this.key=X1(0,p,p,S,j)}equals(p){return this.z===p.z&&this.x===p.x&&this.y===p.y}url(p,S,j){const ut=(fi=this.y,Bn=this.z,us=Tw(256*(Ot=this.x),256*(fi=Math.pow(2,Bn)-fi-1),Bn),ul=Tw(256*(Ot+1),256*(fi+1),Bn),us[0]+","+us[1]+","+ul[0]+","+ul[1]);var Ot,fi,Bn,us,ul;const Ju=function(oh,gh,xh){let bh,Wh="";for(let Zh=oh;Zh>0;Zh--)bh=1<<Zh-1,Wh+=(gh&bh?1:0)+(xh&bh?2:0);return Wh}(this.z,this.x,this.y);return p[(this.x+this.y)%p.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(j==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,S>1?"@2x":"").replace(/{quadkey}/g,Ju).replace(/{bbox-epsg-3857}/g,ut)}isChildOf(p){const S=this.z-p.z;return S>0&&p.x===this.x>>S&&p.y===this.y>>S}getTilePoint(p){const S=Math.pow(2,this.z);return new ud((p.x*S-this.x)*fh,(p.y*S-this.y)*fh)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ob{constructor(p,S){this.wrap=p,this.canonical=S,this.key=X1(p,S.z,S.z,S.x,S.y)}}class t0{constructor(p,S,j,ut,Ot){if(p<j)throw new Error(`overscaledZ should be >= z; overscaledZ = ${p}; z = ${j}`);this.overscaledZ=p,this.wrap=S,this.canonical=new Rb(j,+ut,+Ot),this.key=X1(S,p,j,ut,Ot)}clone(){return new t0(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(p){return this.overscaledZ===p.overscaledZ&&this.wrap===p.wrap&&this.canonical.equals(p.canonical)}scaledTo(p){if(p>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${p}; overscaledZ = ${this.overscaledZ}`);const S=this.canonical.z-p;return p>this.canonical.z?new t0(p,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new t0(p,this.wrap,p,this.canonical.x>>S,this.canonical.y>>S)}calculateScaledKey(p,S){if(p>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${p}; overscaledZ = ${this.overscaledZ}`);const j=this.canonical.z-p;return p>this.canonical.z?X1(this.wrap*+S,p,this.canonical.z,this.canonical.x,this.canonical.y):X1(this.wrap*+S,p,p,this.canonical.x>>j,this.canonical.y>>j)}isChildOf(p){if(p.wrap!==this.wrap)return!1;const S=this.canonical.z-p.canonical.z;return p.overscaledZ===0||p.overscaledZ<this.overscaledZ&&p.canonical.x===this.canonical.x>>S&&p.canonical.y===this.canonical.y>>S}children(p){if(this.overscaledZ>=p)return[new t0(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const S=this.canonical.z+1,j=2*this.canonical.x,ut=2*this.canonical.y;return[new t0(S,this.wrap,S,j,ut),new t0(S,this.wrap,S,j+1,ut),new t0(S,this.wrap,S,j,ut+1),new t0(S,this.wrap,S,j+1,ut+1)]}isLessThan(p){return this.wrap<p.wrap||!(this.wrap>p.wrap)&&(this.overscaledZ<p.overscaledZ||!(this.overscaledZ>p.overscaledZ)&&(this.canonical.x<p.canonical.x||!(this.canonical.x>p.canonical.x)&&this.canonical.y<p.canonical.y))}wrapped(){return new t0(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(p){return new t0(this.overscaledZ,p,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ob(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(p){return this.canonical.getTilePoint(new Cx(p.x-this.wrap,p.y))}}function X1(_,p,S,j,ut){(_*=2)<0&&(_=-1*_-1);const Ot=1<<S;return(Ot*Ot*_+Ot*ut+j).toString(36)+S.toString(36)+p.toString(36)}tp("CanonicalTileID",Rb),tp("OverscaledTileID",t0,{omit:["posMatrix"]});class Sw{constructor(p,S,j){if(this.uid=p,S.height!==S.width)throw new RangeError("DEM tiles must be square");if(j&&j!=="mapbox"&&j!=="terrarium")return void $s(`"${j}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=S.height;const ut=this.dim=S.height-2;this.data=new Uint32Array(S.data.buffer),this.encoding=j||"mapbox";for(let Ot=0;Ot<ut;Ot++)this.data[this._idx(-1,Ot)]=this.data[this._idx(0,Ot)],this.data[this._idx(ut,Ot)]=this.data[this._idx(ut-1,Ot)],this.data[this._idx(Ot,-1)]=this.data[this._idx(Ot,0)],this.data[this._idx(Ot,ut)]=this.data[this._idx(Ot,ut-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ut,-1)]=this.data[this._idx(ut-1,0)],this.data[this._idx(-1,ut)]=this.data[this._idx(0,ut-1)],this.data[this._idx(ut,ut)]=this.data[this._idx(ut-1,ut-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Ot=0;Ot<ut;Ot++)for(let fi=0;fi<ut;fi++){const Bn=this.get(Ot,fi);Bn>this.max&&(this.max=Bn),Bn<this.min&&(this.min=Bn)}}get(p,S){const j=new Uint8Array(this.data.buffer),ut=4*this._idx(p,S);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(j[ut],j[ut+1],j[ut+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(p,S){if(p<-1||p>=this.dim+1||S<-1||S>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(S+1)*this.stride+(p+1)}_unpackMapbox(p,S,j){return(256*p*256+256*S+j)/10-1e4}_unpackTerrarium(p,S,j){return 256*p+S+j/256-32768}getPixels(){return new lg({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(p,S,j){if(this.dim!==p.dim)throw new Error("dem dimension mismatch");let ut=S*this.dim,Ot=S*this.dim+this.dim,fi=j*this.dim,Bn=j*this.dim+this.dim;switch(S){case-1:ut=Ot-1;break;case 1:Ot=ut+1}switch(j){case-1:fi=Bn-1;break;case 1:Bn=fi+1}const us=-S*this.dim,ul=-j*this.dim;for(let Ju=fi;Ju<Bn;Ju++)for(let oh=ut;oh<Ot;oh++)this.data[this._idx(oh,Ju)]=p.data[this._idx(oh+us,Ju+ul)]}}tp("DEMData",Sw);class Iw{constructor(p){this._stringToNumber={},this._numberToString=[];for(let S=0;S<p.length;S++){const j=p[S];this._stringToNumber[j]=S,this._numberToString[S]=j}}encode(p){return this._stringToNumber[p]}decode(p){if(p>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${p} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[p]}}class $b{constructor(p,S,j,ut,Ot){this.type="Feature",this._vectorTileFeature=p,p._z=S,p._x=j,p._y=ut,this.properties=p.properties,this.id=Ot}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(p){this._geometry=p}toJSON(){const p={geometry:this.geometry};for(const S in this)S!=="_geometry"&&S!=="_vectorTileFeature"&&(p[S]=this[S]);return p}}class Bb{constructor(p,S){this.tileID=p,this.x=p.canonical.x,this.y=p.canonical.y,this.z=p.canonical.z,this.grid=new ag(fh,16,0),this.grid3D=new ag(fh,16,0),this.featureIndexArray=new Ty,this.promoteId=S}insert(p,S,j,ut,Ot,fi){const Bn=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(j,ut,Ot);const us=fi?this.grid3D:this.grid;for(let ul=0;ul<S.length;ul++){const Ju=S[ul],oh=[1/0,1/0,-1/0,-1/0];for(let gh=0;gh<Ju.length;gh++){const xh=Ju[gh];oh[0]=Math.min(oh[0],xh.x),oh[1]=Math.min(oh[1],xh.y),oh[2]=Math.max(oh[2],xh.x),oh[3]=Math.max(oh[3],xh.y)}oh[0]<fh&&oh[1]<fh&&oh[2]>=0&&oh[3]>=0&&us.insert(Bn,oh[0],oh[1],oh[2],oh[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wv.VectorTile(new q0(this.rawTileData)).layers,this.sourceLayerCoder=new Iw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(p,S,j,ut){this.loadVTLayers();const Ot=p.params||{},fi=fh/p.tileSize/p.scale,Bn=_y(Ot.filter),us=p.queryGeometry,ul=p.queryPadding*fi,Ju=eb(us),oh=this.grid.query(Ju.minX-ul,Ju.minY-ul,Ju.maxX+ul,Ju.maxY+ul),gh=eb(p.cameraQueryGeometry),xh=this.grid3D.query(gh.minX-ul,gh.minY-ul,gh.maxX+ul,gh.maxY+ul,(Zh,bd,Bd,dd)=>function(Nd,Ff,Bf,Ap,Bp){for(const yp of Nd)if(Ff<=yp.x&&Bf<=yp.y&&Ap>=yp.x&&Bp>=yp.y)return!0;const wp=[new ud(Ff,Bf),new ud(Ff,Bp),new ud(Ap,Bp),new ud(Ap,Bf)];if(Nd.length>2){for(const yp of wp)if(_d(Nd,yp))return!0}for(let yp=0;yp<Nd.length-1;yp++)if(Cf(Nd[yp],Nd[yp+1],wp))return!0;return!1}(p.cameraQueryGeometry,Zh-ul,bd-ul,Bd+ul,dd+ul));for(const Zh of xh)oh.push(Zh);oh.sort($v);const bh={};let Wh;for(let Zh=0;Zh<oh.length;Zh++){const bd=oh[Zh];if(bd===Wh)continue;Wh=bd;const Bd=this.featureIndexArray.get(bd);let dd=null;this.loadMatchingFeature(bh,Bd.bucketIndex,Bd.sourceLayerIndex,Bd.featureIndex,Bn,Ot.layers,Ot.availableImages,S,j,ut,(Nd,Ff,Bf)=>(dd||(dd=Th(Nd)),Ff.queryIntersectsFeature(us,Nd,Bf,dd,this.z,p.transform,fi,p.pixelPosMatrix)))}return bh}loadMatchingFeature(p,S,j,ut,Ot,fi,Bn,us,ul,Ju,oh){const gh=this.bucketLayerIDs[S];if(fi&&!function(Zh,bd){for(let Bd=0;Bd<Zh.length;Bd++)if(bd.indexOf(Zh[Bd])>=0)return!0;return!1}(fi,gh))return;const xh=this.sourceLayerCoder.decode(j),bh=this.vtLayers[xh].feature(ut);if(Ot.needGeometry){const Zh=Ch(bh,!0);if(!Ot.filter(new Cm(this.tileID.overscaledZ),Zh,this.tileID.canonical))return}else if(!Ot.filter(new Cm(this.tileID.overscaledZ),bh))return;const Wh=this.getId(bh,xh);for(let Zh=0;Zh<gh.length;Zh++){const bd=gh[Zh];if(fi&&fi.indexOf(bd)<0)continue;const Bd=us[bd];if(!Bd)continue;let dd={};Wh&&Ju&&(dd=Ju.getState(Bd.sourceLayer||"_geojsonTileLayer",Wh));const Nd=Bt({},ul[bd]);Nd.paint=Nb(Nd.paint,Bd.paint,bh,dd,Bn),Nd.layout=Nb(Nd.layout,Bd.layout,bh,dd,Bn);const Ff=!oh||oh(bh,Bd,dd);if(!Ff)continue;const Bf=new $b(bh,this.z,this.x,this.y,Wh);Bf.layer=Nd;let Ap=p[bd];Ap===void 0&&(Ap=p[bd]=[]),Ap.push({featureIndex:ut,feature:Bf,intersectionZ:Ff})}}lookupSymbolFeatures(p,S,j,ut,Ot,fi,Bn,us){const ul={};this.loadVTLayers();const Ju=_y(Ot);for(const oh of p)this.loadMatchingFeature(ul,j,ut,oh,Ju,fi,Bn,us,S);return ul}hasLayer(p){for(const S of this.bucketLayerIDs)for(const j of S)if(p===j)return!0;return!1}getId(p,S){let j=p.id;return this.promoteId&&(j=p.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[S]],typeof j=="boolean"&&(j=Number(j))),j}}function Nb(_,p,S,j,ut){return Io(_,(Ot,fi)=>{const Bn=p instanceof B0?p.get(fi):null;return Bn&&Bn.evaluate?Bn.evaluate(S,j,ut):Bn})}function eb(_){let p=1/0,S=1/0,j=-1/0,ut=-1/0;for(const Ot of _)p=Math.min(p,Ot.x),S=Math.min(S,Ot.y),j=Math.max(j,Ot.x),ut=Math.max(ut,Ot.y);return{minX:p,minY:S,maxX:j,maxY:ut}}function $v(_,p){return p-_}function Q_(_,p,S,j,ut,Ot){if(ut-j<=S)return;const fi=j+ut>>1;Cw(_,p,fi,j,ut,Ot%2),Q_(_,p,S,j,fi-1,Ot+1),Q_(_,p,S,fi+1,ut,Ot+1)}function Cw(_,p,S,j,ut,Ot){for(;ut>j;){if(ut-j>600){const ul=ut-j+1,Ju=S-j+1,oh=Math.log(ul),gh=.5*Math.exp(2*oh/3),xh=.5*Math.sqrt(oh*gh*(ul-gh)/ul)*(Ju-ul/2<0?-1:1);Cw(_,p,S,Math.max(j,Math.floor(S-Ju*gh/ul+xh)),Math.min(ut,Math.floor(S+(ul-Ju)*gh/ul+xh)),Ot)}const fi=p[2*S+Ot];let Bn=j,us=ut;for(S1(_,p,j,S),p[2*ut+Ot]>fi&&S1(_,p,j,ut);Bn<us;){for(S1(_,p,Bn,us),Bn++,us--;p[2*Bn+Ot]<fi;)Bn++;for(;p[2*us+Ot]>fi;)us--}p[2*j+Ot]===fi?S1(_,p,j,us):(us++,S1(_,p,us,ut)),us<=S&&(j=us+1),S<=us&&(ut=us-1)}}function S1(_,p,S,j){zb(_,S,j),zb(p,2*S,2*j),zb(p,2*S+1,2*j+1)}function zb(_,p,S){const j=_[p];_[p]=_[S],_[S]=j}function Mw(_,p,S,j){const ut=_-S,Ot=p-j;return ut*ut+Ot*Ot}tp("FeatureIndex",Bb,{omit:["rawTileData","sourceLayerCoder"]});const h2=_=>_[0],W1=_=>_[1];var Y1;o.PerformanceMarkers=void 0,(Y1=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",Y1.load="load",Y1.fullLoad="fullLoad";let Mx=null,W0=[];const I1=1e3/30,d2={mark(_){performance.mark(_)},frame(_){const p=_;Mx!=null&&W0.push(p-Mx),Mx=p},clearMetrics(){Mx=null,W0=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const _ in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[_])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const _=performance.getEntriesByName("loadTime")[0].duration,p=performance.getEntriesByName("fullLoadTime")[0].duration,S=W0.length,j=1/(W0.reduce((Ot,fi)=>Ot+fi,0)/S/1e3),ut=W0.filter(Ot=>Ot>I1).reduce((Ot,fi)=>Ot+(fi-I1)/I1,0);return{loadTime:_,fullLoadTime:p,fps:j,percentDroppedFrames:ut/(S+ut)*100}}};o.AJAXError=Af,o.ARRAY_TYPE=$f,o.Actor=class{constructor(_,p,S){this.target=_,this.parent=p,this.mapId=S,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},kn(["receive","process"],this),this.invoker=new Pb(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zu()?_:window}send(_,p,S,j,ut=!1){const Ot=Math.round(1e18*Math.random()).toString(36).substring(0,10);S&&(this.callbacks[Ot]=S);const fi=al(this.globalScope)?void 0:[];return this.target.postMessage({id:Ot,type:_,hasCallback:!!S,targetMapId:j,mustQueue:ut,sourceMapId:this.mapId,data:Tg(p,fi)},fi),{cancel:()=>{S&&delete this.callbacks[Ot],this.target.postMessage({id:Ot,type:"<cancel>",targetMapId:j,sourceMapId:this.mapId})}}}receive(_){const p=_.data,S=p.id;if(S&&(!p.targetMapId||this.mapId===p.targetMapId))if(p.type==="<cancel>"){delete this.tasks[S];const j=this.cancelCallbacks[S];delete this.cancelCallbacks[S],j&&j()}else Zu()||p.mustQueue?(this.tasks[S]=p,this.taskQueue.push(S),this.invoker.trigger()):this.processTask(S,p)}process(){if(!this.taskQueue.length)return;const _=this.taskQueue.shift(),p=this.tasks[_];delete this.tasks[_],this.taskQueue.length&&this.invoker.trigger(),p&&this.processTask(_,p)}processTask(_,p){if(p.type==="<response>"){const S=this.callbacks[_];delete this.callbacks[_],S&&(p.error?S(fg(p.error)):S(null,fg(p.data)))}else{let S=!1;const j=al(this.globalScope)?void 0:[],ut=p.hasCallback?(Bn,us)=>{S=!0,delete this.cancelCallbacks[_],this.target.postMessage({id:_,type:"<response>",sourceMapId:this.mapId,error:Bn?Tg(Bn):null,data:Tg(us,j)},j)}:Bn=>{S=!0};let Ot=null;const fi=fg(p.data);if(this.parent[p.type])Ot=this.parent[p.type](p.sourceMapId,fi,ut);else if(this.parent.getWorkerSource){const Bn=p.type.split(".");Ot=this.parent.getWorkerSource(p.sourceMapId,Bn[0],fi.source)[Bn[1]](fi,ut)}else ut(new Error(`Could not find function ${p.type}`));!S&&Ot&&Ot.cancel&&(this.cancelCallbacks[_]=Ot.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=gg,o.CanonicalTileID=Rb,o.CollisionBoxArray=Iv,o.CollisionCircleLayoutArray=class extends Sv{},o.Color=hp,o.DEMData=Sw,o.DataConstantProperty=kp,o.DictionaryCoder=Iw,o.EXTENT=fh,o.ErrorEvent=bf,o.EvaluationParameters=Cm,o.Event=Gd,o.Evented=Id,o.FeatureIndex=Bb,o.FillBucket=cx,o.FillExtrusionBucket=Fx,o.GeoJSONFeature=$b,o.ImageAtlas=Hx,o.ImagePosition=_1,o.KDBush=class{constructor(_,p=h2,S=W1,j=64,ut=Float64Array){this.nodeSize=j,this.points=_;const Ot=_.length<65536?Uint16Array:Uint32Array,fi=this.ids=new Ot(_.length),Bn=this.coords=new ut(2*_.length);for(let us=0;us<_.length;us++)fi[us]=us,Bn[2*us]=p(_[us]),Bn[2*us+1]=S(_[us]);Q_(fi,Bn,j,0,fi.length-1,0)}range(_,p,S,j){return function(ut,Ot,fi,Bn,us,ul,Ju){const oh=[0,ut.length-1,0],gh=[];let xh,bh;for(;oh.length;){const Wh=oh.pop(),Zh=oh.pop(),bd=oh.pop();if(Zh-bd<=Ju){for(let Nd=bd;Nd<=Zh;Nd++)xh=Ot[2*Nd],bh=Ot[2*Nd+1],xh>=fi&&xh<=us&&bh>=Bn&&bh<=ul&&gh.push(ut[Nd]);continue}const Bd=Math.floor((bd+Zh)/2);xh=Ot[2*Bd],bh=Ot[2*Bd+1],xh>=fi&&xh<=us&&bh>=Bn&&bh<=ul&&gh.push(ut[Bd]);const dd=(Wh+1)%2;(Wh===0?fi<=xh:Bn<=bh)&&(oh.push(bd),oh.push(Bd-1),oh.push(dd)),(Wh===0?us>=xh:ul>=bh)&&(oh.push(Bd+1),oh.push(Zh),oh.push(dd))}return gh}(this.ids,this.coords,_,p,S,j,this.nodeSize)}within(_,p,S){return function(j,ut,Ot,fi,Bn,us){const ul=[0,j.length-1,0],Ju=[],oh=Bn*Bn;for(;ul.length;){const gh=ul.pop(),xh=ul.pop(),bh=ul.pop();if(xh-bh<=us){for(let dd=bh;dd<=xh;dd++)Mw(ut[2*dd],ut[2*dd+1],Ot,fi)<=oh&&Ju.push(j[dd]);continue}const Wh=Math.floor((bh+xh)/2),Zh=ut[2*Wh],bd=ut[2*Wh+1];Mw(Zh,bd,Ot,fi)<=oh&&Ju.push(j[Wh]);const Bd=(gh+1)%2;(gh===0?Ot-Bn<=Zh:fi-Bn<=bd)&&(ul.push(bh),ul.push(Wh-1),ul.push(Bd)),(gh===0?Ot+Bn>=Zh:fi+Bn>=bd)&&(ul.push(Wh+1),ul.push(xh),ul.push(Bd))}return Ju}(this.ids,this.coords,_,p,S,this.nodeSize)}},o.LineBucket=fx,o.LineStripIndexArray=class extends T0{},o.LngLat=Sg,o.LngLatBounds=Db,o.MercatorCoordinate=Cx,o.ONE_EM=$g,o.OverscaledTileID=t0,o.PerformanceUtils=d2,o.Pos3dArray=class extends x0{},o.PosArray=qv,o.Properties=tg,o.QuadTriangleArray=class extends F0{},o.RGBAImage=lg,o.RasterBoundsArray=class extends wy{},o.RequestPerformance=class{constructor(_){this._marks={start:[_.url,"start"].join("#"),end:[_.url,"end"].join("#"),measure:_.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let _=performance.getEntriesByName(this._marks.measure);return _.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),_=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),_}},o.SegmentVector=ol,o.SymbolBucket=H1,o.Transitionable=Hy,o.TriangleIndexArray=Ft,o.Uniform1f=Mf,o.Uniform1i=class extends Wd{constructor(_,p){super(_,p),this.current=0}set(_){this.current!==_&&(this.current=_,this.gl.uniform1i(this.location,_))}},o.Uniform2f=class extends Wd{constructor(_,p){super(_,p),this.current=[0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]||(this.current=_,this.gl.uniform2f(this.location,_[0],_[1]))}},o.Uniform3f=class extends Wd{constructor(_,p){super(_,p),this.current=[0,0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]&&_[2]===this.current[2]||(this.current=_,this.gl.uniform3f(this.location,_[0],_[1],_[2]))}},o.Uniform4f=Of,o.UniformColor=L,o.UniformMatrix4f=class extends Wd{constructor(_,p){super(_,p),this.current=u}set(_){if(_[12]!==this.current[12]||_[0]!==this.current[0])return this.current=_,void this.gl.uniformMatrix4fv(this.location,!1,_);for(let p=1;p<16;p++)if(_[p]!==this.current[p]){this.current=_,this.gl.uniformMatrix4fv(this.location,!1,_);break}}},o.UnwrappedTileID=Ob,o.ValidationError=Fd,o.ZoomHistory=A_,o.addDynamicAttributes=wx,o.arrayBufferToImage=function(_,p){const S=new Image;S.onload=()=>{p(null,S),URL.revokeObjectURL(S.src),S.onload=null,window.requestAnimationFrame(()=>{S.src=_h})},S.onerror=()=>p(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(_)],{type:"image/png"});S.src=_.byteLength?URL.createObjectURL(j):_h},o.arrayBufferToImageBitmap=function(_,p){const S=new Blob([new Uint8Array(_)],{type:"image/png"});createImageBitmap(S).then(j=>{p(null,j)}).catch(j=>{p(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(_,p,S){if(!_.length)return S(null,[]);let j=_.length;const ut=new Array(_.length);let Ot=null;_.forEach((fi,Bn)=>{p(fi,(us,ul)=>{us&&(Ot=us),ut[Bn]=ul,--j==0&&S(Ot,ut)})})},o.bezier=P,o.bindAll=kn,o.clamp=ze,o.clipLine=Yx,o.clone=function(_){var p=new $f(16);return p[0]=_[0],p[1]=_[1],p[2]=_[2],p[3]=_[3],p[4]=_[4],p[5]=_[5],p[6]=_[6],p[7]=_[7],p[8]=_[8],p[9]=_[9],p[10]=_[10],p[11]=_[11],p[12]=_[12],p[13]=_[13],p[14]=_[14],p[15]=_[15],p},o.clone$1=Co,o.collisionCircleLayout=vb,o.config=Kd,o.copy=function(_,p){return _[0]=p[0],_[1]=p[1],_[2]=p[2],_[3]=p[3],_[4]=p[4],_[5]=p[5],_[6]=p[6],_[7]=p[7],_[8]=p[8],_[9]=p[9],_[10]=p[10],_[11]=p[11],_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15],_},o.create=function(){var _=new $f(16);return $f!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},o.createExpression=d_,o.createFilter=_y,o.createLayout=mg,o.createStyleLayer=function(_){return _.type==="custom"?new ww(_):new u2[_.type](_)},o.dot=function(_,p){return _[0]*p[0]+_[1]*p[1]+_[2]*p[2]+_[3]*p[3]},o.earthRadius=kb,o.ease=Y,o.emitValidationErrors=og,o.equals=function(_,p){var S=_[0],j=_[1],ut=_[2],Ot=_[3],fi=_[4],Bn=_[5],us=_[6],ul=_[7],Ju=_[8],oh=_[9],gh=_[10],xh=_[11],bh=_[12],Wh=_[13],Zh=_[14],bd=_[15],Bd=p[0],dd=p[1],Nd=p[2],Ff=p[3],Bf=p[4],Ap=p[5],Bp=p[6],wp=p[7],yp=p[8],cp=p[9],Ep=p[10],gp=p[11],Qf=p[12],Gp=p[13],Fp=p[14],ym=p[15];return Math.abs(S-Bd)<=yf*Math.max(1,Math.abs(S),Math.abs(Bd))&&Math.abs(j-dd)<=yf*Math.max(1,Math.abs(j),Math.abs(dd))&&Math.abs(ut-Nd)<=yf*Math.max(1,Math.abs(ut),Math.abs(Nd))&&Math.abs(Ot-Ff)<=yf*Math.max(1,Math.abs(Ot),Math.abs(Ff))&&Math.abs(fi-Bf)<=yf*Math.max(1,Math.abs(fi),Math.abs(Bf))&&Math.abs(Bn-Ap)<=yf*Math.max(1,Math.abs(Bn),Math.abs(Ap))&&Math.abs(us-Bp)<=yf*Math.max(1,Math.abs(us),Math.abs(Bp))&&Math.abs(ul-wp)<=yf*Math.max(1,Math.abs(ul),Math.abs(wp))&&Math.abs(Ju-yp)<=yf*Math.max(1,Math.abs(Ju),Math.abs(yp))&&Math.abs(oh-cp)<=yf*Math.max(1,Math.abs(oh),Math.abs(cp))&&Math.abs(gh-Ep)<=yf*Math.max(1,Math.abs(gh),Math.abs(Ep))&&Math.abs(xh-gp)<=yf*Math.max(1,Math.abs(xh),Math.abs(gp))&&Math.abs(bh-Qf)<=yf*Math.max(1,Math.abs(bh),Math.abs(Qf))&&Math.abs(Wh-Gp)<=yf*Math.max(1,Math.abs(Wh),Math.abs(Gp))&&Math.abs(Zh-Fp)<=yf*Math.max(1,Math.abs(Zh),Math.abs(Fp))&&Math.abs(bd-ym)<=yf*Math.max(1,Math.abs(bd),Math.abs(ym))},o.evaluateSizeForFeature=function(_,{uSize:p,uSizeT:S},{lowerSize:j,upperSize:ut}){return _.kind==="source"?j/mv:_.kind==="composite"?mm(j/mv,ut/mv,S):p},o.evaluateSizeForZoom=function(_,p){let S=0,j=0;if(_.kind==="constant")j=_.layoutSize;else if(_.kind!=="source"){const{interpolationType:ut,minZoom:Ot,maxZoom:fi}=_,Bn=ut?ze(Np.interpolationFactor(ut,p,Ot,fi),0,1):0;_.kind==="camera"?j=mm(_.minSize,_.maxSize,Bn):S=Bn}return{uSizeT:S,uSize:j}},o.evaluateVariableOffset=X0,o.evented=em,o.exported=Gh,o.extend=Bt,o.filterObject=rl,o.fromScaling=function(_,p){return _[0]=p[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=p[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=p[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},o.getAnchorAlignment=yx,o.getAnchorJustification=Jy,o.getArrayBuffer=Ed,o.getJSON=function(_,p){return qd(Bt(_,{type:"json"}),p)},o.getOverlapMode=Sx,o.getRTLTextPluginStatus=Gg,o.getReferrer=md,o.getVideo=function(_,p){const S=window.document.createElement("video");S.muted=!0,S.onloadstart=function(){p(null,S)};for(let j=0;j<_.length;j++){const ut=window.document.createElement("source");Sd(_[j])||(S.crossOrigin="Anonymous"),ut.src=_[j],S.appendChild(ut)}return{cancel:()=>{}}},o.identity=Dp,o.invert=function(_,p){var S=p[0],j=p[1],ut=p[2],Ot=p[3],fi=p[4],Bn=p[5],us=p[6],ul=p[7],Ju=p[8],oh=p[9],gh=p[10],xh=p[11],bh=p[12],Wh=p[13],Zh=p[14],bd=p[15],Bd=S*Bn-j*fi,dd=S*us-ut*fi,Nd=S*ul-Ot*fi,Ff=j*us-ut*Bn,Bf=j*ul-Ot*Bn,Ap=ut*ul-Ot*us,Bp=Ju*Wh-oh*bh,wp=Ju*Zh-gh*bh,yp=Ju*bd-xh*bh,cp=oh*Zh-gh*Wh,Ep=oh*bd-xh*Wh,gp=gh*bd-xh*Zh,Qf=Bd*gp-dd*Ep+Nd*cp+Ff*yp-Bf*wp+Ap*Bp;return Qf?(_[0]=(Bn*gp-us*Ep+ul*cp)*(Qf=1/Qf),_[1]=(ut*Ep-j*gp-Ot*cp)*Qf,_[2]=(Wh*Ap-Zh*Bf+bd*Ff)*Qf,_[3]=(gh*Bf-oh*Ap-xh*Ff)*Qf,_[4]=(us*yp-fi*gp-ul*wp)*Qf,_[5]=(S*gp-ut*yp+Ot*wp)*Qf,_[6]=(Zh*Nd-bh*Ap-bd*dd)*Qf,_[7]=(Ju*Ap-gh*Nd+xh*dd)*Qf,_[8]=(fi*Ep-Bn*yp+ul*Bp)*Qf,_[9]=(j*yp-S*Ep-Ot*Bp)*Qf,_[10]=(bh*Bf-Wh*Nd+bd*Bd)*Qf,_[11]=(oh*Nd-Ju*Bf-xh*Bd)*Qf,_[12]=(Bn*wp-fi*cp-us*Bp)*Qf,_[13]=(S*cp-j*wp+ut*Bp)*Qf,_[14]=(Wh*dd-bh*Ff-Zh*Bd)*Qf,_[15]=(Ju*Ff-oh*dd+gh*Bd)*Qf,_):null},o.isImageBitmap=sh,o.isSafari=al,o.isWorker=Zu,o.keysDifference=function(_,p){const S=[];for(const j in _)j in p||S.push(j);return S},o.lazyLoadRTLTextPlugin=function(){Ig.isLoading()||Ig.isLoaded()||Gg()!=="deferred"||bv()},o.makeRequest=qd,o.mapObject=Io,o.mercatorXfromLng=Ew,o.mercatorYfromLat=T1,o.mercatorZfromAltitude=Ix,o.mul=xp,o.mul$1=function(_,p,S){return _[0]=p[0]*S[0],_[1]=p[1]*S[1],_[2]=p[2]*S[2],_[3]=p[3]*S[3],_},o.multiply=nm,o.nextPowerOfTwo=function(_){return _<=1?1:Math.pow(2,Math.ceil(Math.log(_)/Math.LN2))},o.number=mm,o.ortho=function(_,p,S,j,ut,Ot,fi){var Bn=1/(p-S),us=1/(j-ut),ul=1/(Ot-fi);return _[0]=-2*Bn,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*us,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*ul,_[11]=0,_[12]=(p+S)*Bn,_[13]=(ut+j)*us,_[14]=(fi+Ot)*ul,_[15]=1,_},o.parseCacheControl=function(_){const p={};if(_.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(S,j,ut,Ot)=>{const fi=ut||Ot;return p[j]=!fi||fi.toLowerCase(),""}),p["max-age"]){const S=parseInt(p["max-age"],10);isNaN(S)?delete p["max-age"]:p["max-age"]=S}return p},o.parseGlyphPbf=function(_){return new q0(_).readFields(n2,[])},o.pbf=q0,o.performSymbolLayout=function(_){_.bucket.createArrays(),_.bucket.tilePixelRatio=fh/(512*_.bucket.overscaling),_.bucket.compareText={},_.bucket.iconsNeedLinear=!1;const p=_.bucket.layers[0].layout,S=_.bucket.layers[0]._unevaluatedLayout._values,j={layoutIconSize:S["icon-size"].possiblyEvaluate(new Cm(_.bucket.zoom+1),_.canonical),layoutTextSize:S["text-size"].possiblyEvaluate(new Cm(_.bucket.zoom+1),_.canonical),textMaxSize:S["text-size"].possiblyEvaluate(new Cm(18))};if(_.bucket.textSizeData.kind==="composite"){const{minZoom:us,maxZoom:ul}=_.bucket.textSizeData;j.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Cm(us),_.canonical),S["text-size"].possiblyEvaluate(new Cm(ul),_.canonical)]}if(_.bucket.iconSizeData.kind==="composite"){const{minZoom:us,maxZoom:ul}=_.bucket.iconSizeData;j.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Cm(us),_.canonical),S["icon-size"].possiblyEvaluate(new Cm(ul),_.canonical)]}const ut=p.get("text-line-height")*$g,Ot=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point",fi=p.get("text-keep-upright"),Bn=p.get("text-size");for(const us of _.bucket.features){const ul=p.get("text-font").evaluate(us,{},_.canonical).join(","),Ju=Bn.evaluate(us,{},_.canonical),oh=j.layoutTextSize.evaluate(us,{},_.canonical),gh=j.layoutIconSize.evaluate(us,{},_.canonical),xh={horizontal:{},vertical:void 0},bh=us.text;let Wh,Zh=[0,0];if(bh){const dd=bh.toString(),Nd=p.get("text-letter-spacing").evaluate(us,{},_.canonical)*$g,Ff=vy(dd)?Nd:0,Bf=p.get("text-anchor").evaluate(us,{},_.canonical),Ap=p.get("text-variable-anchor");if(!Ap){const Ep=p.get("text-radial-offset").evaluate(us,{},_.canonical);Zh=Ep?X0(Bf,[Ep*$g,P0]):p.get("text-offset").evaluate(us,{},_.canonical).map(gp=>gp*$g)}let Bp=Ot?"center":p.get("text-justify").evaluate(us,{},_.canonical);const wp=p.get("symbol-placement"),yp=wp==="point"?p.get("text-max-width").evaluate(us,{},_.canonical)*$g:0,cp=()=>{_.bucket.allowVerticalPlacement&&Zy(dd)&&(xh.vertical=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,Bf,"left",Ff,Zh,o.WritingMode.vertical,!0,wp,oh,Ju))};if(!Ot&&Ap){const Ep=Bp==="auto"?Ap.map(Qf=>Jy(Qf)):[Bp];let gp=!1;for(let Qf=0;Qf<Ep.length;Qf++){const Gp=Ep[Qf];if(!xh.horizontal[Gp])if(gp)xh.horizontal[Gp]=xh.horizontal[0];else{const Fp=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,"center",Gp,Ff,Zh,o.WritingMode.horizontal,!1,wp,oh,Ju);Fp&&(xh.horizontal[Gp]=Fp,gp=Fp.positionedLines.length===1)}}cp()}else{Bp==="auto"&&(Bp=Jy(Bf));const Ep=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,Bf,Bp,Ff,Zh,o.WritingMode.horizontal,!1,wp,oh,Ju);Ep&&(xh.horizontal[Bp]=Ep),cp(),Zy(dd)&&Ot&&fi&&(xh.vertical=Yy(bh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,yp,ut,Bf,Bp,Ff,Zh,o.WritingMode.vertical,!1,wp,oh,Ju))}}let bd=!1;if(us.icon&&us.icon.name){const dd=_.imageMap[us.icon.name];dd&&(Wh=v1(_.imagePositions[us.icon.name],p.get("icon-offset").evaluate(us,{},_.canonical),p.get("icon-anchor").evaluate(us,{},_.canonical)),bd=!!dd.sdf,_.bucket.sdfIcons===void 0?_.bucket.sdfIcons=bd:_.bucket.sdfIcons!==bd&&$s("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dd.pixelRatio!==_.bucket.pixelRatio||p.get("icon-rotate").constantOr(1)!==0)&&(_.bucket.iconsNeedLinear=!0))}const Bd=o_(xh.horizontal)||xh.vertical;_.bucket.iconsInText=!!Bd&&Bd.iconsInText,(Bd||Wh)&&e0(_.bucket,us,xh,Wh,_.imageMap,j,oh,gh,Zh,bd,_.canonical)}_.showCollisionBoxes&&_.bucket.generateCollisionDebugBuffers()},o.perspective=function(_,p,S,j,ut){var Ot,fi=1/Math.tan(p/2);return _[0]=fi/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=fi,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,ut!=null&&ut!==1/0?(_[10]=(ut+j)*(Ot=1/(j-ut)),_[14]=2*ut*j*Ot):(_[10]=-1,_[14]=-2*j),_},o.pick=function(_,p){const S={};for(let j=0;j<p.length;j++){const ut=p[j];ut in _&&(S[ut]=_[ut])}return S},o.plugin=Ig,o.pointGeometry=ud,o.polygonIntersectsPolygon=Rh,o.potpack=wb,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=tp,o.registerForPluginStateChange=function(_){return _({pluginStatus:Gm,pluginURL:sg}),em.on("pluginStateChange",_),_},o.renderColorRamp=Cy,o.rotateX=function(_,p,S){var j=Math.sin(S),ut=Math.cos(S),Ot=p[4],fi=p[5],Bn=p[6],us=p[7],ul=p[8],Ju=p[9],oh=p[10],gh=p[11];return p!==_&&(_[0]=p[0],_[1]=p[1],_[2]=p[2],_[3]=p[3],_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15]),_[4]=Ot*ut+ul*j,_[5]=fi*ut+Ju*j,_[6]=Bn*ut+oh*j,_[7]=us*ut+gh*j,_[8]=ul*ut-Ot*j,_[9]=Ju*ut-fi*j,_[10]=oh*ut-Bn*j,_[11]=gh*ut-us*j,_},o.rotateZ=function(_,p,S){var j=Math.sin(S),ut=Math.cos(S),Ot=p[0],fi=p[1],Bn=p[2],us=p[3],ul=p[4],Ju=p[5],oh=p[6],gh=p[7];return p!==_&&(_[8]=p[8],_[9]=p[9],_[10]=p[10],_[11]=p[11],_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15]),_[0]=Ot*ut+ul*j,_[1]=fi*ut+Ju*j,_[2]=Bn*ut+oh*j,_[3]=us*ut+gh*j,_[4]=ul*ut-Ot*j,_[5]=Ju*ut-fi*j,_[6]=oh*ut-Bn*j,_[7]=gh*ut-us*j,_},o.scale=function(_,p,S){var j=S[0],ut=S[1],Ot=S[2];return _[0]=p[0]*j,_[1]=p[1]*j,_[2]=p[2]*j,_[3]=p[3]*j,_[4]=p[4]*ut,_[5]=p[5]*ut,_[6]=p[6]*ut,_[7]=p[7]*ut,_[8]=p[8]*Ot,_[9]=p[9]*Ot,_[10]=p[10]*Ot,_[11]=p[11]*Ot,_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15],_},o.setRTLTextPlugin=function(_,p,S=!1){if(Gm===P_||Gm===Ng||Gm===W_)throw new Error("setRTLTextPlugin cannot be called multiple times.");sg=Gh.resolveURL(_),Gm=P_,Dg=p,k_(),S||bv()},o.spec=td,o.sphericalToCartesian=function([_,p,S]){return p+=90,p*=Math.PI/180,S*=Math.PI/180,{x:_*Math.cos(p)*Math.sin(S),y:_*Math.sin(p)*Math.sin(S),z:_*Math.cos(S)}},o.toEvaluationFeature=Ch,o.transformMat4=Lp,o.translate=function(_,p,S){var j,ut,Ot,fi,Bn,us,ul,Ju,oh,gh,xh,bh,Wh=S[0],Zh=S[1],bd=S[2];return p===_?(_[12]=p[0]*Wh+p[4]*Zh+p[8]*bd+p[12],_[13]=p[1]*Wh+p[5]*Zh+p[9]*bd+p[13],_[14]=p[2]*Wh+p[6]*Zh+p[10]*bd+p[14],_[15]=p[3]*Wh+p[7]*Zh+p[11]*bd+p[15]):(ut=p[1],Ot=p[2],fi=p[3],Bn=p[4],us=p[5],ul=p[6],Ju=p[7],oh=p[8],gh=p[9],xh=p[10],bh=p[11],_[0]=j=p[0],_[1]=ut,_[2]=Ot,_[3]=fi,_[4]=Bn,_[5]=us,_[6]=ul,_[7]=Ju,_[8]=oh,_[9]=gh,_[10]=xh,_[11]=bh,_[12]=j*Wh+Bn*Zh+oh*bd+p[12],_[13]=ut*Wh+us*Zh+gh*bd+p[13],_[14]=Ot*Wh+ul*Zh+xh*bd+p[14],_[15]=fi*Wh+Ju*Zh+bh*bd+p[15]),_},o.triggerPluginCompletionEvent=Jg,o.unicodeBlockLookup=sp,o.uniqueId=function(){return Ur++},o.validateCustomStyleLayer=function(_){const p=[],S=_.id;return S===void 0&&p.push({message:`layers.${S}: missing required property "id"`}),_.render===void 0&&p.push({message:`layers.${S}: missing required method "render"`}),_.renderingMode&&_.renderingMode!=="2d"&&_.renderingMode!=="3d"&&p.push({message:`layers.${S}: property "renderingMode" must be either "2d" or "3d"`}),p},o.validateLight=Nm,o.validateStyle=$p,o.vectorTile=Wv,o.warnOnce=$s,o.wrap=ge}),s(["./shared"],function(o){function x(Wu){const sl=typeof Wu;if(sl==="number"||sl==="boolean"||sl==="string"||Wu==null)return JSON.stringify(Wu);if(Array.isArray(Wu)){let cs="[";for(const $u of Wu)cs+=`${x($u)},`;return`${cs}]`}const Gn=Object.keys(Wu).sort();let _n="{";for(let cs=0;cs<Gn.length;cs++)_n+=`${JSON.stringify(Gn[cs])}:${x(Wu[Gn[cs]])},`;return`${_n}}`}function C(Wu){let sl="";for(const Gn of o.refProperties)sl+=`/${x(Wu[Gn])}`;return sl}class P{constructor(sl){this.keyCache={},sl&&this.replace(sl)}replace(sl){this._layerConfigs={},this._layers={},this.update(sl,[])}update(sl,Gn){for(const cs of sl){this._layerConfigs[cs.id]=cs;const $u=this._layers[cs.id]=o.createStyleLayer(cs);$u._featureFilter=o.createFilter($u.filter),this.keyCache[cs.id]&&delete this.keyCache[cs.id]}for(const cs of Gn)delete this.keyCache[cs],delete this._layerConfigs[cs],delete this._layers[cs];this.familiesBySource={};const _n=function(cs,$u){const eh={};for(let uh=0;uh<cs.length;uh++){const dh=$u&&$u[cs[uh].id]||C(cs[uh]);$u&&($u[cs[uh].id]=dh);let vh=eh[dh];vh||(vh=eh[dh]=[]),vh.push(cs[uh])}const nh=[];for(const uh in eh)nh.push(eh[uh]);return nh}(Object.values(this._layerConfigs),this.keyCache);for(const cs of _n){const $u=cs.map(Ph=>this._layers[Ph.id]),eh=$u[0];if(eh.visibility==="none")continue;const nh=eh.source||"";let uh=this.familiesBySource[nh];uh||(uh=this.familiesBySource[nh]={});const dh=eh.sourceLayer||"_geojsonTileLayer";let vh=uh[dh];vh||(vh=uh[dh]=[]),vh.push($u)}}}class Y{constructor(sl){const Gn={},_n=[];for(const nh in sl){const uh=sl[nh],dh=Gn[nh]={};for(const vh in uh){const Ph=uh[+vh];if(!Ph||Ph.bitmap.width===0||Ph.bitmap.height===0)continue;const zh={x:0,y:0,w:Ph.bitmap.width+2,h:Ph.bitmap.height+2};_n.push(zh),dh[vh]={rect:zh,metrics:Ph.metrics}}}const{w:cs,h:$u}=o.potpack(_n),eh=new o.AlphaImage({width:cs||1,height:$u||1});for(const nh in sl){const uh=sl[nh];for(const dh in uh){const vh=uh[+dh];if(!vh||vh.bitmap.width===0||vh.bitmap.height===0)continue;const Ph=Gn[nh][dh].rect;o.AlphaImage.copy(vh.bitmap,eh,{x:0,y:0},{x:Ph.x+1,y:Ph.y+1},vh.bitmap)}}this.image=eh,this.positions=Gn}}o.register("GlyphAtlas",Y);class ze{constructor(sl){this.tileID=new o.OverscaledTileID(sl.tileID.overscaledZ,sl.tileID.wrap,sl.tileID.canonical.z,sl.tileID.canonical.x,sl.tileID.canonical.y),this.uid=sl.uid,this.zoom=sl.zoom,this.pixelRatio=sl.pixelRatio,this.tileSize=sl.tileSize,this.source=sl.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=sl.showCollisionBoxes,this.collectResourceTiming=!!sl.collectResourceTiming,this.returnDependencies=!!sl.returnDependencies,this.promoteId=sl.promoteId}parse(sl,Gn,_n,cs,$u){this.status="parsing",this.data=sl,this.collisionBoxArray=new o.CollisionBoxArray;const eh=new o.DictionaryCoder(Object.keys(sl.layers).sort()),nh=new o.FeatureIndex(this.tileID,this.promoteId);nh.bucketLayerIDs=[];const uh={},dh={featureIndex:nh,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:_n},vh=Gn.familiesBySource[this.source];for(const Ah in vh){const mf=sl.layers[Ah];if(!mf)continue;mf.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${Ah}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Od=eh.encode(Ah),qf=[];for(let mp=0;mp<mf.length;mp++){const Vp=mf.feature(mp),om=nh.getId(Vp,Ah);qf.push({feature:Vp,id:om,index:mp,sourceLayerIndex:Od})}for(const mp of vh[Ah]){const Vp=mp[0];Vp.source!==this.source&&o.warnOnce(`layer.source = ${Vp.source} does not equal this.source = ${this.source}`),Vp.minzoom&&this.zoom<Math.floor(Vp.minzoom)||Vp.maxzoom&&this.zoom>=Vp.maxzoom||Vp.visibility!=="none"&&(ge(mp,this.zoom,_n),(uh[Vp.id]=Vp.createBucket({index:nh.bucketLayerIDs.length,layers:mp,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Od,sourceID:this.source})).populate(qf,dh,this.tileID.canonical),nh.bucketLayerIDs.push(mp.map(om=>om.id)))}}let Ph,zh,Ad,wd;const Qd=o.mapObject(dh.glyphDependencies,Ah=>Object.keys(Ah).map(Number));Object.keys(Qd).length?cs.send("getGlyphs",{uid:this.uid,stacks:Qd,source:this.source,tileID:this.tileID,type:"glyphs"},(Ah,mf)=>{Ph||(Ph=Ah,zh=mf,np.call(this))}):zh={};const xf=Object.keys(dh.iconDependencies);xf.length?cs.send("getImages",{icons:xf,source:this.source,tileID:this.tileID,type:"icons"},(Ah,mf)=>{Ph||(Ph=Ah,Ad=mf,np.call(this))}):Ad={};const zf=Object.keys(dh.patternDependencies);function np(){if(Ph)return $u(Ph);if(zh&&Ad&&wd){const Ah=new Y(zh),mf=new o.ImageAtlas(Ad,wd);for(const Od in uh){const qf=uh[Od];qf instanceof o.SymbolBucket?(ge(qf.layers,this.zoom,_n),o.performSymbolLayout({bucket:qf,glyphMap:zh,glyphPositions:Ah.positions,imageMap:Ad,imagePositions:mf.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):qf.hasPattern&&(qf instanceof o.LineBucket||qf instanceof o.FillBucket||qf instanceof o.FillExtrusionBucket)&&(ge(qf.layers,this.zoom,_n),qf.addFeatures(dh,this.tileID.canonical,mf.patternPositions))}this.status="done",$u(null,{buckets:Object.values(uh).filter(Od=>!Od.isEmpty()),featureIndex:nh,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ah.image,imageAtlas:mf,glyphMap:this.returnDependencies?zh:null,iconMap:this.returnDependencies?Ad:null,glyphPositions:this.returnDependencies?Ah.positions:null})}}zf.length?cs.send("getImages",{icons:zf,source:this.source,tileID:this.tileID,type:"patterns"},(Ah,mf)=>{Ph||(Ph=Ah,wd=mf,np.call(this))}):wd={},np.call(this)}}function ge(Wu,sl,Gn){const _n=new o.EvaluationParameters(sl);for(const cs of Wu)cs.recalculate(_n,Gn)}function Bt(Wu,sl){const Gn=o.getArrayBuffer(Wu.request,(_n,cs,$u,eh)=>{_n?sl(_n):cs&&sl(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(cs)),rawData:cs,cacheControl:$u,expires:eh})});return()=>{Gn.cancel(),sl()}}class Ur{constructor(sl,Gn,_n,cs){this.actor=sl,this.layerIndex=Gn,this.availableImages=_n,this.loadVectorData=cs||Bt,this.loading={},this.loaded={}}loadTile(sl,Gn){const _n=sl.uid;this.loading||(this.loading={});const cs=!!(sl&&sl.request&&sl.request.collectResourceTiming)&&new o.RequestPerformance(sl.request),$u=this.loading[_n]=new ze(sl);$u.abort=this.loadVectorData(sl,(eh,nh)=>{if(delete this.loading[_n],eh||!nh)return $u.status="done",this.loaded[_n]=$u,Gn(eh);const uh=nh.rawData,dh={};nh.expires&&(dh.expires=nh.expires),nh.cacheControl&&(dh.cacheControl=nh.cacheControl);const vh={};if(cs){const Ph=cs.finish();Ph&&(vh.resourceTiming=JSON.parse(JSON.stringify(Ph)))}$u.vectorTile=nh.vectorTile,$u.parse(nh.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ph,zh)=>{if(Ph||!zh)return Gn(Ph);Gn(null,o.extend({rawTileData:uh.slice(0)},zh,dh,vh))}),this.loaded=this.loaded||{},this.loaded[_n]=$u})}reloadTile(sl,Gn){const _n=this.loaded,cs=sl.uid,$u=this;if(_n&&_n[cs]){const eh=_n[cs];eh.showCollisionBoxes=sl.showCollisionBoxes;const nh=(uh,dh)=>{const vh=eh.reloadCallback;vh&&(delete eh.reloadCallback,eh.parse(eh.vectorTile,$u.layerIndex,this.availableImages,$u.actor,vh)),Gn(uh,dh)};eh.status==="parsing"?eh.reloadCallback=nh:eh.status==="done"&&(eh.vectorTile?eh.parse(eh.vectorTile,this.layerIndex,this.availableImages,this.actor,nh):nh())}}abortTile(sl,Gn){const _n=this.loading,cs=sl.uid;_n&&_n[cs]&&_n[cs].abort&&(_n[cs].abort(),delete _n[cs]),Gn()}removeTile(sl,Gn){const _n=this.loaded,cs=sl.uid;_n&&_n[cs]&&delete _n[cs],Gn()}}class kn{constructor(){this.loaded={}}loadTile(sl,Gn){const{uid:_n,encoding:cs,rawImageData:$u}=sl,eh=o.isImageBitmap($u)?this.getImageData($u):$u,nh=new o.DEMData(_n,eh,cs);this.loaded=this.loaded||{},this.loaded[_n]=nh,Gn(null,nh)}getImageData(sl){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(sl.width,sl.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=sl.width,this.offscreenCanvas.height=sl.height,this.offscreenCanvasContext.drawImage(sl,0,0,sl.width,sl.height);const Gn=this.offscreenCanvasContext.getImageData(-1,-1,sl.width+2,sl.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:Gn.width,height:Gn.height},Gn.data)}removeTile(sl){const Gn=this.loaded,_n=sl.uid;Gn&&Gn[_n]&&delete Gn[_n]}}var Io=function Wu(sl,Gn){var _n,cs=sl&&sl.type;if(cs==="FeatureCollection")for(_n=0;_n<sl.features.length;_n++)Wu(sl.features[_n],Gn);else if(cs==="GeometryCollection")for(_n=0;_n<sl.geometries.length;_n++)Wu(sl.geometries[_n],Gn);else if(cs==="Feature")Wu(sl.geometry,Gn);else if(cs==="Polygon")rl(sl.coordinates,Gn);else if(cs==="MultiPolygon")for(_n=0;_n<sl.coordinates.length;_n++)rl(sl.coordinates[_n],Gn);return sl};function rl(Wu,sl){if(Wu.length!==0){Co(Wu[0],sl);for(var Gn=1;Gn<Wu.length;Gn++)Co(Wu[Gn],!sl)}}function Co(Wu,sl){for(var Gn=0,_n=0,cs=0,$u=Wu.length,eh=$u-1;cs<$u;eh=cs++){var nh=(Wu[cs][0]-Wu[eh][0])*(Wu[eh][1]+Wu[cs][1]),uh=Gn+nh;_n+=Math.abs(Gn)>=Math.abs(nh)?Gn-uh+nh:nh-uh+Gn,Gn=uh}Gn+_n>=0!=!!sl&&Wu.reverse()}const as=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var $s={},ah={get exports(){return $s},set exports(Wu){$s=Wu}},ch=o.pointGeometry,Zu=o.vectorTile.VectorTileFeature,ih=al;function al(Wu,sl){this.options=sl||{},this.features=Wu,this.length=Wu.length}function sh(Wu,sl){this.id=typeof Wu.id=="number"?Wu.id:void 0,this.type=Wu.type,this.rawGeometry=Wu.type===1?[Wu.geometry]:Wu.geometry,this.properties=Wu.tags,this.extent=sl||4096}al.prototype.feature=function(Wu){return new sh(this.features[Wu],this.options.extent)},sh.prototype.loadGeometry=function(){var Wu=this.rawGeometry;this.geometry=[];for(var sl=0;sl<Wu.length;sl++){for(var Gn=Wu[sl],_n=[],cs=0;cs<Gn.length;cs++)_n.push(new ch(Gn[cs][0],Gn[cs][1]));this.geometry.push(_n)}return this.geometry},sh.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Wu=this.geometry,sl=1/0,Gn=-1/0,_n=1/0,cs=-1/0,$u=0;$u<Wu.length;$u++)for(var eh=Wu[$u],nh=0;nh<eh.length;nh++){var uh=eh[nh];sl=Math.min(sl,uh.x),Gn=Math.max(Gn,uh.x),_n=Math.min(_n,uh.y),cs=Math.max(cs,uh.y)}return[sl,_n,Gn,cs]},sh.prototype.toGeoJSON=Zu.prototype.toGeoJSON;var _h=o.pbf,Ih=ih;function Lh(Wu){var sl=new _h;return function(Gn,_n){for(var cs in Gn.layers)_n.writeMessage(3,Gh,Gn.layers[cs])}(Wu,sl),sl.finish()}function Gh(Wu,sl){var Gn;sl.writeVarintField(15,Wu.version||1),sl.writeStringField(1,Wu.name||""),sl.writeVarintField(5,Wu.extent||4096);var _n={keys:[],values:[],keycache:{},valuecache:{}};for(Gn=0;Gn<Wu.length;Gn++)_n.feature=Wu.feature(Gn),sl.writeMessage(2,ud,_n);var cs=_n.keys;for(Gn=0;Gn<cs.length;Gn++)sl.writeStringField(3,cs[Gn]);var $u=_n.values;for(Gn=0;Gn<$u.length;Gn++)sl.writeMessage(4,vd,$u[Gn])}function ud(Wu,sl){var Gn=Wu.feature;Gn.id!==void 0&&sl.writeVarintField(1,Gn.id),sl.writeMessage(2,Tf,Wu),sl.writeVarintField(3,Gn.type),sl.writeMessage(4,md,Gn)}function Tf(Wu,sl){var Gn=Wu.feature,_n=Wu.keys,cs=Wu.values,$u=Wu.keycache,eh=Wu.valuecache;for(var nh in Gn.properties){var uh=Gn.properties[nh],dh=$u[nh];if(uh!==null){dh===void 0&&(_n.push(nh),$u[nh]=dh=_n.length-1),sl.writeVarint(dh);var vh=typeof uh;vh!=="string"&&vh!=="boolean"&&vh!=="number"&&(uh=JSON.stringify(uh));var Ph=vh+":"+uh,zh=eh[Ph];zh===void 0&&(cs.push(uh),eh[Ph]=zh=cs.length-1),sl.writeVarint(zh)}}}function Kd(Wu,sl){return(sl<<3)+(7&Wu)}function Af(Wu){return Wu<<1^Wu>>31}function md(Wu,sl){for(var Gn=Wu.loadGeometry(),_n=Wu.type,cs=0,$u=0,eh=Gn.length,nh=0;nh<eh;nh++){var uh=Gn[nh],dh=1;_n===1&&(dh=uh.length),sl.writeVarint(Kd(1,dh));for(var vh=_n===3?uh.length-1:uh.length,Ph=0;Ph<vh;Ph++){Ph===1&&_n!==1&&sl.writeVarint(Kd(2,vh-1));var zh=uh[Ph].x-cs,Ad=uh[Ph].y-$u;sl.writeVarint(Af(zh)),sl.writeVarint(Af(Ad)),cs+=zh,$u+=Ad}_n===3&&sl.writeVarint(Kd(7,1))}}function vd(Wu,sl){var Gn=typeof Wu;Gn==="string"?sl.writeStringField(1,Wu):Gn==="boolean"?sl.writeBooleanField(7,Wu):Gn==="number"&&(Wu%1!=0?sl.writeDoubleField(3,Wu):Wu<0?sl.writeSVarintField(6,Wu):sl.writeVarintField(5,Wu))}ah.exports=Lh,$s.fromVectorTileJs=Lh,$s.fromGeojsonVt=function(Wu,sl){sl=sl||{};var Gn={};for(var _n in Wu)Gn[_n]=new Ih(Wu[_n].features,sl),Gn[_n].name=_n,Gn[_n].version=sl.version,Gn[_n].extent=sl.extent;return Lh({layers:Gn})},$s.GeoJSONWrapper=Ih;const qd={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Wu=>Wu},Ed=Math.fround||(Sd=new Float32Array(1),Wu=>(Sd[0]=+Wu,Sd[0]));var Sd;class zd{constructor(sl){this.options=jf(Object.create(qd),sl),this.trees=new Array(this.options.maxZoom+1)}load(sl){const{log:Gn,minZoom:_n,maxZoom:cs,nodeSize:$u}=this.options;Gn&&console.time("total time");const eh=`prepare ${sl.length} points`;Gn&&console.time(eh),this.points=sl;let nh=[];for(let uh=0;uh<sl.length;uh++)sl[uh].geometry&&nh.push(Gd(sl[uh],uh));this.trees[cs+1]=new o.KDBush(nh,yd,Jd,$u,Float32Array),Gn&&console.timeEnd(eh);for(let uh=cs;uh>=_n;uh--){const dh=+Date.now();nh=this._cluster(nh,uh),this.trees[uh]=new o.KDBush(nh,yd,Jd,$u,Float32Array),Gn&&console.log("z%d: %d clusters in %dms",uh,nh.length,+Date.now()-dh)}return Gn&&console.timeEnd("total time"),this}getClusters(sl,Gn){let _n=((sl[0]+180)%360+360)%360-180;const cs=Math.max(-90,Math.min(90,sl[1]));let $u=sl[2]===180?180:((sl[2]+180)%360+360)%360-180;const eh=Math.max(-90,Math.min(90,sl[3]));if(sl[2]-sl[0]>=360)_n=-180,$u=180;else if(_n>$u){const vh=this.getClusters([_n,cs,180,eh],Gn),Ph=this.getClusters([-180,cs,$u,eh],Gn);return vh.concat(Ph)}const nh=this.trees[this._limitZoom(Gn)],uh=nh.range(td(_n),Fd(eh),td($u),Fd(cs)),dh=[];for(const vh of uh){const Ph=nh.points[vh];dh.push(Ph.numPoints?bf(Ph):this.points[Ph.index])}return dh}getChildren(sl){const Gn=this._getOriginId(sl),_n=this._getOriginZoom(sl),cs="No cluster with the specified id.",$u=this.trees[_n];if(!$u)throw new Error(cs);const eh=$u.points[Gn];if(!eh)throw new Error(cs);const nh=this.options.radius/(this.options.extent*Math.pow(2,_n-1)),uh=$u.within(eh.x,eh.y,nh),dh=[];for(const vh of uh){const Ph=$u.points[vh];Ph.parentId===sl&&dh.push(Ph.numPoints?bf(Ph):this.points[Ph.index])}if(dh.length===0)throw new Error(cs);return dh}getLeaves(sl,Gn,_n){const cs=[];return this._appendLeaves(cs,sl,Gn=Gn||10,_n=_n||0,0),cs}getTile(sl,Gn,_n){const cs=this.trees[this._limitZoom(sl)],$u=Math.pow(2,sl),{extent:eh,radius:nh}=this.options,uh=nh/eh,dh=(_n-uh)/$u,vh=(_n+1+uh)/$u,Ph={features:[]};return this._addTileFeatures(cs.range((Gn-uh)/$u,dh,(Gn+1+uh)/$u,vh),cs.points,Gn,_n,$u,Ph),Gn===0&&this._addTileFeatures(cs.range(1-uh/$u,dh,1,vh),cs.points,$u,_n,$u,Ph),Gn===$u-1&&this._addTileFeatures(cs.range(0,dh,uh/$u,vh),cs.points,-1,_n,$u,Ph),Ph.features.length?Ph:null}getClusterExpansionZoom(sl){let Gn=this._getOriginZoom(sl)-1;for(;Gn<=this.options.maxZoom;){const _n=this.getChildren(sl);if(Gn++,_n.length!==1)break;sl=_n[0].properties.cluster_id}return Gn}_appendLeaves(sl,Gn,_n,cs,$u){const eh=this.getChildren(Gn);for(const nh of eh){const uh=nh.properties;if(uh&&uh.cluster?$u+uh.point_count<=cs?$u+=uh.point_count:$u=this._appendLeaves(sl,uh.cluster_id,_n,cs,$u):$u<cs?$u++:sl.push(nh),sl.length===_n)break}return $u}_addTileFeatures(sl,Gn,_n,cs,$u,eh){for(const nh of sl){const uh=Gn[nh],dh=uh.numPoints;let vh,Ph,zh;if(dh)vh=Id(uh),Ph=uh.x,zh=uh.y;else{const Qd=this.points[uh.index];vh=Qd.properties,Ph=td(Qd.geometry.coordinates[0]),zh=Fd(Qd.geometry.coordinates[1])}const Ad={type:1,geometry:[[Math.round(this.options.extent*(Ph*$u-_n)),Math.round(this.options.extent*(zh*$u-cs))]],tags:vh};let wd;dh?wd=uh.id:this.options.generateId?wd=uh.index:this.points[uh.index].id&&(wd=this.points[uh.index].id),wd!==void 0&&(Ad.id=wd),eh.features.push(Ad)}}_limitZoom(sl){return Math.max(this.options.minZoom,Math.min(Math.floor(+sl),this.options.maxZoom+1))}_cluster(sl,Gn){const _n=[],{radius:cs,extent:$u,reduce:eh,minPoints:nh}=this.options,uh=cs/($u*Math.pow(2,Gn));for(let dh=0;dh<sl.length;dh++){const vh=sl[dh];if(vh.zoom<=Gn)continue;vh.zoom=Gn;const Ph=this.trees[Gn+1],zh=Ph.within(vh.x,vh.y,uh),Ad=vh.numPoints||1;let wd=Ad;for(const Qd of zh){const xf=Ph.points[Qd];xf.zoom>Gn&&(wd+=xf.numPoints||1)}if(wd>Ad&&wd>=nh){let Qd=vh.x*Ad,xf=vh.y*Ad,zf=eh&&Ad>1?this._map(vh,!0):null;const np=(dh<<5)+(Gn+1)+this.points.length;for(const Ah of zh){const mf=Ph.points[Ah];if(mf.zoom<=Gn)continue;mf.zoom=Gn;const Od=mf.numPoints||1;Qd+=mf.x*Od,xf+=mf.y*Od,mf.parentId=np,eh&&(zf||(zf=this._map(vh,!0)),eh(zf,this._map(mf)))}vh.parentId=np,_n.push(Md(Qd/wd,xf/wd,np,wd,zf))}else if(_n.push(vh),wd>1)for(const Qd of zh){const xf=Ph.points[Qd];xf.zoom<=Gn||(xf.zoom=Gn,_n.push(xf))}}return _n}_getOriginId(sl){return sl-this.points.length>>5}_getOriginZoom(sl){return(sl-this.points.length)%32}_map(sl,Gn){if(sl.numPoints)return Gn?jf({},sl.properties):sl.properties;const _n=this.points[sl.index].properties,cs=this.options.map(_n);return Gn&&cs===_n?jf({},cs):cs}}function Md(Wu,sl,Gn,_n,cs){return{x:Ed(Wu),y:Ed(sl),zoom:1/0,id:Gn,parentId:-1,numPoints:_n,properties:cs}}function Gd(Wu,sl){const[Gn,_n]=Wu.geometry.coordinates;return{x:Ed(td(Gn)),y:Ed(Fd(_n)),zoom:1/0,index:sl,parentId:-1}}function bf(Wu){return{type:"Feature",id:Wu.id,properties:Id(Wu),geometry:{type:"Point",coordinates:[(sl=Wu.x,360*(sl-.5)),rp(Wu.y)]}};var sl}function Id(Wu){const sl=Wu.numPoints,Gn=sl>=1e4?`${Math.round(sl/1e3)}k`:sl>=1e3?Math.round(sl/100)/10+"k":sl;return jf(jf({},Wu.properties),{cluster:!0,cluster_id:Wu.id,point_count:sl,point_count_abbreviated:Gn})}function td(Wu){return Wu/360+.5}function Fd(Wu){const sl=Math.sin(Wu*Math.PI/180),Gn=.5-.25*Math.log((1+sl)/(1-sl))/Math.PI;return Gn<0?0:Gn>1?1:Gn}function rp(Wu){const sl=(180-360*Wu)*Math.PI/180;return 360*Math.atan(Math.exp(sl))/Math.PI-90}function jf(Wu,sl){for(const Gn in sl)Wu[Gn]=sl[Gn];return Wu}function yd(Wu){return Wu.x}function Jd(Wu){return Wu.y}function op(Wu,sl,Gn,_n){for(var cs,$u=_n,eh=Gn-sl>>1,nh=Gn-sl,uh=Wu[sl],dh=Wu[sl+1],vh=Wu[Gn],Ph=Wu[Gn+1],zh=sl+3;zh<Gn;zh+=3){var Ad=bp(Wu[zh],Wu[zh+1],uh,dh,vh,Ph);if(Ad>$u)cs=zh,$u=Ad;else if(Ad===$u){var wd=Math.abs(zh-eh);wd<nh&&(cs=zh,nh=wd)}}$u>_n&&(cs-sl>3&&op(Wu,sl,cs,_n),Wu[cs+2]=$u,Gn-cs>3&&op(Wu,cs,Gn,_n))}function bp(Wu,sl,Gn,_n,cs,$u){var eh=cs-Gn,nh=$u-_n;if(eh!==0||nh!==0){var uh=((Wu-Gn)*eh+(sl-_n)*nh)/(eh*eh+nh*nh);uh>1?(Gn=cs,_n=$u):uh>0&&(Gn+=eh*uh,_n+=nh*uh)}return(eh=Wu-Gn)*eh+(nh=sl-_n)*nh}function fp(Wu,sl,Gn,_n){var cs={id:Wu===void 0?null:Wu,type:sl,geometry:Gn,tags:_n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($u){var eh=$u.geometry,nh=$u.type;if(nh==="Point"||nh==="MultiPoint"||nh==="LineString")Qh($u,eh);else if(nh==="Polygon"||nh==="MultiLineString")for(var uh=0;uh<eh.length;uh++)Qh($u,eh[uh]);else if(nh==="MultiPolygon")for(uh=0;uh<eh.length;uh++)for(var dh=0;dh<eh[uh].length;dh++)Qh($u,eh[uh][dh])}(cs),cs}function Qh(Wu,sl){for(var Gn=0;Gn<sl.length;Gn+=3)Wu.minX=Math.min(Wu.minX,sl[Gn]),Wu.minY=Math.min(Wu.minY,sl[Gn+1]),Wu.maxX=Math.max(Wu.maxX,sl[Gn]),Wu.maxY=Math.max(Wu.maxY,sl[Gn+1])}function Yd(Wu,sl,Gn,_n){if(sl.geometry){var cs=sl.geometry.coordinates,$u=sl.geometry.type,eh=Math.pow(Gn.tolerance/((1<<Gn.maxZoom)*Gn.extent),2),nh=[],uh=sl.id;if(Gn.promoteId?uh=sl.properties[Gn.promoteId]:Gn.generateId&&(uh=_n||0),$u==="Point")sd(cs,nh);else if($u==="MultiPoint")for(var dh=0;dh<cs.length;dh++)sd(cs[dh],nh);else if($u==="LineString")Zd(cs,nh,eh,!1);else if($u==="MultiLineString"){if(Gn.lineMetrics){for(dh=0;dh<cs.length;dh++)Zd(cs[dh],nh=[],eh,!1),Wu.push(fp(uh,"LineString",nh,sl.properties));return}Xh(cs,nh,eh,!1)}else if($u==="Polygon")Xh(cs,nh,eh,!0);else{if($u!=="MultiPolygon"){if($u==="GeometryCollection"){for(dh=0;dh<sl.geometry.geometries.length;dh++)Yd(Wu,{id:uh,geometry:sl.geometry.geometries[dh],properties:sl.properties},Gn,_n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dh=0;dh<cs.length;dh++){var vh=[];Xh(cs[dh],vh,eh,!0),nh.push(vh)}}Wu.push(fp(uh,$u,nh,sl.properties))}}function sd(Wu,sl){sl.push(Ld(Wu[0])),sl.push(Kf(Wu[1])),sl.push(0)}function Zd(Wu,sl,Gn,_n){for(var cs,$u,eh=0,nh=0;nh<Wu.length;nh++){var uh=Ld(Wu[nh][0]),dh=Kf(Wu[nh][1]);sl.push(uh),sl.push(dh),sl.push(0),nh>0&&(eh+=_n?(cs*dh-uh*$u)/2:Math.sqrt(Math.pow(uh-cs,2)+Math.pow(dh-$u,2))),cs=uh,$u=dh}var vh=sl.length-3;sl[2]=1,op(sl,0,vh,Gn),sl[vh+2]=1,sl.size=Math.abs(eh),sl.start=0,sl.end=sl.size}function Xh(Wu,sl,Gn,_n){for(var cs=0;cs<Wu.length;cs++){var $u=[];Zd(Wu[cs],$u,Gn,_n),sl.push($u)}}function Ld(Wu){return Wu/360+.5}function Kf(Wu){var sl=Math.sin(Wu*Math.PI/180),Gn=.5-.25*Math.log((1+sl)/(1-sl))/Math.PI;return Gn<0?0:Gn>1?1:Gn}function If(Wu,sl,Gn,_n,cs,$u,eh,nh){if(_n/=sl,$u>=(Gn/=sl)&&eh<_n)return Wu;if(eh<Gn||$u>=_n)return null;for(var uh=[],dh=0;dh<Wu.length;dh++){var vh=Wu[dh],Ph=vh.geometry,zh=vh.type,Ad=cs===0?vh.minX:vh.minY,wd=cs===0?vh.maxX:vh.maxY;if(Ad>=Gn&&wd<_n)uh.push(vh);else if(!(wd<Gn||Ad>=_n)){var Qd=[];if(zh==="Point"||zh==="MultiPoint")Df(Ph,Qd,Gn,_n,cs);else if(zh==="LineString")Jf(Ph,Qd,Gn,_n,cs,!1,nh.lineMetrics);else if(zh==="MultiLineString")Wf(Ph,Qd,Gn,_n,cs,!1);else if(zh==="Polygon")Wf(Ph,Qd,Gn,_n,cs,!0);else if(zh==="MultiPolygon")for(var xf=0;xf<Ph.length;xf++){var zf=[];Wf(Ph[xf],zf,Gn,_n,cs,!0),zf.length&&Qd.push(zf)}if(Qd.length){if(nh.lineMetrics&&zh==="LineString"){for(xf=0;xf<Qd.length;xf++)uh.push(fp(vh.id,zh,Qd[xf],vh.tags));continue}zh!=="LineString"&&zh!=="MultiLineString"||(Qd.length===1?(zh="LineString",Qd=Qd[0]):zh="MultiLineString"),zh!=="Point"&&zh!=="MultiPoint"||(zh=Qd.length===3?"Point":"MultiPoint"),uh.push(fp(vh.id,zh,Qd,vh.tags))}}}return uh.length?uh:null}function Df(Wu,sl,Gn,_n,cs){for(var $u=0;$u<Wu.length;$u+=3){var eh=Wu[$u+cs];eh>=Gn&&eh<=_n&&(sl.push(Wu[$u]),sl.push(Wu[$u+1]),sl.push(Wu[$u+2]))}}function Jf(Wu,sl,Gn,_n,cs,$u,eh){for(var nh,uh,dh=Nf(Wu),vh=cs===0?Sp:Pp,Ph=Wu.start,zh=0;zh<Wu.length-3;zh+=3){var Ad=Wu[zh],wd=Wu[zh+1],Qd=Wu[zh+2],xf=Wu[zh+3],zf=Wu[zh+4],np=cs===0?Ad:wd,Ah=cs===0?xf:zf,mf=!1;eh&&(nh=Math.sqrt(Math.pow(Ad-xf,2)+Math.pow(wd-zf,2))),np<Gn?Ah>Gn&&(uh=vh(dh,Ad,wd,xf,zf,Gn),eh&&(dh.start=Ph+nh*uh)):np>_n?Ah<_n&&(uh=vh(dh,Ad,wd,xf,zf,_n),eh&&(dh.start=Ph+nh*uh)):Mp(dh,Ad,wd,Qd),Ah<Gn&&np>=Gn&&(uh=vh(dh,Ad,wd,xf,zf,Gn),mf=!0),Ah>_n&&np<=_n&&(uh=vh(dh,Ad,wd,xf,zf,_n),mf=!0),!$u&&mf&&(eh&&(dh.end=Ph+nh*uh),sl.push(dh),dh=Nf(Wu)),eh&&(Ph+=nh)}var Od=Wu.length-3;Ad=Wu[Od],wd=Wu[Od+1],Qd=Wu[Od+2],(np=cs===0?Ad:wd)>=Gn&&np<=_n&&Mp(dh,Ad,wd,Qd),Od=dh.length-3,$u&&Od>=3&&(dh[Od]!==dh[0]||dh[Od+1]!==dh[1])&&Mp(dh,dh[0],dh[1],dh[2]),dh.length&&sl.push(dh)}function Nf(Wu){var sl=[];return sl.size=Wu.size,sl.start=Wu.start,sl.end=Wu.end,sl}function Wf(Wu,sl,Gn,_n,cs,$u){for(var eh=0;eh<Wu.length;eh++)Jf(Wu[eh],sl,Gn,_n,cs,$u,!1)}function Mp(Wu,sl,Gn,_n){Wu.push(sl),Wu.push(Gn),Wu.push(_n)}function Sp(Wu,sl,Gn,_n,cs,$u){var eh=($u-sl)/(_n-sl);return Wu.push($u),Wu.push(Gn+(cs-Gn)*eh),Wu.push(1),eh}function Pp(Wu,sl,Gn,_n,cs,$u){var eh=($u-Gn)/(cs-Gn);return Wu.push(sl+(_n-sl)*eh),Wu.push($u),Wu.push(1),eh}function Yf(Wu,sl){for(var Gn=[],_n=0;_n<Wu.length;_n++){var cs,$u=Wu[_n],eh=$u.type;if(eh==="Point"||eh==="MultiPoint"||eh==="LineString")cs=qp($u.geometry,sl);else if(eh==="MultiLineString"||eh==="Polygon"){cs=[];for(var nh=0;nh<$u.geometry.length;nh++)cs.push(qp($u.geometry[nh],sl))}else if(eh==="MultiPolygon")for(cs=[],nh=0;nh<$u.geometry.length;nh++){for(var uh=[],dh=0;dh<$u.geometry[nh].length;dh++)uh.push(qp($u.geometry[nh][dh],sl));cs.push(uh)}Gn.push(fp($u.id,eh,cs,$u.tags))}return Gn}function qp(Wu,sl){var Gn=[];Gn.size=Wu.size,Wu.start!==void 0&&(Gn.start=Wu.start,Gn.end=Wu.end);for(var _n=0;_n<Wu.length;_n+=3)Gn.push(Wu[_n]+sl,Wu[_n+1],Wu[_n+2]);return Gn}function sm(Wu,sl){if(Wu.transformed)return Wu;var Gn,_n,cs,$u=1<<Wu.z,eh=Wu.x,nh=Wu.y;for(Gn=0;Gn<Wu.features.length;Gn++){var uh=Wu.features[Gn],dh=uh.geometry,vh=uh.type;if(uh.geometry=[],vh===1)for(_n=0;_n<dh.length;_n+=2)uh.geometry.push(Xd(dh[_n],dh[_n+1],sl,$u,eh,nh));else for(_n=0;_n<dh.length;_n++){var Ph=[];for(cs=0;cs<dh[_n].length;cs+=2)Ph.push(Xd(dh[_n][cs],dh[_n][cs+1],sl,$u,eh,nh));uh.geometry.push(Ph)}}return Wu.transformed=!0,Wu}function Xd(Wu,sl,Gn,_n,cs,$u){return[Math.round(Gn*(Wu*_n-cs)),Math.round(Gn*(sl*_n-$u))]}function Op(Wu,sl,Gn,_n,cs){for(var $u=sl===cs.maxZoom?0:cs.tolerance/((1<<sl)*cs.extent),eh={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Gn,y:_n,z:sl,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},nh=0;nh<Wu.length;nh++){eh.numFeatures++,rm(eh,Wu[nh],$u,cs);var uh=Wu[nh].minX,dh=Wu[nh].minY,vh=Wu[nh].maxX,Ph=Wu[nh].maxY;uh<eh.minX&&(eh.minX=uh),dh<eh.minY&&(eh.minY=dh),vh>eh.maxX&&(eh.maxX=vh),Ph>eh.maxY&&(eh.maxY=Ph)}return eh}function rm(Wu,sl,Gn,_n){var cs=sl.geometry,$u=sl.type,eh=[];if($u==="Point"||$u==="MultiPoint")for(var nh=0;nh<cs.length;nh+=3)eh.push(cs[nh]),eh.push(cs[nh+1]),Wu.numPoints++,Wu.numSimplified++;else if($u==="LineString")Sm(eh,cs,Wu,Gn,!1,!1);else if($u==="MultiLineString"||$u==="Polygon")for(nh=0;nh<cs.length;nh++)Sm(eh,cs[nh],Wu,Gn,$u==="Polygon",nh===0);else if($u==="MultiPolygon")for(var uh=0;uh<cs.length;uh++){var dh=cs[uh];for(nh=0;nh<dh.length;nh++)Sm(eh,dh[nh],Wu,Gn,!0,nh===0)}if(eh.length){var vh=sl.tags||null;if($u==="LineString"&&_n.lineMetrics){for(var Ph in vh={},sl.tags)vh[Ph]=sl.tags[Ph];vh.mapbox_clip_start=cs.start/cs.size,vh.mapbox_clip_end=cs.end/cs.size}var zh={geometry:eh,type:$u==="Polygon"||$u==="MultiPolygon"?3:$u==="LineString"||$u==="MultiLineString"?2:1,tags:vh};sl.id!==null&&(zh.id=sl.id),Wu.features.push(zh)}}function Sm(Wu,sl,Gn,_n,cs,$u){var eh=_n*_n;if(_n>0&&sl.size<(cs?eh:_n))Gn.numPoints+=sl.length/3;else{for(var nh=[],uh=0;uh<sl.length;uh+=3)(_n===0||sl[uh+2]>eh)&&(Gn.numSimplified++,nh.push(sl[uh]),nh.push(sl[uh+1])),Gn.numPoints++;cs&&function(dh,vh){for(var Ph=0,zh=0,Ad=dh.length,wd=Ad-2;zh<Ad;wd=zh,zh+=2)Ph+=(dh[zh]-dh[wd])*(dh[zh+1]+dh[wd+1]);if(Ph>0===vh)for(zh=0,Ad=dh.length;zh<Ad/2;zh+=2){var Qd=dh[zh],xf=dh[zh+1];dh[zh]=dh[Ad-2-zh],dh[zh+1]=dh[Ad-1-zh],dh[Ad-2-zh]=Qd,dh[Ad-1-zh]=xf}}(nh,$u),Wu.push(nh)}}function hp(Wu,sl){var Gn=(sl=this.options=function(cs,$u){for(var eh in $u)cs[eh]=$u[eh];return cs}(Object.create(this.options),sl)).debug;if(Gn&&console.time("preprocess data"),sl.maxZoom<0||sl.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(sl.promoteId&&sl.generateId)throw new Error("promoteId and generateId cannot be used together.");var _n=function(cs,$u){var eh=[];if(cs.type==="FeatureCollection")for(var nh=0;nh<cs.features.length;nh++)Yd(eh,cs.features[nh],$u,nh);else Yd(eh,cs.type==="Feature"?cs:{geometry:cs},$u);return eh}(Wu,sl);this.tiles={},this.tileCoords=[],Gn&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",sl.indexMaxZoom,sl.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_n=function(cs,$u){var eh=$u.buffer/$u.extent,nh=cs,uh=If(cs,1,-1-eh,eh,0,-1,2,$u),dh=If(cs,1,1-eh,2+eh,0,-1,2,$u);return(uh||dh)&&(nh=If(cs,1,-eh,1+eh,0,-1,2,$u)||[],uh&&(nh=Yf(uh,1).concat(nh)),dh&&(nh=nh.concat(Yf(dh,-1)))),nh}(_n,sl),_n.length&&this.splitTile(_n,0,0,0),Gn&&(_n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Em(Wu,sl,Gn){return 32*((1<<Wu)*Gn+sl)+Wu}function Qp(Wu,sl){return sl?Wu.properties[sl]:Wu.id}function lm(Wu,sl){if(Wu==null)return!0;if(Wu.type==="Feature")return Qp(Wu,sl)!=null;if(Wu.type==="FeatureCollection"){const Gn=new Set;for(const _n of Wu.features){const cs=Qp(_n,sl);if(cs==null||Gn.has(cs))return!1;Gn.add(cs)}return!0}return!1}function Dd(Wu,sl){const Gn=new Map;if(Wu!=null)if(Wu.type==="Feature")Gn.set(Qp(Wu,sl),Wu);else for(const _n of Wu.features)Gn.set(Qp(_n,sl),_n);return Gn}function Hf(Wu,sl){const Gn=Wu.tileID.canonical;if(!this._geoJSONIndex)return sl(null,null);const _n=this._geoJSONIndex.getTile(Gn.z,Gn.x,Gn.y);if(!_n)return sl(null,null);const cs=new class{constructor(eh){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=eh.length,this._features=eh}feature(eh){return new class{constructor(nh){this._feature=nh,this.extent=o.EXTENT,this.type=nh.type,this.properties=nh.tags,"id"in nh&&!isNaN(nh.id)&&(this.id=parseInt(nh.id,10))}loadGeometry(){if(this._feature.type===1){const nh=[];for(const uh of this._feature.geometry)nh.push([new o.pointGeometry(uh[0],uh[1])]);return nh}{const nh=[];for(const uh of this._feature.geometry){const dh=[];for(const vh of uh)dh.push(new o.pointGeometry(vh[0],vh[1]));nh.push(dh)}return nh}}toGeoJSON(nh,uh,dh){return as.call(this,nh,uh,dh)}}(this._features[eh])}}(_n.features);let $u=$s(cs);$u.byteOffset===0&&$u.byteLength===$u.buffer.byteLength||($u=new Uint8Array($u)),sl(null,{vectorTile:cs,rawData:$u.buffer})}hp.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},hp.prototype.splitTile=function(Wu,sl,Gn,_n,cs,$u,eh){for(var nh=[Wu,sl,Gn,_n],uh=this.options,dh=uh.debug;nh.length;){_n=nh.pop(),Gn=nh.pop(),sl=nh.pop(),Wu=nh.pop();var vh=1<<sl,Ph=Em(sl,Gn,_n),zh=this.tiles[Ph];if(!zh&&(dh>1&&console.time("creation"),zh=this.tiles[Ph]=Op(Wu,sl,Gn,_n,uh),this.tileCoords.push({z:sl,x:Gn,y:_n}),dh)){dh>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",sl,Gn,_n,zh.numFeatures,zh.numPoints,zh.numSimplified),console.timeEnd("creation"));var Ad="z"+sl;this.stats[Ad]=(this.stats[Ad]||0)+1,this.total++}if(zh.source=Wu,cs){if(sl===uh.maxZoom||sl===cs)continue;var wd=1<<cs-sl;if(Gn!==Math.floor($u/wd)||_n!==Math.floor(eh/wd))continue}else if(sl===uh.indexMaxZoom||zh.numPoints<=uh.indexMaxPoints)continue;if(zh.source=null,Wu.length!==0){dh>1&&console.time("clipping");var Qd,xf,zf,np,Ah,mf,Od=.5*uh.buffer/uh.extent,qf=.5-Od,mp=.5+Od,Vp=1+Od;Qd=xf=zf=np=null,Ah=If(Wu,vh,Gn-Od,Gn+mp,0,zh.minX,zh.maxX,uh),mf=If(Wu,vh,Gn+qf,Gn+Vp,0,zh.minX,zh.maxX,uh),Wu=null,Ah&&(Qd=If(Ah,vh,_n-Od,_n+mp,1,zh.minY,zh.maxY,uh),xf=If(Ah,vh,_n+qf,_n+Vp,1,zh.minY,zh.maxY,uh),Ah=null),mf&&(zf=If(mf,vh,_n-Od,_n+mp,1,zh.minY,zh.maxY,uh),np=If(mf,vh,_n+qf,_n+Vp,1,zh.minY,zh.maxY,uh),mf=null),dh>1&&console.timeEnd("clipping"),nh.push(Qd||[],sl+1,2*Gn,2*_n),nh.push(xf||[],sl+1,2*Gn,2*_n+1),nh.push(zf||[],sl+1,2*Gn+1,2*_n),nh.push(np||[],sl+1,2*Gn+1,2*_n+1)}}},hp.prototype.getTile=function(Wu,sl,Gn){var _n=this.options,cs=_n.extent,$u=_n.debug;if(Wu<0||Wu>24)return null;var eh=1<<Wu,nh=Em(Wu,sl=(sl%eh+eh)%eh,Gn);if(this.tiles[nh])return sm(this.tiles[nh],cs);$u>1&&console.log("drilling down to z%d-%d-%d",Wu,sl,Gn);for(var uh,dh=Wu,vh=sl,Ph=Gn;!uh&&dh>0;)dh--,vh=Math.floor(vh/2),Ph=Math.floor(Ph/2),uh=this.tiles[Em(dh,vh,Ph)];return uh&&uh.source?($u>1&&console.log("found parent tile z%d-%d-%d",dh,vh,Ph),$u>1&&console.time("drilling down"),this.splitTile(uh.source,dh,vh,Ph,Wu,sl,Gn),$u>1&&console.timeEnd("drilling down"),this.tiles[nh]?sm(this.tiles[nh],cs):null):null};class mh extends Ur{constructor(sl,Gn,_n,cs){super(sl,Gn,_n,Hf),this._dataUpdateable=new Map,this.loadGeoJSON=($u,eh)=>{const{promoteId:nh}=$u;if($u.request)return o.getJSON($u.request,(uh,dh,vh,Ph)=>{this._dataUpdateable=lm(dh,nh)?Dd(dh,nh):void 0,eh(uh,dh,vh,Ph)});if(typeof $u.data=="string")try{const uh=JSON.parse($u.data);this._dataUpdateable=lm(uh,nh)?Dd(uh,nh):void 0,eh(null,uh)}catch{eh(new Error(`Input data given to '${$u.source}' is not a valid GeoJSON object.`))}else $u.dataDiff?this._dataUpdateable?(function(uh,dh,vh){var Ph,zh,Ad,wd;if(dh.removeAll&&uh.clear(),dh.remove)for(const Qd of dh.remove)uh.delete(Qd);if(dh.add)for(const Qd of dh.add){const xf=Qp(Qd,vh);xf!=null&&uh.set(xf,Qd)}if(dh.update)for(const Qd of dh.update){let xf=uh.get(Qd.id);if(xf==null)continue;const zf=!Qd.removeAllProperties&&(((Ph=Qd.removeProperties)===null||Ph===void 0?void 0:Ph.length)>0||((zh=Qd.addOrUpdateProperties)===null||zh===void 0?void 0:zh.length)>0);if((Qd.newGeometry||Qd.removeAllProperties||zf)&&(xf={...xf},uh.set(Qd.id,xf),zf&&(xf.properties={...xf.properties})),Qd.newGeometry&&(xf.geometry=Qd.newGeometry),Qd.removeAllProperties)xf.properties={};else if(((Ad=Qd.removeProperties)===null||Ad===void 0?void 0:Ad.length)>0)for(const np of Qd.removeProperties)Object.prototype.hasOwnProperty.call(xf.properties,np)&&delete xf.properties[np];if(((wd=Qd.addOrUpdateProperties)===null||wd===void 0?void 0:wd.length)>0)for(const{key:np,value:Ah}of Qd.addOrUpdateProperties)xf.properties[np]=Ah}}(this._dataUpdateable,$u.dataDiff,nh),eh(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):eh(new Error(`Cannot update existing geojson data in ${$u.source}`)):eh(new Error(`Input data given to '${$u.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},cs&&(this.loadGeoJSON=cs)}loadData(sl,Gn){var _n;(_n=this._pendingRequest)===null||_n===void 0||_n.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const cs=!!(sl&&sl.request&&sl.request.collectResourceTiming)&&new o.RequestPerformance(sl.request);this._pendingCallback=Gn,this._pendingRequest=this.loadGeoJSON(sl,($u,eh)=>{if(delete this._pendingCallback,delete this._pendingRequest,$u||!eh)return Gn($u);if(typeof eh!="object")return Gn(new Error(`Input data given to '${sl.source}' is not a valid GeoJSON object.`));{Io(eh,!0);try{if(sl.filter){const uh=o.createExpression(sl.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(uh.result==="error")throw new Error(uh.value.map(vh=>`${vh.key}: ${vh.message}`).join(", "));eh={type:"FeatureCollection",features:eh.features.filter(vh=>uh.value.evaluate({zoom:0},vh))}}this._geoJSONIndex=sl.cluster?new zd(function({superclusterOptions:uh,clusterProperties:dh}){if(!dh||!uh)return uh;const vh={},Ph={},zh={accumulated:null,zoom:0},Ad={properties:null},wd=Object.keys(dh);for(const Qd of wd){const[xf,zf]=dh[Qd],np=o.createExpression(zf),Ah=o.createExpression(typeof xf=="string"?[xf,["accumulated"],["get",Qd]]:xf);vh[Qd]=np.value,Ph[Qd]=Ah.value}return uh.map=Qd=>{Ad.properties=Qd;const xf={};for(const zf of wd)xf[zf]=vh[zf].evaluate(zh,Ad);return xf},uh.reduce=(Qd,xf)=>{Ad.properties=xf;for(const zf of wd)zh.accumulated=Qd[zf],Qd[zf]=Ph[zf].evaluate(zh,Ad)},uh}(sl)).load(eh.features):function(uh,dh){return new hp(uh,dh)}(eh,sl.geojsonVtOptions)}catch(uh){return Gn(uh)}this.loaded={};const nh={};if(cs){const uh=cs.finish();uh&&(nh.resourceTiming={},nh.resourceTiming[sl.source]=JSON.parse(JSON.stringify(uh)))}Gn(null,nh)}})}reloadTile(sl,Gn){const _n=this.loaded;return _n&&_n[sl.uid]?super.reloadTile(sl,Gn):this.loadTile(sl,Gn)}removeSource(sl,Gn){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Gn()}getClusterExpansionZoom(sl,Gn){try{Gn(null,this._geoJSONIndex.getClusterExpansionZoom(sl.clusterId))}catch(_n){Gn(_n)}}getClusterChildren(sl,Gn){try{Gn(null,this._geoJSONIndex.getChildren(sl.clusterId))}catch(_n){Gn(_n)}}getClusterLeaves(sl,Gn){try{Gn(null,this._geoJSONIndex.getLeaves(sl.clusterId,sl.limit,sl.offset))}catch(_n){Gn(_n)}}}class Jh{constructor(sl){this.self=sl,this.actor=new o.Actor(sl,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ur,geojson:mh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Gn,_n)=>{if(this.workerSourceTypes[Gn])throw new Error(`Worker source with name "${Gn}" already registered.`);this.workerSourceTypes[Gn]=_n},this.self.registerRTLTextPlugin=Gn=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Gn.applyArabicShaping,o.plugin.processBidirectionalText=Gn.processBidirectionalText,o.plugin.processStyledBidirectionalText=Gn.processStyledBidirectionalText}}setReferrer(sl,Gn){this.referrer=Gn}setImages(sl,Gn,_n){this.availableImages[sl]=Gn;for(const cs in this.workerSources[sl]){const $u=this.workerSources[sl][cs];for(const eh in $u)$u[eh].availableImages=Gn}_n()}setLayers(sl,Gn,_n){this.getLayerIndex(sl).replace(Gn),_n()}updateLayers(sl,Gn,_n){this.getLayerIndex(sl).update(Gn.layers,Gn.removedIds),_n()}loadTile(sl,Gn,_n){this.getWorkerSource(sl,Gn.type,Gn.source).loadTile(Gn,_n)}loadDEMTile(sl,Gn,_n){this.getDEMWorkerSource(sl,Gn.source).loadTile(Gn,_n)}reloadTile(sl,Gn,_n){this.getWorkerSource(sl,Gn.type,Gn.source).reloadTile(Gn,_n)}abortTile(sl,Gn,_n){this.getWorkerSource(sl,Gn.type,Gn.source).abortTile(Gn,_n)}removeTile(sl,Gn,_n){this.getWorkerSource(sl,Gn.type,Gn.source).removeTile(Gn,_n)}removeDEMTile(sl,Gn){this.getDEMWorkerSource(sl,Gn.source).removeTile(Gn)}removeSource(sl,Gn,_n){if(!this.workerSources[sl]||!this.workerSources[sl][Gn.type]||!this.workerSources[sl][Gn.type][Gn.source])return;const cs=this.workerSources[sl][Gn.type][Gn.source];delete this.workerSources[sl][Gn.type][Gn.source],cs.removeSource!==void 0?cs.removeSource(Gn,_n):_n()}loadWorkerSource(sl,Gn,_n){try{this.self.importScripts(Gn.url),_n()}catch(cs){_n(cs.toString())}}syncRTLPluginState(sl,Gn,_n){try{o.plugin.setState(Gn);const cs=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&cs!=null){this.self.importScripts(cs);const $u=o.plugin.isParsed();_n($u?void 0:new Error(`RTL Text Plugin failed to import scripts from ${cs}`),$u)}}catch(cs){_n(cs.toString())}}getAvailableImages(sl){let Gn=this.availableImages[sl];return Gn||(Gn=[]),Gn}getLayerIndex(sl){let Gn=this.layerIndexes[sl];return Gn||(Gn=this.layerIndexes[sl]=new P),Gn}getWorkerSource(sl,Gn,_n){if(this.workerSources[sl]||(this.workerSources[sl]={}),this.workerSources[sl][Gn]||(this.workerSources[sl][Gn]={}),!this.workerSources[sl][Gn][_n]){const cs={send:($u,eh,nh)=>{this.actor.send($u,eh,nh,sl)}};this.workerSources[sl][Gn][_n]=new this.workerSourceTypes[Gn](cs,this.getLayerIndex(sl),this.getAvailableImages(sl))}return this.workerSources[sl][Gn][_n]}getDEMWorkerSource(sl,Gn){return this.demWorkerSources[sl]||(this.demWorkerSources[sl]={}),this.demWorkerSources[sl][Gn]||(this.demWorkerSources[sl][Gn]=new kn),this.demWorkerSources[sl][Gn]}}return o.isWorker()&&(self.worker=new Jh(self)),Jh}),s(["./shared"],function(o){var x=C;function C(he){return!function(g){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var q,nt,Ft=new Blob([""],{type:"text/javascript"}),Xr=URL.createObjectURL(Ft);try{nt=new Worker(Xr),q=!0}catch{q=!1}return nt&&nt.terminate(),URL.revokeObjectURL(Xr),q}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var q=document.createElement("canvas");q.width=q.height=1;var nt=q.getContext("2d");if(!nt)return!1;var Ft=nt.getImageData(0,0,1,1);return Ft&&Ft.width===q.width}()?(P[A=g&&g.failIfMajorPerformanceCaveat]===void 0&&(P[A]=function(q){var nt,Ft=function(Xr){var ls=document.createElement("canvas"),Zs=Object.create(C.webGLContextAttributes);return Zs.failIfMajorPerformanceCaveat=Xr,ls.getContext("webgl",Zs)||ls.getContext("experimental-webgl",Zs)}(q);if(!Ft)return!1;try{nt=Ft.createShader(Ft.VERTEX_SHADER)}catch{return!1}return!(!nt||Ft.isContextLost())&&(Ft.shaderSource(nt,"void main() {}"),Ft.compileShader(nt),Ft.getShaderParameter(nt,Ft.COMPILE_STATUS)===!0)}(A)),P[A]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}(he)}var P={};C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var Y="3.0.0-pre.4";function ze(he,g){if(Array.isArray(he)){if(!Array.isArray(g)||he.length!==g.length)return!1;for(let A=0;A<he.length;A++)if(!ze(he[A],g[A]))return!1;return!0}if(typeof he=="object"&&he!==null&&g!==null){if(typeof g!="object"||Object.keys(he).length!==Object.keys(g).length)return!1;for(const A in he)if(!ze(he[A],g[A]))return!1;return!0}return he===g}class ge{static testProp(g){if(!ge.docStyle)return g[0];for(let A=0;A<g.length;A++)if(g[A]in ge.docStyle)return g[A];return g[0]}static create(g,A,q){const nt=window.document.createElement(g);return A!==void 0&&(nt.className=A),q&&q.appendChild(nt),nt}static createNS(g,A){return window.document.createElementNS(g,A)}static disableDrag(){ge.docStyle&&ge.selectProp&&(ge.userSelect=ge.docStyle[ge.selectProp],ge.docStyle[ge.selectProp]="none")}static enableDrag(){ge.docStyle&&ge.selectProp&&(ge.docStyle[ge.selectProp]=ge.userSelect)}static setTransform(g,A){g.style[ge.transformProp]=A}static addEventListener(g,A,q,nt={}){g.addEventListener(A,q,"passive"in nt?nt:nt.capture)}static removeEventListener(g,A,q,nt={}){g.removeEventListener(A,q,"passive"in nt?nt:nt.capture)}static suppressClickInternal(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ge.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ge.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ge.suppressClickInternal,!0)},0)}static mousePos(g,A){const q=g.getBoundingClientRect();return new o.pointGeometry(A.clientX-q.left-g.clientLeft,A.clientY-q.top-g.clientTop)}static touchPos(g,A){const q=g.getBoundingClientRect(),nt=[];for(let Ft=0;Ft<A.length;Ft++)nt.push(new o.pointGeometry(A[Ft].clientX-q.left-g.clientLeft,A[Ft].clientY-q.top-g.clientTop));return nt}static mouseButton(g){return g.button}static remove(g){g.parentNode&&g.parentNode.removeChild(g)}}ge.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ge.selectProp=ge.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ge.transformProp=ge.testProp(["transform","WebkitTransform"]);const Bt={supported:!1,testSupport:function(he){!Io&&kn&&(rl?Co(he):Ur=he)}};let Ur,kn,Io=!1,rl=!1;function Co(he){const g=he.createTexture();he.bindTexture(he.TEXTURE_2D,g);try{if(he.texImage2D(he.TEXTURE_2D,0,he.RGBA,he.RGBA,he.UNSIGNED_BYTE,kn),he.isContextLost())return;Bt.supported=!0}catch{}he.deleteTexture(g),Io=!0}var as;typeof document<"u"&&(kn=document.createElement("img"),kn.onload=function(){Ur&&Co(Ur),Ur=null,rl=!0},kn.onerror=function(){Io=!0,Ur=null},kn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(he){let g,A,q,nt;he.resetRequestQueue=()=>{g=[],A=0,q=0,nt={}},he.addThrottleControl=ls=>{const Zs=q++;return nt[Zs]=ls,Zs},he.removeThrottleControl=ls=>{delete nt[ls]};const Ft=()=>{const ls=Object.keys(nt);let Zs=!1;if(ls.length>0){for(const ol of ls)if(Zs=nt[ol](),Zs)break}return Zs};he.getImage=(ls,Zs)=>{Bt.supported&&(ls.headers||(ls.headers={}),ls.headers.accept="image/webp,*/*");const ol={requestParameters:ls,callback:Zs,cancelled:!1,completed:!1,cancel:()=>{}};return g.push(ol),Ft()||he.processQueue(),ol};const Xr=ls=>{const{requestParameters:Zs,callback:ol}=ls;return o.getArrayBuffer(Zs,(rh,th,ph,Dh)=>{rh?ol(rh):th&&(($h,Mh)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap($h,Mh):o.arrayBufferToImage($h,Mh)})(th,($h,Mh)=>{$h!=null?ol($h):Mh!=null&&ol(null,Mh,{cacheControl:ph,expires:Dh})}),ls.cancelled||(ls.completed=!0,A--,Ft()||he.processQueue())})};he.processQueue=(ls=0)=>{ls<=0&&(ls=Ft()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS);for(let Zs=A;Zs<ls&&g.length>0;Zs++){const ol=g.shift();if(ol.cancelled)continue;const rh=Xr(ol);A++,ol.innerRequest=rh,ol.cancel=()=>{var th;(th=ol).completed||th.cancelled||(A--,th.cancelled=!0,th.innerRequest.cancel(),he.processQueue())}}return g.length}}(as||(as={})),as.resetRequestQueue();var $s,ah=as;(function(he){he.Glyphs="Glyphs",he.Image="Image",he.Source="Source",he.SpriteImage="SpriteImage",he.SpriteJSON="SpriteJSON",he.Style="Style",he.Tile="Tile",he.Unknown="Unknown"})($s||($s={}));class ch{constructor(g){this._transformRequestFn=g}transformRequest(g,A){return this._transformRequestFn&&this._transformRequestFn(g,A)||{url:g}}normalizeSpriteURL(g,A,q){const nt=function(Ft){const Xr=Ft.match(Zu);if(!Xr)throw new Error(`Unable to parse URL "${Ft}"`);return{protocol:Xr[1],authority:Xr[2],path:Xr[3]||"/",params:Xr[4]?Xr[4].split("&"):[]}}(g);return nt.path+=`${A}${q}`,function(Ft){const Xr=Ft.params.length?`?${Ft.params.join("&")}`:"";return`${Ft.protocol}://${Ft.authority}${Ft.path}${Xr}`}(nt)}setTransformRequest(g){this._transformRequestFn=g}}const Zu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ih(he){var g=new o.ARRAY_TYPE(3);return g[0]=he[0],g[1]=he[1],g[2]=he[2],g}var al,sh=function(he,g,A){return he[0]=g[0]-A[0],he[1]=g[1]-A[1],he[2]=g[2]-A[2],he};al=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(al[0]=0,al[1]=0,al[2]=0);var _h=function(he){var g=he[0],A=he[1];return g*g+A*A};function Ih(he){return typeof he=="string"?[{id:"default",url:he}]:he??[]}(function(){var he=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(he[0]=0,he[1]=0)})();class Lh{constructor(g,A,q,nt){this.context=g,this.format=q,this.texture=g.gl.createTexture(),this.update(A,nt)}update(g,A,q){const{width:nt,height:Ft}=g,Xr=!(this.size&&this.size[0]===nt&&this.size[1]===Ft||q),{context:ls}=this,{gl:Zs}=ls;if(this.useMipmap=!!(A&&A.useMipmap),Zs.bindTexture(Zs.TEXTURE_2D,this.texture),ls.pixelStoreUnpackFlipY.set(!1),ls.pixelStoreUnpack.set(1),ls.pixelStoreUnpackPremultiplyAlpha.set(this.format===Zs.RGBA&&(!A||A.premultiply!==!1)),Xr)this.size=[nt,Ft],g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||o.isImageBitmap(g)?Zs.texImage2D(Zs.TEXTURE_2D,0,this.format,this.format,Zs.UNSIGNED_BYTE,g):Zs.texImage2D(Zs.TEXTURE_2D,0,this.format,nt,Ft,0,this.format,Zs.UNSIGNED_BYTE,g.data);else{const{x:ol,y:rh}=q||{x:0,y:0};g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||o.isImageBitmap(g)?Zs.texSubImage2D(Zs.TEXTURE_2D,0,ol,rh,Zs.RGBA,Zs.UNSIGNED_BYTE,g):Zs.texSubImage2D(Zs.TEXTURE_2D,0,ol,rh,nt,Ft,Zs.RGBA,Zs.UNSIGNED_BYTE,g.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Zs.generateMipmap(Zs.TEXTURE_2D)}bind(g,A,q){const{context:nt}=this,{gl:Ft}=nt;Ft.bindTexture(Ft.TEXTURE_2D,this.texture),q!==Ft.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(q=Ft.LINEAR),g!==this.filter&&(Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MAG_FILTER,g),Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MIN_FILTER,q||g),this.filter=g),A!==this.wrap&&(Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_S,A),Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_T,A),this.wrap=A)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:g}=this.context;g.deleteTexture(this.texture),this.texture=null}}function Gh(he){const{userImage:g}=he;return!!(g&&g.render&&g.render())&&(he.data.replace(new Uint8Array(g.data.buffer)),!0)}class ud extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(g){if(this.loaded!==g&&(this.loaded=g,g)){for(const{ids:A,callback:q}of this.requestors)this._notify(A,q);this.requestors=[]}}getImage(g){const A=this.images[g];if(A&&!A.data&&A.spriteData){const q=A.spriteData;A.data=new o.RGBAImage({width:q.width,height:q.height},q.context.getImageData(q.x,q.y,q.width,q.height).data),A.spriteData=null}return A}addImage(g,A){if(this.images[g])throw new Error(`Image id ${g} already exist, use updateImage instead`);this._validate(g,A)&&(this.images[g]=A)}_validate(g,A){let q=!0;const nt=A.data||A.spriteData;return this._validateStretch(A.stretchX,nt&&nt.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "stretchX" value`))),q=!1),this._validateStretch(A.stretchY,nt&&nt.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "stretchY" value`))),q=!1),this._validateContent(A.content,A)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "content" value`))),q=!1),q}_validateStretch(g,A){if(!g)return!0;let q=0;for(const nt of g){if(nt[0]<q||nt[1]<nt[0]||A<nt[1])return!1;q=nt[1]}return!0}_validateContent(g,A){if(!g)return!0;if(g.length!==4)return!1;const q=A.spriteData,nt=q&&q.width||A.data.width,Ft=q&&q.height||A.data.height;return!(g[0]<0||nt<g[0]||g[1]<0||Ft<g[1]||g[2]<0||nt<g[2]||g[3]<0||Ft<g[3]||g[2]<g[0]||g[3]<g[1])}updateImage(g,A,q=!0){const nt=this.getImage(g);if(q&&(nt.data.width!==A.data.width||nt.data.height!==A.data.height))throw new Error(`size mismatch between old image (${nt.data.width}x${nt.data.height}) and new image (${A.data.width}x${A.data.height}).`);A.version=nt.version+1,this.images[g]=A,this.updatedImages[g]=!0}removeImage(g){const A=this.images[g];delete this.images[g],delete this.patterns[g],A.userImage&&A.userImage.onRemove&&A.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(g,A){let q=!0;if(!this.isLoaded())for(const nt of g)this.images[nt]||(q=!1);this.isLoaded()||q?this._notify(g,A):this.requestors.push({ids:g,callback:A})}_notify(g,A){const q={};for(const nt of g){const Ft=this.getImage(nt);Ft?q[nt]={data:Ft.data.clone(),pixelRatio:Ft.pixelRatio,sdf:Ft.sdf,version:Ft.version,stretchX:Ft.stretchX,stretchY:Ft.stretchY,content:Ft.content,hasRenderCallback:!!(Ft.userImage&&Ft.userImage.render)}:(this.fire(new o.Event("styleimagemissing",{id:nt})),o.warnOnce(`Image "${nt}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`))}A(null,q)}getPixelSize(){const{width:g,height:A}=this.atlasImage;return{width:g,height:A}}getPattern(g){const A=this.patterns[g],q=this.getImage(g);if(!q)return null;if(A&&A.position.version===q.version)return A.position;if(A)A.position.version=q.version;else{const nt={w:q.data.width+2,h:q.data.height+2,x:0,y:0},Ft=new o.ImagePosition(nt,q);this.patterns[g]={bin:nt,position:Ft}}return this._updatePatternAtlas(),this.patterns[g].position}bind(g){const A=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Lh(g,this.atlasImage,A.RGBA),this.atlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE)}_updatePatternAtlas(){const g=[];for(const Ft in this.patterns)g.push(this.patterns[Ft].bin);const{w:A,h:q}=o.potpack(g),nt=this.atlasImage;nt.resize({width:A||1,height:q||1});for(const Ft in this.patterns){const{bin:Xr}=this.patterns[Ft],ls=Xr.x+1,Zs=Xr.y+1,ol=this.getImage(Ft).data,rh=ol.width,th=ol.height;o.RGBAImage.copy(ol,nt,{x:0,y:0},{x:ls,y:Zs},{width:rh,height:th}),o.RGBAImage.copy(ol,nt,{x:0,y:th-1},{x:ls,y:Zs-1},{width:rh,height:1}),o.RGBAImage.copy(ol,nt,{x:0,y:0},{x:ls,y:Zs+th},{width:rh,height:1}),o.RGBAImage.copy(ol,nt,{x:rh-1,y:0},{x:ls-1,y:Zs},{width:1,height:th}),o.RGBAImage.copy(ol,nt,{x:0,y:0},{x:ls+rh,y:Zs},{width:1,height:th})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(g){for(const A of g){if(this.callbackDispatchedThisFrame[A])continue;this.callbackDispatchedThisFrame[A]=!0;const q=this.getImage(A);q||o.warnOnce(`Image with ID: "${A}" was not found`),Gh(q)&&this.updateImage(A,q)}}}const Tf=1e20;function Kd(he,g,A,q,nt,Ft,Xr,ls,Zs){for(let ol=g;ol<g+q;ol++)Af(he,A*Ft+ol,Ft,nt,Xr,ls,Zs);for(let ol=A;ol<A+nt;ol++)Af(he,ol*Ft+g,1,q,Xr,ls,Zs)}function Af(he,g,A,q,nt,Ft,Xr){Ft[0]=0,Xr[0]=-Tf,Xr[1]=Tf,nt[0]=he[g];for(let ls=1,Zs=0,ol=0;ls<q;ls++){nt[ls]=he[g+ls*A];const rh=ls*ls;do{const th=Ft[Zs];ol=(nt[ls]-nt[th]+rh-th*th)/(ls-th)/2}while(ol<=Xr[Zs]&&--Zs>-1);Zs++,Ft[Zs]=ls,Xr[Zs]=ol,Xr[Zs+1]=Tf}for(let ls=0,Zs=0;ls<q;ls++){for(;Xr[Zs+1]<ls;)Zs++;const ol=Ft[Zs],rh=ls-ol;he[g+ls*A]=nt[ol]+rh*rh}}class md{constructor(g,A){this.requestManager=g,this.localIdeographFontFamily=A,this.entries={}}setURL(g){this.url=g}getGlyphs(g,A){const q=[];for(const nt in g)for(const Ft of g[nt])q.push({stack:nt,id:Ft});o.asyncAll(q,({stack:nt,id:Ft},Xr)=>{let ls=this.entries[nt];ls||(ls=this.entries[nt]={glyphs:{},requests:{},ranges:{}});let Zs=ls.glyphs[Ft];if(Zs!==void 0)return void Xr(null,{stack:nt,id:Ft,glyph:Zs});if(Zs=this._tinySDF(ls,nt,Ft),Zs)return ls.glyphs[Ft]=Zs,void Xr(null,{stack:nt,id:Ft,glyph:Zs});const ol=Math.floor(Ft/256);if(256*ol>65535)return void Xr(new Error("glyphs > 65535 not supported"));if(ls.ranges[ol])return void Xr(null,{stack:nt,id:Ft,glyph:Zs});if(!this.url)return void Xr(new Error("glyphsUrl is not set"));let rh=ls.requests[ol];rh||(rh=ls.requests[ol]=[],md.loadGlyphRange(nt,ol,this.url,this.requestManager,(th,ph)=>{if(ph){for(const Dh in ph)this._doesCharSupportLocalGlyph(+Dh)||(ls.glyphs[+Dh]=ph[+Dh]);ls.ranges[ol]=!0}for(const Dh of rh)Dh(th,ph);delete ls.requests[ol]})),rh.push((th,ph)=>{th?Xr(th):ph&&Xr(null,{stack:nt,id:Ft,glyph:ph[Ft]||null})})},(nt,Ft)=>{if(nt)A(nt);else if(Ft){const Xr={};for(const{stack:ls,id:Zs,glyph:ol}of Ft)(Xr[ls]||(Xr[ls]={}))[Zs]=ol&&{id:ol.id,bitmap:ol.bitmap.clone(),metrics:ol.metrics};A(null,Xr)}})}_doesCharSupportLocalGlyph(g){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](g)||o.unicodeBlockLookup["Hangul Syllables"](g)||o.unicodeBlockLookup.Hiragana(g)||o.unicodeBlockLookup.Katakana(g))}_tinySDF(g,A,q){const nt=this.localIdeographFontFamily;if(!nt||!this._doesCharSupportLocalGlyph(q))return;let Ft=g.tinySDF;if(!Ft){let ls="400";/bold/i.test(A)?ls="900":/medium/i.test(A)?ls="500":/light/i.test(A)&&(ls="200"),Ft=g.tinySDF=new md.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:nt,fontWeight:ls})}const Xr=Ft.draw(String.fromCharCode(q));return{id:q,bitmap:new o.AlphaImage({width:Xr.width||30,height:Xr.height||30},Xr.data),metrics:{width:Xr.glyphWidth||24,height:Xr.glyphHeight||24,left:Xr.glyphLeft||0,top:Xr.glyphTop-27||-8,advance:Xr.glyphAdvance||24}}}}md.loadGlyphRange=function(he,g,A,q,nt){const Ft=256*g,Xr=Ft+255,ls=q.transformRequest(A.replace("{fontstack}",he).replace("{range}",`${Ft}-${Xr}`),$s.Glyphs);o.getArrayBuffer(ls,(Zs,ol)=>{if(Zs)nt(Zs);else if(ol){const rh={};for(const th of o.parseGlyphPbf(ol))rh[th.id]=th;nt(null,rh)}})},md.TinySDF=class{constructor({fontSize:he=24,buffer:g=3,radius:A=8,cutoff:q=.25,fontFamily:nt="sans-serif",fontWeight:Ft="normal",fontStyle:Xr="normal"}={}){this.buffer=g,this.cutoff=q,this.radius=A;const ls=this.size=he+4*g,Zs=this._createCanvas(ls),ol=this.ctx=Zs.getContext("2d",{willReadFrequently:!0});ol.font=`${Xr} ${Ft} ${he}px ${nt}`,ol.textBaseline="alphabetic",ol.textAlign="left",ol.fillStyle="black",this.gridOuter=new Float64Array(ls*ls),this.gridInner=new Float64Array(ls*ls),this.f=new Float64Array(ls),this.z=new Float64Array(ls+1),this.v=new Uint16Array(ls)}_createCanvas(he){const g=document.createElement("canvas");return g.width=g.height=he,g}draw(he){const{width:g,actualBoundingBoxAscent:A,actualBoundingBoxDescent:q,actualBoundingBoxLeft:nt,actualBoundingBoxRight:Ft}=this.ctx.measureText(he),Xr=Math.ceil(A),ls=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(Ft-nt))),Zs=Math.min(this.size-this.buffer,Xr+Math.ceil(q)),ol=ls+2*this.buffer,rh=Zs+2*this.buffer,th=Math.max(ol*rh,0),ph=new Uint8ClampedArray(th),Dh={data:ph,width:ol,height:rh,glyphWidth:ls,glyphHeight:Zs,glyphTop:Xr,glyphLeft:0,glyphAdvance:g};if(ls===0||Zs===0)return Dh;const{ctx:$h,buffer:Mh,gridInner:Kh,gridOuter:fd}=this;$h.clearRect(Mh,Mh,ls,Zs),$h.fillText(he,Mh,Mh+Xr);const cd=$h.getImageData(Mh,Mh,ls,Zs);fd.fill(Tf,0,th),Kh.fill(0,0,th);for(let jh=0;jh<Zs;jh++)for(let Td=0;Td<ls;Td++){const Vd=cd.data[4*(jh*ls+Td)+3]/255;if(Vd===0)continue;const Wd=(jh+Mh)*ol+Td+Mh;if(Vd===1)fd[Wd]=0,Kh[Wd]=Tf;else{const Mf=.5-Vd;fd[Wd]=Mf>0?Mf*Mf:0,Kh[Wd]=Mf<0?Mf*Mf:0}}Kd(fd,0,0,ol,rh,ol,this.f,this.v,this.z),Kd(Kh,Mh,Mh,ls,Zs,ol,this.f,this.v,this.z);for(let jh=0;jh<th;jh++){const Td=Math.sqrt(fd[jh])-Math.sqrt(Kh[jh]);ph[jh]=Math.round(255-255*(Td/this.radius+this.cutoff))}return Dh}};const vd=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(he,g){return o.sphericalToCartesian(he.expression.evaluate(g))}interpolate(he,g,A){return{x:o.number(he.x,g.x,A),y:o.number(he.y,g.y,A),z:o.number(he.z,g.z,A)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),qd="-transition";class Ed extends o.Evented{constructor(g){super(),this._transitionable=new o.Transitionable(vd),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(g,A={}){if(!this._validate(o.validateLight,g,A))for(const q in g){const nt=g[q];q.endsWith(qd)?this._transitionable.setTransition(q.slice(0,-qd.length),nt):this._transitionable.setValue(q,nt)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,A,q){return(!q||q.validate!==!1)&&o.emitValidationErrors(this,g.call(o.validateStyle,o.extend({value:A,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Sd{constructor(g,A){this.width=g,this.height=A,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(g,A){const q=g.join(",")+String(A);return this.dashEntry[q]||(this.dashEntry[q]=this.addDash(g,A)),this.dashEntry[q]}getDashRanges(g,A,q){const nt=[];let Ft=g.length%2==1?-g[g.length-1]*q:0,Xr=g[0]*q,ls=!0;nt.push({left:Ft,right:Xr,isDash:ls,zeroLength:g[0]===0});let Zs=g[0];for(let ol=1;ol<g.length;ol++){ls=!ls;const rh=g[ol];Ft=Zs*q,Zs+=rh,Xr=Zs*q,nt.push({left:Ft,right:Xr,isDash:ls,zeroLength:rh===0})}return nt}addRoundDash(g,A,q){const nt=A/2;for(let Ft=-q;Ft<=q;Ft++){const Xr=this.width*(this.nextRow+q+Ft);let ls=0,Zs=g[ls];for(let ol=0;ol<this.width;ol++){ol/Zs.right>1&&(Zs=g[++ls]);const rh=Math.abs(ol-Zs.left),th=Math.abs(ol-Zs.right),ph=Math.min(rh,th);let Dh;const $h=Ft/q*(nt+1);if(Zs.isDash){const Mh=nt-Math.abs($h);Dh=Math.sqrt(ph*ph+Mh*Mh)}else Dh=nt-Math.sqrt(ph*ph+$h*$h);this.data[Xr+ol]=Math.max(0,Math.min(255,Dh+128))}}}addRegularDash(g){for(let ls=g.length-1;ls>=0;--ls){const Zs=g[ls],ol=g[ls+1];Zs.zeroLength?g.splice(ls,1):ol&&ol.isDash===Zs.isDash&&(ol.left=Zs.left,g.splice(ls,1))}const A=g[0],q=g[g.length-1];A.isDash===q.isDash&&(A.left=q.left-this.width,q.right=A.right+this.width);const nt=this.width*this.nextRow;let Ft=0,Xr=g[Ft];for(let ls=0;ls<this.width;ls++){ls/Xr.right>1&&(Xr=g[++Ft]);const Zs=Math.abs(ls-Xr.left),ol=Math.abs(ls-Xr.right),rh=Math.min(Zs,ol);this.data[nt+ls]=Math.max(0,Math.min(255,(Xr.isDash?rh:-rh)+128))}}addDash(g,A){const q=A?7:0,nt=2*q+1;if(this.nextRow+nt>this.height)return o.warnOnce("LineAtlas out of space"),null;let Ft=0;for(let ls=0;ls<g.length;ls++)Ft+=g[ls];if(Ft!==0){const ls=this.width/Ft,Zs=this.getDashRanges(g,this.width,ls);A?this.addRoundDash(Zs,ls,q):this.addRegularDash(Zs)}const Xr={y:(this.nextRow+q+.5)/this.height,height:2*q/this.height,width:Ft};return this.nextRow+=nt,this.dirty=!0,Xr}bind(g){const A=g.gl;this.texture?(A.bindTexture(A.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,A.texSubImage2D(A.TEXTURE_2D,0,0,0,this.width,this.height,A.ALPHA,A.UNSIGNED_BYTE,this.data))):(this.texture=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.texture),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texImage2D(A.TEXTURE_2D,0,A.ALPHA,this.width,this.height,0,A.ALPHA,A.UNSIGNED_BYTE,this.data))}}class zd{constructor(g,A,q){this.workerPool=g,this.actors=[],this.currentActor=0,this.id=q;const nt=this.workerPool.acquire(q);for(let Ft=0;Ft<nt.length;Ft++){const Xr=new zd.Actor(nt[Ft],A,q);Xr.name=`Worker ${Ft}`,this.actors.push(Xr)}if(!this.actors.length)throw new Error("No actors found")}broadcast(g,A,q){o.asyncAll(this.actors,(nt,Ft)=>{nt.send(g,A,Ft)},q=q||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(g=!0){this.actors.forEach(A=>{A.remove()}),this.actors=[],g&&this.workerPool.release(this.id)}}function Md(he,g,A){const q=function(nt,Ft){if(nt)return A(nt);if(Ft){const Xr=o.pick(o.extend(Ft,he),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);Ft.vector_layers&&(Xr.vectorLayers=Ft.vector_layers,Xr.vectorLayerIds=Xr.vectorLayers.map(ls=>ls.id)),A(null,Xr)}};return he.url?o.getJSON(g.transformRequest(he.url,$s.Source),q):o.exported.frame(()=>q(null,he))}zd.Actor=o.Actor;class Gd{constructor(g,A,q){this.bounds=o.LngLatBounds.convert(this.validateBounds(g)),this.minzoom=A||0,this.maxzoom=q||24}validateBounds(g){return Array.isArray(g)&&g.length===4?[Math.max(-180,g[0]),Math.max(-90,g[1]),Math.min(180,g[2]),Math.min(90,g[3])]:[-180,-90,180,90]}contains(g){const A=Math.pow(2,g.z),q=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*A),nt=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*A),Ft=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*A),Xr=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*A);return g.x>=q&&g.x<Ft&&g.y>=nt&&g.y<Xr}}class bf extends o.Evented{constructor(g,A,q,nt){if(super(),this.id=g,this.dispatcher=q,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(A,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},A),this._collectResourceTiming=A.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(nt)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Md(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new o.ErrorEvent(g)):A&&(o.extend(this,A),A.bounds&&(this.tileBounds=new Gd(A.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(g,A){const q=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),nt={request:this.map._requestManager.transformRequest(q,$s.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function Ft(Xr,ls){return delete g.request,g.aborted?A(null):Xr&&Xr.status!==404?A(Xr):(ls&&ls.resourceTiming&&(g.resourceTiming=ls.resourceTiming),this.map._refreshExpiredTiles&&ls&&g.setExpiryData(ls),g.loadVectorData(ls,this.map.painter),A(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}nt.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=A:g.request=g.actor.send("reloadTile",nt,Ft.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",nt,Ft.bind(this)))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Id extends o.Evented{constructor(g,A,q,nt){super(),this.id=g,this.dispatcher=q,this.setEventedParent(nt),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},A),o.extend(this,o.pick(A,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Md(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new o.ErrorEvent(g)):A&&(o.extend(this,A),A.bounds&&(this.tileBounds=new Gd(A.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(g){this.map=g,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,A){const q=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);g.request=ah.getImage(this.map._requestManager.transformRequest(q,$s.Tile),(nt,Ft,Xr)=>{if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(nt)g.state="errored",A(nt);else if(Ft){this.map._refreshExpiredTiles&&g.setExpiryData(Xr);const ls=this.map.painter.context,Zs=ls.gl;g.texture=this.map.painter.getTileTexture(Ft.width),g.texture?g.texture.update(Ft,{useMipmap:!0}):(g.texture=new Lh(ls,Ft,Zs.RGBA,{useMipmap:!0}),g.texture.bind(Zs.LINEAR,Zs.CLAMP_TO_EDGE,Zs.LINEAR_MIPMAP_NEAREST),ls.extTextureFilterAnisotropic&&Zs.texParameterf(Zs.TEXTURE_2D,ls.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ls.extTextureFilterAnisotropicMax)),g.state="loaded",A(null)}})}abortTile(g,A){g.request&&(g.request.cancel(),delete g.request),A()}unloadTile(g,A){g.texture&&this.map.painter.saveTileTexture(g.texture),A()}hasTransition(){return!1}}let td;class Fd extends Id{constructor(g,A,q,nt){super(g,A,q,nt),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},A),this.encoding=A.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(g,A){const q=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function nt(Ft,Xr){Ft&&(g.state="errored",A(Ft)),Xr&&(g.dem=Xr,g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0,g.state="loaded",A(null))}g.request=ah.getImage(this.map._requestManager.transformRequest(q,$s.Tile),function(Ft,Xr){if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(Ft)g.state="errored",A(Ft);else if(Xr){this.map._refreshExpiredTiles&&g.setExpiryData(Xr),delete Xr.cacheControl,delete Xr.expires;const ls=o.isImageBitmap(Xr)&&(td==null&&(td=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),td)?Xr:o.exported.getImageData(Xr,1),Zs={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:ls,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",Zs,nt.bind(this)))}}.bind(this)),g.neighboringTiles=this._getNeighboringTiles(g.tileID)}_getNeighboringTiles(g){const A=g.canonical,q=Math.pow(2,A.z),nt=(A.x-1+q)%q,Ft=A.x===0?g.wrap-1:g.wrap,Xr=(A.x+1+q)%q,ls=A.x+1===q?g.wrap+1:g.wrap,Zs={};return Zs[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,nt,A.y).key]={backfilled:!1},Zs[new o.OverscaledTileID(g.overscaledZ,ls,A.z,Xr,A.y).key]={backfilled:!1},A.y>0&&(Zs[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,nt,A.y-1).key]={backfilled:!1},Zs[new o.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y-1).key]={backfilled:!1},Zs[new o.OverscaledTileID(g.overscaledZ,ls,A.z,Xr,A.y-1).key]={backfilled:!1}),A.y+1<q&&(Zs[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,nt,A.y+1).key]={backfilled:!1},Zs[new o.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y+1).key]={backfilled:!1},Zs[new o.OverscaledTileID(g.overscaledZ,ls,A.z,Xr,A.y+1).key]={backfilled:!1}),Zs}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})}}class rp extends o.Evented{constructor(g,A,q,nt){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=q.getActor(),this.setEventedParent(nt),this._data=A.data,this._options=o.extend({},A),this._collectResourceTiming=A.collectResourceTiming,A.maxzoom!==void 0&&(this.maxzoom=A.maxzoom),A.type&&(this.type=A.type),A.attribution&&(this.attribution=A.attribution),this.promoteId=A.promoteId;const Ft=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:A.cluster||!1,geojsonVtOptions:{buffer:(A.buffer!==void 0?A.buffer:128)*Ft,tolerance:(A.tolerance!==void 0?A.tolerance:.375)*Ft,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:A.lineMetrics||!1,generateId:A.generateId||!1},superclusterOptions:{maxZoom:A.clusterMaxZoom!==void 0?A.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,A.clusterMinPoints||2),extent:o.EXTENT,radius:(A.clusterRadius||50)*Ft,log:!1,generateId:A.generateId||!1},clusterProperties:A.clusterProperties,filter:A.filter},A.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(g){this.map=g,this.load()}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){return this._updateWorkerData(g),this}setClusterOptions(g){return this.workerOptions.cluster=g.cluster,g&&(g.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=g.clusterRadius),g.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=g.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(g,A){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},A),this}getClusterChildren(g,A){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},A),this}getClusterLeaves(g,A,q,nt){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:A,offset:q},nt),this}_updateWorkerData(g){const A=o.extend({},this.workerOptions);g?A.dataDiff=g:typeof this._data=="string"?(A.request=this.map._requestManager.transformRequest(o.exported.resolveURL(this._data),$s.Source),A.request.collectResourceTiming=this._collectResourceTiming):A.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,A,(q,nt)=>{if(this._pendingLoads--,this._removed||nt&&nt.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let Ft=null;if(nt&&nt.resourceTiming&&nt.resourceTiming[this.id]&&(Ft=nt.resourceTiming[this.id].slice(0)),q)return void this.fire(new o.ErrorEvent(q));const Xr={dataType:"source"};this._collectResourceTiming&&Ft&&Ft.length>0&&o.extend(Xr,{resourceTiming:Ft}),this.fire(new o.Event("data",{...Xr,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...Xr,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(g,A){const q=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const nt={type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request=this.actor.send(q,nt,(Ft,Xr)=>(delete g.request,g.unloadVectorData(),g.aborted?A(null):Ft?A(Ft):(g.loadVectorData(Xr,this.map.painter,q==="reloadTile"),A(null))))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var jf=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class yd extends o.Evented{constructor(g,A,q,nt){super(),this.id=g,this.dispatcher=q,this.coordinates=A.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(nt),this.options=A}load(g,A){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ah.getImage(this.map._requestManager.transformRequest(this.url,$s.Image),(q,nt)=>{this._request=null,this._loaded=!0,q?this.fire(new o.ErrorEvent(q)):nt&&(this.image=nt,g&&(this.coordinates=g),A&&A(),this._finishLoading())})}loaded(){return this._loaded}updateImage(g){return g.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=g.url,this.load(g.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(g){this.map=g,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(g){this.coordinates=g;const A=g.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(nt){let Ft=1/0,Xr=1/0,ls=-1/0,Zs=-1/0;for(const ph of nt)Ft=Math.min(Ft,ph.x),Xr=Math.min(Xr,ph.y),ls=Math.max(ls,ph.x),Zs=Math.max(Zs,ph.y);const ol=Math.max(ls-Ft,Zs-Xr),rh=Math.max(0,Math.floor(-Math.log(ol)/Math.LN2)),th=Math.pow(2,rh);return new o.CanonicalTileID(rh,Math.floor((Ft+ls)/2*th),Math.floor((Xr+Zs)/2*th))}(A),this.minzoom=this.maxzoom=this.tileID.z;const q=A.map(nt=>this.tileID.getTilePoint(nt)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(q[0].x,q[0].y,0,0),this._boundsArray.emplaceBack(q[1].x,q[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(q[3].x,q[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(q[2].x,q[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,jf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Lh(g,this.image,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));for(const q in this.tiles){const nt=this.tiles[q];nt.state!=="loaded"&&(nt.state="loaded",nt.texture=this.texture)}}loadTile(g,A){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},A(null)):(g.state="errored",A(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jd extends yd{constructor(g,A,q,nt){super(g,A,q,nt),this.roundZoom=!0,this.type="video",this.options=A}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const A of g.urls)this.urls.push(this.map._requestManager.transformRequest(A,$s.Source).url);o.getVideo(this.urls,(A,q)=>{this._loaded=!0,A?this.fire(new o.ErrorEvent(A)):q&&(this.video=q,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const A=this.video.seekable;g<A.start(0)||g>A.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${A.start(0)} and ${A.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,jf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.texSubImage2D(A.TEXTURE_2D,0,0,0,A.RGBA,A.UNSIGNED_BYTE,this.video)):(this.texture=new Lh(g,this.video,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));for(const q in this.tiles){const nt=this.tiles[q];nt.state!=="loaded"&&(nt.state="loaded",nt.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class op extends yd{constructor(g,A,q,nt){super(g,A,q,nt),A.coordinates?Array.isArray(A.coordinates)&&A.coordinates.length===4&&!A.coordinates.some(Ft=>!Array.isArray(Ft)||Ft.length!==2||Ft.some(Xr=>typeof Xr!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),A.animate&&typeof A.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),A.canvas?typeof A.canvas=="string"||A.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=A,this.animate=A.animate===void 0||A.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const A=this.map.painter.context,q=A.gl;this.boundsBuffer||(this.boundsBuffer=A.createVertexBuffer(this._boundsArray,jf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Lh(A,this.canvas,q.RGBA,{premultiply:!0});for(const nt in this.tiles){const Ft=this.tiles[nt];Ft.state!=="loaded"&&(Ft.state="loaded",Ft.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}}const bp={vector:bf,raster:Id,"raster-dem":Fd,geojson:rp,video:Jd,image:yd,canvas:op};function fp(he,g){const A=o.create();return o.translate(A,A,[1,1,0]),o.scale(A,A,[.5*he.width,.5*he.height,1]),o.multiply(A,A,he.calculatePosMatrix(g.toUnwrapped()))}function Qh(he,g,A,q,nt,Ft){const Xr=function(th,ph,Dh){if(th)for(const $h of th){const Mh=ph[$h];if(Mh&&Mh.source===Dh&&Mh.type==="fill-extrusion")return!0}else for(const $h in ph){const Mh=ph[$h];if(Mh.source===Dh&&Mh.type==="fill-extrusion")return!0}return!1}(nt&&nt.layers,g,he.id),ls=Ft.maxPitchScaleFactor(),Zs=he.tilesIn(q,ls,Xr);Zs.sort(Yd);const ol=[];for(const th of Zs)ol.push({wrappedTileID:th.tileID.wrapped().key,queryResults:th.tile.queryRenderedFeatures(g,A,he._state,th.queryGeometry,th.cameraQueryGeometry,th.scale,nt,Ft,ls,fp(he.transform,th.tileID))});const rh=function(th){const ph={},Dh={};for(const $h of th){const Mh=$h.queryResults,Kh=$h.wrappedTileID,fd=Dh[Kh]=Dh[Kh]||{};for(const cd in Mh){const jh=Mh[cd],Td=fd[cd]=fd[cd]||{},Vd=ph[cd]=ph[cd]||[];for(const Wd of jh)Td[Wd.featureIndex]||(Td[Wd.featureIndex]=!0,Vd.push(Wd))}}return ph}(ol);for(const th in rh)rh[th].forEach(ph=>{const Dh=ph.feature,$h=he.getFeatureState(Dh.layer["source-layer"],Dh.id);Dh.source=Dh.layer.source,Dh.layer["source-layer"]&&(Dh.sourceLayer=Dh.layer["source-layer"]),Dh.state=$h});return rh}function Yd(he,g){const A=he.tileID,q=g.tileID;return A.overscaledZ-q.overscaledZ||A.canonical.y-q.canonical.y||A.wrap-q.wrap||A.canonical.x-q.canonical.x}class sd{constructor(g,A){this.tileID=g,this.uid=o.uniqueId(),this.uses=0,this.tileSize=A,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(g){const A=g+this.timeAdded;A<o.exported.now()||this.fadeEndTime&&A<this.fadeEndTime||(this.fadeEndTime=A)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(g){this.demTexture&&g.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(g,A,q){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",g){g.featureIndex&&(this.latestFeatureIndex=g.featureIndex,g.rawTileData?(this.latestRawTileData=g.rawTileData,this.latestFeatureIndex.rawTileData=g.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=g.collisionBoxArray,this.buckets=function(nt,Ft){const Xr={};if(!Ft)return Xr;for(const ls of nt){const Zs=ls.layerIds.map(ol=>Ft.getLayer(ol)).filter(Boolean);if(Zs.length!==0){ls.layers=Zs,ls.stateDependentLayerIds&&(ls.stateDependentLayers=ls.stateDependentLayerIds.map(ol=>Zs.filter(rh=>rh.id===ol)[0]));for(const ol of Zs)Xr[ol.id]=ls}}return Xr}(g.buckets,A.style),this.hasSymbolBuckets=!1;for(const nt in this.buckets){const Ft=this.buckets[nt];if(Ft instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!q)break;Ft.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const nt in this.buckets){const Ft=this.buckets[nt];if(Ft instanceof o.SymbolBucket&&Ft.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const nt in this.buckets){const Ft=this.buckets[nt];this.queryPadding=Math.max(this.queryPadding,A.style.getLayer(nt).queryRadius(Ft))}g.imageAtlas&&(this.imageAtlas=g.imageAtlas),g.glyphAtlasImage&&(this.glyphAtlasImage=g.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const g in this.buckets)this.buckets[g].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(g){return this.buckets[g.id]}upload(g){for(const q in this.buckets){const nt=this.buckets[q];nt.uploadPending()&&nt.upload(g)}const A=g.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lh(g,this.imageAtlas.image,A.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lh(g,this.glyphAtlasImage,A.ALPHA),this.glyphAtlasImage=null)}prepare(g){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(g,this.imageAtlasTexture)}queryRenderedFeatures(g,A,q,nt,Ft,Xr,ls,Zs,ol,rh){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:nt,cameraQueryGeometry:Ft,scale:Xr,tileSize:this.tileSize,pixelPosMatrix:rh,transform:Zs,params:ls,queryPadding:this.queryPadding*ol},g,A,q):{}}querySourceFeatures(g,A){const q=this.latestFeatureIndex;if(!q||!q.rawTileData)return;const nt=q.loadVTLayers(),Ft=A&&A.sourceLayer?A.sourceLayer:"",Xr=nt._geojsonTileLayer||nt[Ft];if(!Xr)return;const ls=o.createFilter(A&&A.filter),{z:Zs,x:ol,y:rh}=this.tileID.canonical,th={z:Zs,x:ol,y:rh};for(let ph=0;ph<Xr.length;ph++){const Dh=Xr.feature(ph);if(ls.needGeometry){const Kh=o.toEvaluationFeature(Dh,!0);if(!ls.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Kh,this.tileID.canonical))continue}else if(!ls.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Dh))continue;const $h=q.getId(Dh,Ft),Mh=new o.GeoJSONFeature(Dh,Zs,ol,rh,$h);Mh.tile=th,g.push(Mh)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(g){const A=this.expirationTime;if(g.cacheControl){const q=o.parseCacheControl(g.cacheControl);q["max-age"]&&(this.expirationTime=Date.now()+1e3*q["max-age"])}else g.expires&&(this.expirationTime=new Date(g.expires).getTime());if(this.expirationTime){const q=Date.now();let nt=!1;if(this.expirationTime>q)nt=!1;else if(A)if(this.expirationTime<A)nt=!0;else{const Ft=this.expirationTime-A;Ft?this.expirationTime=q+Math.max(Ft,3e4):nt=!0}else nt=!0;nt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(g,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(g).length===0)return;const q=this.latestFeatureIndex.loadVTLayers();for(const nt in this.buckets){if(!A.style.hasLayer(nt))continue;const Ft=this.buckets[nt],Xr=Ft.layers[0].sourceLayer||"_geojsonTileLayer",ls=q[Xr],Zs=g[Xr];if(!ls||!Zs||Object.keys(Zs).length===0)continue;Ft.update(Zs,ls,this.imageAtlas&&this.imageAtlas.patternPositions||{});const ol=A&&A.style&&A.style.getLayer(nt);ol&&(this.queryPadding=Math.max(this.queryPadding,ol.queryRadius(Ft)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(g){this.symbolFadeHoldUntil=o.exported.now()+g}setDependencies(g,A){const q={};for(const nt of A)q[nt]=!0;this.dependencies[g]=q}hasDependency(g,A){for(const q of g){const nt=this.dependencies[q];if(nt){for(const Ft of A)if(nt[Ft])return!0}}return!1}}class Zd{constructor(g,A){this.max=g,this.onRemove=A,this.reset()}reset(){for(const g in this.data)for(const A of this.data[g])A.timeout&&clearTimeout(A.timeout),this.onRemove(A.value);return this.data={},this.order=[],this}add(g,A,q){const nt=g.wrapped().key;this.data[nt]===void 0&&(this.data[nt]=[]);const Ft={value:A,timeout:void 0};if(q!==void 0&&(Ft.timeout=setTimeout(()=>{this.remove(g,Ft)},q)),this.data[nt].push(Ft),this.order.push(nt),this.order.length>this.max){const Xr=this._getAndRemoveByKey(this.order[0]);Xr&&this.onRemove(Xr)}return this}has(g){return g.wrapped().key in this.data}getAndRemove(g){return this.has(g)?this._getAndRemoveByKey(g.wrapped().key):null}_getAndRemoveByKey(g){const A=this.data[g].shift();return A.timeout&&clearTimeout(A.timeout),this.data[g].length===0&&delete this.data[g],this.order.splice(this.order.indexOf(g),1),A.value}getByKey(g){const A=this.data[g];return A?A[0].value:null}get(g){return this.has(g)?this.data[g.wrapped().key][0].value:null}remove(g,A){if(!this.has(g))return this;const q=g.wrapped().key,nt=A===void 0?0:this.data[q].indexOf(A),Ft=this.data[q][nt];return this.data[q].splice(nt,1),Ft.timeout&&clearTimeout(Ft.timeout),this.data[q].length===0&&delete this.data[q],this.onRemove(Ft.value),this.order.splice(this.order.indexOf(q),1),this}setMaxSize(g){for(this.max=g;this.order.length>this.max;){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}filter(g){const A=[];for(const q in this.data)for(const nt of this.data[q])g(nt.value)||A.push(nt);for(const q of A)this.remove(q.value.tileID,q)}}class Xh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(g,A,q){const nt=String(A);if(this.stateChanges[g]=this.stateChanges[g]||{},this.stateChanges[g][nt]=this.stateChanges[g][nt]||{},o.extend(this.stateChanges[g][nt],q),this.deletedStates[g]===null){this.deletedStates[g]={};for(const Ft in this.state[g])Ft!==nt&&(this.deletedStates[g][Ft]=null)}else if(this.deletedStates[g]&&this.deletedStates[g][nt]===null){this.deletedStates[g][nt]={};for(const Ft in this.state[g][nt])q[Ft]||(this.deletedStates[g][nt][Ft]=null)}else for(const Ft in q)this.deletedStates[g]&&this.deletedStates[g][nt]&&this.deletedStates[g][nt][Ft]===null&&delete this.deletedStates[g][nt][Ft]}removeFeatureState(g,A,q){if(this.deletedStates[g]===null)return;const nt=String(A);if(this.deletedStates[g]=this.deletedStates[g]||{},q&&A!==void 0)this.deletedStates[g][nt]!==null&&(this.deletedStates[g][nt]=this.deletedStates[g][nt]||{},this.deletedStates[g][nt][q]=null);else if(A!==void 0)if(this.stateChanges[g]&&this.stateChanges[g][nt])for(q in this.deletedStates[g][nt]={},this.stateChanges[g][nt])this.deletedStates[g][nt][q]=null;else this.deletedStates[g][nt]=null;else this.deletedStates[g]=null}getState(g,A){const q=String(A),nt=o.extend({},(this.state[g]||{})[q],(this.stateChanges[g]||{})[q]);if(this.deletedStates[g]===null)return{};if(this.deletedStates[g]){const Ft=this.deletedStates[g][A];if(Ft===null)return{};for(const Xr in Ft)delete nt[Xr]}return nt}initializeTileState(g,A){g.setFeatureState(this.state,A)}coalesceChanges(g,A){const q={};for(const nt in this.stateChanges){this.state[nt]=this.state[nt]||{};const Ft={};for(const Xr in this.stateChanges[nt])this.state[nt][Xr]||(this.state[nt][Xr]={}),o.extend(this.state[nt][Xr],this.stateChanges[nt][Xr]),Ft[Xr]=this.state[nt][Xr];q[nt]=Ft}for(const nt in this.deletedStates){this.state[nt]=this.state[nt]||{};const Ft={};if(this.deletedStates[nt]===null)for(const Xr in this.state[nt])Ft[Xr]={},this.state[nt][Xr]={};else for(const Xr in this.deletedStates[nt]){if(this.deletedStates[nt][Xr]===null)this.state[nt][Xr]={};else for(const ls of Object.keys(this.deletedStates[nt][Xr]))delete this.state[nt][Xr][ls];Ft[Xr]=this.state[nt][Xr]}q[nt]=q[nt]||{},o.extend(q[nt],Ft)}if(this.stateChanges={},this.deletedStates={},Object.keys(q).length!==0)for(const nt in g)g[nt].setFeatureState(q,A)}}class Ld extends o.Evented{constructor(g,A,q){super(),this.id=g,this.dispatcher=q,this.on("data",nt=>{nt.dataType==="source"&&nt.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&nt.dataType==="source"&&nt.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(nt,Ft,Xr,ls){const Zs=new bp[Ft.type](nt,Ft,Xr,ls);if(Zs.id!==nt)throw new Error(`Expected Source id to be ${nt} instead of ${Zs.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],Zs),Zs}(g,A,q,this),this._tiles={},this._cache=new Zd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xh}onAdd(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(g)}onRemove(g){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(g)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const g in this._tiles){const A=this._tiles[g];if(A.state!=="loaded"&&A.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(g,A){return this._source.loadTile(g,A)}_unloadTile(g){if(this._source.unloadTile)return this._source.unloadTile(g,()=>{})}_abortTile(g){this._source.abortTile&&this._source.abortTile(g,()=>{}),this._source.fire(new o.Event("dataabort",{tile:g,coord:g.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(g){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const A in this._tiles){const q=this._tiles[A];q.upload(g),q.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(g=>g.tileID).sort(Kf).map(g=>g.key)}getRenderableIds(g){const A=[];for(const q in this._tiles)this._isIdRenderable(q,g)&&A.push(this._tiles[q]);return g?A.sort((q,nt)=>{const Ft=q.tileID,Xr=nt.tileID,ls=new o.pointGeometry(Ft.canonical.x,Ft.canonical.y)._rotate(this.transform.angle),Zs=new o.pointGeometry(Xr.canonical.x,Xr.canonical.y)._rotate(this.transform.angle);return Ft.overscaledZ-Xr.overscaledZ||Zs.y-ls.y||Zs.x-ls.x}).map(q=>q.tileID.key):A.map(q=>q.tileID).sort(Kf).map(q=>q.key)}hasRenderableParent(g){const A=this.findLoadedParent(g,0);return!!A&&this._isIdRenderable(A.tileID.key)}_isIdRenderable(g,A){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(A||!this._tiles[g].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const g in this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")}}_reloadTile(g,A){const q=this._tiles[g];q&&(q.state!=="loading"&&(q.state=A),this._loadTile(q,this._tileLoaded.bind(this,q,g,A)))}_tileLoaded(g,A,q,nt){if(nt)return g.state="errored",void(nt.status!==404?this._source.fire(new o.ErrorEvent(nt,{tile:g})):this.update(this.transform,this.terrain));g.timeAdded=o.exported.now(),q==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(A,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),g.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:g,coord:g.tileID}))}_backfillDEM(g){const A=this.getRenderableIds();for(let nt=0;nt<A.length;nt++){const Ft=A[nt];if(g.neighboringTiles&&g.neighboringTiles[Ft]){const Xr=this.getTileByID(Ft);q(g,Xr),q(Xr,g)}}function q(nt,Ft){nt.needsHillshadePrepare=!0,nt.needsTerrainPrepare=!0;let Xr=Ft.tileID.canonical.x-nt.tileID.canonical.x;const ls=Ft.tileID.canonical.y-nt.tileID.canonical.y,Zs=Math.pow(2,nt.tileID.canonical.z),ol=Ft.tileID.key;Xr===0&&ls===0||Math.abs(ls)>1||(Math.abs(Xr)>1&&(Math.abs(Xr+Zs)===1?Xr+=Zs:Math.abs(Xr-Zs)===1&&(Xr-=Zs)),Ft.dem&&nt.dem&&(nt.dem.backfillBorder(Ft.dem,Xr,ls),nt.neighboringTiles&&nt.neighboringTiles[ol]&&(nt.neighboringTiles[ol].backfilled=!0)))}}getTile(g){return this.getTileByID(g.key)}getTileByID(g){return this._tiles[g]}_retainLoadedChildren(g,A,q,nt){for(const Ft in this._tiles){let Xr=this._tiles[Ft];if(nt[Ft]||!Xr.hasData()||Xr.tileID.overscaledZ<=A||Xr.tileID.overscaledZ>q)continue;let ls=Xr.tileID;for(;Xr&&Xr.tileID.overscaledZ>A+1;){const ol=Xr.tileID.scaledTo(Xr.tileID.overscaledZ-1);Xr=this._tiles[ol.key],Xr&&Xr.hasData()&&(ls=ol)}let Zs=ls;for(;Zs.overscaledZ>A;)if(Zs=Zs.scaledTo(Zs.overscaledZ-1),g[Zs.key]){nt[ls.key]=ls;break}}}findLoadedParent(g,A){if(g.key in this._loadedParentTiles){const q=this._loadedParentTiles[g.key];return q&&q.tileID.overscaledZ>=A?q:null}for(let q=g.overscaledZ-1;q>=A;q--){const nt=g.scaledTo(q),Ft=this._getLoadedTile(nt);if(Ft)return Ft}}_getLoadedTile(g){const A=this._tiles[g.key];return A&&A.hasData()?A:this._cache.getByKey(g.wrapped().key)}updateCacheSize(g){const A=Math.ceil(g.width/this._source.tileSize)+1,q=Math.ceil(g.height/this._source.tileSize)+1,nt=Math.floor(A*q*5),Ft=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,nt):nt;this._cache.setMaxSize(Ft)}handleWrapJump(g){const A=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,A){const q={};for(const nt in this._tiles){const Ft=this._tiles[nt];Ft.tileID=Ft.tileID.unwrapTo(Ft.tileID.wrap+A),q[Ft.tileID.key]=Ft}this._tiles=q;for(const nt in this._timers)clearTimeout(this._timers[nt]),delete this._timers[nt];for(const nt in this._tiles)this._setTileReloadTimer(nt,this._tiles[nt])}}update(g,A){if(this.transform=g,this.terrain=A,!this._sourceLoaded||this._paused)return;let q;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?q=g.getVisibleUnwrappedCoordinates(this._source.tileID).map(ol=>new o.OverscaledTileID(ol.canonical.z,ol.wrap,ol.canonical.z,ol.canonical.x,ol.canonical.y)):(q=g.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:A}),this._source.hasTile&&(q=q.filter(ol=>this._source.hasTile(ol)))):q=[];const nt=g.coveringZoomLevel(this._source),Ft=Math.max(nt-Ld.maxOverzooming,this._source.minzoom),Xr=Math.max(nt+Ld.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const ol={};for(const rh of q)if(rh.canonical.z>this._source.minzoom){const th=rh.scaledTo(rh.canonical.z-1);ol[th.key]=th;const ph=rh.scaledTo(Math.max(this._source.minzoom,Math.min(rh.canonical.z,5)));ol[ph.key]=ph}q=q.concat(Object.values(ol))}const ls=this._updateRetainedTiles(q,nt);if(If(this._source.type)){const ol={},rh={},th=Object.keys(ls);for(const ph of th){const Dh=ls[ph],$h=this._tiles[ph];if(!$h||$h.fadeEndTime&&$h.fadeEndTime<=o.exported.now())continue;const Mh=this.findLoadedParent(Dh,Ft);Mh&&(this._addTile(Mh.tileID),ol[Mh.tileID.key]=Mh.tileID),rh[ph]=Dh}this._retainLoadedChildren(rh,nt,Xr,ls);for(const ph in ol)ls[ph]||(this._coveredTiles[ph]=!0,ls[ph]=ol[ph]);if(A){const ph={},Dh={};for(const $h of q)this._tiles[$h.key].hasData()?ph[$h.key]=$h:Dh[$h.key]=$h;for(const $h in Dh){const Mh=Dh[$h].children(this._source.maxzoom);this._tiles[Mh[0].key]&&this._tiles[Mh[1].key]&&this._tiles[Mh[2].key]&&this._tiles[Mh[3].key]&&(ph[Mh[0].key]=ls[Mh[0].key]=Mh[0],ph[Mh[1].key]=ls[Mh[1].key]=Mh[1],ph[Mh[2].key]=ls[Mh[2].key]=Mh[2],ph[Mh[3].key]=ls[Mh[3].key]=Mh[3],delete Dh[$h])}for(const $h in Dh){const Mh=this.findLoadedParent(Dh[$h],this._source.minzoom);if(Mh){ph[Mh.tileID.key]=ls[Mh.tileID.key]=Mh.tileID;for(const Kh in ph)ph[Kh].isChildOf(Mh.tileID)&&delete ph[Kh]}}for(const $h in this._tiles)ph[$h]||(this._coveredTiles[$h]=!0)}}for(const ol in ls)this._tiles[ol].clearFadeHold();const Zs=o.keysDifference(this._tiles,ls);for(const ol of Zs){const rh=this._tiles[ol];rh.hasSymbolBuckets&&!rh.holdingForFade()?rh.setHoldDuration(this.map._fadeDuration):rh.hasSymbolBuckets&&!rh.symbolFadeFinished()||this._removeTile(ol)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)}_updateRetainedTiles(g,A){const q={},nt={},Ft=Math.max(A-Ld.maxOverzooming,this._source.minzoom),Xr=Math.max(A+Ld.maxUnderzooming,this._source.minzoom),ls={};for(const Zs of g){const ol=this._addTile(Zs);q[Zs.key]=Zs,ol.hasData()||A<this._source.maxzoom&&(ls[Zs.key]=Zs)}this._retainLoadedChildren(ls,A,Xr,q);for(const Zs of g){let ol=this._tiles[Zs.key];if(ol.hasData())continue;if(A+1>this._source.maxzoom){const th=Zs.children(this._source.maxzoom)[0],ph=this.getTile(th);if(ph&&ph.hasData()){q[th.key]=th;continue}}else{const th=Zs.children(this._source.maxzoom);if(q[th[0].key]&&q[th[1].key]&&q[th[2].key]&&q[th[3].key])continue}let rh=ol.wasRequested();for(let th=Zs.overscaledZ-1;th>=Ft;--th){const ph=Zs.scaledTo(th);if(nt[ph.key]||(nt[ph.key]=!0,ol=this.getTile(ph),!ol&&rh&&(ol=this._addTile(ph)),ol&&(q[ph.key]=ph,rh=ol.wasRequested(),ol.hasData())))break}}return q}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const g in this._tiles){const A=[];let q,nt=this._tiles[g].tileID;for(;nt.overscaledZ>0;){if(nt.key in this._loadedParentTiles){q=this._loadedParentTiles[nt.key];break}A.push(nt.key);const Ft=nt.scaledTo(nt.overscaledZ-1);if(q=this._getLoadedTile(Ft),q)break;nt=Ft}for(const Ft of A)this._loadedParentTiles[Ft]=q}}_addTile(g){let A=this._tiles[g.key];if(A)return A;A=this._cache.getAndRemove(g),A&&(this._setTileReloadTimer(g.key,A),A.tileID=g,this._state.initializeTileState(A,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,A)));const q=A;return A||(A=new sd(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(A,this._tileLoaded.bind(this,A,g.key,A.state))),A.uses++,this._tiles[g.key]=A,q||this._source.fire(new o.Event("dataloading",{tile:A,coord:A.tileID,dataType:"source"})),A}_setTileReloadTimer(g,A){g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);const q=A.getExpiryTimeout();q&&(this._timers[g]=setTimeout(()=>{this._reloadTile(g,"expired"),delete this._timers[g]},q))}_removeTile(g){const A=this._tiles[g];A&&(A.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),A.uses>0||(A.hasData()&&A.state!=="reloading"?this._cache.add(A.tileID,A,A.getExpiryTimeout()):(A.aborted=!0,this._abortTile(A),this._unloadTile(A))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const g in this._tiles)this._removeTile(g);this._cache.reset()}tilesIn(g,A,q){const nt=[],Ft=this.transform;if(!Ft)return nt;const Xr=q?Ft.getCameraQueryGeometry(g):g,ls=g.map($h=>Ft.pointCoordinate($h,this.terrain)),Zs=Xr.map($h=>Ft.pointCoordinate($h,this.terrain)),ol=this.getIds();let rh=1/0,th=1/0,ph=-1/0,Dh=-1/0;for(const $h of Zs)rh=Math.min(rh,$h.x),th=Math.min(th,$h.y),ph=Math.max(ph,$h.x),Dh=Math.max(Dh,$h.y);for(let $h=0;$h<ol.length;$h++){const Mh=this._tiles[ol[$h]];if(Mh.holdingForFade())continue;const Kh=Mh.tileID,fd=Math.pow(2,Ft.zoom-Mh.tileID.overscaledZ),cd=A*Mh.queryPadding*o.EXTENT/Mh.tileSize/fd,jh=[Kh.getTilePoint(new o.MercatorCoordinate(rh,th)),Kh.getTilePoint(new o.MercatorCoordinate(ph,Dh))];if(jh[0].x-cd<o.EXTENT&&jh[0].y-cd<o.EXTENT&&jh[1].x+cd>=0&&jh[1].y+cd>=0){const Td=ls.map(Wd=>Kh.getTilePoint(Wd)),Vd=Zs.map(Wd=>Kh.getTilePoint(Wd));nt.push({tile:Mh,tileID:Kh,queryGeometry:Td,cameraQueryGeometry:Vd,scale:fd})}}return nt}getVisibleCoordinates(g){const A=this.getRenderableIds(g).map(q=>this._tiles[q].tileID);for(const q of A)q.posMatrix=this.transform.calculatePosMatrix(q.toUnwrapped());return A}hasTransition(){if(this._source.hasTransition())return!0;if(If(this._source.type))for(const g in this._tiles){const A=this._tiles[g];if(A.fadeEndTime!==void 0&&A.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(g,A,q){this._state.updateState(g=g||"_geojsonTileLayer",A,q)}removeFeatureState(g,A,q){this._state.removeFeatureState(g=g||"_geojsonTileLayer",A,q)}getFeatureState(g,A){return this._state.getState(g=g||"_geojsonTileLayer",A)}setDependencies(g,A,q){const nt=this._tiles[g];nt&&nt.setDependencies(A,q)}reloadTilesForDependencies(g,A){for(const q in this._tiles)this._tiles[q].hasDependency(g,A)&&this._reloadTile(q,"reloading");this._cache.filter(q=>!q.hasDependency(g,A))}}function Kf(he,g){const A=Math.abs(2*he.wrap)-+(he.wrap<0),q=Math.abs(2*g.wrap)-+(g.wrap<0);return he.overscaledZ-g.overscaledZ||q-A||g.canonical.y-he.canonical.y||g.canonical.x-he.canonical.x}function If(he){return he==="raster"||he==="image"||he==="video"}Ld.maxOverzooming=10,Ld.maxUnderzooming=3;const Df="mapboxgl_preloaded_worker_pool";class Jf{constructor(){this.active={}}acquire(g){if(!this.workers)for(this.workers=[];this.workers.length<Jf.workerCount;)this.workers.push(new Worker(K_.workerUrl));return this.active[g]=!0,this.workers.slice()}release(g){delete this.active[g],this.numActive()===0&&(this.workers.forEach(A=>{A.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Df]}numActive(){return Object.keys(this.active).length}}const Nf=Math.floor(o.exported.hardwareConcurrency/2);let Wf;function Mp(){return Wf||(Wf=new Jf),Wf}function Sp(he,g){const A={};for(const q in he)q!=="ref"&&(A[q]=he[q]);return o.refProperties.forEach(q=>{q in g&&(A[q]=g[q])}),A}function Pp(he){he=he.slice();const g=Object.create(null);for(let A=0;A<he.length;A++)g[he[A].id]=he[A];for(let A=0;A<he.length;A++)"ref"in he[A]&&(he[A]=Sp(he[A],g[he[A].ref]));return he}Jf.workerCount=Math.max(Math.min(Nf,6),1);const Yf={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function qp(he,g,A){A.push({command:Yf.addSource,args:[he,g[he]]})}function sm(he,g,A){g.push({command:Yf.removeSource,args:[he]}),A[he]=!0}function Xd(he,g,A,q){sm(he,A,q),qp(he,g,A)}function Op(he,g,A){let q;for(q in he[A])if(Object.prototype.hasOwnProperty.call(he[A],q)&&q!=="data"&&!ze(he[A][q],g[A][q]))return!1;for(q in g[A])if(Object.prototype.hasOwnProperty.call(g[A],q)&&q!=="data"&&!ze(he[A][q],g[A][q]))return!1;return!0}function rm(he,g,A,q,nt,Ft){let Xr;for(Xr in g=g||{},he=he||{})Object.prototype.hasOwnProperty.call(he,Xr)&&(ze(he[Xr],g[Xr])||A.push({command:Ft,args:[q,Xr,g[Xr],nt]}));for(Xr in g)Object.prototype.hasOwnProperty.call(g,Xr)&&!Object.prototype.hasOwnProperty.call(he,Xr)&&(ze(he[Xr],g[Xr])||A.push({command:Ft,args:[q,Xr,g[Xr],nt]}))}function Sm(he){return he.id}function hp(he,g){return he[g.id]=g,he}class Em{constructor(g,A){this.reset(g,A)}reset(g,A){this.points=g||[],this._distances=[0];for(let q=1;q<this.points.length;q++)this._distances[q]=this._distances[q-1]+this.points[q].dist(this.points[q-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(A||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(g){if(this.points.length===1)return this.points[0];g=o.clamp(g,0,1);let A=1,q=this._distances[A];const nt=g*this.paddedLength+this.padding;for(;q<nt&&A<this._distances.length;)q=this._distances[++A];const Ft=A-1,Xr=this._distances[Ft],ls=q-Xr,Zs=ls>0?(nt-Xr)/ls:0;return this.points[Ft].mult(1-Zs).add(this.points[A].mult(Zs))}}function Qp(he,g){let A=!0;return he==="always"||he!=="never"&&g!=="never"||(A=!1),A}class lm{constructor(g,A,q){const nt=this.boxCells=[],Ft=this.circleCells=[];this.xCellCount=Math.ceil(g/q),this.yCellCount=Math.ceil(A/q);for(let Xr=0;Xr<this.xCellCount*this.yCellCount;Xr++)nt.push([]),Ft.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=g,this.height=A,this.xScale=this.xCellCount/g,this.yScale=this.yCellCount/A,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(g,A,q,nt,Ft){this._forEachCell(A,q,nt,Ft,this._insertBoxCell,this.boxUid++),this.boxKeys.push(g),this.bboxes.push(A),this.bboxes.push(q),this.bboxes.push(nt),this.bboxes.push(Ft)}insertCircle(g,A,q,nt){this._forEachCell(A-nt,q-nt,A+nt,q+nt,this._insertCircleCell,this.circleUid++),this.circleKeys.push(g),this.circles.push(A),this.circles.push(q),this.circles.push(nt)}_insertBoxCell(g,A,q,nt,Ft,Xr){this.boxCells[Ft].push(Xr)}_insertCircleCell(g,A,q,nt,Ft,Xr){this.circleCells[Ft].push(Xr)}_query(g,A,q,nt,Ft,Xr,ls){if(q<0||g>this.width||nt<0||A>this.height)return[];const Zs=[];if(g<=0&&A<=0&&this.width<=q&&this.height<=nt){if(Ft)return[{key:null,x1:g,y1:A,x2:q,y2:nt}];for(let ol=0;ol<this.boxKeys.length;ol++)Zs.push({key:this.boxKeys[ol],x1:this.bboxes[4*ol],y1:this.bboxes[4*ol+1],x2:this.bboxes[4*ol+2],y2:this.bboxes[4*ol+3]});for(let ol=0;ol<this.circleKeys.length;ol++){const rh=this.circles[3*ol],th=this.circles[3*ol+1],ph=this.circles[3*ol+2];Zs.push({key:this.circleKeys[ol],x1:rh-ph,y1:th-ph,x2:rh+ph,y2:th+ph})}}else this._forEachCell(g,A,q,nt,this._queryCell,Zs,{hitTest:Ft,overlapMode:Xr,seenUids:{box:{},circle:{}}},ls);return Zs}query(g,A,q,nt){return this._query(g,A,q,nt,!1,null)}hitTest(g,A,q,nt,Ft,Xr){return this._query(g,A,q,nt,!0,Ft,Xr).length>0}hitTestCircle(g,A,q,nt,Ft){const Xr=g-q,ls=g+q,Zs=A-q,ol=A+q;if(ls<0||Xr>this.width||ol<0||Zs>this.height)return!1;const rh=[];return this._forEachCell(Xr,Zs,ls,ol,this._queryCellCircle,rh,{hitTest:!0,overlapMode:nt,circle:{x:g,y:A,radius:q},seenUids:{box:{},circle:{}}},Ft),rh.length>0}_queryCell(g,A,q,nt,Ft,Xr,ls,Zs){const{seenUids:ol,hitTest:rh,overlapMode:th}=ls,ph=this.boxCells[Ft];if(ph!==null){const $h=this.bboxes;for(const Mh of ph)if(!ol.box[Mh]){ol.box[Mh]=!0;const Kh=4*Mh,fd=this.boxKeys[Mh];if(g<=$h[Kh+2]&&A<=$h[Kh+3]&&q>=$h[Kh+0]&&nt>=$h[Kh+1]&&(!Zs||Zs(fd))&&(!rh||!Qp(th,fd.overlapMode))&&(Xr.push({key:fd,x1:$h[Kh],y1:$h[Kh+1],x2:$h[Kh+2],y2:$h[Kh+3]}),rh))return!0}}const Dh=this.circleCells[Ft];if(Dh!==null){const $h=this.circles;for(const Mh of Dh)if(!ol.circle[Mh]){ol.circle[Mh]=!0;const Kh=3*Mh,fd=this.circleKeys[Mh];if(this._circleAndRectCollide($h[Kh],$h[Kh+1],$h[Kh+2],g,A,q,nt)&&(!Zs||Zs(fd))&&(!rh||!Qp(th,fd.overlapMode))){const cd=$h[Kh],jh=$h[Kh+1],Td=$h[Kh+2];if(Xr.push({key:fd,x1:cd-Td,y1:jh-Td,x2:cd+Td,y2:jh+Td}),rh)return!0}}}return!1}_queryCellCircle(g,A,q,nt,Ft,Xr,ls,Zs){const{circle:ol,seenUids:rh,overlapMode:th}=ls,ph=this.boxCells[Ft];if(ph!==null){const $h=this.bboxes;for(const Mh of ph)if(!rh.box[Mh]){rh.box[Mh]=!0;const Kh=4*Mh,fd=this.boxKeys[Mh];if(this._circleAndRectCollide(ol.x,ol.y,ol.radius,$h[Kh+0],$h[Kh+1],$h[Kh+2],$h[Kh+3])&&(!Zs||Zs(fd))&&!Qp(th,fd.overlapMode))return Xr.push(!0),!0}}const Dh=this.circleCells[Ft];if(Dh!==null){const $h=this.circles;for(const Mh of Dh)if(!rh.circle[Mh]){rh.circle[Mh]=!0;const Kh=3*Mh,fd=this.circleKeys[Mh];if(this._circlesCollide($h[Kh],$h[Kh+1],$h[Kh+2],ol.x,ol.y,ol.radius)&&(!Zs||Zs(fd))&&!Qp(th,fd.overlapMode))return Xr.push(!0),!0}}}_forEachCell(g,A,q,nt,Ft,Xr,ls,Zs){const ol=this._convertToXCellCoord(g),rh=this._convertToYCellCoord(A),th=this._convertToXCellCoord(q),ph=this._convertToYCellCoord(nt);for(let Dh=ol;Dh<=th;Dh++)for(let $h=rh;$h<=ph;$h++)if(Ft.call(this,g,A,q,nt,this.xCellCount*$h+Dh,Xr,ls,Zs))return}_convertToXCellCoord(g){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(g*this.xScale)))}_convertToYCellCoord(g){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(g*this.yScale)))}_circlesCollide(g,A,q,nt,Ft,Xr){const ls=nt-g,Zs=Ft-A,ol=q+Xr;return ol*ol>ls*ls+Zs*Zs}_circleAndRectCollide(g,A,q,nt,Ft,Xr,ls){const Zs=(Xr-nt)/2,ol=Math.abs(g-(nt+Zs));if(ol>Zs+q)return!1;const rh=(ls-Ft)/2,th=Math.abs(A-(Ft+rh));if(th>rh+q)return!1;if(ol<=Zs||th<=rh)return!0;const ph=ol-Zs,Dh=th-rh;return ph*ph+Dh*Dh<=q*q}}function Dd(he,g,A,q,nt){const Ft=o.create();return g?(o.scale(Ft,Ft,[1/nt,1/nt,1]),A||o.rotateZ(Ft,Ft,q.angle)):o.multiply(Ft,q.labelPlaneMatrix,he),Ft}function Hf(he,g,A,q,nt){if(g){const Ft=o.clone(he);return o.scale(Ft,Ft,[nt,nt,1]),A||o.rotateZ(Ft,Ft,-q.angle),Ft}return q.glCoordMatrix}function mh(he,g,A){let q;A?(q=[he.x,he.y,A(he.x,he.y),1],o.transformMat4(q,q,g)):(q=[he.x,he.y,0,1],dh(q,q,g));const nt=q[3];return{point:new o.pointGeometry(q[0]/nt,q[1]/nt),signedDistanceFromCamera:nt}}function Jh(he,g){return .5+he/g*.5}function Wu(he,g){const A=he[0]/he[3],q=he[1]/he[3];return A>=-g[0]&&A<=g[0]&&q>=-g[1]&&q<=g[1]}function sl(he,g,A,q,nt,Ft,Xr,ls,Zs,ol){const rh=q?he.textSizeData:he.iconSizeData,th=o.evaluateSizeForZoom(rh,A.transform.zoom),ph=[256/A.width*2+1,256/A.height*2+1],Dh=q?he.text.dynamicLayoutVertexArray:he.icon.dynamicLayoutVertexArray;Dh.clear();const $h=he.lineVertexArray,Mh=q?he.text.placedSymbolArray:he.icon.placedSymbolArray,Kh=A.transform.width/A.transform.height;let fd=!1;for(let cd=0;cd<Mh.length;cd++){const jh=Mh.get(cd);if(jh.hidden||jh.writingMode===o.WritingMode.vertical&&!fd){uh(jh.numGlyphs,Dh);continue}let Td;if(fd=!1,ol?(Td=[jh.anchorX,jh.anchorY,ol(jh.anchorX,jh.anchorY),1],o.transformMat4(Td,Td,g)):(Td=[jh.anchorX,jh.anchorY,0,1],dh(Td,Td,g)),!Wu(Td,ph)){uh(jh.numGlyphs,Dh);continue}const Vd=Jh(A.transform.cameraToCenterDistance,Td[3]),Wd=o.evaluateSizeForFeature(rh,th,jh),Mf=Xr?Wd/Vd:Wd*Vd,Of=new o.pointGeometry(jh.anchorX,jh.anchorY),L=mh(Of,nt,ol).point,u={},E=cs(jh,Mf,!1,ls,g,nt,Ft,he.glyphOffsetArray,$h,Dh,L,Of,u,Kh,Zs,ol);fd=E.useVertical,(E.notEnoughRoom||fd||E.needsFlipping&&cs(jh,Mf,!0,ls,g,nt,Ft,he.glyphOffsetArray,$h,Dh,L,Of,u,Kh,Zs,ol).notEnoughRoom)&&uh(jh.numGlyphs,Dh)}q?he.text.dynamicLayoutVertexBuffer.updateData(Dh):he.icon.dynamicLayoutVertexBuffer.updateData(Dh)}function Gn(he,g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th,ph){const Dh=ls.glyphStartIndex+ls.numGlyphs,$h=ls.lineStartIndex,Mh=ls.lineStartIndex+ls.lineLength,Kh=g.getoffsetX(ls.glyphStartIndex),fd=g.getoffsetX(Dh-1),cd=eh(he*Kh,A,q,nt,Ft,Xr,ls.segment,$h,Mh,Zs,ol,rh,th,ph);if(!cd)return null;const jh=eh(he*fd,A,q,nt,Ft,Xr,ls.segment,$h,Mh,Zs,ol,rh,th,ph);return jh?{first:cd,last:jh}:null}function _n(he,g,A,q){return he===o.WritingMode.horizontal&&Math.abs(A.y-g.y)>Math.abs(A.x-g.x)*q?{useVertical:!0}:(he===o.WritingMode.vertical?g.y<A.y:g.x>A.x)?{needsFlipping:!0}:null}function cs(he,g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th,ph,Dh,$h,Mh){const Kh=g/24,fd=he.lineOffsetX*Kh,cd=he.lineOffsetY*Kh;let jh;if(he.numGlyphs>1){const Td=he.glyphStartIndex+he.numGlyphs,Vd=he.lineStartIndex,Wd=he.lineStartIndex+he.lineLength,Mf=Gn(Kh,ls,fd,cd,A,rh,th,he,Zs,Ft,ph,$h,Mh);if(!Mf)return{notEnoughRoom:!0};const Of=mh(Mf.first.point,Xr,Mh).point,L=mh(Mf.last.point,Xr,Mh).point;if(q&&!A){const u=_n(he.writingMode,Of,L,Dh);if(u)return u}jh=[Mf.first];for(let u=he.glyphStartIndex+1;u<Td-1;u++)jh.push(eh(Kh*ls.getoffsetX(u),fd,cd,A,rh,th,he.segment,Vd,Wd,Zs,Ft,ph,$h,Mh));jh.push(Mf.last)}else{if(q&&!A){const Vd=mh(th,nt,Mh).point,Wd=he.lineStartIndex+he.segment+1,Mf=new o.pointGeometry(Zs.getx(Wd),Zs.gety(Wd)),Of=mh(Mf,nt,Mh),L=Of.signedDistanceFromCamera>0?Of.point:$u(th,Mf,Vd,1,nt,Mh),u=_n(he.writingMode,Vd,L,Dh);if(u)return u}const Td=eh(Kh*ls.getoffsetX(he.glyphStartIndex),fd,cd,A,rh,th,he.segment,he.lineStartIndex,he.lineStartIndex+he.lineLength,Zs,Ft,ph,$h,Mh);if(!Td)return{notEnoughRoom:!0};jh=[Td]}for(const Td of jh)o.addDynamicAttributes(ol,Td.point,Td.angle);return{}}function $u(he,g,A,q,nt,Ft){const Xr=mh(he.add(he.sub(g)._unit()),nt,Ft).point,ls=A.sub(Xr);return A.add(ls._mult(q/ls.mag()))}function eh(he,g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th,ph,Dh){const $h=q?he-g:he+g;let Mh=$h>0?1:-1,Kh=0;q&&(Mh*=-1,Kh=Math.PI),Mh<0&&(Kh+=Math.PI);let fd=Mh>0?ls+Xr:ls+Xr+1,cd=nt,jh=nt,Td=0,Vd=0;const Wd=Math.abs($h),Mf=[];for(;Td+Vd<=Wd;){if(fd+=Mh,fd<ls||fd>=Zs)return null;if(jh=cd,Mf.push(cd),cd=th[fd],cd===void 0){const B=new o.pointGeometry(ol.getx(fd),ol.gety(fd)),_e=mh(B,rh,Dh);if(_e.signedDistanceFromCamera>0)cd=th[fd]=_e.point;else{const St=fd-Mh;cd=$u(Td===0?Ft:new o.pointGeometry(ol.getx(St),ol.gety(St)),B,jh,Wd-Td+1,rh,Dh)}}Td+=Vd,Vd=jh.dist(cd)}const Of=(Wd-Td)/Vd,L=cd.sub(jh),u=L.mult(Of)._add(jh);u._add(L._unit()._perp()._mult(A*Mh));const E=Kh+Math.atan2(cd.y-jh.y,cd.x-jh.x);return Mf.push(u),{point:u,angle:ph?E:0,path:Mf}}const nh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function uh(he,g){for(let A=0;A<he;A++){const q=g.length;g.resize(q+4),g.float32.set(nh,3*q)}}function dh(he,g,A){const q=g[0],nt=g[1];return he[0]=A[0]*q+A[4]*nt+A[12],he[1]=A[1]*q+A[5]*nt+A[13],he[3]=A[3]*q+A[7]*nt+A[15],he}const vh=100;class Ph{constructor(g,A=new lm(g.width+200,g.height+200,25),q=new lm(g.width+200,g.height+200,25)){this.transform=g,this.grid=A,this.ignoredGrid=q,this.pitchfactor=Math.cos(g._pitch)*g.cameraToCenterDistance,this.screenRightBoundary=g.width+vh,this.screenBottomBoundary=g.height+vh,this.gridRightBoundary=g.width+200,this.gridBottomBoundary=g.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(g,A,q,nt,Ft,Xr){const ls=this.projectAndGetPerspectiveRatio(nt,g.anchorPointX,g.anchorPointY,Xr),Zs=q*ls.perspectiveRatio,ol=g.x1*Zs+ls.point.x,rh=g.y1*Zs+ls.point.y,th=g.x2*Zs+ls.point.x,ph=g.y2*Zs+ls.point.y;return!this.isInsideGrid(ol,rh,th,ph)||A!=="always"&&this.grid.hitTest(ol,rh,th,ph,A,Ft)||ls.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[ol,rh,th,ph],offscreen:this.isOffscreen(ol,rh,th,ph)}}placeCollisionCircles(g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th,ph,Dh,$h){const Mh=[],Kh=new o.pointGeometry(A.anchorX,A.anchorY),fd=mh(Kh,Xr,$h),cd=Jh(this.transform.cameraToCenterDistance,fd.signedDistanceFromCamera),jh=(rh?Ft/cd:Ft*cd)/o.ONE_EM,Td=mh(Kh,ls,$h).point,Vd=Gn(jh,nt,A.lineOffsetX*jh,A.lineOffsetY*jh,!1,Td,Kh,A,q,ls,{},!1,$h);let Wd=!1,Mf=!1,Of=!0;if(Vd){const L=.5*ph*cd+Dh,u=new o.pointGeometry(-100,-100),E=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),B=new Em,_e=Vd.first,St=Vd.last;let mr=[];for(let tl=_e.path.length-1;tl>=1;tl--)mr.push(_e.path[tl]);for(let tl=1;tl<St.path.length;tl++)mr.push(St.path[tl]);const qr=2.5*L;if(Zs){const tl=mr.map(il=>mh(il,Zs,$h));mr=tl.some(il=>il.signedDistanceFromCamera<=0)?[]:tl.map(il=>il.point)}let ss=[];if(mr.length>0){const tl=mr[0].clone(),il=mr[0].clone();for(let Qu=1;Qu<mr.length;Qu++)tl.x=Math.min(tl.x,mr[Qu].x),tl.y=Math.min(tl.y,mr[Qu].y),il.x=Math.max(il.x,mr[Qu].x),il.y=Math.max(il.y,mr[Qu].y);ss=tl.x>=u.x&&il.x<=E.x&&tl.y>=u.y&&il.y<=E.y?[mr]:il.x<u.x||tl.x>E.x||il.y<u.y||tl.y>E.y?[]:o.clipLine([mr],u.x,u.y,E.x,E.y)}for(const tl of ss){B.reset(tl,.25*L);let il=0;il=B.length<=.5*L?1:Math.ceil(B.paddedLength/qr)+1;for(let Qu=0;Qu<il;Qu++){const fh=Qu/Math.max(il-1,1),wh=B.lerp(fh),Sh=wh.x+vh,Th=wh.y+vh;Mh.push(Sh,Th,L,0);const Ch=Sh-L,hh=Th-L,Oh=Sh+L,Rh=Th+L;if(Of=Of&&this.isOffscreen(Ch,hh,Oh,Rh),Mf=Mf||this.isInsideGrid(Ch,hh,Oh,Rh),g!=="always"&&this.grid.hitTestCircle(Sh,Th,L,g,th)&&(Wd=!0,!ol))return{circles:[],offscreen:!1,collisionDetected:Wd}}}}return{circles:!ol&&Wd||!Mf||cd<this.perspectiveRatioCutoff?[]:Mh,offscreen:Of,collisionDetected:Wd}}queryRenderedSymbols(g){if(g.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const A=[];let q=1/0,nt=1/0,Ft=-1/0,Xr=-1/0;for(const rh of g){const th=new o.pointGeometry(rh.x+vh,rh.y+vh);q=Math.min(q,th.x),nt=Math.min(nt,th.y),Ft=Math.max(Ft,th.x),Xr=Math.max(Xr,th.y),A.push(th)}const ls=this.grid.query(q,nt,Ft,Xr).concat(this.ignoredGrid.query(q,nt,Ft,Xr)),Zs={},ol={};for(const rh of ls){const th=rh.key;if(Zs[th.bucketInstanceId]===void 0&&(Zs[th.bucketInstanceId]={}),Zs[th.bucketInstanceId][th.featureIndex])continue;const ph=[new o.pointGeometry(rh.x1,rh.y1),new o.pointGeometry(rh.x2,rh.y1),new o.pointGeometry(rh.x2,rh.y2),new o.pointGeometry(rh.x1,rh.y2)];o.polygonIntersectsPolygon(A,ph)&&(Zs[th.bucketInstanceId][th.featureIndex]=!0,ol[th.bucketInstanceId]===void 0&&(ol[th.bucketInstanceId]=[]),ol[th.bucketInstanceId].push(th.featureIndex))}return ol}insertCollisionBox(g,A,q,nt,Ft,Xr){(q?this.ignoredGrid:this.grid).insert({bucketInstanceId:nt,featureIndex:Ft,collisionGroupID:Xr,overlapMode:A},g[0],g[1],g[2],g[3])}insertCollisionCircles(g,A,q,nt,Ft,Xr){const ls=q?this.ignoredGrid:this.grid,Zs={bucketInstanceId:nt,featureIndex:Ft,collisionGroupID:Xr,overlapMode:A};for(let ol=0;ol<g.length;ol+=4)ls.insertCircle(Zs,g[ol],g[ol+1],g[ol+2])}projectAndGetPerspectiveRatio(g,A,q,nt){let Ft;return nt?(Ft=[A,q,nt(A,q),1],o.transformMat4(Ft,Ft,g)):(Ft=[A,q,0,1],dh(Ft,Ft,g)),{point:new o.pointGeometry((Ft[0]/Ft[3]+1)/2*this.transform.width+vh,(-Ft[1]/Ft[3]+1)/2*this.transform.height+vh),perspectiveRatio:.5+this.transform.cameraToCenterDistance/Ft[3]*.5}}isOffscreen(g,A,q,nt){return q<vh||g>=this.screenRightBoundary||nt<vh||A>this.screenBottomBoundary}isInsideGrid(g,A,q,nt){return q>=0&&g<this.gridRightBoundary&&nt>=0&&A<this.gridBottomBoundary}getViewportMatrix(){const g=o.identity([]);return o.translate(g,g,[-100,-100,0]),g}}function zh(he,g,A){return g*(o.EXTENT/(he.tileSize*Math.pow(2,A-he.tileID.overscaledZ)))}class Ad{constructor(g,A,q,nt){this.opacity=g?Math.max(0,Math.min(1,g.opacity+(g.placed?A:-A))):nt&&q?1:0,this.placed=q}isHidden(){return this.opacity===0&&!this.placed}}class wd{constructor(g,A,q,nt,Ft){this.text=new Ad(g?g.text:null,A,q,Ft),this.icon=new Ad(g?g.icon:null,A,nt,Ft)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qd{constructor(g,A,q){this.text=g,this.icon=A,this.skipFade=q}}class xf{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class zf{constructor(g,A,q,nt,Ft){this.bucketInstanceId=g,this.featureIndex=A,this.sourceLayerIndex=q,this.bucketIndex=nt,this.tileID=Ft}}class np{constructor(g){this.crossSourceCollisions=g,this.maxGroupID=0,this.collisionGroups={}}get(g){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[g]){const A=++this.maxGroupID;this.collisionGroups[g]={ID:A,predicate:q=>q.collisionGroupID===A}}return this.collisionGroups[g]}}function Ah(he,g,A,q,nt){const{horizontalAlign:Ft,verticalAlign:Xr}=o.getAnchorAlignment(he),ls=-(Ft-.5)*g,Zs=-(Xr-.5)*A,ol=o.evaluateVariableOffset(he,q);return new o.pointGeometry(ls+ol[0]*nt,Zs+ol[1]*nt)}function mf(he,g,A,q,nt,Ft){const{x1:Xr,x2:ls,y1:Zs,y2:ol,anchorPointX:rh,anchorPointY:th}=he,ph=new o.pointGeometry(g,A);return q&&ph._rotate(nt?Ft:-Ft),{x1:Xr+ph.x,y1:Zs+ph.y,x2:ls+ph.x,y2:ol+ph.y,anchorPointX:rh,anchorPointY:th}}class Od{constructor(g,A,q,nt,Ft){this.transform=g.clone(),this.terrain=A,this.collisionIndex=new Ph(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=q,this.retainedQueryData={},this.collisionGroups=new np(nt),this.collisionCircleArrays={},this.prevPlacement=Ft,Ft&&(Ft.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(g,A,q,nt){const Ft=q.getBucket(A),Xr=q.latestFeatureIndex;if(!Ft||!Xr||A.id!==Ft.layerIds[0])return;const ls=q.collisionBoxArray,Zs=Ft.layers[0].layout,ol=Math.pow(2,this.transform.zoom-q.tileID.overscaledZ),rh=q.tileSize/o.EXTENT,th=this.transform.calculatePosMatrix(q.tileID.toUnwrapped()),ph=Zs.get("text-pitch-alignment")==="map",Dh=Zs.get("text-rotation-alignment")==="map",$h=zh(q,1,this.transform.zoom),Mh=Dd(th,ph,Dh,this.transform,$h);let Kh=null;if(ph){const cd=Hf(th,ph,Dh,this.transform,$h);Kh=o.multiply([],this.transform.labelPlaneMatrix,cd)}this.retainedQueryData[Ft.bucketInstanceId]=new zf(Ft.bucketInstanceId,Xr,Ft.sourceLayerIndex,Ft.index,q.tileID);const fd={bucket:Ft,layout:Zs,posMatrix:th,textLabelPlaneMatrix:Mh,labelToScreenMatrix:Kh,scale:ol,textPixelRatio:rh,holdingForFade:q.holdingForFade(),collisionBoxArray:ls,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(Ft.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(Ft.sourceID)};if(nt)for(const cd of Ft.sortKeyRanges){const{sortKey:jh,symbolInstanceStart:Td,symbolInstanceEnd:Vd}=cd;g.push({sortKey:jh,symbolInstanceStart:Td,symbolInstanceEnd:Vd,parameters:fd})}else g.push({symbolInstanceStart:0,symbolInstanceEnd:Ft.symbolInstances.length,parameters:fd})}attemptAnchorPlacement(g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th,ph,Dh,$h,Mh,Kh){const fd=[ph.textOffset0,ph.textOffset1],cd=Ah(g,q,nt,fd,Ft),jh=this.collisionIndex.placeCollisionBox(mf(A,cd.x,cd.y,Xr,ls,this.transform.angle),th,Zs,ol,rh.predicate,Kh);if((!Mh||this.collisionIndex.placeCollisionBox(mf(Mh,cd.x,cd.y,Xr,ls,this.transform.angle),th,Zs,ol,rh.predicate,Kh).box.length!==0)&&jh.box.length>0){let Td;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID].text&&(Td=this.prevPlacement.variableOffsets[ph.crossTileID].anchor),ph.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ph.crossTileID]={textOffset:fd,width:q,height:nt,anchor:g,textBoxScale:Ft,prevAnchor:Td},this.markUsedJustification(Dh,g,ph,$h),Dh.allowVerticalPlacement&&(this.markUsedOrientation(Dh,$h,ph),this.placedOrientations[ph.crossTileID]=$h),{shift:cd,placedGlyphBoxes:jh}}}placeLayerBucketPart(g,A,q){const{bucket:nt,layout:Ft,posMatrix:Xr,textLabelPlaneMatrix:ls,labelToScreenMatrix:Zs,textPixelRatio:ol,holdingForFade:rh,collisionBoxArray:th,partiallyEvaluatedTextSize:ph,collisionGroup:Dh}=g.parameters,$h=Ft.get("text-optional"),Mh=Ft.get("icon-optional"),Kh=o.getOverlapMode(Ft,"text-overlap","text-allow-overlap"),fd=Kh==="always",cd=o.getOverlapMode(Ft,"icon-overlap","icon-allow-overlap"),jh=cd==="always",Td=Ft.get("text-rotation-alignment")==="map",Vd=Ft.get("text-pitch-alignment")==="map",Wd=Ft.get("icon-text-fit")!=="none",Mf=Ft.get("symbol-z-order")==="viewport-y",Of=fd&&(jh||!nt.hasIconData()||Mh),L=jh&&(fd||!nt.hasTextData()||$h);!nt.collisionArrays&&th&&nt.deserializeCollisionBoxes(th);const u=(E,B)=>{if(A[E.crossTileID])return;if(rh)return void(this.placements[E.crossTileID]=new Qd(!1,!1,!1));let _e=!1,St=!1,mr=!0,qr=null,ss={box:null,offscreen:null},tl={box:null,offscreen:null},il=null,Qu=null,fh=null,wh=0,Sh=0,Th=0;B.textFeatureIndex?wh=B.textFeatureIndex:E.useRuntimeCollisionCircles&&(wh=E.featureIndex),B.verticalTextFeatureIndex&&(Sh=B.verticalTextFeatureIndex);const Ch=this.retainedQueryData[nt.bucketInstanceId].tileID,hh=this.terrain?(qh,Fh)=>this.terrain.getElevation(Ch,qh,Fh):null;for(const qh of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Fh=B[qh];Fh&&(Fh.elevation=hh?hh(Fh.anchorPointX,Fh.anchorPointY):0)}const Oh=B.textBox;if(Oh){const qh=Hh=>{let ld=o.WritingMode.horizontal;if(nt.allowVerticalPlacement&&!Hh&&this.prevPlacement){const xd=this.prevPlacement.placedOrientations[E.crossTileID];xd&&(this.placedOrientations[E.crossTileID]=xd,ld=xd,this.markUsedOrientation(nt,ld,E))}return ld},Fh=(Hh,ld)=>{if(nt.allowVerticalPlacement&&E.numVerticalGlyphVertices>0&&B.verticalTextBox){for(const xd of nt.writingModes)if(xd===o.WritingMode.vertical?(ss=ld(),tl=ss):ss=Hh(),ss&&ss.box&&ss.box.length)break}else ss=Hh()};if(Ft.get("text-variable-anchor")){let Hh=Ft.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[E.crossTileID]){const gd=this.prevPlacement.variableOffsets[E.crossTileID];Hh.indexOf(gd.anchor)>0&&(Hh=Hh.filter(Vf=>Vf!==gd.anchor),Hh.unshift(gd.anchor))}const ld=(gd,Vf,_d)=>{const Cf=gd.x2-gd.x1,Ud=gd.y2-gd.y1,Lf=E.textBoxScale,Cd=Wd&&cd==="never"?Vf:null;let pd={box:[],offscreen:!1};const $d=Kh!=="never"?2*Hh.length:Hh.length;for(let yf=0;yf<$d;++yf){const $f=this.attemptAnchorPlacement(Hh[yf%Hh.length],gd,Cf,Ud,Lf,Td,Vd,ol,Xr,Dh,yf>=Hh.length?Kh:"never",E,nt,_d,Cd,hh);if($f&&(pd=$f.placedGlyphBoxes,pd&&pd.box&&pd.box.length)){_e=!0,qr=$f.shift;break}}return pd};Fh(()=>ld(Oh,B.iconBox,o.WritingMode.horizontal),()=>{const gd=B.verticalTextBox;return nt.allowVerticalPlacement&&!(ss&&ss.box&&ss.box.length)&&E.numVerticalGlyphVertices>0&&gd?ld(gd,B.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),ss&&(_e=ss.box,mr=ss.offscreen);const xd=qh(ss&&ss.box);if(!_e&&this.prevPlacement){const gd=this.prevPlacement.variableOffsets[E.crossTileID];gd&&(this.variableOffsets[E.crossTileID]=gd,this.markUsedJustification(nt,gd.anchor,E,xd))}}else{const Hh=(ld,xd)=>{const gd=this.collisionIndex.placeCollisionBox(ld,Kh,ol,Xr,Dh.predicate,hh);return gd&&gd.box&&gd.box.length&&(this.markUsedOrientation(nt,xd,E),this.placedOrientations[E.crossTileID]=xd),gd};Fh(()=>Hh(Oh,o.WritingMode.horizontal),()=>{const ld=B.verticalTextBox;return nt.allowVerticalPlacement&&E.numVerticalGlyphVertices>0&&ld?Hh(ld,o.WritingMode.vertical):{box:null,offscreen:null}}),qh(ss&&ss.box&&ss.box.length)}}if(il=ss,_e=il&&il.box&&il.box.length>0,mr=il&&il.offscreen,E.useRuntimeCollisionCircles){const qh=nt.text.placedSymbolArray.get(E.centerJustifiedTextSymbolIndex),Fh=o.evaluateSizeForFeature(nt.textSizeData,ph,qh),Hh=Ft.get("text-padding");Qu=this.collisionIndex.placeCollisionCircles(Kh,qh,nt.lineVertexArray,nt.glyphOffsetArray,Fh,Xr,ls,Zs,q,Vd,Dh.predicate,E.collisionCircleDiameter,Hh,hh),Qu.circles.length&&Qu.collisionDetected&&!q&&o.warnOnce("Collisions detected, but collision boxes are not shown"),_e=fd||Qu.circles.length>0&&!Qu.collisionDetected,mr=mr&&Qu.offscreen}if(B.iconFeatureIndex&&(Th=B.iconFeatureIndex),B.iconBox){const qh=Fh=>{const Hh=Wd&&qr?mf(Fh,qr.x,qr.y,Td,Vd,this.transform.angle):Fh;return this.collisionIndex.placeCollisionBox(Hh,cd,ol,Xr,Dh.predicate,hh)};tl&&tl.box&&tl.box.length&&B.verticalIconBox?(fh=qh(B.verticalIconBox),St=fh.box.length>0):(fh=qh(B.iconBox),St=fh.box.length>0),mr=mr&&fh.offscreen}const Rh=$h||E.numHorizontalGlyphVertices===0&&E.numVerticalGlyphVertices===0,Nh=Mh||E.numIconVertices===0;if(Rh||Nh?Nh?Rh||(St=St&&_e):_e=St&&_e:St=_e=St&&_e,_e&&il&&il.box&&this.collisionIndex.insertCollisionBox(il.box,Kh,Ft.get("text-ignore-placement"),nt.bucketInstanceId,tl&&tl.box&&Sh?Sh:wh,Dh.ID),St&&fh&&this.collisionIndex.insertCollisionBox(fh.box,cd,Ft.get("icon-ignore-placement"),nt.bucketInstanceId,Th,Dh.ID),Qu&&(_e&&this.collisionIndex.insertCollisionCircles(Qu.circles,Kh,Ft.get("text-ignore-placement"),nt.bucketInstanceId,wh,Dh.ID),q)){const qh=nt.bucketInstanceId;let Fh=this.collisionCircleArrays[qh];Fh===void 0&&(Fh=this.collisionCircleArrays[qh]=new xf);for(let Hh=0;Hh<Qu.circles.length;Hh+=4)Fh.circles.push(Qu.circles[Hh+0]),Fh.circles.push(Qu.circles[Hh+1]),Fh.circles.push(Qu.circles[Hh+2]),Fh.circles.push(Qu.collisionDetected?1:0)}if(E.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(nt.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[E.crossTileID]=new Qd(_e||Of,St||L,mr||nt.justReloaded),A[E.crossTileID]=!0};if(Mf){if(g.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const E=nt.getSortedSymbolIndexes(this.transform.angle);for(let B=E.length-1;B>=0;--B){const _e=E[B];u(nt.symbolInstances.get(_e),nt.collisionArrays[_e])}}else for(let E=g.symbolInstanceStart;E<g.symbolInstanceEnd;E++)u(nt.symbolInstances.get(E),nt.collisionArrays[E]);if(q&&nt.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[nt.bucketInstanceId];o.invert(E.invProjMatrix,Xr),E.viewportMatrix=this.collisionIndex.getViewportMatrix()}nt.justReloaded=!1}markUsedJustification(g,A,q,nt){let Ft;Ft=nt===o.WritingMode.vertical?q.verticalPlacedTextSymbolIndex:{left:q.leftJustifiedTextSymbolIndex,center:q.centerJustifiedTextSymbolIndex,right:q.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(A)];const Xr=[q.leftJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.rightJustifiedTextSymbolIndex,q.verticalPlacedTextSymbolIndex];for(const ls of Xr)ls>=0&&(g.text.placedSymbolArray.get(ls).crossTileID=Ft>=0&&ls!==Ft?0:q.crossTileID)}markUsedOrientation(g,A,q){const nt=A===o.WritingMode.horizontal||A===o.WritingMode.horizontalOnly?A:0,Ft=A===o.WritingMode.vertical?A:0,Xr=[q.leftJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.rightJustifiedTextSymbolIndex];for(const ls of Xr)g.text.placedSymbolArray.get(ls).placedOrientation=nt;q.verticalPlacedTextSymbolIndex&&(g.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).placedOrientation=Ft)}commit(g){this.commitTime=g,this.zoomAtLastRecencyCheck=this.transform.zoom;const A=this.prevPlacement;let q=!1;this.prevZoomAdjustment=A?A.zoomAdjustment(this.transform.zoom):0;const nt=A?A.symbolFadeChange(g):1,Ft=A?A.opacities:{},Xr=A?A.variableOffsets:{},ls=A?A.placedOrientations:{};for(const Zs in this.placements){const ol=this.placements[Zs],rh=Ft[Zs];rh?(this.opacities[Zs]=new wd(rh,nt,ol.text,ol.icon),q=q||ol.text!==rh.text.placed||ol.icon!==rh.icon.placed):(this.opacities[Zs]=new wd(null,nt,ol.text,ol.icon,ol.skipFade),q=q||ol.text||ol.icon)}for(const Zs in Ft){const ol=Ft[Zs];if(!this.opacities[Zs]){const rh=new wd(ol,nt,!1,!1);rh.isHidden()||(this.opacities[Zs]=rh,q=q||ol.text.placed||ol.icon.placed)}}for(const Zs in Xr)this.variableOffsets[Zs]||!this.opacities[Zs]||this.opacities[Zs].isHidden()||(this.variableOffsets[Zs]=Xr[Zs]);for(const Zs in ls)this.placedOrientations[Zs]||!this.opacities[Zs]||this.opacities[Zs].isHidden()||(this.placedOrientations[Zs]=ls[Zs]);if(A&&A.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");q?this.lastPlacementChangeTime=g:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=A?A.lastPlacementChangeTime:g)}updateLayerOpacities(g,A){const q={};for(const nt of A){const Ft=nt.getBucket(g);Ft&&nt.latestFeatureIndex&&g.id===Ft.layerIds[0]&&this.updateBucketOpacities(Ft,q,nt.collisionBoxArray)}}updateBucketOpacities(g,A,q){g.hasTextData()&&(g.text.opacityVertexArray.clear(),g.text.hasVisibleVertices=!1),g.hasIconData()&&(g.icon.opacityVertexArray.clear(),g.icon.hasVisibleVertices=!1),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexArray.clear(),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexArray.clear();const nt=g.layers[0].layout,Ft=new wd(null,0,!1,!1,!0),Xr=nt.get("text-allow-overlap"),ls=nt.get("icon-allow-overlap"),Zs=nt.get("text-variable-anchor"),ol=nt.get("text-rotation-alignment")==="map",rh=nt.get("text-pitch-alignment")==="map",th=nt.get("icon-text-fit")!=="none",ph=new wd(null,0,Xr&&(ls||!g.hasIconData()||nt.get("icon-optional")),ls&&(Xr||!g.hasTextData()||nt.get("text-optional")),!0);!g.collisionArrays&&q&&(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData())&&g.deserializeCollisionBoxes(q);const Dh=($h,Mh,Kh)=>{for(let fd=0;fd<Mh/4;fd++)$h.opacityVertexArray.emplaceBack(Kh);$h.hasVisibleVertices=$h.hasVisibleVertices||Kh!==Pg};for(let $h=0;$h<g.symbolInstances.length;$h++){const Mh=g.symbolInstances.get($h),{numHorizontalGlyphVertices:Kh,numVerticalGlyphVertices:fd,crossTileID:cd}=Mh;let jh=this.opacities[cd];A[cd]?jh=Ft:jh||(jh=ph,this.opacities[cd]=jh),A[cd]=!0;const Td=Mh.numIconVertices>0,Vd=this.placedOrientations[Mh.crossTileID],Wd=Vd===o.WritingMode.vertical,Mf=Vd===o.WritingMode.horizontal||Vd===o.WritingMode.horizontalOnly;if(Kh>0||fd>0){const Of=Dy(jh.text);Dh(g.text,Kh,Wd?Pg:Of),Dh(g.text,fd,Mf?Pg:Of);const L=jh.text.isHidden();[Mh.rightJustifiedTextSymbolIndex,Mh.centerJustifiedTextSymbolIndex,Mh.leftJustifiedTextSymbolIndex].forEach(B=>{B>=0&&(g.text.placedSymbolArray.get(B).hidden=L||Wd?1:0)}),Mh.verticalPlacedTextSymbolIndex>=0&&(g.text.placedSymbolArray.get(Mh.verticalPlacedTextSymbolIndex).hidden=L||Mf?1:0);const u=this.variableOffsets[Mh.crossTileID];u&&this.markUsedJustification(g,u.anchor,Mh,Vd);const E=this.placedOrientations[Mh.crossTileID];E&&(this.markUsedJustification(g,"left",Mh,E),this.markUsedOrientation(g,E,Mh))}if(Td){const Of=Dy(jh.icon),L=!(th&&Mh.verticalPlacedIconSymbolIndex&&Wd);Mh.placedIconSymbolIndex>=0&&(Dh(g.icon,Mh.numIconVertices,L?Of:Pg),g.icon.placedSymbolArray.get(Mh.placedIconSymbolIndex).hidden=jh.icon.isHidden()),Mh.verticalPlacedIconSymbolIndex>=0&&(Dh(g.icon,Mh.numVerticalIconVertices,L?Pg:Of),g.icon.placedSymbolArray.get(Mh.verticalPlacedIconSymbolIndex).hidden=jh.icon.isHidden())}if(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData()){const Of=g.collisionArrays[$h];if(Of){let L=new o.pointGeometry(0,0);if(Of.textBox||Of.verticalTextBox){let E=!0;if(Zs){const B=this.variableOffsets[cd];B?(L=Ah(B.anchor,B.width,B.height,B.textOffset,B.textBoxScale),ol&&L._rotate(rh?this.transform.angle:-this.transform.angle)):E=!1}Of.textBox&&qf(g.textCollisionBox.collisionVertexArray,jh.text.placed,!E||Wd,L.x,L.y),Of.verticalTextBox&&qf(g.textCollisionBox.collisionVertexArray,jh.text.placed,!E||Mf,L.x,L.y)}const u=!!(!Mf&&Of.verticalIconBox);Of.iconBox&&qf(g.iconCollisionBox.collisionVertexArray,jh.icon.placed,u,th?L.x:0,th?L.y:0),Of.verticalIconBox&&qf(g.iconCollisionBox.collisionVertexArray,jh.icon.placed,!u,th?L.x:0,th?L.y:0)}}}if(g.sortFeatures(this.transform.angle),this.retainedQueryData[g.bucketInstanceId]&&(this.retainedQueryData[g.bucketInstanceId].featureSortOrder=g.featureSortOrder),g.hasTextData()&&g.text.opacityVertexBuffer&&g.text.opacityVertexBuffer.updateData(g.text.opacityVertexArray),g.hasIconData()&&g.icon.opacityVertexBuffer&&g.icon.opacityVertexBuffer.updateData(g.icon.opacityVertexArray),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexBuffer&&g.iconCollisionBox.collisionVertexBuffer.updateData(g.iconCollisionBox.collisionVertexArray),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexBuffer&&g.textCollisionBox.collisionVertexBuffer.updateData(g.textCollisionBox.collisionVertexArray),g.text.opacityVertexArray.length!==g.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${g.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${g.text.layoutVertexArray.length}) / 4`);if(g.icon.opacityVertexArray.length!==g.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${g.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${g.icon.layoutVertexArray.length}) / 4`);if(g.bucketInstanceId in this.collisionCircleArrays){const $h=this.collisionCircleArrays[g.bucketInstanceId];g.placementInvProjMatrix=$h.invProjMatrix,g.placementViewportMatrix=$h.viewportMatrix,g.collisionCircleArray=$h.circles,delete this.collisionCircleArrays[g.bucketInstanceId]}}symbolFadeChange(g){return this.fadeDuration===0?1:(g-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(g){return Math.max(0,(this.transform.zoom-g)/1.5)}hasTransitions(g){return this.stale||g-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(g,A){const q=this.zoomAtLastRecencyCheck===A?1-this.zoomAdjustment(A):1;return this.zoomAtLastRecencyCheck=A,this.commitTime+this.fadeDuration*q>g}setStale(){this.stale=!0}}function qf(he,g,A,q,nt){he.emplaceBack(g?1:0,A?1:0,q||0,nt||0),he.emplaceBack(g?1:0,A?1:0,q||0,nt||0),he.emplaceBack(g?1:0,A?1:0,q||0,nt||0),he.emplaceBack(g?1:0,A?1:0,q||0,nt||0)}const mp=Math.pow(2,25),Vp=Math.pow(2,24),om=Math.pow(2,17),Pd=Math.pow(2,16),Hg=Math.pow(2,9),Fm=Math.pow(2,8),I_=Math.pow(2,1);function Dy(he){if(he.opacity===0&&!he.placed)return 0;if(he.opacity===1&&he.placed)return 4294967295;const g=he.placed?1:0,A=Math.floor(127*he.opacity);return A*mp+g*Vp+A*om+g*Pd+A*Hg+g*Fm+A*I_+g}const Pg=0;class l_{constructor(g){this._sortAcrossTiles=g.layout.get("symbol-z-order")!=="viewport-y"&&!g.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(g,A,q,nt,Ft){const Xr=this._bucketParts;for(;this._currentTileIndex<g.length;)if(A.getBucketParts(Xr,nt,g[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,Ft())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Xr.sort((ls,Zs)=>ls.sortKey-Zs.sortKey));this._currentPartIndex<Xr.length;)if(A.placeLayerBucketPart(Xr[this._currentPartIndex],this._seenCrossTileIDs,q),this._currentPartIndex++,Ft())return!0;return!1}}class ev{constructor(g,A,q,nt,Ft,Xr,ls,Zs){this.placement=new Od(g,A,Xr,ls,Zs),this._currentPlacementIndex=q.length-1,this._forceFullPlacement=nt,this._showCollisionBoxes=Ft,this._done=!1}isDone(){return this._done}continuePlacement(g,A,q){const nt=o.exported.now(),Ft=()=>{const Xr=o.exported.now()-nt;return!this._forceFullPlacement&&Xr>2};for(;this._currentPlacementIndex>=0;){const Xr=A[g[this._currentPlacementIndex]],ls=this.placement.collisionIndex.transform.zoom;if(Xr.type==="symbol"&&(!Xr.minzoom||Xr.minzoom<=ls)&&(!Xr.maxzoom||Xr.maxzoom>ls)){if(this._inProgressLayer||(this._inProgressLayer=new l_(Xr)),this._inProgressLayer.continuePlacement(q[Xr.source],this.placement,this._showCollisionBoxes,Xr,Ft))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(g){return this.placement.commit(g),this.placement}}const c_=512/o.EXTENT/2;class ep{constructor(g,A,q){this.tileID=g,this.bucketInstanceId=q,this._symbolsByKey={};const nt=new Map;for(let Ft=0;Ft<A.length;Ft++){const Xr=A.get(Ft),ls=Xr.key,Zs=nt.get(ls);Zs?Zs.push(Xr):nt.set(ls,[Xr])}for(const[Ft,Xr]of nt){const ls={positions:Xr.map(Zs=>({x:Math.floor(Zs.anchorX*c_),y:Math.floor(Zs.anchorY*c_)})),crossTileIDs:Xr.map(Zs=>Zs.crossTileID)};if(ls.positions.length>128){const Zs=new o.KDBush(ls.positions,ol=>ol.x,ol=>ol.y,16,Uint16Array);delete Zs.points,delete ls.positions,ls.index=Zs}this._symbolsByKey[Ft]=ls}}getScaledCoordinates(g,A){const{x:q,y:nt,z:Ft}=this.tileID.canonical,{x:Xr,y:ls,z:Zs}=A.canonical,ol=c_/Math.pow(2,Zs-Ft),rh=(ls*o.EXTENT+g.anchorY)*ol,th=nt*o.EXTENT*c_;return{x:Math.floor((Xr*o.EXTENT+g.anchorX)*ol-q*o.EXTENT*c_),y:Math.floor(rh-th)}}findMatches(g,A,q){const nt=this.tileID.canonical.z<A.canonical.z?1:Math.pow(2,this.tileID.canonical.z-A.canonical.z);for(let Ft=0;Ft<g.length;Ft++){const Xr=g.get(Ft);if(Xr.crossTileID)continue;const ls=this._symbolsByKey[Xr.key];if(!ls)continue;const Zs=this.getScaledCoordinates(Xr,A);if(ls.index){const ol=ls.index.range(Zs.x-nt,Zs.y-nt,Zs.x+nt,Zs.y+nt).sort();for(const rh of ol){const th=ls.crossTileIDs[rh];if(!q[th]){q[th]=!0,Xr.crossTileID=th;break}}}else if(ls.positions)for(let ol=0;ol<ls.positions.length;ol++){const rh=ls.positions[ol],th=ls.crossTileIDs[ol];if(Math.abs(rh.x-Zs.x)<=nt&&Math.abs(rh.y-Zs.y)<=nt&&!q[th]){q[th]=!0,Xr.crossTileID=th;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:g})=>g)}}class im{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(g){const A=Math.round((g-this.lng)/360);if(A!==0)for(const q in this.indexes){const nt=this.indexes[q],Ft={};for(const Xr in nt){const ls=nt[Xr];ls.tileID=ls.tileID.unwrapTo(ls.tileID.wrap+A),Ft[ls.tileID.key]=ls}this.indexes[q]=Ft}this.lng=g}addBucket(g,A,q){if(this.indexes[g.overscaledZ]&&this.indexes[g.overscaledZ][g.key]){if(this.indexes[g.overscaledZ][g.key].bucketInstanceId===A.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(g.overscaledZ,this.indexes[g.overscaledZ][g.key])}for(let Ft=0;Ft<A.symbolInstances.length;Ft++)A.symbolInstances.get(Ft).crossTileID=0;this.usedCrossTileIDs[g.overscaledZ]||(this.usedCrossTileIDs[g.overscaledZ]={});const nt=this.usedCrossTileIDs[g.overscaledZ];for(const Ft in this.indexes){const Xr=this.indexes[Ft];if(Number(Ft)>g.overscaledZ)for(const ls in Xr){const Zs=Xr[ls];Zs.tileID.isChildOf(g)&&Zs.findMatches(A.symbolInstances,g,nt)}else{const ls=Xr[g.scaledTo(Number(Ft)).key];ls&&ls.findMatches(A.symbolInstances,g,nt)}}for(let Ft=0;Ft<A.symbolInstances.length;Ft++){const Xr=A.symbolInstances.get(Ft);Xr.crossTileID||(Xr.crossTileID=q.generate(),nt[Xr.crossTileID]=!0)}return this.indexes[g.overscaledZ]===void 0&&(this.indexes[g.overscaledZ]={}),this.indexes[g.overscaledZ][g.key]=new ep(g,A.symbolInstances,A.bucketInstanceId),!0}removeBucketCrossTileIDs(g,A){for(const q of A.getCrossTileIDsLists())for(const nt of q)delete this.usedCrossTileIDs[g][nt]}removeStaleBuckets(g){let A=!1;for(const q in this.indexes){const nt=this.indexes[q];for(const Ft in nt)g[nt[Ft].bucketInstanceId]||(this.removeBucketCrossTileIDs(q,nt[Ft]),delete nt[Ft],A=!0)}return A}}class mm{constructor(){this.layerIndexes={},this.crossTileIDs=new im,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(g,A,q){let nt=this.layerIndexes[g.id];nt===void 0&&(nt=this.layerIndexes[g.id]=new Jp);let Ft=!1;const Xr={};nt.handleWrapJump(q);for(const ls of A){const Zs=ls.getBucket(g);Zs&&g.id===Zs.layerIds[0]&&(Zs.bucketInstanceId||(Zs.bucketInstanceId=++this.maxBucketInstanceId),nt.addBucket(ls.tileID,Zs,this.crossTileIDs)&&(Ft=!0),Xr[Zs.bucketInstanceId]=!0)}return nt.removeStaleBuckets(Xr)&&(Ft=!0),Ft}pruneUnusedLayers(g){const A={};g.forEach(q=>{A[q]=!0});for(const q in this.layerIndexes)A[q]||delete this.layerIndexes[q]}}const yr=(he,g)=>o.emitValidationErrors(he,g&&g.filter(A=>A.identifier!=="source.canvas")),el=o.pick(Yf,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),yh=o.pick(Yf,["setCenter","setZoom","setBearing","setPitch"]),Uh=function(){const he={},g=o.spec.$version;for(const A in o.spec.$root){const q=o.spec.$root[A];if(q.required){let nt=null;nt=A==="version"?g:q.type==="array"?[]:{},nt!=null&&(he[A]=nt)}}return he}();class nd extends o.Evented{constructor(g,A={}){super(),this.map=g,this.dispatcher=new zd(Mp(),this,g._getMapId()),this.imageManager=new ud,this.imageManager.setEventedParent(this),this.glyphManager=new md(g._requestManager,A.localIdeographFontFamily),this.lineAtlas=new Sd(256,512),this.crossTileSymbolIndex=new mm,this._spritesImagesIds={},this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const q=this;this._rtlTextPluginCallback=nd.registerForPluginStateChange(nt=>{q.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:nt.pluginStatus,pluginURL:nt.pluginURL},(Ft,Xr)=>{if(o.triggerPluginCompletionEvent(Ft),Xr&&Xr.every(ls=>ls))for(const ls in q.sourceCaches)q.sourceCaches[ls].reload()})}),this.on("data",nt=>{if(nt.dataType!=="source"||nt.sourceDataType!=="metadata")return;const Ft=this.sourceCaches[nt.sourceId];if(!Ft)return;const Xr=Ft.getSource();if(Xr&&Xr.vectorLayerIds)for(const ls in this._layers){const Zs=this._layers[ls];Zs.source===Xr.id&&this._validateLayer(Zs)}})}loadURL(g,A={},q){this.fire(new o.Event("dataloading",{dataType:"style"})),A.validate=typeof A.validate!="boolean"||A.validate;const nt=this.map._requestManager.transformRequest(g,$s.Style);this._request=o.getJSON(nt,(Ft,Xr)=>{this._request=null,Ft?this.fire(new o.ErrorEvent(Ft)):Xr&&this._load(Xr,A,q)})}loadJSON(g,A={},q){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,A.validate=A.validate!==!1,this._load(g,A,q)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Uh,{validate:!1})}_load(g,A,q){const nt=A.transformStyle?A.transformStyle(q,g):g;if(A.validate&&yr(this,o.validateStyle(nt)))return;this._loaded=!0,this.stylesheet=nt;for(const Xr in nt.sources)this.addSource(Xr,nt.sources[Xr],{validate:!1});nt.sprite?this._loadSprite(nt.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(nt.glyphs);const Ft=Pp(this.stylesheet.layers);this._order=Ft.map(Xr=>Xr.id),this._layers={},this._serializedLayers={};for(let Xr of Ft)Xr=o.createStyleLayer(Xr),Xr.setEventedParent(this,{layer:{id:Xr.id}}),this._layers[Xr.id]=Xr,this._serializedLayers[Xr.id]=Xr.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ed(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(g,A=!1,q){this.imageManager.setLoaded(!1),this._spriteRequest=function(nt,Ft,Xr,ls){const Zs=Ih(nt),ol=Xr>1?"@2x":"";let rh;const th=[],ph=[],Dh={},$h={};for(const{id:Kh,url:fd}of Zs){const cd=th.push(o.getJSON(Ft.transformRequest(Ft.normalizeSpriteURL(fd,ol,".json"),$s.SpriteJSON),(Td,Vd)=>{th.splice(cd,1),rh||(rh=Td,Dh[Kh]=Vd,Mh())})),jh=ph.push(ah.getImage(Ft.transformRequest(Ft.normalizeSpriteURL(fd,ol,".png"),$s.SpriteImage),(Td,Vd)=>{ph.splice(jh,1),rh||(rh=Td,$h[Kh]=Vd,Mh())}))}function Mh(){const Kh=Object.values(Dh).length,fd=Object.values($h).length;if(rh)ls(rh);else if(Zs.length===Kh&&Kh===fd){const cd={};for(const jh in Dh){cd[jh]={};const Td=o.exported.getImageCanvasContext($h[jh]),Vd=Dh[jh];for(const Wd in Vd){const{width:Mf,height:Of,x:L,y:u,sdf:E,pixelRatio:B,stretchX:_e,stretchY:St,content:mr}=Vd[Wd];cd[jh][Wd]={data:null,pixelRatio:B,sdf:E,stretchX:_e,stretchY:St,content:mr,spriteData:{width:Mf,height:Of,x:L,y:u,context:Td}}}}ls(null,cd)}}return{cancel(){if(th.length)for(const Kh of th)Kh.cancel(),th.splice(th.indexOf(Kh),1);if(ph.length)for(const Kh of ph)Kh.cancel(),ph.splice(ph.indexOf(Kh),1)}}}(g,this.map._requestManager,this.map.getPixelRatio(),(nt,Ft)=>{if(this._spriteRequest=null,nt)this.fire(new o.ErrorEvent(nt));else if(Ft)for(const Xr in Ft){this._spritesImagesIds[Xr]=[];const ls=this._spritesImagesIds[Xr]?this._spritesImagesIds[Xr].filter(Zs=>!(Zs in Ft)):[];for(const Zs of ls)this.imageManager.removeImage(Zs),this._changedImages[Zs]=!0;for(const Zs in Ft[Xr]){const ol=Xr==="default"?Zs:`${Xr}:${Zs}`;this._spritesImagesIds[Xr].push(ol),ol in this.imageManager.images?this.imageManager.updateImage(ol,Ft[Xr][Zs],!1):this.imageManager.addImage(ol,Ft[Xr][Zs]),A&&(this._changedImages[ol]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),A&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),q&&q(nt)})}_unloadSprite(){for(const g of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(g),this._changedImages[g]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(g){const A=this.sourceCaches[g.source];if(!A)return;const q=g.sourceLayer;if(!q)return;const nt=A.getSource();(nt.type==="geojson"||nt.vectorLayerIds&&nt.vectorLayerIds.indexOf(q)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${q}" does not exist on source "${nt.id}" as specified by style layer "${g.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(g){const A=[];for(const q of g){const nt=this._layers[q];nt.type!=="custom"&&A.push(nt.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(g){if(!this._loaded)return;const A=this._changed;if(this._changed){const nt=Object.keys(this._updatedLayers),Ft=Object.keys(this._removedLayers);(nt.length||Ft.length)&&this._updateWorkerLayers(nt,Ft);for(const Xr in this._updatedSources){const ls=this._updatedSources[Xr];if(ls==="reload")this._reloadSource(Xr);else{if(ls!=="clear")throw new Error(`Invalid action ${ls}`);this._clearSource(Xr)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Xr in this._updatedPaintProps)this._layers[Xr].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}const q={};for(const nt in this.sourceCaches){const Ft=this.sourceCaches[nt];q[nt]=Ft.used,Ft.used=!1}for(const nt of this._order){const Ft=this._layers[nt];Ft.recalculate(g,this._availableImages),!Ft.isHidden(g.zoom)&&Ft.source&&(this.sourceCaches[Ft.source].used=!0)}for(const nt in q){const Ft=this.sourceCaches[nt];q[nt]!==Ft.used&&Ft.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(g),this.z=g.zoom,A&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const g=Object.keys(this._changedImages);if(g.length){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(g,A){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(g),removedIds:A})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(g,A={}){if(this._checkLoaded(),g=A.transformStyle?A.transformStyle(this.serialize(),g):g,yr(this,o.validateStyle(g)))return!1;(g=o.clone$1(g)).layers=Pp(g.layers);const q=function(Ft,Xr){if(!Ft)return[{command:Yf.setStyle,args:[Xr]}];let ls=[];try{if(!ze(Ft.version,Xr.version))return[{command:Yf.setStyle,args:[Xr]}];ze(Ft.center,Xr.center)||ls.push({command:Yf.setCenter,args:[Xr.center]}),ze(Ft.zoom,Xr.zoom)||ls.push({command:Yf.setZoom,args:[Xr.zoom]}),ze(Ft.bearing,Xr.bearing)||ls.push({command:Yf.setBearing,args:[Xr.bearing]}),ze(Ft.pitch,Xr.pitch)||ls.push({command:Yf.setPitch,args:[Xr.pitch]}),ze(Ft.sprite,Xr.sprite)||ls.push({command:Yf.setSprite,args:[Xr.sprite]}),ze(Ft.glyphs,Xr.glyphs)||ls.push({command:Yf.setGlyphs,args:[Xr.glyphs]}),ze(Ft.transition,Xr.transition)||ls.push({command:Yf.setTransition,args:[Xr.transition]}),ze(Ft.light,Xr.light)||ls.push({command:Yf.setLight,args:[Xr.light]});const Zs={},ol=[];(function(th,ph,Dh,$h){let Mh;for(Mh in ph=ph||{},th=th||{})Object.prototype.hasOwnProperty.call(th,Mh)&&(Object.prototype.hasOwnProperty.call(ph,Mh)||sm(Mh,Dh,$h));for(Mh in ph)Object.prototype.hasOwnProperty.call(ph,Mh)&&(Object.prototype.hasOwnProperty.call(th,Mh)?ze(th[Mh],ph[Mh])||(th[Mh].type==="geojson"&&ph[Mh].type==="geojson"&&Op(th,ph,Mh)?Dh.push({command:Yf.setGeoJSONSourceData,args:[Mh,ph[Mh].data]}):Xd(Mh,ph,Dh,$h)):qp(Mh,ph,Dh))})(Ft.sources,Xr.sources,ol,Zs);const rh=[];Ft.layers&&Ft.layers.forEach(th=>{Zs[th.source]?ls.push({command:Yf.removeLayer,args:[th.id]}):rh.push(th)}),ls=ls.concat(ol),function(th,ph,Dh){ph=ph||[];const $h=(th=th||[]).map(Sm),Mh=ph.map(Sm),Kh=th.reduce(hp,{}),fd=ph.reduce(hp,{}),cd=$h.slice(),jh=Object.create(null);let Td,Vd,Wd,Mf,Of,L,u;for(Td=0,Vd=0;Td<$h.length;Td++)Wd=$h[Td],Object.prototype.hasOwnProperty.call(fd,Wd)?Vd++:(Dh.push({command:Yf.removeLayer,args:[Wd]}),cd.splice(cd.indexOf(Wd,Vd),1));for(Td=0,Vd=0;Td<Mh.length;Td++)Wd=Mh[Mh.length-1-Td],cd[cd.length-1-Td]!==Wd&&(Object.prototype.hasOwnProperty.call(Kh,Wd)?(Dh.push({command:Yf.removeLayer,args:[Wd]}),cd.splice(cd.lastIndexOf(Wd,cd.length-Vd),1)):Vd++,L=cd[cd.length-Td],Dh.push({command:Yf.addLayer,args:[fd[Wd],L]}),cd.splice(cd.length-Td,0,Wd),jh[Wd]=!0);for(Td=0;Td<Mh.length;Td++)if(Wd=Mh[Td],Mf=Kh[Wd],Of=fd[Wd],!jh[Wd]&&!ze(Mf,Of))if(ze(Mf.source,Of.source)&&ze(Mf["source-layer"],Of["source-layer"])&&ze(Mf.type,Of.type)){for(u in rm(Mf.layout,Of.layout,Dh,Wd,null,Yf.setLayoutProperty),rm(Mf.paint,Of.paint,Dh,Wd,null,Yf.setPaintProperty),ze(Mf.filter,Of.filter)||Dh.push({command:Yf.setFilter,args:[Wd,Of.filter]}),ze(Mf.minzoom,Of.minzoom)&&ze(Mf.maxzoom,Of.maxzoom)||Dh.push({command:Yf.setLayerZoomRange,args:[Wd,Of.minzoom,Of.maxzoom]}),Mf)Object.prototype.hasOwnProperty.call(Mf,u)&&u!=="layout"&&u!=="paint"&&u!=="filter"&&u!=="metadata"&&u!=="minzoom"&&u!=="maxzoom"&&(u.indexOf("paint.")===0?rm(Mf[u],Of[u],Dh,Wd,u.slice(6),Yf.setPaintProperty):ze(Mf[u],Of[u])||Dh.push({command:Yf.setLayerProperty,args:[Wd,u,Of[u]]}));for(u in Of)Object.prototype.hasOwnProperty.call(Of,u)&&!Object.prototype.hasOwnProperty.call(Mf,u)&&u!=="layout"&&u!=="paint"&&u!=="filter"&&u!=="metadata"&&u!=="minzoom"&&u!=="maxzoom"&&(u.indexOf("paint.")===0?rm(Mf[u],Of[u],Dh,Wd,u.slice(6),Yf.setPaintProperty):ze(Mf[u],Of[u])||Dh.push({command:Yf.setLayerProperty,args:[Wd,u,Of[u]]}))}else Dh.push({command:Yf.removeLayer,args:[Wd]}),L=cd[cd.lastIndexOf(Wd)+1],Dh.push({command:Yf.addLayer,args:[Of,L]})}(rh,Xr.layers,ls)}catch(Zs){console.warn("Unable to compute style diff:",Zs),ls=[{command:Yf.setStyle,args:[Xr]}]}return ls}(this.serialize(),g).filter(Ft=>!(Ft.command in yh));if(q.length===0)return!1;const nt=q.filter(Ft=>!(Ft.command in el));if(nt.length>0)throw new Error(`Unimplemented: ${nt.map(Ft=>Ft.command).join(", ")}.`);return q.forEach(Ft=>{Ft.command!=="setTransition"&&this[Ft.command].apply(this,Ft.args)}),this.stylesheet=g,!0}addImage(g,A){if(this.getImage(g))return this.fire(new o.ErrorEvent(new Error(`An image named "${g}" already exists.`)));this.imageManager.addImage(g,A),this._afterImageUpdated(g)}updateImage(g,A){this.imageManager.updateImage(g,A)}getImage(g){return this.imageManager.getImage(g)}removeImage(g){if(!this.getImage(g))return this.fire(new o.ErrorEvent(new Error(`An image named "${g}" does not exist.`)));this.imageManager.removeImage(g),this._afterImageUpdated(g)}_afterImageUpdated(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(g,A,q={}){if(this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error(`Source "${g}" already exists.`);if(!A.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(A).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(A.type)>=0&&this._validate(o.validateStyle.source,`sources.${g}`,A,null,q))return;this.map&&this.map._collectResourceTiming&&(A.collectResourceTiming=!0);const nt=this.sourceCaches[g]=new Ld(g,A,this.dispatcher);nt.style=this,nt.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:nt.serialize(),sourceId:g})),nt.onAdd(this.map),this._changed=!0}removeSource(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(const q in this._layers)if(this._layers[q].source===g)return this.fire(new o.ErrorEvent(new Error(`Source "${g}" cannot be removed while layer "${q}" is using it.`)));const A=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],A.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),A.setEventedParent(null),A.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(g,A){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error(`There is no source with this ID=${g}`);const q=this.sourceCaches[g].getSource();if(q.type!=="geojson")throw new Error(`geojsonSource.type is ${q.type}, which is !== 'geojson`);q.setData(A),this._changed=!0}getSource(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()}addLayer(g,A,q={}){this._checkLoaded();const nt=g.id;if(this.getLayer(nt))return void this.fire(new o.ErrorEvent(new Error(`Layer "${nt}" already exists on this map.`)));let Ft;if(g.type==="custom"){if(yr(this,o.validateCustomStyleLayer(g)))return;Ft=o.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(nt,g.source),g=o.clone$1(g),g=o.extend(g,{source:nt})),this._validate(o.validateStyle.layer,`layers.${nt}`,g,{arrayIndex:-1},q))return;Ft=o.createStyleLayer(g),this._validateLayer(Ft),Ft.setEventedParent(this,{layer:{id:nt}}),this._serializedLayers[Ft.id]=Ft.serialize()}const Xr=A?this._order.indexOf(A):this._order.length;if(A&&Xr===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${nt}" before non-existing layer "${A}".`)));else{if(this._order.splice(Xr,0,nt),this._layerOrderChanged=!0,this._layers[nt]=Ft,this._removedLayers[nt]&&Ft.source&&Ft.type!=="custom"){const ls=this._removedLayers[nt];delete this._removedLayers[nt],ls.type!==Ft.type?this._updatedSources[Ft.source]="clear":(this._updatedSources[Ft.source]="reload",this.sourceCaches[Ft.source].pause())}this._updateLayer(Ft),Ft.onAdd&&Ft.onAdd(this.map)}}moveLayer(g,A){if(this._checkLoaded(),this._changed=!0,!this._layers[g])return void this.fire(new o.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be moved.`)));if(g===A)return;const q=this._order.indexOf(g);this._order.splice(q,1);const nt=A?this._order.indexOf(A):this._order.length;A&&nt===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${g}" before non-existing layer "${A}".`))):(this._order.splice(nt,0,g),this._layerOrderChanged=!0)}removeLayer(g){this._checkLoaded();const A=this._layers[g];if(!A)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${g}".`)));A.setEventedParent(null);const q=this._order.indexOf(g);this._order.splice(q,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=A,delete this._layers[g],delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],A.onRemove&&A.onRemove(this.map)}getLayer(g){return this._layers[g]}hasLayer(g){return g in this._layers}setLayerZoomRange(g,A,q){this._checkLoaded();const nt=this.getLayer(g);nt?nt.minzoom===A&&nt.maxzoom===q||(A!=null&&(nt.minzoom=A),q!=null&&(nt.maxzoom=q),this._updateLayer(nt)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${g}".`)))}setFilter(g,A,q={}){this._checkLoaded();const nt=this.getLayer(g);if(nt){if(!ze(nt.filter,A))return A==null?(nt.filter=void 0,void this._updateLayer(nt)):void(this._validate(o.validateStyle.filter,`layers.${nt.id}.filter`,A,null,q)||(nt.filter=o.clone$1(A),this._updateLayer(nt)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${g}".`)))}getFilter(g){return o.clone$1(this.getLayer(g).filter)}setLayoutProperty(g,A,q,nt={}){this._checkLoaded();const Ft=this.getLayer(g);Ft?ze(Ft.getLayoutProperty(A),q)||(Ft.setLayoutProperty(A,q,nt),this._updateLayer(Ft)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getLayoutProperty(g,A){const q=this.getLayer(g);if(q)return q.getLayoutProperty(A);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${g}".`)))}setPaintProperty(g,A,q,nt={}){this._checkLoaded();const Ft=this.getLayer(g);Ft?ze(Ft.getPaintProperty(A),q)||(Ft.setPaintProperty(A,q,nt)&&this._updateLayer(Ft),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getPaintProperty(g,A){return this.getLayer(g).getPaintProperty(A)}setFeatureState(g,A){this._checkLoaded();const q=g.source,nt=g.sourceLayer,Ft=this.sourceCaches[q];if(Ft===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${q}' does not exist in the map's style.`)));const Xr=Ft.getSource().type;Xr==="geojson"&&nt?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Xr!=="vector"||nt?(g.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),Ft.setFeatureState(nt,g.id,A)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(g,A){this._checkLoaded();const q=g.source,nt=this.sourceCaches[q];if(nt===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${q}' does not exist in the map's style.`)));const Ft=nt.getSource().type,Xr=Ft==="vector"?g.sourceLayer:void 0;Ft!=="vector"||Xr?A&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):nt.removeFeatureState(Xr,g.id,A):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(g){this._checkLoaded();const A=g.source,q=g.sourceLayer,nt=this.sourceCaches[A];if(nt!==void 0)return nt.getSource().type!=="vector"||q?(g.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),nt.getFeatureState(q,g.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${A}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,g=>g.serialize()),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(g){const A=Xr=>this._layers[Xr].type==="fill-extrusion",q={},nt=[];for(let Xr=this._order.length-1;Xr>=0;Xr--){const ls=this._order[Xr];if(A(ls)){q[ls]=Xr;for(const Zs of g){const ol=Zs[ls];if(ol)for(const rh of ol)nt.push(rh)}}}nt.sort((Xr,ls)=>ls.intersectionZ-Xr.intersectionZ);const Ft=[];for(let Xr=this._order.length-1;Xr>=0;Xr--){const ls=this._order[Xr];if(A(ls))for(let Zs=nt.length-1;Zs>=0;Zs--){const ol=nt[Zs].feature;if(q[ol.layer.id]<Xr)break;Ft.push(ol),nt.pop()}else for(const Zs of g){const ol=Zs[ls];if(ol)for(const rh of ol)Ft.push(rh.feature)}}return Ft}queryRenderedFeatures(g,A,q){A&&A.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",A.filter,null,A);const nt={};if(A&&A.layers){if(!Array.isArray(A.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Xr of A.layers){const ls=this._layers[Xr];if(!ls)return this.fire(new o.ErrorEvent(new Error(`The layer '${Xr}' does not exist in the map's style and cannot be queried for features.`))),[];nt[ls.source]=!0}}const Ft=[];A.availableImages=this._availableImages;for(const Xr in this.sourceCaches)A.layers&&!nt[Xr]||Ft.push(Qh(this.sourceCaches[Xr],this._layers,this._serializedLayers,g,A,q));return this.placement&&Ft.push(function(Xr,ls,Zs,ol,rh,th,ph){const Dh={},$h=th.queryRenderedSymbols(ol),Mh=[];for(const Kh of Object.keys($h).map(Number))Mh.push(ph[Kh]);Mh.sort(Yd);for(const Kh of Mh){const fd=Kh.featureIndex.lookupSymbolFeatures($h[Kh.bucketInstanceId],ls,Kh.bucketIndex,Kh.sourceLayerIndex,rh.filter,rh.layers,rh.availableImages,Xr);for(const cd in fd){const jh=Dh[cd]=Dh[cd]||[],Td=fd[cd];Td.sort((Vd,Wd)=>{const Mf=Kh.featureSortOrder;if(Mf){const Of=Mf.indexOf(Vd.featureIndex);return Mf.indexOf(Wd.featureIndex)-Of}return Wd.featureIndex-Vd.featureIndex});for(const Vd of Td)jh.push(Vd)}}for(const Kh in Dh)Dh[Kh].forEach(fd=>{const cd=fd.feature,jh=Zs[Xr[Kh].source].getFeatureState(cd.layer["source-layer"],cd.id);cd.source=cd.layer.source,cd.layer["source-layer"]&&(cd.sourceLayer=cd.layer["source-layer"]),cd.state=jh});return Dh}(this._layers,this._serializedLayers,this.sourceCaches,g,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ft)}querySourceFeatures(g,A){A&&A.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",A.filter,null,A);const q=this.sourceCaches[g];return q?function(nt,Ft){const Xr=nt.getRenderableIds().map(ol=>nt.getTileByID(ol)),ls=[],Zs={};for(let ol=0;ol<Xr.length;ol++){const rh=Xr[ol],th=rh.tileID.canonical.key;Zs[th]||(Zs[th]=!0,rh.querySourceFeatures(ls,Ft))}return ls}(q,A):[]}addSourceType(g,A,q){return nd.getSourceType(g)?q(new Error(`A source type called "${g}" already exists.`)):(nd.setSourceType(g,A),A.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:A.workerSourceURL},q):q(null,null))}getLight(){return this.light.getLight()}setLight(g,A={}){this._checkLoaded();const q=this.light.getLight();let nt=!1;for(const Xr in g)if(!ze(g[Xr],q[Xr])){nt=!0;break}if(!nt)return;const Ft={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,A),this.light.updateTransitions(Ft)}_validate(g,A,q,nt,Ft={}){return(!Ft||Ft.validate!==!1)&&yr(this,g.call(o.validateStyle,o.extend({key:A,style:this.serialize(),value:q,styleSpec:o.spec},nt)))}_remove(g=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const A in this._layers)this._layers[A].setEventedParent(null);for(const A in this.sourceCaches){const q=this.sourceCaches[A];q.setEventedParent(null),q.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(g)}_clearSource(g){this.sourceCaches[g].clearTiles()}_reloadSource(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()}_updateSources(g){for(const A in this.sourceCaches)this.sourceCaches[A].update(g,this.map.terrain)}_generateCollisionBoxes(){for(const g in this.sourceCaches)this._reloadSource(g)}_updatePlacement(g,A,q,nt,Ft=!1){let Xr=!1,ls=!1;const Zs={};for(const ol of this._order){const rh=this._layers[ol];if(rh.type!=="symbol")continue;if(!Zs[rh.source]){const ph=this.sourceCaches[rh.source];Zs[rh.source]=ph.getRenderableIds(!0).map(Dh=>ph.getTileByID(Dh)).sort((Dh,$h)=>$h.tileID.overscaledZ-Dh.tileID.overscaledZ||(Dh.tileID.isLessThan($h.tileID)?-1:1))}const th=this.crossTileSymbolIndex.addLayer(rh,Zs[rh.source],g.center.lng);Xr=Xr||th}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((Ft=Ft||this._layerOrderChanged||q===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),g.zoom))&&(this.pauseablePlacement=new ev(g,this.map.terrain,this._order,Ft,A,q,nt,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Zs),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),ls=!0),Xr&&this.pauseablePlacement.placement.setStale()),ls||Xr)for(const ol of this._order){const rh=this._layers[ol];rh.type==="symbol"&&this.placement.updateLayerOpacities(rh,Zs[rh.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()}getImages(g,A,q){this.imageManager.getImages(A.icons,q),this._updateTilesForChangedImages();const nt=this.sourceCaches[A.source];nt&&nt.setDependencies(A.tileID.key,A.type,A.icons)}getGlyphs(g,A,q){this.glyphManager.getGlyphs(A.stacks,q);const nt=this.sourceCaches[A.source];nt&&nt.setDependencies(A.tileID.key,A.type,[""])}getResource(g,A,q){return o.makeRequest(A,q)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(g,A={}){this._checkLoaded(),g&&this._validate(o.validateStyle.glyphs,"glyphs",g,null,A)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=g,this.glyphManager.entries={},this.glyphManager.setURL(g))}addSprite(g,A,q={},nt){this._checkLoaded();const Ft=[{id:g,url:A}],Xr=[...Ih(this.stylesheet.sprite),...Ft];this._validate(o.validateStyle.sprite,"sprite",Xr,null,q)||(this.stylesheet.sprite=Xr,this._loadSprite(Ft,!0,nt))}removeSprite(g){this._checkLoaded();const A=Ih(this.stylesheet.sprite);if(A.find(q=>q.id===g)){if(this._spritesImagesIds[g])for(const q of this._spritesImagesIds[g])this.imageManager.removeImage(q),this._changedImages[q]=!0;A.splice(A.findIndex(q=>q.id===g),1),this.stylesheet.sprite=A.length>0?A:void 0,delete this._spritesImagesIds[g],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${g}" doesn't exists on this map.`)))}getSprite(){return Ih(this.stylesheet.sprite)}setSprite(g,A={},q){this._checkLoaded(),g&&this._validate(o.validateStyle.sprite,"sprite",g,null,A)||(this.stylesheet.sprite=g,g?this._loadSprite(g,!0,q):(this._unloadSprite(),q(null)))}}nd.getSourceType=function(he){return bp[he]},nd.setSourceType=function(he,g){bp[he]=g},nd.registerForPluginStateChange=o.registerForPluginStateChange;var od=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),ad="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Gf={prelude:Ef(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ef(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ef(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ef(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ef("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ef(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ef(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ef("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ef("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ef("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ef(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ef(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ef(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ef(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ef(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ef(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ef(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ef(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ef(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ef(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ef(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ef(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ef(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ef(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ef(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ef(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ef("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ad),terrainDepth:Ef("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ad),terrainCoords:Ef("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ad)};function Ef(he,g){const A=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,q=g.match(/attribute ([\w]+) ([\w]+)/g),nt=he.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Ft=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Xr=Ft?Ft.concat(nt):nt,ls={};return{fragmentSource:he=he.replace(A,(Zs,ol,rh,th,ph)=>(ls[ph]=!0,ol==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
varying ${rh} ${th} ${ph};
#else
uniform ${rh} ${th} u_${ph};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ph}
    ${rh} ${th} ${ph} = u_${ph};
#endif
`)),vertexSource:g=g.replace(A,(Zs,ol,rh,th,ph)=>{const Dh=th==="float"?"vec2":"vec4",$h=ph.match(/color/)?"color":Dh;return ls[ph]?ol==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${rh} ${Dh} a_${ph};
varying ${rh} ${th} ${ph};
#else
uniform ${rh} ${th} u_${ph};
#endif
`:$h==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = a_${ph};
#else
    ${rh} ${th} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = unpack_mix_${$h}(a_${ph}, u_${ph}_t);
#else
    ${rh} ${th} ${ph} = u_${ph};
#endif
`:ol==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${rh} ${Dh} a_${ph};
#else
uniform ${rh} ${th} u_${ph};
#endif
`:$h==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${rh} ${th} ${ph} = a_${ph};
#else
    ${rh} ${th} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${rh} ${th} ${ph} = unpack_mix_${$h}(a_${ph}, u_${ph}_t);
#else
    ${rh} ${th} ${ph} = u_${ph};
#endif
`}),staticAttributes:q,staticUniforms:Xr}}class _p{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(g,A,q,nt,Ft,Xr,ls,Zs,ol){this.context=g;let rh=this.boundPaintVertexBuffers.length!==nt.length;for(let th=0;!rh&&th<nt.length;th++)this.boundPaintVertexBuffers[th]!==nt[th]&&(rh=!0);g.extVertexArrayObject&&this.vao&&this.boundProgram===A&&this.boundLayoutVertexBuffer===q&&!rh&&this.boundIndexBuffer===Ft&&this.boundVertexOffset===Xr&&this.boundDynamicVertexBuffer===ls&&this.boundDynamicVertexBuffer2===Zs&&this.boundDynamicVertexBuffer3===ol?(g.bindVertexArrayOES.set(this.vao),ls&&ls.bind(),Ft&&Ft.dynamicDraw&&Ft.bind(),Zs&&Zs.bind(),ol&&ol.bind()):this.freshBind(A,q,nt,Ft,Xr,ls,Zs,ol)}freshBind(g,A,q,nt,Ft,Xr,ls,Zs){let ol;const rh=g.numAttributes,th=this.context,ph=th.gl;if(th.extVertexArrayObject)this.vao&&this.destroy(),this.vao=th.extVertexArrayObject.createVertexArrayOES(),th.bindVertexArrayOES.set(this.vao),ol=0,this.boundProgram=g,this.boundLayoutVertexBuffer=A,this.boundPaintVertexBuffers=q,this.boundIndexBuffer=nt,this.boundVertexOffset=Ft,this.boundDynamicVertexBuffer=Xr,this.boundDynamicVertexBuffer2=ls,this.boundDynamicVertexBuffer3=Zs;else{ol=th.currentNumAttributes||0;for(let Dh=rh;Dh<ol;Dh++)ph.disableVertexAttribArray(Dh)}A.enableAttributes(ph,g);for(const Dh of q)Dh.enableAttributes(ph,g);Xr&&Xr.enableAttributes(ph,g),ls&&ls.enableAttributes(ph,g),Zs&&Zs.enableAttributes(ph,g),A.bind(),A.setVertexAttribPointers(ph,g,Ft);for(const Dh of q)Dh.bind(),Dh.setVertexAttribPointers(ph,g,Ft);Xr&&(Xr.bind(),Xr.setVertexAttribPointers(ph,g,Ft)),nt&&nt.bind(),ls&&(ls.bind(),ls.setVertexAttribPointers(ph,g,Ft)),Zs&&(Zs.bind(),Zs.setVertexAttribPointers(ph,g,Ft)),th.currentNumAttributes=rh}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ap(he){const g=[];for(let A=0;A<he.length;A++){if(he[A]===null)continue;const q=he[A].split(" ");g.push(q.pop())}return g}class lp{constructor(g,A,q,nt,Ft,Xr,ls){const Zs=g.gl;this.program=Zs.createProgram();const ol=ap(q.staticAttributes),rh=nt?nt.getBinderAttributes():[],th=ol.concat(rh),ph=Gf.prelude.staticUniforms?ap(Gf.prelude.staticUniforms):[],Dh=q.staticUniforms?ap(q.staticUniforms):[],$h=nt?nt.getBinderUniforms():[],Mh=ph.concat(Dh).concat($h),Kh=[];for(const Mf of Mh)Kh.indexOf(Mf)<0&&Kh.push(Mf);const fd=nt?nt.defines():[];Xr&&fd.push("#define OVERDRAW_INSPECTOR;"),ls&&fd.push("#define TERRAIN3D;");const cd=fd.concat(Gf.prelude.fragmentSource,q.fragmentSource).join(`
`),jh=fd.concat(Gf.prelude.vertexSource,q.vertexSource).join(`
`),Td=Zs.createShader(Zs.FRAGMENT_SHADER);if(Zs.isContextLost())return void(this.failedToCreate=!0);Zs.shaderSource(Td,cd),Zs.compileShader(Td),Zs.attachShader(this.program,Td);const Vd=Zs.createShader(Zs.VERTEX_SHADER);if(Zs.isContextLost())return void(this.failedToCreate=!0);Zs.shaderSource(Vd,jh),Zs.compileShader(Vd),Zs.attachShader(this.program,Vd),this.attributes={};const Wd={};this.numAttributes=th.length;for(let Mf=0;Mf<this.numAttributes;Mf++)th[Mf]&&(Zs.bindAttribLocation(this.program,Mf,th[Mf]),this.attributes[th[Mf]]=Mf);Zs.linkProgram(this.program),Zs.deleteShader(Vd),Zs.deleteShader(Td);for(let Mf=0;Mf<Kh.length;Mf++){const Of=Kh[Mf];if(Of&&!Wd[Of]){const L=Zs.getUniformLocation(this.program,Of);L&&(Wd[Of]=L)}}this.fixedUniforms=Ft(g,Wd),this.terrainUniforms=((Mf,Of)=>({u_depth:new o.Uniform1i(Mf,Of.u_depth),u_terrain:new o.Uniform1i(Mf,Of.u_terrain),u_terrain_dim:new o.Uniform1f(Mf,Of.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(Mf,Of.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(Mf,Of.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(Mf,Of.u_terrain_exaggeration)}))(g,Wd),this.binderUniforms=nt?nt.getUniforms(g,Wd):[]}draw(g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th,ph,Dh,$h,Mh,Kh,fd,cd){const jh=g.gl;if(this.failedToCreate)return;if(g.program.set(this.program),g.setDepthMode(q),g.setStencilMode(nt),g.setColorMode(Ft),g.setCullFace(Xr),Zs){g.activeTexture.set(jh.TEXTURE2),jh.bindTexture(jh.TEXTURE_2D,Zs.depthTexture),g.activeTexture.set(jh.TEXTURE3),jh.bindTexture(jh.TEXTURE_2D,Zs.texture);for(const Vd in this.terrainUniforms)this.terrainUniforms[Vd].set(Zs[Vd])}for(const Vd in this.fixedUniforms)this.fixedUniforms[Vd].set(ls[Vd]);Mh&&Mh.setUniforms(g,this.binderUniforms,Dh,{zoom:$h});let Td=0;switch(A){case jh.LINES:Td=2;break;case jh.TRIANGLES:Td=3;break;case jh.LINE_STRIP:Td=1}for(const Vd of ph.get()){const Wd=Vd.vaos||(Vd.vaos={});(Wd[ol]||(Wd[ol]=new _p)).bind(g,this,rh,Mh?Mh.getPaintVertexBuffers():[],th,Vd.vertexOffset,Kh,fd,cd),jh.drawElements(A,Vd.primitiveLength*Td,jh.UNSIGNED_SHORT,Vd.primitiveOffset*Td*2)}}}function Zp(he,g,A){const q=1/zh(A,1,g.transform.tileZoom),nt=Math.pow(2,A.tileID.overscaledZ),Ft=A.tileSize*Math.pow(2,g.transform.tileZoom)/nt,Xr=Ft*(A.tileID.canonical.x+A.tileID.wrap*nt),ls=Ft*A.tileID.canonical.y;return{u_image:0,u_texsize:A.imageAtlasTexture.size,u_scale:[q,he.fromScale,he.toScale],u_fade:he.t,u_pixel_coord_upper:[Xr>>16,ls>>16],u_pixel_coord_lower:[65535&Xr,65535&ls]}}const Rm=(he,g,A,q)=>{const nt=g.style.light,Ft=nt.properties.get("position"),Xr=[Ft.x,Ft.y,Ft.z],ls=function(){var ol=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(ol[1]=0,ol[2]=0,ol[3]=0,ol[5]=0,ol[6]=0,ol[7]=0),ol[0]=1,ol[4]=1,ol[8]=1,ol}();nt.properties.get("anchor")==="viewport"&&function(ol,rh){var th=Math.sin(rh),ph=Math.cos(rh);ol[0]=ph,ol[1]=th,ol[2]=0,ol[3]=-th,ol[4]=ph,ol[5]=0,ol[6]=0,ol[7]=0,ol[8]=1}(ls,-g.transform.angle),function(ol,rh,th){var ph=rh[0],Dh=rh[1],$h=rh[2];ol[0]=ph*th[0]+Dh*th[3]+$h*th[6],ol[1]=ph*th[1]+Dh*th[4]+$h*th[7],ol[2]=ph*th[2]+Dh*th[5]+$h*th[8]}(Xr,Xr,ls);const Zs=nt.properties.get("color");return{u_matrix:he,u_lightpos:Xr,u_lightintensity:nt.properties.get("intensity"),u_lightcolor:[Zs.r,Zs.g,Zs.b],u_vertical_gradient:+A,u_opacity:q}},Yp=(he,g,A,q,nt,Ft,Xr)=>o.extend(Rm(he,g,A,q),Zp(Ft,g,Xr),{u_height_factor:-Math.pow(2,nt.overscaledZ)/Xr.tileSize/8}),Pm=he=>({u_matrix:he}),kf=(he,g,A,q)=>o.extend(Pm(he),Zp(A,g,q)),Tp=(he,g)=>({u_matrix:he,u_world:g}),Np=(he,g,A,q,nt)=>o.extend(kf(he,g,A,q),{u_world:nt}),Jm=(he,g,A,q)=>{const nt=he.transform;let Ft,Xr;if(q.paint.get("circle-pitch-alignment")==="map"){const ls=zh(A,1,nt.zoom);Ft=!0,Xr=[ls,ls]}else Ft=!1,Xr=nt.pixelsToGLUnits;return{u_camera_to_center_distance:nt.cameraToCenterDistance,u_scale_with_map:+(q.paint.get("circle-pitch-scale")==="map"),u_matrix:he.translatePosMatrix(g.posMatrix,A,q.paint.get("circle-translate"),q.paint.get("circle-translate-anchor")),u_pitch_with_map:+Ft,u_device_pixel_ratio:he.pixelRatio,u_extrude_scale:Xr}},Um=(he,g,A)=>{const q=zh(A,1,g.zoom),nt=Math.pow(2,g.zoom-A.tileID.overscaledZ),Ft=A.tileID.overscaleFactor();return{u_matrix:he,u_camera_to_center_distance:g.cameraToCenterDistance,u_pixels_to_tile_units:q,u_extrude_scale:[g.pixelsToGLUnits[0]/(q*nt),g.pixelsToGLUnits[1]/(q*nt)],u_overscale_factor:Ft}},bg=(he,g,A=1)=>({u_matrix:he,u_color:g,u_overlay:0,u_overlay_scale:A}),kg=he=>({u_matrix:he}),$m=(he,g,A,q)=>({u_matrix:he,u_extrude_scale:zh(g,1,A),u_intensity:q});function fy(he,g){const A=Math.pow(2,g.canonical.z),q=g.canonical.y;return[new o.MercatorCoordinate(0,q/A).toLngLat().lat,new o.MercatorCoordinate(0,(q+1)/A).toLngLat().lat]}const Km=(he,g,A,q)=>{const nt=he.transform;return{u_matrix:u_(he,g,A,q),u_ratio:1/zh(g,1,nt.zoom),u_device_pixel_ratio:he.pixelRatio,u_units_to_pixels:[1/nt.pixelsToGLUnits[0],1/nt.pixelsToGLUnits[1]]}},Xg=(he,g,A,q,nt)=>o.extend(Km(he,g,A,nt),{u_image:0,u_image_height:q}),Ly=(he,g,A,q,nt)=>{const Ft=he.transform,Xr=wg(g,Ft);return{u_matrix:u_(he,g,A,nt),u_texsize:g.imageAtlasTexture.size,u_ratio:1/zh(g,1,Ft.zoom),u_device_pixel_ratio:he.pixelRatio,u_image:0,u_scale:[Xr,q.fromScale,q.toScale],u_fade:q.t,u_units_to_pixels:[1/Ft.pixelsToGLUnits[0],1/Ft.pixelsToGLUnits[1]]}},Ry=(he,g,A,q,nt,Ft)=>{const Xr=he.lineAtlas,ls=wg(g,he.transform),Zs=A.layout.get("line-cap")==="round",ol=Xr.getDash(q.from,Zs),rh=Xr.getDash(q.to,Zs),th=ol.width*nt.fromScale,ph=rh.width*nt.toScale;return o.extend(Km(he,g,A,Ft),{u_patternscale_a:[ls/th,-ol.height/2],u_patternscale_b:[ls/ph,-rh.height/2],u_sdfgamma:Xr.width/(256*Math.min(th,ph)*he.pixelRatio)/2,u_image:0,u_tex_y_a:ol.y,u_tex_y_b:rh.y,u_mix:nt.t})};function wg(he,g){return 1/zh(he,1,g.tileZoom)}function u_(he,g,A,q){return he.translatePosMatrix(q?q.posMatrix:g.tileID.posMatrix,g,A.paint.get("line-translate"),A.paint.get("line-translate-anchor"))}const Oy=(he,g,A,q,nt)=>{return{u_matrix:he,u_tl_parent:g,u_scale_parent:A,u_buffer_scale:1,u_fade_t:q.mix,u_opacity:q.opacity*nt.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:nt.paint.get("raster-brightness-min"),u_brightness_high:nt.paint.get("raster-brightness-max"),u_saturation_factor:(Xr=nt.paint.get("raster-saturation"),Xr>0?1-1/(1.001-Xr):-Xr),u_contrast_factor:(Ft=nt.paint.get("raster-contrast"),Ft>0?1/(1-Ft):1+Ft),u_spin_weights:V_(nt.paint.get("raster-hue-rotate"))};var Ft,Xr};function V_(he){he*=Math.PI/180;const g=Math.sin(he),A=Math.cos(he);return[(2*A+1)/3,(-Math.sqrt(3)*g-A+1)/3,(Math.sqrt(3)*g-A+1)/3]}const n0=(he,g,A,q,nt,Ft,Xr,ls,Zs,ol)=>{const rh=nt.transform;return{u_is_size_zoom_constant:+(he==="constant"||he==="source"),u_is_size_feature_constant:+(he==="constant"||he==="camera"),u_size_t:g?g.uSizeT:0,u_size:g?g.uSize:0,u_camera_to_center_distance:rh.cameraToCenterDistance,u_pitch:rh.pitch/360*2*Math.PI,u_rotate_symbol:+A,u_aspect_ratio:rh.width/rh.height,u_fade_change:nt.options.fadeDuration?nt.symbolFadeChange:1,u_matrix:Ft,u_label_plane_matrix:Xr,u_coord_matrix:ls,u_is_text:+Zs,u_pitch_with_map:+q,u_texsize:ol,u_texture:0}},O0=(he,g,A,q,nt,Ft,Xr,ls,Zs,ol,rh)=>{const th=nt.transform;return o.extend(n0(he,g,A,q,nt,Ft,Xr,ls,Zs,ol),{u_gamma_scale:q?Math.cos(th._pitch)*th.cameraToCenterDistance:1,u_device_pixel_ratio:nt.pixelRatio,u_is_halo:+rh})},l1=(he,g,A,q,nt,Ft,Xr,ls,Zs,ol)=>o.extend(O0(he,g,A,q,nt,Ft,Xr,ls,!0,Zs,!0),{u_texsize_icon:ol,u_texture_icon:1}),tv=(he,g,A)=>({u_matrix:he,u_opacity:g,u_color:A}),oy=(he,g,A,q,nt,Ft)=>o.extend(function(Xr,ls,Zs,ol){const rh=Zs.imageManager.getPattern(Xr.from.toString()),th=Zs.imageManager.getPattern(Xr.to.toString()),{width:ph,height:Dh}=Zs.imageManager.getPixelSize(),$h=Math.pow(2,ol.tileID.overscaledZ),Mh=ol.tileSize*Math.pow(2,Zs.transform.tileZoom)/$h,Kh=Mh*(ol.tileID.canonical.x+ol.tileID.wrap*$h),fd=Mh*ol.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:rh.tl,u_pattern_br_a:rh.br,u_pattern_tl_b:th.tl,u_pattern_br_b:th.br,u_texsize:[ph,Dh],u_mix:ls.t,u_pattern_size_a:rh.displaySize,u_pattern_size_b:th.displaySize,u_scale_a:ls.fromScale,u_scale_b:ls.toScale,u_tile_units_to_pixels:1/zh(ol,1,Zs.transform.tileZoom),u_pixel_coord_upper:[Kh>>16,fd>>16],u_pixel_coord_lower:[65535&Kh,65535&fd]}}(q,Ft,A,nt),{u_matrix:he,u_opacity:g}),o0={fillExtrusion:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_lightpos:new o.Uniform3f(he,g.u_lightpos),u_lightintensity:new o.Uniform1f(he,g.u_lightintensity),u_lightcolor:new o.Uniform3f(he,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(he,g.u_vertical_gradient),u_opacity:new o.Uniform1f(he,g.u_opacity)}),fillExtrusionPattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_lightpos:new o.Uniform3f(he,g.u_lightpos),u_lightintensity:new o.Uniform1f(he,g.u_lightintensity),u_lightcolor:new o.Uniform3f(he,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(he,g.u_vertical_gradient),u_height_factor:new o.Uniform1f(he,g.u_height_factor),u_image:new o.Uniform1i(he,g.u_image),u_texsize:new o.Uniform2f(he,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade),u_opacity:new o.Uniform1f(he,g.u_opacity)}),fill:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),fillPattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_image:new o.Uniform1i(he,g.u_image),u_texsize:new o.Uniform2f(he,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade)}),fillOutline:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_world:new o.Uniform2f(he,g.u_world)}),fillOutlinePattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_world:new o.Uniform2f(he,g.u_world),u_image:new o.Uniform1i(he,g.u_image),u_texsize:new o.Uniform2f(he,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade)}),circle:(he,g)=>({u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(he,g.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(he,g.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),collisionBox:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(he,g.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(he,g.u_extrude_scale),u_overscale_factor:new o.Uniform1f(he,g.u_overscale_factor)}),collisionCircle:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_inv_matrix:new o.UniformMatrix4f(he,g.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(he,g.u_viewport_size)}),debug:(he,g)=>({u_color:new o.UniformColor(he,g.u_color),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_overlay:new o.Uniform1i(he,g.u_overlay),u_overlay_scale:new o.Uniform1f(he,g.u_overlay_scale)}),clippingMask:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),heatmap:(he,g)=>({u_extrude_scale:new o.Uniform1f(he,g.u_extrude_scale),u_intensity:new o.Uniform1f(he,g.u_intensity),u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),heatmapTexture:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_world:new o.Uniform2f(he,g.u_world),u_image:new o.Uniform1i(he,g.u_image),u_color_ramp:new o.Uniform1i(he,g.u_color_ramp),u_opacity:new o.Uniform1f(he,g.u_opacity)}),hillshade:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_image:new o.Uniform1i(he,g.u_image),u_latrange:new o.Uniform2f(he,g.u_latrange),u_light:new o.Uniform2f(he,g.u_light),u_shadow:new o.UniformColor(he,g.u_shadow),u_highlight:new o.UniformColor(he,g.u_highlight),u_accent:new o.UniformColor(he,g.u_accent)}),hillshadePrepare:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_image:new o.Uniform1i(he,g.u_image),u_dimension:new o.Uniform2f(he,g.u_dimension),u_zoom:new o.Uniform1f(he,g.u_zoom),u_unpack:new o.Uniform4f(he,g.u_unpack)}),line:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels)}),lineGradient:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels),u_image:new o.Uniform1i(he,g.u_image),u_image_height:new o.Uniform1f(he,g.u_image_height)}),linePattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_texsize:new o.Uniform2f(he,g.u_texsize),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_image:new o.Uniform1i(he,g.u_image),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade)}),lineSDF:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(he,g.u_patternscale_a),u_patternscale_b:new o.Uniform2f(he,g.u_patternscale_b),u_sdfgamma:new o.Uniform1f(he,g.u_sdfgamma),u_image:new o.Uniform1i(he,g.u_image),u_tex_y_a:new o.Uniform1f(he,g.u_tex_y_a),u_tex_y_b:new o.Uniform1f(he,g.u_tex_y_b),u_mix:new o.Uniform1f(he,g.u_mix)}),raster:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_tl_parent:new o.Uniform2f(he,g.u_tl_parent),u_scale_parent:new o.Uniform1f(he,g.u_scale_parent),u_buffer_scale:new o.Uniform1f(he,g.u_buffer_scale),u_fade_t:new o.Uniform1f(he,g.u_fade_t),u_opacity:new o.Uniform1f(he,g.u_opacity),u_image0:new o.Uniform1i(he,g.u_image0),u_image1:new o.Uniform1i(he,g.u_image1),u_brightness_low:new o.Uniform1f(he,g.u_brightness_low),u_brightness_high:new o.Uniform1f(he,g.u_brightness_high),u_saturation_factor:new o.Uniform1f(he,g.u_saturation_factor),u_contrast_factor:new o.Uniform1f(he,g.u_contrast_factor),u_spin_weights:new o.Uniform3f(he,g.u_spin_weights)}),symbolIcon:(he,g)=>({u_is_size_zoom_constant:new o.Uniform1i(he,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(he,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(he,g.u_size_t),u_size:new o.Uniform1f(he,g.u_size),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(he,g.u_pitch),u_rotate_symbol:new o.Uniform1i(he,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(he,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(he,g.u_fade_change),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(he,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(he,g.u_coord_matrix),u_is_text:new o.Uniform1i(he,g.u_is_text),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_texsize:new o.Uniform2f(he,g.u_texsize),u_texture:new o.Uniform1i(he,g.u_texture)}),symbolSDF:(he,g)=>({u_is_size_zoom_constant:new o.Uniform1i(he,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(he,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(he,g.u_size_t),u_size:new o.Uniform1f(he,g.u_size),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(he,g.u_pitch),u_rotate_symbol:new o.Uniform1i(he,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(he,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(he,g.u_fade_change),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(he,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(he,g.u_coord_matrix),u_is_text:new o.Uniform1i(he,g.u_is_text),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_texsize:new o.Uniform2f(he,g.u_texsize),u_texture:new o.Uniform1i(he,g.u_texture),u_gamma_scale:new o.Uniform1f(he,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(he,g.u_is_halo)}),symbolTextAndIcon:(he,g)=>({u_is_size_zoom_constant:new o.Uniform1i(he,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(he,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(he,g.u_size_t),u_size:new o.Uniform1f(he,g.u_size),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(he,g.u_pitch),u_rotate_symbol:new o.Uniform1i(he,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(he,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(he,g.u_fade_change),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(he,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(he,g.u_coord_matrix),u_is_text:new o.Uniform1i(he,g.u_is_text),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_texsize:new o.Uniform2f(he,g.u_texsize),u_texsize_icon:new o.Uniform2f(he,g.u_texsize_icon),u_texture:new o.Uniform1i(he,g.u_texture),u_texture_icon:new o.Uniform1i(he,g.u_texture_icon),u_gamma_scale:new o.Uniform1f(he,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(he,g.u_is_halo)}),background:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_opacity:new o.Uniform1f(he,g.u_opacity),u_color:new o.UniformColor(he,g.u_color)}),backgroundPattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_opacity:new o.Uniform1f(he,g.u_opacity),u_image:new o.Uniform1i(he,g.u_image),u_pattern_tl_a:new o.Uniform2f(he,g.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(he,g.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(he,g.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(he,g.u_pattern_br_b),u_texsize:new o.Uniform2f(he,g.u_texsize),u_mix:new o.Uniform1f(he,g.u_mix),u_pattern_size_a:new o.Uniform2f(he,g.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(he,g.u_pattern_size_b),u_scale_a:new o.Uniform1f(he,g.u_scale_a),u_scale_b:new o.Uniform1f(he,g.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(he,g.u_tile_units_to_pixels)}),terrain:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_texture:new o.Uniform1i(he,g.u_texture),u_ele_delta:new o.Uniform1f(he,g.u_ele_delta)}),terrainDepth:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ele_delta:new o.Uniform1f(he,g.u_ele_delta)}),terrainCoords:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_texture:new o.Uniform1i(he,g.u_texture),u_terrain_coords_id:new o.Uniform1f(he,g.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(he,g.u_ele_delta)})};class $y{constructor(g,A,q){this.context=g;const nt=g.gl;this.buffer=nt.createBuffer(),this.dynamicDraw=!!q,this.context.unbindVAO(),g.bindElementBuffer.set(this.buffer),nt.bufferData(nt.ELEMENT_ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?nt.DYNAMIC_DRAW:nt.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(g){const A=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),A.bufferSubData(A.ELEMENT_ARRAY_BUFFER,0,g.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const py={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vg{constructor(g,A,q,nt){this.length=A.length,this.attributes=q,this.itemSize=A.bytesPerElement,this.dynamicDraw=nt,this.context=g;const Ft=g.gl;this.buffer=Ft.createBuffer(),g.bindVertexBuffer.set(this.buffer),Ft.bufferData(Ft.ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?Ft.DYNAMIC_DRAW:Ft.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(g){if(g.length!==this.length)throw new Error(`Length of new data is ${g.length}, which doesn't match current length of ${this.length}`);const A=this.context.gl;this.bind(),A.bufferSubData(A.ARRAY_BUFFER,0,g.arrayBuffer)}enableAttributes(g,A){for(let q=0;q<this.attributes.length;q++){const nt=A.attributes[this.attributes[q].name];nt!==void 0&&g.enableVertexAttribArray(nt)}}setVertexAttribPointers(g,A,q){for(let nt=0;nt<this.attributes.length;nt++){const Ft=this.attributes[nt],Xr=A.attributes[Ft.name];Xr!==void 0&&g.vertexAttribPointer(Xr,Ft.components,g[py[Ft.type]],!1,this.itemSize,Ft.offset+this.itemSize*(q||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fm{constructor(g){this.gl=g.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(g){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class G_ extends fm{getDefault(){return o.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class eg extends fm{getDefault(){return 1}set(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)}}class h_ extends fm{getDefault(){return 0}set(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)}}class iv extends fm{getDefault(){return[!0,!0,!0,!0]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class By extends fm{getDefault(){return!0}set(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)}}class j_ extends fm{getDefault(){return 255}set(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)}}class a0 extends fm{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(g){const A=this.current;(g.func!==A.func||g.ref!==A.ref||g.mask!==A.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)}}class s0 extends fm{getDefault(){const g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)}}class wm extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST),this.current=g,this.dirty=!1}}class ay extends fm{getDefault(){return[0,1]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)}}class my extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST),this.current=g,this.dirty=!1}}class l0 extends fm{getDefault(){return this.gl.LESS}set(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)}}class gy extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.BLEND):A.disable(A.BLEND),this.current=g,this.dirty=!1}}class vv extends fm{getDefault(){const g=this.gl;return[g.ONE,g.ZERO]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)}}class sy extends fm{getDefault(){return o.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class cm extends fm{getDefault(){return this.gl.FUNC_ADD}set(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)}}class Ny extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE),this.current=g,this.dirty=!1}}class zy extends fm{getDefault(){return this.gl.BACK}set(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)}}class q_ extends fm{getDefault(){return this.gl.CCW}set(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)}}class d_ extends fm{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}}class c0 extends fm{getDefault(){return this.gl.TEXTURE0}set(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)}}class u0 extends fm{getDefault(){const g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class rv extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindFramebuffer(A.FRAMEBUFFER,g),this.current=g,this.dirty=!1}}class Fy extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindRenderbuffer(A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class h0 extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindTexture(A.TEXTURE_2D,g),this.current=g,this.dirty=!1}}class Eg extends fm{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindBuffer(A.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class Z_ extends fm{getDefault(){return null}set(g){const A=this.gl;A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class f_ extends fm{constructor(g){super(g),this.vao=g.extVertexArrayObject}getDefault(){return null}set(g){this.vao&&(g!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(g),this.current=g,this.dirty=!1)}}class p_ extends fm{getDefault(){return 4}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}}class Kp extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}}class C_ extends fm{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}}class m_ extends fm{constructor(g,A){super(g),this.context=g,this.parent=A}getDefault(){return null}}class Nv extends m_{setDirty(){this.dirty=!0}set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}}class _y extends m_{set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class Uy{constructor(g,A,q,nt){this.context=g,this.width=A,this.height=q;const Ft=g.gl,Xr=this.framebuffer=Ft.createFramebuffer();if(this.colorAttachment=new Nv(g,Xr),nt&&(this.depthAttachment=new _y(g,Xr)),Ft.checkFramebufferStatus(Ft.FRAMEBUFFER)!==Ft.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const g=this.context.gl,A=this.colorAttachment.get();if(A&&g.deleteTexture(A),this.depthAttachment){const q=this.depthAttachment.get();q&&g.deleteRenderbuffer(q)}g.deleteFramebuffer(this.framebuffer)}}class Xm{constructor(g,A,q){this.blendFunction=g,this.blendColor=A,this.mask=q}}Xm.Replace=[1,0],Xm.disabled=new Xm(Xm.Replace,o.Color.transparent,[!1,!1,!1,!1]),Xm.unblended=new Xm(Xm.Replace,o.Color.transparent,[!0,!0,!0,!0]),Xm.alphaBlended=new Xm([1,771],o.Color.transparent,[!0,!0,!0,!0]);class d0{constructor(g){this.gl=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G_(this),this.clearDepth=new eg(this),this.clearStencil=new h_(this),this.colorMask=new iv(this),this.depthMask=new By(this),this.stencilMask=new j_(this),this.stencilFunc=new a0(this),this.stencilOp=new s0(this),this.stencilTest=new wm(this),this.depthRange=new ay(this),this.depthTest=new my(this),this.depthFunc=new l0(this),this.blend=new gy(this),this.blendFunc=new vv(this),this.blendColor=new sy(this),this.blendEquation=new cm(this),this.cullFace=new Ny(this),this.cullFaceSide=new zy(this),this.frontFace=new q_(this),this.program=new d_(this),this.activeTexture=new c0(this),this.viewport=new u0(this),this.bindFramebuffer=new rv(this),this.bindRenderbuffer=new Fy(this),this.bindTexture=new h0(this),this.bindVertexBuffer=new Eg(this),this.bindElementBuffer=new Z_(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new f_(this),this.pixelStoreUnpack=new p_(this),this.pixelStoreUnpackPremultiplyAlpha=new Kp(this),this.pixelStoreUnpackFlipY=new C_(this),this.extTextureFilterAnisotropic=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=g.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=g.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(g.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=g.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=g.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=g.getParameter(g.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(g,A){return new $y(this,g,A)}createVertexBuffer(g,A,q){return new Vg(this,g,A,q)}createRenderbuffer(g,A,q){const nt=this.gl,Ft=nt.createRenderbuffer();return this.bindRenderbuffer.set(Ft),nt.renderbufferStorage(nt.RENDERBUFFER,g,A,q),this.bindRenderbuffer.set(null),Ft}createFramebuffer(g,A,q){return new Uy(this,g,A,q)}clear({color:g,depth:A}){const q=this.gl;let nt=0;g&&(nt|=q.COLOR_BUFFER_BIT,this.clearColor.set(g),this.colorMask.set([!0,!0,!0,!0])),A!==void 0&&(nt|=q.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(A),this.depthMask.set(!0)),q.clear(nt)}setCullFace(g){g.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(g.mode),this.frontFace.set(g.frontFace))}setDepthMode(g){g.func!==this.gl.ALWAYS||g.mask?(this.depthTest.set(!0),this.depthFunc.set(g.func),this.depthMask.set(g.mask),this.depthRange.set(g.range)):this.depthTest.set(!1)}setStencilMode(g){g.test.func!==this.gl.ALWAYS||g.mask?(this.stencilTest.set(!0),this.stencilMask.set(g.mask),this.stencilOp.set([g.fail,g.depthFail,g.pass]),this.stencilFunc.set({func:g.test.func,ref:g.ref,mask:g.test.mask})):this.stencilTest.set(!1)}setColorMode(g){ze(g.blendFunction,Xm.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(g.blendFunction),this.blendColor.set(g.blendColor)),this.colorMask.set(g.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class um{constructor(g,A,q){this.func=g,this.mask=A,this.range=q}}um.ReadOnly=!1,um.ReadWrite=!0,um.disabled=new um(519,um.ReadOnly,[0,1]);const Vy=7680;class Bm{constructor(g,A,q,nt,Ft,Xr){this.test=g,this.ref=A,this.mask=q,this.fail=nt,this.depthFail=Ft,this.pass=Xr}}Bm.disabled=new Bm({func:519,mask:0},0,0,Vy,Vy,Vy);class Im{constructor(g,A,q){this.enable=g,this.mode=A,this.frontFace=q}}let g_;function ly(he,g,A,q,nt,Ft,Xr){const ls=he.context,Zs=ls.gl,ol=he.useProgram("collisionBox"),rh=[];let th=0,ph=0;for(let jh=0;jh<q.length;jh++){const Td=q[jh],Vd=g.getTile(Td),Wd=Vd.getBucket(A);if(!Wd)continue;let Mf=Td.posMatrix;nt[0]===0&&nt[1]===0||(Mf=he.translatePosMatrix(Td.posMatrix,Vd,nt,Ft));const Of=Xr?Wd.textCollisionBox:Wd.iconCollisionBox,L=Wd.collisionCircleArray;if(L.length>0){const u=o.create(),E=Mf;o.mul(u,Wd.placementInvProjMatrix,he.transform.glCoordMatrix),o.mul(u,u,Wd.placementViewportMatrix),rh.push({circleArray:L,circleOffset:ph,transform:E,invTransform:u,coord:Td}),th+=L.length/4,ph=th}Of&&ol.draw(ls,Zs.LINES,um.disabled,Bm.disabled,he.colorModeForRenderPass(),Im.disabled,Um(Mf,he.transform,Vd),he.style.map.terrain&&he.style.map.terrain.getTerrainData(Td),A.id,Of.layoutVertexBuffer,Of.indexBuffer,Of.segments,null,he.transform.zoom,null,null,Of.collisionVertexBuffer)}if(!Xr||!rh.length)return;const Dh=he.useProgram("collisionCircle"),$h=new o.CollisionCircleLayoutArray;$h.resize(4*th),$h._trim();let Mh=0;for(const jh of rh)for(let Td=0;Td<jh.circleArray.length/4;Td++){const Vd=4*Td,Wd=jh.circleArray[Vd+0],Mf=jh.circleArray[Vd+1],Of=jh.circleArray[Vd+2],L=jh.circleArray[Vd+3];$h.emplace(Mh++,Wd,Mf,Of,L,0),$h.emplace(Mh++,Wd,Mf,Of,L,1),$h.emplace(Mh++,Wd,Mf,Of,L,2),$h.emplace(Mh++,Wd,Mf,Of,L,3)}(!g_||g_.length<2*th)&&(g_=function(jh){const Td=2*jh,Vd=new o.QuadTriangleArray;Vd.resize(Td),Vd._trim();for(let Wd=0;Wd<Td;Wd++){const Mf=6*Wd;Vd.uint16[Mf+0]=4*Wd+0,Vd.uint16[Mf+1]=4*Wd+1,Vd.uint16[Mf+2]=4*Wd+2,Vd.uint16[Mf+3]=4*Wd+2,Vd.uint16[Mf+4]=4*Wd+3,Vd.uint16[Mf+5]=4*Wd+0}return Vd}(th));const Kh=ls.createIndexBuffer(g_,!0),fd=ls.createVertexBuffer($h,o.collisionCircleLayout.members,!0);for(const jh of rh){const Td={u_matrix:jh.transform,u_inv_matrix:jh.invTransform,u_camera_to_center_distance:(cd=he.transform).cameraToCenterDistance,u_viewport_size:[cd.width,cd.height]};Dh.draw(ls,Zs.TRIANGLES,um.disabled,Bm.disabled,he.colorModeForRenderPass(),Im.disabled,Td,he.style.map.terrain&&he.style.map.terrain.getTerrainData(jh.coord),A.id,fd,Kh,o.SegmentVector.simpleSegment(0,2*jh.circleOffset,jh.circleArray.length,jh.circleArray.length/2),null,he.transform.zoom,null,null,null)}var cd;fd.destroy(),Kh.destroy()}Im.disabled=new Im(!1,1029,2305),Im.backCCW=new Im(!0,1029,2305);const xv=o.identity(new Float32Array(16));function cy(he,g,A,q,nt,Ft){const{horizontalAlign:Xr,verticalAlign:ls}=o.getAnchorAlignment(he),Zs=-(Xr-.5)*g,ol=-(ls-.5)*A,rh=o.evaluateVariableOffset(he,q);return new o.pointGeometry((Zs/nt+rh[0])*Ft,(ol/nt+rh[1])*Ft)}function f0(he,g,A,q,nt,Ft,Xr,ls,Zs,ol,rh){const th=he.text.placedSymbolArray,ph=he.text.dynamicLayoutVertexArray,Dh=he.icon.dynamicLayoutVertexArray,$h={};ph.clear();for(let Mh=0;Mh<th.length;Mh++){const Kh=th.get(Mh),fd=Kh.hidden||!Kh.crossTileID||he.allowVerticalPlacement&&!Kh.placedOrientation?null:q[Kh.crossTileID];if(fd){const cd=new o.pointGeometry(Kh.anchorX,Kh.anchorY),jh=mh(cd,A?Xr:Ft,rh),Td=Jh(nt.cameraToCenterDistance,jh.signedDistanceFromCamera);let Vd=o.evaluateSizeForFeature(he.textSizeData,Zs,Kh)*Td/o.ONE_EM;A&&(Vd*=he.tilePixelRatio/ls);const{width:Wd,height:Mf,anchor:Of,textOffset:L,textBoxScale:u}=fd,E=cy(Of,Wd,Mf,L,u,Vd),B=A?mh(cd.add(E),Ft,rh).point:jh.point.add(g?E.rotate(-nt.angle):E),_e=he.allowVerticalPlacement&&Kh.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let St=0;St<Kh.numGlyphs;St++)o.addDynamicAttributes(ph,B,_e);ol&&Kh.associatedIconIndex>=0&&($h[Kh.associatedIconIndex]={shiftedAnchor:B,angle:_e})}else uh(Kh.numGlyphs,ph)}if(ol){Dh.clear();const Mh=he.icon.placedSymbolArray;for(let Kh=0;Kh<Mh.length;Kh++){const fd=Mh.get(Kh);if(fd.hidden)uh(fd.numGlyphs,Dh);else{const cd=$h[Kh];if(cd)for(let jh=0;jh<fd.numGlyphs;jh++)o.addDynamicAttributes(Dh,cd.shiftedAnchor,cd.angle);else uh(fd.numGlyphs,Dh)}}he.icon.dynamicLayoutVertexBuffer.updateData(Dh)}he.text.dynamicLayoutVertexBuffer.updateData(ph)}function __(he,g,A){return A.iconsInText&&g?"symbolTextAndIcon":he?"symbolSDF":"symbolIcon"}function H_(he,g,A,q,nt,Ft,Xr,ls,Zs,ol,rh,th){const ph=he.context,Dh=ph.gl,$h=he.transform,Mh=ls==="map",Kh=Zs==="map",fd=ls!=="viewport"&&A.layout.get("symbol-placement")!=="point",cd=Mh&&!Kh&&!fd,jh=!A.layout.get("symbol-sort-key").isConstant();let Td=!1;const Vd=he.depthModeForSublayer(0,um.ReadOnly),Wd=A.layout.get("text-variable-anchor"),Mf=[];for(const Of of q){const L=g.getTile(Of),u=L.getBucket(A);if(!u)continue;const E=nt?u.text:u.icon;if(!E||!E.segments.get().length||!E.hasVisibleVertices)continue;const B=E.programConfigurations.get(A.id),_e=nt||u.sdfIcons,St=nt?u.textSizeData:u.iconSizeData,mr=Kh||$h.pitch!==0,qr=he.useProgram(__(_e,nt,u),B),ss=o.evaluateSizeForZoom(St,$h.zoom),tl=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Of);let il,Qu,fh,wh,Sh=[0,0],Th=null;if(nt)Qu=L.glyphAtlasTexture,fh=Dh.LINEAR,il=L.glyphAtlasTexture.size,u.iconsInText&&(Sh=L.imageAtlasTexture.size,Th=L.imageAtlasTexture,wh=mr||he.options.rotating||he.options.zooming||St.kind==="composite"||St.kind==="camera"?Dh.LINEAR:Dh.NEAREST);else{const Vf=A.layout.get("icon-size").constantOr(0)!==1||u.iconsNeedLinear;Qu=L.imageAtlasTexture,fh=_e||he.options.rotating||he.options.zooming||Vf||mr?Dh.LINEAR:Dh.NEAREST,il=L.imageAtlasTexture.size}const Ch=zh(L,1,he.transform.zoom),hh=Dd(Of.posMatrix,Kh,Mh,he.transform,Ch),Oh=Hf(Of.posMatrix,Kh,Mh,he.transform,Ch),Rh=Wd&&u.hasTextData(),Nh=A.layout.get("icon-text-fit")!=="none"&&Rh&&u.hasIconData();if(fd){const Vf=he.style.map.terrain?(Cf,Ud)=>he.style.map.terrain.getElevation(Of,Cf,Ud):null,_d=A.layout.get("text-rotation-alignment")==="map";sl(u,Of.posMatrix,he,nt,hh,Oh,Kh,ol,_d,Vf)}const qh=he.translatePosMatrix(Of.posMatrix,L,Ft,Xr),Fh=fd||nt&&Wd||Nh?xv:hh,Hh=he.translatePosMatrix(Oh,L,Ft,Xr,!0),ld=_e&&A.paint.get(nt?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xd;xd=_e?u.iconsInText?l1(St.kind,ss,cd,Kh,he,qh,Fh,Hh,il,Sh):O0(St.kind,ss,cd,Kh,he,qh,Fh,Hh,nt,il,!0):n0(St.kind,ss,cd,Kh,he,qh,Fh,Hh,nt,il);const gd={program:qr,buffers:E,uniformValues:xd,atlasTexture:Qu,atlasTextureIcon:Th,atlasInterpolation:fh,atlasInterpolationIcon:wh,isSDF:_e,hasHalo:ld};if(jh&&u.canOverlap){Td=!0;const Vf=E.segments.get();for(const _d of Vf)Mf.push({segments:new o.SegmentVector([_d]),sortKey:_d.sortKey,state:gd,terrainData:tl})}else Mf.push({segments:E.segments,sortKey:0,state:gd,terrainData:tl})}Td&&Mf.sort((Of,L)=>Of.sortKey-L.sortKey);for(const Of of Mf){const L=Of.state;if(ph.activeTexture.set(Dh.TEXTURE0),L.atlasTexture.bind(L.atlasInterpolation,Dh.CLAMP_TO_EDGE),L.atlasTextureIcon&&(ph.activeTexture.set(Dh.TEXTURE1),L.atlasTextureIcon&&L.atlasTextureIcon.bind(L.atlasInterpolationIcon,Dh.CLAMP_TO_EDGE)),L.isSDF){const u=L.uniformValues;L.hasHalo&&(u.u_is_halo=1,jy(L.buffers,Of.segments,A,he,L.program,Vd,rh,th,u,Of.terrainData)),u.u_is_halo=0}jy(L.buffers,Of.segments,A,he,L.program,Vd,rh,th,L.uniformValues,Of.terrainData)}}function jy(he,g,A,q,nt,Ft,Xr,ls,Zs,ol){const rh=q.context;nt.draw(rh,rh.gl.TRIANGLES,Ft,Xr,ls,Im.disabled,Zs,ol,A.id,he.layoutVertexBuffer,he.indexBuffer,g,A.paint,q.transform.zoom,he.programConfigurations.get(A.id),he.dynamicLayoutVertexBuffer,he.opacityVertexBuffer)}function yy(he,g,A,q,nt){if(!A||!q||!q.imageAtlas)return;const Ft=q.imageAtlas.patternPositions;let Xr=Ft[A.to.toString()],ls=Ft[A.from.toString()];if(!Xr||!ls){const Zs=nt.getPaintProperty(g);Xr=Ft[Zs],ls=Ft[Zs]}Xr&&ls&&he.setConstantPatternPositions(Xr,ls)}function Qg(he,g,A,q,nt,Ft,Xr){const ls=he.context.gl,Zs="fill-pattern",ol=A.paint.get(Zs),rh=ol&&ol.constantOr(1),th=A.getCrossfadeParameters();let ph,Dh,$h,Mh,Kh;Xr?(Dh=rh&&!A.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ph=ls.LINES):(Dh=rh?"fillPattern":"fill",ph=ls.TRIANGLES);const fd=ol.constantOr(null);for(const cd of q){const jh=g.getTile(cd);if(rh&&!jh.patternsLoaded())continue;const Td=jh.getBucket(A);if(!Td)continue;const Vd=Td.programConfigurations.get(A.id),Wd=he.useProgram(Dh,Vd),Mf=he.style.map.terrain&&he.style.map.terrain.getTerrainData(cd);rh&&(he.context.activeTexture.set(ls.TEXTURE0),jh.imageAtlasTexture.bind(ls.LINEAR,ls.CLAMP_TO_EDGE),Vd.updatePaintBuffers(th)),yy(Vd,Zs,fd,jh,A);const Of=Mf?cd:null,L=he.translatePosMatrix(Of?Of.posMatrix:cd.posMatrix,jh,A.paint.get("fill-translate"),A.paint.get("fill-translate-anchor"));if(Xr){Mh=Td.indexBuffer2,Kh=Td.segments2;const u=[ls.drawingBufferWidth,ls.drawingBufferHeight];$h=Dh==="fillOutlinePattern"&&rh?Np(L,he,th,jh,u):Tp(L,u)}else Mh=Td.indexBuffer,Kh=Td.segments,$h=rh?kf(L,he,th,jh):Pm(L);Wd.draw(he.context,ph,nt,he.stencilModeForClipping(cd),Ft,Im.disabled,$h,Mf,A.id,Td.layoutVertexBuffer,Mh,Kh,A.paint,he.transform.zoom,Vd)}}function qy(he,g,A,q,nt,Ft,Xr){const ls=he.context,Zs=ls.gl,ol="fill-extrusion-pattern",rh=A.paint.get(ol),th=rh.constantOr(1),ph=A.getCrossfadeParameters(),Dh=A.paint.get("fill-extrusion-opacity"),$h=rh.constantOr(null);for(const Mh of q){const Kh=g.getTile(Mh),fd=Kh.getBucket(A);if(!fd)continue;const cd=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Mh),jh=fd.programConfigurations.get(A.id),Td=he.useProgram(th?"fillExtrusionPattern":"fillExtrusion",jh);th&&(he.context.activeTexture.set(Zs.TEXTURE0),Kh.imageAtlasTexture.bind(Zs.LINEAR,Zs.CLAMP_TO_EDGE),jh.updatePaintBuffers(ph)),yy(jh,ol,$h,Kh,A);const Vd=he.translatePosMatrix(Mh.posMatrix,Kh,A.paint.get("fill-extrusion-translate"),A.paint.get("fill-extrusion-translate-anchor")),Wd=A.paint.get("fill-extrusion-vertical-gradient"),Mf=th?Yp(Vd,he,Wd,Dh,Mh,ph,Kh):Rm(Vd,he,Wd,Dh);Td.draw(ls,ls.gl.TRIANGLES,nt,Ft,Xr,Im.backCCW,Mf,cd,A.id,fd.layoutVertexBuffer,fd.indexBuffer,fd.segments,A.paint,he.transform.zoom,jh,he.style.map.terrain&&fd.centroidVertexBuffer)}}function nv(he,g,A,q,nt,Ft,Xr){const ls=he.context,Zs=ls.gl,ol=A.fbo;if(!ol)return;const rh=he.useProgram("hillshade"),th=he.style.map.terrain&&he.style.map.terrain.getTerrainData(g);ls.activeTexture.set(Zs.TEXTURE0),Zs.bindTexture(Zs.TEXTURE_2D,ol.colorAttachment.get()),rh.draw(ls,Zs.TRIANGLES,nt,Ft,Xr,Im.disabled,((ph,Dh,$h,Mh)=>{const Kh=$h.paint.get("hillshade-shadow-color"),fd=$h.paint.get("hillshade-highlight-color"),cd=$h.paint.get("hillshade-accent-color");let jh=$h.paint.get("hillshade-illumination-direction")*(Math.PI/180);$h.paint.get("hillshade-illumination-anchor")==="viewport"&&(jh-=ph.transform.angle);const Td=!ph.options.moving;return{u_matrix:Mh?Mh.posMatrix:ph.transform.calculatePosMatrix(Dh.tileID.toUnwrapped(),Td),u_image:0,u_latrange:fy(0,Dh.tileID),u_light:[$h.paint.get("hillshade-exaggeration"),jh],u_shadow:Kh,u_highlight:fd,u_accent:cd}})(he,A,q,th?g:null),th,q.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments)}function p0(he,g,A,q,nt,Ft){const Xr=he.context,ls=Xr.gl,Zs=g.dem;if(Zs&&Zs.data){const ol=Zs.dim,rh=Zs.stride,th=Zs.getPixels();if(Xr.activeTexture.set(ls.TEXTURE1),Xr.pixelStoreUnpackPremultiplyAlpha.set(!1),g.demTexture=g.demTexture||he.getTileTexture(rh),g.demTexture){const Dh=g.demTexture;Dh.update(th,{premultiply:!1}),Dh.bind(ls.NEAREST,ls.CLAMP_TO_EDGE)}else g.demTexture=new Lh(Xr,th,ls.RGBA,{premultiply:!1}),g.demTexture.bind(ls.NEAREST,ls.CLAMP_TO_EDGE);Xr.activeTexture.set(ls.TEXTURE0);let ph=g.fbo;if(!ph){const Dh=new Lh(Xr,{width:ol,height:ol,data:null},ls.RGBA);Dh.bind(ls.LINEAR,ls.CLAMP_TO_EDGE),ph=g.fbo=Xr.createFramebuffer(ol,ol,!0),ph.colorAttachment.set(Dh.texture)}Xr.bindFramebuffer.set(ph.framebuffer),Xr.viewport.set([0,0,ol,ol]),he.useProgram("hillshadePrepare").draw(Xr,ls.TRIANGLES,q,nt,Ft,Im.disabled,((Dh,$h)=>{const Mh=$h.stride,Kh=o.create();return o.ortho(Kh,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Kh,Kh,[0,-o.EXTENT,0]),{u_matrix:Kh,u_image:1,u_dimension:[Mh,Mh],u_zoom:Dh.overscaledZ,u_unpack:$h.getUnpackVector()}})(g.tileID,Zs),null,A.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments),g.needsHillshadePrepare=!1}}function M_(he,g,A,q,nt,Ft){const Xr=q.paint.get("raster-fade-duration");if(!Ft&&Xr>0){const ls=o.exported.now(),Zs=(ls-he.timeAdded)/Xr,ol=g?(ls-g.timeAdded)/Xr:-1,rh=A.getSource(),th=nt.coveringZoomLevel({tileSize:rh.tileSize,roundZoom:rh.roundZoom}),ph=!g||Math.abs(g.tileID.overscaledZ-th)>Math.abs(he.tileID.overscaledZ-th),Dh=ph&&he.refreshedUponExpiration?1:o.clamp(ph?Zs:1-ol,0,1);return he.refreshedUponExpiration&&Zs>=1&&(he.refreshedUponExpiration=!1),g?{opacity:1,mix:1-Dh}:{opacity:Dh,mix:0}}return{opacity:1,mix:0}}const m0=new o.Color(1,0,0,1),X_=new o.Color(0,1,0,1),hd=new o.Color(0,0,1,1),wf=new o.Color(1,0,1,1),ip=new o.Color(0,1,1,1);function $p(he,g,A,q){hm(he,0,g+A/2,he.transform.width,A,q)}function Nm(he,g,A,q){hm(he,g-A/2,0,A,he.transform.height,q)}function hm(he,g,A,q,nt,Ft){const Xr=he.context,ls=Xr.gl;ls.enable(ls.SCISSOR_TEST),ls.scissor(g*he.pixelRatio,A*he.pixelRatio,q*he.pixelRatio,nt*he.pixelRatio),Xr.clear({color:Ft}),ls.disable(ls.SCISSOR_TEST)}function Qm(he,g,A){const q=he.context,nt=q.gl,Ft=A.posMatrix,Xr=he.useProgram("debug"),ls=um.disabled,Zs=Bm.disabled,ol=he.colorModeForRenderPass(),rh="$debug",th=he.style.map.terrain&&he.style.map.terrain.getTerrainData(A);q.activeTexture.set(nt.TEXTURE0),he.emptyTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE);const ph=g.getTileByID(A.key).latestRawTileData,Dh=Math.floor((ph&&ph.byteLength||0)/1024),$h=g.getTile(A).tileSize,Mh=512/Math.min($h,512)*(A.overscaledZ/he.transform.zoom)*.5;let Kh=A.canonical.toString();A.overscaledZ!==A.canonical.z&&(Kh+=` => ${A.overscaledZ}`),function(fd,cd){fd.initDebugOverlayCanvas();const jh=fd.debugOverlayCanvas,Td=fd.context.gl,Vd=fd.debugOverlayCanvas.getContext("2d");Vd.clearRect(0,0,jh.width,jh.height),Vd.shadowColor="white",Vd.shadowBlur=2,Vd.lineWidth=1.5,Vd.strokeStyle="white",Vd.textBaseline="top",Vd.font="bold 36px Open Sans, sans-serif",Vd.fillText(cd,5,5),Vd.strokeText(cd,5,5),fd.debugOverlayTexture.update(jh),fd.debugOverlayTexture.bind(Td.LINEAR,Td.CLAMP_TO_EDGE)}(he,`${Kh} ${Dh}kB`),Xr.draw(q,nt.TRIANGLES,ls,Zs,Xm.alphaBlended,Im.disabled,bg(Ft,o.Color.transparent,Mh),null,rh,he.debugBuffer,he.quadTriangleIndexBuffer,he.debugSegments),Xr.draw(q,nt.LINE_STRIP,ls,Zs,ol,Im.disabled,bg(Ft,o.Color.red),th,rh,he.debugBuffer,he.tileBorderIndexBuffer,he.debugSegments)}function og(he,g,A){const q=he.context,nt=q.gl,Ft=he.colorModeForRenderPass(),Xr=new um(nt.LEQUAL,um.ReadWrite,he.depthRangeFor3D),ls=he.useProgram("terrain"),Zs=g.getTerrainMesh();q.bindFramebuffer.set(null),q.viewport.set([0,0,he.width,he.height]);for(const ol of A){const rh=he.renderToTexture.getTexture(ol),th=g.getTerrainData(ol.tileID);q.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_2D,rh.texture);const ph={u_matrix:he.transform.calculatePosMatrix(ol.tileID.toUnwrapped()),u_texture:0,u_ele_delta:g.getMeshFrameDelta(he.transform.zoom)};ls.draw(q,nt.TRIANGLES,Xr,Bm.disabled,Ft,Im.backCCW,ph,th,"terrain",Zs.vertexBuffer,Zs.indexBuffer,Zs.segments)}}const ag={symbol:function(he,g,A,q,nt){if(he.renderPass!=="translucent")return;const Ft=Bm.disabled,Xr=he.colorModeForRenderPass();A.layout.get("text-variable-anchor")&&function(ls,Zs,ol,rh,th,ph,Dh){const $h=Zs.transform,Mh=th==="map",Kh=ph==="map";for(const fd of ls){const cd=rh.getTile(fd),jh=cd.getBucket(ol);if(!jh||!jh.text||!jh.text.segments.get().length)continue;const Td=o.evaluateSizeForZoom(jh.textSizeData,$h.zoom),Vd=zh(cd,1,Zs.transform.zoom),Wd=Dd(fd.posMatrix,Kh,Mh,Zs.transform,Vd),Mf=ol.layout.get("icon-text-fit")!=="none"&&jh.hasIconData();if(Td){const Of=Math.pow(2,$h.zoom-cd.tileID.overscaledZ);f0(jh,Mh,Kh,Dh,$h,Wd,fd.posMatrix,Of,Td,Mf,Zs.style.map.terrain?(L,u)=>Zs.style.map.terrain.getElevation(fd,L,u):null)}}}(q,he,A,g,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),nt),A.paint.get("icon-opacity").constantOr(1)!==0&&H_(he,g,A,q,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),Ft,Xr),A.paint.get("text-opacity").constantOr(1)!==0&&H_(he,g,A,q,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),Ft,Xr),g.map.showCollisionBoxes&&(ly(he,g,A,q,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),ly(he,g,A,q,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))},circle:function(he,g,A,q){if(he.renderPass!=="translucent")return;const nt=A.paint.get("circle-opacity"),Ft=A.paint.get("circle-stroke-width"),Xr=A.paint.get("circle-stroke-opacity"),ls=!A.layout.get("circle-sort-key").isConstant();if(nt.constantOr(1)===0&&(Ft.constantOr(1)===0||Xr.constantOr(1)===0))return;const Zs=he.context,ol=Zs.gl,rh=he.depthModeForSublayer(0,um.ReadOnly),th=Bm.disabled,ph=he.colorModeForRenderPass(),Dh=[];for(let $h=0;$h<q.length;$h++){const Mh=q[$h],Kh=g.getTile(Mh),fd=Kh.getBucket(A);if(!fd)continue;const cd=fd.programConfigurations.get(A.id),jh=he.useProgram("circle",cd),Td=fd.layoutVertexBuffer,Vd=fd.indexBuffer,Wd=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Mh),Mf={programConfiguration:cd,program:jh,layoutVertexBuffer:Td,indexBuffer:Vd,uniformValues:Jm(he,Mh,Kh,A),terrainData:Wd};if(ls){const Of=fd.segments.get();for(const L of Of)Dh.push({segments:new o.SegmentVector([L]),sortKey:L.sortKey,state:Mf})}else Dh.push({segments:fd.segments,sortKey:0,state:Mf})}ls&&Dh.sort(($h,Mh)=>$h.sortKey-Mh.sortKey);for(const $h of Dh){const{programConfiguration:Mh,program:Kh,layoutVertexBuffer:fd,indexBuffer:cd,uniformValues:jh,terrainData:Td}=$h.state;Kh.draw(Zs,ol.TRIANGLES,rh,th,ph,Im.disabled,jh,Td,A.id,fd,cd,$h.segments,A.paint,he.transform.zoom,Mh)}},heatmap:function(he,g,A,q){if(A.paint.get("heatmap-opacity")!==0)if(he.renderPass==="offscreen"){const nt=he.context,Ft=nt.gl,Xr=Bm.disabled,ls=new Xm([Ft.ONE,Ft.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Zs,ol,rh){const th=Zs.gl;Zs.activeTexture.set(th.TEXTURE1),Zs.viewport.set([0,0,ol.width/4,ol.height/4]);let ph=rh.heatmapFbo;if(ph)th.bindTexture(th.TEXTURE_2D,ph.colorAttachment.get()),Zs.bindFramebuffer.set(ph.framebuffer);else{const Dh=th.createTexture();th.bindTexture(th.TEXTURE_2D,Dh),th.texParameteri(th.TEXTURE_2D,th.TEXTURE_WRAP_S,th.CLAMP_TO_EDGE),th.texParameteri(th.TEXTURE_2D,th.TEXTURE_WRAP_T,th.CLAMP_TO_EDGE),th.texParameteri(th.TEXTURE_2D,th.TEXTURE_MIN_FILTER,th.LINEAR),th.texParameteri(th.TEXTURE_2D,th.TEXTURE_MAG_FILTER,th.LINEAR),ph=rh.heatmapFbo=Zs.createFramebuffer(ol.width/4,ol.height/4,!1),function($h,Mh,Kh,fd){const cd=$h.gl;cd.texImage2D(cd.TEXTURE_2D,0,cd.RGBA,Mh.width/4,Mh.height/4,0,cd.RGBA,$h.extRenderToTextureHalfFloat?$h.extTextureHalfFloat.HALF_FLOAT_OES:cd.UNSIGNED_BYTE,null),fd.colorAttachment.set(Kh)}(Zs,ol,Dh,ph)}})(nt,he,A),nt.clear({color:o.Color.transparent});for(let Zs=0;Zs<q.length;Zs++){const ol=q[Zs];if(g.hasRenderableParent(ol))continue;const rh=g.getTile(ol),th=rh.getBucket(A);if(!th)continue;const ph=th.programConfigurations.get(A.id),Dh=he.useProgram("heatmap",ph),{zoom:$h}=he.transform;Dh.draw(nt,Ft.TRIANGLES,um.disabled,Xr,ls,Im.disabled,$m(ol.posMatrix,rh,$h,A.paint.get("heatmap-intensity")),null,A.id,th.layoutVertexBuffer,th.indexBuffer,th.segments,A.paint,he.transform.zoom,ph)}nt.viewport.set([0,0,he.width,he.height])}else he.renderPass==="translucent"&&(he.context.setColorMode(he.colorModeForRenderPass()),function(nt,Ft){const Xr=nt.context,ls=Xr.gl,Zs=Ft.heatmapFbo;if(!Zs)return;Xr.activeTexture.set(ls.TEXTURE0),ls.bindTexture(ls.TEXTURE_2D,Zs.colorAttachment.get()),Xr.activeTexture.set(ls.TEXTURE1);let ol=Ft.colorRampTexture;ol||(ol=Ft.colorRampTexture=new Lh(Xr,Ft.colorRamp,ls.RGBA)),ol.bind(ls.LINEAR,ls.CLAMP_TO_EDGE),nt.useProgram("heatmapTexture").draw(Xr,ls.TRIANGLES,um.disabled,Bm.disabled,nt.colorModeForRenderPass(),Im.disabled,((rh,th,ph,Dh)=>{const $h=o.create();o.ortho($h,0,rh.width,rh.height,0,0,1);const Mh=rh.context.gl;return{u_matrix:$h,u_world:[Mh.drawingBufferWidth,Mh.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:th.paint.get("heatmap-opacity")}})(nt,Ft),null,Ft.id,nt.viewportBuffer,nt.quadTriangleIndexBuffer,nt.viewportSegments,Ft.paint,nt.transform.zoom)}(he,A))},line:function(he,g,A,q){if(he.renderPass!=="translucent")return;const nt=A.paint.get("line-opacity"),Ft=A.paint.get("line-width");if(nt.constantOr(1)===0||Ft.constantOr(1)===0)return;const Xr=he.depthModeForSublayer(0,um.ReadOnly),ls=he.colorModeForRenderPass(),Zs=A.paint.get("line-dasharray"),ol=A.paint.get("line-pattern"),rh=ol.constantOr(1),th=A.paint.get("line-gradient"),ph=A.getCrossfadeParameters(),Dh=rh?"linePattern":Zs?"lineSDF":th?"lineGradient":"line",$h=he.context,Mh=$h.gl;let Kh=!0;for(const fd of q){const cd=g.getTile(fd);if(rh&&!cd.patternsLoaded())continue;const jh=cd.getBucket(A);if(!jh)continue;const Td=jh.programConfigurations.get(A.id),Vd=he.context.program.get(),Wd=he.useProgram(Dh,Td),Mf=Kh||Wd.program!==Vd,Of=he.style.map.terrain&&he.style.map.terrain.getTerrainData(fd),L=ol.constantOr(null);if(L&&cd.imageAtlas){const B=cd.imageAtlas,_e=B.patternPositions[L.to.toString()],St=B.patternPositions[L.from.toString()];_e&&St&&Td.setConstantPatternPositions(_e,St)}const u=Of?fd:null,E=rh?Ly(he,cd,A,ph,u):Zs?Ry(he,cd,A,Zs,ph,u):th?Xg(he,cd,A,jh.lineClipsArray.length,u):Km(he,cd,A,u);if(rh)$h.activeTexture.set(Mh.TEXTURE0),cd.imageAtlasTexture.bind(Mh.LINEAR,Mh.CLAMP_TO_EDGE),Td.updatePaintBuffers(ph);else if(Zs&&(Mf||he.lineAtlas.dirty))$h.activeTexture.set(Mh.TEXTURE0),he.lineAtlas.bind($h);else if(th){const B=jh.gradients[A.id];let _e=B.texture;if(A.gradientVersion!==B.version){let St=256;if(A.stepInterpolant){const mr=g.getSource().maxzoom,qr=fd.canonical.z===mr?Math.ceil(1<<he.transform.maxZoom-fd.canonical.z):1;St=o.clamp(o.nextPowerOfTwo(jh.maxLineLength/o.EXTENT*1024*qr),256,$h.maxTextureSize)}B.gradient=o.renderColorRamp({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:B.gradient||void 0,clips:jh.lineClipsArray}),B.texture?B.texture.update(B.gradient):B.texture=new Lh($h,B.gradient,Mh.RGBA),B.version=A.gradientVersion,_e=B.texture}$h.activeTexture.set(Mh.TEXTURE0),_e.bind(A.stepInterpolant?Mh.NEAREST:Mh.LINEAR,Mh.CLAMP_TO_EDGE)}Wd.draw($h,Mh.TRIANGLES,Xr,he.stencilModeForClipping(fd),ls,Im.disabled,E,Of,A.id,jh.layoutVertexBuffer,jh.indexBuffer,jh.segments,A.paint,he.transform.zoom,Td,jh.layoutVertexBuffer2),Kh=!1}},fill:function(he,g,A,q){const nt=A.paint.get("fill-color"),Ft=A.paint.get("fill-opacity");if(Ft.constantOr(1)===0)return;const Xr=he.colorModeForRenderPass(),ls=A.paint.get("fill-pattern"),Zs=he.opaquePassEnabledForLayer()&&!ls.constantOr(1)&&nt.constantOr(o.Color.transparent).a===1&&Ft.constantOr(0)===1?"opaque":"translucent";if(he.renderPass===Zs){const ol=he.depthModeForSublayer(1,he.renderPass==="opaque"?um.ReadWrite:um.ReadOnly);Qg(he,g,A,q,ol,Xr,!1)}if(he.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ol=he.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,um.ReadOnly);Qg(he,g,A,q,ol,Xr,!0)}},"fill-extrusion":function(he,g,A,q){const nt=A.paint.get("fill-extrusion-opacity");if(nt!==0&&he.renderPass==="translucent"){const Ft=new um(he.context.gl.LEQUAL,um.ReadWrite,he.depthRangeFor3D);if(nt!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))qy(he,g,A,q,Ft,Bm.disabled,Xm.disabled),qy(he,g,A,q,Ft,he.stencilModeFor3D(),he.colorModeForRenderPass());else{const Xr=he.colorModeForRenderPass();qy(he,g,A,q,Ft,Bm.disabled,Xr)}}},hillshade:function(he,g,A,q){if(he.renderPass!=="offscreen"&&he.renderPass!=="translucent")return;const nt=he.context,Ft=he.depthModeForSublayer(0,um.ReadOnly),Xr=he.colorModeForRenderPass(),[ls,Zs]=he.renderPass==="translucent"?he.stencilConfigForOverlap(q):[{},q];for(const ol of Zs){const rh=g.getTile(ol);rh.needsHillshadePrepare!==void 0&&rh.needsHillshadePrepare&&he.renderPass==="offscreen"?p0(he,rh,A,Ft,Bm.disabled,Xr):he.renderPass==="translucent"&&nv(he,ol,rh,A,Ft,ls[ol.overscaledZ],Xr)}nt.viewport.set([0,0,he.width,he.height])},raster:function(he,g,A,q){if(he.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!q.length)return;const nt=he.context,Ft=nt.gl,Xr=g.getSource(),ls=he.useProgram("raster"),Zs=he.colorModeForRenderPass(),[ol,rh]=Xr instanceof yd?[{},q]:he.stencilConfigForOverlap(q),th=rh[rh.length-1].overscaledZ,ph=!he.options.moving;for(const Dh of rh){const $h=he.depthModeForSublayer(Dh.overscaledZ-th,A.paint.get("raster-opacity")===1?um.ReadWrite:um.ReadOnly,Ft.LESS),Mh=g.getTile(Dh);Mh.registerFadeDuration(A.paint.get("raster-fade-duration"));const Kh=g.findLoadedParent(Dh,0),fd=M_(Mh,Kh,g,A,he.transform,he.style.map.terrain);let cd,jh;const Td=A.paint.get("raster-resampling")==="nearest"?Ft.NEAREST:Ft.LINEAR;nt.activeTexture.set(Ft.TEXTURE0),Mh.texture.bind(Td,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST),nt.activeTexture.set(Ft.TEXTURE1),Kh?(Kh.texture.bind(Td,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST),cd=Math.pow(2,Kh.tileID.overscaledZ-Mh.tileID.overscaledZ),jh=[Mh.tileID.canonical.x*cd%1,Mh.tileID.canonical.y*cd%1]):Mh.texture.bind(Td,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST);const Vd=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Dh),Wd=Vd?Dh:null,Mf=Wd?Wd.posMatrix:he.transform.calculatePosMatrix(Dh.toUnwrapped(),ph),Of=Oy(Mf,jh||[0,0],cd||1,fd,A);Xr instanceof yd?ls.draw(nt,Ft.TRIANGLES,$h,Bm.disabled,Zs,Im.disabled,Of,Vd,A.id,Xr.boundsBuffer,he.quadTriangleIndexBuffer,Xr.boundsSegments):ls.draw(nt,Ft.TRIANGLES,$h,ol[Dh.overscaledZ],Zs,Im.disabled,Of,Vd,A.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments)}},background:function(he,g,A,q){const nt=A.paint.get("background-color"),Ft=A.paint.get("background-opacity");if(Ft===0)return;const Xr=he.context,ls=Xr.gl,Zs=he.transform,ol=Zs.tileSize,rh=A.paint.get("background-pattern");if(he.isPatternMissing(rh))return;const th=!rh&&nt.a===1&&Ft===1&&he.opaquePassEnabledForLayer()?"opaque":"translucent";if(he.renderPass!==th)return;const ph=Bm.disabled,Dh=he.depthModeForSublayer(0,th==="opaque"?um.ReadWrite:um.ReadOnly),$h=he.colorModeForRenderPass(),Mh=he.useProgram(rh?"backgroundPattern":"background"),Kh=q||Zs.coveringTiles({tileSize:ol,terrain:he.style.map.terrain});rh&&(Xr.activeTexture.set(ls.TEXTURE0),he.imageManager.bind(he.context));const fd=A.getCrossfadeParameters();for(const cd of Kh){const jh=q?cd.posMatrix:he.transform.calculatePosMatrix(cd.toUnwrapped()),Td=rh?oy(jh,Ft,he,rh,{tileID:cd,tileSize:ol},fd):tv(jh,Ft,nt),Vd=he.style.map.terrain&&he.style.map.terrain.getTerrainData(cd);Mh.draw(Xr,ls.TRIANGLES,Dh,ph,$h,Im.disabled,Td,Vd,A.id,he.tileExtentBuffer,he.quadTriangleIndexBuffer,he.tileExtentSegments)}},debug:function(he,g,A){for(let q=0;q<A.length;q++)Qm(he,g,A[q])},custom:function(he,g,A){const q=he.context,nt=A.implementation;if(he.renderPass==="offscreen"){const Ft=nt.prerender;Ft&&(he.setCustomLayerDefaults(),q.setColorMode(he.colorModeForRenderPass()),Ft.call(nt,q.gl,he.transform.customLayerMatrix()),q.setDirty(),he.setBaseState())}else if(he.renderPass==="translucent"){he.setCustomLayerDefaults(),q.setColorMode(he.colorModeForRenderPass()),q.setStencilMode(Bm.disabled);const Ft=nt.renderingMode==="3d"?new um(he.context.gl.LEQUAL,um.ReadWrite,he.depthRangeFor3D):he.depthModeForSublayer(0,um.ReadOnly);q.setDepthMode(Ft),nt.render(q.gl,he.transform.customLayerMatrix()),q.setDirty(),he.setBaseState(),q.bindFramebuffer.set(null)}}};class Vm{constructor(g,A){this.context=new d0(g),this.transform=A,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=Ld.maxUnderzooming+Ld.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new mm,this.gpuTimers={}}resize(g,A,q){if(this.width=g*q,this.height=A*q,this.pixelRatio=q,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const nt of this.style._order)this.style._layers[nt].resize()}setup(){const g=this.context,A=new o.PosArray;A.emplaceBack(0,0),A.emplaceBack(o.EXTENT,0),A.emplaceBack(0,o.EXTENT),A.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=g.createVertexBuffer(A,od.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const q=new o.PosArray;q.emplaceBack(0,0),q.emplaceBack(o.EXTENT,0),q.emplaceBack(0,o.EXTENT),q.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=g.createVertexBuffer(q,od.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const nt=new o.RasterBoundsArray;nt.emplaceBack(0,0,0,0),nt.emplaceBack(o.EXTENT,0,o.EXTENT,0),nt.emplaceBack(0,o.EXTENT,0,o.EXTENT),nt.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=g.createVertexBuffer(nt,jf.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const Ft=new o.PosArray;Ft.emplaceBack(0,0),Ft.emplaceBack(1,0),Ft.emplaceBack(0,1),Ft.emplaceBack(1,1),this.viewportBuffer=g.createVertexBuffer(Ft,od.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const Xr=new o.LineStripIndexArray;Xr.emplaceBack(0),Xr.emplaceBack(1),Xr.emplaceBack(3),Xr.emplaceBack(2),Xr.emplaceBack(0),this.tileBorderIndexBuffer=g.createIndexBuffer(Xr);const ls=new o.TriangleIndexArray;ls.emplaceBack(0,1,2),ls.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=g.createIndexBuffer(ls),this.emptyTexture=new Lh(g,{width:1,height:1,data:new Uint8Array([0,0,0,0])},g.gl.RGBA);const Zs=this.context.gl;this.stencilClearMode=new Bm({func:Zs.ALWAYS,mask:0},0,255,Zs.ZERO,Zs.ZERO,Zs.ZERO)}clearStencil(){const g=this.context,A=g.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const q=o.create();o.ortho(q,0,this.width,this.height,0,0,1),o.scale(q,q,[A.drawingBufferWidth,A.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(g,A.TRIANGLES,um.disabled,this.stencilClearMode,Xm.disabled,Im.disabled,kg(q),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(g,A){if(this.currentStencilSource===g.source||!g.isTileClipped()||!A||!A.length)return;this.currentStencilSource=g.source;const q=this.context,nt=q.gl;this.nextStencilID+A.length>256&&this.clearStencil(),q.setColorMode(Xm.disabled),q.setDepthMode(um.disabled);const Ft=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Xr of A){const ls=this._tileClippingMaskIDs[Xr.key]=this.nextStencilID++,Zs=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Xr);Ft.draw(q,nt.TRIANGLES,um.disabled,new Bm({func:nt.ALWAYS,mask:0},ls,255,nt.KEEP,nt.KEEP,nt.REPLACE),Xm.disabled,Im.disabled,kg(Xr.posMatrix),Zs,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const g=this.nextStencilID++,A=this.context.gl;return new Bm({func:A.NOTEQUAL,mask:255},g,255,A.KEEP,A.KEEP,A.REPLACE)}stencilModeForClipping(g){const A=this.context.gl;return new Bm({func:A.EQUAL,mask:255},this._tileClippingMaskIDs[g.key],0,A.KEEP,A.KEEP,A.REPLACE)}stencilConfigForOverlap(g){const A=this.context.gl,q=g.sort((Xr,ls)=>ls.overscaledZ-Xr.overscaledZ),nt=q[q.length-1].overscaledZ,Ft=q[0].overscaledZ-nt+1;if(Ft>1){this.currentStencilSource=void 0,this.nextStencilID+Ft>256&&this.clearStencil();const Xr={};for(let ls=0;ls<Ft;ls++)Xr[ls+nt]=new Bm({func:A.GEQUAL,mask:255},ls+this.nextStencilID,255,A.KEEP,A.KEEP,A.REPLACE);return this.nextStencilID+=Ft,[Xr,q]}return[{[nt]:Bm.disabled},q]}colorModeForRenderPass(){const g=this.context.gl;return this._showOverdrawInspector?new Xm([g.CONSTANT_COLOR,g.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xm.unblended:Xm.alphaBlended}depthModeForSublayer(g,A,q){if(!this.opaquePassEnabledForLayer())return um.disabled;const nt=1-((1+this.currentLayer)*this.numSublayers+g)*this.depthEpsilon;return new um(q||this.context.gl.LEQUAL,A,[nt,nt])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(g,A){this.style=g,this.options=A,this.lineAtlas=g.lineAtlas,this.imageManager=g.imageManager,this.glyphManager=g.glyphManager,this.symbolFadeChange=g.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const q=this.style._order,nt=this.style.sourceCaches,Ft={},Xr={},ls={};for(const Zs in nt){const ol=nt[Zs];ol.used&&ol.prepare(this.context),Ft[Zs]=ol.getVisibleCoordinates(),Xr[Zs]=Ft[Zs].slice().reverse(),ls[Zs]=ol.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Zs=0;Zs<q.length;Zs++)if(this.style._layers[q[Zs]].is3D()){this.opaquePassCutoff=Zs;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const Zs=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||Zs.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(ol,rh){const th=ol.context,ph=th.gl,Dh=Xm.unblended,$h=new um(ph.LEQUAL,um.ReadWrite,[0,1]),Mh=rh.getTerrainMesh(),Kh=rh.sourceCache.getRenderableTiles(),fd=ol.useProgram("terrainDepth");th.bindFramebuffer.set(rh.getFramebuffer("depth").framebuffer),th.viewport.set([0,0,ol.width/devicePixelRatio,ol.height/devicePixelRatio]),th.clear({color:o.Color.transparent,depth:1});for(const cd of Kh){const jh=rh.getTerrainData(cd.tileID),Td={u_matrix:ol.transform.calculatePosMatrix(cd.tileID.toUnwrapped()),u_ele_delta:rh.getMeshFrameDelta(ol.transform.zoom)};fd.draw(th,ph.TRIANGLES,$h,Bm.disabled,Dh,Im.backCCW,Td,jh,"terrain",Mh.vertexBuffer,Mh.indexBuffer,Mh.segments)}th.bindFramebuffer.set(null),th.viewport.set([0,0,ol.width,ol.height])}(this,this.style.map.terrain),function(ol,rh){const th=ol.context,ph=th.gl,Dh=Xm.unblended,$h=new um(ph.LEQUAL,um.ReadWrite,[0,1]),Mh=rh.getTerrainMesh(),Kh=rh.getCoordsTexture(),fd=rh.sourceCache.getRenderableTiles(),cd=ol.useProgram("terrainCoords");th.bindFramebuffer.set(rh.getFramebuffer("coords").framebuffer),th.viewport.set([0,0,ol.width/devicePixelRatio,ol.height/devicePixelRatio]),th.clear({color:o.Color.transparent,depth:1}),rh.coordsIndex=[];for(const jh of fd){const Td=rh.getTerrainData(jh.tileID);th.activeTexture.set(ph.TEXTURE0),ph.bindTexture(ph.TEXTURE_2D,Kh.texture);const Vd={u_matrix:ol.transform.calculatePosMatrix(jh.tileID.toUnwrapped()),u_terrain_coords_id:(255-rh.coordsIndex.length)/255,u_texture:0,u_ele_delta:rh.getMeshFrameDelta(ol.transform.zoom)};cd.draw(th,ph.TRIANGLES,$h,Bm.disabled,Dh,Im.backCCW,Vd,Td,"terrain",Mh.vertexBuffer,Mh.indexBuffer,Mh.segments),rh.coordsIndex.push(jh.tileID.key)}th.bindFramebuffer.set(null),th.viewport.set([0,0,ol.width,ol.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const Zs of q){const ol=this.style._layers[Zs];if(!ol.hasOffscreenPass()||ol.isHidden(this.transform.zoom))continue;const rh=Xr[ol.source];(ol.type==="custom"||rh.length)&&this.renderLayer(this,nt[ol.source],ol,rh)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:A.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=A.showOverdrawInspector,this.depthRangeFor3D=[0,1-(g._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=q.length-1;this.currentLayer>=0;this.currentLayer--){const Zs=this.style._layers[q[this.currentLayer]],ol=nt[Zs.source],rh=Ft[Zs.source];this._renderTileClippingMasks(Zs,rh),this.renderLayer(this,ol,Zs,rh)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Zs=this.style._layers[q[this.currentLayer]],ol=nt[Zs.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Zs))continue;const rh=(Zs.type==="symbol"?ls:Xr)[Zs.source];this._renderTileClippingMasks(Zs,Ft[Zs.source]),this.renderLayer(this,ol,Zs,rh)}if(this.options.showTileBoundaries){const Zs=function(ol,rh){let th=null;const ph=Object.values(ol._layers).flatMap(Kh=>Kh.source&&!Kh.isHidden(rh)?[ol.sourceCaches[Kh.source]]:[]),Dh=ph.filter(Kh=>Kh.getSource().type==="vector"),$h=ph.filter(Kh=>Kh.getSource().type!=="vector"),Mh=Kh=>{(!th||th.getSource().maxzoom<Kh.getSource().maxzoom)&&(th=Kh)};return Dh.forEach(Kh=>Mh(Kh)),th||$h.forEach(Kh=>Mh(Kh)),th}(this.style,this.transform.zoom);Zs&&ag.debug(this,Zs,Zs.getVisibleCoordinates())}this.options.showPadding&&function(Zs){const ol=Zs.transform.padding;$p(Zs,Zs.transform.height-(ol.top||0),3,m0),$p(Zs,ol.bottom||0,3,X_),Nm(Zs,ol.left||0,3,hd),Nm(Zs,Zs.transform.width-(ol.right||0),3,wf);const rh=Zs.transform.centerPoint;(function(th,ph,Dh,$h){hm(th,ph-1,Dh-10,2,20,$h),hm(th,ph-10,Dh-1,20,2,$h)})(Zs,rh.x,Zs.transform.height-rh.y,ip)}(this),this.context.setDefault()}renderLayer(g,A,q,nt){q.isHidden(this.transform.zoom)||(q.type==="background"||q.type==="custom"||(nt||[]).length)&&(this.id=q.id,this.gpuTimingStart(q),ag[q.type](g,A,q,nt,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(g){if(!this.options.gpuTiming)return;const A=this.context.extTimerQuery;let q=this.gpuTimers[g.id];q||(q=this.gpuTimers[g.id]={calls:0,cpuTime:0,query:A.createQueryEXT()}),q.calls++,A.beginQueryEXT(A.TIME_ELAPSED_EXT,q.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;g.endQueryEXT(g.TIME_ELAPSED_EXT)}collectGpuTimers(){const g=this.gpuTimers;return this.gpuTimers={},g}queryGpuTimers(g){const A={};for(const q in g){const nt=g[q],Ft=this.context.extTimerQuery,Xr=Ft.getQueryObjectEXT(nt.query,Ft.QUERY_RESULT_EXT)/1e6;Ft.deleteQueryEXT(nt.query),A[q]=Xr}return A}translatePosMatrix(g,A,q,nt,Ft){if(!q[0]&&!q[1])return g;const Xr=Ft?nt==="map"?this.transform.angle:0:nt==="viewport"?-this.transform.angle:0;if(Xr){const ol=Math.sin(Xr),rh=Math.cos(Xr);q=[q[0]*rh-q[1]*ol,q[0]*ol+q[1]*rh]}const ls=[Ft?q[0]:zh(A,q[0],this.transform.zoom),Ft?q[1]:zh(A,q[1],this.transform.zoom),0],Zs=new Float32Array(16);return o.translate(Zs,g,ls),Zs}saveTileTexture(g){const A=this._tileTextures[g.size[0]];A?A.push(g):this._tileTextures[g.size[0]]=[g]}getTileTexture(g){const A=this._tileTextures[g];return A&&A.length>0?A.pop():null}isPatternMissing(g){if(!g)return!1;if(!g.from||!g.to)return!0;const A=this.imageManager.getPattern(g.from.toString()),q=this.imageManager.getPattern(g.to.toString());return!A||!q}useProgram(g,A){this.cache=this.cache||{};const q=g+(A?A.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[q]||(this.cache[q]=new lp(this.context,g,Gf[g],A,o0[g],this._showOverdrawInspector,this.style.map.terrain)),this.cache[q]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const g=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(g.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Lh(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class tp{constructor(g,A){this.points=g,this.planes=A}static fromInvProjectionMatrix(g,A,q){const nt=Math.pow(2,q),Ft=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ls=>{const Zs=1/(ls=o.transformMat4([],ls,g))[3]/A*nt;return o.mul$1(ls,ls,[Zs,Zs,1/ls[3],Zs])}),Xr=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ls=>{const Zs=function(ph,Dh){var $h=Dh[0],Mh=Dh[1],Kh=Dh[2],fd=$h*$h+Mh*Mh+Kh*Kh;return fd>0&&(fd=1/Math.sqrt(fd)),ph[0]=Dh[0]*fd,ph[1]=Dh[1]*fd,ph[2]=Dh[2]*fd,ph}([],function(ph,Dh,$h){var Mh=Dh[0],Kh=Dh[1],fd=Dh[2],cd=$h[0],jh=$h[1],Td=$h[2];return ph[0]=Kh*Td-fd*jh,ph[1]=fd*cd-Mh*Td,ph[2]=Mh*jh-Kh*cd,ph}([],sh([],Ft[ls[0]],Ft[ls[1]]),sh([],Ft[ls[2]],Ft[ls[1]]))),ol=-((rh=Zs)[0]*(th=Ft[ls[1]])[0]+rh[1]*th[1]+rh[2]*th[2]);var rh,th;return Zs.concat(ol)});return new tp(Ft,Xr)}}class Wg{constructor(g,A){this.min=g,this.max=A,this.center=function(q,nt,Ft){return q[0]=.5*nt[0],q[1]=.5*nt[1],q[2]=.5*nt[2],q}([],function(q,nt,Ft){return q[0]=nt[0]+Ft[0],q[1]=nt[1]+Ft[1],q[2]=nt[2]+Ft[2],q}([],this.min,this.max))}quadrant(g){const A=[g%2==0,g<2],q=ih(this.min),nt=ih(this.max);for(let Ft=0;Ft<A.length;Ft++)q[Ft]=A[Ft]?this.min[Ft]:this.center[Ft],nt[Ft]=A[Ft]?this.center[Ft]:this.max[Ft];return nt[2]=this.max[2],new Wg(q,nt)}distanceX(g){return Math.max(Math.min(this.max[0],g[0]),this.min[0])-g[0]}distanceY(g){return Math.max(Math.min(this.max[1],g[1]),this.min[1])-g[1]}intersects(g){const A=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let q=!0;for(let nt=0;nt<g.planes.length;nt++){const Ft=g.planes[nt];let Xr=0;for(let ls=0;ls<A.length;ls++)o.dot(Ft,A[ls])>=0&&Xr++;if(Xr===0)return 0;Xr!==A.length&&(q=!1)}if(q)return 2;for(let nt=0;nt<3;nt++){let Ft=Number.MAX_VALUE,Xr=-Number.MAX_VALUE;for(let ls=0;ls<g.points.length;ls++){const Zs=g.points[ls][nt]-this.min[nt];Ft=Math.min(Ft,Zs),Xr=Math.max(Xr,Zs)}if(Xr<0||Ft>this.max[nt]-this.min[nt])return 0}return 1}}class Tg{constructor(g=0,A=0,q=0,nt=0){if(isNaN(g)||g<0||isNaN(A)||A<0||isNaN(q)||q<0||isNaN(nt)||nt<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=g,this.bottom=A,this.left=q,this.right=nt}interpolate(g,A,q){return A.top!=null&&g.top!=null&&(this.top=o.number(g.top,A.top,q)),A.bottom!=null&&g.bottom!=null&&(this.bottom=o.number(g.bottom,A.bottom,q)),A.left!=null&&g.left!=null&&(this.left=o.number(g.left,A.left,q)),A.right!=null&&g.right!=null&&(this.right=o.number(g.right,A.right,q)),this}getCenter(g,A){const q=o.clamp((this.left+g-this.right)/2,0,g),nt=o.clamp((this.top+A-this.bottom)/2,0,A);return new o.pointGeometry(q,nt)}equals(g){return this.top===g.top&&this.bottom===g.bottom&&this.left===g.left&&this.right===g.right}clone(){return new Tg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fg{constructor(g,A,q,nt,Ft){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=Ft===void 0||!!Ft,this._minZoom=g||0,this._maxZoom=A||22,this._minPitch=q??0,this._maxPitch=nt??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Tg,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const g=new fg(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return g.tileSize=this.tileSize,g.latRange=this.latRange,g.width=this.width,g.height=this.height,g._center=this._center,g._elevation=this._elevation,g.zoom=this.zoom,g.angle=this.angle,g._fov=this._fov,g._pitch=this._pitch,g._unmodified=this._unmodified,g._edgeInsets=this._edgeInsets.clone(),g._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(g){this._minZoom!==g&&(this._minZoom=g,this.zoom=Math.max(this.zoom,g))}get maxZoom(){return this._maxZoom}set maxZoom(g){this._maxZoom!==g&&(this._maxZoom=g,this.zoom=Math.min(this.zoom,g))}get minPitch(){return this._minPitch}set minPitch(g){this._minPitch!==g&&(this._minPitch=g,this.pitch=Math.max(this.pitch,g))}get maxPitch(){return this._maxPitch}set maxPitch(g){this._maxPitch!==g&&(this._maxPitch=g,this.pitch=Math.min(this.pitch,g))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(g){g===void 0?g=!0:g===null&&(g=!1),this._renderWorldCopies=g}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(g){const A=-o.wrap(g,-180,180)*Math.PI/180;this.angle!==A&&(this._unmodified=!1,this.angle=A,this._calcMatrices(),this.rotationMatrix=function(){var q=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(q[1]=0,q[2]=0),q[0]=1,q[3]=1,q}(),function(q,nt,Ft){var Xr=nt[0],ls=nt[1],Zs=nt[2],ol=nt[3],rh=Math.sin(Ft),th=Math.cos(Ft);q[0]=Xr*th+Zs*rh,q[1]=ls*th+ol*rh,q[2]=Xr*-rh+Zs*th,q[3]=ls*-rh+ol*th}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(g){const A=o.clamp(g,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==A&&(this._unmodified=!1,this._pitch=A,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(g){g=Math.max(.01,Math.min(60,g)),this._fov!==g&&(this._unmodified=!1,this._fov=g/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(g){const A=Math.min(Math.max(g,this.minZoom),this.maxZoom);this._zoom!==A&&(this._unmodified=!1,this._zoom=A,this.tileZoom=Math.max(0,Math.floor(A)),this.scale=this.zoomScale(A),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(g){g.lat===this._center.lat&&g.lng===this._center.lng||(this._unmodified=!1,this._center=g,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(g){g!==this._elevation&&(this._elevation=g,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(g){this._edgeInsets.equals(g)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,g,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(g){return this._edgeInsets.equals(g)}interpolatePadding(g,A,q){this._unmodified=!1,this._edgeInsets.interpolate(g,A,q),this._constrain(),this._calcMatrices()}coveringZoomLevel(g){const A=(g.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/g.tileSize));return Math.max(0,A)}getVisibleUnwrappedCoordinates(g){const A=[new o.UnwrappedTileID(0,g)];if(this._renderWorldCopies){const q=this.pointCoordinate(new o.pointGeometry(0,0)),nt=this.pointCoordinate(new o.pointGeometry(this.width,0)),Ft=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),Xr=this.pointCoordinate(new o.pointGeometry(0,this.height)),ls=Math.floor(Math.min(q.x,nt.x,Ft.x,Xr.x)),Zs=Math.floor(Math.max(q.x,nt.x,Ft.x,Xr.x)),ol=1;for(let rh=ls-ol;rh<=Zs+ol;rh++)rh!==0&&A.push(new o.UnwrappedTileID(rh,g))}return A}coveringTiles(g){var A,q;let nt=this.coveringZoomLevel(g);const Ft=nt;if(g.minzoom!==void 0&&nt<g.minzoom)return[];g.maxzoom!==void 0&&nt>g.maxzoom&&(nt=g.maxzoom);const Xr=this.pointCoordinate(this.getCameraPoint()),ls=o.MercatorCoordinate.fromLngLat(this.center),Zs=Math.pow(2,nt),ol=[Zs*Xr.x,Zs*Xr.y,0],rh=[Zs*ls.x,Zs*ls.y,0],th=tp.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,nt);let ph=g.minzoom||0;!g.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ph=nt);const Dh=g.terrain?2/Math.min(this.tileSize,g.tileSize)*this.tileSize:3,$h=jh=>({aabb:new Wg([jh*Zs,0,0],[(jh+1)*Zs,Zs,0]),zoom:0,x:0,y:0,wrap:jh,fullyVisible:!1}),Mh=[],Kh=[],fd=nt,cd=g.reparseOverscaled?Ft:nt;if(this._renderWorldCopies)for(let jh=1;jh<=3;jh++)Mh.push($h(-jh)),Mh.push($h(jh));for(Mh.push($h(0));Mh.length>0;){const jh=Mh.pop(),Td=jh.x,Vd=jh.y;let Wd=jh.fullyVisible;if(!Wd){const E=jh.aabb.intersects(th);if(E===0)continue;Wd=E===2}const Mf=g.terrain?ol:rh,Of=jh.aabb.distanceX(Mf),L=jh.aabb.distanceY(Mf),u=Math.max(Math.abs(Of),Math.abs(L));if(jh.zoom===fd||u>Dh+(1<<fd-jh.zoom)-2&&jh.zoom>=ph){const E=fd-jh.zoom,B=ol[0]-.5-(Td<<E),_e=ol[1]-.5-(Vd<<E);Kh.push({tileID:new o.OverscaledTileID(jh.zoom===fd?cd:jh.zoom,jh.wrap,jh.zoom,Td,Vd),distanceSq:_h([rh[0]-.5-Td,rh[1]-.5-Vd]),tileDistanceToCamera:Math.sqrt(B*B+_e*_e)})}else for(let E=0;E<4;E++){const B=(Td<<1)+E%2,_e=(Vd<<1)+(E>>1),St=jh.zoom+1;let mr=jh.aabb.quadrant(E);if(g.terrain){const qr=new o.OverscaledTileID(St,jh.wrap,St,B,_e),ss=g.terrain.getMinMaxElevation(qr),tl=(A=ss.minElevation)!==null&&A!==void 0?A:this.elevation,il=(q=ss.maxElevation)!==null&&q!==void 0?q:this.elevation;mr=new Wg([mr.min[0],mr.min[1],tl],[mr.max[0],mr.max[1],il])}Mh.push({aabb:mr,zoom:St,x:B,y:_e,wrap:jh.wrap,fullyVisible:Wd})}}return Kh.sort((jh,Td)=>jh.distanceSq-Td.distanceSq).map(jh=>jh.tileID)}resize(g,A){this.width=g,this.height=A,this.pixelsToGLUnits=[2/g,-2/A],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(g){return Math.pow(2,g)}scaleZoom(g){return Math.log(g)/Math.LN2}project(g){const A=o.clamp(g.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(g.lng)*this.worldSize,o.mercatorYfromLat(A)*this.worldSize)}unproject(g){return new o.MercatorCoordinate(g.x/this.worldSize,g.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(g){this.freezeElevation||(this.elevation=g?this.getElevation(this._center,g):0)}getElevation(g,A){const q=o.MercatorCoordinate.fromLngLat(g),nt=(1<<this.tileZoom)*o.EXTENT,Ft=q.x*nt,Xr=q.y*nt,ls=Math.floor(Ft/o.EXTENT),Zs=Math.floor(Xr/o.EXTENT),ol=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,ls,Zs);return A.getElevation(ol,Ft%o.EXTENT,Xr%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(g){const A=this.pointLocation(this.centerPoint,g),q=this.getElevation(A,g);if(!(this.elevation-q))return;const nt=this.getCameraPosition(),Ft=o.MercatorCoordinate.fromLngLat(nt.lngLat,nt.altitude),Xr=o.MercatorCoordinate.fromLngLat(A,q),ls=Ft.x-Xr.x,Zs=Ft.y-Xr.y,ol=Ft.z-Xr.z,rh=Math.sqrt(ls*ls+Zs*Zs+ol*ol),th=this.scaleZoom(this.cameraToCenterDistance/rh/this.tileSize);this._elevation=q,this._center=A,this.zoom=th}setLocationAtPoint(g,A){const q=this.pointCoordinate(A),nt=this.pointCoordinate(this.centerPoint),Ft=this.locationCoordinate(g),Xr=new o.MercatorCoordinate(Ft.x-(q.x-nt.x),Ft.y-(q.y-nt.y));this.center=this.coordinateLocation(Xr),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(g,A){return A?this.coordinatePoint(this.locationCoordinate(g),this.getElevation(g,A),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(g))}pointLocation(g,A){return this.coordinateLocation(this.pointCoordinate(g,A))}locationCoordinate(g){return o.MercatorCoordinate.fromLngLat(g)}coordinateLocation(g){return g&&g.toLngLat()}pointCoordinate(g,A){if(A){const ph=A.pointCoordinate(g);if(ph!=null)return ph}const q=[g.x,g.y,0,1],nt=[g.x,g.y,1,1];o.transformMat4(q,q,this.pixelMatrixInverse),o.transformMat4(nt,nt,this.pixelMatrixInverse);const Ft=q[3],Xr=nt[3],ls=q[1]/Ft,Zs=nt[1]/Xr,ol=q[2]/Ft,rh=nt[2]/Xr,th=ol===rh?0:(0-ol)/(rh-ol);return new o.MercatorCoordinate(o.number(q[0]/Ft,nt[0]/Xr,th)/this.worldSize,o.number(ls,Zs,th)/this.worldSize)}coordinatePoint(g,A=0,q=this.pixelMatrix){const nt=[g.x*this.worldSize,g.y*this.worldSize,A,1];return o.transformMat4(nt,nt,q),new o.pointGeometry(nt[0]/nt[3],nt[1]/nt[3])}getBounds(){const g=Math.max(0,this.height/2-this.getHorizon());return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,g))).extend(this.pointLocation(new o.pointGeometry(this.width,g))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(g){g?(this.lngRange=[g.getWest(),g.getEast()],this.latRange=[g.getSouth(),g.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(g,A=!1){const q=g.key,nt=A?this._alignedPosMatrixCache:this._posMatrixCache;if(nt[q])return nt[q];const Ft=g.canonical,Xr=this.worldSize/this.zoomScale(Ft.z),ls=Ft.x+Math.pow(2,Ft.z)*g.wrap,Zs=o.identity(new Float64Array(16));return o.translate(Zs,Zs,[ls*Xr,Ft.y*Xr,0]),o.scale(Zs,Zs,[Xr/o.EXTENT,Xr/o.EXTENT,1]),o.multiply(Zs,A?this.alignedProjMatrix:this.projMatrix,Zs),nt[q]=new Float32Array(Zs),nt[q]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let g,A,q,nt,Ft=-90,Xr=90,ls=-180,Zs=180;const ol=this.size,rh=this._unmodified;if(this.latRange){const Dh=this.latRange;Ft=o.mercatorYfromLat(Dh[1])*this.worldSize,Xr=o.mercatorYfromLat(Dh[0])*this.worldSize,g=Xr-Ft<ol.y?ol.y/(Xr-Ft):0}if(this.lngRange){const Dh=this.lngRange;ls=o.wrap(o.mercatorXfromLng(Dh[0])*this.worldSize,0,this.worldSize),Zs=o.wrap(o.mercatorXfromLng(Dh[1])*this.worldSize,0,this.worldSize),Zs<ls&&(Zs+=this.worldSize),A=Zs-ls<ol.x?ol.x/(Zs-ls):0}const th=this.point,ph=Math.max(A||0,g||0);if(ph)return this.center=this.unproject(new o.pointGeometry(A?(Zs+ls)/2:th.x,g?(Xr+Ft)/2:th.y)),this.zoom+=this.scaleZoom(ph),this._unmodified=rh,void(this._constraining=!1);if(this.latRange){const Dh=th.y,$h=ol.y/2;Dh-$h<Ft&&(nt=Ft+$h),Dh+$h>Xr&&(nt=Xr-$h)}if(this.lngRange){const Dh=(ls+Zs)/2,$h=o.wrap(th.x,Dh-this.worldSize/2,Dh+this.worldSize/2),Mh=ol.x/2;$h-Mh<ls&&(q=ls+Mh),$h+Mh>Zs&&(q=Zs-Mh)}q===void 0&&nt===void 0||(this.center=this.unproject(new o.pointGeometry(q!==void 0?q:th.x,nt!==void 0?nt:th.y)).wrap()),this._unmodified=rh,this._constraining=!1}_calcMatrices(){if(!this.height)return;const g=this.centerOffset,A=this.point.x,q=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let nt=o.identity(new Float64Array(16));o.scale(nt,nt,[this.width/2,-this.height/2,1]),o.translate(nt,nt,[1,-1,0]),this.labelPlaneMatrix=nt,nt=o.identity(new Float64Array(16)),o.scale(nt,nt,[1,-1,1]),o.translate(nt,nt,[-1,-1,0]),o.scale(nt,nt,[2/this.width,2/this.height,1]),this.glCoordMatrix=nt,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const Ft=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,Xr=Math.PI/2+this._pitch,ls=this._fov*(.5+g.y/this.height),Zs=Math.sin(ls)*Ft/Math.sin(o.clamp(Math.PI-Xr-ls,.01,Math.PI-.01)),ol=this.getHorizon(),rh=2*Math.atan(ol/this.cameraToCenterDistance)*(.5+g.y/(2*ol)),th=Math.sin(rh)*Ft/Math.sin(o.clamp(Math.PI-Xr-rh,.01,Math.PI-.01)),ph=Math.min(Zs,th),Dh=1.01*(Math.cos(Math.PI/2-this._pitch)*ph+Ft),$h=this.height/50;nt=new Float64Array(16),o.perspective(nt,this._fov,this.width/this.height,$h,Dh),nt[8]=2*-g.x/this.width,nt[9]=2*g.y/this.height,o.scale(nt,nt,[1,-1,1]),o.translate(nt,nt,[0,0,-this.cameraToCenterDistance]),o.rotateX(nt,nt,this._pitch),o.rotateZ(nt,nt,this.angle),o.translate(nt,nt,[-A,-q,0]),this.mercatorMatrix=o.scale([],nt,[this.worldSize,this.worldSize,this.worldSize]),o.scale(nt,nt,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,nt),o.translate(nt,nt,[0,0,-this.elevation]),this.projMatrix=nt,this.invProjMatrix=o.invert([],nt),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,nt);const Mh=this.width%2/2,Kh=this.height%2/2,fd=Math.cos(this.angle),cd=Math.sin(this.angle),jh=A-Math.round(A)+fd*Mh+cd*Kh,Td=q-Math.round(q)+fd*Kh+cd*Mh,Vd=new Float64Array(nt);if(o.translate(Vd,Vd,[jh>.5?jh-1:jh,Td>.5?Td-1:Td,0]),this.alignedProjMatrix=Vd,nt=o.invert(new Float64Array(16),this.pixelMatrix),!nt)throw new Error("failed to invert matrix");this.pixelMatrixInverse=nt,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const g=this.pointCoordinate(new o.pointGeometry(0,0)),A=[g.x*this.worldSize,g.y*this.worldSize,0,1];return o.transformMat4(A,A,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const g=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,g))}getCameraQueryGeometry(g){const A=this.getCameraPoint();if(g.length===1)return[g[0],A];{let q=A.x,nt=A.y,Ft=A.x,Xr=A.y;for(const ls of g)q=Math.min(q,ls.x),nt=Math.min(nt,ls.y),Ft=Math.max(Ft,ls.x),Xr=Math.max(Xr,ls.y);return[new o.pointGeometry(q,nt),new o.pointGeometry(Ft,nt),new o.pointGeometry(Ft,Xr),new o.pointGeometry(q,Xr),new o.pointGeometry(q,nt)]}}}class A_{constructor(g){this._hashName=g&&encodeURIComponent(g),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(A,q){let nt=!1,Ft=null;const Xr=()=>{Ft=null,nt&&(A(),Ft=setTimeout(Xr,300),nt=!1)};return()=>(nt=!0,Ft||Xr(),Ft)}(this._updateHashUnthrottled.bind(this))}addTo(g){return this._map=g,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(g){const A=this._map.getCenter(),q=Math.round(100*this._map.getZoom())/100,nt=Math.ceil((q*Math.LN2+Math.log(512/360/.5))/Math.LN10),Ft=Math.pow(10,nt),Xr=Math.round(A.lng*Ft)/Ft,ls=Math.round(A.lat*Ft)/Ft,Zs=this._map.getBearing(),ol=this._map.getPitch();let rh="";if(rh+=g?`/${Xr}/${ls}/${q}`:`${q}/${ls}/${Xr}`,(Zs||ol)&&(rh+="/"+Math.round(10*Zs)/10),ol&&(rh+=`/${Math.round(ol)}`),this._hashName){const th=this._hashName;let ph=!1;const Dh=window.location.hash.slice(1).split("&").map($h=>{const Mh=$h.split("=")[0];return Mh===th?(ph=!0,`${Mh}=${rh}`):$h}).filter($h=>$h);return ph||Dh.push(`${th}=${rh}`),`#${Dh.join("&")}`}return`#${rh}`}_getCurrentHash(){const g=window.location.hash.replace("#","");if(this._hashName){let A;return g.split("&").map(q=>q.split("=")).forEach(q=>{q[0]===this._hashName&&(A=q)}),(A&&A[1]||"").split("/")}return g.split("/")}_onHashChange(){const g=this._getCurrentHash();if(g.length>=3&&!g.some(A=>isNaN(A))){const A=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:A,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const g=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,g)}catch{}}}const sp={linearity:.3,easing:o.bezier(0,0,.3,1)},Zy=o.extend({deceleration:2500,maxSpeed:1400},sp),vy=o.extend({deceleration:20,maxSpeed:1400},sp),$0=o.extend({deceleration:1e3,maxSpeed:360},sp),g0=o.extend({deceleration:1e3,maxSpeed:90},sp);class ov{constructor(g){this._map=g,this.clear()}clear(){this._inertiaBuffer=[]}record(g){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:g})}_drainInertiaBuffer(){const g=this._inertiaBuffer,A=o.exported.now();for(;g.length>0&&A-g[0].time>160;)g.shift()}_onMoveEnd(g){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const A={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:Ft}of this._inertiaBuffer)A.zoom+=Ft.zoomDelta||0,A.bearing+=Ft.bearingDelta||0,A.pitch+=Ft.pitchDelta||0,Ft.panDelta&&A.pan._add(Ft.panDelta),Ft.around&&(A.around=Ft.around),Ft.pinchAround&&(A.pinchAround=Ft.pinchAround);const q=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,nt={};if(A.pan.mag()){const Ft=Mm(A.pan.mag(),q,o.extend({},Zy,g||{}));nt.offset=A.pan.mult(Ft.amount/A.pan.mag()),nt.center=this._map.transform.center,_0(nt,Ft)}if(A.zoom){const Ft=Mm(A.zoom,q,vy);nt.zoom=this._map.transform.zoom+Ft.amount,_0(nt,Ft)}if(A.bearing){const Ft=Mm(A.bearing,q,$0);nt.bearing=this._map.transform.bearing+o.clamp(Ft.amount,-179,179),_0(nt,Ft)}if(A.pitch){const Ft=Mm(A.pitch,q,g0);nt.pitch=this._map.transform.pitch+Ft.amount,_0(nt,Ft)}if(nt.zoom||nt.bearing){const Ft=A.pinchAround===void 0?A.around:A.pinchAround;nt.around=Ft?this._map.unproject(Ft):this._map.getCenter()}return this.clear(),o.extend(nt,{noMoveStart:!0})}}function _0(he,g){(!he.duration||he.duration<g.duration)&&(he.duration=g.duration,he.easing=g.easing)}function Mm(he,g,A){const{maxSpeed:q,linearity:nt,deceleration:Ft}=A,Xr=o.clamp(he*nt/(g/1e3),-q,q),ls=Math.abs(Xr)/(Ft*nt);return{easing:A.easing,duration:1e3*ls,amount:Xr*(ls/2)}}class am extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,q,nt={}){const Ft=ge.mousePos(A.getCanvasContainer(),q),Xr=A.unproject(Ft);super(g,o.extend({point:Ft,lngLat:Xr,originalEvent:q},nt)),this._defaultPrevented=!1,this.target=A}}class P_ extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,q){const nt=g==="touchend"?q.changedTouches:q.touches,Ft=ge.touchPos(A.getCanvasContainer(),nt),Xr=Ft.map(Zs=>A.unproject(Zs)),ls=Ft.reduce((Zs,ol,rh,th)=>Zs.add(ol.div(th.length)),new o.pointGeometry(0,0));super(g,{points:Ft,point:ls,lngLats:Xr,lngLat:A.unproject(ls),originalEvent:q}),this._defaultPrevented=!1}}class Ng extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,q){super(g,{originalEvent:q}),this._defaultPrevented=!1}}class W_{constructor(g,A){this._map=g,this._clickTolerance=A.clickTolerance}reset(){delete this._mousedownPos}wheel(g){return this._firePreventable(new Ng(g.type,this._map,g))}mousedown(g,A){return this._mousedownPos=A,this._firePreventable(new am(g.type,this._map,g))}mouseup(g){this._map.fire(new am(g.type,this._map,g))}click(g,A){this._mousedownPos&&this._mousedownPos.dist(A)>=this._clickTolerance||this._map.fire(new am(g.type,this._map,g))}dblclick(g){return this._firePreventable(new am(g.type,this._map,g))}mouseover(g){this._map.fire(new am(g.type,this._map,g))}mouseout(g){this._map.fire(new am(g.type,this._map,g))}touchstart(g){return this._firePreventable(new P_(g.type,this._map,g))}touchmove(g){this._map.fire(new P_(g.type,this._map,g))}touchend(g){this._map.fire(new P_(g.type,this._map,g))}touchcancel(g){this._map.fire(new P_(g.type,this._map,g))}_firePreventable(g){if(this._map.fire(g),g.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dg{constructor(g){this._map=g}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(g){this._map.fire(new am(g.type,this._map,g))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new am("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(g){this._delayContextMenu?this._contextMenuEvent=g:this._ignoreContextMenu||this._map.fire(new am(g.type,this._map,g)),this._map.listens("contextmenu")&&g.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gm{constructor(g,A){this._map=g,this._el=g.getCanvasContainer(),this._container=g.getContainer(),this._clickTolerance=A.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(g,A){this.isEnabled()&&g.shiftKey&&g.button===0&&(ge.disableDrag(),this._startPos=this._lastPos=A,this._active=!0)}mousemoveWindow(g,A){if(!this._active)return;const q=A;if(this._lastPos.equals(q)||!this._box&&q.dist(this._startPos)<this._clickTolerance)return;const nt=this._startPos;this._lastPos=q,this._box||(this._box=ge.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",g));const Ft=Math.min(nt.x,q.x),Xr=Math.max(nt.x,q.x),ls=Math.min(nt.y,q.y),Zs=Math.max(nt.y,q.y);ge.setTransform(this._box,`translate(${Ft}px,${ls}px)`),this._box.style.width=Xr-Ft+"px",this._box.style.height=Zs-ls+"px"}mouseupWindow(g,A){if(!this._active||g.button!==0)return;const q=this._startPos,nt=A;if(this.reset(),ge.suppressClick(),q.x!==nt.x||q.y!==nt.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:g})),{cameraAnimation:Ft=>Ft.fitScreenCoordinates(q,nt,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",g)}keydown(g){this._active&&g.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",g))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ge.remove(this._box),this._box=null),ge.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(g,A){return this._map.fire(new o.Event(g,{originalEvent:A}))}}function sg(he,g){if(he.length!==g.length)throw new Error(`The number of touches and points are not equal - touches ${he.length}, points ${g.length}`);const A={};for(let q=0;q<he.length;q++)A[he[q].identifier]=g[q];return A}class Jg{constructor(g){this.reset(),this.numTouches=g.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(g,A,q){(this.centroid||q.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=g.timeStamp),q.length===this.numTouches&&(this.centroid=function(nt){const Ft=new o.pointGeometry(0,0);for(const Xr of nt)Ft._add(Xr);return Ft.div(nt.length)}(A),this.touches=sg(q,A)))}touchmove(g,A,q){if(this.aborted||!this.centroid)return;const nt=sg(q,A);for(const Ft in this.touches){const Xr=nt[Ft];(!Xr||Xr.dist(this.touches[Ft])>30)&&(this.aborted=!0)}}touchend(g,A,q){if((!this.centroid||g.timeStamp-this.startTime>500)&&(this.aborted=!0),q.length===0){const nt=!this.aborted&&this.centroid;if(this.reset(),nt)return nt}}}class k_{constructor(g){this.singleTap=new Jg(g),this.numTaps=g.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(g,A,q){this.singleTap.touchstart(g,A,q)}touchmove(g,A,q){this.singleTap.touchmove(g,A,q)}touchend(g,A,q){const nt=this.singleTap.touchend(g,A,q);if(nt){const Ft=g.timeStamp-this.lastTime<500,Xr=!this.lastTap||this.lastTap.dist(nt)<30;if(Ft&&Xr||this.reset(),this.count++,this.lastTime=g.timeStamp,this.lastTap=nt,this.count===this.numTaps)return this.reset(),nt}}}class em{constructor(){this._zoomIn=new k_({numTouches:1,numTaps:2}),this._zoomOut=new k_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(g,A,q){this._zoomIn.touchstart(g,A,q),this._zoomOut.touchstart(g,A,q)}touchmove(g,A,q){this._zoomIn.touchmove(g,A,q),this._zoomOut.touchmove(g,A,q)}touchend(g,A,q){const nt=this._zoomIn.touchend(g,A,q),Ft=this._zoomOut.touchend(g,A,q);return nt?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Xr=>Xr.easeTo({duration:300,zoom:Xr.getZoom()+1,around:Xr.unproject(nt)},{originalEvent:g})}):Ft?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Xr=>Xr.easeTo({duration:300,zoom:Xr.getZoom()-1,around:Xr.unproject(Ft)},{originalEvent:g})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gg{constructor(g){this._enabled=!!g.enable,this._moveStateManager=g.moveStateManager,this._clickTolerance=g.clickTolerance||1,this._moveFunction=g.move,this._activateOnStart=!!g.activateOnStart,g.assignEvents(this),this.reset()}reset(g){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(g)}_move(...g){const A=this._moveFunction(...g);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(g,A){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(g)&&(this._moveStateManager.startMove(g),this._lastPoint=A.length?A[0]:A,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(g,A){if(!this.isEnabled())return;const q=this._lastPoint;if(!q)return;if(g.preventDefault(),!this._moveStateManager.isValidMoveEvent(g))return void this.reset(g);const nt=A.length?A[0]:A;return!this._moved&&nt.dist(q)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=nt,this._move(q,nt))}dragEnd(g){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(g)&&(this._moved&&ge.suppressClick(),this.reset(g))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const bv={0:1,2:2};class Ig{constructor(g){this._correctEvent=g.checkCorrectEvent}startMove(g){const A=ge.mouseButton(g);this._eventButton=A}endMove(g){delete this._eventButton}isValidStartEvent(g){return this._correctEvent(g)}isValidMoveEvent(g){return!function(A,q){const nt=bv[q];return A.buttons===void 0||(A.buttons&nt)!==nt}(g,this._eventButton)}isValidEndEvent(g){return ge.mouseButton(g)===this._eventButton}}class Cm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(g){return g.targetTouches.length===1}_isSameTouchEvent(g){return g.targetTouches[0].identifier===this._firstTouch}startMove(g){this._firstTouch=g.targetTouches[0].identifier}endMove(g){delete this._firstTouch}isValidStartEvent(g){return this._isOneFingerTouch(g)}isValidMoveEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}isValidEndEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}}const D_=he=>{he.mousedown=he.dragStart,he.mousemoveWindow=he.dragMove,he.mouseup=he.dragEnd,he.contextmenu=function(g){g.preventDefault()}},xy=({enable:he,clickTolerance:g,bearingDegreesPerPixelMoved:A=.8})=>{const q=new Ig({checkCorrectEvent:nt=>ge.mouseButton(nt)===0&&nt.ctrlKey||ge.mouseButton(nt)===2});return new Gg({clickTolerance:g,move:(nt,Ft)=>({bearingDelta:(Ft.x-nt.x)*A}),moveStateManager:q,enable:he,assignEvents:D_})},Hy=({enable:he,clickTolerance:g,pitchDegreesPerPixelMoved:A=-.5})=>{const q=new Ig({checkCorrectEvent:nt=>ge.mouseButton(nt)===0&&nt.ctrlKey||ge.mouseButton(nt)===2});return new Gg({clickTolerance:g,move:(nt,Ft)=>({pitchDelta:(Ft.y-nt.y)*A}),moveStateManager:q,enable:he,assignEvents:D_})};class y0{constructor(g,A){this._minTouches=g.cooperativeGestures?2:1,this._clickTolerance=g.clickTolerance||1,this._map=A,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(g,A,q){return this._calculateTransform(g,A,q)}touchmove(g,A,q){if(this._map._cooperativeGestures&&(this._minTouches===2&&q.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(g,!1,q.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(q.length<this._minTouches))return g.preventDefault(),this._calculateTransform(g,A,q)}touchend(g,A,q){this._calculateTransform(g,A,q),this._active&&q.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(g,A,q){q.length>0&&(this._active=!0);const nt=sg(q,A),Ft=new o.pointGeometry(0,0),Xr=new o.pointGeometry(0,0);let ls=0;for(const ol in nt){const rh=nt[ol],th=this._touches[ol];th&&(Ft._add(rh),Xr._add(rh.sub(th)),ls++,nt[ol]=rh)}if(this._touches=nt,ls<this._minTouches||!Xr.mag())return;const Zs=Xr.div(ls);return this._sum._add(Zs),this._sum.mag()<this._clickTolerance?void 0:{around:Ft.div(ls),panDelta:Zs}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Y_{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(g){}_move(g,A,q){return{}}touchstart(g,A,q){this._firstTwoTouches||q.length<2||(this._firstTwoTouches=[q[0].identifier,q[1].identifier],this._start([A[0],A[1]]))}touchmove(g,A,q){if(!this._firstTwoTouches)return;g.preventDefault();const[nt,Ft]=this._firstTwoTouches,Xr=Xy(q,A,nt),ls=Xy(q,A,Ft);if(!Xr||!ls)return;const Zs=this._aroundCenter?null:Xr.add(ls).div(2);return this._move([Xr,ls],Zs,g)}touchend(g,A,q){if(!this._firstTwoTouches)return;const[nt,Ft]=this._firstTwoTouches,Xr=Xy(q,A,nt),ls=Xy(q,A,Ft);Xr&&ls||(this._active&&ge.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(g){this._enabled=!0,this._aroundCenter=!!g&&g.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xy(he,g,A){for(let q=0;q<he.length;q++)if(he[q].identifier===A)return g[q]}function e_(he,g){return Math.log(he/g)/Math.LN2}class B0 extends Y_{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(g){this._startDistance=this._distance=g[0].dist(g[1])}_move(g,A){const q=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(e_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:e_(this._distance,q),pinchAround:A}}}function kp(he,g){return 180*he.angleWith(g)/Math.PI}class Up extends Y_{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])}_move(g,A){const q=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:kp(this._vector,q),pinchAround:A}}_isBelowThreshold(g){this._minDiameter=Math.min(this._minDiameter,g.mag());const A=25/(Math.PI*this._minDiameter)*360,q=kp(g,this._startVector);return Math.abs(q)<A}}function by(he){return Math.abs(he.y)>Math.abs(he.x)}class N0 extends Y_{constructor(g){super(),this._map=g}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(g,A,q){super.touchstart(g,A,q),this._currentTouchCount=q.length}_start(g){this._lastPoints=g,by(g[0].sub(g[1]))&&(this._valid=!1)}_move(g,A,q){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const nt=g[0].sub(this._lastPoints[0]),Ft=g[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(nt,Ft,q.timeStamp),this._valid?(this._lastPoints=g,this._active=!0,{pitchDelta:(nt.y+Ft.y)/2*-.5}):void 0}gestureBeginsVertically(g,A,q){if(this._valid!==void 0)return this._valid;const nt=g.mag()>=2,Ft=A.mag()>=2;if(!nt&&!Ft)return;if(!nt||!Ft)return this._firstMove===void 0&&(this._firstMove=q),q-this._firstMove<100&&void 0;const Xr=g.y>0==A.y>0;return by(g)&&by(A)&&Xr}}const pp={panStep:100,bearingStep:15,pitchStep:10};class tg{constructor(){const g=pp;this._panStep=g.panStep,this._bearingStep=g.bearingStep,this._pitchStep=g.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(g){if(g.altKey||g.ctrlKey||g.metaKey)return;let A=0,q=0,nt=0,Ft=0,Xr=0;switch(g.keyCode){case 61:case 107:case 171:case 187:A=1;break;case 189:case 109:case 173:A=-1;break;case 37:g.shiftKey?q=-1:(g.preventDefault(),Ft=-1);break;case 39:g.shiftKey?q=1:(g.preventDefault(),Ft=1);break;case 38:g.shiftKey?nt=1:(g.preventDefault(),Xr=-1);break;case 40:g.shiftKey?nt=-1:(g.preventDefault(),Xr=1);break;default:return}return this._rotationDisabled&&(q=0,nt=0),{cameraAnimation:ls=>{const Zs=ls.getZoom();ls.easeTo({duration:300,easeId:"keyboardHandler",easing:wv,zoom:A?Math.round(Zs)+A*(g.shiftKey?2:1):Zs,bearing:ls.getBearing()+q*this._bearingStep,pitch:ls.getPitch()+nt*this._pitchStep,offset:[-Ft*this._panStep,-Xr*this._panStep],center:ls.getCenter()},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wv(he){return he*(2-he)}const L_=4.000244140625;class Ev{constructor(g,A){this._map=g,this._el=g.getCanvasContainer(),this._handler=A,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(g){this._defaultZoomRate=g}setWheelZoomRate(g){this._wheelZoomRate=g}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(g){this.isEnabled()||(this._enabled=!0,this._aroundCenter=g&&g.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(g){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;g.preventDefault()}let A=g.deltaMode===WheelEvent.DOM_DELTA_LINE?40*g.deltaY:g.deltaY;const q=o.exported.now(),nt=q-(this._lastWheelEventTime||0);this._lastWheelEventTime=q,A!==0&&A%L_==0?this._type="wheel":A!==0&&Math.abs(A)<4?this._type="trackpad":nt>400?(this._type=null,this._lastValue=A,this._timeout=setTimeout(this._onTimeout,40,g)):this._type||(this._type=Math.abs(nt*A)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,A+=this._lastValue)),g.shiftKey&&A&&(A/=4),this._type&&(this._lastWheelEvent=g,this._delta-=A,this._active||this._start(g)),g.preventDefault()}_onTimeout(g){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)}_start(g){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const A=ge.mousePos(this._el,g);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(A)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const g=this._map.transform;if(this._delta!==0){const ls=this._type==="wheel"&&Math.abs(this._delta)>L_?this._wheelZoomRate:this._defaultZoomRate;let Zs=2/(1+Math.exp(-Math.abs(this._delta*ls)));this._delta<0&&Zs!==0&&(Zs=1/Zs);const ol=typeof this._targetZoom=="number"?g.zoomScale(this._targetZoom):g.scale;this._targetZoom=Math.min(g.maxZoom,Math.max(g.minZoom,g.scaleZoom(ol*Zs))),this._type==="wheel"&&(this._startZoom=g.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const A=typeof this._targetZoom=="number"?this._targetZoom:g.zoom,q=this._startZoom,nt=this._easing;let Ft,Xr=!1;if(this._type==="wheel"&&q&&nt){const ls=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),Zs=nt(ls);Ft=o.number(q,A,Zs),ls<1?this._frameId||(this._frameId=!0):Xr=!0}else Ft=A,Xr=!0;return this._active=!0,Xr&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Xr,zoomDelta:Ft-g.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(g){let A=o.ease;if(this._prevEase){const q=this._prevEase,nt=(o.exported.now()-q.start)/q.duration,Ft=q.easing(nt+.01)-q.easing(nt),Xr=.27/Math.sqrt(Ft*Ft+1e-4)*.01,ls=Math.sqrt(.0729-Xr*Xr);A=o.bezier(Xr,ls,.25,1)}return this._prevEase={start:o.exported.now(),duration:g,easing:A},A}reset(){this._active=!1}}class Wy{constructor(g,A){this._clickZoom=g,this._tapZoom=A}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pg{constructor(){this.reset()}reset(){this._active=!1}dblclick(g,A){return g.preventDefault(),{cameraAnimation:q=>{q.easeTo({duration:300,zoom:q.getZoom()+(g.shiftKey?-1:1),around:q.unproject(A)},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mg{constructor(){this._tap=new k_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(g,A,q){this._swipePoint||(this._tapTime&&g.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?q.length>0&&(this._swipePoint=A[0],this._swipeTouch=q[0].identifier):this._tap.touchstart(g,A,q))}touchmove(g,A,q){if(this._tapTime){if(this._swipePoint){if(q[0].identifier!==this._swipeTouch)return;const nt=A[0],Ft=nt.y-this._swipePoint.y;return this._swipePoint=nt,g.preventDefault(),this._active=!0,{zoomDelta:Ft/128}}}else this._tap.touchmove(g,A,q)}touchend(g,A,q){this._tapTime?this._swipePoint&&q.length===0&&this.reset():this._tap.touchend(g,A,q)&&(this._tapTime=g.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zv{constructor(g,A,q){this._el=g,this._mousePan=A,this._touchPan=q}enable(g){this._inertiaOptions=g||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class v0{constructor(g,A,q){this._pitchWithRotate=g.pitchWithRotate,this._mouseRotate=A,this._mousePitch=q}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class x0{constructor(g,A,q,nt){this._el=g,this._touchZoom=A,this._touchRotate=q,this._tapDragZoom=nt,this._rotationDisabled=!1,this._enabled=!0}enable(g){this._touchZoom.enable(g),this._rotationDisabled||this._touchRotate.enable(g),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wy=he=>he.zoom||he.drag||he.pitch||he.rotate;class Lg extends o.Event{}function b0(he){return he.panDelta&&he.panDelta.mag()||he.zoomDelta||he.bearingDelta||he.pitchDelta}class Tv{constructor(g,A){this._map=g,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ov(g),this._bearingSnap=A.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(A),o.bindAll(["handleEvent","handleWindowEvent"],this);const q=this._el;this._listeners=[[q,"touchstart",{passive:!0}],[q,"touchmove",{passive:!1}],[q,"touchend",void 0],[q,"touchcancel",void 0],[q,"mousedown",void 0],[q,"mousemove",void 0],[q,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[q,"mouseover",void 0],[q,"mouseout",void 0],[q,"dblclick",void 0],[q,"click",void 0],[q,"keydown",{capture:!1}],[q,"keyup",void 0],[q,"wheel",{passive:!1}],[q,"contextmenu",void 0],[window,"blur",void 0]];for(const[nt,Ft,Xr]of this._listeners)ge.addEventListener(nt,Ft,nt===document?this.handleWindowEvent:this.handleEvent,Xr)}destroy(){for(const[g,A,q]of this._listeners)ge.removeEventListener(g,A,g===document?this.handleWindowEvent:this.handleEvent,q)}_addDefaultHandlers(g){const A=this._map,q=A.getCanvasContainer();this._add("mapEvent",new W_(A,g));const nt=A.boxZoom=new Gm(A,g);this._add("boxZoom",nt);const Ft=new em,Xr=new pg;A.doubleClickZoom=new Wy(Xr,Ft),this._add("tapZoom",Ft),this._add("clickZoom",Xr);const ls=new mg;this._add("tapDragZoom",ls);const Zs=A.touchPitch=new N0(A);this._add("touchPitch",Zs);const ol=xy(g),rh=Hy(g);A.dragRotate=new v0(g,ol,rh),this._add("mouseRotate",ol,["mousePitch"]),this._add("mousePitch",rh,["mouseRotate"]);const th=(({enable:fd,clickTolerance:cd})=>{const jh=new Ig({checkCorrectEvent:Td=>ge.mouseButton(Td)===0&&!Td.ctrlKey});return new Gg({clickTolerance:cd,move:(Td,Vd)=>({around:Vd,panDelta:Vd.sub(Td)}),activateOnStart:!0,moveStateManager:jh,enable:fd,assignEvents:D_})})(g),ph=new y0(g,A);A.dragPan=new zv(q,th,ph),this._add("mousePan",th),this._add("touchPan",ph,["touchZoom","touchRotate"]);const Dh=new Up,$h=new B0;A.touchZoomRotate=new x0(q,$h,Dh,ls),this._add("touchRotate",Dh,["touchPan","touchZoom"]),this._add("touchZoom",$h,["touchPan","touchRotate"]);const Mh=A.scrollZoom=new Ev(A,this);this._add("scrollZoom",Mh,["mousePan"]);const Kh=A.keyboard=new tg;this._add("keyboard",Kh),this._add("blockableMapEvent",new Dg(A));for(const fd of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])g.interactive&&g[fd]&&A[fd].enable(g[fd])}_add(g,A,q){this._handlers.push({handlerName:g,handler:A,allowed:q}),this._handlersById[g]=A}stop(g){if(!this._updatingCamera){for(const{handler:A}of this._handlers)A.reset();this._inertia.clear(),this._fireEvents({},{},g),this._changes=[]}}isActive(){for(const{handler:g}of this._handlers)if(g.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wy(this._eventsInProgress)||this.isZooming()}_blockedByActive(g,A,q){for(const nt in g)if(nt!==q&&(!A||A.indexOf(nt)<0))return!0;return!1}handleWindowEvent(g){this.handleEvent(g,`${g.type}Window`)}_getMapTouches(g){const A=[];for(const q of g)this._el.contains(q.target)&&A.push(q);return A}handleEvent(g,A){if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const q=g.type==="renderFrame"?void 0:g,nt={needsRenderFrame:!1},Ft={},Xr={},ls=g.touches,Zs=ls?this._getMapTouches(ls):void 0,ol=Zs?ge.touchPos(this._el,Zs):ge.mousePos(this._el,g);for(const{handlerName:ph,handler:Dh,allowed:$h}of this._handlers){if(!Dh.isEnabled())continue;let Mh;this._blockedByActive(Xr,$h,ph)?Dh.reset():Dh[A||g.type]&&(Mh=Dh[A||g.type](g,ol,Zs),this.mergeHandlerResult(nt,Ft,Mh,ph,q),Mh&&Mh.needsRenderFrame&&this._triggerRenderFrame()),(Mh||Dh.isActive())&&(Xr[ph]=Dh)}const rh={};for(const ph in this._previousActiveHandlers)Xr[ph]||(rh[ph]=q);this._previousActiveHandlers=Xr,(Object.keys(rh).length||b0(nt))&&(this._changes.push([nt,Ft,rh]),this._triggerRenderFrame()),(Object.keys(Xr).length||b0(nt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:th}=nt;th&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],th(this._map))}mergeHandlerResult(g,A,q,nt,Ft){if(!q)return;o.extend(g,q);const Xr={handlerName:nt,originalEvent:q.originalEvent||Ft};q.zoomDelta!==void 0&&(A.zoom=Xr),q.panDelta!==void 0&&(A.drag=Xr),q.pitchDelta!==void 0&&(A.pitch=Xr),q.bearingDelta!==void 0&&(A.rotate=Xr)}_applyChanges(){const g={},A={},q={};for(const[nt,Ft,Xr]of this._changes)nt.panDelta&&(g.panDelta=(g.panDelta||new o.pointGeometry(0,0))._add(nt.panDelta)),nt.zoomDelta&&(g.zoomDelta=(g.zoomDelta||0)+nt.zoomDelta),nt.bearingDelta&&(g.bearingDelta=(g.bearingDelta||0)+nt.bearingDelta),nt.pitchDelta&&(g.pitchDelta=(g.pitchDelta||0)+nt.pitchDelta),nt.around!==void 0&&(g.around=nt.around),nt.pinchAround!==void 0&&(g.pinchAround=nt.pinchAround),nt.noInertia&&(g.noInertia=nt.noInertia),o.extend(A,Ft),o.extend(q,Xr);this._updateMapTransform(g,A,q),this._changes=[]}_updateMapTransform(g,A,q){const nt=this._map,Ft=nt.transform,Xr=nt.terrain;if(!(b0(g)||Xr&&this._terrainMovement))return this._fireEvents(A,q,!0);let{panDelta:ls,zoomDelta:Zs,bearingDelta:ol,pitchDelta:rh,around:th,pinchAround:ph}=g;ph!==void 0&&(th=ph),nt._stop(!0),th=th||nt.transform.centerPoint;const Dh=Ft.pointLocation(ls?th.sub(ls):th);ol&&(Ft.bearing+=ol),rh&&(Ft.pitch+=rh),Zs&&(Ft.zoom+=Zs),Xr?this._terrainMovement||!A.drag&&!A.zoom?A.drag&&this._terrainMovement?Ft.center=Ft.pointLocation(Ft.centerPoint.sub(ls)):Ft.setLocationAtPoint(Dh,th):(this._terrainMovement=!0,Ft.freezeElevation=!0,Ft.setLocationAtPoint(Dh,th),this._map.once("moveend",()=>{Ft.freezeElevation=!1,this._terrainMovement=!1,Ft.recalculateZoom(nt.terrain)})):Ft.setLocationAtPoint(Dh,th),this._map._update(),g.noInertia||this._inertia.record(g),this._fireEvents(A,q,!0)}_fireEvents(g,A,q){const nt=wy(this._eventsInProgress),Ft=wy(g),Xr={};for(const rh in g){const{originalEvent:th}=g[rh];this._eventsInProgress[rh]||(Xr[`${rh}start`]=th),this._eventsInProgress[rh]=g[rh]}!nt&&Ft&&this._fireEvent("movestart",Ft.originalEvent);for(const rh in Xr)this._fireEvent(rh,Xr[rh]);Ft&&this._fireEvent("move",Ft.originalEvent);for(const rh in g){const{originalEvent:th}=g[rh];this._fireEvent(rh,th)}const ls={};let Zs;for(const rh in this._eventsInProgress){const{handlerName:th,originalEvent:ph}=this._eventsInProgress[rh];this._handlersById[th].isActive()||(delete this._eventsInProgress[rh],Zs=A[th]||ph,ls[`${rh}end`]=Zs)}for(const rh in ls)this._fireEvent(rh,ls[rh]);const ol=wy(this._eventsInProgress);if(q&&(nt||Ft)&&!ol){this._updatingCamera=!0;const rh=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),th=ph=>ph!==0&&-this._bearingSnap<ph&&ph<this._bearingSnap;rh?(th(rh.bearing||this._map.getBearing())&&(rh.bearing=0),rh.freezeElevation=!0,this._map.easeTo(rh,{originalEvent:Zs})):(this._map.fire(new o.Event("moveend",{originalEvent:Zs})),th(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(g,A){this._map.fire(new o.Event(g,A?{originalEvent:A}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(g=>{delete this._frameId,this.handleEvent(new Lg("renderFrame",{timeStamp:g})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Fv={extend:(he,...g)=>o.extend(he,...g),run(he){he()},logToElement(he,g=!1,A="log"){const q=window.document.getElementById(A);q&&(g&&(q.innerHTML=""),q.innerHTML+=`<br>${he}`)}};class av extends o.Evented{constructor(g,A){super(),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=A.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(g,A){return this.jumpTo({center:g},A)}panBy(g,A,q){return g=o.pointGeometry.convert(g).mult(-1),this.panTo(this.transform.center,o.extend({offset:g},A),q)}panTo(g,A,q){return this.easeTo(o.extend({center:g},A),q)}getZoom(){return this.transform.zoom}setZoom(g,A){return this.jumpTo({zoom:g},A),this}zoomTo(g,A,q){return this.easeTo(o.extend({zoom:g},A),q)}zoomIn(g,A){return this.zoomTo(this.getZoom()+1,g,A),this}zoomOut(g,A){return this.zoomTo(this.getZoom()-1,g,A),this}getBearing(){return this.transform.bearing}setBearing(g,A){return this.jumpTo({bearing:g},A),this}getPadding(){return this.transform.padding}setPadding(g,A){return this.jumpTo({padding:g},A),this}rotateTo(g,A,q){return this.easeTo(o.extend({bearing:g},A),q)}resetNorth(g,A){return this.rotateTo(0,o.extend({duration:1e3},g),A),this}resetNorthPitch(g,A){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},g),A),this}snapToNorth(g,A){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,A):this}getPitch(){return this.transform.pitch}setPitch(g,A){return this.jumpTo({pitch:g},A),this}cameraForBounds(g,A){g=o.LngLatBounds.convert(g);const q=A&&A.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),q,A)}_cameraForBoxAndBearing(g,A,q,nt){const Ft={top:0,bottom:0,right:0,left:0};if(typeof(nt=o.extend({padding:Ft,offset:[0,0],maxZoom:this.transform.maxZoom},nt)).padding=="number"){const Vd=nt.padding;nt.padding={top:Vd,bottom:Vd,right:Vd,left:Vd}}nt.padding=o.extend(Ft,nt.padding);const Xr=this.transform,ls=Xr.padding,Zs=Xr.project(o.LngLat.convert(g)),ol=Xr.project(o.LngLat.convert(A)),rh=Zs.rotate(-q*Math.PI/180),th=ol.rotate(-q*Math.PI/180),ph=new o.pointGeometry(Math.max(rh.x,th.x),Math.max(rh.y,th.y)),Dh=new o.pointGeometry(Math.min(rh.x,th.x),Math.min(rh.y,th.y)),$h=ph.sub(Dh),Mh=(Xr.width-(ls.left+ls.right+nt.padding.left+nt.padding.right))/$h.x,Kh=(Xr.height-(ls.top+ls.bottom+nt.padding.top+nt.padding.bottom))/$h.y;if(Kh<0||Mh<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const fd=Math.min(Xr.scaleZoom(Xr.scale*Math.min(Mh,Kh)),nt.maxZoom),cd=o.pointGeometry.convert(nt.offset),jh=new o.pointGeometry((nt.padding.left-nt.padding.right)/2,(nt.padding.top-nt.padding.bottom)/2).rotate(q*Math.PI/180),Td=cd.add(jh).mult(Xr.scale/Xr.zoomScale(fd));return{center:Xr.unproject(Zs.add(ol).div(2).sub(Td)),zoom:fd,bearing:q}}fitBounds(g,A,q){return this._fitInternal(this.cameraForBounds(g,A),A,q)}fitScreenCoordinates(g,A,q,nt,Ft){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(g)),this.transform.pointLocation(o.pointGeometry.convert(A)),q,nt),nt,Ft)}_fitInternal(g,A,q){return g?(delete(A=o.extend(g,A)).padding,A.linear?this.easeTo(A,q):this.flyTo(A,q)):this}jumpTo(g,A){this.stop();const q=this.transform;let nt=!1,Ft=!1,Xr=!1;return"zoom"in g&&q.zoom!==+g.zoom&&(nt=!0,q.zoom=+g.zoom),g.center!==void 0&&(q.center=o.LngLat.convert(g.center)),"bearing"in g&&q.bearing!==+g.bearing&&(Ft=!0,q.bearing=+g.bearing),"pitch"in g&&q.pitch!==+g.pitch&&(Xr=!0,q.pitch=+g.pitch),g.padding==null||q.isPaddingEqual(g.padding)||(q.padding=g.padding),this.fire(new o.Event("movestart",A)).fire(new o.Event("move",A)),nt&&this.fire(new o.Event("zoomstart",A)).fire(new o.Event("zoom",A)).fire(new o.Event("zoomend",A)),Ft&&this.fire(new o.Event("rotatestart",A)).fire(new o.Event("rotate",A)).fire(new o.Event("rotateend",A)),Xr&&this.fire(new o.Event("pitchstart",A)).fire(new o.Event("pitch",A)).fire(new o.Event("pitchend",A)),this.fire(new o.Event("moveend",A))}calculateCameraOptionsFromTo(g,A,q,nt=0){const Ft=o.MercatorCoordinate.fromLngLat(g,A),Xr=o.MercatorCoordinate.fromLngLat(q,nt),ls=Xr.x-Ft.x,Zs=Xr.y-Ft.y,ol=Xr.z-Ft.z,rh=Math.hypot(ls,Zs,ol);if(rh===0)throw new Error("Can't calculate camera options with same From and To");const th=Math.hypot(ls,Zs),ph=this.transform.scaleZoom(this.transform.cameraToCenterDistance/rh/this.transform.tileSize),Dh=180*Math.atan2(ls,-Zs)/Math.PI;let $h=180*Math.acos(th/rh)/Math.PI;return $h=ol<0?90-$h:90+$h,{center:Xr.toLngLat(),zoom:ph,pitch:$h,bearing:Dh}}easeTo(g,A){this._stop(!1,g.easeId),((g=o.extend({offset:[0,0],duration:500,easing:o.ease},g)).animate===!1||!g.essential&&o.exported.prefersReducedMotion)&&(g.duration=0);const q=this.transform,nt=this.getZoom(),Ft=this.getBearing(),Xr=this.getPitch(),ls=this.getPadding(),Zs="zoom"in g?+g.zoom:nt,ol="bearing"in g?this._normalizeBearing(g.bearing,Ft):Ft,rh="pitch"in g?+g.pitch:Xr,th="padding"in g?g.padding:q.padding,ph=o.pointGeometry.convert(g.offset);let Dh=q.centerPoint.add(ph);const $h=q.pointLocation(Dh),Mh=o.LngLat.convert(g.center||$h);this._normalizeCenter(Mh);const Kh=q.project($h),fd=q.project(Mh).sub(Kh),cd=q.zoomScale(Zs-nt);let jh,Td;g.around&&(jh=o.LngLat.convert(g.around),Td=q.locationPoint(jh));const Vd={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Zs!==nt,this._rotating=this._rotating||Ft!==ol,this._pitching=this._pitching||rh!==Xr,this._padding=!q.isPaddingEqual(th),this._easeId=g.easeId,this._prepareEase(A,g.noMoveStart,Vd),this.terrain&&this._prepareElevation(Mh),this._ease(Wd=>{if(this._zooming&&(q.zoom=o.number(nt,Zs,Wd)),this._rotating&&(q.bearing=o.number(Ft,ol,Wd)),this._pitching&&(q.pitch=o.number(Xr,rh,Wd)),this._padding&&(q.interpolatePadding(ls,th,Wd),Dh=q.centerPoint.add(ph)),this.terrain&&!g.freezeElevation&&this._updateElevation(Wd),jh)q.setLocationAtPoint(jh,Td);else{const Mf=q.zoomScale(q.zoom-nt),Of=Zs>nt?Math.min(2,cd):Math.max(.5,cd),L=Math.pow(Of,1-Wd),u=q.unproject(Kh.add(fd.mult(Wd*L)).mult(Mf));q.setLocationAtPoint(q.renderWorldCopies?u.wrap():u,Dh)}this._fireMoveEvents(A)},Wd=>{this.terrain&&this._finalizeElevation(),this._afterEase(A,Wd)},g),this}_prepareEase(g,A,q={}){this._moving=!0,A||q.moving||this.fire(new o.Event("movestart",g)),this._zooming&&!q.zooming&&this.fire(new o.Event("zoomstart",g)),this._rotating&&!q.rotating&&this.fire(new o.Event("rotatestart",g)),this._pitching&&!q.pitching&&this.fire(new o.Event("pitchstart",g))}_prepareElevation(g){this._elevationCenter=g,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(g,this.terrain),this.transform.freezeElevation=!0}_updateElevation(g){const A=this.transform.getElevation(this._elevationCenter,this.terrain);if(g<1&&A!==this._elevationTarget){const q=this._elevationTarget-this._elevationStart;this._elevationStart+=g*(q-(A-(q*g+this._elevationStart))/(1-g)),this._elevationTarget=A}this.transform.elevation=o.number(this._elevationStart,this._elevationTarget,g)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_fireMoveEvents(g){this.fire(new o.Event("move",g)),this._zooming&&this.fire(new o.Event("zoom",g)),this._rotating&&this.fire(new o.Event("rotate",g)),this._pitching&&this.fire(new o.Event("pitch",g))}_afterEase(g,A){if(this._easeId&&A&&this._easeId===A)return;delete this._easeId;const q=this._zooming,nt=this._rotating,Ft=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,q&&this.fire(new o.Event("zoomend",g)),nt&&this.fire(new o.Event("rotateend",g)),Ft&&this.fire(new o.Event("pitchend",g)),this.fire(new o.Event("moveend",g))}flyTo(g,A){if(!g.essential&&o.exported.prefersReducedMotion){const mr=o.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo(mr,A)}this.stop(),g=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},g);const q=this.transform,nt=this.getZoom(),Ft=this.getBearing(),Xr=this.getPitch(),ls=this.getPadding(),Zs="zoom"in g?o.clamp(+g.zoom,q.minZoom,q.maxZoom):nt,ol="bearing"in g?this._normalizeBearing(g.bearing,Ft):Ft,rh="pitch"in g?+g.pitch:Xr,th="padding"in g?g.padding:q.padding,ph=q.zoomScale(Zs-nt),Dh=o.pointGeometry.convert(g.offset);let $h=q.centerPoint.add(Dh);const Mh=q.pointLocation($h),Kh=o.LngLat.convert(g.center||Mh);this._normalizeCenter(Kh);const fd=q.project(Mh),cd=q.project(Kh).sub(fd);let jh=g.curve;const Td=Math.max(q.width,q.height),Vd=Td/ph,Wd=cd.mag();if("minZoom"in g){const mr=o.clamp(Math.min(g.minZoom,nt,Zs),q.minZoom,q.maxZoom),qr=Td/q.zoomScale(mr-nt);jh=Math.sqrt(qr/Wd*2)}const Mf=jh*jh;function Of(mr){const qr=(Vd*Vd-Td*Td+(mr?-1:1)*Mf*Mf*Wd*Wd)/(2*(mr?Vd:Td)*Mf*Wd);return Math.log(Math.sqrt(qr*qr+1)-qr)}function L(mr){return(Math.exp(mr)-Math.exp(-mr))/2}function u(mr){return(Math.exp(mr)+Math.exp(-mr))/2}const E=Of(0);let B=function(mr){return u(E)/u(E+jh*mr)},_e=function(mr){return Td*((u(E)*(L(qr=E+jh*mr)/u(qr))-L(E))/Mf)/Wd;var qr},St=(Of(1)-E)/jh;if(Math.abs(Wd)<1e-6||!isFinite(St)){if(Math.abs(Td-Vd)<1e-6)return this.easeTo(g,A);const mr=Vd<Td?-1:1;St=Math.abs(Math.log(Vd/Td))/jh,_e=function(){return 0},B=function(qr){return Math.exp(mr*jh*qr)}}return g.duration="duration"in g?+g.duration:1e3*St/("screenSpeed"in g?+g.screenSpeed/jh:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=Ft!==ol,this._pitching=rh!==Xr,this._padding=!q.isPaddingEqual(th),this._prepareEase(A,!1),this.terrain&&this._prepareElevation(Kh),this._ease(mr=>{const qr=mr*St,ss=1/B(qr);q.zoom=mr===1?Zs:nt+q.scaleZoom(ss),this._rotating&&(q.bearing=o.number(Ft,ol,mr)),this._pitching&&(q.pitch=o.number(Xr,rh,mr)),this._padding&&(q.interpolatePadding(ls,th,mr),$h=q.centerPoint.add(Dh)),this.terrain&&!g.freezeElevation&&this._updateElevation(mr);const tl=mr===1?Kh:q.unproject(fd.add(cd.mult(_e(qr))).mult(ss));q.setLocationAtPoint(q.renderWorldCopies?tl.wrap():tl,$h),this._fireMoveEvents(A)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(A)},g),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(g,A){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const q=this._onEaseEnd;delete this._onEaseEnd,q.call(this,A)}if(!g){const q=this.handlers;q&&q.stop(!1)}return this}_ease(g,A,q){q.animate===!1||q.duration===0?(g(1),A()):(this._easeStart=o.exported.now(),this._easeOptions=q,this._onEaseFrame=g,this._onEaseEnd=A,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const g=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(g,A){g=o.wrap(g,-180,180);const q=Math.abs(g-A);return Math.abs(g-360-A)<q&&(g-=360),Math.abs(g+360-A)<q&&(g+=360),g}_normalizeCenter(g){const A=this.transform;if(!A.renderWorldCopies||A.lngRange)return;const q=g.lng-A.center.lng;g.lng+=q>180?-360:q<-180?360:0}}class sv{constructor(g={}){this.options=g,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(g){return this._map=g,this._compact=this.options&&this.options.compact,this._container=ge.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ge.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ge.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ge.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(g,A){const q=this._map._getUIString(`AttributionControl.${A}`);g.title=q,g.setAttribute("aria-label",q)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(g){!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let g=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?g=g.concat(this.options.customAttribution.map(nt=>typeof nt!="string"?"":nt)):typeof this.options.customAttribution=="string"&&g.push(this.options.customAttribution)),this._map.style.stylesheet){const nt=this._map.style.stylesheet;this.styleOwner=nt.owner,this.styleId=nt.id}const A=this._map.style.sourceCaches;for(const nt in A){const Ft=A[nt];if(Ft.used||Ft.usedForTerrain){const Xr=Ft.getSource();Xr.attribution&&g.indexOf(Xr.attribution)<0&&g.push(Xr.attribution)}}g=g.filter(nt=>String(nt).trim()),g.sort((nt,Ft)=>nt.length-Ft.length),g=g.filter((nt,Ft)=>{for(let Xr=Ft+1;Xr<g.length;Xr++)if(g[Xr].indexOf(nt)>=0)return!1;return!0});const q=g.join(" | ");q!==this._attribHTML&&(this._attribHTML=q,g.length?(this._innerContainer.innerHTML=q,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class z0{constructor(g={}){this.options=g,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(g){this._map=g,this._compact=this.options&&this.options.compact,this._container=ge.create("div","maplibregl-ctrl");const A=ge.create("a","maplibregl-ctrl-logo");return A.target="_blank",A.rel="noopener nofollow",A.href="https://maplibre.org/",A.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),A.setAttribute("rel","noopener nofollow"),this._container.appendChild(A),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ge.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const g=this._container.children;if(g.length){const A=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&A.classList.add("maplibregl-compact"):A.classList.remove("maplibregl-compact")}}}class Uv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(g){const A=++this._id;return this._queue.push({callback:g,id:A,cancelled:!1}),A}remove(g){const A=this._currentlyRunning,q=A?this._queue.concat(A):this._queue;for(const nt of q)if(nt.id===g)return void(nt.cancelled=!0)}run(g=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const A=this._currentlyRunning=this._queue;this._queue=[];for(const q of A)if(!q.cancelled&&(q.callback(g),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const w0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Sv=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Vv extends o.Evented{constructor(g){super(),this.sourceCache=g,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,g.usedForTerrain=!0,g.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(g,A){this.sourceCache.update(g,A),this._renderableTilesKeys=[];const q={};for(const nt of g.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:A}))q[nt.key]=!0,this._renderableTilesKeys.push(nt.key),this._tiles[nt.key]||(nt.posMatrix=new Float64Array(16),o.ortho(nt.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[nt.key]=new sd(nt,this.tileSize));for(const nt in this._tiles)q[nt]||delete this._tiles[nt]}freeRtt(g){for(const A in this._tiles){const q=this._tiles[A];(!g||q.tileID.equals(g)||q.tileID.isChildOf(g)||g.isChildOf(q.tileID))&&(q.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(g=>this.getTileByID(g))}getTileByID(g){return this._tiles[g]}getTerrainCoords(g){const A={};for(const q of this._renderableTilesKeys){const nt=this._tiles[q].tileID;if(nt.canonical.equals(g.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16),o.ortho(Ft.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),A[q]=Ft}else if(nt.canonical.isChildOf(g.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16);const Xr=nt.canonical.z-g.canonical.z,ls=nt.canonical.x-(nt.canonical.x>>Xr<<Xr),Zs=nt.canonical.y-(nt.canonical.y>>Xr<<Xr),ol=o.EXTENT>>Xr;o.ortho(Ft.posMatrix,0,ol,0,ol,0,1),o.translate(Ft.posMatrix,Ft.posMatrix,[-ls*ol,-Zs*ol,0]),A[q]=Ft}else if(g.canonical.isChildOf(nt.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16);const Xr=g.canonical.z-nt.canonical.z,ls=g.canonical.x-(g.canonical.x>>Xr<<Xr),Zs=g.canonical.y-(g.canonical.y>>Xr<<Xr),ol=o.EXTENT>>Xr;o.ortho(Ft.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(Ft.posMatrix,Ft.posMatrix,[ls*ol,Zs*ol,0]),o.scale(Ft.posMatrix,Ft.posMatrix,[1/2**Xr,1/2**Xr,0]),A[q]=Ft}}return A}getSourceTile(g,A){const q=this.sourceCache._source;let nt=g.overscaledZ-this.deltaZoom;if(nt>q.maxzoom&&(nt=q.maxzoom),nt<q.minzoom)return null;this._sourceTileCache[g.key]||(this._sourceTileCache[g.key]=g.scaledTo(nt).key);let Ft=this.sourceCache.getTileByID(this._sourceTileCache[g.key]);if((!Ft||!Ft.dem)&&A)for(;nt>=q.minzoom&&(!Ft||!Ft.dem);)Ft=this.sourceCache.getTileByID(g.scaledTo(nt--).key);return Ft}tilesAfterTime(g=Date.now()){return Object.values(this._tiles).filter(A=>A.timeAdded>=g)}}class F0{constructor(g,A,q){this.painter=g,this.sourceCache=new Vv(A),this.options=q,this.exaggeration=typeof q.exaggeration=="number"?q.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(g,A,q,nt=o.EXTENT){if(!(A>=0&&A<nt&&q>=0&&q<nt))return 0;let Ft=0;const Xr=this.getTerrainData(g);if(Xr.tile&&Xr.tile.dem){const ls=function($h,Mh,Kh){var fd=Mh[0],cd=Mh[1];return $h[0]=Kh[0]*fd+Kh[4]*cd+Kh[12],$h[1]=Kh[1]*fd+Kh[5]*cd+Kh[13],$h}([],[A/nt*o.EXTENT,q/nt*o.EXTENT],Xr.u_terrain_matrix),Zs=[ls[0]*Xr.tile.dem.dim,ls[1]*Xr.tile.dem.dim],ol=[Math.floor(Zs[0]),Math.floor(Zs[1])],rh=Xr.tile.dem.get(ol[0],ol[1]),th=Xr.tile.dem.get(ol[0],ol[1]+1),ph=Xr.tile.dem.get(ol[0]+1,ol[1]),Dh=Xr.tile.dem.get(ol[0]+1,ol[1]+1);Ft=o.number(o.number(rh,th,Zs[0]-ol[0]),o.number(ph,Dh,Zs[0]-ol[0]),Zs[1]-ol[1])}return Ft}getElevation(g,A,q,nt=o.EXTENT){return this.getDEMElevation(g,A,q,nt)*this.exaggeration}getTerrainData(g){if(!this._emptyDemTexture){const nt=this.painter.context,Ft=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Lh(nt,Ft,nt.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Lh(nt,new o.RGBAImage({width:1,height:1}),nt.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(nt.gl.NEAREST,nt.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const A=this.sourceCache.getSourceTile(g,!0);if(A&&A.dem&&(!A.demTexture||A.needsTerrainPrepare)){const nt=this.painter.context;A.demTexture=this.painter.getTileTexture(A.dem.stride),A.demTexture?A.demTexture.update(A.dem.getPixels(),{premultiply:!1}):A.demTexture=new Lh(nt,A.dem.getPixels(),nt.gl.RGBA,{premultiply:!1}),A.demTexture.bind(nt.gl.NEAREST,nt.gl.CLAMP_TO_EDGE),A.needsTerrainPrepare=!1}const q=A&&A+A.tileID.key+g.key;if(q&&!this._demMatrixCache[q]){const nt=this.sourceCache.sourceCache._source.maxzoom;let Ft=g.canonical.z-A.tileID.canonical.z;g.overscaledZ>g.canonical.z&&(g.canonical.z>=nt?Ft=g.canonical.z-nt:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Xr=g.canonical.x-(g.canonical.x>>Ft<<Ft),ls=g.canonical.y-(g.canonical.y>>Ft<<Ft),Zs=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<Ft),1/(o.EXTENT<<Ft),0]);o.translate(Zs,Zs,[Xr*o.EXTENT,ls*o.EXTENT,0]),this._demMatrixCache[g.key]={matrix:Zs,coord:g}}return{u_depth:2,u_terrain:3,u_terrain_dim:A&&A.dem&&A.dem.dim||1,u_terrain_matrix:q?this._demMatrixCache[g.key].matrix:this._emptyDemMatrix,u_terrain_unpack:A&&A.dem&&A.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(A&&A.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:A}}getFramebuffer(g){const A=this.painter,q=A.width/devicePixelRatio,nt=A.height/devicePixelRatio;return!this._fbo||this._fbo.width===q&&this._fbo.height===nt||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Lh(A.context,{width:q,height:nt,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Lh(A.context,{width:q,height:nt,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=A.context.createFramebuffer(q,nt,!0),this._fbo.depthAttachment.set(A.context.createRenderbuffer(A.context.gl.DEPTH_COMPONENT16,q,nt))),this._fbo.colorAttachment.set(g==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const g=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const A=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let Ft=0,Xr=0;Ft<this._coordsTextureSize;Ft++)for(let ls=0;ls<this._coordsTextureSize;ls++,Xr+=4)A[Xr+0]=255&ls,A[Xr+1]=255&Ft,A[Xr+2]=ls>>8<<4|Ft>>8,A[Xr+3]=0;const q=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(A.buffer)),nt=new Lh(g,q,g.gl.RGBA,{premultiply:!1});return nt.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._coordsTexture=nt,nt}pointCoordinate(g){const A=new Uint8Array(4),q=this.painter.context,nt=q.gl;q.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),nt.readPixels(g.x,this.painter.height/devicePixelRatio-g.y-1,1,1,nt.RGBA,nt.UNSIGNED_BYTE,A),q.bindFramebuffer.set(null);const Ft=A[0]+(A[2]>>4<<8),Xr=A[1]+((15&A[2])<<8),ls=this.coordsIndex[255-A[3]],Zs=ls&&this.sourceCache.getTileByID(ls);if(!Zs)return null;const ol=this._coordsTextureSize,rh=(1<<Zs.tileID.canonical.z)*ol;return new o.MercatorCoordinate((Zs.tileID.canonical.x*ol+Ft)/rh,(Zs.tileID.canonical.y*ol+Xr)/rh,this.getElevation(Zs.tileID,Ft,Xr,ol))}getTerrainMesh(){if(this._mesh)return this._mesh;const g=this.painter.context,A=new o.Pos3dArray,q=new o.TriangleIndexArray,nt=this.meshSize,Ft=o.EXTENT/nt,Xr=nt*nt;for(let th=0;th<=nt;th++)for(let ph=0;ph<=nt;ph++)A.emplaceBack(ph*Ft,th*Ft,0);for(let th=0;th<Xr;th+=nt+1)for(let ph=0;ph<nt;ph++)q.emplaceBack(ph+th,nt+ph+th+1,nt+ph+th+2),q.emplaceBack(ph+th,nt+ph+th+2,ph+th+1);const ls=A.length,Zs=ls+2*(nt+1);for(const th of[0,1])for(let ph=0;ph<=nt;ph++)for(const Dh of[0,1])A.emplaceBack(ph*Ft,th*o.EXTENT,Dh);for(let th=0;th<2*nt;th+=2)q.emplaceBack(Zs+th,Zs+th+1,Zs+th+3),q.emplaceBack(Zs+th,Zs+th+3,Zs+th+2),q.emplaceBack(ls+th,ls+th+3,ls+th+1),q.emplaceBack(ls+th,ls+th+2,ls+th+3);const ol=A.length,rh=ol+2*(nt+1);for(const th of[0,1])for(let ph=0;ph<=nt;ph++)for(const Dh of[0,1])A.emplaceBack(th*o.EXTENT,ph*Ft,Dh);for(let th=0;th<2*nt;th+=2)q.emplaceBack(ol+th,ol+th+1,ol+th+3),q.emplaceBack(ol+th,ol+th+3,ol+th+2),q.emplaceBack(rh+th,rh+th+3,rh+th+1),q.emplaceBack(rh+th,rh+th+2,rh+th+3);return this._mesh={indexBuffer:g.createIndexBuffer(q),vertexBuffer:g.createVertexBuffer(A,Sv.members),segments:o.SegmentVector.simpleSegment(0,0,A.length,q.length)},this._mesh}getMeshFrameDelta(g){return 2*Math.PI*o.earthRadius/Math.pow(2,g)/5}getMinMaxElevation(g){const A=this.getTerrainData(g).tile,q={minElevation:null,maxElevation:null};return A&&A.dem&&(q.minElevation=A.dem.min*this.exaggeration,q.maxElevation=A.dem.max*this.exaggeration),q}}class Gv{constructor(g,A,q){this._context=g,this._size=A,this._tileSize=q,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const g of this._objects)g.texture.destroy(),g.fbo.destroy()}_createObject(g){const A=this._context.createFramebuffer(this._tileSize,this._tileSize,!0),q=new Lh(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return q.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),A.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_COMPONENT16,this._tileSize,this._tileSize)),A.colorAttachment.set(q.texture),{id:g,fbo:A,texture:q,stamp:-1,inUse:!1}}getObjectForId(g){return this._objects[g]}useObject(g){g.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(A=>g.id!==A),this._recentlyUsed.push(g.id)}stampObject(g){g.stamp=++this._stamp}getOrCreateFreeObject(){for(const A of this._recentlyUsed)if(!this._objects[A].inUse)return this._objects[A];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const g=this._createObject(this._objects.length);return this._objects.push(g),g}freeObject(g){g.inUse=!1}freeAllObjects(){for(const g of this._objects)this.freeObject(g)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(g=>!g.inUse)===!1}}const Ey={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class lv{constructor(g,A){this.painter=g,this.terrain=A,this.pool=new Gv(g.context,30,A.sourceCache.tileSize*A.qualityFactor)}destruct(){this.pool.destruct()}getTexture(g){return this.pool.getObjectForId(g.rtt[this._stacks.length-1].id).texture}prepareForRender(g,A){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=g._order.filter(q=>!g._layers[q].isHidden(A)),this._coordsDescendingInv={};for(const q in g.sourceCaches){this._coordsDescendingInv[q]={};const nt=g.sourceCaches[q].getVisibleCoordinates();for(const Ft of nt){const Xr=this.terrain.sourceCache.getTerrainCoords(Ft);for(const ls in Xr)this._coordsDescendingInv[q][ls]||(this._coordsDescendingInv[q][ls]=[]),this._coordsDescendingInv[q][ls].push(Xr[ls])}}this._coordsDescendingInvStr={};for(const q of g._order){const nt=g._layers[q],Ft=nt.source;if(Ey[nt.type]&&!this._coordsDescendingInvStr[Ft]){this._coordsDescendingInvStr[Ft]={};for(const Xr in this._coordsDescendingInv[Ft])this._coordsDescendingInvStr[Ft][Xr]=this._coordsDescendingInv[Ft][Xr].map(ls=>ls.key).sort().join()}}for(const q of this._renderableTiles)for(const nt in this._coordsDescendingInvStr){const Ft=this._coordsDescendingInvStr[nt][q.tileID.key];Ft&&Ft!==q.rttCoords[nt]&&(q.rtt=[])}}renderLayer(g){if(g.isHidden(this.painter.transform.zoom))return!1;const A=g.type,q=this.painter,nt=this._renderableLayerIds[this._renderableLayerIds.length-1]===g.id;if(Ey[A]&&(this._prevType&&Ey[this._prevType]||this._stacks.push([]),this._prevType=A,this._stacks[this._stacks.length-1].push(g.id),!nt))return!0;if(Ey[this._prevType]||Ey[A]&&nt){this._prevType=A;const Ft=this._stacks.length-1,Xr=this._stacks[Ft]||[];for(const ls of this._renderableTiles){if(this.pool.isFull()&&(og(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ls),ls.rtt[Ft]){const ol=this.pool.getObjectForId(ls.rtt[Ft].id);if(ol.stamp===ls.rtt[Ft].stamp){this.pool.useObject(ol);continue}}const Zs=this.pool.getOrCreateFreeObject();this.pool.useObject(Zs),this.pool.stampObject(Zs),ls.rtt[Ft]={id:Zs.id,stamp:Zs.stamp},q.context.bindFramebuffer.set(Zs.fbo.framebuffer),q.context.clear({color:o.Color.transparent});for(let ol=0;ol<Xr.length;ol++){const rh=q.style._layers[Xr[ol]],th=rh.source?this._coordsDescendingInv[rh.source][ls.tileID.key]:[ls.tileID];q.context.viewport.set([0,0,Zs.fbo.width,Zs.fbo.height]),q._renderTileClippingMasks(rh,th),q.renderLayer(q,q.style.sourceCaches[rh.source],rh,th),rh.source&&(ls.rttCoords[rh.source]=this._coordsDescendingInvStr[rh.source][ls.tileID.key])}}return og(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ey[A]}return!1}}const E0=Y,cv={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},T0=he=>{he.touchstart=he.dragStart,he.touchmoveWindow=he.dragMove,he.touchend=he.dragEnd},jv={showCompass:!0,showZoom:!0,visualizePitch:!1};class c1{constructor(g,A,q=!1){this._clickTolerance=10;const nt=g.dragRotate._mouseRotate.getClickTolerance(),Ft=g.dragRotate._mousePitch.getClickTolerance();this.element=A,this.mouseRotate=xy({clickTolerance:nt,enable:!0}),this.touchRotate=(({enable:Xr,clickTolerance:ls,bearingDegreesPerPixelMoved:Zs=.8})=>{const ol=new Cm;return new Gg({clickTolerance:ls,move:(rh,th)=>({bearingDelta:(th.x-rh.x)*Zs}),moveStateManager:ol,enable:Xr,assignEvents:T0})})({clickTolerance:nt,enable:!0}),this.map=g,q&&(this.mousePitch=Hy({clickTolerance:Ft,enable:!0}),this.touchPitch=(({enable:Xr,clickTolerance:ls,pitchDegreesPerPixelMoved:Zs=-.5})=>{const ol=new Cm;return new Gg({clickTolerance:ls,move:(rh,th)=>({pitchDelta:(th.y-rh.y)*Zs}),moveStateManager:ol,enable:Xr,assignEvents:T0})})({clickTolerance:Ft,enable:!0})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ge.addEventListener(A,"mousedown",this.mousedown),ge.addEventListener(A,"touchstart",this.touchstart,{passive:!1}),ge.addEventListener(A,"touchcancel",this.reset)}startMouse(g,A){this.mouseRotate.dragStart(g,A),this.mousePitch&&this.mousePitch.dragStart(g,A),ge.disableDrag()}startTouch(g,A){this.touchRotate.dragStart(g,A),this.touchPitch&&this.touchPitch.dragStart(g,A),ge.disableDrag()}moveMouse(g,A){const q=this.map,{bearingDelta:nt}=this.mouseRotate.dragMove(g,A)||{};if(nt&&q.setBearing(q.getBearing()+nt),this.mousePitch){const{pitchDelta:Ft}=this.mousePitch.dragMove(g,A)||{};Ft&&q.setPitch(q.getPitch()+Ft)}}moveTouch(g,A){const q=this.map,{bearingDelta:nt}=this.touchRotate.dragMove(g,A)||{};if(nt&&q.setBearing(q.getBearing()+nt),this.touchPitch){const{pitchDelta:Ft}=this.touchPitch.dragMove(g,A)||{};Ft&&q.setPitch(q.getPitch()+Ft)}}off(){const g=this.element;ge.removeEventListener(g,"mousedown",this.mousedown),ge.removeEventListener(g,"touchstart",this.touchstart,{passive:!1}),ge.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ge.removeEventListener(window,"touchend",this.touchend),ge.removeEventListener(g,"touchcancel",this.reset),this.offTemp()}offTemp(){ge.enableDrag(),ge.removeEventListener(window,"mousemove",this.mousemove),ge.removeEventListener(window,"mouseup",this.mouseup),ge.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ge.removeEventListener(window,"touchend",this.touchend)}mousedown(g){this.startMouse(o.extend({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),ge.mousePos(this.element,g)),ge.addEventListener(window,"mousemove",this.mousemove),ge.addEventListener(window,"mouseup",this.mouseup)}mousemove(g){this.moveMouse(g,ge.mousePos(this.element,g))}mouseup(g){this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()}touchstart(g){g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ge.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),ge.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ge.addEventListener(window,"touchend",this.touchend))}touchmove(g){g.targetTouches.length!==1?this.reset():(this._lastPos=ge.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))}touchend(g){g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Iv(he,g,A){if(he=new o.LngLat(he.lng,he.lat),g){const q=new o.LngLat(he.lng-360,he.lat),nt=new o.LngLat(he.lng+360,he.lat),Ft=A.locationPoint(he).distSqr(g);A.locationPoint(q).distSqr(g)<Ft?he=q:A.locationPoint(nt).distSqr(g)<Ft&&(he=nt)}for(;Math.abs(he.lng-A.center.lng)>180;){const q=A.locationPoint(he);if(q.x>=0&&q.y>=0&&q.x<=A.width&&q.y<=A.height)break;he.lng>A.center.lng?he.lng-=360:he.lng+=360}return he}const Cv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function uv(he,g,A){const q=he.classList;for(const nt in Cv)q.remove(`maplibregl-${A}-anchor-${nt}`);q.add(`maplibregl-${A}-anchor-${g}`)}class zg extends o.Evented{constructor(g,A){if(super(),(g instanceof HTMLElement||A)&&(g=o.extend({element:g},A)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=o.pointGeometry.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=ge.create("div"),this._element.setAttribute("aria-label","Map marker");const q=ge.createNS("http://www.w3.org/2000/svg","svg"),nt=41,Ft=27;q.setAttributeNS(null,"display","block"),q.setAttributeNS(null,"height",`${nt}px`),q.setAttributeNS(null,"width",`${Ft}px`),q.setAttributeNS(null,"viewBox",`0 0 ${Ft} ${nt}`);const Xr=ge.createNS("http://www.w3.org/2000/svg","g");Xr.setAttributeNS(null,"stroke","none"),Xr.setAttributeNS(null,"stroke-width","1"),Xr.setAttributeNS(null,"fill","none"),Xr.setAttributeNS(null,"fill-rule","evenodd");const ls=ge.createNS("http://www.w3.org/2000/svg","g");ls.setAttributeNS(null,"fill-rule","nonzero");const Zs=ge.createNS("http://www.w3.org/2000/svg","g");Zs.setAttributeNS(null,"transform","translate(3.0, 29.0)"),Zs.setAttributeNS(null,"fill","#000000");const ol=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const cd of ol){const jh=ge.createNS("http://www.w3.org/2000/svg","ellipse");jh.setAttributeNS(null,"opacity","0.04"),jh.setAttributeNS(null,"cx","10.5"),jh.setAttributeNS(null,"cy","5.80029008"),jh.setAttributeNS(null,"rx",cd.rx),jh.setAttributeNS(null,"ry",cd.ry),Zs.appendChild(jh)}const rh=ge.createNS("http://www.w3.org/2000/svg","g");rh.setAttributeNS(null,"fill",this._color);const th=ge.createNS("http://www.w3.org/2000/svg","path");th.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),rh.appendChild(th);const ph=ge.createNS("http://www.w3.org/2000/svg","g");ph.setAttributeNS(null,"opacity","0.25"),ph.setAttributeNS(null,"fill","#000000");const Dh=ge.createNS("http://www.w3.org/2000/svg","path");Dh.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ph.appendChild(Dh);const $h=ge.createNS("http://www.w3.org/2000/svg","g");$h.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$h.setAttributeNS(null,"fill","#FFFFFF");const Mh=ge.createNS("http://www.w3.org/2000/svg","g");Mh.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Kh=ge.createNS("http://www.w3.org/2000/svg","circle");Kh.setAttributeNS(null,"fill","#000000"),Kh.setAttributeNS(null,"opacity","0.25"),Kh.setAttributeNS(null,"cx","5.5"),Kh.setAttributeNS(null,"cy","5.5"),Kh.setAttributeNS(null,"r","5.4999962");const fd=ge.createNS("http://www.w3.org/2000/svg","circle");fd.setAttributeNS(null,"fill","#FFFFFF"),fd.setAttributeNS(null,"cx","5.5"),fd.setAttributeNS(null,"cy","5.5"),fd.setAttributeNS(null,"r","5.4999962"),Mh.appendChild(Kh),Mh.appendChild(fd),ls.appendChild(Zs),ls.appendChild(rh),ls.appendChild(ph),ls.appendChild($h),ls.appendChild(Mh),q.appendChild(ls),q.setAttributeNS(null,"height",nt*this._scale+"px"),q.setAttributeNS(null,"width",Ft*this._scale+"px"),this._element.appendChild(q),this._offset=o.pointGeometry.convert(g&&g.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",q=>{q.preventDefault()}),this._element.addEventListener("mousedown",q=>{q.preventDefault()}),uv(this._element,this._anchor,"marker"),this._popup=null}addTo(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ge.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){const nt=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[nt,-1*(38.1-13.5+nt)],"bottom-right":[-nt,-1*(38.1-13.5+nt)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(g){const A=g.code,q=g.charCode||g.keyCode;A!=="Space"&&A!=="Enter"&&q!==32&&q!==13||this.togglePopup()}_onMapClick(g){const A=g.originalEvent.target,q=this._element;this._popup&&(A===q||q.contains(A))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this}_update(g){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Iv(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let q="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?q="rotateX(0deg)":this._pitchAlignment==="map"&&(q=`rotateX(${this._map.getPitch()}deg)`),g&&g.type!=="moveend"||(this._pos=this._pos.round()),ge.setTransform(this._element,`${Cv[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${q} ${A}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const nt=this._map.unproject(this._pos),Ft=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=nt.distanceTo(this._lngLat)>20*Ft?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(g){return this._offset=o.pointGeometry.convert(g),this._update(),this}_onMove(g){if(!this._isDragging){const A=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=A}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(g){return this._rotation=g||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(g){return this._rotationAlignment=g||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const R1={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let S0,Mv=0,U0=!1;const Ty={maxWidth:100,unit:"metric"};function qv(he,g,A){const q=A&&A.maxWidth||100,nt=he._container.clientHeight/2,Ft=he.unproject([0,nt]),Xr=he.unproject([q,nt]),ls=Ft.distanceTo(Xr);if(A&&A.unit==="imperial"){const Zs=3.2808*ls;Zs>5280?Sy(g,q,Zs/5280,he._getUIString("ScaleControl.Miles")):Sy(g,q,Zs,he._getUIString("ScaleControl.Feet"))}else A&&A.unit==="nautical"?Sy(g,q,ls/1852,he._getUIString("ScaleControl.NauticalMiles")):ls>=1e3?Sy(g,q,ls/1e3,he._getUIString("ScaleControl.Kilometers")):Sy(g,q,ls,he._getUIString("ScaleControl.Meters"))}function Sy(he,g,A,q){const nt=function(Ft){const Xr=Math.pow(10,`${Math.floor(Ft)}`.length-1);let ls=Ft/Xr;return ls=ls>=10?10:ls>=5?5:ls>=3?3:ls>=2?2:ls>=1?1:function(Zs){const ol=Math.pow(10,Math.ceil(-Math.log(Zs)/Math.LN10));return Math.round(Zs*ol)/ol}(ls),Xr*ls}(A);he.style.width=g*(nt/A)+"px",he.innerHTML=`${nt}&nbsp;${q}`}const Iy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ip(he){if(he){if(typeof he=="number"){const g=Math.round(Math.sqrt(.5*Math.pow(he,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,he),"top-left":new o.pointGeometry(g,g),"top-right":new o.pointGeometry(-g,g),bottom:new o.pointGeometry(0,-he),"bottom-left":new o.pointGeometry(g,-g),"bottom-right":new o.pointGeometry(-g,-g),left:new o.pointGeometry(he,0),right:new o.pointGeometry(-he,0)}}if(he instanceof o.pointGeometry||Array.isArray(he)){const g=o.pointGeometry.convert(he);return{center:g,top:g,"top-left":g,"top-right":g,bottom:g,"bottom-left":g,"bottom-right":g,left:g,right:g}}return{center:o.pointGeometry.convert(he.center||[0,0]),top:o.pointGeometry.convert(he.top||[0,0]),"top-left":o.pointGeometry.convert(he["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(he["top-right"]||[0,0]),bottom:o.pointGeometry.convert(he.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(he["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(he["bottom-right"]||[0,0]),left:o.pointGeometry.convert(he.left||[0,0]),right:o.pointGeometry.convert(he.right||[0,0])}}return Ip(new o.pointGeometry(0,0))}const O1=Y,K_={supported:x,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends av{constructor(he){var g;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(he=o.extend({},cv,he)).minZoom!=null&&he.maxZoom!=null&&he.minZoom>he.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(he.minPitch!=null&&he.maxPitch!=null&&he.minPitch>he.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(he.minPitch!=null&&he.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(he.maxPitch!=null&&he.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fg(he.minZoom,he.maxZoom,he.minPitch,he.maxPitch,he.renderWorldCopies),{bearingSnap:he.bearingSnap}),this._interactive=he.interactive,this._cooperativeGestures=he.cooperativeGestures,this._maxTileCacheSize=he.maxTileCacheSize,this._failIfMajorPerformanceCaveat=he.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=he.preserveDrawingBuffer,this._antialias=he.antialias,this._trackResize=he.trackResize,this._bearingSnap=he.bearingSnap,this._refreshExpiredTiles=he.refreshExpiredTiles,this._fadeDuration=he.fadeDuration,this._crossSourceCollisions=he.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=he.collectResourceTiming,this._renderTaskQueue=new Uv,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},w0,he.locale),this._clickTolerance=he.clickTolerance,this._pixelRatio=(g=he.pixelRatio)!==null&&g!==void 0?g:devicePixelRatio,this._imageQueueHandle=ah.addThrottleControl(()=>this.isMoving()),this._requestManager=new ch(he.transformRequest),typeof he.container=="string"){if(this._container=document.getElementById(he.container),!this._container)throw new Error(`Container '${he.container}' not found.`)}else{if(!(he.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=he.container}he.maxBounds&&this.setMaxBounds(he.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Tv(this,he),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=he.hash&&new A_(typeof he.hash=="string"&&he.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:he.center,zoom:he.zoom,bearing:he.bearing,pitch:he.pitch}),he.bounds&&(this.resize(),this.fitBounds(he.bounds,o.extend({},he.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=he.localIdeographFontFamily,he.style&&this.setStyle(he.style,{localIdeographFontFamily:he.localIdeographFontFamily}),he.attributionControl&&this.addControl(new sv({customAttribution:he.customAttribution})),he.maplibreLogo&&this.addControl(new z0,he.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new o.Event(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new o.Event(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new o.Event("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(he,g){if(g===void 0&&(g=he.getDefaultPosition?he.getDefaultPosition():"top-right"),!he||!he.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const A=he.onAdd(this);this._controls.push(he);const q=this._controlPositions[g];return g.indexOf("bottom")!==-1?q.insertBefore(A,q.firstChild):q.appendChild(A),this}removeControl(he){if(!he||!he.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const g=this._controls.indexOf(he);return g>-1&&this._controls.splice(g,1),he.onRemove(this),this}hasControl(he){return this._controls.indexOf(he)>-1}calculateCameraOptionsFromTo(he,g,A,q){return q==null&&this.terrain&&(q=this.transform.getElevation(A,this.terrain)),super.calculateCameraOptionsFromTo(he,g,A,q)}resize(he){const g=this._containerDimensions(),A=g[0],q=g[1];this._resizeCanvas(A,q,this.getPixelRatio()),this.transform.resize(A,q),this.painter.resize(A,q,this.getPixelRatio());const nt=!this._moving;return nt&&(this.stop(),this.fire(new o.Event("movestart",he)).fire(new o.Event("move",he))),this.fire(new o.Event("resize",he)),nt&&this.fire(new o.Event("moveend",he)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(he){const[g,A]=this._containerDimensions();this._pixelRatio=he,this._resizeCanvas(g,A,he),this.painter.resize(g,A,he)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(he){return this.transform.setMaxBounds(o.LngLatBounds.convert(he)),this._update()}setMinZoom(he){if((he=he??-2)>=-2&&he<=this.transform.maxZoom)return this.transform.minZoom=he,this._update(),this.getZoom()<he&&this.setZoom(he),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(he){if((he=he??22)>=this.transform.minZoom)return this.transform.maxZoom=he,this._update(),this.getZoom()>he&&this.setZoom(he),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(he){if((he=he??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(he>=0&&he<=this.transform.maxPitch)return this.transform.minPitch=he,this._update(),this.getPitch()<he&&this.setPitch(he),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(he){if((he=he??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(he>=this.transform.minPitch)return this.transform.maxPitch=he,this._update(),this.getPitch()>he&&this.setPitch(he),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(he){return this.transform.renderWorldCopies=he,this._update()}project(he){return this.transform.locationPoint(o.LngLat.convert(he),this.style&&this.terrain)}unproject(he){return this.transform.pointLocation(o.pointGeometry.convert(he),this.terrain)}isMoving(){var he;return this._moving||((he=this.handlers)===null||he===void 0?void 0:he.isMoving())}isZooming(){var he;return this._zooming||((he=this.handlers)===null||he===void 0?void 0:he.isZooming())}isRotating(){var he;return this._rotating||((he=this.handlers)===null||he===void 0?void 0:he.isRotating())}_createDelegatedListener(he,g,A){if(he==="mouseenter"||he==="mouseover"){let q=!1;return{layer:g,listener:A,delegates:{mousemove:Ft=>{const Xr=this.getLayer(g)?this.queryRenderedFeatures(Ft.point,{layers:[g]}):[];Xr.length?q||(q=!0,A.call(this,new am(he,this,Ft.originalEvent,{features:Xr}))):q=!1},mouseout:()=>{q=!1}}}}if(he==="mouseleave"||he==="mouseout"){let q=!1;return{layer:g,listener:A,delegates:{mousemove:Xr=>{(this.getLayer(g)?this.queryRenderedFeatures(Xr.point,{layers:[g]}):[]).length?q=!0:q&&(q=!1,A.call(this,new am(he,this,Xr.originalEvent)))},mouseout:Xr=>{q&&(q=!1,A.call(this,new am(he,this,Xr.originalEvent)))}}}}{const q=nt=>{const Ft=this.getLayer(g)?this.queryRenderedFeatures(nt.point,{layers:[g]}):[];Ft.length&&(nt.features=Ft,A.call(this,nt),delete nt.features)};return{layer:g,listener:A,delegates:{[he]:q}}}}on(he,g,A){if(A===void 0)return super.on(he,g);const q=this._createDelegatedListener(he,g,A);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[he]=this._delegatedListeners[he]||[],this._delegatedListeners[he].push(q);for(const nt in q.delegates)this.on(nt,q.delegates[nt]);return this}once(he,g,A){if(A===void 0)return super.once(he,g);const q=this._createDelegatedListener(he,g,A);for(const nt in q.delegates)this.once(nt,q.delegates[nt]);return this}off(he,g,A){return A===void 0?super.off(he,g):(this._delegatedListeners&&this._delegatedListeners[he]&&(q=>{const nt=this._delegatedListeners[he];for(let Ft=0;Ft<nt.length;Ft++){const Xr=nt[Ft];if(Xr.layer===g&&Xr.listener===A){for(const ls in Xr.delegates)this.off(ls,Xr.delegates[ls]);return nt.splice(Ft,1),this}}})(),this)}queryRenderedFeatures(he,g){if(!this.style)return[];let A;const q=he instanceof o.pointGeometry||Array.isArray(he),nt=q?he:[[0,0],[this.transform.width,this.transform.height]];if(g=g||(q?{}:he)||{},nt instanceof o.pointGeometry||typeof nt[0]=="number")A=[o.pointGeometry.convert(nt)];else{const Ft=o.pointGeometry.convert(nt[0]),Xr=o.pointGeometry.convert(nt[1]);A=[Ft,new o.pointGeometry(Xr.x,Ft.y),Xr,new o.pointGeometry(Ft.x,Xr.y),Ft]}return this.style.queryRenderedFeatures(A,g,this.transform)}querySourceFeatures(he,g){return this.style.querySourceFeatures(he,g)}setStyle(he,g){return(g=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&he?(this._diffStyle(he,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(he,g))}setTransformRequest(he){return this._requestManager.setTransformRequest(he),this}_getUIString(he){const g=this._locale[he];if(g==null)throw new Error(`Missing UI string '${he}'`);return g}_updateStyle(he,g){if(g.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(he,g));const A=this.style&&g.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!he)),he?(this.style=new nd(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof he=="string"?this.style.loadURL(he,g,A):this.style.loadJSON(he,g,A),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nd(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(he,g){if(typeof he=="string"){const A=this._requestManager.transformRequest(he,$s.Style);o.getJSON(A,(q,nt)=>{q?this.fire(new o.ErrorEvent(q)):nt&&this._updateDiff(nt,g)})}else typeof he=="object"&&this._updateDiff(he,g)}_updateDiff(he,g){try{this.style.setState(he,g)&&this._update(!0)}catch(A){o.warnOnce(`Unable to perform style diff: ${A.message||A.error||A}.  Rebuilding the style from scratch.`),this._updateStyle(he,g)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(he,g){return this._lazyInitEmptyStyle(),this.style.addSource(he,g),this._update(!0)}isSourceLoaded(he){const g=this.style&&this.style.sourceCaches[he];if(g!==void 0)return g.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${he}'`)))}setTerrain(he){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),he){const g=this.style.sourceCaches[he.source];if(!g)throw new Error(`cannot load terrain, because there exists no source with ID: ${he.source}`);this.terrain=new F0(this.painter,g,he),this.painter.renderToTexture=new lv(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=A=>{A.dataType==="style"?this.terrain.sourceCache.freeRtt():A.dataType==="source"&&A.tile&&(A.sourceId===he.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(A.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new o.Event("terrain",{terrain:he})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const he=this.style&&this.style.sourceCaches;for(const g in he){const A=he[g]._tiles;for(const q in A){const nt=A[q];if(nt.state!=="loaded"&&nt.state!=="errored")return!1}}return!0}addSourceType(he,g,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(he,g,A)}removeSource(he){return this.style.removeSource(he),this._update(!0)}getSource(he){return this.style.getSource(he)}addImage(he,g,{pixelRatio:A=1,sdf:q=!1,stretchX:nt,stretchY:Ft,content:Xr}={}){if(this._lazyInitEmptyStyle(),g instanceof HTMLImageElement||o.isImageBitmap(g)){const{width:ls,height:Zs,data:ol}=o.exported.getImageData(g);this.style.addImage(he,{data:new o.RGBAImage({width:ls,height:Zs},ol),pixelRatio:A,stretchX:nt,stretchY:Ft,content:Xr,sdf:q,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ls,height:Zs,data:ol}=g,rh=g;this.style.addImage(he,{data:new o.RGBAImage({width:ls,height:Zs},new Uint8Array(ol)),pixelRatio:A,stretchX:nt,stretchY:Ft,content:Xr,sdf:q,version:0,userImage:rh}),rh.onAdd&&rh.onAdd(this,he)}}}updateImage(he,g){const A=this.style.getImage(he);if(!A)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const q=g instanceof HTMLImageElement||o.isImageBitmap(g)?o.exported.getImageData(g):g,{width:nt,height:Ft,data:Xr}=q;if(nt===void 0||Ft===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(nt!==A.data.width||Ft!==A.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const ls=!(g instanceof HTMLImageElement||o.isImageBitmap(g));A.data.replace(Xr,ls),this.style.updateImage(he,A)}hasImage(he){return he?!!this.style.getImage(he):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(he){this.style.removeImage(he)}loadImage(he,g){ah.getImage(this._requestManager.transformRequest(he,$s.Image),g)}listImages(){return this.style.listImages()}addLayer(he,g){return this._lazyInitEmptyStyle(),this.style.addLayer(he,g),this._update(!0)}moveLayer(he,g){return this.style.moveLayer(he,g),this._update(!0)}removeLayer(he){return this.style.removeLayer(he),this._update(!0)}getLayer(he){return this.style.getLayer(he)}setLayerZoomRange(he,g,A){return this.style.setLayerZoomRange(he,g,A),this._update(!0)}setFilter(he,g,A={}){return this.style.setFilter(he,g,A),this._update(!0)}getFilter(he){return this.style.getFilter(he)}setPaintProperty(he,g,A,q={}){return this.style.setPaintProperty(he,g,A,q),this._update(!0)}getPaintProperty(he,g){return this.style.getPaintProperty(he,g)}setLayoutProperty(he,g,A,q={}){return this.style.setLayoutProperty(he,g,A,q),this._update(!0)}getLayoutProperty(he,g){return this.style.getLayoutProperty(he,g)}setGlyphs(he,g={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(he,g),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(he,g,A={}){return this._lazyInitEmptyStyle(),this.style.addSprite(he,g,A,q=>{q||this._update(!0)}),this}removeSprite(he){return this._lazyInitEmptyStyle(),this.style.removeSprite(he),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(he,g={}){return this._lazyInitEmptyStyle(),this.style.setSprite(he,g,A=>{A||this._update(!0)}),this}setLight(he,g={}){return this._lazyInitEmptyStyle(),this.style.setLight(he,g),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(he,g){return this.style.setFeatureState(he,g),this._update()}removeFeatureState(he,g){return this.style.removeFeatureState(he,g),this._update()}getFeatureState(he){return this.style.getFeatureState(he)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let he=0,g=0;return this._container&&(he=this._container.clientWidth||400,g=this._container.clientHeight||300),[he,g]}_setupContainer(){const he=this._container;he.classList.add("maplibregl-map");const g=this._canvasContainer=ge.create("div","maplibregl-canvas-container",he);this._interactive&&g.classList.add("maplibregl-interactive"),this._canvas=ge.create("canvas","maplibregl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const A=this._containerDimensions();this._resizeCanvas(A[0],A[1],this.getPixelRatio());const q=this._controlContainer=ge.create("div","maplibregl-control-container",he),nt=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Ft=>{nt[Ft]=ge.create("div",`maplibregl-ctrl-${Ft} `,q)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const he=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=ge.create("div","maplibregl-cooperative-gesture-screen",he);let g="Control",A=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(A=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",g="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${A}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",q=>{q.key===g&&(this._metaPress=!0)}),document.addEventListener("keyup",q=>{q.key===g&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",q=>{this._onCooperativeGesture(q,this._metaPress,1)},!1),this._canvasContainer.classList.remove("maplibregl-touch-drag-pan")}_resizeCanvas(he,g,A){this._canvas.width=A*he,this._canvas.height=A*g,this._canvas.style.width=`${he}px`,this._canvas.style.height=`${g}px`}_setupPainter(){const he=o.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1});let g=null;this._canvas.addEventListener("webglcontextcreationerror",q=>{g={requestedAttributes:he},q&&(g.statusMessage=q.statusMessage,g.type=q.type)},{once:!0});const A=this._canvas.getContext("webgl",he)||this._canvas.getContext("experimental-webgl",he);if(!A){const q="Failed to initialize WebGL";throw g?(g.message=q,new Error(JSON.stringify(g))):new Error(q)}this.painter=new Vm(A,this.transform),Bt.testSupport(A)}_contextLost(he){he.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:he}))}_contextRestored(he){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:he}))}_onMapScroll(he){if(he.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(he,g,A){return!g&&A<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(he){return this.style?(this._styleDirty=this._styleDirty||he,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(he){return this._update(),this._renderTaskQueue.add(he)}_cancelRenderFrame(he){this._renderTaskQueue.remove(he)}_render(he){let g,A=0;const q=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=q.createQueryEXT(),q.beginQueryEXT(q.TIME_ELAPSED_EXT,g),A=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(he),this._removed)return;let nt=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Xr=this.transform.zoom,ls=o.exported.now();this.style.zoomHistory.update(Xr,ls);const Zs=new o.EvaluationParameters(Xr,{now:ls,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ol=Zs.crossFadingFactor();ol===1&&ol===this._crossFadingFactor||(nt=!0,this._crossFadingFactor=ol),this.style.update(Zs)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._imageQueueDirty=ah.processQueue()>0,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||nt)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const Xr=o.exported.now()-A;q.endQueryEXT(q.TIME_ELAPSED_EXT,g),setTimeout(()=>{const ls=q.getQueryObjectEXT(g,q.QUERY_RESULT_EXT)/1e6;q.deleteQueryEXT(g),this.fire(new o.Event("gpu-timing-frame",{cpuTime:Xr,gpuTime:ls}))},50)}if(this.listens("gpu-timing-layer")){const Xr=this.painter.collectGpuTimers();setTimeout(()=>{const ls=this.painter.queryGpuTimers(Xr);this.fire(new o.Event("gpu-timing-layer",{layerTimes:ls}))},50)}const Ft=this._sourcesDirty||this._styleDirty||this._placementDirty||this._imageQueueDirty;return Ft||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Ft||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const g of this._controls)g.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1)),ah.removeThrottleControl(this._imageQueueHandle);const he=this.painter.context.gl.getExtension("WEBGL_lose_context");he&&he.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ge.remove(this._canvasContainer),ge.remove(this._controlContainer),this._cooperativeGestures&&ge.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(he=>{o.PerformanceUtils.frame(he),this._frame=null,this._render(he)}))}_onWindowOnline(){this._update()}_onWindowResize(he){this._trackResize&&this.resize({originalEvent:he})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(he){this._showTileBoundaries!==he&&(this._showTileBoundaries=he,this._update())}get showPadding(){return!!this._showPadding}set showPadding(he){this._showPadding!==he&&(this._showPadding=he,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(he){this._showCollisionBoxes!==he&&(this._showCollisionBoxes=he,he?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(he){this._showOverdrawInspector!==he&&(this._showOverdrawInspector=he,this._update())}get repaint(){return!!this._repaint}set repaint(he){this._repaint!==he&&(this._repaint=he,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(he){this._vertices=he,this._update()}get version(){return E0}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(he){this.options=o.extend({},jv,he),this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",g=>g.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",g=>this._map.zoomIn({},{originalEvent:g})),ge.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",g=>this._map.zoomOut({},{originalEvent:g})),ge.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",g=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:g}):this._map.resetNorth({},{originalEvent:g})}),this._compassIcon=ge.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const he=this._map.getZoom(),g=he===this._map.getMaxZoom(),A=he===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=A,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",A.toString())}_rotateCompassArrow(){const he=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=he}onAdd(he){return this._map=he,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new c1(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ge.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(he,g){const A=ge.create("button",he,this._container);return A.type="button",A.addEventListener("click",g),A}_setButtonTitle(he,g){const A=this._map._getUIString(`NavigationControl.${g}`);he.title=A,he.setAttribute("aria-label",A)}},GeolocateControl:class extends o.Evented{constructor(he){super(),this.options=o.extend({},R1,he),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(he){var g;return this._map=he,this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),g=this._setupUI,S0!==void 0?g(S0):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(A=>{S0=A.state!=="denied",g(S0)}):(S0=!!window.navigator.geolocation,g(S0)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ge.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mv=0,U0=!1}_isOutOfMapMaxBounds(he){const g=this._map.getMaxBounds(),A=he.coords;return g&&(A.longitude<g.getWest()||A.longitude>g.getEast()||A.latitude<g.getSouth()||A.latitude>g.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(he){if(this._map){if(this._isOutOfMapMaxBounds(he))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",he)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=he,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(he),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(he),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",he)),this._finish()}}_updateCamera(he){const g=new o.LngLat(he.coords.longitude,he.coords.latitude),A=he.coords.accuracy,q=this._map.getBearing(),nt=o.extend({bearing:q},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(A),nt,{geolocateSource:!0})}_updateMarker(he){if(he){const g=new o.LngLat(he.coords.longitude,he.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=he.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const he=this._map._container.clientHeight/2,g=this._map.unproject([0,he]),A=this._map.unproject([1,he]),q=g.distanceTo(A),nt=Math.ceil(2*this._accuracy/q);this._circleElement.style.width=`${nt}px`,this._circleElement.style.height=`${nt}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(he){if(this._map){if(this.options.trackUserLocation)if(he.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(he.code===3&&U0)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",he)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(he){if(this._container.addEventListener("contextmenu",g=>g.preventDefault()),this._geolocateButton=ge.create("button","maplibregl-ctrl-geolocate",this._container),ge.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",he===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ge.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new zg(this._dotElement),this._circleElement=ge.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",g=>{g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g.originalEvent&&g.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mv--,U0=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let he;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mv++,Mv>1?(he={maximumAge:6e5,timeout:0},U0=!0):(he=this.options.positionOptions,U0=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,he)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:sv,LogoControl:z0,ScaleControl:class{constructor(he){this.options=o.extend({},Ty,he),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){qv(this._map,this._container,this.options)}onAdd(he){return this._map=he,this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-scale",he.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ge.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(he){this.options.unit=he,qv(this._map,this._container,this.options)}},FullscreenControl:class extends o.Evented{constructor(he={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,he&&he.container&&(he.container instanceof HTMLElement?this._container=he.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(he){return this._map=he,this._container||(this._container=this._map.getContainer()),this._controlContainer=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ge.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const he=this._fullscreenButton=ge.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ge.create("span","maplibregl-ctrl-icon",he).setAttribute("aria-hidden","true"),he.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const he=this._getTitle();this._fullscreenButton.setAttribute("aria-label",he),this._fullscreenButton.title=he}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this.fire(new o.Event(this._fullscreen?"fullscreenstart":"fullscreenend"))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(he){this.options=he,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(he){return this._map=he,this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ge.create("button","maplibregl-ctrl-terrain",this._container),ge.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ge.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(he){super(),this.options=o.extend(Object.create(Iy),he),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(he){return this._map&&this.remove(),this._map=he,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ge.remove(this._content),this._container&&(ge.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(he){return this._lngLat=o.LngLat.convert(he),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(he){return this.setDOMContent(document.createTextNode(he))}setHTML(he){const g=document.createDocumentFragment(),A=document.createElement("body");let q;for(A.innerHTML=he;q=A.firstChild,q;)g.appendChild(q);return this.setDOMContent(g)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(he){return this.options.maxWidth=he,this._update(),this}setDOMContent(he){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ge.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(he),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(he){this._container&&this._container.classList.add(he)}removeClassName(he){this._container&&this._container.classList.remove(he)}setOffset(he){return this.options.offset=he,this._update(),this}toggleClassName(he){if(this._container)return this._container.classList.toggle(he)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ge.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(he){this._update(he.point)}_onMouseMove(he){this._update(he.point)}_onDrag(he){this._update(he.point)}_update(he){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=ge.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ge.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(Ft=>this._container.classList.add(Ft)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Iv(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!he))return;const g=this._pos=this._trackPointer&&he?he:this._map.project(this._lngLat);let A=this.options.anchor;const q=Ip(this.options.offset);if(!A){const Ft=this._container.offsetWidth,Xr=this._container.offsetHeight;let ls;ls=g.y+q.bottom.y<Xr?["top"]:g.y>this._map.transform.height-Xr?["bottom"]:[],g.x<Ft/2?ls.push("left"):g.x>this._map.transform.width-Ft/2&&ls.push("right"),A=ls.length===0?"bottom":ls.join("-")}const nt=g.add(q[A]).round();ge.setTransform(this._container,`${Cv[A]} translate(${nt.x}px,${nt.y}px)`),uv(this._container,A,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const he=this._container.querySelector(Zv);he&&he.focus()}_onClose(){this.remove()}},Marker:zg,Style:nd,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:op,GeoJSONSource:rp,ImageSource:yd,RasterDEMTileSource:Fd,RasterTileSource:Id,VectorTileSource:bf,VideoSource:Jd,prewarm:function(){Mp().acquire(Df)},clearPrewarmedResources:function(){const he=Wf;he&&(he.isPreloaded()&&he.numActive()===1?(he.release(Df),Wf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return O1},get workerCount(){return Jf.workerCount},set workerCount(he){Jf.workerCount=he},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(he){o.config.MAX_PARALLEL_IMAGE_REQUESTS=he},workerUrl:"",addProtocol(he,g){o.config.REGISTERED_PROTOCOLS[he]=g},removeProtocol(he){delete o.config.REGISTERED_PROTOCOLS[he]}};return Fv.extend(K_,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),K_});var f=a;return f})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl__default=getDefaultExportFromCjs(maplibreGlExports),version$2="3.7.5",VERSION=version$2,_hasatob=typeof atob=="function",_hasbtoa=typeof btoa=="function",_hasBuffer=typeof Buffer=="function",_TD=typeof TextDecoder=="function"?new TextDecoder:void 0,_TE=typeof TextEncoder=="function"?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_mkUriSafe=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),_tidyB64=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=e=>{let t,r,n,a,s="";const f=e.length%3;for(let o=0;o<e.length;){if((r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(a=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|a,s+=b64chs[t>>18&63]+b64chs[t>>12&63]+b64chs[t>>6&63]+b64chs[t&63]}return f?s.slice(0,f-3)+"===".substring(f):s},_btoa=_hasbtoa?e=>btoa(e):_hasBuffer?e=>Buffer.from(e,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,a=e.length;n<a;n+=4096)r.push(_fromCC.apply(null,e.subarray(n,n+4096)));return _btoa(r.join(""))},fromUint8Array=(e,t=!1)=>t?_mkUriSafe(_fromUint8Array(e)):_fromUint8Array(e),cb_utob=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?_fromCC(192|t>>>6)+_fromCC(128|t&63):_fromCC(224|t>>>12&15)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return _fromCC(240|t>>>18&7)+_fromCC(128|t>>>12&63)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=e=>e.replace(re_utob,cb_utob),_encode=_hasBuffer?e=>Buffer.from(e,"utf8").toString("base64"):_TE?e=>_fromUint8Array(_TE.encode(e)):e=>_btoa(utob(e)),encode=(e,t=!1)=>t?_mkUriSafe(_encode(e)):_encode(e),encodeURI=e=>encode(e,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return _fromCC((r>>>10)+55296)+_fromCC((r&1023)+56320);case 3:return _fromCC((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return _fromCC((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=e=>e.replace(re_btou,cb_btou),atobPolyfill=e=>{if(e=e.replace(/\s+/g,""),!b64re.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,a;for(let s=0;s<e.length;)t=b64tab[e.charAt(s++)]<<18|b64tab[e.charAt(s++)]<<12|(n=b64tab[e.charAt(s++)])<<6|(a=b64tab[e.charAt(s++)]),r+=n===64?_fromCC(t>>16&255):a===64?_fromCC(t>>16&255,t>>8&255):_fromCC(t>>16&255,t>>8&255,t&255);return r},_atob=_hasatob?e=>atob(_tidyB64(e)):_hasBuffer?e=>Buffer.from(e,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?e=>_U8Afrom(Buffer.from(e,"base64")):e=>_U8Afrom(_atob(e).split("").map(t=>t.charCodeAt(0))),toUint8Array=e=>_toUint8Array(_unURI(e)),_decode=_hasBuffer?e=>Buffer.from(e,"base64").toString("utf8"):_TD?e=>_TD.decode(_toUint8Array(e)):e=>btou(_atob(e)),_unURI=e=>_tidyB64(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),decode=e=>_decode(_unURI(e)),isValid=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},_noEnum=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){const e=(t,r)=>Object.defineProperty(String.prototype,t,_noEnum(r));e("fromBase64",function(){return decode(this)}),e("toBase64",function(t){return encode(this,t)}),e("toBase64URI",function(){return encode(this,!0)}),e("toBase64URL",function(){return encode(this,!0)}),e("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){const e=(t,r)=>Object.defineProperty(Uint8Array.prototype,t,_noEnum(r));e("toBase64",function(t){return fromUint8Array(this,t)}),e("toBase64URI",function(){return fromUint8Array(this,!0)}),e("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version$2,VERSION,atob:_atob,atobPolyfill,btoa:_btoa,btoaPolyfill,fromBase64:decode,toBase64:encode,encode,encodeURI,encodeURL:encodeURI,utob,btou,decode,isValid,fromUint8Array,toUint8Array,extendString,extendUint8Array,extendBuiltins};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(e,t,r){if(native.randomUUID&&!t&&!e)return native.randomUUID();e=e||{};const n=e.random||(e.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let a=0;a<16;++a)t[r+a]=n[a];return t}return unsafeStringify(n)}function tryGettingFetch(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class ClientConfig{constructor(){this._apiKey="",this._fetch=tryGettingFetch()}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}}const config$1=new ClientConfig,LanguageGeocoding={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languageCodeSet$1=new Set(Object.values(LanguageGeocoding));function getAutoLanguageGeocoding(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const e=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet$1.has(t));return e.length?e[0]:LanguageGeocoding.ENGLISH}var __async$4=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});function callFetch(e){return __async$4(this,arguments,function*(t,r={}){if(config$1.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(t).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return config$1.fetch(t,r)})}const defaults$1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(defaults$1);class ServiceError extends Error{constructor(t,r=""){super(`Call to enpoint ${t.url} failed with the status code ${t.status}. ${r}`),this.res=t}}var __async$3=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages$3={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function addLanguageGeocodingOptions(e,t){if(t.language==null)return;const r=Array.from(new Set((Array.isArray(t.language)?t.language:[t.language]).map(n=>n===LanguageGeocoding.AUTO?getAutoLanguageGeocoding():n))).join(",");e.set("language",r)}function addCommonForwardAndReverseGeocodingOptions(e,t){var r;e.set("key",(r=t.apiKey)!=null?r:config$1.apiKey),t.limit!=null&&e.set("limit",String(t.limit)),t.types!=null&&e.set("types",t.types.join(",")),addLanguageGeocodingOptions(e,t)}function addForwardGeocodingOptions(e,t){addCommonForwardAndReverseGeocodingOptions(e,t),t.bbox!=null&&e.set("bbox",t.bbox.join(",")),t.proximity!=null&&e.set("proximity",t.proximity.join(",")),t.country!=null&&e.set("country",t.country.join(",")),t.fuzzyMatch!=null&&e.set("fuzzyMatch",t.fuzzyMatch?"true":"false"),t.autocomplete!=null&&e.set("autocomplete",t.autocomplete?"true":"false")}function forward(e){return __async$3(this,arguments,function*(t,r={}){var n;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const a=new URL(`geocoding/${encodeURIComponent(t)}.json`,defaults$1.maptilerApiURL),{searchParams:s}=a;addForwardGeocodingOptions(s,r);const f=a.toString(),o=yield callFetch(f);if(!o.ok)throw new ServiceError(o,(n=customMessages$3[o.status])!=null?n:"");return yield o.json()})}function reverse(e){return __async$3(this,arguments,function*(t,r={}){var n;if(!Array.isArray(t)||t.length<2)throw new Error("The position must be an array of form [lng, lat].");const a=new URL(`geocoding/${t[0]},${t[1]}.json`,defaults$1.maptilerApiURL);addCommonForwardAndReverseGeocodingOptions(a.searchParams,r);const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,(n=customMessages$3[f.status])!=null?n:"");return yield f.json()})}function byId(e){return __async$3(this,arguments,function*(t,r={}){var n;const a=new URL(`geocoding/${t}.json`,defaults$1.maptilerApiURL);addLanguageGeocodingOptions(a.searchParams,r);const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,(n=customMessages$3[f.status])!=null?n:"");return yield f.json()})}function batch(e){return __async$3(this,arguments,function*(t,r={}){var n;if(!t.length)return[];const a=t.map(P=>encodeURIComponent(P)).join(";"),s=new URL(`geocoding/${a}.json`,defaults$1.maptilerApiURL),{searchParams:f}=s;addForwardGeocodingOptions(f,r);const o=s.toString(),x=yield callFetch(o);if(!x.ok)throw new ServiceError(x,(n=customMessages$3[x.status])!=null?n:"");const C=yield x.json();return t.length===1?[C]:C})}const geocoding={forward,reverse,byId,batch,language:LanguageGeocoding};var __async$2=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages$2={403:"Key is missing, invalid or restricted"};function info(){return __async$2(this,arguments,function*(e={}){var t;const r=new URL("geolocation/ip.json",defaults$1.maptilerApiURL);r.searchParams.set("key",(t=e.apiKey)!=null?t:config$1.apiKey);const n=r.toString(),a=yield callFetch(n);if(!a.ok)throw new ServiceError(a,a.status in customMessages$2?customMessages$2[a.status]:"");return yield a.json()})}const geolocation={info};var __async$1=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages$1={403:"Key is missing, invalid or restricted"};function search(e){return __async$1(this,arguments,function*(t,r={}){var n;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const a=new URL(`coordinates/search/${t}.json`,defaults$1.maptilerApiURL);a.searchParams.set("key",(n=r.apiKey)!=null?n:config$1.apiKey),"limit"in r&&a.searchParams.set("limit",r.limit.toString()),"transformations"in r&&a.searchParams.set("transformations",r.transformations.toString()),"exports"in r&&a.searchParams.set("exports",r.exports.toString());const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,f.status in customMessages$1?customMessages$1[f.status]:"");return yield f.json()})}function transform(e){return __async$1(this,arguments,function*(t,r={}){var n;const a=(Array.isArray(t[0])?t:[t]).map(C=>`${C[0]},${C[1]}`).join(";"),s=new URL(`coordinates/transform/${a}.json`,defaults$1.maptilerApiURL);s.searchParams.set("key",(n=r.apiKey)!=null?n:config$1.apiKey),"sourceCrs"in r&&s.searchParams.set("s_srs",r.sourceCrs.toString()),"targetCrs"in r&&s.searchParams.set("t_srs",r.targetCrs.toString()),"operations"in r&&s.searchParams.set("ops",(Array.isArray(r.operations)?r.operations:[r.operations]).join("|"));const f=s.toString(),o=yield callFetch(f);if(!o.ok)throw new ServiceError(o,o.status in customMessages$1?customMessages$1[o.status]:"");return yield o.json()})}const coordinates={search,transform};var __async$5=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages={403:"Key is missing, invalid or restricted"};function get(e){return __async$5(this,arguments,function*(t,r={}){var n;if(typeof t!="string"||t.trim().length===0)throw new Error("The data ID must be a non-empty string");const a=new URL(`data/${encodeURIComponent(t)}/features.json`,defaults$1.maptilerApiURL);a.searchParams.set("key",(n=r.apiKey)!=null?n:config$1.apiKey);const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,f.status in customMessages?customMessages[f.status]:"");return yield f.json()})}const data={get};function expandMapStyle(e){const t=/^maptiler:\/\/(.*)/;let r;const n=e.trim();let a;return n.startsWith("http://")||n.startsWith("https://")?a=n:(r=t.exec(n))!==null?a=`https://api.maptiler.com/maps/${r[1]}/style.json`:a=`https://api.maptiler.com/maps/${n}/style.json`,a}class MapStyleVariant{constructor(t,r,n,a,s,f){this.name=t,this.variantType=r,this.id=n,this.referenceStyle=a,this.description=s,this.imageURL=f}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){return this.referenceStyle.getVariant(t)}getVariants(){return this.referenceStyle.getVariants().filter(t=>t!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return expandMapStyle(this.getId())}}class ReferenceMapStyle{constructor(t,r){this.name=t,this.id=r,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const mapStylePresetList=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function makeReferenceStyleProxy(e){return new Proxy(e,{get(t,r,n){return t.hasVariant(r)?t.getVariant(r):r.toString().toUpperCase()===r?e.getDefaultVariant():Reflect.get(t,r,n)}})}function buildMapStyles(){const e={};for(let t=0;t<mapStylePresetList.length;t+=1){const r=mapStylePresetList[t],n=makeReferenceStyleProxy(new ReferenceMapStyle(r.name,r.referenceStyleID));for(let a=0;a<r.variants.length;a+=1){const s=r.variants[a],f=new MapStyleVariant(s.name,s.variantType,s.id,n,s.description,s.imageURL);n.addVariant(f)}e[r.referenceStyleID]=n}return e}function styleToStyle$1(e){if(!e)return MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getId();if(typeof e=="string"||e instanceof String)return e.trim().toLowerCase();if(e instanceof MapStyleVariant)return e.getId();if(e instanceof ReferenceMapStyle)return e.getDefaultVariant().getId()}const MapStyle=buildMapStyles();function getSqSegDist(e,t,r){let n=t[0],a=t[1],s=r[0]-n,f=r[1]-a;if(s!==0||f!==0){const o=((e[0]-n)*s+(e[1]-a)*f)/(s*s+f*f);o>1?(n=r[0],a=r[1]):o>0&&(n+=s*o,a+=f*o)}return s=e[0]-n,f=e[1]-a,s*s+f*f}function simplifyDPStep(e,t,r,n,a){let s=n,f;for(let o=t+1;o<r;o++){const x=getSqSegDist(e[o],e[t],e[r]);x>s&&(f=o,s=x)}s>n&&(f-t>1&&simplifyDPStep(e,t,f,n,a),a.push(e[f]),r-f>1&&simplifyDPStep(e,f,r,n,a))}function simplifyDouglasPeucker(e,t){const r=e.length-1,n=[e[0]];return simplifyDPStep(e,0,r,t,n),n.push(e[r]),n}function simplify(e,t){if(e.length<=2)return e;const r=t!==void 0?t*t:1;return simplifyDouglasPeucker(e,r)}function staticMapMarkerToString(e,t=!0){let r=`${e[0]},${e[1]}`;return e.length===3&&t&&(r+=`,${e[2]}`),r}function simplifyAndStringify(e,t=3e3){let r=e.map(s=>s.join(",")).join("|"),n=5e-6;const a=1e-5;for(;r.length>t;)r=simplify(e,n).map(f=>`${f[0]},${f[1]}`).join("|"),n+=a;return r}function centered(e,t,r={}){var n,a,s,f,o;const x=styleToStyle$1(r.style),C=r.hiDPI?"@2x":"",P=(n=r.format)!=null?n:"png";let Y=~~((a=r.width)!=null?a:1024),ze=~~((s=r.height)!=null?s:1024);r.hiDPI&&(Y=~~(Y/2),ze=~~(ze/2));const ge=new URL(`maps/${encodeURIComponent(x)}/static/${e[0]},${e[1]},${t}/${Y}x${ze}${C}.${P}`,defaults$1.maptilerApiURL);if("attribution"in r&&ge.searchParams.set("attribution",r.attribution.toString()),"markers"in r){let Bt="";const Ur="markerIcon"in r;Ur&&(Bt+=`icon:${r.markerIcon}|`),Ur&&"markerAnchor"in r&&(Bt+=`anchor:${r.markerAnchor}|`),Ur&&r.hiDPI&&(Bt+="scale:2|");const kn=Array.isArray(r.markers[0])?r.markers:[r.markers];Bt+=kn.map(Io=>staticMapMarkerToString(Io,!Ur)).join("|"),ge.searchParams.set("markers",Bt)}if("path"in r){let Bt="";if(Bt+=`fill:${(f=r.pathFillColor)!=null?f:"none"}|`,"pathStrokeColor"in r&&(Bt+=`stroke:${r.pathStrokeColor}|`),"pathWidth"in r){const Ur=r.pathWidth/(r.hiDPI?2:1);Bt+=`width:${Ur.toString()}|`}Bt+=simplifyAndStringify(r.path),ge.searchParams.set("path",Bt)}return ge.searchParams.set("key",(o=r.apiKey)!=null?o:config$1.apiKey),ge.toString()}function bounded(e,t={}){var r,n,a,s,f;const o=styleToStyle$1(t.style),x=t.hiDPI?"@2x":"",C=(r=t.format)!=null?r:"png";let P=~~((n=t.width)!=null?n:1024),Y=~~((a=t.height)!=null?a:1024);t.hiDPI&&(P=~~(P/2),Y=~~(Y/2));const ze=new URL(`maps/${encodeURIComponent(o)}/static/${e[0]},${e[1]},${e[2]},${e[3]}/${P}x${Y}${x}.${C}`,defaults$1.maptilerApiURL);if("attribution"in t&&ze.searchParams.set("attribution",t.attribution.toString()),"padding"in t&&ze.searchParams.set("padding",t.padding.toString()),"markers"in t){let ge="";const Bt="markerIcon"in t;Bt&&(ge+=`icon:${t.markerIcon}|`),Bt&&"markerAnchor"in t&&(ge+=`anchor:${t.markerAnchor}|`),Bt&&t.hiDPI&&(ge+="scale:2|");const Ur=Array.isArray(t.markers[0])?t.markers:[t.markers];ge+=Ur.map(kn=>staticMapMarkerToString(kn,!Bt)).join("|"),ze.searchParams.set("markers",ge)}if("path"in t){let ge="";if(ge+=`fill:${(s=t.pathFillColor)!=null?s:"none"}|`,"pathStrokeColor"in t&&(ge+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){const Bt=t.pathWidth/(t.hiDPI?2:1);ge+=`width:${Bt.toString()}|`}ge+=simplifyAndStringify(t.path),ze.searchParams.set("path",ge)}return ze.searchParams.set("key",(f=t.apiKey)!=null?f:config$1.apiKey),ze.toString()}function automatic(e={}){var t,r,n,a,s;if(!("markers"in e)&&!("path"in e))throw new Error("Automatic static maps require markers and/or path to be created.");const f=styleToStyle$1(e.style),o=e.hiDPI?"@2x":"",x=(t=e.format)!=null?t:"png";let C=~~((r=e.width)!=null?r:1024),P=~~((n=e.height)!=null?n:1024);e.hiDPI&&(C=~~(C/2),P=~~(P/2));const Y=new URL(`maps/${encodeURIComponent(f)}/static/auto/${C}x${P}${o}.${x}`,defaults$1.maptilerApiURL);if("attribution"in e&&Y.searchParams.set("attribution",e.attribution.toString()),"padding"in e&&Y.searchParams.set("padding",e.padding.toString()),"markers"in e){let ze="";const ge="markerIcon"in e;ge&&(ze+=`icon:${e.markerIcon}|`),ge&&"markerAnchor"in e&&(ze+=`anchor:${e.markerAnchor}|`),ge&&e.hiDPI&&(ze+="scale:2|");const Bt=Array.isArray(e.markers[0])?e.markers:[e.markers];ze+=Bt.map(Ur=>staticMapMarkerToString(Ur,!ge)).join("|"),Y.searchParams.set("markers",ze)}if("path"in e){let ze="";if(ze+=`fill:${(a=e.pathFillColor)!=null?a:"none"}|`,"pathStrokeColor"in e&&(ze+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){const ge=e.pathWidth/(e.hiDPI?2:1);ze+=`width:${ge.toString()}|`}ze+=simplifyAndStringify(e.path),Y.searchParams.set("path",ze)}return Y.searchParams.set("key",(s=e.apiKey)!=null?s:config$1.apiKey),Y.toString()}const staticMaps={centered,bounded,automatic},Language={AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"latin",NON_LATIN:"nonlatin",LOCAL:"",ALBANIAN:"sq",AMHARIC:"am",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BASQUE:"eu",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CORSICAN:"co",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",JAPANESE_HIRAGANA:"ja-Hira",JAPANESE_KANA:"ja_kana",JAPANESE_LATIN:"ja_rm",JAPANESE_2018:"ja-Latn",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",KOREAN_LATIN:"ko-Latn",KURDISH:"ku",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALAYALAM:"ml",MALTESE:"mt",NORWEGIAN:"no",OCCITAN:"oc",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SERBIAN_LATIN:"sr-Latn",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languagesIsoSet=new Set(Object.values(Language));function isLanguageSupported(e){return languagesIsoSet.has(e)}const languageCodeSet=new Set(Object.values(Language));function getBrowserLanguage(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const e=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet.has(t));return e.length?e[0]:Language.LATIN}class SdkConfig extends EventEmitter$4{constructor(){super(),this.primaryLanguage=Language.AUTO,this.secondaryLanguage=null,this.session=!0,this._unit="metric",this._apiKey=""}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,config$1.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){config$1.fetch=t}get fetch(){return config$1.fetch}}const config=new SdkConfig,defaults={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Language.AUTO,secondaryLanguage:Language.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(defaults);class LogoControl extends maplibregl__default.LogoControl{onAdd(t){return super.onAdd(t)}}class MaptilerLogoControl extends LogoControl{constructor(t={}){var r,n;super(t),this.logoURL="",this.linkURL="",this.logoURL=(r=t.logoURL)!=null?r:defaults.maptilerLogoURL,this.linkURL=(n=t.linkURL)!=null?n:defaults.maptilerURL}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const r=window.document.createElement("a");return r.style.backgroundRepeat="no-repeat",r.style.cursor="pointer",r.style.display="block",r.style.height="23px",r.style.margin="0 0 -4px -4px",r.style.overflow="hidden",r.style.width="88px",r.style.backgroundImage=`url(${this.logoURL})`,r.style.backgroundSize="100px 30px",r.style.width="100px",r.style.height="30px",r.target="_blank",r.rel="noopener nofollow",r.href=this.linkURL,r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}function enableRTL(){maplibregl__default.getRTLTextPluginStatus()==="unavailable"&&maplibregl__default.setRTLTextPlugin(defaults.rtlPluginURL,null,!0)}function bindAll(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function DOMcreate(e,t,r){const n=window.document.createElement(e);return t!==void 0&&(n.className=t),r&&r.appendChild(n),n}function DOMremove(e){e.parentNode&&e.parentNode.removeChild(e)}function styleToStyle(e){return e?typeof e=="string"||e instanceof String?!e.startsWith("http")&&e.toLowerCase().includes(".json")?e:expandMapStyle(e):e instanceof MapStyleVariant?e.getExpandedStyleURL():e instanceof ReferenceMapStyle?e.getDefaultVariant().getExpandedStyleURL():e:MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class MaptilerTerrainControl{constructor(){bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=DOMcreate("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=DOMcreate("button","maplibregl-ctrl-terrain",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){DOMremove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class NavigationControl extends maplibregl__default.NavigationControl{onAdd(t){return super.onAdd(t)}}class MaptilerNavigationControl extends NavigationControl{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})}_createButton(t,r){const n=super._createButton(t,r);return n.clickFunction=r,n}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t}}class GeolocateControl extends maplibregl__default.GeolocateControl{onAdd(t){return super.onAdd(t)}}var __defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(e,t,r)=>t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues$1=(e,t)=>{for(var r in t||(t={}))__hasOwnProp$1.call(t,r)&&__defNormalProp$1(e,r,t[r]);if(__getOwnPropSymbols$1)for(var r of __getOwnPropSymbols$1(t))__propIsEnum$1.call(t,r)&&__defNormalProp$1(e,r,t[r]);return e},__spreadProps$1=(e,t)=>__defProps$1(e,__getOwnPropDescs$1(t));const Marker$1=maplibregl__default.Marker,LngLat$1=maplibregl__default.LngLat;class MaptilerGeolocateControl extends GeolocateControl{constructor(){super(...arguments),this.lastUpdatedCenter=new LngLat$1(0,0)}_updateCamera(t){const r=new LngLat$1(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,a=this._map.getBearing(),s=__spreadProps$1(__spreadValues$1({bearing:a},this.options.fitBoundsOptions),{linear:!0}),f=this._map.getZoom();f>this.options.fitBoundsOptions.maxZoom&&(s.zoom=f),this._map.fitBounds(r.toBounds(n),s,{geolocateSource:!0});let o=!1;const x=()=>{o=!0};this._map.once("click",x),this._map.once("dblclick",x),this._map.once("dragstart",x),this._map.once("mousedown",x),this._map.once("touchstart",x),this._map.once("wheel",x),this._map.once("moveend",()=>{this._map.off("click",x),this._map.off("dblclick",x),this._map.off("dragstart",x),this._map.off("mousedown",x),this._map.off("touchstart",x),this._map.off("wheel",x),!o&&(this.lastUpdatedCenter=this._map.getCenter())})}_setupUI(t){if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=DOMcreate("button","maplibregl-ctrl-geolocate",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOMcreate("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Marker$1(this._dotElement),this._circleElement=DOMcreate("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Marker$1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",r=>{const n=r.originalEvent&&r.originalEvent.type==="resize",a=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!r.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!n&&a>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],r=this._map.project(t),n=this._map.unproject([r.x,r.y]),a=this._map.unproject([r.x+20,r.y]),s=n.distanceTo(a)/20,f=Math.ceil(2*this._accuracy/s);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}}class AttributionControl extends maplibregl__default.AttributionControl{onAdd(t){return super.onAdd(t)}}class ScaleControl extends maplibregl__default.ScaleControl{onAdd(t){return super.onAdd(t)}}class FullscreenControl extends maplibregl__default.FullscreenControl{onAdd(t){return super.onAdd(t)}}var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const MAPTILER_SESSION_ID=v4(),GeolocationType={POINT:"POINT",COUNTRY:"COUNTRY"};let Map$1=class extends maplibregl__default.Map{constructor(t){var r,n,a;t.apiKey&&(config.apiKey=t.apiKey);const s=styleToStyle(t.style),f=location.hash;config.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(__spreadProps(__spreadValues({},t),{style:s,maplibreLogo:!1,transformRequest:Y=>{let ze=null;try{ze=new URL(Y)}catch{return{url:Y,headers:{}}}return ze.host===defaults.maptilerApiHost&&(ze.searchParams.has("key")||ze.searchParams.append("key",config.apiKey),config.session&&ze.searchParams.append("mtsid",MAPTILER_SESSION_ID)),{url:ze.href,headers:{}}}})),this.isTerrainEnabled=!1,this.terrainExaggeration=1,this.primaryLanguage=null,this.secondaryLanguage=null,this.terrainGrowing=!1,this.terrainFlattening=!1,this.primaryLanguage=(r=t.language)!=null?r:config.primaryLanguage,this.secondaryLanguage=config.secondaryLanguage,this.terrainExaggeration=(n=t.terrainExaggeration)!=null?n:this.terrainExaggeration,this.once("styledata",()=>__async(this,null,function*(){if(!t.geolocate||t.center||t.hash&&f)return;try{if(t.geolocate===GeolocationType.COUNTRY){yield this.fitToIpBounds();return}}catch(ge){console.warn(ge.message)}let Y=null;try{yield this.centerOnIpPoint(t.zoom),Y=this.getCameraHash()}catch(ge){console.warn(ge.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(ge=>{Y===this.getCameraHash()&&(this.terrain?this.easeTo({center:[ge.coords.longitude,ge.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[ge.coords.longitude,ge.coords.latitude],zoom:t.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage),this.setSecondaryLanguage(this.secondaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>__async(this,null,function*(){enableRTL()})),this.once("load",()=>__async(this,null,function*(){let Y={logo:null};try{const ze=Object.keys(this.style.sourceCaches).map(Ur=>this.getSource(Ur)).filter(Ur=>typeof Ur.url=="string"&&Ur.url.includes("tiles.json")),ge=new URL(ze[0].url);ge.searchParams.has("key")||ge.searchParams.append("key",config.apiKey),Y=yield(yield fetch(ge.href)).json()}catch{}if("logo"in Y&&Y.logo){const ze=Y.logo;this.addControl(new MaptilerLogoControl({logoURL:ze}),t.logoPosition),t.attributionControl===!1&&this.addControl(new AttributionControl(t))}else t.maptilerLogo&&this.addControl(new MaptilerLogoControl,t.logoPosition);if(t.scaleControl){const ze=t.scaleControl===!0||t.scaleControl===void 0?"bottom-right":t.scaleControl,ge=new ScaleControl({unit:config.unit});this.addControl(ge,ze),config.on("unit",Bt=>{ge.setUnit(Bt)})}if(t.navigationControl!==!1){const ze=t.navigationControl===!0||t.navigationControl===void 0?"top-right":t.navigationControl;this.addControl(new MaptilerNavigationControl,ze)}if(t.geolocateControl!==!1){const ze=t.geolocateControl===!0||t.geolocateControl===void 0?"top-right":t.geolocateControl;this.addControl(new MaptilerGeolocateControl({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),ze)}if(t.terrainControl){const ze=t.terrainControl===!0||t.terrainControl===void 0?"top-right":t.terrainControl;this.addControl(new MaptilerTerrainControl,ze)}if(t.fullscreenControl){const ze=t.fullscreenControl===!0||t.fullscreenControl===void 0?"top-right":t.fullscreenControl;this.addControl(new FullscreenControl({}),ze)}}));let o=!1,x=!1,C=null;this.once("load",Y=>{o=!0,x&&this.fire("loadWithTerrain",C)});const P=Y=>{Y.terrain&&(x=!0,C={type:"loadWithTerrain",target:this,terrain:Y.terrain},this.off("terrain",P),o&&this.fire("loadWithTerrain",C))};this.on("terrain",P),t.terrain&&this.enableTerrain((a=t.terrainExaggeration)!=null?a:this.terrainExaggeration)}onLoadAsync(){return __async(this,null,function*(){return new Promise((t,r)=>{if(this.loaded())return t(this);this.once("load",n=>{t(this)})})})}onLoadWithTerrainAsync(){return __async(this,null,function*(){return new Promise((t,r)=>{if(this.loaded()&&this.terrain)return t(this);this.once("loadWithTerrain",n=>{t(this)})})})}setStyle(t,r){return super.setStyle(styleToStyle(t),r)}setLanguage(t=defaults.primaryLanguage){if(t===Language.AUTO)return this.setLanguage(getBrowserLanguage());this.setPrimaryLanguage(t)}setPrimaryLanguage(t=defaults.primaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.primaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setPrimaryLanguage(getBrowserLanguage());const r=this.getStyle().layers,n=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,a=/^\s*name\s*(:\s*(\S*))?\s*$/,s=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/,f=/^(.*)({\s*name\s*(:\s*(\S*))?\s*})(.*)$/,o=t?`name:${t}`:"name",x=["case",["has",o],["get",o],["get","name"]];for(let C=0;C<r.length;C+=1){const P=r[C],Y=P.layout;if(!Y||!Y["text-field"])continue;const ze=this.getLayoutProperty(P.id,"text-field");let ge;if(Array.isArray(ze)&&ze.length>=2&&ze[0].trim().toLowerCase()==="concat"){const Bt=ze.slice();for(let Ur=0;Ur<ze.length;Ur+=1){const kn=ze[Ur];if((typeof kn=="string"||kn instanceof String)&&n.exec(kn.toString())){Bt[Ur]=x;break}else if(Array.isArray(kn)&&kn.length>=2&&kn[0].trim().toLowerCase()==="get"&&a.exec(kn[1].toString())){Bt[Ur]=x;break}else if(Array.isArray(kn)&&kn.length===4&&kn[0].trim().toLowerCase()==="case"){Bt[Ur]=x;break}}this.setLayoutProperty(P.id,"text-field",Bt)}else if(Array.isArray(ze)&&ze.length>=2&&ze[0].trim().toLowerCase()==="get"&&a.exec(ze[1].toString())){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof ze=="string"||ze instanceof String)&&n.exec(ze.toString())){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if(Array.isArray(ze)&&ze.length===4&&ze[0].trim().toLowerCase()==="case"){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof ze=="string"||ze instanceof String)&&(ge=s.exec(ze.toString()))!==null){const Bt=`{${o}}${ge[3]}{name${ge[4]||""}}`;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof ze=="string"||ze instanceof String)&&(ge=f.exec(ze.toString()))!==null){const Bt=`${ge[1]}{${o}}${ge[5]}`;this.setLayoutProperty(P.id,"text-field",Bt)}}}))}setSecondaryLanguage(t=defaults.secondaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.secondaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setSecondaryLanguage(getBrowserLanguage());const r=this.getStyle().layers,n=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,a=/^\s*name\s*(:\s*(\S*))?\s*$/,s=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/;let f;for(let o=0;o<r.length;o+=1){const x=r[o],C=x.layout;if(!C||!C["text-field"])continue;const P=this.getLayoutProperty(x.id,"text-field");let Y;if(Array.isArray(P)&&P.length>=2&&P[0].trim().toLowerCase()==="concat"){Y=P.slice();let ze=0;for(let ge=0;ge<P.length;ge+=1){const Bt=P[ge];if((typeof Bt=="string"||Bt instanceof String)&&n.exec(Bt.toString())){if(ze===1){Y[ge]=`{name:${t}}`;break}ze+=1}else if(Array.isArray(Bt)&&Bt.length>=2&&Bt[0].trim().toLowerCase()==="get"&&a.exec(Bt[1].toString())){if(ze===1){Y[ge][1]=`name:${t}`;break}ze+=1}else if(Array.isArray(Bt)&&Bt.length===4&&Bt[0].trim().toLowerCase()==="case"){if(ze===1){Y[ge]=["get",`name:${t}`];break}ze+=1}}this.setLayoutProperty(x.id,"text-field",Y)}else if((typeof P=="string"||P instanceof String)&&(f=s.exec(P.toString()))!==null){const ze=t?`name:${t}`:"name";Y=`{name${f[1]||""}}${f[3]}{${ze}}`,this.setLayoutProperty(x.id,"text-field",Y)}}}))}getPrimaryLanguage(){return this.primaryLanguage}getSecondaryLanguage(){return this.secondaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t,r=1e3){if(!this.terrain)return;const n=performance.now(),a=this.terrain.exaggeration,s=t-a,f=()=>{if(!this.terrain||this.terrainFlattening)return;const o=(performance.now()-n)/r;if(o<.99){const x=1-Math.pow(1-o,4),C=a+x*s;this.terrain.exaggeration=C,requestAnimationFrame(f)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(f)}enableTerrain(t=this.terrainExaggeration){if(t<0){console.warn("Terrain exaggeration cannot be negative.");return}const r=a=>__async(this,null,function*(){!this.terrain||a.type!=="data"||a.dataType!=="source"||!("source"in a)||a.sourceId!=="maptiler-terrain"||a.source.type!=="raster-dem"||a.isSourceLoaded&&(this.off("data",r),this.growTerrain(t))}),n=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",r),this.addSource(defaults.terrainSourceId,{type:"raster-dem",url:defaults.terrainSourceURL}),this.setTerrain({source:defaults.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(t);return}this.loaded()||this.isTerrainEnabled?n():this.once("load",()=>{this.getTerrain()&&this.getSource(defaults.terrainSourceId)||n()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=1*1e3,r=performance.now(),n=this.terrain.exaggeration,a=()=>{if(!this.terrain||this.terrainGrowing)return;const s=(performance.now()-r)/t;if(s<.99){const f=Math.pow(1-s,4),o=n*f;this.terrain.exaggeration=o,requestAnimationFrame(a)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(null),this.getSource(defaults.terrainSourceId)&&this.removeSource(defaults.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(a)}setTerrainExaggeration(t,r=!0){!r&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",()=>{t()})}fitToIpBounds(){return __async(this,null,function*(){const t=yield geolocation.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(t){return __async(this,null,function*(){const r=yield geolocation.info();this.jumpTo({center:[r.longitude,r.latitude],zoom:t||11})})}getCameraHash(){const t=new Float32Array(5),r=this.getCenter();return t[0]=r.lng,t[1]=r.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),gBase64.fromUint8Array(new Uint8Array(t.buffer))}getSdkConfig(){return config}getMaptilerSessionId(){return MAPTILER_SESSION_ID}};class Marker extends maplibregl__default.Marker{addTo(t){return super.addTo(t)}}class Popup extends maplibregl__default.Popup{addTo(t){return super.addTo(t)}}class Style extends maplibregl__default.Style{constructor(t,r={}){super(t,r)}}class CanvasSource extends maplibregl__default.CanvasSource{onAdd(t){super.onAdd(t)}}class GeoJSONSource extends maplibregl__default.GeoJSONSource{onAdd(t){super.onAdd(t)}}class ImageSource extends maplibregl__default.ImageSource{onAdd(t){super.onAdd(t)}}class RasterTileSource extends maplibregl__default.RasterTileSource{onAdd(t){super.onAdd(t)}}class RasterDEMTileSource extends maplibregl__default.RasterDEMTileSource{onAdd(t){super.onAdd(t)}}class VectorTileSource extends maplibregl__default.VectorTileSource{onAdd(t){super.onAdd(t)}}class VideoSource extends maplibregl__default.VideoSource{onAdd(t){super.onAdd(t)}}class TerrainControl extends maplibregl__default.TerrainControl{onAdd(t){return super.onAdd(t)}}class Point{constructor(t,r){this.x=t,this.y=r}_matMult(t){const r=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=r,this.y=n,this}_add(t){return this.x+=t.x,this.y+=t.y,this}_sub(t){return this.x-=t.x,this.y-=t.y,this}_mult(t){return this.x*=t,this.y*=t,this}_div(t){return this.x/=t,this.y/=t,this}_multByPoint(t){return this.x*=t.x,this.y*=t.y,this}_divByPoint(t){return this.x/=t.x,this.y/=t.y,this}_unit(){return this._div(this.mag()),this}_perp(){const t=this.y;return this.y=this.x,this.x=-t,this}_rotate(t){const r=Math.cos(t),n=Math.sin(t),a=r*this.x-n*this.y,s=n*this.x+r*this.y;return this.x=a,this.y=s,this}_rotateAround(t,r){const n=Math.cos(t),a=Math.sin(t),s=r.x+n*(this.x-r.x)-a*(this.y-r.y),f=r.y+a*(this.x-r.x)+n*(this.y-r.y);return this.x=s,this.y=f,this}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clone(){return new Point(this.x,this.y)}add(t){return this.clone()._add(t)}sub(t){return this.clone()._sub(t)}multByPoint(t){return this.clone()._multByPoint(t)}divByPoint(t){return this.clone()._divByPoint(t)}mult(t){return this.clone()._mult(t)}div(t){return this.clone()._div(t)}rotate(t){return this.clone()._rotate(t)}rotateAround(t,r){return this.clone()._rotateAround(t,r)}matMult(t){return this.clone()._matMult(t)}unit(){return this.clone()._unit()}perp(){return this.clone()._perp()}round(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(t){return this.x===t.x&&this.y===t.y}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){const r=t.x-this.x,n=t.y-this.y;return r*r+n*n}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleWith(t){return this.angleWithSep(t.x,t.y)}angleWithSep(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)}static convert(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t}}const{supported,setRTLTextPlugin,getRTLTextPluginStatus,LngLat,LngLatBounds,MercatorCoordinate,Evented,AJAXError,prewarm,clearPrewarmedResources,version:version$1,workerCount,maxParallelImageRequests,workerUrl,addProtocol,removeProtocol}=maplibregl__default,MapMLGL=maplibregl__default.Map,MarkerMLGL=maplibregl__default.Marker,PopupMLGL=maplibregl__default.Popup,StyleMLGL=maplibregl__default.Style,CanvasSourceMLGL=maplibregl__default.CanvasSource,GeoJSONSourceMLGL=maplibregl__default.GeoJSONSource,ImageSourceMLGL=maplibregl__default.ImageSource,RasterTileSourceMLGL=maplibregl__default.RasterTileSource,RasterDEMTileSourceMLGL=maplibregl__default.RasterDEMTileSource,VectorTileSourceMLGL=maplibregl__default.VectorTileSource,VideoSourceMLGL=maplibregl__default.VideoSource;maplibregl__default.NavigationControl;maplibregl__default.GeolocateControl;maplibregl__default.AttributionControl;maplibregl__default.LogoControl;maplibregl__default.ScaleControl;maplibregl__default.FullscreenControl;maplibregl__default.TerrainControl;const ll=_mergeNamespaces({__proto__:null,AJAXError,AttributionControl,CanvasSource,CanvasSourceMLGL,Evented,FullscreenControl,GeoJSONSource,GeoJSONSourceMLGL,GeolocateControl,GeolocationType,ImageSource,ImageSourceMLGL,Language,LanguageGeocoding,LngLat,LngLatBounds,LogoControl,Map:Map$1,MapMLGL,MapStyle,MapStyleVariant,MaptilerGeolocateControl,MaptilerLogoControl,MaptilerNavigationControl,MaptilerTerrainControl,Marker,MarkerMLGL,MercatorCoordinate,NavigationControl,Point,Popup,PopupMLGL,RasterDEMTileSource,RasterDEMTileSourceMLGL,RasterTileSource,RasterTileSourceMLGL,ReferenceMapStyle,ScaleControl,SdkConfig,ServiceError,Style,StyleMLGL,TerrainControl,VectorTileSource,VectorTileSourceMLGL,VideoSource,VideoSourceMLGL,addProtocol,clearPrewarmedResources,config,coordinates,data,geocoding,geolocation,getRTLTextPluginStatus,maxParallelImageRequests,prewarm,removeProtocol,setRTLTextPlugin,staticMaps,supported,version:version$1,workerCount,workerUrl},[maplibreGlExports]);var ta=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},zn=(e,t,r)=>(ta(e,t,"read from private field"),r?r.call(e):t.get(e)),fs=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},No=(e,t,r,n)=>(ta(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);function _t(){}function cl(e,t){for(const r in t)e[r]=t[r];return e}function Wa(e){return e()}function ea(){return Object.create(null)}function Fr(e){e.forEach(Wa)}function ja(e){return typeof e=="function"}function Br(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function fl(e){return Object.keys(e).length===0}function hl(e,t,r,n){if(e){const a=Ka(e,t,r,n);return e[0](a)}}function Ka(e,t,r,n){return e[1]&&n?cl(r.ctx.slice(),e[1](n(t))):r.ctx}function gl(e,t,r,n){if(e[2]&&n){const a=e[2](n(r));if(t.dirty===void 0)return a;if(typeof a=="object"){const s=[],f=Math.max(t.dirty.length,a.length);for(let o=0;o<f;o+=1)s[o]=t.dirty[o]|a[o];return s}return t.dirty|a}return t.dirty}function pl(e,t,r,n,a,s){if(a){const f=Ka(t,r,n,s);e.p(f,a)}}function dl(e){if(e.ctx.length>32){const t=[],r=e.ctx.length/32;for(let n=0;n<r;n++)t[n]=-1;return t}return-1}function na(e){return e??""}function rt(e,t){e.appendChild(t)}function Be(e,t,r){e.insertBefore(t,r||null)}function Pe(e){e.parentNode&&e.parentNode.removeChild(e)}function vl(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}function Gt(e){return document.createElement(e)}function jn(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Wr(e){return document.createTextNode(e)}function In(){return Wr(" ")}function Re(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}function yl(e){return function(t){return t.preventDefault(),e.call(this,t)}}function D(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function ml(e){return Array.from(e.childNodes)}function Ki(e,t){t=""+t,e.data!==t&&(e.data=t)}function ra(e,t){e.value=t??""}function nn(e,t,r){e.classList[r?"add":"remove"](t)}function _l(e,t,{bubbles:r=!1,cancelable:n=!1}={}){const a=document.createEvent("CustomEvent");return a.initCustomEvent(e,r,n,t),a}let Qi;function Wi(e){Qi=e}function Qa(){if(!Qi)throw new Error("Function called outside component initialization");return Qi}function El(e){Qa().$$.on_destroy.push(e)}function Il(){const e=Qa();return(t,r,{cancelable:n=!1}={})=>{const a=e.$$.callbacks[t];if(a){const s=_l(t,r,{cancelable:n});return a.slice().forEach(f=>{f.call(e,s)}),!s.defaultPrevented}return!0}}function ia(e,t){const r=e.$$.callbacks[t.type];r&&r.slice().forEach(n=>n.call(this,t))}const gi=[],ys=[];let di=[];const oa=[],Cl=Promise.resolve();let ms=!1;function Nl(){ms||(ms=!0,Cl.then(Ja))}function _s(e){di.push(e)}const hs=new Set;let hi=0;function Ja(){if(hi!==0)return;const e=Qi;do{try{for(;hi<gi.length;){const t=gi[hi];hi++,Wi(t),xl(t.$$)}}catch(t){throw gi.length=0,hi=0,t}for(Wi(null),gi.length=0,hi=0;ys.length;)ys.pop()();for(let t=0;t<di.length;t+=1){const r=di[t];hs.has(r)||(hs.add(r),r())}di.length=0}while(gi.length);for(;oa.length;)oa.pop()();ms=!1,hs.clear(),Wi(e)}function xl(e){if(e.fragment!==null){e.update(),Fr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_s)}}function Sl(e){const t=[],r=[];di.forEach(n=>e.indexOf(n)===-1?t.push(n):r.push(n)),r.forEach(n=>n()),di=t}const Po=new Set;let Yr;function Ro(){Yr={r:0,c:[],p:Yr}}function Oo(){Yr.r||Fr(Yr.c),Yr=Yr.p}function Dt(e,t){e&&e.i&&(Po.delete(e),e.i(t))}function ae(e,t,r,n){if(e&&e.o){if(Po.has(e))return;Po.add(e),Yr.c.push(()=>{Po.delete(e),n&&(r&&e.d(1),n())}),e.o(t)}else n&&n()}function Sr(e){e&&e.c()}function sr(e,t,r,n){const{fragment:a,after_update:s}=e.$$;a&&a.m(t,r),n||_s(()=>{const f=e.$$.on_mount.map(Wa).filter(ja);e.$$.on_destroy?e.$$.on_destroy.push(...f):Fr(f),e.$$.on_mount=[]}),s.forEach(_s)}function ar(e,t){const r=e.$$;r.fragment!==null&&(Sl(r.after_update),Fr(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function wl(e,t){e.$$.dirty[0]===-1&&(gi.push(e),Nl(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function kr(e,t,r,n,a,s,f,o=[-1]){const x=Qi;Wi(e);const C=e.$$={fragment:null,ctx:[],props:s,update:_t,not_equal:a,bound:ea(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(x?x.$$.context:[])),callbacks:ea(),dirty:o,skip_bound:!1,root:t.target||x.$$.root};f&&f(C.root);let P=!1;if(C.ctx=r?r(e,t.props||{},(Y,ze,...ge)=>{const Bt=ge.length?ge[0]:ze;return C.ctx&&a(C.ctx[Y],C.ctx[Y]=Bt)&&(!C.skip_bound&&C.bound[Y]&&C.bound[Y](Bt),P&&wl(e,Y)),ze}):[],C.update(),P=!0,Fr(C.before_update),C.fragment=n?n(C.ctx):!1,t.target){if(t.hydrate){const Y=ml(t.target);C.fragment&&C.fragment.l(Y),Y.forEach(Pe)}else C.fragment&&C.fragment.c();t.intro&&Dt(e.$$.fragment),sr(e,t.target,t.anchor,t.customElement),Ja()}Wi(x)}class Gr{$destroy(){ar(this,1),this.$destroy=_t}$on(t,r){if(!ja(r))return _t;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(r),()=>{const a=n.indexOf(r);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!fl(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Ll(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),D(t,"viewBox","0 0 14 14"),D(t,"width","13"),D(t,"height","13"),D(t,"class","svelte-en2qvf")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Za extends Gr{constructor(t){super(),kr(this,t,null,Ll,Br,{})}}function bl(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),D(t,"viewBox","0 0 30 30"),D(t,"fill","none"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"class","svelte-d2loi5")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class $a extends Gr{constructor(t){super(),kr(this,t,null,bl,Br,{})}}function sa(e){var t,r;let n,a=(((r=(t=e[0].properties)==null?void 0:t.place_type_name)==null?void 0:r[0])??e[0].place_type[0])+"",s;return{c(){n=Gt("span"),s=Wr(a),D(n,"class","line2 svelte-ewziy4")},m(f,o){Be(f,n,o),rt(n,s)},p(f,o){var x,C;o&1&&a!==(a=(((C=(x=f[0].properties)==null?void 0:x.place_type_name)==null?void 0:C[0])??f[0].place_type[0])+"")&&Ki(s,a)},d(f){f&&Pe(n)}}}function Pl(e){let t,r,n,a,s=e[0].place_name.replace(/,.*/,"")+"",f,o,x,C=e[0].place_name.replace(/[^,]*,?\s*/,"")+"",P,Y,ze,ge,Bt=e[2]&&sa(e);return{c(){t=Gt("li"),r=Gt("span"),n=Gt("span"),a=Gt("span"),f=Wr(s),o=In(),x=Gt("span"),P=Wr(C),Y=In(),Bt&&Bt.c(),D(a,"class","primary svelte-ewziy4"),D(x,"class","secondary svelte-ewziy4"),D(n,"class","svelte-ewziy4"),D(r,"class","texts svelte-ewziy4"),D(t,"tabindex","0"),D(t,"data-selected",e[1]),D(t,"class","svelte-ewziy4"),nn(t,"selected",e[1])},m(Ur,kn){Be(Ur,t,kn),rt(t,r),rt(r,n),rt(n,a),rt(a,f),rt(n,o),rt(n,x),rt(x,P),rt(r,Y),Bt&&Bt.m(r,null),ze||(ge=[Re(t,"mouseenter",e[3]),Re(t,"focus",e[4])],ze=!0)},p(Ur,[kn]){kn&1&&s!==(s=Ur[0].place_name.replace(/,.*/,"")+"")&&Ki(f,s),kn&1&&C!==(C=Ur[0].place_name.replace(/[^,]*,?\s*/,"")+"")&&Ki(P,C),Ur[2]?Bt?Bt.p(Ur,kn):(Bt=sa(Ur),Bt.c(),Bt.m(r,null)):Bt&&(Bt.d(1),Bt=null),kn&2&&D(t,"data-selected",Ur[1]),kn&2&&nn(t,"selected",Ur[1])},i:_t,o:_t,d(Ur){Ur&&Pe(t),Bt&&Bt.d(),ze=!1,Fr(ge)}}}function Rl(e,t,r){let{feature:n}=t,{selected:a=!1}=t,{showPlaceType:s=!1}=t;function f(x){ia.call(this,e,x)}function o(x){ia.call(this,e,x)}return e.$$set=x=>{"feature"in x&&r(0,n=x.feature),"selected"in x&&r(1,a=x.selected),"showPlaceType"in x&&r(2,s=x.showPlaceType)},[n,a,s,f,o]}class Ol extends Gr{constructor(t){super(),kr(this,t,Rl,Pl,Br,{feature:0,selected:1,showPlaceType:2})}}function Dl(e){let t;return{c(){t=Gt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',D(t,"class","svelte-7cmwmc")},m(r,n){Be(r,t,n)},p:_t,i:_t,o:_t,d(r){r&&Pe(t)}}}class Tl extends Gr{constructor(t){super(),kr(this,t,null,Dl,Br,{})}}function Ml(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),D(t,"viewBox","0 0 60.006 21.412"),D(t,"width","14"),D(t,"height","20"),D(t,"class","svelte-en2qvf")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Al extends Gr{constructor(t){super(),kr(this,t,null,Ml,Br,{})}}function Fl(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M13.101 14.261 8.74 9.899a4.797 4.797 0 0 1-1.425.748 5.165 5.165 0 0 1-1.603.248c-1.446 0-2.677-.5-3.693-1.503S.495 7.164.495 5.717c0-1.446.508-2.678 1.524-3.693C3.035 1.008 4.266.5 5.712.5c1.448 0 2.672.508 3.675 1.524 1.002 1.015 1.503 2.247 1.503 3.693 0 .558-.08 1.092-.239 1.603-.159.512-.411.98-.757 1.405l4.382 4.4a.74.74 0 0 1 .229.568.81.81 0 0 1-.249.568.787.787 0 0 1-.577.239.787.787 0 0 1-.578-.239ZM5.712 9.223c.97 0 1.796-.342 2.48-1.026a3.378 3.378 0 0 0 1.026-2.48c0-.982-.34-1.818-1.016-2.509-.677-.69-1.507-1.035-2.49-1.035a3.42 3.42 0 0 0-2.509 1.035 3.42 3.42 0 0 0-1.035 2.51c0 .982.345 1.812 1.035 2.488.691.678 1.527 1.017 2.51 1.017Z"),D(t,"width","14"),D(t,"height","14"),D(t,"viewBox","0 0 15 15"),D(t,"class","svelte-en2qvf")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Bl extends Gr{constructor(t){super(),kr(this,t,null,Fl,Br,{})}}function aa(e,t,r){const n=e.slice();return n[70]=t[r],n[72]=r,n}function ua(e){let t,r;return t=new Tl({}),{c(){Sr(t.$$.fragment)},m(n,a){sr(t,n,a),r=!0},i(n){r||(Dt(t.$$.fragment,n),r=!0)},o(n){ae(t.$$.fragment,n),r=!1},d(n){ar(t,n)}}}function la(e){let t,r,n,a,s;return r=new Al({}),{c(){t=Gt("button"),Sr(r.$$.fragment),D(t,"type","button"),D(t,"title",e[9]),D(t,"class","svelte-1r7dvt7"),nn(t,"active",e[0])},m(f,o){Be(f,t,o),sr(r,t,null),n=!0,a||(s=Re(t,"click",e[56]),a=!0)},p(f,o){(!n||o[0]&512)&&D(t,"title",f[9]),(!n||o[0]&1)&&nn(t,"active",f[0])},i(f){n||(Dt(r.$$.fragment,f),n=!0)},o(f){ae(r.$$.fragment,f),n=!1},d(f){f&&Pe(t),ar(r),a=!1,s()}}}function kl(e){let t,r,n,a,s=e[12],f=[];for(let x=0;x<s.length;x+=1)f[x]=ca(aa(e,s,x));const o=x=>ae(f[x],1,1,()=>{f[x]=null});return{c(){t=Gt("ul");for(let x=0;x<f.length;x+=1)f[x].c();D(t,"class","svelte-1r7dvt7")},m(x,C){Be(x,t,C);for(let P=0;P<f.length;P+=1)f[P]&&f[P].m(t,null);r=!0,n||(a=[Re(t,"mouseleave",e[60]),Re(t,"blur",e[61])],n=!0)},p(x,C){if(C[0]&2110464){s=x[12];let P;for(P=0;P<s.length;P+=1){const Y=aa(x,s,P);f[P]?(f[P].p(Y,C),Dt(f[P],1)):(f[P]=ca(Y),f[P].c(),Dt(f[P],1),f[P].m(t,null))}for(Ro(),P=s.length;P<f.length;P+=1)o(P);Oo()}},i(x){if(!r){for(let C=0;C<s.length;C+=1)Dt(f[C]);r=!0}},o(x){f=f.filter(Boolean);for(let C=0;C<f.length;C+=1)ae(f[C]);r=!1},d(x){x&&Pe(t),vl(f,x),n=!1,Fr(a)}}}function Gl(e){let t,r,n,a,s,f;return r=new $a({}),{c(){t=Gt("div"),Sr(r.$$.fragment),n=In(),a=Gt("div"),s=Wr(e[7]),D(a,"class","svelte-1r7dvt7"),D(t,"class","no-results svelte-1r7dvt7")},m(o,x){Be(o,t,x),sr(r,t,null),rt(t,n),rt(t,a),rt(a,s),f=!0},p(o,x){(!f||x[0]&128)&&Ki(s,o[7])},i(o){f||(Dt(r.$$.fragment,o),f=!0)},o(o){ae(r.$$.fragment,o),f=!1},d(o){o&&Pe(t),ar(r)}}}function zl(e){let t="",r;return{c(){r=Wr(t)},m(n,a){Be(n,r,a)},p:_t,i:_t,o:_t,d(n){n&&Pe(r)}}}function Vl(e){let t,r,n,a,s,f,o,x,C,P,Y;return r=new $a({}),x=new Za({}),{c(){t=Gt("div"),Sr(r.$$.fragment),n=In(),a=Gt("div"),s=Wr(e[6]),f=In(),o=Gt("button"),Sr(x.$$.fragment),D(a,"class","svelte-1r7dvt7"),D(o,"class","svelte-1r7dvt7"),D(t,"class","error svelte-1r7dvt7")},m(ze,ge){Be(ze,t,ge),sr(r,t,null),rt(t,n),rt(t,a),rt(a,s),rt(t,f),rt(t,o),sr(x,o,null),C=!0,P||(Y=Re(o,"click",e[57]),P=!0)},p(ze,ge){(!C||ge[0]&64)&&Ki(s,ze[6])},i(ze){C||(Dt(r.$$.fragment,ze),Dt(x.$$.fragment,ze),C=!0)},o(ze){ae(r.$$.fragment,ze),ae(x.$$.fragment,ze),C=!1},d(ze){ze&&Pe(t),ar(r),ar(x),P=!1,Y()}}}function ca(e){let t,r;function n(){return e[58](e[72])}function a(){return e[59](e[70])}return t=new Ol({props:{feature:e[70],showPlaceType:e[10],selected:e[13]===e[72]}}),t.$on("mouseenter",n),t.$on("focus",a),{c(){Sr(t.$$.fragment)},m(s,f){sr(t,s,f),r=!0},p(s,f){e=s;const o={};f[0]&4096&&(o.feature=e[70]),f[0]&1024&&(o.showPlaceType=e[10]),f[0]&8192&&(o.selected=e[13]===e[72]),t.$set(o)},i(s){r||(Dt(t.$$.fragment,s),r=!0)},o(s){ae(t.$$.fragment,s),r=!1},d(s){ar(t,s)}}}function Ul(e){let t,r,n,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn,Io,rl,Co,as;a=new Bl({}),P=new Za({});let $s=e[17]&&ua(),ah=e[5]===!0&&la(e);const ch=e[48].default,Zu=hl(ch,e,e[47],null),ih=[Vl,zl,Gl,kl],al=[];function sh(_h,Ih){var Lh,Gh;return _h[16]?0:_h[14]?((Lh=_h[12])==null?void 0:Lh.length)===0?2:_h[14]&&(Gh=_h[12])!=null&&Gh.length?3:-1:1}return~(Ur=sh(e))&&(kn=al[Ur]=ih[Ur](e)),{c(){t=Gt("form"),r=Gt("div"),n=Gt("button"),Sr(a.$$.fragment),s=In(),f=Gt("input"),o=In(),x=Gt("div"),C=Gt("button"),Sr(P.$$.fragment),Y=In(),$s&&$s.c(),ze=In(),ah&&ah.c(),ge=In(),Zu&&Zu.c(),Bt=In(),kn&&kn.c(),D(n,"class","search-button svelte-1r7dvt7"),D(n,"type","button"),D(f,"placeholder",e[8]),D(f,"aria-label",e[8]),D(f,"class","svelte-1r7dvt7"),D(C,"type","button"),D(C,"title",e[3]),D(C,"class","svelte-1r7dvt7"),D(x,"class","clear-button-container svelte-1r7dvt7"),nn(x,"displayable",e[1]!==""),D(r,"class","input-group svelte-1r7dvt7"),D(t,"tabindex","0"),D(t,"class",Io=na(e[2])+" svelte-1r7dvt7"),nn(t,"can-collapse",e[4]&&e[1]==="")},m(_h,Ih){Be(_h,t,Ih),rt(t,r),rt(r,n),sr(a,n,null),rt(r,s),rt(r,f),e[50](f),ra(f,e[1]),rt(r,o),rt(r,x),rt(x,C),sr(P,C,null),rt(x,Y),$s&&$s.m(x,null),rt(r,ze),ah&&ah.m(r,null),rt(r,ge),Zu&&Zu.m(r,null),rt(t,Bt),~Ur&&al[Ur].m(t,null),rl=!0,Co||(as=[Re(n,"click",e[49]),Re(f,"input",e[51]),Re(f,"focus",e[52]),Re(f,"blur",e[53]),Re(f,"keydown",e[19]),Re(f,"input",e[54]),Re(C,"click",e[55]),Re(t,"submit",yl(e[18]))],Co=!0)},p(_h,Ih){(!rl||Ih[0]&256)&&D(f,"placeholder",_h[8]),(!rl||Ih[0]&256)&&D(f,"aria-label",_h[8]),Ih[0]&2&&f.value!==_h[1]&&ra(f,_h[1]),(!rl||Ih[0]&8)&&D(C,"title",_h[3]),_h[17]?$s?Ih[0]&131072&&Dt($s,1):($s=ua(),$s.c(),Dt($s,1),$s.m(x,null)):$s&&(Ro(),ae($s,1,1,()=>{$s=null}),Oo()),(!rl||Ih[0]&2)&&nn(x,"displayable",_h[1]!==""),_h[5]===!0?ah?(ah.p(_h,Ih),Ih[0]&32&&Dt(ah,1)):(ah=la(_h),ah.c(),Dt(ah,1),ah.m(r,ge)):ah&&(Ro(),ae(ah,1,1,()=>{ah=null}),Oo()),Zu&&Zu.p&&(!rl||Ih[1]&65536)&&pl(Zu,ch,_h,_h[47],rl?gl(ch,_h[47],Ih,null):dl(_h[47]),null);let Lh=Ur;Ur=sh(_h),Ur===Lh?~Ur&&al[Ur].p(_h,Ih):(kn&&(Ro(),ae(al[Lh],1,1,()=>{al[Lh]=null}),Oo()),~Ur?(kn=al[Ur],kn?kn.p(_h,Ih):(kn=al[Ur]=ih[Ur](_h),kn.c()),Dt(kn,1),kn.m(t,null)):kn=null),(!rl||Ih[0]&4&&Io!==(Io=na(_h[2])+" svelte-1r7dvt7"))&&D(t,"class",Io),(!rl||Ih[0]&22)&&nn(t,"can-collapse",_h[4]&&_h[1]==="")},i(_h){rl||(Dt(a.$$.fragment,_h),Dt(P.$$.fragment,_h),Dt($s),Dt(ah),Dt(Zu,_h),Dt(kn),rl=!0)},o(_h){ae(a.$$.fragment,_h),ae(P.$$.fragment,_h),ae($s),ae(ah),ae(Zu,_h),ae(kn),rl=!1},d(_h){_h&&Pe(t),ar(a),e[50](null),ar(P),$s&&$s.d(),ah&&ah.d(),Zu&&Zu.d(_h),~Ur&&al[Ur].d(),Co=!1,Fr(as)}}}function ql(e,t,r){const n=t[1],a=t[0],s=n-a;return e===n&&r?e:((e-a)%s+s)%s+a}function fa(e){let t=[...e];return t[2]<t[0]&&(t[2]+=360),t}function Xl(e,t,r){let n,{$$slots:a={},$$scope:s}=t,{class:f=void 0}=t,{apiKey:o}=t,{bbox:x=void 0}=t,{clearButtonTitle:C="clear"}=t,{clearOnBlur:P=!1}=t,{collapsed:Y=!1}=t,{country:ze=void 0}=t,{debounceSearch:ge=200}=t,{enableReverse:Bt=!1}=t,{errorMessage:Ur="Something went wrong…"}=t,{filter:kn=()=>!0}=t,{flyTo:Io=!0}=t,{fuzzyMatch:rl=!0}=t,{language:Co=void 0}=t,{limit:as=void 0}=t,{mapController:$s=void 0}=t,{minLength:ah=2}=t,{noResultsMessage:ch="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:Zu="Search"}=t,{proximity:ih=void 0}=t,{reverseActive:al=Bt==="always"}=t,{reverseButtonTitle:sh="toggle reverse geocoding"}=t,{searchValue:_h=""}=t,{showFullGeometry:Ih=!0}=t,{showPlaceType:Lh=!1}=t,{showResultsWhileTyping:Gh=!0}=t,{trackProximity:ud=!0}=t,{types:Tf=void 0}=t,{zoom:Kd=16}=t,{fetchParameters:Af={}}=t;function md(){bf.focus()}function vd(){bf.blur()}function qd(Xd,Op=!0){r(1,_h=Xd),Op?(r(13,Id=-1),op()):(Zd(),setTimeout(()=>{bf.focus(),bf.select()}))}let Ed=!1,Sd,zd,Md,Gd="",bf,Id=-1,td,Fd=[],rp,jf,yd;const Jd=Il();El(()=>{$s&&($s.setEventHandler(void 0),$s.indicateReverse(!1),$s.setSelectedMarker(-1),$s.setMarkers(void 0,void 0))});function op(Xd){if(jf&&(clearTimeout(jf),jf=void 0),Id>-1&&Sd)r(45,Md=Sd[Id]),r(1,_h=Md.place_name.replace(/,.*/,"")),r(16,td=void 0),r(44,zd=void 0),r(13,Id=-1);else if(_h){const Op=Xd||!bp();fp(_h,{exact:!0}).then(()=>{r(44,zd=Sd),r(45,Md=void 0),Op&&Qh()}).catch(rm=>r(16,td=rm))}}function bp(){return/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(_h)}async function fp(Xd,{byId:Op=!1,exact:rm=!1}={}){r(16,td=void 0);const Sm=bp(),hp=new URLSearchParams;Co!=null&&hp.set("language",Array.isArray(Co)?Co.join(","):Co),Tf&&hp.set("types",Tf.join(",")),Sm||(x&&hp.set("bbox",x.map(Hf=>Hf.toFixed(6)).join(",")),ze&&hp.set("country",Array.isArray(ze)?ze.join(","):ze)),Op||(ih&&hp.set("proximity",ih.map(Hf=>Hf.toFixed(6)).join(",")),(rm||!Gh)&&hp.set("autocomplete","false"),hp.set("fuzzyMatch",String(rl))),as!==void 0&&hp.set("limit",String(as)),hp.set("key",o);const Em="https://api.maptiler.com/geocoding/"+encodeURIComponent(Xd)+".json?"+hp.toString();if(Em===Gd){Op?(r(12,Sd=void 0),r(45,Md=Fd[0])):r(12,Sd=Fd);return}Gd=Em,rp?.abort();const Qp=new AbortController;r(17,rp=Qp);let lm;try{lm=await fetch(Em,{signal:Qp.signal,...Af}).finally(()=>{Qp===rp&&r(17,rp=void 0)})}catch(Hf){if(Hf&&typeof Hf=="object"&&"name"in Hf&&Hf.name==="AbortError")return;throw new Error}if(!lm.ok)throw new Error;const Dd=await lm.json();Jd("response",{url:Em,featureCollection:Dd}),Op?(r(12,Sd=void 0),r(45,Md=Dd.features[0]),Fd=[Md]):(r(12,Sd=Dd.features.filter(kn)),Fd=Sd,Sm&&bf.focus())}function Qh(){var Xd,Op,rm,Sm;if(!(zd!=null&&zd.length)||!Io)return;const hp=[180,90,-180,-90],Em=!zd.some(Qp=>!Qp.matching_text);for(const Qp of zd)(Em||!Qp.matching_text)&&(hp[0]=Math.min(hp[0],((Xd=Qp.bbox)==null?void 0:Xd[0])??Qp.center[0]),hp[1]=Math.min(hp[1],((Op=Qp.bbox)==null?void 0:Op[1])??Qp.center[1]),hp[2]=Math.max(hp[2],((rm=Qp.bbox)==null?void 0:rm[2])??Qp.center[0]),hp[3]=Math.max(hp[3],((Sm=Qp.bbox)==null?void 0:Sm[3])??Qp.center[1]));$s&&zd.length>0&&(Md&&hp[0]===hp[2]&&hp[1]===hp[3]?$s.flyTo(Md.center,Kd):$s.fitBounds(fa(hp),50))}function Yd(Xd){r(0,al=Bt==="always"),qd(ql(Xd[0],[-180,180],!0).toFixed(6)+","+Xd[1].toFixed(6))}function sd(Xd){if(!Sd)return;let Op=Xd.key==="ArrowDown"?1:Xd.key==="ArrowUp"?-1:0;Op?(Id===-1&&Op===-1&&r(13,Id=Sd.length),r(13,Id+=Op),Id>=Sd.length&&r(13,Id=-1),Xd.preventDefault()):["ArrowLeft","ArrowRight","Home","End"].includes(Xd.key)&&r(13,Id=-1)}function Zd(Xd=!0){if(r(16,td=void 0),Gh){if(jf&&clearTimeout(jf),_h.length<=ah)return;const Op=_h;jf=window.setTimeout(()=>{fp(Op).catch(rm=>r(16,td=rm))},Xd?ge:0)}else r(12,Sd=void 0),r(16,td=void 0)}function Xh(Xd){r(45,Md=Xd),r(1,_h=Xd.place_name),r(13,Id=-1)}const Ld=()=>bf.focus();function Kf(Xd){ys[Xd?"unshift":"push"](()=>{bf=Xd,r(15,bf)})}function If(){_h=this.value,r(1,_h),r(11,Ed),r(25,P)}const Df=()=>r(11,Ed=!0),Jf=()=>r(11,Ed=!1),Nf=()=>Zd(),Wf=()=>{r(1,_h=""),bf.focus()},Mp=()=>r(0,al=!al),Sp=()=>r(16,td=void 0),Pp=Xd=>r(13,Id=Xd),Yf=Xd=>Xh(Xd),qp=()=>r(13,Id=-1),sm=()=>{};return e.$$set=Xd=>{"class"in Xd&&r(2,f=Xd.class),"apiKey"in Xd&&r(23,o=Xd.apiKey),"bbox"in Xd&&r(24,x=Xd.bbox),"clearButtonTitle"in Xd&&r(3,C=Xd.clearButtonTitle),"clearOnBlur"in Xd&&r(25,P=Xd.clearOnBlur),"collapsed"in Xd&&r(4,Y=Xd.collapsed),"country"in Xd&&r(26,ze=Xd.country),"debounceSearch"in Xd&&r(27,ge=Xd.debounceSearch),"enableReverse"in Xd&&r(5,Bt=Xd.enableReverse),"errorMessage"in Xd&&r(6,Ur=Xd.errorMessage),"filter"in Xd&&r(28,kn=Xd.filter),"flyTo"in Xd&&r(29,Io=Xd.flyTo),"fuzzyMatch"in Xd&&r(30,rl=Xd.fuzzyMatch),"language"in Xd&&r(31,Co=Xd.language),"limit"in Xd&&r(32,as=Xd.limit),"mapController"in Xd&&r(33,$s=Xd.mapController),"minLength"in Xd&&r(34,ah=Xd.minLength),"noResultsMessage"in Xd&&r(7,ch=Xd.noResultsMessage),"placeholder"in Xd&&r(8,Zu=Xd.placeholder),"proximity"in Xd&&r(22,ih=Xd.proximity),"reverseActive"in Xd&&r(0,al=Xd.reverseActive),"reverseButtonTitle"in Xd&&r(9,sh=Xd.reverseButtonTitle),"searchValue"in Xd&&r(1,_h=Xd.searchValue),"showFullGeometry"in Xd&&r(35,Ih=Xd.showFullGeometry),"showPlaceType"in Xd&&r(10,Lh=Xd.showPlaceType),"showResultsWhileTyping"in Xd&&r(36,Gh=Xd.showResultsWhileTyping),"trackProximity"in Xd&&r(37,ud=Xd.trackProximity),"types"in Xd&&r(38,Tf=Xd.types),"zoom"in Xd&&r(39,Kd=Xd.zoom),"fetchParameters"in Xd&&r(40,Af=Xd.fetchParameters),"$$scope"in Xd&&r(47,s=Xd.$$scope)},e.$$.update=()=>{if(e.$$.dirty[1]&64&&(ud||r(22,ih=void 0)),e.$$.dirty[0]&33556480&&setTimeout(()=>{r(14,yd=Ed),P&&!Ed&&r(1,_h="")}),e.$$.dirty[0]&4098&&(_h||(r(45,Md=void 0),r(12,Sd=void 0),r(16,td=void 0),r(44,zd=Sd))),e.$$.dirty[1]&16400&&Ih&&Md&&!Md.address&&Md.geometry.type==="Point"&&fp(Md.id,{byId:!0}).catch(Xd=>r(16,td=Xd)),e.$$.dirty[0]&536870912|e.$$.dirty[1]&16644&&$s&&Md&&Io&&(!Md.bbox||Md.bbox[0]===Md.bbox[2]&&Md.bbox[1]===Md.bbox[3]?$s.flyTo(Md.center,Kd):$s.fitBounds(fa(Md.bbox),50),r(12,Sd=void 0),r(44,zd=void 0),r(13,Id=-1)),e.$$.dirty[0]&4096|e.$$.dirty[1]&8192&&zd!==Sd&&r(44,zd=void 0),e.$$.dirty[1]&24580&&$s&&$s.setMarkers(zd,Md),e.$$.dirty[0]&2&&r(13,Id=-1),e.$$.dirty[0]&20481|e.$$.dirty[1]&68&&$s&&$s.setEventHandler(Xd=>{switch(Xd.type){case"mapClick":al&&Yd(Xd.coordinates);break;case"proximityChange":r(22,ih=ud?Xd.proximity:void 0);break;case"markerClick":{const Op=Sd?.find(rm=>rm.id===Xd.id);Op&&Xh(Op)}break;case"markerMouseEnter":r(13,Id=yd?Sd?.findIndex(Op=>Op.id===Xd.id)??-1:-1);break;case"markerMouseLeave":r(13,Id=-1);break}}),e.$$.dirty[0]&8192|e.$$.dirty[1]&4&&$s?.setSelectedMarker(Id),e.$$.dirty[0]&12288&&r(46,n=Sd?.[Id]),e.$$.dirty[0]&2|e.$$.dirty[1]&4){const Xd=/^(-?\d+(?:\.\d*)?),(-?\d+(?:\.\d*)?)$/.exec(_h);$s?.setReverseMarker(Xd?[Number(Xd[1]),Number(Xd[2])]:void 0)}e.$$.dirty[1]&32768&&Jd("select",n),e.$$.dirty[1]&16384&&Jd("pick",Md),e.$$.dirty[0]&20480&&Jd("optionsVisibilityChange",yd&&!!Sd),e.$$.dirty[0]&4096&&Jd("featuresListed",Sd),e.$$.dirty[1]&8192&&Jd("featuresMarked",zd),e.$$.dirty[0]&1&&Jd("reverseToggle",al),e.$$.dirty[0]&2&&Jd("queryChange",_h),e.$$.dirty[0]&1|e.$$.dirty[1]&4&&$s&&$s.indicateReverse(al)},[al,_h,f,C,Y,Bt,Ur,ch,Zu,sh,Lh,Ed,Sd,Id,yd,bf,td,rp,op,sd,Zd,Xh,ih,o,x,P,ze,ge,kn,Io,rl,Co,as,$s,ah,Ih,Gh,ud,Tf,Kd,Af,md,vd,qd,zd,Md,n,s,a,Ld,Kf,If,Df,Jf,Nf,Wf,Mp,Sp,Pp,Yf,qp,sm]}let Yl=class extends Gr{constructor(e){super(),kr(this,e,Xl,Ul,Br,{class:2,apiKey:23,bbox:24,clearButtonTitle:3,clearOnBlur:25,collapsed:4,country:26,debounceSearch:27,enableReverse:5,errorMessage:6,filter:28,flyTo:29,fuzzyMatch:30,language:31,limit:32,mapController:33,minLength:34,noResultsMessage:7,placeholder:8,proximity:22,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:35,showPlaceType:10,showResultsWhileTyping:36,trackProximity:37,types:38,zoom:39,fetchParameters:40,focus:41,blur:42,setQuery:43},null,[-1,-1,-1])}get focus(){return this.$$.ctx[41]}get blur(){return this.$$.ctx[42]}get setQuery(){return this.$$.ctx[43]}};/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Hl(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function o(C){return function(P){return x([C,P])}}function x(C){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=C[0]&2?a.return:C[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,C[1])).done)return s;switch(a=0,s&&(C=[C[0]&2,s.value]),C[0]){case 0:case 1:s=C;break;case 4:return r.label++,{value:C[1],done:!1};case 5:r.label++,a=C[1],C=[0];continue;case 7:C=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(C[0]===6||C[0]===2)){r=0;continue}if(C[0]===3&&(!s||C[1]>s[0]&&C[1]<s[3])){r.label=C[1];break}if(C[0]===6&&r.label<s[1]){r.label=s[1],s=C;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(C);break}s[2]&&r.ops.pop(),r.trys.pop();continue}C=t.call(e,r)}catch(P){C=[6,P],a=0}finally{n=s=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var wr=function(){function e(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return e}();function Wl(e,t){return e>t?1:e<t?-1:0}function Ir(e,t,r){for(var n=new wr(null,null),a=n,s=n;;){var f=r(e,t.key);if(f<0){if(t.left===null)break;if(r(e,t.left.key)<0){var o=t.left;if(t.left=o.right,o.right=t,t=o,t.left===null)break}s.left=t,s=t,t=t.left}else if(f>0){if(t.right===null)break;if(r(e,t.right.key)>0){var o=t.right;if(t.right=o.left,o.left=t,t=o,t.right===null)break}a.right=t,a=t,t=t.right}else break}return a.right=t.left,s.left=t.right,t.left=n.right,t.right=n.left,t}function gs(e,t,r,n){var a=new wr(e,t);if(r===null)return a.left=a.right=null,a;r=Ir(e,r,n);var s=n(e,r.key);return s<0?(a.left=r.left,a.right=r,r.left=null):s>=0&&(a.right=r.right,a.left=r,r.right=null),a}function ha(e,t,r){var n=null,a=null;if(t){t=Ir(e,t,r);var s=r(t.key,e);s===0?(n=t.left,a=t.right):s<0?(a=t.right,t.right=null,n=t):(n=t.left,t.left=null,a=t)}return{left:n,right:a}}function jl(e,t,r){return t===null?e:(e===null||(t=Ir(e.key,t,r),t.left=e),t)}function Es(e,t,r,n,a){if(e){n(""+t+(r?"└── ":"├── ")+a(e)+`
`);var s=t+(r?"    ":"│   ");e.left&&Es(e.left,s,!1,n,a),e.right&&Es(e.right,s,!0,n,a)}}var Ms=function(){function e(t){t===void 0&&(t=Wl),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,r){return this._size++,this._root=gs(t,r,this._root,this._comparator)},e.prototype.add=function(t,r){var n=new wr(t,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var a=this._comparator,s=Ir(t,this._root,a),f=a(t,s.key);return f===0?this._root=s:(f<0?(n.left=s.left,n.right=s,s.left=null):f>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,r,n){var a;if(r===null)return null;r=Ir(t,r,n);var s=n(t,r.key);return s===0?(r.left===null?a=r.right:(a=Ir(t,r.left,n),a.right=r.right),this._size--,a):r},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Ir(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var r=this._root,n=this._comparator;r;){var a=n(t,r.key);if(a===0)return r;a<0?r=r.left:r=r.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Ir(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var r=this._root,n=this._comparator;r;){var a=n(t,r.key);if(a===0)return!0;a<0?r=r.left:r=r.right}return!1},e.prototype.forEach=function(t,r){for(var n=this._root,a=[],s=!1;!s;)n!==null?(a.push(n),n=n.left):a.length!==0?(n=a.pop(),t.call(r,n),n=n.right):s=!0;return this},e.prototype.range=function(t,r,n,a){for(var s=[],f=this._comparator,o=this._root,x;s.length!==0||o;)if(o)s.push(o),o=o.left;else{if(o=s.pop(),x=f(o.key,r),x>0)break;if(f(o.key,t)>=0&&n.call(a,o))return this;o=o.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(r){var n=r.key;return t.push(n)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(r){var n=r.data;return t.push(n)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var r=this._root,n=!1,a=0,s=[];!n;)if(r)s.push(r),r=r.left;else if(s.length>0){if(r=s.pop(),a===t)return r;a++,r=r.right}else n=!0;return null},e.prototype.next=function(t){var r=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var a=this._comparator;r;){var s=a(t.key,r.key);if(s===0)break;s<0?(n=r,r=r.left):r=r.right}return n},e.prototype.prev=function(t){var r=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var a=this._comparator;r;){var s=a(t.key,r.key);if(s===0)break;s<0?r=r.left:(n=r,r=r.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return Ql(this._root)},e.prototype.load=function(t,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var a=t.length,s=this._comparator;if(n&&Ns(t,r,0,a-1,s),this._root===null)this._root=Is(t,r,0,a),this._size=a;else{var f=Jl(this.toList(),Kl(t,r),s);a=this._size+a,this._root=Cs({head:f},0,a)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var r=[];return Es(this._root,"",!0,function(n){return r.push(n)},t),r.join("")},e.prototype.update=function(t,r,n){var a=this._comparator,s=ha(t,this._root,a),f=s.left,o=s.right;a(t,r)<0?o=gs(r,n,o,a):f=gs(r,n,f,a),this._root=jl(f,o,a)},e.prototype.split=function(t){return ha(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t;return Hl(this,function(r){switch(r.label){case 0:t=this.minNode(),r.label=1;case 1:return t?[4,t]:[3,3];case 2:return r.sent(),t=this.next(t),[3,1];case 3:return[2]}})},e}();function Is(e,t,r,n){var a=n-r;if(a>0){var s=r+Math.floor(a/2),f=e[s],o=t[s],x=new wr(f,o);return x.left=Is(e,t,r,s),x.right=Is(e,t,s+1,n),x}return null}function Kl(e,t){for(var r=new wr(null,null),n=r,a=0;a<e.length;a++)n=n.next=new wr(e[a],t[a]);return n.next=null,r.next}function Ql(e){for(var t=e,r=[],n=!1,a=new wr(null,null),s=a;!n;)t?(r.push(t),t=t.left):r.length>0?(t=s=s.next=r.pop(),t=t.right):n=!0;return s.next=null,a.next}function Cs(e,t,r){var n=r-t;if(n>0){var a=t+Math.floor(n/2),s=Cs(e,t,a),f=e.head;return f.left=s,e.head=e.head.next,f.right=Cs(e,a+1,r),f}return null}function Jl(e,t,r){for(var n=new wr(null,null),a=n,s=e,f=t;s!==null&&f!==null;)r(s.key,f.key)<0?(a.next=s,s=s.next):(a.next=f,f=f.next),a=a.next;return s!==null?a.next=s:f!==null&&(a.next=f),n.next}function Ns(e,t,r,n,a){if(!(r>=n)){for(var s=e[r+n>>1],f=r-1,o=n+1;;){do f++;while(a(e[f],s)<0);do o--;while(a(e[o],s)>0);if(f>=o)break;var x=e[f];e[f]=e[o],e[o]=x,x=t[f],t[f]=t[o],t[o]=x}Ns(e,t,r,o,a),Ns(e,t,o+1,n,a)}}function vn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ga(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ne(e,t,r){return t&&ga(e.prototype,t),r&&ga(e,r),e}var qi=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},xs=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x,a=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:a},ur:{x:n,y:s}}},Cr=Number.EPSILON;Cr===void 0&&(Cr=Math.pow(2,-52));var Zl=Cr*Cr,Ss=function(e,t){if(-Cr<e&&e<Cr&&-Cr<t&&t<Cr)return 0;var r=e-t;return r*r<Zl*e*t?0:e<t?-1:1},$l=function(){function e(){vn(this,e),this.reset()}return Ne(e,[{key:"reset",value:function(){this.xRounder=new pa,this.yRounder=new pa}},{key:"round",value:function(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}]),e}(),pa=function(){function e(){vn(this,e),this.tree=new Ms,this.round(0)}return Ne(e,[{key:"round",value:function(t){var r=this.tree.add(t),n=this.tree.prev(r);if(n!==null&&Ss(r.key,n.key)===0)return this.tree.remove(t),n.key;var a=this.tree.next(r);return a!==null&&Ss(r.key,a.key)===0?(this.tree.remove(t),a.key):t}}]),e}(),Ji=new $l,ji=function(e,t){return e.x*t.y-e.y*t.x},tu=function(e,t){return e.x*t.x+e.y*t.y},da=function(e,t,r){var n={x:t.x-e.x,y:t.y-e.y},a={x:r.x-e.x,y:r.y-e.y},s=ji(n,a);return Ss(s,0)},Mo=function(e){return Math.sqrt(tu(e,e))},tc=function(e,t,r){var n={x:t.x-e.x,y:t.y-e.y},a={x:r.x-e.x,y:r.y-e.y};return ji(a,n)/Mo(a)/Mo(n)},ec=function(e,t,r){var n={x:t.x-e.x,y:t.y-e.y},a={x:r.x-e.x,y:r.y-e.y};return tu(a,n)/Mo(a)/Mo(n)},va=function(e,t,r){return t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r}},ya=function(e,t,r){return t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)}},nc=function(e,t,r,n){if(t.x===0)return ya(r,n,e.x);if(n.x===0)return ya(e,t,r.x);if(t.y===0)return va(r,n,e.y);if(n.y===0)return va(e,t,r.y);var a=ji(t,n);if(a==0)return null;var s={x:r.x-e.x,y:r.y-e.y},f=ji(s,t)/a,o=ji(s,n)/a,x=e.x+o*t.x,C=r.x+f*n.x,P=e.y+o*t.y,Y=r.y+f*n.y,ze=(x+C)/2,ge=(P+Y)/2;return{x:ze,y:ge}},Xn=function(){Ne(e,null,[{key:"compare",value:function(t,r){var n=e.comparePoints(t.point,r.point);return n!==0?n:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Ao.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}}]);function e(t,r){vn(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}return Ne(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var r=t.point.events,n=0,a=r.length;n<a;n++){var s=r[n];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,r=0;r<t;r++){var n=this.point.events[r];if(n.segment.consumedBy===void 0)for(var a=r+1;a<t;a++){var s=this.point.events[a];s.consumedBy===void 0&&n.otherSE.point.events===s.otherSE.point.events&&n.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],r=0,n=this.point.events.length;r<n;r++){var a=this.point.events[r];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}},{key:"getLeftmostComparator",value:function(t){var r=this,n=new Map,a=function(s){var f=s.otherSE;n.set(s,{sine:tc(r.point,t.point,f.point),cosine:ec(r.point,t.point,f.point)})};return function(s,f){n.has(s)||a(s),n.has(f)||a(f);var o=n.get(s),x=o.sine,C=o.cosine,P=n.get(f),Y=P.sine,ze=P.cosine;return x>=0&&Y>=0?C<ze?1:C>ze?-1:0:x<0&&Y<0?C<ze?-1:C>ze?1:0:Y<x?-1:Y>x?1:0}}}]),e}(),rc=0,Ao=function(){Ne(e,null,[{key:"compare",value:function(t,r){var n=t.leftSE.point.x,a=r.leftSE.point.x,s=t.rightSE.point.x,f=r.rightSE.point.x;if(f<n)return 1;if(s<a)return-1;var o=t.leftSE.point.y,x=r.leftSE.point.y,C=t.rightSE.point.y,P=r.rightSE.point.y;if(n<a){if(x<o&&x<C)return 1;if(x>o&&x>C)return-1;var Y=t.comparePoint(r.leftSE.point);if(Y<0)return 1;if(Y>0)return-1;var ze=r.comparePoint(t.rightSE.point);return ze!==0?ze:-1}if(n>a){if(o<x&&o<P)return-1;if(o>x&&o>P)return 1;var ge=r.comparePoint(t.leftSE.point);if(ge!==0)return ge;var Bt=t.comparePoint(r.rightSE.point);return Bt<0?1:Bt>0?-1:1}if(o<x)return-1;if(o>x)return 1;if(s<f){var Ur=r.comparePoint(t.rightSE.point);if(Ur!==0)return Ur}if(s>f){var kn=t.comparePoint(r.rightSE.point);if(kn<0)return 1;if(kn>0)return-1}if(s!==f){var Io=C-o,rl=s-n,Co=P-x,as=f-a;if(Io>rl&&Co<as)return 1;if(Io<rl&&Co>as)return-1}return s>f?1:s<f||C<P?-1:C>P?1:t.id<r.id?-1:t.id>r.id?1:0}}]);function e(t,r,n,a){vn(this,e),this.id=++rc,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=n,this.windings=a}return Ne(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var r=this.leftSE.point,n=this.rightSE.point,a=this.vector();if(r.x===n.x)return t.x===r.x?0:t.x<r.x?1:-1;var s=(t.y-r.y)/a.y,f=r.x+s*a.x;if(t.x===f)return 0;var o=(t.x-r.x)/a.x,x=r.y+o*a.y;return t.y===x?0:t.y<x?-1:1}},{key:"getIntersection",value:function(t){var r=this.bbox(),n=t.bbox(),a=xs(r,n);if(a===null)return null;var s=this.leftSE.point,f=this.rightSE.point,o=t.leftSE.point,x=t.rightSE.point,C=qi(r,o)&&this.comparePoint(o)===0,P=qi(n,s)&&t.comparePoint(s)===0,Y=qi(r,x)&&this.comparePoint(x)===0,ze=qi(n,f)&&t.comparePoint(f)===0;if(P&&C)return ze&&!Y?f:!ze&&Y?x:null;if(P)return Y&&s.x===x.x&&s.y===x.y?null:s;if(C)return ze&&f.x===o.x&&f.y===o.y?null:o;if(ze&&Y)return null;if(ze)return f;if(Y)return x;var ge=nc(s,this.vector(),o,t.vector());return ge===null||!qi(a,ge)?null:Ji.round(ge.x,ge.y)}},{key:"split",value:function(t){var r=[],n=t.events!==void 0,a=new Xn(t,!0),s=new Xn(t,!1),f=this.rightSE;this.replaceRightSE(s),r.push(s),r.push(a);var o=new e(a,f,this.rings.slice(),this.windings.slice());return Xn.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Xn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(a.checkForConsuming(),s.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}},{key:"consume",value:function(t){for(var r=this,n=t;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var a=e.compare(r,n);if(a!==0){if(a>0){var s=r;r=n,n=s}if(r.prev===n){var f=r;r=n,n=f}for(var o=0,x=n.rings.length;o<x;o++){var C=n.rings[o],P=n.windings[o],Y=r.rings.indexOf(C);Y===-1?(r.rings.push(C),r.windings.push(P)):r.windings[Y]+=P}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,n=this._afterState.windings,a=this._afterState.multiPolys,s=0,f=this.rings.length;s<f;s++){var o=this.rings[s],x=this.windings[s],C=r.indexOf(o);C===-1?(r.push(o),n.push(x)):n[C]+=x}for(var P=[],Y=[],ze=0,ge=r.length;ze<ge;ze++)if(n[ze]!==0){var Bt=r[ze],Ur=Bt.poly;if(Y.indexOf(Ur)===-1)if(Bt.isExterior)P.push(Ur);else{Y.indexOf(Ur)===-1&&Y.push(Ur);var kn=P.indexOf(Bt.poly);kn!==-1&&P.splice(kn,1)}}for(var Io=0,rl=P.length;Io<rl;Io++){var Co=P[Io].multiPoly;a.indexOf(Co)===-1&&a.push(Co)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Nn.type){case"union":{var n=t.length===0,a=r.length===0;this._isInResult=n!==a;break}case"intersection":{var s,f;t.length<r.length?(s=t.length,f=r.length):(s=r.length,f=t.length),this._isInResult=f===Nn.numMultiPolys&&s<f;break}case"xor":{var o=Math.abs(t.length-r.length);this._isInResult=o%2===1;break}case"difference":{var x=function(C){return C.length===1&&C[0].isSubject};this._isInResult=x(t)!==x(r);break}default:throw new Error("Unrecognized operation type found ".concat(Nn.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,n){var a,s,f,o=Xn.comparePoints(t,r);if(o<0)a=t,s=r,f=1;else if(o>0)a=r,s=t,f=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var x=new Xn(a,!0),C=new Xn(s,!1);return new e(x,C,[n],[f])}}]),e}(),ma=function(){function e(t,r,n){if(vn(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=Ji.round(t[0][0],t[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};for(var s=a,f=1,o=t.length;f<o;f++){if(typeof t[f][0]!="number"||typeof t[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var x=Ji.round(t[f][0],t[f][1]);x.x===s.x&&x.y===s.y||(this.segments.push(Ao.fromRing(s,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),s=x)}(a.x!==s.x||a.y!==s.y)&&this.segments.push(Ao.fromRing(s,a,this))}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,n=this.segments.length;r<n;r++){var a=this.segments[r];t.push(a.leftSE),t.push(a.rightSE)}return t}}]),e}(),ic=function(){function e(t,r){if(vn(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ma(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,a=t.length;n<a;n++){var s=new ma(t[n],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=r}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),r=0,n=this.interiorRings.length;r<n;r++)for(var a=this.interiorRings[r].getSweepEvents(),s=0,f=a.length;s<f;s++)t.push(a[s]);return t}}]),e}(),_a=function(){function e(t,r){if(vn(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,a=t.length;n<a;n++){var s=new ic(t[n],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=r}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,n=this.polys.length;r<n;r++)for(var a=this.polys[r].getSweepEvents(),s=0,f=a.length;s<f;s++)t.push(a[s]);return t}}]),e}(),oc=function(){Ne(e,null,[{key:"factory",value:function(t){for(var r=[],n=0,a=t.length;n<a;n++){var s=t[n];if(!(!s.isInResult()||s.ringOut)){for(var f=null,o=s.leftSE,x=s.rightSE,C=[o],P=o.point,Y=[];f=o,o=x,C.push(o),o.point!==P;)for(;;){var ze=o.getAvailableLinkedEvents();if(ze.length===0){var ge=C[0].point,Bt=C[C.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(ge.x,",")+" ".concat(ge.y,"]. Last matching segment found ends at")+" [".concat(Bt.x,", ").concat(Bt.y,"]."))}if(ze.length===1){x=ze[0].otherSE;break}for(var Ur=null,kn=0,Io=Y.length;kn<Io;kn++)if(Y[kn].point===o.point){Ur=kn;break}if(Ur!==null){var rl=Y.splice(Ur)[0],Co=C.splice(rl.index);Co.unshift(Co[0].otherSE),r.push(new e(Co.reverse()));continue}Y.push({index:C.length,point:o.point});var as=o.getLeftmostComparator(f);x=ze.sort(as)[0].otherSE;break}r.push(new e(C))}}return r}}]);function e(t){vn(this,e),this.events=t;for(var r=0,n=t.length;r<n;r++)t[r].segment.ringOut=this;this.poly=null}return Ne(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,r=[t],n=1,a=this.events.length-1;n<a;n++){var s=this.events[n].point,f=this.events[n+1].point;da(s,t,f)!==0&&(r.push(s),t=s)}if(r.length===1)return null;var o=r[0],x=r[1];da(o,t,x)===0&&r.shift(),r.push(r[0]);for(var C=this.isExteriorRing()?1:-1,P=this.isExteriorRing()?0:r.length-1,Y=this.isExteriorRing()?r.length:-1,ze=[],ge=P;ge!=Y;ge+=C)ze.push([r[ge].x,r[ge].y]);return ze}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],r=1,n=this.events.length;r<n;r++){var a=this.events[r];Xn.compare(t,a)>0&&(t=a)}for(var s=t.segment.prevInResult(),f=s?s.prevInResult():null;;){if(!s)return null;if(!f)return s.ringOut;if(f.ringOut!==s.ringOut)return f.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=f.prevInResult(),f=s?s.prevInResult():null}}}]),e}(),Ea=function(){function e(t){vn(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Ne(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var r=0,n=this.interiorRings.length;r<n;r++){var a=this.interiorRings[r].getGeom();a!==null&&t.push(a)}return t}}]),e}(),sc=function(){function e(t){vn(this,e),this.rings=t,this.polys=this._composePolys(t)}return Ne(e,[{key:"getGeom",value:function(){for(var t=[],r=0,n=this.polys.length;r<n;r++){var a=this.polys[r].getGeom();a!==null&&t.push(a)}return t}},{key:"_composePolys",value:function(t){for(var r=[],n=0,a=t.length;n<a;n++){var s=t[n];if(!s.poly)if(s.isExteriorRing())r.push(new Ea(s));else{var f=s.enclosingRing();f.poly||r.push(new Ea(f)),f.poly.addInterior(s)}}return r}}]),e}(),ac=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ao.compare;vn(this,e),this.queue=t,this.tree=new Ms(r),this.segments=[]}return Ne(e,[{key:"process",value:function(t){var r=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),n;var a=t.isLeft?this.tree.insert(r):this.tree.find(r);if(!a)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=a,f=a,o=void 0,x=void 0;o===void 0;)s=this.tree.prev(s),s===null?o=null:s.key.consumedBy===void 0&&(o=s.key);for(;x===void 0;)f=this.tree.next(f),f===null?x=null:f.key.consumedBy===void 0&&(x=f.key);if(t.isLeft){var C=null;if(o){var P=o.getIntersection(r);if(P!==null&&(r.isAnEndpoint(P)||(C=P),!o.isAnEndpoint(P)))for(var Y=this._splitSafely(o,P),ze=0,ge=Y.length;ze<ge;ze++)n.push(Y[ze])}var Bt=null;if(x){var Ur=x.getIntersection(r);if(Ur!==null&&(r.isAnEndpoint(Ur)||(Bt=Ur),!x.isAnEndpoint(Ur)))for(var kn=this._splitSafely(x,Ur),Io=0,rl=kn.length;Io<rl;Io++)n.push(kn[Io])}if(C!==null||Bt!==null){var Co=null;if(C===null)Co=Bt;else if(Bt===null)Co=C;else{var as=Xn.comparePoints(C,Bt);Co=as<=0?C:Bt}this.queue.remove(r.rightSE),n.push(r.rightSE);for(var $s=r.split(Co),ah=0,ch=$s.length;ah<ch;ah++)n.push($s[ah])}n.length>0?(this.tree.remove(r),n.push(t)):(this.segments.push(r),r.prev=o)}else{if(o&&x){var Zu=o.getIntersection(x);if(Zu!==null){if(!o.isAnEndpoint(Zu))for(var ih=this._splitSafely(o,Zu),al=0,sh=ih.length;al<sh;al++)n.push(ih[al]);if(!x.isAnEndpoint(Zu))for(var _h=this._splitSafely(x,Zu),Ih=0,Lh=_h.length;Ih<Lh;Ih++)n.push(_h[Ih])}}this.tree.remove(r)}return n}},{key:"_splitSafely",value:function(t,r){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var a=t.split(r);return a.push(n),t.consumedBy===void 0&&this.tree.insert(t),a}}]),e}(),Ia=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,uc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,lc=function(){function e(){vn(this,e)}return Ne(e,[{key:"run",value:function(t,r,n){Nn.type=t,Ji.reset();for(var a=[new _a(r,!0)],s=0,f=n.length;s<f;s++)a.push(new _a(n[s],!1));if(Nn.numMultiPolys=a.length,Nn.type==="difference")for(var o=a[0],x=1;x<a.length;)xs(a[x].bbox,o.bbox)!==null?x++:a.splice(x,1);if(Nn.type==="intersection"){for(var C=0,P=a.length;C<P;C++)for(var Y=a[C],ze=C+1,ge=a.length;ze<ge;ze++)if(xs(Y.bbox,a[ze].bbox)===null)return[]}for(var Bt=new Ms(Xn.compare),Ur=0,kn=a.length;Ur<kn;Ur++)for(var Io=a[Ur].getSweepEvents(),rl=0,Co=Io.length;rl<Co;rl++)if(Bt.insert(Io[rl]),Bt.size>Ia)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var as=new ac(Bt),$s=Bt.size,ah=Bt.pop();ah;){var ch=ah.key;if(Bt.size===$s){var Zu=ch.segment;throw new Error("Unable to pop() ".concat(ch.isLeft?"left":"right"," SweepEvent ")+"[".concat(ch.point.x,", ").concat(ch.point.y,"] from segment #").concat(Zu.id," ")+"[".concat(Zu.leftSE.point.x,", ").concat(Zu.leftSE.point.y,"] -> ")+"[".concat(Zu.rightSE.point.x,", ").concat(Zu.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Bt.size>Ia)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(as.segments.length>uc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ih=as.process(ch),al=0,sh=ih.length;al<sh;al++){var _h=ih[al];_h.consumedBy===void 0&&Bt.insert(_h)}$s=Bt.size,ah=Bt.pop()}Ji.reset();var Ih=oc.factory(as.segments),Lh=new sc(Ih);return Lh.getGeom()}}]),e}(),Nn=new lc,cc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("union",e,r)},fc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("intersection",e,r)},hc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("xor",e,r)},gc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("difference",e,r)},eu={union:cc,intersection:fc,xor:hc,difference:gc},Ee=63710088e-1,nu={centimeters:Ee*100,centimetres:Ee*100,degrees:Ee/111325,feet:Ee*3.28084,inches:Ee*39.37,kilometers:Ee/1e3,kilometres:Ee/1e3,meters:Ee,metres:Ee,miles:Ee/1609.344,millimeters:Ee*1e3,millimetres:Ee*1e3,nauticalmiles:Ee/1852,radians:1,yards:Ee*1.0936};function Wo(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function pc(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ca(e[0])||!Ca(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Wo(n,t,r)}function ru(e,t,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:e};return Wo(o,t,r)}function ws(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function iu(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Wo(n,t,r)}function dc(e,t){t===void 0&&(t="kilometers");var r=nu[t];if(!r)throw new Error(t+" units is invalid");return e*r}function vc(e,t){t===void 0&&(t="kilometers");var r=nu[t];if(!r)throw new Error(t+" units is invalid");return e/r}function Ca(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Fo(e){return e.type==="Feature"?e.geometry:e}function yc(e,t,r){r===void 0&&(r={});var n=Fo(e),a=Fo(t),s=eu.union(n.coordinates,a.coordinates);return s.length===0?null:s.length===1?ru(s[0],r.properties):iu(s,r.properties)}function mc(e){let t,r,n;return{c(){t=jn("svg"),r=jn("path"),D(r,"stroke-width","4"),D(r,"fill-rule","evenodd"),D(r,"clip-rule","evenodd"),D(r,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),D(r,"class","svelte-1k1cmht"),D(t,"width",n=e[0]!=="list"?void 0:"20"),D(t,"viewBox","0 0 70 85"),D(t,"fill","none"),D(t,"class","svelte-1k1cmht"),nn(t,"in-map",e[0]!=="list"),nn(t,"list-icon",e[0]==="list")},m(a,s){Be(a,t,s),rt(t,r)},p(a,[s]){s&1&&n!==(n=a[0]!=="list"?void 0:"20")&&D(t,"width",n),s&1&&nn(t,"in-map",a[0]!=="list"),s&1&&nn(t,"list-icon",a[0]==="list")},i:_t,o:_t,d(a){a&&Pe(t)}}}function _c(e,t,r){let{displayIn:n}=t;return e.$$set=a=>{"displayIn"in a&&r(0,n=a.displayIn)},[n]}class Ec extends Gr{constructor(t){super(),kr(this,t,_c,mc,Br,{displayIn:0})}}function ou(e,t,r){if(e!==null)for(var n,a,s,f,o,x,C,P=0,Y=0,ze,ge=e.type,Bt=ge==="FeatureCollection",Ur=ge==="Feature",kn=Bt?e.features.length:1,Io=0;Io<kn;Io++){C=Bt?e.features[Io].geometry:Ur?e.geometry:e,ze=C?C.type==="GeometryCollection":!1,o=ze?C.geometries.length:1;for(var rl=0;rl<o;rl++){var Co=0,as=0;if(f=ze?C.geometries[rl]:C,f!==null){x=f.coordinates;var $s=f.type;switch(P=r&&($s==="Polygon"||$s==="MultiPolygon")?1:0,$s){case null:break;case"Point":if(t(x,Y,Io,Co,as)===!1)return!1;Y++,Co++;break;case"LineString":case"MultiPoint":for(n=0;n<x.length;n++){if(t(x[n],Y,Io,Co,as)===!1)return!1;Y++,$s==="MultiPoint"&&Co++}$s==="LineString"&&Co++;break;case"Polygon":case"MultiLineString":for(n=0;n<x.length;n++){for(a=0;a<x[n].length-P;a++){if(t(x[n][a],Y,Io,Co,as)===!1)return!1;Y++}$s==="MultiLineString"&&Co++,$s==="Polygon"&&as++}$s==="Polygon"&&Co++;break;case"MultiPolygon":for(n=0;n<x.length;n++){for(as=0,a=0;a<x[n].length;a++){for(s=0;s<x[n][a].length-P;s++){if(t(x[n][a][s],Y,Io,Co,as)===!1)return!1;Y++}as++}Co++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(ou(f.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Na(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function su(e,t){var r,n,a,s,f,o,x,C,P,Y,ze=0,ge=e.type==="FeatureCollection",Bt=e.type==="Feature",Ur=ge?e.features.length:1;for(r=0;r<Ur;r++){for(o=ge?e.features[r].geometry:Bt?e.geometry:e,C=ge?e.features[r].properties:Bt?e.properties:{},P=ge?e.features[r].bbox:Bt?e.bbox:void 0,Y=ge?e.features[r].id:Bt?e.id:void 0,x=o?o.type==="GeometryCollection":!1,f=x?o.geometries.length:1,a=0;a<f;a++){if(s=x?o.geometries[a]:o,s===null){if(t(null,ze,C,P,Y)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,ze,C,P,Y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(t(s.geometries[n],ze,C,P,Y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ze++}}function Ls(e){var t=[1/0,1/0,-1/0,-1/0];return ou(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Ls.default=Ls;function Ic(e,t){t===void 0&&(t={});var r=Ls(e),n=(r[0]+r[2])/2,a=(r[1]+r[3])/2;return pc([n,a],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),r=Math.max(Math.min(t.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(r+n,0):Math.min(n,r);var a=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:r;for(a=a<0?Math.max(r+arguments[2],0):Math.min(a,r);n<a;)t[n]=e,++n;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var jr=function(){};jr.prototype.interfaces_=function(){return[]};jr.prototype.getClass=function(){return jr};jr.prototype.equalsWithTolerance=function(e,t,r){return Math.abs(e-t)<=r};var ct=function(e){function t(r){e.call(this,r),this.name="IllegalArgumentException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),z=function(){},au={MAX_VALUE:{configurable:!0}};z.isNaN=function(e){return Number.isNaN(e)};z.doubleToLongBits=function(e){return e};z.longBitsToDouble=function(e){return e};z.isInfinite=function(e){return!Number.isFinite(e)};au.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(z,au);var ke=function(){},jo=function(){},vi=function(){};function Ge(){}var v=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},si={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};v.prototype.setOrdinate=function(e,t){switch(e){case v.X:this.x=t;break;case v.Y:this.y=t;break;case v.Z:this.z=t;break;default:throw new ct("Invalid ordinate index: "+e)}};v.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return!(!jr.equalsWithTolerance(this.x,t.x,r)||!jr.equalsWithTolerance(this.y,t.y,r))}};v.prototype.getOrdinate=function(e){switch(e){case v.X:return this.x;case v.Y:return this.y;case v.Z:return this.z}throw new ct("Invalid ordinate index: "+e)};v.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||z.isNaN(this.z))&&z.isNaN(e.z)};v.prototype.equals=function(e){return e instanceof v?this.equals2D(e):!1};v.prototype.equalInZ=function(e,t){return jr.equalsWithTolerance(this.z,e.z,t)};v.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};v.prototype.clone=function(){};v.prototype.copy=function(){return new v(this)};v.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};v.prototype.distance3D=function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return Math.sqrt(t*t+r*r+n*n)};v.prototype.distance=function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)};v.prototype.hashCode=function(){var e=17;return e=37*e+v.hashCode(this.x),e=37*e+v.hashCode(this.y),e};v.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};v.prototype.interfaces_=function(){return[ke,jo,Ge]};v.prototype.getClass=function(){return v};v.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=z.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};si.DimensionalComparator.get=function(){return rr};si.serialVersionUID.get=function(){return 6683108902428367e3};si.NULL_ORDINATE.get=function(){return z.NaN};si.X.get=function(){return 0};si.Y.get=function(){return 1};si.Z.get=function(){return 2};Object.defineProperties(v,si);var rr=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new ct("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};rr.prototype.compare=function(e,t){var r=e,n=t,a=rr.compare(r.x,n.x);if(a!==0)return a;var s=rr.compare(r.y,n.y);if(s!==0)return s;if(this._dimensionsToTest<=2)return 0;var f=rr.compare(r.z,n.z);return f};rr.prototype.interfaces_=function(){return[vi]};rr.prototype.getClass=function(){return rr};rr.compare=function(e,t){return e<t?-1:e>t?1:z.isNaN(e)?z.isNaN(t)?0:-1:z.isNaN(t)?1:0};var yi=function(){};yi.prototype.create=function(){};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};var m=function(){},ho={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};m.prototype.interfaces_=function(){return[]};m.prototype.getClass=function(){return m};m.toLocationSymbol=function(e){switch(e){case m.EXTERIOR:return"e";case m.BOUNDARY:return"b";case m.INTERIOR:return"i";case m.NONE:return"-"}throw new ct("Unknown location value: "+e)};ho.INTERIOR.get=function(){return 0};ho.BOUNDARY.get=function(){return 1};ho.EXTERIOR.get=function(){return 2};ho.NONE.get=function(){return-1};Object.defineProperties(m,ho);var G=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},xe=function(){},uu={LOG_10:{configurable:!0}};xe.prototype.interfaces_=function(){return[]};xe.prototype.getClass=function(){return xe};xe.log10=function(e){var t=Math.log(e);return z.isInfinite(t)||z.isNaN(t)?t:t/xe.LOG_10};xe.min=function(e,t,r,n){var a=e;return t<a&&(a=t),r<a&&(a=r),n<a&&(a=n),a};xe.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],r=arguments[2];return e<t?t:e>r?r:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],a=arguments[1],s=arguments[2];return n<a?a:n>s?s:n}};xe.wrap=function(e,t){return e<0?t- -e%t:e%t};xe.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],r=arguments[2],n=e;return t>n&&(n=t),r>n&&(n=r),n}else if(arguments.length===4){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3],x=a;return s>x&&(x=s),f>x&&(x=f),o>x&&(x=o),x}};xe.average=function(e,t){return(e+t)/2};uu.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(xe,uu);var yn=function(e){this.str=e};yn.prototype.append=function(e){this.str+=e};yn.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};yn.prototype.toString=function(e){return this.str};var sn=function(e){this.value=e};sn.prototype.intValue=function(){return this.value};sn.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};sn.isNaN=function(e){return Number.isNaN(e)};var Zi=function(){};Zi.isWhitespace=function(e){return e<=32&&e>=0||e===127};Zi.toUpperCase=function(e){return e.toUpperCase()};var I=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}else if(typeof arguments[0]=="string"){var n=arguments[0];e.call(this,e.parse(n))}}else if(arguments.length===2){var a=arguments[0],s=arguments[1];this.init(a,s)}},Qe={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};I.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};I.prototype.extractSignificantDigits=function(e,t){var r=this.abs(),n=I.magnitude(r._hi),a=I.TEN.pow(n);r=r.divide(a),r.gt(I.TEN)?(r=r.divide(I.TEN),n+=1):r.lt(I.ONE)&&(r=r.multiply(I.TEN),n-=1);for(var s=n+1,f=new yn,o=I.MAX_PRINT_DIGITS-1,x=0;x<=o;x++){e&&x===s&&f.append(".");var C=Math.trunc(r._hi);if(C<0)break;var P=!1,Y=0;C>9?(P=!0,Y="9"):Y="0"+C,f.append(Y),r=r.subtract(I.valueOf(C)).multiply(I.TEN),P&&r.selfAdd(I.TEN);var ze=!0,ge=I.magnitude(r._hi);if(ge<0&&Math.abs(ge)>=o-x&&(ze=!1),!ze)break}return t[0]=n,f.toString()};I.prototype.sqr=function(){return this.multiply(this)};I.prototype.doubleValue=function(){return this._hi+this._lo};I.prototype.subtract=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};I.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};I.prototype.isZero=function(){return this._hi===0&&this._lo===0};I.prototype.selfSubtract=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};I.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};I.prototype.min=function(e){return this.le(e)?this:e};I.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=null,s=null,f=null,o=null,x=null,C=null,P=null,Y=null;return x=this._hi/r,C=I.SPLIT*x,a=C-x,Y=I.SPLIT*r,a=C-a,s=x-a,f=Y-r,P=x*r,f=Y-f,o=r-f,Y=a*f-P+a*o+s*f+s*o,C=(this._hi-P-Y+this._lo-x*n)/r,Y=x+C,this._hi=Y,this._lo=x-Y+C,this}};I.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};I.prototype.divide=function(){if(arguments[0]instanceof I){var e=arguments[0],t=null,r=null,n=null,a=null,s=null,f=null,o=null,x=null;s=this._hi/e._hi,f=I.SPLIT*s,t=f-s,x=I.SPLIT*e._hi,t=f-t,r=s-t,n=x-e._hi,o=s*e._hi,n=x-n,a=e._hi-n,x=t*n-o+t*a+r*n+r*a,f=(this._hi-o-x+this._lo-s*e._lo)/e._hi,x=s+f;var C=x,P=s-x+f;return new I(C,P)}else if(typeof arguments[0]=="number"){var Y=arguments[0];return z.isNaN(Y)?I.createNaN():I.copy(this).selfDivide(Y,0)}};I.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};I.prototype.pow=function(e){if(e===0)return I.valueOf(1);var t=new I(this),r=I.valueOf(1),n=Math.abs(e);if(n>1)for(;n>0;)n%2===1&&r.selfMultiply(t),n/=2,n>0&&(t=t.sqr());else r=t;return e<0?r.reciprocal():r};I.prototype.ceil=function(){if(this.isNaN())return I.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new I(e,t)};I.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};I.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};I.prototype.setValue=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};I.prototype.max=function(e){return this.ge(e)?this:e};I.prototype.sqrt=function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,r=I.valueOf(t),n=this.subtract(r.sqr()),a=n._hi*(e*.5);return r.add(a)};I.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],r=null,n=null,a=null,s=null,f=null,o=null;return a=this._hi+t,f=a-this._hi,s=a-f,s=t-f+(this._hi-s),o=s+this._lo,r=a+o,n=o+(a-r),this._hi=r+n,this._lo=n+(r-this._hi),this}}else if(arguments.length===2){var x=arguments[0],C=arguments[1],P=null,Y=null,ze=null,ge=null,Bt=null,Ur=null,kn=null,Io=null;Bt=this._hi+x,ze=this._lo+C,kn=Bt-this._hi,Io=ze-this._lo,Ur=Bt-kn,ge=ze-Io,Ur=x-kn+(this._hi-Ur),ge=C-Io+(this._lo-ge),kn=Ur+ze,P=Bt+kn,Y=kn+(Bt-P),kn=ge+Y;var rl=P+kn,Co=kn+(P-rl);return this._hi=rl,this._lo=Co,this}};I.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=null,s=null,f=null,o=null,x=null,C=null;x=I.SPLIT*this._hi,a=x-this._hi,C=I.SPLIT*r,a=x-a,s=this._hi-a,f=C-r,x=this._hi*r,f=C-f,o=r-f,C=a*f-x+a*o+s*f+s*o+(this._hi*n+this._lo*r);var P=x+C;a=x-P;var Y=C+a;return this._hi=P,this._lo=Y,this}};I.prototype.selfSqr=function(){return this.selfMultiply(this)};I.prototype.floor=function(){if(this.isNaN())return I.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new I(e,t)};I.prototype.negate=function(){return this.isNaN()?this:new I(-this._hi,-this._lo)};I.prototype.clone=function(){};I.prototype.multiply=function(){if(arguments[0]instanceof I){var e=arguments[0];return e.isNaN()?I.createNaN():I.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return z.isNaN(t)?I.createNaN():I.copy(this).selfMultiply(t,0)}};I.prototype.isNaN=function(){return z.isNaN(this._hi)};I.prototype.intValue=function(){return Math.trunc(this._hi)};I.prototype.toString=function(){var e=I.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};I.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),r=this.extractSignificantDigits(!0,t),n=t[0]+1,a=r;if(r.charAt(0)===".")a="0"+r;else if(n<0)a="0."+I.stringOfChar("0",-n)+r;else if(r.indexOf(".")===-1){var s=n-r.length,f=I.stringOfChar("0",s);a=r+f+".0"}return this.isNegative()?"-"+a:a};I.prototype.reciprocal=function(){var e=null,t=null,r=null,n=null,a=null,s=null,f=null,o=null;a=1/this._hi,s=I.SPLIT*a,e=s-a,o=I.SPLIT*this._hi,e=s-e,t=a-e,r=o-this._hi,f=a*this._hi,r=o-r,n=this._hi-r,o=e*r-f+e*n+t*r+t*n,s=(1-f-o-a*this._lo)/this._hi;var x=a+s,C=a-x+s;return new I(x,C)};I.prototype.toSciNotation=function(){if(this.isZero())return I.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),r=this.extractSignificantDigits(!1,t),n=I.SCI_NOT_EXPONENT_CHAR+t[0];if(r.charAt(0)==="0")throw new Error("Found leading zero: "+r);var a="";r.length>1&&(a=r.substring(1));var s=r.charAt(0)+"."+a;return this.isNegative()?"-"+s+n:s+n};I.prototype.abs=function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)};I.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};I.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};I.prototype.add=function(){if(arguments[0]instanceof I){var e=arguments[0];return I.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return I.copy(this).selfAdd(t)}};I.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof I){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._hi=r,this._lo=n}};I.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};I.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};I.prototype.trunc=function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()};I.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};I.prototype.interfaces_=function(){return[Ge,ke,jo]};I.prototype.getClass=function(){return I};I.sqr=function(e){return I.valueOf(e).selfMultiply(e)};I.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return I.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new I(t)}};I.sqrt=function(e){return I.valueOf(e).sqrt()};I.parse=function(e){for(var t=0,r=e.length;Zi.isWhitespace(e.charAt(t));)t++;var n=!1;if(t<r){var a=e.charAt(t);(a==="-"||a==="+")&&(t++,a==="-"&&(n=!0))}for(var s=new I,f=0,o=0,x=0;!(t>=r);){var C=e.charAt(t);if(t++,Zi.isDigit(C)){var P=C-"0";s.selfMultiply(I.TEN),s.selfAdd(P),f++;continue}if(C==="."){o=f;continue}if(C==="e"||C==="E"){var Y=e.substring(t);try{x=sn.parseInt(Y)}catch(kn){throw kn instanceof Error?new Error("Invalid exponent "+Y+" in string "+e):kn}finally{}break}throw new Error("Unexpected character '"+C+"' at position "+t+" in string "+e)}var ze=s,ge=f-o-x;if(ge===0)ze=s;else if(ge>0){var Bt=I.TEN.pow(ge);ze=s.divide(Bt)}else if(ge<0){var Ur=I.TEN.pow(-ge);ze=s.multiply(Ur)}return n?ze.negate():ze};I.createNaN=function(){return new I(z.NaN,z.NaN)};I.copy=function(e){return new I(e)};I.magnitude=function(e){var t=Math.abs(e),r=Math.log(t)/Math.log(10),n=Math.trunc(Math.floor(r)),a=Math.pow(10,n);return a*10<=t&&(n+=1),n};I.stringOfChar=function(e,t){for(var r=new yn,n=0;n<t;n++)r.append(e);return r.toString()};Qe.PI.get=function(){return new I(3.141592653589793,12246467991473532e-32)};Qe.TWO_PI.get=function(){return new I(6.283185307179586,24492935982947064e-32)};Qe.PI_2.get=function(){return new I(1.5707963267948966,6123233995736766e-32)};Qe.E.get=function(){return new I(2.718281828459045,14456468917292502e-32)};Qe.NaN.get=function(){return new I(z.NaN,z.NaN)};Qe.EPS.get=function(){return 123259516440783e-46};Qe.SPLIT.get=function(){return 134217729};Qe.MAX_PRINT_DIGITS.get=function(){return 32};Qe.TEN.get=function(){return I.valueOf(10)};Qe.ONE.get=function(){return I.valueOf(1)};Qe.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Qe.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(I,Qe);var ue=function(){},lu={DP_SAFE_EPSILON:{configurable:!0}};ue.prototype.interfaces_=function(){return[]};ue.prototype.getClass=function(){return ue};ue.orientationIndex=function(e,t,r){var n=ue.orientationIndexFilter(e,t,r);if(n<=1)return n;var a=I.valueOf(t.x).selfAdd(-e.x),s=I.valueOf(t.y).selfAdd(-e.y),f=I.valueOf(r.x).selfAdd(-t.x),o=I.valueOf(r.y).selfAdd(-t.y);return a.selfMultiply(o).selfSubtract(s.selfMultiply(f)).signum()};ue.signOfDet2x2=function(e,t,r,n){var a=e.multiply(n).selfSubtract(t.multiply(r));return a.signum()};ue.intersection=function(e,t,r,n){var a=I.valueOf(n.y).selfSubtract(r.y).selfMultiply(I.valueOf(t.x).selfSubtract(e.x)),s=I.valueOf(n.x).selfSubtract(r.x).selfMultiply(I.valueOf(t.y).selfSubtract(e.y)),f=a.subtract(s),o=I.valueOf(n.x).selfSubtract(r.x).selfMultiply(I.valueOf(e.y).selfSubtract(r.y)),x=I.valueOf(n.y).selfSubtract(r.y).selfMultiply(I.valueOf(e.x).selfSubtract(r.x)),C=o.subtract(x),P=C.selfDivide(f).doubleValue(),Y=I.valueOf(e.x).selfAdd(I.valueOf(t.x).selfSubtract(e.x).selfMultiply(P)).doubleValue(),ze=I.valueOf(t.x).selfSubtract(e.x).selfMultiply(I.valueOf(e.y).selfSubtract(r.y)),ge=I.valueOf(t.y).selfSubtract(e.y).selfMultiply(I.valueOf(e.x).selfSubtract(r.x)),Bt=ze.subtract(ge),Ur=Bt.selfDivide(f).doubleValue(),kn=I.valueOf(r.y).selfAdd(I.valueOf(n.y).selfSubtract(r.y).selfMultiply(Ur)).doubleValue();return new v(Y,kn)};ue.orientationIndexFilter=function(e,t,r){var n=null,a=(e.x-r.x)*(t.y-r.y),s=(e.y-r.y)*(t.x-r.x),f=a-s;if(a>0){if(s<=0)return ue.signum(f);n=a+s}else if(a<0){if(s>=0)return ue.signum(f);n=-a-s}else return ue.signum(f);var o=ue.DP_SAFE_EPSILON*n;return f>=o||-f>=o?ue.signum(f):2};ue.signum=function(e){return e>0?1:e<0?-1:0};lu.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(ue,lu);var Q=function(){},go={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};go.X.get=function(){return 0};go.Y.get=function(){return 1};go.Z.get=function(){return 2};go.M.get=function(){return 3};Q.prototype.setOrdinate=function(e,t,r){};Q.prototype.size=function(){};Q.prototype.getOrdinate=function(e,t){};Q.prototype.getCoordinate=function(){};Q.prototype.getCoordinateCopy=function(e){};Q.prototype.getDimension=function(){};Q.prototype.getX=function(e){};Q.prototype.clone=function(){};Q.prototype.expandEnvelope=function(e){};Q.prototype.copy=function(){};Q.prototype.getY=function(e){};Q.prototype.toCoordinateArray=function(){};Q.prototype.interfaces_=function(){return[jo]};Q.prototype.getClass=function(){return Q};Object.defineProperties(Q,go);var cu=function(){},ki=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(cu),Ut=function(){};Ut.arraycopy=function(e,t,r,n,a){for(var s=0,f=t;f<t+a;f++)r[n+s]=e[f],s++};Ut.getProperty=function(e){return{"line.separator":`
`}[e]};var Ve=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var a=arguments[0],s=arguments[1];this.x=a.y*s.w-s.y*a.w,this.y=s.x*a.w-a.x*s.w,this.w=a.x*s.y-s.x*a.y}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var f=arguments[0],o=arguments[1];this.x=f.y-o.y,this.y=o.x-f.x,this.w=f.x*o.y-o.x*f.y}}else if(arguments.length===3){var x=arguments[0],C=arguments[1],P=arguments[2];this.x=x,this.y=C,this.w=P}else if(arguments.length===4){var Y=arguments[0],ze=arguments[1],ge=arguments[2],Bt=arguments[3],Ur=Y.y-ze.y,kn=ze.x-Y.x,Io=Y.x*ze.y-ze.x*Y.y,rl=ge.y-Bt.y,Co=Bt.x-ge.x,as=ge.x*Bt.y-Bt.x*ge.y;this.x=kn*as-Co*Io,this.y=rl*Io-Ur*as,this.w=Ur*Co-rl*kn}};Ve.prototype.getY=function(){var e=this.y/this.w;if(z.isNaN(e)||z.isInfinite(e))throw new ki;return e};Ve.prototype.getX=function(){var e=this.x/this.w;if(z.isNaN(e)||z.isInfinite(e))throw new ki;return e};Ve.prototype.getCoordinate=function(){var e=new v;return e.x=this.getX(),e.y=this.getY(),e};Ve.prototype.interfaces_=function(){return[]};Ve.prototype.getClass=function(){return Ve};Ve.intersection=function(e,t,r,n){var a=e.y-t.y,s=t.x-e.x,f=e.x*t.y-t.x*e.y,o=r.y-n.y,x=n.x-r.x,C=r.x*n.y-n.x*r.y,P=s*C-x*f,Y=o*f-a*C,ze=a*x-o*s,ge=P/ze,Bt=Y/ze;if(z.isNaN(ge)||z.isInfinite(ge)||z.isNaN(Bt)||z.isInfinite(Bt))throw new ki;return new v(ge,Bt)};var T=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof v){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}}else if(arguments.length===2){var n=arguments[0],a=arguments[1];this.init(n.x,a.x,n.y,a.y)}else if(arguments.length===4){var s=arguments[0],f=arguments[1],o=arguments[2],x=arguments[3];this.init(s,f,o,x)}},fu={serialVersionUID:{configurable:!0}};T.prototype.getArea=function(){return this.getWidth()*this.getHeight()};T.prototype.equals=function(e){if(!(e instanceof T))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};T.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new T;var t=this._minx>e._minx?this._minx:e._minx,r=this._miny>e._miny?this._miny:e._miny,n=this._maxx<e._maxx?this._maxx:e._maxx,a=this._maxy<e._maxy?this._maxy:e._maxy;return new T(t,n,r,a)};T.prototype.isNull=function(){return this._maxx<this._minx};T.prototype.getMaxX=function(){return this._maxx};T.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&n>=this._miny&&n<=this._maxy}};T.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof T){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof v){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.isNull()?!1:!(r>this._maxx||r<this._minx||n>this._maxy||n<this._miny)}};T.prototype.getMinY=function(){return this._miny};T.prototype.getMinX=function(){return this._minx};T.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=n,this._maxy=n):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}};T.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};T.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};T.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};T.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};T.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};T.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};T.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};T.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};T.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};T.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof T){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof v){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.covers(r,n)}};T.prototype.centre=function(){return this.isNull()?null:new v((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};T.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(arguments.length===4){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3];a<s?(this._minx=a,this._maxx=s):(this._minx=s,this._maxx=a),f<o?(this._miny=f,this._maxy=o):(this._miny=o,this._maxy=f)}};T.prototype.getMaxY=function(){return this._maxy};T.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var r=0;return this._maxy<e._miny?r=e._miny-this._maxy:this._miny>e._maxy&&(r=this._miny-e._maxy),t===0?r:r===0?t:Math.sqrt(t*t+r*r)};T.prototype.hashCode=function(){var e=17;return e=37*e+v.hashCode(this._minx),e=37*e+v.hashCode(this._maxx),e=37*e+v.hashCode(this._miny),e=37*e+v.hashCode(this._maxy),e};T.prototype.interfaces_=function(){return[ke,Ge]};T.prototype.getClass=function(){return T};T.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],r=arguments[2];return r.x>=(e.x<t.x?e.x:t.x)&&r.x<=(e.x>t.x?e.x:t.x)&&r.y>=(e.y<t.y?e.y:t.y)&&r.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var n=arguments[0],a=arguments[1],s=arguments[2],f=arguments[3],o=Math.min(s.x,f.x),x=Math.max(s.x,f.x),C=Math.min(n.x,a.x),P=Math.max(n.x,a.x);return!(C>x||P<o||(o=Math.min(s.y,f.y),x=Math.max(s.y,f.y),C=Math.min(n.y,a.y),P=Math.max(n.y,a.y),C>x)||P<o)}};fu.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(T,fu);var Ze={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Ko=function(e){this.geometryFactory=e||new H};Ko.prototype.read=function(e){var t,r,n;e=e.replace(/[\n\r]/g," ");var a=Ze.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(a=Ze.emptyTypeStr.exec(e),a[2]=void 0),a&&(r=a[1].toLowerCase(),n=a[2],pi[r]&&(t=pi[r].apply(this,[n]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};Ko.prototype.write=function(e){return this.extractGeometry(e)};Ko.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Un[t])return null;var r=t.toUpperCase(),n;return e.isEmpty()?n=r+" EMPTY":n=r+"("+Un[t].apply(this,[e])+")",n};var Un={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Un.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push("("+Un.point.apply(t,[e._geometries[n]])+")");return r.join(",")},linestring:function(e){for(var t=this,r=[],n=0,a=e._points._coordinates.length;n<a;++n)r.push(Un.coordinate.apply(t,[e._points._coordinates[n]]));return r.join(",")},linearring:function(e){for(var t=this,r=[],n=0,a=e._points._coordinates.length;n<a;++n)r.push(Un.coordinate.apply(t,[e._points._coordinates[n]]));return r.join(",")},multilinestring:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push("("+Un.linestring.apply(t,[e._geometries[n]])+")");return r.join(",")},polygon:function(e){var t=this,r=[];r.push("("+Un.linestring.apply(this,[e._shell])+")");for(var n=0,a=e._holes.length;n<a;++n)r.push("("+Un.linestring.apply(t,[e._holes[n]])+")");return r.join(",")},multipolygon:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push("("+Un.polygon.apply(t,[e._geometries[n]])+")");return r.join(",")},geometrycollection:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push(t.extractGeometry(e._geometries[n]));return r.join(",")}},pi={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Ze.spaces);return this.geometryFactory.createPoint(new v(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var r,n=e.trim().split(","),a=[],s=0,f=n.length;s<f;++s)r=n[s].replace(Ze.trimParens,"$1"),a.push(pi.point.apply(t,[r]));return this.geometryFactory.createMultiPoint(a)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),r=[],n,a=0,s=t.length;a<s;++a)n=t[a].trim().split(Ze.spaces),r.push(new v(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),r=[],n,a=0,s=t.length;a<s;++a)n=t[a].trim().split(Ze.spaces),r.push(new v(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var r,n=e.trim().split(Ze.parenComma),a=[],s=0,f=n.length;s<f;++s)r=n[s].replace(Ze.trimParens,"$1"),a.push(pi.linestring.apply(t,[r]));return this.geometryFactory.createMultiLineString(a)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var r,n,a,s=e.trim().split(Ze.parenComma),f,o=[],x=0,C=s.length;x<C;++x)r=s[x].replace(Ze.trimParens,"$1"),n=pi.linestring.apply(t,[r]),a=t.geometryFactory.createLinearRing(n._points),x===0?f=a:o.push(a);return this.geometryFactory.createPolygon(f,o)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var r,n=e.trim().split(Ze.doubleParenComma),a=[],s=0,f=n.length;s<f;++s)r=n[s].replace(Ze.trimParens,"$1"),a.push(pi.polygon.apply(t,[r]));return this.geometryFactory.createMultiPolygon(a)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=e.trim().split("|"),n=[],a=0,s=r.length;a<s;++a)n.push(t.read(r[a]));return this.geometryFactory.createGeometryCollection(n)}},qe=function(e){this.parser=new Ko(e)};qe.prototype.write=function(e){return this.parser.write(e)};qe.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Kn=function(e){function t(r){e.call(this,r),this.name="RuntimeException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Bo=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var r=arguments[0];e.call(this,r)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Kn),U=function(){};U.prototype.interfaces_=function(){return[]};U.prototype.getClass=function(){return U};U.shouldNeverReachHere=function(){if(arguments.length===0)U.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Bo("Should never reach here"+(e!==null?": "+e:""))}};U.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],U.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new Bo:new Bo(t)};U.equals=function(){var e,t,r;if(arguments.length===2)e=arguments[0],t=arguments[1],U.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],r=arguments[2],!t.equals(e)))throw new Bo("Expected "+e+" but encountered "+t+(r!==null?": "+r:""))};var ft=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new v,this._intPt[1]=new v,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ai={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ft.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};ft.prototype.getTopologySummary=function(){var e=new yn;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};ft.prototype.computeIntersection=function(e,t,r,n){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=r,this._inputLines[1][1]=n,this._result=this.computeIntersect(e,t,r,n)};ft.prototype.getIntersectionNum=function(){return this._result};ft.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),r=this.getEdgeDistance(e,1);t>r?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};ft.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};ft.prototype.setPrecisionModel=function(e){this._precisionModel=e};ft.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],r=0;r<this._result;r++)if(!(e._intPt[r].equals2D(e._inputLines[t][0])||e._intPt[r].equals2D(e._inputLines[t][1])))return!0;return!1}};ft.prototype.getIntersection=function(e){return this._intPt[e]};ft.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};ft.prototype.hasIntersection=function(){return this._result!==ft.NO_INTERSECTION};ft.prototype.getEdgeDistance=function(e,t){var r=ft.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return r};ft.prototype.isCollinear=function(){return this._result===ft.COLLINEAR_INTERSECTION};ft.prototype.toString=function(){return qe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+qe.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};ft.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};ft.prototype.isIntersection=function(e){for(var t=this,r=0;r<this._result;r++)if(t._intPt[r].equals2D(e))return!0;return!1};ft.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};ft.prototype.interfaces_=function(){return[]};ft.prototype.getClass=function(){return ft};ft.computeEdgeDistance=function(e,t,r){var n=Math.abs(r.x-t.x),a=Math.abs(r.y-t.y),s=-1;if(e.equals(t))s=0;else if(e.equals(r))n>a?s=n:s=a;else{var f=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);n>a?s=f:s=o,s===0&&!e.equals(t)&&(s=Math.max(f,o))}return U.isTrue(!(s===0&&!e.equals(t)),"Bad distance calculation"),s};ft.nonRobustComputeEdgeDistance=function(e,t,r){var n=e.x-t.x,a=e.y-t.y,s=Math.sqrt(n*n+a*a);return U.isTrue(!(s===0&&!e.equals(t)),"Invalid distance calculation"),s};ai.DONT_INTERSECT.get=function(){return 0};ai.DO_INTERSECT.get=function(){return 1};ai.COLLINEAR.get=function(){return 2};ai.NO_INTERSECTION.get=function(){return 0};ai.POINT_INTERSECTION.get=function(){return 1};ai.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(ft,ai);var zr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(r){var n=new T(this._inputLines[0][0],this._inputLines[0][1]),a=new T(this._inputLines[1][0],this._inputLines[1][1]);return n.contains(r)&&a.contains(r)},t.prototype.computeIntersection=function(){if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];if(this._isProper=!1,T.intersects(n,a,r)&&O.orientationIndex(n,a,r)===0&&O.orientationIndex(a,n,r)===0)return this._isProper=!0,(r.equals(n)||r.equals(a))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(r,n,a,s,f){f.x=this.smallestInAbsValue(r.x,n.x,a.x,s.x),f.y=this.smallestInAbsValue(r.y,n.y,a.y,s.y),r.x-=f.x,r.y-=f.y,n.x-=f.x,n.y-=f.y,a.x-=f.x,a.y-=f.y,s.x-=f.x,s.y-=f.y},t.prototype.safeHCoordinateIntersection=function(r,n,a,s){var f=null;try{f=Ve.intersection(r,n,a,s)}catch(o){if(o instanceof ki)f=t.nearestEndpoint(r,n,a,s);else throw o}finally{}return f},t.prototype.intersection=function(r,n,a,s){var f=this.intersectionWithNormalization(r,n,a,s);return this.isInSegmentEnvelopes(f)||(f=new v(t.nearestEndpoint(r,n,a,s))),this._precisionModel!==null&&this._precisionModel.makePrecise(f),f},t.prototype.smallestInAbsValue=function(r,n,a,s){var f=r,o=Math.abs(f);return Math.abs(n)<o&&(f=n,o=Math.abs(n)),Math.abs(a)<o&&(f=a,o=Math.abs(a)),Math.abs(s)<o&&(f=s),f},t.prototype.checkDD=function(r,n,a,s,f){var o=ue.intersection(r,n,a,s),x=this.isInSegmentEnvelopes(o);Ut.out.println("DD in env = "+x+"  --------------------- "+o),f.distance(o)>1e-4&&Ut.out.println("Distance = "+f.distance(o))},t.prototype.intersectionWithNormalization=function(r,n,a,s){var f=new v(r),o=new v(n),x=new v(a),C=new v(s),P=new v;this.normalizeToEnvCentre(f,o,x,C,P);var Y=this.safeHCoordinateIntersection(f,o,x,C);return Y.x+=P.x,Y.y+=P.y,Y},t.prototype.computeCollinearIntersection=function(r,n,a,s){var f=T.intersects(r,n,a),o=T.intersects(r,n,s),x=T.intersects(a,s,r),C=T.intersects(a,s,n);return f&&o?(this._intPt[0]=a,this._intPt[1]=s,e.COLLINEAR_INTERSECTION):x&&C?(this._intPt[0]=r,this._intPt[1]=n,e.COLLINEAR_INTERSECTION):f&&x?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!o&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):f&&C?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!o&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&x?(this._intPt[0]=s,this._intPt[1]=r,s.equals(r)&&!f&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&C?(this._intPt[0]=s,this._intPt[1]=n,s.equals(n)&&!f&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(r,n,a,s,f){var o=r.x<n.x?r.x:n.x,x=r.y<n.y?r.y:n.y,C=r.x>n.x?r.x:n.x,P=r.y>n.y?r.y:n.y,Y=a.x<s.x?a.x:s.x,ze=a.y<s.y?a.y:s.y,ge=a.x>s.x?a.x:s.x,Bt=a.y>s.y?a.y:s.y,Ur=o>Y?o:Y,kn=C<ge?C:ge,Io=x>ze?x:ze,rl=P<Bt?P:Bt,Co=(Ur+kn)/2,as=(Io+rl)/2;f.x=Co,f.y=as,r.x-=f.x,r.y-=f.y,n.x-=f.x,n.y-=f.y,a.x-=f.x,a.y-=f.y,s.x-=f.x,s.y-=f.y},t.prototype.computeIntersect=function(r,n,a,s){if(this._isProper=!1,!T.intersects(r,n,a,s))return e.NO_INTERSECTION;var f=O.orientationIndex(r,n,a),o=O.orientationIndex(r,n,s);if(f>0&&o>0||f<0&&o<0)return e.NO_INTERSECTION;var x=O.orientationIndex(a,s,r),C=O.orientationIndex(a,s,n);if(x>0&&C>0||x<0&&C<0)return e.NO_INTERSECTION;var P=f===0&&o===0&&x===0&&C===0;return P?this.computeCollinearIntersection(r,n,a,s):(f===0||o===0||x===0||C===0?(this._isProper=!1,r.equals2D(a)||r.equals2D(s)?this._intPt[0]=r:n.equals2D(a)||n.equals2D(s)?this._intPt[0]=n:f===0?this._intPt[0]=new v(a):o===0?this._intPt[0]=new v(s):x===0?this._intPt[0]=new v(r):C===0&&(this._intPt[0]=new v(n))):(this._isProper=!0,this._intPt[0]=this.intersection(r,n,a,s)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(r,n,a,s){var f=r,o=O.distancePointLine(r,a,s),x=O.distancePointLine(n,a,s);return x<o&&(o=x,f=n),x=O.distancePointLine(a,r,n),x<o&&(o=x,f=a),x=O.distancePointLine(s,r,n),x<o&&(o=x,f=s),f},t}(ft),Kr=function(){};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};Kr.orientationIndex=function(e,t,r){var n=t.x-e.x,a=t.y-e.y,s=r.x-t.x,f=r.y-t.y;return Kr.signOfDet2x2(n,a,s,f)};Kr.signOfDet2x2=function(e,t,r,n){var a=null,s=null,f=null;if(a=1,e===0||n===0)return t===0||r===0?0:t>0?r>0?-a:a:r>0?a:-a;if(t===0||r===0)return n>0?e>0?a:-a:e>0?-a:a;if(t>0?n>0?t<=n||(a=-a,s=e,e=r,r=s,s=t,t=n,n=s):t<=-n?(a=-a,r=-r,n=-n):(s=e,e=-r,r=s,s=t,t=-n,n=s):n>0?-t<=n?(a=-a,e=-e,t=-t):(s=-e,e=r,r=s,s=-t,t=n,n=s):t>=n?(e=-e,t=-t,r=-r,n=-n):(a=-a,s=-e,e=-r,r=s,s=-t,t=-n,n=s),e>0)if(r>0){if(!(e<=r))return a}else return a;else{if(r>0)return-a;if(e>=r)a=-a,e=-e,r=-r;else return-a}for(;;){if(f=Math.floor(r/e),r=r-f*e,n=n-f*t,n<0)return-a;if(n>t)return a;if(e>r+r){if(t<n+n)return a}else{if(t>n+n)return-a;r=e-r,n=t-n,a=-a}if(n===0)return r===0?0:-a;if(r===0||(f=Math.floor(e/r),e=e-f*r,t=t-f*n,t<0))return a;if(t>n)return-a;if(r>e+e){if(n<t+t)return-a}else{if(n>t+t)return a;e=r-e,t=n-t,a=-a}if(t===0)return e===0?0:a;if(e===0)return-a}};var rn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};rn.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var r=e.x,n=t.x;return r>n&&(r=t.x,n=e.x),this._p.x>=r&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var a=e.x-this._p.x,s=e.y-this._p.y,f=t.x-this._p.x,o=t.y-this._p.y,x=Kr.signOfDet2x2(a,s,f,o);if(x===0)return this._isPointOnSegment=!0,null;o<s&&(x=-x),x>0&&this._crossingCount++}};rn.prototype.isPointInPolygon=function(){return this.getLocation()!==m.EXTERIOR};rn.prototype.getLocation=function(){return this._isPointOnSegment?m.BOUNDARY:this._crossingCount%2===1?m.INTERIOR:m.EXTERIOR};rn.prototype.isOnSegment=function(){return this._isPointOnSegment};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.locatePointInRing=function(){if(arguments[0]instanceof v&&G(arguments[1],Q)){for(var e=arguments[0],t=arguments[1],r=new rn(e),n=new v,a=new v,s=1;s<t.size();s++)if(t.getCoordinate(s,n),t.getCoordinate(s-1,a),r.countSegment(n,a),r.isOnSegment())return r.getLocation();return r.getLocation()}else if(arguments[0]instanceof v&&arguments[1]instanceof Array){for(var f=arguments[0],o=arguments[1],x=new rn(f),C=1;C<o.length;C++){var P=o[C],Y=o[C-1];if(x.countSegment(P,Y),x.isOnSegment())return x.getLocation()}return x.getLocation()}};var O=function(){},ui={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};O.prototype.interfaces_=function(){return[]};O.prototype.getClass=function(){return O};O.orientationIndex=function(e,t,r){return ue.orientationIndex(e,t,r)};O.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,r=e[0].x,n=1;n<e.length-1;n++){var a=e[n].x-r,s=e[n+1].y,f=e[n-1].y;t+=a*(f-s)}return t/2}else if(G(arguments[0],Q)){var o=arguments[0],x=o.size();if(x<3)return 0;var C=new v,P=new v,Y=new v;o.getCoordinate(0,P),o.getCoordinate(1,Y);var ze=P.x;Y.x-=ze;for(var ge=0,Bt=1;Bt<x-1;Bt++)C.y=P.y,P.x=Y.x,P.y=Y.y,o.getCoordinate(Bt+1,Y),Y.x-=ze,ge+=P.x*(C.y-Y.y);return ge/2}};O.distanceLineLine=function(e,t,r,n){if(e.equals(t))return O.distancePointLine(e,r,n);if(r.equals(n))return O.distancePointLine(n,e,t);var a=!1;if(!T.intersects(e,t,r,n))a=!0;else{var s=(t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x);if(s===0)a=!0;else{var f=(e.y-r.y)*(n.x-r.x)-(e.x-r.x)*(n.y-r.y),o=(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y),x=o/s,C=f/s;(C<0||C>1||x<0||x>1)&&(a=!0)}}return a?xe.min(O.distancePointLine(e,r,n),O.distancePointLine(t,r,n),O.distancePointLine(r,e,t),O.distancePointLine(n,e,t)):0};O.isPointInRing=function(e,t){return O.locatePointInRing(e,t)!==m.EXTERIOR};O.computeLength=function(e){var t=e.size();if(t<=1)return 0;var r=0,n=new v;e.getCoordinate(0,n);for(var a=n.x,s=n.y,f=1;f<t;f++){e.getCoordinate(f,n);var o=n.x,x=n.y,C=o-a,P=x-s;r+=Math.sqrt(C*C+P*P),a=o,s=x}return r};O.isCCW=function(e){var t=e.length-1;if(t<3)throw new ct("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=e[0],n=0,a=1;a<=t;a++){var s=e[a];s.y>r.y&&(r=s,n=a)}var f=n;do f=f-1,f<0&&(f=t);while(e[f].equals2D(r)&&f!==n);var o=n;do o=(o+1)%t;while(e[o].equals2D(r)&&o!==n);var x=e[f],C=e[o];if(x.equals2D(r)||C.equals2D(r)||x.equals2D(C))return!1;var P=O.computeOrientation(x,r,C),Y=!1;return P===0?Y=x.x>C.x:Y=P>0,Y};O.locatePointInRing=function(e,t){return rn.locatePointInRing(e,t)};O.distancePointLinePerpendicular=function(e,t,r){var n=(r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y),a=((t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y))/n;return Math.abs(a)*Math.sqrt(n)};O.computeOrientation=function(e,t,r){return O.orientationIndex(e,t,r)};O.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new ct("Line array must contain at least one vertex");for(var r=e.distance(t[0]),n=0;n<t.length-1;n++){var a=O.distancePointLine(e,t[n],t[n+1]);a<r&&(r=a)}return r}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];if(f.x===o.x&&f.y===o.y)return s.distance(f);var x=(o.x-f.x)*(o.x-f.x)+(o.y-f.y)*(o.y-f.y),C=((s.x-f.x)*(o.x-f.x)+(s.y-f.y)*(o.y-f.y))/x;if(C<=0)return s.distance(f);if(C>=1)return s.distance(o);var P=((f.y-s.y)*(o.x-f.x)-(f.x-s.x)*(o.y-f.y))/x;return Math.abs(P)*Math.sqrt(x)}};O.isOnLine=function(e,t){for(var r=new zr,n=1;n<t.length;n++){var a=t[n-1],s=t[n];if(r.computeIntersection(e,a,s),r.hasIntersection())return!0}return!1};ui.CLOCKWISE.get=function(){return-1};ui.RIGHT.get=function(){return O.CLOCKWISE};ui.COUNTERCLOCKWISE.get=function(){return 1};ui.LEFT.get=function(){return O.COUNTERCLOCKWISE};ui.COLLINEAR.get=function(){return 0};ui.STRAIGHT.get=function(){return O.COLLINEAR};Object.defineProperties(O,ui);var Qn=function(){};Qn.prototype.filter=function(e){};Qn.prototype.interfaces_=function(){return[]};Qn.prototype.getClass=function(){return Qn};var k=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},An={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};k.prototype.isGeometryCollection=function(){return this.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION};k.prototype.getFactory=function(){return this._factory};k.prototype.getGeometryN=function(e){return this};k.prototype.getArea=function(){return 0};k.prototype.isRectangle=function(){return!1};k.prototype.equals=function(){if(arguments[0]instanceof k){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof k))return!1;var r=t;return this.equalsExact(r)}};k.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};k.prototype.geometryChanged=function(){this.apply(k.geometryChangedFilter)};k.prototype.geometryChangedAction=function(){this._envelope=null};k.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};k.prototype.getLength=function(){return 0};k.prototype.getNumGeometries=function(){return 1};k.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}};k.prototype.getUserData=function(){return this._userData};k.prototype.getSRID=function(){return this._SRID};k.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};k.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION)throw new ct("This method does not support GeometryCollection arguments")};k.prototype.equal=function(e,t,r){return r===0?e.equals(t):e.distance(t)<=r};k.prototype.norm=function(){var e=this.copy();return e.normalize(),e};k.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};k.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new T(this._envelope)};k.prototype.setSRID=function(e){this._SRID=e};k.prototype.setUserData=function(e){this._userData=e};k.prototype.compare=function(e,t){for(var r=e.iterator(),n=t.iterator();r.hasNext()&&n.hasNext();){var a=r.next(),s=n.next(),f=a.compareTo(s);if(f!==0)return f}return r.hasNext()?1:n.hasNext()?-1:0};k.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};k.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===k.SORTINDEX_MULTIPOINT||this.getSortIndex()===k.SORTINDEX_MULTILINESTRING||this.getSortIndex()===k.SORTINDEX_MULTIPOLYGON};k.prototype.interfaces_=function(){return[jo,ke,Ge]};k.prototype.getClass=function(){return k};k.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};k.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};An.serialVersionUID.get=function(){return 8763622679187377e3};An.SORTINDEX_POINT.get=function(){return 0};An.SORTINDEX_MULTIPOINT.get=function(){return 1};An.SORTINDEX_LINESTRING.get=function(){return 2};An.SORTINDEX_LINEARRING.get=function(){return 3};An.SORTINDEX_MULTILINESTRING.get=function(){return 4};An.SORTINDEX_POLYGON.get=function(){return 5};An.SORTINDEX_MULTIPOLYGON.get=function(){return 6};An.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};An.geometryChangedFilter.get=function(){return As};Object.defineProperties(k,An);var As=function(){};As.interfaces_=function(){return[Qn]};As.filter=function(e){e.geometryChangedAction()};var wn=function(){};wn.prototype.filter=function(e){};wn.prototype.interfaces_=function(){return[]};wn.prototype.getClass=function(){return wn};var Me=function(){},er={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Me.prototype.isInBoundary=function(e){};Me.prototype.interfaces_=function(){return[]};Me.prototype.getClass=function(){return Me};er.Mod2BoundaryNodeRule.get=function(){return mi};er.EndPointBoundaryNodeRule.get=function(){return _i};er.MultiValentEndPointBoundaryNodeRule.get=function(){return Ei};er.MonoValentEndPointBoundaryNodeRule.get=function(){return Ii};er.MOD2_BOUNDARY_RULE.get=function(){return new mi};er.ENDPOINT_BOUNDARY_RULE.get=function(){return new _i};er.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ei};er.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ii};er.OGC_SFS_BOUNDARY_RULE.get=function(){return Me.MOD2_BOUNDARY_RULE};Object.defineProperties(Me,er);var mi=function(){};mi.prototype.isInBoundary=function(e){return e%2===1};mi.prototype.interfaces_=function(){return[Me]};mi.prototype.getClass=function(){return mi};var _i=function(){};_i.prototype.isInBoundary=function(e){return e>0};_i.prototype.interfaces_=function(){return[Me]};_i.prototype.getClass=function(){return _i};var Ei=function(){};Ei.prototype.isInBoundary=function(e){return e>1};Ei.prototype.interfaces_=function(){return[Me]};Ei.prototype.getClass=function(){return Ei};var Ii=function(){};Ii.prototype.isInBoundary=function(e){return e===1};Ii.prototype.interfaces_=function(){return[Me]};Ii.prototype.getClass=function(){return Ii};var wt=function(){};wt.prototype.add=function(){};wt.prototype.addAll=function(){};wt.prototype.isEmpty=function(){};wt.prototype.iterator=function(){};wt.prototype.size=function(){};wt.prototype.toArray=function(){};wt.prototype.remove=function(){};function Fs(e){this.message=e||""}Fs.prototype=new Error;Fs.prototype.name="IndexOutOfBoundsException";var Gi=function(){};Gi.prototype.hasNext=function(){};Gi.prototype.next=function(){};Gi.prototype.remove=function(){};var Ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(wt);function zi(e){this.message=e||""}zi.prototype=new Error;zi.prototype.name="NoSuchElementException";var b=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,wt]},t.prototype.add=function(r){return arguments.length===1?this.array_.push(r):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(r){for(var n=this,a=r.iterator();a.hasNext();)n.add(a.next());return!0},t.prototype.set=function(r,n){var a=this.array_[r];return this.array_[r]=n,a},t.prototype.iterator=function(){return new Cc(this)},t.prototype.get=function(r){if(r<0||r>=this.size())throw new Fs;return this.array_[r]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var r=this,n=[],a=0,s=this.array_.length;a<s;a++)n.push(r.array_[a]);return n},t.prototype.remove=function(r){for(var n=this,a=!1,s=0,f=this.array_.length;s<f;s++)if(n.array_[s]===r){n.array_.splice(s,1),a=!0;break}return a},t}(Ue),Cc=function(e){function t(r){e.call(this),this.arrayList_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new zi;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(r){return this.arrayList_.set(this.position_-1,r)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Gi),po=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(arguments.length===2){var a=arguments[0],s=arguments[1];this.ensureCapacity(a.length),this.add(a,s)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(n){return this.get(n)},t.prototype.addAll=function(){var n=this;if(arguments.length===2){for(var a=arguments[0],s=arguments[1],f=!1,o=a.iterator();o.hasNext();)n.add(o.next(),s),f=!0;return f}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var n=this,a=e.prototype.clone.call(this),s=0;s<this.size();s++)a.add(s,n.get(s).copy());return a},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var n=this;if(arguments.length===1){var a=arguments[0];e.prototype.add.call(this,a)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var s=arguments[0],f=arguments[1];return this.add(s,f,!0),!0}else if(arguments[0]instanceof v&&typeof arguments[1]=="boolean"){var o=arguments[0],x=arguments[1];if(!x&&this.size()>=1){var C=this.get(this.size()-1);if(C.equals2D(o))return null}e.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var P=arguments[0],Y=arguments[1];return this.add(P,Y),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var ze=arguments[0],ge=arguments[1],Bt=arguments[2];if(Bt)for(var Ur=0;Ur<ze.length;Ur++)n.add(ze[Ur],ge);else for(var kn=ze.length-1;kn>=0;kn--)n.add(ze[kn],ge);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof v){var Io=arguments[0],rl=arguments[1],Co=arguments[2];if(!Co){var as=this.size();if(as>0){if(Io>0){var $s=this.get(Io-1);if($s.equals2D(rl))return null}if(Io<as){var ah=this.get(Io);if(ah.equals2D(rl))return null}}}e.prototype.add.call(this,Io,rl)}}else if(arguments.length===4){var ch=arguments[0],Zu=arguments[1],ih=arguments[2],al=arguments[3],sh=1;ih>al&&(sh=-1);for(var _h=ih;_h!==al;_h+=sh)n.add(ch[_h],Zu);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new v(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,r),t}(b),W=function(){},Qo={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Qo.ForwardComparator.get=function(){return $i};Qo.BidirectionalComparator.get=function(){return Ci};Qo.coordArrayType.get=function(){return new Array(0).fill(null)};W.prototype.interfaces_=function(){return[]};W.prototype.getClass=function(){return W};W.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};W.ptNotInList=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(W.indexOf(n,t)<0)return n}return null};W.scroll=function(e,t){var r=W.indexOf(t,e);if(r<0)return null;var n=new Array(e.length).fill(null);Ut.arraycopy(e,r,n,0,e.length-r),Ut.arraycopy(e,0,n,e.length-r,r),Ut.arraycopy(n,0,e,0,e.length)};W.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].equals(t[r]))return!1;return!0}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];if(n===a)return!0;if(n===null||a===null||n.length!==a.length)return!1;for(var f=0;f<n.length;f++)if(s.compare(n[f],a[f])!==0)return!1;return!0}};W.intersection=function(e,t){for(var r=new po,n=0;n<e.length;n++)t.intersects(e[n])&&r.add(e[n],!0);return r.toCoordinateArray()};W.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};W.removeRepeatedPoints=function(e){if(!W.hasRepeatedPoints(e))return e;var t=new po(e,!1);return t.toCoordinateArray()};W.reverse=function(e){for(var t=e.length-1,r=Math.trunc(t/2),n=0;n<=r;n++){var a=e[n];e[n]=e[t-n],e[t-n]=a}};W.removeNull=function(e){for(var t=0,r=0;r<e.length;r++)e[r]!==null&&t++;var n=new Array(t).fill(null);if(t===0)return n;for(var a=0,s=0;s<e.length;s++)e[s]!==null&&(n[a++]=e[s]);return n};W.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),r=0;r<e.length;r++)t[r]=new v(e[r]);return t}else if(arguments.length===5)for(var n=arguments[0],a=arguments[1],s=arguments[2],f=arguments[3],o=arguments[4],x=0;x<o;x++)s[f+x]=new v(n[a+x])};W.isEqualReversed=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],a=t[e.length-r-1];if(n.compareTo(a)!==0)return!1}return!0};W.envelope=function(e){for(var t=new T,r=0;r<e.length;r++)t.expandToInclude(e[r]);return t};W.toCoordinateArray=function(e){return e.toArray(W.coordArrayType)};W.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};W.indexOf=function(e,t){for(var r=0;r<t.length;r++)if(e.equals(t[r]))return r;return-1};W.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var r=e.length-1-t,n=e[t].compareTo(e[r]);if(n!==0)return n}return 1};W.compare=function(e,t){for(var r=0;r<e.length&&r<t.length;){var n=e[r].compareTo(t[r]);if(n!==0)return n;r++}return r<t.length?-1:r<e.length?1:0};W.minCoordinate=function(e){for(var t=null,r=0;r<e.length;r++)(t===null||t.compareTo(e[r])>0)&&(t=e[r]);return t};W.extract=function(e,t,r){t=xe.clamp(t,0,e.length),r=xe.clamp(r,-1,e.length);var n=r-t+1;r<0&&(n=0),t>=e.length&&(n=0),r<t&&(n=0);var a=new Array(n).fill(null);if(n===0)return a;for(var s=0,f=t;f<=r;f++)a[s++]=e[f];return a};Object.defineProperties(W,Qo);var $i=function(){};$i.prototype.compare=function(e,t){var r=e,n=t;return W.compare(r,n)};$i.prototype.interfaces_=function(){return[vi]};$i.prototype.getClass=function(){return $i};var Ci=function(){};Ci.prototype.compare=function(e,t){var r=e,n=t;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(r.length===0)return 0;var a=W.compare(r,n),s=W.isEqualReversed(r,n);return s?0:a};Ci.prototype.OLDcompare=function(e,t){var r=e,n=t;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(r.length===0)return 0;for(var a=W.increasingDirection(r),s=W.increasingDirection(n),f=a>0?0:r.length-1,o=s>0?0:r.length-1,x=0;x<r.length;x++){var C=r[f].compareTo(n[o]);if(C!==0)return C;f+=a,o+=s}return 0};Ci.prototype.interfaces_=function(){return[vi]};Ci.prototype.getClass=function(){return Ci};var li=function(){};li.prototype.get=function(){};li.prototype.put=function(){};li.prototype.size=function(){};li.prototype.values=function(){};li.prototype.entrySet=function(){};var Nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(li);function vo(e){this.message=e||""}vo.prototype=new Error;vo.prototype.name="OperationNotSupported";function Jo(){}Jo.prototype=new wt;Jo.prototype.contains=function(){};var Bs=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(r){for(var n=this,a=0,s=this.array_.length;a<s;a++){var f=n.array_[a];if(f===r)return!0}return!1},t.prototype.add=function(r){return this.contains(r)?!1:(this.array_.push(r),!0)},t.prototype.addAll=function(r){for(var n=this,a=r.iterator();a.hasNext();)n.add(a.next());return!0},t.prototype.remove=function(r){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var r=this,n=[],a=0,s=this.array_.length;a<s;a++)n.push(r.array_[a]);return n},t.prototype.iterator=function(){return new xc(this)},t}(Jo),xc=function(e){function t(r){e.call(this),this.hashSet_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new zi;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new vo},t}(Gi),Yn=0,_r=1;function xa(e){return e===null?Yn:e.color}function st(e){return e===null?null:e.parent}function Vn(e,t){e!==null&&(e.color=t)}function ps(e){return e===null?null:e.left}function Sa(e){return e===null?null:e.right}function jt(){this.root_=null,this.size_=0}jt.prototype=new Nc;jt.prototype.get=function(e){for(var t=this.root_;t!==null;){var r=e.compareTo(t.key);if(r<0)t=t.left;else if(r>0)t=t.right;else return t.value}return null};jt.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:Yn,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r=this.root_,n,a;do if(n=r,a=e.compareTo(r.key),a<0)r=r.left;else if(a>0)r=r.right;else{var s=r.value;return r.value=t,s}while(r!==null);var f={key:e,left:null,right:null,value:t,parent:n,color:Yn,getValue:function(){return this.value},getKey:function(){return this.key}};return a<0?n.left=f:n.right=f,this.fixAfterInsertion(f),this.size_++,null};jt.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=_r;e!=null&&e!==this.root_&&e.parent.color===_r;)if(st(e)===ps(st(st(e)))){var r=Sa(st(st(e)));xa(r)===_r?(Vn(st(e),Yn),Vn(r,Yn),Vn(st(st(e)),_r),e=st(st(e))):(e===Sa(st(e))&&(e=st(e),t.rotateLeft(e)),Vn(st(e),Yn),Vn(st(st(e)),_r),t.rotateRight(st(st(e))))}else{var n=ps(st(st(e)));xa(n)===_r?(Vn(st(e),Yn),Vn(n,Yn),Vn(st(st(e)),_r),e=st(st(e))):(e===ps(st(e))&&(e=st(e),t.rotateRight(e)),Vn(st(e),Yn),Vn(st(st(e)),_r),t.rotateLeft(st(st(e))))}this.root_.color=Yn};jt.prototype.values=function(){var e=new b,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=jt.successor(t))!==null;)e.add(t.value);return e};jt.prototype.entrySet=function(){var e=new Bs,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=jt.successor(t))!==null;)e.add(t);return e};jt.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};jt.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};jt.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};jt.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var r=e.parent,n=e;r!==null&&n===r.right;)n=r,r=r.parent;return r}};jt.prototype.size=function(){return this.size_};var to=function(){};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};function hu(){}hu.prototype=new Jo;function an(){this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}an.prototype=new hu;an.prototype.contains=function(e){for(var t=this,r=0,n=this.array_.length;r<n;r++){var a=t.array_[r];if(a.compareTo(e)===0)return!0}return!1};an.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var r=0,n=this.array_.length;r<n;r++){var a=t.array_[r];if(a.compareTo(e)===1)return t.array_.splice(r,0,e),!0}return this.array_.push(e),!0};an.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next());return!0};an.prototype.remove=function(e){throw new vo};an.prototype.size=function(){return this.array_.length};an.prototype.isEmpty=function(){return this.array_.length===0};an.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};an.prototype.iterator=function(){return new Zo(this)};var Zo=function(e){this.treeSet_=e,this.position_=0};Zo.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new zi;return this.treeSet_.array_[this.position_++]};Zo.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Zo.prototype.remove=function(){throw new vo};var Nr=function(){};Nr.sort=function(){var e=arguments[0],t,r,n,a;if(arguments.length===1)a=function(f,o){return f.compareTo(o)},e.sort(a);else if(arguments.length===2)n=arguments[1],a=function(f,o){return n.compare(f,o)},e.sort(a);else if(arguments.length===3){r=e.slice(arguments[1],arguments[2]),r.sort();var s=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<s.length;t++)e.push(s[t])}else if(arguments.length===4)for(r=e.slice(arguments[1],arguments[2]),n=arguments[3],a=function(f,o){return n.compare(f,o)},r.sort(a),s=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<s.length;t++)e.push(s[t])};Nr.asList=function(e){for(var t=new b,r=0,n=e.length;r<n;r++)t.add(e[r]);return t};var J=function(){},Je={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Je.P.get=function(){return 0};Je.L.get=function(){return 1};Je.A.get=function(){return 2};Je.FALSE.get=function(){return-1};Je.TRUE.get=function(){return-2};Je.DONTCARE.get=function(){return-3};Je.SYM_FALSE.get=function(){return"F"};Je.SYM_TRUE.get=function(){return"T"};Je.SYM_DONTCARE.get=function(){return"*"};Je.SYM_P.get=function(){return"0"};Je.SYM_L.get=function(){return"1"};Je.SYM_A.get=function(){return"2"};J.prototype.interfaces_=function(){return[]};J.prototype.getClass=function(){return J};J.toDimensionSymbol=function(e){switch(e){case J.FALSE:return J.SYM_FALSE;case J.TRUE:return J.SYM_TRUE;case J.DONTCARE:return J.SYM_DONTCARE;case J.P:return J.SYM_P;case J.L:return J.SYM_L;case J.A:return J.SYM_A}throw new ct("Unknown dimension value: "+e)};J.toDimensionValue=function(e){switch(Zi.toUpperCase(e)){case J.SYM_FALSE:return J.FALSE;case J.SYM_TRUE:return J.TRUE;case J.SYM_DONTCARE:return J.DONTCARE;case J.SYM_P:return J.P;case J.SYM_L:return J.L;case J.SYM_A:return J.A}throw new ct("Unknown dimension symbol: "+e)};Object.defineProperties(J,Je);var un=function(){};un.prototype.filter=function(e){};un.prototype.interfaces_=function(){return[]};un.prototype.getClass=function(){return un};var Xe=function(){};Xe.prototype.filter=function(e,t){};Xe.prototype.isDone=function(){};Xe.prototype.isGeometryChanged=function(){};Xe.prototype.interfaces_=function(){return[]};Xe.prototype.getClass=function(){return Xe};var ne=function(e){function t(n,a){if(e.call(this,a),this._geometries=n||[],e.hasNullElements(this._geometries))throw new ct("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var n=this,a=new T,s=0;s<this._geometries.length;s++)a.expandToInclude(n._geometries[s].getEnvelopeInternal());return a},t.prototype.getGeometryN=function(n){return this._geometries[n]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var n=this,a=new Array(this.getNumPoints()).fill(null),s=-1,f=0;f<this._geometries.length;f++)for(var o=n._geometries[f].getCoordinates(),x=0;x<o.length;x++)s++,a[s]=o[x];return a},t.prototype.getArea=function(){for(var n=this,a=0,s=0;s<this._geometries.length;s++)a+=n._geometries[s].getArea();return a},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var a=arguments[0],s=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a;if(this._geometries.length!==f._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!n._geometries[o].equalsExact(f._geometries[o],s))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var n=this,a=0;a<this._geometries.length;a++)n._geometries[a].normalize();Nr.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var n=this,a=J.FALSE,s=0;s<this._geometries.length;s++)a=Math.max(a,n._geometries[s].getBoundaryDimension());return a},t.prototype.getDimension=function(){for(var n=this,a=J.FALSE,s=0;s<this._geometries.length;s++)a=Math.max(a,n._geometries[s].getDimension());return a},t.prototype.getLength=function(){for(var n=this,a=0,s=0;s<this._geometries.length;s++)a+=n._geometries[s].getLength();return a},t.prototype.getNumPoints=function(){for(var n=this,a=0,s=0;s<this._geometries.length;s++)a+=n._geometries[s].getNumPoints();return a},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var n=this,a=this._geometries.length,s=new Array(a).fill(null),f=0;f<this._geometries.length;f++)s[f]=n._geometries[f].reverse();return this.getFactory().createGeometryCollection(s)},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var a=arguments[0],s=new an(Nr.asList(this._geometries)),f=new an(Nr.asList(a._geometries));return this.compare(s,f)}else if(arguments.length===2){for(var o=arguments[0],x=arguments[1],C=o,P=this.getNumGeometries(),Y=C.getNumGeometries(),ze=0;ze<P&&ze<Y;){var ge=n.getGeometryN(ze),Bt=C.getGeometryN(ze),Ur=ge.compareToSameClass(Bt,x);if(Ur!==0)return Ur;ze++}return ze<P?1:ze<Y?-1:0}},t.prototype.apply=function(){var n=this;if(G(arguments[0],wn))for(var a=arguments[0],s=0;s<this._geometries.length;s++)n._geometries[s].apply(a);else if(G(arguments[0],Xe)){var f=arguments[0];if(this._geometries.length===0)return null;for(var o=0;o<this._geometries.length&&(n._geometries[o].apply(f),!f.isDone());o++);f.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var x=arguments[0];x.filter(this);for(var C=0;C<this._geometries.length;C++)n._geometries[C].apply(x)}else if(G(arguments[0],Qn)){var P=arguments[0];P.filter(this);for(var Y=0;Y<this._geometries.length;Y++)n._geometries[Y].apply(P)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),U.shouldNeverReachHere(),null},t.prototype.clone=function(){var n=this,a=e.prototype.clone.call(this);a._geometries=new Array(this._geometries.length).fill(null);for(var s=0;s<this._geometries.length;s++)a._geometries[s]=n._geometries[s].clone();return a},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.isEmpty=function(){for(var n=this,a=0;a<this._geometries.length;a++)if(!n._geometries[a].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,r),t}(k),Lr=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?J.FALSE:0},t.prototype.isClosed=function(){var n=this;if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!n._geometries[a].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var n=this,a=this._geometries.length,s=new Array(a).fill(null),f=0;f<this._geometries.length;f++)s[a-1-f]=n._geometries[f].reverse();return this.getFactory().createMultiLineString(s)},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,r),t}(ne),Oe=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=Me.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=n}};Oe.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};Oe.prototype.getBoundary=function(){return this._geom instanceof pt?this.boundaryLineString(this._geom):this._geom instanceof Lr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Oe.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};Oe.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Oe.prototype.computeBoundaryCoordinates=function(e){var t=this,r=new b;this._endpointMap=new jt;for(var n=0;n<e.getNumGeometries();n++){var a=e.getGeometryN(n);a.getNumPoints()!==0&&(t.addEndpoint(a.getCoordinateN(0)),t.addEndpoint(a.getCoordinateN(a.getNumPoints()-1)))}for(var s=this._endpointMap.entrySet().iterator();s.hasNext();){var f=s.next(),o=f.getValue(),x=o.count;t._bnRule.isInBoundary(x)&&r.add(f.getKey())}return W.toCoordinateArray(r)};Oe.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new ko,this._endpointMap.put(e,t)),t.count++};Oe.prototype.interfaces_=function(){return[]};Oe.prototype.getClass=function(){return Oe};Oe.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new Oe(e);return t.getBoundary()}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=new Oe(r,n);return a.getBoundary()}};var ko=function(){this.count=null};ko.prototype.interfaces_=function(){return[]};ko.prototype.getClass=function(){return ko};function Sc(){}function wc(){}var Lc=function(){};function bc(){}function Pc(){}function Rc(){}var De=function(){},ks={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};De.prototype.interfaces_=function(){return[]};De.prototype.getClass=function(){return De};De.chars=function(e,t){for(var r=new Array(t).fill(null),n=0;n<t;n++)r[n]=e;return String(r)};De.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new bc,r=new Sc;return e.printStackTrace(r),t.toString()}else if(arguments.length===2){var n=arguments[0],a=arguments[1],s="";new wc(De.getStackTrace(n));for(var f=new Rc,o=0;o<a;o++)try{s+=f.readLine()+De.NEWLINE}catch(x){if(x instanceof Pc)U.shouldNeverReachHere();else throw x}finally{}return s}};De.split=function(e,t){for(var r=t.length,n=new b,a=""+e,s=a.indexOf(t);s>=0;){var f=a.substring(0,s);n.add(f),a=a.substring(s+r),s=a.indexOf(t)}a.length>0&&n.add(a);for(var o=new Array(n.size()).fill(null),x=0;x<o.length;x++)o[x]=n.get(x);return o};De.toString=function(){if(arguments.length===1){var e=arguments[0];return De.SIMPLE_ORDINATE_FORMAT.format(e)}};De.spaces=function(e){return De.chars(" ",e)};ks.NEWLINE.get=function(){return Ut.getProperty("line.separator")};ks.SIMPLE_ORDINATE_FORMAT.get=function(){return new Lc};Object.defineProperties(De,ks);var Et=function(){};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.copyCoord=function(e,t,r,n){for(var a=Math.min(e.getDimension(),r.getDimension()),s=0;s<a;s++)r.setOrdinate(n,s,e.getOrdinate(t,s))};Et.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Q.X)===e.getOrdinate(t-1,Q.X)&&e.getOrdinate(0,Q.Y)===e.getOrdinate(t-1,Q.Y)};Et.isEqual=function(e,t){var r=e.size(),n=t.size();if(r!==n)return!1;for(var a=Math.min(e.getDimension(),t.getDimension()),s=0;s<r;s++)for(var f=0;f<a;f++){var o=e.getOrdinate(s,f),x=t.getOrdinate(s,f);if(e.getOrdinate(s,f)!==t.getOrdinate(s,f)&&!(z.isNaN(o)&&z.isNaN(x)))return!1}return!0};Et.extend=function(e,t,r){var n=e.create(r,t.getDimension()),a=t.size();if(Et.copy(t,0,n,0,a),a>0)for(var s=a;s<r;s++)Et.copy(t,a-1,n,s,1);return n};Et.reverse=function(e){for(var t=e.size()-1,r=Math.trunc(t/2),n=0;n<=r;n++)Et.swap(e,n,t-n)};Et.swap=function(e,t,r){if(t===r)return null;for(var n=0;n<e.getDimension();n++){var a=e.getOrdinate(t,n);e.setOrdinate(t,n,e.getOrdinate(r,n)),e.setOrdinate(r,n,a)}};Et.copy=function(e,t,r,n,a){for(var s=0;s<a;s++)Et.copyCoord(e,t+s,r,n+s)};Et.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var r=e.getDimension(),n=new yn;n.append("(");for(var a=0;a<t;a++){a>0&&n.append(" ");for(var s=0;s<r;s++)s>0&&n.append(","),n.append(De.toString(e.getOrdinate(a,s)))}return n.append(")"),n.toString()}};Et.ensureValidRing=function(e,t){var r=t.size();if(r===0)return t;if(r<=3)return Et.createClosedRing(e,t,4);var n=t.getOrdinate(0,Q.X)===t.getOrdinate(r-1,Q.X)&&t.getOrdinate(0,Q.Y)===t.getOrdinate(r-1,Q.Y);return n?t:Et.createClosedRing(e,t,r+1)};Et.createClosedRing=function(e,t,r){var n=e.create(r,t.getDimension()),a=t.size();Et.copy(t,0,n,0,a);for(var s=a;s<r;s++)Et.copy(t,0,n,s,1);return n};var pt=function(e){function t(n,a){e.call(this,a),this._points=null,this.init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new T:this._points.expandEnvelope(new T)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var a=arguments[0],s=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a;if(this._points.size()!==f._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!n.equal(n._points.getCoordinate(o),f._points.getCoordinate(o),s))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var n=this,a=0;a<Math.trunc(this._points.size()/2);a++){var s=n._points.size()-1-a;if(!n._points.getCoordinate(a).equals(n._points.getCoordinate(s)))return n._points.getCoordinate(a).compareTo(n._points.getCoordinate(s))>0&&Et.reverse(n._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?J.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return O.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var n=this._points.copy();Et.reverse(n);var a=this.getFactory().createLineString(n);return a},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){for(var a=arguments[0],s=a,f=0,o=0;f<this._points.size()&&o<s._points.size();){var x=n._points.getCoordinate(f).compareTo(s._points.getCoordinate(o));if(x!==0)return x;f++,o++}return f<this._points.size()?1:o<s._points.size()?-1:0}else if(arguments.length===2){var C=arguments[0],P=arguments[1],Y=C;return P.compare(this._points,Y._points)}},t.prototype.apply=function(){var n=this;if(G(arguments[0],wn))for(var a=arguments[0],s=0;s<this._points.size();s++)a.filter(n._points.getCoordinate(s));else if(G(arguments[0],Xe)){var f=arguments[0];if(this._points.size()===0)return null;for(var o=0;o<this._points.size()&&(f.filter(n._points,o),!f.isDone());o++);f.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var x=arguments[0];x.filter(this)}else if(G(arguments[0],Qn)){var C=arguments[0];C.filter(this)}},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.isEquivalentClass=function(n){return n instanceof t},t.prototype.clone=function(){var n=e.prototype.clone.call(this);return n._points=this._points.clone(),n},t.prototype.getCoordinateN=function(n){return this._points.getCoordinate(n)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(n){if(n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),n.size()===1)throw new ct("Invalid number of points in LineString (found "+n.size()+" - must be 0 or >= 2)");this._points=n},t.prototype.isCoordinate=function(n){for(var a=this,s=0;s<this._points.size();s++)if(a._points.getCoordinate(s).equals(n))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(n){return this.getFactory().createPoint(this._points.getCoordinate(n))},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,r),t}(k),eo=function(){};eo.prototype.interfaces_=function(){return[]};eo.prototype.getClass=function(){return eo};var de=function(e){function t(n,a){e.call(this,a),this._coordinates=n||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new T;var n=new T;return n.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),n},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?this.isEmpty()&&n.isEmpty()?!0:this.isEmpty()!==n.isEmpty()?!1:this.equal(n.getCoordinate(),this.getCoordinate(),a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var n=arguments[0],a=n;return this.getCoordinate().compareTo(a.getCoordinate())}else if(arguments.length===2){var s=arguments[0],f=arguments[1],o=s;return f.compare(this._coordinates,o._coordinates)}},t.prototype.apply=function(){if(G(arguments[0],wn)){var n=arguments[0];if(this.isEmpty())return null;n.filter(this.getCoordinate())}else if(G(arguments[0],Xe)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var s=arguments[0];s.filter(this)}else if(G(arguments[0],Qn)){var f=arguments[0];f.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var n=e.prototype.clone.call(this);return n._coordinates=this._coordinates.clone(),n},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(n){n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),U.isTrue(n.size()<=1),this._coordinates=n},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[eo]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,r),t}(k),ur=function(){};ur.prototype.interfaces_=function(){return[]};ur.prototype.getClass=function(){return ur};var Rt=function(e){function t(n,a,s){if(e.call(this,s),this._shell=null,this._holes=null,n===null&&(n=this.getFactory().createLinearRing()),a===null&&(a=[]),e.hasNullElements(a))throw new ct("holes must not contain null elements");if(n.isEmpty()&&e.hasNonEmptyElements(a))throw new ct("shell is empty but holes are not");this._shell=n,this._holes=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var n=this;if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),s=-1,f=this._shell.getCoordinates(),o=0;o<f.length;o++)s++,a[s]=f[o];for(var x=0;x<this._holes.length;x++)for(var C=n._holes[x].getCoordinates(),P=0;P<C.length;P++)s++,a[s]=C[P];return a},t.prototype.getArea=function(){var n=this,a=0;a+=Math.abs(O.signedArea(this._shell.getCoordinateSequence()));for(var s=0;s<this._holes.length;s++)a-=Math.abs(O.signedArea(n._holes[s].getCoordinateSequence()));return a},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var n=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),s=0;s<5;s++){var f=n.getX(s);if(!(f===a.getMinX()||f===a.getMaxX()))return!1;var o=n.getY(s);if(!(o===a.getMinY()||o===a.getMaxY()))return!1}for(var x=n.getX(0),C=n.getY(0),P=1;P<=4;P++){var Y=n.getX(P),ze=n.getY(P),ge=Y!==x,Bt=ze!==C;if(ge===Bt)return!1;x=Y,C=ze}return!0},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var a=arguments[0],s=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a,o=this._shell,x=f._shell;if(!o.equalsExact(x,s)||this._holes.length!==f._holes.length)return!1;for(var C=0;C<this._holes.length;C++)if(!n._holes[C].equalsExact(f._holes[C],s))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var n=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var a=0;a<this._holes.length;a++)n.normalize(n._holes[a],!1);Nr.sort(this._holes)}else if(arguments.length===2){var s=arguments[0],f=arguments[1];if(s.isEmpty())return null;var o=new Array(s.getCoordinates().length-1).fill(null);Ut.arraycopy(s.getCoordinates(),0,o,0,o.length);var x=W.minCoordinate(s.getCoordinates());W.scroll(o,x),Ut.arraycopy(o,0,s.getCoordinates(),0,o.length),s.getCoordinates()[o.length]=o[0],O.isCCW(s.getCoordinates())===f&&W.reverse(s.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var n=this,a=0;a+=this._shell.getLength();for(var s=0;s<this._holes.length;s++)a+=n._holes[s].getLength();return a},t.prototype.getNumPoints=function(){for(var n=this,a=this._shell.getNumPoints(),s=0;s<this._holes.length;s++)a+=n._holes[s].getNumPoints();return a},t.prototype.reverse=function(){var n=this,a=this.copy();a._shell=this._shell.copy().reverse(),a._holes=new Array(this._holes.length).fill(null);for(var s=0;s<this._holes.length;s++)a._holes[s]=n._holes[s].copy().reverse();return a},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var a=arguments[0],s=this._shell,f=a._shell;return s.compareToSameClass(f)}else if(arguments.length===2){var o=arguments[0],x=arguments[1],C=o,P=this._shell,Y=C._shell,ze=P.compareToSameClass(Y,x);if(ze!==0)return ze;for(var ge=this.getNumInteriorRing(),Bt=C.getNumInteriorRing(),Ur=0;Ur<ge&&Ur<Bt;){var kn=n.getInteriorRingN(Ur),Io=C.getInteriorRingN(Ur),rl=kn.compareToSameClass(Io,x);if(rl!==0)return rl;Ur++}return Ur<ge?1:Ur<Bt?-1:0}},t.prototype.apply=function(n){var a=this;if(G(n,wn)){this._shell.apply(n);for(var s=0;s<this._holes.length;s++)a._holes[s].apply(n)}else if(G(n,Xe)){if(this._shell.apply(n),!n.isDone())for(var f=0;f<this._holes.length&&(a._holes[f].apply(n),!n.isDone());f++);n.isGeometryChanged()&&this.geometryChanged()}else if(G(n,un))n.filter(this);else if(G(n,Qn)){n.filter(this),this._shell.apply(n);for(var o=0;o<this._holes.length;o++)a._holes[o].apply(n)}},t.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var s=0;s<this._holes.length;s++)a[s+1]=n._holes[s];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)},t.prototype.clone=function(){var n=this,a=e.prototype.clone.call(this);a._shell=this._shell.clone(),a._holes=new Array(this._holes.length).fill(null);for(var s=0;s<this._holes.length;s++)a._holes[s]=n._holes[s].clone();return a},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var n=this,a=this._shell.copy(),s=new Array(this._holes.length).fill(null),f=0;f<s.length;f++)s[f]=n._holes[f].copy();return new t(a,s,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(n){return this._holes[n]},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,r),t}(k),Ni=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._geometries[n].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[eo]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,r),t}(ne),Ln=function(e){function t(n,a){n instanceof v&&a instanceof H&&(n=a.getCoordinateSequenceFactory().create(n)),e.call(this,n,a),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var n=this._points.copy();Et.reverse(n);var a=this.getFactory().createLinearRing(n);return a},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new ct("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new ct("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,r),t}(pt),xn=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var n=this,a=this._geometries.length,s=new Array(a).fill(null),f=0;f<this._geometries.length;f++)s[f]=n._geometries[f].reverse();return this.getFactory().createMultiPolygon(s)},t.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new b,s=0;s<this._geometries.length;s++)for(var f=n._geometries[s],o=f.getBoundary(),x=0;x<o.getNumGeometries();x++)a.add(o.getGeometryN(x));var C=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(C))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,r),t}(ne),Ae=function(e){this._factory=e||null,this._isUserDataCopied=!1},$o={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Ae.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Ae.prototype.edit=function(e,t){if(e===null)return null;var r=this.editInternal(e,t);return this._isUserDataCopied&&r.setUserData(e.getUserData()),r};Ae.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof ne?this.editGeometryCollection(e,t):e instanceof Rt?this.editPolygon(e,t):e instanceof de?t.edit(e,this._factory):e instanceof pt?t.edit(e,this._factory):(U.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Ae.prototype.editGeometryCollection=function(e,t){for(var r=this,n=t.edit(e,this._factory),a=new b,s=0;s<n.getNumGeometries();s++){var f=r.edit(n.getGeometryN(s),t);f===null||f.isEmpty()||a.add(f)}return n.getClass()===Ni?this._factory.createMultiPoint(a.toArray([])):n.getClass()===Lr?this._factory.createMultiLineString(a.toArray([])):n.getClass()===xn?this._factory.createMultiPolygon(a.toArray([])):this._factory.createGeometryCollection(a.toArray([]))};Ae.prototype.editPolygon=function(e,t){var r=this,n=t.edit(e,this._factory);if(n===null&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var a=this.edit(n.getExteriorRing(),t);if(a===null||a.isEmpty())return this._factory.createPolygon();for(var s=new b,f=0;f<n.getNumInteriorRing();f++){var o=r.edit(n.getInteriorRingN(f),t);o===null||o.isEmpty()||s.add(o)}return this._factory.createPolygon(a,s.toArray([]))};Ae.prototype.interfaces_=function(){return[]};Ae.prototype.getClass=function(){return Ae};Ae.GeometryEditorOperation=function(){};$o.NoOpGeometryOperation.get=function(){return no};$o.CoordinateOperation.get=function(){return ro};$o.CoordinateSequenceOperation.get=function(){return io};Object.defineProperties(Ae,$o);var no=function(){};no.prototype.edit=function(e,t){return e};no.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};no.prototype.getClass=function(){return no};var ro=function(){};ro.prototype.edit=function(e,t){var r=this.editCoordinates(e.getCoordinates(),e);return r===null?e:e instanceof Ln?t.createLinearRing(r):e instanceof pt?t.createLineString(r):e instanceof de?r.length>0?t.createPoint(r[0]):t.createPoint():e};ro.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};ro.prototype.getClass=function(){return ro};var io=function(){};io.prototype.edit=function(e,t){return e instanceof Ln?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof pt?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof de?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};io.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};io.prototype.getClass=function(){return io};var yt=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var r=0;r<t;r++)e._coordinates[r]=new v}else if(G(arguments[0],Q)){var n=arguments[0];if(n===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var a=0;a<this._coordinates.length;a++)e._coordinates[a]=n.getCoordinateCopy(a)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var s=arguments[0],f=arguments[1];this._coordinates=s,this._dimension=f,s===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],x=arguments[1];this._coordinates=new Array(o).fill(null),this._dimension=x;for(var C=0;C<o;C++)e._coordinates[C]=new v}}},gu={serialVersionUID:{configurable:!0}};yt.prototype.setOrdinate=function(e,t,r){switch(t){case Q.X:this._coordinates[e].x=r;break;case Q.Y:this._coordinates[e].y=r;break;case Q.Z:this._coordinates[e].z=r;break;default:throw new ct("invalid ordinateIndex")}};yt.prototype.size=function(){return this._coordinates.length};yt.prototype.getOrdinate=function(e,t){switch(t){case Q.X:return this._coordinates[e].x;case Q.Y:return this._coordinates[e].y;case Q.Z:return this._coordinates[e].z}return z.NaN};yt.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],r=arguments[1];r.x=this._coordinates[t].x,r.y=this._coordinates[t].y,r.z=this._coordinates[t].z}};yt.prototype.getCoordinateCopy=function(e){return new v(this._coordinates[e])};yt.prototype.getDimension=function(){return this._dimension};yt.prototype.getX=function(e){return this._coordinates[e].x};yt.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)t[r]=e._coordinates[r].clone();return new yt(t,this._dimension)};yt.prototype.expandEnvelope=function(e){for(var t=this,r=0;r<this._coordinates.length;r++)e.expandToInclude(t._coordinates[r]);return e};yt.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)t[r]=e._coordinates[r].copy();return new yt(t,this._dimension)};yt.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new yn(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)t.append(", "),t.append(e._coordinates[r]);return t.append(")"),t.toString()}else return"()"};yt.prototype.getY=function(e){return this._coordinates[e].y};yt.prototype.toCoordinateArray=function(){return this._coordinates};yt.prototype.interfaces_=function(){return[Q,Ge]};yt.prototype.getClass=function(){return yt};gu.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(yt,gu);var bn=function(){},Gs={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};bn.prototype.readResolve=function(){return bn.instance()};bn.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new yt(e)}else if(G(arguments[0],Q)){var t=arguments[0];return new yt(t)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new yt(r):new yt(r,n)}};bn.prototype.interfaces_=function(){return[yi,Ge]};bn.prototype.getClass=function(){return bn};bn.instance=function(){return bn.instanceObject};Gs.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Gs.instanceObject.get=function(){return new bn};Object.defineProperties(bn,Gs);var pu=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(r){return this.map_.get(r)||null},t.prototype.put=function(r,n){return this.map_.set(r,n),n},t.prototype.values=function(){for(var r=new b,n=this.map_.values(),a=n.next();!a.done;)r.add(a.value),a=n.next();return r},t.prototype.entrySet=function(){var r=new Bs;return this.map_.entries().forEach(function(n){return r.add(n)}),r},t.prototype.size=function(){return this.map_.size()},t}(li),$=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ln){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var r=arguments[0];this._modelType=e.FIXED,this.setScale(r)}else if(arguments[0]instanceof e){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}},zs={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};$.prototype.equals=function(e){if(!(e instanceof $))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};$.prototype.compareTo=function(e){var t=e,r=this.getMaximumSignificantDigits(),n=t.getMaximumSignificantDigits();return new sn(r).compareTo(new sn(n))};$.prototype.getScale=function(){return this._scale};$.prototype.isFloating=function(){return this._modelType===$.FLOATING||this._modelType===$.FLOATING_SINGLE};$.prototype.getType=function(){return this._modelType};$.prototype.toString=function(){var e="UNKNOWN";return this._modelType===$.FLOATING?e="Floating":this._modelType===$.FLOATING_SINGLE?e="Floating-Single":this._modelType===$.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};$.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(z.isNaN(e))return e;if(this._modelType===$.FLOATING_SINGLE){var t=e;return t}return this._modelType===$.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof v){var r=arguments[0];if(this._modelType===$.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}};$.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===$.FLOATING?e=16:this._modelType===$.FLOATING_SINGLE?e=6:this._modelType===$.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};$.prototype.setScale=function(e){this._scale=Math.abs(e)};$.prototype.interfaces_=function(){return[Ge,ke]};$.prototype.getClass=function(){return $};$.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};zs.serialVersionUID.get=function(){return 7777263578777804e3};zs.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties($,zs);var ln=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Vs={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};ln.prototype.readResolve=function(){return ln.nameToTypeMap.get(this._name)};ln.prototype.toString=function(){return this._name};ln.prototype.interfaces_=function(){return[Ge]};ln.prototype.getClass=function(){return ln};Vs.serialVersionUID.get=function(){return-552860263173159e4};Vs.nameToTypeMap.get=function(){return new pu};Object.defineProperties(ln,Vs);$.Type=ln;$.FIXED=new ln("FIXED");$.FLOATING=new ln("FLOATING");$.FLOATING_SINGLE=new ln("FLOATING SINGLE");var H=function e(){this._precisionModel=new $,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?G(arguments[0],yi)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof $&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},du={serialVersionUID:{configurable:!0}};H.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new v(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new v(e.getMinX(),e.getMinY()),new v(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new v(e.getMinX(),e.getMinY()),new v(e.getMinX(),e.getMaxY()),new v(e.getMaxX(),e.getMaxY()),new v(e.getMaxX(),e.getMinY()),new v(e.getMinX(),e.getMinY())]),null)};H.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new pt(this.getCoordinateSequenceFactory().create(e),this);if(G(e,Q))return new pt(e,this)}else return new pt(this.getCoordinateSequenceFactory().create([]),this)};H.prototype.createMultiLineString=function(){if(arguments.length===0)return new Lr(null,this);if(arguments.length===1){var e=arguments[0];return new Lr(e,this)}};H.prototype.buildGeometry=function(e){for(var t=null,r=!1,n=!1,a=e.iterator();a.hasNext();){var s=a.next(),f=s.getClass();t===null&&(t=f),f!==t&&(r=!0),s.isGeometryCollectionOrDerived()&&(n=!0)}if(t===null)return this.createGeometryCollection();if(r||n)return this.createGeometryCollection(H.toGeometryArray(e));var o=e.iterator().next(),x=e.size()>1;if(x){if(o instanceof Rt)return this.createMultiPolygon(H.toPolygonArray(e));if(o instanceof pt)return this.createMultiLineString(H.toLineStringArray(e));if(o instanceof de)return this.createMultiPoint(H.toPointArray(e));U.shouldNeverReachHere("Unhandled class: "+o.getClass().getName())}return o};H.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};H.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(G(arguments[0],Q)){var t=arguments[0];return new de(t,this)}}};H.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};H.prototype.createPolygon=function(){if(arguments.length===0)return new Rt(null,null,this);if(arguments.length===1){if(G(arguments[0],Q)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Ln){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var n=arguments[0],a=arguments[1];return new Rt(n,a,this)}};H.prototype.getSRID=function(){return this._SRID};H.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ne(null,this);if(arguments.length===1){var e=arguments[0];return new ne(e,this)}};H.prototype.createGeometry=function(e){var t=new Ae(this);return t.edit(e,{edit:function(){if(arguments.length===2){var r=arguments[0];return this._coordinateSequenceFactory.create(r)}}})};H.prototype.getPrecisionModel=function(){return this._precisionModel};H.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(G(arguments[0],Q)){var t=arguments[0];return new Ln(t,this)}}};H.prototype.createMultiPolygon=function(){if(arguments.length===0)return new xn(null,this);if(arguments.length===1){var e=arguments[0];return new xn(e,this)}};H.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Ni(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Ni(t,this)}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(G(arguments[0],Q)){var n=arguments[0];if(n===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(n.size()).fill(null),s=0;s<n.size();s++){var f=e.getCoordinateSequenceFactory().create(1,n.getDimension());Et.copy(n,s,f,0,1),a[s]=e.createPoint(f)}return this.createMultiPoint(a)}}};H.prototype.interfaces_=function(){return[Ge]};H.prototype.getClass=function(){return H};H.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};H.getDefaultCoordinateSequenceFactory=function(){return bn.instance()};H.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};du.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(H,du);var Oc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ts=function(e){this.geometryFactory=e||new H};ts.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var r=t.type;if(!tn[r])throw new Error("Unknown GeoJSON type: "+t.type);return Oc.indexOf(r)!==-1?tn[r].apply(this,[t.coordinates]):r==="GeometryCollection"?tn[r].apply(this,[t.geometries]):tn[r].apply(this,[t])};ts.prototype.write=function(e){var t=e.getGeometryType();if(!qn[t])throw new Error("Geometry is not supported");return qn[t].apply(this,[e])};var tn={Feature:function(e){var t={};for(var r in e)t[r]=e[r];if(e.geometry){var n=e.geometry.type;if(!tn[n])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=tn.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,r={};if(e.features){r.features=[];for(var n=0;n<e.features.length;++n)r.features.push(t.read(e.features[n]))}return e.bbox&&(r.bbox=this.parse.bbox.apply(this,[e.bbox])),r},coordinates:function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];t.push(new v(n[0],n[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new v(e[0],e[1]),new v(e[2],e[1]),new v(e[2],e[3]),new v(e[0],e[3]),new v(e[0],e[1])])},Point:function(e){var t=new v(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(tn.Point.apply(t,[e[n]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(e){var t=tn.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(tn.LineString.apply(t,[e[n]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(e){for(var t=this,r=tn.coordinates.apply(this,[e[0]]),n=this.geometryFactory.createLinearRing(r),a=[],s=1;s<e.length;++s){var f=e[s],o=tn.coordinates.apply(t,[f]),x=t.geometryFactory.createLinearRing(o);a.push(x)}return this.geometryFactory.createPolygon(n,a)},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var a=e[n];r.push(tn.Polygon.apply(t,[a]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var a=e[n];r.push(t.read(a))}return this.geometryFactory.createGeometryCollection(r)}},qn={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=qn.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=qn.Point.apply(t,[a]);r.push(s.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(e){for(var t=this,r=[],n=e.getCoordinates(),a=0;a<n.length;++a){var s=n[a];r.push(qn.coordinate.apply(t,[s]))}return{type:"LineString",coordinates:r}},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=qn.LineString.apply(t,[a]);r.push(s.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(e){var t=this,r=[],n=qn.LineString.apply(this,[e._shell]);r.push(n.coordinates);for(var a=0;a<e._holes.length;++a){var s=e._holes[a],f=qn.LineString.apply(t,[s]);r.push(f.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=qn.Polygon.apply(t,[a]);r.push(s.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=a.getGeometryType();r.push(qn[s].apply(t,[a]))}return{type:"GeometryCollection",geometries:r}}},Us=function(e){this.geometryFactory=e||new H,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ts(this.geometryFactory)};Us.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===$.FIXED&&this.reducePrecision(t),t};Us.prototype.reducePrecision=function(e){var t=this,r,n;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(r=0,n=e.points.length;r<n;r++)t.precisionModel.makePrecise(e.points[r]);else if(e.geometries)for(r=0,n=e.geometries.length;r<n;r++)t.reducePrecision(e.geometries[r])};var vu=function(){this.parser=new ts(this.geometryFactory)};vu.prototype.write=function(e){return this.parser.write(e)};var w=function(){},es={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};w.prototype.interfaces_=function(){return[]};w.prototype.getClass=function(){return w};w.opposite=function(e){return e===w.LEFT?w.RIGHT:e===w.RIGHT?w.LEFT:e};es.ON.get=function(){return 0};es.LEFT.get=function(){return 1};es.RIGHT.get=function(){return 2};Object.defineProperties(w,es);function ns(e){this.message=e||""}ns.prototype=new Error;ns.prototype.name="EmptyStackException";function mn(){this.array_=[]}mn.prototype=new Ue;mn.prototype.add=function(e){return this.array_.push(e),!0};mn.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};mn.prototype.push=function(e){return this.array_.push(e),e};mn.prototype.pop=function(e){if(this.array_.length===0)throw new ns;return this.array_.pop()};mn.prototype.peek=function(){if(this.array_.length===0)throw new ns;return this.array_[this.array_.length-1]};mn.prototype.empty=function(){return this.array_.length===0};mn.prototype.isEmpty=function(){return this.empty()};mn.prototype.search=function(e){return this.array_.indexOf(e)};mn.prototype.size=function(){return this.array_.length};mn.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};var cn=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};cn.prototype.getCoordinate=function(){return this._minCoord};cn.prototype.getRightmostSide=function(e,t){var r=this.getRightmostSideOfSegment(e,t);return r<0&&(r=this.getRightmostSideOfSegment(e,t-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),r};cn.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();U.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],r=e[this._minIndex+1],n=O.computeOrientation(this._minCoord,r,t),a=!1;(t.y<this._minCoord.y&&r.y<this._minCoord.y&&n===O.COUNTERCLOCKWISE||t.y>this._minCoord.y&&r.y>this._minCoord.y&&n===O.CLOCKWISE)&&(a=!0),a&&(this._minIndex=this._minIndex-1)};cn.prototype.getRightmostSideOfSegment=function(e,t){var r=e.getEdge(),n=r.getCoordinates();if(t<0||t+1>=n.length||n[t].y===n[t+1].y)return-1;var a=w.LEFT;return n[t].y<n[t+1].y&&(a=w.RIGHT),a};cn.prototype.getEdge=function(){return this._orientedDe};cn.prototype.checkForRightmostCoordinate=function(e){for(var t=this,r=e.getEdge().getCoordinates(),n=0;n<r.length-1;n++)(t._minCoord===null||r[n].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=n,t._minCoord=r[n])};cn.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};cn.prototype.findEdge=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next();n.isForward()&&t.checkForRightmostCoordinate(n)}U.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var a=this.getRightmostSide(this._minDe,this._minIndex);a===w.LEFT&&(this._orientedDe=this._minDe.getSym())};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};var Jn=function(e){function t(r,n){e.call(this,t.msgWithCoord(r,n)),this.pt=n?new v(n):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(r,n){return n?r:r+" [ "+n+" ]"},t}(Kn),rs=function(){this.array_=[]};rs.prototype.addLast=function(e){this.array_.push(e)};rs.prototype.removeFirst=function(){return this.array_.shift()};rs.prototype.isEmpty=function(){return this.array_.length===0};var re=function(){this._finder=null,this._dirEdgeList=new b,this._nodes=new b,this._rightMostCoord=null,this._env=null,this._finder=new cn};re.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};re.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};re.prototype.computeNodeDepth=function(e){for(var t=this,r=null,n=e.getEdges().iterator();n.hasNext();){var a=n.next();if(a.isVisited()||a.getSym().isVisited()){r=a;break}}if(r===null)throw new Jn("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(r);for(var s=e.getEdges().iterator();s.hasNext();){var f=s.next();f.setVisited(!0),t.copySymDepths(f)}};re.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(w.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};re.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};re.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(w.RIGHT)>=1&&t.getDepth(w.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};re.prototype.computeDepths=function(e){var t=this,r=new Bs,n=new rs,a=e.getNode();for(n.addLast(a),r.add(a),e.setVisited(!0);!n.isEmpty();){var s=n.removeFirst();r.add(s),t.computeNodeDepth(s);for(var f=s.getEdges().iterator();f.hasNext();){var o=f.next(),x=o.getSym();if(!x.isVisited()){var C=x.getNode();r.contains(C)||(n.addLast(C),r.add(C))}}}};re.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};re.prototype.getEnvelope=function(){if(this._env===null){for(var e=new T,t=this._dirEdgeList.iterator();t.hasNext();)for(var r=t.next(),n=r.getEdge().getCoordinates(),a=0;a<n.length-1;a++)e.expandToInclude(n[a]);this._env=e}return this._env};re.prototype.addReachable=function(e){var t=this,r=new mn;for(r.add(e);!r.empty();){var n=r.pop();t.add(n,r)}};re.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(w.LEFT,e.getDepth(w.RIGHT)),t.setDepth(w.RIGHT,e.getDepth(w.LEFT))};re.prototype.add=function(e,t){var r=this;e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var a=n.next();r._dirEdgeList.add(a);var s=a.getSym(),f=s.getNode();f.isVisited()||t.push(f)}};re.prototype.getNodes=function(){return this._nodes};re.prototype.getDirectedEdges=function(){return this._dirEdgeList};re.prototype.interfaces_=function(){return[ke]};re.prototype.getClass=function(){return re};var at=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[w.ON]=n}else if(arguments[0]instanceof e){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var s=0;s<this.location.length;s++)t.location[s]=a.location[s]}}else if(arguments.length===3){var f=arguments[0],o=arguments[1],x=arguments[2];this.init(3),this.location[w.ON]=f,this.location[w.LEFT]=o,this.location[w.RIGHT]=x}};at.prototype.setAllLocations=function(e){for(var t=this,r=0;r<this.location.length;r++)t.location[r]=e};at.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==m.NONE)return!1;return!0};at.prototype.setAllLocationsIfNull=function(e){for(var t=this,r=0;r<this.location.length;r++)t.location[r]===m.NONE&&(t.location[r]=e)};at.prototype.isLine=function(){return this.location.length===1};at.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var r=new Array(3).fill(null);r[w.ON]=this.location[w.ON],r[w.LEFT]=m.NONE,r[w.RIGHT]=m.NONE,this.location=r}for(var n=0;n<this.location.length;n++)t.location[n]===m.NONE&&n<e.location.length&&(t.location[n]=e.location[n])};at.prototype.getLocations=function(){return this.location};at.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[w.LEFT];this.location[w.LEFT]=this.location[w.RIGHT],this.location[w.RIGHT]=e};at.prototype.toString=function(){var e=new yn;return this.location.length>1&&e.append(m.toLocationSymbol(this.location[w.LEFT])),e.append(m.toLocationSymbol(this.location[w.ON])),this.location.length>1&&e.append(m.toLocationSymbol(this.location[w.RIGHT])),e.toString()};at.prototype.setLocations=function(e,t,r){this.location[w.ON]=e,this.location[w.LEFT]=t,this.location[w.RIGHT]=r};at.prototype.get=function(e){return e<this.location.length?this.location[e]:m.NONE};at.prototype.isArea=function(){return this.location.length>1};at.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===m.NONE)return!0;return!1};at.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(w.ON,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.location[t]=r}};at.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(m.NONE)};at.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};at.prototype.allPositionsEqual=function(e){for(var t=this,r=0;r<this.location.length;r++)if(t.location[r]!==e)return!1;return!0};at.prototype.interfaces_=function(){return[]};at.prototype.getClass=function(){return at};var et=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new at(t),this.elt[1]=new at(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.elt[0]=new at(r.elt[0]),this.elt[1]=new at(r.elt[1])}}else if(arguments.length===2){var n=arguments[0],a=arguments[1];this.elt[0]=new at(m.NONE),this.elt[1]=new at(m.NONE),this.elt[n].setLocation(a)}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];this.elt[0]=new at(s,f,o),this.elt[1]=new at(s,f,o)}else if(arguments.length===4){var x=arguments[0],C=arguments[1],P=arguments[2],Y=arguments[3];this.elt[0]=new at(m.NONE,m.NONE,m.NONE),this.elt[1]=new at(m.NONE,m.NONE,m.NONE),this.elt[x].setLocations(C,P,Y)}};et.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};et.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};et.prototype.isNull=function(e){return this.elt[e].isNull()};et.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.elt[t].setAllLocationsIfNull(r)}};et.prototype.isLine=function(e){return this.elt[e].isLine()};et.prototype.merge=function(e){for(var t=this,r=0;r<2;r++)t.elt[r]===null&&e.elt[r]!==null?t.elt[r]=new at(e.elt[r]):t.elt[r].merge(e.elt[r])};et.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};et.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(w.ON)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return this.elt[t].get(r)}};et.prototype.toString=function(){var e=new yn;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};et.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};et.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};et.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(w.ON,t)}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this.elt[r].setLocation(n,a)}};et.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};et.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};et.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new at(this.elt[e].location[0]))};et.prototype.interfaces_=function(){return[]};et.prototype.getClass=function(){return et};et.toLineLabel=function(e){for(var t=new et(m.NONE),r=0;r<2;r++)t.setLocation(r,e.getLocation(r));return t};var xt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new b,this._pts=new b,this._label=new et(m.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new b,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};xt.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)t[r]=e._pts.get(r);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=O.isCCW(this._ring.getCoordinates())};xt.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};xt.prototype.computePoints=function(e){var t=this;this._startDe=e;var r=e,n=!0;do{if(r===null)throw new Jn("Found null DirectedEdge");if(r.getEdgeRing()===t)throw new Jn("Directed Edge visited twice during ring-building at "+r.getCoordinate());t._edges.add(r);var a=r.getLabel();U.isTrue(a.isArea()),t.mergeLabel(a),t.addPoints(r.getEdge(),r.isForward(),n),n=!1,t.setEdgeRing(r,t),r=t.getNext(r)}while(r!==this._startDe)};xt.prototype.getLinearRing=function(){return this._ring};xt.prototype.getCoordinate=function(e){return this._pts.get(e)};xt.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var r=t.getNode(),n=r.getEdges().getOutgoingDegree(e);n>e._maxNodeDegree&&(e._maxNodeDegree=n),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};xt.prototype.addPoints=function(e,t,r){var n=this,a=e.getCoordinates();if(t){var s=1;r&&(s=0);for(var f=s;f<a.length;f++)n._pts.add(a[f])}else{var o=a.length-2;r&&(o=a.length-1);for(var x=o;x>=0;x--)n._pts.add(a[x])}};xt.prototype.isHole=function(){return this._isHole};xt.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};xt.prototype.containsPoint=function(e){var t=this.getLinearRing(),r=t.getEnvelopeInternal();if(!r.contains(e)||!O.isPointInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){var a=n.next();if(a.containsPoint(e))return!1}return!0};xt.prototype.addHole=function(e){this._holes.add(e)};xt.prototype.isShell=function(){return this._shell===null};xt.prototype.getLabel=function(){return this._label};xt.prototype.getEdges=function(){return this._edges};xt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};xt.prototype.getShell=function(){return this._shell};xt.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=t.getLocation(r,w.RIGHT);if(n===m.NONE)return null;if(this._label.getLocation(r)===m.NONE)return this._label.setLocation(r,n),null}};xt.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};xt.prototype.toPolygon=function(e){for(var t=this,r=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)r[n]=t._holes.get(n).getLinearRing();var a=e.createPolygon(this.getLinearRing(),r);return a};xt.prototype.interfaces_=function(){return[]};xt.prototype.getClass=function(){return xt};var Dc=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(r,n){r.setMinEdgeRing(n)},t.prototype.getNext=function(r){return r.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xt),Tc=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var r=this,n=new b,a=this._startDe;do{if(a.getMinEdgeRing()===null){var s=new Dc(a,r._geometryFactory);n.add(s)}a=a.getNext()}while(a!==this._startDe);return n},t.prototype.setEdgeRing=function(r,n){r.setEdgeRing(n)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=this,n=this._startDe;do{var a=n.getNode();a.getEdges().linkMinimalDirectedEdges(r),n=n.getNext()}while(n!==this._startDe)},t.prototype.getNext=function(r){return r.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xt),Se=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Se.prototype.setVisited=function(e){this._isVisited=e};Se.prototype.setInResult=function(e){this._isInResult=e};Se.prototype.isCovered=function(){return this._isCovered};Se.prototype.isCoveredSet=function(){return this._isCoveredSet};Se.prototype.setLabel=function(e){this._label=e};Se.prototype.getLabel=function(){return this._label};Se.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Se.prototype.updateIM=function(e){U.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Se.prototype.isInResult=function(){return this._isInResult};Se.prototype.isVisited=function(){return this._isVisited};Se.prototype.interfaces_=function(){return[]};Se.prototype.getClass=function(){return Se};var is=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var r=arguments[0],n=arguments[1];this._coord=r,this._edges=n,this._label=new et(0,m.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();){var n=r.next();if(n.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(r){},t.prototype.computeMergedLocation=function(r,n){var a=m.NONE;if(a=this._label.getLocation(n),!r.isNull(n)){var s=r.getLocation(n);a!==m.BOUNDARY&&(a=s)}return a},t.prototype.setLabel=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];this._label===null?this._label=new et(r,n):this._label.setLocation(r,n)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var r=this;if(arguments[0]instanceof t){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof et)for(var a=arguments[0],s=0;s<2;s++){var f=r.computeMergedLocation(a,s),o=r._label.getLocation(s);o===m.NONE&&r._label.setLocation(s,f)}},t.prototype.add=function(r){this._edges.insert(r),r.setNode(this)},t.prototype.setLabelBoundary=function(r){if(this._label===null)return null;var n=m.NONE;this._label!==null&&(n=this._label.getLocation(r));var a=null;switch(n){case m.BOUNDARY:a=m.INTERIOR;break;case m.INTERIOR:a=m.BOUNDARY;break;default:a=m.BOUNDARY;break}this._label.setLocation(r,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Se),fn=function(){this.nodeMap=new jt,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};fn.prototype.find=function(e){return this.nodeMap.get(e)};fn.prototype.addNode=function(){if(arguments[0]instanceof v){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof is){var r=arguments[0],n=this.nodeMap.get(r.getCoordinate());return n===null?(this.nodeMap.put(r.getCoordinate(),r),r):(n.mergeLabel(r),n)}};fn.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};fn.prototype.iterator=function(){return this.nodeMap.values().iterator()};fn.prototype.values=function(){return this.nodeMap.values()};fn.prototype.getBoundaryNodes=function(e){for(var t=new b,r=this.iterator();r.hasNext();){var n=r.next();n.getLabel().getLocation(e)===m.BOUNDARY&&t.add(n)}return t};fn.prototype.add=function(e){var t=e.getCoordinate(),r=this.addNode(t);r.add(e)};fn.prototype.interfaces_=function(){return[]};fn.prototype.getClass=function(){return fn};var it=function(){},yo={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};it.prototype.interfaces_=function(){return[]};it.prototype.getClass=function(){return it};it.isNorthern=function(e){return e===it.NE||e===it.NW};it.isOpposite=function(e,t){if(e===t)return!1;var r=(e-t+4)%4;return r===2};it.commonHalfPlane=function(e,t){if(e===t)return e;var r=(e-t+4)%4;if(r===2)return-1;var n=e<t?e:t,a=e>t?e:t;return n===0&&a===3?3:n};it.isInHalfPlane=function(e,t){return t===it.SE?e===it.SE||e===it.SW:e===t||e===t+1};it.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new ct("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?it.NE:it.SE:t>=0?it.NW:it.SW}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var r=arguments[0],n=arguments[1];if(n.x===r.x&&n.y===r.y)throw new ct("Cannot compute the quadrant for two identical points "+r);return n.x>=r.x?n.y>=r.y?it.NE:it.SE:n.y>=r.y?it.NW:it.SW}};yo.NE.get=function(){return 0};yo.NW.get=function(){return 1};yo.SW.get=function(){return 2};yo.SE.get=function(){return 3};Object.defineProperties(it,yo);var Kt=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],a=null;this._edge=t,this.init(r,n),this._label=a}else if(arguments.length===4){var s=arguments[0],f=arguments[1],o=arguments[2],x=arguments[3];this._edge=s,this.init(f,o),this._label=x}};Kt.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:O.computeOrientation(e._p0,e._p1,this._p1)};Kt.prototype.getDy=function(){return this._dy};Kt.prototype.getCoordinate=function(){return this._p0};Kt.prototype.setNode=function(e){this._node=e};Kt.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),a=r.substring(n+1);e.print("  "+a+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Kt.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};Kt.prototype.getDirectedCoordinate=function(){return this._p1};Kt.prototype.getDx=function(){return this._dx};Kt.prototype.getLabel=function(){return this._label};Kt.prototype.getEdge=function(){return this._edge};Kt.prototype.getQuadrant=function(){return this._quadrant};Kt.prototype.getNode=function(){return this._node};Kt.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),r=t.lastIndexOf("."),n=t.substring(r+1);return"  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};Kt.prototype.computeLabel=function(e){};Kt.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=it.quadrant(this._dx,this._dy),U.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Kt.prototype.interfaces_=function(){return[ke]};Kt.prototype.getClass=function(){return Kt};var bs=function(e){function t(){var r=arguments[0],n=arguments[1];if(e.call(this,r),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var a=r.getNumPoints()-1;this.init(r.getCoordinate(a),r.getCoordinate(a-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(r){return this._depth[r]},t.prototype.setVisited=function(r){this._isVisited=r},t.prototype.computeDirectedLabel=function(){this._label=new et(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(r,n){if(this._depth[r]!==-999&&this._depth[r]!==n)throw new Jn("assigned depths do not match",this.getCoordinate());this._depth[r]=n},t.prototype.isInteriorAreaEdge=function(){for(var r=this,n=!0,a=0;a<2;a++)r._label.isArea(a)&&r._label.getLocation(a,w.LEFT)===m.INTERIOR&&r._label.getLocation(a,w.RIGHT)===m.INTERIOR||(n=!1);return n},t.prototype.setNextMin=function(r){this._nextMin=r},t.prototype.print=function(r){e.prototype.print.call(this,r),r.print(" "+this._depth[w.LEFT]+"/"+this._depth[w.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},t.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},t.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),n=!this._label.isArea(0)||this._label.allPositionsEqual(0,m.EXTERIOR),a=!this._label.isArea(1)||this._label.allPositionsEqual(1,m.EXTERIOR);return r&&n&&a},t.prototype.setEdgeRing=function(r){this._edgeRing=r},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},t.prototype.setInResult=function(r){this._isInResult=r},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)},t.prototype.setSym=function(r){this._sym=r},t.prototype.setVisitedEdge=function(r){this.setVisited(r),this._sym.setVisited(r)},t.prototype.setEdgeDepths=function(r,n){var a=this.getEdge().getDepthDelta();this._isForward||(a=-a);var s=1;r===w.LEFT&&(s=-1);var f=w.opposite(r),o=a*s,x=n+o;this.setDepth(r,n),this.setDepth(f,x)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(r){this._next=r},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(r,n){return r===m.EXTERIOR&&n===m.INTERIOR?1:r===m.INTERIOR&&n===m.EXTERIOR?-1:0},t}(Kt),xi=function(){};xi.prototype.createNode=function(e){return new is(e,null)};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};var ht=function(){if(this._edges=new b,this._nodes=null,this._edgeEndList=new b,arguments.length===0)this._nodes=new fn(new xi);else if(arguments.length===1){var e=arguments[0];this._nodes=new fn(e)}};ht.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var r=0;r<this._edges.size();r++){e.println("edge "+r+":");var n=t._edges.get(r);n.print(e),n.eiList.print(e)}};ht.prototype.find=function(e){return this._nodes.find(e)};ht.prototype.addNode=function(){if(arguments[0]instanceof is){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof v){var t=arguments[0];return this._nodes.addNode(t)}};ht.prototype.getNodeIterator=function(){return this._nodes.iterator()};ht.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};ht.prototype.debugPrintln=function(e){Ut.out.println(e)};ht.prototype.isBoundaryNode=function(e,t){var r=this._nodes.find(t);if(r===null)return!1;var n=r.getLabel();return n!==null&&n.getLocation(e)===m.BOUNDARY};ht.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};ht.prototype.matchInSameDirection=function(e,t,r,n){return e.equals(r)?O.computeOrientation(e,t,n)===O.COLLINEAR&&it.quadrant(e,t)===it.quadrant(r,n):!1};ht.prototype.getEdgeEnds=function(){return this._edgeEndList};ht.prototype.debugPrint=function(e){Ut.out.print(e)};ht.prototype.getEdgeIterator=function(){return this._edges.iterator()};ht.prototype.findEdgeInSameDirection=function(e,t){for(var r=this,n=0;n<this._edges.size();n++){var a=r._edges.get(n),s=a.getCoordinates();if(r.matchInSameDirection(e,t,s[0],s[1])||r.matchInSameDirection(e,t,s[s.length-1],s[s.length-2]))return a}return null};ht.prototype.insertEdge=function(e){this._edges.add(e)};ht.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var r=t.next();if(r.getEdge()===e)return r}return null};ht.prototype.addEdges=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next();t._edges.add(n);var a=new bs(n,!0),s=new bs(n,!1);a.setSym(s),s.setSym(a),t.add(a),t.add(s)}};ht.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};ht.prototype.getNodes=function(){return this._nodes.values()};ht.prototype.findEdge=function(e,t){for(var r=this,n=0;n<this._edges.size();n++){var a=r._edges.get(n),s=a.getCoordinates();if(e.equals(s[0])&&t.equals(s[1]))return a}return null};ht.prototype.interfaces_=function(){return[]};ht.prototype.getClass=function(){return ht};ht.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var r=t.next();r.getEdges().linkResultDirectedEdges()}};var ve=function(){this._geometryFactory=null,this._shellList=new b;var e=arguments[0];this._geometryFactory=e};ve.prototype.sortShellsAndHoles=function(e,t,r){for(var n=e.iterator();n.hasNext();){var a=n.next();a.isHole()?r.add(a):t.add(a)}};ve.prototype.computePolygons=function(e){for(var t=this,r=new b,n=e.iterator();n.hasNext();){var a=n.next(),s=a.toPolygon(t._geometryFactory);r.add(s)}return r};ve.prototype.placeFreeHoles=function(e,t){for(var r=this,n=t.iterator();n.hasNext();){var a=n.next();if(a.getShell()===null){var s=r.findEdgeRingContaining(a,e);if(s===null)throw new Jn("unable to assign hole to a shell",a.getCoordinate(0));a.setShell(s)}}};ve.prototype.buildMinimalEdgeRings=function(e,t,r){for(var n=this,a=new b,s=e.iterator();s.hasNext();){var f=s.next();if(f.getMaxNodeDegree()>2){f.linkDirectedEdgesForMinimalEdgeRings();var o=f.buildMinimalRings(),x=n.findShell(o);x!==null?(n.placePolygonHoles(x,o),t.add(x)):r.addAll(o)}else a.add(f)}return a};ve.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var r=t.next();if(r.containsPoint(e))return!0}return!1};ve.prototype.buildMaximalEdgeRings=function(e){for(var t=this,r=new b,n=e.iterator();n.hasNext();){var a=n.next();if(a.isInResult()&&a.getLabel().isArea()&&a.getEdgeRing()===null){var s=new Tc(a,t._geometryFactory);r.add(s),s.setInResult()}}return r};ve.prototype.placePolygonHoles=function(e,t){for(var r=t.iterator();r.hasNext();){var n=r.next();n.isHole()&&n.setShell(e)}};ve.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};ve.prototype.findEdgeRingContaining=function(e,t){for(var r=e.getLinearRing(),n=r.getEnvelopeInternal(),a=r.getCoordinateN(0),s=null,f=null,o=t.iterator();o.hasNext();){var x=o.next(),C=x.getLinearRing(),P=C.getEnvelopeInternal();s!==null&&(f=s.getLinearRing().getEnvelopeInternal());var Y=!1;P.contains(n)&&O.isPointInRing(a,C.getCoordinates())&&(Y=!0),Y&&(s===null||f.contains(P))&&(s=x)}return s};ve.prototype.findShell=function(e){for(var t=0,r=null,n=e.iterator();n.hasNext();){var a=n.next();a.isHole()||(r=a,t++)}return U.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),r};ve.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],r=arguments[1];ht.linkResultDirectedEdges(r);var n=this.buildMaximalEdgeRings(t),a=new b,s=this.buildMinimalEdgeRings(n,this._shellList,a);this.sortShellsAndHoles(s,this._shellList,a),this.placeFreeHoles(this._shellList,a)}};ve.prototype.interfaces_=function(){return[]};ve.prototype.getClass=function(){return ve};var Si=function(){};Si.prototype.getBounds=function(){};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};var Ye=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};Ye.prototype.getItem=function(){return this._item};Ye.prototype.getBounds=function(){return this._bounds};Ye.prototype.interfaces_=function(){return[Si,Ge]};Ye.prototype.getClass=function(){return Ye};var Zn=function(){this._size=null,this._items=null,this._size=0,this._items=new b,this._items.add(null)};Zn.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Zn.prototype.size=function(){return this._size};Zn.prototype.reorder=function(e){for(var t=this,r=null,n=this._items.get(e);e*2<=this._size&&(r=e*2,r!==t._size&&t._items.get(r+1).compareTo(t._items.get(r))<0&&r++,t._items.get(r).compareTo(n)<0);e=r)t._items.set(e,t._items.get(r));this._items.set(e,n)};Zn.prototype.clear=function(){this._size=0,this._items.clear()};Zn.prototype.isEmpty=function(){return this._size===0};Zn.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(r/2)))<0;r/=2)t._items.set(r,t._items.get(Math.trunc(r/2)));this._items.set(r,e)};Zn.prototype.interfaces_=function(){return[]};Zn.prototype.getClass=function(){return Zn};var lr=function(){};lr.prototype.visitItem=function(e){};lr.prototype.interfaces_=function(){return[]};lr.prototype.getClass=function(){return lr};var Qr=function(){};Qr.prototype.insert=function(e,t){};Qr.prototype.remove=function(e,t){};Qr.prototype.query=function(){};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};var Pt=function(){if(this._childBoundables=new b,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},yu={serialVersionUID:{configurable:!0}};Pt.prototype.getLevel=function(){return this._level};Pt.prototype.size=function(){return this._childBoundables.size()};Pt.prototype.getChildBoundables=function(){return this._childBoundables};Pt.prototype.addChildBoundable=function(e){U.isTrue(this._bounds===null),this._childBoundables.add(e)};Pt.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Pt.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Pt.prototype.interfaces_=function(){return[Si,Ge]};Pt.prototype.getClass=function(){return Pt};yu.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Pt,yu);var He=function(){};He.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};He.min=function(e){return He.sort(e),e.get(0)};He.sort=function(e,t){var r=e.toArray();t?Nr.sort(r,t):Nr.sort(r);for(var n=e.iterator(),a=0,s=r.length;a<s;a++)n.next(),n.set(r[a])};He.singletonList=function(e){var t=new b;return t.add(e),t};var Ct=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],r=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=r,this._distance=this.distance()};Ct.prototype.expandToQueue=function(e,t){var r=Ct.isComposite(this._boundable1),n=Ct.isComposite(this._boundable2);if(r&&n)return Ct.area(this._boundable1)>Ct.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(r)return this.expand(this._boundable1,this._boundable2,e,t),null;if(n)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new ct("neither boundable is composite")};Ct.prototype.isLeaves=function(){return!(Ct.isComposite(this._boundable1)||Ct.isComposite(this._boundable2))};Ct.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};Ct.prototype.expand=function(e,t,r,n){for(var a=this,s=e.getChildBoundables(),f=s.iterator();f.hasNext();){var o=f.next(),x=new Ct(o,t,a._itemDistance);x.getDistance()<n&&r.add(x)}};Ct.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Ct.prototype.getDistance=function(){return this._distance};Ct.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Ct.prototype.interfaces_=function(){return[ke]};Ct.prototype.getClass=function(){return Ct};Ct.area=function(e){return e.getBounds().getArea()};Ct.isComposite=function(e){return e instanceof Pt};var Tt=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new b,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var r=arguments[0];U.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},os={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Tt.prototype.getNodeCapacity=function(){return this._nodeCapacity};Tt.prototype.lastNode=function(e){return e.get(e.size()-1)};Tt.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],r=0,n=t.getChildBoundables().iterator();n.hasNext();){var a=n.next();a instanceof Pt?r+=e.size(a):a instanceof Ye&&(r+=1)}return r}};Tt.prototype.removeItem=function(e,t){for(var r=null,n=e.getChildBoundables().iterator();n.hasNext();){var a=n.next();a instanceof Ye&&a.getItem()===t&&(r=a)}return r!==null?(e.getChildBoundables().remove(r),!0):!1};Tt.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new b:t}else if(arguments.length===1){for(var r=arguments[0],n=new b,a=r.getChildBoundables().iterator();a.hasNext();){var s=a.next();if(s instanceof Pt){var f=e.itemsTree(s);f!==null&&n.add(f)}else s instanceof Ye?n.add(s.getItem()):U.shouldNeverReachHere()}return n.size()<=0?null:n}};Tt.prototype.insert=function(e,t){U.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ye(e,t))};Tt.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],r=new b;return this.boundablesAtLevel(t,this._root,r),r}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];if(U.isTrue(n>-2),a.getLevel()===n)return s.add(a),null;for(var f=a.getChildBoundables().iterator();f.hasNext();){var o=f.next();o instanceof Pt?e.boundablesAtLevel(n,o,s):(U.isTrue(o instanceof Ye),n===-1&&s.add(o))}return null}};Tt.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var r=new b;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,r),r}else if(arguments.length===2){var n=arguments[0],a=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,a)}else if(arguments.length===3){if(G(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt)for(var s=arguments[0],f=arguments[1],o=arguments[2],x=f.getChildBoundables(),C=0;C<x.size();C++){var P=x.get(C);e.getIntersectsOp().intersects(P.getBounds(),s)&&(P instanceof Pt?e.query(s,P,o):P instanceof Ye?o.visitItem(P.getItem()):U.shouldNeverReachHere())}else if(G(arguments[2],Ue)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt)for(var Y=arguments[0],ze=arguments[1],ge=arguments[2],Bt=ze.getChildBoundables(),Ur=0;Ur<Bt.size();Ur++){var kn=Bt.get(Ur);e.getIntersectsOp().intersects(kn.getBounds(),Y)&&(kn instanceof Pt?e.query(Y,kn,ge):kn instanceof Ye?ge.add(kn.getItem()):U.shouldNeverReachHere())}}};Tt.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Tt.prototype.getRoot=function(){return this.build(),this._root};Tt.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,r):!1}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2],f=this.removeItem(a,s);if(f)return!0;for(var o=null,x=a.getChildBoundables().iterator();x.hasNext();){var C=x.next();if(e.getIntersectsOp().intersects(C.getBounds(),n)&&C instanceof Pt&&(f=e.remove(n,C,s),f)){o=C;break}}return o!==null&&o.getChildBoundables().isEmpty()&&a.getChildBoundables().remove(o),f}};Tt.prototype.createHigherLevels=function(e,t){U.isTrue(!e.isEmpty());var r=this.createParentBoundables(e,t+1);return r.size()===1?r.get(0):this.createHigherLevels(r,t+1)};Tt.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],r=0,n=t.getChildBoundables().iterator();n.hasNext();){var a=n.next();if(a instanceof Pt){var s=e.depth(a);s>r&&(r=s)}}return r+1}};Tt.prototype.createParentBoundables=function(e,t){var r=this;U.isTrue(!e.isEmpty());var n=new b;n.add(this.createNode(t));var a=new b(e);He.sort(a,this.getComparator());for(var s=a.iterator();s.hasNext();){var f=s.next();r.lastNode(n).getChildBoundables().size()===r.getNodeCapacity()&&n.add(r.createNode(t)),r.lastNode(n).addChildBoundable(f)}return n};Tt.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Tt.prototype.interfaces_=function(){return[Ge]};Tt.prototype.getClass=function(){return Tt};Tt.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};os.IntersectsOp.get=function(){return Mc};os.serialVersionUID.get=function(){return-3886435814360241e3};os.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Tt,os);var Mc=function(){},wi=function(){};wi.prototype.distance=function(e,t){};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};var mu=function(e){function t(n){n=n||t.DEFAULT_NODE_CAPACITY,e.call(this,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(n,a){var s=this;U.isTrue(n.length>0);for(var f=new b,o=0;o<n.length;o++)f.addAll(s.createParentBoundablesFromVerticalSlice(n[o],a));return f},t.prototype.createNode=function(n){return new wa(n)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];if(n.isNull())return null;e.prototype.insert.call(this,n,a)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(n,a){for(var s=Math.trunc(Math.ceil(n.size()/a)),f=new Array(a).fill(null),o=n.iterator(),x=0;x<a;x++){f[x]=new b;for(var C=0;o.hasNext()&&C<s;){var P=o.next();f[x].add(P),C++}}return f},t.prototype.query=function(){if(arguments.length===1){var n=arguments[0];return e.prototype.query.call(this,n)}else if(arguments.length===2){var a=arguments[0],s=arguments[1];e.prototype.query.call(this,a,s)}else if(arguments.length===3){if(G(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt){var f=arguments[0],o=arguments[1],x=arguments[2];e.prototype.query.call(this,f,o,x)}else if(G(arguments[2],Ue)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt){var C=arguments[0],P=arguments[1],Y=arguments[2];e.prototype.query.call(this,C,P,Y)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(n,a){return e.prototype.createParentBoundables.call(this,n,a)},t.prototype.remove=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return e.prototype.remove.call(this,n,a)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(n,a){U.isTrue(!n.isEmpty());var s=Math.trunc(Math.ceil(n.size()/this.getNodeCapacity())),f=new b(n);He.sort(f,t.xComparator);var o=this.verticalSlices(f,Math.trunc(Math.ceil(Math.sqrt(s))));return this.createParentBoundablesFromVerticalSlices(o,a)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(G(arguments[0],wi)){var n=arguments[0],a=new Ct(this.getRoot(),this.getRoot(),n);return this.nearestNeighbour(a)}else if(arguments[0]instanceof Ct){var s=arguments[0];return this.nearestNeighbour(s,z.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&G(arguments[1],wi)){var f=arguments[0],o=arguments[1],x=new Ct(this.getRoot(),f.getRoot(),o);return this.nearestNeighbour(x)}else if(arguments[0]instanceof Ct&&typeof arguments[1]=="number"){var C=arguments[0],P=arguments[1],Y=P,ze=null,ge=new Zn;for(ge.add(C);!ge.isEmpty()&&Y>0;){var Bt=ge.poll(),Ur=Bt.getDistance();if(Ur>=Y)break;Bt.isLeaves()?(Y=Ur,ze=Bt):Bt.expandToQueue(ge,Y)}return[ze.getBoundable(0).getItem(),ze.getBoundable(1).getItem()]}}else if(arguments.length===3){var kn=arguments[0],Io=arguments[1],rl=arguments[2],Co=new Ye(kn,Io),as=new Ct(this.getRoot(),Co,rl);return this.nearestNeighbour(as)[0]}},t.prototype.interfaces_=function(){return[Qr,Ge]},t.prototype.getClass=function(){return t},t.centreX=function(n){return t.avg(n.getMinX(),n.getMaxX())},t.avg=function(n,a){return(n+a)/2},t.centreY=function(n){return t.avg(n.getMinY(),n.getMaxY())},r.STRtreeNode.get=function(){return wa},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[vi]},compare:function(n,a){return e.compareDoubles(t.centreX(n.getBounds()),t.centreX(a.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[vi]},compare:function(n,a){return e.compareDoubles(t.centreY(n.getBounds()),t.centreY(a.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(n,a){return n.intersects(a)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,r),t}(Tt),wa=function(e){function t(){var r=arguments[0];e.call(this,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var r=null,n=this.getChildBoundables().iterator();n.hasNext();){var a=n.next();r===null?r=new T(a.getBounds()):r.expandToInclude(a.getBounds())}return r},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Pt),se=function(){};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};se.relativeSign=function(e,t){return e<t?-1:e>t?1:0};se.compare=function(e,t,r){if(t.equals2D(r))return 0;var n=se.relativeSign(t.x,r.x),a=se.relativeSign(t.y,r.y);switch(e){case 0:return se.compareValue(n,a);case 1:return se.compareValue(a,n);case 2:return se.compareValue(a,-n);case 3:return se.compareValue(-n,a);case 4:return se.compareValue(-n,-a);case 5:return se.compareValue(-a,-n);case 6:return se.compareValue(-a,n);case 7:return se.compareValue(n,-a)}return U.shouldNeverReachHere("invalid octant value"),0};se.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var cr=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this._segString=e,this.coord=new v(t),this.segmentIndex=r,this._segmentOctant=n,this._isInterior=!t.equals2D(e.getCoordinate(r))};cr.prototype.getCoordinate=function(){return this.coord};cr.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};cr.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:se.compare(this._segmentOctant,this.coord,t.coord)};cr.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};cr.prototype.isInterior=function(){return this._isInterior};cr.prototype.interfaces_=function(){return[ke]};cr.prototype.getClass=function(){return cr};var ie=function(){this._nodeMap=new jt,this._edge=null;var e=arguments[0];this._edge=e};ie.prototype.getSplitCoordinates=function(){var e=this,t=new po;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var a=r.next();e.addEdgeCoordinates(n,a,t),n=a}return t.toCoordinateArray()};ie.prototype.addCollapsedNodes=function(){var e=this,t=new b;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var r=t.iterator();r.hasNext();){var n=r.next().intValue();e.add(e._edge.getCoordinate(n),n)}};ie.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};ie.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,r=0;r<this._edge.size()-2;r++){var n=t._edge.getCoordinate(r),a=t._edge.getCoordinate(r+2);n.equals2D(a)&&e.add(new sn(r+1))}};ie.prototype.addEdgeCoordinates=function(e,t,r){var n=this,a=this._edge.getCoordinate(t.segmentIndex),s=t.isInterior()||!t.coord.equals2D(a);r.add(new v(e.coord),!1);for(var f=e.segmentIndex+1;f<=t.segmentIndex;f++)r.add(n._edge.getCoordinate(f));s&&r.add(new v(t.coord))};ie.prototype.iterator=function(){return this._nodeMap.values().iterator()};ie.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),n=r.next();r.hasNext();){var a=r.next(),s=t.createSplitEdge(n,a);e.add(s),n=a}};ie.prototype.findCollapseIndex=function(e,t,r){if(!e.coord.equals2D(t.coord))return!1;var n=t.segmentIndex-e.segmentIndex;return t.isInterior()||n--,n===1?(r[0]=e.segmentIndex+1,!0):!1};ie.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,r=new Array(1).fill(null),n=this.iterator(),a=n.next();n.hasNext();){var s=n.next(),f=t.findCollapseIndex(a,s,r);f&&e.add(new sn(r[0])),a=s}};ie.prototype.getEdge=function(){return this._edge};ie.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};ie.prototype.createSplitEdge=function(e,t){var r=this,n=t.segmentIndex-e.segmentIndex+2,a=this._edge.getCoordinate(t.segmentIndex),s=t.isInterior()||!t.coord.equals2D(a);s||n--;var f=new Array(n).fill(null),o=0;f[o++]=new v(e.coord);for(var x=e.segmentIndex+1;x<=t.segmentIndex;x++)f[o++]=r._edge.getCoordinate(x);return s&&(f[o]=new v(t.coord)),new It(f,this._edge.getData())};ie.prototype.add=function(e,t){var r=new cr(this._edge,e,t,this._edge.getSegmentOctant(t)),n=this._nodeMap.get(r);return n!==null?(U.isTrue(n.coord.equals2D(e),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(r,r),r)};ie.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),r=e.get(0),n=r.getCoordinate(0);if(!n.equals2D(t[0]))throw new Kn("bad split edge start point at "+n);var a=e.get(e.size()-1),s=a.getCoordinates(),f=s[s.length-1];if(!f.equals2D(t[t.length-1]))throw new Kn("bad split edge end point at "+f)};ie.prototype.interfaces_=function(){return[]};ie.prototype.getClass=function(){return ie};var Jr=function(){};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Jr.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new ct("Cannot compute the octant for point ( "+e+", "+t+" )");var r=Math.abs(e),n=Math.abs(t);return e>=0?t>=0?r>=n?0:1:r>=n?7:6:t>=0?r>=n?3:2:r>=n?4:5}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var a=arguments[0],s=arguments[1],f=s.x-a.x,o=s.y-a.y;if(f===0&&o===0)throw new ct("Cannot compute the octant for two identical points "+a);return Jr.octant(f,o)}};var Pn=function(){};Pn.prototype.getCoordinates=function(){};Pn.prototype.size=function(){};Pn.prototype.getCoordinate=function(e){};Pn.prototype.isClosed=function(){};Pn.prototype.setData=function(e){};Pn.prototype.getData=function(){};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};var oo=function(){};oo.prototype.addIntersection=function(e,t){};oo.prototype.interfaces_=function(){return[Pn]};oo.prototype.getClass=function(){return oo};var It=function(){this._nodeList=new ie(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};It.prototype.getCoordinates=function(){return this._pts};It.prototype.size=function(){return this._pts.length};It.prototype.getCoordinate=function(e){return this._pts[e]};It.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};It.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};It.prototype.setData=function(e){this._data=e};It.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Jr.octant(e,t)};It.prototype.getData=function(){return this._data};It.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var r=arguments[0],n=arguments[1],a=arguments[3],s=new v(r.getIntersection(a));this.addIntersection(s,n)}};It.prototype.toString=function(){return qe.toLineString(new yt(this._pts))};It.prototype.getNodeList=function(){return this._nodeList};It.prototype.addIntersectionNode=function(e,t){var r=t,n=r+1;if(n<this._pts.length){var a=this._pts[n];e.equals2D(a)&&(r=n)}var s=this._nodeList.add(e,r);return s};It.prototype.addIntersections=function(e,t,r){for(var n=this,a=0;a<e.getIntersectionNum();a++)n.addIntersection(e,t,r,a)};It.prototype.interfaces_=function(){return[oo]};It.prototype.getClass=function(){return It};It.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new b;return It.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var r=arguments[0],n=arguments[1],a=r.iterator();a.hasNext();){var s=a.next();s.getNodeList().addSplitEdges(n)}};var F=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new v,this.p1=new v;else if(arguments.length===1){var e=arguments[0];this.p0=new v(e.p0),this.p1=new v(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],r=arguments[1],n=arguments[2],a=arguments[3];this.p0=new v(t,r),this.p1=new v(n,a)}},_u={serialVersionUID:{configurable:!0}};F.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};F.prototype.orientationIndex=function(){if(arguments[0]instanceof F){var e=arguments[0],t=O.orientationIndex(this.p0,this.p1,e.p0),r=O.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&r>=0||t<=0&&r<=0?Math.max(t,r):0}else if(arguments[0]instanceof v){var n=arguments[0];return O.orientationIndex(this.p0,this.p1,n)}};F.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};F.prototype.isVertical=function(){return this.p0.x===this.p1.x};F.prototype.equals=function(e){if(!(e instanceof F))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};F.prototype.intersection=function(e){var t=new zr;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};F.prototype.project=function(){if(arguments[0]instanceof v){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new v(e);var t=this.projectionFactor(e),r=new v;return r.x=this.p0.x+t*(this.p1.x-this.p0.x),r.y=this.p0.y+t*(this.p1.y-this.p0.y),r}else if(arguments[0]instanceof F){var n=arguments[0],a=this.projectionFactor(n.p0),s=this.projectionFactor(n.p1);if(a>=1&&s>=1||a<=0&&s<=0)return null;var f=this.project(n.p0);a<0&&(f=this.p0),a>1&&(f=this.p1);var o=this.project(n.p1);return s<0&&(o=this.p0),s>1&&(o=this.p1),new F(f,o)}};F.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};F.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};F.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};F.prototype.distancePerpendicular=function(e){return O.distancePointLinePerpendicular(e,this.p0,this.p1)};F.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};F.prototype.midPoint=function(){return F.midPoint(this.p0,this.p1)};F.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,n=t*t+r*r;if(n<=0)return z.NaN;var a=((e.x-this.p0.x)*t+(e.y-this.p0.y)*r)/n;return a};F.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var r=new Array(2).fill(null),n=z.MAX_VALUE,a=null,s=this.closestPoint(e.p0);n=s.distance(e.p0),r[0]=s,r[1]=e.p0;var f=this.closestPoint(e.p1);a=f.distance(e.p1),a<n&&(n=a,r[0]=f,r[1]=e.p1);var o=e.closestPoint(this.p0);a=o.distance(this.p0),a<n&&(n=a,r[0]=this.p0,r[1]=o);var x=e.closestPoint(this.p1);return a=x.distance(this.p1),a<n&&(n=a,r[0]=this.p1,r[1]=x),r};F.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var r=this.p0.distance(e),n=this.p1.distance(e);return r<n?this.p0:this.p1};F.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};F.prototype.getLength=function(){return this.p0.distance(this.p1)};F.prototype.compareTo=function(e){var t=e,r=this.p0.compareTo(t.p0);return r!==0?r:this.p1.compareTo(t.p1)};F.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};F.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};F.prototype.lineIntersection=function(e){try{var t=Ve.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(r){if(!(r instanceof ki))throw r}finally{}return null};F.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};F.prototype.pointAlongOffset=function(e,t){var r=this.p0.x+e*(this.p1.x-this.p0.x),n=this.p0.y+e*(this.p1.y-this.p0.y),a=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,f=Math.sqrt(a*a+s*s),o=0,x=0;if(t!==0){if(f<=0)throw new Error("Cannot compute offset from zero-length line segment");o=t*a/f,x=t*s/f}var C=r-x,P=n+o,Y=new v(C,P);return Y};F.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=r.x,this.p1.y=r.y}};F.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||z.isNaN(t))&&(t=1),t};F.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};F.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};F.prototype.distance=function(){if(arguments[0]instanceof F){var e=arguments[0];return O.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof v){var t=arguments[0];return O.distancePointLine(t,this.p0,this.p1)}};F.prototype.pointAlong=function(e){var t=new v;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};F.prototype.hashCode=function(){var e=z.doubleToLongBits(this.p0.x);e^=z.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),r=z.doubleToLongBits(this.p1.x);r^=z.doubleToLongBits(this.p1.y)*31;var n=Math.trunc(r)^Math.trunc(r>>32);return t^n};F.prototype.interfaces_=function(){return[ke,Ge]};F.prototype.getClass=function(){return F};F.midPoint=function(e,t){return new v((e.x+t.x)/2,(e.y+t.y)/2)};_u.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(F,_u);var so=function(){this.tempEnv1=new T,this.tempEnv2=new T,this._overlapSeg1=new F,this._overlapSeg2=new F};so.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];e.getLineSegment(t,this._overlapSeg1),r.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var ye=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this._pts=e,this._start=t,this._end=r,this._context=n};ye.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};ye.prototype.computeSelect=function(e,t,r,n){var a=this._pts[t],s=this._pts[r];if(n.tempEnv1.init(a,s),r-t===1)return n.select(this,t),null;if(!e.intersects(n.tempEnv1))return null;var f=Math.trunc((t+r)/2);t<f&&this.computeSelect(e,t,f,n),f<r&&this.computeSelect(e,f,r,n)};ye.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),r=0,n=this._start;n<=this._end;n++)t[r++]=e._pts[n];return t};ye.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};ye.prototype.setId=function(e){this._id=e};ye.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};ye.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new T(e,t)}return this._env};ye.prototype.getEndIndex=function(){return this._end};ye.prototype.getStartIndex=function(){return this._start};ye.prototype.getContext=function(){return this._context};ye.prototype.getId=function(){return this._id};ye.prototype.computeOverlapsInternal=function(e,t,r,n,a,s){var f=this._pts[e],o=this._pts[t],x=r._pts[n],C=r._pts[a];if(t-e===1&&a-n===1)return s.overlap(this,e,r,n),null;if(s.tempEnv1.init(f,o),s.tempEnv2.init(x,C),!s.tempEnv1.intersects(s.tempEnv2))return null;var P=Math.trunc((e+t)/2),Y=Math.trunc((n+a)/2);e<P&&(n<Y&&this.computeOverlapsInternal(e,P,r,n,Y,s),Y<a&&this.computeOverlapsInternal(e,P,r,Y,a,s)),P<t&&(n<Y&&this.computeOverlapsInternal(P,t,r,n,Y,s),Y<a&&this.computeOverlapsInternal(P,t,r,Y,a,s))};ye.prototype.interfaces_=function(){return[]};ye.prototype.getClass=function(){return ye};var on=function(){};on.prototype.interfaces_=function(){return[]};on.prototype.getClass=function(){return on};on.getChainStartIndices=function(e){var t=0,r=new b;r.add(new sn(t));do{var n=on.findChainEnd(e,t);r.add(new sn(n)),t=n}while(t<e.length-1);var a=on.toIntArray(r);return a};on.findChainEnd=function(e,t){for(var r=t;r<e.length-1&&e[r].equals2D(e[r+1]);)r++;if(r>=e.length-1)return e.length-1;for(var n=it.quadrant(e[r],e[r+1]),a=t+1;a<e.length;){if(!e[a-1].equals2D(e[a])){var s=it.quadrant(e[a-1],e[a]);if(s!==n)break}a++}return a-1};on.getChains=function(){if(arguments.length===1){var e=arguments[0];return on.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],r=arguments[1],n=new b,a=on.getChainStartIndices(t),s=0;s<a.length-1;s++){var f=new ye(t,a[s],a[s+1],r);n.add(f)}return n}};on.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),r=0;r<t.length;r++)t[r]=e.get(r).intValue();return t};var br=function(){};br.prototype.computeNodes=function(e){};br.prototype.getNodedSubstrings=function(){};br.prototype.interfaces_=function(){return[]};br.prototype.getClass=function(){return br};var ao=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};ao.prototype.setSegmentIntersector=function(e){this._segInt=e};ao.prototype.interfaces_=function(){return[br]};ao.prototype.getClass=function(){return ao};var qs=function(e){function t(n){n?e.call(this,n):e.call(this),this._monoChains=new b,this._index=new mu,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return It.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(n){for(var a=this,s=on.getChains(n.getCoordinates(),n),f=s.iterator();f.hasNext();){var o=f.next();o.setId(a._idCounter++),a._index.insert(o.getEnvelope(),o),a._monoChains.add(o)}},t.prototype.computeNodes=function(n){var a=this;this._nodedSegStrings=n;for(var s=n.iterator();s.hasNext();)a.add(s.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var n=this,a=new La(this._segInt),s=this._monoChains.iterator();s.hasNext();)for(var f=s.next(),o=n._index.query(f.getEnvelope()),x=o.iterator();x.hasNext();){var C=x.next();if(C.getId()>f.getId()&&(f.computeOverlaps(C,a),n._nOverlaps++),n._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.SegmentOverlapAction.get=function(){return La},Object.defineProperties(t,r),t}(ao),La=function(e){function t(){e.call(this),this._si=null;var r=arguments[0];this._si=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var r=arguments[0],n=arguments[1],a=arguments[2],s=arguments[3],f=r.getContext(),o=a.getContext();this._si.processIntersections(f,n,o,s)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(so),Z=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(arguments.length===4){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3];this.setQuadrantSegments(a),this.setEndCapStyle(s),this.setJoinStyle(f),this.setMitreLimit(o)}}},nr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Z.prototype.getEndCapStyle=function(){return this._endCapStyle};Z.prototype.isSingleSided=function(){return this._isSingleSided};Z.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Z.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Z.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Z.JOIN_ROUND&&(this._quadrantSegments=Z.DEFAULT_QUADRANT_SEGMENTS)};Z.prototype.getJoinStyle=function(){return this._joinStyle};Z.prototype.setJoinStyle=function(e){this._joinStyle=e};Z.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Z.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Z.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Z.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Z.prototype.getMitreLimit=function(){return this._mitreLimit};Z.prototype.setMitreLimit=function(e){this._mitreLimit=e};Z.prototype.setSingleSided=function(e){this._isSingleSided=e};Z.prototype.interfaces_=function(){return[]};Z.prototype.getClass=function(){return Z};Z.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};nr.CAP_ROUND.get=function(){return 1};nr.CAP_FLAT.get=function(){return 2};nr.CAP_SQUARE.get=function(){return 3};nr.JOIN_ROUND.get=function(){return 1};nr.JOIN_MITRE.get=function(){return 2};nr.JOIN_BEVEL.get=function(){return 3};nr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};nr.DEFAULT_MITRE_LIMIT.get=function(){return 5};nr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Z,nr);var dt=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=O.COUNTERCLOCKWISE,this._inputLine=e||null},mo={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};dt.prototype.isDeletable=function(e,t,r,n){var a=this._inputLine[e],s=this._inputLine[t],f=this._inputLine[r];return!this.isConcave(a,s,f)||!this.isShallow(a,s,f,n)?!1:this.isShallowSampled(a,s,e,r,n)};dt.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,r=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(r),a=!1;n<this._inputLine.length;){var s=!1;e.isDeletable(t,r,n,e._distanceTol)&&(e._isDeleted[r]=dt.DELETE,s=!0,a=!0),s?t=n:t=r,r=e.findNextNonDeletedIndex(t),n=e.findNextNonDeletedIndex(r)}return a};dt.prototype.isShallowConcavity=function(e,t,r,n){var a=O.computeOrientation(e,t,r),s=a===this._angleOrientation;if(!s)return!1;var f=O.distancePointLine(t,e,r);return f<n};dt.prototype.isShallowSampled=function(e,t,r,n,a){var s=this,f=Math.trunc((n-r)/dt.NUM_PTS_TO_CHECK);f<=0&&(f=1);for(var o=r;o<n;o+=f)if(!s.isShallow(e,t,s._inputLine[o],a))return!1;return!0};dt.prototype.isConcave=function(e,t,r){var n=O.computeOrientation(e,t,r),a=n===this._angleOrientation;return a};dt.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=O.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var r=!1;do r=t.deleteShallowConcavities();while(r);return this.collapseLine()};dt.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===dt.DELETE;)t++;return t};dt.prototype.isShallow=function(e,t,r,n){var a=O.distancePointLine(t,e,r);return a<n};dt.prototype.collapseLine=function(){for(var e=this,t=new po,r=0;r<this._inputLine.length;r++)e._isDeleted[r]!==dt.DELETE&&t.add(e._inputLine[r]);return t.toCoordinateArray()};dt.prototype.interfaces_=function(){return[]};dt.prototype.getClass=function(){return dt};dt.simplify=function(e,t){var r=new dt(e);return r.simplify(t)};mo.INIT.get=function(){return 0};mo.DELETE.get=function(){return 1};mo.KEEP.get=function(){return 1};mo.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(dt,mo);var we=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new b},Eu={COORDINATE_ARRAY_TYPE:{configurable:!0}};we.prototype.getCoordinates=function(){var e=this._ptList.toArray(we.COORDINATE_ARRAY_TYPE);return e};we.prototype.setPrecisionModel=function(e){this._precisionModel=e};we.prototype.addPt=function(e){var t=new v(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};we.prototype.revere=function(){};we.prototype.addPts=function(e,t){var r=this;if(t)for(var n=0;n<e.length;n++)r.addPt(e[n]);else for(var a=e.length-1;a>=0;a--)r.addPt(e[a])};we.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),r=e.distance(t);return r<this._minimimVertexDistance};we.prototype.toString=function(){var e=new H,t=e.createLineString(this.getCoordinates());return t.toString()};we.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new v(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};we.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};Eu.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(we,Eu);var K=function(){},ci={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};K.prototype.interfaces_=function(){return[]};K.prototype.getClass=function(){return K};K.toDegrees=function(e){return e*180/Math.PI};K.normalize=function(e){for(;e>Math.PI;)e-=K.PI_TIMES_2;for(;e<=-Math.PI;)e+=K.PI_TIMES_2;return e};K.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=r.x-t.x,a=r.y-t.y;return Math.atan2(a,n)}};K.isAcute=function(e,t,r){var n=e.x-t.x,a=e.y-t.y,s=r.x-t.x,f=r.y-t.y,o=n*s+a*f;return o>0};K.isObtuse=function(e,t,r){var n=e.x-t.x,a=e.y-t.y,s=r.x-t.x,f=r.y-t.y,o=n*s+a*f;return o<0};K.interiorAngle=function(e,t,r){var n=K.angle(t,e),a=K.angle(t,r);return Math.abs(a-n)};K.normalizePositive=function(e){if(e<0){for(;e<0;)e+=K.PI_TIMES_2;e>=K.PI_TIMES_2&&(e=0)}else{for(;e>=K.PI_TIMES_2;)e-=K.PI_TIMES_2;e<0&&(e=0)}return e};K.angleBetween=function(e,t,r){var n=K.angle(t,e),a=K.angle(t,r);return K.diff(n,a)};K.diff=function(e,t){var r=null;return e<t?r=t-e:r=e-t,r>Math.PI&&(r=2*Math.PI-r),r};K.toRadians=function(e){return e*Math.PI/180};K.getTurn=function(e,t){var r=Math.sin(t-e);return r>0?K.COUNTERCLOCKWISE:r<0?K.CLOCKWISE:K.NONE};K.angleBetweenOriented=function(e,t,r){var n=K.angle(t,e),a=K.angle(t,r),s=a-n;return s<=-Math.PI?s+K.PI_TIMES_2:s>Math.PI?s-K.PI_TIMES_2:s};ci.PI_TIMES_2.get=function(){return 2*Math.PI};ci.PI_OVER_2.get=function(){return Math.PI/2};ci.PI_OVER_4.get=function(){return Math.PI/4};ci.COUNTERCLOCKWISE.get=function(){return O.COUNTERCLOCKWISE};ci.CLOCKWISE.get=function(){return O.CLOCKWISE};ci.NONE.get=function(){return O.COLLINEAR};Object.defineProperties(K,ci);var lt=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new F,this._seg1=new F,this._offset0=new F,this._offset1=new F,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=t,this._bufParams=r,this._li=new zr,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===Z.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},_o={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};lt.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=O.computeOrientation(this._s0,this._s1,this._s2),n=r===O.CLOCKWISE&&this._side===w.LEFT||r===O.COUNTERCLOCKWISE&&this._side===w.RIGHT;r===0?this.addCollinear(t):n?this.addOutsideTurn(r,t):this.addInsideTurn(r,t)};lt.prototype.addLineEndCap=function(e,t){var r=new F(e,t),n=new F;this.computeOffsetSegment(r,w.LEFT,this._distance,n);var a=new F;this.computeOffsetSegment(r,w.RIGHT,this._distance,a);var s=t.x-e.x,f=t.y-e.y,o=Math.atan2(f,s);switch(this._bufParams.getEndCapStyle()){case Z.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(t,o+Math.PI/2,o-Math.PI/2,O.CLOCKWISE,this._distance),this._segList.addPt(a.p1);break;case Z.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(a.p1);break;case Z.CAP_SQUARE:var x=new v;x.x=Math.abs(this._distance)*Math.cos(o),x.y=Math.abs(this._distance)*Math.sin(o);var C=new v(n.p1.x+x.x,n.p1.y+x.y),P=new v(a.p1.x+x.x,a.p1.y+x.y);this._segList.addPt(C),this._segList.addPt(P);break}};lt.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};lt.prototype.addMitreJoin=function(e,t,r,n){var a=!0,s=null;try{s=Ve.intersection(t.p0,t.p1,r.p0,r.p1);var f=n<=0?1:s.distance(e)/Math.abs(n);f>this._bufParams.getMitreLimit()&&(a=!1)}catch(o){if(o instanceof ki)s=new v(0,0),a=!1;else throw o}finally{}a?this._segList.addPt(s):this.addLimitedMitreJoin(t,r,n,this._bufParams.getMitreLimit())};lt.prototype.addFilletCorner=function(e,t,r,n,a){var s=t.x-e.x,f=t.y-e.y,o=Math.atan2(f,s),x=r.x-e.x,C=r.y-e.y,P=Math.atan2(C,x);n===O.CLOCKWISE?o<=P&&(o+=2*Math.PI):o>=P&&(o-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,o,P,n,a),this._segList.addPt(r)};lt.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Z.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Z.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};lt.prototype.createSquare=function(e){this._segList.addPt(new v(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new v(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new v(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new v(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};lt.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};lt.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};lt.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};lt.prototype.initSideSegments=function(e,t,r){this._s1=e,this._s2=t,this._side=r,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)};lt.prototype.addLimitedMitreJoin=function(e,t,r,n){var a=this._seg0.p1,s=K.angle(a,this._seg0.p0),f=K.angleBetweenOriented(this._seg0.p0,a,this._seg1.p1),o=f/2,x=K.normalize(s+o),C=K.normalize(x+Math.PI),P=n*r,Y=P*Math.abs(Math.sin(o)),ze=r-Y,ge=a.x+P*Math.cos(C),Bt=a.y+P*Math.sin(C),Ur=new v(ge,Bt),kn=new F(a,Ur),Io=kn.pointAlongOffset(1,ze),rl=kn.pointAlongOffset(1,-ze);this._side===w.LEFT?(this._segList.addPt(Io),this._segList.addPt(rl)):(this._segList.addPt(rl),this._segList.addPt(Io))};lt.prototype.computeOffsetSegment=function(e,t,r,n){var a=t===w.LEFT?1:-1,s=e.p1.x-e.p0.x,f=e.p1.y-e.p0.y,o=Math.sqrt(s*s+f*f),x=a*r*s/o,C=a*r*f/o;n.p0.x=e.p0.x-C,n.p0.y=e.p0.y+x,n.p1.x=e.p1.x-C,n.p1.y=e.p1.y+x};lt.prototype.addFilletArc=function(e,t,r,n,a){var s=this,f=n===O.CLOCKWISE?-1:1,o=Math.abs(t-r),x=Math.trunc(o/this._filletAngleQuantum+.5);if(x<1)return null;for(var C=0,P=o/x,Y=C,ze=new v;Y<o;){var ge=t+f*Y;ze.x=e.x+a*Math.cos(ge),ze.y=e.y+a*Math.sin(ge),s._segList.addPt(ze),Y+=P}};lt.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new v((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var n=new v((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};lt.prototype.createCircle=function(e){var t=new v(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};lt.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};lt.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new we,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*lt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};lt.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Z.JOIN_BEVEL||this._bufParams.getJoinStyle()===Z.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,O.CLOCKWISE,this._distance))};lt.prototype.closeRing=function(){this._segList.closeRing()};lt.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};lt.prototype.interfaces_=function(){return[]};lt.prototype.getClass=function(){return lt};_o.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};_o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};_o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};_o.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(lt,_o);var le=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};le.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var r=t<0,n=Math.abs(t),a=this.getSegGen(n);e.length<=1?this.computePointCurve(e[0],a):this.computeOffsetCurve(e,r,a);var s=a.getCoordinates();return r&&W.reverse(s),s};le.prototype.computeSingleSidedBufferCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);if(t){r.addSegments(e,!0);var a=dt.simplify(e,-n),s=a.length-1;r.initSideSegments(a[s],a[s-1],w.LEFT),r.addFirstSegment();for(var f=s-2;f>=0;f--)r.addNextSegment(a[f],!0)}else{r.addSegments(e,!1);var o=dt.simplify(e,n),x=o.length-1;r.initSideSegments(o[0],o[1],w.LEFT),r.addFirstSegment();for(var C=2;C<=x;C++)r.addNextSegment(o[C],!0)}r.addLastSegment(),r.closeRing()};le.prototype.computeRingBufferCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);t===w.RIGHT&&(n=-n);var a=dt.simplify(e,n),s=a.length-1;r.initSideSegments(a[s-1],a[0],t);for(var f=1;f<=s;f++){var o=f!==1;r.addNextSegment(a[f],o)}r.closeRing()};le.prototype.computeLineBufferCurve=function(e,t){var r=this.simplifyTolerance(this._distance),n=dt.simplify(e,r),a=n.length-1;t.initSideSegments(n[0],n[1],w.LEFT);for(var s=2;s<=a;s++)t.addNextSegment(n[s],!0);t.addLastSegment(),t.addLineEndCap(n[a-1],n[a]);var f=dt.simplify(e,-r),o=f.length-1;t.initSideSegments(f[o],f[o-1],w.LEFT);for(var x=o-2;x>=0;x--)t.addNextSegment(f[x],!0);t.addLastSegment(),t.addLineEndCap(f[1],f[0]),t.closeRing()};le.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Z.CAP_ROUND:t.createCircle(e);break;case Z.CAP_SQUARE:t.createSquare(e);break}};le.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var r=Math.abs(t),n=this.getSegGen(r);if(e.length<=1)this.computePointCurve(e[0],n);else if(this._bufParams.isSingleSided()){var a=t<0;this.computeSingleSidedBufferCurve(e,a,n)}else this.computeLineBufferCurve(e,n);var s=n.getCoordinates();return s};le.prototype.getBufferParameters=function(){return this._bufParams};le.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};le.prototype.getRingCurve=function(e,t,r){if(this._distance=r,e.length<=2)return this.getLineCurve(e,r);if(r===0)return le.copyCoordinates(e);var n=this.getSegGen(r);return this.computeRingBufferCurve(e,t,n),n.getCoordinates()};le.prototype.computeOffsetCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);if(t){var a=dt.simplify(e,-n),s=a.length-1;r.initSideSegments(a[s],a[s-1],w.LEFT),r.addFirstSegment();for(var f=s-2;f>=0;f--)r.addNextSegment(a[f],!0)}else{var o=dt.simplify(e,n),x=o.length-1;r.initSideSegments(o[0],o[1],w.LEFT),r.addFirstSegment();for(var C=2;C<=x;C++)r.addNextSegment(o[C],!0)}r.addLastSegment()};le.prototype.getSegGen=function(e){return new lt(this._precisionModel,this._bufParams,e)};le.prototype.interfaces_=function(){return[]};le.prototype.getClass=function(){return le};le.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),r=0;r<t.length;r++)t[r]=new v(e[r]);return t};var Zr=function(){this._subgraphs=null,this._seg=new F,this._cga=new O;var e=arguments[0];this._subgraphs=e},Iu={DepthSegment:{configurable:!0}};Zr.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],r=new b,n=this._subgraphs.iterator();n.hasNext();){var a=n.next(),s=a.getEnvelope();t.y<s.getMinY()||t.y>s.getMaxY()||e.findStabbedSegments(t,a.getDirectedEdges(),r)}return r}else if(arguments.length===3){if(G(arguments[2],Ue)&&arguments[0]instanceof v&&arguments[1]instanceof bs)for(var f=arguments[0],o=arguments[1],x=arguments[2],C=o.getEdge().getCoordinates(),P=0;P<C.length-1;P++){e._seg.p0=C[P],e._seg.p1=C[P+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var Y=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(Y<f.x)&&!e._seg.isHorizontal()&&!(f.y<e._seg.p0.y||f.y>e._seg.p1.y)&&O.computeOrientation(e._seg.p0,e._seg.p1,f)!==O.RIGHT){var ze=o.getDepth(w.LEFT);e._seg.p0.equals(C[P])||(ze=o.getDepth(w.RIGHT));var ge=new Pr(e._seg,ze);x.add(ge)}}else if(G(arguments[2],Ue)&&arguments[0]instanceof v&&G(arguments[1],Ue))for(var Bt=arguments[0],Ur=arguments[1],kn=arguments[2],Io=Ur.iterator();Io.hasNext();){var rl=Io.next();rl.isForward()&&e.findStabbedSegments(Bt,rl,kn)}}};Zr.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var r=He.min(t);return r._leftDepth};Zr.prototype.interfaces_=function(){return[]};Zr.prototype.getClass=function(){return Zr};Iu.DepthSegment.get=function(){return Pr};Object.defineProperties(Zr,Iu);var Pr=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new F(e),this._leftDepth=t};Pr.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(t._upwardSeg);return r!==0||(r=-1*t._upwardSeg.orientationIndex(this._upwardSeg),r!==0)?r:this._upwardSeg.compareTo(t._upwardSeg)};Pr.prototype.compareX=function(e,t){var r=e.p0.compareTo(t.p0);return r!==0?r:e.p1.compareTo(t.p1)};Pr.prototype.toString=function(){return this._upwardSeg.toString()};Pr.prototype.interfaces_=function(){return[ke]};Pr.prototype.getClass=function(){return Pr};var tt=function(e,t,r){this.p0=e||null,this.p1=t||null,this.p2=r||null};tt.prototype.area=function(){return tt.area(this.p0,this.p1,this.p2)};tt.prototype.signedArea=function(){return tt.signedArea(this.p0,this.p1,this.p2)};tt.prototype.interpolateZ=function(e){if(e===null)throw new ct("Supplied point is null.");return tt.interpolateZ(e,this.p0,this.p1,this.p2)};tt.prototype.longestSideLength=function(){return tt.longestSideLength(this.p0,this.p1,this.p2)};tt.prototype.isAcute=function(){return tt.isAcute(this.p0,this.p1,this.p2)};tt.prototype.circumcentre=function(){return tt.circumcentre(this.p0,this.p1,this.p2)};tt.prototype.area3D=function(){return tt.area3D(this.p0,this.p1,this.p2)};tt.prototype.centroid=function(){return tt.centroid(this.p0,this.p1,this.p2)};tt.prototype.inCentre=function(){return tt.inCentre(this.p0,this.p1,this.p2)};tt.prototype.interfaces_=function(){return[]};tt.prototype.getClass=function(){return tt};tt.area=function(e,t,r){return Math.abs(((r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y))/2)};tt.signedArea=function(e,t,r){return((r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y))/2};tt.det=function(e,t,r,n){return e*n-t*r};tt.interpolateZ=function(e,t,r,n){var a=t.x,s=t.y,f=r.x-a,o=n.x-a,x=r.y-s,C=n.y-s,P=f*C-o*x,Y=e.x-a,ze=e.y-s,ge=(C*Y-o*ze)/P,Bt=(-x*Y+f*ze)/P,Ur=t.z+ge*(r.z-t.z)+Bt*(n.z-t.z);return Ur};tt.longestSideLength=function(e,t,r){var n=e.distance(t),a=t.distance(r),s=r.distance(e),f=n;return a>f&&(f=a),s>f&&(f=s),f};tt.isAcute=function(e,t,r){return!(!K.isAcute(e,t,r)||!K.isAcute(t,r,e)||!K.isAcute(r,e,t))};tt.circumcentre=function(e,t,r){var n=r.x,a=r.y,s=e.x-n,f=e.y-a,o=t.x-n,x=t.y-a,C=2*tt.det(s,f,o,x),P=tt.det(f,s*s+f*f,x,o*o+x*x),Y=tt.det(s,s*s+f*f,o,o*o+x*x),ze=n-P/C,ge=a+Y/C;return new v(ze,ge)};tt.perpendicularBisector=function(e,t){var r=t.x-e.x,n=t.y-e.y,a=new Ve(e.x+r/2,e.y+n/2,1),s=new Ve(e.x-n+r/2,e.y+r+n/2,1);return new Ve(a,s)};tt.angleBisector=function(e,t,r){var n=t.distance(e),a=t.distance(r),s=n/(n+a),f=r.x-e.x,o=r.y-e.y,x=new v(e.x+s*f,e.y+s*o);return x};tt.area3D=function(e,t,r){var n=t.x-e.x,a=t.y-e.y,s=t.z-e.z,f=r.x-e.x,o=r.y-e.y,x=r.z-e.z,C=a*x-s*o,P=s*f-n*x,Y=n*o-a*f,ze=C*C+P*P+Y*Y,ge=Math.sqrt(ze)/2;return ge};tt.centroid=function(e,t,r){var n=(e.x+t.x+r.x)/3,a=(e.y+t.y+r.y)/3;return new v(n,a)};tt.inCentre=function(e,t,r){var n=t.distance(r),a=e.distance(r),s=e.distance(t),f=n+a+s,o=(n*e.x+a*t.x+s*r.x)/f,x=(n*e.y+a*t.y+s*r.y)/f;return new v(o,x)};var Fe=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new b;var e=arguments[0],t=arguments[1],r=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=r};Fe.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),r=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(r,m.EXTERIOR,m.INTERIOR)};Fe.prototype.addPolygon=function(e){var t=this,r=this._distance,n=w.LEFT;this._distance<0&&(r=-this._distance,n=w.RIGHT);var a=e.getExteriorRing(),s=W.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&s.length<3)return null;this.addPolygonRing(s,r,n,m.EXTERIOR,m.INTERIOR);for(var f=0;f<e.getNumInteriorRing();f++){var o=e.getInteriorRingN(f),x=W.removeRepeatedPoints(o.getCoordinates());t._distance>0&&t.isErodedCompletely(o,-t._distance)||t.addPolygonRing(x,r,w.opposite(n),m.INTERIOR,m.EXTERIOR)}};Fe.prototype.isTriangleErodedCompletely=function(e,t){var r=new tt(e[0],e[1],e[2]),n=r.inCentre(),a=O.distancePointLine(n,r.p0,r.p1);return a<Math.abs(t)};Fe.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=W.removeRepeatedPoints(e.getCoordinates()),r=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(r,m.EXTERIOR,m.INTERIOR)};Fe.prototype.addCurve=function(e,t,r){if(e===null||e.length<2)return null;var n=new It(e,new et(0,m.BOUNDARY,t,r));this._curveList.add(n)};Fe.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Fe.prototype.addPolygonRing=function(e,t,r,n,a){if(t===0&&e.length<Ln.MINIMUM_VALID_SIZE)return null;var s=n,f=a;e.length>=Ln.MINIMUM_VALID_SIZE&&O.isCCW(e)&&(s=a,f=n,r=w.opposite(r));var o=this._curveBuilder.getRingCurve(e,r,t);this.addCurve(o,s,f)};Fe.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Rt?this.addPolygon(e):e instanceof pt?this.addLineString(e):e instanceof de?this.addPoint(e):e instanceof Ni?this.addCollection(e):e instanceof Lr?this.addCollection(e):e instanceof xn?this.addCollection(e):e instanceof ne&&this.addCollection(e)};Fe.prototype.isErodedCompletely=function(e,t){var r=e.getCoordinates();if(r.length<4)return t<0;if(r.length===4)return this.isTriangleErodedCompletely(r,t);var n=e.getEnvelopeInternal(),a=Math.min(n.getHeight(),n.getWidth());return t<0&&2*Math.abs(t)>a};Fe.prototype.addCollection=function(e){for(var t=this,r=0;r<e.getNumGeometries();r++){var n=e.getGeometryN(r);t.add(n)}};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};var Li=function(){};Li.prototype.locate=function(e){};Li.prototype.interfaces_=function(){return[]};Li.prototype.getClass=function(){return Li};var Sn=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};Sn.prototype.next=function(){if(this._atStart)return this._atStart=!1,Sn.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new zi;var e=this._parent.getGeometryN(this._index++);return e instanceof ne?(this._subcollectionIterator=new Sn(e),this._subcollectionIterator.next()):e};Sn.prototype.remove=function(){throw new Error(this.getClass().getName())};Sn.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Sn.prototype.interfaces_=function(){return[Gi]};Sn.prototype.getClass=function(){return Sn};Sn.isAtomic=function(e){return!(e instanceof ne)};var Ce=function(){this._geom=null;var e=arguments[0];this._geom=e};Ce.prototype.locate=function(e){return Ce.locate(e,this._geom)};Ce.prototype.interfaces_=function(){return[Li]};Ce.prototype.getClass=function(){return Ce};Ce.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?O.isPointInRing(e,t.getCoordinates()):!1};Ce.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var r=t.getExteriorRing();if(!Ce.isPointInRing(e,r))return!1;for(var n=0;n<t.getNumInteriorRing();n++){var a=t.getInteriorRingN(n);if(Ce.isPointInRing(e,a))return!1}return!0};Ce.containsPoint=function(e,t){if(t instanceof Rt)return Ce.containsPointInPolygon(e,t);if(t instanceof ne)for(var r=new Sn(t);r.hasNext();){var n=r.next();if(n!==t&&Ce.containsPoint(e,n))return!0}return!1};Ce.locate=function(e,t){return t.isEmpty()?m.EXTERIOR:Ce.containsPoint(e,t)?m.INTERIOR:m.EXTERIOR};var Qt=function(){this._edgeMap=new jt,this._edgeList=null,this._ptInAreaLocation=[m.NONE,m.NONE]};Qt.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),r=t-1;return t===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)};Qt.prototype.propagateSideLabels=function(e){for(var t=m.NONE,r=this.iterator();r.hasNext();){var n=r.next(),a=n.getLabel();a.isArea(e)&&a.getLocation(e,w.LEFT)!==m.NONE&&(t=a.getLocation(e,w.LEFT))}if(t===m.NONE)return null;for(var s=t,f=this.iterator();f.hasNext();){var o=f.next(),x=o.getLabel();if(x.getLocation(e,w.ON)===m.NONE&&x.setLocation(e,w.ON,s),x.isArea(e)){var C=x.getLocation(e,w.LEFT),P=x.getLocation(e,w.RIGHT);if(P!==m.NONE){if(P!==s)throw new Jn("side location conflict",o.getCoordinate());C===m.NONE&&U.shouldNeverReachHere("found single null side (at "+o.getCoordinate()+")"),s=C}else U.isTrue(x.getLocation(e,w.LEFT)===m.NONE,"found single null side"),x.setLocation(e,w.RIGHT,s),x.setLocation(e,w.LEFT,s)}}};Qt.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};Qt.prototype.print=function(e){Ut.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};Qt.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Qt.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var r=t.size()-1,n=t.get(r).getLabel(),a=n.getLocation(e,w.LEFT);U.isTrue(a!==m.NONE,"Found unlabelled area edge");for(var s=a,f=this.iterator();f.hasNext();){var o=f.next(),x=o.getLabel();U.isTrue(x.isArea(e),"Found non-area edge");var C=x.getLocation(e,w.LEFT),P=x.getLocation(e,w.RIGHT);if(C===P||P!==s)return!1;s=C}return!0};Qt.prototype.findIndex=function(e){var t=this;this.iterator();for(var r=0;r<this._edgeList.size();r++){var n=t._edgeList.get(r);if(n===e)return r}return-1};Qt.prototype.iterator=function(){return this.getEdges().iterator()};Qt.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new b(this._edgeMap.values())),this._edgeList};Qt.prototype.getLocation=function(e,t,r){return this._ptInAreaLocation[e]===m.NONE&&(this._ptInAreaLocation[e]=Ce.locate(t,r[e].getGeometry())),this._ptInAreaLocation[e]};Qt.prototype.toString=function(){var e=new yn;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var r=t.next();e.append(r),e.append(`
`)}return e.toString()};Qt.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();r.computeLabel(e)}};Qt.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],n=this.iterator();n.hasNext();)for(var a=n.next(),s=a.getLabel(),f=0;f<2;f++)s.isLine(f)&&s.getLocation(f)===m.BOUNDARY&&(r[f]=!0);for(var o=this.iterator();o.hasNext();)for(var x=o.next(),C=x.getLabel(),P=0;P<2;P++)if(C.isAnyNull(P)){var Y=m.NONE;if(r[P])Y=m.EXTERIOR;else{var ze=x.getCoordinate();Y=t.getLocation(P,ze,e)}C.setAllLocationsIfNull(P,Y)}};Qt.prototype.getDegree=function(){return this._edgeMap.size()};Qt.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};Qt.prototype.interfaces_=function(){return[]};Qt.prototype.getClass=function(){return Qt};var Ac=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var r=this;this.getResultAreaEdges();for(var n=null,a=null,s=this._SCANNING_FOR_INCOMING,f=0;f<this._resultAreaEdgeList.size();f++){var o=r._resultAreaEdgeList.get(f),x=o.getSym();if(o.getLabel().isArea())switch(n===null&&o.isInResult()&&(n=o),s){case r._SCANNING_FOR_INCOMING:if(!x.isInResult())continue;a=x,s=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(!o.isInResult())continue;a.setNext(o),s=r._SCANNING_FOR_INCOMING;break}}if(s===this._LINKING_TO_OUTGOING){if(n===null)throw new Jn("no outgoing dirEdge found",this.getCoordinate());U.isTrue(n.isInResult(),"unable to link last incoming dirEdge"),a.setNext(n)}},t.prototype.insert=function(r){var n=r;this.insertEdgeEnd(n,n)},t.prototype.getRightmostEdge=function(){var r=this.getEdges(),n=r.size();if(n<1)return null;var a=r.get(0);if(n===1)return a;var s=r.get(n-1),f=a.getQuadrant(),o=s.getQuadrant();return it.isNorthern(f)&&it.isNorthern(o)?a:!it.isNorthern(f)&&!it.isNorthern(o)?s:a.getDy()!==0?a:s.getDy()!==0?s:(U.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(r){Ut.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var a=n.next();r.print("out "),a.print(r),r.println(),r.print("in "),a.getSym().print(r),r.println()}},t.prototype.getResultAreaEdges=function(){var r=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new b;for(var n=this.iterator();n.hasNext();){var a=n.next();(a.isInResult()||a.getSym().isInResult())&&r._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(r){for(var n=this.iterator();n.hasNext();){var a=n.next(),s=a.getLabel();s.setAllLocationsIfNull(0,r.getLocation(0)),s.setAllLocationsIfNull(1,r.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var r=this;this.getEdges();for(var n=null,a=null,s=this._edgeList.size()-1;s>=0;s--){var f=r._edgeList.get(s),o=f.getSym();a===null&&(a=o),n!==null&&o.setNext(n),n=f}a.setNext(n)},t.prototype.computeDepths=function(){var r=this;if(arguments.length===1){var n=arguments[0],a=this.findIndex(n),s=n.getDepth(w.LEFT),f=n.getDepth(w.RIGHT),o=this.computeDepths(a+1,this._edgeList.size(),s),x=this.computeDepths(0,a,o);if(x!==f)throw new Jn("depth mismatch at "+n.getCoordinate())}else if(arguments.length===3){for(var C=arguments[0],P=arguments[1],Y=arguments[2],ze=Y,ge=C;ge<P;ge++){var Bt=r._edgeList.get(ge);Bt.setEdgeDepths(w.RIGHT,ze),ze=Bt.getDepth(w.LEFT)}return ze}},t.prototype.mergeSymLabels=function(){for(var r=this.iterator();r.hasNext();){var n=r.next(),a=n.getLabel();a.merge(n.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(r){for(var n=this,a=null,s=null,f=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var x=n._resultAreaEdgeList.get(o),C=x.getSym();switch(a===null&&x.getEdgeRing()===r&&(a=x),f){case n._SCANNING_FOR_INCOMING:if(C.getEdgeRing()!==r)continue;s=C,f=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(x.getEdgeRing()!==r)continue;s.setNextMin(x),f=n._SCANNING_FOR_INCOMING;break}}f===this._LINKING_TO_OUTGOING&&(U.isTrue(a!==null,"found null for first outgoing dirEdge"),U.isTrue(a.getEdgeRing()===r,"unable to link last incoming dirEdge"),s.setNextMin(a))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var r=0,n=this.iterator();n.hasNext();){var a=n.next();a.isInResult()&&r++}return r}else if(arguments.length===1){for(var s=arguments[0],f=0,o=this.iterator();o.hasNext();){var x=o.next();x.getEdgeRing()===s&&f++}return f}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var r=m.NONE,n=this.iterator();n.hasNext();){var a=n.next(),s=a.getSym();if(!a.isLineEdge()){if(a.isInResult()){r=m.INTERIOR;break}if(s.isInResult()){r=m.EXTERIOR;break}}}if(r===m.NONE)return null;for(var f=r,o=this.iterator();o.hasNext();){var x=o.next(),C=x.getSym();x.isLineEdge()?x.getEdge().setCovered(f===m.INTERIOR):(x.isInResult()&&(f=m.EXTERIOR),C.isInResult()&&(f=m.INTERIOR))}},t.prototype.computeLabelling=function(r){var n=this;e.prototype.computeLabelling.call(this,r),this._label=new et(m.NONE);for(var a=this.iterator();a.hasNext();)for(var s=a.next(),f=s.getEdge(),o=f.getLabel(),x=0;x<2;x++){var C=o.getLocation(x);(C===m.INTERIOR||C===m.BOUNDARY)&&n._label.setLocation(x,m.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qt),Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(r){return new is(r,new Ac)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xi),fr=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};fr.prototype.compareTo=function(e){var t=e,r=fr.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return r};fr.prototype.interfaces_=function(){return[ke]};fr.prototype.getClass=function(){return fr};fr.orientation=function(e){return W.increasingDirection(e)===1};fr.compareOriented=function(e,t,r,n){for(var a=t?1:-1,s=n?1:-1,f=t?e.length:-1,o=n?r.length:-1,x=t?0:e.length-1,C=n?0:r.length-1;;){var P=e[x].compareTo(r[C]);if(P!==0)return P;x+=a,C+=s;var Y=x===f,ze=C===o;if(Y&&!ze)return-1;if(!Y&&ze)return 1;if(Y&&ze)return 0}};var We=function(){this._edges=new b,this._ocaMap=new jt};We.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var n=t._edges.get(r);r>0&&e.print(","),e.print("(");for(var a=n.getCoordinates(),s=0;s<a.length;s++)s>0&&e.print(","),e.print(a[s].x+" "+a[s].y);e.println(")")}e.print(")  ")};We.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next())};We.prototype.findEdgeIndex=function(e){for(var t=this,r=0;r<this._edges.size();r++)if(t._edges.get(r).equals(e))return r;return-1};We.prototype.iterator=function(){return this._edges.iterator()};We.prototype.getEdges=function(){return this._edges};We.prototype.get=function(e){return this._edges.get(e)};We.prototype.findEqualEdge=function(e){var t=new fr(e.getCoordinates()),r=this._ocaMap.get(t);return r};We.prototype.add=function(e){this._edges.add(e);var t=new fr(e.getCoordinates());this._ocaMap.put(t,e)};We.prototype.interfaces_=function(){return[]};We.prototype.getClass=function(){return We};var Rr=function(){};Rr.prototype.processIntersections=function(e,t,r,n){};Rr.prototype.isDone=function(){};Rr.prototype.interfaces_=function(){return[]};Rr.prototype.getClass=function(){return Rr};var Le=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Le.prototype.isTrivialIntersection=function(e,t,r,n){if(e===r&&this._li.getIntersectionNum()===1){if(Le.isAdjacentSegments(t,n))return!0;if(e.isClosed()){var a=e.size()-1;if(t===0&&n===a||n===0&&t===a)return!0}}return!1};Le.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Le.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Le.prototype.getLineIntersector=function(){return this._li};Le.prototype.hasProperIntersection=function(){return this._hasProper};Le.prototype.processIntersections=function(e,t,r,n){if(e===r&&t===n)return null;this.numTests++;var a=e.getCoordinates()[t],s=e.getCoordinates()[t+1],f=r.getCoordinates()[n],o=r.getCoordinates()[n+1];this._li.computeIntersection(a,s,f,o),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,r,n)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Le.prototype.hasIntersection=function(){return this._hasIntersection};Le.prototype.isDone=function(){return!1};Le.prototype.hasInteriorIntersection=function(){return this._hasInterior};Le.prototype.interfaces_=function(){return[Rr]};Le.prototype.getClass=function(){return Le};Le.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var hn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],r=arguments[2];this.coord=new v(e),this.segmentIndex=t,this.dist=r};hn.prototype.getSegmentIndex=function(){return this.segmentIndex};hn.prototype.getCoordinate=function(){return this.coord};hn.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};hn.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};hn.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};hn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};hn.prototype.getDistance=function(){return this.dist};hn.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};hn.prototype.interfaces_=function(){return[ke]};hn.prototype.getClass=function(){return hn};var Rn=function(){this._nodeMap=new jt,this.edge=null;var e=arguments[0];this.edge=e};Rn.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};Rn.prototype.iterator=function(){return this._nodeMap.values().iterator()};Rn.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var a=r.next(),s=t.createSplitEdge(n,a);e.add(s),n=a}};Rn.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};Rn.prototype.createSplitEdge=function(e,t){var r=this,n=t.segmentIndex-e.segmentIndex+2,a=this.edge.pts[t.segmentIndex],s=t.dist>0||!t.coord.equals2D(a);s||n--;var f=new Array(n).fill(null),o=0;f[o++]=new v(e.coord);for(var x=e.segmentIndex+1;x<=t.segmentIndex;x++)f[o++]=r.edge.pts[x];return s&&(f[o]=t.coord),new Go(f,new et(this.edge._label))};Rn.prototype.add=function(e,t,r){var n=new hn(e,t,r),a=this._nodeMap.get(n);return a!==null?a:(this._nodeMap.put(n,n),n)};Rn.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();if(r.coord.equals(e))return!0}return!1};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};var Or=function(){};Or.prototype.getChainStartIndices=function(e){var t=this,r=0,n=new b;n.add(new sn(r));do{var a=t.findChainEnd(e,r);n.add(new sn(a)),r=a}while(r<e.length-1);var s=Or.toIntArray(n);return s};Or.prototype.findChainEnd=function(e,t){for(var r=it.quadrant(e[t],e[t+1]),n=t+1;n<e.length;){var a=it.quadrant(e[n-1],e[n]);if(a!==r)break;n++}return n-1};Or.prototype.interfaces_=function(){return[]};Or.prototype.getClass=function(){return Or};Or.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),r=0;r<t.length;r++)t[r]=e.get(r).intValue();return t};var $n=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new T,this.env2=new T;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Or;this.startIndex=t.getChainStartIndices(this.pts)};$n.prototype.getCoordinates=function(){return this.pts};$n.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return t>r?t:r};$n.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return t<r?t:r};$n.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[r],t.startIndex[r+1],n)}else if(arguments.length===6){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3],x=arguments[4],C=arguments[5],P=this.pts[a],Y=this.pts[s],ze=f.pts[o],ge=f.pts[x];if(s-a===1&&x-o===1)return C.addIntersections(this.e,a,f.e,o),null;if(this.env1.init(P,Y),this.env2.init(ze,ge),!this.env1.intersects(this.env2))return null;var Bt=Math.trunc((a+s)/2),Ur=Math.trunc((o+x)/2);a<Bt&&(o<Ur&&this.computeIntersectsForChain(a,Bt,f,o,Ur,C),Ur<x&&this.computeIntersectsForChain(a,Bt,f,Ur,x,C)),Bt<s&&(o<Ur&&this.computeIntersectsForChain(Bt,s,f,o,Ur,C),Ur<x&&this.computeIntersectsForChain(Bt,s,f,Ur,x,C))}};$n.prototype.getStartIndexes=function(){return this.startIndex};$n.prototype.computeIntersects=function(e,t){for(var r=this,n=0;n<this.startIndex.length-1;n++)for(var a=0;a<e.startIndex.length-1;a++)r.computeIntersectsForChain(n,e,a,t)};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var Vt=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var r=0;r<2;r++)for(var n=0;n<3;n++)t._depth[r][n]=e.NULL_VALUE},Nu={NULL_VALUE:{configurable:!0}};Vt.prototype.getDepth=function(e,t){return this._depth[e][t]};Vt.prototype.setDepth=function(e,t,r){this._depth[e][t]=r};Vt.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var r=0;r<3;r++)if(e._depth[t][r]!==Vt.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var n=arguments[0];return this._depth[n][1]===Vt.NULL_VALUE}else if(arguments.length===2){var a=arguments[0],s=arguments[1];return this._depth[a][s]===Vt.NULL_VALUE}};Vt.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var r=e._depth[t][1];e._depth[t][2]<r&&(r=e._depth[t][2]),r<0&&(r=0);for(var n=1;n<3;n++){var a=0;e._depth[t][n]>r&&(a=1),e._depth[t][n]=a}}};Vt.prototype.getDelta=function(e){return this._depth[e][w.RIGHT]-this._depth[e][w.LEFT]};Vt.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?m.EXTERIOR:m.INTERIOR};Vt.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Vt.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],r=0;r<2;r++)for(var n=1;n<3;n++){var a=t.getLocation(r,n);(a===m.EXTERIOR||a===m.INTERIOR)&&(e.isNull(r,n)?e._depth[r][n]=Vt.depthAtLocation(a):e._depth[r][n]+=Vt.depthAtLocation(a))}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];o===m.INTERIOR&&this._depth[s][f]++}};Vt.prototype.interfaces_=function(){return[]};Vt.prototype.getClass=function(){return Vt};Vt.depthAtLocation=function(e){return e===m.EXTERIOR?0:e===m.INTERIOR?1:Vt.NULL_VALUE};Nu.NULL_VALUE.get=function(){return-1};Object.defineProperties(Vt,Nu);var Go=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new Rn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Vt,this._depthDelta=0,arguments.length===1){var r=arguments[0];t.call(this,r,null)}else if(arguments.length===2){var n=arguments[0],a=arguments[1];this.pts=n,this._label=a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var r=new Array(2).fill(null);r[0]=this.pts[0],r[1]=this.pts[1];var n=new t(r,et.toLineLabel(this._label));return n},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(r){this._isIsolated=r},t.prototype.setName=function(r){this._name=r},t.prototype.equals=function(r){var n=this;if(!(r instanceof t))return!1;var a=r;if(this.pts.length!==a.pts.length)return!1;for(var s=!0,f=!0,o=this.pts.length,x=0;x<this.pts.length;x++)if(n.pts[x].equals2D(a.pts[x])||(s=!1),n.pts[x].equals2D(a.pts[--o])||(f=!1),!s&&!f)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}},t.prototype.print=function(r){var n=this;r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&r.print(","),r.print(n.pts[a].x+" "+n.pts[a].y);r.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(r){t.updateIM(this._label,r)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(r){var n=this;r.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)r.print(n.pts[a]+" ");r.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new $n(this)),this._mce},t.prototype.getEnvelope=function(){var r=this;if(this._env===null){this._env=new T;for(var n=0;n<this.pts.length;n++)r._env.expandToInclude(r.pts[n])}return this._env},t.prototype.addIntersection=function(r,n,a,s){var f=new v(r.getIntersection(s)),o=n,x=r.getEdgeDistance(a,s),C=o+1;if(C<this.pts.length){var P=this.pts[C];f.equals2D(P)&&(o=C,x=0)}this.eiList.add(f,o,x)},t.prototype.toString=function(){var r=this,n=new yn;n.append("edge "+this._name+": "),n.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&n.append(","),n.append(r.pts[a].x+" "+r.pts[a].y);return n.append(")  "+this._label+" "+this._depthDelta),n.toString()},t.prototype.isPointwiseEqual=function(r){var n=this;if(this.pts.length!==r.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!n.pts[a].equals2D(r.pts[a]))return!1;return!0},t.prototype.setDepthDelta=function(r){this._depthDelta=r},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(r,n,a){for(var s=this,f=0;f<r.getIntersectionNum();f++)s.addIntersection(r,n,a,f)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];n.setAtLeastIfValid(r.getLocation(0,w.ON),r.getLocation(1,w.ON),1),r.isArea()&&(n.setAtLeastIfValid(r.getLocation(0,w.LEFT),r.getLocation(1,w.LEFT),2),n.setAtLeastIfValid(r.getLocation(0,w.RIGHT),r.getLocation(1,w.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Se),ee=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new We,this._bufParams=e||null};ee.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};ee.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var r=t.getLabel(),n=e.getLabel();t.isPointwiseEqual(e)||(n=new et(e.getLabel()),n.flip()),r.merge(n);var a=ee.depthDelta(n),s=t.getDepthDelta(),f=s+a;t.setDepthDelta(f)}else this._edgeList.add(e),e.setDepthDelta(ee.depthDelta(e.getLabel()))};ee.prototype.buildSubgraphs=function(e,t){for(var r=new b,n=e.iterator();n.hasNext();){var a=n.next(),s=a.getRightmostCoordinate(),f=new Zr(r),o=f.getDepth(s);a.computeDepth(o),a.findResultEdges(),r.add(a),t.add(a.getDirectedEdges(),a.getNodes())}};ee.prototype.createSubgraphs=function(e){for(var t=new b,r=e.getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isVisited()){var a=new re;a.create(n),t.add(a)}}return He.sort(t,He.reverseOrder()),t};ee.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};ee.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new qs,r=new zr;return r.setPrecisionModel(e),t.setSegmentIntersector(new Le(r)),t};ee.prototype.buffer=function(e,t){var r=this._workingPrecisionModel;r===null&&(r=e.getPrecisionModel()),this._geomFact=e.getFactory();var n=new le(r,this._bufParams),a=new Fe(e,t,n),s=a.getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,r),this._graph=new ht(new Cu),this._graph.addEdges(this._edgeList.getEdges());var f=this.createSubgraphs(this._graph),o=new ve(this._geomFact);this.buildSubgraphs(f,o);var x=o.getPolygons();if(x.size()<=0)return this.createEmptyResultGeometry();var C=this._geomFact.buildGeometry(x);return C};ee.prototype.computeNodedEdges=function(e,t){var r=this,n=this.getNoder(t);n.computeNodes(e);for(var a=n.getNodedSubstrings(),s=a.iterator();s.hasNext();){var f=s.next(),o=f.getCoordinates();if(!(o.length===2&&o[0].equals2D(o[1]))){var x=f.getData(),C=new Go(f.getCoordinates(),new et(x));r.insertUniqueEdge(C)}}};ee.prototype.setNoder=function(e){this._workingNoder=e};ee.prototype.interfaces_=function(){return[]};ee.prototype.getClass=function(){return ee};ee.depthDelta=function(e){var t=e.getLocation(0,w.LEFT),r=e.getLocation(0,w.RIGHT);return t===m.INTERIOR&&r===m.EXTERIOR?1:t===m.EXTERIOR&&r===m.INTERIOR?-1:0};ee.convertSegStrings=function(e){for(var t=new H,r=new b;e.hasNext();){var n=e.next(),a=t.createLineString(n.getCoordinates());r.add(a)}return t.buildGeometry(r)};var hr=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var r=arguments[0],n=arguments[1],a=arguments[2],s=arguments[3];this._noder=r,this._scaleFactor=n,this._offsetX=a,this._offsetY=s,this._isScaled=!this.isIntegerPrecision()}};hr.prototype.rescale=function(){var e=this;if(G(arguments[0],wt))for(var t=arguments[0],r=t.iterator();r.hasNext();){var n=r.next();e.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],s=0;s<a.length;s++)a[s].x=a[s].x/e._scaleFactor+e._offsetX,a[s].y=a[s].y/e._scaleFactor+e._offsetY;a.length===2&&a[0].equals2D(a[1])&&Ut.out.println(a)}};hr.prototype.scale=function(){var e=this;if(G(arguments[0],wt)){for(var t=arguments[0],r=new b,n=t.iterator();n.hasNext();){var a=n.next();r.add(new It(e.scale(a.getCoordinates()),a.getData()))}return r}else if(arguments[0]instanceof Array){for(var s=arguments[0],f=new Array(s.length).fill(null),o=0;o<s.length;o++)f[o]=new v(Math.round((s[o].x-e._offsetX)*e._scaleFactor),Math.round((s[o].y-e._offsetY)*e._scaleFactor),s[o].z);var x=W.removeRepeatedPoints(f);return x}};hr.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};hr.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};hr.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};hr.prototype.interfaces_=function(){return[br]};hr.prototype.getClass=function(){return hr};var gn=function(){this._li=new zr,this._segStrings=null;var e=arguments[0];this._segStrings=e},xu={fact:{configurable:!0}};gn.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var r=t.next(),n=r.getCoordinates();e.checkEndPtVertexIntersections(n[0],e._segStrings),e.checkEndPtVertexIntersections(n[n.length-1],e._segStrings)}else if(arguments.length===2){for(var a=arguments[0],s=arguments[1],f=s.iterator();f.hasNext();)for(var o=f.next(),x=o.getCoordinates(),C=1;C<x.length-1;C++)if(x[C].equals(a))throw new Kn("found endpt/interior pt intersection at index "+C+" :pt "+a)}};gn.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var r=t.next(),n=this._segStrings.iterator();n.hasNext();){var a=n.next();e.checkInteriorIntersections(r,a)}else if(arguments.length===2)for(var s=arguments[0],f=arguments[1],o=s.getCoordinates(),x=f.getCoordinates(),C=0;C<o.length-1;C++)for(var P=0;P<x.length-1;P++)e.checkInteriorIntersections(s,C,f,P);else if(arguments.length===4){var Y=arguments[0],ze=arguments[1],ge=arguments[2],Bt=arguments[3];if(Y===ge&&ze===Bt)return null;var Ur=Y.getCoordinates()[ze],kn=Y.getCoordinates()[ze+1],Io=ge.getCoordinates()[Bt],rl=ge.getCoordinates()[Bt+1];if(this._li.computeIntersection(Ur,kn,Io,rl),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Ur,kn)||this.hasInteriorIntersection(this._li,Io,rl)))throw new Kn("found non-noded intersection at "+Ur+"-"+kn+" and "+Io+"-"+rl)}};gn.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};gn.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var r=t.next();e.checkCollapses(r)}else if(arguments.length===1)for(var n=arguments[0],a=n.getCoordinates(),s=0;s<a.length-2;s++)e.checkCollapse(a[s],a[s+1],a[s+2])};gn.prototype.hasInteriorIntersection=function(e,t,r){for(var n=0;n<e.getIntersectionNum();n++){var a=e.getIntersection(n);if(!(a.equals(t)||a.equals(r)))return!0}return!1};gn.prototype.checkCollapse=function(e,t,r){if(e.equals(r))throw new Kn("found non-noded collapse at "+gn.fact.createLineString([e,t,r]))};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};xu.fact.get=function(){return new H};Object.defineProperties(gn,xu);var ce=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],r=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=r,t<=0)throw new ct("Scale factor must be non-zero");t!==1&&(this._pt=new v(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new v,this._p1Scaled=new v),this.initCorners(this._pt)},Su={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ce.prototype.intersectsScaled=function(e,t){var r=Math.min(e.x,t.x),n=Math.max(e.x,t.x),a=Math.min(e.y,t.y),s=Math.max(e.y,t.y),f=this._maxx<r||this._minx>n||this._maxy<a||this._miny>s;if(f)return!1;var o=this.intersectsToleranceSquare(e,t);return U.isTrue(!(f&&o),"Found bad envelope test"),o};ce.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new v(this._maxx,this._maxy),this._corner[1]=new v(this._minx,this._maxy),this._corner[2]=new v(this._minx,this._miny),this._corner[3]=new v(this._maxx,this._miny)};ce.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};ce.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};ce.prototype.getCoordinate=function(){return this._originalPt};ce.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};ce.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=ce.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new T(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};ce.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};ce.prototype.intersectsToleranceSquare=function(e,t){var r=!1,n=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||r&&n||e.equals(this._pt)||t.equals(this._pt))};ce.prototype.addSnappedNode=function(e,t){var r=e.getCoordinate(t),n=e.getCoordinate(t+1);return this.intersects(r,n)?(e.addIntersection(this.getCoordinate(),t),!0):!1};ce.prototype.interfaces_=function(){return[]};ce.prototype.getClass=function(){return ce};Su.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(ce,Su);var uo=function(){this.tempEnv1=new T,this.selectedSegment=new F};uo.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};var bi=function(){this._index=null;var e=arguments[0];this._index=e},wu={HotPixelSnapAction:{configurable:!0}};bi.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],a=t.getSafeEnvelope(),s=new Lu(t,r,n);return this._index.query(a,{interfaces_:function(){return[lr]},visitItem:function(f){var o=f;o.select(a,s)}}),s.isNodeAdded()}};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};wu.HotPixelSnapAction.get=function(){return Lu};Object.defineProperties(bi,wu);var Lu=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],n=arguments[1],a=arguments[2];this._hotPixel=r,this._parentEdge=n,this._hotPixelVertexIndex=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1],a=r.getContext();if(this._parentEdge!==null&&a===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(a,n)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(uo),$r=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new b};$r.prototype.processIntersections=function(e,t,r,n){var a=this;if(e===r&&t===n)return null;var s=e.getCoordinates()[t],f=e.getCoordinates()[t+1],o=r.getCoordinates()[n],x=r.getCoordinates()[n+1];if(this._li.computeIntersection(s,f,o,x),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var C=0;C<this._li.getIntersectionNum();C++)a._interiorIntersections.add(a._li.getIntersection(C));e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1)}};$r.prototype.isDone=function(){return!1};$r.prototype.getInteriorIntersections=function(){return this._interiorIntersections};$r.prototype.interfaces_=function(){return[Rr]};$r.prototype.getClass=function(){return $r};var On=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new zr,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};On.prototype.checkCorrectness=function(e){var t=It.getNodedSubstrings(e),r=new gn(t);try{r.checkValid()}catch(n){if(n instanceof cu)n.printStackTrace();else throw n}finally{}};On.prototype.getNodedSubstrings=function(){return It.getNodedSubstrings(this._nodedSegStrings)};On.prototype.snapRound=function(e,t){var r=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(r),this.computeVertexSnaps(e)};On.prototype.findInteriorIntersections=function(e,t){var r=new $r(t);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(e),r.getInteriorIntersections()};On.prototype.computeVertexSnaps=function(){var e=this;if(G(arguments[0],wt))for(var t=arguments[0],r=t.iterator();r.hasNext();){var n=r.next();e.computeVertexSnaps(n)}else if(arguments[0]instanceof It)for(var a=arguments[0],s=a.getCoordinates(),f=0;f<s.length;f++){var o=new ce(s[f],e._scaleFactor,e._li),x=e._pointSnapper.snap(o,a,f);x&&a.addIntersection(s[f],f)}};On.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new qs,this._pointSnapper=new bi(this._noder.getIndex()),this.snapRound(e,this._li)};On.prototype.computeIntersectionSnaps=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next(),a=new ce(n,t._scaleFactor,t._li);t._pointSnapper.snap(a)}};On.prototype.interfaces_=function(){return[br]};On.prototype.getClass=function(){return On};var zt=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Z,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._argGeom=t,this._bufParams=r}},Vi={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};zt.prototype.bufferFixedPrecision=function(e){var t=new hr(new On(new $(1)),e.getScale()),r=new ee(this._bufParams);r.setWorkingPrecisionModel(e),r.setNoder(t),this._resultGeometry=r.buffer(this._argGeom,this._distance)};zt.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=zt.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(s){if(s instanceof Jn)e._saveException=s;else throw s}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var r=arguments[0],n=zt.precisionScaleFactor(this._argGeom,this._distance,r),a=new $(n);this.bufferFixedPrecision(a)}};zt.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===$.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};zt.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};zt.prototype.bufferOriginalPrecision=function(){try{var e=new ee(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Kn)this._saveException=t;else throw t}finally{}};zt.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};zt.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new zt(e),n=r.getResultGeometry(t);return n}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof k&&typeof arguments[1]=="number"){var a=arguments[0],s=arguments[1],f=arguments[2],o=new zt(a);o.setQuadrantSegments(f);var x=o.getResultGeometry(s);return x}else if(arguments[2]instanceof Z&&arguments[0]instanceof k&&typeof arguments[1]=="number"){var C=arguments[0],P=arguments[1],Y=arguments[2],ze=new zt(C,Y),ge=ze.getResultGeometry(P);return ge}}else if(arguments.length===4){var Bt=arguments[0],Ur=arguments[1],kn=arguments[2],Io=arguments[3],rl=new zt(Bt);rl.setQuadrantSegments(kn),rl.setEndCapStyle(Io);var Co=rl.getResultGeometry(Ur);return Co}};zt.precisionScaleFactor=function(e,t,r){var n=e.getEnvelopeInternal(),a=xe.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY())),s=t>0?t:0,f=a+2*s,o=Math.trunc(Math.log(f)/Math.log(10)+1),x=r-o,C=Math.pow(10,x);return C};Vi.CAP_ROUND.get=function(){return Z.CAP_ROUND};Vi.CAP_BUTT.get=function(){return Z.CAP_FLAT};Vi.CAP_FLAT.get=function(){return Z.CAP_FLAT};Vi.CAP_SQUARE.get=function(){return Z.CAP_SQUARE};Vi.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(zt,Vi);var Zt=function(){this._pt=[new v,new v],this._distance=z.NaN,this._isNull=!0};Zt.prototype.getCoordinates=function(){return this._pt};Zt.prototype.getCoordinate=function(e){return this._pt[e]};Zt.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n<this._distance&&this.initialize(t,r,n)}};Zt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=a,this._isNull=!1}};Zt.prototype.getDistance=function(){return this._distance};Zt.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n>this._distance&&this.initialize(t,r,n)}};Zt.prototype.interfaces_=function(){return[]};Zt.prototype.getClass=function(){return Zt};var Cn=function(){};Cn.prototype.interfaces_=function(){return[]};Cn.prototype.getClass=function(){return Cn};Cn.computeDistance=function(){if(arguments[2]instanceof Zt&&arguments[0]instanceof pt&&arguments[1]instanceof v)for(var e=arguments[0],t=arguments[1],r=arguments[2],n=e.getCoordinates(),a=new F,s=0;s<n.length-1;s++){a.setCoordinates(n[s],n[s+1]);var f=a.closestPoint(t);r.setMinimum(f,t)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof Rt&&arguments[1]instanceof v){var o=arguments[0],x=arguments[1],C=arguments[2];Cn.computeDistance(o.getExteriorRing(),x,C);for(var P=0;P<o.getNumInteriorRing();P++)Cn.computeDistance(o.getInteriorRingN(P),x,C)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof k&&arguments[1]instanceof v){var Y=arguments[0],ze=arguments[1],ge=arguments[2];if(Y instanceof pt)Cn.computeDistance(Y,ze,ge);else if(Y instanceof Rt)Cn.computeDistance(Y,ze,ge);else if(Y instanceof ne)for(var Bt=Y,Ur=0;Ur<Bt.getNumGeometries();Ur++){var kn=Bt.getGeometryN(Ur);Cn.computeDistance(kn,ze,ge)}else ge.setMinimum(Y.getCoordinate(),ze)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof F&&arguments[1]instanceof v){var Io=arguments[0],rl=arguments[1],Co=arguments[2],as=Io.closestPoint(rl);Co.setMinimum(as,rl)}};var Dr=function(e){this._maxPtDist=new Zt,this._inputGeom=e||null},Xs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Dr.prototype.computeMaxMidpointDistance=function(e){var t=new gr(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Dr.prototype.computeMaxVertexDistance=function(e){var t=new ti(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Dr.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Dr.prototype.getDistancePoints=function(){return this._maxPtDist};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};Xs.MaxPointDistanceFilter.get=function(){return ti};Xs.MaxMidpointDistanceFilter.get=function(){return gr};Object.defineProperties(Dr,Xs);var ti=function(e){this._maxPtDist=new Zt,this._minPtDist=new Zt,this._geom=e||null};ti.prototype.filter=function(e){this._minPtDist.initialize(),Cn.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ti.prototype.getMaxPointDistance=function(){return this._maxPtDist};ti.prototype.interfaces_=function(){return[wn]};ti.prototype.getClass=function(){return ti};var gr=function(e){this._maxPtDist=new Zt,this._minPtDist=new Zt,this._geom=e||null};gr.prototype.filter=function(e,t){if(t===0)return null;var r=e.getCoordinate(t-1),n=e.getCoordinate(t),a=new v((r.x+n.x)/2,(r.y+n.y)/2);this._minPtDist.initialize(),Cn.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};gr.prototype.isDone=function(){return!1};gr.prototype.isGeometryChanged=function(){return!1};gr.prototype.getMaxPointDistance=function(){return this._maxPtDist};gr.prototype.interfaces_=function(){return[Xe]};gr.prototype.getClass=function(){return gr};var Wn=function(e){this._comps=e||null};Wn.prototype.filter=function(e){e instanceof Rt&&this._comps.add(e)};Wn.prototype.interfaces_=function(){return[un]};Wn.prototype.getClass=function(){return Wn};Wn.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Wn.getPolygons(e,new b)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t instanceof Rt?r.add(t):t instanceof ne&&t.apply(new Wn(r)),r}};var kt=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._lines=t,this._isForcedToLineString=r}};kt.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Ln){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof pt&&this._lines.add(e)};kt.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};kt.prototype.interfaces_=function(){return[Qn]};kt.prototype.getClass=function(){return kt};kt.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(kt.getLines(e))}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t.getFactory().buildGeometry(kt.getLines(t,r))}};kt.getLines=function(){if(arguments.length===1){var e=arguments[0];return kt.getLines(e,!1)}else if(arguments.length===2){if(G(arguments[0],wt)&&G(arguments[1],wt)){for(var t=arguments[0],r=arguments[1],n=t.iterator();n.hasNext();){var a=n.next();kt.getLines(a,r)}return r}else if(arguments[0]instanceof k&&typeof arguments[1]=="boolean"){var s=arguments[0],f=arguments[1],o=new b;return s.apply(new kt(o,f)),o}else if(arguments[0]instanceof k&&G(arguments[1],wt)){var x=arguments[0],C=arguments[1];return x instanceof pt?C.add(x):x.apply(new kt(C)),C}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&G(arguments[0],wt)&&G(arguments[1],wt)){for(var P=arguments[0],Y=arguments[1],ze=arguments[2],ge=P.iterator();ge.hasNext();){var Bt=ge.next();kt.getLines(Bt,Y,ze)}return Y}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof k&&G(arguments[1],wt)){var Ur=arguments[0],kn=arguments[1],Io=arguments[2];return Ur.apply(new kt(kn,Io)),kn}}};var je=function(){if(this._boundaryRule=Me.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new ct("Rule must be non-null");this._boundaryRule=e}};je.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof v&&arguments[1]instanceof Rt){var t=arguments[0],r=arguments[1];if(r.isEmpty())return m.EXTERIOR;var n=r.getExteriorRing(),a=this.locateInPolygonRing(t,n);if(a===m.EXTERIOR)return m.EXTERIOR;if(a===m.BOUNDARY)return m.BOUNDARY;for(var s=0;s<r.getNumInteriorRing();s++){var f=r.getInteriorRingN(s),o=e.locateInPolygonRing(t,f);if(o===m.INTERIOR)return m.EXTERIOR;if(o===m.BOUNDARY)return m.BOUNDARY}return m.INTERIOR}else if(arguments[0]instanceof v&&arguments[1]instanceof pt){var x=arguments[0],C=arguments[1];if(!C.getEnvelopeInternal().intersects(x))return m.EXTERIOR;var P=C.getCoordinates();return!C.isClosed()&&(x.equals(P[0])||x.equals(P[P.length-1]))?m.BOUNDARY:O.isOnLine(x,P)?m.INTERIOR:m.EXTERIOR}else if(arguments[0]instanceof v&&arguments[1]instanceof de){var Y=arguments[0],ze=arguments[1],ge=ze.getCoordinate();return ge.equals2D(Y)?m.INTERIOR:m.EXTERIOR}};je.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?O.locatePointInRing(e,t.getCoordinates()):m.EXTERIOR};je.prototype.intersects=function(e,t){return this.locate(e,t)!==m.EXTERIOR};je.prototype.updateLocationInfo=function(e){e===m.INTERIOR&&(this._isIn=!0),e===m.BOUNDARY&&this._numBoundaries++};je.prototype.computeLocation=function(e,t){var r=this;if(t instanceof de&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof pt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Rt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Lr)for(var n=t,a=0;a<n.getNumGeometries();a++){var s=n.getGeometryN(a);r.updateLocationInfo(r.locateInternal(e,s))}else if(t instanceof xn)for(var f=t,o=0;o<f.getNumGeometries();o++){var x=f.getGeometryN(o);r.updateLocationInfo(r.locateInternal(e,x))}else if(t instanceof ne)for(var C=new Sn(t);C.hasNext();){var P=C.next();P!==t&&r.computeLocation(e,P)}};je.prototype.locate=function(e,t){return t.isEmpty()?m.EXTERIOR:t instanceof pt?this.locateInternal(e,t):t instanceof Rt?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?m.BOUNDARY:this._numBoundaries>0||this._isIn?m.INTERIOR:m.EXTERIOR)};je.prototype.interfaces_=function(){return[]};je.prototype.getClass=function(){return je};var $t=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],r=arguments[1];e.call(this,t,e.INSIDE_AREA,r)}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];this._component=n,this._segIndex=a,this._pt=s}},bu={INSIDE_AREA:{configurable:!0}};$t.prototype.isInsideArea=function(){return this._segIndex===$t.INSIDE_AREA};$t.prototype.getCoordinate=function(){return this._pt};$t.prototype.getGeometryComponent=function(){return this._component};$t.prototype.getSegmentIndex=function(){return this._segIndex};$t.prototype.interfaces_=function(){return[]};$t.prototype.getClass=function(){return $t};bu.INSIDE_AREA.get=function(){return-1};Object.defineProperties($t,bu);var ir=function(e){this._pts=e||null};ir.prototype.filter=function(e){e instanceof de&&this._pts.add(e)};ir.prototype.interfaces_=function(){return[un]};ir.prototype.getClass=function(){return ir};ir.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof de?He.singletonList(e):ir.getPoints(e,new b)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t instanceof de?r.add(t):t instanceof ne&&t.apply(new ir(r)),r}};var ei=function(){this._locations=null;var e=arguments[0];this._locations=e};ei.prototype.filter=function(e){(e instanceof de||e instanceof pt||e instanceof Rt)&&this._locations.add(new $t(e,0,e.getCoordinate()))};ei.prototype.interfaces_=function(){return[un]};ei.prototype.getClass=function(){return ei};ei.getLocations=function(e){var t=new b;return e.apply(new ei(t)),t};var qt=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new je,this._minDistanceLocation=null,this._minDistance=z.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=n,this._terminateDistance=a}};qt.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=1-r,s=Wn.getPolygons(this._geom[r]);if(s.size()>0){var f=ei.getLocations(this._geom[a]);if(this.computeContainmentDistance(f,s,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[a]=n[0],this._minDistanceLocation[r]=n[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&G(arguments[0],Ue)&&G(arguments[1],Ue)){for(var o=arguments[0],x=arguments[1],C=arguments[2],P=0;P<o.size();P++)for(var Y=o.get(P),ze=0;ze<x.size();ze++)if(e.computeContainmentDistance(Y,x.get(ze),C),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof $t&&arguments[1]instanceof Rt){var ge=arguments[0],Bt=arguments[1],Ur=arguments[2],kn=ge.getCoordinate();if(m.EXTERIOR!==this._ptLocator.locate(kn,Bt))return this._minDistance=0,Ur[0]=ge,Ur[1]=new $t(Bt,kn),null}}};qt.prototype.computeMinDistanceLinesPoints=function(e,t,r){for(var n=this,a=0;a<e.size();a++)for(var s=e.get(a),f=0;f<t.size();f++){var o=t.get(f);if(n.computeMinDistance(s,o,r),n._minDistance<=n._terminateDistance)return null}};qt.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=kt.getLines(this._geom[0]),r=kt.getLines(this._geom[1]),n=ir.getPoints(this._geom[0]),a=ir.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,a,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(r,n,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(n,a,e),this.updateMinDistance(e,!1)};qt.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};qt.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};qt.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};qt.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof pt&&arguments[1]instanceof de){var t=arguments[0],r=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var a=t.getCoordinates(),s=r.getCoordinate(),f=0;f<a.length-1;f++){var o=O.distancePointLine(s,a[f],a[f+1]);if(o<e._minDistance){e._minDistance=o;var x=new F(a[f],a[f+1]),C=x.closestPoint(s);n[0]=new $t(t,f,C),n[1]=new $t(r,0,s)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof pt&&arguments[1]instanceof pt){var P=arguments[0],Y=arguments[1],ze=arguments[2];if(P.getEnvelopeInternal().distance(Y.getEnvelopeInternal())>this._minDistance)return null;for(var ge=P.getCoordinates(),Bt=Y.getCoordinates(),Ur=0;Ur<ge.length-1;Ur++)for(var kn=0;kn<Bt.length-1;kn++){var Io=O.distanceLineLine(ge[Ur],ge[Ur+1],Bt[kn],Bt[kn+1]);if(Io<e._minDistance){e._minDistance=Io;var rl=new F(ge[Ur],ge[Ur+1]),Co=new F(Bt[kn],Bt[kn+1]),as=rl.closestPoints(Co);ze[0]=new $t(P,Ur,as[0]),ze[1]=new $t(Y,kn,as[1])}if(e._minDistance<=e._terminateDistance)return null}}}};qt.prototype.computeMinDistancePoints=function(e,t,r){for(var n=this,a=0;a<e.size();a++)for(var s=e.get(a),f=0;f<t.size();f++){var o=t.get(f),x=s.getCoordinate().distance(o.getCoordinate());if(x<n._minDistance&&(n._minDistance=x,r[0]=new $t(s,0,s.getCoordinate()),r[1]=new $t(o,0,o.getCoordinate())),n._minDistance<=n._terminateDistance)return null}};qt.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new ct("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};qt.prototype.computeMinDistanceLines=function(e,t,r){for(var n=this,a=0;a<e.size();a++)for(var s=e.get(a),f=0;f<t.size();f++){var o=t.get(f);if(n.computeMinDistance(s,o,r),n._minDistance<=n._terminateDistance)return null}};qt.prototype.interfaces_=function(){return[]};qt.prototype.getClass=function(){return qt};qt.distance=function(e,t){var r=new qt(e,t);return r.distance()};qt.isWithinDistance=function(e,t,r){var n=new qt(e,t,r);return n.distance()<=r};qt.nearestPoints=function(e,t){var r=new qt(e,t);return r.nearestPoints()};var Wt=function(){this._pt=[new v,new v],this._distance=z.NaN,this._isNull=!0};Wt.prototype.getCoordinates=function(){return this._pt};Wt.prototype.getCoordinate=function(e){return this._pt[e]};Wt.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n<this._distance&&this.initialize(t,r,n)}};Wt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=a,this._isNull=!1}};Wt.prototype.toString=function(){return qe.toLineString(this._pt[0],this._pt[1])};Wt.prototype.getDistance=function(){return this._distance};Wt.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n>this._distance&&this.initialize(t,r,n)}};Wt.prototype.interfaces_=function(){return[]};Wt.prototype.getClass=function(){return Wt};var en=function(){};en.prototype.interfaces_=function(){return[]};en.prototype.getClass=function(){return en};en.computeDistance=function(){if(arguments[2]instanceof Wt&&arguments[0]instanceof pt&&arguments[1]instanceof v)for(var e=arguments[0],t=arguments[1],r=arguments[2],n=new F,a=e.getCoordinates(),s=0;s<a.length-1;s++){n.setCoordinates(a[s],a[s+1]);var f=n.closestPoint(t);r.setMinimum(f,t)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof Rt&&arguments[1]instanceof v){var o=arguments[0],x=arguments[1],C=arguments[2];en.computeDistance(o.getExteriorRing(),x,C);for(var P=0;P<o.getNumInteriorRing();P++)en.computeDistance(o.getInteriorRingN(P),x,C)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof k&&arguments[1]instanceof v){var Y=arguments[0],ze=arguments[1],ge=arguments[2];if(Y instanceof pt)en.computeDistance(Y,ze,ge);else if(Y instanceof Rt)en.computeDistance(Y,ze,ge);else if(Y instanceof ne)for(var Bt=Y,Ur=0;Ur<Bt.getNumGeometries();Ur++){var kn=Bt.getGeometryN(Ur);en.computeDistance(kn,ze,ge)}else ge.setMinimum(Y.getCoordinate(),ze)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof F&&arguments[1]instanceof v){var Io=arguments[0],rl=arguments[1],Co=arguments[2],as=Io.closestPoint(rl);Co.setMinimum(as,rl)}};var Te=function(){this._g0=null,this._g1=null,this._ptDist=new Wt,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},Ys={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Te.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Te.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new ct("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};Te.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};Te.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Te.prototype.computeOrientedDistance=function(e,t,r){var n=new ni(t);if(e.apply(n),r.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var a=new pr(t,this._densifyFrac);e.apply(a),r.setMaximum(a.getMaxPointDistance())}};Te.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Te.prototype.interfaces_=function(){return[]};Te.prototype.getClass=function(){return Te};Te.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new Te(e,t);return r.distance()}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2],f=new Te(n,a);return f.setDensifyFraction(s),f.distance()}};Ys.MaxPointDistanceFilter.get=function(){return ni};Ys.MaxDensifiedByFractionDistanceFilter.get=function(){return pr};Object.defineProperties(Te,Ys);var ni=function(){this._maxPtDist=new Wt,this._minPtDist=new Wt,this._euclideanDist=new en,this._geom=null;var e=arguments[0];this._geom=e};ni.prototype.filter=function(e){this._minPtDist.initialize(),en.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ni.prototype.getMaxPointDistance=function(){return this._maxPtDist};ni.prototype.interfaces_=function(){return[wn]};ni.prototype.getClass=function(){return ni};var pr=function(){this._maxPtDist=new Wt,this._minPtDist=new Wt,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};pr.prototype.filter=function(e,t){var r=this;if(t===0)return null;for(var n=e.getCoordinate(t-1),a=e.getCoordinate(t),s=(a.x-n.x)/this._numSubSegs,f=(a.y-n.y)/this._numSubSegs,o=0;o<this._numSubSegs;o++){var x=n.x+o*s,C=n.y+o*f,P=new v(x,C);r._minPtDist.initialize(),en.computeDistance(r._geom,P,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}};pr.prototype.isDone=function(){return!1};pr.prototype.isGeometryChanged=function(){return!1};pr.prototype.getMaxPointDistance=function(){return this._maxPtDist};pr.prototype.interfaces_=function(){return[Xe]};pr.prototype.getClass=function(){return pr};var pe=function(e,t,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=r||null},Hs={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};pe.prototype.checkMaximumDistance=function(e,t,r){var n=new Te(t,e);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var a=n.getCoordinates();this._errorLocation=a[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+qe.toLineString(a[0],a[1])+")"}};pe.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=pe.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),pe.VERBOSE&&Ut.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};pe.prototype.checkNegativeValid=function(){if(!(this._input instanceof Rt||this._input instanceof xn||this._input instanceof ne))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};pe.prototype.getErrorIndicator=function(){return this._errorIndicator};pe.prototype.checkMinimumDistance=function(e,t,r){var n=new qt(e,t,r);if(this._minDistanceFound=n.distance(),this._minDistanceFound<r){this._isValid=!1;var a=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+qe.toLineString(a[0],a[1])+" )"}};pe.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};pe.prototype.getErrorLocation=function(){return this._errorLocation};pe.prototype.getPolygonLines=function(e){for(var t=new b,r=new kt(t),n=Wn.getPolygons(e),a=n.iterator();a.hasNext();){var s=a.next();s.apply(r)}return e.getFactory().buildGeometry(t)};pe.prototype.getErrorMessage=function(){return this._errMsg};pe.prototype.interfaces_=function(){return[]};pe.prototype.getClass=function(){return pe};Hs.VERBOSE.get=function(){return!1};Hs.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(pe,Hs);var Xt=function(e,t,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=r||null},Ws={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Xt.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Xt.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Xt.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new T(this._input.getEnvelopeInternal());t.expandBy(this._distance);var r=new T(this._result.getEnvelopeInternal());r.expandBy(e),r.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")};Xt.prototype.checkDistance=function(){var e=new pe(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};Xt.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Xt.prototype.checkPolygonal=function(){this._result instanceof Rt||this._result instanceof xn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Xt.prototype.getErrorIndicator=function(){return this._errorIndicator};Xt.prototype.getErrorLocation=function(){return this._errorLocation};Xt.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Xt.prototype.report=function(e){if(!Xt.VERBOSE)return null;Ut.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};Xt.prototype.getErrorMessage=function(){return this._errorMsg};Xt.prototype.interfaces_=function(){return[]};Xt.prototype.getClass=function(){return Xt};Xt.isValidMsg=function(e,t,r){var n=new Xt(e,t,r);return n.isValid()?null:n.getErrorMessage()};Xt.isValid=function(e,t,r){var n=new Xt(e,t,r);return!!n.isValid()};Ws.VERBOSE.get=function(){return!1};Ws.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Xt,Ws);var pn=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};pn.prototype.getCoordinates=function(){return this._pts};pn.prototype.size=function(){return this._pts.length};pn.prototype.getCoordinate=function(e){return this._pts[e]};pn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};pn.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Jr.octant(this.getCoordinate(e),this.getCoordinate(e+1))};pn.prototype.setData=function(e){this._data=e};pn.prototype.getData=function(){return this._data};pn.prototype.toString=function(){return qe.toLineString(new yt(this._pts))};pn.prototype.interfaces_=function(){return[Pn]};pn.prototype.getClass=function(){return pn};var Mt=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new b,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Mt.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Mt.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Mt.prototype.getIntersectionSegments=function(){return this._intSegments};Mt.prototype.count=function(){return this._intersectionCount};Mt.prototype.getIntersections=function(){return this._intersections};Mt.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Mt.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Mt.prototype.processIntersections=function(e,t,r,n){if(!this._findAllIntersections&&this.hasIntersection()||e===r&&t===n)return null;if(this._isCheckEndSegmentsOnly){var a=this.isEndSegment(e,t)||this.isEndSegment(r,n);if(!a)return null}var s=e.getCoordinates()[t],f=e.getCoordinates()[t+1],o=r.getCoordinates()[n],x=r.getCoordinates()[n+1];this._li.computeIntersection(s,f,o,x),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=s,this._intSegments[1]=f,this._intSegments[2]=o,this._intSegments[3]=x,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Mt.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};Mt.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Mt.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Mt.prototype.interfaces_=function(){return[Rr]};Mt.prototype.getClass=function(){return Mt};Mt.createAllIntersectionsFinder=function(e){var t=new Mt(e);return t.setFindAllIntersections(!0),t};Mt.createAnyIntersectionFinder=function(e){return new Mt(e)};Mt.createIntersectionCounter=function(e){var t=new Mt(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Ke=function(){this._li=new zr,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Ke.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ke.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ke.prototype.isValid=function(){return this.execute(),this._isValid};Ke.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Ke.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Mt(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new qs;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ke.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Jn(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ke.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+qe.toLineString(e[0],e[1])+" and "+qe.toLineString(e[2],e[3])};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};Ke.computeIntersections=function(e){var t=new Ke(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Tr=function e(){this._nv=null;var t=arguments[0];this._nv=new Ke(e.toSegmentStrings(t))};Tr.prototype.checkValid=function(){this._nv.checkValid()};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.toSegmentStrings=function(e){for(var t=new b,r=e.iterator();r.hasNext();){var n=r.next();t.add(new pn(n.getCoordinates(),n))}return t};Tr.checkValid=function(e){var t=new Tr(e);t.checkValid()};var ri=function(e){this._mapOp=e};ri.prototype.map=function(e){for(var t=this,r=new b,n=0;n<e.getNumGeometries();n++){var a=t._mapOp.map(e.getGeometryN(n));a.isEmpty()||r.add(a)}return e.getFactory().createGeometryCollection(H.toGeometryArray(r))};ri.prototype.interfaces_=function(){return[]};ri.prototype.getClass=function(){return ri};ri.map=function(e,t){var r=new ri(t);return r.map(e)};var dn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new b,this._resultLineList=new b;var e=arguments[0],t=arguments[1],r=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=r};dn.prototype.collectLines=function(e){for(var t=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var n=r.next();t.collectLineEdge(n,e,t._lineEdgesList),t.collectBoundaryTouchEdge(n,e,t._lineEdgesList)}};dn.prototype.labelIsolatedLine=function(e,t){var r=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,r)};dn.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};dn.prototype.collectLineEdge=function(e,t,r){var n=e.getLabel(),a=e.getEdge();e.isLineEdge()&&!e.isVisited()&&V.isResultOfOp(n,t)&&!a.isCovered()&&(r.add(a),e.setVisitedEdge(!0))};dn.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var r=t.next();r.getEdges().findCoveredLineEdges()}for(var n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var a=n.next(),s=a.getEdge();if(a.isLineEdge()&&!s.isCoveredSet()){var f=e._op.isCoveredByA(a.getCoordinate());s.setCovered(f)}}};dn.prototype.labelIsolatedLines=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next(),a=n.getLabel();n.isIsolated()&&(a.isNull(0)?t.labelIsolatedLine(n,0):t.labelIsolatedLine(n,1))}};dn.prototype.buildLines=function(e){for(var t=this,r=this._lineEdgesList.iterator();r.hasNext();){var n=r.next(),a=t._geometryFactory.createLineString(n.getCoordinates());t._resultLineList.add(a),n.setInResult(!0)}};dn.prototype.collectBoundaryTouchEdge=function(e,t,r){var n=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;U.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),V.isResultOfOp(n,t)&&t===V.INTERSECTION&&(r.add(e.getEdge()),e.setVisitedEdge(!0))};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};var ii=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new b;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};ii.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var r=this._geometryFactory.createPoint(t);this._resultPointList.add(r)}};ii.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(n.getEdges().getDegree()===0||e===V.INTERSECTION)){var a=n.getLabel();V.isResultOfOp(a,e)&&t.filterCoveredNodeToPoint(n)}}};ii.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};var fe=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};fe.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};fe.prototype.transformPolygon=function(e,t){var r=this,n=!0,a=this.transformLinearRing(e.getExteriorRing(),e);(a===null||!(a instanceof Ln)||a.isEmpty())&&(n=!1);for(var s=new b,f=0;f<e.getNumInteriorRing();f++){var o=r.transformLinearRing(e.getInteriorRingN(f),e);o===null||o.isEmpty()||(o instanceof Ln||(n=!1),s.add(o))}if(n)return this._factory.createPolygon(a,s.toArray([]));var x=new b;return a!==null&&x.add(a),x.addAll(s),this._factory.buildGeometry(x)};fe.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};fe.prototype.getInputGeometry=function(){return this._inputGeom};fe.prototype.transformMultiLineString=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transformLineString(e.getGeometryN(a),e);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)};fe.prototype.transformCoordinates=function(e,t){return this.copy(e)};fe.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};fe.prototype.transformMultiPoint=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transformPoint(e.getGeometryN(a),e);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)};fe.prototype.transformMultiPolygon=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transformPolygon(e.getGeometryN(a),e);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)};fe.prototype.copy=function(e){return e.copy()};fe.prototype.transformGeometryCollection=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transform(e.getGeometryN(a));s!==null&&(r._pruneEmptyGeometry&&s.isEmpty()||n.add(s))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(H.toGeometryArray(n)):this._factory.buildGeometry(n)};fe.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof de)return this.transformPoint(e,null);if(e instanceof Ni)return this.transformMultiPoint(e,null);if(e instanceof Ln)return this.transformLinearRing(e,null);if(e instanceof pt)return this.transformLineString(e,null);if(e instanceof Lr)return this.transformMultiLineString(e,null);if(e instanceof Rt)return this.transformPolygon(e,null);if(e instanceof xn)return this.transformMultiPolygon(e,null);if(e instanceof ne)return this.transformGeometryCollection(e,null);throw new ct("Unknown Geometry subtype: "+e.getClass().getName())};fe.prototype.transformLinearRing=function(e,t){var r=this.transformCoordinates(e.getCoordinateSequence(),e);if(r===null)return this._factory.createLinearRing(null);var n=r.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};var Dn=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new F,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof pt&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1];e.call(this,t.getCoordinates(),r)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var n=arguments[0],a=arguments[1];this._srcPts=n,this._isClosed=e.isClosed(n),this._snapTolerance=a}};Dn.prototype.snapVertices=function(e,t){for(var r=this,n=this._isClosed?e.size()-1:e.size(),a=0;a<n;a++){var s=e.get(a),f=r.findSnapForVertex(s,t);f!==null&&(e.set(a,new v(f)),a===0&&r._isClosed&&e.set(e.size()-1,new v(f)))}};Dn.prototype.findSnapForVertex=function(e,t){for(var r=this,n=0;n<t.length;n++){if(e.equals2D(t[n]))return null;if(e.distance(t[n])<r._snapTolerance)return t[n]}return null};Dn.prototype.snapTo=function(e){var t=new po(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var r=t.toCoordinateArray();return r};Dn.prototype.snapSegments=function(e,t){var r=this;if(t.length===0)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var a=0;a<n;a++){var s=t[a],f=r.findSegmentIndexToSnap(s,e);f>=0&&e.add(f+1,new v(s),!1)}};Dn.prototype.findSegmentIndexToSnap=function(e,t){for(var r=this,n=z.MAX_VALUE,a=-1,s=0;s<t.size()-1;s++){if(r._seg.p0=t.get(s),r._seg.p1=t.get(s+1),r._seg.p0.equals2D(e)||r._seg.p1.equals2D(e)){if(r._allowSnappingToSourceVertices)continue;return-1}var f=r._seg.distance(e);f<r._snapTolerance&&f<n&&(n=f,a=s)}return a};Dn.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var mt=function(e){this._srcGeom=e||null},Pu={SNAP_PRECISION_FACTOR:{configurable:!0}};mt.prototype.snapTo=function(e,t){var r=this.extractTargetCoordinates(e),n=new Ru(t,r);return n.transform(this._srcGeom)};mt.prototype.snapToSelf=function(e,t){var r=this.extractTargetCoordinates(this._srcGeom),n=new Ru(e,r,!0),a=n.transform(this._srcGeom),s=a;return t&&G(s,ur)&&(s=a.buffer(0)),s};mt.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),r=t/10;return r};mt.prototype.extractTargetCoordinates=function(e){for(var t=new an,r=e.getCoordinates(),n=0;n<r.length;n++)t.add(r[n]);return t.toArray(new Array(0).fill(null))};mt.prototype.computeMinimumSegmentLength=function(e){for(var t=z.MAX_VALUE,r=0;r<e.length-1;r++){var n=e[r].distance(e[r+1]);n<t&&(t=n)}return t};mt.prototype.interfaces_=function(){return[]};mt.prototype.getClass=function(){return mt};mt.snap=function(e,t,r){var n=new Array(2).fill(null),a=new mt(e);n[0]=a.snapTo(t,r);var s=new mt(t);return n[1]=s.snapTo(n[0],r),n};mt.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=mt.computeSizeBasedSnapTolerance(e),r=e.getPrecisionModel();if(r.getType()===$.FIXED){var n=1/r.getScale()*2/1.415;n>t&&(t=n)}return t}else if(arguments.length===2){var a=arguments[0],s=arguments[1];return Math.min(mt.computeOverlaySnapTolerance(a),mt.computeOverlaySnapTolerance(s))}};mt.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),r=Math.min(t.getHeight(),t.getWidth()),n=r*mt.SNAP_PRECISION_FACTOR;return n};mt.snapToSelf=function(e,t,r){var n=new mt(e);return n.snapToSelf(t,r)};Pu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(mt,Pu);var Ru=function(e){function t(r,n,a){e.call(this),this._snapTolerance=r||null,this._snapPts=n||null,this._isSelfSnap=a!==void 0?a:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(r,n){var a=new Dn(r,this._snapTolerance);return a.setAllowSnappingToSourceVertices(this._isSelfSnap),a.snapTo(n)},t.prototype.transformCoordinates=function(r,n){var a=r.toCoordinateArray(),s=this.snapLine(a,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fe),Jt=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Jt.prototype.getCommon=function(){return z.longBitsToDouble(this._commonBits)};Jt.prototype.add=function(e){var t=z.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=Jt.signExpBits(this._commonBits),this._isFirst=!1,null;var r=Jt.signExpBits(t);if(r!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Jt.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=Jt.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Jt.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=z.longBitsToDouble(e),r=z.toBinaryString(e),n="0000000000000000000000000000000000000000000000000000000000000000"+r,a=n.substring(n.length-64),s=a.substring(0,1)+"  "+a.substring(1,12)+"(exp) "+a.substring(12)+" [ "+t+" ]";return s}};Jt.prototype.interfaces_=function(){return[]};Jt.prototype.getClass=function(){return Jt};Jt.getBit=function(e,t){var r=1<<t;return e&r?1:0};Jt.signExpBits=function(e){return e>>52};Jt.zeroLowerBits=function(e,t){var r=(1<<t)-1,n=~r,a=e&n;return a};Jt.numCommonMostSigMantissaBits=function(e,t){for(var r=0,n=52;n>=0;n--){if(Jt.getBit(e,n)!==Jt.getBit(t,n))return r;r++}return 52};var dr=function(){this._commonCoord=null,this._ccFilter=new oi},js={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};dr.prototype.addCommonBits=function(e){var t=new vr(this._commonCoord);e.apply(t),e.geometryChanged()};dr.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new v(this._commonCoord);t.x=-t.x,t.y=-t.y;var r=new vr(t);return e.apply(r),e.geometryChanged(),e};dr.prototype.getCommonCoordinate=function(){return this._commonCoord};dr.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};js.CommonCoordinateFilter.get=function(){return oi};js.Translater.get=function(){return vr};Object.defineProperties(dr,js);var oi=function(){this._commonBitsX=new Jt,this._commonBitsY=new Jt};oi.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};oi.prototype.getCommonCoordinate=function(){return new v(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};oi.prototype.interfaces_=function(){return[wn]};oi.prototype.getClass=function(){return oi};var vr=function(){this.trans=null;var e=arguments[0];this.trans=e};vr.prototype.filter=function(e,t){var r=e.getOrdinate(t,0)+this.trans.x,n=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,r),e.setOrdinate(t,1,n)};vr.prototype.isDone=function(){return!1};vr.prototype.isGeometryChanged=function(){return!0};vr.prototype.interfaces_=function(){return[Xe]};vr.prototype.getClass=function(){return vr};var At=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};At.prototype.selfSnap=function(e){var t=new mt(e),r=t.snapTo(e,this._snapTolerance);return r};At.prototype.removeCommonBits=function(e){this._cbr=new dr,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};At.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};At.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),r=V.overlayOp(t[0],t[1],e);return this.prepareResult(r)};At.prototype.checkValid=function(e){e.isValid()||Ut.out.println("Snapped geometry is invalid")};At.prototype.computeSnapTolerance=function(){this._snapTolerance=mt.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};At.prototype.snap=function(e){var t=this.removeCommonBits(e),r=mt.snap(t[0],t[1],this._snapTolerance);return r};At.prototype.interfaces_=function(){return[]};At.prototype.getClass=function(){return At};At.overlayOp=function(e,t,r){var n=new At(e,t);return n.getResultGeometry(r)};At.union=function(e,t){return At.overlayOp(e,t,V.UNION)};At.intersection=function(e,t){return At.overlayOp(e,t,V.INTERSECTION)};At.symDifference=function(e,t){return At.overlayOp(e,t,V.SYMDIFFERENCE)};At.difference=function(e,t){return At.overlayOp(e,t,V.DIFFERENCE)};var oe=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};oe.prototype.getResultGeometry=function(e){var t=null,r=!1,n=null;try{t=V.overlayOp(this._geom[0],this._geom[1],e);var a=!0;a&&(r=!0)}catch(s){if(s instanceof Kn)n=s;else throw s}finally{}if(!r)try{t=At.overlayOp(this._geom[0],this._geom[1],e)}catch(s){throw s instanceof Kn?n:s}finally{}return t};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.overlayOp=function(e,t,r){var n=new oe(e,t);return n.getResultGeometry(r)};oe.union=function(e,t){return oe.overlayOp(e,t,V.UNION)};oe.intersection=function(e,t){return oe.overlayOp(e,t,V.INTERSECTION)};oe.symDifference=function(e,t){return oe.overlayOp(e,t,V.SYMDIFFERENCE)};oe.difference=function(e,t){return oe.overlayOp(e,t,V.DIFFERENCE)};var lo=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};lo.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};lo.prototype.interfaces_=function(){return[]};lo.prototype.getClass=function(){return lo};var me=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],r=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=r}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];this._eventType=e.INSERT,this._label=n,this._xValue=a,this._obj=s}},Ks={INSERT:{configurable:!0},DELETE:{configurable:!0}};me.prototype.isDelete=function(){return this._eventType===me.DELETE};me.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};me.prototype.getObject=function(){return this._obj};me.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};me.prototype.getInsertEvent=function(){return this._insertEvent};me.prototype.isInsert=function(){return this._eventType===me.INSERT};me.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};me.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};me.prototype.interfaces_=function(){return[ke]};me.prototype.getClass=function(){return me};Ks.INSERT.get=function(){return 1};Ks.DELETE.get=function(){return 2};Object.defineProperties(me,Ks);var zo=function(){};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};var Yt=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],r=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=r};Yt.prototype.isTrivialIntersection=function(e,t,r,n){if(e===r&&this._li.getIntersectionNum()===1){if(Yt.isAdjacentSegments(t,n))return!0;if(e.isClosed()){var a=e.getNumPoints()-1;if(t===0&&n===a||n===0&&t===a)return!0}}return!1};Yt.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Yt.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Yt.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Yt.prototype.isBoundaryPointInternal=function(e,t){for(var r=t.iterator();r.hasNext();){var n=r.next(),a=n.getCoordinate();if(e.isIntersection(a))return!0}return!1};Yt.prototype.hasProperIntersection=function(){return this._hasProper};Yt.prototype.hasIntersection=function(){return this._hasIntersection};Yt.prototype.isDone=function(){return this._isDone};Yt.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};Yt.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};Yt.prototype.addIntersections=function(e,t,r,n){if(e===r&&t===n)return null;this.numTests++;var a=e.getCoordinates()[t],s=e.getCoordinates()[t+1],f=r.getCoordinates()[n],o=r.getCoordinates()[n+1];this._li.computeIntersection(a,s,f,o),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,r,n)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Yt.prototype.interfaces_=function(){return[]};Yt.prototype.getClass=function(){return Yt};Yt.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var Fc=function(e){function t(){e.call(this),this.events=new b,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var r=this;He.sort(this.events);for(var n=0;n<this.events.size();n++){var a=r.events.get(n);a.isDelete()&&a.getInsertEvent().setDeleteEventIndex(n)}},t.prototype.computeIntersections=function(){var r=this;if(arguments.length===1){var n=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var a=0;a<this.events.size();a++){var s=r.events.get(a);if(s.isInsert()&&r.processOverlaps(a,s.getDeleteEventIndex(),s,n),n.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Yt&&G(arguments[0],Ue)&&G(arguments[1],Ue)){var f=arguments[0],o=arguments[1],x=arguments[2];this.addEdges(f,f),this.addEdges(o,o),this.computeIntersections(x)}else if(typeof arguments[2]=="boolean"&&G(arguments[0],Ue)&&arguments[1]instanceof Yt){var C=arguments[0],P=arguments[1],Y=arguments[2];Y?this.addEdges(C,null):this.addEdges(C),this.computeIntersections(P)}}},t.prototype.addEdge=function(r,n){for(var a=this,s=r.getMonotoneChainEdge(),f=s.getStartIndexes(),o=0;o<f.length-1;o++){var x=new lo(s,o),C=new me(n,s.getMinX(o),x);a.events.add(C),a.events.add(new me(s.getMaxX(o),C))}},t.prototype.processOverlaps=function(r,n,a,s){for(var f=this,o=a.getObject(),x=r;x<n;x++){var C=f.events.get(x);if(C.isInsert()){var P=C.getObject();a.isSameLabel(C)||(o.computeIntersections(P,s),f.nOverlaps++)}}},t.prototype.addEdges=function(){var r=this;if(arguments.length===1)for(var n=arguments[0],a=n.iterator();a.hasNext();){var s=a.next();r.addEdge(s,s)}else if(arguments.length===2)for(var f=arguments[0],o=arguments[1],x=f.iterator();x.hasNext();){var C=x.next();r.addEdge(C,o)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(zo),Tn=function(){this._min=z.POSITIVE_INFINITY,this._max=z.NEGATIVE_INFINITY},Ou={NodeComparator:{configurable:!0}};Tn.prototype.getMin=function(){return this._min};Tn.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};Tn.prototype.getMax=function(){return this._max};Tn.prototype.toString=function(){return qe.toLineString(new v(this._min,0),new v(this._max,0))};Tn.prototype.interfaces_=function(){return[]};Tn.prototype.getClass=function(){return Tn};Ou.NodeComparator.get=function(){return co};Object.defineProperties(Tn,Ou);var co=function(){};co.prototype.compare=function(e,t){var r=e,n=t,a=(r._min+r._max)/2,s=(n._min+n._max)/2;return a<s?-1:a>s?1:0};co.prototype.interfaces_=function(){return[vi]};co.prototype.getClass=function(){return co};var Bc=function(e){function t(){e.call(this),this._item=null;var r=arguments[0],n=arguments[1],a=arguments[2];this._min=r,this._max=n,this._item=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(r,n,a){if(!this.intersects(r,n))return null;a.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tn),kc=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var r=arguments[0],n=arguments[1];this._node1=r,this._node2=n,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(r,n){this._min=Math.min(r._min,n._min),this._max=Math.max(r._max,n._max)},t.prototype.query=function(r,n,a){if(!this.intersects(r,n))return null;this._node1!==null&&this._node1.query(r,n,a),this._node2!==null&&this._node2.query(r,n,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tn),Mn=function(){this._leaves=new b,this._root=null,this._level=0};Mn.prototype.buildTree=function(){var e=this;He.sort(this._leaves,new Tn.NodeComparator);for(var t=this._leaves,r=null,n=new b;;){if(e.buildLevel(t,n),n.size()===1)return n.get(0);r=t,t=n,n=r}};Mn.prototype.insert=function(e,t,r){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Bc(e,t,r))};Mn.prototype.query=function(e,t,r){this.init(),this._root.query(e,t,r)};Mn.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Mn.prototype.printNode=function(e){Ut.out.println(qe.toLineString(new v(e._min,this._level),new v(e._max,this._level)))};Mn.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Mn.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var r=0;r<e.size();r+=2){var n=e.get(r),a=r+1<e.size()?e.get(r):null;if(a===null)t.add(n);else{var s=new kc(e.get(r),e.get(r+1));t.add(s)}}};Mn.prototype.interfaces_=function(){return[]};Mn.prototype.getClass=function(){return Mn};var Pi=function(){this._items=new b};Pi.prototype.visitItem=function(e){this._items.add(e)};Pi.prototype.getItems=function(){return this._items};Pi.prototype.interfaces_=function(){return[lr]};Pi.prototype.getClass=function(){return Pi};var Ri=function(){this._index=null;var e=arguments[0];if(!G(e,ur))throw new ct("Argument must be Polygonal");this._index=new Mr(e)},Qs={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Ri.prototype.locate=function(e){var t=new rn(e),r=new Oi(t);return this._index.query(e.y,e.y,r),t.getLocation()};Ri.prototype.interfaces_=function(){return[Li]};Ri.prototype.getClass=function(){return Ri};Qs.SegmentVisitor.get=function(){return Oi};Qs.IntervalIndexedGeometry.get=function(){return Mr};Object.defineProperties(Ri,Qs);var Oi=function(){this._counter=null;var e=arguments[0];this._counter=e};Oi.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Oi.prototype.interfaces_=function(){return[lr]};Oi.prototype.getClass=function(){return Oi};var Mr=function(){this._index=new Mn;var e=arguments[0];this.init(e)};Mr.prototype.init=function(e){for(var t=this,r=kt.getLines(e),n=r.iterator();n.hasNext();){var a=n.next(),s=a.getCoordinates();t.addLine(s)}};Mr.prototype.addLine=function(e){for(var t=this,r=1;r<e.length;r++){var n=new F(e[r-1],e[r]),a=Math.min(n.p0.y,n.p1.y),s=Math.max(n.p0.y,n.p1.y);t._index.insert(a,s,n)}};Mr.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new Pi;return this._index.query(e,t,r),r.getItems()}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];this._index.query(n,a,s)}};Mr.prototype.interfaces_=function(){return[]};Mr.prototype.getClass=function(){return Mr};var Xi=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new pu,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new je,arguments.length===2){var r=arguments[0],n=arguments[1],a=Me.OGC_SFS_BOUNDARY_RULE;this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=a,n!==null&&this.add(n)}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];this._argIndex=s,this._parentGeom=f,this._boundaryNodeRule=o,f!==null&&this.add(f)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(r,n){var a=this._nodes.addNode(n),s=a.getLabel(),f=1,o=m.NONE;o=s.getLocation(r,w.ON),o===m.BOUNDARY&&f++;var x=t.determineBoundary(this._boundaryNodeRule,f);s.setLocation(r,x)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.computeSelfNodes(r,n,!1)}else if(arguments.length===3){var a=arguments[0],s=arguments[1],f=arguments[2],o=new Yt(a,!0,!1);o.setIsDoneIfProperInt(f);var x=this.createEdgeSetIntersector(),C=this._parentGeom instanceof Ln||this._parentGeom instanceof Rt||this._parentGeom instanceof xn,P=s||!C;return x.computeIntersections(this._edges,o,P),this.addSelfIntersectionNodes(this._argIndex),o}},t.prototype.computeSplitEdges=function(r){for(var n=this._edges.iterator();n.hasNext();){var a=n.next();a.eiList.addSplitEdges(r)}},t.prototype.computeEdgeIntersections=function(r,n,a){var s=new Yt(n,a,!0);s.setBoundaryNodes(this.getBoundaryNodes(),r.getBoundaryNodes());var f=this.createEdgeSetIntersector();return f.computeIntersections(this._edges,r._edges,s),s},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof de){var r=arguments[0],n=r.getCoordinate();this.insertPoint(this._argIndex,n,m.INTERIOR)}else if(arguments[0]instanceof v){var a=arguments[0];this.insertPoint(this._argIndex,a,m.INTERIOR)}},t.prototype.addPolygon=function(r){var n=this;this.addPolygonRing(r.getExteriorRing(),m.EXTERIOR,m.INTERIOR);for(var a=0;a<r.getNumInteriorRing();a++){var s=r.getInteriorRingN(a);n.addPolygonRing(s,m.INTERIOR,m.EXTERIOR)}},t.prototype.addEdge=function(r){this.insertEdge(r);var n=r.getCoordinates();this.insertPoint(this._argIndex,n[0],m.BOUNDARY),this.insertPoint(this._argIndex,n[n.length-1],m.BOUNDARY)},t.prototype.addLineString=function(r){var n=W.removeRepeatedPoints(r.getCoordinates());if(n.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var a=new Go(n,new et(this._argIndex,m.INTERIOR));this._lineEdgeMap.put(r,a),this.insertEdge(a),U.isTrue(n.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,n[0]),this.insertBoundaryPoint(this._argIndex,n[n.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var r=this.getBoundaryNodes(),n=new Array(r.size()).fill(null),a=0,s=r.iterator();s.hasNext();){var f=s.next();n[a++]=f.getCoordinate().copy()}return n},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(r,n,a){if(this.isBoundaryNode(r,n))return null;a===m.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(r,n):this.insertPoint(r,n,a)},t.prototype.addPolygonRing=function(r,n,a){if(r.isEmpty())return null;var s=W.removeRepeatedPoints(r.getCoordinates());if(s.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=s[0],null;var f=n,o=a;O.isCCW(s)&&(f=a,o=n);var x=new Go(s,new et(this._argIndex,m.BOUNDARY,f,o));this._lineEdgeMap.put(r,x),this.insertEdge(x),this.insertPoint(this._argIndex,s[0],m.BOUNDARY)},t.prototype.insertPoint=function(r,n,a){var s=this._nodes.addNode(n),f=s.getLabel();f===null?s._label=new et(r,a):f.setLocation(r,a)},t.prototype.createEdgeSetIntersector=function(){return new Fc},t.prototype.addSelfIntersectionNodes=function(r){for(var n=this,a=this._edges.iterator();a.hasNext();)for(var s=a.next(),f=s.getLabel().getLocation(r),o=s.eiList.iterator();o.hasNext();){var x=o.next();n.addSelfIntersectionNode(r,x.coord,f)}},t.prototype.add=function(){if(arguments.length===1){var r=arguments[0];if(r.isEmpty())return null;if(r instanceof xn&&(this._useBoundaryDeterminationRule=!1),r instanceof Rt)this.addPolygon(r);else if(r instanceof pt)this.addLineString(r);else if(r instanceof de)this.addPoint(r);else if(r instanceof Ni)this.addCollection(r);else if(r instanceof Lr)this.addCollection(r);else if(r instanceof xn)this.addCollection(r);else if(r instanceof ne)this.addCollection(r);else throw new Error(r.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(r){for(var n=this,a=0;a<r.getNumGeometries();a++){var s=r.getGeometryN(a);n.add(s)}},t.prototype.locate=function(r){return G(this._parentGeom,ur)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Ri(this._parentGeom)),this._areaPtLocator.locate(r)):this._ptLocator.locate(r,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var r=arguments[0];return this._lineEdgeMap.get(r)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(r,n){return r.isInBoundary(n)?m.BOUNDARY:m.INTERIOR},t}(ht),Di=function(){if(this._li=new zr,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Xi(0,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=Me.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Xi(0,t,n),this._arg[1]=new Xi(1,r,n)}else if(arguments.length===3){var a=arguments[0],s=arguments[1],f=arguments[2];a.getPrecisionModel().compareTo(s.getPrecisionModel())>=0?this.setComputationPrecision(a.getPrecisionModel()):this.setComputationPrecision(s.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Xi(0,a,f),this._arg[1]=new Xi(1,s,f)}};Di.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Di.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};var xr=function(){};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.map=function(){if(arguments[0]instanceof k&&G(arguments[1],xr.MapOp)){for(var e=arguments[0],t=arguments[1],r=new b,n=0;n<e.getNumGeometries();n++){var a=t.map(e.getGeometryN(n));a!==null&&r.add(a)}return e.getFactory().buildGeometry(r)}else if(G(arguments[0],wt)&&G(arguments[1],xr.MapOp)){for(var s=arguments[0],f=arguments[1],o=new b,x=s.iterator();x.hasNext();){var C=x.next(),P=f.map(C);P!==null&&o.add(P)}return o}};xr.MapOp=function(){};var V=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n),this._ptLocator=new je,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new We,this._resultPolyList=new b,this._resultLineList=new b,this._resultPointList=new b,this._graph=new ht(new Cu),this._geomFact=r.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(r){var n=this._edgeList.findEqualEdge(r);if(n!==null){var a=n.getLabel(),s=r.getLabel();n.isPointwiseEqual(r)||(s=new et(r.getLabel()),s.flip());var f=n.getDepth();f.isNull()&&f.add(a),f.add(s),a.merge(s)}else this._edgeList.add(r)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var n=r.next(),a=n.getSym();n.isInResult()&&a.isInResult()&&(n.setInResult(!1),a.setInResult(!1))}},t.prototype.isCoveredByLA=function(r){return!!(this.isCovered(r,this._resultLineList)||this.isCovered(r,this._resultPolyList))},t.prototype.computeGeometry=function(r,n,a,s){var f=new b;return f.addAll(r),f.addAll(n),f.addAll(a),f.isEmpty()?t.createEmptyResult(s,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(f)},t.prototype.mergeSymLabels=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var n=r.next();n.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(r,n){for(var a=this,s=n.iterator();s.hasNext();){var f=s.next(),o=a._ptLocator.locate(r,f);if(o!==m.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var r=new b,n=this._edgeList.iterator();n.hasNext();){var a=n.next();a.isCollapsed()&&(n.remove(),r.add(a.getCollapsedEdge()))}this._edgeList.addAll(r)},t.prototype.updateNodeLabelling=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var n=r.next(),a=n.getEdges().getLabel();n.getLabel().merge(a)}},t.prototype.getResultGeometry=function(r){return this.computeOverlay(r),this._resultGeom},t.prototype.insertUniqueEdges=function(r){for(var n=this,a=r.iterator();a.hasNext();){var s=a.next();n.insertUniqueEdge(s)}},t.prototype.computeOverlay=function(r){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var n=new b;this._arg[0].computeSplitEdges(n),this._arg[1].computeSplitEdges(n),this.insertUniqueEdges(n),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Tr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(r),this.cancelDuplicateResultEdges();var a=new ve(this._geomFact);a.add(this._graph),this._resultPolyList=a.getPolygons();var s=new dn(this,this._geomFact,this._ptLocator);this._resultLineList=s.build(r);var f=new ii(this,this._geomFact,this._ptLocator);this._resultPointList=f.build(r),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,r)},t.prototype.labelIncompleteNode=function(r,n){var a=this._ptLocator.locate(r.getCoordinate(),this._arg[n].getGeometry());r.getLabel().setLocation(n,a)},t.prototype.copyPoints=function(r){for(var n=this,a=this._arg[r].getNodeIterator();a.hasNext();){var s=a.next(),f=n._graph.addNode(s.getCoordinate());f.setLabel(r,s.getLabel().getLocation(r))}},t.prototype.findResultAreaEdges=function(r){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var a=n.next(),s=a.getLabel();s.isArea()&&!a.isInteriorAreaEdge()&&t.isResultOfOp(s.getLocation(0,w.RIGHT),s.getLocation(1,w.RIGHT),r)&&a.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var r=this._edgeList.iterator();r.hasNext();){var n=r.next(),a=n.getLabel(),s=n.getDepth();if(!s.isNull()){s.normalize();for(var f=0;f<2;f++)!a.isNull(f)&&a.isArea()&&!s.isNull(f)&&(s.getDelta(f)===0?a.toLine(f):(U.isTrue(!s.isNull(f,w.LEFT),"depth of LEFT side has not been initialized"),a.setLocation(f,w.LEFT,s.getLocation(f,w.LEFT)),U.isTrue(!s.isNull(f,w.RIGHT),"depth of RIGHT side has not been initialized"),a.setLocation(f,w.RIGHT,s.getLocation(f,w.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var r=this,n=this._graph.getNodes().iterator();n.hasNext();){var a=n.next();a.getEdges().computeLabelling(r._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var r=this,n=this._graph.getNodes().iterator();n.hasNext();){var a=n.next(),s=a.getLabel();a.isIsolated()&&(s.isNull(0)?r.labelIncompleteNode(a,0):r.labelIncompleteNode(a,1)),a.getEdges().updateLabelling(s)}},t.prototype.isCoveredByA=function(r){return!!this.isCovered(r,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Di);V.overlayOp=function(e,t,r){var n=new V(e,t),a=n.getResultGeometry(r);return a};V.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return V.createEmptyResult(V.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var r=t;return ri.map(e,{interfaces_:function(){return[xr.MapOp]},map:function(n){return n.intersection(r)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.INTERSECTION)};V.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return V.createEmptyResult(V.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.SYMDIFFERENCE)};V.resultDimension=function(e,t,r){var n=t.getDimension(),a=r.getDimension(),s=-1;switch(e){case V.INTERSECTION:s=Math.min(n,a);break;case V.UNION:s=Math.max(n,a);break;case V.DIFFERENCE:s=n;break;case V.SYMDIFFERENCE:s=Math.max(n,a);break}return s};V.createEmptyResult=function(e,t,r,n){var a=null;switch(V.resultDimension(e,t,r)){case-1:a=n.createGeometryCollection(new Array(0).fill(null));break;case 0:a=n.createPoint();break;case 1:a=n.createLineString();break;case 2:a=n.createPolygon();break}return a};V.difference=function(e,t){return e.isEmpty()?V.createEmptyResult(V.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.DIFFERENCE))};V.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=e.getLocation(0),n=e.getLocation(1);return V.isResultOfOp(r,n,t)}else if(arguments.length===3){var a=arguments[0],s=arguments[1],f=arguments[2];switch(a===m.BOUNDARY&&(a=m.INTERIOR),s===m.BOUNDARY&&(s=m.INTERIOR),f){case V.INTERSECTION:return a===m.INTERIOR&&s===m.INTERIOR;case V.UNION:return a===m.INTERIOR||s===m.INTERIOR;case V.DIFFERENCE:return a===m.INTERIOR&&s!==m.INTERIOR;case V.SYMDIFFERENCE:return a===m.INTERIOR&&s!==m.INTERIOR||a!==m.INTERIOR&&s===m.INTERIOR}return!1}};V.INTERSECTION=1;V.UNION=2;V.DIFFERENCE=3;V.SYMDIFFERENCE=4;var or=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new je,this._seg=new F;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};or.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,r=0;r<this._linework.getNumGeometries();r++)for(var n=t._linework.getGeometryN(r),a=n.getCoordinateSequence(),s=0;s<a.size()-1;s++){a.getCoordinate(s,t._seg.p0),a.getCoordinate(s+1,t._seg.p1);var f=t._seg.distance(e);if(f<=t._boundaryDistanceTolerance)return!0}return!1};or.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?m.BOUNDARY:this._ptLocator.locate(e,this._g)};or.prototype.extractLinework=function(e){var t=new Ti;e.apply(t);var r=t.getLinework(),n=H.toLineStringArray(r);return e.getFactory().createMultiLineString(n)};or.prototype.interfaces_=function(){return[]};or.prototype.getClass=function(){return or};var Ti=function(){this._linework=null,this._linework=new b};Ti.prototype.getLinework=function(){return this._linework};Ti.prototype.filter=function(e){var t=this;if(e instanceof Rt){var r=e;this._linework.add(r.getExteriorRing());for(var n=0;n<r.getNumInteriorRing();n++)t._linework.add(r.getInteriorRingN(n))}};Ti.prototype.interfaces_=function(){return[un]};Ti.prototype.getClass=function(){return Ti};var Ar=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};Ar.prototype.extractPoints=function(e,t,r){for(var n=this,a=e.getCoordinates(),s=0;s<a.length-1;s++)n.computeOffsetPoints(a[s],a[s+1],t,r)};Ar.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};Ar.prototype.getPoints=function(e){for(var t=this,r=new b,n=kt.getLines(this._g),a=n.iterator();a.hasNext();){var s=a.next();t.extractPoints(s,e,r)}return r};Ar.prototype.computeOffsetPoints=function(e,t,r,n){var a=t.x-e.x,s=t.y-e.y,f=Math.sqrt(a*a+s*s),o=r*a/f,x=r*s/f,C=(t.x+e.x)/2,P=(t.y+e.y)/2;if(this._doLeft){var Y=new v(C-x,P+o);n.add(Y)}if(this._doRight){var ze=new v(C+x,P-o);n.add(ze)}};Ar.prototype.interfaces_=function(){return[]};Ar.prototype.getClass=function(){return Ar};var be=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new b;var t=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,r),this._geom=[t,r,n],this._locFinder=[new or(this._geom[0],this._boundaryDistanceTolerance),new or(this._geom[1],this._boundaryDistanceTolerance),new or(this._geom[2],this._boundaryDistanceTolerance)]},Du={TOLERANCE:{configurable:!0}};be.prototype.reportResult=function(e,t,r){Ut.out.println("Overlay result invalid - A:"+m.toLocationSymbol(t[0])+" B:"+m.toLocationSymbol(t[1])+" expected:"+(r?"i":"e")+" actual:"+m.toLocationSymbol(t[2]))};be.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};be.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],r=0;r<this._testCoords.size();r++){var n=e._testCoords.get(r);if(!e.checkValid(t,n))return e._invalidLocation=n,!1}return!0}else if(arguments.length===2){var a=arguments[0],s=arguments[1];return this._location[0]=this._locFinder[0].getLocation(s),this._location[1]=this._locFinder[1].getLocation(s),this._location[2]=this._locFinder[2].getLocation(s),be.hasLocation(this._location,m.BOUNDARY)?!0:this.isValidResult(a,this._location)}};be.prototype.addTestPts=function(e){var t=new Ar(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};be.prototype.isValidResult=function(e,t){var r=V.isResultOfOp(t[0],t[1],e),n=t[2]===m.INTERIOR,a=!(r^n);return a||this.reportResult(e,t,r),a};be.prototype.getInvalidLocation=function(){return this._invalidLocation};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};be.hasLocation=function(e,t){for(var r=0;r<3;r++)if(e[r]===t)return!0;return!1};be.computeBoundaryDistanceTolerance=function(e,t){return Math.min(mt.computeSizeBasedSnapTolerance(e),mt.computeSizeBasedSnapTolerance(t))};be.isValid=function(e,t,r,n){var a=new be(e,t,n);return a.isValid(r)};Du.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(be,Du);var Ie=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Ie.prototype.extractElements=function(e,t){var r=this;if(e===null)return null;for(var n=0;n<e.getNumGeometries();n++){var a=e.getGeometryN(n);r._skipEmpty&&a.isEmpty()||t.add(a)}};Ie.prototype.combine=function(){for(var e=this,t=new b,r=this._inputGeoms.iterator();r.hasNext();){var n=r.next();e.extractElements(n,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Ie.prototype.interfaces_=function(){return[]};Ie.prototype.getClass=function(){return Ie};Ie.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Ie(e);return t.combine()}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=new Ie(Ie.createList(r,n));return a.combine()}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2],x=new Ie(Ie.createList(s,f,o));return x.combine()}};Ie.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Ie.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new b;return r.add(e),r.add(t),r}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2],f=new b;return f.add(n),f.add(a),f.add(s),f}};var Nt=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new b)},Tu={STRTREE_NODE_CAPACITY:{configurable:!0}};Nt.prototype.reduceToGeometries=function(e){for(var t=this,r=new b,n=e.iterator();n.hasNext();){var a=n.next(),s=null;G(a,Ue)?s=t.unionTree(a):a instanceof k&&(s=a),r.add(s)}return r};Nt.prototype.extractByEnvelope=function(e,t,r){for(var n=new b,a=0;a<t.getNumGeometries();a++){var s=t.getGeometryN(a);s.getEnvelopeInternal().intersects(e)?n.add(s):r.add(s)}return this._geomFactory.buildGeometry(n)};Nt.prototype.unionOptimized=function(e,t){var r=e.getEnvelopeInternal(),n=t.getEnvelopeInternal();if(!r.intersects(n)){var a=Ie.combine(e,t);return a}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var s=r.intersection(n);return this.unionUsingEnvelopeIntersection(e,t,s)};Nt.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new mu(Nt.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var r=t.next();e.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var n=e.itemsTree(),a=this.unionTree(n);return a};Nt.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2];if(n-r<=1){var a=Nt.getGeometry(t,r);return this.unionSafe(a,null)}else{if(n-r===2)return this.unionSafe(Nt.getGeometry(t,r),Nt.getGeometry(t,r+1));var s=Math.trunc((n+r)/2),f=this.binaryUnion(t,r,s),o=this.binaryUnion(t,s,n);return this.unionSafe(f,o)}}};Nt.prototype.repeatedUnion=function(e){for(var t=null,r=e.iterator();r.hasNext();){var n=r.next();t===null?t=n.copy():t=t.union(n)}return t};Nt.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};Nt.prototype.unionActual=function(e,t){return Nt.restrictToPolygons(e.union(t))};Nt.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),r=this.binaryUnion(t);return r};Nt.prototype.unionUsingEnvelopeIntersection=function(e,t,r){var n=new b,a=this.extractByEnvelope(r,e,n),s=this.extractByEnvelope(r,t,n),f=this.unionActual(a,s);n.add(f);var o=Ie.combine(n);return o};Nt.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),r=t.buildGeometry(e),n=r.buffer(0);return n}else if(arguments.length===2){var a=arguments[0],s=arguments[1],f=a.getFactory(),o=f.createGeometryCollection([a,s]),x=o.buffer(0);return x}};Nt.prototype.interfaces_=function(){return[]};Nt.prototype.getClass=function(){return Nt};Nt.restrictToPolygons=function(e){if(G(e,ur))return e;var t=Wn.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(H.toPolygonArray(t))};Nt.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};Nt.union=function(e){var t=new Nt(e);return t.union()};Tu.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Nt,Tu);var Vo=function(){};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};Vo.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return V.createEmptyResult(V.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.UNION)};function Vr(){return new Uo}function Uo(){this.reset()}Uo.prototype={constructor:Uo,reset:function(){this.s=this.t=0},add:function(e){ba(xo,e,this.t),ba(this,xo.s,this.s),this.s?this.t+=xo.t:this.s=xo.t},valueOf:function(){return this.s}};var xo=new Uo;function ba(e,t,r){var n=e.s=t+r,a=n-t,s=n-a;e.t=t-s+(r-a)}var gt=1e-6,ot=Math.PI,Hn=ot/2,Pa=ot/4,tr=ot*2,Er=180/ot,$e=ot/180,te=Math.abs,Gc=Math.atan,Mi=Math.atan2,Lt=Math.cos,bt=Math.sin,Eo=Math.sqrt;function Mu(e){return e>1?0:e<-1?ot:Math.acos(e)}function Ai(e){return e>1?Hn:e<-1?-Hn:Math.asin(e)}function Yi(){}function qo(e,t){e&&Oa.hasOwnProperty(e.type)&&Oa[e.type](e,t)}var Ra={Feature:function(e,t){qo(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,a=r.length;++n<a;)qo(r[n].geometry,t)}},Oa={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,a=r.length;++n<a;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ps(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,a=r.length;++n<a;)Ps(r[n],t,0)},Polygon:function(e,t){Da(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,a=r.length;++n<a;)Da(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,a=r.length;++n<a;)qo(r[n],t)}};function Ps(e,t,r){var n=-1,a=e.length-r,s;for(t.lineStart();++n<a;)s=e[n],t.point(s[0],s[1],s[2]);t.lineEnd()}function Da(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)Ps(e[r],t,1);t.polygonEnd()}function zc(e,t){e&&Ra.hasOwnProperty(e.type)?Ra[e.type](e,t):qo(e,t)}Vr();Vr();function Rs(e){return[Mi(e[1],e[0]),Ai(e[2])]}function Fi(e){var t=e[0],r=e[1],n=Lt(r);return[n*Lt(t),n*bt(t),bt(r)]}function So(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xo(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function ds(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function wo(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Os(e){var t=Eo(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}Vr();function Au(e,t){function r(n,a){return n=e(n,a),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,a){return n=t.invert(n,a),n&&e.invert(n[0],n[1])}),r}function Ds(e,t){return[e>ot?e-tr:e<-ot?e+tr:e,t]}Ds.invert=Ds;function Vc(e,t,r){return(e%=tr)?t||r?Au(Ma(e),Aa(t,r)):Ma(e):t||r?Aa(t,r):Ds}function Ta(e){return function(t,r){return t+=e,[t>ot?t-tr:t<-ot?t+tr:t,r]}}function Ma(e){var t=Ta(e);return t.invert=Ta(-e),t}function Aa(e,t){var r=Lt(e),n=bt(e),a=Lt(t),s=bt(t);function f(o,x){var C=Lt(x),P=Lt(o)*C,Y=bt(o)*C,ze=bt(x),ge=ze*r+P*n;return[Mi(Y*a-ge*s,P*r-ze*n),Ai(ge*a+Y*s)]}return f.invert=function(o,x){var C=Lt(x),P=Lt(o)*C,Y=bt(o)*C,ze=bt(x),ge=ze*a-Y*s;return[Mi(Y*a+ze*s,P*r+ge*n),Ai(ge*r-P*n)]},f}function Uc(e,t,r,n,a,s){if(r){var f=Lt(t),o=bt(t),x=n*r;a==null?(a=t+n*tr,s=t-x/2):(a=Fa(f,a),s=Fa(f,s),(n>0?a<s:a>s)&&(a+=n*tr));for(var C,P=a;n>0?P>s:P<s;P-=x)C=Rs([f,-o*Lt(P),-o*bt(P)]),e.point(C[0],C[1])}}function Fa(e,t){t=Fi(t),t[0]-=e,Os(t);var r=Mu(-t[1]);return((-t[2]<0?-r:r)+tr-gt)%tr}function Fu(){var e=[],t;return{point:function(r,n){t.push([r,n])},lineStart:function(){e.push(t=[])},lineEnd:Yi,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function qc(e,t,r,n,a,s){var f=e[0],o=e[1],x=t[0],C=t[1],P=0,Y=1,ze=x-f,ge=C-o,Bt;if(Bt=r-f,!(!ze&&Bt>0)){if(Bt/=ze,ze<0){if(Bt<P)return;Bt<Y&&(Y=Bt)}else if(ze>0){if(Bt>Y)return;Bt>P&&(P=Bt)}if(Bt=a-f,!(!ze&&Bt<0)){if(Bt/=ze,ze<0){if(Bt>Y)return;Bt>P&&(P=Bt)}else if(ze>0){if(Bt<P)return;Bt<Y&&(Y=Bt)}if(Bt=n-o,!(!ge&&Bt>0)){if(Bt/=ge,ge<0){if(Bt<P)return;Bt<Y&&(Y=Bt)}else if(ge>0){if(Bt>Y)return;Bt>P&&(P=Bt)}if(Bt=s-o,!(!ge&&Bt<0)){if(Bt/=ge,ge<0){if(Bt>Y)return;Bt>P&&(P=Bt)}else if(ge>0){if(Bt<P)return;Bt<Y&&(Y=Bt)}return P>0&&(e[0]=f+P*ze,e[1]=o+P*ge),Y<1&&(t[0]=f+Y*ze,t[1]=o+Y*ge),!0}}}}}function Do(e,t){return te(e[0]-t[0])<gt&&te(e[1]-t[1])<gt}function Lo(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Bu(e,t,r,n,a){var s=[],f=[],o,x;if(e.forEach(function(Bt){if(!((Ur=Bt.length-1)<=0)){var Ur,kn=Bt[0],Io=Bt[Ur],rl;if(Do(kn,Io)){for(a.lineStart(),o=0;o<Ur;++o)a.point((kn=Bt[o])[0],kn[1]);a.lineEnd();return}s.push(rl=new Lo(kn,Bt,null,!0)),f.push(rl.o=new Lo(kn,null,rl,!1)),s.push(rl=new Lo(Io,Bt,null,!1)),f.push(rl.o=new Lo(Io,null,rl,!0))}}),!!s.length){for(f.sort(t),Ba(s),Ba(f),o=0,x=f.length;o<x;++o)f[o].e=r=!r;for(var C=s[0],P,Y;;){for(var ze=C,ge=!0;ze.v;)if((ze=ze.n)===C)return;P=ze.z,a.lineStart();do{if(ze.v=ze.o.v=!0,ze.e){if(ge)for(o=0,x=P.length;o<x;++o)a.point((Y=P[o])[0],Y[1]);else n(ze.x,ze.n.x,1,a);ze=ze.n}else{if(ge)for(P=ze.p.z,o=P.length-1;o>=0;--o)a.point((Y=P[o])[0],Y[1]);else n(ze.x,ze.p.x,-1,a);ze=ze.p}ze=ze.o,P=ze.z,ge=!ge}while(!ze.v);a.lineEnd()}}}function Ba(e){if(t=e.length){for(var t,r=0,n=e[0],a;++r<t;)n.n=a=e[r],a.p=n,n=a;n.n=a=e[0],a.p=n}}function ku(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Xc(e){return e.length===1&&(e=Yc(e)),{left:function(t,r,n,a){for(n==null&&(n=0),a==null&&(a=t.length);n<a;){var s=n+a>>>1;e(t[s],r)<0?n=s+1:a=s}return n},right:function(t,r,n,a){for(n==null&&(n=0),a==null&&(a=t.length);n<a;){var s=n+a>>>1;e(t[s],r)>0?a=s:n=s+1}return n}}}function Yc(e){return function(t,r){return ku(e(t),r)}}Xc(ku);function Gu(e){for(var t=e.length,r,n=-1,a=0,s,f;++n<t;)a+=e[n].length;for(s=new Array(a);--t>=0;)for(f=e[t],r=f.length;--r>=0;)s[--a]=f[r];return s}var Hi=1e9,bo=-Hi;function Hc(e,t,r,n){function a(C,P){return e<=C&&C<=r&&t<=P&&P<=n}function s(C,P,Y,ze){var ge=0,Bt=0;if(C==null||(ge=f(C,Y))!==(Bt=f(P,Y))||x(C,P)<0^Y>0)do ze.point(ge===0||ge===3?e:r,ge>1?n:t);while((ge=(ge+Y+4)%4)!==Bt);else ze.point(P[0],P[1])}function f(C,P){return te(C[0]-e)<gt?P>0?0:3:te(C[0]-r)<gt?P>0?2:1:te(C[1]-t)<gt?P>0?1:0:P>0?3:2}function o(C,P){return x(C.x,P.x)}function x(C,P){var Y=f(C,1),ze=f(P,1);return Y!==ze?Y-ze:Y===0?P[1]-C[1]:Y===1?C[0]-P[0]:Y===2?C[1]-P[1]:P[0]-C[0]}return function(C){var P=C,Y=Fu(),ze,ge,Bt,Ur,kn,Io,rl,Co,as,$s,ah,ch={point:Zu,lineStart:_h,lineEnd:Ih,polygonStart:al,polygonEnd:sh};function Zu(Gh,ud){a(Gh,ud)&&P.point(Gh,ud)}function ih(){for(var Gh=0,ud=0,Tf=ge.length;ud<Tf;++ud)for(var Kd=ge[ud],Af=1,md=Kd.length,vd=Kd[0],qd,Ed,Sd=vd[0],zd=vd[1];Af<md;++Af)qd=Sd,Ed=zd,vd=Kd[Af],Sd=vd[0],zd=vd[1],Ed<=n?zd>n&&(Sd-qd)*(n-Ed)>(zd-Ed)*(e-qd)&&++Gh:zd<=n&&(Sd-qd)*(n-Ed)<(zd-Ed)*(e-qd)&&--Gh;return Gh}function al(){P=Y,ze=[],ge=[],ah=!0}function sh(){var Gh=ih(),ud=ah&&Gh,Tf=(ze=Gu(ze)).length;(ud||Tf)&&(C.polygonStart(),ud&&(C.lineStart(),s(null,null,1,C),C.lineEnd()),Tf&&Bu(ze,o,Gh,s,C),C.polygonEnd()),P=C,ze=ge=Bt=null}function _h(){ch.point=Lh,ge&&ge.push(Bt=[]),$s=!0,as=!1,rl=Co=NaN}function Ih(){ze&&(Lh(Ur,kn),Io&&as&&Y.rejoin(),ze.push(Y.result())),ch.point=Zu,as&&P.lineEnd()}function Lh(Gh,ud){var Tf=a(Gh,ud);if(ge&&Bt.push([Gh,ud]),$s)Ur=Gh,kn=ud,Io=Tf,$s=!1,Tf&&(P.lineStart(),P.point(Gh,ud));else if(Tf&&as)P.point(Gh,ud);else{var Kd=[rl=Math.max(bo,Math.min(Hi,rl)),Co=Math.max(bo,Math.min(Hi,Co))],Af=[Gh=Math.max(bo,Math.min(Hi,Gh)),ud=Math.max(bo,Math.min(Hi,ud))];qc(Kd,Af,e,t,r,n)?(as||(P.lineStart(),P.point(Kd[0],Kd[1])),P.point(Af[0],Af[1]),Tf||P.lineEnd(),ah=!1):Tf&&(P.lineStart(),P.point(Gh,ud),ah=!1)}rl=Gh,Co=ud,as=Tf}return ch}}var vs=Vr();function Wc(e,t){var r=t[0],n=t[1],a=[bt(r),-Lt(r),0],s=0,f=0;vs.reset();for(var o=0,x=e.length;o<x;++o)if(P=(C=e[o]).length)for(var C,P,Y=C[P-1],ze=Y[0],ge=Y[1]/2+Pa,Bt=bt(ge),Ur=Lt(ge),kn=0;kn<P;++kn,ze=rl,Bt=as,Ur=$s,Y=Io){var Io=C[kn],rl=Io[0],Co=Io[1]/2+Pa,as=bt(Co),$s=Lt(Co),ah=rl-ze,ch=ah>=0?1:-1,Zu=ch*ah,ih=Zu>ot,al=Bt*as;if(vs.add(Mi(al*ch*bt(Zu),Ur*$s+al*Lt(Zu))),s+=ih?ah+ch*tr:ah,ih^ze>=r^rl>=r){var sh=Xo(Fi(Y),Fi(Io));Os(sh);var _h=Xo(a,sh);Os(_h);var Ih=(ih^ah>=0?-1:1)*Ai(_h[2]);(n>Ih||n===Ih&&(sh[0]||sh[1]))&&(f+=ih^ah>=0?1:-1)}}return(s<-gt||s<gt&&vs<-gt)^f&1}Vr();function ka(e){return e}Vr();Vr();var Bi=1/0,Yo=Bi,fo=-Bi,Ho=fo,Ga={point:jc,lineStart:Yi,lineEnd:Yi,polygonStart:Yi,polygonEnd:Yi,result:function(){var e=[[Bi,Yo],[fo,Ho]];return fo=Ho=-(Yo=Bi=1/0),e}};function jc(e,t){e<Bi&&(Bi=e),e>fo&&(fo=e),t<Yo&&(Yo=t),t>Ho&&(Ho=t)}Vr();function zu(e,t,r,n){return function(a,s){var f=t(s),o=a.invert(n[0],n[1]),x=Fu(),C=t(x),P=!1,Y,ze,ge,Bt={point:Ur,lineStart:Io,lineEnd:rl,polygonStart:function(){Bt.point=Co,Bt.lineStart=as,Bt.lineEnd=$s,ze=[],Y=[]},polygonEnd:function(){Bt.point=Ur,Bt.lineStart=Io,Bt.lineEnd=rl,ze=Gu(ze);var ah=Wc(Y,o);ze.length?(P||(s.polygonStart(),P=!0),Bu(ze,Qc,ah,r,s)):ah&&(P||(s.polygonStart(),P=!0),s.lineStart(),r(null,null,1,s),s.lineEnd()),P&&(s.polygonEnd(),P=!1),ze=Y=null},sphere:function(){s.polygonStart(),s.lineStart(),r(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function Ur(ah,ch){var Zu=a(ah,ch);e(ah=Zu[0],ch=Zu[1])&&s.point(ah,ch)}function kn(ah,ch){var Zu=a(ah,ch);f.point(Zu[0],Zu[1])}function Io(){Bt.point=kn,f.lineStart()}function rl(){Bt.point=Ur,f.lineEnd()}function Co(ah,ch){ge.push([ah,ch]);var Zu=a(ah,ch);C.point(Zu[0],Zu[1])}function as(){C.lineStart(),ge=[]}function $s(){Co(ge[0][0],ge[0][1]),C.lineEnd();var ah=C.clean(),ch=x.result(),Zu,ih=ch.length,al,sh,_h;if(ge.pop(),Y.push(ge),ge=null,!!ih){if(ah&1){if(sh=ch[0],(al=sh.length-1)>0){for(P||(s.polygonStart(),P=!0),s.lineStart(),Zu=0;Zu<al;++Zu)s.point((_h=sh[Zu])[0],_h[1]);s.lineEnd()}return}ih>1&&ah&2&&ch.push(ch.pop().concat(ch.shift())),ze.push(ch.filter(Kc))}}return Bt}}function Kc(e){return e.length>1}function Qc(e,t){return((e=e.x)[0]<0?e[1]-Hn-gt:Hn-e[1])-((t=t.x)[0]<0?t[1]-Hn-gt:Hn-t[1])}const za=zu(function(){return!0},Jc,$c,[-ot,-Hn]);function Jc(e){var t=NaN,r=NaN,n=NaN,a;return{lineStart:function(){e.lineStart(),a=1},point:function(s,f){var o=s>0?ot:-ot,x=te(s-t);te(x-ot)<gt?(e.point(t,r=(r+f)/2>0?Hn:-Hn),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(o,r),e.point(s,r),a=0):n!==o&&x>=ot&&(te(t-n)<gt&&(t-=n*gt),te(s-o)<gt&&(s-=o*gt),r=Zc(t,r,s,f),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(o,r),a=0),e.point(t=s,r=f),n=o},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-a}}}function Zc(e,t,r,n){var a,s,f=bt(e-r);return te(f)>gt?Gc((bt(t)*(s=Lt(n))*bt(r)-bt(n)*(a=Lt(t))*bt(e))/(a*s*f)):(t+n)/2}function $c(e,t,r,n){var a;if(e==null)a=r*Hn,n.point(-ot,a),n.point(0,a),n.point(ot,a),n.point(ot,0),n.point(ot,-a),n.point(0,-a),n.point(-ot,-a),n.point(-ot,0),n.point(-ot,a);else if(te(e[0]-t[0])>gt){var s=e[0]<t[0]?ot:-ot;a=r*s/2,n.point(-s,a),n.point(0,a),n.point(s,a)}else n.point(t[0],t[1])}function tf(e,t){var r=Lt(e),n=r>0,a=te(r)>gt;function s(P,Y,ze,ge){Uc(ge,e,t,ze,P,Y)}function f(P,Y){return Lt(P)*Lt(Y)>r}function o(P){var Y,ze,ge,Bt,Ur;return{lineStart:function(){Bt=ge=!1,Ur=1},point:function(kn,Io){var rl=[kn,Io],Co,as=f(kn,Io),$s=n?as?0:C(kn,Io):as?C(kn+(kn<0?ot:-ot),Io):0;if(!Y&&(Bt=ge=as)&&P.lineStart(),as!==ge&&(Co=x(Y,rl),(!Co||Do(Y,Co)||Do(rl,Co))&&(rl[0]+=gt,rl[1]+=gt,as=f(rl[0],rl[1]))),as!==ge)Ur=0,as?(P.lineStart(),Co=x(rl,Y),P.point(Co[0],Co[1])):(Co=x(Y,rl),P.point(Co[0],Co[1]),P.lineEnd()),Y=Co;else if(a&&Y&&n^as){var ah;!($s&ze)&&(ah=x(rl,Y,!0))&&(Ur=0,n?(P.lineStart(),P.point(ah[0][0],ah[0][1]),P.point(ah[1][0],ah[1][1]),P.lineEnd()):(P.point(ah[1][0],ah[1][1]),P.lineEnd(),P.lineStart(),P.point(ah[0][0],ah[0][1])))}as&&(!Y||!Do(Y,rl))&&P.point(rl[0],rl[1]),Y=rl,ge=as,ze=$s},lineEnd:function(){ge&&P.lineEnd(),Y=null},clean:function(){return Ur|(Bt&&ge)<<1}}}function x(P,Y,ze){var ge=Fi(P),Bt=Fi(Y),Ur=[1,0,0],kn=Xo(ge,Bt),Io=So(kn,kn),rl=kn[0],Co=Io-rl*rl;if(!Co)return!ze&&P;var as=r*Io/Co,$s=-r*rl/Co,ah=Xo(Ur,kn),ch=wo(Ur,as),Zu=wo(kn,$s);ds(ch,Zu);var ih=ah,al=So(ch,ih),sh=So(ih,ih),_h=al*al-sh*(So(ch,ch)-1);if(!(_h<0)){var Ih=Eo(_h),Lh=wo(ih,(-al-Ih)/sh);if(ds(Lh,ch),Lh=Rs(Lh),!ze)return Lh;var Gh=P[0],ud=Y[0],Tf=P[1],Kd=Y[1],Af;ud<Gh&&(Af=Gh,Gh=ud,ud=Af);var md=ud-Gh,vd=te(md-ot)<gt,qd=vd||md<gt;if(!vd&&Kd<Tf&&(Af=Tf,Tf=Kd,Kd=Af),qd?vd?Tf+Kd>0^Lh[1]<(te(Lh[0]-Gh)<gt?Tf:Kd):Tf<=Lh[1]&&Lh[1]<=Kd:md>ot^(Gh<=Lh[0]&&Lh[0]<=ud)){var Ed=wo(ih,(-al+Ih)/sh);return ds(Ed,ch),[Lh,Rs(Ed)]}}}function C(P,Y){var ze=n?e:ot-e,ge=0;return P<-ze?ge|=1:P>ze&&(ge|=2),Y<-ze?ge|=4:Y>ze&&(ge|=8),ge}return zu(f,o,s,n?[0,-e]:[-ot,e-ot])}function Vu(e){return function(t){var r=new Ts;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Ts(){}Ts.prototype={constructor:Ts,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Uu(e,t,r){var n=t[1][0]-t[0][0],a=t[1][1]-t[0][1],s=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),s!=null&&e.clipExtent(null),zc(r,e.stream(Ga));var f=Ga.result(),o=Math.min(n/(f[1][0]-f[0][0]),a/(f[1][1]-f[0][1])),x=+t[0][0]+(n-o*(f[1][0]+f[0][0]))/2,C=+t[0][1]+(a-o*(f[1][1]+f[0][1]))/2;return s!=null&&e.clipExtent(s),e.scale(o*150).translate([x,C])}function ef(e,t,r){return Uu(e,[[0,0],t],r)}var Va=16,nf=Lt(30*$e);function Ua(e,t){return+t?of(e,t):rf(e)}function rf(e){return Vu({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function of(e,t){function r(n,a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn){var Io=C-n,rl=P-a,Co=Io*Io+rl*rl;if(Co>4*t&&Ur--){var as=f+ze,$s=o+ge,ah=x+Bt,ch=Eo(as*as+$s*$s+ah*ah),Zu=Ai(ah/=ch),ih=te(te(ah)-1)<gt||te(s-Y)<gt?(s+Y)/2:Mi($s,as),al=e(ih,Zu),sh=al[0],_h=al[1],Ih=sh-n,Lh=_h-a,Gh=rl*Ih-Io*Lh;(Gh*Gh/Co>t||te((Io*Ih+rl*Lh)/Co-.5)>.3||f*ze+o*ge+x*Bt<nf)&&(r(n,a,s,f,o,x,sh,_h,ih,as/=ch,$s/=ch,ah,Ur,kn),kn.point(sh,_h),r(sh,_h,ih,as,$s,ah,C,P,Y,ze,ge,Bt,Ur,kn))}}return function(n){var a,s,f,o,x,C,P,Y,ze,ge,Bt,Ur,kn={point:Io,lineStart:rl,lineEnd:as,polygonStart:function(){n.polygonStart(),kn.lineStart=$s},polygonEnd:function(){n.polygonEnd(),kn.lineStart=rl}};function Io(Zu,ih){Zu=e(Zu,ih),n.point(Zu[0],Zu[1])}function rl(){Y=NaN,kn.point=Co,n.lineStart()}function Co(Zu,ih){var al=Fi([Zu,ih]),sh=e(Zu,ih);r(Y,ze,P,ge,Bt,Ur,Y=sh[0],ze=sh[1],P=Zu,ge=al[0],Bt=al[1],Ur=al[2],Va,n),n.point(Y,ze)}function as(){kn.point=Io,n.lineEnd()}function $s(){rl(),kn.point=ah,kn.lineEnd=ch}function ah(Zu,ih){Co(a=Zu,ih),s=Y,f=ze,o=ge,x=Bt,C=Ur,kn.point=Co}function ch(){r(Y,ze,P,ge,Bt,Ur,s,f,a,o,x,C,Va,n),kn.lineEnd=as,as()}return kn}}var sf=Vu({point:function(e,t){this.stream.point(e*$e,t*$e)}});function af(e){return uf(function(){return e})()}function uf(e){var t,r=150,n=480,a=250,s,f,o=0,x=0,C=0,P=0,Y=0,ze,ge,Bt=null,Ur=za,kn=null,Io,rl,Co,as=ka,$s=.5,ah=Ua(sh,$s),ch,Zu;function ih(Lh){return Lh=ge(Lh[0]*$e,Lh[1]*$e),[Lh[0]*r+s,f-Lh[1]*r]}function al(Lh){return Lh=ge.invert((Lh[0]-s)/r,(f-Lh[1])/r),Lh&&[Lh[0]*Er,Lh[1]*Er]}function sh(Lh,Gh){return Lh=t(Lh,Gh),[Lh[0]*r+s,f-Lh[1]*r]}ih.stream=function(Lh){return ch&&Zu===Lh?ch:ch=sf(Ur(ze,ah(as(Zu=Lh))))},ih.clipAngle=function(Lh){return arguments.length?(Ur=+Lh?tf(Bt=Lh*$e,6*$e):(Bt=null,za),Ih()):Bt*Er},ih.clipExtent=function(Lh){return arguments.length?(as=Lh==null?(kn=Io=rl=Co=null,ka):Hc(kn=+Lh[0][0],Io=+Lh[0][1],rl=+Lh[1][0],Co=+Lh[1][1]),Ih()):kn==null?null:[[kn,Io],[rl,Co]]},ih.scale=function(Lh){return arguments.length?(r=+Lh,_h()):r},ih.translate=function(Lh){return arguments.length?(n=+Lh[0],a=+Lh[1],_h()):[n,a]},ih.center=function(Lh){return arguments.length?(o=Lh[0]%360*$e,x=Lh[1]%360*$e,_h()):[o*Er,x*Er]},ih.rotate=function(Lh){return arguments.length?(C=Lh[0]%360*$e,P=Lh[1]%360*$e,Y=Lh.length>2?Lh[2]%360*$e:0,_h()):[C*Er,P*Er,Y*Er]},ih.precision=function(Lh){return arguments.length?(ah=Ua(sh,$s=Lh*Lh),Ih()):Eo($s)},ih.fitExtent=function(Lh,Gh){return Uu(ih,Lh,Gh)},ih.fitSize=function(Lh,Gh){return ef(ih,Lh,Gh)};function _h(){ge=Au(ze=Vc(C,P,Y),t);var Lh=t(o,x);return s=n-Lh[0]*r,f=a+Lh[1]*r,Ih()}function Ih(){return ch=Zu=null,ih}return function(){return t=e.apply(this,arguments),ih.invert=t.invert&&al,_h()}}function lf(e){return function(t,r){var n=Lt(t),a=Lt(r),s=e(n*a);return[s*a*bt(t),s*bt(r)]}}function cf(e){return function(t,r){var n=Eo(t*t+r*r),a=e(n),s=bt(a),f=Lt(a);return[Mi(t*s,n*f),Ai(n&&r*s/n)]}}var qu=lf(function(e){return(e=Mu(e))&&e/bt(e)});qu.invert=cf(function(e){return e});function ff(){return af(qu).scale(79.4188).clipAngle(180-.001)}function qa(e,t){return[e,t]}qa.invert=qa;function hf(e,t,r){r=r||{};var n=r.units||"kilometers",a=r.steps||8;if(!e)throw new Error("geojson is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var s=[];switch(e.type){case"GeometryCollection":return su(e,function(f){var o=To(f,t,n,a);o&&s.push(o)}),ws(s);case"FeatureCollection":return Na(e,function(f){var o=To(f,t,n,a);o&&Na(o,function(x){x&&s.push(x)})}),ws(s)}return To(e,t,n,a)}function To(e,t,r,n){var a=e.properties||{},s=e.type==="Feature"?e.geometry:e;if(s.type==="GeometryCollection"){var f=[];return su(e,function(Ur){var kn=To(Ur,t,r,n);kn&&f.push(kn)}),ws(f)}var o=gf(s),x={type:s.type,coordinates:Yu(s.coordinates,o)},C=new Us,P=C.read(x),Y=dc(vc(t,r),"meters"),ze=zt.bufferOp(P,Y,n),ge=new vu;if(ze=ge.write(ze),!Xu(ze.coordinates)){var Bt={type:ze.type,coordinates:Hu(ze.coordinates,o)};return Wo(Bt,a)}}function Xu(e){return Array.isArray(e[0])?Xu(e[0]):isNaN(e[0])}function Yu(e,t){return typeof e[0]!="object"?t(e):e.map(function(r){return Yu(r,t)})}function Hu(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(r){return Hu(r,t)})}function gf(e){var t=Ic(e).geometry.coordinates,r=[-t[0],-t[1]];return ff().rotate(r).scale(Ee)}function pf(e,t){var r=Fo(e),n=Fo(t),a=e.properties||{},s=eu.difference(r.coordinates,n.coordinates);return s.length===0?null:s.length===1?ru(s[0],a):iu(s,a)}function Xa(e){let t;for(const r of e)t&&r[0]-t[0]>=180?r[0]-=360:t&&r[0]-t[0]<-180&&(r[0]+=360),t=r}function Ya(e,t){const r=pf({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},e);if(!r)return;r.properties={isMask:"y"};const n=hf(e,0);if(n.geometry.type==="Polygon")for(const a of n.geometry.coordinates)Xa(a);else for(const a of n.geometry.coordinates)for(const s of a)Xa(s);t({type:"FeatureCollection",features:[n,r]})}let Ha={type:"FeatureCollection",features:[]};function df(e,t,r=!0,n=!0,a={},s={},f={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let o,x,C=[],P,Y;function ze(){(f!=null&&f.fill||f!=null&&f.line)&&e.addSource("full-geom",{type:"geojson",data:Ha}),f!=null&&f.fill&&e.addLayer({...f?.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),f!=null&&f.line&&e.addLayer({...f?.line,id:"full-geom-line",type:"line",source:"full-geom"})}e.loaded()?ze():e.once("load",()=>{ze()});const ge=kn=>{o?.({type:"mapClick",coordinates:[kn.lngLat.lng,kn.lngLat.lat]})},Bt=()=>{let kn;const Io=e.getZoom()>9?[(kn=e.getCenter().wrap()).lng,kn.lat]:void 0;x!==Io&&(x=Io,o?.({type:"proximityChange",proximity:Io}))};function Ur(kn=!1){if(!t)throw new Error;const Io=document.createElement("div");return kn&&Io.classList.add("marker-interactive"),new Ec({props:{displayIn:"maplibre"},target:Io}),new t.Marker({element:Io,offset:[1,-13]})}return{setEventHandler(kn){kn?(o=kn,e.on("moveend",Bt),Bt(),e.on("click",ge)):(e.off("moveend",Bt),o?.({type:"proximityChange",proximity:void 0}),o=void 0,e.off("click",ge))},flyTo(kn,Io){e.flyTo({center:kn,zoom:Io,...a})},fitBounds(kn,Io){e.fitBounds([[kn[0],kn[1]],[kn[2],kn[3]]],{padding:Io,...s})},indicateReverse(kn){e.getCanvasContainer().style.cursor=kn?"crosshair":""},setReverseMarker(kn){!t||!r||(Y?kn?Y.setLngLat(kn):(Y.remove(),Y=void 0):kn&&(Y=(typeof r=="object"?new t.Marker(r):Ur()).setLngLat(kn).addTo(e),Y.getElement().classList.add("marker-reverse")))},setMarkers(kn,Io){if(!r)return;function rl(Co){var as;(as=e.getSource("full-geom"))==null||as.setData(Co)}for(const Co of C)Co.remove();if(C.length=0,rl(Ha),!!t){if(Io){let Co=!1;if(Io.geometry.type==="GeometryCollection"){const as=Io.geometry.geometries.filter($s=>$s.type==="Polygon"||$s.type==="MultiPolygon");if(as.length>0){let $s=as.pop();for(const ah of as)$s=yc($s,ah);Ya({...Io,geometry:$s},rl),Co=!0}else{const $s=Io.geometry.geometries.filter(ah=>ah.type==="LineString"||ah.type==="MultiLineString");$s.length>0&&(rl({...Io,geometry:{type:"GeometryCollection",geometries:$s}}),Co=!0)}}if(!Co){if(Io.geometry.type==="Polygon"||Io.geometry.type==="MultiPolygon")Ya(Io,rl);else if(Io.geometry.type==="LineString"||Io.geometry.type==="MultiLineString"){rl(Io);return}}r&&C.push((typeof r=="object"?new t.Marker(r):Ur()).setLngLat(Io.center).addTo(e))}if(n)for(const Co of kn??[]){if(Co===Io)continue;const as=(typeof n=="object"?new t.Marker(n):Ur(!0)).setLngLat(Co.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Co.place_name.replace(/,.*/,""))).addTo(e),$s=as.getElement();$s.addEventListener("click",ah=>{ah.stopPropagation(),o?.({type:"markerClick",id:Co.id})}),$s.addEventListener("mouseenter",()=>{o?.({type:"markerMouseEnter",id:Co.id}),as.togglePopup()}),$s.addEventListener("mouseleave",()=>{o?.({type:"markerMouseLeave",id:Co.id}),as.togglePopup()}),$s.classList.toggle("marker-fuzzy",!!Co.matching_text),C.push(as)}}},setSelectedMarker(kn){P&&P.getElement().classList.toggle("marker-selected",!1),P=kn>-1?C[kn]:void 0,P?.getElement().classList.toggle("marker-selected",!0)}}}var En,Hr;class vf extends EventTarget{constructor(t){super(),fs(this,En,void 0),fs(this,Hr,void 0),No(this,Hr,t)}onAdd(t){const r=document.createElement("div");r.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:n,showResultMarkers:a,flyTo:s,fullGeometryStyle:f,...o}=zn(this,Hr),x=typeof s=="boolean"?{}:s,C=this.getExtraProps(t,r),P={mapController:df(t,this.getMapLibreGl(),n,a,x,x,f),flyTo:s===void 0?!0:!!s,apiKey:"",...C,...o};if(!P.apiKey)throw new Error("no apiKey provided");No(this,En,new Yl({target:r,props:P}));for(const Y of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])zn(this,En).$on(Y,ze=>this.dispatchEvent(ze));return r}setOptions(t){var r;No(this,Hr,t);const{marker:n,showResultMarkers:a,flyTo:s,fullGeometryStyle:f,...o}=zn(this,Hr);(r=zn(this,En))==null||r.$set(o)}setQuery(t,r=!0){var n;(n=zn(this,En))==null||n.setQuery(t,r)}setReverseMode(t){var r;(r=zn(this,En))==null||r.$set({reverseActive:t})}focus(){var t;(t=zn(this,En))==null||t.focus()}blur(){var t;(t=zn(this,En))==null||t.blur()}onRemove(){var t;(t=zn(this,En))==null||t.$destroy()}}En=new WeakMap,Hr=new WeakMap;class _f extends vf{getMapLibreGl(){return ll}getExtraProps(t,r){const n={};if(!("getSdkConfig"in t&&typeof t.getSdkConfig=="function"))throw new Error("MapTiler SDK not detected");const{primaryLanguage:a,apiKey:s}=t.getSdkConfig();n.apiKey=s;const f=/^([a-z]{2})($|_|-)/.exec(a);return f&&(n.language=f[1]),r.className+=" maptiler-ctrl",n}}const style="",doubleClickZoom={enable:e=>{setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},DrawAssistedRectangle={onSetup:function(e){const t=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:t,currentVertexPosition:0}},onTap:function(e,t){this.onClick(e,t)},onClick:function(e,t){if(e.currentVertexPosition===2){const r=this.calculatepXY3(e,t,!1);return r&&e.rectangle.updateCoordinate(`0.${e.currentVertexPosition+1}`,r[0],r[1]),this.updateUIClasses({mouse:"pointer"}),this.changeMode("simple_select",{featuresId:e.rectangle.id})}else e.rectangle.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.rectangle.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},onMouseMove:function(e,t){if(e.rectangle.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition&&e.currentVertexPosition>0&&this.calculateOrientedAnglePolygon(e),e.currentVertexPosition===2){const r=this.calculatepXY3(e,t,!0);r&&e.rectangle.updateCoordinate("0."+(e.currentVertexPosition+1),r[0],r[1])}},deegrees2meters(e){const t=e[0]*2003750834e-2/180;let r=Math.log(Math.tan((90+e[1])*Math.PI/360))/(Math.PI/180);return r=r*2003750834e-2/180,[t,r]},meters2degress(e){const t=e[0]*180/2003750834e-2,r=Math.atan(Math.exp(e[1]*Math.PI/2003750834e-2))*360/Math.PI-90;return[t,r]},calculateOrientedAnglePolygon:function(e){const t=e.rectangle.getCoordinate("0.0"),r=this.deegrees2meters(t),n=e.rectangle.getCoordinate("0.1"),a=this.deegrees2meters(n);let f=-1*(Math.atan2(a[1]-r[1],a[0]-r[0])*180/Math.PI+90);const o=f<0?f+360:f;e.angle=parseFloat(o.toFixed(2))},calculatepXY3:function(e,t,r){const n=e.rectangle.getCoordinate("0.0"),a=this.deegrees2meters(n),s=e.rectangle.getCoordinate("0.1"),f=this.deegrees2meters(s);let o=this.deegrees2meters([t.lngLat.lng,t.lngLat.lat]);const x=this.deegrees2meters([t.lngLat.lng,t.lngLat.lat]);if(a[0]===f[0])o=[x[0],f[1]];else if(a[1]===f[1])o=[f[0],x[1]];else{const Bt=-1/((f[1]-a[1])/(f[0]-a[0]));Math.abs(Bt)<1?o[1]=Bt*(x[0]-f[0])+f[1]:o[0]=f[0]+(o[1]-f[1])/Bt}const C=[f[0]-a[0],f[1]-a[1]],P=[o[0]-C[0],o[1]-C[1]],Y=this.meters2degress(o),ze=this.meters2degress(P);return e.rectangle.updateCoordinate("0.2",Y[0],Y[1]),e.rectangle.updateCoordinate("0.3",ze[0],ze[1]),ze},onKeyUp:function(e,t){if(t.keyCode===27)return this.changeMode("simple_select")},onStop:function(e){doubleClickZoom.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.getFeature(e.rectangle.id)!==void 0&&(e.rectangle.removeCoordinate("0.4"),e.rectangle.isValid()?this.map.fire("draw.create",{features:[e.rectangle.toGeoJSON()]}):(this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(e,t,r){const n=t.properties.id===e.rectangle.id;if(t.properties.active=n?"true":"false",t.properties.angle=e.angle,t.angle=e.angle,!n)return r(t);const a=t.geometry.coordinates[0].length;if(a<3){const s=t.geometry.coordinates[0][0],f={type:"Feature",properties:t.properties,angle:e.angle,geometry:{coordinates:t.geometry.coordinates[0][0],type:"Point"}};s&&r(f);return}if(a>=3&&a<=4){const s=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:"Feature",properties:t.properties,angle:e.angle,geometry:{coordinates:s,type:"LineString"}}),a===3)return}return r(t)},onTrash:function(e){this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select")}};class MapTilerGLButtonControl{constructor({className:t="",title:r="",eventHandler:n=evtHndlr}){this._className=t,this._title=r,this._eventHandler=n}onAdd(t){return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon "+this._className,this._btn.type="button",this._btn.title=this._title,this._btn.onclick=this._eventHandler,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl-group maplibregl-ctrl",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const maptilerMapViewer_vue_vue_type_style_index_0_scoped_cfeeea1a_lang="";let draw;const STYLES_DRAW=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#FF0000","fill-outline-color":"#D20C0C","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":3}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#ee0508","fill-opacity":.8}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c40b0b","line-width":2}}],_sfc_main$4={name:"maptiler-map-viewer",setup(){const e=useQuasar();return{alert:ref(!1),alertMsg:ref(""),tileInfoString:ref(""),dirHandle:ref(""),qt:e,map:ref(null),maptiler_style_url:ref(""),maptiler_access_token:ref(""),maptiler_rgb_image_url:ref(""),maptiler_raster_png_dem:ref(""),maptiler_api_url:ref(""),satellite_endpoint:ref(""),satellite_image_url:ref(""),rasterFromStyle:ref(!1),zoom:ref(""),lng:ref(""),lat:ref(""),drawmode:ref("simple_select"),layers:ref(["hillshading","bounding_box"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Satellite",value:"satellite"}]}},mounted(){},methods:{async changeLayers(e){for(const t of this.layer_type)e.includes(t.value)?this.map.setLayoutProperty(t.value,"visibility","visible"):this.map.setLayoutProperty(t.value,"visibility","none")},async loadMapSourcesLayers(e){e.addSource("maptiler_terrain_dem",{type:"raster-dem",url:this.maptiler_raster_png_dem+"tiles.json"}),e.addLayer({id:"hillshading",source:"maptiler_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),e.addSource("satellite",{type:"raster",url:this.maptiler_api_url+"/tiles/satellite/tiles.json",tileSize:512}),e.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}})},changeDrawMode(e){let t=document.getElementsByClassName("mapbox-gl-draw_polygon")[0],r=document.getElementsByClassName("mapbox-gl-draw_line")[0],n=e.target;n.title==="Select single tile"?(r.style.backgroundColor="white",t.style.backgroundColor="green",draw.deleteAll(),draw.changeMode("simple_select"),this.drawmode="simple_select"):n.title==="Draw Rectangle to select multiple tiles"&&(r.style.backgroundColor="green",t.style.backgroundColor="white",draw.deleteAll(),draw.changeMode("draw_assisted_rectangle"),this.drawmode="draw_assisted_rectangle",this.map.setPaintProperty("bounding_box","fill-opacity",0)),idbKeyval.set("drawmode",this.drawmode),console.log(this.drawmode)},resizeMap(){this.map.resize()},updateBBox(e){let t=e.features[0].geometry.coordinates[0],r,n,a,s;r=t[3][0],n=t[3][1],a=t[1][0],s=t[1][1];let f=[r,n,a,s],o=mapUtils.getTileInfo(0,0,!0,0,0,0,f);idbKeyval.set("tile_info",o)},async setBoundingBox(e){let t=mapUtils.getTileInfo(this.lng,this.lat,!1,0,0,this.zoom);this.tileInfoString="Slippy Tile Info String: "+t.x+","+t.y+","+t.z+" Bounding Box sides in KM: "+t.distance,e.getSource("bounding_box_source").setData(t.polygon_bb),e.setPaintProperty("bounding_box","fill-opacity",.45),e.fitBounds(t.bbox,{linear:!0}),idbKeyval.set("tile_info",t)},async loadMapTilerMap(){this.maptiler_access_token=await idbKeyval.get("maptiler_access_token"),this.dirHandle=await idbKeyval.get("dirHandle"),this.maptiler_style_url=await idbKeyval.get("maptiler_style_url"),this.maptiler_api_url=await idbKeyval.get("maptiler_api_url"),this.maptiler_raster_png_dem=await idbKeyval.get("maptiler_raster_png_dem"),this.dirHandle=await idbKeyval.get("dirHandle"),config.apiKey=this.maptiler_access_token;let e=this,t=new Map$1({container:"map",trackResize:!0,antialias:!0,style:this.maptiler_style_url,center:[-121.7598,46.876],zoom:9,maxZoom:12,doubleClickZoom:!1,terrainControl:!0,fullscreenControl:!0,failIfMajorPerformance:!0});this.map=t,this.map.doubleClickZoom.disable();const r=new _f({apiKey:config.apiKey,class:"geocoder",showResultsWhileTyping:!0,placeholder:"Try: Lng , Lat or Name"});t.addControl(r,"top-right"),draw=new MapboxDraw({modes:{...MapboxDraw.modes,draw_assisted_rectangle:DrawAssistedRectangle},displayControlsDefault:!1,controls:{},userProperties:!0,styles:STYLES_DRAW}),t.addControl(draw);const n=new MapTilerGLButtonControl({className:"mapbox-gl-draw_polygon",title:"Select single tile",eventHandler:e.changeDrawMode});t.addControl(n);const a=new MapTilerGLButtonControl({className:"mapbox-gl-draw_line",title:"Draw Rectangle to select multiple tiles",eventHandler:e.changeDrawMode});t.addControl(a),t.on("load",function(){e.loadMapSourcesLayers(t);let s=document.getElementsByClassName("mapbox-gl-draw_polygon")[0];s.style.backgroundColor="green",draw.changeMode("simple_select"),this.drawmode="simple_select"}),t.on("click",async function(s){e.drawmode==="simple_select"&&(e.lng=s.lngLat.lng,e.lat=s.lngLat.lat,e.zoom=Math.floor(t.getZoom()),await e.setBoundingBox(t,e.zoom))}),t.on("zoomend",async function(){e.zoom=Math.floor(t.getZoom())}),t.on("error",s=>{console.error(s)}),t.on("draw.create",function(s){console.log("draw mode create "+s.type),e.updateBBox(s)}),t.on("draw.update",function(s){console.log("draw mode update "+s.type),e.updateBBox(s)}),t.on("draw.selectionchange",function(s){console.log("draw mode selectionchange "+s.type)}),t.on("draw.delete",function(s){console.log("draw mode delete "+s.type)}),t.on("draw.modechange",s=>{console.log("draw mode CHANGE "+s.mode)}),t.on("dblclick",async function(s){let f=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(f,!0)===!1){console.error(`User did not grant permission to '${f.name}'`);return}let o=await idbKeyval.get("tile_info"),x={},C=!0;e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance;let P=await idbKeyval.get("exportType");if(e.drawmode==="simple_select"){if(e.qt.loading.show(),P.label==="Image of map only"){C=!1;let ze=e.maptiler_style_url.replace("style.json","")+`${o.z}/${o.x}/${o.y}.png?key=`+e.maptiler_access_token,ge=await mapUtils.getMapboxTerrainRgb(ze),Bt=await ge.toBuffer();idbKeyval.set("map_image_buffer",Bt),await fileUtils.writeFileToDisk(f,o.mapFileName,Bt),x.image=ge}else{e.maptiler_rgb_image_url=e.maptiler_raster_png_dem+`${o.z}/${o.x}/${o.y}.webp?key=`+e.maptiler_access_token;let Y=await mapUtils.getMapboxTerrainRgb(e.maptiler_rgb_image_url),ze=await Y.toBuffer();if(await idbKeyval.set("rgb_image_buffer",ze),await fileUtils.writeFileToDisk(f,o.rgbFileName,ze),x=mapUtils.createHeightMapImage(Y,32,"GREY"),await fileUtils.fileExists(f,o.thirtyTwoFileName)===!1){let Bt=await x.image.toBuffer();await fileUtils.writeFileToDisk(f,o.thirtyTwoFileName,Bt)}}emitter.emit("updatePreviewImage",{dir_handle:f,tile_info:o,preview_image_info:x,map:t,updateStats:C}),e.qt.loading.hide()}else if(e.drawmode==="draw_assisted_rectangle"){e.qt.loading.show(),o.z=Math.floor(t.getZoom()),idbKeyval.set("tile_info",o);let Y=await idbKeyval.get("exportOptionsModel"),ze=await idbKeyval.get("saveStitchingFiles"),ge=Math.floor(t.getZoom()),Bt={left:o.bbox[0],bottom:o.bbox[1],right:o.bbox[2],top:o.bbox[3]},Ur=tilesInBbox.tilesInBbox(Bt,ge),kn=[],Io=[];try{if(P.label!=="Image of map only"){for(let Zu of Ur){let ih={};o=mapUtils.getTileInfo(0,0,!0,Zu.x,Zu.y,Zu.z,o.bbox),e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance,e.maptiler_rgb_image_url=e.maptiler_raster_png_dem+`${o.z}/${o.x}/${o.y}.webp?key=`+e.maptiler_access_token;let sh=await(await mapUtils.getMapboxTerrainRgb(e.maptiler_rgb_image_url)).toBuffer();if(ze===!0&&await fileUtils.writeFileToDisk(f,o.rgbFileName,sh),ih.x=o.x,ih.y=o.y,ih.buffer=sh,kn.push(ih),Y.includes("satellite")){e.satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint"),e.satellite_image_url=e.satellite_endpoint+`/${o.z}/${o.x}/${o.y}.jpg?key=`+e.maptiler_access_token;let Ih=await(await mapUtils.getMapboxTerrainRgb(e.satellite_image_url)).toBuffer();ih={},ih.x=o.x,ih.y=o.y,ih.buffer=Ih,Io.push(ih)}}idbKeyval.set("tile_info",o);const rl=512;let Co=await combineTilesJimp(kn,rl,rl);if(await idbKeyval.set("rgb_image_buffer",Co),await fileUtils.writeFileToDisk(f,o.rgbFileName,Co),Y.includes("satellite")){let Zu=await combineTilesJimp(Io,rl,rl);idbKeyval.set("sat_image_buffer",Zu),await fileUtils.writeFileToDisk(f,o.satelliteFileName,Zu)}let as=await idbKeyval.get("rgb_image_buffer"),$s=await mapUtils.loadImageFromArray(as),ah=mapUtils.createHeightMapImage($s,32,"GREY");if(await fileUtils.fileExists(f,o.thirtyTwoFileName)===!1){let Zu=await ah.image.toBuffer();await fileUtils.writeFileToDisk(f,o.thirtyTwoFileName,Zu)}emitter.emit("updatePreviewImage",{dir_handle:f,tile_info:o,preview_image_info:ah,map:t,updateStats:C}),e.qt.loading.hide()}else{let rl;for(let ch of Ur){let Zu={};o=mapUtils.getTileInfo(0,0,!0,ch.x,ch.y,ch.z,o.bbox),e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance;let al=e.maptiler_style_url.replace("style.json","")+`${o.z}/${o.x}/${o.y}.png?key=`+e.maptiler_access_token;rl=await(await mapUtils.getMapboxTerrainRgb(al)).toBuffer(),ze===!0&&await fileUtils.writeFileToDisk(f,o.mapFileName,rl),Zu.x=o.x,Zu.y=o.y,Zu.buffer=rl,kn.push(Zu)}let Co=!1;idbKeyval.set("tile_info",o);const as=512;let $s=await combineTilesJimp(kn,as,as);await idbKeyval.set("map_image_buffer",$s),await fileUtils.writeFileToDisk(f,o.mapFileName,$s);let ah=await mapUtils.loadImageFromArray($s);x.image=ah,emitter.emit("updatePreviewImage",{dir_handle:f,tile_info:o,preview_image_info:x,map:t,updateStats:Co}),e.qt.loading.hide()}}catch(rl){console.log(rl),e.alertMsg=rl,e.alert=!0,e.qt.loading.hide()}e.qt.loading.hide()}})}}},_withScopeId=e=>(pushScopeId("data-v-cfeeea1a"),e=e(),popScopeId(),e),_hoisted_1$4={id:"map"},_hoisted_2$3=_withScopeId(()=>createBaseVNode("pre",{id:"features"},null,-1)),_hoisted_3$3={class:"row no-wrap q-pa-md"},_hoisted_4$3={class:"column"},_hoisted_5$3=_withScopeId(()=>createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1)),_hoisted_6$3=_withScopeId(()=>createBaseVNode("div",{class:"text-h6"},"Alert",-1));function _sfc_render$4(e,t,r,n,a,s){return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$4,[_hoisted_2$3,createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("div",_hoisted_4$3,[_hoisted_5$3,createVNode(QOptionGroup,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:n.layer_type,type:"toggle",modelValue:n.layers,"onUpdate:modelValue":[t[0]||(t[0]=f=>n.layers=f),s.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),createTextVNode("   "+toDisplayString(" Zoom: "+this.zoom+" "+this.tileInfoString),1)]),_:1})]),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[1]||(t[1]=f=>n.alert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_6$3]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const MaptilerMapViewer=_export_sfc(_sfc_main$4,[["render",_sfc_render$4],["__scopeId","data-v-cfeeea1a"]]),wieghtmapViewer_vue_vue_type_style_index_0_scoped_a7c2d78d_lang="";let mapweight=null;const _sfc_main$3={name:"weightmap-viewer",setup(){return{qt:useQuasar(),access_token:ref("")}},methods:{async loadMapboxWeightMap(){let e=await idbKeyval.get("tile_info");if(e.hasOwnProperty("bbox")){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken;let r="mapbox://styles/"+(await idbKeyval.get("mapbox_raster_style_url")||"");mapweight===null&&(mapweight=new mapboxgl.Map({container:"mapweight",style:r})),mapweight.on("load",()=>{this.loadMapSourcesLayers(mapweight),mapweight.getSource("bounding_box_source").setData(e.polygon_bb),mapweight.setPaintProperty("bounding_box","fill-opacity",.45),mapweight.fitBounds(e.bbox)}),mapweight.getSource("bounding_box_source").setData(e.polygon_bb),mapweight.setPaintProperty("bounding_box","fill-opacity",.45),mapweight.fitBounds(e.bbox)}},loadMapSourcesLayers(e){mapweight.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),mapweight.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}})}}},_hoisted_1$3={id:"mapweight"};function _sfc_render$3(e,t,r,n,a,s){return openBlock(),createElementBlock("div",_hoisted_1$3)}const WeightmapViewer=_export_sfc(_sfc_main$3,[["render",_sfc_render$3],["__scopeId","data-v-a7c2d78d"]]),useRatioProps={ratio:[String,Number]};function useRatio(e,t){return computed(()=>{const r=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(r)!==!0&&r>0?{paddingBottom:`${100/r}%`}:null})}const defaultRatio=16/9,QImg=createComponent({name:"QImg",props:{...useRatioProps,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:defaultRatio},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:r}){const n=ref(e.initialRatio),a=useRatio(e,n);let s=null,f=!1;const o=[ref(null),ref(kn())],x=ref(0),C=ref(!1),P=ref(!1),Y=computed(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),ze=computed(()=>({width:e.width,height:e.height})),ge=computed(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),Bt=computed(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));watch(()=>Ur(),Io);function Ur(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function kn(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function Io(Zu){s!==null&&(clearTimeout(s),s=null),P.value=!1,Zu===null?(C.value=!1,o[x.value^1].value=kn()):C.value=!0,o[x.value].value=Zu}function rl({target:Zu}){f!==!0&&(s!==null&&(clearTimeout(s),s=null),n.value=Zu.naturalHeight===0?.5:Zu.naturalWidth/Zu.naturalHeight,Co(Zu,1))}function Co(Zu,ih){f===!0||ih===1e3||(Zu.complete===!0?as(Zu):s=setTimeout(()=>{s=null,Co(Zu,ih+1)},50))}function as(Zu){f!==!0&&(x.value=x.value^1,o[x.value].value=null,C.value=!1,P.value=!1,r("load",Zu.currentSrc||Zu.src))}function $s(Zu){s!==null&&(clearTimeout(s),s=null),C.value=!1,P.value=!0,o[x.value].value=null,o[x.value^1].value=kn(),r("error",Zu)}function ah(Zu){const ih=o[Zu].value,al={key:"img_"+Zu,class:ge.value,style:Bt.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...ih};return x.value===Zu?(al.class+=" q-img__image--waiting",Object.assign(al,{onLoad:rl,onError:$s})):al.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+Zu},h("img",al))}function ch(){return C.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},hSlot(t[P.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[h(QSpinner,{color:e.spinnerColor,size:e.spinnerSize})])}return Io(Ur()),onBeforeUnmount(()=>{f=!0,s!==null&&(clearTimeout(s),s=null)}),()=>{const Zu=[];return a.value!==null&&Zu.push(h("div",{key:"filler",style:a.value})),P.value!==!0&&(o[0].value!==null&&Zu.push(ah(0)),o[1].value!==null&&Zu.push(ah(1))),Zu.push(h(Transition,{name:"q-transition--fade"},ch)),h("div",{class:Y.value,style:ze.value,role:"img","aria-label":e.alt},Zu)}}});let Gdal,ZrangeSeaLevel=32767;const _sfc_main$2={name:"SideNav",setup(){const e=useQuasar();return{alert:ref(!1),isAlphaBrush:ref(!1),blurRadius:ref(0),blurRadiusWeightmap:ref(10),gridSize:ref(2),access_token:ref(""),isDisabled:ref(!1),isDownload:ref(!0),isWorldPartition:ref(!1),isLandscape:ref(!0),isExportOptions:ref(!0),isBlurRadius:ref(!0),isSendToUnreal:ref(!0),unrealLandscape:ref({label:505,value:505}),landscapeSize:[{label:"8129x8129",value:8129},{label:"6097x6097",value:6097},{label:"4033x4033",value:4033},{label:"3025x3025",value:3025},{label:"2017x2017",value:2017},{label:"1513x1513",value:1513},{label:"1009x1009",value:1009},{label:"512x512 -- Native Resolution",value:512},{label:"505x505",value:505}],url:ref(""),tile_info:ref(""),satellite_endpoint:ref(""),satellite_image_url:ref(""),mapserver:ref(""),raster_style_endpoint:ref(""),raster_style_url:ref(""),weightmap_url:ref(""),save_fileName:ref(""),dirHandle:ref(""),preview_image_info:ref(""),rgb_image:ref(""),img_min:ref(""),img_max:ref(""),map:null,data:null,bbinfoalert:ref(!1),exportType:ref({label:"Unreal Heightmap",value:"Unreal Heightmap"}),landscapeName:ref(""),alphaBrushName:ref(""),alphaBrushHeight:ref(505),alphaBrushWidth:ref(505),unrealMapPath:ref(""),qt:e,exportOptionsModel:ref(["zrange","combine_features"]),alertMsg:ref(""),exportOptions:[],computed:{exportOptions:function(){this.forceRefresh()}},exportTypeOptions:[{label:"Unreal Heightmap",value:"Unreal Heightmap"},{label:"Unreal Terrain Magic Plugin -- EarthLandscape Clip",value:"Unreal Terrain Magic Plugin -- EarthLandscape Clip"},{label:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip",value:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"},{label:"Unreal Stamp Brush Plugin",value:"Unreal Stamp Brush Plugin"},{label:"Unreal Landmass Effect Brush Plugin",value:"Unreal Landmass Effect Brush Plugin",cannotSelect:!1},{label:"None",value:"none"},{label:"Geojson Only",value:"geojson_only"},{label:"Image of map only",value:"map-image"}]}},async mounted(){this.exportType={label:"Unreal Heightmap",value:"Unreal Heightmap"},idbKeyval.set("exportType",toRaw(this.exportType)),Gdal=await initGdalJs({path:"https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package",useWorker:!1}),emitter.on("updatePreviewImage",e=>{this.data=e,this.updatePreviewImage()})},methods:{async forceRefresh(){this.mapserver=await idbKeyval.get("mapserver"),this.mapserver==="Maptiler"?this.exportOptions=[{label:"Zrange-sea level=0",value:"zrange"},{label:"Flip X",value:"flipx"},{label:"Flip y",value:"flipy"},{label:"Download Satellite",value:"satellite"},{label:"Download Geojson Features",value:"features"},{label:"Combine Unique Features",value:"combine_features"}]:this.exportOptions=[{label:"Zrange-sea level=0",value:"zrange"},{label:"Flip X",value:"flipx"},{label:"Flip y",value:"flipy"},{label:"Download Satellite",value:"satellite"},{label:"Download Geojson Features",value:"features"},{label:"Combine Unique Features",value:"combine_features"},{label:"Create Weightmap (Splatmap) Files",value:"raster_style"}],this.$forceUpdate()},showNotify(e,t,r,n,a){this.qt.notify({message:e,color:t,position:r,icon:n,textColor:a})},copyTileInfoString(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Tile info string copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},copyExtents(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.bboxW+","+this.tile_info.bboxS+","+this.tile_info.bboxE+","+this.tile_info.bboxN;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Bounding box coordinates copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},landscapeSizeChange(){this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale()},adjustedZscale(){let e=this.getUnrealZScale(this.preview_image_info.maxElevation,this.preview_image_info.minElevation),t=this.getUnrealXYScale();return this.tile_info.xyscale=t.toFixed(3),this.exportOptionsModel.includes("zrange")?(this.tile_info.startZRange=ZrangeSeaLevel,this.tile_info.zscale=e.toFixed(3)):(this.tile_info.startZRange=0,this.tile_info.zscale=e.toFixed(3)),this.tile_info.zscale},exportOptionsModelChange(e){this.exportOptionsModel=e,this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale();let t=toRaw(this.exportOptionsModel);idbKeyval.set("exportOptionsModel",t)},exportType_Change(e){idbKeyval.set("exportType",toRaw(this.exportType)),this.exportType.label==="Unreal Heightmap"||this.exportType.label==="None"||this.exportType.label==="Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"?(this.isDownload=!0,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!0,this.isExportOptions=!0,this.isBlurRadius=!0):this.exportType.label==="Unreal Stamp Brush Plugin"||this.exportType.label==="Unreal Landmass Effect Brush Plugin"?(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!0,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!0):this.exportType.label==="Geojson Only"?(this.isDownload=!0,this.isSendToUnreal=!1,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1):this.exportType.label==="Image of map only"?(this.isDownload=!0,this.isSendToUnreal=!1,this.isAlphaBrush=!1,this.isLandscape=!0,this.isExportOptions=!1,this.isBlurRadius=!1):this.exportType.label==="Unreal Terrain Magic Plugin -- EarthLandscape Clip"&&(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1)},showBBInfo(){this.tile_info?this.bbinfoalert=!0:(this.bbinfoalert=!1,this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},updateStats(){this.preview_image_info.maxElevation!==""?(this.tile_info.MaxElevation=this.preview_image_info.maxElevation,this.tile_info.MinElevation=this.preview_image_info.minElevation,this.tile_info.minmax=this.tile_info.MinElevation.toFixed(3)+" / "+this.tile_info.MaxElevation.toFixed(3),this.tile_info.elevation_range=(this.tile_info.MaxElevation-this.tile_info.MinElevation).toFixed(3),this.tile_info.zscale=this.adjustedZscale()):this.tile_info.minmax=""},getUnrealZScale(e,t){let r,n;return this.exportOptionsModel.includes("zrange")?r=e*100:(t<0&&(t=0),r=(e-t)*100),n=r*.001953125,n},getUnrealXYScale(){return this.tile_info.distance*1e3/this.unrealLandscape.value*100},async updatePreviewImage(){this.preview_image_info=await this.data.preview_image_info,this.tile_info=this.data.tile_info,this.map=this.data.map;let e=await this.preview_image_info.image.toBlob();const t=URL.createObjectURL(e);this.url=t,this.data.updateStats===!0&&this.updateStats(this.tile_info)},async saveImage(e,t,r){let n=await idbKeyval.get("dirHandle"),a=new Blob([e],{type:"image/"+r});await fileUtils.writeFileToDisk(n,t,a)},async processGdal(e,t,r,n,a){let s;this.exportType.label==="Image of map only"?(console.log("test"),s=new Blob([e],{type:"image/"+n})):s=new Blob([new Uint8Array(e)],{type:"image/"+n});const f=new File([s],t),x=(await Gdal.open(f)).datasets[0],C=await Gdal.gdal_translate(x,r),P=await Gdal.getFileBytes(C);a==="createHeightmap"&&await this.saveImage(P,t,n),Gdal.close(x)},async sendToUnreal(){let e="http://localhost:30010/",t="remote/object/call",r={},n,a,s,f="Mapbox_BP",o,x,C,P;if(this.tile_info)if(r={objectPath:"/Script/UnrealEd.Default__EditorActorSubsystem",functionName:"GetAllLevelActors"},n=await mapUtils.unrealRemoteControl(r,e+t),n.error)n.error.message==="Failed to fetch"?this.alertMsg="Cannot connect to Unreal server. Please make sure your project is open and Mapbox_BP is in the scene.  Also make sure you launched the Map using the Select Map button as this starts the Unreal Web Server":this.alertMsg=n.error.message,this.alert=!0;else{let Y=await n.response.json();for(let ze of Y.ReturnValue)if(a=ze.includes(f),a===!0){s=ze;break}else s=null;if(s){this.exportType.label!=="Unreal Terrain Magic Plugin -- EarthLandscape Clip"?await this.createSixteenHeightMap():this.tile_info.resolution="505",this.exportType.label==="Unreal Stamp Brush Plugin"&&(o="/Game/Brushes/CustomBrushes/",x="/Game/Brushes/PEAKS/Peak_10_brush.Peak_10_brush",C="Textures/",P="HeightMap"),this.exportType.label==="Unreal Landmass Effect Brush Plugin"&&(o="/Game/Editor/Landscape/LandmassEffectBrush/CustomBrushes/",x="/Game/Editor/Landscape/LandmassEffectBrush/Effects/Variants/Map/HeightMapEffect.HeightMapEffect",C="Textures/",P="Heightmap (Greyscale / White is High)"),this.unrealMapPath=await idbKeyval.get("mappath"),this.tile_info.landscapeName=this.landscapeName;let ze=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z,ge;this.isWorldPartition===!0?ge=this.gridSize:ge=0,r={objectPath:s,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:this.tile_info.landscapeName,LandscapeSize:this.tile_info.resolution.toString(),TileHeightmapFileName:this.tile_info.sixteenFileName,TileGeojsonFileName:this.tile_info.geoJsonFileName,TileInfoFileName:this.tile_info.tileInfoFileName,MapMiddleLngX:this.tile_info.center.lng,MapMiddleLatY:this.tile_info.center.lat,MapBtmRLng:this.tile_info.bottomRight.lng,MapBtmLLng:this.tile_info.bottomLeft.lng,MapTopLLat:this.tile_info.topLeft.lat,MapBtmLLat:this.tile_info.bottomLeft.lat,RunFunction:this.exportType.label,SlippyMapTileString:ze.trim(),HeightMapTexturesPath:"/Game/ImportedHeightMaps/",AlphaBrushName:this.tile_info.alphaBrushFileName,AlphaBrushDestinationPath:o,AlphaBrushTemplatePath:x,AlphaBrushTexturesPath:C,HeightmapProperty:P,WorldPartitionGridSize:ge.toString()}},n=await mapUtils.unrealRemoteControl(r,e+t),n.error?(console.log(n.error),this.alertMsg=n.error.message,this.alert=!0):console.log(await n.response.json())}else this.alertMsg="Could not find Mapbox_BP in scene",this.alert=!0}else this.alertMsg="Please double click on your chosen selection first",this.alert=!0;this.qt.loading.hide()},async unrealTileFeatures(e){let t=mapUtils.getFeaturesFromBB(this.map,this.tile_info,e),r=JSON.stringify(t),n=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.geoJsonFileName,r),await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.tileInfoFileName,n)},async createSixteenHeightMap(){if(this.qt.loading.show(),this.mapserver=await idbKeyval.get("mapserver"),this.mapserver==="Mapbox"?(this.access_token=await idbKeyval.get("mapbox_access_token"),this.satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint"),this.satellite_image_url=this.satellite_endpoint+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token,this.raster_style_endpoint=await idbKeyval.get("mapbox_raster_style_endpoint"),this.raster_style_url=await idbKeyval.get("mapbox_raster_style_url"),this.weightmap_url=this.raster_style_endpoint+"/"+this.raster_style_url+`/tiles/512/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token):this.mapserver==="Maptiler"&&(this.access_token=await idbKeyval.get("maptiler_access_token"),this.satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint"),this.satellite_image_url=this.satellite_endpoint+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}.jpg?key=`+this.access_token,this.raster_style_endpoint=await idbKeyval.get("maptiler_raster_style_endpoint"),this.raster_style_url=await idbKeyval.get("maptiler_raster_style_url"),this.weightmap_url=this.raster_style_endpoint+"/"+this.raster_style_url+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}.png?key=`+this.access_token),this.tile_info){if(this.tile_info.resizeMethod="lanczos",this.exportType.label==="Image of map only"){let e=await idbKeyval.get("map_image_buffer"),t=["-of","PNG","-outsize",this.unrealLandscape.value.toString(),this.unrealLandscape.value.toString()];await this.processGdal(e,"map_image_"+this.tile_info.mapboxTileName+"_"+this.unrealLandscape.value.toString()+".png",t,"png","createHeightmap"),this.qt.loading.hide()}else{let e,t;if(this.tile_info.resolution=this.unrealLandscape.value,this.tile_info.geoJsonFileName="geojson-"+this.tile_info.mapboxTileName+".json",this.tile_info.tileInfoFileName="tile-info-"+this.tile_info.mapboxTileName+".json",this.tile_info.sixteenFileName="sixteen-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".png",this.tile_info.satelliteFileName="satellite-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".jpg",this.qt.loading.show(),this.dirHandle=await idbKeyval.get("dirHandle"),await fileUtils.verifyPermission(this.dirHandle,!0)===!1){console.error(`User did not grant permission to '${this.dirHandle.name}'`);return}if(fileUtils.fileExists(this.dirHandle,this.tile_info.thirtytwoFile)){let n=await idbKeyval.get("rgb_image_buffer"),a=await mapUtils.loadImageFromArray(n),s=mapUtils.createHeightMapImage(a,16,"GREY"),f=s.image;if(this.exportOptionsModel.includes("flipy")&&(f=await f.flipY()),this.exportOptionsModel.includes("flipx")&&(f=await f.flipX()),this.blurRadius>=1&&(f=f.blurFilter({radius:this.blurRadius})),t=await f.toBuffer(),this.img_min=parseInt(s.minElevation).toString(),this.img_max=parseInt(s.maxElevation).toString(),this.tile_info.resampleSize=this.unrealLandscape.value.toString(),this.tile_info.exportTypeLabel=this.exportType.label,this.tile_info.alphaBrushFileName="alphabrush-"+this.tile_info.mapboxTileName+"-height-"+this.alphaBrushHeight+"-width-"+this.alphaBrushWidth,this.exportOptionsModel.includes("features")){let o=!1;this.exportOptionsModel.includes("combine_features")&&(o=!0),await this.unrealTileFeatures(o)}switch(this.tile_info.exportTypeLabel){case"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip":if(e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")){e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod];let o;await fileUtils.fileExists(this.dirHandle,this.tile_info.satFileName)===!0?o=await idbKeyval.get("sat_image_buffer"):o=await mapUtils.downloadTerrainRgb(this.satellite_image_url),await this.processGdal(o,this.tile_info.satelliteFileName,e,"jpg","createHeightmap")}this.qt.loading.hide();break;case"Unreal Heightmap":if(this.tile_info.resampleSize!==512)e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")&&(e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod],await fileUtils.fileExists(this.dirHandle,this.tile_info.satFileName)===!0?t=await idbKeyval.get("sat_image_buffer"):t=await mapUtils.downloadTerrainRgb(this.satellite_image_url),await this.processGdal(t,this.tile_info.satelliteFileName,e,"jpg","createHeightmap"));else if(await this.saveImage(t,this.tile_info.sixteenFileName,"png"),this.exportOptionsModel.includes("satellite")){let o=await mapUtils.downloadTerrainRgb(this.satellite_image_url);await this.saveImage(o,this.tile_info.satelliteFileName,"jpg")}this.qt.loading.hide();break;case"Geojson Only":await this.unrealTileFeatures(!0),this.qt.loading.hide();break;case"Unreal Stamp Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"Unreal Landmass Effect Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"None":await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.sixteenFileName,f.toBuffer()),this.qt.loading.hide();break}}else this.alertMsg="Please double click on your chosen selection first.",this.alert=!0}this.qt.loading.hide()}else this.alertMsg="Please double click on your chosen selection first.",this.alert=!0,this.qt.loading.hide()}}},_hoisted_1$2=createBaseVNode("div",{id:"previewTitle",class:"text-h6 bg-primary text-white"},"Preview Image",-1),_hoisted_2$2={class:"row justify-start q-pa-none q-mb-md"},_hoisted_3$2={style:{width:"100%"}},_hoisted_4$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_5$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_6$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Type:")],-1),_hoisted_7$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Options:")],-1),_hoisted_8$2=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Coordinates for Unreal LandscapeGen Plugin")],-1),_hoisted_9$2=createBaseVNode("div",{class:"text-h6"},"Zoom:",-1),_hoisted_10$2=createBaseVNode("div",{class:"text-h6"},"Mouse Point Lat/Lng:",-1),_hoisted_11$2=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Bounding Box Corners Lat/Lng:")],-1),_hoisted_12$2=createBaseVNode("div",{class:"text-h6"},"Top Left:",-1),_hoisted_13$2=createBaseVNode("div",{class:"text-h6"},"Bottom Left:",-1),_hoisted_14=createBaseVNode("div",{class:"text-h6"},"Top Right:",-1),_hoisted_15=createBaseVNode("div",{class:"text-h6"},"Bottom Right:",-1),_hoisted_16=createBaseVNode("div",{class:"text-h6"},"Lng/Lat Max/Min:",-1),_hoisted_17=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$2(e,t,r,n,a,s){return openBlock(),createElementBlock(Fragment,null,[_hoisted_1$2,createVNode(QImg,{src:n.url,height:"250px"},null,8,["src"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(QField,{dense:"",class:"text-weight-bolder q-pt-none q-mt-xs",label:"Min/Max Elevation","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_4$2,toDisplayString(this.tile_info.minmax),1)]),_:1}),createVNode(QField,{class:"q-pt-none q-mt-xs",dense:"",label:"Unreal X,Y and Z-Scale",hint:"Input into Unreal Landscape Z scale","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_5$2,toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.zscale),1)]),_:1}),createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_6$2]),_:1}),createVNode(QSelect,{class:"q-mt-none q-pt-none","bg-color":"blue-2",outlined:"",filled:"",dense:"",modelValue:n.exportType,"onUpdate:modelValue":[t[0]||(t[0]=f=>n.exportType=f),s.exportType_Change],options:n.exportTypeOptions,"option-disable":"cannotSelect"},null,8,["modelValue","options","option-disable","onUpdate:modelValue"]),withDirectives(createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_7$2]),_:1},512),[[vShow,n.isExportOptions]]),withDirectives(createVNode(QOptionGroup,{class:"q-mt-none q-pt-none",dense:"",inline:"",options:n.exportOptions,"onUpdate:modelValue":[s.exportOptionsModelChange,t[1]||(t[1]=f=>n.exportOptionsModel=f)],type:"checkbox",modelValue:n.exportOptionsModel},null,8,["options","onUpdate:modelValue","modelValue"]),[[vShow,n.isExportOptions]]),withDirectives(createVNode(QSelect,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Size","transition-show":"scale","transition-hide":"scale",hint:"Unreal Recommended Sizes",outlined:"",modelValue:n.unrealLandscape,"onUpdate:modelValue":[t[2]||(t[2]=f=>n.unrealLandscape=f),s.landscapeSizeChange],options:n.landscapeSize},null,8,["modelValue","options","onUpdate:modelValue"]),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[createVNode(QCheckbox,{modelValue:n.isWorldPartition,"onUpdate:modelValue":t[3]||(t[3]=f=>n.isWorldPartition=f),label:"Enable World Partition"},null,8,["modelValue"])]),_:1},512),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"World Partition Grid Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:n.gridSize,"onUpdate:modelValue":t[4]||(t[4]=f=>n.gridSize=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Brush Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:n.alphaBrushHeight,"onUpdate:modelValue":t[5]||(t[5]=f=>n.alphaBrushHeight=f),label:"Height"},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:n.alphaBrushWidth,"onUpdate:modelValue":t[6]||(t[6]=f=>n.alphaBrushWidth=f),label:"Width"},null,8,["modelValue"]),createVNode(QInput,{ref:"alphaBrushNameRef",dense:"",modelValue:n.alphaBrushName,"onUpdate:modelValue":t[7]||(t[7]=f=>n.alphaBrushName=f),label:"Brush Name"},null,8,["modelValue"])]),_:1},512),[[vShow,n.isAlphaBrush]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Name (Optional)",hint:"Enter Unique Landscape Name"},{default:withCtx(()=>[createVNode(QInput,{dense:"",modelValue:n.landscapeName,"onUpdate:modelValue":t[8]||(t[8]=f=>n.landscapeName=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:n.blurRadius,"onUpdate:modelValue":t[9]||(t[9]=f=>n.blurRadius=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isBlurRadius]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Weightmap Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:n.blurRadiusWeightmap,"onUpdate:modelValue":t[10]||(t[10]=f=>n.blurRadiusWeightmap=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isBlurRadius]])])]),withDirectives(createVNode(QBtn,{onClick:s.createSixteenHeightMap,ref:"btnDownload",dense:"",color:"primary","no-caps":"",label:"Download HeightMap"},null,8,["onClick"]),[[vShow,n.isDownload]]),withDirectives(createVNode(QBtn,{onClick:s.sendToUnreal,disabled:n.isDisabled,dense:"",color:"green",class:"q-ml-xs","no-caps":"",label:"Send To Unreal"},null,8,["onClick","disabled"]),[[vShow,n.isSendToUnreal]]),createVNode(QBtn,{onClick:s.copyExtents,disabled:n.isDisabled,dense:"",color:"purple",class:"q-ml-xs","no-caps":"",label:"Copy Bounds for Blender Osm"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:s.copyTileInfoString,disabled:n.isDisabled,dense:"",color:"cyan",class:"q-ml-xs","no-caps":"",label:"Copy Slippy Tile Info String"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:s.showBBInfo,dense:"",color:"orange","no-caps":"",label:"Show Bounding Box Info"},null,8,["onClick"]),createVNode(QDialog,{modelValue:n.bbinfoalert,"onUpdate:modelValue":t[11]||(t[11]=f=>n.bbinfoalert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_8$2]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[_hoisted_9$2,createTextVNode(" "+toDisplayString(n.tile_info.z)+" ",1),_hoisted_10$2,createTextVNode(" Lat: "+toDisplayString(n.tile_info.pointLat)+" Lng: "+toDisplayString(n.tile_info.pointLng)+" ",1),_hoisted_11$2,_hoisted_12$2,createTextVNode(" Lat: "+toDisplayString(n.tile_info.topLeft.lat)+" Lng: "+toDisplayString(n.tile_info.topLeft.lng)+" ",1),_hoisted_13$2,createTextVNode(" Lat: "+toDisplayString(n.tile_info.bottomLeft.lat)+" Lng: "+toDisplayString(n.tile_info.bottomLeft.lng)+" ",1),_hoisted_14,createTextVNode(" Lat: "+toDisplayString(n.tile_info.topRight.lat)+" Lng: "+toDisplayString(n.tile_info.topRight.lng)+" ",1),_hoisted_15,createTextVNode(" Lat: "+toDisplayString(n.tile_info.bottomRight.lat)+" Lng: "+toDisplayString(n.tile_info.bottomRight.lng)+" ",1),_hoisted_16,createTextVNode(" Lng/Lat-Min: "+toDisplayString(n.tile_info.bboxW)+" , "+toDisplayString(n.tile_info.bboxS)+" Lng/Lat-Max: "+toDisplayString(n.tile_info.bboxE)+" , "+toDisplayString(n.tile_info.bboxN),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[12]||(t[12]=f=>n.alert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_17]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const SideNav=_export_sfc(_sfc_main$2,[["render",_sfc_render$2]]),version="2.8.0",_sfc_main$1={setup(){return{appVersion:ref(version)}},emits:["ok","hide"],methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){this.$emit("ok"),this.hide()},onCancelClick(){this.hide()}}},_hoisted_1$1=createBaseVNode("div",null,[createBaseVNode("b",null,"Help")],-1),_hoisted_2$1=createBaseVNode("br",null,null,-1),_hoisted_3$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Settings Page:")],-1),_hoisted_4$1=createBaseVNode("ol",null,[createBaseVNode("li",null,[createTextVNode(" You need to create a free Mapbox account and enter your mapbox access token. Goto "),createBaseVNode("a",{href:"https://www.mapbox.com",target:"_blank"},"Mapbox"),createTextVNode(" then goto your account page. There you can copy your access token. ")]),createBaseVNode("li",null," Select a download folder. This is a folder on your local pc where your heightmap files will be saved. ")],-1),_hoisted_5$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Map Page:")],-1),_hoisted_6$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Map Settings"),createTextVNode(" -- Enable different layers for viewing. This does not affect downloaded data ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Search Bar"),createTextVNode(" -- Enter the name of a location or Longitude Latitude seperated by a comma. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Top Bar"),createTextVNode(" -- Area in KM show the area of the blue bounding box in Kilometers. Slippy Tile Info String is a standard format identification for downloading map tiles. Format is X,Y,Z Z = zoom level. ")])],-1),_hoisted_7$1=createBaseVNode("div",{class:""},[createBaseVNode("b",null,"Map Navigation:")],-1),_hoisted_8$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Select a Draw mode"),createTextVNode(" -- Select a draw mode from the control on the right of the map. "),createBaseVNode("br"),createBaseVNode("u",null,[createBaseVNode("img",{src:"/single_tile.png",alt:"Single select"}),createTextVNode(" Single tile select")]),createTextVNode(" -- Select a single tile (default mode) "),createBaseVNode("br"),createBaseVNode("u",null,[createBaseVNode("img",{src:"/multiple_tile.png",alt:"Multiple select"}),createTextVNode(" Draw rectangle to select multiple tiles")]),createTextVNode(" See Tile stitching video at the bottom for use. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Click"),createTextVNode(" -- Selects a location on the map indicated by a blue bounding box. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Double Left Mouse Click"),createTextVNode(" -- Download the tile preview and tile information. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Right Mouse Hold"),createTextVNode(" -- Tilt and Rotate the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Scroll Wheel"),createTextVNode(" -- Zoom in and out. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Arrow Keys"),createTextVNode(" -- Move around the map. ")])],-1),_hoisted_9$1=createBaseVNode("div",{class:"q-mb-md"},[createBaseVNode("b",null,"Left Side Bar:")],-1),_hoisted_10$1=createBaseVNode("div",{class:"q-ml-md"},[createBaseVNode("div",null,[createBaseVNode("u",null,"Export Type:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Heightmap"),createTextVNode(" -- Generates a 16-bit png heightmap file. Can be used in other applications besides Unreal. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- EarthLandscape Clip"),createTextVNode(" -- Sends tile info string x,y and zoom to Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added it to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"),createTextVNode(" -- Downloads heightmap from this app and loads it into Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Stamp Brush Plugin"),createTextVNode(" -- You need to install paid plugin "),createBaseVNode("a",{href:"https://www.unrealengine.com/marketplace/en-US/product/landscape-stamping-tool-100-custom-brushes?sessionInvalidated=true"},"Landscape Stamping Tool - 100+ Custom Brushes"),createTextVNode(". This automates the creation of new stamps from selected map location. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Landmass Effect Brush Plugin"),createTextVNode(" -- Open source plugin for creating non-destructive landmass stamps and other features. Download the source from here "),createBaseVNode("a",{href:"https://github.com/AWeinb/SimplerLandmassBlueprints"},"SimplerLandmassBlueprints"),createTextVNode(". From the Content folder copy the whole Editor folder to your Content directory. Each time you click Send To Unreal it will import the texture to a sub folder CustomBrushes > Textures. For now it only imports the texture you have to manually add the texture to the brush according to the github instructions. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"None"),createTextVNode(" -- Generate 16-bit png heightmap but do not do any other transformations to the image. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Geojson Only"),createTextVNode(" -- Do not download a heightmap png file. Just download a Geojson file. ")])])]),createBaseVNode("div",null,[createBaseVNode("u",null,"Export Options:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Zrange-sea level="),createTextVNode(" -- By checking this the imported heightmap will keep the landscape height near 100 Unreal Units. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"FlipX/FlipY"),createTextVNode(" -- Flips the sides of the heightmap image in the X or Y direction. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Satellite"),createTextVNode(" -- Downloads a Satellite Image of the selected area. This can be used as on overlay in UE. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Geojson Features"),createTextVNode(" -- Downloads the features of the selected area in geojson format. Search Mapbox for geosjon. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Combine Unique Features"),createTextVNode(" -- Removes overlapping features when downloading geojson ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Create Weightmap (Splatmap) Files"),createTextVNode(" -- You can now create weightmap files for use in Unreal for texturing your landscape. Setup and Use instructions https://www.youtube.com/watch?v=j_4pZ5EneVc&t=6s ")])])])],-1),_hoisted_11$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Landscape:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Size"),createTextVNode(" -- Resamples the size of the image to recommended Unreal Landscape sizes. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Enable World Partition"),createTextVNode(" -- If you have a World Partition project and want a World Partition landscape with proxies, enable this.. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"World Partition Grid Size"),createTextVNode(" -- Grid size setting. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Name"),createTextVNode(" -- Name of the landscape to be imported. (Optional ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Blur Radius"),createTextVNode(" -- Adds a gaussian blur to the heightmap png. This can help smooth out your imported landscape if it has some sharp edges. The greater the number the greater the blur. 0 = no blur. ")])])],-1),_hoisted_12$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Buttons:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Download Heightmap"),createTextVNode(" -- Downloads the heightmap png to the folder location on the settings page. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Send To Unreal"),createTextVNode(" -- Automatically imports heightmap or stamp into your Unreal project. Required -- Mapbox_BP has to be installed in to your unreal project and configured. You can download the free plugin here "),createBaseVNode("a",{href:"https://github.com/delebash/UnrealMapboxBridgePlugin"},"Unreal Mapbox Bridge Plugin"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Bounds for Blender OSM"),createTextVNode(" -- A plugin for blend that downloads real world map info into blender. It has it's own map but you can use this one as well since it has a search by name feature. Download "),createBaseVNode("a",{href:"https://github.com/vvoovv/blender-osm"},"Blender OSM"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Slippy Tile Info String"),createTextVNode(" -- This format is used in many other GIS applications to download map tile information. This is just a convenience function. This is also the same string Terrain Magic expects. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Show Bounding Box Info"),createTextVNode(" -- General info such as Long/Lat info for bounding box. ")])])],-1),_hoisted_13$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Videos:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("a",{href:"https://www.youtube.com/playlist?list=PLFCVXzupw1r_7ExUSGDxHGHU-gPRxOGeZ"},"Unreal Mapbox Bridge Tutorial Playlist")])])],-1);function _sfc_render$1(e,t,r,n,a,s){return openBlock(),createBlock(QDialog,{class:"dialog-plugin",ref:"dialog",onHide:s.onDialogHide},{default:withCtx(()=>[createVNode(QCard,{style:{width:"900px","max-width":"80vw",height:"700px"}},{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_1$1,_hoisted_2$1,createVNode(QSeparator),_hoisted_3$1,_hoisted_4$1,_hoisted_5$1,_hoisted_6$1,_hoisted_7$1,_hoisted_8$1,_hoisted_9$1,_hoisted_10$1,_hoisted_11$1,_hoisted_12$1,_hoisted_13$1,createVNode(QCardActions,{class:"absolute-top",align:"right"},{default:withCtx(()=>[createTextVNode(" App Version "+toDisplayString(n.appVersion)+"  ",1),createVNode(QBtn,{color:"primary",label:"Close",onClick:s.onOKClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"])}const Help=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),columns=[{name:"name",align:"left",label:"Name",field:"name",sortable:!0},{name:"color",align:"left",label:"Color",field:"color",sortable:!0}];let rows=[{name:"Forest",color:"201, 28, 19"},{name:"Water",color:"78, 143, 207"},{name:"Scrub",color:"143, 253, 139"},{name:"Trees",color:"34, 106, 32"},{name:"Rock",color:"101, 100, 93"},{name:"Sand",color:"243, 234, 129"},{name:"Grass",color:"33, 225, 29"},{name:"Glacier",color:"255, 255, 255"},{name:"Landcover",color:"0, 0, 0"},{name:"Hillshade",color:"242, 110, 220"}];const _sfc_main={setup(){const e=useQuasar(),t=ref([]),r=ref(!1);return{mapserver:ref("Mapbox"),servertype:["Maptiler","Mapbox"],selected:t,columns,rows:ref(rows),loading:r,pagination:ref({rowsPerPage:0}),getSelectedString(){return t.value.length===0?"":`${t.value.length} record${t.value.length>1?"s":""} selected of ${rows.length}`},showDialog(){e.dialog({component:Help,componentProps:{text:""}}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},data_path:"",selectedTab:ref("map"),alert:ref(!1),alertMsg:ref(""),saveStitchingFiles:ref(!1),dirHandle:ref(""),dirName:ref(""),maptiler_style_url:ref(""),maptiler_access_token:ref(""),maptiler_api_url:ref(""),maptiler_raster_png_dem:ref(""),maptiler_satellite_endpoint:ref(""),maptiler_raster_style_url:ref(""),maptiler_raster_style_endpoint:ref(""),mapbox_style_url:ref(""),mapbox_access_token:ref(""),mapbox_api_url:ref(""),mapbox_raster_style_endpoint:ref(""),mapbox_raster_style_url:ref(""),mapbox_raster_png_dem:ref(""),mapbox_satellite_endpoint:ref(""),isPwd:ref(!0),drawerLeft:ref(!1),createFolder:ref(!1)}},mounted:async function(){this.checkFileApiSupport(),await this.loadUserData(),this.isRequiredSettings()===!0&&await this.loadMap()},methods:{async mapserverChange(e){this.mapserver=e,idbKeyval.set("mapserver",this.mapserver),await this.loadUserData()},addRow(){let e={name:"Color",color:"0, 0, 0"};this.rows.push(e)},removeRow(){if(this.selected.length>0){let e=this.rows.filter(t=>!this.selected.includes(t));this.rows=JSON.parse(JSON.stringify(e)),this.saveRow()}else this.alertMsg="Select row(s) to delete.",this.alert=!0},saveRow(){if(isProxy(this.rows)){let e=toRaw(this.rows);idbKeyval.set("weightmap_data",e)}else idbKeyval.set("weightmap_data",this.rows)},checkFileApiSupport(){fileUtils.checkFileApiSupport()===!1&&(this.alertMsg="This browser does not support File System Access API.  Try Edge or Chrome.",this.alert=!0)},resizeMap(){this.mapserver==="Mapbox"?this.$refs.mapBoxViewer.resizeMap():this.mapserver==="Maptiler"&&this.$refs.mapTilerViewer.resizeMap()},changeDrawer(){this.drawerLeft=!this.drawerLeft},async loadMap(){this.selectedTab="map",await this.$nextTick(()=>{this.mapserver==="Mapbox"?this.$refs.mapBoxViewer.loadMapboxMap():this.mapserver==="Maptiler"&&this.$refs.mapTilerViewer.loadMapTilerMap(),this.$refs.sideNavRef.forceRefresh()})},async loadWeightMap(){await this.$nextTick(()=>{this.mapserver==="Mapbox"&&this.$refs.weightmapViewerRef.loadMapboxWeightMap()})},isRequiredSettings(){if(this.mapserver==="Mapbox")return this.mapbox_access_token&&this.mapbox_style_url&&this.dirName?!0:(this.redirectToSettings(),!1);if(this.mapserver==="Maptiler")return!0},redirectToSettings(){this.selectedTab="settings",Notify.create({color:"negative",textColor:"white",icon:"report_problem",message:"Please fill out the required fields!",position:"top"})},async openDirectory(){let e;try{e=await fileUtils.getDirHandle()}catch(t){if(t.name==="AbortError")return;console.error("An error occured trying to open the file.",t)}e&&(idbKeyval.set("dirHandle",e),this.dirName=e.name)},saveUserSettings(){if(idbKeyval.set("mapserver",this.mapserver),this.mapserver==="Maptiler"?(idbKeyval.set("maptiler_access_token",this.maptiler_access_token),idbKeyval.set("maptiler_style_url",this.maptiler_style_url),idbKeyval.set("maptiler_api_url",this.maptiler_api_url),idbKeyval.set("maptiler_raster_png_dem",this.maptiler_raster_png_dem),idbKeyval.set("maptiler_satellite_endpoint",this.maptiler_satellite_endpoint),idbKeyval.set("maptiler_raster_style_endpoint",this.maptiler_raster_style_endpoint),idbKeyval.set("maptiler_raster_style_url",this.maptiler_raster_style_url)):this.mapserver==="Mapbox"&&(idbKeyval.set("mapbox_access_token",this.mapbox_access_token),idbKeyval.set("mapbox_style_url",this.mapbox_style_url),idbKeyval.set("mapbox_api_url",this.mapbox_api_url),idbKeyval.set("mapbox_satellite_endpoint",this.mapbox_satellite_endpoint),idbKeyval.set("mapbox_raster_png_dem",this.mapbox_raster_png_dem),idbKeyval.set("mapbox_raster_style_endpoint",this.mapbox_raster_style_endpoint),idbKeyval.set("mapbox_raster_style_url",this.mapbox_raster_style_url)),idbKeyval.set("mapserver",this.mapserver),idbKeyval.set("create_folder",this.createFolder),idbKeyval.set("saveStitchingFiles",this.saveStitchingFiles),isProxy(this.rows)){let e=toRaw(this.rows);idbKeyval.set("weightmap_data",e)}else idbKeyval.set("weightmap_data",this.rows);this.isRequiredSettings()===!0&&this.loadMap()},async loadUserData(){this.mapserver=await idbKeyval.get("mapserver")||"Mapbox",this.mapserver==="Maptiler"?(this.maptiler_access_token=await idbKeyval.get("maptiler_access_token")||"",this.maptiler_style_url=await idbKeyval.get("maptiler_style_url")||"https://api.maptiler.com/maps/streets/style.json",this.maptiler_raster_png_dem=await idbKeyval.get("maptiler_raster_png_dem")||"https://api.maptiler.com/tiles/terrain-rgb-v2/",this.maptiler_api_url=await idbKeyval.get("maptiler_api_url")||"https://api.maptiler.com",this.maptiler_satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint")||"https://api.maptiler.com/tiles/satellite-v2",this.maptiler_raster_style_endpoint=await idbKeyval.get("maptiler_raster_style_endpoint")||"https://api.maptiler.com/maps",this.maptiler_raster_style_url=await idbKeyval.get("maptiler_raster_style_url")||""):this.mapserver==="Mapbox"&&(this.mapbox_access_token=await idbKeyval.get("mapbox_access_token")||"",this.mapbox_style_url=await idbKeyval.get("mapbox_style_url")||"mapbox://styles/mapbox/streets-v11",this.mapbox_api_url=await idbKeyval.get("mapbox_api_url")||"https://api.mapbox.com/v4/",this.mapbox_satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint")||"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles",this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem")||"mapbox.mapbox-terrain-dem-v1",this.mapbox_raster_style_endpoint=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",this.mapbox_raster_style_url=await idbKeyval.get("mapbox_raster_style_url")||"");let e=await idbKeyval.get("dirHandle")||"";this.createFolder=await idbKeyval.get("create_folder")||"",this.saveStitchingFiles=await idbKeyval.get("saveStitchingFiles")||!1;let t=await idbKeyval.get("weightmap_data")||[];t.length===0?(idbKeyval.set("weightmap_data",rows),this.rows=rows):this.rows=t,this.dirHandle=e,this.dirName=e.name}},components:{MapboxMapViewer,MaptilerMapViewer,WeightmapViewer,SideNav,Help}},_hoisted_1={class:"row q-pa-xs full-height"},_hoisted_2={key:0},_hoisted_3=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Maptiler Settings")],-1),_hoisted_4={key:1},_hoisted_5=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Mapbox Settings")],-1),_hoisted_6=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/access-token/",target:"_blank"},"Mapbox access token docs",-1),_hoisted_7=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/style-url/",target:"_blank"},"Mapbox style url docs",-1),_hoisted_8=createBaseVNode("a",{href:"https://api.mapbox.com/styles/v1/delebash/clfzz7dot000001qilz330eyt.html?title=copy&access_token=pk.eyJ1IjoiZGVsZWJhc2giLCJhIjoiY2t1YWxkODF0MGh2NjJxcXA4czBpdXlmdyJ9.D_ngzR7j4vU1CILtpNLg4Q&zoomwheel=true&fresh=true#8.76/35.8732/5.8202/0/7"},"Copy Mapbox Weightmap Style",-1),_hoisted_9={class:"q-pa-none row items-start"},_hoisted_10={class:"col q-pa-none"},_hoisted_11=createBaseVNode("br",null,null,-1),_hoisted_12={key:2,class:"q-pa-md"},_hoisted_13=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render(e,t,r,n,a,s){const f=resolveComponent("side-nav"),o=resolveComponent("mapbox-map-viewer"),x=resolveComponent("maptiler-map-viewer"),C=resolveComponent("weightmap-viewer");return openBlock(),createBlock(QLayout,{view:"lHr lpr lfr"},{default:withCtx(()=>[createVNode(QHeader,{dense:"",elevated:"",class:"bg-primary text-white","height-hint":"98"}),createVNode(QDrawer,{dense:"","show-if-above":"",modelValue:n.drawerLeft,"onUpdate:modelValue":t[0]||(t[0]=P=>n.drawerLeft=P),side:"left",onHide:s.resizeMap,class:"no-margin no-padding"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(QCard,{class:"col q-pl-xs"},{default:withCtx(()=>[createVNode(f,{ref:"sideNavRef"},null,512)]),_:1})])]),_:1},8,["modelValue","onHide"]),createVNode(QPageContainer,null,{default:withCtx(()=>[createVNode(QPage,{class:"row no-margin q-pa-sm"},{default:withCtx(()=>[createVNode(QCard,{class:"col"},{default:withCtx(()=>[createVNode(QTabs,{dense:"",modelValue:n.selectedTab,"onUpdate:modelValue":t[3]||(t[3]=P=>n.selectedTab=P),class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:withCtx(()=>[createVNode(QBtn,{dense:"",flat:"",onClick:s.changeDrawer,round:"",icon:"menu"},null,8,["onClick"]),createVNode(QTab,{dense:"",name:"map",label:"Map"}),n.mapserver=="Mapbox"?(openBlock(),createBlock(QTab,{key:0,dense:"",name:"weightmap",onClick:t[1]||(t[1]=P=>s.loadWeightMap()),label:"Weight Map"})):createCommentVNode("",!0),createVNode(QTab,{dense:"",name:"settings",label:"Settings"}),createVNode(QBtn,{style:{background:"#FF0080",color:"white"},label:"Help",class:"q-mr-lg",onClick:n.showDialog},null,8,["onClick"]),createVNode(QBtn,{dense:"",flat:"",round:"",onClick:t[2]||(t[2]=P=>e.$q.dark.toggle()),icon:e.$q.dark.isActive?"nights_stay":"wb_sunny"},null,8,["icon"])]),_:1},8,["modelValue"]),createVNode(QSeparator),createVNode(QTabPanels,{class:"q-pa-none q-ma-none","keep-alive":"",modelValue:n.selectedTab,"onUpdate:modelValue":t[26]||(t[26]=P=>n.selectedTab=P),animated:""},{default:withCtx(()=>[createVNode(QTabPanel,{name:"map",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[n.mapserver=="Mapbox"?(openBlock(),createBlock(o,{key:0,class:"col",ref:"mapBoxViewer"},null,512)):createCommentVNode("",!0),n.mapserver=="Maptiler"?(openBlock(),createBlock(x,{key:1,class:"col",ref:"mapTilerViewer"},null,512)):createCommentVNode("",!0)]),_:1}),createVNode(QTabPanel,{name:"weightmap",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[createVNode(C,{class:"col",ref:"weightmapViewerRef"},null,512)]),_:1}),createVNode(QTabPanel,{lass:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",name:"settings"},{default:withCtx(()=>[createVNode(QSelect,{"onUpdate:modelValue":[t[4]||(t[4]=P=>s.mapserverChange(P)),t[5]||(t[5]=P=>n.mapserver=P)],modelValue:n.mapserver,options:n.servertype,label:"Server Type"},null,8,["modelValue","options"]),n.mapserver=="Maptiler"?(openBlock(),createElementBlock("div",_hoisted_2,[_hoisted_3,createVNode(QInput,{dense:"",modelValue:n.maptiler_access_token,"onUpdate:modelValue":t[7]||(t[7]=P=>n.maptiler_access_token=P),label:"Maptiler Access Token *",filled:"",type:n.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Maptiler accounts page. The Maptiler free plan is a great choice.",rules:[P=>P&&P.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:n.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[6]||(t[6]=P=>n.isPwd=!n.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_style_url,"onUpdate:modelValue":t[8]||(t[8]=P=>n.maptiler_style_url=P),label:"Enter your Maptiler style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Maptiler Studio.",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_api_url,"onUpdate:modelValue":t[9]||(t[9]=P=>n.maptiler_api_url=P),label:"Maptiler base api url *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_raster_png_dem,"onUpdate:modelValue":t[10]||(t[10]=P=>n.maptiler_raster_png_dem=P),label:"Maptiler Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_satellite_endpoint,"onUpdate:modelValue":t[11]||(t[11]=P=>n.maptiler_satellite_endpoint=P),label:"Maptiler Satellite Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"])])):createCommentVNode("",!0),n.mapserver=="Mapbox"?(openBlock(),createElementBlock("div",_hoisted_4,[_hoisted_5,createTextVNode(" See: "),_hoisted_6,createVNode(QInput,{dense:"",modelValue:n.mapbox_access_token,"onUpdate:modelValue":t[13]||(t[13]=P=>n.mapbox_access_token=P),label:"Mapbox Access Token *",filled:"",type:n.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Mapbox accounts page. The Mapbox free plan is a great choice.",rules:[P=>P&&P.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:n.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[12]||(t[12]=P=>n.isPwd=!n.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createTextVNode(" See: "),_hoisted_7,createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_style_url,"onUpdate:modelValue":t[14]||(t[14]=P=>n.mapbox_style_url=P),label:"Enter your Mapbox style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Mapbox Studio.",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_api_url,"onUpdate:modelValue":t[15]||(t[15]=P=>n.mapbox_api_url=P),label:"Mapbox base api url *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_raster_png_dem,"onUpdate:modelValue":t[16]||(t[16]=P=>n.mapbox_raster_png_dem=P),label:"Mapbox Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_satellite_endpoint,"onUpdate:modelValue":t[17]||(t[17]=P=>n.mapbox_satellite_endpoint=P),label:"Mapbox Satellite Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createTextVNode(" Click "),_hoisted_8,createTextVNode(" to copy this style to your mapbox account and then paste your new style address in text box below in the format name/style id example: delebash/clfzz7dot000001qilz330eyt "),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_raster_style_url,"onUpdate:modelValue":t[18]||(t[18]=P=>n.mapbox_raster_style_url=P),label:"Mapbox Weight Map Style",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_raster_style_endpoint,"onUpdate:modelValue":t[19]||(t[19]=P=>n.mapbox_raster_style_endpoint=P),label:"Mapbox Raster From Style Endpoint",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"])])):createCommentVNode("",!0),createVNode(QCheckbox,{modelValue:n.saveStitchingFiles,"onUpdate:modelValue":t[20]||(t[20]=P=>n.saveStitchingFiles=P),label:"Save Temp Stitching files to disk"},null,8,["modelValue"]),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createVNode(QInput,{dense:"",class:"q-pb-none",modelValue:n.dirName,"onUpdate:modelValue":t[21]||(t[21]=P=>n.dirName=P),label:"Enter download directory path *",filled:"","lazy-rules":"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"])]),createVNode(QBtn,{class:"q-pb-none",dense:"",onClick:t[22]||(t[22]=P=>s.openDirectory()),color:"secondary",label:"Select download folder"})]),_hoisted_11,n.mapserver=="Mapbox"?(openBlock(),createElementBlock("div",_hoisted_12,[createVNode(QTable,{flat:"",bordered:"",title:"Weightmap colors",rows:n.rows,columns:n.columns,"row-key":"name","selected-rows-label":n.getSelectedString,selection:"multiple",selected:n.selected,"onUpdate:selected":t[23]||(t[23]=P=>n.selected=P),"virtual-scroll":"",pagination:n.pagination,"onUpdate:pagination":t[24]||(t[24]=P=>n.pagination=P),"rows-per-page-options":[0],loading:n.loading},{top:withCtx(()=>[createVNode(QBtn,{color:"primary",disable:n.loading,label:"Add new color",onClick:s.addRow},null,8,["disable","onClick"]),createVNode(QBtn,{class:"q-ml-sm",color:"primary",disable:n.loading,label:"Delete selected rows",onClick:s.removeRow},null,8,["disable","onClick"])]),body:withCtx(P=>[createVNode(QTr,{props:P},{default:withCtx(()=>[createVNode(QTd,null,{default:withCtx(()=>[createVNode(QCheckbox,{dense:"",modelValue:P.selected,"onUpdate:modelValue":Y=>P.selected=Y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),createVNode(QTd,{key:"name",props:P},{default:withCtx(()=>[createTextVNode(toDisplayString(P.row.name)+" ",1),createVNode(QPopupEdit,{modelValue:P.row.name,"onUpdate:modelValue":Y=>P.row.name=Y,title:"Name",onSave:s.saveRow},{default:withCtx(Y=>[createVNode(QInput,{modelValue:Y.value,"onUpdate:modelValue":ze=>Y.value=ze,dense:"",autofocus:"",counter:"",onKeyup:withKeys(Y.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),createVNode(QTd,{key:"color",props:P},{default:withCtx(()=>[createTextVNode(toDisplayString(P.row.color)+" ",1),createVNode(QPopupEdit,{modelValue:P.row.color,"onUpdate:modelValue":Y=>P.row.color=Y,title:"r,g,b",onSave:s.saveRow},{default:withCtx(Y=>[createVNode(QInput,{modelValue:Y.value,"onUpdate:modelValue":ze=>Y.value=ze,dense:"",autofocus:"",counter:"",onKeyup:withKeys(Y.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected-rows-label","selected","pagination","loading"])])):createCommentVNode("",!0),createVNode(QBtn,{class:"q-pt-none",dense:"",onClick:t[25]||(t[25]=P=>s.saveUserSettings()),color:"secondary",label:"Save settings"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[27]||(t[27]=P=>n.alert=P)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_13]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const MainLayout=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{MainLayout as default};
