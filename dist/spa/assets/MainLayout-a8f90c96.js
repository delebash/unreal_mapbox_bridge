import{r as ref,i as isRuntimeSsrPreHydration,o as onMounted,c as createComponent,g as getCurrentInstance,a as onBeforeUnmount,n as noop,b as nextTick,h,l as listenOpts,d as inject,e as emptyRenderFn,f as computed,w as watch,j as hUniqueSlot,k as layoutKey,P as Platform,m as createDirective,p as client$1,q as leftClick,s as addEvt,t as preventDraggable,u as prevent,v as stop,x as position,y as cleanEvt,z as stopAndPrevent,A as useModelToggleProps,B as useDarkProps,C as useModelToggleEmits,D as useDark,E as useTimeout,F as useModelToggle,G as useHistory,H as withDirectives,I as hDir,J as hSlot,K as usePreventScroll,L as tabsKey,R as Ripple,M as isKeyCode,N as shouldIgnoreKey,Q as QIcon,O as hMergeSlot,S as isDeepEqual,T as uid$1,U as useTick,V as provide,W as onDeactivated,X as onActivated,Y as Transition,Z as getNormalizedVNodes,_ as KeepAlive,$ as useFieldProps,a0 as useFieldEmits,a1 as useField,a2 as useFieldState,a3 as useSizeProps,a4 as useSize,a5 as hMergeSlotSafely,a6 as useRouterLinkProps,a7 as useRouterLink,a8 as portalProxyList,a9 as getScrollbarWidth,aa as useTransitionProps,ab as useTransition,ac as usePortal,ad as addFocusout,ae as removeFocusout,af as removeEscapeKey,ag as getScrollTarget,ah as closePortalMenus,ai as addFocusFn,aj as addEscapeKey,ak as childHasFocus,al as debounce$2,am as onBeforeMount,an as useFormProps,ao as useFormInputNameAttr,ap as fieldValueIsFilled,aq as onBeforeUpdate,ar as onUpdated,as as useKeyComposition,at as QDialog,au as injectProp,av as QBtn,aw as vmHasRouter,ax as History,ay as isNumber$1,az as isDate,aA as isObject$6,aB as injectMultipleProps,aC as QCheckbox,aD as QSeparator,aE as pageContainerKey,aF as getVerticalScrollPosition,aG as getHorizontalScrollPosition,aH as reactive,aI as onUnmounted,aJ as getPortalProxy,aK as closePortals,aL as quasarKey,aM as _export_sfc,aN as openBlock,aO as createElementBlock,aP as createBaseVNode,aQ as createVNode,aR as withCtx,aS as QOptionGroup,aT as createTextVNode,aU as toDisplayString,aV as QCard,aW as QCardSection,aX as QCardActions,aY as Fragment,aZ as pushScopeId,a_ as popScopeId,a$ as QSpinner,b0 as toRaw,b1 as vShow,b2 as QInput,b3 as createBlock,b4 as isProxy,b5 as Notify,b6 as resolveComponent,b7 as createCommentVNode,b8 as withKeys}from"./index-6a282966.js";import{Q as QPage}from"./QPage-e893c0e1.js";function _mergeNamespaces(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(n,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function useCanRender(){const e=ref(!isRuntimeSsrPreHydration.value);return e.value===!1&&onMounted(()=>{e.value=!0}),e}const hasObserver=typeof ResizeObserver<"u",resizeProps=hasObserver===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},QResizeObserver=createComponent({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:t}){let r=null,n,a={width:-1,height:-1};function s(x){x===!0||e.debounce===0||e.debounce==="0"?f():r===null&&(r=setTimeout(f,e.debounce))}function f(){if(r!==null&&(clearTimeout(r),r=null),n){const{offsetWidth:x,offsetHeight:C}=n;(x!==a.width||C!==a.height)&&(a={width:x,height:C},t("resize",a))}}const{proxy:o}=getCurrentInstance();if(hasObserver===!0){let x;const C=P=>{n=o.$el.parentNode,n?(x=new ResizeObserver(s),x.observe(n),f()):P!==!0&&nextTick(()=>{C(!0)})};return onMounted(()=>{C()}),onBeforeUnmount(()=>{r!==null&&clearTimeout(r),x!==void 0&&(x.disconnect!==void 0?x.disconnect():n&&x.unobserve(n))}),noop}else{let P=function(){r!==null&&(clearTimeout(r),r=null),C!==void 0&&(C.removeEventListener!==void 0&&C.removeEventListener("resize",s,listenOpts.passive),C=void 0)},ge=function(){P(),n&&n.contentDocument&&(C=n.contentDocument.defaultView,C.addEventListener("resize",s,listenOpts.passive),f())};const x=useCanRender();let C;return onMounted(()=>{nextTick(()=>{n=o.$el,n&&ge()})}),onBeforeUnmount(P),o.trigger=s,()=>{if(x.value===!0)return h("object",{style:resizeProps.style,tabindex:-1,type:"text/html",data:resizeProps.url,"aria-hidden":"true",onLoad:ge})}}}}),QHeader=createComponent({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=inject(layoutKey,emptyRenderFn);if(a===emptyRenderFn)return console.error("QHeader needs to be child of QLayout"),emptyRenderFn;const s=ref(parseInt(e.heightHint,10)),f=ref(!0),o=computed(()=>e.reveal===!0||a.view.value.indexOf("H")>-1||n.platform.is.ios&&a.isContainer.value===!0),x=computed(()=>{if(e.modelValue!==!0)return 0;if(o.value===!0)return f.value===!0?s.value:0;const tl=s.value-a.scroll.value.position;return tl>0?tl:0}),C=computed(()=>e.modelValue!==!0||o.value===!0&&f.value!==!0),P=computed(()=>e.modelValue===!0&&C.value===!0&&e.reveal===!0),ge=computed(()=>"q-header q-layout__section--marginal "+(o.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(C.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),nt=computed(()=>{const tl=a.rows.value.top,Io={};return tl[0]==="l"&&a.left.space===!0&&(Io[n.lang.rtl===!0?"right":"left"]=`${a.left.size}px`),tl[2]==="r"&&a.right.space===!0&&(Io[n.lang.rtl===!0?"left":"right"]=`${a.right.size}px`),Io});function ze(tl,Io){a.update("header",tl,Io)}function Bt(tl,Io){tl.value!==Io&&(tl.value=Io)}function qr({height:tl}){Bt(s,tl),ze("size",tl)}function _n(tl){P.value===!0&&Bt(f,!0),r("focusin",tl)}watch(()=>e.modelValue,tl=>{ze("space",tl),Bt(f,!0),a.animate()}),watch(x,tl=>{ze("offset",tl)}),watch(()=>e.reveal,tl=>{tl===!1&&Bt(f,e.modelValue)}),watch(f,tl=>{a.animate(),r("reveal",tl)}),watch(a.scroll,tl=>{e.reveal===!0&&Bt(f,tl.direction==="up"||tl.position<=e.revealOffset||tl.position-tl.inflectionPoint<100)});const Fn={};return a.instances.header=Fn,e.modelValue===!0&&ze("size",s.value),ze("space",e.modelValue),ze("offset",x.value),onBeforeUnmount(()=>{a.instances.header===Fn&&(a.instances.header=void 0,ze("size",0),ze("offset",0),ze("space",!1))}),()=>{const tl=hUniqueSlot(t.default,[]);return e.elevated===!0&&tl.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),tl.push(h(QResizeObserver,{debounce:0,onResize:qr})),h("header",{class:ge.value,style:nt.value,onFocusin:_n},tl)}}}),modifiersAll={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},directionList=Object.keys(modifiersAll);modifiersAll.all=!0;function getModifierDirections(e){const t={};for(const r of directionList)e[r]===!0&&(t[r]=!0);return Object.keys(t).length===0?modifiersAll:(t.horizontal===!0?t.left=t.right=!0:t.left===!0&&t.right===!0&&(t.horizontal=!0),t.vertical===!0?t.up=t.down=!0:t.up===!0&&t.down===!0&&(t.vertical=!0),t.horizontal===!0&&t.vertical===!0&&(t.all=!0),t)}const avoidNodeNamesList=["INPUT","TEXTAREA"];function shouldStart(e,t){return t.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof t.handler=="function"&&avoidNodeNamesList.includes(e.target.nodeName.toUpperCase())===!1&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(t.uid)===-1)}function clearSelection(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),Platform.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}function getChanges(e,t,r){const n=position(e);let a,s=n.left-t.event.x,f=n.top-t.event.y,o=Math.abs(s),x=Math.abs(f);const C=t.direction;C.horizontal===!0&&C.vertical!==!0?a=s<0?"left":"right":C.horizontal!==!0&&C.vertical===!0?a=f<0?"up":"down":C.up===!0&&f<0?(a="up",o>x&&(C.left===!0&&s<0?a="left":C.right===!0&&s>0&&(a="right"))):C.down===!0&&f>0?(a="down",o>x&&(C.left===!0&&s<0?a="left":C.right===!0&&s>0&&(a="right"))):C.left===!0&&s<0?(a="left",o<x&&(C.up===!0&&f<0?a="up":C.down===!0&&f>0&&(a="down"))):C.right===!0&&s>0&&(a="right",o<x&&(C.up===!0&&f<0?a="up":C.down===!0&&f>0&&(a="down")));let P=!1;if(a===void 0&&r===!1){if(t.event.isFirst===!0||t.event.lastDir===void 0)return{};a=t.event.lastDir,P=!0,a==="left"||a==="right"?(n.left-=s,o=0,s=0):(n.top-=f,x=0,f=0)}return{synthetic:P,payload:{evt:e,touch:t.event.mouse!==!0,mouse:t.event.mouse===!0,position:n,direction:a,isFirst:t.event.isFirst,isFinal:r===!0,duration:Date.now()-t.event.time,distance:{x:o,y:x},offset:{x:s,y:f},delta:{x:n.left-t.event.lastX,y:n.top-t.event.lastY}}}}let uid=0;const TouchPan=createDirective({name:"touch-pan",beforeMount(e,{value:t,modifiers:r}){if(r.mouse!==!0&&client$1.has.touch!==!0)return;function n(s,f){r.mouse===!0&&f===!0?stopAndPrevent(s):(r.stop===!0&&stop(s),r.prevent===!0&&prevent(s))}const a={uid:"qvtp_"+uid++,handler:t,modifiers:r,direction:getModifierDirections(r),noop,mouseStart(s){shouldStart(s,a)&&leftClick(s)&&(addEvt(a,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),a.start(s,!0))},touchStart(s){if(shouldStart(s,a)){const f=s.target;addEvt(a,"temp",[[f,"touchmove","move","notPassiveCapture"],[f,"touchcancel","end","passiveCapture"],[f,"touchend","end","passiveCapture"]]),a.start(s)}},start(s,f){if(client$1.is.firefox===!0&&preventDraggable(e,!0),a.lastEvt=s,f===!0||r.stop===!0){if(a.direction.all!==!0&&(f!==!0||a.modifiers.mouseAllDir!==!0&&a.modifiers.mousealldir!==!0)){const C=s.type.indexOf("mouse")>-1?new MouseEvent(s.type,s):new TouchEvent(s.type,s);s.defaultPrevented===!0&&prevent(C),s.cancelBubble===!0&&stop(C),Object.assign(C,{qKeyEvent:s.qKeyEvent,qClickOutside:s.qClickOutside,qAnchorHandled:s.qAnchorHandled,qClonedBy:s.qClonedBy===void 0?[a.uid]:s.qClonedBy.concat(a.uid)}),a.initialEvent={target:s.target,event:C}}stop(s)}const{left:o,top:x}=position(s);a.event={x:o,y:x,time:Date.now(),mouse:f===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:o,lastY:x}},move(s){if(a.event===void 0)return;const f=position(s),o=f.left-a.event.x,x=f.top-a.event.y;if(o===0&&x===0)return;a.lastEvt=s;const C=a.event.mouse===!0,P=()=>{n(s,C);let ze;r.preserveCursor!==!0&&r.preservecursor!==!0&&(ze=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),C===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),a.styleCleanup=Bt=>{if(a.styleCleanup=void 0,ze!==void 0&&(document.documentElement.style.cursor=ze),document.body.classList.remove("non-selectable"),C===!0){const qr=()=>{document.body.classList.remove("no-pointer-events--children")};Bt!==void 0?setTimeout(()=>{qr(),Bt()},50):qr()}else Bt!==void 0&&Bt()}};if(a.event.detected===!0){a.event.isFirst!==!0&&n(s,a.event.mouse);const{payload:ze,synthetic:Bt}=getChanges(s,a,!1);ze!==void 0&&(a.handler(ze)===!1?a.end(s):(a.styleCleanup===void 0&&a.event.isFirst===!0&&P(),a.event.lastX=ze.position.left,a.event.lastY=ze.position.top,a.event.lastDir=Bt===!0?void 0:ze.direction,a.event.isFirst=!1));return}if(a.direction.all===!0||C===!0&&(a.modifiers.mouseAllDir===!0||a.modifiers.mousealldir===!0)){P(),a.event.detected=!0,a.move(s);return}const ge=Math.abs(o),nt=Math.abs(x);ge!==nt&&(a.direction.horizontal===!0&&ge>nt||a.direction.vertical===!0&&ge<nt||a.direction.up===!0&&ge<nt&&x<0||a.direction.down===!0&&ge<nt&&x>0||a.direction.left===!0&&ge>nt&&o<0||a.direction.right===!0&&ge>nt&&o>0?(a.event.detected=!0,a.move(s)):a.end(s,!0))},end(s,f){if(a.event!==void 0){if(cleanEvt(a,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),f===!0)a.styleCleanup!==void 0&&a.styleCleanup(),a.event.detected!==!0&&a.initialEvent!==void 0&&a.initialEvent.target.dispatchEvent(a.initialEvent.event);else if(a.event.detected===!0){a.event.isFirst===!0&&a.handler(getChanges(s===void 0?a.lastEvt:s,a).payload);const{payload:o}=getChanges(s===void 0?a.lastEvt:s,a,!0),x=()=>{a.handler(o)};a.styleCleanup!==void 0?a.styleCleanup(x):x()}a.event=void 0,a.initialEvent=void 0,a.lastEvt=void 0}}};if(e.__qtouchpan=a,r.mouse===!0){const s=r.mouseCapture===!0||r.mousecapture===!0?"Capture":"";addEvt(a,"main",[[e,"mousedown","mouseStart",`passive${s}`]])}client$1.has.touch===!0&&addEvt(a,"main",[[e,"touchstart","touchStart",`passive${r.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const r=e.__qtouchpan;r!==void 0&&(t.oldValue!==t.value&&(typeof value!="function"&&r.end(),r.handler=t.value),r.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchpan;t!==void 0&&(t.event!==void 0&&t.end(),cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchpan)}});function between(e,t,r){return r<=t?t:Math.min(r,Math.max(t,e))}function normalizeToInterval(e,t,r){if(r<=t)return t;const n=r-t+1;let a=t+(e-t)%n;return a<t&&(a=n+a),a===0?0:a}const duration=150,QDrawer=createComponent({name:"QDrawer",inheritAttrs:!1,props:{...useModelToggleProps,...useDarkProps,side:{type:String,default:"left",validator:e=>["left","right"].includes(e)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:e=>["default","desktop","mobile"].includes(e),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...useModelToggleEmits,"onLayout","miniState"],setup(e,{slots:t,emit:r,attrs:n}){const a=getCurrentInstance(),{proxy:{$q:s}}=a,f=useDark(e,s),{preventBodyScroll:o}=usePreventScroll(),{registerTimeout:x,removeTimeout:C}=useTimeout(),P=inject(layoutKey,emptyRenderFn);if(P===emptyRenderFn)return console.error("QDrawer needs to be child of QLayout"),emptyRenderFn;let ge,nt=null,ze;const Bt=ref(e.behavior==="mobile"||e.behavior!=="desktop"&&P.totalWidth.value<=e.breakpoint),qr=computed(()=>e.mini===!0&&Bt.value!==!0),_n=computed(()=>qr.value===!0?e.miniWidth:e.width),Fn=ref(e.showIfAbove===!0&&Bt.value===!1?!0:e.modelValue===!0),tl=computed(()=>e.persistent!==!0&&(Bt.value===!0||Sd.value===!0));function Io(Yh,$d){if(ch(),Yh!==!1&&P.animate(),Uf(0),Bt.value===!0){const Jf=P.instances[vd.value];Jf!==void 0&&Jf.belowBreakpoint===!0&&Jf.hide(!1),qd(1),P.isContainer.value!==!0&&o(!0)}else qd(0),Yh!==!1&&Vd(!1);x(()=>{Yh!==!1&&Vd(!0),$d!==!0&&r("show",Yh)},duration)}function Co(Yh,$d){ju(),Yh!==!1&&P.animate(),qd(0),Uf(oh.value*_n.value),Kh(),$d!==!0?x(()=>{r("hide",Yh)},duration):C()}const{show:rl,hide:ah}=useModelToggle({showing:Fn,hideOnRouteChange:tl,handleShow:Io,handleHide:Co}),{addToHistory:ch,removeFromHistory:ju}=useHistory(Fn,ah,tl),Zu={belowBreakpoint:Bt,hide:ah},sl=computed(()=>e.side==="right"),oh=computed(()=>(s.lang.rtl===!0?-1:1)*(sl.value===!0?1:-1)),hh=ref(0),Sh=ref(!1),$h=ref(!1),hd=ref(_n.value*oh.value),vd=computed(()=>sl.value===!0?"left":"right"),Ef=computed(()=>Fn.value===!0&&Bt.value===!1&&e.overlay===!1?e.miniToOverlay===!0?e.miniWidth:_n.value:0),Cd=computed(()=>e.overlay===!0||e.miniToOverlay===!0||P.view.value.indexOf(sl.value?"R":"L")>-1||s.platform.is.ios===!0&&P.isContainer.value===!0),Cf=computed(()=>e.overlay===!1&&Fn.value===!0&&Bt.value===!1),Sd=computed(()=>e.overlay===!0&&Fn.value===!0&&Bt.value===!1),yd=computed(()=>"fullscreen q-drawer__backdrop"+(Fn.value===!1&&Sh.value===!1?" hidden":"")),Hd=computed(()=>({backgroundColor:`rgba(0,0,0,${hh.value*.4})`})),xd=computed(()=>sl.value===!0?P.rows.value.top[2]==="r":P.rows.value.top[0]==="l"),Pd=computed(()=>sl.value===!0?P.rows.value.bottom[2]==="r":P.rows.value.bottom[0]==="l"),zd=computed(()=>{const Yh={};return P.header.space===!0&&xd.value===!1&&(Cd.value===!0?Yh.top=`${P.header.offset}px`:P.header.space===!0&&(Yh.top=`${P.header.size}px`)),P.footer.space===!0&&Pd.value===!1&&(Cd.value===!0?Yh.bottom=`${P.footer.offset}px`:P.footer.space===!0&&(Yh.bottom=`${P.footer.size}px`)),Yh}),Ld=computed(()=>{const Yh={width:`${_n.value}px`,transform:`translateX(${hd.value}px)`};return Bt.value===!0?Yh:Object.assign(Yh,zd.value)}),Kd=computed(()=>"q-drawer__content fit "+(P.isContainer.value!==!0?"scroll":"overflow-auto")),wf=computed(()=>`q-drawer q-drawer--${e.side}`+($h.value===!0?" q-drawer--mini-animate":"")+(e.bordered===!0?" q-drawer--bordered":"")+(f.value===!0?" q-drawer--dark q-dark":"")+(Sh.value===!0?" no-transition":Fn.value===!0?"":" q-layout--prevent-focus")+(Bt.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${qr.value===!0?"mini":"standard"}`+(Cd.value===!0||Cf.value!==!0?" fixed":"")+(e.overlay===!0||e.miniToOverlay===!0?" q-drawer--on-top":"")+(xd.value===!0?" q-drawer--top-padding":""))),kd=computed(()=>{const Yh=s.lang.rtl===!0?e.side:vd.value;return[[TouchPan,_p,void 0,{[Yh]:!0,mouse:!0}]]}),cd=computed(()=>{const Yh=s.lang.rtl===!0?vd.value:e.side;return[[TouchPan,lp,void 0,{[Yh]:!0,mouse:!0}]]}),gd=computed(()=>{const Yh=s.lang.rtl===!0?vd.value:e.side;return[[TouchPan,lp,void 0,{[Yh]:!0,mouse:!0,mouseAllDir:!0}]]});function bp(){fd(Bt,e.behavior==="mobile"||e.behavior!=="desktop"&&P.totalWidth.value<=e.breakpoint)}watch(Bt,Yh=>{Yh===!0?(ge=Fn.value,Fn.value===!0&&ah(!1)):e.overlay===!1&&e.behavior!=="mobile"&&ge!==!1&&(Fn.value===!0?(Uf(0),qd(0),Kh()):rl(!1))}),watch(()=>e.side,(Yh,$d)=>{P.instances[$d]===Zu&&(P.instances[$d]=void 0,P[$d].space=!1,P[$d].offset=0),P.instances[Yh]=Zu,P[Yh].size=_n.value,P[Yh].space=Cf.value,P[Yh].offset=Ef.value}),watch(P.totalWidth,()=>{(P.isContainer.value===!0||document.qScrollPrevented!==!0)&&bp()}),watch(()=>e.behavior+e.breakpoint,bp),watch(P.isContainer,Yh=>{Fn.value===!0&&o(Yh!==!0),Yh===!0&&bp()}),watch(P.scrollbarWidth,()=>{Uf(Fn.value===!0?0:void 0)}),watch(Ef,Yh=>{Qd("offset",Yh)}),watch(Cf,Yh=>{r("onLayout",Yh),Qd("space",Yh)}),watch(sl,()=>{Uf()}),watch(_n,Yh=>{Uf(),Jd(e.miniToOverlay,Yh)}),watch(()=>e.miniToOverlay,Yh=>{Jd(Yh,_n.value)}),watch(()=>s.lang.rtl,()=>{Uf()}),watch(()=>e.mini,()=>{e.noMiniAnimation||e.modelValue===!0&&(ep(),P.animate())}),watch(qr,Yh=>{r("miniState",Yh)});function Uf(Yh){Yh===void 0?nextTick(()=>{Yh=Fn.value===!0?0:_n.value,Uf(oh.value*Yh)}):(P.isContainer.value===!0&&sl.value===!0&&(Bt.value===!0||Math.abs(Yh)===_n.value)&&(Yh+=oh.value*P.scrollbarWidth.value),hd.value=Yh)}function qd(Yh){hh.value=Yh}function Vd(Yh){const $d=Yh===!0?"remove":P.isContainer.value!==!0?"add":"";$d!==""&&document.body.classList[$d]("q-body--drawer-toggle")}function ep(){nt!==null&&clearTimeout(nt),a.proxy&&a.proxy.$el&&a.proxy.$el.classList.add("q-drawer--mini-animate"),$h.value=!0,nt=setTimeout(()=>{nt=null,$h.value=!1,a&&a.proxy&&a.proxy.$el&&a.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function _p(Yh){if(Fn.value!==!1)return;const $d=_n.value,Jf=between(Yh.distance.x,0,$d);if(Yh.isFinal===!0){Jf>=Math.min(75,$d)===!0?rl():(P.animate(),qd(0),Uf(oh.value*$d)),Sh.value=!1;return}Uf((s.lang.rtl===!0?sl.value!==!0:sl.value)?Math.max($d-Jf,0):Math.min(0,Jf-$d)),qd(between(Jf/$d,0,1)),Yh.isFirst===!0&&(Sh.value=!0)}function lp(Yh){if(Fn.value!==!0)return;const $d=_n.value,Jf=Yh.direction===e.side,Sf=(s.lang.rtl===!0?Jf!==!0:Jf)?between(Yh.distance.x,0,$d):0;if(Yh.isFinal===!0){Math.abs(Sf)<Math.min(75,$d)===!0?(P.animate(),qd(1),Uf(0)):ah(),Sh.value=!1;return}Uf(oh.value*Sf),qd(between(1-Sf/$d,0,1)),Yh.isFirst===!0&&(Sh.value=!0)}function Kh(){o(!1),Vd(!0)}function Qd(Yh,$d){P.update(e.side,Yh,$d)}function fd(Yh,$d){Yh.value!==$d&&(Yh.value=$d)}function Jd(Yh,$d){Qd("size",Yh===!0?e.miniWidth:$d)}return P.instances[e.side]=Zu,Jd(e.miniToOverlay,_n.value),Qd("space",Cf.value),Qd("offset",Ef.value),e.showIfAbove===!0&&e.modelValue!==!0&&Fn.value===!0&&e["onUpdate:modelValue"]!==void 0&&r("update:modelValue",!0),onMounted(()=>{r("onLayout",Cf.value),r("miniState",qr.value),ge=e.showIfAbove===!0;const Yh=()=>{(Fn.value===!0?Io:Co)(!1,!0)};if(P.totalWidth.value!==0){nextTick(Yh);return}ze=watch(P.totalWidth,()=>{ze(),ze=void 0,Fn.value===!1&&e.showIfAbove===!0&&Bt.value===!1?rl(!1):Yh()})}),onBeforeUnmount(()=>{ze!==void 0&&ze(),nt!==null&&(clearTimeout(nt),nt=null),Fn.value===!0&&Kh(),P.instances[e.side]===Zu&&(P.instances[e.side]=void 0,Qd("size",0),Qd("offset",0),Qd("space",!1))}),()=>{const Yh=[];Bt.value===!0&&(e.noSwipeOpen===!1&&Yh.push(withDirectives(h("div",{key:"open",class:`q-drawer__opener fixed-${e.side}`,"aria-hidden":"true"}),kd.value)),Yh.push(hDir("div",{ref:"backdrop",class:yd.value,style:Hd.value,"aria-hidden":"true",onClick:ah},void 0,"backdrop",e.noSwipeBackdrop!==!0&&Fn.value===!0,()=>gd.value)));const $d=qr.value===!0&&t.mini!==void 0,Jf=[h("div",{...n,key:""+$d,class:[Kd.value,n.class]},$d===!0?t.mini():hSlot(t.default))];return e.elevated===!0&&Fn.value===!0&&Jf.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Yh.push(hDir("aside",{ref:"content",class:wf.value,style:Ld.value},Jf,"contentclose",e.noSwipeClose!==!0&&Bt.value===!0,()=>cd.value)),h("div",{class:"q-drawer-container"},Yh)}}});let id=0;const useTabEmits=["click","keydown"],useTabProps={icon:String,label:[Number,String],alert:[Boolean,String],alertIcon:String,name:{type:[Number,String],default:()=>`t_${id++}`},noCaps:Boolean,tabindex:[String,Number],disable:Boolean,contentClass:String,ripple:{type:[Boolean,Object],default:!0}};function useTab(e,t,r,n){const a=inject(tabsKey,emptyRenderFn);if(a===emptyRenderFn)return console.error("QTab/QRouteTab component needs to be child of QTabs"),emptyRenderFn;const{proxy:s}=getCurrentInstance(),f=ref(null),o=ref(null),x=ref(null),C=computed(()=>e.disable===!0||e.ripple===!1?!1:Object.assign({keyCodes:[13,32],early:!0},e.ripple===!0?{}:e.ripple)),P=computed(()=>a.currentModel.value===e.name),ge=computed(()=>"q-tab relative-position self-stretch flex flex-center text-center"+(P.value===!0?" q-tab--active"+(a.tabProps.value.activeClass?" "+a.tabProps.value.activeClass:"")+(a.tabProps.value.activeColor?` text-${a.tabProps.value.activeColor}`:"")+(a.tabProps.value.activeBgColor?` bg-${a.tabProps.value.activeBgColor}`:""):" q-tab--inactive")+(e.icon&&e.label&&a.tabProps.value.inlineLabel===!1?" q-tab--full":"")+(e.noCaps===!0||a.tabProps.value.noCaps===!0?" q-tab--no-caps":"")+(e.disable===!0?" disabled":" q-focusable q-hoverable cursor-pointer")+(n!==void 0?n.linkClass.value:"")),nt=computed(()=>"q-tab__content self-stretch flex-center relative-position q-anchor--skip non-selectable "+(a.tabProps.value.inlineLabel===!0?"row no-wrap q-tab__content--inline":"column")+(e.contentClass!==void 0?` ${e.contentClass}`:"")),ze=computed(()=>e.disable===!0||a.hasFocus.value===!0||P.value===!1&&a.hasActiveTab.value===!0?-1:e.tabindex||0);function Bt(Io,Co){if(Co!==!0&&f.value!==null&&f.value.focus(),e.disable===!0){n!==void 0&&n.hasRouterLink.value===!0&&stopAndPrevent(Io);return}if(n===void 0){a.updateModel({name:e.name}),r("click",Io);return}if(n.hasRouterLink.value===!0){const rl=(ah={})=>{let ch;const ju=ah.to===void 0||isDeepEqual(ah.to,e.to)===!0?a.avoidRouteWatcher=uid$1():null;return n.navigateToRouterLink(Io,{...ah,returnRouterError:!0}).catch(Zu=>{ch=Zu}).then(Zu=>{if(ju===a.avoidRouteWatcher&&(a.avoidRouteWatcher=!1,ch===void 0&&(Zu===void 0||Zu.message.startsWith("Avoided redundant navigation")===!0)&&a.updateModel({name:e.name})),ah.returnRouterError===!0)return ch!==void 0?Promise.reject(ch):Zu})};r("click",Io,rl),Io.defaultPrevented!==!0&&rl();return}r("click",Io)}function qr(Io){isKeyCode(Io,[13,32])?Bt(Io,!0):shouldIgnoreKey(Io)!==!0&&Io.keyCode>=35&&Io.keyCode<=40&&Io.altKey!==!0&&Io.metaKey!==!0&&a.onKbdNavigate(Io.keyCode,s.$el)===!0&&stopAndPrevent(Io),r("keydown",Io)}function _n(){const Io=a.tabProps.value.narrowIndicator,Co=[],rl=h("div",{ref:x,class:["q-tab__indicator",a.tabProps.value.indicatorClass]});e.icon!==void 0&&Co.push(h(QIcon,{class:"q-tab__icon",name:e.icon})),e.label!==void 0&&Co.push(h("div",{class:"q-tab__label"},e.label)),e.alert!==!1&&Co.push(e.alertIcon!==void 0?h(QIcon,{class:"q-tab__alert-icon",color:e.alert!==!0?e.alert:void 0,name:e.alertIcon}):h("div",{class:"q-tab__alert"+(e.alert!==!0?` text-${e.alert}`:"")})),Io===!0&&Co.push(rl);const ah=[h("div",{class:"q-focus-helper",tabindex:-1,ref:f}),h("div",{class:nt.value},hMergeSlot(t.default,Co))];return Io===!1&&ah.push(rl),ah}const Fn={name:computed(()=>e.name),rootRef:o,tabIndicatorRef:x,routeData:n};onBeforeUnmount(()=>{a.unregisterTab(Fn)}),onMounted(()=>{a.registerTab(Fn)});function tl(Io,Co){const rl={ref:o,class:ge.value,tabindex:ze.value,role:"tab","aria-selected":P.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:Bt,onKeydown:qr,...Co};return withDirectives(h(Io,rl,_n()),[[Ripple,C.value]])}return{renderTab:tl,$tabs:a}}const QTab=createComponent({name:"QTab",props:useTabProps,emits:useTabEmits,setup(e,{slots:t,emit:r}){const{renderTab:n}=useTab(e,t,r);return()=>n("div")}});let rtlHasScrollBug=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const t=document.createElement("div");Object.assign(t.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(t),e.scrollLeft=-1e3,rtlHasScrollBug=e.scrollLeft>=0,e.remove()}function getIndicatorClass(e,t,r){const n=r===!0?["left","right"]:["top","bottom"];return`absolute-${t===!0?n[0]:n[1]}${e?` text-${e}`:""}`}const alignValues=["left","center","right","justify"],QTabs=createComponent({name:"QTabs",props:{modelValue:[Number,String],align:{type:String,default:"center",validator:e=>alignValues.includes(e)},breakpoint:{type:[String,Number],default:600},vertical:Boolean,shrink:Boolean,stretch:Boolean,activeClass:String,activeColor:String,activeBgColor:String,indicatorColor:String,leftIcon:String,rightIcon:String,outsideArrows:Boolean,mobileArrows:Boolean,switchIndicator:Boolean,narrowIndicator:Boolean,inlineLabel:Boolean,noCaps:Boolean,dense:Boolean,contentClass:String,"onUpdate:modelValue":[Function,Array]},setup(e,{slots:t,emit:r}){const{proxy:n}=getCurrentInstance(),{$q:a}=n,{registerTick:s}=useTick(),{registerTick:f}=useTick(),{registerTick:o}=useTick(),{registerTimeout:x,removeTimeout:C}=useTimeout(),{registerTimeout:P,removeTimeout:ge}=useTimeout(),nt=ref(null),ze=ref(null),Bt=ref(e.modelValue),qr=ref(!1),_n=ref(!0),Fn=ref(!1),tl=ref(!1),Io=[],Co=ref(0),rl=ref(!1);let ah=null,ch=null,ju;const Zu=computed(()=>({activeClass:e.activeClass,activeColor:e.activeColor,activeBgColor:e.activeBgColor,indicatorClass:getIndicatorClass(e.indicatorColor,e.switchIndicator,e.vertical),narrowIndicator:e.narrowIndicator,inlineLabel:e.inlineLabel,noCaps:e.noCaps})),sl=computed(()=>{const fd=Co.value,Jd=Bt.value;for(let Yh=0;Yh<fd;Yh++)if(Io[Yh].name.value===Jd)return!0;return!1}),oh=computed(()=>`q-tabs__content--align-${qr.value===!0?"left":tl.value===!0?"justify":e.align}`),hh=computed(()=>`q-tabs row no-wrap items-center q-tabs--${qr.value===!0?"":"not-"}scrollable q-tabs--${e.vertical===!0?"vertical":"horizontal"} q-tabs__arrows--${e.outsideArrows===!0?"outside":"inside"} q-tabs--mobile-with${e.mobileArrows===!0?"":"out"}-arrows`+(e.dense===!0?" q-tabs--dense":"")+(e.shrink===!0?" col-shrink":"")+(e.stretch===!0?" self-stretch":"")),Sh=computed(()=>"q-tabs__content scroll--mobile row no-wrap items-center self-stretch hide-scrollbar relative-position "+oh.value+(e.contentClass!==void 0?` ${e.contentClass}`:"")),$h=computed(()=>e.vertical===!0?{container:"height",content:"offsetHeight",scroll:"scrollHeight"}:{container:"width",content:"offsetWidth",scroll:"scrollWidth"}),hd=computed(()=>e.vertical!==!0&&a.lang.rtl===!0),vd=computed(()=>rtlHasScrollBug===!1&&hd.value===!0);watch(hd,Hd),watch(()=>e.modelValue,fd=>{Ef({name:fd,setCurrent:!0,skipEmit:!0})}),watch(()=>e.outsideArrows,Cd);function Ef({name:fd,setCurrent:Jd,skipEmit:Yh}){Bt.value!==fd&&(Yh!==!0&&e["onUpdate:modelValue"]!==void 0&&r("update:modelValue",fd),(Jd===!0||e["onUpdate:modelValue"]===void 0)&&(Sd(Bt.value,fd),Bt.value=fd))}function Cd(){s(()=>{Cf({width:nt.value.offsetWidth,height:nt.value.offsetHeight})})}function Cf(fd){if($h.value===void 0||ze.value===null)return;const Jd=fd[$h.value.container],Yh=Math.min(ze.value[$h.value.scroll],Array.prototype.reduce.call(ze.value.children,(Jf,Sf)=>Jf+(Sf[$h.value.content]||0),0)),$d=Jd>0&&Yh>Jd;qr.value=$d,$d===!0&&f(Hd),tl.value=Jd<parseInt(e.breakpoint,10)}function Sd(fd,Jd){const Yh=fd!=null&&fd!==""?Io.find(Jf=>Jf.name.value===fd):null,$d=Jd!=null&&Jd!==""?Io.find(Jf=>Jf.name.value===Jd):null;if(Yh&&$d){const Jf=Yh.tabIndicatorRef.value,Sf=$d.tabIndicatorRef.value;ah!==null&&(clearTimeout(ah),ah=null),Jf.style.transition="none",Jf.style.transform="none",Sf.style.transition="none",Sf.style.transform="none";const If=Jf.getBoundingClientRect(),Xf=Sf.getBoundingClientRect();Sf.style.transform=e.vertical===!0?`translate3d(0,${If.top-Xf.top}px,0) scale3d(1,${Xf.height?If.height/Xf.height:1},1)`:`translate3d(${If.left-Xf.left}px,0,0) scale3d(${Xf.width?If.width/Xf.width:1},1,1)`,o(()=>{ah=setTimeout(()=>{ah=null,Sf.style.transition="transform .25s cubic-bezier(.4, 0, .2, 1)",Sf.style.transform="none"},70)})}$d&&qr.value===!0&&yd($d.rootRef.value)}function yd(fd){const{left:Jd,width:Yh,top:$d,height:Jf}=ze.value.getBoundingClientRect(),Sf=fd.getBoundingClientRect();let If=e.vertical===!0?Sf.top-$d:Sf.left-Jd;if(If<0){ze.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.floor(If),Hd();return}If+=e.vertical===!0?Sf.height-Jf:Sf.width-Yh,If>0&&(ze.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.ceil(If),Hd())}function Hd(){const fd=ze.value;if(fd===null)return;const Jd=fd.getBoundingClientRect(),Yh=e.vertical===!0?fd.scrollTop:Math.abs(fd.scrollLeft);hd.value===!0?(_n.value=Math.ceil(Yh+Jd.width)<fd.scrollWidth-1,Fn.value=Yh>0):(_n.value=Yh>0,Fn.value=e.vertical===!0?Math.ceil(Yh+Jd.height)<fd.scrollHeight:Math.ceil(Yh+Jd.width)<fd.scrollWidth)}function xd(fd){ch!==null&&clearInterval(ch),ch=setInterval(()=>{kd(fd)===!0&&Ld()},5)}function Pd(){xd(vd.value===!0?Number.MAX_SAFE_INTEGER:0)}function zd(){xd(vd.value===!0?0:Number.MAX_SAFE_INTEGER)}function Ld(){ch!==null&&(clearInterval(ch),ch=null)}function Kd(fd,Jd){const Yh=Array.prototype.filter.call(ze.value.children,Xf=>Xf===Jd||Xf.matches&&Xf.matches(".q-tab.q-focusable")===!0),$d=Yh.length;if($d===0)return;if(fd===36)return yd(Yh[0]),Yh[0].focus(),!0;if(fd===35)return yd(Yh[$d-1]),Yh[$d-1].focus(),!0;const Jf=fd===(e.vertical===!0?38:37),Sf=fd===(e.vertical===!0?40:39),If=Jf===!0?-1:Sf===!0?1:void 0;if(If!==void 0){const Xf=hd.value===!0?-1:1,Of=Yh.indexOf(Jd)+If*Xf;return Of>=0&&Of<$d&&(yd(Yh[Of]),Yh[Of].focus({preventScroll:!0})),!0}}const wf=computed(()=>vd.value===!0?{get:fd=>Math.abs(fd.scrollLeft),set:(fd,Jd)=>{fd.scrollLeft=-Jd}}:e.vertical===!0?{get:fd=>fd.scrollTop,set:(fd,Jd)=>{fd.scrollTop=Jd}}:{get:fd=>fd.scrollLeft,set:(fd,Jd)=>{fd.scrollLeft=Jd}});function kd(fd){const Jd=ze.value,{get:Yh,set:$d}=wf.value;let Jf=!1,Sf=Yh(Jd);const If=fd<Sf?-1:1;return Sf+=If*5,Sf<0?(Jf=!0,Sf=0):(If===-1&&Sf<=fd||If===1&&Sf>=fd)&&(Jf=!0,Sf=fd),$d(Jd,Sf),Hd(),Jf}function cd(fd,Jd){for(const Yh in fd)if(fd[Yh]!==Jd[Yh])return!1;return!0}function gd(){let fd=null,Jd={matchedLen:0,queryDiff:9999,hrefLen:0};const Yh=Io.filter(If=>If.routeData!==void 0&&If.routeData.hasRouterLink.value===!0),{hash:$d,query:Jf}=n.$route,Sf=Object.keys(Jf).length;for(const If of Yh){const Xf=If.routeData.exact.value===!0;if(If.routeData[Xf===!0?"linkIsExactActive":"linkIsActive"].value!==!0)continue;const{hash:Of,query:jf,matched:Ap,href:vp}=If.routeData.resolvedLink.value,Tp=Object.keys(jf).length;if(Xf===!0){if(Of!==$d||Tp!==Sf||cd(Jf,jf)===!1)continue;fd=If.name.value;break}if(Of!==""&&Of!==$d||Tp!==0&&cd(jf,Jf)===!1)continue;const Zf={matchedLen:Ap.length,queryDiff:Sf-Tp,hrefLen:vp.length-Of.length};if(Zf.matchedLen>Jd.matchedLen){fd=If.name.value,Jd=Zf;continue}else if(Zf.matchedLen!==Jd.matchedLen)continue;if(Zf.queryDiff<Jd.queryDiff)fd=If.name.value,Jd=Zf;else if(Zf.queryDiff!==Jd.queryDiff)continue;Zf.hrefLen>Jd.hrefLen&&(fd=If.name.value,Jd=Zf)}fd===null&&Io.some(If=>If.routeData===void 0&&If.name.value===Bt.value)===!0||Ef({name:fd,setCurrent:!0})}function bp(fd){if(C(),rl.value!==!0&&nt.value!==null&&fd.target&&typeof fd.target.closest=="function"){const Jd=fd.target.closest(".q-tab");Jd&&nt.value.contains(Jd)===!0&&(rl.value=!0,qr.value===!0&&yd(Jd))}}function Uf(){x(()=>{rl.value=!1},30)}function qd(){lp.avoidRouteWatcher===!1?P(gd):ge()}function Vd(){if(ju===void 0){const fd=watch(()=>n.$route.fullPath,qd);ju=()=>{fd(),ju=void 0}}}function ep(fd){Io.push(fd),Co.value++,Cd(),fd.routeData===void 0||n.$route===void 0?P(()=>{if(qr.value===!0){const Jd=Bt.value,Yh=Jd!=null&&Jd!==""?Io.find($d=>$d.name.value===Jd):null;Yh&&yd(Yh.rootRef.value)}}):(Vd(),fd.routeData.hasRouterLink.value===!0&&qd())}function _p(fd){Io.splice(Io.indexOf(fd),1),Co.value--,Cd(),ju!==void 0&&fd.routeData!==void 0&&(Io.every(Jd=>Jd.routeData===void 0)===!0&&ju(),qd())}const lp={currentModel:Bt,tabProps:Zu,hasFocus:rl,hasActiveTab:sl,registerTab:ep,unregisterTab:_p,verifyRouteModel:qd,updateModel:Ef,onKbdNavigate:Kd,avoidRouteWatcher:!1};provide(tabsKey,lp);function Kh(){ah!==null&&clearTimeout(ah),Ld(),ju!==void 0&&ju()}let Qd;return onBeforeUnmount(Kh),onDeactivated(()=>{Qd=ju!==void 0,Kh()}),onActivated(()=>{Qd===!0&&Vd(),Cd()}),()=>h("div",{ref:nt,class:hh.value,role:"tablist",onFocusin:bp,onFocusout:Uf},[h(QResizeObserver,{onResize:Cf}),h("div",{ref:ze,class:Sh.value,onScroll:Hd},hSlot(t.default)),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--left absolute q-tab__icon"+(_n.value===!0?"":" q-tabs__arrow--faded"),name:e.leftIcon||a.iconSet.tabs[e.vertical===!0?"up":"left"],onMousedownPassive:Pd,onTouchstartPassive:Pd,onMouseupPassive:Ld,onMouseleavePassive:Ld,onTouchendPassive:Ld}),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--right absolute q-tab__icon"+(Fn.value===!0?"":" q-tabs__arrow--faded"),name:e.rightIcon||a.iconSet.tabs[e.vertical===!0?"down":"right"],onMousedownPassive:zd,onTouchstartPassive:zd,onMouseupPassive:Ld,onMouseleavePassive:Ld,onTouchendPassive:Ld})])}});function parseArg(e){const t=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((r,n)=>{const a=parseFloat(r);a&&(t[n]=a)}),t}const TouchSwipe=createDirective({name:"touch-swipe",beforeMount(e,{value:t,arg:r,modifiers:n}){if(n.mouse!==!0&&client$1.has.touch!==!0)return;const a=n.mouseCapture===!0?"Capture":"",s={handler:t,sensitivity:parseArg(r),direction:getModifierDirections(n),noop,mouseStart(f){shouldStart(f,s)&&leftClick(f)&&(addEvt(s,"temp",[[document,"mousemove","move",`notPassive${a}`],[document,"mouseup","end","notPassiveCapture"]]),s.start(f,!0))},touchStart(f){if(shouldStart(f,s)){const o=f.target;addEvt(s,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","notPassiveCapture"],[o,"touchend","end","notPassiveCapture"]]),s.start(f)}},start(f,o){client$1.is.firefox===!0&&preventDraggable(e,!0);const x=position(f);s.event={x:x.left,y:x.top,time:Date.now(),mouse:o===!0,dir:!1}},move(f){if(s.event===void 0)return;if(s.event.dir!==!1){stopAndPrevent(f);return}const o=Date.now()-s.event.time;if(o===0)return;const x=position(f),C=x.left-s.event.x,P=Math.abs(C),ge=x.top-s.event.y,nt=Math.abs(ge);if(s.event.mouse!==!0){if(P<s.sensitivity[1]&&nt<s.sensitivity[1]){s.end(f);return}}else if(window.getSelection().toString()!==""){s.end(f);return}else if(P<s.sensitivity[2]&&nt<s.sensitivity[2])return;const ze=P/o,Bt=nt/o;s.direction.vertical===!0&&P<nt&&P<100&&Bt>s.sensitivity[0]&&(s.event.dir=ge<0?"up":"down"),s.direction.horizontal===!0&&P>nt&&nt<100&&ze>s.sensitivity[0]&&(s.event.dir=C<0?"left":"right"),s.direction.up===!0&&P<nt&&ge<0&&P<100&&Bt>s.sensitivity[0]&&(s.event.dir="up"),s.direction.down===!0&&P<nt&&ge>0&&P<100&&Bt>s.sensitivity[0]&&(s.event.dir="down"),s.direction.left===!0&&P>nt&&C<0&&nt<100&&ze>s.sensitivity[0]&&(s.event.dir="left"),s.direction.right===!0&&P>nt&&C>0&&nt<100&&ze>s.sensitivity[0]&&(s.event.dir="right"),s.event.dir!==!1?(stopAndPrevent(f),s.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),s.styleCleanup=qr=>{s.styleCleanup=void 0,document.body.classList.remove("non-selectable");const _n=()=>{document.body.classList.remove("no-pointer-events--children")};qr===!0?setTimeout(_n,50):_n()}),s.handler({evt:f,touch:s.event.mouse!==!0,mouse:s.event.mouse,direction:s.event.dir,duration:o,distance:{x:P,y:nt}})):s.end(f)},end(f){s.event!==void 0&&(cleanEvt(s,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),s.styleCleanup!==void 0&&s.styleCleanup(!0),f!==void 0&&s.event.dir!==!1&&stopAndPrevent(f),s.event=void 0)}};if(e.__qtouchswipe=s,n.mouse===!0){const f=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";addEvt(s,"main",[[e,"mousedown","mouseStart",`passive${f}`]])}client$1.has.touch===!0&&addEvt(s,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const r=e.__qtouchswipe;r!==void 0&&(t.oldValue!==t.value&&(typeof t.value!="function"&&r.end(),r.handler=t.value),r.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchswipe;t!==void 0&&(cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchswipe)}});function useCache(){const e=new Map;return{getCache:function(t,r){return e[t]===void 0?e[t]=r:e[t]},getCacheWithFn:function(t,r){return e[t]===void 0?e[t]=r():e[t]}}}const usePanelChildProps={name:{required:!0},disable:Boolean},PanelWrapper={setup(e,{slots:t}){return()=>h("div",{class:"q-panel scroll",role:"tabpanel"},hSlot(t.default))}},usePanelProps={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},usePanelEmits=["update:modelValue","beforeTransition","transition"];function usePanel(){const{props:e,emit:t,proxy:r}=getCurrentInstance(),{getCacheWithFn:n}=useCache();let a,s;const f=ref(null),o=ref(null);function x(Sh){const $h=e.vertical===!0?"up":"left";ch((r.$q.lang.rtl===!0?-1:1)*(Sh.direction===$h?1:-1))}const C=computed(()=>[[TouchSwipe,x,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),P=computed(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),ge=computed(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),nt=computed(()=>`--q-transition-duration: ${e.transitionDuration}ms`),ze=computed(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),Bt=computed(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),qr=computed(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);watch(()=>e.modelValue,(Sh,$h)=>{const hd=Io(Sh)===!0?Co(Sh):-1;s!==!0&&ah(hd===-1?0:hd<Co($h)?-1:1),f.value!==hd&&(f.value=hd,t("beforeTransition",Sh,$h),nextTick(()=>{t("transition",Sh,$h)}))});function _n(){ch(1)}function Fn(){ch(-1)}function tl(Sh){t("update:modelValue",Sh)}function Io(Sh){return Sh!=null&&Sh!==""}function Co(Sh){return a.findIndex($h=>$h.props.name===Sh&&$h.props.disable!==""&&$h.props.disable!==!0)}function rl(){return a.filter(Sh=>Sh.props.disable!==""&&Sh.props.disable!==!0)}function ah(Sh){const $h=Sh!==0&&e.animated===!0&&f.value!==-1?"q-transition--"+(Sh===-1?P.value:ge.value):null;o.value!==$h&&(o.value=$h)}function ch(Sh,$h=f.value){let hd=$h+Sh;for(;hd>-1&&hd<a.length;){const vd=a[hd];if(vd!==void 0&&vd.props.disable!==""&&vd.props.disable!==!0){ah(Sh),s=!0,t("update:modelValue",vd.props.name),setTimeout(()=>{s=!1});return}hd+=Sh}e.infinite===!0&&a.length!==0&&$h!==-1&&$h!==a.length&&ch(Sh,Sh===-1?a.length:-1)}function ju(){const Sh=Co(e.modelValue);return f.value!==Sh&&(f.value=Sh),!0}function Zu(){const Sh=Io(e.modelValue)===!0&&ju()&&a[f.value];return e.keepAlive===!0?[h(KeepAlive,Bt.value,[h(qr.value===!0?n(ze.value,()=>({...PanelWrapper,name:ze.value})):PanelWrapper,{key:ze.value,style:nt.value},()=>Sh)])]:[h("div",{class:"q-panel scroll",style:nt.value,key:ze.value,role:"tabpanel"},[Sh])]}function sl(){if(a.length!==0)return e.animated===!0?[h(Transition,{name:o.value},Zu)]:Zu()}function oh(Sh){return a=getNormalizedVNodes(hSlot(Sh.default,[])).filter($h=>$h.props!==null&&$h.props.slot===void 0&&Io($h.props.name)===!0),a.length}function hh(){return a}return Object.assign(r,{next:_n,previous:Fn,goTo:tl}),{panelIndex:f,panelDirectives:C,updatePanelsList:oh,updatePanelIndex:ju,getPanelContent:sl,getEnabledPanels:rl,getPanels:hh,isValidPanelName:Io,keepAliveProps:Bt,needsUniqueKeepAliveWrapper:qr,goToPanelByOffset:ch,goToPanel:tl,nextPanel:_n,previousPanel:Fn}}const QTabPanel=createComponent({name:"QTabPanel",props:usePanelChildProps,setup(e,{slots:t}){return()=>h("div",{class:"q-tab-panel",role:"tabpanel"},hSlot(t.default))}}),QField=createComponent({name:"QField",inheritAttrs:!1,props:useFieldProps,emits:useFieldEmits,setup(){return useField(useFieldState())}}),defaultSizes$1={xs:8,sm:10,md:14,lg:20,xl:24},QChip=createComponent({name:"QChip",props:{...useDarkProps,...useSizeProps,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=useDark(e,n),s=useSize(e,defaultSizes$1),f=computed(()=>e.selected===!0||e.icon!==void 0),o=computed(()=>e.selected===!0?e.iconSelected||n.iconSet.chip.selected:e.icon),x=computed(()=>e.iconRemove||n.iconSet.chip.remove),C=computed(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),P=computed(()=>{const _n=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(_n?` text-${_n} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(C.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(a.value===!0?" q-chip--dark q-dark":"")}),ge=computed(()=>{const _n=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},Fn={..._n,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||n.lang.label.remove};return{chip:_n,remove:Fn}});function nt(_n){_n.keyCode===13&&ze(_n)}function ze(_n){e.disable||(r("update:selected",!e.selected),r("click",_n))}function Bt(_n){(_n.keyCode===void 0||_n.keyCode===13)&&(stopAndPrevent(_n),e.disable===!1&&(r("update:modelValue",!1),r("remove")))}function qr(){const _n=[];C.value===!0&&_n.push(h("div",{class:"q-focus-helper"})),f.value===!0&&_n.push(h(QIcon,{class:"q-chip__icon q-chip__icon--left",name:o.value}));const Fn=e.label!==void 0?[h("div",{class:"ellipsis"},[e.label])]:void 0;return _n.push(h("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},hMergeSlotSafely(t.default,Fn))),e.iconRight&&_n.push(h(QIcon,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&_n.push(h(QIcon,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:x.value,...ge.value.remove,onClick:Bt,onKeyup:Bt})),_n}return()=>{if(e.modelValue===!1)return;const _n={class:P.value,style:s.value};return C.value===!0&&Object.assign(_n,ge.value.chip,{onClick:ze,onKeyup:nt}),hDir("div",_n,qr(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Ripple,e.ripple]])}}}),QItem=createComponent({name:"QItem",props:{...useDarkProps,...useRouterLinkProps,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=useDark(e,n),{hasLink:s,linkAttrs:f,linkClass:o,linkTag:x,navigateOnClick:C}=useRouterLink(),P=ref(null),ge=ref(null),nt=computed(()=>e.clickable===!0||s.value===!0||e.tag==="label"),ze=computed(()=>e.disable!==!0&&nt.value===!0),Bt=computed(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(a.value===!0?" q-item--dark":"")+(s.value===!0&&e.active===null?o.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(ze.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),qr=computed(()=>e.insetLevel===void 0?null:{["padding"+(n.lang.rtl===!0?"Right":"Left")]:16+e.insetLevel*56+"px"});function _n(Io){ze.value===!0&&(ge.value!==null&&(Io.qKeyEvent!==!0&&document.activeElement===P.value?ge.value.focus():document.activeElement===ge.value&&P.value.focus()),C(Io))}function Fn(Io){if(ze.value===!0&&isKeyCode(Io,13)===!0){stopAndPrevent(Io),Io.qKeyEvent=!0;const Co=new MouseEvent("click",Io);Co.qKeyEvent=!0,P.value.dispatchEvent(Co)}r("keyup",Io)}function tl(){const Io=hUniqueSlot(t.default,[]);return ze.value===!0&&Io.unshift(h("div",{class:"q-focus-helper",tabindex:-1,ref:ge})),Io}return()=>{const Io={ref:P,class:Bt.value,style:qr.value,role:"listitem",onClick:_n,onKeyup:Fn};return ze.value===!0?(Io.tabindex=e.tabindex||"0",Object.assign(Io,f.value)):nt.value===!0&&(Io["aria-disabled"]="true"),h(x.value,Io,tl())}}}),QItemSection=createComponent({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:t}){const r=computed(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>h("div",{class:r.value},hSlot(t.default))}}),QItemLabel=createComponent({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(e,{slots:t}){const r=computed(()=>parseInt(e.lines,10)),n=computed(()=>"q-item__label"+(e.overline===!0?" q-item__label--overline text-overline":"")+(e.caption===!0?" q-item__label--caption text-caption":"")+(e.header===!0?" q-item__label--header":"")+(r.value===1?" ellipsis":"")),a=computed(()=>e.lines!==void 0&&r.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":r.value}:null);return()=>h("div",{style:a.value,class:n.value},hSlot(t.default))}}),useAnchorProps={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function useAnchor({showing:e,avoidEmit:t,configureAnchorEl:r}){const{props:n,proxy:a,emit:s}=getCurrentInstance(),f=ref(null);let o=null;function x(ze){return f.value===null?!1:ze===void 0||ze.touches===void 0||ze.touches.length<=1}const C={};r===void 0&&(Object.assign(C,{hide(ze){a.hide(ze)},toggle(ze){a.toggle(ze),ze.qAnchorHandled=!0},toggleKey(ze){isKeyCode(ze,13)===!0&&C.toggle(ze)},contextClick(ze){a.hide(ze),prevent(ze),nextTick(()=>{a.show(ze),ze.qAnchorHandled=!0})},prevent,mobileTouch(ze){if(C.mobileCleanup(ze),x(ze)!==!0)return;a.hide(ze),f.value.classList.add("non-selectable");const Bt=ze.target;addEvt(C,"anchor",[[Bt,"touchmove","mobileCleanup","passive"],[Bt,"touchend","mobileCleanup","passive"],[Bt,"touchcancel","mobileCleanup","passive"],[f.value,"contextmenu","prevent","notPassive"]]),o=setTimeout(()=>{o=null,a.show(ze),ze.qAnchorHandled=!0},300)},mobileCleanup(ze){f.value.classList.remove("non-selectable"),o!==null&&(clearTimeout(o),o=null),e.value===!0&&ze!==void 0&&clearSelection()}}),r=function(ze=n.contextMenu){if(n.noParentEvent===!0||f.value===null)return;let Bt;ze===!0?a.$q.platform.is.mobile===!0?Bt=[[f.value,"touchstart","mobileTouch","passive"]]:Bt=[[f.value,"mousedown","hide","passive"],[f.value,"contextmenu","contextClick","notPassive"]]:Bt=[[f.value,"click","toggle","passive"],[f.value,"keyup","toggleKey","passive"]],addEvt(C,"anchor",Bt)});function P(){cleanEvt(C,"anchor")}function ge(ze){for(f.value=ze;f.value.classList.contains("q-anchor--skip");)f.value=f.value.parentNode;r()}function nt(){if(n.target===!1||n.target===""||a.$el.parentNode===null)f.value=null;else if(n.target===!0)ge(a.$el.parentNode);else{let ze=n.target;if(typeof n.target=="string")try{ze=document.querySelector(n.target)}catch{ze=void 0}ze!=null?(f.value=ze.$el||ze,r()):(f.value=null,console.error(`Anchor: target "${n.target}" not found`))}}return watch(()=>n.contextMenu,ze=>{f.value!==null&&(P(),r(ze))}),watch(()=>n.target,()=>{f.value!==null&&P(),nt()}),watch(()=>n.noParentEvent,ze=>{f.value!==null&&(ze===!0?P():r())}),onMounted(()=>{nt(),t!==!0&&n.modelValue===!0&&f.value===null&&s("update:modelValue",!1)}),onBeforeUnmount(()=>{o!==null&&clearTimeout(o),P()}),{anchorEl:f,canShow:x,anchorEvents:C}}function useScrollTarget(e,t){const r=ref(null);let n;function a(o,x){const C=`${x!==void 0?"add":"remove"}EventListener`,P=x!==void 0?x:n;o!==window&&o[C]("scroll",P,listenOpts.passive),window[C]("scroll",P,listenOpts.passive),n=x}function s(){r.value!==null&&(a(r.value),r.value=null)}const f=watch(()=>e.noParentEvent,()=>{r.value!==null&&(s(),t())});return onBeforeUnmount(f),{localScrollTarget:r,unconfigureScrollTarget:s,changeScrollEvent:a}}const{notPassiveCapture}=listenOpts,registeredList=[];function globalHandler(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let r=portalProxyList.length-1;for(;r>=0;){const n=portalProxyList[r].$;if(n.type.name!=="QDialog")break;if(n.props.seamless!==!0)return;r--}for(let n=registeredList.length-1;n>=0;n--){const a=registeredList[n];if((a.anchorEl.value===null||a.anchorEl.value.contains(t)===!1)&&(t===document.body||a.innerRef.value!==null&&a.innerRef.value.contains(t)===!1))e.qClickOutside=!0,a.onClickOutside(e);else return}}function addClickOutside(e){registeredList.push(e),registeredList.length===1&&(document.addEventListener("mousedown",globalHandler,notPassiveCapture),document.addEventListener("touchstart",globalHandler,notPassiveCapture))}function removeClickOutside(e){const t=registeredList.findIndex(r=>r===e);t>-1&&(registeredList.splice(t,1),registeredList.length===0&&(document.removeEventListener("mousedown",globalHandler,notPassiveCapture),document.removeEventListener("touchstart",globalHandler,notPassiveCapture)))}let vpLeft,vpTop;function validatePosition(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function validateOffset(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const horizontalPos={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{horizontalPos[`${e}#ltr`]=e,horizontalPos[`${e}#rtl`]=e});function parsePosition(e,t){const r=e.split(" ");return{vertical:r[0],horizontal:horizontalPos[`${r[1]}#${t===!0?"rtl":"ltr"}`]}}function getAnchorProps(e,t){let{top:r,left:n,right:a,bottom:s,width:f,height:o}=e.getBoundingClientRect();return t!==void 0&&(r-=t[1],n-=t[0],s+=t[1],a+=t[0],f+=t[0],o+=t[1]),{top:r,bottom:s,height:o,left:n,right:a,width:f,middle:n+(a-n)/2,center:r+(s-r)/2}}function getAbsoluteAnchorProps(e,t,r){let{top:n,left:a}=e.getBoundingClientRect();return n+=t.top,a+=t.left,r!==void 0&&(n+=r[1],a+=r[0]),{top:n,bottom:n+1,height:1,left:a,right:a+1,width:1,middle:a,center:n}}function getTargetProps(e){return{top:0,center:e.offsetHeight/2,bottom:e.offsetHeight,left:0,middle:e.offsetWidth/2,right:e.offsetWidth}}function getTopLeftProps(e,t,r){return{top:e[r.anchorOrigin.vertical]-t[r.selfOrigin.vertical],left:e[r.anchorOrigin.horizontal]-t[r.selfOrigin.horizontal]}}function setPosition(e){if(client$1.is.ios===!0&&window.visualViewport!==void 0){const o=document.body.style,{offsetLeft:x,offsetTop:C}=window.visualViewport;x!==vpLeft&&(o.setProperty("--q-pe-left",x+"px"),vpLeft=x),C!==vpTop&&(o.setProperty("--q-pe-top",C+"px"),vpTop=C)}const{scrollLeft:t,scrollTop:r}=e.el,n=e.absoluteOffset===void 0?getAnchorProps(e.anchorEl,e.cover===!0?[0,0]:e.offset):getAbsoluteAnchorProps(e.anchorEl,e.absoluteOffset,e.offset);let a={maxHeight:e.maxHeight,maxWidth:e.maxWidth,visibility:"visible"};(e.fit===!0||e.cover===!0)&&(a.minWidth=n.width+"px",e.cover===!0&&(a.minHeight=n.height+"px")),Object.assign(e.el.style,a);const s=getTargetProps(e.el);let f=getTopLeftProps(n,s,e);if(e.absoluteOffset===void 0||e.offset===void 0)applyBoundaries(f,n,s,e.anchorOrigin,e.selfOrigin);else{const{top:o,left:x}=f;applyBoundaries(f,n,s,e.anchorOrigin,e.selfOrigin);let C=!1;if(f.top!==o){C=!0;const P=2*e.offset[1];n.center=n.top-=P,n.bottom-=P+2}if(f.left!==x){C=!0;const P=2*e.offset[0];n.middle=n.left-=P,n.right-=P+2}C===!0&&(f=getTopLeftProps(n,s,e),applyBoundaries(f,n,s,e.anchorOrigin,e.selfOrigin))}a={top:f.top+"px",left:f.left+"px"},f.maxHeight!==void 0&&(a.maxHeight=f.maxHeight+"px",n.height>f.maxHeight&&(a.minHeight=a.maxHeight)),f.maxWidth!==void 0&&(a.maxWidth=f.maxWidth+"px",n.width>f.maxWidth&&(a.minWidth=a.maxWidth)),Object.assign(e.el.style,a),e.el.scrollTop!==r&&(e.el.scrollTop=r),e.el.scrollLeft!==t&&(e.el.scrollLeft=t)}function applyBoundaries(e,t,r,n,a){const s=r.bottom,f=r.right,o=getScrollbarWidth(),x=window.innerHeight-o,C=document.body.clientWidth;if(e.top<0||e.top+s>x)if(a.vertical==="center")e.top=t[n.vertical]>x/2?Math.max(0,x-s):0,e.maxHeight=Math.min(s,x);else if(t[n.vertical]>x/2){const P=Math.min(x,n.vertical==="center"?t.center:n.vertical===a.vertical?t.bottom:t.top);e.maxHeight=Math.min(s,P),e.top=Math.max(0,P-s)}else e.top=Math.max(0,n.vertical==="center"?t.center:n.vertical===a.vertical?t.top:t.bottom),e.maxHeight=Math.min(s,x-e.top);if(e.left<0||e.left+f>C)if(e.maxWidth=Math.min(f,C),a.horizontal==="middle")e.left=t[n.horizontal]>C/2?Math.max(0,C-f):0;else if(t[n.horizontal]>C/2){const P=Math.min(C,n.horizontal==="middle"?t.middle:n.horizontal===a.horizontal?t.right:t.left);e.maxWidth=Math.min(f,P),e.left=Math.max(0,P-e.maxWidth)}else e.left=Math.max(0,n.horizontal==="middle"?t.middle:n.horizontal===a.horizontal?t.left:t.right),e.maxWidth=Math.min(f,C-e.left)}const QMenu=createComponent({name:"QMenu",inheritAttrs:!1,props:{...useAnchorProps,...useModelToggleProps,...useDarkProps,...useTransitionProps,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:validatePosition},self:{type:String,validator:validatePosition},offset:{type:Array,validator:validateOffset},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...useModelToggleEmits,"click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){let a=null,s,f,o;const x=getCurrentInstance(),{proxy:C}=x,{$q:P}=C,ge=ref(null),nt=ref(!1),ze=computed(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),Bt=useDark(e,P),{registerTick:qr,removeTick:_n}=useTick(),{registerTimeout:Fn}=useTimeout(),{transitionProps:tl,transitionStyle:Io}=useTransition(e),{localScrollTarget:Co,changeScrollEvent:rl,unconfigureScrollTarget:ah}=useScrollTarget(e,xd),{anchorEl:ch,canShow:ju}=useAnchor({showing:nt}),{hide:Zu}=useModelToggle({showing:nt,canShow:ju,handleShow:Sd,handleHide:yd,hideOnRouteChange:ze,processOnMount:!0}),{showPortal:sl,hidePortal:oh,renderPortal:hh}=usePortal(x,ge,wf,"menu"),Sh={anchorEl:ch,innerRef:ge,onClickOutside(kd){if(e.persistent!==!0&&nt.value===!0)return Zu(kd),(kd.type==="touchstart"||kd.target.classList.contains("q-dialog__backdrop"))&&stopAndPrevent(kd),!0}},$h=computed(()=>parsePosition(e.anchor||(e.cover===!0?"center middle":"bottom start"),P.lang.rtl)),hd=computed(()=>e.cover===!0?$h.value:parsePosition(e.self||"top start",P.lang.rtl)),vd=computed(()=>(e.square===!0?" q-menu--square":"")+(Bt.value===!0?" q-menu--dark q-dark":"")),Ef=computed(()=>e.autoClose===!0?{onClick:Pd}:{}),Cd=computed(()=>nt.value===!0&&e.persistent!==!0);watch(Cd,kd=>{kd===!0?(addEscapeKey(Ld),addClickOutside(Sh)):(removeEscapeKey(Ld),removeClickOutside(Sh))});function Cf(){addFocusFn(()=>{let kd=ge.value;kd&&kd.contains(document.activeElement)!==!0&&(kd=kd.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||kd.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||kd.querySelector("[autofocus], [data-autofocus]")||kd,kd.focus({preventScroll:!0}))})}function Sd(kd){if(a=e.noRefocus===!1?document.activeElement:null,addFocusout(zd),sl(),xd(),s=void 0,kd!==void 0&&(e.touchPosition||e.contextMenu)){const cd=position(kd);if(cd.left!==void 0){const{top:gd,left:bp}=ch.value.getBoundingClientRect();s={left:cd.left-bp,top:cd.top-gd}}}f===void 0&&(f=watch(()=>P.screen.width+"|"+P.screen.height+"|"+e.self+"|"+e.anchor+"|"+P.lang.rtl,Kd)),e.noFocus!==!0&&document.activeElement.blur(),qr(()=>{Kd(),e.noFocus!==!0&&Cf()}),Fn(()=>{P.platform.is.ios===!0&&(o=e.autoClose,ge.value.click()),Kd(),sl(!0),r("show",kd)},e.transitionDuration)}function yd(kd){_n(),oh(),Hd(!0),a!==null&&(kd===void 0||kd.qClickOutside!==!0)&&(((kd&&kd.type.indexOf("key")===0?a.closest('[tabindex]:not([tabindex^="-"])'):void 0)||a).focus(),a=null),Fn(()=>{oh(!0),r("hide",kd)},e.transitionDuration)}function Hd(kd){s=void 0,f!==void 0&&(f(),f=void 0),(kd===!0||nt.value===!0)&&(removeFocusout(zd),ah(),removeClickOutside(Sh),removeEscapeKey(Ld)),kd!==!0&&(a=null)}function xd(){(ch.value!==null||e.scrollTarget!==void 0)&&(Co.value=getScrollTarget(ch.value,e.scrollTarget),rl(Co.value,Kd))}function Pd(kd){o!==!0?(closePortalMenus(C,kd),r("click",kd)):o=!1}function zd(kd){Cd.value===!0&&e.noFocus!==!0&&childHasFocus(ge.value,kd.target)!==!0&&Cf()}function Ld(kd){r("escapeKey"),Zu(kd)}function Kd(){const kd=ge.value;kd===null||ch.value===null||setPosition({el:kd,offset:e.offset,anchorEl:ch.value,anchorOrigin:$h.value,selfOrigin:hd.value,absoluteOffset:s,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function wf(){return h(Transition,tl.value,()=>nt.value===!0?h("div",{role:"menu",...n,ref:ge,tabindex:-1,class:["q-menu q-position-engine scroll"+vd.value,n.class],style:[n.style,Io.value],...Ef.value},hSlot(t.default)):null)}return onBeforeUnmount(Hd),Object.assign(C,{focus:Cf,updatePosition:Kd}),hh}}),aggBucketSize=1e3,scrollToEdges=["start","center","end","start-force","center-force","end-force"],filterProto=Array.prototype.filter,setOverflowAnchor=window.getComputedStyle(document.body).overflowAnchor===void 0?noop:function(e,t){e!==null&&(e._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;e._qOverflowAnimationFrame=void 0;const r=e.children||[];filterProto.call(r,a=>a.dataset&&a.dataset.qVsAnchor!==void 0).forEach(a=>{delete a.dataset.qVsAnchor});const n=r[t];n&&n.dataset&&(n.dataset.qVsAnchor="")}))};function sumFn(e,t){return e+t}function getScrollDetails(e,t,r,n,a,s,f,o){const x=e===window?document.scrollingElement||document.documentElement:e,C=a===!0?"offsetWidth":"offsetHeight",P={scrollStart:0,scrollViewSize:-f-o,scrollMaxSize:0,offsetStart:-f,offsetEnd:-o};if(a===!0?(e===window?(P.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,P.scrollViewSize+=document.documentElement.clientWidth):(P.scrollStart=x.scrollLeft,P.scrollViewSize+=x.clientWidth),P.scrollMaxSize=x.scrollWidth,s===!0&&(P.scrollStart=(rtlHasScrollBug===!0?P.scrollMaxSize-P.scrollViewSize:0)-P.scrollStart)):(e===window?(P.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,P.scrollViewSize+=document.documentElement.clientHeight):(P.scrollStart=x.scrollTop,P.scrollViewSize+=x.clientHeight),P.scrollMaxSize=x.scrollHeight),r!==null)for(let ge=r.previousElementSibling;ge!==null;ge=ge.previousElementSibling)ge.classList.contains("q-virtual-scroll--skip")===!1&&(P.offsetStart+=ge[C]);if(n!==null)for(let ge=n.nextElementSibling;ge!==null;ge=ge.nextElementSibling)ge.classList.contains("q-virtual-scroll--skip")===!1&&(P.offsetEnd+=ge[C]);if(t!==e){const ge=x.getBoundingClientRect(),nt=t.getBoundingClientRect();a===!0?(P.offsetStart+=nt.left-ge.left,P.offsetEnd-=nt.width):(P.offsetStart+=nt.top-ge.top,P.offsetEnd-=nt.height),e!==window&&(P.offsetStart+=P.scrollStart),P.offsetEnd+=P.scrollMaxSize-P.offsetStart}return P}function setScroll(e,t,r,n){t==="end"&&(t=(e===window?document.body:e)[r===!0?"scrollWidth":"scrollHeight"]),e===window?r===!0?(n===!0&&(t=(rtlHasScrollBug===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-t),window.scrollTo(t,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,t):r===!0?(n===!0&&(t=(rtlHasScrollBug===!0?e.scrollWidth-e.offsetWidth:0)-t),e.scrollLeft=t):e.scrollTop=t}function sumSize(e,t,r,n){if(r>=n)return 0;const a=t.length,s=Math.floor(r/aggBucketSize),f=Math.floor((n-1)/aggBucketSize)+1;let o=e.slice(s,f).reduce(sumFn,0);return r%aggBucketSize!==0&&(o-=t.slice(s*aggBucketSize,r).reduce(sumFn,0)),n%aggBucketSize!==0&&n!==a&&(o-=t.slice(n,f*aggBucketSize).reduce(sumFn,0)),o}const commonVirtScrollProps={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},commonVirtPropsList=Object.keys(commonVirtScrollProps),useVirtualScrollProps={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...commonVirtScrollProps};function useVirtualScroll({virtualScrollLength:e,getVirtualScrollTarget:t,getVirtualScrollEl:r,virtualScrollItemSizeComputed:n}){const a=getCurrentInstance(),{props:s,emit:f,proxy:o}=a,{$q:x}=o;let C,P,ge,nt=[],ze;const Bt=ref(0),qr=ref(0),_n=ref({}),Fn=ref(null),tl=ref(null),Io=ref(null),Co=ref({from:0,to:0}),rl=computed(()=>s.tableColspan!==void 0?s.tableColspan:100);n===void 0&&(n=computed(()=>s.virtualScrollItemSize));const ah=computed(()=>n.value+";"+s.virtualScrollHorizontal),ch=computed(()=>ah.value+";"+s.virtualScrollSliceRatioBefore+";"+s.virtualScrollSliceRatioAfter);watch(ch,()=>{vd()}),watch(ah,ju);function ju(){hd(P,!0)}function Zu(yd){hd(yd===void 0?P:yd)}function sl(yd,Hd){const xd=t();if(xd==null||xd.nodeType===8)return;const Pd=getScrollDetails(xd,r(),Fn.value,tl.value,s.virtualScrollHorizontal,x.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd);ge!==Pd.scrollViewSize&&vd(Pd.scrollViewSize),hh(xd,Pd,Math.min(e.value-1,Math.max(0,parseInt(yd,10)||0)),0,scrollToEdges.indexOf(Hd)>-1?Hd:P>-1&&yd>P?"end":"start")}function oh(){const yd=t();if(yd==null||yd.nodeType===8)return;const Hd=getScrollDetails(yd,r(),Fn.value,tl.value,s.virtualScrollHorizontal,x.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd),xd=e.value-1,Pd=Hd.scrollMaxSize-Hd.offsetStart-Hd.offsetEnd-qr.value;if(C===Hd.scrollStart)return;if(Hd.scrollMaxSize<=0){hh(yd,Hd,0,0);return}ge!==Hd.scrollViewSize&&vd(Hd.scrollViewSize),Sh(Co.value.from);const zd=Math.floor(Hd.scrollMaxSize-Math.max(Hd.scrollViewSize,Hd.offsetEnd)-Math.min(ze[xd],Hd.scrollViewSize/2));if(zd>0&&Math.ceil(Hd.scrollStart)>=zd){hh(yd,Hd,xd,Hd.scrollMaxSize-Hd.offsetEnd-nt.reduce(sumFn,0));return}let Ld=0,Kd=Hd.scrollStart-Hd.offsetStart,wf=Kd;if(Kd<=Pd&&Kd+Hd.scrollViewSize>=Bt.value)Kd-=Bt.value,Ld=Co.value.from,wf=Kd;else for(let kd=0;Kd>=nt[kd]&&Ld<xd;kd++)Kd-=nt[kd],Ld+=aggBucketSize;for(;Kd>0&&Ld<xd;)Kd-=ze[Ld],Kd>-Hd.scrollViewSize?(Ld++,wf=Kd):wf=ze[Ld]+Kd;hh(yd,Hd,Ld,wf)}function hh(yd,Hd,xd,Pd,zd){const Ld=typeof zd=="string"&&zd.indexOf("-force")>-1,Kd=Ld===!0?zd.replace("-force",""):zd,wf=Kd!==void 0?Kd:"start";let kd=Math.max(0,xd-_n.value[wf]),cd=kd+_n.value.total;cd>e.value&&(cd=e.value,kd=Math.max(0,cd-_n.value.total)),C=Hd.scrollStart;const gd=kd!==Co.value.from||cd!==Co.value.to;if(gd===!1&&Kd===void 0){Cd(xd);return}const{activeElement:bp}=document,Uf=Io.value;gd===!0&&Uf!==null&&Uf!==bp&&Uf.contains(bp)===!0&&(Uf.addEventListener("focusout",$h),setTimeout(()=>{Uf!==null&&Uf.removeEventListener("focusout",$h)})),setOverflowAnchor(Uf,xd-kd);const qd=Kd!==void 0?ze.slice(kd,xd).reduce(sumFn,0):0;if(gd===!0){const Vd=cd>=Co.value.from&&kd<=Co.value.to?Co.value.to:cd;Co.value={from:kd,to:Vd},Bt.value=sumSize(nt,ze,0,kd),qr.value=sumSize(nt,ze,cd,e.value),requestAnimationFrame(()=>{Co.value.to!==cd&&C===Hd.scrollStart&&(Co.value={from:Co.value.from,to:cd},qr.value=sumSize(nt,ze,cd,e.value))})}requestAnimationFrame(()=>{if(C!==Hd.scrollStart)return;gd===!0&&Sh(kd);const Vd=ze.slice(kd,xd).reduce(sumFn,0),ep=Vd+Hd.offsetStart+Bt.value,_p=ep+ze[xd];let lp=ep+Pd;if(Kd!==void 0){const Kh=Vd-qd,Qd=Hd.scrollStart+Kh;lp=Ld!==!0&&Qd<ep&&_p<Qd+Hd.scrollViewSize?Qd:Kd==="end"?_p-Hd.scrollViewSize:ep-(Kd==="start"?0:Math.round((Hd.scrollViewSize-ze[xd])/2))}C=lp,setScroll(yd,lp,s.virtualScrollHorizontal,x.lang.rtl),Cd(xd)})}function Sh(yd){const Hd=Io.value;if(Hd){const xd=filterProto.call(Hd.children,kd=>kd.classList&&kd.classList.contains("q-virtual-scroll--skip")===!1),Pd=xd.length,zd=s.virtualScrollHorizontal===!0?kd=>kd.getBoundingClientRect().width:kd=>kd.offsetHeight;let Ld=yd,Kd,wf;for(let kd=0;kd<Pd;){for(Kd=zd(xd[kd]),kd++;kd<Pd&&xd[kd].classList.contains("q-virtual-scroll--with-prev")===!0;)Kd+=zd(xd[kd]),kd++;wf=Kd-ze[Ld],wf!==0&&(ze[Ld]+=wf,nt[Math.floor(Ld/aggBucketSize)]+=wf),Ld++}}}function $h(){Io.value!==null&&Io.value!==void 0&&Io.value.focus()}function hd(yd,Hd){const xd=1*n.value;(Hd===!0||Array.isArray(ze)===!1)&&(ze=[]);const Pd=ze.length;ze.length=e.value;for(let Ld=e.value-1;Ld>=Pd;Ld--)ze[Ld]=xd;const zd=Math.floor((e.value-1)/aggBucketSize);nt=[];for(let Ld=0;Ld<=zd;Ld++){let Kd=0;const wf=Math.min((Ld+1)*aggBucketSize,e.value);for(let kd=Ld*aggBucketSize;kd<wf;kd++)Kd+=ze[kd];nt.push(Kd)}P=-1,C=void 0,Bt.value=sumSize(nt,ze,0,Co.value.from),qr.value=sumSize(nt,ze,Co.value.to,e.value),yd>=0?(Sh(Co.value.from),nextTick(()=>{sl(yd)})):Cf()}function vd(yd){if(yd===void 0&&typeof window<"u"){const Kd=t();Kd!=null&&Kd.nodeType!==8&&(yd=getScrollDetails(Kd,r(),Fn.value,tl.value,s.virtualScrollHorizontal,x.lang.rtl,s.virtualScrollStickySizeStart,s.virtualScrollStickySizeEnd).scrollViewSize)}ge=yd;const Hd=parseFloat(s.virtualScrollSliceRatioBefore)||0,xd=parseFloat(s.virtualScrollSliceRatioAfter)||0,Pd=1+Hd+xd,zd=yd===void 0||yd<=0?1:Math.ceil(yd/n.value),Ld=Math.max(1,zd,Math.ceil((s.virtualScrollSliceSize>0?s.virtualScrollSliceSize:10)/Pd));_n.value={total:Math.ceil(Ld*Pd),start:Math.ceil(Ld*Hd),center:Math.ceil(Ld*(.5+Hd)),end:Math.ceil(Ld*(1+Hd)),view:zd}}function Ef(yd,Hd){const xd=s.virtualScrollHorizontal===!0?"width":"height",Pd={["--q-virtual-scroll-item-"+xd]:n.value+"px"};return[yd==="tbody"?h(yd,{class:"q-virtual-scroll__padding",key:"before",ref:Fn},[h("tr",[h("td",{style:{[xd]:`${Bt.value}px`,...Pd},colspan:rl.value})])]):h(yd,{class:"q-virtual-scroll__padding",key:"before",ref:Fn,style:{[xd]:`${Bt.value}px`,...Pd}}),h(yd,{class:"q-virtual-scroll__content",key:"content",ref:Io,tabindex:-1},Hd.flat()),yd==="tbody"?h(yd,{class:"q-virtual-scroll__padding",key:"after",ref:tl},[h("tr",[h("td",{style:{[xd]:`${qr.value}px`,...Pd},colspan:rl.value})])]):h(yd,{class:"q-virtual-scroll__padding",key:"after",ref:tl,style:{[xd]:`${qr.value}px`,...Pd}})]}function Cd(yd){P!==yd&&(s.onVirtualScroll!==void 0&&f("virtualScroll",{index:yd,from:Co.value.from,to:Co.value.to-1,direction:yd<P?"decrease":"increase",ref:o}),P=yd)}vd();const Cf=debounce$2(oh,x.platform.is.ios===!0?120:35);onBeforeMount(()=>{vd()});let Sd=!1;return onDeactivated(()=>{Sd=!0}),onActivated(()=>{if(Sd!==!0)return;const yd=t();C!==void 0&&yd!==void 0&&yd!==null&&yd.nodeType!==8?setScroll(yd,C,s.virtualScrollHorizontal,x.lang.rtl):sl(P)}),onBeforeUnmount(()=>{Cf.cancel()}),Object.assign(o,{scrollTo:sl,reset:ju,refresh:Zu}),{virtualScrollSliceRange:Co,virtualScrollSliceSizeComputed:_n,setVirtualScrollSize:vd,onVirtualScrollEvt:Cf,localResetVirtualScroll:hd,padVirtualScroll:Ef,scrollTo:sl,reset:ju,refresh:Zu}}const validateNewValueMode=e=>["add","add-unique","toggle"].includes(e),reEscapeList=".*+?^${}()|[]\\",fieldPropsList=Object.keys(useFieldProps),QSelect=createComponent({name:"QSelect",inheritAttrs:!1,props:{...useVirtualScrollProps,...useFormProps,...useFieldProps,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:validateNewValueMode},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...useFieldEmits,"add","remove","inputValue","newValue","keyup","keypress","keydown","filterAbort"],setup(e,{slots:t,emit:r}){const{proxy:n}=getCurrentInstance(),{$q:a}=n,s=ref(!1),f=ref(!1),o=ref(-1),x=ref(""),C=ref(!1),P=ref(!1);let ge=null,nt,ze,Bt,qr=null,_n,Fn,tl,Io;const Co=ref(null),rl=ref(null),ah=ref(null),ch=ref(null),ju=ref(null),Zu=useFormInputNameAttr(e),sl=useKeyComposition(Th),oh=computed(()=>Array.isArray(e.options)?e.options.length:0),hh=computed(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:Sh,virtualScrollSliceSizeComputed:$h,localResetVirtualScroll:hd,padVirtualScroll:vd,onVirtualScrollEvt:Ef,scrollTo:Cd,setVirtualScrollSize:Cf}=useVirtualScroll({virtualScrollLength:oh,getVirtualScrollTarget:ih,getVirtualScrollEl:lh,virtualScrollItemSizeComputed:hh}),Sd=useFieldState(),yd=computed(()=>{const Gh=e.mapOptions===!0&&e.multiple!==!0,Nf=e.modelValue!==void 0&&(e.modelValue!==null||Gh===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const Hf=e.mapOptions===!0&&nt!==void 0?nt:[],mp=Nf.map(Bp=>vp(Bp,Hf));return e.modelValue===null&&Gh===!0?mp.filter(Bp=>Bp!==null):mp}return Nf}),Hd=computed(()=>{const Gh={};return fieldPropsList.forEach(Nf=>{const Hf=e[Nf];Hf!==void 0&&(Gh[Nf]=Hf)}),Gh}),xd=computed(()=>e.optionsDark===null?Sd.isDark.value:e.optionsDark),Pd=computed(()=>fieldValueIsFilled(yd.value)),zd=computed(()=>{let Gh="q-field__input q-placeholder col";return e.hideSelected===!0||yd.value.length===0?[Gh,e.inputClass]:(Gh+=" q-field__input--padding",e.inputClass===void 0?Gh:[Gh,e.inputClass])}),Ld=computed(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),Kd=computed(()=>oh.value===0),wf=computed(()=>yd.value.map(Gh=>fd.value(Gh)).join(", ")),kd=computed(()=>e.displayValue!==void 0?e.displayValue:wf.value),cd=computed(()=>e.optionsHtml===!0?()=>!0:Gh=>Gh!=null&&Gh.html===!0),gd=computed(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||yd.value.some(cd.value))),bp=computed(()=>Sd.focused.value===!0?e.tabindex:-1),Uf=computed(()=>{const Gh={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":s.value===!0?"true":"false","aria-controls":`${Sd.targetUid.value}_lb`};return o.value>=0&&(Gh["aria-activedescendant"]=`${Sd.targetUid.value}_${o.value}`),Gh}),qd=computed(()=>({id:`${Sd.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),Vd=computed(()=>yd.value.map((Gh,Nf)=>({index:Nf,opt:Gh,html:cd.value(Gh),selected:!0,removeAtIndex:If,toggleOption:Of,tabindex:bp.value}))),ep=computed(()=>{if(oh.value===0)return[];const{from:Gh,to:Nf}=Sh.value;return e.options.slice(Gh,Nf).map((Hf,mp)=>{const Bp=Jd.value(Hf)===!0,zp=Gh+mp,um={clickable:!0,active:!1,activeClass:Kh.value,manualFocus:!0,focused:!1,disable:Bp,tabindex:-1,dense:e.optionsDense,dark:xd.value,role:"option",id:`${Sd.targetUid.value}_${zp}`,onClick:()=>{Of(Hf)}};return Bp!==!0&&(Zf(Hf)===!0&&(um.active=!0),o.value===zp&&(um.focused=!0),um["aria-selected"]=um.active===!0?"true":"false",a.platform.is.desktop===!0&&(um.onMousemove=()=>{s.value===!0&&jf(zp)})),{index:zp,opt:Hf,html:cd.value(Hf),label:fd.value(Hf),selected:um.active,focused:um.focused,toggleOption:Of,setOptionIndex:jf,itemProps:um}})}),_p=computed(()=>e.dropdownIcon!==void 0?e.dropdownIcon:a.iconSet.arrow.dropdown),lp=computed(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Kh=computed(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),Qd=computed(()=>Tp(e.optionValue,"value")),fd=computed(()=>Tp(e.optionLabel,"label")),Jd=computed(()=>Tp(e.optionDisable,"disable")),Yh=computed(()=>yd.value.map(Gh=>Qd.value(Gh))),$d=computed(()=>{const Gh={onInput:Th,onChange:sl,onKeydown:Lh,onKeyup:Wd,onKeypress:$p,onFocus:qp,onClick(Nf){ze===!0&&stop(Nf)}};return Gh.onCompositionstart=Gh.onCompositionupdate=Gh.onCompositionend=sl,Gh});watch(yd,Gh=>{nt=Gh,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&Sd.innerLoading.value!==!0&&(f.value!==!0&&s.value!==!0||Pd.value!==!0)&&(Bt!==!0&&Fd(),(f.value===!0||s.value===!0)&&fh(""))},{immediate:!0}),watch(()=>e.fillInput,Fd),watch(s,Kf),watch(oh,up);function Jf(Gh){return e.emitValue===!0?Qd.value(Gh):Gh}function Sf(Gh){if(Gh>-1&&Gh<yd.value.length)if(e.multiple===!0){const Nf=e.modelValue.slice();r("remove",{index:Gh,value:Nf.splice(Gh,1)[0]}),r("update:modelValue",Nf)}else r("update:modelValue",null)}function If(Gh){Sf(Gh),Sd.focus()}function Xf(Gh,Nf){const Hf=Jf(Gh);if(e.multiple!==!0){e.fillInput===!0&&al(fd.value(Gh),!0,!0),r("update:modelValue",Hf);return}if(yd.value.length===0){r("add",{index:0,value:Hf}),r("update:modelValue",e.multiple===!0?[Hf]:Hf);return}if(Nf===!0&&Zf(Gh)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const mp=e.modelValue.slice();r("add",{index:mp.length,value:Hf}),mp.push(Hf),r("update:modelValue",mp)}function Of(Gh,Nf){if(Sd.editable.value!==!0||Gh===void 0||Jd.value(Gh)===!0)return;const Hf=Qd.value(Gh);if(e.multiple!==!0){Nf!==!0&&(al(e.fillInput===!0?fd.value(Gh):"",!0,!0),Zd()),rl.value!==null&&rl.value.focus(),(yd.value.length===0||isDeepEqual(Qd.value(yd.value[0]),Hf)!==!0)&&r("update:modelValue",e.emitValue===!0?Hf:Gh);return}if((ze!==!0||C.value===!0)&&Sd.focus(),qp(),yd.value.length===0){const zp=e.emitValue===!0?Hf:Gh;r("add",{index:0,value:zp}),r("update:modelValue",e.multiple===!0?[zp]:zp);return}const mp=e.modelValue.slice(),Bp=Yh.value.findIndex(zp=>isDeepEqual(zp,Hf));if(Bp>-1)r("remove",{index:Bp,value:mp.splice(Bp,1)[0]});else{if(e.maxValues!==void 0&&mp.length>=e.maxValues)return;const zp=e.emitValue===!0?Hf:Gh;r("add",{index:mp.length,value:zp}),mp.push(zp)}r("update:modelValue",mp)}function jf(Gh){if(a.platform.is.desktop!==!0)return;const Nf=Gh>-1&&Gh<oh.value?Gh:-1;o.value!==Nf&&(o.value=Nf)}function Ap(Gh=1,Nf){if(s.value===!0){let Hf=o.value;do Hf=normalizeToInterval(Hf+Gh,-1,oh.value-1);while(Hf!==-1&&Hf!==o.value&&Jd.value(e.options[Hf])===!0);o.value!==Hf&&(jf(Hf),Cd(Hf),Nf!==!0&&e.useInput===!0&&e.fillInput===!0&&Fh(Hf>=0?fd.value(e.options[Hf]):_n))}}function vp(Gh,Nf){const Hf=mp=>isDeepEqual(Qd.value(mp),Gh);return e.options.find(Hf)||Nf.find(Hf)||Gh}function Tp(Gh,Nf){const Hf=Gh!==void 0?Gh:Nf;return typeof Hf=="function"?Hf:mp=>mp!==null&&typeof mp=="object"&&Hf in mp?mp[Hf]:mp}function Zf(Gh){const Nf=Qd.value(Gh);return Yh.value.find(Hf=>isDeepEqual(Hf,Nf))!==void 0}function qp(Gh){e.useInput===!0&&rl.value!==null&&(Gh===void 0||rl.value===Gh.target&&Gh.target.value===wf.value)&&rl.value.select()}function sm(Gh){isKeyCode(Gh,27)===!0&&s.value===!0&&(stop(Gh),Zd(),Fd()),r("keyup",Gh)}function Wd(Gh){const{value:Nf}=Gh.target;if(Gh.keyCode!==void 0){sm(Gh);return}if(Gh.target.value="",ge!==null&&(clearTimeout(ge),ge=null),Fd(),typeof Nf=="string"&&Nf.length!==0){const Hf=Nf.toLocaleLowerCase(),mp=zp=>{const um=e.options.find(Nm=>zp.value(Nm).toLocaleLowerCase()===Hf);return um===void 0?!1:(yd.value.indexOf(um)===-1?Of(um):Zd(),!0)},Bp=zp=>{mp(Qd)!==!0&&(mp(fd)===!0||zp===!0||fh(Nf,!0,()=>Bp(!0)))};Bp()}else Sd.clearValue(Gh)}function $p(Gh){r("keypress",Gh)}function Lh(Gh){if(r("keydown",Gh),shouldIgnoreKey(Gh)===!0)return;const Nf=x.value.length!==0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),Hf=Gh.shiftKey!==!0&&e.multiple!==!0&&(o.value>-1||Nf===!0);if(Gh.keyCode===27){prevent(Gh);return}if(Gh.keyCode===9&&Hf===!1){td();return}if(Gh.target===void 0||Gh.target.id!==Sd.targetUid.value)return;if(Gh.keyCode===40&&Sd.innerLoading.value!==!0&&s.value===!1){stopAndPrevent(Gh),Ad();return}if(Gh.keyCode===8&&e.hideSelected!==!0&&x.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?Sf(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&r("update:modelValue",null);return}(Gh.keyCode===35||Gh.keyCode===36)&&(typeof x.value!="string"||x.value.length===0)&&(stopAndPrevent(Gh),o.value=-1,Ap(Gh.keyCode===36?1:-1,e.multiple)),(Gh.keyCode===33||Gh.keyCode===34)&&$h.value!==void 0&&(stopAndPrevent(Gh),o.value=Math.max(-1,Math.min(oh.value,o.value+(Gh.keyCode===33?-1:1)*$h.value.view)),Ap(Gh.keyCode===33?1:-1,e.multiple)),(Gh.keyCode===38||Gh.keyCode===40)&&(stopAndPrevent(Gh),Ap(Gh.keyCode===38?-1:1,e.multiple));const mp=oh.value;if((tl===void 0||Io<Date.now())&&(tl=""),mp>0&&e.useInput!==!0&&Gh.key!==void 0&&Gh.key.length===1&&Gh.altKey===!1&&Gh.ctrlKey===!1&&Gh.metaKey===!1&&(Gh.keyCode!==32||tl.length!==0)){s.value!==!0&&Ad(Gh);const Bp=Gh.key.toLocaleLowerCase(),zp=tl.length===1&&tl[0]===Bp;Io=Date.now()+1500,zp===!1&&(stopAndPrevent(Gh),tl+=Bp);const um=new RegExp("^"+tl.split("").map(a_=>reEscapeList.indexOf(a_)>-1?"\\"+a_:a_).join(".*"),"i");let Nm=o.value;if(zp===!0||Nm<0||um.test(fd.value(e.options[Nm]))!==!0)do Nm=normalizeToInterval(Nm+1,-1,mp-1);while(Nm!==o.value&&(Jd.value(e.options[Nm])===!0||um.test(fd.value(e.options[Nm]))!==!0));o.value!==Nm&&nextTick(()=>{jf(Nm),Cd(Nm),Nm>=0&&e.useInput===!0&&e.fillInput===!0&&Fh(fd.value(e.options[Nm]))});return}if(!(Gh.keyCode!==13&&(Gh.keyCode!==32||e.useInput===!0||tl!=="")&&(Gh.keyCode!==9||Hf===!1))){if(Gh.keyCode!==9&&stopAndPrevent(Gh),o.value>-1&&o.value<mp){Of(e.options[o.value]);return}if(Nf===!0){const Bp=(zp,um)=>{if(um){if(validateNewValueMode(um)!==!0)return}else um=e.newValueMode;if(zp==null)return;al("",e.multiple!==!0,!0),(um==="toggle"?Of:Xf)(zp,um==="add-unique"),e.multiple!==!0&&(rl.value!==null&&rl.value.focus(),Zd())};if(e.onNewValue!==void 0?r("newValue",x.value,Bp):Bp(x.value),e.multiple!==!0)return}s.value===!0?td():Sd.innerLoading.value!==!0&&Ad()}}function lh(){return ze===!0?ju.value:ah.value!==null&&ah.value.contentEl!==null?ah.value.contentEl:void 0}function ih(){return lh()}function Ah(){return e.hideSelected===!0?[]:t["selected-item"]!==void 0?Vd.value.map(Gh=>t["selected-item"](Gh)).slice():t.selected!==void 0?[].concat(t.selected()):e.useChips===!0?Vd.value.map((Gh,Nf)=>h(QChip,{key:"option-"+Nf,removable:Sd.editable.value===!0&&Jd.value(Gh.opt)!==!0,dense:!0,textColor:e.color,tabindex:bp.value,onRemove(){Gh.removeAtIndex(Nf)}},()=>h("span",{class:"ellipsis",[Gh.html===!0?"innerHTML":"textContent"]:fd.value(Gh.opt)}))):[h("span",{[gd.value===!0?"innerHTML":"textContent"]:kd.value})]}function zh(){if(Kd.value===!0)return t["no-option"]!==void 0?t["no-option"]({inputValue:x.value}):void 0;const Gh=t.option!==void 0?t.option:Hf=>h(QItem,{key:Hf.index,...Hf.itemProps},()=>h(QItemSection,()=>h(QItemLabel,()=>h("span",{[Hf.html===!0?"innerHTML":"textContent"]:Hf.label}))));let Nf=vd("div",ep.value.map(Gh));return t["before-options"]!==void 0&&(Nf=t["before-options"]().concat(Nf)),hMergeSlot(t["after-options"],Nf)}function Qh(Gh,Nf){const Hf=Nf===!0?{...Uf.value,...Sd.splitAttrs.attributes.value}:void 0,mp={ref:Nf===!0?rl:void 0,key:"i_t",class:zd.value,style:e.inputStyle,value:x.value!==void 0?x.value:"",type:"search",...Hf,id:Nf===!0?Sd.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":Gh===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...$d.value};return Gh!==!0&&ze===!0&&(Array.isArray(mp.class)===!0?mp.class=[...mp.class,"no-pointer-events"]:mp.class+=" no-pointer-events"),h("input",mp)}function Th(Gh){ge!==null&&(clearTimeout(ge),ge=null),!(Gh&&Gh.target&&Gh.target.qComposing===!0)&&(Fh(Gh.target.value||""),Bt=!0,_n=x.value,Sd.focused.value!==!0&&(ze!==!0||C.value===!0)&&Sd.focus(),e.onFilter!==void 0&&(ge=setTimeout(()=>{ge=null,fh(x.value)},e.inputDebounce)))}function Fh(Gh){x.value!==Gh&&(x.value=Gh,r("inputValue",Gh))}function al(Gh,Nf,Hf){Bt=Hf!==!0,e.useInput===!0&&(Fh(Gh),(Nf===!0||Hf!==!0)&&(_n=Gh),Nf!==!0&&fh(Gh))}function fh(Gh,Nf,Hf){if(e.onFilter===void 0||Nf!==!0&&Sd.focused.value!==!0)return;Sd.innerLoading.value===!0?r("filterAbort"):(Sd.innerLoading.value=!0,P.value=!0),Gh!==""&&e.multiple!==!0&&yd.value.length!==0&&Bt!==!0&&Gh===fd.value(yd.value[0])&&(Gh="");const mp=setTimeout(()=>{s.value===!0&&(s.value=!1)},10);qr!==null&&clearTimeout(qr),qr=mp,r("filter",Gh,(Bp,zp)=>{(Nf===!0||Sd.focused.value===!0)&&qr===mp&&(clearTimeout(qr),typeof Bp=="function"&&Bp(),P.value=!1,nextTick(()=>{Sd.innerLoading.value=!1,Sd.editable.value===!0&&(Nf===!0?s.value===!0&&Zd():s.value===!0?Kf(!0):s.value=!0),typeof zp=="function"&&nextTick(()=>{zp(n)}),typeof Hf=="function"&&nextTick(()=>{Hf(n)})}))},()=>{Sd.focused.value===!0&&qr===mp&&(clearTimeout(qr),Sd.innerLoading.value=!1,P.value=!1),s.value===!0&&(s.value=!1)})}function nl(){return h(QMenu,{ref:ah,class:Ld.value,style:e.popupContentStyle,modelValue:s.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&Kd.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:xd.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:lp.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...qd.value,onScrollPassive:Ef,onBeforeShow:wp,onBeforeHide:Zs,onShow:ol},zh)}function Zs(Gh){Hp(Gh),td()}function ol(){Cf()}function sh(Gh){stop(Gh),rl.value!==null&&rl.value.focus(),C.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function xh(Gh){stop(Gh),nextTick(()=>{C.value=!1})}function Mh(){const Gh=[h(QField,{class:`col-auto ${Sd.fieldClass.value}`,...Hd.value,for:Sd.targetUid.value,dark:xd.value,square:!0,loading:P.value,itemAligned:!1,filled:!0,stackLabel:x.value.length!==0,...Sd.splitAttrs.listeners.value,onFocus:sh,onBlur:xh},{...t,rawControl:()=>Sd.getControl(!0),before:void 0,after:void 0})];return s.value===!0&&Gh.push(h("div",{ref:ju,class:Ld.value+" scroll",style:e.popupContentStyle,...qd.value,onClick:prevent,onScrollPassive:Ef},zh())),h(QDialog,{ref:ch,modelValue:f.value,position:e.useInput===!0?"top":void 0,transitionShow:Fn,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:wp,onBeforeHide:Uh,onHide:Nh,onShow:Zh},()=>h("div",{class:"q-select__dialog"+(xd.value===!0?" q-select__dialog--dark q-dark":"")+(C.value===!0?" q-select__dialog--focused":"")},Gh))}function Uh(Gh){Hp(Gh),ch.value!==null&&ch.value.__updateRefocusTarget(Sd.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),Sd.focused.value=!1}function Nh(Gh){Zd(),Sd.focused.value===!1&&r("blur",Gh),Fd()}function Zh(){const Gh=document.activeElement;(Gh===null||Gh.id!==Sd.targetUid.value)&&rl.value!==null&&rl.value!==Gh&&rl.value.focus(),Cf()}function td(){f.value!==!0&&(o.value=-1,s.value===!0&&(s.value=!1),Sd.focused.value===!1&&(qr!==null&&(clearTimeout(qr),qr=null),Sd.innerLoading.value===!0&&(r("filterAbort"),Sd.innerLoading.value=!1,P.value=!1)))}function Ad(Gh){Sd.editable.value===!0&&(ze===!0?(Sd.onControlFocusin(Gh),f.value=!0,nextTick(()=>{Sd.focus()})):Sd.focus(),e.onFilter!==void 0?fh(x.value):(Kd.value!==!0||t["no-option"]!==void 0)&&(s.value=!0))}function Zd(){f.value=!1,td()}function Fd(){e.useInput===!0&&al(e.multiple!==!0&&e.fillInput===!0&&yd.value.length!==0&&fd.value(yd.value[0])||"",!0,!0)}function Kf(Gh){let Nf=-1;if(Gh===!0){if(yd.value.length!==0){const Hf=Qd.value(yd.value[0]);Nf=e.options.findIndex(mp=>isDeepEqual(Qd.value(mp),Hf))}hd(Nf)}jf(Nf)}function up(Gh,Nf){s.value===!0&&Sd.innerLoading.value===!1&&(hd(-1,!0),nextTick(()=>{s.value===!0&&Sd.innerLoading.value===!1&&(Gh>Nf?hd():Kf(!0))}))}function ap(){f.value===!1&&ah.value!==null&&ah.value.updatePosition()}function wp(Gh){Gh!==void 0&&stop(Gh),r("popupShow",Gh),Sd.hasPopupOpen=!0,Sd.onControlFocusin(Gh)}function Hp(Gh){Gh!==void 0&&stop(Gh),r("popupHide",Gh),Sd.hasPopupOpen=!1,Sd.onControlFocusout(Gh)}function Ip(){ze=a.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?t["no-option"]!==void 0||e.onFilter!==void 0||Kd.value===!1:!0),Fn=a.platform.is.ios===!0&&ze===!0&&e.useInput===!0?"fade":e.transitionShow}return onBeforeUpdate(Ip),onUpdated(ap),Ip(),onBeforeUnmount(()=>{ge!==null&&clearTimeout(ge)}),Object.assign(n,{showPopup:Ad,hidePopup:Zd,removeAtIndex:Sf,add:Xf,toggleOption:Of,getOptionIndex:()=>o.value,setOptionIndex:jf,moveOptionSelection:Ap,filter:fh,updateMenuPosition:ap,updateInputValue:al,isOptionSelected:Zf,getEmittingOptionValue:Jf,isOptionDisabled:(...Gh)=>Jd.value.apply(null,Gh)===!0,getOptionValue:(...Gh)=>Qd.value.apply(null,Gh),getOptionLabel:(...Gh)=>fd.value.apply(null,Gh)}),Object.assign(Sd,{innerValue:yd,fieldClass:computed(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:Co,targetRef:rl,hasValue:Pd,showPopup:Ad,floatingLabel:computed(()=>e.hideSelected!==!0&&Pd.value===!0||typeof x.value=="number"||x.value.length!==0||fieldValueIsFilled(e.displayValue)),getControlChild:()=>{if(Sd.editable.value!==!1&&(f.value===!0||Kd.value!==!0||t["no-option"]!==void 0))return ze===!0?Mh():nl();Sd.hasPopupOpen===!0&&(Sd.hasPopupOpen=!1)},controlEvents:{onFocusin(Gh){Sd.onControlFocusin(Gh)},onFocusout(Gh){Sd.onControlFocusout(Gh,()=>{Fd(),td()})},onClick(Gh){if(prevent(Gh),ze!==!0&&s.value===!0){td(),rl.value!==null&&rl.value.focus();return}Ad(Gh)}},getControl:Gh=>{const Nf=Ah(),Hf=Gh===!0||f.value!==!0||ze!==!0;if(e.useInput===!0)Nf.push(Qh(Gh,Hf));else if(Sd.editable.value===!0){const Bp=Hf===!0?Uf.value:void 0;Nf.push(h("input",{ref:Hf===!0?rl:void 0,key:"d_t",class:"q-select__focus-target",id:Hf===!0?Sd.targetUid.value:void 0,value:kd.value,readonly:!0,"data-autofocus":Gh===!0||e.autofocus===!0||void 0,...Bp,onKeydown:Lh,onKeyup:sm,onKeypress:$p})),Hf===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length!==0&&Nf.push(h("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:Wd}))}if(Zu.value!==void 0&&e.disable!==!0&&Yh.value.length!==0){const Bp=Yh.value.map(zp=>h("option",{value:zp,selected:!0}));Nf.push(h("select",{class:"hidden",name:Zu.value,multiple:e.multiple},Bp))}const mp=e.useInput===!0||Hf!==!0?void 0:Sd.splitAttrs.attributes.value;return h("div",{class:"q-field__native row items-center",...mp,...Sd.splitAttrs.listeners.value},Nf)},getInnerAppend:()=>e.loading!==!0&&P.value!==!0&&e.hideDropdownIcon!==!0?[h(QIcon,{class:"q-select__dropdown-icon"+(s.value===!0?" rotate-180":""),name:_p.value})]:null}),useField(Sd)}}),QTd=createComponent({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:t}){const r=getCurrentInstance(),n=computed(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return h("td",{class:n.value},hSlot(t.default));const a=r.vnode.key,s=(e.props.colsMap!==void 0?e.props.colsMap[a]:null)||e.props.col;if(s===void 0)return;const{row:f}=e.props;return h("td",{class:n.value+s.__tdClass(f),style:s.__tdStyle(f)},hSlot(t.default))}}});function cloneDeep(e,t=new WeakMap){if(Object(e)!==e)return e;if(t.has(e))return t.get(e);const r=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const n=e.valueOf();if(Object(n)!==n){const a=new e.constructor(n);return t.set(e,a),a}}return t.set(e,r),e instanceof Set?e.forEach(n=>{r.add(cloneDeep(n,t))}):e instanceof Map&&e.forEach((n,a)=>{r.set(a,cloneDeep(n,t))}),Object.assign(r,...Object.keys(e).map(n=>({[n]:cloneDeep(e[n],t)})))}const QPopupEdit=createComponent({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:r}){const{proxy:n}=getCurrentInstance(),{$q:a}=n,s=ref(null),f=ref(""),o=ref("");let x=!1;const C=computed(()=>injectProp({initialValue:f.value,validate:e.validate,set:P,cancel:ge,updatePosition:nt},"value",()=>o.value,Co=>{o.value=Co}));function P(){e.validate(o.value)!==!1&&(ze()===!0&&(r("save",o.value,f.value),r("update:modelValue",o.value)),Bt())}function ge(){ze()===!0&&r("cancel",o.value,f.value),Bt()}function nt(){nextTick(()=>{s.value.updatePosition()})}function ze(){return isDeepEqual(o.value,f.value)===!1}function Bt(){x=!0,s.value.hide()}function qr(){x=!1,f.value=cloneDeep(e.modelValue),o.value=cloneDeep(e.modelValue),r("beforeShow")}function _n(){r("show")}function Fn(){x===!1&&ze()===!0&&(e.autoSave===!0&&e.validate(o.value)===!0?(r("save",o.value,f.value),r("update:modelValue",o.value)):r("cancel",o.value,f.value)),r("beforeHide")}function tl(){r("hide")}function Io(){const Co=t.default!==void 0?[].concat(t.default(C.value)):[];return e.title&&Co.unshift(h("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&Co.push(h("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[h(QBtn,{flat:!0,color:e.color,label:e.labelCancel||a.lang.label.cancel,onClick:ge}),h(QBtn,{flat:!0,color:e.color,label:e.labelSet||a.lang.label.set,onClick:P})])),Co}return Object.assign(n,{set:P,cancel:ge,show(Co){s.value!==null&&s.value.show(Co)},hide(Co){s.value!==null&&s.value.hide(Co)},updatePosition:nt}),()=>{if(e.disable!==!0)return h(QMenu,{ref:s,class:"q-popup-edit",cover:e.cover,onBeforeShow:qr,onShow:_n,onBeforeHide:Fn,onHide:tl,onEscapeKey:ge},Io)}}}),QTr=createComponent({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const r=computed(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>h("tr",{class:r.value},hSlot(t.default))}}),QTh=createComponent({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:t,emit:r}){const n=getCurrentInstance(),{proxy:{$q:a}}=n,s=f=>{r("click",f)};return()=>{if(e.props===void 0)return h("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:s},hSlot(t.default));let f,o;const x=n.vnode.key;if(x){if(f=e.props.colsMap[x],f===void 0)return}else f=e.props.col;if(f.sortable===!0){const P=f.align==="right"?"unshift":"push";o=hUniqueSlot(t.default,[]),o[P](h(QIcon,{class:f.__iconClass,name:a.iconSet.table.arrowUp}))}else o=hSlot(t.default);const C={class:f.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:f.headerStyle,onClick:P=>{f.sortable===!0&&e.props.sort(f),s(P)}};return h("th",C,o)}}}),QList=createComponent({name:"QList",props:{...useDarkProps,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:t}){const r=getCurrentInstance(),n=useDark(e,r.proxy.$q),a=computed(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(n.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>h(e.tag,{class:a.value},hSlot(t.default))}}),separatorValues=["horizontal","vertical","cell","none"],QMarkupTable=createComponent({name:"QMarkupTable",props:{...useDarkProps,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>separatorValues.includes(e)}},setup(e,{slots:t}){const r=getCurrentInstance(),n=useDark(e,r.proxy.$q),a=computed(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(n.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>h("div",{class:a.value},[h("table",{class:"q-table"},hSlot(t.default))])}});function getTableMiddle(e,t){return h("div",e,[h("table",{class:"q-table"},t)])}const comps={list:QList,table:QMarkupTable},typeOptions=["list","table","__qtable"],QVirtualScroll=createComponent({name:"QVirtualScroll",props:{...useVirtualScrollProps,type:{type:String,default:"list",validator:e=>typeOptions.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:t,attrs:r}){let n;const a=ref(null),s=computed(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:f,localResetVirtualScroll:o,padVirtualScroll:x,onVirtualScrollEvt:C}=useVirtualScroll({virtualScrollLength:s,getVirtualScrollTarget:Bt,getVirtualScrollEl:ze}),P=computed(()=>{if(s.value===0)return[];const tl=(Io,Co)=>({index:f.value.from+Co,item:Io});return e.itemsFn===void 0?e.items.slice(f.value.from,f.value.to).map(tl):e.itemsFn(f.value.from,f.value.to-f.value.from).map(tl)}),ge=computed(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),nt=computed(()=>e.scrollTarget!==void 0?{}:{tabindex:0});watch(s,()=>{o()}),watch(()=>e.scrollTarget,()=>{_n(),qr()});function ze(){return a.value.$el||a.value}function Bt(){return n}function qr(){n=getScrollTarget(ze(),e.scrollTarget),n.addEventListener("scroll",C,listenOpts.passive)}function _n(){n!==void 0&&(n.removeEventListener("scroll",C,listenOpts.passive),n=void 0)}function Fn(){let tl=x(e.type==="list"?"div":"tbody",P.value.map(t.default));return t.before!==void 0&&(tl=t.before().concat(tl)),hMergeSlot(t.after,tl)}return onBeforeMount(()=>{o()}),onMounted(()=>{qr()}),onActivated(()=>{qr()}),onDeactivated(()=>{_n()}),onBeforeUnmount(()=>{_n()}),()=>{if(t.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?getTableMiddle({ref:a,class:"q-table__middle "+ge.value},Fn()):h(comps[e.type],{...r,ref:a,class:[r.class,ge.value],...nt.value},Fn)}}}),defaultSizes={xs:2,sm:4,md:6,lg:10,xl:14};function width(e,t,r){return{transform:t===!0?`translateX(${r.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}const QLinearProgress=createComponent({name:"QLinearProgress",props:{...useDarkProps,...useSizeProps,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:r}=getCurrentInstance(),n=useDark(e,r.$q),a=useSize(e,defaultSizes),s=computed(()=>e.indeterminate===!0||e.query===!0),f=computed(()=>e.reverse!==e.query),o=computed(()=>({...a.value!==null?a.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),x=computed(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),C=computed(()=>width(e.buffer!==void 0?e.buffer:1,f.value,r.$q)),P=computed(()=>`with${e.instantFeedback===!0?"out":""}-transition`),ge=computed(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${P.value} q-linear-progress__track--${n.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),nt=computed(()=>width(s.value===!0?1:e.value,f.value,r.$q)),ze=computed(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${P.value} q-linear-progress__model--${s.value===!0?"in":""}determinate`),Bt=computed(()=>({width:`${e.value*100}%`})),qr=computed(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${P.value}`);return()=>{const _n=[h("div",{class:ge.value,style:C.value}),h("div",{class:ze.value,style:nt.value})];return e.stripe===!0&&s.value===!1&&_n.push(h("div",{class:qr.value,style:Bt.value})),h("div",{class:x.value,style:o.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},hMergeSlot(t.default,_n))}}});let counter=0;const useFullscreenProps={fullscreen:Boolean,noRouteFullscreenExit:Boolean},useFullscreenEmits=["update:fullscreen","fullscreen"];function useFullscreen(){const e=getCurrentInstance(),{props:t,emit:r,proxy:n}=e;let a,s,f;const o=ref(!1);vmHasRouter(e)===!0&&watch(()=>n.$route.fullPath,()=>{t.noRouteFullscreenExit!==!0&&P()}),watch(()=>t.fullscreen,ge=>{o.value!==ge&&x()}),watch(o,ge=>{r("update:fullscreen",ge),r("fullscreen",ge)});function x(){o.value===!0?P():C()}function C(){o.value!==!0&&(o.value=!0,f=n.$el.parentNode,f.replaceChild(s,n.$el),document.body.appendChild(n.$el),counter++,counter===1&&document.body.classList.add("q-body--fullscreen-mixin"),a={handler:P},History.add(a))}function P(){o.value===!0&&(a!==void 0&&(History.remove(a),a=void 0),f.replaceChild(n.$el,s),o.value=!1,counter=Math.max(0,counter-1),counter===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),n.$el.scrollIntoView!==void 0&&setTimeout(()=>{n.$el.scrollIntoView()})))}return onBeforeMount(()=>{s=document.createElement("span")}),onMounted(()=>{t.fullscreen===!0&&C()}),onBeforeUnmount(P),Object.assign(n,{toggleFullscreen:x,setFullscreen:C,exitFullscreen:P}),{inFullscreen:o,toggleFullscreen:x}}function sortDate(e,t){return new Date(e)-new Date(t)}const useTableSortProps={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function useTableSort(e,t,r,n){const a=computed(()=>{const{sortBy:o}=t.value;return o&&r.value.find(x=>x.name===o)||null}),s=computed(()=>e.sortMethod!==void 0?e.sortMethod:(o,x,C)=>{const P=r.value.find(ze=>ze.name===x);if(P===void 0||P.field===void 0)return o;const ge=C===!0?-1:1,nt=typeof P.field=="function"?ze=>P.field(ze):ze=>ze[P.field];return o.sort((ze,Bt)=>{let qr=nt(ze),_n=nt(Bt);return qr==null?-1*ge:_n==null?1*ge:P.sort!==void 0?P.sort(qr,_n,ze,Bt)*ge:isNumber$1(qr)===!0&&isNumber$1(_n)===!0?(qr-_n)*ge:isDate(qr)===!0&&isDate(_n)===!0?sortDate(qr,_n)*ge:typeof qr=="boolean"&&typeof _n=="boolean"?(qr-_n)*ge:([qr,_n]=[qr,_n].map(Fn=>(Fn+"").toLocaleString().toLowerCase()),qr<_n?-1*ge:qr===_n?0:ge)})});function f(o){let x=e.columnSortOrder;if(isObject$6(o)===!0)o.sortOrder&&(x=o.sortOrder),o=o.name;else{const ge=r.value.find(nt=>nt.name===o);ge!==void 0&&ge.sortOrder&&(x=ge.sortOrder)}let{sortBy:C,descending:P}=t.value;C!==o?(C=o,P=x==="da"):e.binaryStateSort===!0?P=!P:P===!0?x==="ad"?C=null:P=!1:x==="ad"?P=!0:C=null,n({sortBy:C,descending:P,page:1})}return{columnToSort:a,computedSortMethod:s,sort:f}}const useTableFilterProps={filter:[String,Object],filterMethod:Function};function useTableFilter(e,t){const r=computed(()=>e.filterMethod!==void 0?e.filterMethod:(n,a,s,f)=>{const o=a?a.toLowerCase():"";return n.filter(x=>s.some(C=>{const P=f(C,x)+"";return(P==="undefined"||P==="null"?"":P.toLowerCase()).indexOf(o)!==-1}))});return watch(()=>e.filter,()=>{nextTick(()=>{t({page:1},!0)})},{deep:!0}),{computedFilterMethod:r}}function samePagination(e,t){for(const r in t)if(t[r]!==e[r])return!1;return!0}function fixPagination(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const useTablePaginationProps={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function useTablePaginationState(e,t){const{props:r,emit:n}=e,a=ref(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:r.rowsPerPageOptions.length!==0?r.rowsPerPageOptions[0]:5},r.pagination)),s=computed(()=>{const P=r["onUpdate:pagination"]!==void 0?{...a.value,...r.pagination}:a.value;return fixPagination(P)}),f=computed(()=>s.value.rowsNumber!==void 0);function o(P){x({pagination:P,filter:r.filter})}function x(P={}){nextTick(()=>{n("request",{pagination:P.pagination||s.value,filter:P.filter||r.filter,getCellValue:t})})}function C(P,ge){const nt=fixPagination({...s.value,...P});if(samePagination(s.value,nt)===!0){f.value===!0&&ge===!0&&o(nt);return}if(f.value===!0){o(nt);return}r.pagination!==void 0&&r["onUpdate:pagination"]!==void 0?n("update:pagination",nt):a.value=nt}return{innerPagination:a,computedPagination:s,isServerSide:f,requestServerInteraction:x,setPagination:C}}function useTablePagination(e,t,r,n,a,s){const{props:f,emit:o,proxy:{$q:x}}=e,C=computed(()=>n.value===!0?r.value.rowsNumber||0:s.value),P=computed(()=>{const{page:Co,rowsPerPage:rl}=r.value;return(Co-1)*rl}),ge=computed(()=>{const{page:Co,rowsPerPage:rl}=r.value;return Co*rl}),nt=computed(()=>r.value.page===1),ze=computed(()=>r.value.rowsPerPage===0?1:Math.max(1,Math.ceil(C.value/r.value.rowsPerPage))),Bt=computed(()=>ge.value===0?!0:r.value.page>=ze.value),qr=computed(()=>(f.rowsPerPageOptions.includes(t.value.rowsPerPage)?f.rowsPerPageOptions:[t.value.rowsPerPage].concat(f.rowsPerPageOptions)).map(rl=>({label:rl===0?x.lang.table.allRows:""+rl,value:rl})));watch(ze,(Co,rl)=>{if(Co===rl)return;const ah=r.value.page;Co&&!ah?a({page:1}):Co<ah&&a({page:Co})});function _n(){a({page:1})}function Fn(){const{page:Co}=r.value;Co>1&&a({page:Co-1})}function tl(){const{page:Co,rowsPerPage:rl}=r.value;ge.value>0&&Co*rl<C.value&&a({page:Co+1})}function Io(){a({page:ze.value})}return f["onUpdate:pagination"]!==void 0&&o("update:pagination",{...r.value}),{firstRowIndex:P,lastRowIndex:ge,isFirstPage:nt,isLastPage:Bt,pagesNumber:ze,computedRowsPerPageOptions:qr,computedRowsNumber:C,firstPage:_n,prevPage:Fn,nextPage:tl,lastPage:Io}}const useTableRowSelectionProps={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},useTableRowSelectionEmits=["update:selected","selection"];function useTableRowSelection(e,t,r,n){const a=computed(()=>{const Bt={};return e.selected.map(n.value).forEach(qr=>{Bt[qr]=!0}),Bt}),s=computed(()=>e.selection!=="none"),f=computed(()=>e.selection==="single"),o=computed(()=>e.selection==="multiple"),x=computed(()=>r.value.length!==0&&r.value.every(Bt=>a.value[n.value(Bt)]===!0)),C=computed(()=>x.value!==!0&&r.value.some(Bt=>a.value[n.value(Bt)]===!0)),P=computed(()=>e.selected.length);function ge(Bt){return a.value[Bt]===!0}function nt(){t("update:selected",[])}function ze(Bt,qr,_n,Fn){t("selection",{rows:qr,added:_n,keys:Bt,evt:Fn});const tl=f.value===!0?_n===!0?qr:[]:_n===!0?e.selected.concat(qr):e.selected.filter(Io=>Bt.includes(n.value(Io))===!1);t("update:selected",tl)}return{hasSelectionMode:s,singleSelection:f,multipleSelection:o,allRowsSelected:x,someRowsSelected:C,rowsSelectedNumber:P,isRowSelected:ge,clearSelection:nt,updateSelection:ze}}function getVal(e){return Array.isArray(e)?e.slice():[]}const useTableRowExpandProps={expanded:Array},useTableRowExpandEmits=["update:expanded"];function useTableRowExpand(e,t){const r=ref(getVal(e.expanded));watch(()=>e.expanded,f=>{r.value=getVal(f)});function n(f){return r.value.includes(f)}function a(f){e.expanded!==void 0?t("update:expanded",f):r.value=f}function s(f,o){const x=r.value.slice(),C=x.indexOf(f);o===!0?C===-1&&(x.push(f),a(x)):C!==-1&&(x.splice(C,1),a(x))}return{isRowExpanded:n,setExpanded:a,updateExpanded:s}}const useTableColumnSelectionProps={visibleColumns:Array};function useTableColumnSelection(e,t,r){const n=computed(()=>{if(e.columns!==void 0)return e.columns;const o=e.rows[0];return o!==void 0?Object.keys(o).map(x=>({name:x,label:x.toUpperCase(),field:x,align:isNumber$1(o[x])?"right":"left",sortable:!0})):[]}),a=computed(()=>{const{sortBy:o,descending:x}=t.value;return(e.visibleColumns!==void 0?n.value.filter(P=>P.required===!0||e.visibleColumns.includes(P.name)===!0):n.value).map(P=>{const ge=P.align||"right",nt=`text-${ge}`;return{...P,align:ge,__iconClass:`q-table__sort-icon q-table__sort-icon--${ge}`,__thClass:nt+(P.headerClasses!==void 0?" "+P.headerClasses:"")+(P.sortable===!0?" sortable":"")+(P.name===o?` sorted ${x===!0?"sort-desc":""}`:""),__tdStyle:P.style!==void 0?typeof P.style!="function"?()=>P.style:P.style:()=>null,__tdClass:P.classes!==void 0?typeof P.classes!="function"?()=>nt+" "+P.classes:ze=>nt+" "+P.classes(ze):()=>nt}})}),s=computed(()=>{const o={};return a.value.forEach(x=>{o[x.name]=x}),o}),f=computed(()=>e.tableColspan!==void 0?e.tableColspan:a.value.length+(r.value===!0?1:0));return{colList:n,computedCols:a,computedColsMap:s,computedColspan:f}}const bottomClass="q-table__bottom row items-center",commonVirtPropsObj={};commonVirtPropsList.forEach(e=>{commonVirtPropsObj[e]={}});const QTable=createComponent({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...commonVirtPropsObj,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...useDarkProps,...useFullscreenProps,...useTableColumnSelectionProps,...useTableFilterProps,...useTablePaginationProps,...useTableRowExpandProps,...useTableRowSelectionProps,...useTableSortProps},emits:["request","virtualScroll",...useFullscreenEmits,...useTableRowExpandEmits,...useTableRowSelectionEmits],setup(e,{slots:t,emit:r}){const n=getCurrentInstance(),{proxy:{$q:a}}=n,s=useDark(e,a),{inFullscreen:f,toggleFullscreen:o}=useFullscreen(),x=computed(()=>typeof e.rowKey=="function"?e.rowKey:Th=>Th[e.rowKey]),C=ref(null),P=ref(null),ge=computed(()=>e.grid!==!0&&e.virtualScroll===!0),nt=computed(()=>" q-table__card"+(s.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),ze=computed(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":nt.value)+(s.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(f.value===!0?" fullscreen scroll":"")),Bt=computed(()=>ze.value+(e.loading===!0?" q-table--loading":""));watch(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+ze.value,()=>{ge.value===!0&&P.value!==null&&P.value.reset()});const{innerPagination:qr,computedPagination:_n,isServerSide:Fn,requestServerInteraction:tl,setPagination:Io}=useTablePaginationState(n,Ap),{computedFilterMethod:Co}=useTableFilter(e,Io),{isRowExpanded:rl,setExpanded:ah,updateExpanded:ch}=useTableRowExpand(e,r),ju=computed(()=>{let Th=e.rows;if(Fn.value===!0||Th.length===0)return Th;const{sortBy:Fh,descending:al}=_n.value;return e.filter&&(Th=Co.value(Th,e.filter,yd.value,Ap)),Pd.value!==null&&(Th=zd.value(e.rows===Th?Th.slice():Th,Fh,al)),Th}),Zu=computed(()=>ju.value.length),sl=computed(()=>{let Th=ju.value;if(Fn.value===!0)return Th;const{rowsPerPage:Fh}=_n.value;return Fh!==0&&(Kd.value===0&&e.rows!==Th?Th.length>wf.value&&(Th=Th.slice(0,wf.value)):Th=Th.slice(Kd.value,wf.value)),Th}),{hasSelectionMode:oh,singleSelection:hh,multipleSelection:Sh,allRowsSelected:$h,someRowsSelected:hd,rowsSelectedNumber:vd,isRowSelected:Ef,clearSelection:Cd,updateSelection:Cf}=useTableRowSelection(e,r,sl,x),{colList:Sd,computedCols:yd,computedColsMap:Hd,computedColspan:xd}=useTableColumnSelection(e,_n,oh),{columnToSort:Pd,computedSortMethod:zd,sort:Ld}=useTableSort(e,_n,Sd,Io),{firstRowIndex:Kd,lastRowIndex:wf,isFirstPage:kd,isLastPage:cd,pagesNumber:gd,computedRowsPerPageOptions:bp,computedRowsNumber:Uf,firstPage:qd,prevPage:Vd,nextPage:ep,lastPage:_p}=useTablePagination(n,qr,_n,Fn,Io,Zu),lp=computed(()=>sl.value.length===0),Kh=computed(()=>{const Th={};return commonVirtPropsList.forEach(Fh=>{Th[Fh]=e[Fh]}),Th.virtualScrollItemSize===void 0&&(Th.virtualScrollItemSize=e.dense===!0?28:48),Th});function Qd(){ge.value===!0&&P.value.reset()}function fd(){if(e.grid===!0)return Qh();const Th=e.hideHeader!==!0?qp:null;if(ge.value===!0){const al=t["top-row"],fh=t["bottom-row"],nl={default:Zs=>Jf(Zs.item,t.body,Zs.index)};if(al!==void 0){const Zs=h("tbody",al({cols:yd.value}));nl.before=Th===null?()=>Zs:()=>[Th()].concat(Zs)}else Th!==null&&(nl.before=Th);return fh!==void 0&&(nl.after=()=>h("tbody",fh({cols:yd.value}))),h(QVirtualScroll,{ref:P,class:e.tableClass,style:e.tableStyle,...Kh.value,scrollTarget:e.virtualScrollTarget,items:sl.value,type:"__qtable",tableColspan:xd.value,onVirtualScroll:Yh},nl)}const Fh=[Sf()];return Th!==null&&Fh.unshift(Th()),getTableMiddle({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},Fh)}function Jd(Th,Fh){if(P.value!==null){P.value.scrollTo(Th,Fh);return}Th=parseInt(Th,10);const al=C.value.querySelector(`tbody tr:nth-of-type(${Th+1})`);if(al!==null){const fh=C.value.querySelector(".q-table__middle.scroll"),nl=al.offsetTop-e.virtualScrollStickySizeStart,Zs=nl<fh.scrollTop?"decrease":"increase";fh.scrollTop=nl,r("virtualScroll",{index:Th,from:0,to:qr.value.rowsPerPage-1,direction:Zs})}}function Yh(Th){r("virtualScroll",Th)}function $d(){return[h(QLinearProgress,{class:"q-table__linear-progress",color:e.color,dark:s.value,indeterminate:!0,trackColor:"transparent"})]}function Jf(Th,Fh,al){const fh=x.value(Th),nl=Ef(fh);if(Fh!==void 0)return Fh(If({key:fh,row:Th,pageIndex:al,__trClass:nl?"selected":""}));const Zs=t["body-cell"],ol=yd.value.map(xh=>{const Mh=t[`body-cell-${xh.name}`],Uh=Mh!==void 0?Mh:Zs;return Uh!==void 0?Uh(Xf({key:fh,row:Th,pageIndex:al,col:xh})):h("td",{class:xh.__tdClass(Th),style:xh.__tdStyle(Th)},Ap(xh,Th))});if(oh.value===!0){const xh=t["body-selection"],Mh=xh!==void 0?xh(Of({key:fh,row:Th,pageIndex:al})):[h(QCheckbox,{modelValue:nl,color:e.color,dark:s.value,dense:e.dense,"onUpdate:modelValue":(Uh,Nh)=>{Cf([fh],[Th],Uh,Nh)}})];ol.unshift(h("td",{class:"q-table--col-auto-width"},Mh))}const sh={key:fh,class:{selected:nl}};return e.onRowClick!==void 0&&(sh.class["cursor-pointer"]=!0,sh.onClick=xh=>{r("RowClick",xh,Th,al)}),e.onRowDblclick!==void 0&&(sh.class["cursor-pointer"]=!0,sh.onDblclick=xh=>{r("RowDblclick",xh,Th,al)}),e.onRowContextmenu!==void 0&&(sh.class["cursor-pointer"]=!0,sh.onContextmenu=xh=>{r("RowContextmenu",xh,Th,al)}),h("tr",sh,ol)}function Sf(){const Th=t.body,Fh=t["top-row"],al=t["bottom-row"];let fh=sl.value.map((nl,Zs)=>Jf(nl,Th,Zs));return Fh!==void 0&&(fh=Fh({cols:yd.value}).concat(fh)),al!==void 0&&(fh=fh.concat(al({cols:yd.value}))),h("tbody",fh)}function If(Th){return jf(Th),Th.cols=Th.cols.map(Fh=>injectProp({...Fh},"value",()=>Ap(Fh,Th.row))),Th}function Xf(Th){return jf(Th),injectProp(Th,"value",()=>Ap(Th.col,Th.row)),Th}function Of(Th){return jf(Th),Th}function jf(Th){Object.assign(Th,{cols:yd.value,colsMap:Hd.value,sort:Ld,rowIndex:Kd.value+Th.pageIndex,color:e.color,dark:s.value,dense:e.dense}),oh.value===!0&&injectProp(Th,"selected",()=>Ef(Th.key),(Fh,al)=>{Cf([Th.key],[Th.row],Fh,al)}),injectProp(Th,"expand",()=>rl(Th.key),Fh=>{ch(Th.key,Fh)})}function Ap(Th,Fh){const al=typeof Th.field=="function"?Th.field(Fh):Fh[Th.field];return Th.format!==void 0?Th.format(al,Fh):al}const vp=computed(()=>({pagination:_n.value,pagesNumber:gd.value,isFirstPage:kd.value,isLastPage:cd.value,firstPage:qd,prevPage:Vd,nextPage:ep,lastPage:_p,inFullscreen:f.value,toggleFullscreen:o}));function Tp(){const Th=t.top,Fh=t["top-left"],al=t["top-right"],fh=t["top-selection"],nl=oh.value===!0&&fh!==void 0&&vd.value>0,Zs="q-table__top relative-position row items-center";if(Th!==void 0)return h("div",{class:Zs},[Th(vp.value)]);let ol;if(nl===!0?ol=fh(vp.value).slice():(ol=[],Fh!==void 0?ol.push(h("div",{class:"q-table__control"},[Fh(vp.value)])):e.title&&ol.push(h("div",{class:"q-table__control"},[h("div",{class:["q-table__title",e.titleClass]},e.title)]))),al!==void 0&&(ol.push(h("div",{class:"q-table__separator col"})),ol.push(h("div",{class:"q-table__control"},[al(vp.value)]))),ol.length!==0)return h("div",{class:Zs},ol)}const Zf=computed(()=>hd.value===!0?null:$h.value);function qp(){const Th=sm();return e.loading===!0&&t.loading===void 0&&Th.push(h("tr",{class:"q-table__progress"},[h("th",{class:"relative-position",colspan:xd.value},$d())])),h("thead",Th)}function sm(){const Th=t.header,Fh=t["header-cell"];if(Th!==void 0)return Th(Wd({header:!0})).slice();const al=yd.value.map(fh=>{const nl=t[`header-cell-${fh.name}`],Zs=nl!==void 0?nl:Fh,ol=Wd({col:fh});return Zs!==void 0?Zs(ol):h(QTh,{key:fh.name,props:ol},()=>fh.label)});if(hh.value===!0&&e.grid!==!0)al.unshift(h("th",{class:"q-table--col-auto-width"}," "));else if(Sh.value===!0){const fh=t["header-selection"],nl=fh!==void 0?fh(Wd({})):[h(QCheckbox,{color:e.color,modelValue:Zf.value,dark:s.value,dense:e.dense,"onUpdate:modelValue":$p})];al.unshift(h("th",{class:"q-table--col-auto-width"},nl))}return[h("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},al)]}function Wd(Th){return Object.assign(Th,{cols:yd.value,sort:Ld,colsMap:Hd.value,color:e.color,dark:s.value,dense:e.dense}),Sh.value===!0&&injectProp(Th,"selected",()=>Zf.value,$p),Th}function $p(Th){hd.value===!0&&(Th=!1),Cf(sl.value.map(x.value),sl.value,Th)}const Lh=computed(()=>{const Th=[e.iconFirstPage||a.iconSet.table.firstPage,e.iconPrevPage||a.iconSet.table.prevPage,e.iconNextPage||a.iconSet.table.nextPage,e.iconLastPage||a.iconSet.table.lastPage];return a.lang.rtl===!0?Th.reverse():Th});function lh(){if(e.hideBottom===!0)return;if(lp.value===!0){if(e.hideNoData===!0)return;const al=e.loading===!0?e.loadingLabel||a.lang.table.loading:e.filter?e.noResultsLabel||a.lang.table.noResults:e.noDataLabel||a.lang.table.noData,fh=t["no-data"],nl=fh!==void 0?[fh({message:al,icon:a.iconSet.table.warning,filter:e.filter})]:[h(QIcon,{class:"q-table__bottom-nodata-icon",name:a.iconSet.table.warning}),al];return h("div",{class:bottomClass+" q-table__bottom--nodata"},nl)}const Th=t.bottom;if(Th!==void 0)return h("div",{class:bottomClass},[Th(vp.value)]);const Fh=e.hideSelectedBanner!==!0&&oh.value===!0&&vd.value>0?[h("div",{class:"q-table__control"},[h("div",[(e.selectedRowsLabel||a.lang.table.selectedRecords)(vd.value)])])]:[];if(e.hidePagination!==!0)return h("div",{class:bottomClass+" justify-end"},Ah(Fh));if(Fh.length!==0)return h("div",{class:bottomClass},Fh)}function ih(Th){Io({page:1,rowsPerPage:Th.value})}function Ah(Th){let Fh;const{rowsPerPage:al}=_n.value,fh=e.paginationLabel||a.lang.table.pagination,nl=t.pagination,Zs=e.rowsPerPageOptions.length>1;if(Th.push(h("div",{class:"q-table__separator col"})),Zs===!0&&Th.push(h("div",{class:"q-table__control"},[h("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||a.lang.table.recordsPerPage]),h(QSelect,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:al,options:bp.value,displayValue:al===0?a.lang.table.allRows:al,dark:s.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":ih})])),nl!==void 0)Fh=nl(vp.value);else if(Fh=[h("span",al!==0?{class:"q-table__bottom-item"}:{},[al?fh(Kd.value+1,Math.min(wf.value,Uf.value),Uf.value):fh(1,Zu.value,Uf.value)])],al!==0&&gd.value>1){const ol={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&(ol.size="sm"),gd.value>2&&Fh.push(h(QBtn,{key:"pgFirst",...ol,icon:Lh.value[0],disable:kd.value,onClick:qd})),Fh.push(h(QBtn,{key:"pgPrev",...ol,icon:Lh.value[1],disable:kd.value,onClick:Vd}),h(QBtn,{key:"pgNext",...ol,icon:Lh.value[2],disable:cd.value,onClick:ep})),gd.value>2&&Fh.push(h(QBtn,{key:"pgLast",...ol,icon:Lh.value[3],disable:cd.value,onClick:_p}))}return Th.push(h("div",{class:"q-table__control"},Fh)),Th}function zh(){const Th=e.gridHeader===!0?[h("table",{class:"q-table"},[qp()])]:e.loading===!0&&t.loading===void 0?$d():void 0;return h("div",{class:"q-table__middle"},Th)}function Qh(){const Th=t.item!==void 0?t.item:Fh=>{const al=Fh.cols.map(nl=>h("div",{class:"q-table__grid-item-row"},[h("div",{class:"q-table__grid-item-title"},[nl.label]),h("div",{class:"q-table__grid-item-value"},[nl.value])]));if(oh.value===!0){const nl=t["body-selection"],Zs=nl!==void 0?nl(Fh):[h(QCheckbox,{modelValue:Fh.selected,color:e.color,dark:s.value,dense:e.dense,"onUpdate:modelValue":(ol,sh)=>{Cf([Fh.key],[Fh.row],ol,sh)}})];al.unshift(h("div",{class:"q-table__grid-item-row"},Zs),h(QSeparator,{dark:s.value}))}const fh={class:["q-table__grid-item-card"+nt.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(fh.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(fh.onClick=nl=>{r("RowClick",nl,Fh.row,Fh.pageIndex)}),e.onRowDblclick!==void 0&&(fh.onDblclick=nl=>{r("RowDblclick",nl,Fh.row,Fh.pageIndex)})),h("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(Fh.selected===!0?" q-table__grid-item--selected":"")},[h("div",fh,al)])};return h("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},sl.value.map((Fh,al)=>Th(If({key:x.value(Fh),row:Fh,pageIndex:al}))))}return Object.assign(n.proxy,{requestServerInteraction:tl,setPagination:Io,firstPage:qd,prevPage:Vd,nextPage:ep,lastPage:_p,isRowSelected:Ef,clearSelection:Cd,isRowExpanded:rl,setExpanded:ah,sort:Ld,resetVirtualScroll:Qd,scrollTo:Jd,getCellValue:Ap}),injectMultipleProps(n.proxy,{filteredSortedRows:()=>ju.value,computedRows:()=>sl.value,computedRowsNumber:()=>Uf.value}),()=>{const Th=[Tp()],Fh={ref:C,class:Bt.value};return e.grid===!0?Th.push(zh()):Object.assign(Fh,{class:[Fh.class,e.cardClass],style:e.cardStyle}),Th.push(fd(),lh()),e.loading===!0&&t.loading!==void 0&&Th.push(t.loading()),h("div",Fh,Th)}}}),QTabPanels=createComponent({name:"QTabPanels",props:{...usePanelProps,...useDarkProps},emits:usePanelEmits,setup(e,{slots:t}){const r=getCurrentInstance(),n=useDark(e,r.proxy.$q),{updatePanelsList:a,getPanelContent:s,panelDirectives:f}=usePanel(),o=computed(()=>"q-tab-panels q-panel-parent"+(n.value===!0?" q-tab-panels--dark q-dark":""));return()=>(a(t),hDir("div",{class:o.value},s(),"pan",e.swipeable,()=>f.value))}}),QPageContainer=createComponent({name:"QPageContainer",setup(e,{slots:t}){const{proxy:{$q:r}}=getCurrentInstance(),n=inject(layoutKey,emptyRenderFn);if(n===emptyRenderFn)return console.error("QPageContainer needs to be child of QLayout"),emptyRenderFn;provide(pageContainerKey,!0);const a=computed(()=>{const s={};return n.header.space===!0&&(s.paddingTop=`${n.header.size}px`),n.right.space===!0&&(s[`padding${r.lang.rtl===!0?"Left":"Right"}`]=`${n.right.size}px`),n.footer.space===!0&&(s.paddingBottom=`${n.footer.size}px`),n.left.space===!0&&(s[`padding${r.lang.rtl===!0?"Right":"Left"}`]=`${n.left.size}px`),s});return()=>h("div",{class:"q-page-container",style:a.value},hSlot(t.default))}}),{passive}=listenOpts,axisValues=["both","horizontal","vertical"],QScrollObserver=createComponent({name:"QScrollObserver",props:{axis:{type:String,validator:e=>axisValues.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(e,{emit:t}){const r={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let n=null,a,s;watch(()=>e.scrollTarget,()=>{x(),o()});function f(){n!==null&&n();const ge=Math.max(0,getVerticalScrollPosition(a)),nt=getHorizontalScrollPosition(a),ze={top:ge-r.position.top,left:nt-r.position.left};if(e.axis==="vertical"&&ze.top===0||e.axis==="horizontal"&&ze.left===0)return;const Bt=Math.abs(ze.top)>=Math.abs(ze.left)?ze.top<0?"up":"down":ze.left<0?"left":"right";r.position={top:ge,left:nt},r.directionChanged=r.direction!==Bt,r.delta=ze,r.directionChanged===!0&&(r.direction=Bt,r.inflectionPoint=r.position),t("scroll",{...r})}function o(){a=getScrollTarget(s,e.scrollTarget),a.addEventListener("scroll",C,passive),C(!0)}function x(){a!==void 0&&(a.removeEventListener("scroll",C,passive),a=void 0)}function C(ge){if(ge===!0||e.debounce===0||e.debounce==="0")f();else if(n===null){const[nt,ze]=e.debounce?[setTimeout(f,e.debounce),clearTimeout]:[requestAnimationFrame(f),cancelAnimationFrame];n=()=>{ze(nt),n=null}}}const{proxy:P}=getCurrentInstance();return watch(()=>P.$q.lang.rtl,f),onMounted(()=>{s=P.$el.parentNode,o()}),onBeforeUnmount(()=>{n!==null&&n(),x()}),Object.assign(P,{trigger:C,getPosition:()=>r}),noop}}),QLayout=createComponent({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=getCurrentInstance(),a=ref(null),s=ref(n.screen.height),f=ref(e.container===!0?0:n.screen.width),o=ref({position:0,direction:"down",inflectionPoint:0}),x=ref(0),C=ref(isRuntimeSsrPreHydration.value===!0?0:getScrollbarWidth()),P=computed(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),ge=computed(()=>e.container===!1?{minHeight:n.screen.height+"px"}:null),nt=computed(()=>C.value!==0?{[n.lang.rtl===!0?"left":"right"]:`${C.value}px`}:null),ze=computed(()=>C.value!==0?{[n.lang.rtl===!0?"right":"left"]:0,[n.lang.rtl===!0?"left":"right"]:`-${C.value}px`,width:`calc(100% + ${C.value}px)`}:null);function Bt(Co){if(e.container===!0||document.qScrollPrevented!==!0){const rl={position:Co.position.top,direction:Co.direction,directionChanged:Co.directionChanged,inflectionPoint:Co.inflectionPoint.top,delta:Co.delta.top};o.value=rl,e.onScroll!==void 0&&r("scroll",rl)}}function qr(Co){const{height:rl,width:ah}=Co;let ch=!1;s.value!==rl&&(ch=!0,s.value=rl,e.onScrollHeight!==void 0&&r("scrollHeight",rl),Fn()),f.value!==ah&&(ch=!0,f.value=ah),ch===!0&&e.onResize!==void 0&&r("resize",Co)}function _n({height:Co}){x.value!==Co&&(x.value=Co,Fn())}function Fn(){if(e.container===!0){const Co=s.value>x.value?getScrollbarWidth():0;C.value!==Co&&(C.value=Co)}}let tl=null;const Io={instances:{},view:computed(()=>e.view),isContainer:computed(()=>e.container),rootRef:a,height:s,containerHeight:x,scrollbarWidth:C,totalWidth:computed(()=>f.value+C.value),rows:computed(()=>{const Co=e.view.toLowerCase().split(" ");return{top:Co[0].split(""),middle:Co[1].split(""),bottom:Co[2].split("")}}),header:reactive({size:0,offset:0,space:!1}),right:reactive({size:300,offset:0,space:!1}),footer:reactive({size:0,offset:0,space:!1}),left:reactive({size:300,offset:0,space:!1}),scroll:o,animate(){tl!==null?clearTimeout(tl):document.body.classList.add("q-body--layout-animate"),tl=setTimeout(()=>{tl=null,document.body.classList.remove("q-body--layout-animate")},155)},update(Co,rl,ah){Io[Co][rl]=ah}};if(provide(layoutKey,Io),getScrollbarWidth()>0){let ah=function(){Co=null,rl.classList.remove("hide-scrollbar")},ch=function(){if(Co===null){if(rl.scrollHeight>n.screen.height)return;rl.classList.add("hide-scrollbar")}else clearTimeout(Co);Co=setTimeout(ah,300)},ju=function(Zu){Co!==null&&Zu==="remove"&&(clearTimeout(Co),ah()),window[`${Zu}EventListener`]("resize",ch)},Co=null;const rl=document.body;watch(()=>e.container!==!0?"add":"remove",ju),e.container!==!0&&ju("add"),onUnmounted(()=>{ju("remove")})}return()=>{const Co=hMergeSlot(t.default,[h(QScrollObserver,{onScroll:Bt}),h(QResizeObserver,{onResize:qr})]),rl=h("div",{class:P.value,style:ge.value,ref:e.container===!0?void 0:a,tabindex:-1},Co);return e.container===!0?h("div",{class:"q-layout-container overflow-hidden",ref:a},[h(QResizeObserver,{onResize:_n}),h("div",{class:"absolute-full",style:nt.value},[h("div",{class:"scroll",style:ze.value},[rl])])]):rl}}});function getDepth$1(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const ClosePopup=createDirective({name:"close-popup",beforeMount(e,{value:t}){const r={depth:getDepth$1(t),handler(n){r.depth!==0&&setTimeout(()=>{const a=getPortalProxy(e);a!==void 0&&closePortals(a,n,r.depth)})},handlerKey(n){isKeyCode(n,13)===!0&&r.handler(n)}};e.__qclosepopup=r,e.addEventListener("click",r.handler),e.addEventListener("keyup",r.handlerKey)},updated(e,{value:t,oldValue:r}){t!==r&&(e.__qclosepopup.depth=getDepth$1(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}}),QToolbar=createComponent({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:t}){const r=computed(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>h("div",{class:r.value,role:"toolbar"},hSlot(t.default))}});class Store{constructor(t="unreal-mapbox",r="keyval"){this.storeName=r,this._dbp=new Promise((n,a)=>{const s=indexedDB.open(t,3);s.onerror=()=>a(s.error),s.onsuccess=()=>n(s.result),s.onupgradeneeded=()=>{try{s.result.deleteObjectStore(r)}catch{}s.result.createObjectStore(r)}})}_withIDBStore(t,r){return this._dbp.then(n=>new Promise((a,s)=>{const f=n.transaction(this.storeName,t);f.oncomplete=()=>a(),f.onabort=f.onerror=()=>s(f.error),r(f.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get$3(e,t=getDefaultStore()){let r;return t._withIDBStore("readonly",n=>{r=n.get(e)}).then(()=>r.result)}function set(e,t,r=getDefaultStore()){return r._withIDBStore("readwrite",n=>{n.put(t,e)})}function del(e,t=getDefaultStore()){return t._withIDBStore("readwrite",r=>{r.delete(e)})}function clear(e=getDefaultStore()){return e._withIDBStore("readwrite",t=>{t.clear()})}function keys$4(e=getDefaultStore()){const t=[];return e._withIDBStore("readonly",r=>{(r.openKeyCursor||r.openCursor).call(r).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}const idbKeyval={keys:keys$4,clear,del,set,get:get$3};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(e=>e[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(e=>e)}async function verifyPermission(e,t){const r={};return t&&(r.writable=!0,r.mode="readwrite"),await e.queryPermission(r)==="granted"||await e.requestPermission(r)==="granted"}async function writeFileToDisk(e,t,r){let a=await(await e.getFileHandle(t,{create:!0})).createWritable();await a.write(r),await a.close()}async function fileExists(e,t){try{return await e.getFileHandle(t),!0}catch(r){if(r.name==="NotFoundError")return!1;if(r.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(e,t){return await(await(await e.getFileHandle(t)).getFile()).arrayBuffer()}function checkFileApiSupport(){let e;return"showDirectoryPicker"in window?e=!0:e=!1,e}const fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var s=Function.bind.apply(t,a);return new s}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),r}var mapboxGl={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){var r,n,a;function s(o,x){if(!r)r=x;else if(!n)n=x;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",P={};r(P),a=x(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}s(["exports"],function(o){var x=typeof self<"u"?self:{},C="2.15.0";let P;const ge={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(P==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{P={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):c}catch{P=c}}return P},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ge.API_URL)return null;try{const c=new URL(ge.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nt={supported:!1,testSupport:function(c){!qr&&Bt&&(_n?Fn(c):ze=c)}};let ze,Bt,qr=!1,_n=!1;function Fn(c){const l=c.createTexture();c.bindTexture(c.TEXTURE_2D,l);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Bt),c.isContextLost())return;nt.supported=!0}catch{}c.deleteTexture(l),qr=!0}x.document&&(Bt=x.document.createElement("img"),Bt.onload=function(){ze&&Fn(ze),ze=null,_n=!0},Bt.onerror=function(){qr=!0,ze=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const tl="01";function Io(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Co=rl;function rl(c,l,d,y){this.cx=3*c,this.bx=3*(d-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(y-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=d,this.p2y=y}rl.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var d=c,y=0;y<8;y++){var M=this.sampleCurveX(d)-c;if(Math.abs(M)<l)return d;var N=this.sampleCurveDerivativeX(d);if(Math.abs(N)<1e-6)break;d-=M/N}var q=0,St=1;for(d=c,y=0;y<20&&(M=this.sampleCurveX(d),!(Math.abs(M-c)<l));y++)c>M?q=d:St=d,d=.5*(St-q)+q;return d},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var ah=Io(Co),ch=ju;function ju(c,l){this.x=c,this.y=l}ju.prototype={clone:function(){return new ju(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,l){return this.clone()._rotateAround(c,l)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var l=c.x-this.x,d=c.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,l){return Math.atan2(this.x*l-this.y*c,this.x*c+this.y*l)},_matMult:function(c){var l=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=l,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var l=Math.cos(c),d=Math.sin(c),y=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=y,this},_rotateAround:function(c,l){var d=Math.cos(c),y=Math.sin(c),M=l.y+y*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-y*(this.y-l.y),this.y=M,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ju.convert=function(c){return c instanceof ju?c:Array.isArray(c)?new ju(c[0],c[1]):c};var Zu=Io(ch);const sl=Math.PI/180,oh=180/Math.PI;function hh(c){return c*sl}function Sh(c){return c*oh}const $h=[[0,0],[1,0],[1,1],[0,1]];function hd(c){if(c<=0)return 0;if(c>=1)return 1;const l=c*c,d=l*c;return 4*(c<.5?d:3*(c-l)+d-.75)}function vd(c,l,d,y){const M=new ah(c,l,d,y);return function(N){return M.solve(N)}}const Ef=vd(.25,.1,.25,1);function Cd(c,l,d){return Math.min(d,Math.max(l,c))}function Cf(c,l,d){return(d=Cd((d-c)/(l-c),0,1))*d*(3-2*d)}function Sd(c,l,d){const y=d-l,M=((c-l)%y+y)%y+l;return M===l?d:M}function yd(c,l,d){if(!c.length)return d(null,[]);let y=c.length;const M=new Array(c.length);let N=null;c.forEach((q,St)=>{l(q,(Ht,Ui)=>{Ht&&(N=Ht),M[St]=Ui,--y==0&&d(N,M)})})}function Hd(c){const l=[];for(const d in c)l.push(c[d]);return l}function xd(c,...l){for(const d of l)for(const y in d)c[y]=d[y];return c}let Pd=1;function zd(){return Pd++}function Ld(){return function c(l){return l?(l^Math.random()*(16>>l/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function Kd(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function wf(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function kd(c,l){c.forEach(d=>{l[d]&&(l[d]=l[d].bind(l))})}function cd(c,l){return c.indexOf(l,c.length-l.length)!==-1}function gd(c,l,d){const y={};for(const M in c)y[M]=l.call(d||this,c[M],M,c);return y}function bp(c,l,d){const y={};for(const M in c)l.call(d||this,c[M],M,c)&&(y[M]=c[M]);return y}function Uf(c){return Array.isArray(c)?c.map(Uf):typeof c=="object"&&c?gd(c,Uf):c}const qd={};function Vd(c){qd[c]||(typeof console<"u"&&console.warn(c),qd[c]=!0)}function ep(c,l,d){return(d.y-c.y)*(l.x-c.x)>(l.y-c.y)*(d.x-c.x)}function _p(c){let l=0;for(let d,y,M=0,N=c.length,q=N-1;M<N;q=M++)d=c[M],y=c[q],l+=(y.x-d.x)*(d.y+y.y);return l}function lp(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kh(c){const l={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,y,M,N)=>{const q=M||N;return l[y]=!q||q.toLowerCase(),""}),l["max-age"]){const d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l}let Qd=null;function fd(c){if(Qd==null){const l=c.navigator?c.navigator.userAgent:null;Qd=!!c.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Qd}function Jd(c){try{const l=x[c];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}}function Yh(c,l){return[c[4*l],c[4*l+1],c[4*l+2],c[4*l+3]]}const $d="mapbox-tiles";let Jf=500,Sf=50,If,Xf;function Of(){try{return x.caches}catch{}}function jf(){Of()&&!If&&(If=x.caches.open($d))}function Ap(c){const l=c.indexOf("?");if(l<0)return c;const d=function(M){const N=M.indexOf("?");return N>0?M.slice(N+1).split("&"):[]}(c),y=d.filter(M=>{const N=M.split("=");return N[0]==="language"||N[0]==="worldview"});return y.length?`${c.slice(0,l)}?${y.join("&")}`:c.slice(0,l)}let vp=1/0;const Tp={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Tp);class Zf extends Error{constructor(l,d,y){d===401&&Th(y)&&(l+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(l),this.status=d,this.url=y}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const qp=lp()?()=>self.worker&&self.worker.referrer:()=>(x.location.protocol==="blob:"?x.parent:x).location.href,sm=function(c,l){if(!(/^file:/.test(d=c.url)||/^file:/.test(qp())&&!/^\w+:/.test(d))){if(x.fetch&&x.Request&&x.AbortController&&x.Request.prototype.hasOwnProperty("signal"))return function(y,M){const N=new x.AbortController,q=new x.Request(y.url,{method:y.method||"GET",body:y.body,credentials:y.credentials,headers:y.headers,referrer:qp(),referrerPolicy:y.referrerPolicy,signal:N.signal});let St=!1,Ht=!1;const Ui=(Bn=q.url).indexOf("sku=")>0&&Th(Bn);var Bn;y.type==="json"&&q.headers.set("Accept","application/json");const ls=($u,Ku,rh)=>{if(Ht)return;if($u&&$u.message!=="SecurityError"&&Vd($u.toString()),Ku&&rh)return il(Ku);const vh=Date.now();x.fetch(q).then(Ph=>{if(Ph.ok){const Xh=Ui?Ph.clone():null;return il(Ph,Xh,vh)}return M(new Zf(Ph.statusText,Ph.status,y.url))}).catch(Ph=>{Ph.name!=="AbortError"&&M(new Error(`${Ph.message} ${y.url}`))})},il=($u,Ku,rh)=>{(y.type==="arrayBuffer"?$u.arrayBuffer():y.type==="json"?$u.json():$u.text()).then(vh=>{Ht||(Ku&&rh&&function(Ph,Xh,Dh){if(jf(),!If)return;const jh={status:Xh.status,statusText:Xh.statusText,headers:new x.Headers};Xh.headers.forEach((Bd,Rd)=>jh.headers.set(Rd,Bd));const ad=Kh(Xh.headers.get("Cache-Control")||"");if(ad["no-store"])return;ad["max-age"]&&jh.headers.set("Expires",new Date(Dh+1e3*ad["max-age"]).toUTCString());const nd=jh.headers.get("Expires");nd&&(new Date(nd).getTime()-Dh<42e4||function(Bd,Rd){if(Xf===void 0)try{new Response(new ReadableStream),Xf=!0}catch{Xf=!1}Xf?Rd(Bd.body):Bd.blob().then(Rd)}(Xh,Bd=>{const Rd=new x.Response(Bd,jh);jf(),If&&If.then(bf=>bf.put(Ap(Ph.url),Rd)).catch(bf=>Vd(bf.message))}))}(q,Ku,rh),St=!0,M(null,vh,$u.headers.get("Cache-Control"),$u.headers.get("Expires")))}).catch(vh=>{Ht||M(new Error(vh.message))})};return Ui?function($u,Ku){if(jf(),!If)return Ku(null);const rh=Ap($u.url);If.then(vh=>{vh.match(rh).then(Ph=>{const Xh=function(Dh){if(!Dh)return!1;const jh=new Date(Dh.headers.get("Expires")||0),ad=Kh(Dh.headers.get("Cache-Control")||"");return jh>Date.now()&&!ad["no-cache"]}(Ph);vh.delete(rh),Xh&&vh.put(rh,Ph.clone()),Ku(null,Ph,Xh)}).catch(Ku)}).catch(Ku)}(q,ls):ls(null,null),{cancel:()=>{Ht=!0,St||N.abort()}}}(c,l);if(lp()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,l,void 0,!0)}var d;return function(y,M){const N=new x.XMLHttpRequest;N.open(y.method||"GET",y.url,!0),y.type==="arrayBuffer"&&(N.responseType="arraybuffer");for(const q in y.headers)N.setRequestHeader(q,y.headers[q]);return y.type==="json"&&(N.responseType="text",N.setRequestHeader("Accept","application/json")),N.withCredentials=y.credentials==="include",N.onerror=()=>{M(new Error(N.statusText))},N.onload=()=>{if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let q=N.response;if(y.type==="json")try{q=JSON.parse(N.response)}catch(St){return M(St)}M(null,q,N.getResponseHeader("Cache-Control"),N.getResponseHeader("Expires"))}else M(new Zf(N.statusText,N.status,y.url))},N.send(y.body),{cancel:()=>N.abort()}}(c,l)},Wd=function(c,l){return sm(xd(c,{type:"arrayBuffer"}),l)};function $p(c){const l=x.document.createElement("a");return l.href=c,l.protocol===x.document.location.protocol&&l.host===x.document.location.host}const Lh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let lh,ih;lh=[],ih=0;const Ah=function(c,l){if(nt.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),ih>=ge.MAX_PARALLEL_IMAGE_REQUESTS){const N={requestParameters:c,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return lh.push(N),N}ih++;let d=!1;const y=()=>{if(!d)for(d=!0,ih--;lh.length&&ih<ge.MAX_PARALLEL_IMAGE_REQUESTS;){const N=lh.shift(),{requestParameters:q,callback:St,cancelled:Ht}=N;Ht||(N.cancel=Ah(q,St).cancel)}},M=Wd(c,(N,q,St,Ht)=>{y(),N?l(N):q&&(x.createImageBitmap?function(Ui,Bn){const ls=new x.Blob([new Uint8Array(Ui)],{type:"image/png"});x.createImageBitmap(ls).then(il=>{Bn(null,il)}).catch(il=>{Bn(new Error(`Could not load image because of ${il.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(q,(Ui,Bn)=>l(Ui,Bn,St,Ht)):function(Ui,Bn){const ls=new x.Image,il=x.URL;ls.onload=()=>{Bn(null,ls),il.revokeObjectURL(ls.src),ls.onload=null,x.requestAnimationFrame(()=>{ls.src=Lh})},ls.onerror=()=>Bn(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $u=new x.Blob([new Uint8Array(Ui)],{type:"image/png"});ls.src=Ui.byteLength?il.createObjectURL($u):Lh}(q,(Ui,Bn)=>l(Ui,Bn,St,Ht)))});return{cancel:()=>{M.cancel(),y()}}},zh="NO_ACCESS_TOKEN";function Qh(c){return c.indexOf("mapbox:")===0}function Th(c){return ge.API_URL_REGEX.test(c)}function Fh(c){return ge.API_CDN_URL_REGEX.test(c)}function al(c){return ge.API_STYLE_REGEX.test(c)&&!fh(c)}function fh(c){return ge.API_SPRITE_REGEX.test(c)}const nl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zs(c){const l=c.match(nl);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function ol(c){const l=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${l}`}const sh="mapbox.eventData";function xh(c){if(!c)return null;const l=c.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(decodeURIComponent(x.atob(l[1]).split("").map(d=>"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Mh{constructor(l){this.type=l,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const d=xh(ge.ACCESS_TOKEN);let y="";return y=d&&d.u?x.btoa(encodeURIComponent(d.u).replace(/%([0-9A-F]{2})/g,(M,N)=>String.fromCharCode(+("0x"+N)))):ge.ACCESS_TOKEN||"",l?`${sh}.${l}:${y}`:`${sh}:${y}`}fetchEventData(){const l=Jd("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid");if(l)try{const M=x.localStorage.getItem(d);M&&(this.eventData=JSON.parse(M));const N=x.localStorage.getItem(y);N&&(this.anonId=N)}catch{Vd("Unable to read from LocalStorage")}}saveEventData(){const l=Jd("localStorage"),d=this.getStorageKey(),y=this.getStorageKey("uuid");if(l)try{x.localStorage.setItem(y,this.anonId),Object.keys(this.eventData).length>=1&&x.localStorage.setItem(d,JSON.stringify(this.eventData))}catch{Vd("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,d,y,M){if(!ge.EVENTS_URL)return;const N=Zs(ge.EVENTS_URL);N.params.push(`access_token=${M||ge.ACCESS_TOKEN||""}`);const q={event:this.type,created:new Date(l).toISOString()},St=d?xd(q,d):q,Ht={url:ol(N),headers:{"Content-Type":"text/plain"},body:JSON.stringify([St])};this.pendingRequest=function(Ui,Bn){return sm(xd(Ui,{method:"POST"}),Bn)}(Ht,Ui=>{this.pendingRequest=null,y(Ui),this.saveEventData(),this.processRequests(M)})}queueRequest(l,d){this.queue.push(l),this.processRequests(d)}}const Uh=new class extends Mh{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,l){ge.EVENTS_URL&&ge.ACCESS_TOKEN&&Array.isArray(c)&&c.some(d=>Qh(d)||Th(d))&&this.queueRequest(Date.now(),l)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=xh(ge.ACCESS_TOKEN),d=l?l.u:ge.ACCESS_TOKEN;let y=d!==this.eventData.tokenU;wf(this.anonId)||(this.anonId=Ld(),y=!0);const M=this.queue.shift();if(this.eventData.lastSuccess){const N=new Date(this.eventData.lastSuccess),q=new Date(M),St=(M-this.eventData.lastSuccess)/864e5;y=y||St>=1||St<-1||N.getDate()!==q.getDate()}else y=!0;y?this.postEvent(M,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:tl,"enabled.telemetry":!1,userId:this.anonId},N=>{N||(this.eventData.lastSuccess=M,this.eventData.tokenU=d)},c):this.processRequests()}},Nh=Uh.postTurnstileEvent.bind(Uh),Zh=new class extends Mh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,l,d,y){this.skuToken=l,this.errorCb=y,ge.EVENTS_URL&&(d||ge.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},d):this.errorCb(new Error(zh)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:d}=this.queue.shift();l&&this.success[l]||(this.anonId||this.fetchEventData(),wf(this.anonId)||(this.anonId=Ld()),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:tl,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):l&&(this.success[l]=!0)},c))}},td=Zh.postMapLoadEvent.bind(Zh),Ad=new class extends Mh{constructor(){super("gljs.performance")}postPerformanceEvent(c,l){ge.EVENTS_URL&&(c||ge.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:l},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,performanceData:d}=this.queue.shift(),y=function(M){const N=x.performance.getEntriesByType("resource"),q=x.performance.getEntriesByType("mark"),St=function(il){const $u={};if(il){for(const Ku in il)if(Ku!=="other")for(const rh of il[Ku]){const vh=`${Ku}ResolveRangeMin`,Ph=`${Ku}ResolveRangeMax`,Xh=`${Ku}RequestCount`,Dh=`${Ku}RequestCachedCount`;$u[vh]=Math.min($u[vh]||1/0,rh.startTime),$u[Ph]=Math.max($u[Ph]||-1/0,rh.responseEnd);const jh=ad=>{$u[ad]===void 0&&($u[ad]=0),++$u[ad]};rh.transferSize!==void 0&&rh.transferSize===0&&jh(Dh),jh(Xh)}}return $u}(function(il,$u){const Ku={};if(il)for(const rh of il){const vh=$u(rh);Ku[vh]===void 0&&(Ku[vh]=[]),Ku[vh].push(rh)}return Ku}(N,Hp)),Ht=x.devicePixelRatio,Ui=x.navigator.connection||x.navigator.mozConnection||x.navigator.webkitConnection,Bn={counters:[],metadata:[],attributes:[]},ls=(il,$u,Ku)=>{Ku!=null&&il.push({name:$u,value:Ku.toString()})};for(const il in St)ls(Bn.counters,il,St[il]);if(M.interactionRange[0]!==1/0&&M.interactionRange[1]!==-1/0&&(ls(Bn.counters,"interactionRangeMin",M.interactionRange[0]),ls(Bn.counters,"interactionRangeMax",M.interactionRange[1])),q)for(const il of Object.keys(ap)){const $u=ap[il],Ku=q.find(rh=>rh.name===$u);Ku&&ls(Bn.counters,$u,Ku.startTime)}return ls(Bn.counters,"visibilityHidden",M.visibilityHidden),ls(Bn.attributes,"style",function(il){if(il)for(const $u of il){const Ku=$u.name.split("?")[0];if(al(Ku)){const rh=Ku.split("/").slice(-2);if(rh.length===2)return`mapbox://styles/${rh[0]}/${rh[1]}`}}}(N)),ls(Bn.attributes,"terrainEnabled",M.terrainEnabled?"true":"false"),ls(Bn.attributes,"fogEnabled",M.fogEnabled?"true":"false"),ls(Bn.attributes,"projection",M.projection),ls(Bn.attributes,"zoom",M.zoom),ls(Bn.metadata,"devicePixelRatio",Ht),ls(Bn.metadata,"connectionEffectiveType",Ui?Ui.effectiveType:void 0),ls(Bn.metadata,"navigatorUserAgent",x.navigator.userAgent),ls(Bn.metadata,"screenWidth",x.screen.width),ls(Bn.metadata,"screenHeight",x.screen.height),ls(Bn.metadata,"windowWidth",x.innerWidth),ls(Bn.metadata,"windowHeight",x.innerHeight),ls(Bn.metadata,"mapWidth",M.width/Ht),ls(Bn.metadata,"mapHeight",M.height/Ht),ls(Bn.metadata,"webglRenderer",M.renderer),ls(Bn.metadata,"webglVendor",M.vendor),ls(Bn.metadata,"sdkVersion",C),ls(Bn.metadata,"sdkIdentifier","mapbox-gl-js"),Bn}(d);for(const M of y.metadata);for(const M of y.counters);for(const M of y.attributes);this.postEvent(l,y,()=>{},c)}},Zd=Ad.postPerformanceEvent.bind(Ad),Fd=new class extends Mh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,l,d,y){if(!ge.API_URL||!ge.SESSION_PATH)return;const M=Zs(ge.API_URL+ge.SESSION_PATH);M.params.push(`sku=${l||""}`),M.params.push(`access_token=${y||ge.ACCESS_TOKEN||""}`);const N={url:ol(M),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(q,St){return sm(xd(q,{method:"GET"}),St)}(N,q=>{this.pendingRequest=null,d(q),this.saveEventData(),this.processRequests(y)})}getSessionAPI(c,l,d,y){this.skuToken=l,this.errorCb=y,ge.SESSION_PATH&&ge.API_URL&&(d||ge.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},d):this.errorCb(new Error(zh)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:d}=this.queue.shift();l&&this.success[l]||this.getSession(d,this.skuToken,y=>{y?this.errorCb(y):l&&(this.success[l]=!0)},c)}},Kf=Fd.getSessionAPI.bind(Fd),up=new Set,ap={create:"create",load:"load",fullLoad:"fullLoad"},wp={mark(c){x.performance.mark(c)},measure(c,l,d){x.performance.measure(c,l,d)}};function Hp(c){const l=c.name.split("?")[0];return Fh(l)&&l.includes("mapbox-gl.js")?"javascript":Fh(l)&&l.includes("mapbox-gl.css")?"css":function(d){return ge.API_FONTS_REGEX.test(d)}(l)?"fontRange":fh(l)?"sprite":al(l)?"style":function(d){return ge.API_TILEJSON_REGEX.test(d)}(l)?"tilejson":"other"}const Ip=x.performance;function Gh(c){const l=c?c.url.toString():void 0;return Ip.getEntriesByName(l)}let Nf,Hf,mp,Bp;const zp={now:()=>mp!==void 0?mp:x.performance.now(),setNow(c){mp=c},restoreNow(){mp=void 0},frame(c){const l=x.requestAnimationFrame(c);return{cancel:()=>x.cancelAnimationFrame(l)}},getImageData(c,l=0){const{width:d,height:y}=c;Bp||(Bp=x.document.createElement("canvas"));const M=Bp.getContext("2d",{willReadFrequently:!0});if(!M)throw new Error("failed to create canvas 2d context");return(d>Bp.width||y>Bp.height)&&(Bp.width=d,Bp.height=y),M.clearRect(-l,-l,d+2*l,y+2*l),M.drawImage(c,0,0,d,y),M.getImageData(-l,-l,d+2*l,y+2*l)},resolveURL:c=>(Nf||(Nf=x.document.createElement("a")),Nf.href=c,Nf.href),get devicePixelRatio(){return x.devicePixelRatio},get prefersReducedMotion(){return!!x.matchMedia&&(Hf==null&&(Hf=x.matchMedia("(prefers-reduced-motion: reduce)")),Hf.matches)}};function um(c,l,d){d[c]&&d[c].indexOf(l)!==-1||(d[c]=d[c]||[],d[c].push(l))}function Nm(c,l,d){if(d&&d[c]){const y=d[c].indexOf(l);y!==-1&&d[c].splice(y,1)}}class a_{constructor(l,d={}){xd(this,d),this.type=l}}class Ug extends a_{constructor(l,d={}){super("error",xd({error:l},d))}}class by{on(l,d){return this._listeners=this._listeners||{},um(l,d,this._listeners),this}off(l,d){return Nm(l,d,this._listeners),Nm(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},um(l,d,this._oneTimeListeners),this):new Promise(y=>this.once(l,y))}fire(l,d){typeof l=="string"&&(l=new a_(l,d||{}));const y=l.type;if(this.listens(y)){l.target=this;const M=this._listeners&&this._listeners[y]?this._listeners[y].slice():[];for(const St of M)St.call(this,l);const N=this._oneTimeListeners&&this._oneTimeListeners[y]?this._oneTimeListeners[y].slice():[];for(const St of N)Nm(y,St,this._oneTimeListeners),St.call(this,l);const q=this._eventedParent;q&&(xd(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),q.fire(l))}else l instanceof Ug&&console.error(l.error);return this}listens(l){return!!(this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l))}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var Yd=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Mg(c,...l){for(const d of l)for(const y in d)c[y]=d[y];return c}function km(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function sg(c){if(Array.isArray(c))return c.map(sg);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const l={};for(const d in c)l[d]=sg(c[d]);return l}return km(c)}class wy extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}var p_=wy;class a0{constructor(l,d=[]){this.parent=l,this.bindings={};for(const[y,M]of d)this.bindings[y]=M}concat(l){return new a0(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}var s0=a0;const mm={kind:"null"},yr={kind:"number"},Js={kind:"string"},uh={kind:"boolean"},Vh={kind:"color"},od={kind:"object"},Wh={kind:"value"},pd={kind:"collator"},$f={kind:"formatted"},Tf={kind:"resolvedImage"};function rp(c,l){return{kind:"array",itemType:c,N:l}}function Gf(c){if(c.kind==="array"){const l=Gf(c.itemType);return typeof c.N=="number"?`array<${l}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${l}>`}return c.kind}const op=[mm,yr,Js,uh,Vh,$f,od,rp(Wh),Tf];function Vp(c,l){if(l.kind==="error")return null;if(c.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Vp(c.itemType,l.itemType))&&(typeof c.N!="number"||c.N===l.N))return null}else{if(c.kind===l.kind)return null;if(c.kind==="value"){for(const d of op)if(!Vp(d,l))return null}}return`Expected ${Gf(c)} but found ${Gf(l)} instead.`}function Sm(c,l){return l.some(d=>d.kind===c.kind)}function Xp(c,l){return l.some(d=>d==="null"?c===null:d==="array"?Array.isArray(c):d==="object"?c&&!Array.isArray(c)&&typeof c=="object":d===typeof c)}var Dm,Mf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Cp(c){return(c=Math.round(c))<0?0:c>255?255:c}function Kp(c){return Cp(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function Ym(c){return(l=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:l>1?1:l;var l}function Mm(c,l,d){return d<0?d+=1:d>1&&(d-=1),6*d<1?c+(l-c)*d*6:2*d<1?l:3*d<2?c+(l-c)*(2/3-d)*6:c}try{Dm={}.parseCSSColor=function(c){var l,d=c.replace(/ /g,"").toLowerCase();if(d in Mf)return Mf[d].slice();if(d[0]==="#")return d.length===4?(l=parseInt(d.substr(1),16))>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null:d.length===7&&(l=parseInt(d.substr(1),16))>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null;var y=d.indexOf("("),M=d.indexOf(")");if(y!==-1&&M+1===d.length){var N=d.substr(0,y),q=d.substr(y+1,M-(y+1)).split(","),St=1;switch(N){case"rgba":if(q.length!==4)return null;St=Ym(q.pop());case"rgb":return q.length!==3?null:[Kp(q[0]),Kp(q[1]),Kp(q[2]),St];case"hsla":if(q.length!==4)return null;St=Ym(q.pop());case"hsl":if(q.length!==3)return null;var Ht=(parseFloat(q[0])%360+360)%360/360,Ui=Ym(q[1]),Bn=Ym(q[2]),ls=Bn<=.5?Bn*(Ui+1):Bn+Ui-Bn*Ui,il=2*Bn-ls;return[Cp(255*Mm(il,ls,Ht+1/3)),Cp(255*Mm(il,ls,Ht)),Cp(255*Mm(il,ls,Ht-1/3)),St];default:return null}}return null}}catch{}class lg{constructor(l,d,y,M=1){this.r=l,this.g=d,this.b=y,this.a=M}static parse(l){if(!l)return;if(l instanceof lg)return l;if(typeof l!="string")return;const d=Dm(l);return d?new lg(d[0]/255*d[3],d[1]/255*d[3],d[2]/255*d[3],d[3]):void 0}toString(){const[l,d,y,M]=this.toArray();return`rgba(${Math.round(l)},${Math.round(d)},${Math.round(y)},${M})`}toArray(){const{r:l,g:d,b:y,a:M}=this;return M===0?[0,0,0,0]:[255*l/M,255*d/M,255*y/M,M]}toArray01(){const{r:l,g:d,b:y,a:M}=this;return M===0?[0,0,0,0]:[l/M,d/M,y/M,M]}toArray01PremultipliedAlpha(){const{r:l,g:d,b:y,a:M}=this;return[l,d,y,M]}}lg.black=new lg(0,0,0,1),lg.white=new lg(1,1,1,1),lg.transparent=new lg(0,0,0,0),lg.red=new lg(1,0,0,1),lg.blue=new lg(0,0,1,1);var jm=lg;class Tm{constructor(l,d,y){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=y,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Uy{constructor(l,d,y,M,N){this.text=l.normalize?l.normalize():l,this.image=d,this.scale=y,this.fontStack=M,this.textColor=N}}class vg{constructor(l){this.sections=l}static fromString(l){return new vg([new Uy(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof vg?l:vg.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}serialize(){const l=["format"];for(const d of this.sections){if(d.image){l.push(["image",d.image.name]);continue}l.push(d.text);const y={};d.fontStack&&(y["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(y["font-scale"]=d.scale),d.textColor&&(y["text-color"]=["rgba"].concat(d.textColor.toArray())),l.push(y)}return l}}class ng{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new ng({name:l,available:!1}):null}serialize(){return["image",this.name]}}function l0(c,l,d,y){return typeof c=="number"&&c>=0&&c<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?y===void 0||typeof y=="number"&&y>=0&&y<=1?null:`Invalid rgba value [${[c,l,d,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof y=="number"?[c,l,d,y]:[c,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vy(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof jm||c instanceof Tm||c instanceof vg||c instanceof ng)return!0;if(Array.isArray(c)){for(const l of c)if(!Vy(l))return!1;return!0}if(typeof c=="object"){for(const l in c)if(!Vy(c[l]))return!1;return!0}return!1}function zm(c){if(c===null)return mm;if(typeof c=="string")return Js;if(typeof c=="boolean")return uh;if(typeof c=="number")return yr;if(c instanceof jm)return Vh;if(c instanceof Tm)return pd;if(c instanceof vg)return $f;if(c instanceof ng)return Tf;if(Array.isArray(c)){const l=c.length;let d;for(const y of c){const M=zm(y);if(d){if(d===M)continue;d=Wh;break}d=M}return rp(d||Wh,l)}return od}function s_(c){const l=typeof c;return c===null?"":l==="string"||l==="number"||l==="boolean"?String(c):c instanceof jm||c instanceof vg||c instanceof ng?c.toString():JSON.stringify(c)}class j0{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Vy(l[1]))return d.error("invalid value");const y=l[1];let M=zm(y);const N=d.expectedType;return M.kind!=="array"||M.N!==0||!N||N.kind!=="array"||typeof N.N=="number"&&N.N!==0||(M=N),new j0(M,y)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof jm?["rgba"].concat(this.value.toArray()):this.value instanceof vg?this.value.serialize():this.value}}var Ey=j0,xg=class{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}};const q0={string:Js,number:yr,boolean:uh,object:od};class fv{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let y,M=1;const N=l[0];if(N==="array"){let St,Ht;if(l.length>2){const Ui=l[1];if(typeof Ui!="string"||!(Ui in q0)||Ui==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);St=q0[Ui],M++}else St=Wh;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);Ht=l[2],M++}y=rp(St,Ht)}else y=q0[N];const q=[];for(;M<l.length;M++){const St=d.parse(l[M],M,Wh);if(!St)return null;q.push(St)}return new fv(y,q)}evaluate(l){for(let d=0;d<this.args.length;d++){const y=this.args[d].evaluate(l);if(!Vp(this.type,zm(y)))return y;if(d===this.args.length-1)throw new xg(`Expected value to be of type ${Gf(this.type)}, but found ${Gf(zm(y))} instead.`)}return null}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=this.type,d=[l.kind];if(l.kind==="array"){const y=l.itemType;if(y.kind==="string"||y.kind==="number"||y.kind==="boolean"){d.push(y.kind);const M=l.N;(typeof M=="number"||this.args.length>1)&&d.push(M)}}return d.concat(this.args.map(y=>y.serialize()))}}var G_=fv;class P_{constructor(l){this.type=$f,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const y=l[1];if(!Array.isArray(y)&&typeof y=="object")return d.error("First argument must be an image or text section.");const M=[];let N=!1;for(let q=1;q<=l.length-1;++q){const St=l[q];if(N&&typeof St=="object"&&!Array.isArray(St)){N=!1;let Ht=null;if(St["font-scale"]&&(Ht=d.parse(St["font-scale"],1,yr),!Ht))return null;let Ui=null;if(St["text-font"]&&(Ui=d.parse(St["text-font"],1,rp(Js)),!Ui))return null;let Bn=null;if(St["text-color"]&&(Bn=d.parse(St["text-color"],1,Vh),!Bn))return null;const ls=M[M.length-1];ls.scale=Ht,ls.font=Ui,ls.textColor=Bn}else{const Ht=d.parse(l[q],1,Wh);if(!Ht)return null;const Ui=Ht.type.kind;if(Ui!=="string"&&Ui!=="value"&&Ui!=="null"&&Ui!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");N=!0,M.push({content:Ht,scale:null,font:null,textColor:null})}}return new P_(M)}evaluate(l){return new vg(this.sections.map(d=>{const y=d.content.evaluate(l);return zm(y)===Tf?new Uy("",y,null,null,null):new Uy(s_(y),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null)}))}eachChild(l){for(const d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor)}outputDefined(){return!1}serialize(){const l=["format"];for(const d of this.sections){l.push(d.content.serialize());const y={};d.scale&&(y["font-scale"]=d.scale.serialize()),d.font&&(y["text-font"]=d.font.serialize()),d.textColor&&(y["text-color"]=d.textColor.serialize()),l.push(y)}return l}}class Sy{constructor(l){this.type=Tf,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");const y=d.parse(l[1],1,Js);return y?new Sy(y):d.error("No image name provided.")}evaluate(l){const d=this.input.evaluate(l),y=ng.fromString(d);return y&&l.availableImages&&(y.available=l.availableImages.indexOf(d)>-1),y}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const pv={"to-boolean":uh,"to-color":Vh,"to-number":yr,"to-string":Js};class S0{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const y=l[0];if((y==="to-boolean"||y==="to-string")&&l.length!==2)return d.error("Expected one argument.");const M=pv[y],N=[];for(let q=1;q<l.length;q++){const St=d.parse(l[q],q,Wh);if(!St)return null;N.push(St)}return new S0(M,N)}evaluate(l){if(this.type.kind==="boolean")return!!this.args[0].evaluate(l);if(this.type.kind==="color"){let d,y;for(const M of this.args){if(d=M.evaluate(l),y=null,d instanceof jm)return d;if(typeof d=="string"){const N=l.parseColor(d);if(N)return N}else if(Array.isArray(d)&&(y=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:l0(d[0],d[1],d[2],d[3]),!y))return new jm(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new xg(y||`Could not parse color from value '${typeof d=="string"?d:String(JSON.stringify(d))}'`)}if(this.type.kind==="number"){let d=null;for(const y of this.args){if(d=y.evaluate(l),d===null)return 0;const M=Number(d);if(!isNaN(M))return M}throw new xg(`Could not convert ${JSON.stringify(d)} to number.`)}return this.type.kind==="formatted"?vg.fromString(s_(this.args[0].evaluate(l))):this.type.kind==="resolvedImage"?ng.fromString(s_(this.args[0].evaluate(l))):s_(this.args[0].evaluate(l))}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){if(this.type.kind==="formatted")return new P_([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Sy(this.args[0]).serialize();const l=[`to-${this.type.kind}`];return this.eachChild(d=>{l.push(d.serialize())}),l}}var Jg=S0;const Wp=["Unknown","Point","LineString","Polygon"];var T0=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:d,y}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*l-c[0])+this.featureDistanceData.bearing[1]*(y*l-c[1])}return 0}parseColor(c){let l=this._parseColorCache[c];return l||(l=this._parseColorCache[c]=jm.parse(c)),l}};class bg{constructor(l,d,y,M){this.name=l,this.type=d,this._evaluate=y,this.args=M}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(l=>l.serialize()))}static parse(l,d){const y=l[0],M=bg.definitions[y];if(!M)return d.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0);const N=Array.isArray(M)?M[0]:M.type,q=Array.isArray(M)?[[M[1],M[2]]]:M.overloads,St=q.filter(([Ui])=>!Array.isArray(Ui)||Ui.length===l.length-1);let Ht=null;for(const[Ui,Bn]of St){Ht=new g_(d.registry,d.path,null,d.scope);const ls=[];let il=!1;for(let $u=1;$u<l.length;$u++){const Ku=l[$u],rh=Array.isArray(Ui)?Ui[$u-1]:Ui.type,vh=Ht.parse(Ku,1+ls.length,rh);if(!vh){il=!0;break}ls.push(vh)}if(!il)if(Array.isArray(Ui)&&Ui.length!==ls.length)Ht.error(`Expected ${Ui.length} arguments, but found ${ls.length} instead.`);else{for(let $u=0;$u<ls.length;$u++){const Ku=Array.isArray(Ui)?Ui[$u]:Ui.type,rh=ls[$u];Ht.concat($u+1).checkSubtype(Ku,rh.type)}if(Ht.errors.length===0)return new bg(y,N,Bn,ls)}}if(St.length===1)d.errors.push(...Ht.errors);else{const Ui=(St.length?St:q).map(([ls])=>{return il=ls,Array.isArray(il)?`(${il.map(Gf).join(", ")})`:`(${Gf(il.type)}...)`;var il}).join(" | "),Bn=[];for(let ls=1;ls<l.length;ls++){const il=d.parse(l[ls],1+Bn.length);if(!il)return null;Bn.push(Gf(il.type))}d.error(`Expected arguments of type ${Ui}, but found (${Bn.join(", ")}) instead.`)}return null}static register(l,d){bg.definitions=d;for(const y in d)l[y]=bg}}var Rg=bg;class jy{constructor(l,d,y){this.type=pd,this.locale=y,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");const y=l[1];if(typeof y!="object"||Array.isArray(y))return d.error("Collator options argument must be an object.");const M=d.parse(y["case-sensitive"]!==void 0&&y["case-sensitive"],1,uh);if(!M)return null;const N=d.parse(y["diacritic-sensitive"]!==void 0&&y["diacritic-sensitive"],1,uh);if(!N)return null;let q=null;return y.locale&&(q=d.parse(y.locale,1,Js),!q)?null:new jy(M,N,q)}evaluate(l){return new Tm(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}serialize(){const l={};return l["case-sensitive"]=this.caseSensitive.serialize(),l["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(l.locale=this.locale.serialize()),["collator",l]}}const Qg=8192;function j_(c,l){c[0]=Math.min(c[0],l[0]),c[1]=Math.min(c[1],l[1]),c[2]=Math.max(c[2],l[0]),c[3]=Math.max(c[3],l[1])}function q_(c,l){return!(c[0]<=l[0]||c[2]>=l[2]||c[1]<=l[1]||c[3]>=l[3])}function Ty(c,l){const d=(180+c[0])/360,y=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,M=Math.pow(2,l.z);return[Math.round(d*M*Qg),Math.round(y*M*Qg)]}function gm(c,l,d){const y=c[0]-l[0],M=c[1]-l[1],N=c[0]-d[0],q=c[1]-d[1];return y*q-N*M==0&&y*N<=0&&M*q<=0}function qy(c,l){let d=!1;for(let q=0,St=l.length;q<St;q++){const Ht=l[q];for(let Ui=0,Bn=Ht.length;Ui<Bn-1;Ui++){if(gm(c,Ht[Ui],Ht[Ui+1]))return!1;(M=Ht[Ui])[1]>(y=c)[1]!=(N=Ht[Ui+1])[1]>y[1]&&y[0]<(N[0]-M[0])*(y[1]-M[1])/(N[1]-M[1])+M[0]&&(d=!d)}}var y,M,N;return d}function cy(c,l){for(let d=0;d<l.length;d++)if(qy(c,l[d]))return!0;return!1}function I0(c,l,d,y){const M=y[0]-d[0],N=y[1]-d[1],q=(c[0]-d[0])*N-M*(c[1]-d[1]),St=(l[0]-d[0])*N-M*(l[1]-d[1]);return q>0&&St<0||q<0&&St>0}function Z_(c,l,d){for(const Ui of d)for(let Bn=0;Bn<Ui.length-1;++Bn)if((St=[(q=Ui[Bn+1])[0]-(N=Ui[Bn])[0],q[1]-N[1]])[0]*(Ht=[(M=l)[0]-(y=c)[0],M[1]-y[1]])[1]-St[1]*Ht[0]!=0&&I0(y,M,N,q)&&I0(N,q,y,M))return!0;var y,M,N,q,St,Ht;return!1}function fm(c,l){for(let d=0;d<c.length;++d)if(!qy(c[d],l))return!1;for(let d=0;d<c.length-1;++d)if(Z_(c[d],c[d+1],l))return!1;return!0}function mv(c,l){for(let d=0;d<l.length;d++)if(fm(c,l[d]))return!0;return!1}function Iy(c,l,d){const y=[];for(let M=0;M<c.length;M++){const N=[];for(let q=0;q<c[M].length;q++){const St=Ty(c[M][q],d);j_(l,St),N.push(St)}y.push(N)}return y}function Z0(c,l,d){const y=[];for(let M=0;M<c.length;M++){const N=Iy(c[M],l,d);y.push(N)}return y}function Zy(c,l,d,y){if(c[0]<d[0]||c[0]>d[2]){const M=.5*y;let N=c[0]-d[0]>M?-y:d[0]-c[0]>M?y:0;N===0&&(N=c[0]-d[2]>M?-y:d[2]-c[0]>M?y:0),c[0]+=N}j_(l,c)}function Hy(c,l,d,y){const M=Math.pow(2,y.z)*Qg,N=[y.x*Qg,y.y*Qg],q=[];if(!c)return q;for(const St of c)for(const Ht of St){const Ui=[Ht.x+N[0],Ht.y+N[1]];Zy(Ui,l,d,M),q.push(Ui)}return q}function H_(c,l,d,y){const M=Math.pow(2,y.z)*Qg,N=[y.x*Qg,y.y*Qg],q=[];if(!c)return q;for(const Ht of c){const Ui=[];for(const Bn of Ht){const ls=[Bn.x+N[0],Bn.y+N[1]];j_(l,ls),Ui.push(ls)}q.push(Ui)}if(l[2]-l[0]<=M/2){(St=l)[0]=St[1]=1/0,St[2]=St[3]=-1/0;for(const Ht of q)for(const Ui of Ht)Zy(Ui,l,d,M)}var St;return q}class Cy{constructor(l,d){this.type=uh,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Vy(l[1])){const y=l[1];if(y.type==="FeatureCollection")for(let M=0;M<y.features.length;++M){const N=y.features[M].geometry.type;if(N==="Polygon"||N==="MultiPolygon")return new Cy(y,y.features[M].geometry)}else if(y.type==="Feature"){const M=y.geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new Cy(y,y.geometry)}else if(y.type==="Polygon"||y.type==="MultiPolygon")return new Cy(y,y)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,y){const M=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],q=d.canonicalID();if(!q)return!1;if(y.type==="Polygon"){const St=Iy(y.coordinates,N,q),Ht=Hy(d.geometry(),M,N,q);if(!q_(M,N))return!1;for(const Ui of Ht)if(!qy(Ui,St))return!1}if(y.type==="MultiPolygon"){const St=Z0(y.coordinates,N,q),Ht=Hy(d.geometry(),M,N,q);if(!q_(M,N))return!1;for(const Ui of Ht)if(!cy(Ui,St))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,y){const M=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],q=d.canonicalID();if(!q)return!1;if(y.type==="Polygon"){const St=Iy(y.coordinates,N,q),Ht=H_(d.geometry(),M,N,q);if(!q_(M,N))return!1;for(const Ui of Ht)if(!fm(Ui,St))return!1}if(y.type==="MultiPolygon"){const St=Z0(y.coordinates,N,q),Ht=H_(d.geometry(),M,N,q);if(!q_(M,N))return!1;for(const Ui of Ht)if(!mv(Ui,St))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var c0=Cy;function Xy(c){if(c instanceof Rg&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof c0)return!1;let l=!0;return c.eachChild(d=>{l&&!Xy(d)&&(l=!1)}),l}function m_(c){if(c instanceof Rg&&c.name==="feature-state")return!1;let l=!0;return c.eachChild(d=>{l&&!m_(d)&&(l=!1)}),l}function X_(c,l){if(c instanceof Rg&&l.indexOf(c.name)>=0)return!1;let d=!0;return c.eachChild(y=>{d&&!X_(y,l)&&(d=!1)}),d}class Og{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const y=l[1];return d.scope.has(y)?new Og(y,d.scope.get(y)):d.error(`Unknown variable "${y}". Make sure "${y}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var C0=Og;class l_{constructor(l,d=[],y,M=new s0,N=[]){this.registry=l,this.path=d,this.key=d.map(q=>`[${q}]`).join(""),this.scope=M,this.errors=N,this.expectedType=y}parse(l,d,y,M,N={}){return d?this.concat(d,y,M)._parse(l,N):this._parse(l,N)}_parse(l,d){function y(M,N,q){return q==="assert"?new G_(N,[M]):q==="coerce"?new Jg(N,[M]):M}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const M=l[0];if(typeof M!="string")return this.error(`Expression name must be a string, but found ${typeof M} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const N=this.registry[M];if(N){let q=N.parse(l,this);if(!q)return null;if(this.expectedType){const St=this.expectedType,Ht=q.type;if(St.kind!=="string"&&St.kind!=="number"&&St.kind!=="boolean"&&St.kind!=="object"&&St.kind!=="array"||Ht.kind!=="value")if(St.kind!=="color"&&St.kind!=="formatted"&&St.kind!=="resolvedImage"||Ht.kind!=="value"&&Ht.kind!=="string"){if(this.checkSubtype(St,Ht))return null}else q=y(q,St,d.typeAnnotation||"coerce");else q=y(q,St,d.typeAnnotation||"assert")}if(!(q instanceof Ey)&&q.type.kind!=="resolvedImage"&&e_(q)){const St=new T0;try{q=new Ey(q.type,q.evaluate(St))}catch(Ht){return this.error(Ht.message),null}}return q}return this.error(`Unknown expression "${M}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,y){const M=typeof l=="number"?this.path.concat(l):this.path,N=y?this.scope.concat(y):this.scope;return new l_(this.registry,M,d||null,N,this.errors)}error(l,...d){const y=`${this.key}${d.map(M=>`[${M}]`).join("")}`;this.errors.push(new p_(y,l))}checkSubtype(l,d){const y=Vp(l,d);return y&&this.error(y),y}}var g_=l_;function e_(c){if(c instanceof C0)return e_(c.boundExpression);if(c instanceof Rg&&c.name==="error"||c instanceof jy||c instanceof c0)return!1;const l=c instanceof Jg||c instanceof G_;let d=!0;return c.eachChild(y=>{d=l?d&&e_(y):d&&y instanceof Ey}),!!d&&Xy(c)&&X_(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function K_(c,l){const d=c.length-1;let y,M,N=0,q=d,St=0;for(;N<=q;)if(St=Math.floor((N+q)/2),y=c[St],M=c[St+1],y<=l){if(St===d||l<M)return St;N=St+1}else{if(!(y>l))throw new xg("Input is not a number.");q=St-1}return 0}class t_{constructor(l,d,y){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(const[M,N]of y)this.labels.push(M),this.outputs.push(N)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");const y=d.parse(l[1],1,yr);if(!y)return null;const M=[];let N=null;d.expectedType&&d.expectedType.kind!=="value"&&(N=d.expectedType);for(let q=1;q<l.length;q+=2){const St=q===1?-1/0:l[q],Ht=l[q+1],Ui=q,Bn=q+1;if(typeof St!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ui);if(M.length&&M[M.length-1][0]>=St)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ui);const ls=d.parse(Ht,Bn,N);if(!ls)return null;N=N||ls.type,M.push([St,ls])}return new t_(N,y,M)}evaluate(l){const d=this.labels,y=this.outputs;if(d.length===1)return y[0].evaluate(l);const M=this.input.evaluate(l);if(M<=d[0])return y[0].evaluate(l);const N=d.length;return M>=d[N-1]?y[N-1].evaluate(l):y[K_(d,M)].evaluate(l)}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){const l=["step",this.input.serialize()];for(let d=0;d<this.labels.length;d++)d>0&&l.push(this.labels[d]),l.push(this.outputs[d].serialize());return l}}var gv=t_;function im(c,l,d){return c*(1-d)+l*d}var uy=Object.freeze({__proto__:null,array:function(c,l,d){return c.map((y,M)=>im(y,l[M],d))},color:function(c,l,d){return new jm(im(c.r,l.r,d),im(c.g,l.g,d),im(c.b,l.b,d),im(c.a,l.a,d))},number:im});const Hm=.95047,Ky=1.08883,lm=4/29,W_=6/29,Am=3*W_*W_,Im=W_*W_*W_,hy=Math.PI/180,My=180/Math.PI;function H0(c){return c>Im?Math.pow(c,1/3):c/Am+lm}function k_(c){return c>W_?c*c*c:Am*(c-lm)}function X0(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function D_(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Y_(c){const l=D_(c.r),d=D_(c.g),y=D_(c.b),M=H0((.4124564*l+.3575761*d+.1804375*y)/Hm),N=H0((.2126729*l+.7151522*d+.072175*y)/1);return{l:116*N-16,a:500*(M-N),b:200*(N-H0((.0193339*l+.119192*d+.9503041*y)/Ky)),alpha:c.a}}function K0(c){let l=(c.l+16)/116,d=isNaN(c.a)?l:l+c.a/500,y=isNaN(c.b)?l:l-c.b/200;return l=1*k_(l),d=Hm*k_(d),y=Ky*k_(y),new jm(X0(3.2404542*d-1.5371385*l-.4985314*y),X0(-.969266*d+1.8760108*l+.041556*y),X0(.0556434*d-.2040259*l+1.0572252*y),c.alpha)}function u0(c,l,d){const y=l-c;return c+d*(y>180||y<-180?y-360*Math.round(y/360):y)}const dy={forward:Y_,reverse:K0,interpolate:function(c,l,d){return{l:im(c.l,l.l,d),a:im(c.a,l.a,d),b:im(c.b,l.b,d),alpha:im(c.alpha,l.alpha,d)}}},J_={forward:function(c){const{l,a:d,b:y}=Y_(c),M=Math.atan2(y,d)*My;return{h:M<0?M+360:M,c:Math.sqrt(d*d+y*y),l,alpha:c.a}},reverse:function(c){const l=c.h*hy,d=c.c;return K0({l:c.l,a:Math.cos(l)*d,b:Math.sin(l)*d,alpha:c.alpha})},interpolate:function(c,l,d){return{h:u0(c.h,l.h,d),c:im(c.c,l.c,d),l:im(c.l,l.l,d),alpha:im(c.alpha,l.alpha,d)}}};var M0=Object.freeze({__proto__:null,hcl:J_,lab:dy});class Wy{constructor(l,d,y,M,N){this.type=l,this.operator=d,this.interpolation=y,this.input=M,this.labels=[],this.outputs=[];for(const[q,St]of N)this.labels.push(q),this.outputs.push(St)}static interpolationFactor(l,d,y,M){let N=0;if(l.name==="exponential")N=L_(d,l.base,y,M);else if(l.name==="linear")N=L_(d,1,y,M);else if(l.name==="cubic-bezier"){const q=l.controlPoints;N=new ah(q[0],q[1],q[2],q[3]).solve(L_(d,1,y,M))}return N}static parse(l,d){let[y,M,N,...q]=l;if(!Array.isArray(M)||M.length===0)return d.error("Expected an interpolation type expression.",1);if(M[0]==="linear")M={name:"linear"};else if(M[0]==="exponential"){const Ui=M[1];if(typeof Ui!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);M={name:"exponential",base:Ui}}else{if(M[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(M[0])}`,1,0);{const Ui=M.slice(1);if(Ui.length!==4||Ui.some(Bn=>typeof Bn!="number"||Bn<0||Bn>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);M={name:"cubic-bezier",controlPoints:Ui}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(N=d.parse(N,2,yr),!N)return null;const St=[];let Ht=null;y==="interpolate-hcl"||y==="interpolate-lab"?Ht=Vh:d.expectedType&&d.expectedType.kind!=="value"&&(Ht=d.expectedType);for(let Ui=0;Ui<q.length;Ui+=2){const Bn=q[Ui],ls=q[Ui+1],il=Ui+3,$u=Ui+4;if(typeof Bn!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',il);if(St.length&&St[St.length-1][0]>=Bn)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',il);const Ku=d.parse(ls,$u,Ht);if(!Ku)return null;Ht=Ht||Ku.type,St.push([Bn,Ku])}return Ht.kind==="number"||Ht.kind==="color"||Ht.kind==="array"&&Ht.itemType.kind==="number"&&typeof Ht.N=="number"?new Wy(Ht,y,M,N,St):d.error(`Type ${Gf(Ht)} is not interpolatable.`)}evaluate(l){const d=this.labels,y=this.outputs;if(d.length===1)return y[0].evaluate(l);const M=this.input.evaluate(l);if(M<=d[0])return y[0].evaluate(l);const N=d.length;if(M>=d[N-1])return y[N-1].evaluate(l);const q=K_(d,M),St=Wy.interpolationFactor(this.interpolation,M,d[q],d[q+1]),Ht=y[q].evaluate(l),Ui=y[q+1].evaluate(l);return this.operator==="interpolate"?uy[this.type.kind.toLowerCase()](Ht,Ui,St):this.operator==="interpolate-hcl"?J_.reverse(J_.interpolate(J_.forward(Ht),J_.forward(Ui),St)):dy.reverse(dy.interpolate(dy.forward(Ht),dy.forward(Ui),St))}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){let l;l=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const d=[this.operator,l,this.input.serialize()];for(let y=0;y<this.labels.length;y++)d.push(this.labels[y],this.outputs[y].serialize());return d}}function L_(c,l,d,y){const M=y-d,N=c-d;return M===0?0:l===1?N/M:(Math.pow(l,N)-1)/(Math.pow(l,M)-1)}var __=Wy;class c_{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expectected at least one argument.");let y=null;const M=d.expectedType;M&&M.kind!=="value"&&(y=M);const N=[];for(const St of l.slice(1)){const Ht=d.parse(St,1+N.length,y,void 0,{typeAnnotation:"omit"});if(!Ht)return null;y=y||Ht.type,N.push(Ht)}const q=M&&N.some(St=>Vp(M,St.type));return new c_(q?Wh:y,N)}evaluate(l){let d,y=null,M=0;for(const N of this.args){if(M++,y=N.evaluate(l),y&&y instanceof ng&&!y.available&&(d||(d=y),y=null,M===this.args.length))return d;if(y!==null)break}return y}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=["coalesce"];return this.eachChild(d=>{l.push(d.serialize())}),l}}var bd=c_;class mf{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const y=[];for(let N=1;N<l.length-1;N+=2){const q=l[N];if(typeof q!="string")return d.error(`Expected string, but found ${typeof q} instead.`,N);if(/[^a-zA-Z0-9_]/.test(q))return d.error("Variable names must contain only alphanumeric characters or '_'.",N);const St=d.parse(l[N+1],N+1);if(!St)return null;y.push([q,St])}const M=d.parse(l[l.length-1],l.length-1,d.expectedType,y);return M?new mf(y,M):null}outputDefined(){return this.result.outputDefined()}serialize(){const l=["let"];for(const[d,y]of this.bindings)l.push(d,y.serialize());return l.push(this.result.serialize()),l}}var np=mf;class Dp{constructor(l,d,y){this.type=l,this.index=d,this.input=y}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,yr),M=d.parse(l[2],2,rp(d.expectedType||Wh));return y&&M?new Dp(M.type.itemType,y,M):null}evaluate(l){const d=this.index.evaluate(l),y=this.input.evaluate(l);if(d<0)throw new xg(`Array index out of bounds: ${d} < 0.`);if(d>=y.length)throw new xg(`Array index out of bounds: ${d} > ${y.length-1}.`);if(d!==Math.floor(d))throw new xg(`Array index must be an integer, but found ${d} instead.`);return y[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Fm=Dp;class om{constructor(l,d){this.type=uh,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,Wh),M=d.parse(l[2],2,Wh);return y&&M?Sm(y.type,[uh,Js,yr,mm,Wh])?new om(y,M):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gf(y.type)} instead`):null}evaluate(l){const d=this.needle.evaluate(l),y=this.haystack.evaluate(l);if(y==null)return!1;if(!Xp(d,["boolean","string","number","null"]))throw new xg(`Expected first argument to be of type boolean, string, number or null, but found ${Gf(zm(d))} instead.`);if(!Xp(y,["string","array"]))throw new xg(`Expected second argument to be of type array or string, but found ${Gf(zm(y))} instead.`);return y.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var qm=om;class Um{constructor(l,d,y){this.type=yr,this.needle=l,this.haystack=d,this.fromIndex=y}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,Wh),M=d.parse(l[2],2,Wh);if(!y||!M)return null;if(!Sm(y.type,[uh,Js,yr,mm,Wh]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gf(y.type)} instead`);if(l.length===4){const N=d.parse(l[3],3,yr);return N?new Um(y,M,N):null}return new Um(y,M)}evaluate(l){const d=this.needle.evaluate(l),y=this.haystack.evaluate(l);if(!Xp(d,["boolean","string","number","null"]))throw new xg(`Expected first argument to be of type boolean, string, number or null, but found ${Gf(zm(d))} instead.`);if(!Xp(y,["string","array"]))throw new xg(`Expected second argument to be of type array or string, but found ${Gf(zm(y))} instead.`);if(this.fromIndex){const M=this.fromIndex.evaluate(l);return y.indexOf(d,M)}return y.indexOf(d)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const l=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),l]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ag=Um;class Pm{constructor(l,d,y,M,N,q){this.inputType=l,this.type=d,this.input=y,this.cases=M,this.outputs=N,this.otherwise=q}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let y,M;d.expectedType&&d.expectedType.kind!=="value"&&(M=d.expectedType);const N={},q=[];for(let Ui=2;Ui<l.length-1;Ui+=2){let Bn=l[Ui];const ls=l[Ui+1];Array.isArray(Bn)||(Bn=[Bn]);const il=d.concat(Ui);if(Bn.length===0)return il.error("Expected at least one branch label.");for(const Ku of Bn){if(typeof Ku!="number"&&typeof Ku!="string")return il.error("Branch labels must be numbers or strings.");if(typeof Ku=="number"&&Math.abs(Ku)>Number.MAX_SAFE_INTEGER)return il.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ku=="number"&&Math.floor(Ku)!==Ku)return il.error("Numeric branch labels must be integer values.");if(y){if(il.checkSubtype(y,zm(Ku)))return null}else y=zm(Ku);if(N[String(Ku)]!==void 0)return il.error("Branch labels must be unique.");N[String(Ku)]=q.length}const $u=d.parse(ls,Ui,M);if(!$u)return null;M=M||$u.type,q.push($u)}const St=d.parse(l[1],1,Wh);if(!St)return null;const Ht=d.parse(l[l.length-1],l.length-1,M);return Ht?St.type.kind!=="value"&&d.concat(1).checkSubtype(y,St.type)?null:new Pm(y,M,St,N,q,Ht):null}evaluate(l){const d=this.input.evaluate(l);return(zm(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["match",this.input.serialize()],d=Object.keys(this.cases).sort(),y=[],M={};for(const q of d){const St=M[this.cases[q]];St===void 0?(M[this.cases[q]]=y.length,y.push([this.cases[q],[q]])):y[St][1].push(q)}const N=q=>this.inputType.kind==="number"?Number(q):q;for(const[q,St]of y)l.push(St.length===1?N(St[0]):St.map(N)),l.push(this.outputs[q].serialize());return l.push(this.otherwise.serialize()),l}}var tp=Pm;class $g{constructor(l,d,y){this.type=l,this.branches=d,this.otherwise=y}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let y;d.expectedType&&d.expectedType.kind!=="value"&&(y=d.expectedType);const M=[];for(let q=1;q<l.length-1;q+=2){const St=d.parse(l[q],q,uh);if(!St)return null;const Ht=d.parse(l[q+1],q+1,y);if(!Ht)return null;M.push([St,Ht]),y=y||Ht.type}const N=d.parse(l[l.length-1],l.length-1,y);return N?new $g(y,M,N):null}evaluate(l){for(const[d,y]of this.branches)if(d.evaluate(l))return y.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[d,y]of this.branches)l(d),l(y);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["case"];return this.eachChild(d=>{l.push(d.serialize())}),l}}var Bg=$g;class Zm{constructor(l,d,y,M){this.type=l,this.input=d,this.beginIndex=y,this.endIndex=M}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const y=d.parse(l[1],1,Wh),M=d.parse(l[2],2,yr);if(!y||!M)return null;if(!Sm(y.type,[rp(Wh),Js,Wh]))return d.error(`Expected first argument to be of type array or string, but found ${Gf(y.type)} instead`);if(l.length===4){const N=d.parse(l[3],3,yr);return N?new Zm(y.type,y,M,N):null}return new Zm(y.type,y,M)}evaluate(l){const d=this.input.evaluate(l),y=this.beginIndex.evaluate(l);if(!Xp(d,["string","array"]))throw new xg(`Expected first argument to be of type array or string, but found ${Gf(zm(d))} instead.`);if(this.endIndex){const M=this.endIndex.evaluate(l);return d.slice(y,M)}return d.slice(y)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const l=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),l]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var R_=Zm;function ip(c,l){return c==="=="||c==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Yy(c,l,d,y){return y.compare(l,d)===0}function O_(c,l,d){const y=c!=="=="&&c!=="!=";return class sS{constructor(N,q,St){this.type=uh,this.lhs=N,this.rhs=q,this.collator=St,this.hasUntypedArgument=N.type.kind==="value"||q.type.kind==="value"}static parse(N,q){if(N.length!==3&&N.length!==4)return q.error("Expected two or three arguments.");const St=N[0];let Ht=q.parse(N[1],1,Wh);if(!Ht)return null;if(!ip(St,Ht.type))return q.concat(1).error(`"${St}" comparisons are not supported for type '${Gf(Ht.type)}'.`);let Ui=q.parse(N[2],2,Wh);if(!Ui)return null;if(!ip(St,Ui.type))return q.concat(2).error(`"${St}" comparisons are not supported for type '${Gf(Ui.type)}'.`);if(Ht.type.kind!==Ui.type.kind&&Ht.type.kind!=="value"&&Ui.type.kind!=="value")return q.error(`Cannot compare types '${Gf(Ht.type)}' and '${Gf(Ui.type)}'.`);y&&(Ht.type.kind==="value"&&Ui.type.kind!=="value"?Ht=new G_(Ui.type,[Ht]):Ht.type.kind!=="value"&&Ui.type.kind==="value"&&(Ui=new G_(Ht.type,[Ui])));let Bn=null;if(N.length===4){if(Ht.type.kind!=="string"&&Ui.type.kind!=="string"&&Ht.type.kind!=="value"&&Ui.type.kind!=="value")return q.error("Cannot use collator to compare non-string types.");if(Bn=q.parse(N[3],3,pd),!Bn)return null}return new sS(Ht,Ui,Bn)}evaluate(N){const q=this.lhs.evaluate(N),St=this.rhs.evaluate(N);if(y&&this.hasUntypedArgument){const Ht=zm(q),Ui=zm(St);if(Ht.kind!==Ui.kind||Ht.kind!=="string"&&Ht.kind!=="number")throw new xg(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${Ht.kind}, ${Ui.kind}) instead.`)}if(this.collator&&!y&&this.hasUntypedArgument){const Ht=zm(q),Ui=zm(St);if(Ht.kind!=="string"||Ui.kind!=="string")return l(N,q,St)}return this.collator?d(N,q,St,this.collator.evaluate(N)):l(N,q,St)}eachChild(N){N(this.lhs),N(this.rhs),this.collator&&N(this.collator)}outputDefined(){return!0}serialize(){const N=[c];return this.eachChild(q=>{N.push(q.serialize())}),N}}}const A0=O_("==",function(c,l,d){return l===d},Yy),W0=O_("!=",function(c,l,d){return l!==d},function(c,l,d,y){return!Yy(0,l,d,y)}),zv=O_("<",function(c,l,d){return l<d},function(c,l,d,y){return y.compare(l,d)<0}),P0=O_(">",function(c,l,d){return l>d},function(c,l,d,y){return y.compare(l,d)>0}),xm=O_("<=",function(c,l,d){return l<=d},function(c,l,d,y){return y.compare(l,d)<=0}),am=O_(">=",function(c,l,d){return l>=d},function(c,l,d,y){return y.compare(l,d)>=0});class y_{constructor(l,d,y,M,N,q){this.type=Js,this.number=l,this.locale=d,this.currency=y,this.unit=M,this.minFractionDigits=N,this.maxFractionDigits=q}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");const y=d.parse(l[1],1,yr);if(!y)return null;const M=l[2];if(typeof M!="object"||Array.isArray(M))return d.error("NumberFormat options argument must be an object.");let N=null;if(M.locale&&(N=d.parse(M.locale,1,Js),!N))return null;let q=null;if(M.currency&&(q=d.parse(M.currency,1,Js),!q))return null;let St=null;if(M.unit&&(St=d.parse(M.unit,1,Js),!St))return null;let Ht=null;if(M["min-fraction-digits"]&&(Ht=d.parse(M["min-fraction-digits"],1,yr),!Ht))return null;let Ui=null;return M["max-fraction-digits"]&&(Ui=d.parse(M["max-fraction-digits"],1,yr),!Ui)?null:new y_(y,N,q,St,Ht,Ui)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(l):void 0,unit:this.unit?this.unit.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.unit&&l(this.unit),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const l={};return this.locale&&(l.locale=this.locale.serialize()),this.currency&&(l.currency=this.currency.serialize()),this.unit&&(l.unit=this.unit.serialize()),this.minFractionDigits&&(l["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(l["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),l]}}class Vg{constructor(l){this.type=yr,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);const y=d.parse(l[1],1);return y?y.type.kind!=="array"&&y.type.kind!=="string"&&y.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${Gf(y.type)} instead.`):new Vg(y):null}evaluate(l){const d=this.input.evaluate(l);if(typeof d=="string"||Array.isArray(d))return d.length;throw new xg(`Expected value to be of type string or array, but found ${Gf(zm(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){const l=["length"];return this.eachChild(d=>{l.push(d.serialize())}),l}}const h0={"==":A0,"!=":W0,">":P0,"<":zv,">=":am,"<=":xm,array:G_,at:Fm,boolean:G_,case:Bg,coalesce:bd,collator:jy,format:P_,image:Sy,in:qm,"index-of":Ag,interpolate:__,"interpolate-hcl":__,"interpolate-lab":__,length:Vg,let:np,literal:Ey,match:tp,number:G_,"number-format":y_,object:G_,slice:R_,step:gv,string:G_,"to-boolean":Jg,"to-color":Jg,"to-number":Jg,"to-string":Jg,var:C0,within:c0};function Gg(c,[l,d,y,M]){l=l.evaluate(c),d=d.evaluate(c),y=y.evaluate(c);const N=M?M.evaluate(c):1,q=l0(l,d,y,N);if(q)throw new xg(q);return new jm(l/255*N,d/255*N,y/255*N,N)}function bm(c,l){return c in l}function cg(c,l){const d=l[c];return d===void 0?null:d}function Pg(c){return{type:c}}Rg.register(h0,{error:[{kind:"error"},[Js],(c,[l])=>{throw new xg(l.evaluate(c))}],typeof:[Js,[Wh],(c,[l])=>Gf(zm(l.evaluate(c)))],"to-rgba":[rp(yr,4),[Vh],(c,[l])=>l.evaluate(c).toArray()],rgb:[Vh,[yr,yr,yr],Gg],rgba:[Vh,[yr,yr,yr,yr],Gg],has:{type:uh,overloads:[[[Js],(c,[l])=>bm(l.evaluate(c),c.properties())],[[Js,od],(c,[l,d])=>bm(l.evaluate(c),d.evaluate(c))]]},get:{type:Wh,overloads:[[[Js],(c,[l])=>cg(l.evaluate(c),c.properties())],[[Js,od],(c,[l,d])=>cg(l.evaluate(c),d.evaluate(c))]]},"feature-state":[Wh,[Js],(c,[l])=>cg(l.evaluate(c),c.featureState||{})],properties:[od,[],c=>c.properties()],"geometry-type":[Js,[],c=>c.geometryType()],id:[Wh,[],c=>c.id()],zoom:[yr,[],c=>c.globals.zoom],pitch:[yr,[],c=>c.globals.pitch||0],"distance-from-center":[yr,[],c=>c.distanceFromCenter()],"heatmap-density":[yr,[],c=>c.globals.heatmapDensity||0],"line-progress":[yr,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[yr,[],c=>c.globals.skyRadialProgress||0],accumulated:[Wh,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[yr,Pg(yr),(c,l)=>{let d=0;for(const y of l)d+=y.evaluate(c);return d}],"*":[yr,Pg(yr),(c,l)=>{let d=1;for(const y of l)d*=y.evaluate(c);return d}],"-":{type:yr,overloads:[[[yr,yr],(c,[l,d])=>l.evaluate(c)-d.evaluate(c)],[[yr],(c,[l])=>-l.evaluate(c)]]},"/":[yr,[yr,yr],(c,[l,d])=>l.evaluate(c)/d.evaluate(c)],"%":[yr,[yr,yr],(c,[l,d])=>l.evaluate(c)%d.evaluate(c)],ln2:[yr,[],()=>Math.LN2],pi:[yr,[],()=>Math.PI],e:[yr,[],()=>Math.E],"^":[yr,[yr,yr],(c,[l,d])=>Math.pow(l.evaluate(c),d.evaluate(c))],sqrt:[yr,[yr],(c,[l])=>Math.sqrt(l.evaluate(c))],log10:[yr,[yr],(c,[l])=>Math.log(l.evaluate(c))/Math.LN10],ln:[yr,[yr],(c,[l])=>Math.log(l.evaluate(c))],log2:[yr,[yr],(c,[l])=>Math.log(l.evaluate(c))/Math.LN2],sin:[yr,[yr],(c,[l])=>Math.sin(l.evaluate(c))],cos:[yr,[yr],(c,[l])=>Math.cos(l.evaluate(c))],tan:[yr,[yr],(c,[l])=>Math.tan(l.evaluate(c))],asin:[yr,[yr],(c,[l])=>Math.asin(l.evaluate(c))],acos:[yr,[yr],(c,[l])=>Math.acos(l.evaluate(c))],atan:[yr,[yr],(c,[l])=>Math.atan(l.evaluate(c))],min:[yr,Pg(yr),(c,l)=>Math.min(...l.map(d=>d.evaluate(c)))],max:[yr,Pg(yr),(c,l)=>Math.max(...l.map(d=>d.evaluate(c)))],abs:[yr,[yr],(c,[l])=>Math.abs(l.evaluate(c))],round:[yr,[yr],(c,[l])=>{const d=l.evaluate(c);return d<0?-Math.round(-d):Math.round(d)}],floor:[yr,[yr],(c,[l])=>Math.floor(l.evaluate(c))],ceil:[yr,[yr],(c,[l])=>Math.ceil(l.evaluate(c))],"filter-==":[uh,[Js,Wh],(c,[l,d])=>c.properties()[l.value]===d.value],"filter-id-==":[uh,[Wh],(c,[l])=>c.id()===l.value],"filter-type-==":[uh,[Js],(c,[l])=>c.geometryType()===l.value],"filter-<":[uh,[Js,Wh],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y<M}],"filter-id-<":[uh,[Wh],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d<y}],"filter->":[uh,[Js,Wh],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y>M}],"filter-id->":[uh,[Wh],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d>y}],"filter-<=":[uh,[Js,Wh],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y<=M}],"filter-id-<=":[uh,[Wh],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d<=y}],"filter->=":[uh,[Js,Wh],(c,[l,d])=>{const y=c.properties()[l.value],M=d.value;return typeof y==typeof M&&y>=M}],"filter-id->=":[uh,[Wh],(c,[l])=>{const d=c.id(),y=l.value;return typeof d==typeof y&&d>=y}],"filter-has":[uh,[Wh],(c,[l])=>l.value in c.properties()],"filter-has-id":[uh,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[uh,[rp(Js)],(c,[l])=>l.value.indexOf(c.geometryType())>=0],"filter-id-in":[uh,[rp(Wh)],(c,[l])=>l.value.indexOf(c.id())>=0],"filter-in-small":[uh,[Js,rp(Wh)],(c,[l,d])=>d.value.indexOf(c.properties()[l.value])>=0],"filter-in-large":[uh,[Js,rp(Wh)],(c,[l,d])=>function(y,M,N,q){for(;N<=q;){const St=N+q>>1;if(M[St]===y)return!0;M[St]>y?q=St-1:N=St+1}return!1}(c.properties()[l.value],d.value,0,d.value.length-1)],all:{type:uh,overloads:[[[uh,uh],(c,[l,d])=>l.evaluate(c)&&d.evaluate(c)],[Pg(uh),(c,l)=>{for(const d of l)if(!d.evaluate(c))return!1;return!0}]]},any:{type:uh,overloads:[[[uh,uh],(c,[l,d])=>l.evaluate(c)||d.evaluate(c)],[Pg(uh),(c,l)=>{for(const d of l)if(d.evaluate(c))return!0;return!1}]]},"!":[uh,[uh],(c,[l])=>!l.evaluate(c)],"is-supported-script":[uh,[Js],(c,[l])=>{const d=c.globals&&c.globals.isSupportedScript;return!d||d(l.evaluate(c))}],upcase:[Js,[Js],(c,[l])=>l.evaluate(c).toUpperCase()],downcase:[Js,[Js],(c,[l])=>l.evaluate(c).toLowerCase()],concat:[Js,Pg(Wh),(c,l)=>l.map(d=>s_(d.evaluate(c))).join("")],"resolved-locale":[Js,[pd],(c,[l])=>l.evaluate(c).resolvedLocale()]});var v_=h0;function fy(c){return{result:"success",value:c}}function fg(c){return{result:"error",value:c}}function Ay(c){return c["property-type"]==="data-driven"}function ug(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function ym(c){return!!c.expression&&c.expression.interpolated}function Yp(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function $_(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function k0(c){return c}function Py(c,l){const d=l.type==="color",y=c.stops&&typeof c.stops[0][0]=="object",M=y||!(y||c.property!==void 0),N=c.type||(ym(l)?"exponential":"interval");if(d&&((c=Mg({},c)).stops&&(c.stops=c.stops.map(Ui=>[Ui[0],jm.parse(Ui[1])])),c.default=jm.parse(c.default?c.default:l.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!M0[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let q,St,Ht;if(N==="exponential")q=Q_;else if(N==="interval")q=b_;else if(N==="categorical"){q=_v,St=Object.create(null);for(const Ui of c.stops)St[Ui[0]]=Ui[1];Ht=typeof c.stops[0][0]}else{if(N!=="identity")throw new Error(`Unknown function type "${N}"`);q=Pp}if(y){const Ui={},Bn=[];for(let $u=0;$u<c.stops.length;$u++){const Ku=c.stops[$u],rh=Ku[0].zoom;Ui[rh]===void 0&&(Ui[rh]={zoom:rh,type:c.type,property:c.property,default:c.default,stops:[]},Bn.push(rh)),Ui[rh].stops.push([Ku[0].value,Ku[1]])}const ls=[];for(const $u of Bn)ls.push([Ui[$u].zoom,Py(Ui[$u],l)]);const il={name:"linear"};return{kind:"composite",interpolationType:il,interpolationFactor:__.interpolationFactor.bind(void 0,il),zoomStops:ls.map($u=>$u[0]),evaluate:({zoom:$u},Ku)=>Q_({stops:ls,base:c.base},l,$u).evaluate($u,Ku)}}if(M){const Ui=N==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Ui,interpolationFactor:__.interpolationFactor.bind(void 0,Ui),zoomStops:c.stops.map(Bn=>Bn[0]),evaluate:({zoom:Bn})=>q(c,l,Bn,St,Ht)}}return{kind:"source",evaluate(Ui,Bn){const ls=Bn&&Bn.properties?Bn.properties[c.property]:void 0;return ls===void 0?x_(c.default,l.default):q(c,l,ls,St,Ht)}}}function x_(c,l,d){return c!==void 0?c:l!==void 0?l:d!==void 0?d:void 0}function _v(c,l,d,y,M){return x_(typeof d===M?y[d]:void 0,c.default,l.default)}function b_(c,l,d){if(Yp(d)!=="number")return x_(c.default,l.default);const y=c.stops.length;if(y===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[y-1][0])return c.stops[y-1][1];const M=K_(c.stops.map(N=>N[0]),d);return c.stops[M][1]}function Q_(c,l,d){const y=c.base!==void 0?c.base:1;if(Yp(d)!=="number")return x_(c.default,l.default);const M=c.stops.length;if(M===1||d<=c.stops[0][0])return c.stops[0][1];if(d>=c.stops[M-1][0])return c.stops[M-1][1];const N=K_(c.stops.map(Bn=>Bn[0]),d),q=function(Bn,ls,il,$u){const Ku=$u-il,rh=Bn-il;return Ku===0?0:ls===1?rh/Ku:(Math.pow(ls,rh)-1)/(Math.pow(ls,Ku)-1)}(d,y,c.stops[N][0],c.stops[N+1][0]),St=c.stops[N][1],Ht=c.stops[N+1][1];let Ui=uy[l.type]||k0;if(c.colorSpace&&c.colorSpace!=="rgb"){const Bn=M0[c.colorSpace];Ui=(ls,il)=>Bn.reverse(Bn.interpolate(Bn.forward(ls),Bn.forward(il),q))}return typeof St.evaluate=="function"?{evaluate(...Bn){const ls=St.evaluate.apply(void 0,Bn),il=Ht.evaluate.apply(void 0,Bn);if(ls!==void 0&&il!==void 0)return Ui(ls,il,q)}}:Ui(St,Ht,q)}function Pp(c,l,d){return l.type==="color"?d=jm.parse(d):l.type==="formatted"?d=vg.fromString(d.toString()):l.type==="resolvedImage"?d=ng.fromString(d.toString()):Yp(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0),x_(d,c.default,l.default)}class jp{constructor(l,d){this.expression=l,this._warningHistory={},this._evaluator=new T0,this._defaultValue=d?function(y){return y.type==="color"&&($_(y.default)||Array.isArray(y.default))?new jm(0,0,0,0):y.type==="color"?jm.parse(y.default)||null:y.default===void 0?null:y.default}(d):null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,y,M,N,q,St,Ht){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=y,this._evaluator.canonical=M||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=q,this._evaluator.featureTileCoord=St||null,this._evaluator.featureDistanceData=Ht||null,this.expression.evaluate(this._evaluator)}evaluate(l,d,y,M,N,q,St,Ht){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=y||null,this._evaluator.canonical=M||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=q||null,this._evaluator.featureTileCoord=St||null,this._evaluator.featureDistanceData=Ht||null;try{const Ui=this.expression.evaluate(this._evaluator);if(Ui==null||typeof Ui=="number"&&Ui!=Ui)return this._defaultValue;if(this._enumValues&&!(Ui in this._enumValues))throw new xg(`Expected value to be one of ${Object.keys(this._enumValues).map(Bn=>JSON.stringify(Bn)).join(", ")}, but found ${JSON.stringify(Ui)} instead.`);return Ui}catch(Ui){return this._warningHistory[Ui.message]||(this._warningHistory[Ui.message]=!0,typeof console<"u"&&console.warn(Ui.message)),this._defaultValue}}}function py(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in v_}function d0(c,l){const d=new g_(v_,[],l?function(M){const N={color:Vh,string:Js,number:yr,enum:Js,boolean:uh,formatted:$f,resolvedImage:Tf};return M.type==="array"?rp(N[M.value]||Wh,M.length):N[M.type]}(l):void 0),y=d.parse(c,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?fy(new jp(y,l)):fg(d.errors)}class yv{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!m_(d.expression)}evaluateWithoutErrorHandling(l,d,y,M,N,q){return this._styleExpression.evaluateWithoutErrorHandling(l,d,y,M,N,q)}evaluate(l,d,y,M,N,q){return this._styleExpression.evaluate(l,d,y,M,N,q)}}class Ng{constructor(l,d,y,M){this.kind=l,this.zoomStops=y,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!m_(d.expression),this.interpolationType=M}evaluateWithoutErrorHandling(l,d,y,M,N,q){return this._styleExpression.evaluateWithoutErrorHandling(l,d,y,M,N,q)}evaluate(l,d,y,M,N,q){return this._styleExpression.evaluate(l,d,y,M,N,q)}interpolationFactor(l,d,y){return this.interpolationType?__.interpolationFactor(this.interpolationType,l,d,y):0}}function f0(c,l){if((c=d0(c,l)).result==="error")return c;const d=c.value.expression,y=Xy(d);if(!y&&!Ay(l))return fg([new p_("","data expressions not supported")]);const M=X_(d,["zoom","pitch","distance-from-center"]);if(!M&&!ug(l))return fg([new p_("","zoom expressions not supported")]);const N=Fv(d);return N||M?N instanceof p_?fg([N]):N instanceof __&&!ym(l)?fg([new p_("",'"interpolate" expressions cannot be used with this property')]):fy(N?new Ng(y?"camera":"composite",c.value,N.labels,N instanceof __?N.interpolation:void 0):new yv(y?"constant":"source",c.value)):fg([new p_("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class w_{constructor(l,d){this._parameters=l,this._specification=d,Mg(this,Py(this._parameters,this._specification))}static deserialize(l){return new w_(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Fv(c){let l=null;if(c instanceof np)l=Fv(c.result);else if(c instanceof bd){for(const d of c.args)if(l=Fv(d),l)break}else(c instanceof gv||c instanceof __)&&c.input instanceof Rg&&c.input.name==="zoom"&&(l=c);return l instanceof p_||c.eachChild(d=>{const y=Fv(d);y instanceof p_?l=y:!l&&y?l=new p_("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&y&&l!==y&&(l=new p_("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}class hp{constructor(l,d,y,M){this.message=(l?`${l}: `:"")+y,M&&(this.identifier=M),d!=null&&d.__line__&&(this.line=d.__line__)}}function wm(c){const l=c.key,d=c.value,y=c.valueSpec||{},M=c.objectElementValidators||{},N=c.style,q=c.styleSpec;let St=[];const Ht=Yp(d);if(Ht!=="object")return[new hp(l,d,`object expected, ${Ht} found`)];for(const Ui in d){const Bn=Ui.split(".")[0];let ls;M[Bn]?ls=M[Bn]:y[Bn]?ls=jg:M["*"]?ls=M["*"]:y["*"]&&(ls=jg),ls?St=St.concat(ls({key:(l&&`${l}.`)+Ui,value:d[Ui],valueSpec:y[Bn]||y["*"],style:N,styleSpec:q,object:d,objectKey:Ui},d)):St.push(new hp(l,d[Ui],`unknown property "${Ui}"`))}for(const Ui in y)M[Ui]||y[Ui].required&&y[Ui].default===void 0&&d[Ui]===void 0&&St.push(new hp(l,d,`missing required property "${Ui}"`));return St}function pg(c){const l=c.value,d=c.valueSpec,y=c.style,M=c.styleSpec,N=c.key,q=c.arrayElementValidator||jg;if(Yp(l)!=="array")return[new hp(N,l,`array expected, ${Yp(l)} found`)];if(d.length&&l.length!==d.length)return[new hp(N,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new hp(N,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let St={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};M.$version<7&&(St.function=d.function),Yp(d.value)==="object"&&(St=d.value);let Ht=[];for(let Ui=0;Ui<l.length;Ui++)Ht=Ht.concat(q({array:l,arrayIndex:Ui,value:l[Ui],valueSpec:St,style:y,styleSpec:M,key:`${N}[${Ui}]`}));return Ht}function Y0(c){const l=c.key,d=c.value,y=c.valueSpec;let M=Yp(d);if(M==="number"&&d!=d&&(M="NaN"),M!=="number")return[new hp(l,d,`number expected, ${M} found`)];if("minimum"in y){let N=y.minimum;if(Yp(y.minimum)==="array"&&(N=y.minimum[c.arrayIndex]),d<N)return[new hp(l,d,`${d} is less than the minimum value ${N}`)]}if("maximum"in y){let N=y.maximum;if(Yp(y.maximum)==="array"&&(N=y.maximum[c.arrayIndex]),d>N)return[new hp(l,d,`${d} is greater than the maximum value ${N}`)]}return[]}function Jy(c){const l=c.valueSpec,d=km(c.value.type);let y,M,N,q={};const St=d!=="categorical"&&c.value.property===void 0,Ht=!St,Ui=Yp(c.value.stops)==="array"&&Yp(c.value.stops[0])==="array"&&Yp(c.value.stops[0][0])==="object",Bn=wm({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function($u){if(d==="identity")return[new hp($u.key,$u.value,'identity function may not have a "stops" property')];let Ku=[];const rh=$u.value;return Ku=Ku.concat(pg({key:$u.key,value:rh,valueSpec:$u.valueSpec,style:$u.style,styleSpec:$u.styleSpec,arrayElementValidator:ls})),Yp(rh)==="array"&&rh.length===0&&Ku.push(new hp($u.key,rh,"array must have at least one stop")),Ku},default:function($u){return jg({key:$u.key,value:$u.value,valueSpec:l,style:$u.style,styleSpec:$u.styleSpec})}}});return d==="identity"&&St&&Bn.push(new hp(c.key,c.value,'missing required property "property"')),d==="identity"||c.value.stops||Bn.push(new hp(c.key,c.value,'missing required property "stops"')),d==="exponential"&&c.valueSpec.expression&&!ym(c.valueSpec)&&Bn.push(new hp(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(Ht&&!Ay(c.valueSpec)?Bn.push(new hp(c.key,c.value,"property functions not supported")):St&&!ug(c.valueSpec)&&Bn.push(new hp(c.key,c.value,"zoom functions not supported"))),d!=="categorical"&&!Ui||c.value.property!==void 0||Bn.push(new hp(c.key,c.value,'"property" property is required')),Bn;function ls($u){let Ku=[];const rh=$u.value,vh=$u.key;if(Yp(rh)!=="array")return[new hp(vh,rh,`array expected, ${Yp(rh)} found`)];if(rh.length!==2)return[new hp(vh,rh,`array length 2 expected, length ${rh.length} found`)];if(Ui){if(Yp(rh[0])!=="object")return[new hp(vh,rh,`object expected, ${Yp(rh[0])} found`)];if(rh[0].zoom===void 0)return[new hp(vh,rh,"object stop key must have zoom")];if(rh[0].value===void 0)return[new hp(vh,rh,"object stop key must have value")];const Ph=km(rh[0].zoom);if(typeof Ph!="number")return[new hp(vh,rh[0].zoom,"stop zoom values must be numbers")];if(N&&N>Ph)return[new hp(vh,rh[0].zoom,"stop zoom values must appear in ascending order")];Ph!==N&&(N=Ph,M=void 0,q={}),Ku=Ku.concat(wm({key:`${vh}[0]`,value:rh[0],valueSpec:{zoom:{}},style:$u.style,styleSpec:$u.styleSpec,objectElementValidators:{zoom:Y0,value:il}}))}else Ku=Ku.concat(il({key:`${vh}[0]`,value:rh[0],valueSpec:{},style:$u.style,styleSpec:$u.styleSpec},rh));return py(sg(rh[1]))?Ku.concat([new hp(`${vh}[1]`,rh[1],"expressions are not allowed in function stops.")]):Ku.concat(jg({key:`${vh}[1]`,value:rh[1],valueSpec:l,style:$u.style,styleSpec:$u.styleSpec}))}function il($u,Ku){const rh=Yp($u.value),vh=km($u.value),Ph=$u.value!==null?$u.value:Ku;if(y){if(rh!==y)return[new hp($u.key,Ph,`${rh} stop domain type must match previous stop domain type ${y}`)]}else y=rh;if(rh!=="number"&&rh!=="string"&&rh!=="boolean"&&typeof vh!="number"&&typeof vh!="string"&&typeof vh!="boolean")return[new hp($u.key,Ph,"stop domain value must be a number, string, or boolean")];if(rh!=="number"&&d!=="categorical"){let Xh=`number expected, ${rh} found`;return Ay(l)&&d===void 0&&(Xh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new hp($u.key,Ph,Xh)]}return d!=="categorical"||rh!=="number"||typeof vh=="number"&&isFinite(vh)&&Math.floor(vh)===vh?d!=="categorical"&&rh==="number"&&typeof vh=="number"&&typeof M=="number"&&M!==void 0&&vh<M?[new hp($u.key,Ph,"stop domain values must appear in ascending order")]:(M=vh,d==="categorical"&&vh in q?[new hp($u.key,Ph,"stop domain values must be unique")]:(q[vh]=!0,[])):[new hp($u.key,Ph,`integer expected, found ${String(vh)}`)]}}function mg(c){const l=(c.expressionContext==="property"?f0:d0)(sg(c.value),c.valueSpec);if(l.result==="error")return l.value.map(y=>new hp(`${c.key}${y.key}`,c.value,y.message));const d=l.value.expression||l.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!d.outputDefined())return[new hp(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!m_(d))return[new hp(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return ky(d,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!X_(d,["zoom","feature-state"]))return[new hp(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Xy(d))return[new hp(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ky(c,l){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const M of l.valueSpec.expression.parameters)d.delete(M);if(d.size===0)return[];const y=[];return c instanceof Rg&&d.has(c.name)?[new hp(l.key,l.value,`["${c.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(c.eachChild(M=>{y.push(...ky(M,l))}),y)}function J0(c){const l=c.key,d=c.value,y=c.valueSpec,M=[];return Array.isArray(y.values)?y.values.indexOf(km(d))===-1&&M.push(new hp(l,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf(km(d))===-1&&M.push(new hp(l,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),M}function D0(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const l of c.slice(1))if(!D0(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function p0(c,l="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};D0(c)||(c=m0(c));const d=c;let y=!0;try{y=function(Ui){if(!Qy(Ui))return Ui;let Bn=sg(Ui);return Q0(Bn),Bn=Uv(Bn),Bn}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}const M=Yd[`filter_${l}`],N=d0(y,M);let q=null;if(N.result==="error")throw new Error(N.value.map(Ui=>`${Ui.key}: ${Ui.message}`).join(", "));q=(Ui,Bn,ls)=>N.value.evaluate(Ui,Bn,{},ls);let St=null,Ht=null;if(y!==d){const Ui=d0(d,M);if(Ui.result==="error")throw new Error(Ui.value.map(Bn=>`${Bn.key}: ${Bn.message}`).join(", "));St=(Bn,ls,il,$u,Ku)=>Ui.value.evaluate(Bn,ls,{},il,void 0,void 0,$u,Ku),Ht=!Xy(Ui.value.expression)}return{filter:q,dynamicFilter:St||void 0,needGeometry:Vv(y),needFeature:!!Ht}}function Uv(c){if(!Array.isArray(c))return c;const l=function(d){if(ev.has(d[0])){for(let y=1;y<d.length;y++)if(Qy(d[y]))return!0}return d}(c);return l===!0?l:l.map(d=>Uv(d))}function Q0(c){let l=!1;const d=[];if(c[0]==="case"){for(let y=1;y<c.length-1;y+=2)l=l||Qy(c[y]),d.push(c[y+1]);d.push(c[c.length-1])}else if(c[0]==="match"){l=l||Qy(c[1]);for(let y=2;y<c.length-1;y+=2)d.push(c[y+1]);d.push(c[c.length-1])}else if(c[0]==="step"){l=l||Qy(c[1]);for(let y=1;y<c.length-1;y+=2)d.push(c[y+1])}l&&(c.length=0,c.push("any",...d));for(let y=1;y<c.length;y++)Q0(c[y])}function Qy(c){if(!Array.isArray(c))return!1;if((l=c[0])==="pitch"||l==="distance-from-center")return!0;var l;for(let d=1;d<c.length;d++)if(Qy(c[d]))return!0;return!1}const ev=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function n1(c,l){return c<l?-1:c>l?1:0}function Vv(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let l=1;l<c.length;l++)if(Vv(c[l]))return!0;return!1}function m0(c){if(!c)return!0;const l=c[0];return c.length<=1?l!=="any":l==="=="?vv(c[1],c[2],"=="):l==="!="?my(vv(c[1],c[2],"==")):l==="<"||l===">"||l==="<="||l===">="?vv(c[1],c[2],l):l==="any"?(d=c.slice(1),["any"].concat(d.map(m0))):l==="all"?["all"].concat(c.slice(1).map(m0)):l==="none"?["all"].concat(c.slice(1).map(m0).map(my)):l==="in"?tv(c[1],c.slice(2)):l==="!in"?my(tv(c[1],c.slice(2))):l==="has"?xv(c[1]):l==="!has"?my(xv(c[1])):l!=="within"||c;var d}function vv(c,l,d){switch(c){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,c,l]}}function tv(c,l){if(l.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",c,["literal",l.sort(n1)]]:["filter-in-small",c,["literal",l]]}}function xv(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function my(c){return["!",c]}function g0(c){return D0(sg(c.value))?mg(Mg({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):L0(c)}function L0(c){const l=c.value,d=c.key;if(Yp(l)!=="array")return[new hp(d,l,`array expected, ${Yp(l)} found`)];const y=c.styleSpec;let M,N=[];if(l.length<1)return[new hp(d,l,"filter array must have at least 1 element")];switch(N=N.concat(J0({key:`${d}[0]`,value:l[0],valueSpec:y.filter_operator,style:c.style,styleSpec:c.styleSpec})),km(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&km(l[1])==="$type"&&N.push(new hp(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&N.push(new hp(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(M=Yp(l[1]),M!=="string"&&N.push(new hp(`${d}[1]`,l[1],`string expected, ${M} found`)));for(let q=2;q<l.length;q++)M=Yp(l[q]),km(l[1])==="$type"?N=N.concat(J0({key:`${d}[${q}]`,value:l[q],valueSpec:y.geometry_type,style:c.style,styleSpec:c.styleSpec})):M!=="string"&&M!=="number"&&M!=="boolean"&&N.push(new hp(`${d}[${q}]`,l[q],`string, number, or boolean expected, ${M} found`));break;case"any":case"all":case"none":for(let q=1;q<l.length;q++)N=N.concat(L0({key:`${d}[${q}]`,value:l[q],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":M=Yp(l[1]),l.length!==2?N.push(new hp(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):M!=="string"&&N.push(new hp(`${d}[1]`,l[1],`string expected, ${M} found`));break;case"within":M=Yp(l[1]),l.length!==2?N.push(new hp(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):M!=="object"&&N.push(new hp(`${d}[1]`,l[1],`object expected, ${M} found`))}return N}function bv(c,l){const d=c.key,y=c.style,M=c.styleSpec,N=c.value,q=c.objectKey,St=M[`${l}_${c.layerType}`];if(!St)return[];const Ht=q.match(/^(.*)-transition$/);if(l==="paint"&&Ht&&St[Ht[1]]&&St[Ht[1]].transition)return jg({key:d,value:N,valueSpec:M.transition,style:y,styleSpec:M});const Ui=c.valueSpec||St[q];if(!Ui)return[new hp(d,N,`unknown property "${q}"`)];let Bn;if(Yp(N)==="string"&&Ay(Ui)&&!Ui.tokens&&(Bn=/^{([^}]+)}$/.exec(N))){const il=`\`{ "type": "identity", "property": ${Bn?JSON.stringify(Bn[1]):'"_"'} }\``;return[new hp(d,N,`"${q}" does not support interpolation syntax
Use an identity property function instead: ${il}.`)]}const ls=[];return c.layerType==="symbol"&&(q==="text-field"&&y&&!y.glyphs&&ls.push(new hp(d,N,'use of "text-field" requires a style "glyphs" property')),q==="text-font"&&$_(sg(N))&&km(N.type)==="identity"&&ls.push(new hp(d,N,'"text-font" does not support identity functions'))),ls.concat(jg({key:c.key,value:N,valueSpec:Ui,style:y,styleSpec:M,expressionContext:"property",propertyType:l,propertyKey:q}))}function wv(c){return bv(c,"paint")}function Ev(c){return bv(c,"layout")}function o1(c){let l=[];const d=c.value,y=c.key,M=c.style,N=c.styleSpec;d.type||d.ref||l.push(new hp(y,d,'either "type" or "ref" is required'));let q=km(d.type);const St=km(d.ref);if(d.id){const Ht=km(d.id);for(let Ui=0;Ui<c.arrayIndex;Ui++){const Bn=M.layers[Ui];km(Bn.id)===Ht&&l.push(new hp(y,d.id,`duplicate layer id "${d.id}", previously used at line ${Bn.id.__line__}`))}}if("ref"in d){let Ht;["type","source","source-layer","filter","layout"].forEach(Ui=>{Ui in d&&l.push(new hp(y,d[Ui],`"${Ui}" is prohibited for ref layers`))}),M.layers.forEach(Ui=>{km(Ui.id)===St&&(Ht=Ui)}),Ht?Ht.ref?l.push(new hp(y,d.ref,"ref cannot reference another ref layer")):q=km(Ht.type):typeof St=="string"&&l.push(new hp(y,d.ref,`ref layer "${St}" not found`))}else if(q!=="background"&&q!=="sky")if(d.source){const Ht=M.sources&&M.sources[d.source],Ui=Ht&&km(Ht.type);Ht?Ui==="vector"&&q==="raster"?l.push(new hp(y,d.source,`layer "${d.id}" requires a raster source`)):Ui==="raster"&&q!=="raster"?l.push(new hp(y,d.source,`layer "${d.id}" requires a vector source`)):Ui!=="vector"||d["source-layer"]?Ui==="raster-dem"&&q!=="hillshade"?l.push(new hp(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):q!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||Ui==="geojson"&&Ht.lineMetrics||l.push(new hp(y,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new hp(y,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new hp(y,d.source,`source "${d.source}" not found`))}else l.push(new hp(y,d,'missing required property "source"'));return l=l.concat(wm({key:y,value:d,valueSpec:N.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>jg({key:`${y}.type`,value:d.type,valueSpec:N.layer.type,style:c.style,styleSpec:c.styleSpec,object:d,objectKey:"type"}),filter:Ht=>g0(Mg({layerType:q},Ht)),layout:Ht=>wm({layer:d,key:Ht.key,value:Ht.value,valueSpec:{},style:Ht.style,styleSpec:Ht.styleSpec,objectElementValidators:{"*":Ui=>Ev(Mg({layerType:q},Ui))}}),paint:Ht=>wm({layer:d,key:Ht.key,value:Ht.value,valueSpec:{},style:Ht.style,styleSpec:Ht.styleSpec,objectElementValidators:{"*":Ui=>wv(Mg({layerType:q},Ui))}})}})),l}function Dy(c){const l=c.value,d=c.key,y=Yp(l);return y!=="string"?[new hp(d,l,`string expected, ${y} found`)]:[]}const Sv={promoteId:function({key:c,value:l}){if(Yp(l)==="string")return Dy({key:c,value:l});{const d=[];for(const y in l)d.push(...Dy({key:`${c}.${y}`,value:l[y]}));return d}}};function Gv(c){const l=c.value,d=c.key,y=c.styleSpec,M=c.style;if(!l.type)return[new hp(d,l,'"type" is required')];const N=km(l.type);let q;switch(N){case"vector":case"raster":case"raster-dem":return q=wm({key:d,value:l,valueSpec:y[`source_${N.replace("-","_")}`],style:c.style,styleSpec:y,objectElementValidators:Sv}),q;case"geojson":if(q=wm({key:d,value:l,valueSpec:y.source_geojson,style:M,styleSpec:y,objectElementValidators:Sv}),l.cluster)for(const St in l.clusterProperties){const[Ht,Ui]=l.clusterProperties[St],Bn=typeof Ht=="string"?[Ht,["accumulated"],["get",St]]:Ht;q.push(...mg({key:`${d}.${St}.map`,value:Ui,expressionContext:"cluster-map"})),q.push(...mg({key:`${d}.${St}.reduce`,value:Bn,expressionContext:"cluster-reduce"}))}return q;case"video":return wm({key:d,value:l,valueSpec:y.source_video,style:M,styleSpec:y});case"image":return wm({key:d,value:l,valueSpec:y.source_image,style:M,styleSpec:y});case"canvas":return[new hp(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return J0({key:`${d}.type`,value:l.type,valueSpec:{values:jv(y)},style:M,styleSpec:y})}}function jv(c){return c.source.reduce((l,d)=>{const y=c[d];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function a1(c){const l=c.value,d=c.styleSpec,y=d.light,M=c.style;let N=[];const q=Yp(l);if(l===void 0)return N;if(q!=="object")return N=N.concat([new hp("light",l,`object expected, ${q} found`)]),N;for(const St in l){const Ht=St.match(/^(.*)-transition$/);N=N.concat(Ht&&y[Ht[1]]&&y[Ht[1]].transition?jg({key:St,value:l[St],valueSpec:d.transition,style:M,styleSpec:d}):y[St]?jg({key:St,value:l[St],valueSpec:y[St],style:M,styleSpec:d}):[new hp(St,l[St],`unknown property "${St}"`)])}return N}function e0(c){const l=c.value,d=c.key,y=c.style,M=c.styleSpec,N=M.terrain;let q=[];const St=Yp(l);if(l===void 0)return q;if(St!=="object")return q=q.concat([new hp("terrain",l,`object expected, ${St} found`)]),q;for(const Ht in l){const Ui=Ht.match(/^(.*)-transition$/);q=q.concat(Ui&&N[Ui[1]]&&N[Ui[1]].transition?jg({key:Ht,value:l[Ht],valueSpec:M.transition,style:y,styleSpec:M}):N[Ht]?jg({key:Ht,value:l[Ht],valueSpec:N[Ht],style:y,styleSpec:M}):[new hp(Ht,l[Ht],`unknown property "${Ht}"`)])}if(l.source){const Ht=y.sources&&y.sources[l.source],Ui=Ht&&km(Ht.type);Ht?Ui!=="raster-dem"&&q.push(new hp(d,l.source,`terrain cannot be used with a source of type ${String(Ui)}, it only be used with a "raster-dem" source type`)):q.push(new hp(d,l.source,`source "${l.source}" not found`))}else q.push(new hp(d,l,'terrain is missing required property "source"'));return q}function iv(c){const l=c.value,d=c.style,y=c.styleSpec,M=y.fog;let N=[];const q=Yp(l);if(l===void 0)return N;if(q!=="object")return N=N.concat([new hp("fog",l,`object expected, ${q} found`)]),N;for(const St in l){const Ht=St.match(/^(.*)-transition$/);N=N.concat(Ht&&M[Ht[1]]&&M[Ht[1]].transition?jg({key:St,value:l[St],valueSpec:y.transition,style:d,styleSpec:y}):M[St]?jg({key:St,value:l[St],valueSpec:M[St],style:d,styleSpec:y}):[new hp(St,l[St],`unknown property "${St}"`)])}return N}const R0={"*":()=>[],array:pg,boolean:function(c){const l=c.value,d=c.key,y=Yp(l);return y!=="boolean"?[new hp(d,l,`boolean expected, ${y} found`)]:[]},number:Y0,color:function(c){const l=c.key,d=c.value,y=Yp(d);return y!=="string"?[new hp(l,d,`color expected, ${y} found`)]:Dm(d)===null?[new hp(l,d,`color expected, "${d}" found`)]:[]},enum:J0,filter:g0,function:Jy,layer:o1,object:wm,source:Gv,light:a1,terrain:e0,fog:iv,string:Dy,formatted:function(c){return Dy(c).length===0?[]:mg(c)},resolvedImage:function(c){return Dy(c).length===0?[]:mg(c)},projection:function(c){const l=c.value,d=c.styleSpec,y=d.projection,M=c.style;let N=[];const q=Yp(l);if(q==="object")for(const St in l)N=N.concat(jg({key:St,value:l[St],valueSpec:y[St],style:M,styleSpec:d}));else q!=="string"&&(N=N.concat([new hp("projection",l,`object or string expected, ${q} found`)]));return N}};function jg(c){const l=c.value,d=c.valueSpec,y=c.styleSpec;return d.expression&&$_(km(l))?Jy(c):d.expression&&py(sg(l))?mg(c):d.type&&R0[d.type]?R0[d.type](c):wm(Mg({},c,{valueSpec:d.type?y[d.type]:d}))}function s1(c){const l=c.value,d=c.key,y=Dy(c);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new hp(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new hp(d,l,'"glyphs" url must include a "{range}" token'))),y}function rv(c,l=Yd){return B_(jg({key:"",value:c,valueSpec:l.$root,styleSpec:l,style:c,objectElementValidators:{glyphs:s1,"*":()=>[]}}))}const Q1=c=>B_(wv(c)),ex=c=>B_(Ev(c));function B_(c){return c.slice().sort((l,d)=>l.line&&d.line?l.line-d.line:0)}function T1(c,l){let d=!1;if(l&&l.length)for(const y of l)c.fire(new Ug(new Error(y.message))),d=!0;return d}var _0=g,he=3;function g(c,l,d){var y=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var M=new Int32Array(this.arrayBuffer);c=M[0],this.d=(l=M[1])+2*(d=M[2]);for(var N=0;N<this.d*this.d;N++){var q=M[he+N],St=M[he+N+1];y.push(q===St?null:M.subarray(q,St))}var Ht=M[he+y.length+1];this.keys=M.subarray(M[he+y.length],Ht),this.bboxes=M.subarray(Ht),this.insert=this._insertReadonly}else{this.d=l+2*d;for(var Ui=0;Ui<this.d*this.d;Ui++)y.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=c,this.padding=d,this.scale=l/c,this.uid=0;var Bn=d/l*c;this.min=-Bn,this.max=c+Bn}g.prototype.insert=function(c,l,d,y,M){this._forEachCell(l,d,y,M,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(M)},g.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},g.prototype._insertCell=function(c,l,d,y,M,N){this.cells[M].push(N)},g.prototype.query=function(c,l,d,y,M){var N=this.min,q=this.max;if(c<=N&&l<=N&&q<=d&&q<=y&&!M)return Array.prototype.slice.call(this.keys);var St=[];return this._forEachCell(c,l,d,y,this._queryCell,St,{},M),St},g.prototype._queryCell=function(c,l,d,y,M,N,q,St){var Ht=this.cells[M];if(Ht!==null)for(var Ui=this.keys,Bn=this.bboxes,ls=0;ls<Ht.length;ls++){var il=Ht[ls];if(q[il]===void 0){var $u=4*il;(St?St(Bn[$u+0],Bn[$u+1],Bn[$u+2],Bn[$u+3]):c<=Bn[$u+2]&&l<=Bn[$u+3]&&d>=Bn[$u+0]&&y>=Bn[$u+1])?(q[il]=!0,N.push(Ui[il])):q[il]=!1}}},g.prototype._forEachCell=function(c,l,d,y,M,N,q,St){for(var Ht=this._convertToCellCoord(c),Ui=this._convertToCellCoord(l),Bn=this._convertToCellCoord(d),ls=this._convertToCellCoord(y),il=Ht;il<=Bn;il++)for(var $u=Ui;$u<=ls;$u++){var Ku=this.d*$u+il;if((!St||St(this._convertFromCellCoord(il),this._convertFromCellCoord($u),this._convertFromCellCoord(il+1),this._convertFromCellCoord($u+1)))&&M.call(this,c,l,d,y,Ku,N,q,St))return}},g.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},g.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},g.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,l=he+this.cells.length+1+1,d=0,y=0;y<this.cells.length;y++)d+=this.cells[y].length;var M=new Int32Array(l+d+this.keys.length+this.bboxes.length);M[0]=this.extent,M[1]=this.n,M[2]=this.padding;for(var N=l,q=0;q<c.length;q++){var St=c[q];M[he+q]=N,M.set(St,N),N+=St.length}return M[he+c.length]=N,M.set(this.keys,N),M[he+c.length+1]=N+=this.keys.length,M.set(this.bboxes,N),N+=this.bboxes.length,M.buffer};var A=Io(_0);const X={};function _e(c,l,d={}){Object.defineProperty(c,"_classRegistryKey",{value:l,writeable:!1}),X[l]={klass:c,omit:d.omit||[]}}_e(Object,"Object"),A.serialize=function(c,l){const d=c.toArrayBuffer();return l&&l.push(d),{buffer:d}},A.deserialize=function(c){return new A(c.buffer)},Object.defineProperty(A,"name",{value:"Grid"}),_e(A,"Grid"),_e(jm,"Color"),_e(Error,"Error"),_e(Zf,"AJAXError"),_e(ng,"ResolvedImage"),_e(w_,"StylePropertyFunction"),_e(jp,"StyleExpression",{omit:["_evaluator"]}),_e(Ng,"ZoomDependentExpression"),_e(yv,"ZoomConstantExpression"),_e(Rg,"CompoundExpression",{omit:["_evaluate"]});for(const c in v_)X[v_[c]._classRegistryKey]||_e(v_[c],`Expression${c}`);function Ft(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Xr(c){return x.ImageBitmap&&c instanceof x.ImageBitmap}function as(c,l){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Ft(c)||Xr(c))return l&&l.push(c),c;if(ArrayBuffer.isView(c)){const d=c;return l&&l.push(d.buffer),d}if(c instanceof x.ImageData)return l&&l.push(c.data.buffer),c;if(Array.isArray(c)){const d=[];for(const y of c)d.push(as(y,l));return d}if(typeof c=="object"){const d=c.constructor,y=d._classRegistryKey;if(!y)throw new Error(`can't serialize object of unregistered class ${y}`);const M=d.serialize?d.serialize(c,l):{};if(!d.serialize){for(const N in c)c.hasOwnProperty(N)&&(X[y].omit.indexOf(N)>=0||(M[N]=as(c[N],l)));c instanceof Error&&(M.message=c.message)}if(M.$name)throw new Error("$name property is reserved for worker serialization logic.");return y!=="Object"&&(M.$name=y),M}throw new Error("can't serialize object of type "+typeof c)}function cs(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Ft(c)||Xr(c)||ArrayBuffer.isView(c)||c instanceof x.ImageData)return c;if(Array.isArray(c))return c.map(cs);if(typeof c=="object"){const l=c.$name||"Object",{klass:d}=X[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(c);const y=Object.create(d.prototype);for(const M of Object.keys(c))M!=="$name"&&(y[M]=cs(c[M]));return y}throw new Error("can't deserialize object of type "+typeof c)}const us={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function th(c){for(const l of c)if(Rh(l.charCodeAt(0)))return!0;return!1}function eh(c){for(const l of c)if(!ph(l.charCodeAt(0)))return!1;return!0}function ph(c){return!(us.Arabic(c)||us["Arabic Supplement"](c)||us["Arabic Extended-A"](c)||us["Arabic Presentation Forms-A"](c)||us["Arabic Presentation Forms-B"](c))}function Rh(c){return!(c!==746&&c!==747&&(c<4352||!(us["Bopomofo Extended"](c)||us.Bopomofo(c)||us["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||us["CJK Compatibility Ideographs"](c)||us["CJK Compatibility"](c)||us["CJK Radicals Supplement"](c)||us["CJK Strokes"](c)||!(!us["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||us["CJK Unified Ideographs Extension A"](c)||us["CJK Unified Ideographs"](c)||us["Enclosed CJK Letters and Months"](c)||us["Hangul Compatibility Jamo"](c)||us["Hangul Jamo Extended-A"](c)||us["Hangul Jamo Extended-B"](c)||us["Hangul Jamo"](c)||us["Hangul Syllables"](c)||us.Hiragana(c)||us["Ideographic Description Characters"](c)||us.Kanbun(c)||us["Kangxi Radicals"](c)||us["Katakana Phonetic Extensions"](c)||us.Katakana(c)&&c!==12540||!(!us["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!us["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||us["Unified Canadian Aboriginal Syllabics"](c)||us["Unified Canadian Aboriginal Syllabics Extended"](c)||us["Vertical Forms"](c)||us["Yijing Hexagram Symbols"](c)||us["Yi Syllables"](c)||us["Yi Radicals"](c))))}function Bh(c){return!(Rh(c)||function(l){return!!(us["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||us["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||us["Letterlike Symbols"](l)||us["Number Forms"](l)||us["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||us["Control Pictures"](l)&&l!==9251||us["Optical Character Recognition"](l)||us["Enclosed Alphanumerics"](l)||us["Geometric Shapes"](l)||us["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||us["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||us["CJK Symbols and Punctuation"](l)||us.Katakana(l)||us["Private Use Area"](l)||us["CJK Compatibility Forms"](l)||us["Small Form Variants"](l)||us["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(c))}function Ch(c){return c>=1424&&c<=2303||us["Arabic Presentation Forms-A"](c)||us["Arabic Presentation Forms-B"](c)}function ed(c,l){return!(!l&&Ch(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||us.Khmer(c))}function Ed(c){for(const l of c)if(Ch(l.charCodeAt(0)))return!0;return!1}const _d="deferred",qh="loading",Md="loaded";let Nd=null,L="unavailable",u=null;const E=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(L="error"),Nd&&Nd(c)};function B(){Y.fire(new a_("pluginStateChange",{pluginStatus:L,pluginURL:u}))}const Y=new by,vt=function(){return L},mr=function(){if(L!==_d||!u)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");L=qh,B(),u&&Wd({url:u},c=>{c?E(c):(L=Md,B())})},Ur={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>L===Md||Ur.applyArabicShaping!=null,isLoading:()=>L===qh,setState(c){L=c.pluginStatus,u=c.pluginURL},isParsed:()=>Ur.applyArabicShaping!=null&&Ur.processBidirectionalText!=null&&Ur.processStyledBidirectionalText!=null,getPluginURL:()=>u};class Gn{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.transition=d.transition,this.pitch=d.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(l){return function(d,y){for(const M of d)if(!ed(M.charCodeAt(0),y))return!1;return!0}(l,Ur.isLoaded())}}class $s{constructor(l,d){this.property=l,this.value=d,this.expression=function(y,M){if($_(y))return new w_(y,M);if(py(y)){const N=f0(y,M);if(N.result==="error")throw new Error(N.value.map(q=>`${q.key}: ${q.message}`).join(", "));return N.value}{let N=y;return typeof y=="string"&&M.type==="color"&&(N=jm.parse(y)),{kind:"constant",evaluate:()=>N}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,y){return this.property.possiblyEvaluate(this,l,d,y)}}class el{constructor(l){this.property=l,this.value=new $s(l,void 0)}transitioned(l,d){return new dh(this.property,this.value,d,xd({},l.transition,this.transition),l.now)}untransitioned(){return new dh(this.property,this.value,null,{},0)}}class Wu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Uf(this._values[l].value.value)}setValue(l,d){this._values.hasOwnProperty(l)||(this._values[l]=new el(this._values[l].property)),this._values[l].value=new $s(this._values[l].property,d===null?void 0:Uf(d))}getTransition(l){return Uf(this._values[l].transition)}setTransition(l,d){this._values.hasOwnProperty(l)||(this._values[l]=new el(this._values[l].property)),this._values[l].transition=Uf(d)||void 0}serialize(){const l={};for(const d of Object.keys(this._values)){const y=this.getValue(d);y!==void 0&&(l[d]=y);const M=this.getTransition(d);M!==void 0&&(l[`${d}-transition`]=M)}return l}transitioned(l,d){const y=new gh(this._properties);for(const M of Object.keys(this._values))y._values[M]=this._values[M].transitioned(l,d._values[M]);return y}untransitioned(){const l=new gh(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class dh{constructor(l,d,y,M,N){const q=M.delay||0,St=M.duration||0;N=N||0,this.property=l,this.value=d,this.begin=N+q,this.end=this.begin+St,l.specification.transition&&(M.delay||M.duration)&&(this.prior=y)}possiblyEvaluate(l,d,y){const M=l.now||0,N=this.value.possiblyEvaluate(l,d,y),q=this.prior;if(q){if(M>this.end)return this.prior=null,N;if(this.value.isDataDriven())return this.prior=null,N;if(M<this.begin)return q.possiblyEvaluate(l,d,y);{const St=(M-this.begin)/(this.end-this.begin);return this.property.interpolate(q.possiblyEvaluate(l,d,y),N,hd(St))}}return N}}class gh{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,y){const M=new Ih(this._properties);for(const N of Object.keys(this._values))M._values[N]=this._values[N].possiblyEvaluate(l,d,y);return M}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Eh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}getValue(l){return Uf(this._values[l].value)}setValue(l,d){this._values[l]=new $s(this._values[l].property,d===null?void 0:Uf(d))}serialize(){const l={};for(const d of Object.keys(this._values)){const y=this.getValue(d);y!==void 0&&(l[d]=y)}return l}possiblyEvaluate(l,d,y){const M=new Ih(this._properties);for(const N of Object.keys(this._values))M._values[N]=this._values[N].possiblyEvaluate(l,d,y);return M}}class yh{constructor(l,d,y){this.property=l,this.value=d,this.parameters=y}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,y,M){return this.property.evaluate(this.value,this.parameters,l,d,y,M)}}class Ih{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Qu{constructor(l){this.specification=l}possiblyEvaluate(l,d){return l.expression.evaluate(d)}interpolate(l,d,y){const M=uy[this.specification.type];return M?M(l,d,y):l}}class bh{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,y,M){return new yh(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},y,M)}:l.expression,d)}interpolate(l,d,y){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new yh(this,{kind:"constant",value:void 0},l.parameters);const M=uy[this.specification.type];return M?new yh(this,{kind:"constant",value:M(l.value.value,d.value.value,y)},l.parameters):l}evaluate(l,d,y,M,N,q){return l.kind==="constant"?l.value:l.evaluate(d,y,M,N,q)}}class kh{constructor(l){this.specification=l}possiblyEvaluate(l,d,y,M){return!!l.expression.evaluate(d,null,{},y,M)}interpolate(){return!1}}class Oh{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const d=new Gn(0,{});for(const y in l){const M=l[y];M.specification.overridable&&this.overridableProperties.push(y);const N=this.defaultPropertyValues[y]=new $s(M,void 0),q=this.defaultTransitionablePropertyValues[y]=new el(M);this.defaultTransitioningPropertyValues[y]=q.untransitioned(),this.defaultPossiblyEvaluatedValues[y]=N.possiblyEvaluate(d)}}}function rd(c,l){return 256*(c=Cd(Math.floor(c),0,255))+Cd(Math.floor(l),0,255)}_e(bh,"DataDrivenProperty"),_e(Qu,"DataConstantProperty"),_e(kh,"ColorRampProperty");const sd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ld{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dd{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ud(c,l=1){let d=0,y=0;return{members:c.map(M=>{const N=sd[M.type].BYTES_PER_ELEMENT,q=d=md(d,Math.max(l,N)),St=M.components||1;return y=Math.max(y,N),d+=N*St,{name:M.name,type:M.type,components:St,offset:q}}),size:md(d,Math.max(y,l)),alignment:l}}function md(c,l){return Math.ceil(c/l)*l}class Af extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){const y=this.length;return this.resize(y+1),this.emplace(y,l,d)}emplace(l,d,y){const M=2*l;return this.int16[M+0]=d,this.int16[M+1]=y,l}}Af.prototype.bytesPerElement=4,_e(Af,"StructArrayLayout2i4");class Td extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y){const M=this.length;return this.resize(M+1),this.emplace(M,l,d,y)}emplace(l,d,y,M){const N=3*l;return this.int16[N+0]=d,this.int16[N+1]=y,this.int16[N+2]=M,l}}Td.prototype.bytesPerElement=6,_e(Td,"StructArrayLayout3i6");class Gd extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const q=4*l;return this.int16[q+0]=d,this.int16[q+1]=y,this.int16[q+2]=M,this.int16[q+3]=N,l}}Gd.prototype.bytesPerElement=8,_e(Gd,"StructArrayLayout4i8");class Od extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q,St){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,l,d,y,M,N,q,St)}emplace(l,d,y,M,N,q,St,Ht){const Ui=6*l,Bn=12*l,ls=3*l;return this.int16[Ui+0]=d,this.int16[Ui+1]=y,this.uint8[Bn+4]=M,this.uint8[Bn+5]=N,this.uint8[Bn+6]=q,this.uint8[Bn+7]=St,this.float32[ls+2]=Ht,l}}Od.prototype.bytesPerElement=12,_e(Od,"StructArrayLayout2i4ub1f12");class Lf extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const q=4*l;return this.float32[q+0]=d,this.float32[q+1]=y,this.float32[q+2]=M,this.float32[q+3]=N,l}}Lf.prototype.bytesPerElement=16,_e(Lf,"StructArrayLayout4f16");class Dd extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N){const q=this.length;return this.resize(q+1),this.emplace(q,l,d,y,M,N)}emplace(l,d,y,M,N,q){const St=6*l,Ht=3*l;return this.uint16[St+0]=d,this.uint16[St+1]=y,this.uint16[St+2]=M,this.uint16[St+3]=N,this.float32[Ht+2]=q,l}}Dd.prototype.bytesPerElement=12,_e(Dd,"StructArrayLayout4ui1f12");class yf extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const q=4*l;return this.uint16[q+0]=d,this.uint16[q+1]=y,this.uint16[q+2]=M,this.uint16[q+3]=N,l}}yf.prototype.bytesPerElement=8,_e(yf,"StructArrayLayout4ui8");class zf extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q){const St=this.length;return this.resize(St+1),this.emplace(St,l,d,y,M,N,q)}emplace(l,d,y,M,N,q,St){const Ht=6*l;return this.int16[Ht+0]=d,this.int16[Ht+1]=y,this.int16[Ht+2]=M,this.int16[Ht+3]=N,this.int16[Ht+4]=q,this.int16[Ht+5]=St,l}}zf.prototype.bytesPerElement=12,_e(zf,"StructArrayLayout6i12");class Pf extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il){const $u=this.length;return this.resize($u+1),this.emplace($u,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il)}emplace(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u){const Ku=12*l;return this.int16[Ku+0]=d,this.int16[Ku+1]=y,this.int16[Ku+2]=M,this.int16[Ku+3]=N,this.uint16[Ku+4]=q,this.uint16[Ku+5]=St,this.uint16[Ku+6]=Ht,this.uint16[Ku+7]=Ui,this.int16[Ku+8]=Bn,this.int16[Ku+9]=ls,this.int16[Ku+10]=il,this.int16[Ku+11]=$u,l}}Pf.prototype.bytesPerElement=24,_e(Pf,"StructArrayLayout4i4ui4i24");class Vf extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q){const St=this.length;return this.resize(St+1),this.emplace(St,l,d,y,M,N,q)}emplace(l,d,y,M,N,q,St){const Ht=10*l,Ui=5*l;return this.int16[Ht+0]=d,this.int16[Ht+1]=y,this.int16[Ht+2]=M,this.float32[Ui+2]=N,this.float32[Ui+3]=q,this.float32[Ui+4]=St,l}}Vf.prototype.bytesPerElement=20,_e(Vf,"StructArrayLayout3i3f20");class Lp extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}Lp.prototype.bytesPerElement=4,_e(Lp,"StructArrayLayout1ul4");class Mp extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u){const Ku=this.length;return this.resize(Ku+1),this.emplace(Ku,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u)}emplace(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku){const rh=20*l,vh=10*l;return this.int16[rh+0]=d,this.int16[rh+1]=y,this.int16[rh+2]=M,this.int16[rh+3]=N,this.int16[rh+4]=q,this.float32[vh+3]=St,this.float32[vh+4]=Ht,this.float32[vh+5]=Ui,this.float32[vh+6]=Bn,this.int16[rh+14]=ls,this.uint32[vh+8]=il,this.uint16[rh+18]=$u,this.uint16[rh+19]=Ku,l}}Mp.prototype.bytesPerElement=40,_e(Mp,"StructArrayLayout5i4f1i1ul2ui40");class fp extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q,St){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,l,d,y,M,N,q,St)}emplace(l,d,y,M,N,q,St,Ht){const Ui=8*l;return this.int16[Ui+0]=d,this.int16[Ui+1]=y,this.int16[Ui+2]=M,this.int16[Ui+4]=N,this.int16[Ui+5]=q,this.int16[Ui+6]=St,this.int16[Ui+7]=Ht,l}}fp.prototype.bytesPerElement=16,_e(fp,"StructArrayLayout3i2i2i16");class Fp extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N){const q=this.length;return this.resize(q+1),this.emplace(q,l,d,y,M,N)}emplace(l,d,y,M,N,q){const St=4*l,Ht=8*l;return this.float32[St+0]=d,this.float32[St+1]=y,this.float32[St+2]=M,this.int16[Ht+6]=N,this.int16[Ht+7]=q,l}}Fp.prototype.bytesPerElement=16,_e(Fp,"StructArrayLayout2f1f2i16");class cm extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const q=12*l,St=3*l;return this.uint8[q+0]=d,this.uint8[q+1]=y,this.float32[St+1]=M,this.float32[St+2]=N,l}}cm.prototype.bytesPerElement=12,_e(cm,"StructArrayLayout2ub2f12");class Jp extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y){const M=this.length;return this.resize(M+1),this.emplace(M,l,d,y)}emplace(l,d,y,M){const N=3*l;return this.float32[N+0]=d,this.float32[N+1]=y,this.float32[N+2]=M,l}}Jp.prototype.bytesPerElement=12,_e(Jp,"StructArrayLayout3f12");class kp extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y){const M=this.length;return this.resize(M+1),this.emplace(M,l,d,y)}emplace(l,d,y,M){const N=3*l;return this.uint16[N+0]=d,this.uint16[N+1]=y,this.uint16[N+2]=M,l}}kp.prototype.bytesPerElement=6,_e(kp,"StructArrayLayout3ui6");class _m extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh,Ph,Xh,Dh,jh,ad){const nd=this.length;return this.resize(nd+1),this.emplace(nd,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh,Ph,Xh,Dh,jh,ad)}emplace(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh,Ph,Xh,Dh,jh,ad,nd){const Bd=30*l,Rd=15*l,bf=60*l;return this.int16[Bd+0]=d,this.int16[Bd+1]=y,this.int16[Bd+2]=M,this.float32[Rd+2]=N,this.float32[Rd+3]=q,this.uint16[Bd+8]=St,this.uint16[Bd+9]=Ht,this.uint32[Rd+5]=Ui,this.uint32[Rd+6]=Bn,this.uint32[Rd+7]=ls,this.uint16[Bd+16]=il,this.uint16[Bd+17]=$u,this.uint16[Bd+18]=Ku,this.float32[Rd+10]=rh,this.float32[Rd+11]=vh,this.uint8[bf+48]=Ph,this.uint8[bf+49]=Xh,this.uint8[bf+50]=Dh,this.uint32[Rd+13]=jh,this.int16[Bd+28]=ad,this.uint8[bf+58]=nd,l}}_m.prototype.bytesPerElement=60,_e(_m,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Lm extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh,Ph,Xh,Dh,jh,ad,nd,Bd,Rd,bf,qf,Xd,kf,Df,Ff){const Yf=this.length;return this.resize(Yf+1),this.emplace(Yf,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh,Ph,Xh,Dh,jh,ad,nd,Bd,Rd,bf,qf,Xd,kf,Df,Ff)}emplace(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh,Ph,Xh,Dh,jh,ad,nd,Bd,Rd,bf,qf,Xd,kf,Df,Ff,Yf){const xf=38*l,dp=19*l;return this.int16[xf+0]=d,this.int16[xf+1]=y,this.int16[xf+2]=M,this.float32[dp+2]=N,this.float32[dp+3]=q,this.int16[xf+8]=St,this.int16[xf+9]=Ht,this.int16[xf+10]=Ui,this.int16[xf+11]=Bn,this.int16[xf+12]=ls,this.int16[xf+13]=il,this.uint16[xf+14]=$u,this.uint16[xf+15]=Ku,this.uint16[xf+16]=rh,this.uint16[xf+17]=vh,this.uint16[xf+18]=Ph,this.uint16[xf+19]=Xh,this.uint16[xf+20]=Dh,this.uint16[xf+21]=jh,this.uint16[xf+22]=ad,this.uint16[xf+23]=nd,this.uint16[xf+24]=Bd,this.uint16[xf+25]=Rd,this.uint16[xf+26]=bf,this.uint16[xf+27]=qf,this.uint16[xf+28]=Xd,this.uint32[dp+15]=kf,this.float32[dp+16]=Df,this.float32[dp+17]=Ff,this.float32[dp+18]=Yf,l}}Lm.prototype.bytesPerElement=76,_e(Lm,"StructArrayLayout3i2f6i15ui1ul3f76");class Rm extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}Rm.prototype.bytesPerElement=4,_e(Rm,"StructArrayLayout1f4");class Vm extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,y,M,N){const q=this.length;return this.resize(q+1),this.emplace(q,l,d,y,M,N)}emplace(l,d,y,M,N,q){const St=5*l;return this.float32[St+0]=d,this.float32[St+1]=y,this.float32[St+2]=M,this.float32[St+3]=N,this.float32[St+4]=q,l}}Vm.prototype.bytesPerElement=20,_e(Vm,"StructArrayLayout5f20");class i_ extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,y,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,d,y,M)}emplace(l,d,y,M,N){const q=6*l;return this.uint32[3*l+0]=d,this.uint16[q+2]=y,this.uint16[q+3]=M,this.uint16[q+4]=N,l}}i_.prototype.bytesPerElement=12,_e(i_,"StructArrayLayout1ul3ui12");class qg extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){const y=this.length;return this.resize(y+1),this.emplace(y,l,d)}emplace(l,d,y){const M=2*l;return this.uint16[M+0]=d,this.uint16[M+1]=y,l}}qg.prototype.bytesPerElement=4,_e(qg,"StructArrayLayout2ui4");class ey extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}ey.prototype.bytesPerElement=2,_e(ey,"StructArrayLayout1ui2");class ty extends dd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){const y=this.length;return this.resize(y+1),this.emplace(y,l,d)}emplace(l,d,y){const M=2*l;return this.float32[M+0]=d,this.float32[M+1]=y,l}}ty.prototype.bytesPerElement=8,_e(ty,"StructArrayLayout2f8");class pm extends ld{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pm.prototype.size=40;class Om extends Mp{get(l){return new pm(this,l)}}_e(Om,"CollisionBoxArray");class vm extends ld{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(l){this._structArray.uint8[this._pos1+49]=l}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(l){this._structArray.uint8[this._pos1+50]=l}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(l){this._structArray.uint32[this._pos4+13]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(l){this._structArray.uint8[this._pos1+58]=l}}vm.prototype.size=60;class kg extends _m{get(l){return new vm(this,l)}}_e(kg,"PlacedSymbolArray");class N_ extends ld{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(l){this._structArray.uint32[this._pos4+15]=l}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}N_.prototype.size=76;class $m extends Lm{get(l){return new N_(this,l)}}_e($m,"SymbolInstanceArray");class u_ extends Rm{getoffsetX(l){return this.float32[1*l+0]}}_e(u_,"GlyphOffsetArray");class l1 extends Af{getx(l){return this.int16[2*l+0]}gety(l){return this.int16[2*l+1]}}_e(l1,"SymbolLineVertexArray");class gy extends ld{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gy.prototype.size=12;class O0 extends i_{get(l){return new gy(this,l)}}_e(O0,"FeatureIndexArray");class $0 extends qg{geta_centroid_pos0(l){return this.uint16[2*l+0]}geta_centroid_pos1(l){return this.uint16[2*l+1]}}_e($0,"FillExtrusionCentroidArray");const nv=ud([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Tv=ud([{name:"a_dash",components:4,type:"Uint16"}]);var I1={exports:{}},c1={exports:{}};c1.exports=function(c,l){var d,y,M,N,q,St,Ht,Ui;for(y=c.length-(d=3&c.length),M=l,q=3432918353,St=461845907,Ui=0;Ui<y;)Ht=255&c.charCodeAt(Ui)|(255&c.charCodeAt(++Ui))<<8|(255&c.charCodeAt(++Ui))<<16|(255&c.charCodeAt(++Ui))<<24,++Ui,M=27492+(65535&(N=5*(65535&(M=(M^=Ht=(65535&(Ht=(Ht=(65535&Ht)*q+(((Ht>>>16)*q&65535)<<16)&4294967295)<<15|Ht>>>17))*St+(((Ht>>>16)*St&65535)<<16)&4294967295)<<13|M>>>19))+((5*(M>>>16)&65535)<<16)&4294967295))+((58964+(N>>>16)&65535)<<16);switch(Ht=0,d){case 3:Ht^=(255&c.charCodeAt(Ui+2))<<16;case 2:Ht^=(255&c.charCodeAt(Ui+1))<<8;case 1:M^=Ht=(65535&(Ht=(Ht=(65535&(Ht^=255&c.charCodeAt(Ui)))*q+(((Ht>>>16)*q&65535)<<16)&4294967295)<<15|Ht>>>17))*St+(((Ht>>>16)*St&65535)<<16)&4294967295}return M^=c.length,M=2246822507*(65535&(M^=M>>>16))+((2246822507*(M>>>16)&65535)<<16)&4294967295,M=3266489909*(65535&(M^=M>>>13))+((3266489909*(M>>>16)&65535)<<16)&4294967295,(M^=M>>>16)>>>0};var tx=c1.exports,rw={exports:{}};rw.exports=function(c,l){for(var d,y=c.length,M=l^y,N=0;y>=4;)d=1540483477*(65535&(d=255&c.charCodeAt(N)|(255&c.charCodeAt(++N))<<8|(255&c.charCodeAt(++N))<<16|(255&c.charCodeAt(++N))<<24))+((1540483477*(d>>>16)&65535)<<16),M=1540483477*(65535&M)+((1540483477*(M>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),y-=4,++N;switch(y){case 3:M^=(255&c.charCodeAt(N+2))<<16;case 2:M^=(255&c.charCodeAt(N+1))<<8;case 1:M=1540483477*(65535&(M^=255&c.charCodeAt(N)))+((1540483477*(M>>>16)&65535)<<16)}return M=1540483477*(65535&(M^=M>>>13))+((1540483477*(M>>>16)&65535)<<16),(M^=M>>>15)>>>0};var Ax=tx,Yw=rw.exports;I1.exports=Ax,I1.exports.murmur3=Ax,I1.exports.murmur2=Yw;var qv=Io(I1.exports);class Px{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,y,M){this.ids.push(wg(l)),this.positions.push(d,y,M)}getPositions(l){const d=wg(l);let y=0,M=this.ids.length-1;for(;y<M;){const q=y+M>>1;this.ids[q]>=d?M=q:y=q+1}const N=[];for(;this.ids[y]===d;)N.push({index:this.positions[3*y],start:this.positions[3*y+1],end:this.positions[3*y+2]}),y++;return N}static serialize(l,d){const y=new Float64Array(l.ids),M=new Uint32Array(l.positions);return C1(y,M,0,y.length-1),d&&d.push(y.buffer,M.buffer),{ids:y,positions:M}}static deserialize(l){const d=new Px;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function wg(c){const l=+c;return!isNaN(l)&&Number.MIN_SAFE_INTEGER<=l&&l<=Number.MAX_SAFE_INTEGER?l:qv(String(c))}function C1(c,l,d,y){for(;d<y;){const M=c[d+y>>1];let N=d-1,q=y+1;for(;;){do N++;while(c[N]<M);do q--;while(c[q]>M);if(N>=q)break;ix(c,N,q),ix(l,3*N,3*q),ix(l,3*N+1,3*q+1),ix(l,3*N+2,3*q+2)}q-d<y-q?(C1(c,l,d,q),d=q+1):(C1(c,l,q+1,y),y=q)}}function ix(c,l,d){const y=c[l];c[l]=c[d],c[d]=y}_e(Px,"FeaturePositionMap");class y0{constructor(l){this.gl=l.gl,this.initialized=!1}fetchUniformLocation(l,d){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(l,d),this.initialized=!0),!!this.location}}class u1 extends y0{constructor(l){super(l),this.current=0}set(l,d,y){this.fetchUniformLocation(l,d)&&this.current!==y&&(this.current=y,this.gl.uniform1f(this.location,y))}}class M1 extends y0{constructor(l){super(l),this.current=[0,0,0,0]}set(l,d,y){this.fetchUniformLocation(l,d)&&(y[0]===this.current[0]&&y[1]===this.current[1]&&y[2]===this.current[2]&&y[3]===this.current[3]||(this.current=y,this.gl.uniform4f(this.location,y[0],y[1],y[2],y[3])))}}class cb extends y0{constructor(l){super(l),this.current=jm.transparent}set(l,d,y){this.fetchUniformLocation(l,d)&&(y.r===this.current.r&&y.g===this.current.g&&y.b===this.current.b&&y.a===this.current.a||(this.current=y,this.gl.uniform4f(this.location,y.r,y.g,y.b,y.a)))}}const nw=new Float32Array(16),rx=new Float32Array(9),ub=new Float32Array(4);function nx(c){return[rd(255*c.r,255*c.g),rd(255*c.b,255*c.a)]}class ox{constructor(l,d,y){this.value=l,this.uniformNames=d.map(M=>`u_${M}`),this.type=y}setUniform(l,d,y,M,N){d.set(l,N,M.constantOr(this.value))}getBinding(l,d){return this.type==="color"?new cb(l):new u1(l)}}class h1{constructor(l,d){this.uniformNames=d.map(y=>`u_${y}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(l){this.pixelRatio=l.pixelRatio||1,this.pattern=l.tl.concat(l.br)}setUniform(l,d,y,M,N){const q=N==="u_pattern"||N==="u_dash"?this.pattern:N==="u_pixel_ratio"?this.pixelRatio:null;q&&d.set(l,N,q)}getBinding(l,d){return d==="u_pattern"||d==="u_dash"?new M1(l):new u1(l)}}class t0{constructor(l,d,y,M){this.expression=l,this.type=y,this.maxValue=0,this.paintVertexAttributes=d.map(N=>({name:`a_${N}`,type:"Float32",components:y==="color"?2:1,offset:0})),this.paintVertexArray=new M}populatePaintArray(l,d,y,M,N,q){const St=this.paintVertexArray.length,Ht=this.expression.evaluate(new Gn(0),d,{},N,M,q);this.paintVertexArray.resize(l),this._setPaintValue(St,l,Ht)}updatePaintArray(l,d,y,M,N){const q=this.expression.evaluate({zoom:0},y,M,void 0,N);this._setPaintValue(l,d,q)}_setPaintValue(l,d,y){if(this.type==="color"){const M=nx(y);for(let N=l;N<d;N++)this.paintVertexArray.emplace(N,M[0],M[1])}else{for(let M=l;M<d;M++)this.paintVertexArray.emplace(M,y);this.maxValue=Math.max(this.maxValue,Math.abs(y))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class B0{constructor(l,d,y,M,N,q){this.expression=l,this.uniformNames=d.map(St=>`u_${St}_t`),this.type=y,this.useIntegerZoom=M,this.zoom=N,this.maxValue=0,this.paintVertexAttributes=d.map(St=>({name:`a_${St}`,type:"Float32",components:y==="color"?4:2,offset:0})),this.paintVertexArray=new q}populatePaintArray(l,d,y,M,N,q){const St=this.expression.evaluate(new Gn(this.zoom),d,{},N,M,q),Ht=this.expression.evaluate(new Gn(this.zoom+1),d,{},N,M,q),Ui=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(Ui,l,St,Ht)}updatePaintArray(l,d,y,M,N){const q=this.expression.evaluate({zoom:this.zoom},y,M,void 0,N),St=this.expression.evaluate({zoom:this.zoom+1},y,M,void 0,N);this._setPaintValue(l,d,q,St)}_setPaintValue(l,d,y,M){if(this.type==="color"){const N=nx(y),q=nx(M);for(let St=l;St<d;St++)this.paintVertexArray.emplace(St,N[0],N[1],q[0],q[1])}else{for(let N=l;N<d;N++)this.paintVertexArray.emplace(N,y,M);this.maxValue=Math.max(this.maxValue,Math.abs(y),Math.abs(M))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d,y,M,N){const q=this.useIntegerZoom?Math.floor(y.zoom):y.zoom,St=Cd(this.expression.interpolationFactor(q,this.zoom,this.zoom+1),0,1);d.set(l,N,St)}getBinding(l,d){return new u1(l)}}class ov{constructor(l,d,y,M,N){this.expression=l,this.layerId=N,this.paintVertexAttributes=(y==="array"?Tv:nv).members;for(let q=0;q<d.length;++q);this.paintVertexArray=new M}populatePaintArray(l,d,y){const M=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValues(M,l,d.patterns&&d.patterns[this.layerId],y)}updatePaintArray(l,d,y,M,N,q){this._setPaintValues(l,d,y.patterns&&y.patterns[this.layerId],q)}_setPaintValues(l,d,y,M){if(!M||!y)return;const N=M[y];if(!N)return;const{tl:q,br:St,pixelRatio:Ht}=N;for(let Ui=l;Ui<d;Ui++)this.paintVertexArray.emplace(Ui,q[0],q[1],St[0],St[1],Ht)}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zv{constructor(l,d,y=()=>!0){this.binders={},this._buffers=[];const M=[];for(const N in l.paint._values){if(!y(N))continue;const q=l.paint.get(N);if(!(q instanceof yh&&Ay(q.property.specification)))continue;const St=db(N,l.type),Ht=q.value,Ui=q.property.specification.type,Bn=!!q.property.useIntegerZoom,ls=N==="line-dasharray"||N.endsWith("pattern"),il=N==="line-dasharray"&&l.layout.get("line-cap").value.kind!=="constant";if(Ht.kind!=="constant"||il)if(Ht.kind==="source"||il||ls){const $u=ow(N,Ui,"source");this.binders[N]=ls?new ov(Ht,St,Ui,$u,l.id):new t0(Ht,St,Ui,$u),M.push(`/a_${N}`)}else{const $u=ow(N,Ui,"composite");this.binders[N]=new B0(Ht,St,Ui,Bn,d,$u),M.push(`/z_${N}`)}else this.binders[N]=ls?new h1(Ht.value,St):new ox(Ht.value,St,Ui),M.push(`/u_${N}`)}this.cacheKey=M.sort().join("")}getMaxValue(l){const d=this.binders[l];return d instanceof t0||d instanceof B0?d.maxValue:0}populatePaintArrays(l,d,y,M,N,q){for(const St in this.binders){const Ht=this.binders[St];(Ht instanceof t0||Ht instanceof B0||Ht instanceof ov)&&Ht.populatePaintArray(l,d,y,M,N,q)}}setConstantPatternPositions(l){for(const d in this.binders){const y=this.binders[d];y instanceof h1&&y.setConstantPatternPositions(l)}}updatePaintArrays(l,d,y,M,N,q){let St=!1;for(const Ht in l){const Ui=d.getPositions(Ht);for(const Bn of Ui){const ls=y.feature(Bn.index);for(const il in this.binders){const $u=this.binders[il];if(($u instanceof t0||$u instanceof B0||$u instanceof ov)&&$u.expression.isStateDependent===!0){const Ku=M.paint.get(il);$u.expression=Ku.value,$u.updatePaintArray(Bn.start,Bn.end,ls,l[Ht],N,q),St=!0}}}}return St}defines(){const l=[];for(const d in this.binders){const y=this.binders[d];(y instanceof ox||y instanceof h1)&&l.push(...y.uniformNames.map(M=>`#define HAS_UNIFORM_${M}`))}return l}getBinderAttributes(){const l=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof t0||y instanceof B0||y instanceof ov)for(let M=0;M<y.paintVertexAttributes.length;M++)l.push(y.paintVertexAttributes[M].name)}return l}getBinderUniforms(){const l=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof ox||y instanceof h1||y instanceof B0)for(const M of y.uniformNames)l.push(M)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l){const d=[];for(const y in this.binders){const M=this.binders[y];if(M instanceof ox||M instanceof h1||M instanceof B0)for(const N of M.uniformNames)d.push({name:N,property:y,binding:M.getBinding(l,N)})}return d}setUniforms(l,d,y,M,N){for(const{name:q,property:St,binding:Ht}of y)this.binders[St].setUniform(l,Ht,N,M.get(St),q)}updatePaintBuffers(){this._buffers=[];for(const l in this.binders){const d=this.binders[l];(d instanceof t0||d instanceof B0||d instanceof ov)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(l){for(const d in this.binders){const y=this.binders[d];(y instanceof t0||y instanceof B0||y instanceof ov)&&y.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const d=this.binders[l];(d instanceof t0||d instanceof B0||d instanceof ov)&&d.destroy()}}}class Iv{constructor(l,d,y=()=>!0){this.programConfigurations={};for(const M of l)this.programConfigurations[M.id]=new Zv(M,d,y);this.needsUpload=!1,this._featureMap=new Px,this._bufferOffset=0}populatePaintArrays(l,d,y,M,N,q,St){for(const Ht in this.programConfigurations)this.programConfigurations[Ht].populatePaintArrays(l,d,M,N,q,St);d.id!==void 0&&this._featureMap.add(d.id,y,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,y,M,N){for(const q of y)this.needsUpload=this.programConfigurations[q.id].updatePaintArrays(l,this._featureMap,d,q,M,N)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}const hb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function db(c,l){return hb[c]||[c.replace(`${l}-`,"").replace(/-/g,"_")]}const Jw={"line-pattern":{source:Dd,composite:Dd},"fill-pattern":{source:Dd,composite:Dd},"fill-extrusion-pattern":{source:Dd,composite:Dd},"line-dasharray":{source:yf,composite:yf}},Qw={color:{source:ty,composite:Lf},number:{source:Rm,composite:ty}};function ow(c,l,d){const y=Jw[c];return y&&y[d]||Qw[l][d]}_e(ox,"ConstantBinder"),_e(h1,"PatternConstantBinder"),_e(t0,"SourceExpressionBinder"),_e(ov,"PatternCompositeBinder"),_e(B0,"CompositeExpressionBinder"),_e(Zv,"ProgramConfiguration",{omit:["_buffers"]}),_e(Iv,"ProgramConfigurationSet");const aw="-transition";class N0 extends by{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&l.type!=="sky"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Eh(d.layout)),d.paint)){this._transitionablePaint=new Wu(d.paint);for(const y in l.paint)this.setPaintProperty(y,l.paint[y],{validate:!1});for(const y in l.layout)this.setLayoutProperty(y,l.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ih(d.paint)}}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,y={}){d!=null&&this._validate(ex,`layers.${this.id}.layout.${l}`,l,d,y)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return cd(l,aw)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,y={}){if(d!=null&&this._validate(Q1,`layers.${this.id}.paint.${l}`,l,d,y))return!1;if(cd(l,aw))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{const M=this._transitionablePaint._values[l],N=M.value.isDataDriven(),q=M.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);const St=this._transitionablePaint._values[l].value,Ht=St.isDataDriven(),Ui=cd(l,"pattern")||l==="line-dasharray";return Ht||N||Ui||this._handleOverridablePaintPropertyUpdate(l,q,St)}}_handleSpecialPaintPropertyUpdate(l){}getProgramIds(){return null}getProgramConfiguration(l){return null}_handleOverridablePaintPropertyUpdate(l,d,y){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),bp(l,(d,y)=>!(d===void 0||y==="layout"&&!Object.keys(d).length||y==="paint"&&!Object.keys(d).length))}_validate(l,d,y,M,N={}){return(!N||N.validate!==!1)&&T1(this,l.call(rv,{key:d,layerType:this.type,objectKey:y,value:M,styleSpec:Yd,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const d=this.paint.get(l);if(d instanceof yh&&Ay(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=p0(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Hv=ud([{name:"a_pos",components:2,type:"Int16"}],4),e2=ud([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Eg{constructor(l=[]){this.segments=l}prepareSegment(l,d,y,M){let N=this.segments[this.segments.length-1];return l>Eg.MAX_VERTEX_ARRAY_LENGTH&&Vd(`Max vertices per segment is ${Eg.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!N||N.vertexLength+l>Eg.MAX_VERTEX_ARRAY_LENGTH||N.sortKey!==M)&&(N={vertexOffset:d.length,primitiveOffset:y.length,vertexLength:0,primitiveLength:0},M!==void 0&&(N.sortKey=M),this.segments.push(N)),N}get(){return this.segments}destroy(){for(const l of this.segments)for(const d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,y,M){return new Eg([{vertexOffset:l,primitiveOffset:d,vertexLength:y,primitiveLength:M,vaos:{},sortKey:0}])}}Eg.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_e(Eg,"SegmentVector");var Rp=8192;class Xv{constructor(l,d){l&&(d?this.setSouthWest(l).setNorthEast(d):l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1]))}setNorthEast(l){return this._ne=l instanceof Bm?new Bm(l.lng,l.lat):Bm.convert(l),this}setSouthWest(l){return this._sw=l instanceof Bm?new Bm(l.lng,l.lat):Bm.convert(l),this}extend(l){const d=this._sw,y=this._ne;let M,N;if(l instanceof Bm)M=l,N=l;else{if(!(l instanceof Xv))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Xv.convert(l)):this.extend(Bm.convert(l)):typeof l=="object"&&l!==null&&l.hasOwnProperty("lat")&&(l.hasOwnProperty("lon")||l.hasOwnProperty("lng"))?this.extend(Bm.convert(l)):this;if(M=l._sw,N=l._ne,!M||!N)return this}return d||y?(d.lng=Math.min(M.lng,d.lng),d.lat=Math.min(M.lat,d.lat),y.lng=Math.max(N.lng,y.lng),y.lat=Math.max(N.lat,y.lat)):(this._sw=new Bm(M.lng,M.lat),this._ne=new Bm(N.lng,N.lat)),this}getCenter(){return new Bm((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Bm(this.getWest(),this.getNorth())}getSouthEast(){return new Bm(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:d,lat:y}=Bm.convert(l);let M=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(M=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&M}static convert(l){return!l||l instanceof Xv?l:new Xv(l)}}var kx=1e-6,Ly=typeof Float32Array<"u"?Float32Array:Array;function fb(){var c=new Ly(9);return Ly!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function pb(c,l,d){var y=l[0],M=l[1],N=l[2],q=l[3],St=l[4],Ht=l[5],Ui=l[6],Bn=l[7],ls=l[8],il=d[0],$u=d[1],Ku=d[2],rh=d[3],vh=d[4],Ph=d[5],Xh=d[6],Dh=d[7],jh=d[8];return c[0]=il*y+$u*q+Ku*Ui,c[1]=il*M+$u*St+Ku*Bn,c[2]=il*N+$u*Ht+Ku*ls,c[3]=rh*y+vh*q+Ph*Ui,c[4]=rh*M+vh*St+Ph*Bn,c[5]=rh*N+vh*Ht+Ph*ls,c[6]=Xh*y+Dh*q+jh*Ui,c[7]=Xh*M+Dh*St+jh*Bn,c[8]=Xh*N+Dh*Ht+jh*ls,c}function z0(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function mb(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],q=l[4],St=l[5],Ht=l[6],Ui=l[7],Bn=l[8],ls=l[9],il=l[10],$u=l[11],Ku=l[12],rh=l[13],vh=l[14],Ph=l[15],Xh=d*St-y*q,Dh=d*Ht-M*q,jh=d*Ui-N*q,ad=y*Ht-M*St,nd=y*Ui-N*St,Bd=M*Ui-N*Ht,Rd=Bn*rh-ls*Ku,bf=Bn*vh-il*Ku,qf=Bn*Ph-$u*Ku,Xd=ls*vh-il*rh,kf=ls*Ph-$u*rh,Df=il*Ph-$u*vh,Ff=Xh*Df-Dh*kf+jh*Xd+ad*qf-nd*bf+Bd*Rd;return Ff?(c[0]=(St*Df-Ht*kf+Ui*Xd)*(Ff=1/Ff),c[1]=(M*kf-y*Df-N*Xd)*Ff,c[2]=(rh*Bd-vh*nd+Ph*ad)*Ff,c[3]=(il*nd-ls*Bd-$u*ad)*Ff,c[4]=(Ht*qf-q*Df-Ui*bf)*Ff,c[5]=(d*Df-M*qf+N*bf)*Ff,c[6]=(vh*jh-Ku*Bd-Ph*Dh)*Ff,c[7]=(Bn*Bd-il*jh+$u*Dh)*Ff,c[8]=(q*kf-St*qf+Ui*Rd)*Ff,c[9]=(y*qf-d*kf-N*Rd)*Ff,c[10]=(Ku*nd-rh*jh+Ph*Xh)*Ff,c[11]=(ls*jh-Bn*nd-$u*Xh)*Ff,c[12]=(St*bf-q*Xd-Ht*Rd)*Ff,c[13]=(d*Xd-y*bf+M*Rd)*Ff,c[14]=(rh*Dh-Ku*ad-vh*Xh)*Ff,c[15]=(Bn*ad-ls*Dh+il*Xh)*Ff,c):null}function d1(c,l,d){var y=l[0],M=l[1],N=l[2],q=l[3],St=l[4],Ht=l[5],Ui=l[6],Bn=l[7],ls=l[8],il=l[9],$u=l[10],Ku=l[11],rh=l[12],vh=l[13],Ph=l[14],Xh=l[15],Dh=d[0],jh=d[1],ad=d[2],nd=d[3];return c[0]=Dh*y+jh*St+ad*ls+nd*rh,c[1]=Dh*M+jh*Ht+ad*il+nd*vh,c[2]=Dh*N+jh*Ui+ad*$u+nd*Ph,c[3]=Dh*q+jh*Bn+ad*Ku+nd*Xh,c[4]=(Dh=d[4])*y+(jh=d[5])*St+(ad=d[6])*ls+(nd=d[7])*rh,c[5]=Dh*M+jh*Ht+ad*il+nd*vh,c[6]=Dh*N+jh*Ui+ad*$u+nd*Ph,c[7]=Dh*q+jh*Bn+ad*Ku+nd*Xh,c[8]=(Dh=d[8])*y+(jh=d[9])*St+(ad=d[10])*ls+(nd=d[11])*rh,c[9]=Dh*M+jh*Ht+ad*il+nd*vh,c[10]=Dh*N+jh*Ui+ad*$u+nd*Ph,c[11]=Dh*q+jh*Bn+ad*Ku+nd*Xh,c[12]=(Dh=d[12])*y+(jh=d[13])*St+(ad=d[14])*ls+(nd=d[15])*rh,c[13]=Dh*M+jh*Ht+ad*il+nd*vh,c[14]=Dh*N+jh*Ui+ad*$u+nd*Ph,c[15]=Dh*q+jh*Bn+ad*Ku+nd*Xh,c}function ax(c,l,d){var y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh=d[0],vh=d[1],Ph=d[2];return l===c?(c[12]=l[0]*rh+l[4]*vh+l[8]*Ph+l[12],c[13]=l[1]*rh+l[5]*vh+l[9]*Ph+l[13],c[14]=l[2]*rh+l[6]*vh+l[10]*Ph+l[14],c[15]=l[3]*rh+l[7]*vh+l[11]*Ph+l[15]):(M=l[1],N=l[2],q=l[3],St=l[4],Ht=l[5],Ui=l[6],Bn=l[7],ls=l[8],il=l[9],$u=l[10],Ku=l[11],c[0]=y=l[0],c[1]=M,c[2]=N,c[3]=q,c[4]=St,c[5]=Ht,c[6]=Ui,c[7]=Bn,c[8]=ls,c[9]=il,c[10]=$u,c[11]=Ku,c[12]=y*rh+St*vh+ls*Ph+l[12],c[13]=M*rh+Ht*vh+il*Ph+l[13],c[14]=N*rh+Ui*vh+$u*Ph+l[14],c[15]=q*rh+Bn*vh+Ku*Ph+l[15]),c}function Cv(c,l,d){var y=d[0],M=d[1],N=d[2];return c[0]=l[0]*y,c[1]=l[1]*y,c[2]=l[2]*y,c[3]=l[3]*y,c[4]=l[4]*M,c[5]=l[5]*M,c[6]=l[6]*M,c[7]=l[7]*M,c[8]=l[8]*N,c[9]=l[9]*N,c[10]=l[10]*N,c[11]=l[11]*N,c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c}function f1(c,l,d){var y=Math.sin(d),M=Math.cos(d),N=l[4],q=l[5],St=l[6],Ht=l[7],Ui=l[8],Bn=l[9],ls=l[10],il=l[11];return l!==c&&(c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[4]=N*M+Ui*y,c[5]=q*M+Bn*y,c[6]=St*M+ls*y,c[7]=Ht*M+il*y,c[8]=Ui*M-N*y,c[9]=Bn*M-q*y,c[10]=ls*M-St*y,c[11]=il*M-Ht*y,c}function A1(c,l,d){var y=Math.sin(d),M=Math.cos(d),N=l[0],q=l[1],St=l[2],Ht=l[3],Ui=l[8],Bn=l[9],ls=l[10],il=l[11];return l!==c&&(c[4]=l[4],c[5]=l[5],c[6]=l[6],c[7]=l[7],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=N*M-Ui*y,c[1]=q*M-Bn*y,c[2]=St*M-ls*y,c[3]=Ht*M-il*y,c[8]=N*y+Ui*M,c[9]=q*y+Bn*M,c[10]=St*y+ls*M,c[11]=Ht*y+il*M,c}function sw(c,l){return c[0]=l[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function lw(c,l,d){var y,M,N,q=d[0],St=d[1],Ht=d[2],Ui=Math.hypot(q,St,Ht);return Ui<kx?null:(q*=Ui=1/Ui,St*=Ui,Ht*=Ui,y=Math.sin(l),M=Math.cos(l),c[0]=q*q*(N=1-M)+M,c[1]=St*q*N+Ht*y,c[2]=Ht*q*N-St*y,c[3]=0,c[4]=q*St*N-Ht*y,c[5]=St*St*N+M,c[6]=Ht*St*N+q*y,c[7]=0,c[8]=q*Ht*N+St*y,c[9]=St*Ht*N-q*y,c[10]=Ht*Ht*N+M,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)});var t2=d1;function p1(){var c=new Ly(3);return Ly!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function gb(c){var l=new Ly(3);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l}function sx(c){return Math.hypot(c[0],c[1],c[2])}function P1(c,l,d){var y=new Ly(3);return y[0]=c,y[1]=l,y[2]=d,y}function Mv(c,l,d){return c[0]=l[0]+d[0],c[1]=l[1]+d[1],c[2]=l[2]+d[2],c}function _b(c,l,d){return c[0]=l[0]-d[0],c[1]=l[1]-d[1],c[2]=l[2]-d[2],c}function uw(c,l,d){return c[0]=l[0]*d[0],c[1]=l[1]*d[1],c[2]=l[2]*d[2],c}function lx(c,l,d){return c[0]=Math.min(l[0],d[0]),c[1]=Math.min(l[1],d[1]),c[2]=Math.min(l[2],d[2]),c}function k1(c,l,d){return c[0]=Math.max(l[0],d[0]),c[1]=Math.max(l[1],d[1]),c[2]=Math.max(l[2],d[2]),c}function _y(c,l,d){return c[0]=l[0]*d,c[1]=l[1]*d,c[2]=l[2]*d,c}function cx(c,l,d,y){return c[0]=l[0]+d[0]*y,c[1]=l[1]+d[1]*y,c[2]=l[2]+d[2]*y,c}function z_(c,l){var d=l[0],y=l[1],M=l[2],N=d*d+y*y+M*M;return N>0&&(N=1/Math.sqrt(N)),c[0]=l[0]*N,c[1]=l[1]*N,c[2]=l[2]*N,c}function i0(c,l){return c[0]*l[0]+c[1]*l[1]+c[2]*l[2]}function Dx(c,l,d){var y=l[0],M=l[1],N=l[2],q=d[0],St=d[1],Ht=d[2];return c[0]=M*Ht-N*St,c[1]=N*q-y*Ht,c[2]=y*St-M*q,c}function Sg(c,l,d){var y=l[0],M=l[1],N=l[2],q=d[3]*y+d[7]*M+d[11]*N+d[15];return c[0]=(d[0]*y+d[4]*M+d[8]*N+d[12])/(q=q||1),c[1]=(d[1]*y+d[5]*M+d[9]*N+d[13])/q,c[2]=(d[2]*y+d[6]*M+d[10]*N+d[14])/q,c}function hw(c,l,d){var y=d[0],M=d[1],N=d[2],q=l[0],St=l[1],Ht=l[2],Ui=M*Ht-N*St,Bn=N*q-y*Ht,ls=y*St-M*q,il=M*ls-N*Bn,$u=N*Ui-y*ls,Ku=y*Bn-M*Ui,rh=2*d[3];return Bn*=rh,ls*=rh,$u*=2,Ku*=2,c[0]=q+(Ui*=rh)+(il*=2),c[1]=St+Bn+$u,c[2]=Ht+ls+Ku,c}var ux,v0=_b,i2=uw,r2=sx;function D1(c,l,d){return c[0]=l[0]*d,c[1]=l[1]*d,c[2]=l[2]*d,c[3]=l[3]*d,c}function r_(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],q=d*d+y*y+M*M+N*N;return q>0&&(q=1/Math.sqrt(q)),c[0]=d*q,c[1]=y*q,c[2]=M*q,c[3]=N*q,c}function Av(c,l,d){var y=l[0],M=l[1],N=l[2],q=l[3];return c[0]=d[0]*y+d[4]*M+d[8]*N+d[12]*q,c[1]=d[1]*y+d[5]*M+d[9]*N+d[13]*q,c[2]=d[2]*y+d[6]*M+d[10]*N+d[14]*q,c[3]=d[3]*y+d[7]*M+d[11]*N+d[15]*q,c}function yb(){var c=new Ly(4);return Ly!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function vb(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Gm(c,l,d){d*=.5;var y=l[0],M=l[1],N=l[2],q=l[3],St=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht+q*St,c[1]=M*Ht+N*St,c[2]=N*Ht-M*St,c[3]=q*Ht-y*St,c}function Pv(c,l,d){d*=.5;var y=l[0],M=l[1],N=l[2],q=l[3],St=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht-N*St,c[1]=M*Ht+q*St,c[2]=N*Ht+y*St,c[3]=q*Ht-M*St,c}p1(),ux=new Ly(4),Ly!=Float32Array&&(ux[0]=0,ux[1]=0,ux[2]=0,ux[3]=0);var xb=r_;p1(),P1(1,0,0),P1(0,1,0),yb(),yb(),fb();const dw=ud([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:bb}=dw,av=ud([{name:"a_pos_3",components:3,type:"Int16"}]);var sv=ud([{name:"a_pos",type:"Int16",components:2}]);class Lx{constructor(l,d){this.pos=l,this.dir=d}intersectsPlane(l,d,y){const M=i0(d,this.dir);if(Math.abs(M)<1e-6)return!1;const N=((l[0]-this.pos[0])*d[0]+(l[1]-this.pos[1])*d[1]+(l[2]-this.pos[2])*d[2])/M;return y[0]=this.pos[0]+this.dir[0]*N,y[1]=this.pos[1]+this.dir[1]*N,y[2]=this.pos[2]+this.dir[2]*N,!0}closestPointOnSphere(l,d,y){if(function($u,Ku){var rh=$u[0],vh=$u[1],Ph=$u[2],Xh=Ku[0],Dh=Ku[1],jh=Ku[2];return Math.abs(rh-Xh)<=kx*Math.max(1,Math.abs(rh),Math.abs(Xh))&&Math.abs(vh-Dh)<=kx*Math.max(1,Math.abs(vh),Math.abs(Dh))&&Math.abs(Ph-jh)<=kx*Math.max(1,Math.abs(Ph),Math.abs(jh))}(this.pos,l)||d===0)return y[0]=y[1]=y[2]=0,!1;const[M,N,q]=this.dir,St=this.pos[0]-l[0],Ht=this.pos[1]-l[1],Ui=this.pos[2]-l[2],Bn=M*M+N*N+q*q,ls=2*(St*M+Ht*N+Ui*q),il=ls*ls-4*Bn*(St*St+Ht*Ht+Ui*Ui-d*d);if(il<0){const $u=Math.max(-ls/2,0),Ku=St+M*$u,rh=Ht+N*$u,vh=Ui+q*$u,Ph=Math.hypot(Ku,rh,vh);return y[0]=Ku*d/Ph,y[1]=rh*d/Ph,y[2]=vh*d/Ph,!1}{const $u=(-ls-Math.sqrt(il))/(2*Bn);if($u<0){const Ku=Math.hypot(St,Ht,Ui);return y[0]=St*d/Ku,y[1]=Ht*d/Ku,y[2]=Ui*d/Ku,!1}return y[0]=St+M*$u,y[1]=Ht+N*$u,y[2]=Ui+q*$u,!0}}}class wb{constructor(l,d,y,M,N){this.TL=l,this.TR=d,this.BR=y,this.BL=M,this.horizon=N}static fromInvProjectionMatrix(l,d,y){const M=[-1,1,1],N=[1,1,1],q=[1,-1,1],St=[-1,-1,1],Ht=Sg(M,M,l),Ui=Sg(N,N,l),Bn=Sg(q,q,l),ls=Sg(St,St,l);return new wb(Ht,Ui,Bn,ls,d/y)}}class Eb{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,y,M){const N=Math.pow(2,y),q=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(Ht=>{const Ui=Av([],Ht,l),Bn=1/Ui[3]/d*N;return function(ls,il,$u){return ls[0]=il[0]*$u[0],ls[1]=il[1]*$u[1],ls[2]=il[2]*$u[2],ls[3]=il[3]*$u[3],ls}(Ui,Ui,[Bn,Bn,M?1/Ui[3]:Bn,Bn])}),St=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(Ht=>{const Ui=z_([],Dx([],v0([],q[Ht[0]],q[Ht[1]]),v0([],q[Ht[2]],q[Ht[1]]))),Bn=-i0(Ui,q[Ht[1]]);return Ui.concat(Bn)});return new Eb(q,St)}}class iy{static fromPoints(l){const d=[1/0,1/0,1/0],y=[-1/0,-1/0,-1/0];for(const M of l)lx(d,d,M),k1(y,y,M);return new iy(d,y)}static applyTransform(l,d){const y=l.getCorners();for(let M=0;M<y.length;++M)Sg(y[M],y[M],d);return iy.fromPoints(y)}constructor(l,d){this.min=l,this.max=d,this.center=_y([],Mv([],this.min,this.max),.5)}quadrant(l){const d=[l%2==0,l<2],y=gb(this.min),M=gb(this.max);for(let N=0;N<d.length;N++)y[N]=d[N]?this.min[N]:this.center[N],M[N]=d[N]?this.center[N]:this.max[N];return M[2]=this.max[2],new iy(y,M)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}getCorners(){const l=this.min,d=this.max;return[[l[0],l[1],l[2]],[d[0],l[1],l[2]],[d[0],d[1],l[2]],[l[0],d[1],l[2]],[l[0],l[1],d[2]],[d[0],l[1],d[2]],[d[0],d[1],d[2]],[l[0],d[1],d[2]]]}intersects(l){const d=this.getCorners();let y=!0;for(let M=0;M<l.planes.length;M++){const N=l.planes[M];let q=0;for(let St=0;St<d.length;St++)q+=i0(N,d[St])+N[3]>=0;if(q===0)return 0;q!==d.length&&(y=!1)}if(y)return 2;for(let M=0;M<3;M++){let N=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let St=0;St<l.points.length;St++){const Ht=l.points[St][M]-this.min[M];N=Math.min(N,Ht),q=Math.max(q,Ht)}if(q<0||N>this.max[M]-this.min[M])return 0}return 1}}const Sb=5,fw=6,lv=Rp/Math.PI/2,n2=16383,m1=64,hx=[m1,32,16],yy=-lv,F_=lv,pw=[new iy([yy,yy,yy],[F_,F_,F_]),new iy([yy,yy,yy],[0,0,F_]),new iy([0,yy,yy],[F_,0,F_]),new iy([yy,0,yy],[0,F_,F_]),new iy([0,0,yy],[F_,F_,F_])];function Rx(c){return c*lv/F1}function mw(c,l,d,y=!0){const M=_y([],c._camera.position,c.worldSize),N=[l,d,1,1];Av(N,N,c.pixelMatrixInverse),D1(N,N,1/N[3]);const q=z_([],v0([],N,M)),St=c.globeMatrix,Ht=[St[12],St[13],St[14]],Ui=v0([],Ht,M),Bn=sx(Ui),ls=z_([],Ui),il=c.worldSize/(2*Math.PI),$u=i0(ls,q),Ku=Math.asin(il/Bn);if(Ku<Math.acos($u)){if(!y)return null;const qf=[],Xd=[];_y(qf,q,Bn/$u),z_(Xd,v0(Xd,qf,Ui)),z_(q,Mv(q,Ui,_y(q,Xd,Math.tan(Ku)*Bn)))}const rh=[];new Lx(M,q).closestPointOnSphere(Ht,il,rh);const vh=z_([],Yh(St,0)),Ph=z_([],Yh(St,1)),Xh=z_([],Yh(St,2)),Dh=i0(vh,rh),jh=i0(Ph,rh),ad=i0(Xh,rh),nd=Sh(Math.asin(-jh/il));let Bd=Sh(Math.atan2(Dh,ad));Bd=c.center.lng+function(qf,Xd){const kf=(Xd-qf+180)%360-180;return kf<-180?kf+360:kf}(c.center.lng,Bd);const Rd=uv(Bd),bf=Cd(F0(nd),0,1);return new Dv(Rd,bf)}class o2{constructor(l,d,y){this.a=v0([],l,y),this.b=v0([],d,y),this.center=y;const M=z_([],this.a),N=z_([],this.b);this.angle=Math.acos(i0(M,N))}}function Ox(c,l){if(c.angle===0)return null;let d;return d=c.a[l]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[l]/c.a[l]/Math.sin(c.angle)-1/Math.tan(c.angle)),d<0||d>1?null:function(y,M,N,q){const St=Math.sin(N);return y*(Math.sin((1-q)*N)/St)+M*(Math.sin(q*N)/St)}(c.a[l],c.b[l],c.angle,Cd(d,0,1))+c.center[l]}function x0(c){if(c.z<=1)return pw[c.z+2*c.y+c.x];const l=O1(g1(c));return iy.fromPoints(l)}function Kv(c,l,d){return _y(c,c,1-d),cx(c,c,l,d)}function dx(c,l){const d=z1(l.zoom);if(d===0)return x0(c);const y=g1(c),M=O1(y),N=uv(y.getWest())*l.worldSize,q=uv(y.getEast())*l.worldSize,St=F0(y.getNorth())*l.worldSize,Ht=F0(y.getSouth())*l.worldSize,Ui=[N,St,0],Bn=[q,St,0],ls=[N,Ht,0],il=[q,Ht,0],$u=mb([],l.globeMatrix);return Sg(Ui,Ui,$u),Sg(Bn,Bn,$u),Sg(ls,ls,$u),Sg(il,il,$u),M[0]=Kv(M[0],ls,d),M[1]=Kv(M[1],il,d),M[2]=Kv(M[2],Bn,d),M[3]=Kv(M[3],Ui,d),iy.fromPoints(M)}function L1(c,l,d){for(const y of c)Sg(y,y,l),_y(y,y,d)}function R1(c,l,d){const y=l/c.worldSize,M=c.globeMatrix;if(d.z<=1){const Rd=x0(d).getCorners();return L1(Rd,M,y),iy.fromPoints(Rd)}const N=g1(d),q=O1(N);L1(q,M,y);const St=Number.MAX_VALUE,Ht=[-St,-St,-St],Ui=[St,St,St];if(N.contains(c.center)){for(const qf of q)lx(Ui,Ui,qf),k1(Ht,Ht,qf);Ht[2]=0;const Rd=c.point,bf=[Rd.x*y,Rd.y*y,0];return lx(Ui,Ui,bf),k1(Ht,Ht,bf),new iy(Ui,Ht)}const Bn=[M[12]*y,M[13]*y,M[14]*y],ls=N.getCenter(),il=Cd(c.center.lat,-Hg,Hg),$u=Cd(ls.lat,-Hg,Hg),Ku=uv(c.center.lng),rh=F0(il);let vh=Ku-uv(ls.lng);const Ph=rh-F0($u);vh>.5?vh-=1:vh<-.5&&(vh+=1);let Xh=0;Math.abs(vh)>Math.abs(Ph)?Xh=vh>=0?1:3:(Xh=Ph>=0?0:2,cx(Bn,Bn,[M[4]*y,M[5]*y,M[6]*y],-Math.sin(hh(Ph>=0?N.getSouth():N.getNorth()))*lv));const Dh=q[Xh],jh=q[(Xh+1)%4],ad=new o2(Dh,jh,Bn),nd=[Ox(ad,0)||Dh[0],Ox(ad,1)||Dh[1],Ox(ad,2)||Dh[2]],Bd=z1(c.zoom);if(Bd>0){const Rd=function({x:qf,y:Xd,z:kf},Df,Ff,Yf,xf){const dp=1/(1<<kf);let Sp=qf*dp,pp=Sp+dp,Qp=Xd*dp,Qf=Qp+dp,Up=0;const em=(Sp+pp)/2-Yf;return em>.5?Up=-1:em<-.5&&(Up=1),Sp=((Sp+Up)*Df-(Yf*=Df))*Ff+Yf,pp=((pp+Up)*Df-Yf)*Ff+Yf,Qp=(Qp*Df-(xf*=Df))*Ff+xf,Qf=(Qf*Df-xf)*Ff+xf,[[Sp,Qf,0],[pp,Qf,0],[pp,Qp,0],[Sp,Qp,0]]}(d,l,c._pixelsPerMercatorPixel,Ku,rh);for(let qf=0;qf<q.length;qf++)Kv(q[qf],Rd[qf],Bd);const bf=Mv([],Rd[Xh],Rd[(Xh+1)%4]);_y(bf,bf,.5),Kv(nd,bf,Bd)}for(const Rd of q)lx(Ui,Ui,Rd),k1(Ht,Ht,Rd);return Ui[2]=Math.min(Dh[2],jh[2]),lx(Ui,Ui,nd),k1(Ht,Ht,nd),new iy(Ui,Ht)}function g1({x:c,y:l,z:d}){const y=1/(1<<d),M=new Bm(Ry(c*y),Zg((l+1)*y)),N=new Bm(Ry((c+1)*y),Zg(l*y));return new Xv(M,N)}function O1(c){const l=hh(c.getNorth()),d=hh(c.getSouth()),y=Math.cos(l),M=Math.cos(d),N=Math.sin(l),q=Math.sin(d),St=c.getWest(),Ht=c.getEast();return[$1(M,q,St),$1(M,q,Ht),$1(y,N,Ht),$1(y,N,St)]}function $1(c,l,d,y=lv){return d=hh(d),[c*Math.sin(d)*y,-l*y,c*Math.cos(d)*y]}function _1(c,l,d){return $1(Math.cos(hh(c)),Math.sin(hh(c)),l,d)}function B1(c,l,d,y){const M=1<<d.z,N=(c/Rp+d.x)/M;return _1(Zg((l/Rp+d.y)/M),Ry(N),y)}function $x({min:c,max:l}){return n2/Math.max(l[0]-c[0],l[1]-c[1],l[2]-c[2])}const Tb=new Float64Array(16);function N1(c){const l=$x(c),d=sw(Tb,[l,l,l]);return ax(d,d,((y=[])[0]=-(M=c.min)[0],y[1]=-M[1],y[2]=-M[2],y));var y,M}function fx(c){const l=(y=c.min,(d=Tb)[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=y[0],d[13]=y[1],d[14]=y[2],d[15]=1,d);var d,y;const M=1/$x(c);return Cv(l,l,[M,M,M])}function Bx(c,l,d,y,M){const N=function(Ht){const Ui=Rp/(2*Math.PI);return Ht/(2*Math.PI)/Ui}(d),q=[c,l,-d/(2*Math.PI)],St=z0(new Float64Array(16));return ax(St,St,q),Cv(St,St,[N,N,N]),f1(St,St,hh(-M)),A1(St,St,hh(-y)),St}function z1(c){return Cf(Sb,fw,c)}function gw(c,l){const d=_1(l.lat,l.lng),y=function(Ku){const rh=_1(Ku._center.lat,Ku._center.lng);let vh=Dx([],P1(0,1,0),rh);const Ph=lw([],-Ku.angle,rh);vh=Sg(vh,vh,Ph),lw(Ph,-Ku._pitch,vh);const Xh=z_([],rh);return _y(Xh,Xh,Rx(Ku.cameraToCenterDistance/Ku.pixelsPerMeter)),Sg(Xh,Xh,Ph),Mv([],rh,Xh)}(c);return q=(M=_b([],y,d))[0],St=M[1],Ht=M[2],Ui=(N=d)[0],Bn=N[1],ls=N[2],$u=(il=Math.sqrt(q*q+St*St+Ht*Ht)*Math.sqrt(Ui*Ui+Bn*Bn+ls*ls))&&i0(M,N)/il,Math.acos(Math.min(Math.max($u,-1),1));var M,N,q,St,Ht,Ui,Bn,ls,il,$u}function Nx(c,l){return gw(c,l)>Math.PI/2*1.01}const cv=hh(85),_w=Math.cos(cv),Wv=Math.sin(cv),F1=63710088e-1,Ib=2*Math.PI*F1;class kv{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kv(Sd(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const d=Math.PI/180,y=this.lat*d,M=l.lat*d,N=Math.sin(y)*Math.sin(M)+Math.cos(y)*Math.cos(M)*Math.cos((l.lng-this.lng)*d);return F1*Math.acos(Math.min(N,1))}toBounds(l=0){const d=360*l/40075017,y=d/Math.cos(Math.PI/180*this.lat);return new Xv(new kv(this.lng-y,this.lat-d),new kv(this.lng+y,this.lat+d))}toEcef(l){const d=Rx(l);return _1(this.lat,this.lng,lv+d)}static convert(l){if(l instanceof kv)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new kv(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new kv(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Bm=kv;function Cb(c){return Ib*Math.cos(c*Math.PI/180)}function uv(c){return(180+c)/360}function F0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function b0(c,l){return c/Cb(l)}function Ry(c){return 360*c-180}function Zg(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Mb(c,l){return c*Cb(Zg(l))}const Hg=85.051129;function px(c){return 1/Math.cos(c*Math.PI/180)}class Dv{constructor(l,d,y=0){this.x=+l,this.y=+d,this.z=+y}static fromLngLat(l,d=0){const y=Bm.convert(l);return new Dv(uv(y.lng),F0(y.lat),b0(d,y.lat))}toLngLat(){return new Bm(Ry(this.x),Zg(this.y))}toAltitude(){return Mb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ib*px(Zg(this.y))}}function Ab(c,l,d,y,M,N,q,St,Ht){const Ui=(l+y)/2,Bn=(d+M)/2,ls=new Zu(Ui,Bn);St(ls),function(il,$u,Ku,rh,vh,Ph){const Xh=Ku-vh,Dh=rh-Ph;return Math.abs((rh-$u)*Xh-(Ku-il)*Dh)/Math.hypot(Xh,Dh)}(ls.x,ls.y,N.x,N.y,q.x,q.y)>=Ht?(Ab(c,l,d,Ui,Bn,N,ls,St,Ht),Ab(c,Ui,Bn,y,M,ls,q,St,Ht)):c.push(q)}function yw(c,l,d){let y=c[0],M=y.x,N=y.y;l(y);const q=[y];for(let St=1;St<c.length;St++){const Ht=c[St],{x:Ui,y:Bn}=Ht;l(Ht),Ab(q,M,N,Ui,Bn,y,Ht,l,d),M=Ui,N=Bn,y=Ht}return q}function Pb(c,l,d,y){if(y(l,d)){const M=l.add(d)._mult(.5);Pb(c,l,M,y),Pb(c,M,d,y)}else c.push(d)}function a2(c,l){let d=c[0];const y=[d];for(let M=1;M<c.length;M++){const N=c[M];Pb(y,d,N,l),d=N}return y}const Yv=Math.pow(2,14)-1,zx=-Yv-1;function vw(c,l){const d=Math.round(c.x*l),y=Math.round(c.y*l);return c.x=Cd(d,zx,Yv),c.y=Cd(y,zx,Yv),(d<c.x||d>c.x+1||y<c.y||y>c.y+1)&&Vd("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function U0(c,l,d){const y=c.loadGeometry(),M=c.extent,N=Rp/M;if(l&&d&&d.projection.isReprojectedInTileSpace){const q=1<<l.z,{scale:St,x:Ht,y:Ui,projection:Bn}=d,ls=il=>{const $u=Ry((l.x+il.x/M)/q),Ku=Zg((l.y+il.y/M)/q),rh=Bn.project($u,Ku);il.x=(rh.x*St-Ht)*M,il.y=(rh.y*St-Ui)*M};for(let il=0;il<y.length;il++)if(c.type!==1)y[il]=yw(y[il],ls,1);else{const $u=[];for(const Ku of y[il])Ku.x<0||Ku.x>=M||Ku.y<0||Ku.y>=M||(ls(Ku),$u.push(Ku));y[il]=$u}}for(const q of y)for(const St of q)vw(St,N);return y}function y1(c,l){return{type:c.type,id:c.id,properties:c.properties,geometry:l?U0(c):[]}}function V0(c,l,d,y,M){c.emplaceBack(2*l+(y+1)/2,2*d+(M+1)/2)}function mx(c,l,d){c.emplaceBack(l.x,l.y,l.z,d[0]*16384,d[1]*16384,d[2]*16384)}class Fx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.projection=l.projection,this.layoutVertexArray=new Af,this.indexArray=new kp,this.segments=new Eg,this.programConfigurations=new Iv(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,y,M){const N=this.layers[0],q=[];let St=null;N.type==="circle"&&(St=N.layout.get("circle-sort-key"));for(const{feature:Ui,id:Bn,index:ls,sourceLayerIndex:il}of l){const $u=this.layers[0]._featureFilter.needGeometry,Ku=y1(Ui,$u);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),Ku,y))continue;const rh=St?St.evaluate(Ku,{},y):void 0,vh={id:Bn,properties:Ui.properties,type:Ui.type,sourceLayerIndex:il,index:ls,geometry:$u?Ku.geometry:U0(Ui,y,M),patterns:{},sortKey:rh};q.push(vh)}St&&q.sort((Ui,Bn)=>Ui.sortKey-Bn.sortKey);let Ht=null;M.projection.name==="globe"&&(this.globeExtVertexArray=new zf,Ht=M.projection);for(const Ui of q){const{geometry:Bn,index:ls,sourceLayerIndex:il}=Ui,$u=l[ls].feature;this.addFeature(Ui,Bn,ls,d.availableImages,y,Ht),d.featureIndex.insert($u,Bn,ls,il,this.index)}}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Hv.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,e2.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(l,d,y,M,N,q){for(const St of d)for(const Ht of St){const Ui=Ht.x,Bn=Ht.y;if(Ui<0||Ui>=Rp||Bn<0||Bn>=Rp)continue;if(q){const $u=q.projectTilePoint(Ui,Bn,N),Ku=q.upVector(N,Ui,Bn),rh=this.globeExtVertexArray;mx(rh,$u,Ku),mx(rh,$u,Ku),mx(rh,$u,Ku),mx(rh,$u,Ku)}const ls=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),il=ls.vertexLength;V0(this.layoutVertexArray,Ui,Bn,-1,-1),V0(this.layoutVertexArray,Ui,Bn,1,-1),V0(this.layoutVertexArray,Ui,Bn,1,1),V0(this.layoutVertexArray,Ui,Bn,-1,1),this.indexArray.emplaceBack(il,il+1,il+2),this.indexArray.emplaceBack(il,il+2,il+3),ls.vertexLength+=4,ls.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,{},M,N)}}function xw(c,l){for(let d=0;d<c.length;d++)if(x1(l,c[d]))return!0;for(let d=0;d<l.length;d++)if(x1(c,l[d]))return!0;return!!gx(c,l)}function s2(c,l,d){return!!x1(c,l)||!!_x(l,c,d)}function bw(c,l){if(c.length===1)return v1(l,c[0]);for(let d=0;d<l.length;d++){const y=l[d];for(let M=0;M<y.length;M++)if(x1(c,y[M]))return!0}for(let d=0;d<c.length;d++)if(v1(l,c[d]))return!0;for(let d=0;d<l.length;d++)if(gx(c,l[d]))return!0;return!1}function Ux(c,l,d){if(c.length>1){if(gx(c,l))return!0;for(let y=0;y<l.length;y++)if(_x(l[y],c,d))return!0}for(let y=0;y<c.length;y++)if(_x(c[y],l,d))return!0;return!1}function gx(c,l){if(c.length===0||l.length===0)return!1;for(let d=0;d<c.length-1;d++){const y=c[d],M=c[d+1];for(let N=0;N<l.length-1;N++)if(l2(y,M,l[N],l[N+1]))return!0}return!1}function l2(c,l,d,y){return ep(c,d,y)!==ep(l,d,y)&&ep(c,l,d)!==ep(c,l,y)}function _x(c,l,d){const y=d*d;if(l.length===1)return c.distSqr(l[0])<y;for(let M=1;M<l.length;M++)if(Vx(c,l[M-1],l[M])<y)return!0;return!1}function Vx(c,l,d){const y=l.distSqr(d);if(y===0)return c.distSqr(l);const M=((c.x-l.x)*(d.x-l.x)+(c.y-l.y)*(d.y-l.y))/y;return c.distSqr(M<0?l:M>1?d:d.sub(l)._mult(M)._add(l))}function v1(c,l){let d,y,M,N=!1;for(let q=0;q<c.length;q++){d=c[q];for(let St=0,Ht=d.length-1;St<d.length;Ht=St++)y=d[St],M=d[Ht],y.y>l.y!=M.y>l.y&&l.x<(M.x-y.x)*(l.y-y.y)/(M.y-y.y)+y.x&&(N=!N)}return N}function x1(c,l){let d=!1;for(let y=0,M=c.length-1;y<c.length;M=y++){const N=c[y],q=c[M];N.y>l.y!=q.y>l.y&&l.x<(q.x-N.x)*(l.y-N.y)/(q.y-N.y)+N.x&&(d=!d)}return d}function jx(c,l,d,y,M){for(const q of c)if(l<=q.x&&d<=q.y&&y>=q.x&&M>=q.y)return!0;const N=[new Zu(l,d),new Zu(l,M),new Zu(y,M),new Zu(y,d)];if(c.length>2){for(const q of N)if(x1(c,q))return!0}for(let q=0;q<c.length-1;q++)if(ww(c[q],c[q+1],N))return!0;return!1}function ww(c,l,d){const y=d[0],M=d[2];if(c.x<y.x&&l.x<y.x||c.x>M.x&&l.x>M.x||c.y<y.y&&l.y<y.y||c.y>M.y&&l.y>M.y)return!1;const N=ep(c,l,d[0]);return N!==ep(c,l,d[1])||N!==ep(c,l,d[2])||N!==ep(c,l,d[3])}function Lv(c,l,d){const y=l.paint.get(c).value;return y.kind==="constant"?y.value:d.programConfigurations.get(l.id).getMaxValue(c)}function U1(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Ew(c,l,d,y,M){if(!l[0]&&!l[1])return c;const N=Zu.convert(l)._mult(M);d==="viewport"&&N._rotate(-y);const q=[];for(let St=0;St<c.length;St++)q.push(c[St].sub(N));return q}function Sw(c,l,d,y){const M=Zu.convert(c)._mult(y);return l==="viewport"&&M._rotate(-d),M}_e(Fx,"CircleBucket",{omit:["layers"]});const c2=new Oh({"circle-sort-key":new bh(Yd.layout_circle["circle-sort-key"])});var u2={paint:new Oh({"circle-radius":new bh(Yd.paint_circle["circle-radius"]),"circle-color":new bh(Yd.paint_circle["circle-color"]),"circle-blur":new bh(Yd.paint_circle["circle-blur"]),"circle-opacity":new bh(Yd.paint_circle["circle-opacity"]),"circle-translate":new Qu(Yd.paint_circle["circle-translate"]),"circle-translate-anchor":new Qu(Yd.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qu(Yd.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qu(Yd.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bh(Yd.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bh(Yd.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bh(Yd.paint_circle["circle-stroke-opacity"])}),layout:c2};function Tw(c,l,d,y,M,N,q,St,Ht){if(N&&c.queryGeometry.isAboveHorizon)return!1;N&&(Ht*=c.pixelToTileUnitsFactor);const Ui=c.tileID.canonical,Bn=d.projection.upVectorScale(Ui,d.center.lat,d.worldSize).metersToTile;for(const ls of l)for(const il of ls){const $u=il.add(St),Ku=M&&d.elevation?d.elevation.exaggeration()*M.getElevationAt($u.x,$u.y,!0):0,rh=d.projection.projectTilePoint($u.x,$u.y,Ui);if(Ku>0){const Dh=d.projection.upVector(Ui,$u.x,$u.y);rh.x+=Dh[0]*Bn*Ku,rh.y+=Dh[1]*Bn*Ku,rh.z+=Dh[2]*Bn*Ku}const vh=N?$u:kb(rh.x,rh.y,rh.z,y),Ph=N?c.tilespaceRays.map(Dh=>Iw(Dh,Ku)):c.queryGeometry.screenGeometry,Xh=Av([],[rh.x,rh.y,rh.z,1],y);if(!q&&N?Ht*=Xh[3]/d.cameraToCenterDistance:q&&!N&&(Ht*=d.cameraToCenterDistance/Xh[3]),N){const Dh=Zg((il.y/Rp+Ui.y)/(1<<Ui.z));Ht/=d.projection.pixelsPerMeter(Dh,1)/b0(1,Dh)}if(s2(Ph,vh,Ht))return!0}return!1}function kb(c,l,d,y){const M=Av([],[c,l,d,1],y);return new Zu(M[0]/M[3],M[1]/M[3])}const gg=P1(0,0,0),V1=P1(0,0,1);function Iw(c,l){const d=p1();return gg[2]=l,c.intersectsPlane(gg,V1,d),new Zu(d[0],d[1])}class Db extends Fx{}function Lb(c,{width:l,height:d},y,M){if(M){if(M instanceof Uint8ClampedArray)M=new Uint8Array(M.buffer);else if(M.length!==l*d*y)throw new RangeError("mismatched image size")}else M=new Uint8Array(l*d*y);return c.width=l,c.height=d,c.data=M,c}function Rb(c,l,d){const{width:y,height:M}=l;y===c.width&&M===c.height||(qx(c,l,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,y),height:Math.min(c.height,M)},d),c.width=y,c.height=M,c.data=l.data)}function qx(c,l,d,y,M,N){if(M.width===0||M.height===0)return l;if(M.width>c.width||M.height>c.height||d.x>c.width-M.width||d.y>c.height-M.height)throw new RangeError("out of range source coordinates for image copy");if(M.width>l.width||M.height>l.height||y.x>l.width-M.width||y.y>l.height-M.height)throw new RangeError("out of range destination coordinates for image copy");const q=c.data,St=l.data;for(let Ht=0;Ht<M.height;Ht++){const Ui=((d.y+Ht)*c.width+d.x)*N,Bn=((y.y+Ht)*l.width+y.x)*N;for(let ls=0;ls<M.width*N;ls++)St[Bn+ls]=q[Ui+ls]}return l}_e(Db,"HeatmapBucket",{omit:["layers"]});class hv{constructor(l,d){Lb(this,l,1,d)}resize(l){Rb(this,new hv(l),1)}clone(){return new hv({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,y,M,N){qx(l,d,y,M,N,1)}}class ry{constructor(l,d){Lb(this,l,4,d)}resize(l){Rb(this,new ry(l),4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new ry({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,y,M,N){qx(l,d,y,M,N,4)}}_e(hv,"AlphaImage"),_e(ry,"RGBAImage");var Zx={paint:new Oh({"heatmap-radius":new bh(Yd.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bh(Yd.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qu(Yd.paint_heatmap["heatmap-intensity"]),"heatmap-color":new kh(Yd.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qu(Yd.paint_heatmap["heatmap-opacity"])})};function Hx(c){const l={},d=c.resolution||256,y=c.clips?c.clips.length:1,M=c.image||new ry({width:d,height:y}),N=(q,St,Ht)=>{l[c.evaluationKey]=Ht;const Ui=c.expression.evaluate(l);M.data[q+St+0]=Math.floor(255*Ui.r/Ui.a),M.data[q+St+1]=Math.floor(255*Ui.g/Ui.a),M.data[q+St+2]=Math.floor(255*Ui.b/Ui.a),M.data[q+St+3]=Math.floor(255*Ui.a)};if(c.clips)for(let q=0,St=0;q<y;++q,St+=4*d)for(let Ht=0,Ui=0;Ht<d;Ht++,Ui+=4){const Bn=Ht/(d-1),{start:ls,end:il}=c.clips[q];N(St,Ui,ls*(1-Bn)+il*Bn)}else for(let q=0,St=0;q<d;q++,St+=4)N(0,St,q/(d-1));return M}var Ob={paint:new Oh({"hillshade-illumination-direction":new Qu(Yd.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qu(Yd.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qu(Yd.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qu(Yd.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qu(Yd.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qu(Yd.paint_hillshade["hillshade-accent-color"])})};const Cw=ud([{name:"a_pos",components:2,type:"Int16"}],4),{members:r0}=Cw;var b1={exports:{}};function yx(c,l,d){d=d||2;var y,M,N,q,St,Ht,Ui,Bn=l&&l.length,ls=Bn?l[0]*d:c.length,il=$b(c,0,ls,d,!0),$u=[];if(!il||il.next===il.prev)return $u;if(Bn&&(il=function(rh,vh,Ph,Xh){var Dh,jh,ad,nd=[];for(Dh=0,jh=vh.length;Dh<jh;Dh++)(ad=$b(rh,vh[Dh]*Xh,Dh<jh-1?vh[Dh+1]*Xh:rh.length,Xh,!1))===ad.next&&(ad.steiner=!0),nd.push(d2(ad));for(nd.sort(Pw),Dh=0;Dh<nd.length;Dh++)Ph=vx(nd[Dh],Ph);return Ph}(c,l,il,d)),c.length>80*d){y=N=c[0],M=q=c[1];for(var Ku=d;Ku<ls;Ku+=d)(St=c[Ku])<y&&(y=St),(Ht=c[Ku+1])<M&&(M=Ht),St>N&&(N=St),Ht>q&&(q=Ht);Ui=(Ui=Math.max(N-y,q-M))!==0?32767/Ui:0}return G1(il,$u,d,y,M,Ui,0),$u}function $b(c,l,d,y,M){var N,q;if(M===fi(c,l,d,y)>0)for(N=l;N<d;N+=y)q=j(N,c[N],c[N+1],q);else for(N=d-y;N>=l;N-=y)q=j(N,c[N],c[N+1],q);return q&&Qv(q,q.next)&&(ut(q),q=q.next),q}function Jv(c,l){if(!c)return c;l||(l=c);var d,y=c;do if(d=!1,y.steiner||!Qv(y,y.next)&&hg(y.prev,y,y.next)!==0)y=y.next;else{if(ut(y),(y=l=y.prev)===y.next)break;d=!0}while(d||y!==l);return l}function G1(c,l,d,y,M,N,q){if(c){!q&&N&&function(Bn,ls,il,$u){var Ku=Bn;do Ku.z===0&&(Ku.z=Xx(Ku.x,Ku.y,ls,il,$u)),Ku.prevZ=Ku.prev,Ku.nextZ=Ku.next,Ku=Ku.next;while(Ku!==Bn);Ku.prevZ.nextZ=null,Ku.prevZ=null,function(rh){var vh,Ph,Xh,Dh,jh,ad,nd,Bd,Rd=1;do{for(Ph=rh,rh=null,jh=null,ad=0;Ph;){for(ad++,Xh=Ph,nd=0,vh=0;vh<Rd&&(nd++,Xh=Xh.nextZ);vh++);for(Bd=Rd;nd>0||Bd>0&&Xh;)nd!==0&&(Bd===0||!Xh||Ph.z<=Xh.z)?(Dh=Ph,Ph=Ph.nextZ,nd--):(Dh=Xh,Xh=Xh.nextZ,Bd--),jh?jh.nextZ=Dh:rh=Dh,Dh.prevZ=jh,jh=Dh;Ph=Xh}jh.nextZ=null,Rd*=2}while(ad>1)}(Ku)}(c,y,M,N);for(var St,Ht,Ui=c;c.prev!==c.next;)if(St=c.prev,Ht=c.next,N?Aw(c,y,M,N):Mw(c))l.push(St.i/d|0),l.push(c.i/d|0),l.push(Ht.i/d|0),ut(c),c=Ht.next,Ui=Ht.next;else if((c=Ht)===Ui){q?q===1?G1(c=h2(Jv(c),l,d),l,d,y,M,N,2):q===2&&Bb(c,l,d,y,M,N):G1(Jv(c),l,d,y,M,N,1);break}}}function Mw(c){var l=c.prev,d=c,y=c.next;if(hg(l,d,y)>=0)return!1;for(var M=l.x,N=d.x,q=y.x,St=l.y,Ht=d.y,Ui=y.y,Bn=M<N?M<q?M:q:N<q?N:q,ls=St<Ht?St<Ui?St:Ui:Ht<Ui?Ht:Ui,il=M>N?M>q?M:q:N>q?N:q,$u=St>Ht?St>Ui?St:Ui:Ht>Ui?Ht:Ui,Ku=y.next;Ku!==l;){if(Ku.x>=Bn&&Ku.x<=il&&Ku.y>=ls&&Ku.y<=$u&&j1(M,St,N,Ht,q,Ui,Ku.x,Ku.y)&&hg(Ku.prev,Ku,Ku.next)>=0)return!1;Ku=Ku.next}return!0}function Aw(c,l,d,y){var M=c.prev,N=c,q=c.next;if(hg(M,N,q)>=0)return!1;for(var St=M.x,Ht=N.x,Ui=q.x,Bn=M.y,ls=N.y,il=q.y,$u=St<Ht?St<Ui?St:Ui:Ht<Ui?Ht:Ui,Ku=Bn<ls?Bn<il?Bn:il:ls<il?ls:il,rh=St>Ht?St>Ui?St:Ui:Ht>Ui?Ht:Ui,vh=Bn>ls?Bn>il?Bn:il:ls>il?ls:il,Ph=Xx($u,Ku,l,d,y),Xh=Xx(rh,vh,l,d,y),Dh=c.prevZ,jh=c.nextZ;Dh&&Dh.z>=Ph&&jh&&jh.z<=Xh;){if(Dh.x>=$u&&Dh.x<=rh&&Dh.y>=Ku&&Dh.y<=vh&&Dh!==M&&Dh!==q&&j1(St,Bn,Ht,ls,Ui,il,Dh.x,Dh.y)&&hg(Dh.prev,Dh,Dh.next)>=0||(Dh=Dh.prevZ,jh.x>=$u&&jh.x<=rh&&jh.y>=Ku&&jh.y<=vh&&jh!==M&&jh!==q&&j1(St,Bn,Ht,ls,Ui,il,jh.x,jh.y)&&hg(jh.prev,jh,jh.next)>=0))return!1;jh=jh.nextZ}for(;Dh&&Dh.z>=Ph;){if(Dh.x>=$u&&Dh.x<=rh&&Dh.y>=Ku&&Dh.y<=vh&&Dh!==M&&Dh!==q&&j1(St,Bn,Ht,ls,Ui,il,Dh.x,Dh.y)&&hg(Dh.prev,Dh,Dh.next)>=0)return!1;Dh=Dh.prevZ}for(;jh&&jh.z<=Xh;){if(jh.x>=$u&&jh.x<=rh&&jh.y>=Ku&&jh.y<=vh&&jh!==M&&jh!==q&&j1(St,Bn,Ht,ls,Ui,il,jh.x,jh.y)&&hg(jh.prev,jh,jh.next)>=0)return!1;jh=jh.nextZ}return!0}function h2(c,l,d){var y=c;do{var M=y.prev,N=y.next.next;!Qv(M,N)&&Kx(M,y,y.next,N)&&p(M,N)&&p(N,M)&&(l.push(M.i/d|0),l.push(y.i/d|0),l.push(N.i/d|0),ut(y),ut(y.next),y=c=N),y=y.next}while(y!==c);return Jv(y)}function Bb(c,l,d,y,M,N){var q=c;do{for(var St=q.next.next;St!==q.prev;){if(q.i!==St.i&&zb(q,St)){var Ht=S(q,St);return q=Jv(q,q.next),Ht=Jv(Ht,Ht.next),G1(q,l,d,y,M,N,0),void G1(Ht,l,d,y,M,N,0)}St=St.next}q=q.next}while(q!==c)}function Pw(c,l){return c.x-l.x}function vx(c,l){var d=function(M,N){var q,St=N,Ht=M.x,Ui=M.y,Bn=-1/0;do{if(Ui<=St.y&&Ui>=St.next.y&&St.next.y!==St.y){var ls=St.x+(Ui-St.y)*(St.next.x-St.x)/(St.next.y-St.y);if(ls<=Ht&&ls>Bn&&(Bn=ls,q=St.x<St.next.x?St:St.next,ls===Ht))return q}St=St.next}while(St!==N);if(!q)return null;var il,$u=q,Ku=q.x,rh=q.y,vh=1/0;St=q;do Ht>=St.x&&St.x>=Ku&&Ht!==St.x&&j1(Ui<rh?Ht:Bn,Ui,Ku,rh,Ui<rh?Bn:Ht,Ui,St.x,St.y)&&(il=Math.abs(Ui-St.y)/(Ht-St.x),p(St,M)&&(il<vh||il===vh&&(St.x>q.x||St.x===q.x&&Nb(q,St)))&&(q=St,vh=il)),St=St.next;while(St!==$u);return q}(c,l);if(!d)return l;var y=S(d,c);return Jv(y,y.next),Jv(d,d.next)}function Nb(c,l){return hg(c.prev,c,l.prev)<0&&hg(l.next,c,c.next)<0}function Xx(c,l,d,y,M){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-d)*M|0)|c<<8))|c<<4))|c<<2))|c<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-y)*M|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function d2(c){var l=c,d=c;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==c);return d}function j1(c,l,d,y,M,N,q,St){return(M-q)*(l-St)>=(c-q)*(N-St)&&(c-q)*(y-St)>=(d-q)*(l-St)&&(d-q)*(N-St)>=(M-q)*(y-St)}function zb(c,l){return c.next.i!==l.i&&c.prev.i!==l.i&&!function(d,y){var M=d;do{if(M.i!==d.i&&M.next.i!==d.i&&M.i!==y.i&&M.next.i!==y.i&&Kx(M,M.next,d,y))return!0;M=M.next}while(M!==d);return!1}(c,l)&&(p(c,l)&&p(l,c)&&function(d,y){var M=d,N=!1,q=(d.x+y.x)/2,St=(d.y+y.y)/2;do M.y>St!=M.next.y>St&&M.next.y!==M.y&&q<(M.next.x-M.x)*(St-M.y)/(M.next.y-M.y)+M.x&&(N=!N),M=M.next;while(M!==d);return N}(c,l)&&(hg(c.prev,c,l.prev)||hg(c,l.prev,l))||Qv(c,l)&&hg(c.prev,c,c.next)>0&&hg(l.prev,l,l.next)>0)}function hg(c,l,d){return(l.y-c.y)*(d.x-l.x)-(l.x-c.x)*(d.y-l.y)}function Qv(c,l){return c.x===l.x&&c.y===l.y}function Kx(c,l,d,y){var M=_(hg(c,l,d)),N=_(hg(c,l,y)),q=_(hg(d,y,c)),St=_(hg(d,y,l));return M!==N&&q!==St||!(M!==0||!Wx(c,d,l))||!(N!==0||!Wx(c,y,l))||!(q!==0||!Wx(d,c,y))||!(St!==0||!Wx(d,l,y))}function Wx(c,l,d){return l.x<=Math.max(c.x,d.x)&&l.x>=Math.min(c.x,d.x)&&l.y<=Math.max(c.y,d.y)&&l.y>=Math.min(c.y,d.y)}function _(c){return c>0?1:c<0?-1:0}function p(c,l){return hg(c.prev,c,c.next)<0?hg(c,l,c.next)>=0&&hg(c,c.prev,l)>=0:hg(c,l,c.prev)<0||hg(c,c.next,l)<0}function S(c,l){var d=new Ot(c.i,c.x,c.y),y=new Ot(l.i,l.x,l.y),M=c.next,N=l.prev;return c.next=l,l.prev=c,d.next=M,M.prev=d,y.next=d,d.prev=y,N.next=y,y.prev=N,y}function j(c,l,d,y){var M=new Ot(c,l,d);return y?(M.next=y.next,M.prev=y,y.next.prev=M,y.next=M):(M.prev=M,M.next=M),M}function ut(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Ot(c,l,d){this.i=c,this.x=l,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fi(c,l,d,y){for(var M=0,N=l,q=d-y;N<d;N+=y)M+=(c[q]-c[N])*(c[N+1]+c[q+1]),q=N;return M}b1.exports=yx,b1.exports.default=yx,yx.deviation=function(c,l,d,y){var M=l&&l.length,N=Math.abs(fi(c,0,M?l[0]*d:c.length,d));if(M)for(var q=0,St=l.length;q<St;q++)N-=Math.abs(fi(c,l[q]*d,q<St-1?l[q+1]*d:c.length,d));var Ht=0;for(q=0;q<y.length;q+=3){var Ui=y[q]*d,Bn=y[q+1]*d,ls=y[q+2]*d;Ht+=Math.abs((c[Ui]-c[ls])*(c[Bn+1]-c[Ui+1])-(c[Ui]-c[Bn])*(c[ls+1]-c[Ui+1]))}return N===0&&Ht===0?0:Math.abs((Ht-N)/N)},yx.flatten=function(c){for(var l=c[0][0].length,d={vertices:[],holes:[],dimensions:l},y=0,M=0;M<c.length;M++){for(var N=0;N<c[M].length;N++)for(var q=0;q<l;q++)d.vertices.push(c[M][N][q]);M>0&&d.holes.push(y+=c[M-1].length)}return d};var kn=Io(b1.exports);function ss(c,l,d,y,M){ul(c,l,d||0,y||c.length-1,M||nh)}function ul(c,l,d,y,M){for(;y>d;){if(y-d>600){var N=y-d+1,q=l-d+1,St=Math.log(N),Ht=.5*Math.exp(2*St/3),Ui=.5*Math.sqrt(St*Ht*(N-Ht)/N)*(q-N/2<0?-1:1);ul(c,l,Math.max(d,Math.floor(l-q*Ht/N+Ui)),Math.min(y,Math.floor(l+(N-q)*Ht/N+Ui)),M)}var Bn=c[l],ls=d,il=y;for(Ju(c,d,l),M(c[y],Bn)>0&&Ju(c,d,y);ls<il;){for(Ju(c,ls,il),ls++,il--;M(c[ls],Bn)<0;)ls++;for(;M(c[il],Bn)>0;)il--}M(c[d],Bn)===0?Ju(c,d,il):Ju(c,++il,y),il<=l&&(d=il+1),l<=il&&(y=il-1)}}function Ju(c,l,d){var y=c[l];c[l]=c[d],c[d]=y}function nh(c,l){return c<l?-1:c>l?1:0}function mh(c,l){const d=c.length;if(d<=1)return[c];const y=[];let M,N;for(let q=0;q<d;q++){const St=_p(c[q]);St!==0&&(c[q].area=Math.abs(St),N===void 0&&(N=St<0),N===St<0?(M&&y.push(M),M=[c[q]]):M.push(c[q]))}if(M&&y.push(M),l>1)for(let q=0;q<y.length;q++)y[q].length<=l||(ss(y[q],l,1,y[q].length-1,_h),y[q]=y[q].slice(0,l));return y}function _h(c,l){return l.area-c.area}function wh(c,l,d){const y=d.patternDependencies;let M=!1;for(const N of l){const q=N.paint.get(`${c}-pattern`);q.isConstant()||(M=!0);const St=q.constantOr(null);St&&(M=!0,y[St]=!0)}return M}function Jh(c,l,d,y,M){const N=M.patternDependencies;for(const q of l){const St=q.paint.get(`${c}-pattern`).value;if(St.kind!=="constant"){let Ht=St.evaluate({zoom:y},d,{},M.availableImages);Ht=Ht&&Ht.name?Ht.name:Ht,N[Ht]=!0,d.patterns[q.id]=Ht}}return d}class Hh{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Af,this.indexArray=new kp,this.indexArray2=new qg,this.programConfigurations=new Iv(l.layers,l.zoom),this.segments=new Eg,this.segments2=new Eg,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.projection=l.projection}populate(l,d,y,M){this.hasPattern=wh("fill",this.layers,d);const N=this.layers[0].layout.get("fill-sort-key"),q=[];for(const{feature:St,id:Ht,index:Ui,sourceLayerIndex:Bn}of l){const ls=this.layers[0]._featureFilter.needGeometry,il=y1(St,ls);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),il,y))continue;const $u=N?N.evaluate(il,{},y,d.availableImages):void 0,Ku={id:Ht,properties:St.properties,type:St.type,sourceLayerIndex:Bn,index:Ui,geometry:ls?il.geometry:U0(St,y,M),patterns:{},sortKey:$u};q.push(Ku)}N&&q.sort((St,Ht)=>St.sortKey-Ht.sortKey);for(const St of q){const{geometry:Ht,index:Ui,sourceLayerIndex:Bn}=St;if(this.hasPattern){const ls=Jh("fill",this.layers,St,this.zoom,d);this.patternFeatures.push(ls)}else this.addFeature(St,Ht,Ui,y,{},d.availableImages);d.featureIndex.insert(l[Ui].feature,Ht,Ui,Bn,this.index)}}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}addFeatures(l,d,y,M,N){for(const q of this.patternFeatures)this.addFeature(q,q.geometry,q.index,d,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,r0),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,y,M,N,q=[]){for(const St of mh(d,500)){let Ht=0;for(const Ku of St)Ht+=Ku.length;const Ui=this.segments.prepareSegment(Ht,this.layoutVertexArray,this.indexArray),Bn=Ui.vertexLength,ls=[],il=[];for(const Ku of St){if(Ku.length===0)continue;Ku!==St[0]&&il.push(ls.length/2);const rh=this.segments2.prepareSegment(Ku.length,this.layoutVertexArray,this.indexArray2),vh=rh.vertexLength;this.layoutVertexArray.emplaceBack(Ku[0].x,Ku[0].y),this.indexArray2.emplaceBack(vh+Ku.length-1,vh),ls.push(Ku[0].x),ls.push(Ku[0].y);for(let Ph=1;Ph<Ku.length;Ph++)this.layoutVertexArray.emplaceBack(Ku[Ph].x,Ku[Ph].y),this.indexArray2.emplaceBack(vh+Ph-1,vh+Ph),ls.push(Ku[Ph].x),ls.push(Ku[Ph].y);rh.vertexLength+=Ku.length,rh.primitiveLength+=Ku.length}const $u=kn(ls,il);for(let Ku=0;Ku<$u.length;Ku+=3)this.indexArray.emplaceBack(Bn+$u[Ku],Bn+$u[Ku+1],Bn+$u[Ku+2]);Ui.vertexLength+=Ht,Ui.primitiveLength+=$u.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,N,q,M)}}_e(Hh,"FillBucket",{omit:["layers","patternFeatures"]});const Id=new Oh({"fill-sort-key":new bh(Yd.layout_fill["fill-sort-key"])});var jd={paint:new Oh({"fill-antialias":new Qu(Yd.paint_fill["fill-antialias"]),"fill-opacity":new bh(Yd.paint_fill["fill-opacity"]),"fill-color":new bh(Yd.paint_fill["fill-color"]),"fill-outline-color":new bh(Yd.paint_fill["fill-outline-color"]),"fill-translate":new Qu(Yd.paint_fill["fill-translate"]),"fill-translate-anchor":new Qu(Yd.paint_fill["fill-translate-anchor"]),"fill-pattern":new bh(Yd.paint_fill["fill-pattern"])}),layout:Id};const wd=ud([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ud=ud([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Bf=ud([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rf}=wd;var Ep={},Op=ch,yp=sp;function sp(c,l,d,y,M){this.properties={},this.extent=d,this.type=0,this._pbf=c,this._geometry=-1,this._keys=y,this._values=M,c.readFields(cp,this,l)}function cp(c,l,d){c==1?l.id=d.readVarint():c==2?function(y,M){for(var N=y.readVarint()+y.pos;y.pos<N;){var q=M._keys[y.readVarint()],St=M._values[y.readVarint()];M.properties[q]=St}}(d,l):c==3?l.type=d.readVarint():c==4&&(l._geometry=d.pos)}function xp(c){for(var l,d,y=0,M=0,N=c.length,q=N-1;M<N;q=M++)y+=((d=c[q]).x-(l=c[M]).x)*(l.y+d.y);return y}sp.types=["Unknown","Point","LineString","Polygon"],sp.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,d=c.readVarint()+c.pos,y=1,M=0,N=0,q=0,St=[];c.pos<d;){if(M<=0){var Ht=c.readVarint();y=7&Ht,M=Ht>>3}if(M--,y===1||y===2)N+=c.readSVarint(),q+=c.readSVarint(),y===1&&(l&&St.push(l),l=[]),l.push(new Op(N,q));else{if(y!==7)throw new Error("unknown command "+y);l&&l.push(l[0].clone())}}return l&&St.push(l),St},sp.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,d=1,y=0,M=0,N=0,q=1/0,St=-1/0,Ht=1/0,Ui=-1/0;c.pos<l;){if(y<=0){var Bn=c.readVarint();d=7&Bn,y=Bn>>3}if(y--,d===1||d===2)(M+=c.readSVarint())<q&&(q=M),M>St&&(St=M),(N+=c.readSVarint())<Ht&&(Ht=N),N>Ui&&(Ui=N);else if(d!==7)throw new Error("unknown command "+d)}return[q,Ht,St,Ui]},sp.prototype.toGeoJSON=function(c,l,d){var y,M,N=this.extent*Math.pow(2,d),q=this.extent*c,St=this.extent*l,Ht=this.loadGeometry(),Ui=sp.types[this.type];function Bn($u){for(var Ku=0;Ku<$u.length;Ku++){var rh=$u[Ku];$u[Ku]=[360*(rh.x+q)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(rh.y+St)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var ls=[];for(y=0;y<Ht.length;y++)ls[y]=Ht[y][0];Bn(Ht=ls);break;case 2:for(y=0;y<Ht.length;y++)Bn(Ht[y]);break;case 3:for(Ht=function($u){var Ku=$u.length;if(Ku<=1)return[$u];for(var rh,vh,Ph=[],Xh=0;Xh<Ku;Xh++){var Dh=xp($u[Xh]);Dh!==0&&(vh===void 0&&(vh=Dh<0),vh===Dh<0?(rh&&Ph.push(rh),rh=[$u[Xh]]):rh.push($u[Xh]))}return rh&&Ph.push(rh),Ph}(Ht),y=0;y<Ht.length;y++)for(M=0;M<Ht[y].length;M++)Bn(Ht[y][M])}Ht.length===1?Ht=Ht[0]:Ui="Multi"+Ui;var il={type:"Feature",geometry:{type:Ui,coordinates:Ht},properties:this.properties};return"id"in this&&(il.id=this.id),il};var gp=yp,Wf=Gp;function Gp(c,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Np,this,l),this.length=this._features.length}function Np(c,l,d){c===15?l.version=d.readVarint():c===1?l.name=d.readString():c===5?l.extent=d.readVarint():c===2?l._features.push(d.pos):c===3?l._keys.push(d.readString()):c===4&&l._values.push(function(y){for(var M=null,N=y.readVarint()+y.pos;y.pos<N;){var q=y.readVarint()>>3;M=q===1?y.readString():q===2?y.readFloat():q===3?y.readDouble():q===4?y.readVarint64():q===5?y.readVarint():q===6?y.readSVarint():q===7?y.readBoolean():null}return M}(d))}Gp.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var l=this._pbf.readVarint()+this._pbf.pos;return new gp(this._pbf,l,this.extent,this._keys,this._values)};var hm=Wf;function og(c,l,d){if(c===3){var y=new hm(d,d.readVarint()+d.pos);y.length&&(l[y.name]=y)}}var Jm=Ep.VectorTile=function(c,l){this.layers=c.readFields(og,{},l)},Tg=Ep.VectorTileFeature=yp;function ny(c,l,d,y){const M=[],N=y===0?(q,St,Ht,Ui,Bn,ls)=>{q.push(new Zu(ls,Ht+(ls-St)/(Ui-St)*(Bn-Ht)))}:(q,St,Ht,Ui,Bn,ls)=>{q.push(new Zu(St+(ls-Ht)/(Bn-Ht)*(Ui-St),ls))};for(const q of c){const St=[];for(const Ht of q){if(Ht.length<=2)continue;const Ui=[];for(let il=0;il<Ht.length-1;il++){const $u=Ht[il].x,Ku=Ht[il].y,rh=Ht[il+1].x,vh=Ht[il+1].y,Ph=y===0?$u:Ku,Xh=y===0?rh:vh;Ph<l?Xh>l&&N(Ui,$u,Ku,rh,vh,l):Ph>d?Xh<d&&N(Ui,$u,Ku,rh,vh,d):Ui.push(Ht[il]),Xh<l&&Ph>=l&&N(Ui,$u,Ku,rh,vh,l),Xh>d&&Ph<=d&&N(Ui,$u,Ku,rh,vh,d)}let Bn=Ht[Ht.length-1];const ls=y===0?Bn.x:Bn.y;ls>=l&&ls<=d&&Ui.push(Bn),Ui.length&&(Bn=Ui[Ui.length-1],Ui[0].x===Bn.x&&Ui[0].y===Bn.y||Ui.push(Ui[0]),St.push(Ui))}St.length&&M.push(St)}return M}Ep.VectorTileLayer=Wf;const E_=Tg.types,zg=Math.pow(2,13);function Ig(c,l,d,y,M,N,q,St){c.emplaceBack((l<<1)+q,(d<<1)+N,(Math.floor(y*zg)<<1)+M,Math.round(St))}function Fg(c,l,d){c.emplaceBack(l.x,l.y,l.z,d[0]*16384,d[1]*16384,d[2]*16384)}class S_{constructor(){this.acc=new Zu(0,0),this.polyCount=[]}startRing(l){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Zu(l.x,l.y),this.max=new Zu(l.x,l.y))}append(l,d){this.currentPolyCount.edges++,this.acc._add(l);const y=this.min,M=this.max;l.x<y.x?y.x=l.x:l.x>M.x&&(M.x=l.x),l.y<y.y?y.y=l.y:l.y>M.y&&(M.y=l.y),((l.x===0||l.x===Rp)&&l.x===d.x)!=((l.y===0||l.y===Rp)&&l.y===d.y)&&this.processBorderOverlap(l,d),d.x<0!=l.x<0&&this.addBorderIntersection(0,im(d.y,l.y,(0-d.x)/(l.x-d.x))),d.x>Rp!=l.x>Rp&&this.addBorderIntersection(1,im(d.y,l.y,(Rp-d.x)/(l.x-d.x))),d.y<0!=l.y<0&&this.addBorderIntersection(2,im(d.x,l.x,(0-d.y)/(l.y-d.y))),d.y>Rp!=l.y>Rp&&this.addBorderIntersection(3,im(d.x,l.x,(Rp-d.y)/(l.y-d.y)))}addBorderIntersection(l,d){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const y=this.borders[l];d<y[0]&&(y[0]=d),d>y[1]&&(y[1]=d)}processBorderOverlap(l,d){if(l.x===d.x){if(l.y===d.y)return;const y=l.x===0?0:1;this.addBorderIntersection(y,d.y),this.addBorderIntersection(y,l.y)}else{const y=l.y===0?2:3;this.addBorderIntersection(y,d.x),this.addBorderIntersection(y,l.x)}}centroid(){const l=this.polyCount.reduce((d,y)=>d+y.edges,0);return l!==0?this.acc.div(l)._round():new Zu(0,0)}span(){return new Zu(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((l,d)=>l+ +(d[0]!==Number.MAX_VALUE),0)}}class h_{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=l.projection,this.layoutVertexArray=new Gd,this.centroidVertexArray=new $0,this.indexArray=new kp,this.programConfigurations=new Iv(l.layers,l.zoom),this.segments=new Eg,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.enableTerrain=l.enableTerrain}populate(l,d,y,M){this.features=[],this.hasPattern=wh("fill-extrusion",this.layers,d),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(N){const q=Math.exp(Math.PI*(1-N.y/(1<<N.z)*2));return 80150034*q/(q*q+1)/Rp/(1<<N.z)}(y),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:N,id:q,index:St,sourceLayerIndex:Ht}of l){const Ui=this.layers[0]._featureFilter.needGeometry,Bn=y1(N,Ui);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),Bn,y))continue;const ls={id:q,sourceLayerIndex:Ht,index:St,geometry:Ui?Bn.geometry:U0(N,y,M),properties:N.properties,type:N.type,patterns:{}},il=this.layoutVertexArray.length;this.hasPattern?this.features.push(Jh("fill-extrusion",this.layers,ls,this.zoom,d)):this.addFeature(ls,ls.geometry,St,y,{},d.availableImages,M),d.featureIndex.insert(N,ls.geometry,St,Ht,this.index,il)}this.sortBorders()}addFeatures(l,d,y,M,N){for(const q of this.features){const{geometry:St}=q;this.addFeature(q,St,q.index,d,y,M,N)}this.sortBorders()}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Rf),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=l.createVertexBuffer(this.layoutVertexExtArray,Bf.members,!0))),this.programConfigurations.upload(l),this.uploaded=!0}uploadCentroid(l){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Ud.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,y,M,N,q,St){const Ht=[new Zu(0,0),new Zu(Rp,Rp)],Ui=St.projection,Bn=Ui.name==="globe",ls=this.enableTerrain&&!Bn?new S_:null,il=E_[l.type]==="Polygon";Bn&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new zf);const $u=mh(d,500);for(let Ph=$u.length-1;Ph>=0;Ph--){const Xh=$u[Ph];(Xh.length===0||(Ku=Xh[0]).every(Dh=>Dh.x<=0)||Ku.every(Dh=>Dh.x>=Rp)||Ku.every(Dh=>Dh.y<=0)||Ku.every(Dh=>Dh.y>=Rp))&&$u.splice(Ph,1)}var Ku;let rh;if(Bn)rh=d_($u,Ht,M);else{rh=[];for(const Ph of $u)rh.push({polygon:Ph,bounds:Ht})}const vh=il?this.edgeRadius:0;for(const{polygon:Ph,bounds:Xh}of rh){let Dh=0,jh=0;for(const nd of Ph)il&&!nd[0].equals(nd[nd.length-1])&&nd.push(nd[0]),jh+=il?nd.length-1:nd.length;const ad=this.segments.prepareSegment((il?5:4)*jh,this.layoutVertexArray,this.indexArray);if(il){const nd=[],Bd=[];Dh=ad.vertexLength;for(const bf of Ph){let qf,Xd;bf.length&&bf!==Ph[0]&&Bd.push(nd.length/2),qf=bf[1].sub(bf[0])._perp()._unit();for(let kf=1;kf<bf.length;kf++){const Df=bf[kf],Ff=bf[kf===bf.length-1?1:kf+1];let{x:Yf,y:xf}=Df;if(vh){Xd=Ff.sub(Df)._perp()._unit();const dp=qf.add(Xd)._unit(),Sp=vh*Math.min(4,1/(qf.x*dp.x+qf.y*dp.y));Yf+=Sp*dp.x,xf+=Sp*dp.y,qf=Xd}Ig(this.layoutVertexArray,Yf,xf,0,0,1,1,0),ad.vertexLength++,nd.push(Df.x,Df.y),Bn&&Fg(this.layoutVertexExtArray,Ui.projectTilePoint(Yf,xf,M),Ui.upVector(M,Yf,xf))}}const Rd=kn(nd,Bd);for(let bf=0;bf<Rd.length;bf+=3)this.indexArray.emplaceBack(Dh+Rd[bf],Dh+Rd[bf+2],Dh+Rd[bf+1]),ad.primitiveLength++}for(const nd of Ph){ls&&nd.length&&ls.startRing(nd[0]);let Bd,Rd,bf,qf=nd.length>4&&oy(nd[nd.length-2],nd[0],nd[1]),Xd=vh?T_(nd[nd.length-2],nd[0],nd[1],vh):0;Rd=nd[1].sub(nd[0])._perp()._unit();let kf=!0;for(let Df=1,Ff=0;Df<nd.length;Df++){let Yf=nd[Df-1],xf=nd[Df];const dp=nd[Df===nd.length-1?1:Df+1];if(ls&&il&&ls.currentPolyCount.top++,U_(xf,Yf,Xh)){vh&&(Rd=dp.sub(xf)._perp()._unit(),kf=!kf);continue}ls&&ls.append(xf,Yf);const Sp=xf.sub(Yf)._perp(),pp=Sp.x/(Math.abs(Sp.x)+Math.abs(Sp.y)),Qp=Sp.y>0?1:0,Qf=Yf.dist(xf);if(Ff+Qf>32768&&(Ff=0),vh){bf=dp.sub(xf)._perp()._unit();let tm=I_(Yf,xf,dp,Dg(Rd,bf),vh);isNaN(tm)&&(tm=0);const Zp=xf.sub(Yf)._unit();Yf=Yf.add(Zp.mult(Xd))._round(),xf=xf.add(Zp.mult(-tm))._round(),Xd=tm,Rd=bf}const Up=ad.vertexLength,em=nd.length>4&&oy(Yf,xf,dp);let Em=ay(Ff,qf,kf);if(Ig(this.layoutVertexArray,Yf.x,Yf.y,pp,Qp,0,0,Em),Ig(this.layoutVertexArray,Yf.x,Yf.y,pp,Qp,0,1,Em),Ff+=Qf,Em=ay(Ff,em,!kf),qf=em,Ig(this.layoutVertexArray,xf.x,xf.y,pp,Qp,0,0,Em),Ig(this.layoutVertexArray,xf.x,xf.y,pp,Qp,0,1,Em),ad.vertexLength+=4,this.indexArray.emplaceBack(Up+0,Up+1,Up+2),this.indexArray.emplaceBack(Up+1,Up+3,Up+2),ad.primitiveLength+=2,vh){const tm=Dh+(Df===1?nd.length-2:Df-2),Zp=Df===1?Dh:tm+1;if(this.indexArray.emplaceBack(Up+1,tm,Up+3),this.indexArray.emplaceBack(tm,Zp,Up+3),ad.primitiveLength+=2,Bd===void 0&&(Bd=Up),!U_(dp,nd[Df],Xh)){const ag=Df===nd.length-1?Bd:ad.vertexLength;this.indexArray.emplaceBack(Up+2,Up+3,ag),this.indexArray.emplaceBack(Up+3,ag+1,ag),this.indexArray.emplaceBack(Up+3,Zp,ag+1),ad.primitiveLength+=3}kf=!kf}if(Bn){const tm=this.layoutVertexExtArray,Zp=Ui.projectTilePoint(Yf.x,Yf.y,M),ag=Ui.projectTilePoint(xf.x,xf.y,M),rm=Ui.upVector(M,Yf.x,Yf.y),nm=Ui.upVector(M,xf.x,xf.y);Fg(tm,Zp,rm),Fg(tm,Zp,rm),Fg(tm,ag,nm),Fg(tm,ag,nm)}}il&&(Dh+=nd.length-1)}}if(ls&&ls.polyCount.length>0){if(ls.borders){ls.vertexArrayOffset=this.centroidVertexArray.length;const Ph=ls.borders,Xh=this.featuresOnBorder.push(ls)-1;for(let Dh=0;Dh<4;Dh++)Ph[Dh][0]!==Number.MAX_VALUE&&this.borders[Dh].push(Xh)}this.encodeCentroid(ls.borders?void 0:ls.centroid(),ls)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,N,q,M)}sortBorders(){for(let l=0;l<4;l++)this.borders[l].sort((d,y)=>this.featuresOnBorder[d].borders[l][0]-this.featuresOnBorder[y].borders[l][0])}encodeCentroid(l,d,y=!0){let M,N;if(l)if(l.y!==0){const St=d.span()._mult(this.tileToMeter);M=(Math.max(l.x,1)<<3)+Math.min(7,Math.round(St.x/10)),N=(Math.max(l.y,1)<<3)+Math.min(7,Math.round(St.y/10))}else M=Math.ceil(7*(l.x+450)),N=0;else M=0,N=+y;let q=y?this.centroidVertexArray.length:d.vertexArrayOffset;for(const St of d.polyCount){y&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*St.edges+St.top);for(let Ht=0;Ht<St.top;Ht++)this.centroidVertexArray.emplace(q++,M,N);for(let Ht=0;Ht<2*St.edges;Ht++)this.centroidVertexArray.emplace(q++,0,N),this.centroidVertexArray.emplace(q++,M,N)}}}function Dg(c,l){const d=c.add(l)._unit();return c.x*d.x+c.y*d.y}function T_(c,l,d,y){const M=l.sub(c)._perp()._unit(),N=d.sub(l)._perp()._unit();return I_(c,l,d,Dg(M,N),y)}function I_(c,l,d,y,M){const N=Math.sqrt(1-y*y);return Math.min(c.dist(l)/3,l.dist(d)/3,M*N/y)}function U_(c,l,d){return c.x<d[0].x&&l.x<d[0].x||c.x>d[1].x&&l.x>d[1].x||c.y<d[0].y&&l.y<d[0].y||c.y>d[1].y&&l.y>d[1].y}function oy(c,l,d){if(c.x<0||c.x>=Rp||l.x<0||l.x>=Rp||d.x<0||d.x>=Rp)return!1;const y=d.sub(l),M=y.perp(),N=c.sub(l);return(y.x*N.x+y.y*N.y)/Math.sqrt((y.x*y.x+y.y*y.y)*(N.x*N.x+N.y*N.y))>-.866&&M.x*N.x+M.y*N.y<0}function ay(c,l,d){const y=l?2|c:-3&c;return d?1|y:-2&y}function _g(){const c=Math.PI/32,l=Math.tan(c),d=F1;return d*Math.sqrt(1+2*l*l)-d}function d_(c,l,d){const y=1<<d.z,M=Ry(d.x/y),N=Ry((d.x+1)/y),q=Zg(d.y/y),St=Zg((d.y+1)/y);return function(Ht,Ui,Bn,ls,il=0,$u){const Ku=[];if(!Ht.length||!Bn||!ls)return Ku;const rh=(nd,Bd)=>{for(const Rd of nd)Ku.push({polygon:Rd,bounds:Bd})},vh=Math.ceil(Math.log2(Bn)),Ph=Math.ceil(Math.log2(ls)),Xh=vh-Ph,Dh=[];for(let nd=0;nd<Math.abs(Xh);nd++)Dh.push(Xh>0?0:1);for(let nd=0;nd<Math.min(vh,Ph);nd++)Dh.push(0),Dh.push(1);let jh=Ht;if(jh=ny(jh,Ui[0].y-il,Ui[1].y+il,1),jh=ny(jh,Ui[0].x-il,Ui[1].x+il,0),!jh.length)return Ku;const ad=[];for(Dh.length?ad.push({polygons:jh,bounds:Ui,depth:0}):rh(jh,Ui);ad.length;){const nd=ad.pop(),Bd=nd.depth,Rd=Dh[Bd],bf=nd.bounds[0],qf=nd.bounds[1],Xd=Rd===0?bf.x:bf.y,kf=Rd===0?qf.x:qf.y,Df=$u?$u(Rd,Xd,kf):.5*(Xd+kf),Ff=ny(nd.polygons,Xd-il,Df+il,Rd),Yf=ny(nd.polygons,Df-il,kf+il,Rd);if(Ff.length){const xf=[bf,new Zu(Rd===0?Df:qf.x,Rd===1?Df:qf.y)];Dh.length>Bd+1?ad.push({polygons:Ff,bounds:xf,depth:Bd+1}):rh(Ff,xf)}if(Yf.length){const xf=[new Zu(Rd===0?Df:bf.x,Rd===1?Df:bf.y),qf];Dh.length>Bd+1?ad.push({polygons:Yf,bounds:xf,depth:Bd+1}):rh(Yf,xf)}}return Ku}(c,l,Math.ceil((N-M)/11.25),Math.ceil((q-St)/11.25),1,(Ht,Ui,Bn)=>{if(Ht===0)return .5*(Ui+Bn);{const ls=Zg((d.y+Ui/Rp)/y);return(F0(.5*(Zg((d.y+Bn/Rp)/y)+ls))*y-d.y)*Rp}})}_e(h_,"FillExtrusionBucket",{omit:["layers","features"]}),_e(S_,"PartMetadata");const dm=new Oh({"fill-extrusion-edge-radius":new Qu(Yd["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Oy={paint:new Oh({"fill-extrusion-opacity":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bh(Yd["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bh(Yd["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bh(Yd["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bh(Yd["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Qu(Yd["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:dm};function f_(c,l,d){var y=2*Math.PI*6378137/256/Math.pow(2,d);return[c*y-2*Math.PI*6378137/2,l*y-2*Math.PI*6378137/2]}class n_{constructor(l,d,y){this.z=l,this.x=d,this.y=y,this.key=vy(0,l,l,d,y)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d){const y=function(N,q,St){var Ht=f_(256*N,256*(q=Math.pow(2,St)-q-1),St),Ui=f_(256*(N+1),256*(q+1),St);return Ht[0]+","+Ht[1]+","+Ui[0]+","+Ui[1]}(this.x,this.y,this.z),M=function(N,q,St){let Ht,Ui="";for(let Bn=N;Bn>0;Bn--)Ht=1<<Bn-1,Ui+=(q&Ht?1:0)+(St&Ht?2:0);return Ui}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",M).replace("{bbox-epsg-3857}",y)}toString(){return`${this.z}/${this.x}/${this.y}`}}class n0{constructor(l,d){this.wrap=l,this.canonical=d,this.key=vy(l,d.z,d.z,d.x,d.y)}}class dg{constructor(l,d,y,M,N){this.overscaledZ=l,this.wrap=d,this.canonical=new n_(y,+M,+N),this.key=d===0&&l===y?this.canonical.key:vy(d,l,y,M,N)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){const d=this.canonical.z-l;return l>this.canonical.z?new dg(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dg(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d=!0){if(this.overscaledZ===l&&d)return this.key;if(l>this.canonical.z)return vy(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y);{const y=this.canonical.z-l;return vy(this.wrap*+d,l,l,this.canonical.x>>y,this.canonical.y>>y)}}isChildOf(l){if(l.wrap!==this.wrap)return!1;const d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new dg(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,y=2*this.canonical.x,M=2*this.canonical.y;return[new dg(d,this.wrap,d,y,M),new dg(d,this.wrap,d,y+1,M),new dg(d,this.wrap,d,y,M+1),new dg(d,this.wrap,d,y+1,M+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new dg(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new dg(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new n0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vy(c,l,d,y,M){const N=1<<Math.min(d,22);let q=N*(M%N)+y%N;return c&&d<22&&(q+=N*N*((c<0?-2*c-1:2*c)%(1<<2*(22-d)))),16*(32*q+d)+(l-d)}_e(n_,"CanonicalTileID"),_e(dg,"OverscaledTileID",{omit:["projMatrix"]});class $y extends Zu{constructor(l,d,y){super(l,d),this.z=y}}function sy(c,l){return c.x*l.x+c.y*l.y}function By(c,l){if(c.length===1){let d=0;const y=l[d++];let M;for(;!M||y.equals(M);)if(M=l[d++],!M)return 1/0;for(;d<l.length;d++){const N=l[d],q=c[0],St=M.sub(y),Ht=N.sub(y),Ui=q.sub(y),Bn=sy(St,St),ls=sy(St,Ht),il=sy(Ht,Ht),$u=sy(Ui,St),Ku=sy(Ui,Ht),rh=Bn*il-ls*ls,vh=(il*$u-ls*Ku)/rh,Ph=(Bn*Ku-ls*$u)/rh,Xh=y.z*(1-vh-Ph)+M.z*vh+N.z*Ph;if(isFinite(Xh))return Xh}return 1/0}{let d=1/0;for(const y of l)d=Math.min(d,y.z);return d}}function ly(c,l,d,y,M,N,q,St){const Ht=q*M.getElevationAt(c,l,!0,!0),Ui=N[0]!==0,Bn=Ui?N[1]===0?q*(N[0]/7-450):q*function(ls,il,$u){const Ku=Math.floor(il[0]/8),rh=Math.floor(il[1]/8),vh=10*(il[0]-8*Ku),Ph=10*(il[1]-8*rh),Xh=ls.getElevationAt(Ku,rh,!0,!0),Dh=ls.getMeterToDEM($u),jh=Math.floor(.5*(vh*Dh-1)),ad=Math.floor(.5*(Ph*Dh-1)),nd=ls.tileCoordToPixel(Ku,rh),Bd=2*jh+1,Rd=2*ad+1,bf=function(Yf,xf,dp,Sp,pp){return[Yf.getElevationAtPixel(xf,dp,!0),Yf.getElevationAtPixel(xf+pp,dp,!0),Yf.getElevationAtPixel(xf,dp+pp,!0),Yf.getElevationAtPixel(xf+Sp,dp+pp,!0)]}(ls,nd.x-jh,nd.y-ad,Bd,Rd),qf=Math.abs(bf[0]-bf[1]),Xd=Math.abs(bf[2]-bf[3]),kf=Math.abs(bf[0]-bf[2])+Math.abs(bf[1]-bf[3]),Df=Math.min(.25,.5*Dh*(qf+Xd)/Bd),Ff=Math.min(.25,.5*Dh*kf/Rd);return Xh+Math.max(Df*vh,Ff*Ph)}(M,N,St):Ht;return{base:Ht+(d===0)?-1:d,top:Ui?Math.max(Bn+y,Ht+d+2):Ht+y}}const Rv=ud([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:xx}=Rv,kw=ud([{name:"a_packed",components:4,type:"Float32"}]),{members:Fb}=kw,Ub=Tg.types,Ov=Math.cos(Math.PI/180*37.5);class bx{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.projection=l.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Od,this.layoutVertexArray2=new Lf,this.indexArray=new kp,this.programConfigurations=new Iv(l.layers,l.zoom),this.segments=new Eg,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,y,M){this.hasPattern=wh("line",this.layers,d);const N=this.layers[0].layout.get("line-sort-key"),q=[];for(const{feature:Bn,id:ls,index:il,sourceLayerIndex:$u}of l){const Ku=this.layers[0]._featureFilter.needGeometry,rh=y1(Bn,Ku);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),rh,y))continue;const vh=N?N.evaluate(rh,{},y):void 0,Ph={id:ls,properties:Bn.properties,type:Bn.type,sourceLayerIndex:$u,index:il,geometry:Ku?rh.geometry:U0(Bn,y,M),patterns:{},sortKey:vh};q.push(Ph)}N&&q.sort((Bn,ls)=>Bn.sortKey-ls.sortKey);const{lineAtlas:St,featureIndex:Ht}=d,Ui=this.addConstantDashes(St);for(const Bn of q){const{geometry:ls,index:il,sourceLayerIndex:$u}=Bn;if(Ui&&this.addFeatureDashes(Bn,St),this.hasPattern){const Ku=Jh("line",this.layers,Bn,this.zoom,d);this.patternFeatures.push(Ku)}else this.addFeature(Bn,ls,il,y,St.positions,d.availableImages);Ht.insert(l[il].feature,ls,il,$u,this.index)}}addConstantDashes(l){let d=!1;for(const y of this.layers){const M=y.paint.get("line-dasharray").value,N=y.layout.get("line-cap").value;if(M.kind!=="constant"||N.kind!=="constant")d=!0;else{const q=N.value,St=M.value;if(!St)continue;l.addDash(St,q)}}return d}addFeatureDashes(l,d){const y=this.zoom;for(const M of this.layers){const N=M.paint.get("line-dasharray").value,q=M.layout.get("line-cap").value;if(N.kind==="constant"&&q.kind==="constant")continue;let St,Ht;if(N.kind==="constant"){if(St=N.value,!St)continue}else St=N.evaluate({zoom:y},l);Ht=q.kind==="constant"?q.value:q.evaluate({zoom:y},l),d.addDash(St,Ht),l.patterns[M.id]=d.getKey(St,Ht)}}update(l,d,y,M){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,y,M)}addFeatures(l,d,y,M,N){for(const q of this.patternFeatures)this.addFeature(q,q.geometry,q.index,d,y,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,Fb)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,xx),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&l.properties.hasOwnProperty("mapbox_clip_start")&&l.properties.hasOwnProperty("mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,y,M,N,q){const St=this.layers[0].layout,Ht=St.get("line-join").evaluate(l,{}),Ui=St.get("line-cap").evaluate(l,{}),Bn=St.get("line-miter-limit"),ls=St.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const il of d)this.addLine(il,l,Ht,Ui,Bn,ls);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,y,N,q,M)}addLine(l,d,y,M,N,q){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ph=0;Ph<l.length-1;Ph++)this.totalDistance+=l[Ph].dist(l[Ph+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const St=Ub[d.type]==="Polygon";let Ht=l.length;for(;Ht>=2&&l[Ht-1].equals(l[Ht-2]);)Ht--;let Ui=0;for(;Ui<Ht-1&&l[Ui].equals(l[Ui+1]);)Ui++;if(Ht<(St?3:2))return;y==="bevel"&&(N=1.05);const Bn=this.overscaling<=16?15*Rp/(512*this.overscaling):0,ls=this.segments.prepareSegment(10*Ht,this.layoutVertexArray,this.indexArray);let il,$u,Ku,rh,vh;this.e1=this.e2=-1,St&&(il=l[Ht-2],vh=l[Ui].sub(il)._unit()._perp());for(let Ph=Ui;Ph<Ht;Ph++){if(Ku=Ph===Ht-1?St?l[Ui+1]:void 0:l[Ph+1],Ku&&l[Ph].equals(Ku))continue;vh&&(rh=vh),il&&($u=il),il=l[Ph],vh=Ku?Ku.sub(il)._unit()._perp():rh,rh=rh||vh;let Xh=rh.add(vh);Xh.x===0&&Xh.y===0||Xh._unit();const Dh=rh.x*vh.x+rh.y*vh.y,jh=Xh.x*vh.x+Xh.y*vh.y,ad=jh!==0?1/jh:1/0,nd=2*Math.sqrt(2-2*jh),Bd=jh<Ov&&$u&&Ku,Rd=rh.x*vh.y-rh.y*vh.x>0;if(Bd&&Ph>Ui){const Xd=il.dist($u);if(Xd>2*Bn){const kf=il.sub(il.sub($u)._mult(Bn/Xd)._round());this.updateDistance($u,kf),this.addCurrentVertex(kf,rh,0,0,ls),$u=kf}}const bf=$u&&Ku;let qf=bf?y:St?"butt":M;if(bf&&qf==="round"&&(ad<q?qf="miter":ad<=2&&(qf="fakeround")),qf==="miter"&&ad>N&&(qf="bevel"),qf==="bevel"&&(ad>2&&(qf="flipbevel"),ad<N&&(qf="miter")),$u&&this.updateDistance($u,il),qf==="miter")Xh._mult(ad),this.addCurrentVertex(il,Xh,0,0,ls);else if(qf==="flipbevel"){if(ad>100)Xh=vh.mult(-1);else{const Xd=ad*rh.add(vh).mag()/rh.sub(vh).mag();Xh._perp()._mult(Xd*(Rd?-1:1))}this.addCurrentVertex(il,Xh,0,0,ls),this.addCurrentVertex(il,Xh.mult(-1),0,0,ls)}else if(qf==="bevel"||qf==="fakeround"){const Xd=-Math.sqrt(ad*ad-1),kf=Rd?Xd:0,Df=Rd?0:Xd;if($u&&this.addCurrentVertex(il,rh,kf,Df,ls),qf==="fakeround"){const Ff=Math.round(180*nd/Math.PI/20);for(let Yf=1;Yf<Ff;Yf++){let xf=Yf/Ff;if(xf!==.5){const Sp=xf-.5;xf+=xf*Sp*(xf-1)*((1.0904+Dh*(Dh*(3.55645-1.43519*Dh)-3.2452))*Sp*Sp+(.848013+Dh*(.215638*Dh-1.06021)))}const dp=vh.sub(rh)._mult(xf)._add(rh)._unit()._mult(Rd?-1:1);this.addHalfVertex(il,dp.x,dp.y,!1,Rd,0,ls)}}Ku&&this.addCurrentVertex(il,vh,-kf,-Df,ls)}else if(qf==="butt")this.addCurrentVertex(il,Xh,0,0,ls);else if(qf==="square"){const Xd=$u?1:-1;$u||this.addCurrentVertex(il,Xh,Xd,Xd,ls),this.addCurrentVertex(il,Xh,0,0,ls),$u&&this.addCurrentVertex(il,Xh,Xd,Xd,ls)}else qf==="round"&&($u&&(this.addCurrentVertex(il,rh,0,0,ls),this.addCurrentVertex(il,rh,1,1,ls,!0)),Ku&&(this.addCurrentVertex(il,vh,-1,-1,ls,!0),this.addCurrentVertex(il,vh,0,0,ls)));if(Bd&&Ph<Ht-1){const Xd=il.dist(Ku);if(Xd>2*Bn){const kf=il.add(Ku.sub(il)._mult(Bn/Xd)._round());this.updateDistance(il,kf),this.addCurrentVertex(kf,vh,0,0,ls),il=kf}}}}addCurrentVertex(l,d,y,M,N,q=!1){const St=d.y*M-d.x,Ht=-d.y-d.x*M;this.addHalfVertex(l,d.x+d.y*y,d.y-d.x*y,q,!1,y,N),this.addHalfVertex(l,St,Ht,q,!0,-M,N)}addHalfVertex({x:l,y:d},y,M,N,q,St,Ht){this.layoutVertexArray.emplaceBack((l<<1)+(N?1:0),(d<<1)+(q?1:0),Math.round(63*y)+128,Math.round(63*M)+128,1+(St===0?0:St<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const Ui=Ht.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ui),Ht.primitiveLength++),q?this.e2=Ui:this.e1=Ui}updateScaledDistance(){if(this.lineClips){const l=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=l*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}_e(bx,"LineBucket",{omit:["layers","patternFeatures"]});const Vb=new Oh({"line-cap":new bh(Yd.layout_line["line-cap"]),"line-join":new bh(Yd.layout_line["line-join"]),"line-miter-limit":new Qu(Yd.layout_line["line-miter-limit"]),"line-round-limit":new Qu(Yd.layout_line["line-round-limit"]),"line-sort-key":new bh(Yd.layout_line["line-sort-key"])});var Yx={paint:new Oh({"line-opacity":new bh(Yd.paint_line["line-opacity"]),"line-color":new bh(Yd.paint_line["line-color"]),"line-translate":new Qu(Yd.paint_line["line-translate"]),"line-translate-anchor":new Qu(Yd.paint_line["line-translate-anchor"]),"line-width":new bh(Yd.paint_line["line-width"]),"line-gap-width":new bh(Yd.paint_line["line-gap-width"]),"line-offset":new bh(Yd.paint_line["line-offset"]),"line-blur":new bh(Yd.paint_line["line-blur"]),"line-dasharray":new bh(Yd.paint_line["line-dasharray"]),"line-pattern":new bh(Yd.paint_line["line-pattern"]),"line-gradient":new kh(Yd.paint_line["line-gradient"]),"line-trim-offset":new Qu(Yd.paint_line["line-trim-offset"])}),layout:Vb};const Gb=new class extends bh{possiblyEvaluate(c,l){return l=new Gn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(c,l)}evaluate(c,l,d,y){return l=xd({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(c,l,d,y)}}(Yx.paint.properties["line-width"].specification);function Dw(c,l){return l>0?l+2*c:c}Gb.useIntegerZoom=!0;const f2=ud([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),p2=ud([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),m2=ud([{name:"a_projected_pos",components:4,type:"Float32"}],4);ud([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const g2=ud([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_2=ud([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ud([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Lw=ud([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),y2=ud([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ud([{name:"triangle",components:3,type:"Uint16"}]),ud([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ud([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ud([{type:"Float32",name:"offsetX"}]),ud([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Qm=24;const Ny=128;function Jx(c,l){const{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Gn(c+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:M}=d;let N=0;for(;N<y.length&&y[N]<=c;)N++;N=Math.max(0,N-1);let q=N;for(;q<y.length&&y[q]<c+1;)q++;q=Math.min(y.length-1,q);const St=y[N],Ht=y[q];return d.kind==="composite"?{kind:"composite",minZoom:St,maxZoom:Ht,interpolationType:M}:{kind:"camera",minZoom:St,maxZoom:Ht,minSize:d.evaluate(new Gn(St)),maxSize:d.evaluate(new Gn(Ht)),interpolationType:M}}}function C_(c,{uSize:l,uSizeT:d},{lowerSize:y,upperSize:M}){return c.kind==="source"?y/Ny:c.kind==="composite"?im(y/Ny,M/Ny,d):l}function xy(c,l){let d=0,y=0;if(c.kind==="constant")y=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:M,minZoom:N,maxZoom:q}=c,St=M?Cd(__.interpolationFactor(M,l,N,q),0,1):0;c.kind==="camera"?y=im(c.minSize,c.maxSize,St):d=St}return{uSizeT:d,uSize:y}}var wx=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ny,evaluateSizeForFeature:C_,evaluateSizeForZoom:xy,getSizeData:Jx});function Ex(c,l,d){return c.sections.forEach(y=>{y.text=function(M,N,q){const St=N.layout.get("text-transform").evaluate(q,{});return St==="uppercase"?M=M.toLocaleUpperCase():St==="lowercase"&&(M=M.toLocaleLowerCase()),Ur.applyArabicShaping&&(M=Ur.applyArabicShaping(M)),M}(y.text,l,d)}),c}const q1={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function w1(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function dS(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var X2=eg,K2=function(c,l,d,y,M){var N,q,St=8*M-y-1,Ht=(1<<St)-1,Ui=Ht>>1,Bn=-7,ls=d?M-1:0,il=d?-1:1,$u=c[l+ls];for(ls+=il,N=$u&(1<<-Bn)-1,$u>>=-Bn,Bn+=St;Bn>0;N=256*N+c[l+ls],ls+=il,Bn-=8);for(q=N&(1<<-Bn)-1,N>>=-Bn,Bn+=y;Bn>0;q=256*q+c[l+ls],ls+=il,Bn-=8);if(N===0)N=1-Ui;else{if(N===Ht)return q?NaN:1/0*($u?-1:1);q+=Math.pow(2,y),N-=Ui}return($u?-1:1)*q*Math.pow(2,N-y)},W2=function(c,l,d,y,M,N){var q,St,Ht,Ui=8*N-M-1,Bn=(1<<Ui)-1,ls=Bn>>1,il=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,$u=y?0:N-1,Ku=y?1:-1,rh=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(St=isNaN(l)?1:0,q=Bn):(q=Math.floor(Math.log(l)/Math.LN2),l*(Ht=Math.pow(2,-q))<1&&(q--,Ht*=2),(l+=q+ls>=1?il/Ht:il*Math.pow(2,1-ls))*Ht>=2&&(q++,Ht/=2),q+ls>=Bn?(St=0,q=Bn):q+ls>=1?(St=(l*Ht-1)*Math.pow(2,M),q+=ls):(St=l*Math.pow(2,ls-1)*Math.pow(2,M),q=0));M>=8;c[d+$u]=255&St,$u+=Ku,St/=256,M-=8);for(q=q<<M|St,Ui+=M;Ui>0;c[d+$u]=255&q,$u+=Ku,q/=256,Ui-=8);c[d+$u-Ku]|=128*rh};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function eg(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}eg.Varint=0,eg.Fixed64=1,eg.Bytes=2,eg.Fixed32=5;var v2=4294967296,Y2=1/v2,J2=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function E1(c){return c.type===eg.Bytes?c.readVarint()+c.pos:c.pos+1}function Qx(c,l,d){return d?4294967296*l+(c>>>0):4294967296*(l>>>0)+(c>>>0)}function Q2(c,l,d){var y=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));d.realloc(y);for(var M=d.pos-1;M>=c;M--)d.buf[M+y]=d.buf[M]}function fS(c,l){for(var d=0;d<c.length;d++)l.writeVarint(c[d])}function pS(c,l){for(var d=0;d<c.length;d++)l.writeSVarint(c[d])}function mS(c,l){for(var d=0;d<c.length;d++)l.writeFloat(c[d])}function gS(c,l){for(var d=0;d<c.length;d++)l.writeDouble(c[d])}function _S(c,l){for(var d=0;d<c.length;d++)l.writeBoolean(c[d])}function yS(c,l){for(var d=0;d<c.length;d++)l.writeFixed32(c[d])}function vS(c,l){for(var d=0;d<c.length;d++)l.writeSFixed32(c[d])}function xS(c,l){for(var d=0;d<c.length;d++)l.writeFixed64(c[d])}function bS(c,l){for(var d=0;d<c.length;d++)l.writeSFixed64(c[d])}function Rw(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+16777216*c[l+3]}function eb(c,l,d){c[d]=l,c[d+1]=l>>>8,c[d+2]=l>>>16,c[d+3]=l>>>24}function eE(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+(c[l+3]<<24)}eg.prototype={destroy:function(){this.buf=null},readFields:function(c,l,d){for(d=d||this.length;this.pos<d;){var y=this.readVarint(),M=y>>3,N=this.pos;this.type=7&y,c(M,l,this),this.pos===N&&this.skip(y)}return l},readMessage:function(c,l){return this.readFields(c,l,this.readVarint()+this.pos)},readFixed32:function(){var c=Rw(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=eE(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Rw(this.buf,this.pos)+Rw(this.buf,this.pos+4)*v2;return this.pos+=8,c},readSFixed64:function(){var c=Rw(this.buf,this.pos)+eE(this.buf,this.pos+4)*v2;return this.pos+=8,c},readFloat:function(){var c=K2(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=K2(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var l,d,y=this.buf;return l=127&(d=y[this.pos++]),d<128?l:(l|=(127&(d=y[this.pos++]))<<7,d<128?l:(l|=(127&(d=y[this.pos++]))<<14,d<128?l:(l|=(127&(d=y[this.pos++]))<<21,d<128?l:function(M,N,q){var St,Ht,Ui=q.buf;if(St=(112&(Ht=Ui[q.pos++]))>>4,Ht<128||(St|=(127&(Ht=Ui[q.pos++]))<<3,Ht<128)||(St|=(127&(Ht=Ui[q.pos++]))<<10,Ht<128)||(St|=(127&(Ht=Ui[q.pos++]))<<17,Ht<128)||(St|=(127&(Ht=Ui[q.pos++]))<<24,Ht<128)||(St|=(1&(Ht=Ui[q.pos++]))<<31,Ht<128))return Qx(M,St,N);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(d=y[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,l=this.pos;return this.pos=c,c-l>=12&&J2?function(d,y,M){return J2.decode(d.subarray(y,M))}(this.buf,l,c):function(d,y,M){for(var N="",q=y;q<M;){var St,Ht,Ui,Bn=d[q],ls=null,il=Bn>239?4:Bn>223?3:Bn>191?2:1;if(q+il>M)break;il===1?Bn<128&&(ls=Bn):il===2?(192&(St=d[q+1]))==128&&(ls=(31&Bn)<<6|63&St)<=127&&(ls=null):il===3?(Ht=d[q+2],(192&(St=d[q+1]))==128&&(192&Ht)==128&&((ls=(15&Bn)<<12|(63&St)<<6|63&Ht)<=2047||ls>=55296&&ls<=57343)&&(ls=null)):il===4&&(Ht=d[q+2],Ui=d[q+3],(192&(St=d[q+1]))==128&&(192&Ht)==128&&(192&Ui)==128&&((ls=(15&Bn)<<18|(63&St)<<12|(63&Ht)<<6|63&Ui)<=65535||ls>=1114112)&&(ls=null)),ls===null?(ls=65533,il=1):ls>65535&&(ls-=65536,N+=String.fromCharCode(ls>>>10&1023|55296),ls=56320|1023&ls),N+=String.fromCharCode(ls),q+=il}return N}(this.buf,l,c)},readBytes:function(){var c=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,c);return this.pos=c,l},readPackedVarint:function(c,l){if(this.type!==eg.Bytes)return c.push(this.readVarint(l));var d=E1(this);for(c=c||[];this.pos<d;)c.push(this.readVarint(l));return c},readPackedSVarint:function(c){if(this.type!==eg.Bytes)return c.push(this.readSVarint());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==eg.Bytes)return c.push(this.readBoolean());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==eg.Bytes)return c.push(this.readFloat());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==eg.Bytes)return c.push(this.readDouble());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==eg.Bytes)return c.push(this.readFixed32());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==eg.Bytes)return c.push(this.readSFixed32());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==eg.Bytes)return c.push(this.readFixed64());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==eg.Bytes)return c.push(this.readSFixed64());var l=E1(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed64());return c},skip:function(c){var l=7&c;if(l===eg.Varint)for(;this.buf[this.pos++]>127;);else if(l===eg.Bytes)this.pos=this.readVarint()+this.pos;else if(l===eg.Fixed32)this.pos+=4;else{if(l!==eg.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(c,l){this.writeVarint(c<<3|l)},realloc:function(c){for(var l=this.length||16;l<this.pos+c;)l*=2;if(l!==this.length){var d=new Uint8Array(l);d.set(this.buf),this.buf=d,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),eb(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),eb(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),eb(this.buf,-1&c,this.pos),eb(this.buf,Math.floor(c*Y2),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),eb(this.buf,-1&c,this.pos),eb(this.buf,Math.floor(c*Y2),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(l,d){var y,M;if(l>=0?(y=l%4294967296|0,M=l/4294967296|0):(M=~(-l/4294967296),4294967295^(y=~(-l%4294967296))?y=y+1|0:(y=0,M=M+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(N,q,St){St.buf[St.pos++]=127&N|128,N>>>=7,St.buf[St.pos++]=127&N|128,N>>>=7,St.buf[St.pos++]=127&N|128,N>>>=7,St.buf[St.pos++]=127&N|128,St.buf[St.pos]=127&(N>>>=7)}(y,0,d),function(N,q){var St=(7&N)<<4;q.buf[q.pos++]|=St|((N>>>=3)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N)))))}(M,d)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var l=this.pos;this.pos=function(y,M,N){for(var q,St,Ht=0;Ht<M.length;Ht++){if((q=M.charCodeAt(Ht))>55295&&q<57344){if(!St){q>56319||Ht+1===M.length?(y[N++]=239,y[N++]=191,y[N++]=189):St=q;continue}if(q<56320){y[N++]=239,y[N++]=191,y[N++]=189,St=q;continue}q=St-55296<<10|q-56320|65536,St=null}else St&&(y[N++]=239,y[N++]=191,y[N++]=189,St=null);q<128?y[N++]=q:(q<2048?y[N++]=q>>6|192:(q<65536?y[N++]=q>>12|224:(y[N++]=q>>18|240,y[N++]=q>>12&63|128),y[N++]=q>>6&63|128),y[N++]=63&q|128)}return N}(this.buf,c,this.pos);var d=this.pos-l;d>=128&&Q2(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeFloat:function(c){this.realloc(4),W2(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),W2(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var l=c.length;this.writeVarint(l),this.realloc(l);for(var d=0;d<l;d++)this.buf[this.pos++]=c[d]},writeRawMessage:function(c,l){this.pos++;var d=this.pos;c(l,this);var y=this.pos-d;y>=128&&Q2(d,y,this),this.pos=d-1,this.writeVarint(y),this.pos+=y},writeMessage:function(c,l,d){this.writeTag(c,eg.Bytes),this.writeRawMessage(l,d)},writePackedVarint:function(c,l){l.length&&this.writeMessage(c,fS,l)},writePackedSVarint:function(c,l){l.length&&this.writeMessage(c,pS,l)},writePackedBoolean:function(c,l){l.length&&this.writeMessage(c,_S,l)},writePackedFloat:function(c,l){l.length&&this.writeMessage(c,mS,l)},writePackedDouble:function(c,l){l.length&&this.writeMessage(c,gS,l)},writePackedFixed32:function(c,l){l.length&&this.writeMessage(c,yS,l)},writePackedSFixed32:function(c,l){l.length&&this.writeMessage(c,vS,l)},writePackedFixed64:function(c,l){l.length&&this.writeMessage(c,xS,l)},writePackedSFixed64:function(c,l){l.length&&this.writeMessage(c,bS,l)},writeBytesField:function(c,l){this.writeTag(c,eg.Bytes),this.writeBytes(l)},writeFixed32Field:function(c,l){this.writeTag(c,eg.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(c,l){this.writeTag(c,eg.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(c,l){this.writeTag(c,eg.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(c,l){this.writeTag(c,eg.Fixed64),this.writeSFixed64(l)},writeVarintField:function(c,l){this.writeTag(c,eg.Varint),this.writeVarint(l)},writeSVarintField:function(c,l){this.writeTag(c,eg.Varint),this.writeSVarint(l)},writeStringField:function(c,l){this.writeTag(c,eg.Bytes),this.writeString(l)},writeFloatField:function(c,l){this.writeTag(c,eg.Fixed32),this.writeFloat(l)},writeDoubleField:function(c,l){this.writeTag(c,eg.Fixed64),this.writeDouble(l)},writeBooleanField:function(c,l){this.writeVarintField(c,!!l)}};var Ow=Io(X2);const x2=3;function wS(c,l,d){l.glyphs=[],c===1&&d.readMessage(ES,l)}function ES(c,l,d){if(c===3){const{id:y,bitmap:M,width:N,height:q,left:St,top:Ht,advance:Ui}=d.readMessage(SS,{});l.glyphs.push({id:y,bitmap:new hv({width:N+2*x2,height:q+2*x2},M),metrics:{width:N,height:q,left:St,top:Ht,advance:Ui}})}else c===4?l.ascender=d.readSVarint():c===5&&(l.descender=d.readSVarint())}function SS(c,l,d){c===1?l.id=d.readVarint():c===2?l.bitmap=d.readBytes():c===3?l.width=d.readVarint():c===4?l.height=d.readVarint():c===5?l.left=d.readSVarint():c===6?l.top=d.readSVarint():c===7&&(l.advance=d.readVarint())}const tE=x2;function b2(c){let l=0,d=0;for(const q of c)l+=q.w*q.h,d=Math.max(d,q.w);c.sort((q,St)=>St.h-q.h);const y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}];let M=0,N=0;for(const q of c)for(let St=y.length-1;St>=0;St--){const Ht=y[St];if(!(q.w>Ht.w||q.h>Ht.h)){if(q.x=Ht.x,q.y=Ht.y,N=Math.max(N,q.y+q.h),M=Math.max(M,q.x+q.w),q.w===Ht.w&&q.h===Ht.h){const Ui=y.pop();St<y.length&&(y[St]=Ui)}else q.h===Ht.h?(Ht.x+=q.w,Ht.w-=q.w):q.w===Ht.w?(Ht.y+=q.h,Ht.h-=q.h):(y.push({x:Ht.x+q.w,y:Ht.y,w:Ht.w-q.w,h:q.h}),Ht.y+=q.h,Ht.h-=q.h);break}}return{w:M,h:N,fill:l/(M*N)||0}}const o0=1;class w2{constructor(l,{pixelRatio:d,version:y,stretchX:M,stretchY:N,content:q}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=M,this.stretchY=N,this.content=q,this.version=y}get tl(){return[this.paddedRect.x+o0,this.paddedRect.y+o0]}get br(){return[this.paddedRect.x+this.paddedRect.w-o0,this.paddedRect.y+this.paddedRect.h-o0]}get displaySize(){return[(this.paddedRect.w-2*o0)/this.pixelRatio,(this.paddedRect.h-2*o0)/this.pixelRatio]}}class iE{constructor(l,d){const y={},M={};this.haveRenderCallbacks=[];const N=[];this.addImages(l,y,N),this.addImages(d,M,N);const{w:q,h:St}=b2(N),Ht=new ry({width:q||1,height:St||1});for(const Ui in l){const Bn=l[Ui],ls=y[Ui].paddedRect;ry.copy(Bn.data,Ht,{x:0,y:0},{x:ls.x+o0,y:ls.y+o0},Bn.data)}for(const Ui in d){const Bn=d[Ui],ls=M[Ui].paddedRect,il=ls.x+o0,$u=ls.y+o0,Ku=Bn.data.width,rh=Bn.data.height;ry.copy(Bn.data,Ht,{x:0,y:0},{x:il,y:$u},Bn.data),ry.copy(Bn.data,Ht,{x:0,y:rh-1},{x:il,y:$u-1},{width:Ku,height:1}),ry.copy(Bn.data,Ht,{x:0,y:0},{x:il,y:$u+rh},{width:Ku,height:1}),ry.copy(Bn.data,Ht,{x:Ku-1,y:0},{x:il-1,y:$u},{width:1,height:rh}),ry.copy(Bn.data,Ht,{x:0,y:0},{x:il+Ku,y:$u},{width:1,height:rh})}this.image=Ht,this.iconPositions=y,this.patternPositions=M}addImages(l,d,y){for(const M in l){const N=l[M],q={x:0,y:0,w:N.data.width+2*o0,h:N.data.height+2*o0};y.push(q),d[M]=new w2(q,N),N.hasRenderCallback&&this.haveRenderCallbacks.push(M)}}patchUpdatedImages(l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(y=>l.hasImage(y)),l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const y in l.updatedImages)this.patchUpdatedImage(this.iconPositions[y],l.getImage(y),d),this.patchUpdatedImage(this.patternPositions[y],l.getImage(y),d)}patchUpdatedImage(l,d,y){if(!l||!d||l.version===d.version)return;l.version=d.version;const[M,N]=l.tl;y.update(d.data,void 0,{x:M,y:N})}}_e(w2,"ImagePosition"),_e(iE,"ImageAtlas");const G0={horizontal:1,vertical:2,horizontalOnly:3},rE=-17;class jb{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,d){const y=new jb;return y.scale=l||1,y.fontStack=d,y}static forImage(l){const d=new jb;return d.imageName=l,d}}class tb{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){const y=new tb;for(let M=0;M<l.sections.length;M++){const N=l.sections[M];N.image?y.addImageSection(N):y.addTextSection(N,d)}return y}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSections(){return this.sections}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(l){this.text=function(d,y){let M="";for(let N=0;N<d.length;N++){const q=d.charCodeAt(N+1)||null,St=d.charCodeAt(N-1)||null;M+=!y&&(q&&Bh(q)&&!q1[d[N+1]]||St&&Bh(St)&&!q1[d[N-1]])||!q1[d[N]]?d[N]:q1[d[N]]}return M}(this.text,l)}trim(){let l=0;for(let y=0;y<this.text.length&&$w[this.text.charCodeAt(y)];y++)l++;let d=this.text.length;for(let y=this.text.length-1;y>=0&&y>=l&&$w[this.text.charCodeAt(y)];y--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){const y=new tb;return y.text=this.text.substring(l,d),y.sectionIndex=this.sectionIndex.slice(l,d),y.sections=this.sections,y}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}addTextSection(l,d){this.text+=l.text,this.sections.push(jb.forText(l.scale,l.fontStack||d));const y=this.sections.length-1;for(let M=0;M<l.text.length;++M)this.sectionIndex.push(y)}addImageSection(l){const d=l.image?l.image.name:"";if(d.length===0)return void Vd("Can't add FormattedSection with an empty image.");const y=this.getNextImageSectionCharCode();y?(this.text+=String.fromCharCode(y),this.sections.push(jb.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Vd("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function E2(c,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku){const rh=tb.fromFeature(c,M);ls===G0.vertical&&rh.verticalizePunctuation(il);let vh=[];const Ph=function(nd,Bd,Rd,bf,qf,Xd){if(!nd)return[];const kf=[],Df=function(dp,Sp,pp,Qp,Qf,Up){let em=0;for(let Em=0;Em<dp.length();Em++){const tm=dp.getSection(Em);em+=nE(dp.getCharCode(Em),tm,Qp,Qf,Sp,Up)}return em/Math.max(1,Math.ceil(em/pp))}(nd,Bd,Rd,bf,qf,Xd),Ff=nd.text.indexOf("​")>=0;let Yf=0;for(let dp=0;dp<nd.length();dp++){const Sp=nd.getSection(dp),pp=nd.getCharCode(dp);if($w[pp]||(Yf+=nE(pp,Sp,bf,qf,Bd,Xd)),dp<nd.length()-1){const Qp=!((xf=pp)<11904||!(us["Bopomofo Extended"](xf)||us.Bopomofo(xf)||us["CJK Compatibility Forms"](xf)||us["CJK Compatibility Ideographs"](xf)||us["CJK Compatibility"](xf)||us["CJK Radicals Supplement"](xf)||us["CJK Strokes"](xf)||us["CJK Symbols and Punctuation"](xf)||us["CJK Unified Ideographs Extension A"](xf)||us["CJK Unified Ideographs"](xf)||us["Enclosed CJK Letters and Months"](xf)||us["Halfwidth and Fullwidth Forms"](xf)||us.Hiragana(xf)||us["Ideographic Description Characters"](xf)||us["Kangxi Radicals"](xf)||us["Katakana Phonetic Extensions"](xf)||us.Katakana(xf)||us["Vertical Forms"](xf)||us["Yi Radicals"](xf)||us["Yi Syllables"](xf)));(TS[pp]||Qp||Sp.imageName)&&kf.push(aE(dp+1,Yf,Df,kf,IS(pp,nd.getCharCode(dp+1),Qp&&Ff),!1))}}var xf;return sE(aE(nd.length(),Yf,Df,kf,0,!0))}(rh,Ui,N,l,y,$u),{processBidirectionalText:Xh,processStyledBidirectionalText:Dh}=Ur;if(Xh&&rh.sections.length===1){const nd=Xh(rh.toString(),Ph);for(const Bd of nd){const Rd=new tb;Rd.text=Bd,Rd.sections=rh.sections;for(let bf=0;bf<Bd.length;bf++)Rd.sectionIndex.push(0);vh.push(Rd)}}else if(Dh){const nd=Dh(rh.text,rh.sectionIndex,Ph);for(const Bd of nd){const Rd=new tb;Rd.text=Bd[0],Rd.sectionIndex=Bd[1],Rd.sections=rh.sections,vh.push(Rd)}}else vh=function(nd,Bd){const Rd=[],bf=nd.text;let qf=0;for(const Xd of Bd)Rd.push(nd.substring(qf,Xd)),qf=Xd;return qf<bf.length&&Rd.push(nd.substring(qf,bf.length)),Rd}(rh,Ph);const jh=[],ad={positionedLines:jh,text:rh.toString(),top:Bn[1],bottom:Bn[1],left:Bn[0],right:Bn[0],writingMode:ls,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(nd,Bd,Rd,bf,qf,Xd,kf,Df,Ff,Yf,xf,dp){let Sp=0,pp=0,Qp=0;const Qf=Df==="right"?1:Df==="left"?0:.5;let Up=!1;for(const rm of qf){const nm=rm.getSections();for(const Xm of nm){if(Xm.imageName)continue;const tg=Bd[Xm.fontStack];if(tg&&(Up=tg.ascender!==void 0&&tg.descender!==void 0,!Up))break}if(!Up)break}let em=0;for(const rm of qf){rm.trim();const nm=rm.getMaxScale(),Xm=(nm-1)*Qm,tg={positionedGlyphs:[],lineOffset:0};nd.positionedLines[em]=tg;const ig=tg.positionedGlyphs;let Km=0;if(!rm.length()){pp+=Xd,++em;continue}let yg=0,Lg=0;for(let Wm=0;Wm<rm.length();Wm++){const o_=rm.getSection(Wm),Kg=rm.getSectionIndex(Wm),Cg=rm.getCharCode(Wm);let Cm=o_.scale,Wg=null,rg=null,zy=null,Yg=Qm,V_=0;const M_=!(Ff===G0.horizontal||!xf&&!Rh(Cg)||xf&&($w[Cg]||(Em=Cg,us.Arabic(Em)||us["Arabic Supplement"](Em)||us["Arabic Extended-A"](Em)||us["Arabic Presentation Forms-A"](Em)||us["Arabic Presentation Forms-B"](Em))));if(o_.imageName){const Fy=bf[o_.imageName];if(!Fy)continue;zy=o_.imageName,nd.iconsInText=nd.iconsInText||!0,rg=Fy.paddedRect;const A_=Fy.displaySize;Cm=Cm*Qm/dp,Wg={width:A_[0],height:A_[1],left:o0,top:-tE,advance:M_?A_[1]:A_[0],localGlyph:!1},V_=Up?-Wg.height*Cm:rE+nm*Qm-A_[1]*Cm,Yg=Wg.advance;const Nv=(M_?A_[0]:A_[1])*Cm-Qm*nm;Nv>0&&Nv>Km&&(Km=Nv)}else{const Fy=Rd[o_.fontStack];if(!Fy)continue;Fy[Cg]&&(rg=Fy[Cg]);const A_=Bd[o_.fontStack];if(!A_)continue;const Nv=A_.glyphs[Cg];if(!Nv)continue;if(Wg=Nv.metrics,Yg=Cg!==8203?Qm:0,Up){const lb=A_.ascender!==void 0?Math.abs(A_.ascender):0,ew=A_.descender!==void 0?Math.abs(A_.descender):0,tw=(lb+ew)*Cm;yg<tw&&(yg=tw,Lg=(lb-ew)/2*Cm),V_=-lb*Cm}else V_=rE+(nm-Cm)*Qm}M_?(nd.verticalizable=!0,ig.push({glyph:Cg,imageName:zy,x:Sp,y:pp+V_,vertical:M_,scale:Cm,localGlyph:Wg.localGlyph,fontStack:o_.fontStack,sectionIndex:Kg,metrics:Wg,rect:rg}),Sp+=Yg*Cm+Yf):(ig.push({glyph:Cg,imageName:zy,x:Sp,y:pp+V_,vertical:M_,scale:Cm,localGlyph:Wg.localGlyph,fontStack:o_.fontStack,sectionIndex:Kg,metrics:Wg,rect:rg}),Sp+=Wg.advance*Cm+Yf)}ig.length!==0&&(Qp=Math.max(Sp-Yf,Qp),Up?lE(ig,Qf,Km,Lg,Xd*nm/2):lE(ig,Qf,Km,0,Xd/2)),Sp=0;const Xg=Xd*nm+Km;tg.lineOffset=Math.max(Km,Xm),pp+=Xg,++em}var Em;const tm=pp,{horizontalAlign:Zp,verticalAlign:ag}=S2(kf);(function(rm,nm,Xm,tg,ig,Km){const yg=(nm-Xm)*ig,Lg=-Km*tg;for(const Xg of rm)for(const Wm of Xg.positionedGlyphs)Wm.x+=yg,Wm.y+=Lg})(nd.positionedLines,Qf,Zp,ag,Qp,tm),nd.top+=-ag*tm,nd.bottom=nd.top+tm,nd.left+=-Zp*Qp,nd.right=nd.left+Qp,nd.hasBaseline=Up}(ad,l,d,y,vh,q,St,Ht,ls,Ui,il,Ku),!function(nd){for(const Bd of nd)if(Bd.positionedGlyphs.length!==0)return!1;return!0}(jh)&&ad}const $w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function nE(c,l,d,y,M,N){if(l.imageName){const q=y[l.imageName];return q?q.displaySize[0]*l.scale*Qm/N+M:0}{const q=d[l.fontStack],St=q&&q.glyphs[c];return St?St.metrics.advance*l.scale+M:0}}function oE(c,l,d,y){const M=Math.pow(c-l,2);return y?c<l?M/2:2*M:M+Math.abs(d)*d}function IS(c,l,d){let y=0;return c===10&&(y-=1e4),d&&(y+=150),c!==40&&c!==65288||(y+=50),l!==41&&l!==65289||(y+=50),y}function aE(c,l,d,y,M,N){let q=null,St=oE(l,d,M,N);for(const Ht of y){const Ui=oE(l-Ht.x,d,M,N)+Ht.badness;Ui<=St&&(q=Ht,St=Ui)}return{index:c,x:l,priorBreak:q,badness:St}}function sE(c){return c?sE(c.priorBreak).concat(c.index):[]}function S2(c){let l=.5,d=.5;switch(c){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function lE(c,l,d,y,M){if(!(l||d||y||M))return;const N=c.length-1,q=c[N],St=(q.x+q.metrics.advance*q.scale)*l;for(let Ht=0;Ht<=N;Ht++)c[Ht].x-=St,c[Ht].y+=d+y+M}function CS(c,l,d){const{horizontalAlign:y,verticalAlign:M}=S2(d),N=l[0]-c.displaySize[0]*y,q=l[1]-c.displaySize[1]*M;return{image:c,top:q,bottom:q+c.displaySize[1],left:N,right:N+c.displaySize[0]}}function cE(c,l,d,y,M,N){const q=c.image;let St;if(q.content){const vh=q.content,Ph=q.pixelRatio||1;St=[vh[0]/Ph,vh[1]/Ph,q.displaySize[0]-vh[2]/Ph,q.displaySize[1]-vh[3]/Ph]}const Ht=l.left*N,Ui=l.right*N;let Bn,ls,il,$u;d==="width"||d==="both"?($u=M[0]+Ht-y[3],ls=M[0]+Ui+y[1]):($u=M[0]+(Ht+Ui-q.displaySize[0])/2,ls=$u+q.displaySize[0]);const Ku=l.top*N,rh=l.bottom*N;return d==="height"||d==="both"?(Bn=M[1]+Ku-y[0],il=M[1]+rh+y[2]):(Bn=M[1]+(Ku+rh-q.displaySize[1])/2,il=Bn+q.displaySize[1]),{image:q,top:Bn,right:ls,bottom:il,left:$u,collisionPadding:St}}class S1 extends Zu{constructor(l,d,y,M,N){super(l,d),this.angle=M,this.z=y,N!==void 0&&(this.segment=N)}clone(){return new S1(this.x,this.y,this.z,this.angle,this.segment)}}function uE(c,l,d,y,M){if(l.segment===void 0)return!0;let N=l,q=l.segment+1,St=0;for(;St>-d/2;){if(q--,q<0)return!1;St-=c[q].dist(N),N=c[q]}St+=c[q].dist(c[q+1]),q++;const Ht=[];let Ui=0;for(;St<d/2;){const Bn=c[q],ls=c[q+1];if(!ls)return!1;let il=c[q-1].angleTo(Bn)-Bn.angleTo(ls);for(il=Math.abs((il+3*Math.PI)%(2*Math.PI)-Math.PI),Ht.push({distance:St,angleDelta:il}),Ui+=il;St-Ht[0].distance>y;)Ui-=Ht.shift().angleDelta;if(Ui>M)return!1;q++,St+=Bn.dist(ls)}return!0}function hE(c){let l=0;for(let d=0;d<c.length-1;d++)l+=c[d].dist(c[d+1]);return l}function dE(c,l,d){return c?.6*l*d:0}function fE(c,l){return Math.max(c?c.right-c.left:0,l?l.right-l.left:0)}function MS(c,l,d,y,M,N){const q=dE(d,M,N),St=fE(d,y)*N;let Ht=0;const Ui=hE(c)/2;for(let Bn=0;Bn<c.length-1;Bn++){const ls=c[Bn],il=c[Bn+1],$u=ls.dist(il);if(Ht+$u>Ui){const Ku=(Ui-Ht)/$u,rh=im(ls.x,il.x,Ku),vh=im(ls.y,il.y,Ku),Ph=new S1(rh,vh,0,il.angleTo(ls),Bn);return!q||uE(c,Ph,St,q,l)?Ph:void 0}Ht+=$u}}function AS(c,l,d,y,M,N,q,St,Ht){const Ui=dE(y,N,q),Bn=fE(y,M),ls=Bn*q,il=c[0].x===0||c[0].x===Ht||c[0].y===0||c[0].y===Ht;return l-ls<l/4&&(l=ls+l/4),pE(c,il?l/2*St%l:(Bn/2+2*N)*q*St%l,l,Ui,d,ls,il,!1,Ht)}function pE(c,l,d,y,M,N,q,St,Ht){const Ui=N/2,Bn=hE(c);let ls=0,il=l-d,$u=[];for(let Ku=0;Ku<c.length-1;Ku++){const rh=c[Ku],vh=c[Ku+1],Ph=rh.dist(vh),Xh=vh.angleTo(rh);for(;il+d<ls+Ph;){il+=d;const Dh=(il-ls)/Ph,jh=im(rh.x,vh.x,Dh),ad=im(rh.y,vh.y,Dh);if(jh>=0&&jh<Ht&&ad>=0&&ad<Ht&&il-Ui>=0&&il+Ui<=Bn){const nd=new S1(jh,ad,0,Xh,Ku);nd._round(),y&&!uE(c,nd,N,y,M)||$u.push(nd)}}ls+=Ph}return St||$u.length||q||($u=pE(c,ls/2,d,y,M,N,q,!0,Ht)),$u}function mE(c,l,d,y,M){const N=[];for(let q=0;q<c.length;q++){const St=c[q];let Ht;for(let Ui=0;Ui<St.length-1;Ui++){let Bn=St[Ui],ls=St[Ui+1];Bn.x<l&&ls.x<l||(Bn.x<l?Bn=new Zu(l,Bn.y+(l-Bn.x)/(ls.x-Bn.x)*(ls.y-Bn.y))._round():ls.x<l&&(ls=new Zu(l,Bn.y+(l-Bn.x)/(ls.x-Bn.x)*(ls.y-Bn.y))._round()),Bn.y<d&&ls.y<d||(Bn.y<d?Bn=new Zu(Bn.x+(d-Bn.y)/(ls.y-Bn.y)*(ls.x-Bn.x),d)._round():ls.y<d&&(ls=new Zu(Bn.x+(d-Bn.y)/(ls.y-Bn.y)*(ls.x-Bn.x),d)._round()),Bn.x>=y&&ls.x>=y||(Bn.x>=y?Bn=new Zu(y,Bn.y+(y-Bn.x)/(ls.x-Bn.x)*(ls.y-Bn.y))._round():ls.x>=y&&(ls=new Zu(y,Bn.y+(y-Bn.x)/(ls.x-Bn.x)*(ls.y-Bn.y))._round()),Bn.y>=M&&ls.y>=M||(Bn.y>=M?Bn=new Zu(Bn.x+(M-Bn.y)/(ls.y-Bn.y)*(ls.x-Bn.x),M)._round():ls.y>=M&&(ls=new Zu(Bn.x+(M-Bn.y)/(ls.y-Bn.y)*(ls.x-Bn.x),M)._round()),Ht&&Bn.equals(Ht[Ht.length-1])||(Ht=[Bn],N.push(Ht)),Ht.push(ls)))))}}return N}_e(S1,"Anchor");const qb=1e20;function gE(c,l,d,y,M,N,q,St,Ht){for(let Ui=l;Ui<l+y;Ui++)_E(c,d*N+Ui,N,M,q,St,Ht);for(let Ui=d;Ui<d+M;Ui++)_E(c,Ui*N+l,1,y,q,St,Ht)}function _E(c,l,d,y,M,N,q){N[0]=0,q[0]=-qb,q[1]=qb,M[0]=c[l];for(let St=1,Ht=0,Ui=0;St<y;St++){M[St]=c[l+St*d];const Bn=St*St;do{const ls=N[Ht];Ui=(M[St]-M[ls]+Bn-ls*ls)/(St-ls)/2}while(Ui<=q[Ht]&&--Ht>-1);Ht++,N[Ht]=St,q[Ht]=Ui,q[Ht+1]=qb}for(let St=0,Ht=0;St<y;St++){for(;q[Ht+1]<St;)Ht++;const Ui=N[Ht],Bn=St-Ui;c[l+St*d]=M[Ui]+Bn*Bn}}const $v=2,T2={none:0,ideographs:1,all:2};class ib{constructor(l,d,y){this.requestManager=l,this.localGlyphMode=d,this.localFontFamily=y,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(l){this.url=l}getGlyphs(l,d){const y=[];for(const M in l)for(const N of l[M])y.push({stack:M,id:N});yd(y,({stack:M,id:N},q)=>{let St=this.entries[M];St||(St=this.entries[M]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let Ht=St.glyphs[N];if(Ht!==void 0)return void q(null,{stack:M,id:N,glyph:Ht});if(Ht=this._tinySDF(St,M,N),Ht)return St.glyphs[N]=Ht,void q(null,{stack:M,id:N,glyph:Ht});const Ui=Math.floor(N/256);if(256*Ui>65535)return void q(new Error("glyphs > 65535 not supported"));if(St.ranges[Ui])return void q(null,{stack:M,id:N,glyph:Ht});let Bn=St.requests[Ui];Bn||(Bn=St.requests[Ui]=[],ib.loadGlyphRange(M,Ui,this.url,this.requestManager,(ls,il)=>{if(il){St.ascender=il.ascender,St.descender=il.descender;for(const $u in il.glyphs)this._doesCharSupportLocalGlyph(+$u)||(St.glyphs[+$u]=il.glyphs[+$u]);St.ranges[Ui]=!0}for(const $u of Bn)$u(ls,il);delete St.requests[Ui]})),Bn.push((ls,il)=>{ls?q(ls):il&&q(null,{stack:M,id:N,glyph:il.glyphs[N]||null})})},(M,N)=>{if(M)d(M);else if(N){const q={};for(const{stack:St,id:Ht,glyph:Ui}of N)q[St]===void 0&&(q[St]={}),q[St].glyphs===void 0&&(q[St].glyphs={}),q[St].glyphs[Ht]=Ui&&{id:Ui.id,bitmap:Ui.bitmap.clone(),metrics:Ui.metrics},q[St].ascender=this.entries[St].ascender,q[St].descender=this.entries[St].descender;d(null,q)}})}_doesCharSupportLocalGlyph(l){return this.localGlyphMode!==T2.none&&(this.localGlyphMode===T2.all?!!this.localFontFamily:!!this.localFontFamily&&(us["CJK Unified Ideographs"](l)||us["Hangul Syllables"](l)||us.Hiragana(l)||us.Katakana(l)||us["CJK Symbols and Punctuation"](l)))}_tinySDF(l,d,y){const M=this.localFontFamily;if(!M||!this._doesCharSupportLocalGlyph(y))return;let N=l.tinySDF;if(!N){let rh="400";/bold/i.test(d)?rh="900":/medium/i.test(d)?rh="500":/light/i.test(d)&&(rh="200"),N=l.tinySDF=new ib.TinySDF({fontFamily:M,fontWeight:rh,fontSize:24*$v,buffer:3*$v,radius:8*$v}),N.fontWeight=rh}if(this.localGlyphs[N.fontWeight][y])return this.localGlyphs[N.fontWeight][y];const q=String.fromCharCode(y),{data:St,width:Ht,height:Ui,glyphWidth:Bn,glyphHeight:ls,glyphLeft:il,glyphTop:$u,glyphAdvance:Ku}=N.draw(q);return this.localGlyphs[N.fontWeight][y]={id:y,bitmap:new hv({width:Ht,height:Ui},St),metrics:{width:Bn/$v,height:ls/$v,left:il/$v,top:$u/$v-27,advance:Ku/$v,localGlyph:!0}}}}ib.loadGlyphRange=function(c,l,d,y,M){const N=256*l,q=N+255,St=y.transformRequest(y.normalizeGlyphsURL(d).replace("{fontstack}",c).replace("{range}",`${N}-${q}`),Tp.Glyphs);Wd(St,(Ht,Ui)=>{if(Ht)M(Ht);else if(Ui){const Bn={},ls=function(il){return new Ow(il).readFields(wS,{})}(Ui);for(const il of ls.glyphs)Bn[il.id]=il;M(null,{glyphs:Bn,ascender:ls.ascender,descender:ls.descender})}})},ib.TinySDF=class{constructor({fontSize:c=24,buffer:l=3,radius:d=8,cutoff:y=.25,fontFamily:M="sans-serif",fontWeight:N="normal",fontStyle:q="normal"}={}){this.buffer=l,this.cutoff=y,this.radius=d;const St=this.size=c+4*l,Ht=this._createCanvas(St),Ui=this.ctx=Ht.getContext("2d",{willReadFrequently:!0});Ui.font=`${q} ${N} ${c}px ${M}`,Ui.textBaseline="alphabetic",Ui.textAlign="left",Ui.fillStyle="black",this.gridOuter=new Float64Array(St*St),this.gridInner=new Float64Array(St*St),this.f=new Float64Array(St),this.z=new Float64Array(St+1),this.v=new Uint16Array(St)}_createCanvas(c){const l=document.createElement("canvas");return l.width=l.height=c,l}draw(c){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:M,actualBoundingBoxRight:N}=this.ctx.measureText(c),q=Math.ceil(d),St=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(N-M))),Ht=Math.min(this.size-this.buffer,q+Math.ceil(y)),Ui=St+2*this.buffer,Bn=Ht+2*this.buffer,ls=Math.max(Ui*Bn,0),il=new Uint8ClampedArray(ls),$u={data:il,width:Ui,height:Bn,glyphWidth:St,glyphHeight:Ht,glyphTop:q,glyphLeft:0,glyphAdvance:l};if(St===0||Ht===0)return $u;const{ctx:Ku,buffer:rh,gridInner:vh,gridOuter:Ph}=this;Ku.clearRect(rh,rh,St,Ht),Ku.fillText(c,rh,rh+q);const Xh=Ku.getImageData(rh,rh,St,Ht);Ph.fill(qb,0,ls),vh.fill(0,0,ls);for(let Dh=0;Dh<Ht;Dh++)for(let jh=0;jh<St;jh++){const ad=Xh.data[4*(Dh*St+jh)+3]/255;if(ad===0)continue;const nd=(Dh+rh)*Ui+jh+rh;if(ad===1)Ph[nd]=0,vh[nd]=qb;else{const Bd=.5-ad;Ph[nd]=Bd>0?Bd*Bd:0,vh[nd]=Bd<0?Bd*Bd:0}}gE(Ph,0,0,Ui,Bn,Ui,this.f,this.v,this.z),gE(vh,rh,rh,St,Ht,Ui,this.f,this.v,this.z);for(let Dh=0;Dh<ls;Dh++){const jh=Math.sqrt(Ph[Dh])-Math.sqrt(vh[Dh]);il[Dh]=Math.round(255-255*(jh/this.radius+this.cutoff))}return $u}};const rb=o0;function yE(c,l,d,y){const M=[],N=c.image,q=N.pixelRatio,St=N.paddedRect.w-2*rb,Ht=N.paddedRect.h-2*rb,Ui=c.right-c.left,Bn=c.bottom-c.top,ls=N.stretchX||[[0,St]],il=N.stretchY||[[0,Ht]],$u=(Xd,kf)=>Xd+kf[1]-kf[0],Ku=ls.reduce($u,0),rh=il.reduce($u,0),vh=St-Ku,Ph=Ht-rh;let Xh=0,Dh=Ku,jh=0,ad=rh,nd=0,Bd=vh,Rd=0,bf=Ph;if(N.content&&y){const Xd=N.content;Xh=Bw(ls,0,Xd[0]),jh=Bw(il,0,Xd[1]),Dh=Bw(ls,Xd[0],Xd[2]),ad=Bw(il,Xd[1],Xd[3]),nd=Xd[0]-Xh,Rd=Xd[1]-jh,Bd=Xd[2]-Xd[0]-Dh,bf=Xd[3]-Xd[1]-ad}const qf=(Xd,kf,Df,Ff)=>{const Yf=Nw(Xd.stretch-Xh,Dh,Ui,c.left),xf=zw(Xd.fixed-nd,Bd,Xd.stretch,Ku),dp=Nw(kf.stretch-jh,ad,Bn,c.top),Sp=zw(kf.fixed-Rd,bf,kf.stretch,rh),pp=Nw(Df.stretch-Xh,Dh,Ui,c.left),Qp=zw(Df.fixed-nd,Bd,Df.stretch,Ku),Qf=Nw(Ff.stretch-jh,ad,Bn,c.top),Up=zw(Ff.fixed-Rd,bf,Ff.stretch,rh),em=new Zu(Yf,dp),Em=new Zu(pp,dp),tm=new Zu(pp,Qf),Zp=new Zu(Yf,Qf),ag=new Zu(xf/q,Sp/q),rm=new Zu(Qp/q,Up/q),nm=l*Math.PI/180;if(nm){const ig=Math.sin(nm),Km=Math.cos(nm),yg=[Km,-ig,ig,Km];em._matMult(yg),Em._matMult(yg),Zp._matMult(yg),tm._matMult(yg)}const Xm=Xd.stretch+Xd.fixed,tg=kf.stretch+kf.fixed;return{tl:em,tr:Em,bl:Zp,br:tm,tex:{x:N.paddedRect.x+rb+Xm,y:N.paddedRect.y+rb+tg,w:Df.stretch+Df.fixed-Xm,h:Ff.stretch+Ff.fixed-tg},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ag,pixelOffsetBR:rm,minFontScaleX:Bd/q/Ui,minFontScaleY:bf/q/Bn,isSDF:d}};if(y&&(N.stretchX||N.stretchY)){const Xd=vE(ls,vh,Ku),kf=vE(il,Ph,rh);for(let Df=0;Df<Xd.length-1;Df++){const Ff=Xd[Df],Yf=Xd[Df+1];for(let xf=0;xf<kf.length-1;xf++)M.push(qf(Ff,kf[xf],Yf,kf[xf+1]))}}else M.push(qf({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:St+1},{fixed:0,stretch:Ht+1}));return M}function Bw(c,l,d){let y=0;for(const M of c)y+=Math.max(l,Math.min(d,M[1]))-Math.max(l,Math.min(d,M[0]));return y}function vE(c,l,d){const y=[{fixed:-rb,stretch:0}];for(const[M,N]of c){const q=y[y.length-1];y.push({fixed:M-q.stretch,stretch:q.stretch}),y.push({fixed:M-q.stretch,stretch:q.stretch+(N-M)})}return y.push({fixed:l+rb,stretch:d}),y}function Nw(c,l,d,y){return c/l*d+y}function zw(c,l,d,y){return c-l*d/y}function PS(c,l,d,y){const M=l+c.positionedLines[y].lineOffset;return y===0?d+M/2:d+(M+(l+c.positionedLines[y-1].lineOffset))/2}class kS{constructor(l=[],d=DS){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let y=(this.length>>1)-1;y>=0;y--)this._down(y)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:d,compare:y}=this,M=d[l];for(;l>0;){const N=l-1>>1,q=d[N];if(y(M,q)>=0)break;d[l]=q,l=N}d[l]=M}_down(l){const{data:d,compare:y}=this,M=this.length>>1,N=d[l];for(;l<M;){let q=1+(l<<1),St=d[q];const Ht=q+1;if(Ht<this.length&&y(d[Ht],St)<0&&(q=Ht,St=d[Ht]),y(St,N)>=0)break;d[l]=St,l=q}d[l]=N}}function DS(c,l){return c<l?-1:c>l?1:0}function LS(c,l=1,d=!1){let y=1/0,M=1/0,N=-1/0,q=-1/0;const St=c[0];for(let $u=0;$u<St.length;$u++){const Ku=St[$u];(!$u||Ku.x<y)&&(y=Ku.x),(!$u||Ku.y<M)&&(M=Ku.y),(!$u||Ku.x>N)&&(N=Ku.x),(!$u||Ku.y>q)&&(q=Ku.y)}const Ht=Math.min(N-y,q-M);let Ui=Ht/2;const Bn=new kS([],RS);if(Ht===0)return new Zu(y,M);for(let $u=y;$u<N;$u+=Ht)for(let Ku=M;Ku<q;Ku+=Ht)Bn.push(new nb($u+Ui,Ku+Ui,Ui,c));let ls=function($u){let Ku=0,rh=0,vh=0;const Ph=$u[0];for(let Xh=0,Dh=Ph.length,jh=Dh-1;Xh<Dh;jh=Xh++){const ad=Ph[Xh],nd=Ph[jh],Bd=ad.x*nd.y-nd.x*ad.y;rh+=(ad.x+nd.x)*Bd,vh+=(ad.y+nd.y)*Bd,Ku+=3*Bd}return new nb(rh/Ku,vh/Ku,0,$u)}(c),il=Bn.length;for(;Bn.length;){const $u=Bn.pop();($u.d>ls.d||!ls.d)&&(ls=$u,d&&console.log("found best %d after %d probes",Math.round(1e4*$u.d)/1e4,il)),$u.max-ls.d<=l||(Ui=$u.h/2,Bn.push(new nb($u.p.x-Ui,$u.p.y-Ui,Ui,c)),Bn.push(new nb($u.p.x+Ui,$u.p.y-Ui,Ui,c)),Bn.push(new nb($u.p.x-Ui,$u.p.y+Ui,Ui,c)),Bn.push(new nb($u.p.x+Ui,$u.p.y+Ui,Ui,c)),il+=4)}return d&&(console.log(`num probes: ${il}`),console.log(`best distance: ${ls.d}`)),ls.p}function RS(c,l){return l.max-c.max}class nb{constructor(l,d,y,M){this.p=new Zu(l,d),this.h=y,this.d=function(N,q){let St=!1,Ht=1/0;for(let Ui=0;Ui<q.length;Ui++){const Bn=q[Ui];for(let ls=0,il=Bn.length,$u=il-1;ls<il;$u=ls++){const Ku=Bn[ls],rh=Bn[$u];Ku.y>N.y!=rh.y>N.y&&N.x<(rh.x-Ku.x)*(N.y-Ku.y)/(rh.y-Ku.y)+Ku.x&&(St=!St),Ht=Math.min(Ht,Vx(N,Ku,rh))}}return(St?1:-1)*Math.sqrt(Ht)}(this.p,M),this.max=this.d+this.h*Math.SQRT2}}const ob=7,I2=Number.POSITIVE_INFINITY,$S=Math.sqrt(2);function xE(c,[l,d]){let y=0,M=0;if(d===I2){l<0&&(l=0);const N=l/$S;switch(c){case"top-right":case"top-left":M=N-ob;break;case"bottom-right":case"bottom-left":M=-N+ob;break;case"bottom":M=-l+ob;break;case"top":M=l-ob}switch(c){case"top-right":case"bottom-right":y=-N;break;case"top-left":case"bottom-left":y=N;break;case"left":y=l;break;case"right":y=-l}}else{switch(l=Math.abs(l),d=Math.abs(d),c){case"top-right":case"top-left":case"top":M=d-ob;break;case"bottom-right":case"bottom-left":case"bottom":M=-d+ob}switch(c){case"top-right":case"bottom-right":case"right":y=-l;break;case"top-left":case"bottom-left":case"left":y=l}}return[y,M]}function BS(c,l,d,y,M,N,q,St,Ht,Ui){c.createArrays(),c.tilePixelRatio=Rp/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const Bn=c.layers[0].layout,ls=c.layers[0]._unevaluatedLayout._values,il={};if(c.textSizeData.kind==="composite"){const{minZoom:rh,maxZoom:vh}=c.textSizeData;il.compositeTextSizes=[ls["text-size"].possiblyEvaluate(new Gn(rh),St),ls["text-size"].possiblyEvaluate(new Gn(vh),St)]}if(c.iconSizeData.kind==="composite"){const{minZoom:rh,maxZoom:vh}=c.iconSizeData;il.compositeIconSizes=[ls["icon-size"].possiblyEvaluate(new Gn(rh),St),ls["icon-size"].possiblyEvaluate(new Gn(vh),St)]}il.layoutTextSize=ls["text-size"].possiblyEvaluate(new Gn(Ht+1),St),il.layoutIconSize=ls["icon-size"].possiblyEvaluate(new Gn(Ht+1),St),il.textMaxSize=ls["text-size"].possiblyEvaluate(new Gn(18),St);const $u=Bn.get("text-rotation-alignment")==="map"&&Bn.get("symbol-placement")!=="point",Ku=Bn.get("text-size");for(const rh of c.features){const vh=Bn.get("text-font").evaluate(rh,{},St).join(","),Ph=Ku.evaluate(rh,{},St),Xh=il.layoutTextSize.evaluate(rh,{},St),Dh=(il.layoutIconSize.evaluate(rh,{},St),{horizontal:{},vertical:void 0}),jh=rh.text;let ad,nd=[0,0];if(jh){const bf=jh.toString(),qf=Bn.get("text-letter-spacing").evaluate(rh,{},St)*Qm,Xd=Bn.get("text-line-height").evaluate(rh,{},St)*Qm,kf=eh(bf)?qf:0,Df=Bn.get("text-anchor").evaluate(rh,{},St),Ff=Bn.get("text-variable-anchor");if(!Ff){const pp=Bn.get("text-radial-offset").evaluate(rh,{},St);nd=pp?xE(Df,[pp*Qm,I2]):Bn.get("text-offset").evaluate(rh,{},St).map(Qp=>Qp*Qm)}let Yf=$u?"center":Bn.get("text-justify").evaluate(rh,{},St);const xf=Bn.get("symbol-placement")==="point",dp=xf?Bn.get("text-max-width").evaluate(rh,{},St)*Qm:1/0,Sp=pp=>{c.allowVerticalPlacement&&th(bf)&&(Dh.vertical=E2(jh,l,d,M,vh,dp,Xd,Df,pp,kf,nd,G0.vertical,!0,Xh,Ph))};if(!$u&&Ff){const pp=Yf==="auto"?Ff.map(Qf=>C2(Qf)):[Yf];let Qp=!1;for(let Qf=0;Qf<pp.length;Qf++){const Up=pp[Qf];if(!Dh.horizontal[Up])if(Qp)Dh.horizontal[Up]=Dh.horizontal[0];else{const em=E2(jh,l,d,M,vh,dp,Xd,"center",Up,kf,nd,G0.horizontal,!1,Xh,Ph);em&&(Dh.horizontal[Up]=em,Qp=em.positionedLines.length===1)}}Sp("left")}else{if(Yf==="auto"&&(Yf=C2(Df)),xf||Bn.get("text-writing-mode").indexOf("horizontal")>=0||!th(bf)){const pp=E2(jh,l,d,M,vh,dp,Xd,Df,Yf,kf,nd,G0.horizontal,!1,Xh,Ph);pp&&(Dh.horizontal[Yf]=pp)}Sp(xf?"left":Yf)}}let Bd=!1;if(rh.icon&&rh.icon.name){const bf=y[rh.icon.name];bf&&(ad=CS(M[rh.icon.name],Bn.get("icon-offset").evaluate(rh,{},St),Bn.get("icon-anchor").evaluate(rh,{},St)),Bd=bf.sdf,c.sdfIcons===void 0?c.sdfIcons=bf.sdf:c.sdfIcons!==bf.sdf&&Vd("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(bf.pixelRatio!==c.pixelRatio||Bn.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const Rd=wE(Dh.horizontal)||Dh.vertical;c.iconsInText||(c.iconsInText=!!Rd&&Rd.iconsInText),(Rd||ad)&&NS(c,rh,Dh,ad,y,il,Xh,0,nd,Bd,q,St,Ui)}N&&c.generateCollisionDebugBuffers(Ht,c.collisionBoxArray)}function C2(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function NS(c,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il){let $u=N.textMaxSize.evaluate(l,{},ls);$u===void 0&&($u=q);const Ku=c.layers[0].layout,rh=Ku.get("icon-offset").evaluate(l,{},ls),vh=wE(d.horizontal)||d.vertical,Ph=il.name==="globe",Xh=Qm,Dh=q/Xh,jh=c.tilePixelRatio*$u/Xh,ad=(Df=c.overscaling,c.zoom>18&&Df>2&&(Df>>=1),Math.max(Rp/(512*Df),1)*Ku.get("symbol-spacing")),nd=Ku.get("text-padding")*c.tilePixelRatio,Bd=Ku.get("icon-padding")*c.tilePixelRatio,Rd=hh(Ku.get("text-max-angle")),bf=Ku.get("text-rotation-alignment")==="map"&&Ku.get("symbol-placement")!=="point",qf=Ku.get("icon-rotation-alignment")==="map"&&Ku.get("symbol-placement")!=="point",Xd=Ku.get("symbol-placement"),kf=ad/2;var Df;const Ff=Ku.get("icon-text-fit");let Yf;y&&Ff!=="none"&&(c.allowVerticalPlacement&&d.vertical&&(Yf=cE(y,d.vertical,Ff,Ku.get("icon-text-fit-padding"),rh,Dh)),vh&&(y=cE(y,vh,Ff,Ku.get("icon-text-fit-padding"),rh,Dh)));const xf=(dp,Sp,pp)=>{if(Sp.x<0||Sp.x>=Rp||Sp.y<0||Sp.y>=Rp)return;let Qp=null;if(Ph){const{x:Qf,y:Up,z:em}=il.projectTilePoint(Sp.x,Sp.y,pp);Qp={anchor:new S1(Qf,Up,em,0,void 0),up:il.upVector(pp,Sp.x,Sp.y)}}(function(Qf,Up,em,Em,tm,Zp,ag,rm,nm,Xm,tg,ig,Km,yg,Lg,Xg,Wm,o_,Kg,Cg,Cm,Wg,rg,zy,Yg){const V_=Qf.addToLineVertexArray(Up,Em);let M_,Fy,A_,Nv,lb,ew,tw,tS=0,iS=0,rS=0,nS=0,V2=-1,G2=-1;const r1={};let oS=qv("");const Ix=em?em.anchor:Up;let j2=0,q2=0;if(nm._unevaluatedLayout.getValue("text-radial-offset")===void 0?[j2,q2]=nm.layout.get("text-offset").evaluate(Cm,{},Yg).map(w0=>w0*Qm):(j2=nm.layout.get("text-radial-offset").evaluate(Cm,{},Yg)*Qm,q2=I2),Qf.allowVerticalPlacement&&tm.vertical){const w0=tm.vertical;if(Lg)ew=M2(w0),rm&&(tw=M2(rm));else{const E0=nm.layout.get("text-rotate").evaluate(Cm,{},Yg)+90;A_=Fw(Xm,Ix,Up,tg,ig,Km,w0,yg,E0,Xg),rm&&(Nv=Fw(Xm,Ix,Up,tg,ig,Km,rm,o_,E0))}}if(Zp){const w0=nm.layout.get("icon-rotate").evaluate(Cm,{},Yg),E0=nm.layout.get("icon-text-fit")!=="none",iw=yE(Zp,w0,rg,E0),H2=rm?yE(rm,w0,rg,E0):void 0;Fy=Fw(Xm,Ix,Up,tg,ig,Km,Zp,o_,w0),tS=4*iw.length;const aS=Qf.iconSizeData;let Cx=null;aS.kind==="source"?(Cx=[Ny*nm.layout.get("icon-size").evaluate(Cm,{},Yg)],Cx[0]>Z1&&Vd(`${Qf.layerIds[0]}: Value for "icon-size" is >= ${Zb}. Reduce your "icon-size".`)):aS.kind==="composite"&&(Cx=[Ny*Wg.compositeIconSizes[0].evaluate(Cm,{},Yg),Ny*Wg.compositeIconSizes[1].evaluate(Cm,{},Yg)],(Cx[0]>Z1||Cx[1]>Z1)&&Vd(`${Qf.layerIds[0]}: Value for "icon-size" is >= ${Zb}. Reduce your "icon-size".`)),Qf.addSymbols(Qf.icon,iw,Cx,Cg,Kg,Cm,!1,em,Up,V_.lineStartIndex,V_.lineLength,-1,zy,Yg),V2=Qf.icon.placedSymbolArray.length-1,H2&&(iS=4*H2.length,Qf.addSymbols(Qf.icon,H2,Cx,Cg,Kg,Cm,G0.vertical,em,Up,V_.lineStartIndex,V_.lineLength,-1,zy,Yg),G2=Qf.icon.placedSymbolArray.length-1)}for(const w0 in tm.horizontal){const E0=tm.horizontal[w0];M_||(oS=qv(E0.text),Lg?lb=M2(E0):M_=Fw(Xm,Ix,Up,tg,ig,Km,E0,yg,nm.layout.get("text-rotate").evaluate(Cm,{},Yg),Xg));const iw=E0.positionedLines.length===1;if(rS+=bE(Qf,em,Up,E0,ag,nm,Lg,Cm,Xg,V_,tm.vertical?G0.horizontal:G0.horizontalOnly,iw?Object.keys(tm.horizontal):[w0],r1,V2,Wg,zy,Yg),iw)break}tm.vertical&&(nS+=bE(Qf,em,Up,tm.vertical,ag,nm,Lg,Cm,Xg,V_,G0.vertical,["vertical"],r1,G2,Wg,zy,Yg));let J1=-1;const Z2=(w0,E0)=>w0?Math.max(w0,E0):E0;J1=Z2(lb,J1),J1=Z2(ew,J1),J1=Z2(tw,J1);const dT=J1>-1?1:0;Qf.glyphOffsetArray.length>=X1.MAX_GLYPHS&&Vd("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Cm.sortKey!==void 0&&Qf.addToSortKeyRanges(Qf.symbolInstances.length,Cm.sortKey),Qf.symbolInstances.emplaceBack(Ix.x,Ix.y,Ix.z,Up.x,Up.y,r1.right>=0?r1.right:-1,r1.center>=0?r1.center:-1,r1.left>=0?r1.left:-1,r1.vertical>=0?r1.vertical:-1,V2,G2,oS,M_!==void 0?M_:Qf.collisionBoxArray.length,M_!==void 0?M_+1:Qf.collisionBoxArray.length,A_!==void 0?A_:Qf.collisionBoxArray.length,A_!==void 0?A_+1:Qf.collisionBoxArray.length,Fy!==void 0?Fy:Qf.collisionBoxArray.length,Fy!==void 0?Fy+1:Qf.collisionBoxArray.length,Nv||Qf.collisionBoxArray.length,Nv?Nv+1:Qf.collisionBoxArray.length,tg,rS,nS,tS,iS,dT,0,j2,q2,J1)})(c,Sp,Qp,dp,d,y,M,Yf,c.layers[0],c.collisionBoxArray,l.index,l.sourceLayerIndex,c.index,nd,bf,Ht,0,Bd,qf,rh,l,N,Ui,Bn,ls)};if(Xd==="line")for(const dp of mE(l.geometry,0,0,Rp,Rp)){const Sp=AS(dp,ad,Rd,d.vertical||vh,y,Xh,jh,c.overscaling,Rp);for(const pp of Sp)vh&&zS(c,vh.text,kf,pp)||xf(dp,pp,ls)}else if(Xd==="line-center"){for(const dp of l.geometry)if(dp.length>1){const Sp=MS(dp,Rd,d.vertical||vh,y,Xh,jh);Sp&&xf(dp,Sp,ls)}}else if(l.type==="Polygon")for(const dp of mh(l.geometry,0)){const Sp=LS(dp,16);xf(dp[0],new S1(Sp.x,Sp.y,0,0,void 0),ls)}else if(l.type==="LineString")for(const dp of l.geometry)xf(dp,new S1(dp[0].x,dp[0].y,0,0,void 0),ls);else if(l.type==="Point")for(const dp of l.geometry)for(const Sp of dp)xf([Sp],new S1(Sp.x,Sp.y,0,0,void 0),ls)}const Zb=255,Z1=Zb*Ny;function bE(c,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku,rh,vh){const Ph=function(jh,ad,nd,Bd,Rd,bf,qf,Xd){const kf=[];if(ad.positionedLines.length===0)return kf;const Df=Bd.layout.get("text-rotate").evaluate(bf,{})*Math.PI/180,Ff=function(pp){const Qp=pp[0],Qf=pp[1],Up=Qp*Qf;return Up>0?[Qp,-Qf]:Up<0?[-Qp,Qf]:Qp===0?[Qf,Qp]:[Qf,-Qp]}(nd);let Yf=Math.abs(ad.top-ad.bottom);for(const pp of ad.positionedLines)Yf-=pp.lineOffset;const xf=ad.positionedLines.length,dp=Yf/xf;let Sp=ad.top-nd[1];for(let pp=0;pp<xf;++pp){const Qp=ad.positionedLines[pp];Sp=PS(ad,dp,Sp,pp);for(const Qf of Qp.positionedGlyphs){if(!Qf.rect)continue;const Up=Qf.rect||{};let em=tE+1,Em=!0,tm=1,Zp=0;if(Qf.imageName){const rg=qf[Qf.imageName];if(!rg)continue;if(rg.sdf){Vd("SDF images are not supported in formatted text and will be ignored.");continue}Em=!1,tm=rg.pixelRatio,em=o0/tm}const ag=(Rd||Xd)&&Qf.vertical,rm=Qf.metrics.advance*Qf.scale/2,nm=Qf.metrics,Xm=Qf.rect;if(Xm===null)continue;Xd&&ad.verticalizable&&(Zp=Qf.imageName?rm-Qf.metrics.width*Qf.scale/2:0);const tg=Rd?[Qf.x+rm,Qf.y]:[0,0];let ig=[0,0],Km=[0,0],yg=!1;Rd||(ag?(Km=[Qf.x+rm+Ff[0],Qf.y+Ff[1]-Zp],yg=!0):ig=[Qf.x+rm+nd[0],Qf.y+nd[1]-Zp]);const Lg=Xm.w*Qf.scale/(tm*(Qf.localGlyph?$v:1)),Xg=Xm.h*Qf.scale/(tm*(Qf.localGlyph?$v:1));let Wm,o_,Kg,Cg;if(ag){const rg=Qf.y-Sp,zy=new Zu(-rm,rm-rg),Yg=-Math.PI/2,V_=new Zu(...Km);Wm=new Zu(-rm+ig[0],ig[1]),Wm._rotateAround(Yg,zy)._add(V_),Wm.x+=-rg+rm,Wm.y-=(nm.left-em)*Qf.scale;const M_=Qf.imageName?nm.advance*Qf.scale:Qm*Qf.scale,Fy=String.fromCharCode(Qf.glyph);w1(Fy)?Wm.x+=(1-em)*Qf.scale:dS(Fy)?Wm.x+=M_-nm.height*Qf.scale+(-em-1)*Qf.scale:Wm.x+=Qf.imageName||nm.width+2*em===Xm.w&&nm.height+2*em===Xm.h?(M_-Xg)/2:(M_-(nm.height+2*em)*Qf.scale)/2,o_=new Zu(Wm.x,Wm.y-Lg),Kg=new Zu(Wm.x+Xg,Wm.y),Cg=new Zu(Wm.x+Xg,Wm.y-Lg)}else{const rg=(nm.left-em)*Qf.scale-rm+ig[0],zy=(-nm.top-em)*Qf.scale+ig[1],Yg=rg+Lg,V_=zy+Xg;Wm=new Zu(rg,zy),o_=new Zu(Yg,zy),Kg=new Zu(rg,V_),Cg=new Zu(Yg,V_)}if(Df){let rg;rg=Rd?new Zu(0,0):yg?new Zu(Ff[0],Ff[1]):new Zu(nd[0],nd[1]),Wm._rotateAround(Df,rg),o_._rotateAround(Df,rg),Kg._rotateAround(Df,rg),Cg._rotateAround(Df,rg)}const Cm=new Zu(0,0),Wg=new Zu(0,0);kf.push({tl:Wm,tr:o_,bl:Kg,br:Cg,tex:Up,writingMode:ad.writingMode,glyphOffset:tg,sectionIndex:Qf.sectionIndex,isSDF:Em,pixelOffsetTL:Cm,pixelOffsetBR:Wg,minFontScaleX:0,minFontScaleY:0})}}return kf}(0,y,Ht,N,q,St,M,c.allowVerticalPlacement),Xh=c.textSizeData;let Dh=null;Xh.kind==="source"?(Dh=[Ny*N.layout.get("text-size").evaluate(St,{},vh)],Dh[0]>Z1&&Vd(`${c.layerIds[0]}: Value for "text-size" is >= ${Zb}. Reduce your "text-size".`)):Xh.kind==="composite"&&(Dh=[Ny*Ku.compositeTextSizes[0].evaluate(St,{},vh),Ny*Ku.compositeTextSizes[1].evaluate(St,{},vh)],(Dh[0]>Z1||Dh[1]>Z1)&&Vd(`${c.layerIds[0]}: Value for "text-size" is >= ${Zb}. Reduce your "text-size".`)),c.addSymbols(c.text,Ph,Dh,Ht,q,St,Bn,l,d,Ui.lineStartIndex,Ui.lineLength,$u,rh,vh);for(const jh of ls)il[jh]=c.text.placedSymbolArray.length-1;return 4*Ph.length}function wE(c){for(const l in c)return c[l];return null}function Fw(c,l,d,y,M,N,q,St,Ht,Ui){let Bn=q.top,ls=q.bottom,il=q.left,$u=q.right;const Ku=q.collisionPadding;if(Ku&&(il-=Ku[0],Bn-=Ku[1],$u+=Ku[2],ls+=Ku[3]),Ht){const rh=new Zu(il,Bn),vh=new Zu($u,Bn),Ph=new Zu(il,ls),Xh=new Zu($u,ls),Dh=hh(Ht);let jh=new Zu(0,0);Ui&&(jh=new Zu(Ui[0],Ui[1])),rh._rotateAround(Dh,jh),vh._rotateAround(Dh,jh),Ph._rotateAround(Dh,jh),Xh._rotateAround(Dh,jh),il=Math.min(rh.x,vh.x,Ph.x,Xh.x),$u=Math.max(rh.x,vh.x,Ph.x,Xh.x),Bn=Math.min(rh.y,vh.y,Ph.y,Xh.y),ls=Math.max(rh.y,vh.y,Ph.y,Xh.y)}return c.emplaceBack(l.x,l.y,l.z,d.x,d.y,il,Bn,$u,ls,St,y,M,N),c.length-1}function M2(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const l=c.bottom-c.top;return l>0?Math.max(10,l):null}function zS(c,l,d,y){const M=c.compareText;if(l in M){const N=M[l];for(let q=N.length-1;q>=0;q--)if(y.dist(N[q])<d)return!0}else M[l]=[];return M[l].push(y),!1}function EE(c,l){const d=c.fovAboveCenter,y=c.elevation?c.elevation.getMinElevationBelowMSL()*l:0,M=(c._camera.position[2]*c.worldSize-y)/Math.cos(c._pitch),N=Math.sin(d)*M/Math.sin(Math.max(Math.PI/2-c._pitch-d,.01)),q=Math.sin(c._pitch)*N+M;return Math.min(1.01*q,M*(1/c._horizonShift))}function Sx(c,l){if(!l.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:l};const d=Math.pow(2,-c.z),y=c.x*d,M=(c.x+1)*d,N=c.y*d,q=(c.y+1)*d,St=Ry(y),Ht=Ry(M),Ui=Zg(N),Bn=Zg(q),ls=l.project(St,Ui),il=l.project(Ht,Ui),$u=l.project(Ht,Bn),Ku=l.project(St,Bn);let rh=Math.min(ls.x,il.x,$u.x,Ku.x),vh=Math.min(ls.y,il.y,$u.y,Ku.y),Ph=Math.max(ls.x,il.x,$u.x,Ku.x),Xh=Math.max(ls.y,il.y,$u.y,Ku.y);const Dh=d/16;function jh(nd,Bd,Rd,bf,qf,Xd){const kf=(Rd+qf)/2,Df=(bf+Xd)/2,Ff=l.project(Ry(kf),Zg(Df)),Yf=Math.max(0,rh-Ff.x,vh-Ff.y,Ff.x-Ph,Ff.y-Xh);rh=Math.min(rh,Ff.x),Ph=Math.max(Ph,Ff.x),vh=Math.min(vh,Ff.y),Xh=Math.max(Xh,Ff.y),Yf>Dh&&(jh(nd,Ff,Rd,bf,kf,Df),jh(Ff,Bd,kf,Df,qf,Xd))}jh(ls,il,y,N,M,N),jh(il,$u,M,N,M,q),jh($u,Ku,M,q,y,q),jh(Ku,ls,y,q,y,N),rh-=Dh,vh-=Dh,Ph+=Dh,Xh+=Dh;const ad=1/Math.max(Ph-rh,Xh-vh);return{scale:ad,x:rh*ad,y:vh*ad,x2:Ph*ad,y2:Xh*ad,projection:l}}const FS=z0(new Float32Array(16));class H1{constructor(l){this.spec=l,this.name=l.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(l,d){return{x:0,y:0,z:0}}unproject(l,d){return new Bm(0,0)}projectTilePoint(l,d,y){return{x:l,y:d,z:0}}locationPoint(l,d,y=!0){return l._coordinatePoint(l.locationCoordinate(d),y)}pixelsPerMeter(l,d){return b0(1,l)*d}pixelSpaceConversion(l,d,y){return 1}farthestPixelDistance(l){return EE(l,l.pixelsPerMeter)}pointCoordinate(l,d,y,M){const N=l.horizonLineFromTop(!1),q=new Zu(d,Math.max(N,y));return l.rayIntersectionCoordinate(l.pointRayIntersection(q,M))}pointCoordinate3D(l,d,y){const M=new Zu(d,y);if(l.elevation)return l.elevation.pointCoordinate(M);{const N=this.pointCoordinate(l,M.x,M.y,0);return[N.x,N.y,N.z]}}isPointAboveHorizon(l,d){if(l.elevation)return!this.pointCoordinate3D(l,d.x,d.y);const y=l.horizonLineFromTop();return d.y<y}createInversionMatrix(l,d){return FS}createTileMatrix(l,d,y){let M,N,q;const St=y.canonical,Ht=z0(new Float64Array(16));if(this.isReprojectedInTileSpace){const Ui=Sx(St,this);M=1,N=Ui.x+y.wrap*Ui.scale,q=Ui.y,Cv(Ht,Ht,[M/Ui.scale,M/Ui.scale,l.pixelsPerMeter/d])}else M=d/l.zoomScale(St.z),N=(St.x+Math.pow(2,St.z)*y.wrap)*M,q=St.y*M;return ax(Ht,Ht,[N,q,0]),Cv(Ht,Ht,[M/Rp,M/Rp,1]),Ht}upVector(l,d,y){return[0,0,1]}upVectorScale(l,d,y){return{metersToTile:1}}}class US extends H1{constructor(l){super(l),this.range=[4,7],this.center=l.center||[-96,37.5];const[d,y]=this.parallels=l.parallels||[29.5,45.5],M=Math.sin(hh(d));this.n=(M+Math.sin(hh(y)))/2,this.c=1+M*(2*this.n-M),this.r0=Math.sqrt(this.c)/this.n}project(l,d){const{n:y,c:M,r0:N}=this,q=hh(l-this.center[0]),St=hh(d),Ht=Math.sqrt(M-2*y*Math.sin(St))/y;return{x:Ht*Math.sin(q*y),y:Ht*Math.cos(q*y)-N,z:0}}unproject(l,d){const{n:y,c:M,r0:N}=this,q=N+d;let St=Math.atan2(l,Math.abs(q))*Math.sign(q);q*y<0&&(St-=Math.PI*Math.sign(l)*Math.sign(q));const Ht=hh(this.center[0])*y;St=Sd(St,-Math.PI-Ht,Math.PI-Ht);const Ui=Cd(Sh(St/y)+this.center[0],-180,180),Bn=Math.asin(Cd((M-(l*l+q*q)*y*y)/(2*y),-1,1)),ls=Cd(Sh(Bn),-Hg,Hg);return new Bm(Ui,ls)}}const Hb=1.340264,Xb=-.081106,Kb=893e-6,Wb=.003796,Uw=Math.sqrt(3)/2;class VS extends H1{project(l,d){d=d/180*Math.PI,l=l/180*Math.PI;const y=Math.asin(Uw*Math.sin(d)),M=y*y,N=M*M*M;return{x:.5*(l*Math.cos(y)/(Uw*(Hb+3*Xb*M+N*(7*Kb+9*Wb*M)))/Math.PI+.5),y:1-.5*(y*(Hb+Xb*M+N*(Kb+Wb*M))/Math.PI+1),z:0}}unproject(l,d){l=(2*l-.5)*Math.PI;let y=d=(2*(1-d)-1)*Math.PI,M=y*y,N=M*M*M;for(let Bn,ls,il,$u=0;$u<12&&(ls=y*(Hb+Xb*M+N*(Kb+Wb*M))-d,il=Hb+3*Xb*M+N*(7*Kb+9*Wb*M),Bn=ls/il,y=Cd(y-Bn,-Math.PI/3,Math.PI/3),M=y*y,N=M*M*M,!(Math.abs(Bn)<1e-12));++$u);const q=Uw*l*(Hb+3*Xb*M+N*(7*Kb+9*Wb*M))/Math.cos(y),St=Math.asin(Math.sin(y)/Uw),Ht=Cd(180*q/Math.PI,-180,180),Ui=Cd(180*St/Math.PI,-Hg,Hg);return new Bm(Ht,Ui)}}class GS extends H1{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0}project(l,d){return{x:.5+l/360,y:.5-d/360,z:0}}unproject(l,d){const y=360*(l-.5),M=Cd(360*(.5-d),-Hg,Hg);return new Bm(y,M)}}const ab=Math.PI/2;function Vw(c){return Math.tan((ab+c)/2)}class jS extends H1{constructor(l){super(l),this.center=l.center||[0,30];const[d,y]=this.parallels=l.parallels||[30,30];let M=hh(d),N=hh(y);this.southernCenter=M+N<0,this.southernCenter&&(M=-M,N=-N);const q=Math.cos(M),St=Vw(M);this.n=M===N?Math.sin(M):Math.log(q/Math.cos(N))/Math.log(Vw(N)/St),this.f=q*Math.pow(Vw(M),this.n)/this.n}project(l,d){d=hh(d),this.southernCenter&&(d=-d),l=hh(l-this.center[0]);const y=1e-6,{n:M,f:N}=this;N>0?d<-ab+y&&(d=-ab+y):d>ab-y&&(d=ab-y);const q=N/Math.pow(Vw(d),M);let St=q*Math.sin(M*l),Ht=N-q*Math.cos(M*l);return St=.5*(St/Math.PI+.5),Ht=.5*(Ht/Math.PI+.5),{x:St,y:this.southernCenter?Ht:1-Ht,z:0}}unproject(l,d){l=(2*l-.5)*Math.PI,this.southernCenter&&(d=1-d),d=(2*(1-d)-.5)*Math.PI;const{n:y,f:M}=this,N=M-d,q=Math.sign(N),St=Math.sign(y)*Math.sqrt(l*l+N*N);let Ht=Math.atan2(l,Math.abs(N))*q;N*y<0&&(Ht-=Math.PI*Math.sign(l)*q);const Ui=Cd(Sh(Ht/y)+this.center[0],-180,180),Bn=Cd(Sh(2*Math.atan(Math.pow(M/St,1/y))-ab),-Hg,Hg);return new Bm(Ui,this.southernCenter?-Bn:Bn)}}class SE extends H1{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(l,d){return{x:uv(l),y:F0(d),z:0}}unproject(l,d){const y=Ry(l),M=Zg(d);return new Bm(y,M)}}const TE=hh(Hg);class qS extends H1{project(l,d){const y=(d=hh(d))*d,M=y*y;return{x:.5*((l=hh(l))*(.8707-.131979*y+M*(M*(.003971*y-.001529*M)-.013791))/Math.PI+.5),y:1-.5*(d*(1.007226+y*(.015085+M*(.028874*y-.044475-.005916*M)))/Math.PI+1),z:0}}unproject(l,d){l=(2*l-.5)*Math.PI;let y=d=(2*(1-d)-1)*Math.PI,M=25,N=0,q=y*y;do{q=y*y;const Ui=q*q;N=(y*(1.007226+q*(.015085+Ui*(.028874*q-.044475-.005916*Ui)))-d)/(1.007226+q*(.045255+Ui*(.259866*q-.311325-.005916*11*Ui))),y=Cd(y-N,-TE,TE)}while(Math.abs(N)>1e-6&&--M>0);q=y*y;const St=Cd(Sh(l/(.8707+q*(q*(q*q*q*(.003971-.001529*q)-.013791)-.131979))),-180,180),Ht=Sh(y);return new Bm(St,Ht)}}const IE=hh(Hg);class ZS extends H1{project(l,d){d=hh(d),l=hh(l);const y=Math.cos(d),M=2/Math.PI,N=Math.acos(y*Math.cos(l/2)),q=Math.sin(N)/N,St=.5*(l*M+2*y*Math.sin(l/2)/q)||0,Ht=.5*(d+Math.sin(d)/q)||0;return{x:.5*(St/Math.PI+.5),y:1-.5*(Ht/Math.PI+1),z:0}}unproject(l,d){let y=l=(2*l-.5)*Math.PI,M=d=(2*(1-d)-1)*Math.PI,N=25;const q=1e-6;let St=0,Ht=0;do{const Ui=Math.cos(M),Bn=Math.sin(M),ls=2*Bn*Ui,il=Bn*Bn,$u=Ui*Ui,Ku=Math.cos(y/2),rh=Math.sin(y/2),vh=2*Ku*rh,Ph=rh*rh,Xh=1-$u*Ku*Ku,Dh=Xh?1/Xh:0,jh=Xh?Math.acos(Ui*Ku)*Math.sqrt(1/Xh):0,ad=.5*(2*jh*Ui*rh+2*y/Math.PI)-l,nd=.5*(jh*Bn+M)-d,Bd=.5*Dh*($u*Ph+jh*Ui*Ku*il)+1/Math.PI,Rd=Dh*(vh*ls/4-jh*Bn*rh),bf=.125*Dh*(ls*rh-jh*Bn*$u*vh),qf=.5*Dh*(il*Ku+jh*Ph*Ui)+.5,Xd=Rd*bf-qf*Bd;St=(nd*Rd-ad*qf)/Xd,Ht=(ad*bf-nd*Bd)/Xd,y=Cd(y-St,-Math.PI,Math.PI),M=Cd(M-Ht,-IE,IE)}while((Math.abs(St)>q||Math.abs(Ht)>q)&&--N>0);return new Bm(Sh(y),Sh(M))}}class CE extends H1{constructor(l){super(l),this.center=l.center||[0,0],this.parallels=l.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(hh(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(l,d){const{scale:y,cosPhi:M}=this;return{x:hh(l)*M*y+.5,y:-Math.sin(hh(d))/M*y+.5,z:0}}unproject(l,d){const{scale:y,cosPhi:M}=this,N=-(d-.5)/y,q=Cd(Sh((l-.5)/y)/M,-180,180),St=Math.asin(Cd(N*M,-1,1)),Ht=Cd(Sh(St),-Hg,Hg);return new Bm(q,Ht)}}class HS extends SE{constructor(l){super(l),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(l,d,y){const M=B1(l,d,y);return Sg(M,M,N1(x0(y))),{x:M[0],y:M[1],z:M[2]}}locationPoint(l,d){const y=_1(d.lat,d.lng),M=z_([],y),N=l.elevation?l.elevation.getAtPointOrZero(l.locationCoordinate(d),l._centerAltitude):l._centerAltitude;cx(y,y,M,b0(1,0)*Rp*N);const q=z0(new Float64Array(16));return d1(q,l.pixelMatrix,l.globeMatrix),Sg(y,y,q),new Zu(y[0],y[1])}pixelsPerMeter(l,d){return b0(1,0)*d}pixelSpaceConversion(l,d,y){const M=b0(1,l)*d,N=im(b0(1,45)*d,M,y);return this.pixelsPerMeter(l,d)/N}createTileMatrix(l,d,y){const M=fx(x0(y.canonical));return d1(new Float64Array(16),l.globeMatrix,M)}createInversionMatrix(l,d){const{center:y}=l,M=N1(x0(d));return A1(M,M,hh(y.lng)),f1(M,M,hh(y.lat)),Cv(M,M,[l._pixelsPerMercatorPixel,l._pixelsPerMercatorPixel,1]),Float32Array.from(M)}pointCoordinate(l,d,y,M){return mw(l,d,y,!0)||new Dv(0,0)}pointCoordinate3D(l,d,y){const M=this.pointCoordinate(l,d,y,0);return[M.x,M.y,M.z]}isPointAboveHorizon(l,d){return!mw(l,d.x,d.y,!1)}farthestPixelDistance(l){const d=function(M,N){const q=M.cameraToCenterDistance,St=M._centerAltitude*N,Ht=M._camera,Ui=M._camera.forward(),Bn=Mv([],_y([],Ui,-q),[0,0,St]),ls=M.worldSize/(2*Math.PI),il=[0,0,-ls],$u=M.width/M.height,Ku=Math.tan(M.fovAboveCenter),rh=_y([],Ht.up(),Ku),vh=_y([],Ht.right(),Ku*$u),Ph=z_([],Mv([],Mv([],Ui,rh),vh)),Xh=[];let Dh;if(new Lx(Bn,Ph).closestPointOnSphere(il,ls,Xh)){const jh=Mv([],Xh,il),ad=v0([],jh,Bn);Dh=Math.cos(M.fovAboveCenter)*sx(ad)}else{const jh=v0([],Bn,il),ad=v0([],il,Bn);z_(ad,ad);const nd=sx(jh)-ls;Dh=Math.sqrt(nd*(nd+2*ls));const Bd=Math.acos(Dh/(ls+nd))-Math.acos(i0(Ui,ad));Dh*=Math.cos(Bd)}return 1.01*Dh}(l,this.pixelsPerMeter(l.center.lat,l.worldSize)),y=z1(l.zoom);if(y>0){const M=EE(l,b0(1,l.center.lat)*l.worldSize),N=l.worldSize/(2*Math.PI),q=Math.max(l.width,l.height)/l.worldSize*Math.PI;return im(d,M+N*(1-Math.cos(q)),Math.pow(y,10))}return d}upVector(l,d,y){return B1(d,y,l,1)}upVectorScale(l){return{metersToTile:Rx($x(x0(l)))}}}function ME(c){const l=c.parallels,d=!!l&&Math.abs(l[0]+l[1])<.01;switch(c.name){case"mercator":return new SE(c);case"equirectangular":return new GS(c);case"naturalEarth":return new qS(c);case"equalEarth":return new VS(c);case"winkelTripel":return new ZS(c);case"albers":return d?new CE(c):new US(c);case"lambertConformalConic":return d?new CE(c):new jS(c);case"globe":return new HS(c)}throw new Error(`Invalid projection name: ${c.name}`)}const XS=Tg.types,KS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gw(c,l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il){const $u=St?Math.min(Z1,Math.round(St[0])):0,Ku=St?Math.min(Z1,Math.round(St[1])):0;c.emplaceBack(l,d,Math.round(32*y),Math.round(32*M),N,q,($u<<1)+(Ht?1:0),Ku,16*Ui,16*Bn,256*ls,256*il)}function jw(c,l,d,y,M,N,q){c.emplaceBack(l,d,y,M,N,q)}function qw(c,l,d,y,M){c.emplaceBack(l,d,y,M),c.emplaceBack(l,d,y,M),c.emplaceBack(l,d,y,M),c.emplaceBack(l,d,y,M)}function WS(c){for(const l of c.sections)if(Ed(l.text))return!0;return!1}class A2{constructor(l){this.layoutVertexArray=new Pf,this.indexArray=new kp,this.programConfigurations=l,this.segments=new Eg,this.dynamicLayoutVertexArray=new Lf,this.opacityVertexArray=new Lp,this.placedSymbolArray=new kg,this.globeExtVertexArray=new Vf}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,y,M){this.isEmpty()||(y&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,f2.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,m2.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,KS,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,p2.members,!0)),this.opacityVertexBuffer.itemSize=1),(y||M)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}_e(A2,"SymbolBuffers");class P2{constructor(l,d,y){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new y,this.segments=new Eg,this.collisionVertexArray=new cm,this.collisionVertexArrayExt=new Jp}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,g2.members,!0),this.collisionVertexBufferExt=l.createVertexBuffer(this.collisionVertexArrayExt,_2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_e(P2,"CollisionBuffers");class X1{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(q=>q.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=z0([]),this.placementViewportMatrix=z0([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jx(this.zoom,d["text-size"]),this.iconSizeData=Jx(this.zoom,d["icon-size"]);const y=this.layers[0].layout,M=y.get("symbol-sort-key"),N=y.get("symbol-z-order");this.canOverlap=y.get("text-allow-overlap")||y.get("icon-allow-overlap")||y.get("text-ignore-placement")||y.get("icon-ignore-placement"),this.sortFeaturesByKey=N!=="viewport-y"&&M.constantOr(1)!==void 0,this.sortFeaturesByY=(N==="viewport-y"||N==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=y.get("text-writing-mode").map(q=>G0[q]),this.stateDependentLayerIds=this.layers.filter(q=>q.isStateDependent()).map(q=>q.id),this.sourceID=l.sourceID,this.projection=l.projection}createArrays(){this.text=new A2(new Iv(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new A2(new Iv(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new u_,this.lineVertexArray=new l1,this.symbolInstances=new $m}calculateGlyphDependencies(l,d,y,M,N){for(let q=0;q<l.length;q++)if(d[l.charCodeAt(q)]=!0,M&&N){const St=q1[l.charAt(q)];St&&(d[St.charCodeAt(0)]=!0)}}populate(l,d,y,M){const N=this.layers[0],q=N.layout,St=this.projection.name==="globe",Ht=q.get("text-font"),Ui=q.get("text-field"),Bn=q.get("icon-image"),ls=(Ui.value.kind!=="constant"||Ui.value.value instanceof vg&&!Ui.value.value.isEmpty()||Ui.value.value.toString().length>0)&&(Ht.value.kind!=="constant"||Ht.value.value.length>0),il=Bn.value.kind!=="constant"||!!Bn.value.value||Object.keys(Bn.parameters).length>0,$u=q.get("symbol-sort-key");if(this.features=[],!ls&&!il)return;const Ku=d.iconDependencies,rh=d.glyphDependencies,vh=d.availableImages,Ph=new Gn(this.zoom);for(const{feature:Xh,id:Dh,index:jh,sourceLayerIndex:ad}of l){const nd=N._featureFilter.needGeometry,Bd=y1(Xh,nd);if(!N._featureFilter.filter(Ph,Bd,y))continue;if(nd||(Bd.geometry=U0(Xh,y,M)),St&&Xh.type!==1&&y.z<=5){const Xd=Bd.geometry,kf=.98078528056,Df=(Ff,Yf)=>i0(B1(Ff.x,Ff.y,y,1),B1(Yf.x,Yf.y,y,1))<kf;for(let Ff=0;Ff<Xd.length;Ff++)Xd[Ff]=a2(Xd[Ff],Df)}let Rd,bf;if(ls){const Xd=N.getValueAndResolveTokens("text-field",Bd,y,vh),kf=vg.factory(Xd);WS(kf)&&(this.hasRTLText=!0),(!this.hasRTLText||vt()==="unavailable"||this.hasRTLText&&Ur.isParsed())&&(Rd=Ex(kf,N,Bd))}if(il){const Xd=N.getValueAndResolveTokens("icon-image",Bd,y,vh);bf=Xd instanceof ng?Xd:ng.fromString(Xd)}if(!Rd&&!bf)continue;const qf=this.sortFeaturesByKey?$u.evaluate(Bd,{},y):void 0;if(this.features.push({id:Dh,text:Rd,icon:bf,index:jh,sourceLayerIndex:ad,geometry:Bd.geometry,properties:Xh.properties,type:XS[Xh.type],sortKey:qf}),bf&&(Ku[bf.name]=!0),Rd){const Xd=Ht.evaluate(Bd,{},y).join(","),kf=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(G0.vertical)>=0;for(const Df of Rd.sections)if(Df.image)Ku[Df.image.name]=!0;else{const Ff=th(Rd.toString()),Yf=Df.fontStack||Xd,xf=rh[Yf]=rh[Yf]||{};this.calculateGlyphDependencies(Df.text,xf,kf,this.allowVerticalPlacement,Ff)}}}q.get("symbol-placement")==="line"&&(this.features=function(Xh){const Dh={},jh={},ad=[];let nd=0;function Bd(Xd){ad.push(Xh[Xd]),nd++}function Rd(Xd,kf,Df){const Ff=jh[Xd];return delete jh[Xd],jh[kf]=Ff,ad[Ff].geometry[0].pop(),ad[Ff].geometry[0]=ad[Ff].geometry[0].concat(Df[0]),Ff}function bf(Xd,kf,Df){const Ff=Dh[kf];return delete Dh[kf],Dh[Xd]=Ff,ad[Ff].geometry[0].shift(),ad[Ff].geometry[0]=Df[0].concat(ad[Ff].geometry[0]),Ff}function qf(Xd,kf,Df){const Ff=Df?kf[0][kf[0].length-1]:kf[0][0];return`${Xd}:${Ff.x}:${Ff.y}`}for(let Xd=0;Xd<Xh.length;Xd++){const kf=Xh[Xd],Df=kf.geometry,Ff=kf.text?kf.text.toString():null;if(!Ff){Bd(Xd);continue}const Yf=qf(Ff,Df),xf=qf(Ff,Df,!0);if(Yf in jh&&xf in Dh&&jh[Yf]!==Dh[xf]){const dp=bf(Yf,xf,Df),Sp=Rd(Yf,xf,ad[dp].geometry);delete Dh[Yf],delete jh[xf],jh[qf(Ff,ad[Sp].geometry,!0)]=Sp,ad[dp].geometry=null}else Yf in jh?Rd(Yf,xf,Df):xf in Dh?bf(Yf,xf,Df):(Bd(Xd),Dh[Yf]=nd-1,jh[xf]=nd-1)}return ad.filter(Xd=>Xd.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Xh,Dh)=>Xh.sortKey-Dh.sortKey)}update(l,d,y,M){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,y,M),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,y,M))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ME(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){const y=this.lineVertexArray.length;if(l.segment!==void 0)for(const{x:M,y:N}of d)this.lineVertexArray.emplaceBack(M,N);return{lineStartIndex:y,lineLength:this.lineVertexArray.length-y}}addSymbols(l,d,y,M,N,q,St,Ht,Ui,Bn,ls,il,$u,Ku){const rh=l.indexArray,vh=l.layoutVertexArray,Ph=l.globeExtVertexArray,Xh=l.segments.prepareSegment(4*d.length,vh,rh,this.canOverlap?q.sortKey:void 0),Dh=this.glyphOffsetArray.length,jh=Xh.vertexLength,ad=this.allowVerticalPlacement&&St===G0.vertical?Math.PI/2:0,nd=q.text&&q.text.sections;for(let Rd=0;Rd<d.length;Rd++){const{tl:bf,tr:qf,bl:Xd,br:kf,tex:Df,pixelOffsetTL:Ff,pixelOffsetBR:Yf,minFontScaleX:xf,minFontScaleY:dp,glyphOffset:Sp,isSDF:pp,sectionIndex:Qp}=d[Rd],Qf=Xh.vertexLength,Up=Sp[1];if(Gw(vh,Ui.x,Ui.y,bf.x,Up+bf.y,Df.x,Df.y,y,pp,Ff.x,Ff.y,xf,dp),Gw(vh,Ui.x,Ui.y,qf.x,Up+qf.y,Df.x+Df.w,Df.y,y,pp,Yf.x,Ff.y,xf,dp),Gw(vh,Ui.x,Ui.y,Xd.x,Up+Xd.y,Df.x,Df.y+Df.h,y,pp,Ff.x,Yf.y,xf,dp),Gw(vh,Ui.x,Ui.y,kf.x,Up+kf.y,Df.x+Df.w,Df.y+Df.h,y,pp,Yf.x,Yf.y,xf,dp),Ht){const{x:em,y:Em,z:tm}=Ht.anchor,[Zp,ag,rm]=Ht.up;jw(Ph,em,Em,tm,Zp,ag,rm),jw(Ph,em,Em,tm,Zp,ag,rm),jw(Ph,em,Em,tm,Zp,ag,rm),jw(Ph,em,Em,tm,Zp,ag,rm),qw(l.dynamicLayoutVertexArray,em,Em,tm,ad)}else qw(l.dynamicLayoutVertexArray,Ui.x,Ui.y,Ui.z,ad);rh.emplaceBack(Qf,Qf+1,Qf+2),rh.emplaceBack(Qf+1,Qf+2,Qf+3),Xh.vertexLength+=4,Xh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Sp[0]),Rd!==d.length-1&&Qp===d[Rd+1].sectionIndex||l.programConfigurations.populatePaintArrays(vh.length,q,q.index,{},$u,Ku,nd&&nd[Qp])}const Bd=Ht?Ht.anchor:Ui;l.placedSymbolArray.emplaceBack(Bd.x,Bd.y,Bd.z,Ui.x,Ui.y,Dh,this.glyphOffsetArray.length-Dh,jh,Bn,ls,Ui.segment,y?y[0]:0,y?y[1]:0,M[0],M[1],St,0,!1,0,il,0)}_commitLayoutVertex(l,d,y,M,N,q,St){l.emplaceBack(d,y,M,N,q,Math.round(St.x),Math.round(St.y))}_addCollisionDebugVertices(l,d,y,M,N,q,St){const Ht=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),Ui=Ht.vertexLength,Bn=St.tileAnchorX,ls=St.tileAnchorY;for(let $u=0;$u<4;$u++)y.collisionVertexArray.emplaceBack(0,0,0,0);y.collisionVertexArrayExt.emplaceBack(d,-l.padding,-l.padding),y.collisionVertexArrayExt.emplaceBack(d,l.padding,-l.padding),y.collisionVertexArrayExt.emplaceBack(d,l.padding,l.padding),y.collisionVertexArrayExt.emplaceBack(d,-l.padding,l.padding),this._commitLayoutVertex(y.layoutVertexArray,M,N,q,Bn,ls,new Zu(l.x1,l.y1)),this._commitLayoutVertex(y.layoutVertexArray,M,N,q,Bn,ls,new Zu(l.x2,l.y1)),this._commitLayoutVertex(y.layoutVertexArray,M,N,q,Bn,ls,new Zu(l.x2,l.y2)),this._commitLayoutVertex(y.layoutVertexArray,M,N,q,Bn,ls,new Zu(l.x1,l.y2)),Ht.vertexLength+=4;const il=y.indexArray;il.emplaceBack(Ui,Ui+1),il.emplaceBack(Ui+1,Ui+2),il.emplaceBack(Ui+2,Ui+3),il.emplaceBack(Ui+3,Ui),Ht.primitiveLength+=4}_addTextDebugCollisionBoxes(l,d,y,M,N,q){for(let St=M;St<N;St++){const Ht=y.get(St),Ui=this.getSymbolInstanceTextSize(l,q,d,St);this._addCollisionDebugVertices(Ht,Ui,this.textCollisionBox,Ht.projectedAnchorX,Ht.projectedAnchorY,Ht.projectedAnchorZ,q)}}_addIconDebugCollisionBoxes(l,d,y,M,N,q){for(let St=M;St<N;St++){const Ht=y.get(St),Ui=this.getSymbolInstanceIconSize(l,d,q.placedIconSymbolIndex);this._addCollisionDebugVertices(Ht,Ui,this.iconCollisionBox,Ht.projectedAnchorX,Ht.projectedAnchorY,Ht.projectedAnchorZ,q)}}generateCollisionDebugBuffers(l,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new P2(fp,Lw.members,qg),this.iconCollisionBox=new P2(fp,Lw.members,qg);const y=xy(this.iconSizeData,l),M=xy(this.textSizeData,l);for(let N=0;N<this.symbolInstances.length;N++){const q=this.symbolInstances.get(N);this._addTextDebugCollisionBoxes(M,l,d,q.textBoxStartIndex,q.textBoxEndIndex,q),this._addTextDebugCollisionBoxes(M,l,d,q.verticalTextBoxStartIndex,q.verticalTextBoxEndIndex,q),this._addIconDebugCollisionBoxes(y,l,d,q.iconBoxStartIndex,q.iconBoxEndIndex,q),this._addIconDebugCollisionBoxes(y,l,d,q.verticalIconBoxStartIndex,q.verticalIconBoxEndIndex,q)}}getSymbolInstanceTextSize(l,d,y,M){const N=this.text.placedSymbolArray.get(d.rightJustifiedTextSymbolIndex>=0?d.rightJustifiedTextSymbolIndex:d.centerJustifiedTextSymbolIndex>=0?d.centerJustifiedTextSymbolIndex:d.leftJustifiedTextSymbolIndex>=0?d.leftJustifiedTextSymbolIndex:d.verticalPlacedTextSymbolIndex>=0?d.verticalPlacedTextSymbolIndex:M),q=C_(this.textSizeData,l,N)/Qm;return this.tilePixelRatio*q}getSymbolInstanceIconSize(l,d,y){const M=this.icon.placedSymbolArray.get(y),N=C_(this.iconSizeData,l,M);return this.tilePixelRatio*N}_commitDebugCollisionVertexUpdate(l,d,y){l.emplaceBack(d,-y,-y),l.emplaceBack(d,y,-y),l.emplaceBack(d,y,y),l.emplaceBack(d,-y,y)}_updateTextDebugCollisionBoxes(l,d,y,M,N,q){for(let St=M;St<N;St++){const Ht=y.get(St),Ui=this.getSymbolInstanceTextSize(l,q,d,St);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Ui,Ht.padding)}}_updateIconDebugCollisionBoxes(l,d,y,M,N,q){for(let St=M;St<N;St++){const Ht=y.get(St),Ui=this.getSymbolInstanceIconSize(l,d,q);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Ui,Ht.padding)}}updateCollisionDebugBuffers(l,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=xy(this.iconSizeData,l),M=xy(this.textSizeData,l);for(let N=0;N<this.symbolInstances.length;N++){const q=this.symbolInstances.get(N);this._updateTextDebugCollisionBoxes(M,l,d,q.textBoxStartIndex,q.textBoxEndIndex,q),this._updateTextDebugCollisionBoxes(M,l,d,q.verticalTextBoxStartIndex,q.verticalTextBoxEndIndex,q),this._updateIconDebugCollisionBoxes(y,l,d,q.iconBoxStartIndex,q.iconBoxEndIndex,q.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(y,l,d,q.verticalIconBoxStartIndex,q.verticalIconBoxEndIndex,q.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(l,d,y,M,N,q,St,Ht,Ui){const Bn={};if(d<y){const{x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh,featureIndex:ad}=l.get(d);Bn.textBox={x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh},Bn.textFeatureIndex=ad}if(M<N){const{x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh,featureIndex:ad}=l.get(M);Bn.verticalTextBox={x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh},Bn.verticalTextFeatureIndex=ad}if(q<St){const{x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh,featureIndex:ad}=l.get(q);Bn.iconBox={x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh},Bn.iconFeatureIndex=ad}if(Ht<Ui){const{x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh,featureIndex:ad}=l.get(Ht);Bn.verticalIconBox={x1:ls,y1:il,x2:$u,y2:Ku,padding:rh,projectedAnchorX:vh,projectedAnchorY:Ph,projectedAnchorZ:Xh,tileAnchorX:Dh,tileAnchorY:jh},Bn.verticalIconFeatureIndex=ad}return Bn}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const y=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,y.textBoxStartIndex,y.textBoxEndIndex,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y.iconBoxStartIndex,y.iconBoxEndIndex,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){const y=l.placedSymbolArray.get(d),M=y.vertexStartIndex+4*y.numGlyphs;for(let N=y.vertexStartIndex;N<M;N+=4)l.indexArray.emplaceBack(N,N+1,N+2),l.indexArray.emplaceBack(N+1,N+2,N+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(l),y=Math.cos(l),M=[],N=[],q=[];for(let St=0;St<this.symbolInstances.length;++St){q.push(St);const Ht=this.symbolInstances.get(St);M.push(0|Math.round(d*Ht.tileAnchorX+y*Ht.tileAnchorY)),N.push(Ht.featureIndex)}return q.sort((St,Ht)=>M[St]-M[Ht]||N[Ht]-N[St]),q}addToSortKeyRanges(l,d){const y=this.sortKeyRanges[this.sortKeyRanges.length-1];y&&y.sortKey===d?y.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const y=this.symbolInstances.get(d);this.featureSortOrder.push(y.featureIndex);const{rightJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:N,leftJustifiedTextSymbolIndex:q,verticalPlacedTextSymbolIndex:St,placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:Ui}=y;M>=0&&this.addIndicesForPlacedSymbol(this.text,M),N>=0&&N!==M&&this.addIndicesForPlacedSymbol(this.text,N),q>=0&&q!==N&&q!==M&&this.addIndicesForPlacedSymbol(this.text,q),St>=0&&this.addIndicesForPlacedSymbol(this.text,St),Ht>=0&&this.addIndicesForPlacedSymbol(this.icon,Ht),Ui>=0&&this.addIndicesForPlacedSymbol(this.icon,Ui)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}_e(X1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),X1.MAX_GLYPHS=65535,X1.addDynamicAttributes=qw;const YS=new Oh({"symbol-placement":new Qu(Yd.layout_symbol["symbol-placement"]),"symbol-spacing":new Qu(Yd.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qu(Yd.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bh(Yd.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qu(Yd.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qu(Yd.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qu(Yd.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qu(Yd.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qu(Yd.layout_symbol["icon-rotation-alignment"]),"icon-size":new bh(Yd.layout_symbol["icon-size"]),"icon-text-fit":new Qu(Yd.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qu(Yd.layout_symbol["icon-text-fit-padding"]),"icon-image":new bh(Yd.layout_symbol["icon-image"]),"icon-rotate":new bh(Yd.layout_symbol["icon-rotate"]),"icon-padding":new Qu(Yd.layout_symbol["icon-padding"]),"icon-keep-upright":new Qu(Yd.layout_symbol["icon-keep-upright"]),"icon-offset":new bh(Yd.layout_symbol["icon-offset"]),"icon-anchor":new bh(Yd.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qu(Yd.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qu(Yd.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qu(Yd.layout_symbol["text-rotation-alignment"]),"text-field":new bh(Yd.layout_symbol["text-field"]),"text-font":new bh(Yd.layout_symbol["text-font"]),"text-size":new bh(Yd.layout_symbol["text-size"]),"text-max-width":new bh(Yd.layout_symbol["text-max-width"]),"text-line-height":new bh(Yd.layout_symbol["text-line-height"]),"text-letter-spacing":new bh(Yd.layout_symbol["text-letter-spacing"]),"text-justify":new bh(Yd.layout_symbol["text-justify"]),"text-radial-offset":new bh(Yd.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qu(Yd.layout_symbol["text-variable-anchor"]),"text-anchor":new bh(Yd.layout_symbol["text-anchor"]),"text-max-angle":new Qu(Yd.layout_symbol["text-max-angle"]),"text-writing-mode":new Qu(Yd.layout_symbol["text-writing-mode"]),"text-rotate":new bh(Yd.layout_symbol["text-rotate"]),"text-padding":new Qu(Yd.layout_symbol["text-padding"]),"text-keep-upright":new Qu(Yd.layout_symbol["text-keep-upright"]),"text-transform":new bh(Yd.layout_symbol["text-transform"]),"text-offset":new bh(Yd.layout_symbol["text-offset"]),"text-allow-overlap":new Qu(Yd.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qu(Yd.layout_symbol["text-ignore-placement"]),"text-optional":new Qu(Yd.layout_symbol["text-optional"])});var k2={paint:new Oh({"icon-opacity":new bh(Yd.paint_symbol["icon-opacity"]),"icon-color":new bh(Yd.paint_symbol["icon-color"]),"icon-halo-color":new bh(Yd.paint_symbol["icon-halo-color"]),"icon-halo-width":new bh(Yd.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bh(Yd.paint_symbol["icon-halo-blur"]),"icon-translate":new Qu(Yd.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qu(Yd.paint_symbol["icon-translate-anchor"]),"text-opacity":new bh(Yd.paint_symbol["text-opacity"]),"text-color":new bh(Yd.paint_symbol["text-color"],{runtimeType:Vh,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new bh(Yd.paint_symbol["text-halo-color"]),"text-halo-width":new bh(Yd.paint_symbol["text-halo-width"]),"text-halo-blur":new bh(Yd.paint_symbol["text-halo-blur"]),"text-translate":new Qu(Yd.paint_symbol["text-translate"]),"text-translate-anchor":new Qu(Yd.paint_symbol["text-translate-anchor"])}),layout:YS};class AE{constructor(l){this.type=l.property.overrides?l.property.overrides.runtimeType:mm,this.defaultValue=l}evaluate(l){if(l.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_e(AE,"FormatSectionOverride",{omit:["defaultValue"]});class Zw extends N0{constructor(l){super(l,k2)}recalculate(l,d){super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const y=this.layout.get("text-writing-mode");if(y){const M=[];for(const N of y)M.indexOf(N)<0&&M.push(N);this.layout._values["text-writing-mode"]=M}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(l,d,y,M){const N=this.layout.get(l).evaluate(d,{},y,M),q=this._unevaluatedLayout._values[l];return q.isDataDriven()||py(q.value)||!N?N:function(St,Ht){return Ht.replace(/{([^{}]+)}/g,(Ui,Bn)=>Bn in St?String(St[Bn]):"")}(d.properties,N)}createBucket(l){return new X1(l)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const l of k2.paint.overridableProperties){if(!Zw.hasPaintOverride(this.layout,l))continue;const d=this.paint.get(l),y=new AE(d),M=new jp(y,d.property.specification);let N=null;N=d.value.kind==="constant"||d.value.kind==="source"?new yv("source",M):new Ng("composite",M,d.value.zoomStops,d.value._interpolationType),this.paint._values[l]=new yh(d.property,N,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,y){return!(!this.layout||d.isDataDriven()||y.isDataDriven())&&Zw.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){const y=l.get("text-field"),M=k2.paint.properties[d];let N=!1;const q=St=>{for(const Ht of St)if(M.overrides&&M.overrides.hasOverride(Ht))return void(N=!0)};if(y.value.kind==="constant"&&y.value.value instanceof vg)q(y.value.value.sections);else if(y.value.kind==="source"){const St=Ui=>{N||(Ui instanceof Ey&&zm(Ui.value)===$f?q(Ui.value.sections):Ui instanceof P_?q(Ui.sections):Ui.eachChild(St))},Ht=y.value;Ht._styleExpression&&St(Ht._styleExpression.expression)}return N}getProgramConfiguration(l){return new Zv(this,l)}}var JS={paint:new Oh({"background-color":new Qu(Yd.paint_background["background-color"]),"background-pattern":new Qu(Yd.paint_background["background-pattern"]),"background-opacity":new Qu(Yd.paint_background["background-opacity"])})},QS={paint:new Oh({"raster-opacity":new Qu(Yd.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qu(Yd.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qu(Yd.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qu(Yd.paint_raster["raster-brightness-max"]),"raster-saturation":new Qu(Yd.paint_raster["raster-saturation"]),"raster-contrast":new Qu(Yd.paint_raster["raster-contrast"]),"raster-resampling":new Qu(Yd.paint_raster["raster-resampling"]),"raster-fade-duration":new Qu(Yd.paint_raster["raster-fade-duration"])})};class eT extends N0{constructor(l){super(l,{}),this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)}onRemove(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)}}var tT={paint:new Oh({"sky-type":new Qu(Yd.paint_sky["sky-type"]),"sky-atmosphere-sun":new Qu(Yd.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Qu(Yd.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Qu(Yd.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Qu(Yd.paint_sky["sky-gradient-radius"]),"sky-gradient":new kh(Yd.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Qu(Yd.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Qu(Yd.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Qu(Yd.paint_sky["sky-opacity"])})};function D2(c,l,d){const y=[0,0,1],M=vb([]);return Pv(M,M,d?-hh(c)+Math.PI:hh(c)),Gm(M,M,-hh(l)),hw(y,y,M),z_(y,y)}const iT={circle:class extends N0{constructor(c){super(c,u2)}createBucket(c){return new Fx(c)}queryRadius(c){const l=c;return Lv("circle-radius",this,l)+Lv("circle-stroke-width",this,l)+U1(this.paint.get("circle-translate"))}queryIntersectsFeature(c,l,d,y,M,N,q,St){const Ht=Sw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Ui=this.paint.get("circle-radius").evaluate(l,d)+this.paint.get("circle-stroke-width").evaluate(l,d);return Tw(c,y,N,q,St,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",Ht,Ui)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new Zv(this,c)}},heatmap:class extends N0{createBucket(c){return new Db(c)}constructor(c){super(c,Zx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Lv("heatmap-radius",this,c)}queryIntersectsFeature(c,l,d,y,M,N,q,St){const Ht=this.paint.get("heatmap-radius").evaluate(l,d);return Tw(c,y,N,q,St,!0,!0,new Zu(0,0),Ht)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new Zv(this,c)}},hillshade:class extends N0{constructor(c){super(c,Ob)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends N0{constructor(c){super(c,jd)}getProgramIds(){const c=this.paint.get("fill-pattern"),l=c&&c.constantOr(1),d=[l?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&d.push(l&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),d}getProgramConfiguration(c){return new Zv(this,c)}recalculate(c,l){super.recalculate(c,l);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Hh(c)}queryRadius(){return U1(this.paint.get("fill-translate"))}queryIntersectsFeature(c,l,d,y,M,N){return!c.queryGeometry.isAboveHorizon&&bw(Ew(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),y)}isTileClipped(){return!0}},"fill-extrusion":class extends N0{constructor(c){super(c,Oy)}createBucket(c){return new h_(c)}queryRadius(){return U1(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new Zv(this,c)}queryIntersectsFeature(c,l,d,y,M,N,q,St,Ht){const Ui=Sw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Bn=this.paint.get("fill-extrusion-height").evaluate(l,d),ls=this.paint.get("fill-extrusion-base").evaluate(l,d),il=[0,0],$u=St&&N.elevation,Ku=N.elevation?N.elevation.exaggeration():1,rh=c.tile.getBucket(this);if($u&&rh instanceof h_){const jh=rh.centroidVertexArray,ad=Ht+1;ad<jh.length&&(il[0]=jh.geta_centroid_pos0(ad),il[1]=jh.geta_centroid_pos1(ad))}if(il[0]===0&&il[1]===1)return!1;N.projection.name==="globe"&&(y=d_([y],[new Zu(0,0),new Zu(Rp,Rp)],c.tileID.canonical).map(jh=>jh.polygon).flat());const vh=$u?St:null,[Ph,Xh]=function(jh,ad,nd,Bd,Rd,bf,qf,Xd,kf,Df,Ff){return jh.projection.name==="globe"?function(Yf,xf,dp,Sp,pp,Qp,Qf,Up,em,Em,tm){const Zp=[],ag=[],rm=Yf.projection.upVectorScale(tm,Yf.center.lat,Yf.worldSize).metersToTile,nm=[0,0,0,1],Xm=[0,0,0,1],tg=(Km,yg,Lg,Xg)=>{Km[0]=yg,Km[1]=Lg,Km[2]=Xg,Km[3]=1},ig=_g();dp>0&&(dp+=ig),Sp+=ig;for(const Km of xf){const yg=[],Lg=[];for(const Xg of Km){const Wm=Xg.x+pp.x,o_=Xg.y+pp.y,Kg=Yf.projection.projectTilePoint(Wm,o_,tm),Cg=Yf.projection.upVector(tm,Xg.x,Xg.y);let Cm=dp,Wg=Sp;if(Qf){const rg=ly(Wm,o_,dp,Sp,Qf,Up,em,Em);Cm+=rg.base,Wg+=rg.top}dp!==0?tg(nm,Kg.x+Cg[0]*rm*Cm,Kg.y+Cg[1]*rm*Cm,Kg.z+Cg[2]*rm*Cm):tg(nm,Kg.x,Kg.y,Kg.z),tg(Xm,Kg.x+Cg[0]*rm*Wg,Kg.y+Cg[1]*rm*Wg,Kg.z+Cg[2]*rm*Wg),Sg(nm,nm,Qp),Sg(Xm,Xm,Qp),yg.push(new $y(nm[0],nm[1],nm[2])),Lg.push(new $y(Xm[0],Xm[1],Xm[2]))}Zp.push(yg),ag.push(Lg)}return[Zp,ag]}(jh,ad,nd,Bd,Rd,bf,qf,Xd,kf,Df,Ff):qf?function(Yf,xf,dp,Sp,pp,Qp,Qf,Up,em){const Em=[],tm=[],Zp=[0,0,0,1];for(const ag of Yf){const rm=[],nm=[];for(const Xm of ag){const tg=Xm.x+Sp.x,ig=Xm.y+Sp.y,Km=ly(tg,ig,xf,dp,Qp,Qf,Up,em);Zp[0]=tg,Zp[1]=ig,Zp[2]=Km.base,Zp[3]=1,Av(Zp,Zp,pp),Zp[3]=Math.max(Zp[3],1e-5);const yg=new $y(Zp[0]/Zp[3],Zp[1]/Zp[3],Zp[2]/Zp[3]);Zp[0]=tg,Zp[1]=ig,Zp[2]=Km.top,Zp[3]=1,Av(Zp,Zp,pp),Zp[3]=Math.max(Zp[3],1e-5);const Lg=new $y(Zp[0]/Zp[3],Zp[1]/Zp[3],Zp[2]/Zp[3]);rm.push(yg),nm.push(Lg)}Em.push(rm),tm.push(nm)}return[Em,tm]}(ad,nd,Bd,Rd,bf,qf,Xd,kf,Df):function(Yf,xf,dp,Sp,pp){const Qp=[],Qf=[],Up=pp[8]*xf,em=pp[9]*xf,Em=pp[10]*xf,tm=pp[11]*xf,Zp=pp[8]*dp,ag=pp[9]*dp,rm=pp[10]*dp,nm=pp[11]*dp;for(const Xm of Yf){const tg=[],ig=[];for(const Km of Xm){const yg=Km.x+Sp.x,Lg=Km.y+Sp.y,Xg=pp[0]*yg+pp[4]*Lg+pp[12],Wm=pp[1]*yg+pp[5]*Lg+pp[13],o_=pp[2]*yg+pp[6]*Lg+pp[14],Kg=pp[3]*yg+pp[7]*Lg+pp[15],Cg=Xg+Up,Cm=Wm+em,Wg=o_+Em,rg=Math.max(Kg+tm,1e-5),zy=Xg+Zp,Yg=Wm+ag,V_=o_+rm,M_=Math.max(Kg+nm,1e-5);tg.push(new $y(Cg/rg,Cm/rg,Wg/rg)),ig.push(new $y(zy/M_,Yg/M_,V_/M_))}Qp.push(tg),Qf.push(ig)}return[Qp,Qf]}(ad,nd,Bd,Rd,bf)}(N,y,ls,Bn,Ui,q,vh,il,Ku,N.center.lat,c.tileID.canonical),Dh=c.queryGeometry;return function(jh,ad,nd){let Bd=1/0;bw(nd,ad)&&(Bd=By(nd,ad[0]));for(let Rd=0;Rd<ad.length;Rd++){const bf=ad[Rd],qf=jh[Rd];for(let Xd=0;Xd<bf.length-1;Xd++){const kf=bf[Xd],Df=[kf,bf[Xd+1],qf[Xd+1],qf[Xd],kf];xw(nd,Df)&&(Bd=Math.min(Bd,By(nd,Df)))}}return Bd!==1/0&&Bd}(Ph,Xh,Dh.isPointQuery()?Dh.screenBounds:Dh.screenGeometry)}},line:class extends N0{constructor(c){super(c,Yx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const l=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=l._styleExpression&&l._styleExpression.expression instanceof gv,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,l){super.recalculate(c,l),this.paint._values["line-floorwidth"]=Gb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new bx(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new Zv(this,c)}queryRadius(c){const l=c,d=Dw(Lv("line-width",this,l),Lv("line-gap-width",this,l)),y=Lv("line-offset",this,l);return d/2+Math.abs(y)+U1(this.paint.get("line-translate"))}queryIntersectsFeature(c,l,d,y,M,N){if(c.queryGeometry.isAboveHorizon)return!1;const q=Ew(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),St=c.pixelToTileUnitsFactor/2*Dw(this.paint.get("line-width").evaluate(l,d),this.paint.get("line-gap-width").evaluate(l,d)),Ht=this.paint.get("line-offset").evaluate(l,d);return Ht&&(y=function(Ui,Bn){const ls=[],il=new Zu(0,0);for(let $u=0;$u<Ui.length;$u++){const Ku=Ui[$u],rh=[];for(let vh=0;vh<Ku.length;vh++){const Ph=Ku[vh],Xh=Ku[vh+1],Dh=vh===0?il:Ph.sub(Ku[vh-1])._unit()._perp(),jh=vh===Ku.length-1?il:Xh.sub(Ph)._unit()._perp(),ad=Dh._add(jh)._unit();ad._mult(1/(ad.x*jh.x+ad.y*jh.y)),rh.push(ad._mult(Bn)._add(Ph))}ls.push(rh)}return ls}(y,Ht*c.pixelToTileUnitsFactor)),function(Ui,Bn,ls){for(let il=0;il<Bn.length;il++){const $u=Bn[il];if(Ui.length>=3){for(let Ku=0;Ku<$u.length;Ku++)if(x1(Ui,$u[Ku]))return!0}if(Ux(Ui,$u,ls))return!0}return!1}(q,y,St)}isTileClipped(){return!0}},symbol:Zw,background:class extends N0{constructor(c){super(c,JS)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends N0{constructor(c){super(c,QS)}getProgramIds(){return["raster"]}},sky:class extends N0{constructor(c){super(c,tT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const l=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==l.azimuthal||this._lightPosition.polar!==l.polar}return!1}getCenter(c,l){if(this.paint.get("sky-type")==="atmosphere"){const y=this.paint.get("sky-atmosphere-sun"),M=!y,N=c.style.light,q=N.properties.get("position");return M&&N.properties.get("anchor")==="viewport"&&Vd("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),M?D2(q.azimuthal,90-q.polar,l):D2(y[0],90-y[1],l)}const d=this.paint.get("sky-gradient-center");return D2(d[0],90-d[1],l)}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}}};class Yb{constructor(l,d,y,M){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(d,M)}update(l,d,y){const{width:M,height:N}=l,{context:q}=this,{gl:St}=q,{HTMLImageElement:Ht,HTMLCanvasElement:Ui,HTMLVideoElement:Bn,ImageData:ls,ImageBitmap:il}=x;if(St.bindTexture(St.TEXTURE_2D,this.texture),q.pixelStoreUnpackFlipY.set(!1),q.pixelStoreUnpack.set(1),q.pixelStoreUnpackPremultiplyAlpha.set(this.format===St.RGBA&&(!d||d.premultiply!==!1)),y||this.size&&this.size[0]===M&&this.size[1]===N){const{x:$u,y:Ku}=y||{x:0,y:0};l instanceof Ht||l instanceof Ui||l instanceof Bn||l instanceof ls||il&&l instanceof il?St.texSubImage2D(St.TEXTURE_2D,0,$u,Ku,St.RGBA,St.UNSIGNED_BYTE,l):St.texSubImage2D(St.TEXTURE_2D,0,$u,Ku,M,N,St.RGBA,St.UNSIGNED_BYTE,l.data)}else this.size=[M,N],l instanceof Ht||l instanceof Ui||l instanceof Bn||l instanceof ls||il&&l instanceof il?St.texImage2D(St.TEXTURE_2D,0,this.format,this.format,St.UNSIGNED_BYTE,l):St.texImage2D(St.TEXTURE_2D,0,this.format,M,N,0,this.format,St.UNSIGNED_BYTE,l.data);this.useMipmap=!!(d&&d.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&St.generateMipmap(St.TEXTURE_2D)}bind(l,d){const{context:y}=this,{gl:M}=y;M.bindTexture(M.TEXTURE_2D,this.texture),l!==this.filter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,l),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,this.useMipmap?l===M.NEAREST?M.NEAREST_MIPMAP_NEAREST:M.LINEAR_MIPMAP_NEAREST:l),this.filter=l),d!==this.wrap&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,d),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class rT{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nT{constructor(){this.tasks={},this.taskQueue=[],kd(["process"],this),this.invoker=new rT(this.process),this.nextId=0}add(l,d){const y=this.nextId++,M=function({type:N,isSymbolTile:q,zoom:St}){return St=St||0,N==="message"?0:N!=="maybePrepare"||q?N!=="parseTile"||q?N==="parseTile"&&q?300-St:N==="maybePrepare"&&q?400-St:500:200-St:100-St}(d);if(M===0){lp();try{l()}finally{}return{cancel:()=>{}}}return this.tasks[y]={fn:l,metadata:d,priority:M,id:y},this.taskQueue.push(y),this.invoker.trigger(),{cancel:()=>{delete this.tasks[y]}}}process(){lp();try{if(this.taskQueue=this.taskQueue.filter(y=>!!this.tasks[y]),!this.taskQueue.length)return;const l=this.pick();if(l===null)return;const d=this.tasks[l];if(delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),!d)return;d.fn()}finally{}}pick(){let l=null,d=1/0;for(let M=0;M<this.taskQueue.length;M++){const N=this.tasks[this.taskQueue[M]];N.priority<d&&(d=N.priority,l=M)}if(l===null)return null;const y=this.taskQueue[l];return this.taskQueue.splice(l,1),y}remove(){this.invoker.remove()}}class PE{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){const y=l[d];this._stringToNumber[y]=d,this._numberToString[d]=y}}encode(l){return this._stringToNumber[l]}decode(l){return this._numberToString[l]}}const oT=["tile","layer","source","sourceLayer","state"];class kE{constructor(l,d,y,M,N){this.type="Feature",this._vectorTileFeature=l,this._z=d,this._x=y,this._y=M,this.properties=l.properties,this.id=N}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(l.id=this.id);for(const d of oT)this[d]!==void 0&&(l[d]=this[d]);return l}}const dv=32,e1=33,K1=new Uint16Array(8184);for(let c=0;c<2046;c++){let l=c+2,d=0,y=0,M=0,N=0,q=0,St=0;for(1&l?M=N=q=dv:d=y=St=dv;(l>>=1)>1;){const Ui=d+M>>1,Bn=y+N>>1;1&l?(M=d,N=y,d=q,y=St):(d=M,y=N,M=q,N=St),q=Ui,St=Bn}const Ht=4*c;K1[Ht+0]=d,K1[Ht+1]=y,K1[Ht+2]=M,K1[Ht+3]=N}const t1=new Uint16Array(2178),W1=new Uint8Array(1089),Hw=new Uint16Array(1089);function DE(c){return c===0?-.03125:c===32?.03125:0}var LE=ud([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const RE={type:2,extent:Rp,loadGeometry:()=>[[new Zu(0,0),new Zu(Rp+1,0),new Zu(Rp+1,Rp+1),new Zu(0,Rp+1),new Zu(0,0)]]};class L2{constructor(l,d,y,M,N){this.tileID=l,this.uid=zd(),this.uses=0,this.tileSize=d,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=N,this.expiredRequestCount=0,this.state="loading",M&&M.transform&&(this.projection=M.transform.projection)}registerFadeDuration(l){const d=l+this.timeAdded;d<zp.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Sx(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,d,y){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(M,N){const q={};if(!N)return q;for(const St of M){const Ht=St.layerIds.map(Ui=>N.getLayer(Ui)).filter(Boolean);if(Ht.length!==0){St.layers=Ht,St.stateDependentLayerIds&&(St.stateDependentLayers=St.stateDependentLayerIds.map(Ui=>Ht.filter(Bn=>Bn.id===Ui)[0]));for(const Ui of Ht)q[Ui.id]=St}}return q}(l.buckets,d.style),this.hasSymbolBuckets=!1;for(const M in this.buckets){const N=this.buckets[M];if(N instanceof X1){if(this.hasSymbolBuckets=!0,!y)break;N.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const M in this.buckets){const N=this.buckets[M];if(N instanceof X1&&N.hasRTLText){this.hasRTLText=!0,Ur.isLoading()||Ur.isLoaded()||vt()!=="deferred"||mr();break}}this.queryPadding=0;for(const M in this.buckets){const N=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(M).queryRadius(N))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas)}else this.collisionBoxArray=new Om}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const M=this.buckets[y];M.uploadPending()&&M.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yb(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yb(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Yb(l,this.lineAtlas.image,d.ALPHA),this.lineAtlas.uploaded=!0)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,y,M,N,q,St,Ht){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:M,pixelPosMatrix:St,transform:q,params:N,tileTransform:this.tileTransform},l,d,y):{}}querySourceFeatures(l,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const M=y.loadVTLayers(),N=d?d.sourceLayer:"",q=M._geojsonTileLayer||M[N];if(!q)return;const St=p0(d&&d.filter),{z:Ht,x:Ui,y:Bn}=this.tileID.canonical,ls={z:Ht,x:Ui,y:Bn};for(let il=0;il<q.length;il++){const $u=q.feature(il);if(St.needGeometry){const vh=y1($u,!0);if(!St.filter(new Gn(this.tileID.overscaledZ),vh,this.tileID.canonical))continue}else if(!St.filter(new Gn(this.tileID.overscaledZ),$u))continue;const Ku=y.getId($u,N),rh=new kE($u,Ht,Ui,Bn,Ku);rh.tile=ls,l.push(rh)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const y=Kh(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let M=!1;if(this.expirationTime>y)M=!1;else if(d)if(this.expirationTime<d)M=!0;else{const N=this.expirationTime-d;N?this.expirationTime=y+Math.max(N,3e4):M=!0}else M=!0;M?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0||!d)return;const y=this.latestFeatureIndex.loadVTLayers(),M=d.style.listImages();for(const N in this.buckets){if(!d.style.hasLayer(N))continue;const q=this.buckets[N],St=q.layers[0].sourceLayer||"_geojsonTileLayer",Ht=y[St],Ui=l[St];if(!Ht||!Ui||Object.keys(Ui).length===0)continue;if(q.update(Ui,Ht,M,this.imageAtlas&&this.imageAtlas.patternPositions||{}),q instanceof bx||q instanceof Hh){const ls=d.style._getSourceCache(q.layers[0].source);d._terrain&&d._terrain.enabled&&ls&&q.programConfigurations.needsUpload&&d._terrain._clearRenderCacheForTile(ls.id,this.tileID)}const Bn=d&&d.style&&d.style.getLayer(N);Bn&&(this.queryPadding=Math.max(this.queryPadding,Bn.queryRadius(q)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zp.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=zp.now()+l}setTexture(l,d){const y=d.context,M=y.gl;this.texture=this.texture||d.getTileTexture(l.width),this.texture?this.texture.update(l,{useMipmap:!0}):(this.texture=new Yb(y,l,M.RGBA,{useMipmap:!0}),this.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE))}setDependencies(l,d){const y={};for(const M of d)y[M]=!0;this.dependencies[l]=y}hasDependency(l,d){for(const y of l){const M=this.dependencies[y];if(M){for(const N of d)if(M[N])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const y=U0(RE,this.tileID.canonical,this.tileTransform)[0],M=new Af,N=new ey;for(let q=0;q<y.length;q++){const{x:St,y:Ht}=y[q];M.emplaceBack(St,Ht),N.emplaceBack(q)}N.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(N),this._tileDebugBuffer=l.createVertexBuffer(M,sv.members),this._tileDebugSegments=Eg.simpleSegment(0,0,M.length,N.length)}_makeTileBoundsBuffers(l,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const y=U0(RE,this.tileID.canonical,this.tileTransform)[0];let M,N;if(this.isRaster){const q=function(St,Ht){const Ui=Sx(St,Ht),Bn=Math.pow(2,St.z);for(let vh=0;vh<e1;vh++)for(let Ph=0;Ph<e1;Ph++){const Xh=Ry((St.x+(Ph+DE(Ph))/dv)/Bn),Dh=Zg((St.y+(vh+DE(vh))/dv)/Bn),jh=Ht.project(Xh,Dh),ad=vh*e1+Ph;t1[2*ad+0]=Math.round((jh.x*Ui.scale-Ui.x)*Rp),t1[2*ad+1]=Math.round((jh.y*Ui.scale-Ui.y)*Rp)}W1.fill(0),Hw.fill(0);for(let vh=2045;vh>=0;vh--){const Ph=4*vh,Xh=K1[Ph+0],Dh=K1[Ph+1],jh=K1[Ph+2],ad=K1[Ph+3],nd=Xh+jh>>1,Bd=Dh+ad>>1,Rd=nd+Bd-Dh,bf=Bd+Xh-nd,qf=Dh*e1+Xh,Xd=ad*e1+jh,kf=Bd*e1+nd,Df=Math.hypot((t1[2*qf+0]+t1[2*Xd+0])/2-t1[2*kf+0],(t1[2*qf+1]+t1[2*Xd+1])/2-t1[2*kf+1])>=16;W1[kf]=W1[kf]||(Df?1:0),vh<1022&&(W1[kf]=W1[kf]||W1[(Dh+bf>>1)*e1+(Xh+Rd>>1)]||W1[(ad+bf>>1)*e1+(jh+Rd>>1)])}const ls=new Gd,il=new kp;let $u=0;function Ku(vh,Ph){const Xh=Ph*e1+vh;return Hw[Xh]===0&&(ls.emplaceBack(t1[2*Xh+0],t1[2*Xh+1],vh*Rp/dv,Ph*Rp/dv),Hw[Xh]=++$u),Hw[Xh]-1}function rh(vh,Ph,Xh,Dh,jh,ad){const nd=vh+Xh>>1,Bd=Ph+Dh>>1;if(Math.abs(vh-jh)+Math.abs(Ph-ad)>1&&W1[Bd*e1+nd])rh(jh,ad,vh,Ph,nd,Bd),rh(Xh,Dh,jh,ad,nd,Bd);else{const Rd=Ku(vh,Ph),bf=Ku(Xh,Dh),qf=Ku(jh,ad);il.emplaceBack(Rd,bf,qf)}}return rh(0,0,dv,dv,dv,0),rh(dv,dv,0,0,0,dv),{vertices:ls,indices:il}}(this.tileID.canonical,d);M=q.vertices,N=q.indices}else{M=new Gd,N=new kp;for(const{x:St,y:Ht}of y)M.emplaceBack(St,Ht,0,0);const q=kn(M.int16,void 0,4);for(let St=0;St<q.length;St+=3)N.emplaceBack(q[St],q[St+1],q[St+2])}this._tileBoundsBuffer=l.createVertexBuffer(M,LE.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(N),this._tileBoundsSegments=Eg.simpleSegment(0,0,M.length,N.length)}_makeGlobeTileDebugBuffers(l,d){const y=d.projection;if(!y||y.name!=="globe"||d.freezeTileCoverage)return;const M=this.tileID.canonical,N=N1(dx(M,d)),q=z1(d.zoom);let St;q>0&&(St=mb(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(l,M,d,N,St,q),this._makeGlobeTileDebugTextBuffer(l,M,d,N,St,q)}_globePoint(l,d,y,M,N,q,St){let Ht=B1(l,d,y);if(q){const Ui=1<<y.z,Bn=uv(M.center.lng),ls=F0(M.center.lat),il=(y.x+.5)/Ui-Bn;let $u=0;il>.5?$u=-1:il<-.5&&($u=1);let Ku=(l/Rp+y.x)/Ui+$u,rh=(d/Rp+y.y)/Ui;Ku=(Ku-Bn)*M._pixelsPerMercatorPixel+Bn,rh=(rh-ls)*M._pixelsPerMercatorPixel+ls;const vh=[Ku*M.worldSize,rh*M.worldSize,0];Sg(vh,vh,q),Ht=Kv(Ht,vh,St)}return Sg(Ht,Ht,N)}_makeGlobeTileDebugBorderBuffer(l,d,y,M,N,q){const St=new Af,Ht=new ey,Ui=new Td,Bn=(il,$u,Ku,rh,vh)=>{const Ph=(Ku-il)/(vh-1),Xh=(rh-$u)/(vh-1),Dh=St.length;for(let jh=0;jh<vh;jh++){const ad=il+jh*Ph,nd=$u+jh*Xh;St.emplaceBack(ad,nd);const Bd=this._globePoint(ad,nd,d,y,M,N,q);Ui.emplaceBack(Bd[0],Bd[1],Bd[2]),Ht.emplaceBack(Dh+jh)}},ls=Rp;Bn(0,0,ls,0,16),Bn(ls,0,ls,ls,16),Bn(ls,ls,0,ls,16),Bn(0,ls,0,0,16),this._tileDebugIndexBuffer=l.createIndexBuffer(Ht),this._tileDebugBuffer=l.createVertexBuffer(St,sv.members),this._globeTileDebugBorderBuffer=l.createVertexBuffer(Ui,av.members),this._tileDebugSegments=Eg.simpleSegment(0,0,St.length,Ht.length)}_makeGlobeTileDebugTextBuffer(l,d,y,M,N,q){const St=Rp/4,Ht=new Af,Ui=new kp,Bn=new Td,ls=25;Ui.reserve(32),Ht.reserve(ls),Bn.reserve(ls);const il=($u,Ku)=>ls*$u+Ku;for(let $u=0;$u<ls;$u++){const Ku=$u*St;for(let rh=0;rh<ls;rh++){const vh=rh*St;Ht.emplaceBack(vh,Ku);const Ph=this._globePoint(vh,Ku,d,y,M,N,q);Bn.emplaceBack(Ph[0],Ph[1],Ph[2])}}for(let $u=0;$u<4;$u++)for(let Ku=0;Ku<4;Ku++){const rh=il($u,Ku),vh=il($u,Ku+1),Ph=il($u+1,Ku),Xh=il($u+1,Ku+1);Ui.emplaceBack(rh,vh,Ph),Ui.emplaceBack(Ph,vh,Xh)}this._tileDebugTextIndexBuffer=l.createIndexBuffer(Ui),this._tileDebugTextBuffer=l.createVertexBuffer(Ht,sv.members),this._globeTileDebugTextBuffer=l.createVertexBuffer(Bn,av.members),this._tileDebugTextSegments=Eg.simpleSegment(0,0,ls,32)}}class aT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,y){const M=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][M]=this.stateChanges[l][M]||{},xd(this.stateChanges[l][M],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const N in this.state[l])N!==M&&(this.deletedStates[l][N]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][M]===null){this.deletedStates[l][M]={};for(const N in this.state[l][M])y[N]||(this.deletedStates[l][M][N]=null)}else for(const N in y)this.deletedStates[l]&&this.deletedStates[l][M]&&this.deletedStates[l][M][N]===null&&delete this.deletedStates[l][M][N]}removeFeatureState(l,d,y){if(this.deletedStates[l]===null)return;const M=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&d!==void 0)this.deletedStates[l][M]!==null&&(this.deletedStates[l][M]=this.deletedStates[l][M]||{},this.deletedStates[l][M][y]=null);else if(d!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][M])for(y in this.deletedStates[l][M]={},this.stateChanges[l][M])this.deletedStates[l][M][y]=null;else this.deletedStates[l][M]=null;else this.deletedStates[l]=null}getState(l,d){const y=String(d),M=xd({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const N=this.deletedStates[l][d];if(N===null)return{};for(const q in N)delete M[q]}return M}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const y={};for(const M in this.stateChanges){this.state[M]=this.state[M]||{};const N={};for(const q in this.stateChanges[M])this.state[M][q]||(this.state[M][q]={}),xd(this.state[M][q],this.stateChanges[M][q]),N[q]=this.state[M][q];y[M]=N}for(const M in this.deletedStates){this.state[M]=this.state[M]||{};const N={};if(this.deletedStates[M]===null)for(const q in this.state[M])N[q]={},this.state[M][q]={};else for(const q in this.deletedStates[M]){if(this.deletedStates[M][q]===null)this.state[M][q]={};else if(this.state[M][q])for(const St of Object.keys(this.deletedStates[M][q]))delete this.state[M][q][St];N[q]=this.state[M][q]}y[M]=y[M]||{},xd(y[M],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const M in l)l[M].setFeatureState(y,d)}}class OE{constructor(l){this.size=l,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(l,d){const y=this.toIdx(l,d);return{min:this.minimums[y],max:this.maximums[y]}}isLeaf(l,d){return this.leaves[this.toIdx(l,d)]}toIdx(l,d){return d*this.size+l}}function $E(c,l,d,y){let M=0,N=Number.MAX_VALUE;for(let q=0;q<3;q++)if(Math.abs(y[q])<1e-15){if(d[q]<c[q]||d[q]>l[q])return null}else{const St=1/y[q];let Ht=(c[q]-d[q])*St,Ui=(l[q]-d[q])*St;if(Ht>Ui){const Bn=Ht;Ht=Ui,Ui=Bn}if(Ht>M&&(M=Ht),Ui<N&&(N=Ui),M>N)return null}return M}function BE(c,l,d,y,M,N,q,St,Ht,Ui,Bn){const ls=y-c,il=M-l,$u=N-d,Ku=q-c,rh=St-l,vh=Ht-d,Ph=Bn[1]*vh-Bn[2]*rh,Xh=Bn[2]*Ku-Bn[0]*vh,Dh=Bn[0]*rh-Bn[1]*Ku,jh=ls*Ph+il*Xh+$u*Dh;if(Math.abs(jh)<1e-15)return null;const ad=1/jh,nd=Ui[0]-c,Bd=Ui[1]-l,Rd=Ui[2]-d,bf=(nd*Ph+Bd*Xh+Rd*Dh)*ad;if(bf<0||bf>1)return null;const qf=Bd*$u-Rd*il,Xd=Rd*ls-nd*$u,kf=nd*il-Bd*ls,Df=(Bn[0]*qf+Bn[1]*Xd+Bn[2]*kf)*ad;return Df<0||bf+Df>1?null:(Ku*qf+rh*Xd+vh*kf)*ad}function NE(c,l,d){return(c-l)/(d-l)}function zE(c,l,d,y,M,N,q,St,Ht){const Ui=1<<d,Bn=N-y,ls=q-M,il=(c+1)/Ui*Bn+y,$u=(l+0)/Ui*ls+M,Ku=(l+1)/Ui*ls+M;St[0]=(c+0)/Ui*Bn+y,St[1]=$u,Ht[0]=il,Ht[1]=Ku}class FE{constructor(l){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=l,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const d=function(N){const q=Math.ceil(Math.log2(N.dim/8)),St=[];let Ht=Math.ceil(Math.pow(2,q));const Ui=1/Ht,Bn=($u,Ku,rh,vh,Ph)=>{const Xh=vh?1:0,Dh=($u+1)*rh-Xh,jh=Ku*rh,ad=(Ku+1)*rh-Xh;Ph[0]=$u*rh,Ph[1]=jh,Ph[2]=Dh,Ph[3]=ad};let ls=new OE(Ht);const il=[];for(let $u=0;$u<Ht*Ht;$u++){Bn($u%Ht,Math.floor($u/Ht),Ui,!1,il);const Ku=Y1(il[0],il[1],N),rh=Y1(il[2],il[1],N),vh=Y1(il[2],il[3],N),Ph=Y1(il[0],il[3],N);ls.minimums.push(Math.min(Ku,rh,vh,Ph)),ls.maximums.push(Math.max(Ku,rh,vh,Ph)),ls.leaves.push(1)}for(St.push(ls),Ht/=2;Ht>=1;Ht/=2){const $u=St[St.length-1];ls=new OE(Ht);for(let Ku=0;Ku<Ht*Ht;Ku++){Bn(Ku%Ht,Math.floor(Ku/Ht),2,!0,il);const rh=$u.getElevation(il[0],il[1]),vh=$u.getElevation(il[2],il[1]),Ph=$u.getElevation(il[2],il[3]),Xh=$u.getElevation(il[0],il[3]),Dh=$u.isLeaf(il[0],il[1]),jh=$u.isLeaf(il[2],il[1]),ad=$u.isLeaf(il[2],il[3]),nd=$u.isLeaf(il[0],il[3]),Bd=Math.min(rh.min,vh.min,Ph.min,Xh.min),Rd=Math.max(rh.max,vh.max,Ph.max,Xh.max),bf=Dh&&jh&&ad&&nd;ls.maximums.push(Rd),ls.minimums.push(Bd),ls.leaves.push(Rd-Bd<=5&&bf?1:0)}St.push(ls)}return St}(this.dem),y=d.length-1,M=d[y];this._addNode(M.minimums[0],M.maximums[0],M.leaves[0]),this._construct(d,0,0,y,0)}raycastRoot(l,d,y,M,N,q,St=1){return $E([l,d,-100],[y,M,this.maximums[0]*St],N,q)}raycast(l,d,y,M,N,q,St=1){if(!this.nodeCount)return null;const Ht=this.raycastRoot(l,d,y,M,N,q,St);if(Ht==null)return null;const Ui=[],Bn=[],ls=[],il=[],$u=[{idx:0,t:Ht,nodex:0,nodey:0,depth:0}];for(;$u.length>0;){const{idx:Ku,t:rh,nodex:vh,nodey:Ph,depth:Xh}=$u.pop();if(this.leaves[Ku]){zE(vh,Ph,Xh,l,d,y,M,ls,il);const jh=1<<Xh,ad=(vh+0)/jh,nd=(vh+1)/jh,Bd=(Ph+0)/jh,Rd=(Ph+1)/jh,bf=Y1(ad,Bd,this.dem)*St,qf=Y1(nd,Bd,this.dem)*St,Xd=Y1(nd,Rd,this.dem)*St,kf=Y1(ad,Rd,this.dem)*St,Df=BE(ls[0],ls[1],bf,il[0],ls[1],qf,il[0],il[1],Xd,N,q),Ff=BE(il[0],il[1],Xd,ls[0],il[1],kf,ls[0],ls[1],bf,N,q),Yf=Math.min(Df!==null?Df:Number.MAX_VALUE,Ff!==null?Ff:Number.MAX_VALUE);if(Yf!==Number.MAX_VALUE)return Yf;{const xf=cx([],N,q,rh);if(UE(bf,qf,kf,Xd,NE(xf[0],ls[0],il[0]),NE(xf[1],ls[1],il[1]))>=xf[2])return rh}continue}let Dh=0;for(let jh=0;jh<this._siblingOffset.length;jh++){zE((vh<<1)+this._siblingOffset[jh][0],(Ph<<1)+this._siblingOffset[jh][1],Xh+1,l,d,y,M,ls,il),ls[2]=-100,il[2]=this.maximums[this.childOffsets[Ku]+jh]*St;const ad=$E(ls,il,N,q);if(ad!=null){const nd=ad;Ui[jh]=nd;let Bd=!1;for(let Rd=0;Rd<Dh&&!Bd;Rd++)nd>=Ui[Bn[Rd]]&&(Bn.splice(Rd,0,jh),Bd=!0);Bd||(Bn[Dh]=jh),Dh++}}for(let jh=0;jh<Dh;jh++){const ad=Bn[jh];$u.push({idx:this.childOffsets[Ku]+ad,t:Ui[ad],nodex:(vh<<1)+this._siblingOffset[ad][0],nodey:(Ph<<1)+this._siblingOffset[ad][1],depth:Xh+1})}}return null}_addNode(l,d,y){return this.minimums.push(l),this.maximums.push(d),this.leaves.push(y),this.childOffsets.push(0),this.nodeCount++}_construct(l,d,y,M,N){if(l[M].isLeaf(d,y)===1)return;this.childOffsets[N]||(this.childOffsets[N]=this.nodeCount);const q=M-1,St=l[q];let Ht=0,Ui=0;for(let Bn=0;Bn<this._siblingOffset.length;Bn++){const ls=2*d+this._siblingOffset[Bn][0],il=2*y+this._siblingOffset[Bn][1],$u=St.getElevation(ls,il),Ku=St.isLeaf(ls,il),rh=this._addNode($u.min,$u.max,Ku);Ku&&(Ht|=1<<Bn),Ui||(Ui=rh)}for(let Bn=0;Bn<this._siblingOffset.length;Bn++)Ht&1<<Bn||this._construct(l,2*d+this._siblingOffset[Bn][0],2*y+this._siblingOffset[Bn][1],q,Ui+Bn)}}function UE(c,l,d,y,M,N){return im(im(c,d,N),im(l,y,N),M)}function Y1(c,l,d){const y=d.dim,M=Cd(c*y-.5,0,y-1),N=Cd(l*y-.5,0,y-1),q=Math.floor(M),St=Math.floor(N),Ht=Math.min(q+1,y-1),Ui=Math.min(St+1,y-1);return UE(d.get(q,St),d.get(Ht,St),d.get(q,Ui),d.get(Ht,Ui),M-q,N-St)}const VE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function sT(c,l,d){return(256*c*256+256*l+d)/10-1e4}function lT(c,l,d){return 256*c+l+d/256-32768}class Xw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(l,d,y,M=!1,N=!1){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(y&&y!=="mapbox"&&y!=="terrarium")return Vd(`"${y}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=d.height;const q=this.dim=d.height-2,St=new Uint32Array(d.data.buffer);if(this.pixels=new Uint8Array(d.data.buffer),this.encoding=y||"mapbox",this.borderReady=M,!M){for(let Ht=0;Ht<q;Ht++)St[this._idx(-1,Ht)]=St[this._idx(0,Ht)],St[this._idx(q,Ht)]=St[this._idx(q-1,Ht)],St[this._idx(Ht,-1)]=St[this._idx(Ht,0)],St[this._idx(Ht,q)]=St[this._idx(Ht,q-1)];St[this._idx(-1,-1)]=St[this._idx(0,0)],St[this._idx(q,-1)]=St[this._idx(q-1,0)],St[this._idx(-1,q)]=St[this._idx(0,q-1)],St[this._idx(q,q)]=St[this._idx(q-1,q-1)],N&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new FE(this)}get(l,d,y=!1){y&&(l=Cd(l,-1,this.dim),d=Cd(d,-1,this.dim));const M=4*this._idx(l,d);return(this.encoding==="terrarium"?lT:sT)(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}static getUnpackVector(l){return VE[l]}get unpackVector(){return VE[this.encoding]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}static pack(l,d){const y=[0,0,0,0],M=Xw.getUnpackVector(d);let N=Math.floor((l+M[3])/M[2]);return y[2]=N%256,N=Math.floor(N/256),y[1]=N%256,N=Math.floor(N/256),y[0]=N,y}getPixels(){return new ry({width:this.stride,height:this.stride},this.pixels)}backfillBorder(l,d,y){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let M=d*this.dim,N=d*this.dim+this.dim,q=y*this.dim,St=y*this.dim+this.dim;switch(d){case-1:M=N-1;break;case 1:N=M+1}switch(y){case-1:q=St-1;break;case 1:St=q+1}const Ht=-d*this.dim,Ui=-y*this.dim;for(let Bn=q;Bn<St;Bn++)for(let ls=M;ls<N;ls++){const il=4*this._idx(ls,Bn),$u=4*this._idx(ls+Ht,Bn+Ui);this.pixels[il+0]=l.pixels[$u+0],this.pixels[il+1]=l.pixels[$u+1],this.pixels[il+2]=l.pixels[$u+2],this.pixels[il+3]=l.pixels[$u+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}_e(Xw,"DEMData"),_e(FE,"DemMinMaxQuadTree",{omit:["dem"]});class cT{constructor(l,d){this.max=l,this.onRemove=d,this.reset()}reset(){for(const l in this.data)for(const d of this.data[l])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(l,d,y){const M=l.wrapped().key;this.data[M]===void 0&&(this.data[M]=[]);const N={value:d,timeout:void 0};if(y!==void 0&&(N.timeout=setTimeout(()=>{this.remove(l,N)},y)),this.data[M].push(N),this.order.push(M),this.order.length>this.max){const q=this._getAndRemoveByKey(this.order[0]);q&&this.onRemove(q)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value}getByKey(l){const d=this.data[l];return d?d[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,d){if(!this.has(l))return this;const y=l.wrapped().key,M=d===void 0?0:this.data[y].indexOf(d),N=this.data[y][M];return this.data[y].splice(M,1),N.timeout&&clearTimeout(N.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(N.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(l){const d=[];for(const y in this.data)for(const M of this.data[y])l(M.value)||d.push(M);for(const y of d)this.remove(y.value.tileID,y)}}class sb{constructor(l,d,y){this.func=l,this.mask=d,this.range=y}}sb.ReadOnly=!1,sb.ReadWrite=!0,sb.disabled=new sb(519,sb.ReadOnly,[0,1]);const R2=7680;class O2{constructor(l,d,y,M,N,q){this.test=l,this.ref=d,this.mask=y,this.fail=M,this.depthFail=N,this.pass=q}}O2.disabled=new O2({func:519,mask:0},0,0,R2,R2,R2);class i1{constructor(l,d,y){this.blendFunction=l,this.blendColor=d,this.mask=y}}i1.Replace=[1,0],i1.disabled=new i1(i1.Replace,jm.transparent,[!1,!1,!1,!1]),i1.unblended=new i1(i1.Replace,jm.transparent,[!0,!0,!0,!0]),i1.alphaBlended=new i1([1,771],jm.transparent,[!0,!0,!0,!0]);const $2=1029,B2=2305;class Bv{constructor(l,d,y){this.enable=l,this.mode=d,this.frontFace=y}}Bv.disabled=new Bv(!1,$2,B2),Bv.backCCW=new Bv(!0,$2,B2),Bv.backCW=new Bv(!0,$2,2304),Bv.frontCW=new Bv(!0,1028,2304),Bv.frontCCW=new Bv(!0,1028,B2);class Tx extends by{constructor(l,d,y){super(),this.id=l,this._onlySymbols=y,d.on("data",M=>{M.dataType==="source"&&M.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new cT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new aT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(l){this.map=l,this._minTileCacheSize=this._minTileCacheSize===void 0&&l?l._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&l?l._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles){const d=this._tiles[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,d){return l.isSymbolTile=this._onlySymbols,this._source.loadTile(l,d)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l,()=>{})}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Hd(this._tiles).map(l=>l.tileID).sort(GE).map(l=>l.key)}getRenderableIds(l){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,l)&&d.push(this._tiles[y]);return l?d.sort((y,M)=>{const N=y.tileID,q=M.tileID,St=new Zu(N.canonical.x,N.canonical.y)._rotate(this.transform.angle),Ht=new Zu(q.canonical.x,q.canonical.y)._rotate(this.transform.angle);return N.overscaledZ-q.overscaledZ||Ht.y-St.y||Ht.x-St.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(GE).map(y=>y.key)}hasRenderableParent(l){const d=this.findLoadedParent(l,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(l,d){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(d||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,d){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=d),this._loadTile(y,this._tileLoaded.bind(this,y,l,d)))}_tileLoaded(l,d,y,M){if(M)if(l.state="errored",M.status!==404)this._source.fire(new Ug(M,{tile:l}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const N=this.map.painter.terrain;this.update(this.transform,N.getScaledDemTileSize(),!0),N.resetTileLookupCache(this.id)}else this.update(this.transform);else l.timeAdded=zp.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new a_("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id}))}_backfillDEM(l){const d=this.getRenderableIds();for(let M=0;M<d.length;M++){const N=d[M];if(l.neighboringTiles&&l.neighboringTiles[N]){const q=this.getTileByID(N);y(l,q),y(q,l)}}function y(M,N){if(!M.dem||M.dem.borderReady)return;M.needsHillshadePrepare=!0,M.needsDEMTextureUpload=!0;let q=N.tileID.canonical.x-M.tileID.canonical.x;const St=N.tileID.canonical.y-M.tileID.canonical.y,Ht=Math.pow(2,M.tileID.canonical.z),Ui=N.tileID.key;q===0&&St===0||Math.abs(St)>1||(Math.abs(q)>1&&(Math.abs(q+Ht)===1?q+=Ht:Math.abs(q-Ht)===1&&(q-=Ht)),N.dem&&M.dem&&(M.dem.backfillBorder(N.dem,q,St),M.neighboringTiles&&M.neighboringTiles[Ui]&&(M.neighboringTiles[Ui].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,d,y,M){for(const N in this._tiles){let q=this._tiles[N];if(M[N]||!q.hasData()||q.tileID.overscaledZ<=d||q.tileID.overscaledZ>y)continue;let St=q.tileID;for(;q&&q.tileID.overscaledZ>d+1;){const Ui=q.tileID.scaledTo(q.tileID.overscaledZ-1);q=this._tiles[Ui.key],q&&q.hasData()&&(St=Ui)}let Ht=St;for(;Ht.overscaledZ>d;)if(Ht=Ht.scaledTo(Ht.overscaledZ-1),l[Ht.key]){M[St.key]=St;break}}}findLoadedParent(l,d){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=l.overscaledZ-1;y>=d;y--){const M=l.scaledTo(y),N=this._getLoadedTile(M);if(N)return N}}_getLoadedTile(l){const d=this._tiles[l.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,d){d=d||this._source.tileSize;const y=Math.ceil(l.width/d)+1,M=Math.ceil(l.height/d)+1,N=Math.floor(y*M*5),q=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,N):N,St=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,q):q;this._cache.setMaxSize(St)}handleWrapJump(l){const d=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,d){const y={};for(const M in this._tiles){const N=this._tiles[M];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+d),y[N.tileID.key]=N}this._tiles=y;for(const M in this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(const M in this._tiles)this._setTileReloadTimer(+M,this._tiles[M])}}update(l,d,y){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;let M;this.updateCacheSize(l,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?M=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(St=>new dg(St.canonical.z,St.wrap,St.canonical.z,St.canonical.x,St.canonical.y)):(M=l.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(M=M.filter(St=>this._source.hasTile(St)))):M=[];const N=this._updateRetainedTiles(M);if(jE(this._source.type)&&M.length!==0){const St={},Ht={},Ui=Object.keys(N);for(const ls of Ui){const il=N[ls],$u=this._tiles[ls];if(!$u||$u.fadeEndTime&&$u.fadeEndTime<=zp.now())continue;const Ku=this.findLoadedParent(il,Math.max(il.overscaledZ-Tx.maxOverzooming,this._source.minzoom));Ku&&(this._addTile(Ku.tileID),St[Ku.tileID.key]=Ku.tileID),Ht[ls]=il}const Bn=M[M.length-1].overscaledZ;for(const ls in this._tiles){const il=this._tiles[ls];if(N[ls]||!il.hasData())continue;let $u=il.tileID;for(;$u.overscaledZ>Bn;){$u=$u.scaledTo($u.overscaledZ-1);const Ku=this._tiles[$u.key];if(Ku&&Ku.hasData()&&Ht[$u.key]){N[ls]=il.tileID;break}}}for(const ls in St)N[ls]||(this._coveredTiles[ls]=!0,N[ls]=St[ls])}for(const St in N)this._tiles[St].clearFadeHold();const q=function(St,Ht){const Ui=[];for(const Bn in St)Bn in Ht||Ui.push(Bn);return Ui}(this._tiles,N);for(const St of q){const Ht=this._tiles[St];Ht.hasSymbolBuckets&&!Ht.holdingForFade()?Ht.setHoldDuration(this.map._fadeDuration):Ht.hasSymbolBuckets&&!Ht.symbolFadeFinished()||this._removeTile(+St)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const d={};if(l.length===0)return d;const y={},M=l.reduce((Ui,Bn)=>Math.min(Ui,Bn.overscaledZ),1/0),N=l[0].overscaledZ,q=Math.max(N-Tx.maxOverzooming,this._source.minzoom),St=Math.max(N+Tx.maxUnderzooming,this._source.minzoom),Ht={};for(const Ui of l){const Bn=this._addTile(Ui);d[Ui.key]=Ui,Bn.hasData()||M<this._source.maxzoom&&(Ht[Ui.key]=Ui)}this._retainLoadedChildren(Ht,M,St,d);for(const Ui of l){let Bn=this._tiles[Ui.key];if(Bn.hasData())continue;if(Ui.canonical.z>=this._source.maxzoom){const il=Ui.children(this._source.maxzoom)[0],$u=this.getTile(il);if($u&&$u.hasData()){d[il.key]=il;continue}}else{const il=Ui.children(this._source.maxzoom);if(d[il[0].key]&&d[il[1].key]&&d[il[2].key]&&d[il[3].key])continue}let ls=Bn.wasRequested();for(let il=Ui.overscaledZ-1;il>=q;--il){const $u=Ui.scaledTo(il);if(y[$u.key]||(y[$u.key]=!0,Bn=this.getTile($u),!Bn&&ls&&(Bn=this._addTile($u)),Bn&&(d[$u.key]=$u,ls=Bn.wasRequested(),Bn.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const d=[];let y,M=this._tiles[l].tileID;for(;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){y=this._loadedParentTiles[M.key];break}d.push(M.key);const N=M.scaledTo(M.overscaledZ-1);if(y=this._getLoadedTile(N),y)break;M=N}for(const N of d)this._loadedParentTiles[N]=y}}_addTile(l){let d=this._tiles[l.key];if(d)return d;d=this._cache.getAndRemove(l),d&&(this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,d)));const y=!!d;if(!y){const M=this.map?this.map.painter:null;d=new L2(l,this._source.tileSize*l.overscaleFactor(),this.transform.tileZoom,M,this._isRaster),this._loadTile(d,this._tileLoaded.bind(this,d,l.key,d.state))}return d?(d.uses++,this._tiles[l.key]=d,y||this._source.fire(new a_("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null}_setTileReloadTimer(l,d){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=d.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const d=this._tiles[l];d&&(d.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(l,d,y){const M=[],N=this.transform;if(!N)return M;const q=N.projection.name==="globe",St=uv(N.center.lng);for(const Ht in this._tiles){const Ui=this._tiles[Ht];if(y&&Ui.clearQueryDebugViz(),Ui.holdingForFade())continue;let Bn;if(q){const ls=Ui.tileID.canonical;if(ls.z===0){const il=[Math.abs(Cd(St,...Jb(ls,-1))-St),Math.abs(Cd(St,...Jb(ls,1))-St)];Bn=[0,2*il.indexOf(Math.min(...il))-1]}else{const il=[Math.abs(Cd(St,...Jb(ls,-1))-St),Math.abs(Cd(St,...Jb(ls,0))-St),Math.abs(Cd(St,...Jb(ls,1))-St)];Bn=[il.indexOf(Math.min(...il))-1]}}else Bn=[0];for(const ls of Bn){const il=l.containsTile(Ui,N,d,ls);il&&M.push(il)}}return M}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(jE(this._source.type))for(const l in this._tiles){const d=this._tiles[l];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=zp.now())return!0}return!1}setFeatureState(l,d,y){this._state.updateState(l=l||"_geojsonTileLayer",d,y)}removeFeatureState(l,d,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",d,y)}getFeatureState(l,d){return this._state.getState(l=l||"_geojsonTileLayer",d)}setDependencies(l,d,y){const M=this._tiles[l];M&&M.setDependencies(d,y)}reloadTilesForDependencies(l,d){for(const y in this._tiles)this._tiles[y].hasDependency(l,d)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(l,d))}_preloadTiles(l,d){if(!this._sourceLoaded){const St=()=>{this._sourceLoaded&&(this._source.off("data",St),this._preloadTiles(l,d))};return void this._source.on("data",St)}const y=new Map,M=Array.isArray(l)?l:[l],N=this.map.painter.terrain,q=this.usedForTerrain&&N?N.getScaledDemTileSize():this._source.tileSize;for(const St of M){const Ht=St.coveringTiles({tileSize:q,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Ui of Ht)y.set(Ui.key,Ui);this.usedForTerrain&&St.updateElevation(!1)}yd(Array.from(y.values()),(St,Ht)=>{const Ui=new L2(St,this._source.tileSize*St.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Ui,Bn=>{this._source.type==="raster-dem"&&Ui.dem&&this._backfillDEM(Ui),Ht(Bn,Ui)})},d)}}function GE(c,l){const d=Math.abs(2*c.wrap)-+(c.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return c.overscaledZ-l.overscaledZ||y-d||l.canonical.y-c.canonical.y||l.canonical.x-c.canonical.x}function jE(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function Jb(c,l){const d=1<<c.z;return[c.x/d+l,(c.x+1)/d+l]}Tx.maxOverzooming=10,Tx.maxUnderzooming=3;class Kw{constructor(l,d,y){this._demTile=l,this._dem=this._demTile.dem,this._scale=d,this._offset=y}static create(l,d,y){const M=y||l.findDEMTileFor(d);if(!M||!M.dem)return;const N=M.dem,q=M.tileID,St=1<<d.canonical.z-q.canonical.z;return new Kw(M,M.tileSize/Rp/St,[(d.canonical.x/St-q.canonical.x)*N.dim,(d.canonical.y/St-q.canonical.y)*N.dim])}tileCoordToPixel(l,d){const y=d*this._scale+this._offset[1],M=Math.floor(l*this._scale+this._offset[0]),N=Math.floor(y);return new Zu(M,N)}getElevationAt(l,d,y,M){const N=l*this._scale+this._offset[0],q=d*this._scale+this._offset[1],St=Math.floor(N),Ht=Math.floor(q),Ui=this._dem;return M=!!M,y?im(im(Ui.get(St,Ht,M),Ui.get(St,Ht+1,M),q-Ht),im(Ui.get(St+1,Ht,M),Ui.get(St+1,Ht+1,M),q-Ht),N-St):Ui.get(St,Ht,M)}getElevationAtPixel(l,d,y){return this._dem.get(l,d,!!y)}getMeterToDEM(l){return(1<<this._demTile.tileID.canonical.z)*b0(1,l)*this._dem.stride}}class qE{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new A(Rp,16,0),this.featureIndexArray=new O0,this.promoteId=d}insert(l,d,y,M,N,q=0){const St=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(y,M,N,q);const Ht=this.grid;for(let Ui=0;Ui<d.length;Ui++){const Bn=d[Ui],ls=[1/0,1/0,-1/0,-1/0];for(let il=0;il<Bn.length;il++){const $u=Bn[il];ls[0]=Math.min(ls[0],$u.x),ls[1]=Math.min(ls[1],$u.y),ls[2]=Math.max(ls[2],$u.x),ls[3]=Math.max(ls[3],$u.y)}ls[0]<Rp&&ls[1]<Rp&&ls[2]>=0&&ls[3]>=0&&Ht.insert(St,ls[0],ls[1],ls[2],ls[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jm(new Ow(this.rawTileData)).layers,this.sourceLayerCoder=new PE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const l in this.vtLayers)this.vtFeatures[l]=[]}return this.vtLayers}query(l,d,y,M){this.loadVTLayers();const N=l.params||{},q=p0(N.filter),St=l.tileResult,Ht=l.transform,Ui=St.bufferedTilespaceBounds,Bn=this.grid.query(Ui.min.x,Ui.min.y,Ui.max.x,Ui.max.y,(Ku,rh,vh,Ph)=>jx(St.bufferedTilespaceGeometry,Ku,rh,vh,Ph));Bn.sort(uT);let ls=null;Ht.elevation&&Bn.length>0&&(ls=Kw.create(Ht.elevation,this.tileID));const il={};let $u;for(let Ku=0;Ku<Bn.length;Ku++){const rh=Bn[Ku];if(rh===$u)continue;$u=rh;const vh=this.featureIndexArray.get(rh);let Ph=null;this.loadMatchingFeature(il,vh,q,N.layers,N.availableImages,d,y,M,(Xh,Dh,jh,ad=0)=>(Ph||(Ph=U0(Xh,this.tileID.canonical,l.tileTransform)),Dh.queryIntersectsFeature(St,Xh,jh,Ph,this.z,l.transform,l.pixelPosMatrix,ls,ad)))}return il}loadMatchingFeature(l,d,y,M,N,q,St,Ht,Ui){const{featureIndex:Bn,bucketIndex:ls,sourceLayerIndex:il,layoutVertexArrayOffset:$u}=d,Ku=this.bucketLayerIDs[ls];if(M&&!function(Xh,Dh){for(let jh=0;jh<Xh.length;jh++)if(Dh.indexOf(Xh[jh])>=0)return!0;return!1}(M,Ku))return;const rh=this.sourceLayerCoder.decode(il),vh=this.vtLayers[rh].feature(Bn);if(y.needGeometry){const Xh=y1(vh,!0);if(!y.filter(new Gn(this.tileID.overscaledZ),Xh,this.tileID.canonical))return}else if(!y.filter(new Gn(this.tileID.overscaledZ),vh))return;const Ph=this.getId(vh,rh);for(let Xh=0;Xh<Ku.length;Xh++){const Dh=Ku[Xh];if(M&&M.indexOf(Dh)<0)continue;const jh=q[Dh];if(!jh)continue;let ad={};Ph!==void 0&&Ht&&(ad=Ht.getState(jh.sourceLayer||"_geojsonTileLayer",Ph));const nd=xd({},St[Dh]);nd.paint=ZE(nd.paint,jh.paint,vh,ad,N),nd.layout=ZE(nd.layout,jh.layout,vh,ad,N);const Bd=!Ui||Ui(vh,jh,ad,$u);if(!Bd)continue;const Rd=new kE(vh,this.z,this.x,this.y,Ph);Rd.layer=nd;let bf=l[Dh];bf===void 0&&(bf=l[Dh]=[]),bf.push({featureIndex:Bn,feature:Rd,intersectionZ:Bd})}}lookupSymbolFeatures(l,d,y,M,N,q,St,Ht){const Ui={};this.loadVTLayers();const Bn=p0(N);for(const ls of l)this.loadMatchingFeature(Ui,{bucketIndex:y,sourceLayerIndex:M,featureIndex:ls,layoutVertexArrayOffset:0},Bn,q,St,Ht,d);return Ui}loadFeature(l){const{featureIndex:d,sourceLayerIndex:y}=l;this.loadVTLayers();const M=this.sourceLayerCoder.decode(y),N=this.vtFeatures[M];if(N[d])return N[d];const q=this.vtLayers[M].feature(d);return N[d]=q,q}hasLayer(l){for(const d of this.bucketLayerIDs)for(const y of d)if(l===y)return!0;return!1}getId(l,d){let y=l.id;if(this.promoteId){const M=typeof this.promoteId=="string"?this.promoteId:this.promoteId[d];M!=null&&(y=l.properties[M]),typeof y=="boolean"&&(y=Number(y))}return y}}function ZE(c,l,d,y,M){return gd(c,(N,q)=>{const St=l instanceof Ih?l.get(q):null;return St&&St.evaluate?St.evaluate(d,y,M):St})}function uT(c,l){return l-c}_e(qE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class HE{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.image=new hv({width:l,height:d}),this.positions={},this.uploaded=!1}getDash(l,d){const y=this.getKey(l,d);return this.positions[y]}trim(){const l=this.width,d=this.height=Kd(this.nextRow);this.image.resize({width:l,height:d})}getKey(l,d){return l.join(",")+d}getDashRanges(l,d,y){const M=[];let N=l.length%2==1?-l[l.length-1]*y:0,q=l[0]*y,St=!0;M.push({left:N,right:q,isDash:St,zeroLength:l[0]===0});let Ht=l[0];for(let Ui=1;Ui<l.length;Ui++){St=!St;const Bn=l[Ui];N=Ht*y,Ht+=Bn,q=Ht*y,M.push({left:N,right:q,isDash:St,zeroLength:Bn===0})}return M}addRoundDash(l,d,y){const M=d/2;for(let N=-y;N<=y;N++){const q=this.width*(this.nextRow+y+N);let St=0,Ht=l[St];for(let Ui=0;Ui<this.width;Ui++){Ui/Ht.right>1&&(Ht=l[++St]);const Bn=Math.abs(Ui-Ht.left),ls=Math.abs(Ui-Ht.right),il=Math.min(Bn,ls);let $u;const Ku=N/y*(M+1);if(Ht.isDash){const rh=M-Math.abs(Ku);$u=Math.sqrt(il*il+rh*rh)}else $u=M-Math.sqrt(il*il+Ku*Ku);this.image.data[q+Ui]=Math.max(0,Math.min(255,$u+128))}}}addRegularDash(l,d){for(let Ht=l.length-1;Ht>=0;--Ht){const Ui=l[Ht],Bn=l[Ht+1];Ui.zeroLength?l.splice(Ht,1):Bn&&Bn.isDash===Ui.isDash&&(Bn.left=Ui.left,l.splice(Ht,1))}const y=l[0],M=l[l.length-1];y.isDash===M.isDash&&(y.left=M.left-this.width,M.right=y.right+this.width);const N=this.width*this.nextRow;let q=0,St=l[q];for(let Ht=0;Ht<this.width;Ht++){Ht/St.right>1&&(St=l[++q]);const Ui=Math.abs(Ht-St.left),Bn=Math.abs(Ht-St.right),ls=Math.min(Ui,Bn);this.image.data[N+Ht]=Math.max(0,Math.min(255,(St.isDash?ls:-ls)+d+128))}}addDash(l,d){const y=this.getKey(l,d);if(this.positions[y])return this.positions[y];const M=d==="round",N=M?7:0,q=2*N+1;if(this.nextRow+q>this.height)return Vd("LineAtlas out of space"),null;l.length===0&&l.push(1);let St=0;for(let Bn=0;Bn<l.length;Bn++)l[Bn]<0&&(Vd("Negative value is found in line dasharray, replacing values with 0"),l[Bn]=0),St+=l[Bn];if(St!==0){const Bn=this.width/St,ls=this.getDashRanges(l,this.width,Bn);M?this.addRoundDash(ls,Bn,N):this.addRegularDash(ls,d==="square"?.5*Bn:0)}const Ht=this.nextRow+N;this.nextRow+=q;const Ui={tl:[Ht,N],br:[St,0]};return this.positions[y]=Ui,Ui}}_e(HE,"LineAtlas");const XE=1*$v;class KE{constructor(l){const d={},y=[];for(const St in l){const Ht=l[St],Ui=d[St]={};for(const Bn in Ht.glyphs){const ls=Ht.glyphs[+Bn];if(!ls||ls.bitmap.width===0||ls.bitmap.height===0)continue;const il=ls.metrics.localGlyph?XE:1,$u={x:0,y:0,w:ls.bitmap.width+2*il,h:ls.bitmap.height+2*il};y.push($u),Ui[Bn]=$u}}const{w:M,h:N}=b2(y),q=new hv({width:M||1,height:N||1});for(const St in l){const Ht=l[St];for(const Ui in Ht.glyphs){const Bn=Ht.glyphs[+Ui];if(!Bn||Bn.bitmap.width===0||Bn.bitmap.height===0)continue;const ls=d[St][Ui],il=Bn.metrics.localGlyph?XE:1;hv.copy(Bn.bitmap,q,{x:0,y:0},{x:ls.x+il,y:ls.y+il},Bn.bitmap)}}this.image=q,this.positions=d}}_e(KE,"GlyphAtlas");class hT{constructor(l){this.tileID=new dg(l.tileID.overscaledZ,l.tileID.wrap,l.tileID.canonical.z,l.tileID.canonical.x,l.tileID.canonical.y),this.tileZoom=l.tileZoom,this.uid=l.uid,this.zoom=l.zoom,this.canonical=l.tileID.canonical,this.pixelRatio=l.pixelRatio,this.tileSize=l.tileSize,this.source=l.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=l.showCollisionBoxes,this.collectResourceTiming=!!l.collectResourceTiming,this.returnDependencies=!!l.returnDependencies,this.promoteId=l.promoteId,this.enableTerrain=!!l.enableTerrain,this.isSymbolTile=l.isSymbolTile,this.tileTransform=Sx(l.tileID.canonical,l.projection),this.projection=l.projection}parse(l,d,y,M,N){this.status="parsing",this.data=l,this.collisionBoxArray=new Om;const q=new PE(Object.keys(l.layers).sort()),St=new qE(this.tileID,this.promoteId);St.bucketLayerIDs=[];const Ht={},Ui=new HE(256,256),Bn={featureIndex:St,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ui,availableImages:y},ls=d.familiesBySource[this.source];for(const ad in ls){const nd=l.layers[ad];if(!nd)continue;let Bd=!1,Rd=!1;for(const Xd of ls[ad])Xd[0].type==="symbol"?Bd=!0:Rd=!0;if(this.isSymbolTile===!0&&!Bd||this.isSymbolTile===!1&&!Rd)continue;nd.version===1&&Vd(`Vector tile source "${this.source}" layer "${ad}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bf=q.encode(ad),qf=[];for(let Xd=0;Xd<nd.length;Xd++){const kf=nd.feature(Xd),Df=St.getId(kf,ad);qf.push({feature:kf,id:Df,index:Xd,sourceLayerIndex:bf})}for(const Xd of ls[ad]){const kf=Xd[0];this.isSymbolTile!==void 0&&kf.type==="symbol"!==this.isSymbolTile||kf.minzoom&&this.zoom<Math.floor(kf.minzoom)||kf.maxzoom&&this.zoom>=kf.maxzoom||kf.visibility!=="none"&&(N2(Xd,this.zoom,y),(Ht[kf.id]=kf.createBucket({index:St.bucketLayerIDs.length,layers:Xd,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bf,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:y})).populate(qf,Bn,this.tileID.canonical,this.tileTransform),St.bucketLayerIDs.push(Xd.map(Df=>Df.id)))}}let il,$u,Ku,rh;Ui.trim();const vh={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ph=()=>{if(il)return N(il);if($u&&Ku&&rh){const ad=new KE($u),nd=new iE(Ku,rh);for(const Bd in Ht){const Rd=Ht[Bd];Rd instanceof X1?(N2(Rd.layers,this.zoom,y),BS(Rd,$u,ad.positions,Ku,nd.iconPositions,this.showCollisionBoxes,y,this.tileID.canonical,this.tileZoom,this.projection)):Rd.hasPattern&&(Rd instanceof bx||Rd instanceof Hh||Rd instanceof h_)&&(N2(Rd.layers,this.zoom,y),Rd.addFeatures(Bn,this.tileID.canonical,nd.patternPositions,y,this.tileTransform))}this.status="done",N(null,{buckets:Hd(Ht).filter(Bd=>!Bd.isEmpty()),featureIndex:St,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ad.image,lineAtlas:Ui,imageAtlas:nd,glyphMap:this.returnDependencies?$u:null,iconMap:this.returnDependencies?Ku:null,glyphPositions:this.returnDependencies?ad.positions:null})}},Xh=gd(Bn.glyphDependencies,ad=>Object.keys(ad).map(Number));Object.keys(Xh).length?M.send("getGlyphs",{uid:this.uid,stacks:Xh},(ad,nd)=>{il||(il=ad,$u=nd,Ph())},void 0,!1,vh):$u={};const Dh=Object.keys(Bn.iconDependencies);Dh.length?M.send("getImages",{icons:Dh,source:this.source,tileID:this.tileID,type:"icons"},(ad,nd)=>{il||(il=ad,Ku=nd,Ph())},void 0,!1,vh):Ku={};const jh=Object.keys(Bn.patternDependencies);jh.length?M.send("getImages",{icons:jh,source:this.source,tileID:this.tileID,type:"patterns"},(ad,nd)=>{il||(il=ad,rh=nd,Ph())},void 0,!1,vh):rh={},Ph()}}function N2(c,l,d){const y=new Gn(l);for(const M of c)M.recalculate(y,d)}class WE{constructor(l){this.entries={},this.scheduler=l}request(l,d,y,M){const N=this.entries[l]=this.entries[l]||{callbacks:[]};if(N.result){const[q,St]=N.result;return this.scheduler?this.scheduler.add(()=>{M(q,St)},d):M(q,St),()=>{}}return N.callbacks.push(M),N.cancel||(N.cancel=y((q,St)=>{N.result=[q,St];for(const Ht of N.callbacks)this.scheduler?this.scheduler.add(()=>{Ht(q,St)},d):Ht(q,St);setTimeout(()=>delete this.entries[l],3e3)})),()=>{N.result||(N.callbacks=N.callbacks.filter(q=>q!==M),N.callbacks.length||(N.cancel(),delete this.entries[l]))}}}function YE(c,l,d){const y=JSON.stringify(c.request);return c.data&&(this.deduped.entries[y]={result:[null,c.data]}),this.deduped.request(y,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},M=>{const N=Wd(c.request,(q,St,Ht,Ui)=>{q?M(q):St&&M(null,{vectorTile:d?void 0:new Jm(new Ow(St)),rawData:St,cacheControl:Ht,expires:Ui})});return()=>{N.cancel(),M()}},l)}const JE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class z2{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,y]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const M=y>>4;if(M!==1)throw new Error(`Got v${M} data when expected v1.`);const N=JE[15&y];if(!N)throw new Error("Unrecognized array type.");const[q]=new Uint16Array(l,2,1),[St]=new Uint32Array(l,4,1);return new z2(St,q,N,l)}constructor(l,d=64,y=Float64Array,M){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=y,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const N=JE.indexOf(this.ArrayType),q=2*l*this.ArrayType.BYTES_PER_ELEMENT,St=l*this.IndexArrayType.BYTES_PER_ELEMENT,Ht=(8-St%8)%8;if(N<0)throw new Error(`Unexpected typed array class: ${y}.`);M&&M instanceof ArrayBuffer?(this.data=M,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+St+Ht,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+q+St+Ht),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+St+Ht,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+N]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){const y=this._pos>>1;return this.ids[y]=y,this.coords[this._pos++]=l,this.coords[this._pos++]=d,y}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return F2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,y,M){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:N,coords:q,nodeSize:St}=this,Ht=[0,N.length-1,0],Ui=[];for(;Ht.length;){const Bn=Ht.pop()||0,ls=Ht.pop()||0,il=Ht.pop()||0;if(ls-il<=St){for(let vh=il;vh<=ls;vh++){const Ph=q[2*vh],Xh=q[2*vh+1];Ph>=l&&Ph<=y&&Xh>=d&&Xh<=M&&Ui.push(N[vh])}continue}const $u=il+ls>>1,Ku=q[2*$u],rh=q[2*$u+1];Ku>=l&&Ku<=y&&rh>=d&&rh<=M&&Ui.push(N[$u]),(Bn===0?l<=Ku:d<=rh)&&(Ht.push(il),Ht.push($u-1),Ht.push(1-Bn)),(Bn===0?y>=Ku:M>=rh)&&(Ht.push($u+1),Ht.push(ls),Ht.push(1-Bn))}return Ui}within(l,d,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:N,nodeSize:q}=this,St=[0,M.length-1,0],Ht=[],Ui=y*y;for(;St.length;){const Bn=St.pop()||0,ls=St.pop()||0,il=St.pop()||0;if(ls-il<=q){for(let vh=il;vh<=ls;vh++)eS(N[2*vh],N[2*vh+1],l,d)<=Ui&&Ht.push(M[vh]);continue}const $u=il+ls>>1,Ku=N[2*$u],rh=N[2*$u+1];eS(Ku,rh,l,d)<=Ui&&Ht.push(M[$u]),(Bn===0?l-y<=Ku:d-y<=rh)&&(St.push(il),St.push($u-1),St.push(1-Bn)),(Bn===0?l+y>=Ku:d+y>=rh)&&(St.push($u+1),St.push(ls),St.push(1-Bn))}return Ht}}function F2(c,l,d,y,M,N){if(M-y<=d)return;const q=y+M>>1;QE(c,l,q,y,M,N),F2(c,l,d,y,q-1,1-N),F2(c,l,d,q+1,M,1-N)}function QE(c,l,d,y,M,N){for(;M>y;){if(M-y>600){const Ui=M-y+1,Bn=d-y+1,ls=Math.log(Ui),il=.5*Math.exp(2*ls/3),$u=.5*Math.sqrt(ls*il*(Ui-il)/Ui)*(Bn-Ui/2<0?-1:1);QE(c,l,d,Math.max(y,Math.floor(d-Bn*il/Ui+$u)),Math.min(M,Math.floor(d+(Ui-Bn)*il/Ui+$u)),N)}const q=l[2*d+N];let St=y,Ht=M;for(Qb(c,l,y,d),l[2*M+N]>q&&Qb(c,l,y,M);St<Ht;){for(Qb(c,l,St,Ht),St++,Ht--;l[2*St+N]<q;)St++;for(;l[2*Ht+N]>q;)Ht--}l[2*y+N]===q?Qb(c,l,y,Ht):(Ht++,Qb(c,l,Ht,M)),Ht<=d&&(y=Ht+1),d<=Ht&&(M=Ht-1)}}function Qb(c,l,d,y){U2(c,d,y),U2(l,2*d,2*y),U2(l,2*d+1,2*y+1)}function U2(c,l,d){const y=c[l];c[l]=c[d],c[d]=y}function eS(c,l,d,y){const M=c-d,N=l-y;return M*M+N*N}o.ARRAY_TYPE=Ly,o.AUTH_ERR_MSG=zh,o.Aabb=iy,o.Actor=class{constructor(c,l,d){this.target=c,this.parent=l,this.mapId=d,this.callbacks={},this.cancelCallbacks={},kd(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=lp()?c:x,this.scheduler=new nT}send(c,l,d,y,M=!1,N){const q=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=N,this.callbacks[q]=d);const St=fd(this.globalScope)?void 0:[];return this.target.postMessage({id:q,type:c,hasCallback:!!d,targetMapId:y,mustQueue:M,sourceMapId:this.mapId,data:as(l,St)},St),{cancel:()=>{d&&delete this.callbacks[q],this.target.postMessage({id:q,type:"<cancel>",targetMapId:y,sourceMapId:this.mapId})}}}receive(c){const l=c.data,d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const y=this.cancelCallbacks[d];delete this.cancelCallbacks[d],y&&y.cancel()}else if(l.mustQueue||lp()){const y=this.callbacks[d];this.cancelCallbacks[d]=this.scheduler.add(()=>this.processTask(d,l),y&&y.metadata||{type:"message"})}else this.processTask(d,l)}processTask(c,l){if(l.type==="<response>"){const d=this.callbacks[c];delete this.callbacks[c],d&&(l.error?d(cs(l.error)):d(null,cs(l.data)))}else{const d=fd(this.globalScope)?void 0:[],y=l.hasCallback?(N,q)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:N?as(N):null,data:as(q,d)},d)}:N=>{},M=cs(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,M,y);else if(this.parent.getWorkerSource){const N=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,N[0],M.source)[N[1]](M,y)}else y(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=n_,o.Color=jm,o.ColorMode=i1,o.CullFaceMode=Bv,o.DEMData=Xw,o.DataConstantProperty=Qu,o.DedupedRequest=WE,o.DepthMode=sb,o.EXTENT=Rp,o.Elevation=class{isDataAvailableAtPoint(c){const l=this._source();if(this.isUsingMockSource()||!l||c.y<0||c.y>1)return!1;const d=l.getSource().maxzoom,y=1<<d,M=Math.floor(c.x),N=Math.floor((c.x-M)*y),q=Math.floor(c.y*y),St=this.findDEMTileFor(new dg(d,M,d,N,q));return!(!St||!St.dem)}getAtPointOrZero(c,l=0){return this.getAtPoint(c,l)||0}getAtPoint(c,l,d=!0){if(this.isUsingMockSource())return null;l==null&&(l=null);const y=this._source();if(!y||c.y<0||c.y>1)return l;const M=y.getSource().maxzoom,N=1<<M,q=Math.floor(c.x),St=c.x-q,Ht=new dg(M,q,M,Math.floor(St*N),Math.floor(c.y*N)),Ui=this.findDEMTileFor(Ht);if(!Ui||!Ui.dem)return l;const Bn=Ui.dem,ls=1<<Ui.tileID.canonical.z,il=(St*ls-Ui.tileID.canonical.x)*Bn.dim,$u=(c.y*ls-Ui.tileID.canonical.y)*Bn.dim,Ku=Math.floor(il),rh=Math.floor($u);return(d?this.exaggeration():1)*im(im(Bn.get(Ku,rh),Bn.get(Ku,rh+1),$u-rh),im(Bn.get(Ku+1,rh),Bn.get(Ku+1,rh+1),$u-rh),il-Ku)}getAtTileOffset(c,l,d){const y=1<<c.canonical.z;return this.getAtPointOrZero(new Dv(c.wrap+(c.canonical.x+l/Rp)/y,(c.canonical.y+d/Rp)/y))}getAtTileOffsetFunc(c,l,d,y){return M=>{const N=this.getAtTileOffset(c,M.x,M.y),q=y.upVector(c.canonical,M.x,M.y);return _y(q,q,N*y.upVectorScale(c.canonical,l,d).metersToTile),q}}getForTilePoints(c,l,d,y){if(this.isUsingMockSource())return!1;const M=Kw.create(this,c,y);return!!M&&(l.forEach(N=>{N[2]=this.exaggeration()*M.getElevationAt(N[0],N[1],d)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const l=this.findDEMTileFor(c);if(!l||!l.dem)return null;const d=l.dem.tree,y=l.tileID,M=1<<c.canonical.z-y.canonical.z;let N=c.canonical.x/M-y.canonical.x,q=c.canonical.y/M-y.canonical.y,St=0;for(let Ht=0;Ht<c.canonical.z-y.canonical.z&&!d.leaves[St];Ht++){N*=2,q*=2;const Ui=2*Math.floor(q)+Math.floor(N);St=d.childOffsets[St]+Ui,N%=1,q%=1}return{min:this.exaggeration()*d.minimums[St],max:this.exaggeration()*d.maximums[St]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,l,d){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Ug,o.EvaluationParameters=Gn,o.Event=a_,o.Evented=by,o.FillExtrusionBucket=h_,o.Frustum=Eb,o.FrustumCorners=wb,o.GLOBE_RADIUS=lv,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=fw,o.GLOBE_ZOOM_THRESHOLD_MIN=Sb,o.GlobeSharedBuffers=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const c of this._wireframeSegments)c.destroy()}}_fillGridMeshWithLods(c,l){const d=new Af,y=new kp,M=[],N=c+1+2,q=l[0]+1,St=l[0]+1+(1+l.length),Ht=(Ui,Bn,ls)=>{let il=Ui===N-1?Ui-2:Ui===0?Ui:Ui-1;return il+=ls?24575:0,[il,Bn]};for(let Ui=0;Ui<N;++Ui)d.emplaceBack(...Ht(Ui,0,!0));for(let Ui=0;Ui<q;++Ui)for(let Bn=0;Bn<N;++Bn)d.emplaceBack(...Ht(Bn,Ui,(Bn===0||Bn===N-1)&&!0));for(let Ui=0;Ui<l.length;++Ui){const Bn=l[Ui];for(let ls=0;ls<N;++ls)d.emplaceBack(...Ht(ls,Bn,!0))}for(let Ui=0;Ui<l.length;++Ui){const Bn=y.length,ls=l[Ui]+1+2,il=new kp;for(let rh=0;rh<ls-1;rh++){const vh=rh===ls-2,Ph=vh?N*(St-l.length+Ui-rh):N;for(let Xh=0;Xh<N-1;Xh++){const Dh=rh*N+Xh;rh===0||vh||Xh===0||Xh===N-2?(il.emplaceBack(Dh+1,Dh,Dh+Ph),il.emplaceBack(Dh+Ph,Dh+Ph+1,Dh+1)):(y.emplaceBack(Dh+1,Dh,Dh+Ph),y.emplaceBack(Dh+Ph,Dh+Ph+1,Dh+1))}}const $u=Eg.simpleSegment(0,Bn,d.length,y.length-Bn);for(let rh=0;rh<il.uint16.length;rh+=3)y.emplaceBack(il.uint16[rh],il.uint16[rh+1],il.uint16[rh+2]);const Ku=Eg.simpleSegment(0,Bn,d.length,y.length-Bn);M.push({withoutSkirts:$u,withSkirts:Ku})}return{vertices:d,indices:y,segments:M}}_createGrid(c){const l=this._fillGridMeshWithLods(m1,hx);this._gridSegments=l.segments,this._gridBuffer=c.createVertexBuffer(l.vertices,sv.members),this._gridIndexBuffer=c.createIndexBuffer(l.indices,!0)}_createPoles(c){const l=new kp;for(let M=0;M<=m1;M++)l.emplaceBack(0,M+1,M+2);this._poleIndexBuffer=c.createIndexBuffer(l,!0);const d=new Vm,y=new Vm;this._poleSegments=[];for(let M=0,N=0;M<Sb;M++){const q=360/(1<<M);d.emplaceBack(0,-lv,0,.5,0),y.emplaceBack(0,-lv,0,.5,1);for(let St=0;St<=m1;St++){const Ht=St/m1,Ui=im(0,q,Ht),[Bn,ls,il]=$1(_w,Wv,Ui,lv);d.emplaceBack(Bn,ls,il,Ht,0),y.emplaceBack(Bn,ls,il,Ht,1)}this._poleSegments.push(Eg.simpleSegment(N,0,66,64)),N+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(d,bb,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(y,bb,!1)}getGridBuffers(c,l){return[this._gridBuffer,this._gridIndexBuffer,l?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}getWirefameBuffers(c,l){if(!this._wireframeSegments){const d=new qg,y=m1,M=y+1+2,N=1;this._wireframeSegments=[];for(let q=0,St=0;q<hx.length;q++){const Ht=hx[q];for(let Bn=N;Bn<Ht+N;Bn++)for(let ls=N;ls<y+N;ls++){const il=Bn*M+ls;d.emplaceBack(il,il+1),d.emplaceBack(il,il+M),d.emplaceBack(il,il+M+1)}const Ui=Ht*y*3;this._wireframeSegments.push(Eg.simpleSegment(0,St,(Ht+1)*M,Ui)),St+=Ui}this._wireframeIndexBuffer=c.createIndexBuffer(d)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[l]]}},o.GlyphManager=ib,o.ImagePosition=w2,o.KDBush=z2,o.LivePerformanceUtils=wp,o.LngLat=Bm,o.LngLatBounds=Xv,o.LocalGlyphMode=T2,o.MAX_MERCATOR_LATITUDE=Hg,o.MercatorCoordinate=Dv,o.ONE_EM=Qm,o.OverscaledTileID=dg,o.PerformanceMarkers=ap,o.Point=Zu,o.Properties=Oh,o.RGBAImage=ry,o.Ray=Lx,o.RequestManager=class{constructor(c,l,d){this._transformRequestFn=c,this._customAccessToken=l,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const c=function(){let l="";for(let d=0;d<10;d++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",tl,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,l){return this._transformRequestFn&&this._transformRequestFn(c,l)||{url:c}}normalizeStyleURL(c,l){if(!Qh(c))return c;const d=Zs(c);return d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeGlyphsURL(c,l){if(!Qh(c))return c;const d=Zs(c);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeSourceURL(c,l,d,y){if(!Qh(c))return c;const M=Zs(c);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),d&&M.params.push(`language=${d}`),y&&M.params.push(`worldview=${y}`),this._makeAPIURL(M,this._customAccessToken||l)}normalizeSpriteURL(c,l,d,y){const M=Zs(c);return Qh(c)?(M.path=`/styles/v1${M.path}/sprite${l}${d}`,this._makeAPIURL(M,this._customAccessToken||y)):(M.path+=`${l}${d}`,ol(M))}normalizeTileURL(c,l,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!Qh(c))return c;const y=Zs(c);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||d&&y.authority!=="raster"&&d===512?"@2x":""}${nt.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${ge.RASTER_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${ge.TILE_URL_VERSION}${y.path}`);const M=this._customAccessToken||function(N){for(const q of N){const St=q.match(/^access_token=(.*)$/);if(St)return St[1]}return null}(y.params)||ge.ACCESS_TOKEN;return ge.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,M)}canonicalizeTileURL(c,l){const d=Zs(c);if(!d.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!d.path.match(/\.[\w]+$/))return c;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${ge.RASTER_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${ge.TILE_URL_VERSION}/`,"")}`;let M=d.params;return l&&(M=M.filter(N=>!N.match(/^access_token=/))),M.length&&(y+=`?${M.join("&")}`),y}canonicalizeTileset(c,l){const d=!!l&&Qh(l),y=[];for(const M of c.tiles||[])Th(M)?y.push(this.canonicalizeTileURL(M,d)):y.push(M);return y}_makeAPIURL(c,l){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=Zs(ge.API_URL);if(c.protocol=y.protocol,c.authority=y.authority,c.protocol==="http"){const M=c.params.indexOf("secure");M>=0&&c.params.splice(M,1)}if(y.path!=="/"&&(c.path=`${y.path}${c.path}`),!ge.REQUIRE_ACCESS_TOKEN)return ol(c);if(l=l||ge.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return c.params=c.params.filter(M=>M.indexOf("access_token")===-1),c.params.push(`access_token=${l||""}`),ol(c)}},o.ResourceType=Tp,o.SegmentVector=Eg,o.SourceCache=Tx,o.StencilMode=O2,o.StructArrayLayout1ui2=ey,o.StructArrayLayout2f1f2i16=Fp,o.StructArrayLayout2i4=Af,o.StructArrayLayout2ui4=qg,o.StructArrayLayout3f12=Jp,o.StructArrayLayout3ui6=kp,o.StructArrayLayout4i8=Gd,o.StructArrayLayout5f20=Vm,o.Texture=Yb,o.Tile=L2,o.Transitionable=Wu,o.Uniform1f=u1,o.Uniform1i=class extends y0{constructor(c){super(c),this.current=0}set(c,l,d){this.fetchUniformLocation(c,l)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}},o.Uniform2f=class extends y0{constructor(c){super(c),this.current=[0,0]}set(c,l,d){this.fetchUniformLocation(c,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}},o.Uniform3f=class extends y0{constructor(c){super(c),this.current=[0,0,0]}set(c,l,d){this.fetchUniformLocation(c,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}},o.Uniform4f=M1,o.UniformColor=cb,o.UniformMatrix2f=class extends y0{constructor(c){super(c),this.current=ub}set(c,l,d){if(this.fetchUniformLocation(c,l)){for(let y=0;y<4;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}},o.UniformMatrix3f=class extends y0{constructor(c){super(c),this.current=rx}set(c,l,d){if(this.fetchUniformLocation(c,l)){for(let y=0;y<9;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix3fv(this.location,!1,d);break}}}},o.UniformMatrix4f=class extends y0{constructor(c){super(c),this.current=nw}set(c,l,d){if(this.fetchUniformLocation(c,l)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let y=1;y<16;y++)if(d[y]!==this.current[y]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}},o.UnwrappedTileID=n0,o.ValidationError=hp,o.VectorTileFeature=Tg,o.VectorTileWorkerSource=class extends by{constructor(c,l,d,y,M){super(),this.actor=c,this.layerIndex=l,this.availableImages=d,this.loadVectorData=M||YE,this.loading={},this.loaded={},this.deduped=new WE(c.scheduler),this.isSpriteLoaded=y,this.scheduler=c.scheduler}loadTile(c,l){const d=c.uid,y=c&&c.request,M=y&&y.collectResourceTiming,N=this.loading[d]=new hT(c);N.abort=this.loadVectorData(c,(q,St)=>{const Ht=!this.loading[d];if(delete this.loading[d],Ht||q||!St)return N.status="done",Ht||(this.loaded[d]=N),l(q);const Ui=St.rawData,Bn={};St.expires&&(Bn.expires=St.expires),St.cacheControl&&(Bn.cacheControl=St.cacheControl),N.vectorTile=St.vectorTile||new Jm(new Ow(Ui));const ls=()=>{N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,(il,$u)=>{if(il||!$u)return l(il);const Ku={};if(M){const rh=Gh(y);rh.length>0&&(Ku.resourceTiming=JSON.parse(JSON.stringify(rh)))}l(null,xd({rawTileData:Ui.slice(0)},$u,Bn,Ku))})};this.isSpriteLoaded?ls():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ls,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):ls()}),this.loaded=this.loaded||{},this.loaded[d]=N})}reloadTile(c,l){const d=this.loaded,y=c.uid,M=this;if(d&&d[y]){const N=d[y];N.showCollisionBoxes=c.showCollisionBoxes,N.enableTerrain=!!c.enableTerrain,N.projection=c.projection,N.tileTransform=Sx(c.tileID.canonical,c.projection);const q=(St,Ht)=>{const Ui=N.reloadCallback;Ui&&(delete N.reloadCallback,N.parse(N.vectorTile,M.layerIndex,this.availableImages,M.actor,Ui)),l(St,Ht)};N.status==="parsing"?N.reloadCallback=q:N.status==="done"&&(N.vectorTile?N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,q):q())}}abortTile(c,l){const d=c.uid,y=this.loading[d];y&&(y.abort&&y.abort(),delete this.loading[d]),l()}removeTile(c,l){const d=this.loaded,y=c.uid;d&&d[y]&&delete d[y],l()}},o.WritingMode=G0,o.ZoomDependentExpression=Ng,o.add=Mv,o.addDynamicAttributes=qw,o.adjoint=function(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],q=l[4],St=l[5],Ht=l[6],Ui=l[7],Bn=l[8];return c[0]=q*Bn-St*Ui,c[1]=M*Ui-y*Bn,c[2]=y*St-M*q,c[3]=St*Ht-N*Bn,c[4]=d*Bn-M*Ht,c[5]=M*N-d*St,c[6]=N*Ui-q*Ht,c[7]=y*Ht-d*Ui,c[8]=d*q-y*N,c},o.asyncAll=yd,o.bezier=vd,o.bindAll=kd,o.boundsAttributes=LE,o.bufferConvexPolygon=function(c,l){const d=[];for(let y=0;y<c.length;y++){const M=Sd(y-1,-1,c.length-1),N=Sd(y+1,-1,c.length-1),q=c[y],St=c[N],Ht=c[M].sub(q).unit(),Ui=St.sub(q).unit(),Bn=Ui.angleWithSep(Ht.x,Ht.y),ls=Ht.add(Ui).unit().mult(-1*l/Math.sin(Bn/2));d.push(q.add(ls))}return d},o.cacheEntryPossiblyAdded=function(c){vp++,vp>Sf&&(c.getActor().send("enforceCacheSizeLimit",Jf),vp=0)},o.calculateGlobeLabelMatrix=function(c,l){const{x:d,y}=c.point,M=Bx(d,y,c.worldSize/c._pixelsPerMercatorPixel,0,0);return d1(M,M,fx(x0(l)))},o.calculateGlobeMatrix=function(c){const{x:l,y:d}=c.point,{lng:y,lat:M}=c._center;return Bx(l,d,c.worldSize,y,M)},o.calculateGlobeMercatorMatrix=function(c){const l=c.pixelsPerMeter,d=l/b0(1,c.center.lat),y=z0(new Float64Array(16));return ax(y,y,[c.point.x,c.point.y,0]),Cv(y,y,[d,d,l]),Float32Array.from(y)},o.circumferenceAtLatitude=Cb,o.clamp=Cd,o.clearTileCache=function(c){if(!Of())return;const l=x.caches.delete($d);c&&l.catch(c).then(()=>c())},o.clipLine=mE,o.clone=function(c){var l=new Ly(16);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=c[6],l[7]=c[7],l[8]=c[8],l[9]=c[9],l[10]=c[10],l[11]=c[11],l[12]=c[12],l[13]=c[13],l[14]=c[14],l[15]=c[15],l},o.clone$1=Uf,o.collisionCircleLayout=y2,o.config=ge,o.conjugate=function(c,l){return c[0]=-l[0],c[1]=-l[1],c[2]=-l[2],c[3]=l[3],c},o.create=function(){var c=new Ly(16);return Ly!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},o.create$1=fb,o.createExpression=d0,o.createLayout=ud,o.createStyleLayer=function(c){return c.type==="custom"?new eT(c):new iT[c.type](c)},o.cross=Dx,o.degToRad=hh,o.distance=function(c,l){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])},o.div=function(c,l,d){return c[0]=l[0]/d[0],c[1]=l[1]/d[1],c[2]=l[2]/d[2],c},o.dot=i0,o.earthRadius=F1,o.ease=Ef,o.easeCubicInOut=hd,o.ecefToLatLng=function([c,l,d]){const y=Math.hypot(c,l,d),M=Math.atan2(c,d),N=.5*Math.PI-Math.acos(-l/y);return new Bm(Sh(M),Sh(N))},o.emitValidationErrors=T1,o.endsWith=cd,o.enforceCacheSizeLimit=function(c){jf(),If&&If.then(l=>{l.keys().then(d=>{for(let y=0;y<d.length-c;y++)l.delete(d[y])})})},o.evaluateSizeForFeature=C_,o.evaluateSizeForZoom=xy,o.evaluateVariableOffset=xE,o.evented=Y,o.exactEquals=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]&&c[3]===l[3]},o.exactEquals$1=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]},o.exported=zp,o.exported$1=nt,o.extend=xd,o.extend$1=Mg,o.fillExtrusionHeightLift=_g,o.filterObject=bp,o.fromMat4=function(c,l){return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[4],c[4]=l[5],c[5]=l[6],c[6]=l[8],c[7]=l[9],c[8]=l[10],c},o.fromQuat=function(c,l){var d=l[0],y=l[1],M=l[2],N=l[3],q=d+d,St=y+y,Ht=M+M,Ui=d*q,Bn=y*q,ls=y*St,il=M*q,$u=M*St,Ku=M*Ht,rh=N*q,vh=N*St,Ph=N*Ht;return c[0]=1-ls-Ku,c[1]=Bn+Ph,c[2]=il-vh,c[3]=0,c[4]=Bn-Ph,c[5]=1-Ui-Ku,c[6]=$u+rh,c[7]=0,c[8]=il+vh,c[9]=$u-rh,c[10]=1-Ui-ls,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},o.fromRotation=function(c,l){var d=Math.sin(l),y=Math.cos(l);return c[0]=y,c[1]=d,c[2]=0,c[3]=-d,c[4]=y,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},o.fromScaling=sw,o.furthestTileCorner=function(c){const l=Math.round((c+45+360)%360/90)%4;return $h[l]},o.getAABBPointSquareDist=function(c,l,d){let y=0;for(let M=0;M<2;++M){const N=d?d[M]:0;c[M]>N&&(y+=(c[M]-N)*(c[M]-N)),l[M]<N&&(y+=(N-l[M])*(N-l[M]))}return y},o.getAnchorAlignment=S2,o.getAnchorJustification=C2,o.getBounds=function(c){let l=1/0,d=1/0,y=-1/0,M=-1/0;for(const N of c)l=Math.min(l,N.x),d=Math.min(d,N.y),y=Math.max(y,N.x),M=Math.max(M,N.y);return{min:new Zu(l,d),max:new Zu(y,M)}},o.getColumn=Yh,o.getDefaultExportFromCjs=Io,o.getGridMatrix=function(c,l,d,y){const M=l.getNorth(),N=l.getSouth(),q=l.getWest(),St=l.getEast(),Ht=1<<c.z,Ui=St-q,Bn=M-N,ls=Ui/m1,il=-Bn/hx[d],$u=[0,ls,0,il,0,0,M,q,0];if(c.z>0){const Ku=180/y;pb($u,$u,[Ku/Ui+1,0,0,0,Ku/Bn+1,0,-.5*Ku/ls,.5*Ku/il,1])}return $u[2]=Ht,$u[5]=c.x,$u[8]=c.y,$u},o.getImage=Ah,o.getJSON=function(c,l){return sm(xd(c,{type:"json"}),l)},o.getLatitudinalLod=function(c){const l=Hg-5;c=Cd(c,-l,l)/l*90;const d=Math.pow(Math.abs(Math.sin(hh(c))),3);return Math.round(d*(hx.length-1))},o.getMapSessionAPI=Kf,o.getPerformanceMeasurement=Gh,o.getProjection=ME,o.getRTLTextPluginStatus=vt,o.getReferrer=qp,o.getTilePoint=function(c,{x:l,y:d},y=0){return new Zu(((l-y)*c.scale-c.x)*Rp,(d*c.scale-c.y)*Rp)},o.getTileVec3=function(c,l,d=0){return P1(((l.x-d)*c.scale-c.x)*Rp,(l.y*c.scale-c.y)*Rp,Mb(l.z,l.y))},o.getVideo=function(c,l){const d=x.document.createElement("video");d.muted=!0,d.onloadstart=function(){l(null,d)};for(let y=0;y<c.length;y++){const M=x.document.createElement("source");$p(c[y])||(d.crossOrigin="Anonymous"),M.src=c[y],d.appendChild(M)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(c){const l=[0,0,0],d=z0(new Float64Array(16));return d1(d,c.pixelMatrix,c.globeMatrix),Sg(l,l,d),new Zu(l[0],l[1])},o.globeDenormalizeECEF=fx,o.globeECEFOrigin=function(c,l){const d=[0,0,0];return Sg(d,d,N1(x0(l.canonical))),Sg(d,d,c),d},o.globeMetersToEcef=Rx,o.globeNormalizeECEF=N1,o.globePixelsToTileUnits=function(c,l){return Rp/(512*Math.pow(2,c))*$x(x0(l))},o.globePoleMatrixForTile=function(c,l,d){const y=z0(new Float64Array(16)),M=(l/(1<<c)-.5)*Math.PI*2;return A1(y,d.globeMatrix,M),Float32Array.from(y)},o.globeTileBounds=x0,o.globeTiltAtLngLat=gw,o.globeToMercatorTransition=z1,o.globeUseCustomAntiAliasing=function(c,l,d){const y=z1(d.zoom),M=c.style.map._antialias,N=!!l.extStandardDerivatives,q=l.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return y===0&&!M&&!q&&N},o.identity=z0,o.identity$1=vb,o.invert=mb,o.isFullscreen=function(){return!!x.document.fullscreenElement||!!x.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Nx,o.isMapAuthenticated=function(c){return up.has(c)},o.isMapboxURL=Qh,o.isSafariWithAntialiasingBug=function(c){const l=c.navigator?c.navigator.userAgent:null;return!!fd(c)&&l&&(l.match("Version/15.4")||l.match("Version/15.5")||l.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Zg,o.latLngToECEF=_1,o.len=r2,o.length=sx,o.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},o.lngFromMercatorX=Ry,o.loadVectorTile=YE,o.makeRequest=sm,o.mapValue=function(c,l,d,y,M){return Cd((c-l)/(d-l)*(M-y)+y,y,M)},o.mercatorScale=px,o.mercatorXfromLng=uv,o.mercatorYfromLat=F0,o.mercatorZfromAltitude=b0,o.mul=t2,o.mul$1=i2,o.multiply=d1,o.multiply$1=pb,o.multiply$2=uw,o.nextPowerOfTwo=Kd,o.normalize=z_,o.normalize$1=xb,o.normalize$2=r_,o.number=im,o.ortho=function(c,l,d,y,M,N,q){var St=1/(l-d),Ht=1/(y-M),Ui=1/(N-q);return c[0]=-2*St,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*Ht,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*Ui,c[11]=0,c[12]=(l+d)*St,c[13]=(M+y)*Ht,c[14]=(q+N)*Ui,c[15]=1,c},o.pbf=X2,o.perspective=function(c,l,d,y,M){var N,q=1/Math.tan(l/2);return c[0]=q/d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=q,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,M!=null&&M!==1/0?(c[10]=(M+y)*(N=1/(y-M)),c[14]=2*M*y*N):(c[10]=-1,c[14]=-2*y),c},o.pick=function(c,l){const d={};for(let y=0;y<l.length;y++){const M=l[y];M in c&&(d[M]=c[M])}return d},o.plugin=Ur,o.pointGeometry=ch,o.polesInViewport=function(c){const l=z0(new Float64Array(16));d1(l,c.pixelMatrix,c.globeMatrix);const d=[0,yy,0],y=[0,F_,0];return Sg(d,d,l),Sg(y,y,l),[d[0]>0&&d[0]<=c.width&&d[1]>0&&d[1]<=c.height&&!Nx(c,new Bm(c.center.lat,90)),y[0]>0&&y[0]<=c.width&&y[1]>0&&y[1]<=c.height&&!Nx(c,new Bm(c.center.lat,-90))]},o.polygonContainsPoint=x1,o.polygonIntersectsBox=jx,o.polygonIntersectsPolygon=xw,o.polygonizeBounds=function(c,l,d=0,y=!0){const M=new Zu(d,d),N=c.sub(M),q=l.add(M),St=[N,new Zu(q.x,N.y),q,new Zu(N.x,q.y)];return y&&St.push(N.clone()),St},o.posAttributes=sv,o.postMapLoadEvent=td,o.postPerformanceEvent=Zd,o.postTurnstileEvent=Nh,o.potpack=b2,o.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},o.radToDeg=Sh,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(c){return c({pluginStatus:L,pluginURL:u}),Y.on("pluginStateChange",c),c},o.removeAuthState=function(c){up.delete(c)},o.renderColorRamp=Hx,o.resample=yw,o.rotateX=f1,o.rotateX$1=Gm,o.rotateY=A1,o.rotateY$1=Pv,o.rotateZ=function(c,l,d){var y=Math.sin(d),M=Math.cos(d),N=l[0],q=l[1],St=l[2],Ht=l[3],Ui=l[4],Bn=l[5],ls=l[6],il=l[7];return l!==c&&(c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=N*M+Ui*y,c[1]=q*M+Bn*y,c[2]=St*M+ls*y,c[3]=Ht*M+il*y,c[4]=Ui*M-N*y,c[5]=Bn*M-q*y,c[6]=ls*M-St*y,c[7]=il*M-Ht*y,c},o.rotateZ$1=function(c,l,d){d*=.5;var y=l[0],M=l[1],N=l[2],q=l[3],St=Math.sin(d),Ht=Math.cos(d);return c[0]=y*Ht+M*St,c[1]=M*Ht-y*St,c[2]=N*Ht+q*St,c[3]=q*Ht-N*St,c},o.scale=Cv,o.scale$1=D1,o.scale$2=_y,o.scaleAndAdd=cx,o.set=function(c,l,d,y){return c[0]=l,c[1]=d,c[2]=y,c},o.setCacheLimits=function(c,l){Jf=c,Sf=l},o.setColumn=function(c,l,d){c[4*l+0]=d[0],c[4*l+1]=d[1],c[4*l+2]=d[2],c[4*l+3]=d[3]},o.setRTLTextPlugin=function(c,l,d=!1){if(L===_d||L===qh||L===Md)throw new Error("setRTLTextPlugin cannot be called multiple times.");u=zp.resolveURL(c),L=_d,Nd=l,B(),d||mr()},o.smoothstep=Cf,o.spec=Yd,o.squaredLength=function(c){var l=c[0],d=c[1],y=c[2];return l*l+d*d+y*y},o.storeAuthState=function(c,l){l?up.add(c):up.delete(c)},o.sub=v0,o.subtract=_b,o.symbolSize=wx,o.tileAABB=function(c,l,d,y,M,N,q,St,Ht){if(Ht.name==="globe")return R1(c,l,new n_(d,y,M));const Ui=Sx({z:d,x:y,y:M},Ht);return new iy([(N+Ui.x/Ui.scale)*l,l*(Ui.y/Ui.scale),q],[(N+Ui.x2/Ui.scale)*l,l*(Ui.y2/Ui.scale),St])},o.tileCornersToBounds=g1,o.tileTransform=Sx,o.transformMat3=function(c,l,d){var y=l[0],M=l[1],N=l[2];return c[0]=y*d[0]+M*d[3]+N*d[6],c[1]=y*d[1]+M*d[4]+N*d[7],c[2]=y*d[2]+M*d[5]+N*d[8],c},o.transformMat4=Sg,o.transformMat4$1=Av,o.transformQuat=hw,o.transitionTileAABBinECEF=dx,o.translate=ax,o.transpose=function(c,l){if(c===l){var d=l[1],y=l[2],M=l[5];c[1]=l[3],c[2]=l[6],c[3]=d,c[5]=l[7],c[6]=y,c[7]=M}else c[0]=l[0],c[1]=l[3],c[2]=l[6],c[3]=l[1],c[4]=l[4],c[5]=l[7],c[6]=l[2],c[7]=l[5],c[8]=l[8];return c},o.triggerPluginCompletionEvent=E,o.uniqueId=zd,o.updateGlobeVertexNormal=function(c,l,d,y,M){const N=5*l+2;c.float32[N+0]=d,c.float32[N+1]=y,c.float32[N+2]=M},o.validateCustomStyleLayer=function(c){const l=[],d=c.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),c.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},o.validateFilter=c=>B_(g0(c)),o.validateFog=c=>B_(iv(c)),o.validateLayer=c=>B_(o1(c)),o.validateLight=c=>B_(a1(c)),o.validateSource=c=>B_(Gv(c)),o.validateStyle=rv,o.validateTerrain=c=>B_(e0(c)),o.values=Hd,o.vectorTile=Ep,o.version=C,o.warnOnce=Vd,o.window=x,o.wrap=Sd}),s(["./shared"],function(o){function x(Lh){if(typeof Lh=="number"||typeof Lh=="boolean"||typeof Lh=="string"||Lh==null)return JSON.stringify(Lh);if(Array.isArray(Lh)){let ih="[";for(const Ah of Lh)ih+=`${x(Ah)},`;return`${ih}]`}let lh="{";for(const ih of Object.keys(Lh).sort())lh+=`${ih}:${x(Lh[ih])},`;return`${lh}}`}function C(Lh){let lh="";for(const ih of o.refProperties)lh+=`/${x(Lh[ih])}`;return lh}class P{constructor(lh){this.keyCache={},lh&&this.replace(lh)}replace(lh){this._layerConfigs={},this._layers={},this.update(lh,[])}update(lh,ih){for(const zh of lh)this._layerConfigs[zh.id]=zh,(this._layers[zh.id]=o.createStyleLayer(zh)).compileFilter(),this.keyCache[zh.id]&&delete this.keyCache[zh.id];for(const zh of ih)delete this.keyCache[zh],delete this._layerConfigs[zh],delete this._layers[zh];this.familiesBySource={};const Ah=function(zh,Qh){const Th={};for(let al=0;al<zh.length;al++){const fh=Qh&&Qh[zh[al].id]||C(zh[al]);Qh&&(Qh[zh[al].id]=fh);let nl=Th[fh];nl||(nl=Th[fh]=[]),nl.push(zh[al])}const Fh=[];for(const al in Th)Fh.push(Th[al]);return Fh}(o.values(this._layerConfigs),this.keyCache);for(const zh of Ah){const Qh=zh.map(Zs=>this._layers[Zs.id]),Th=Qh[0];if(Th.visibility==="none")continue;const Fh=Th.source||"";let al=this.familiesBySource[Fh];al||(al=this.familiesBySource[Fh]={});const fh=Th.sourceLayer||"_geojsonTileLayer";let nl=al[fh];nl||(nl=al[fh]=[]),nl.push(Qh)}}}class ge{loadTile(lh,ih){const{uid:Ah,encoding:zh,rawImageData:Qh,padding:Th,buildQuadTree:Fh}=lh,al=o.window.ImageBitmap&&Qh instanceof o.window.ImageBitmap?this.getImageData(Qh,Th):Qh;ih(null,new o.DEMData(Ah,al,zh,Th<1,Fh))}getImageData(lh,ih){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(lh.width,lh.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=lh.width,this.offscreenCanvas.height=lh.height,this.offscreenCanvasContext.drawImage(lh,0,0,lh.width,lh.height);const Ah=this.offscreenCanvasContext.getImageData(-ih,-ih,lh.width+2*ih,lh.height+2*ih);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ah}}function nt(Lh,lh){if(Lh.length!==0){ze(Lh[0],lh);for(var ih=1;ih<Lh.length;ih++)ze(Lh[ih],!lh)}}function ze(Lh,lh){for(var ih=0,Ah=0,zh=0,Qh=Lh.length,Th=Qh-1;zh<Qh;Th=zh++){var Fh=(Lh[zh][0]-Lh[Th][0])*(Lh[Th][1]+Lh[zh][1]),al=ih+Fh;Ah+=Math.abs(ih)>=Math.abs(Fh)?ih-al+Fh:Fh-al+ih,ih=al}ih+Ah>=0!=!!lh&&Lh.reverse()}var Bt=o.getDefaultExportFromCjs(function Lh(lh,ih){var Ah,zh=lh&&lh.type;if(zh==="FeatureCollection")for(Ah=0;Ah<lh.features.length;Ah++)Lh(lh.features[Ah],ih);else if(zh==="GeometryCollection")for(Ah=0;Ah<lh.geometries.length;Ah++)Lh(lh.geometries[Ah],ih);else if(zh==="Feature")Lh(lh.geometry,ih);else if(zh==="Polygon")nt(lh.coordinates,ih);else if(zh==="MultiPolygon")for(Ah=0;Ah<lh.coordinates.length;Ah++)nt(lh.coordinates[Ah],ih);return lh});const qr=o.VectorTileFeature.prototype.toGeoJSON;var _n={exports:{}},Fn=o.pointGeometry,tl=o.vectorTile.VectorTileFeature,Io=Co;function Co(Lh,lh){this.options=lh||{},this.features=Lh,this.length=Lh.length}function rl(Lh,lh){this.id=typeof Lh.id=="number"?Lh.id:void 0,this.type=Lh.type,this.rawGeometry=Lh.type===1?[Lh.geometry]:Lh.geometry,this.properties=Lh.tags,this.extent=lh||4096}Co.prototype.feature=function(Lh){return new rl(this.features[Lh],this.options.extent)},rl.prototype.loadGeometry=function(){var Lh=this.rawGeometry;this.geometry=[];for(var lh=0;lh<Lh.length;lh++){for(var ih=Lh[lh],Ah=[],zh=0;zh<ih.length;zh++)Ah.push(new Fn(ih[zh][0],ih[zh][1]));this.geometry.push(Ah)}return this.geometry},rl.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Lh=this.geometry,lh=1/0,ih=-1/0,Ah=1/0,zh=-1/0,Qh=0;Qh<Lh.length;Qh++)for(var Th=Lh[Qh],Fh=0;Fh<Th.length;Fh++){var al=Th[Fh];lh=Math.min(lh,al.x),ih=Math.max(ih,al.x),Ah=Math.min(Ah,al.y),zh=Math.max(zh,al.y)}return[lh,Ah,ih,zh]},rl.prototype.toGeoJSON=tl.prototype.toGeoJSON;var ah=o.pbf,ch=Io;function ju(Lh){var lh=new ah;return function(ih,Ah){for(var zh in ih.layers)Ah.writeMessage(3,Zu,ih.layers[zh])}(Lh,lh),lh.finish()}function Zu(Lh,lh){var ih;lh.writeVarintField(15,Lh.version||1),lh.writeStringField(1,Lh.name||""),lh.writeVarintField(5,Lh.extent||4096);var Ah={keys:[],values:[],keycache:{},valuecache:{}};for(ih=0;ih<Lh.length;ih++)Ah.feature=Lh.feature(ih),lh.writeMessage(2,sl,Ah);var zh=Ah.keys;for(ih=0;ih<zh.length;ih++)lh.writeStringField(3,zh[ih]);var Qh=Ah.values;for(ih=0;ih<Qh.length;ih++)lh.writeMessage(4,hd,Qh[ih])}function sl(Lh,lh){var ih=Lh.feature;ih.id!==void 0&&lh.writeVarintField(1,ih.id),lh.writeMessage(2,oh,Lh),lh.writeVarintField(3,ih.type),lh.writeMessage(4,$h,ih)}function oh(Lh,lh){var ih=Lh.feature,Ah=Lh.keys,zh=Lh.values,Qh=Lh.keycache,Th=Lh.valuecache;for(var Fh in ih.properties){var al=ih.properties[Fh],fh=Qh[Fh];if(al!==null){fh===void 0&&(Ah.push(Fh),Qh[Fh]=fh=Ah.length-1),lh.writeVarint(fh);var nl=typeof al;nl!=="string"&&nl!=="boolean"&&nl!=="number"&&(al=JSON.stringify(al));var Zs=nl+":"+al,ol=Th[Zs];ol===void 0&&(zh.push(al),Th[Zs]=ol=zh.length-1),lh.writeVarint(ol)}}}function hh(Lh,lh){return(lh<<3)+(7&Lh)}function Sh(Lh){return Lh<<1^Lh>>31}function $h(Lh,lh){for(var ih=Lh.loadGeometry(),Ah=Lh.type,zh=0,Qh=0,Th=ih.length,Fh=0;Fh<Th;Fh++){var al=ih[Fh],fh=1;Ah===1&&(fh=al.length),lh.writeVarint(hh(1,fh));for(var nl=Ah===3?al.length-1:al.length,Zs=0;Zs<nl;Zs++){Zs===1&&Ah!==1&&lh.writeVarint(hh(2,nl-1));var ol=al[Zs].x-zh,sh=al[Zs].y-Qh;lh.writeVarint(Sh(ol)),lh.writeVarint(Sh(sh)),zh+=ol,Qh+=sh}Ah===3&&lh.writeVarint(hh(7,1))}}function hd(Lh,lh){var ih=typeof Lh;ih==="string"?lh.writeStringField(1,Lh):ih==="boolean"?lh.writeBooleanField(7,Lh):ih==="number"&&(Lh%1!=0?lh.writeDoubleField(3,Lh):Lh<0?lh.writeSVarintField(6,Lh):lh.writeVarintField(5,Lh))}_n.exports=ju,_n.exports.fromVectorTileJs=ju,_n.exports.fromGeojsonVt=function(Lh,lh){lh=lh||{};var ih={};for(var Ah in Lh)ih[Ah]=new ch(Lh[Ah].features,lh),ih[Ah].name=Ah,ih[Ah].version=lh.version,ih[Ah].extent=lh.extent;return ju({layers:ih})},_n.exports.GeoJSONWrapper=ch;var vd=o.getDefaultExportFromCjs(_n.exports);const Ef={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Lh=>Lh},Cd=Math.fround||(Cf=new Float32Array(1),Lh=>(Cf[0]=+Lh,Cf[0]));var Cf;const Sd=3,yd=5,Hd=6;class xd{constructor(lh){this.options=Object.assign(Object.create(Ef),lh),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(lh){const{log:ih,minZoom:Ah,maxZoom:zh}=this.options;ih&&console.time("total time");const Qh=`prepare ${lh.length} points`;ih&&console.time(Qh),this.points=lh;const Th=[];for(let al=0;al<lh.length;al++){const fh=lh[al];if(!fh.geometry)continue;const[nl,Zs]=fh.geometry.coordinates,ol=Cd(Ld(nl)),sh=Cd(Kd(Zs));Th.push(ol,sh,1/0,al,-1,1),this.options.reduce&&Th.push(0)}let Fh=this.trees[zh+1]=this._createTree(Th);ih&&console.timeEnd(Qh);for(let al=zh;al>=Ah;al--){const fh=+Date.now();Fh=this.trees[al]=this._createTree(this._cluster(Fh,al)),ih&&console.log("z%d: %d clusters in %dms",al,Fh.numItems,+Date.now()-fh)}return ih&&console.timeEnd("total time"),this}getClusters(lh,ih){let Ah=((lh[0]+180)%360+360)%360-180;const zh=Math.max(-90,Math.min(90,lh[1]));let Qh=lh[2]===180?180:((lh[2]+180)%360+360)%360-180;const Th=Math.max(-90,Math.min(90,lh[3]));if(lh[2]-lh[0]>=360)Ah=-180,Qh=180;else if(Ah>Qh){const Zs=this.getClusters([Ah,zh,180,Th],ih),ol=this.getClusters([-180,zh,Qh,Th],ih);return Zs.concat(ol)}const Fh=this.trees[this._limitZoom(ih)],al=Fh.range(Ld(Ah),Kd(Th),Ld(Qh),Kd(zh)),fh=Fh.data,nl=[];for(const Zs of al){const ol=this.stride*Zs;nl.push(fh[ol+yd]>1?Pd(fh,ol,this.clusterProps):this.points[fh[ol+Sd]])}return nl}getChildren(lh){const ih=this._getOriginId(lh),Ah=this._getOriginZoom(lh),zh="No cluster with the specified id.",Qh=this.trees[Ah];if(!Qh)throw new Error(zh);const Th=Qh.data;if(ih*this.stride>=Th.length)throw new Error(zh);const Fh=this.options.radius/(this.options.extent*Math.pow(2,Ah-1)),al=Qh.within(Th[ih*this.stride],Th[ih*this.stride+1],Fh),fh=[];for(const nl of al){const Zs=nl*this.stride;Th[Zs+4]===lh&&fh.push(Th[Zs+yd]>1?Pd(Th,Zs,this.clusterProps):this.points[Th[Zs+Sd]])}if(fh.length===0)throw new Error(zh);return fh}getLeaves(lh,ih,Ah){const zh=[];return this._appendLeaves(zh,lh,ih=ih||10,Ah=Ah||0,0),zh}getTile(lh,ih,Ah){const zh=this.trees[this._limitZoom(lh)],Qh=Math.pow(2,lh),{extent:Th,radius:Fh}=this.options,al=Fh/Th,fh=(Ah-al)/Qh,nl=(Ah+1+al)/Qh,Zs={features:[]};return this._addTileFeatures(zh.range((ih-al)/Qh,fh,(ih+1+al)/Qh,nl),zh.data,ih,Ah,Qh,Zs),ih===0&&this._addTileFeatures(zh.range(1-al/Qh,fh,1,nl),zh.data,Qh,Ah,Qh,Zs),ih===Qh-1&&this._addTileFeatures(zh.range(0,fh,al/Qh,nl),zh.data,-1,Ah,Qh,Zs),Zs.features.length?Zs:null}getClusterExpansionZoom(lh){let ih=this._getOriginZoom(lh)-1;for(;ih<=this.options.maxZoom;){const Ah=this.getChildren(lh);if(ih++,Ah.length!==1)break;lh=Ah[0].properties.cluster_id}return ih}_appendLeaves(lh,ih,Ah,zh,Qh){const Th=this.getChildren(ih);for(const Fh of Th){const al=Fh.properties;if(al&&al.cluster?Qh+al.point_count<=zh?Qh+=al.point_count:Qh=this._appendLeaves(lh,al.cluster_id,Ah,zh,Qh):Qh<zh?Qh++:lh.push(Fh),lh.length===Ah)break}return Qh}_createTree(lh){const ih=new o.KDBush(lh.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ah=0;Ah<lh.length;Ah+=this.stride)ih.add(lh[Ah],lh[Ah+1]);return ih.finish(),ih.data=lh,ih}_addTileFeatures(lh,ih,Ah,zh,Qh,Th){for(const Fh of lh){const al=Fh*this.stride,fh=ih[al+yd]>1;let nl,Zs,ol;if(fh)nl=zd(ih,al,this.clusterProps),Zs=ih[al],ol=ih[al+1];else{const Mh=this.points[ih[al+Sd]];nl=Mh.properties;const[Uh,Nh]=Mh.geometry.coordinates;Zs=Ld(Uh),ol=Kd(Nh)}const sh={type:1,geometry:[[Math.round(this.options.extent*(Zs*Qh-Ah)),Math.round(this.options.extent*(ol*Qh-zh))]],tags:nl};let xh;xh=fh||this.options.generateId?ih[al+Sd]:this.points[ih[al+Sd]].id,xh!==void 0&&(sh.id=xh),Th.features.push(sh)}}_limitZoom(lh){return Math.max(this.options.minZoom,Math.min(Math.floor(+lh),this.options.maxZoom+1))}_cluster(lh,ih){const{radius:Ah,extent:zh,reduce:Qh,minPoints:Th}=this.options,Fh=Ah/(zh*Math.pow(2,ih)),al=lh.data,fh=[],nl=this.stride;for(let Zs=0;Zs<al.length;Zs+=nl){if(al[Zs+2]<=ih)continue;al[Zs+2]=ih;const ol=al[Zs],sh=al[Zs+1],xh=lh.within(al[Zs],al[Zs+1],Fh),Mh=al[Zs+yd];let Uh=Mh;for(const Nh of xh){const Zh=Nh*nl;al[Zh+2]>ih&&(Uh+=al[Zh+yd])}if(Uh>Mh&&Uh>=Th){let Nh,Zh=ol*Mh,td=sh*Mh,Ad=-1;const Zd=((Zs/nl|0)<<5)+(ih+1)+this.points.length;for(const Fd of xh){const Kf=Fd*nl;if(al[Kf+2]<=ih)continue;al[Kf+2]=ih;const up=al[Kf+yd];Zh+=al[Kf]*up,td+=al[Kf+1]*up,al[Kf+4]=Zd,Qh&&(Nh||(Nh=this._map(al,Zs,!0),Ad=this.clusterProps.length,this.clusterProps.push(Nh)),Qh(Nh,this._map(al,Kf)))}al[Zs+4]=Zd,fh.push(Zh/Uh,td/Uh,1/0,Zd,-1,Uh),Qh&&fh.push(Ad)}else{for(let Nh=0;Nh<nl;Nh++)fh.push(al[Zs+Nh]);if(Uh>1)for(const Nh of xh){const Zh=Nh*nl;if(!(al[Zh+2]<=ih)){al[Zh+2]=ih;for(let td=0;td<nl;td++)fh.push(al[Zh+td])}}}}return fh}_getOriginId(lh){return lh-this.points.length>>5}_getOriginZoom(lh){return(lh-this.points.length)%32}_map(lh,ih,Ah){if(lh[ih+yd]>1){const Th=this.clusterProps[lh[ih+Hd]];return Ah?Object.assign({},Th):Th}const zh=this.points[lh[ih+Sd]].properties,Qh=this.options.map(zh);return Ah&&Qh===zh?Object.assign({},Qh):Qh}}function Pd(Lh,lh,ih){return{type:"Feature",id:Lh[lh+Sd],properties:zd(Lh,lh,ih),geometry:{type:"Point",coordinates:[(Ah=Lh[lh],360*(Ah-.5)),wf(Lh[lh+1])]}};var Ah}function zd(Lh,lh,ih){const Ah=Lh[lh+yd],zh=Ah>=1e4?`${Math.round(Ah/1e3)}k`:Ah>=1e3?Math.round(Ah/100)/10+"k":Ah,Qh=Lh[lh+Hd],Th=Qh===-1?{}:Object.assign({},ih[Qh]);return Object.assign(Th,{cluster:!0,cluster_id:Lh[lh+Sd],point_count:Ah,point_count_abbreviated:zh})}function Ld(Lh){return Lh/360+.5}function Kd(Lh){const lh=Math.sin(Lh*Math.PI/180),ih=.5-.25*Math.log((1+lh)/(1-lh))/Math.PI;return ih<0?0:ih>1?1:ih}function wf(Lh){const lh=(180-360*Lh)*Math.PI/180;return 360*Math.atan(Math.exp(lh))/Math.PI-90}function kd(Lh,lh,ih,Ah){for(var zh,Qh=Ah,Th=ih-lh>>1,Fh=ih-lh,al=Lh[lh],fh=Lh[lh+1],nl=Lh[ih],Zs=Lh[ih+1],ol=lh+3;ol<ih;ol+=3){var sh=cd(Lh[ol],Lh[ol+1],al,fh,nl,Zs);if(sh>Qh)zh=ol,Qh=sh;else if(sh===Qh){var xh=Math.abs(ol-Th);xh<Fh&&(zh=ol,Fh=xh)}}Qh>Ah&&(zh-lh>3&&kd(Lh,lh,zh,Ah),Lh[zh+2]=Qh,ih-zh>3&&kd(Lh,zh,ih,Ah))}function cd(Lh,lh,ih,Ah,zh,Qh){var Th=zh-ih,Fh=Qh-Ah;if(Th!==0||Fh!==0){var al=((Lh-ih)*Th+(lh-Ah)*Fh)/(Th*Th+Fh*Fh);al>1?(ih=zh,Ah=Qh):al>0&&(ih+=Th*al,Ah+=Fh*al)}return(Th=Lh-ih)*Th+(Fh=lh-Ah)*Fh}function gd(Lh,lh,ih,Ah){var zh={id:Lh===void 0?null:Lh,type:lh,geometry:ih,tags:Ah,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Qh){var Th=Qh.geometry,Fh=Qh.type;if(Fh==="Point"||Fh==="MultiPoint"||Fh==="LineString")bp(Qh,Th);else if(Fh==="Polygon"||Fh==="MultiLineString")for(var al=0;al<Th.length;al++)bp(Qh,Th[al]);else if(Fh==="MultiPolygon")for(al=0;al<Th.length;al++)for(var fh=0;fh<Th[al].length;fh++)bp(Qh,Th[al][fh])}(zh),zh}function bp(Lh,lh){for(var ih=0;ih<lh.length;ih+=3)Lh.minX=Math.min(Lh.minX,lh[ih]),Lh.minY=Math.min(Lh.minY,lh[ih+1]),Lh.maxX=Math.max(Lh.maxX,lh[ih]),Lh.maxY=Math.max(Lh.maxY,lh[ih+1])}function Uf(Lh,lh,ih,Ah){if(lh.geometry){var zh=lh.geometry.coordinates,Qh=lh.geometry.type,Th=Math.pow(ih.tolerance/((1<<ih.maxZoom)*ih.extent),2),Fh=[],al=lh.id;if(ih.promoteId?al=lh.properties[ih.promoteId]:ih.generateId&&(al=Ah||0),Qh==="Point")qd(zh,Fh);else if(Qh==="MultiPoint")for(var fh=0;fh<zh.length;fh++)qd(zh[fh],Fh);else if(Qh==="LineString")Vd(zh,Fh,Th,!1);else if(Qh==="MultiLineString"){if(ih.lineMetrics){for(fh=0;fh<zh.length;fh++)Vd(zh[fh],Fh=[],Th,!1),Lh.push(gd(al,"LineString",Fh,lh.properties));return}ep(zh,Fh,Th,!1)}else if(Qh==="Polygon")ep(zh,Fh,Th,!0);else{if(Qh!=="MultiPolygon"){if(Qh==="GeometryCollection"){for(fh=0;fh<lh.geometry.geometries.length;fh++)Uf(Lh,{id:al,geometry:lh.geometry.geometries[fh],properties:lh.properties},ih,Ah);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fh=0;fh<zh.length;fh++){var nl=[];ep(zh[fh],nl,Th,!0),Fh.push(nl)}}Lh.push(gd(al,Qh,Fh,lh.properties))}}function qd(Lh,lh){lh.push(_p(Lh[0])),lh.push(lp(Lh[1])),lh.push(0)}function Vd(Lh,lh,ih,Ah){for(var zh,Qh,Th=0,Fh=0;Fh<Lh.length;Fh++){var al=_p(Lh[Fh][0]),fh=lp(Lh[Fh][1]);lh.push(al),lh.push(fh),lh.push(0),Fh>0&&(Th+=Ah?(zh*fh-al*Qh)/2:Math.sqrt(Math.pow(al-zh,2)+Math.pow(fh-Qh,2))),zh=al,Qh=fh}var nl=lh.length-3;lh[2]=1,kd(lh,0,nl,ih),lh[nl+2]=1,lh.size=Math.abs(Th),lh.start=0,lh.end=lh.size}function ep(Lh,lh,ih,Ah){for(var zh=0;zh<Lh.length;zh++){var Qh=[];Vd(Lh[zh],Qh,ih,Ah),lh.push(Qh)}}function _p(Lh){return Lh/360+.5}function lp(Lh){var lh=Math.sin(Lh*Math.PI/180),ih=.5-.25*Math.log((1+lh)/(1-lh))/Math.PI;return ih<0?0:ih>1?1:ih}function Kh(Lh,lh,ih,Ah,zh,Qh,Th,Fh){if(Ah/=lh,Qh>=(ih/=lh)&&Th<Ah)return Lh;if(Th<ih||Qh>=Ah)return null;for(var al=[],fh=0;fh<Lh.length;fh++){var nl=Lh[fh],Zs=nl.geometry,ol=nl.type,sh=zh===0?nl.minX:nl.minY,xh=zh===0?nl.maxX:nl.maxY;if(sh>=ih&&xh<Ah)al.push(nl);else if(!(xh<ih||sh>=Ah)){var Mh=[];if(ol==="Point"||ol==="MultiPoint")Qd(Zs,Mh,ih,Ah,zh);else if(ol==="LineString")fd(Zs,Mh,ih,Ah,zh,!1,Fh.lineMetrics);else if(ol==="MultiLineString")Yh(Zs,Mh,ih,Ah,zh,!1);else if(ol==="Polygon")Yh(Zs,Mh,ih,Ah,zh,!0);else if(ol==="MultiPolygon")for(var Uh=0;Uh<Zs.length;Uh++){var Nh=[];Yh(Zs[Uh],Nh,ih,Ah,zh,!0),Nh.length&&Mh.push(Nh)}if(Mh.length){if(Fh.lineMetrics&&ol==="LineString"){for(Uh=0;Uh<Mh.length;Uh++)al.push(gd(nl.id,ol,Mh[Uh],nl.tags));continue}ol!=="LineString"&&ol!=="MultiLineString"||(Mh.length===1?(ol="LineString",Mh=Mh[0]):ol="MultiLineString"),ol!=="Point"&&ol!=="MultiPoint"||(ol=Mh.length===3?"Point":"MultiPoint"),al.push(gd(nl.id,ol,Mh,nl.tags))}}}return al.length?al:null}function Qd(Lh,lh,ih,Ah,zh){for(var Qh=0;Qh<Lh.length;Qh+=3){var Th=Lh[Qh+zh];Th>=ih&&Th<=Ah&&(lh.push(Lh[Qh]),lh.push(Lh[Qh+1]),lh.push(Lh[Qh+2]))}}function fd(Lh,lh,ih,Ah,zh,Qh,Th){for(var Fh,al,fh=Jd(Lh),nl=zh===0?Jf:Sf,Zs=Lh.start,ol=0;ol<Lh.length-3;ol+=3){var sh=Lh[ol],xh=Lh[ol+1],Mh=Lh[ol+2],Uh=Lh[ol+3],Nh=Lh[ol+4],Zh=zh===0?sh:xh,td=zh===0?Uh:Nh,Ad=!1;Th&&(Fh=Math.sqrt(Math.pow(sh-Uh,2)+Math.pow(xh-Nh,2))),Zh<ih?td>ih&&(al=nl(fh,sh,xh,Uh,Nh,ih),Th&&(fh.start=Zs+Fh*al)):Zh>Ah?td<Ah&&(al=nl(fh,sh,xh,Uh,Nh,Ah),Th&&(fh.start=Zs+Fh*al)):$d(fh,sh,xh,Mh),td<ih&&Zh>=ih&&(al=nl(fh,sh,xh,Uh,Nh,ih),Ad=!0),td>Ah&&Zh<=Ah&&(al=nl(fh,sh,xh,Uh,Nh,Ah),Ad=!0),!Qh&&Ad&&(Th&&(fh.end=Zs+Fh*al),lh.push(fh),fh=Jd(Lh)),Th&&(Zs+=Fh)}var Zd=Lh.length-3;sh=Lh[Zd],xh=Lh[Zd+1],Mh=Lh[Zd+2],(Zh=zh===0?sh:xh)>=ih&&Zh<=Ah&&$d(fh,sh,xh,Mh),Zd=fh.length-3,Qh&&Zd>=3&&(fh[Zd]!==fh[0]||fh[Zd+1]!==fh[1])&&$d(fh,fh[0],fh[1],fh[2]),fh.length&&lh.push(fh)}function Jd(Lh){var lh=[];return lh.size=Lh.size,lh.start=Lh.start,lh.end=Lh.end,lh}function Yh(Lh,lh,ih,Ah,zh,Qh){for(var Th=0;Th<Lh.length;Th++)fd(Lh[Th],lh,ih,Ah,zh,Qh,!1)}function $d(Lh,lh,ih,Ah){Lh.push(lh),Lh.push(ih),Lh.push(Ah)}function Jf(Lh,lh,ih,Ah,zh,Qh){var Th=(Qh-lh)/(Ah-lh);return Lh.push(Qh),Lh.push(ih+(zh-ih)*Th),Lh.push(1),Th}function Sf(Lh,lh,ih,Ah,zh,Qh){var Th=(Qh-ih)/(zh-ih);return Lh.push(lh+(Ah-lh)*Th),Lh.push(Qh),Lh.push(1),Th}function If(Lh,lh){for(var ih=[],Ah=0;Ah<Lh.length;Ah++){var zh,Qh=Lh[Ah],Th=Qh.type;if(Th==="Point"||Th==="MultiPoint"||Th==="LineString")zh=Xf(Qh.geometry,lh);else if(Th==="MultiLineString"||Th==="Polygon"){zh=[];for(var Fh=0;Fh<Qh.geometry.length;Fh++)zh.push(Xf(Qh.geometry[Fh],lh))}else if(Th==="MultiPolygon")for(zh=[],Fh=0;Fh<Qh.geometry.length;Fh++){for(var al=[],fh=0;fh<Qh.geometry[Fh].length;fh++)al.push(Xf(Qh.geometry[Fh][fh],lh));zh.push(al)}ih.push(gd(Qh.id,Th,zh,Qh.tags))}return ih}function Xf(Lh,lh){var ih=[];ih.size=Lh.size,Lh.start!==void 0&&(ih.start=Lh.start,ih.end=Lh.end);for(var Ah=0;Ah<Lh.length;Ah+=3)ih.push(Lh[Ah]+lh,Lh[Ah+1],Lh[Ah+2]);return ih}function Of(Lh,lh){if(Lh.transformed)return Lh;var ih,Ah,zh,Qh=1<<Lh.z,Th=Lh.x,Fh=Lh.y;for(ih=0;ih<Lh.features.length;ih++){var al=Lh.features[ih],fh=al.geometry,nl=al.type;if(al.geometry=[],nl===1)for(Ah=0;Ah<fh.length;Ah+=2)al.geometry.push(jf(fh[Ah],fh[Ah+1],lh,Qh,Th,Fh));else for(Ah=0;Ah<fh.length;Ah++){var Zs=[];for(zh=0;zh<fh[Ah].length;zh+=2)Zs.push(jf(fh[Ah][zh],fh[Ah][zh+1],lh,Qh,Th,Fh));al.geometry.push(Zs)}}return Lh.transformed=!0,Lh}function jf(Lh,lh,ih,Ah,zh,Qh){return[Math.round(ih*(Lh*Ah-zh)),Math.round(ih*(lh*Ah-Qh))]}function Ap(Lh,lh,ih,Ah,zh){for(var Qh=lh===zh.maxZoom?0:zh.tolerance/((1<<lh)*zh.extent),Th={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ih,y:Ah,z:lh,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fh=0;Fh<Lh.length;Fh++){Th.numFeatures++,vp(Th,Lh[Fh],Qh,zh);var al=Lh[Fh].minX,fh=Lh[Fh].minY,nl=Lh[Fh].maxX,Zs=Lh[Fh].maxY;al<Th.minX&&(Th.minX=al),fh<Th.minY&&(Th.minY=fh),nl>Th.maxX&&(Th.maxX=nl),Zs>Th.maxY&&(Th.maxY=Zs)}return Th}function vp(Lh,lh,ih,Ah){var zh=lh.geometry,Qh=lh.type,Th=[];if(Qh==="Point"||Qh==="MultiPoint")for(var Fh=0;Fh<zh.length;Fh+=3)Th.push(zh[Fh]),Th.push(zh[Fh+1]),Lh.numPoints++,Lh.numSimplified++;else if(Qh==="LineString")Tp(Th,zh,Lh,ih,!1,!1);else if(Qh==="MultiLineString"||Qh==="Polygon")for(Fh=0;Fh<zh.length;Fh++)Tp(Th,zh[Fh],Lh,ih,Qh==="Polygon",Fh===0);else if(Qh==="MultiPolygon")for(var al=0;al<zh.length;al++){var fh=zh[al];for(Fh=0;Fh<fh.length;Fh++)Tp(Th,fh[Fh],Lh,ih,!0,Fh===0)}if(Th.length){var nl=lh.tags||null;if(Qh==="LineString"&&Ah.lineMetrics){for(var Zs in nl={},lh.tags)nl[Zs]=lh.tags[Zs];nl.mapbox_clip_start=zh.start/zh.size,nl.mapbox_clip_end=zh.end/zh.size}var ol={geometry:Th,type:Qh==="Polygon"||Qh==="MultiPolygon"?3:Qh==="LineString"||Qh==="MultiLineString"?2:1,tags:nl};lh.id!==null&&(ol.id=lh.id),Lh.features.push(ol)}}function Tp(Lh,lh,ih,Ah,zh,Qh){var Th=Ah*Ah;if(Ah>0&&lh.size<(zh?Th:Ah))ih.numPoints+=lh.length/3;else{for(var Fh=[],al=0;al<lh.length;al+=3)(Ah===0||lh[al+2]>Th)&&(ih.numSimplified++,Fh.push(lh[al]),Fh.push(lh[al+1])),ih.numPoints++;zh&&function(fh,nl){for(var Zs=0,ol=0,sh=fh.length,xh=sh-2;ol<sh;xh=ol,ol+=2)Zs+=(fh[ol]-fh[xh])*(fh[ol+1]+fh[xh+1]);if(Zs>0===nl)for(ol=0,sh=fh.length;ol<sh/2;ol+=2){var Mh=fh[ol],Uh=fh[ol+1];fh[ol]=fh[sh-2-ol],fh[ol+1]=fh[sh-1-ol],fh[sh-2-ol]=Mh,fh[sh-1-ol]=Uh}}(Fh,Qh),Lh.push(Fh)}}function Zf(Lh,lh){var ih=(lh=this.options=function(zh,Qh){for(var Th in Qh)zh[Th]=Qh[Th];return zh}(Object.create(this.options),lh)).debug;if(ih&&console.time("preprocess data"),lh.maxZoom<0||lh.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lh.promoteId&&lh.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ah=function(zh,Qh){var Th=[];if(zh.type==="FeatureCollection")for(var Fh=0;Fh<zh.features.length;Fh++)Uf(Th,zh.features[Fh],Qh,Fh);else Uf(Th,zh.type==="Feature"?zh:{geometry:zh},Qh);return Th}(Lh,lh);this.tiles={},this.tileCoords=[],ih&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lh.indexMaxZoom,lh.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ah=function(zh,Qh){var Th=Qh.buffer/Qh.extent,Fh=zh,al=Kh(zh,1,-1-Th,Th,0,-1,2,Qh),fh=Kh(zh,1,1-Th,2+Th,0,-1,2,Qh);return(al||fh)&&(Fh=Kh(zh,1,-Th,1+Th,0,-1,2,Qh)||[],al&&(Fh=If(al,1).concat(Fh)),fh&&(Fh=Fh.concat(If(fh,-1)))),Fh}(Ah,lh),Ah.length&&this.splitTile(Ah,0,0,0),ih&&(Ah.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function qp(Lh,lh,ih){return 32*((1<<Lh)*ih+lh)+Lh}function sm(Lh,lh){const ih=Lh.tileID.canonical;if(!this._geoJSONIndex)return lh(null,null);const Ah=this._geoJSONIndex.getTile(ih.z,ih.x,ih.y);if(!Ah)return lh(null,null);const zh=new class{constructor(Th){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Th.length,this._features=Th}feature(Th){return new class{constructor(Fh){this._feature=Fh,this.extent=o.EXTENT,this.type=Fh.type,this.properties=Fh.tags,"id"in Fh&&!isNaN(Fh.id)&&(this.id=parseInt(Fh.id,10))}loadGeometry(){if(this._feature.type===1){const Fh=[];for(const al of this._feature.geometry)Fh.push([new o.Point(al[0],al[1])]);return Fh}{const Fh=[];for(const al of this._feature.geometry){const fh=[];for(const nl of al)fh.push(new o.Point(nl[0],nl[1]));Fh.push(fh)}return Fh}}toGeoJSON(Fh,al,fh){return qr.call(this,Fh,al,fh)}}(this._features[Th])}}(Ah.features);let Qh=vd(zh);Qh.byteOffset===0&&Qh.byteLength===Qh.buffer.byteLength||(Qh=new Uint8Array(Qh)),lh(null,{vectorTile:zh,rawData:Qh.buffer})}Zf.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zf.prototype.splitTile=function(Lh,lh,ih,Ah,zh,Qh,Th){for(var Fh=[Lh,lh,ih,Ah],al=this.options,fh=al.debug;Fh.length;){Ah=Fh.pop(),ih=Fh.pop(),lh=Fh.pop(),Lh=Fh.pop();var nl=1<<lh,Zs=qp(lh,ih,Ah),ol=this.tiles[Zs];if(!ol&&(fh>1&&console.time("creation"),ol=this.tiles[Zs]=Ap(Lh,lh,ih,Ah,al),this.tileCoords.push({z:lh,x:ih,y:Ah}),fh)){fh>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lh,ih,Ah,ol.numFeatures,ol.numPoints,ol.numSimplified),console.timeEnd("creation"));var sh="z"+lh;this.stats[sh]=(this.stats[sh]||0)+1,this.total++}if(ol.source=Lh,zh){if(lh===al.maxZoom||lh===zh)continue;var xh=1<<zh-lh;if(ih!==Math.floor(Qh/xh)||Ah!==Math.floor(Th/xh))continue}else if(lh===al.indexMaxZoom||ol.numPoints<=al.indexMaxPoints)continue;if(ol.source=null,Lh.length!==0){fh>1&&console.time("clipping");var Mh,Uh,Nh,Zh,td,Ad,Zd=.5*al.buffer/al.extent,Fd=.5-Zd,Kf=.5+Zd,up=1+Zd;Mh=Uh=Nh=Zh=null,td=Kh(Lh,nl,ih-Zd,ih+Kf,0,ol.minX,ol.maxX,al),Ad=Kh(Lh,nl,ih+Fd,ih+up,0,ol.minX,ol.maxX,al),Lh=null,td&&(Mh=Kh(td,nl,Ah-Zd,Ah+Kf,1,ol.minY,ol.maxY,al),Uh=Kh(td,nl,Ah+Fd,Ah+up,1,ol.minY,ol.maxY,al),td=null),Ad&&(Nh=Kh(Ad,nl,Ah-Zd,Ah+Kf,1,ol.minY,ol.maxY,al),Zh=Kh(Ad,nl,Ah+Fd,Ah+up,1,ol.minY,ol.maxY,al),Ad=null),fh>1&&console.timeEnd("clipping"),Fh.push(Mh||[],lh+1,2*ih,2*Ah),Fh.push(Uh||[],lh+1,2*ih,2*Ah+1),Fh.push(Nh||[],lh+1,2*ih+1,2*Ah),Fh.push(Zh||[],lh+1,2*ih+1,2*Ah+1)}}},Zf.prototype.getTile=function(Lh,lh,ih){var Ah=this.options,zh=Ah.extent,Qh=Ah.debug;if(Lh<0||Lh>24)return null;var Th=1<<Lh,Fh=qp(Lh,lh=(lh%Th+Th)%Th,ih);if(this.tiles[Fh])return Of(this.tiles[Fh],zh);Qh>1&&console.log("drilling down to z%d-%d-%d",Lh,lh,ih);for(var al,fh=Lh,nl=lh,Zs=ih;!al&&fh>0;)fh--,nl=Math.floor(nl/2),Zs=Math.floor(Zs/2),al=this.tiles[qp(fh,nl,Zs)];return al&&al.source?(Qh>1&&console.log("found parent tile z%d-%d-%d",fh,nl,Zs),Qh>1&&console.time("drilling down"),this.splitTile(al.source,fh,nl,Zs,Lh,lh,ih),Qh>1&&console.timeEnd("drilling down"),this.tiles[Fh]?Of(this.tiles[Fh],zh):null):null};class Wd extends o.VectorTileWorkerSource{constructor(lh,ih,Ah,zh,Qh){super(lh,ih,Ah,zh,sm),Qh&&(this.loadGeoJSON=Qh)}loadData(lh,ih){const Ah=lh&&lh.request,zh=Ah&&Ah.collectResourceTiming;this.loadGeoJSON(lh,(Qh,Th)=>{if(Qh||!Th)return ih(Qh);if(typeof Th!="object")return ih(new Error(`Input data given to '${lh.source}' is not a valid GeoJSON object.`));{Bt(Th,!0);try{if(lh.filter){const al=o.createExpression(lh.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(al.result==="error")throw new Error(al.value.map(nl=>`${nl.key}: ${nl.message}`).join(", "));Th={type:"FeatureCollection",features:Th.features.filter(nl=>al.value.evaluate({zoom:0},nl))}}this._geoJSONIndex=lh.cluster?new xd(function({superclusterOptions:al,clusterProperties:fh}){if(!fh||!al)return al;const nl={},Zs={},ol={accumulated:null,zoom:0},sh={properties:null},xh=Object.keys(fh);for(const Mh of xh){const[Uh,Nh]=fh[Mh],Zh=o.createExpression(Nh),td=o.createExpression(typeof Uh=="string"?[Uh,["accumulated"],["get",Mh]]:Uh);nl[Mh]=Zh.value,Zs[Mh]=td.value}return al.map=Mh=>{sh.properties=Mh;const Uh={};for(const Nh of xh)Uh[Nh]=nl[Nh].evaluate(ol,sh);return Uh},al.reduce=(Mh,Uh)=>{sh.properties=Uh;for(const Nh of xh)ol.accumulated=Mh[Nh],Mh[Nh]=Zs[Nh].evaluate(ol,sh)},al}(lh)).load(Th.features):function(al,fh){return new Zf(al,fh)}(Th,lh.geojsonVtOptions)}catch(al){return ih(al)}this.loaded={};const Fh={};if(zh){const al=o.getPerformanceMeasurement(Ah);al&&(Fh.resourceTiming={},Fh.resourceTiming[lh.source]=JSON.parse(JSON.stringify(al)))}ih(null,Fh)}})}reloadTile(lh,ih){const Ah=this.loaded;return Ah&&Ah[lh.uid]?super.reloadTile(lh,ih):this.loadTile(lh,ih)}loadGeoJSON(lh,ih){if(lh.request)o.getJSON(lh.request,ih);else{if(typeof lh.data!="string")return ih(new Error(`Input data given to '${lh.source}' is not a valid GeoJSON object.`));try{return ih(null,JSON.parse(lh.data))}catch{return ih(new Error(`Input data given to '${lh.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(lh,ih){try{ih(null,this._geoJSONIndex.getClusterExpansionZoom(lh.clusterId))}catch(Ah){ih(Ah)}}getClusterChildren(lh,ih){try{ih(null,this._geoJSONIndex.getChildren(lh.clusterId))}catch(Ah){ih(Ah)}}getClusterLeaves(lh,ih){try{ih(null,this._geoJSONIndex.getLeaves(lh.clusterId,lh.limit,lh.offset))}catch(Ah){ih(Ah)}}}class $p{constructor(lh){this.self=lh,this.actor=new o.Actor(lh,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Wd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ih,Ah)=>{if(this.workerSourceTypes[ih])throw new Error(`Worker source with name "${ih}" already registered.`);this.workerSourceTypes[ih]=Ah},this.self.registerRTLTextPlugin=ih=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ih.applyArabicShaping,o.plugin.processBidirectionalText=ih.processBidirectionalText,o.plugin.processStyledBidirectionalText=ih.processStyledBidirectionalText}}clearCaches(lh,ih,Ah){delete this.layerIndexes[lh],delete this.availableImages[lh],delete this.workerSources[lh],delete this.demWorkerSources[lh],Ah()}checkIfReady(lh,ih,Ah){Ah()}setReferrer(lh,ih){this.referrer=ih}spriteLoaded(lh,ih){this.isSpriteLoaded[lh]=ih;for(const Ah in this.workerSources[lh]){const zh=this.workerSources[lh][Ah];for(const Qh in zh)zh[Qh]instanceof o.VectorTileWorkerSource&&(zh[Qh].isSpriteLoaded=ih,zh[Qh].fire(new o.Event("isSpriteLoaded")))}}setImages(lh,ih,Ah){this.availableImages[lh]=ih;for(const zh in this.workerSources[lh]){const Qh=this.workerSources[lh][zh];for(const Th in Qh)Qh[Th].availableImages=ih}Ah()}enableTerrain(lh,ih,Ah){this.terrain=ih,Ah()}setProjection(lh,ih){this.projections[lh]=o.getProjection(ih)}setLayers(lh,ih,Ah){this.getLayerIndex(lh).replace(ih),Ah()}updateLayers(lh,ih,Ah){this.getLayerIndex(lh).update(ih.layers,ih.removedIds),Ah()}loadTile(lh,ih,Ah){const zh=this.enableTerrain?o.extend({enableTerrain:this.terrain},ih):ih;zh.projection=this.projections[lh]||this.defaultProjection,this.getWorkerSource(lh,ih.type,ih.source).loadTile(zh,Ah)}loadDEMTile(lh,ih,Ah){const zh=this.enableTerrain?o.extend({buildQuadTree:this.terrain},ih):ih;this.getDEMWorkerSource(lh,ih.source).loadTile(zh,Ah)}reloadTile(lh,ih,Ah){const zh=this.enableTerrain?o.extend({enableTerrain:this.terrain},ih):ih;zh.projection=this.projections[lh]||this.defaultProjection,this.getWorkerSource(lh,ih.type,ih.source).reloadTile(zh,Ah)}abortTile(lh,ih,Ah){this.getWorkerSource(lh,ih.type,ih.source).abortTile(ih,Ah)}removeTile(lh,ih,Ah){this.getWorkerSource(lh,ih.type,ih.source).removeTile(ih,Ah)}removeSource(lh,ih,Ah){if(!this.workerSources[lh]||!this.workerSources[lh][ih.type]||!this.workerSources[lh][ih.type][ih.source])return;const zh=this.workerSources[lh][ih.type][ih.source];delete this.workerSources[lh][ih.type][ih.source],zh.removeSource!==void 0?zh.removeSource(ih,Ah):Ah()}loadWorkerSource(lh,ih,Ah){try{this.self.importScripts(ih.url),Ah()}catch(zh){Ah(zh.toString())}}syncRTLPluginState(lh,ih,Ah){try{o.plugin.setState(ih);const zh=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&zh!=null){this.self.importScripts(zh);const Qh=o.plugin.isParsed();Ah(Qh?void 0:new Error(`RTL Text Plugin failed to import scripts from ${zh}`),Qh)}}catch(zh){Ah(zh.toString())}}getAvailableImages(lh){let ih=this.availableImages[lh];return ih||(ih=[]),ih}getLayerIndex(lh){let ih=this.layerIndexes[lh];return ih||(ih=this.layerIndexes[lh]=new P),ih}getWorkerSource(lh,ih,Ah){if(this.workerSources[lh]||(this.workerSources[lh]={}),this.workerSources[lh][ih]||(this.workerSources[lh][ih]={}),!this.workerSources[lh][ih][Ah]){const zh={send:(Qh,Th,Fh,al,fh,nl)=>{this.actor.send(Qh,Th,Fh,lh,fh,nl)},scheduler:this.actor.scheduler};this.workerSources[lh][ih][Ah]=new this.workerSourceTypes[ih](zh,this.getLayerIndex(lh),this.getAvailableImages(lh),this.isSpriteLoaded[lh])}return this.workerSources[lh][ih][Ah]}getDEMWorkerSource(lh,ih){return this.demWorkerSources[lh]||(this.demWorkerSources[lh]={}),this.demWorkerSources[lh][ih]||(this.demWorkerSources[lh][ih]=new ge),this.demWorkerSources[lh][ih]}enforceCacheSizeLimit(lh,ih){o.enforceCacheSizeLimit(ih)}getWorkerPerformanceMetrics(lh,ih,Ah){Ah(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $p(self)),$p}),s(["./shared"],function(o){function x(L,u){if(Array.isArray(L)){if(!Array.isArray(u)||L.length!==u.length)return!1;for(let E=0;E<L.length;E++)if(!x(L[E],u[E]))return!1;return!0}if(typeof L=="object"&&L!==null&&u!==null){if(typeof u!="object"||Object.keys(L).length!==Object.keys(u).length)return!1;for(const E in L)if(!x(L[E],u[E]))return!1;return!0}return L===u}var C=P;function P(L){return!function(u){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var B,Y,vt=new Blob([""],{type:"text/javascript"}),mr=URL.createObjectURL(vt);try{Y=new Worker(mr),B=!0}catch{B=!1}return Y&&Y.terminate(),URL.revokeObjectURL(mr),B}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var B=document.createElement("canvas");B.width=B.height=1;var Y=B.getContext("2d");if(!Y)return!1;var vt=Y.getImageData(0,0,1,1);return vt&&vt.width===B.width}()?(ge[E=u&&u.failIfMajorPerformanceCaveat]===void 0&&(ge[E]=function(B){var Y,vt=function(mr){var Ur=document.createElement("canvas"),Gn=Object.create(P.webGLContextAttributes);return Gn.failIfMajorPerformanceCaveat=mr,Ur.getContext("webgl",Gn)||Ur.getContext("experimental-webgl",Gn)}(B);if(!vt)return!1;try{Y=vt.createShader(vt.VERTEX_SHADER)}catch{return!1}return!(!Y||vt.isContextLost())&&(vt.shaderSource(Y,"void main() {}"),vt.compileShader(Y),vt.getShaderParameter(Y,vt.COMPILE_STATUS)===!0)}(E)),ge[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var E}(L)}var ge={};function nt(L,u,E){const B=o.window.document.createElement(L);return u!==void 0&&(B.className=u),E&&E.appendChild(B),B}function ze(L,u,E){const B=o.window.document.createElementNS("http://www.w3.org/2000/svg",L);for(const Y of Object.keys(u))B.setAttributeNS(null,Y,u[Y]);return E&&E.appendChild(B),B}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Bt=o.window.document&&o.window.document.documentElement.style,qr=Bt&&Bt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let _n;function Fn(){Bt&&qr&&(_n=Bt[qr],Bt[qr]="none")}function tl(){Bt&&qr&&(Bt[qr]=_n)}function Io(L){L.preventDefault(),L.stopPropagation(),o.window.removeEventListener("click",Io,!0)}function Co(){o.window.addEventListener("click",Io,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Io,!0)},0)}function rl(L,u){const E=L.getBoundingClientRect();return ju(L,E,u)}function ah(L,u){const E=L.getBoundingClientRect(),B=[];for(let Y=0;Y<u.length;Y++)B.push(ju(L,E,u[Y]));return B}function ch(L){return o.window.InstallTrigger!==void 0&&L.button===2&&L.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:L.button}function ju(L,u,E){const B=L.offsetWidth===u.width?1:L.offsetWidth/u.width;return new o.Point((E.clientX-u.left)*B,(E.clientY-u.top)*B)}function Zu(L,u){var E=u[0],B=u[1],Y=u[2],vt=u[3],mr=E*vt-Y*B;return mr?(L[0]=vt*(mr=1/mr),L[1]=-B*mr,L[2]=-Y*mr,L[3]=E*mr,L):null}function sl(L){const{userImage:u}=L;return!!(u&&u.render&&u.render())&&(L.data.replace(new Uint8Array(u.data.buffer)),!0)}class oh extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:E,callback:B}of this.requestors)this._notify(E,B);this.requestors=[]}}hasImage(u){return!!this.getImage(u)}getImage(u){return this.images[u]}addImage(u,E){this._validate(u,E)&&(this.images[u]=E)}_validate(u,E){let B=!0;return this._validateStretch(E.stretchX,E.data&&E.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "stretchX" value`))),B=!1),this._validateStretch(E.stretchY,E.data&&E.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "stretchY" value`))),B=!1),this._validateContent(E.content,E)||(this.fire(new o.ErrorEvent(new Error(`Image "${u}" has invalid "content" value`))),B=!1),B}_validateStretch(u,E){if(!u)return!0;let B=0;for(const Y of u){if(Y[0]<B||Y[1]<Y[0]||E<Y[1])return!1;B=Y[1]}return!0}_validateContent(u,E){return!(u&&(u.length!==4||u[0]<0||E.data.width<u[0]||u[1]<0||E.data.height<u[1]||u[2]<0||E.data.width<u[2]||u[3]<0||E.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))}updateImage(u,E){E.version=this.images[u].version+1,this.images[u]=E,this.updatedImages[u]=!0}removeImage(u){const E=this.images[u];delete this.images[u],delete this.patterns[u],E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u,E){let B=!0;if(!this.isLoaded())for(const Y of u)this.images[Y]||(B=!1);this.isLoaded()||B?this._notify(u,E):this.requestors.push({ids:u,callback:E})}_notify(u,E){const B={};for(const Y of u){this.images[Y]||this.fire(new o.Event("styleimagemissing",{id:Y}));const vt=this.images[Y];vt?B[Y]={data:vt.data.clone(),pixelRatio:vt.pixelRatio,sdf:vt.sdf,version:vt.version,stretchX:vt.stretchX,stretchY:vt.stretchY,content:vt.content,hasRenderCallback:!!(vt.userImage&&vt.userImage.render)}:o.warnOnce(`Image "${Y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}E(null,B)}getPixelSize(){const{width:u,height:E}=this.atlasImage;return{width:u,height:E}}getPattern(u){const E=this.patterns[u],B=this.getImage(u);if(!B)return null;if(E&&E.position.version===B.version)return E.position;if(E)E.position.version=B.version;else{const Y={w:B.data.width+2,h:B.data.height+2,x:0,y:0},vt=new o.ImagePosition(Y,B);this.patterns[u]={bin:Y,position:vt}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const E=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(u,this.atlasImage,E.RGBA),this.atlasTexture&&this.atlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const vt in this.patterns)u.push(this.patterns[vt].bin);const{w:E,h:B}=o.potpack(u),Y=this.atlasImage;Y.resize({width:E||1,height:B||1});for(const vt in this.patterns){const{bin:mr}=this.patterns[vt],Ur=mr.x+1,Gn=mr.y+1,$s=this.images[vt].data,el=$s.width,Wu=$s.height;o.RGBAImage.copy($s,Y,{x:0,y:0},{x:Ur,y:Gn},{width:el,height:Wu}),o.RGBAImage.copy($s,Y,{x:0,y:Wu-1},{x:Ur,y:Gn-1},{width:el,height:1}),o.RGBAImage.copy($s,Y,{x:0,y:0},{x:Ur,y:Gn+Wu},{width:el,height:1}),o.RGBAImage.copy($s,Y,{x:el-1,y:0},{x:Ur-1,y:Gn},{width:1,height:Wu}),o.RGBAImage.copy($s,Y,{x:0,y:0},{x:Ur+el,y:Gn},{width:1,height:Wu})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const E of u){if(this.callbackDispatchedThisFrame[E])continue;this.callbackDispatchedThisFrame[E]=!0;const B=this.images[E];sl(B)&&this.updateImage(E,B)}}}const hh=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(L,u){return function([E,B,Y]){const vt=o.degToRad(B+90),mr=o.degToRad(Y);return{x:E*Math.cos(vt)*Math.sin(mr),y:E*Math.sin(vt)*Math.sin(mr),z:E*Math.cos(mr),azimuthal:B,polar:Y}}(L.expression.evaluate(u))}interpolate(L,u,E){return{x:o.number(L.x,u.x,E),y:o.number(L.y,u.y,E),z:o.number(L.z,u.z,E),azimuthal:o.number(L.azimuthal,u.azimuthal,E),polar:o.number(L.polar,u.polar,E)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class Sh extends o.Evented{constructor(u){super(),this._transitionable=new o.Transitionable(hh),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,E={}){if(!this._validate(o.validateLight,u,E))for(const B in u){const Y=u[B];o.endsWith(B,"-transition")?this._transitionable.setTransition(B.slice(0,-11),Y):this._transitionable.setValue(B,Y)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,E,B){return(!B||B.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:E,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const $h=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let hd=class extends o.Evented{constructor(L,u){super(),this._transitionable=new o.Transitionable($h),this.set(L),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(L){for(const u in L){const E=L[u];o.endsWith(u,"-transition")?this._transitionable.setTransition(u.slice(0,-11),E):this._transitionable.setValue(u,E)}}updateTransitions(L){this._transitioning=this._transitionable.transitioned(L,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(L){this.properties=this._transitioning.possiblyEvaluate(L)}};function vd(L,u,E,B){const Y=o.smoothstep(45,65,E),[vt,mr]=Ef(L,B),Ur=o.length(u);let Gn=1-Math.min(1,Math.exp((Ur-vt)/(mr-vt)*-6));return Gn*=Gn*Gn,Gn=Math.min(1,1.00747*Gn),Gn*Y*L.alpha}function Ef(L,u){const E=.5/Math.tan(.5*u);return[L.range[0]+E,L.range[1]+E]}const Cd=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class Cf extends o.Evented{constructor(u,E){super(),this._transitionable=new o.Transitionable(Cd),this.set(u),this._transitioning=this._transitionable.untransitioned(),this._transform=E}get state(){const u=this._transform,E=u.projection.name==="globe",B=o.globeToMercatorTransition(u.zoom),Y=this.properties.get("range"),vt=[.5,3];return{range:E?[o.number(vt[0],Y[0],B),o.number(vt[1],Y[1],B)]:Y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(u,E={}){if(!this._validate(o.validateFog,u,E)){for(const B of Object.keys(o.spec.fog))u&&u[B]===void 0&&(u[B]=o.spec.fog[B].default);for(const B in u){const Y=u[B];o.endsWith(B,"-transition")?this._transitionable.setTransition(B.slice(0,-11),Y):this._transitionable.setValue(B,Y)}}}getOpacity(u){if(!this._transform.projection.supportsFog)return 0;const E=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,u))*E.a}getOpacityAtLatLng(u,E){return this._transform.projection.supportsFog?function(B,Y,vt){const mr=o.MercatorCoordinate.fromLngLat(Y),Ur=vt.elevation?vt.elevation.getAtPointOrZero(mr):0,Gn=[mr.x,mr.y,Ur];return o.transformMat4(Gn,Gn,vt.mercatorFogMatrix),vd(B,Gn,vt.pitch,vt._fov)}(this.state,u,E):0}getFovAdjustedRange(u){return this._transform.projection.supportsFog?Ef(this.state,u):[0,1]}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,E,B){return(!B||B.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:E,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Sd{constructor(u,E){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const B=this.workerPool.acquire(this.id);for(let Y=0;Y<B.length;Y++){const vt=new Sd.Actor(B[Y],E,this.id);vt.name=`Worker ${Y}`,this.actors.push(vt)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(u,E,B){o.asyncAll(this.actors,(Y,vt)=>{Y.send(u,E,vt)},B=B||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(u=>{u.remove()}),this.actors=[],this.workerPool.release(this.id)}}function yd(L,u,E){return u*(o.EXTENT/(L.tileSize*Math.pow(2,E-L.tileID.overscaledZ)))}Sd.Actor=o.Actor;class Hd{constructor(u,E,B,Y){this.screenBounds=u,this.cameraPoint=E,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=B,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,Y)}static createFromScreenPoints(u,E){let B,Y;if(u instanceof o.Point||typeof u[0]=="number"){const vt=o.Point.convert(u);B=[vt],Y=E.isPointAboveHorizon(vt)}else{const vt=o.Point.convert(u[0]),mr=o.Point.convert(u[1]);B=[vt,mr],Y=o.polygonizeBounds(vt,mr).every(Ur=>E.isPointAboveHorizon(Ur))}return new Hd(B,E.getCameraPoint(),Y,E)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(u){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],u)}bufferedCameraGeometry(u){const E=this.screenBounds[0],B=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],Y=o.polygonizeBounds(E,B,0,!1);return this.cameraPoint.y>B.y&&(this.cameraPoint.x>E.x&&this.cameraPoint.x<B.x?Y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=B.x?Y[2]=this.cameraPoint:this.cameraPoint.x<=E.x&&(Y[3]=this.cameraPoint)),o.bufferConvexPolygon(Y,u)}bufferedCameraGeometryGlobe(u){const E=this.screenBounds[0],B=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],Y=o.polygonizeBounds(E,B,u),vt=this.cameraPoint.clone();switch(3*((vt.y>E.y)+(vt.y>B.y))+((vt.x>E.x)+(vt.x>B.x))){case 0:Y[0]=vt,Y[4]=vt.clone();break;case 1:Y.splice(1,0,vt);break;case 2:Y[1]=vt;break;case 3:Y.splice(4,0,vt);break;case 5:Y.splice(2,0,vt);break;case 6:Y[3]=vt;break;case 7:Y.splice(3,0,vt);break;case 8:Y[2]=vt}return Y}containsTile(u,E,B,Y=0){const vt=u.queryPadding/E._pixelsPerMercatorPixel+1,mr=B?this._bufferedCameraMercator(vt,E):this._bufferedScreenMercator(vt,E);let Ur=u.tileID.wrap+(mr.unwrapped?Y:0);const Gn=mr.polygon.map(Ih=>o.getTilePoint(u.tileTransform,Ih,Ur));if(!o.polygonIntersectsBox(Gn,0,0,o.EXTENT,o.EXTENT))return;Ur=u.tileID.wrap+(this.screenGeometryMercator.unwrapped?Y:0);const $s=this.screenGeometryMercator.polygon.map(Ih=>o.getTileVec3(u.tileTransform,Ih,Ur)),el=$s.map(Ih=>new o.Point(Ih[0],Ih[1])),Wu=E.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),dh=o.getTileVec3(u.tileTransform,Wu,Ur),gh=$s.map(Ih=>{const Qu=o.sub(Ih,Ih,dh);return o.normalize(Qu,Qu),new o.Ray(dh,Qu)}),Eh=yd(u,1,E.zoom)*E._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:el,tilespaceRays:gh,bufferedTilespaceGeometry:Gn,bufferedTilespaceBounds:(yh=o.getBounds(Gn),yh.min.x=o.clamp(yh.min.x,0,o.EXTENT),yh.min.y=o.clamp(yh.min.y,0,o.EXTENT),yh.max.x=o.clamp(yh.max.x,0,o.EXTENT),yh.max.y=o.clamp(yh.max.y,0,o.EXTENT),yh),tile:u,tileID:u.tileID,pixelToTileUnitsFactor:Eh};var yh}_bufferedScreenMercator(u,E){const B=zd(u);if(this._screenRaycastCache[B])return this._screenRaycastCache[B];{let Y;return Y=E.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(u),E):{polygon:this.bufferedScreenGeometry(u).map(vt=>E.pointCoordinate3D(vt)),unwrapped:!0},this._screenRaycastCache[B]=Y,Y}}_bufferedCameraMercator(u,E){const B=zd(u);if(this._cameraRaycastCache[B])return this._cameraRaycastCache[B];{let Y;return Y=E.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(u),E):{polygon:this.bufferedCameraGeometry(u).map(vt=>E.pointCoordinate3D(vt)),unwrapped:!0},this._cameraRaycastCache[B]=Y,Y}}_projectAndResample(u,E){const B=function(vt,mr){const Ur=o.multiply([],mr.pixelMatrix,mr.globeMatrix),Gn=[0,-o.GLOBE_RADIUS,0,1],$s=[0,o.GLOBE_RADIUS,0,1],el=[0,0,0,1];o.transformMat4$1(Gn,Gn,Ur),o.transformMat4$1($s,$s,Ur),o.transformMat4$1(el,el,Ur);const Wu=new o.Point(Gn[0]/Gn[3],Gn[1]/Gn[3]),dh=new o.Point($s[0]/$s[3],$s[1]/$s[3]),gh=o.polygonContainsPoint(vt,Wu)&&Gn[3]<el[3],Eh=o.polygonContainsPoint(vt,dh)&&$s[3]<el[3];if(!gh&&!Eh)return null;const yh=function(ld,dd,ud){for(let md=1;md<ld.length;md++){const Af=Pd(dd.pointCoordinate3D(ld[md-1]).x),Td=Pd(dd.pointCoordinate3D(ld[md]).x);if(ud<0){if(Af<Td)return{idx:md,t:-Af/(Td-1-Af)}}else if(Td<Af)return{idx:md,t:(1-Af)/(Td+1-Af)}}return null}(vt,mr,gh?-1:1);if(!yh)return null;const{idx:Ih,t:Qu}=yh;let bh=Ih>1?xd(vt.slice(0,Ih),mr):[],kh=Ih<vt.length?xd(vt.slice(Ih),mr):[];bh=bh.map(ld=>new o.Point(Pd(ld.x),ld.y)),kh=kh.map(ld=>new o.Point(Pd(ld.x),ld.y));const Oh=[...bh];Oh.length===0&&Oh.push(kh[kh.length-1]);const rd=o.number(Oh[Oh.length-1].y,(kh.length===0?bh[0]:kh[0]).y,Qu);let sd;return sd=gh?[new o.Point(0,rd),new o.Point(0,0),new o.Point(1,0),new o.Point(1,rd)]:[new o.Point(1,rd),new o.Point(1,1),new o.Point(0,1),new o.Point(0,rd)],Oh.push(...sd),kh.length===0?Oh.push(bh[0]):Oh.push(...kh),{polygon:Oh.map(ld=>new o.MercatorCoordinate(ld.x,ld.y)),unwrapped:!1}}(u,E);if(B)return B;const Y=function(vt,mr){let Ur=!1,Gn=-1/0,$s=0;for(let Wu=0;Wu<vt.length-1;Wu++)vt[Wu].x>Gn&&(Gn=vt[Wu].x,$s=Wu);for(let Wu=0;Wu<vt.length-1;Wu++){const dh=($s+Wu)%(vt.length-1),gh=vt[dh],Eh=vt[dh+1];Math.abs(gh.x-Eh.x)>.5&&(gh.x<Eh.x?(gh.x+=1,dh===0&&(vt[vt.length-1].x+=1)):(Eh.x+=1,dh+1===vt.length-1&&(vt[0].x+=1)),Ur=!0)}const el=o.mercatorXfromLng(mr.center.lng);return Ur&&el<Math.abs(el-1)&&vt.forEach(Wu=>{Wu.x-=1}),{polygon:vt,unwrapped:Ur}}(xd(u,E).map(vt=>new o.Point(Pd(vt.x),vt.y)),E);return{polygon:Y.polygon.map(vt=>new o.MercatorCoordinate(vt.x,vt.y)),unwrapped:Y.unwrapped}}}function xd(L,u){return o.resample(L,E=>{const B=u.pointCoordinate3D(E);E.x=B.x,E.y=B.y},1/256)}function Pd(L){return L<0?1+L%1:L%1}function zd(L){return 100*L|0}function Ld(L,u,E,B,Y){const vt=function(mr,Ur){if(mr)return Y(mr);if(Ur){L.url&&Ur.tiles&&L.tiles&&delete L.tiles;const Gn=o.pick(o.extend(Ur,L),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);Ur.vector_layers&&(Gn.vectorLayers=Ur.vector_layers,Gn.vectorLayerIds=Gn.vectorLayers.map($s=>$s.id)),Gn.tiles=u.canonicalizeTileset(Gn,L.url),Y(null,Gn)}};return L.url?o.getJSON(u.transformRequest(u.normalizeSourceURL(L.url,null,E,B),o.ResourceType.Source),vt):o.exported.frame(()=>vt(null,L))}class Kd{constructor(u,E,B){this.bounds=o.LngLatBounds.convert(this.validateBounds(u)),this.minzoom=E||0,this.maxzoom=B||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const E=Math.pow(2,u.z),B=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*E),Y=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*E),vt=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*E),mr=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*E);return u.x>=B&&u.x<vt&&u.y>=Y&&u.y<mr}}class wf{constructor(u,E,B){this.context=u;const Y=u.gl;this.buffer=Y.createBuffer(),this.dynamicDraw=!!B,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),Y.bufferData(Y.ELEMENT_ARRAY_BUFFER,E.arrayBuffer,this.dynamicDraw?Y.DYNAMIC_DRAW:Y.STATIC_DRAW),this.dynamicDraw||E.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const E=this.context.gl;this.context.unbindVAO(),this.bind(),E.bufferSubData(E.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cd{constructor(u,E,B,Y){this.length=E.length,this.attributes=B,this.itemSize=E.bytesPerElement,this.dynamicDraw=Y,this.context=u;const vt=u.gl;this.buffer=vt.createBuffer(),u.bindVertexBuffer.set(this.buffer),vt.bufferData(vt.ARRAY_BUFFER,E.arrayBuffer,this.dynamicDraw?vt.DYNAMIC_DRAW:vt.STATIC_DRAW),this.dynamicDraw||E.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){const E=this.context.gl;this.bind(),E.bufferSubData(E.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,E){for(let B=0;B<this.attributes.length;B++){const Y=E.attributes[this.attributes[B].name];Y!==void 0&&u.enableVertexAttribArray(Y)}}setVertexAttribPointers(u,E,B){for(let Y=0;Y<this.attributes.length;Y++){const vt=this.attributes[Y],mr=E.attributes[vt.name];mr!==void 0&&u.vertexAttribPointer(mr,vt.components,u[kd[vt.type]],!1,this.itemSize,vt.offset+this.itemSize*(B||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gd{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bp extends gd{getDefault(){return o.Color.transparent}set(u){const E=this.current;(u.r!==E.r||u.g!==E.g||u.b!==E.b||u.a!==E.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Uf extends gd{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class qd extends gd{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class Vd extends gd{getDefault(){return[!0,!0,!0,!0]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||u[3]!==E[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class ep extends gd{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class _p extends gd{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class lp extends gd{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const E=this.current;(u.func!==E.func||u.ref!==E.ref||u.mask!==E.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class Kh extends gd{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Qd extends gd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.STENCIL_TEST):E.disable(E.STENCIL_TEST),this.current=u,this.dirty=!1}}class fd extends gd{getDefault(){return[0,1]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class Jd extends gd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.DEPTH_TEST):E.disable(E.DEPTH_TEST),this.current=u,this.dirty=!1}}class Yh extends gd{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class $d extends gd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.BLEND):E.disable(E.BLEND),this.current=u,this.dirty=!1}}class Jf extends gd{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class Sf extends gd{getDefault(){return o.Color.transparent}set(u){const E=this.current;(u.r!==E.r||u.g!==E.g||u.b!==E.b||u.a!==E.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class If extends gd{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class Xf extends gd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;u?E.enable(E.CULL_FACE):E.disable(E.CULL_FACE),this.current=u,this.dirty=!1}}class Of extends gd{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class jf extends gd{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}let Ap,vp=class extends gd{getDefault(){return null}set(L){(L!==this.current||this.dirty)&&(this.gl.useProgram(L),this.current=L,this.dirty=!1)}};class Tp extends gd{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class Zf extends gd{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const E=this.current;(u[0]!==E[0]||u[1]!==E[1]||u[2]!==E[2]||u[3]!==E[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class qp extends gd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindFramebuffer(E.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class sm extends gd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindRenderbuffer(E.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Wd extends gd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindTexture(E.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class $p extends gd{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.bindBuffer(E.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Lh extends gd{getDefault(){return null}set(u){const E=this.gl;E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class lh extends gd{constructor(u){super(u),this.vao=u.extVertexArrayObject}getDefault(){return null}set(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)}}class ih extends gd{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class Ah extends gd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class zh extends gd{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const E=this.gl;E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Qh extends gd{constructor(u,E){super(u),this.context=u,this.parent=E}getDefault(){return null}}class Th extends Qh{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const E=this.gl;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Fh extends Qh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const E=this.gl;E.framebufferRenderbuffer(E.FRAMEBUFFER,this.attachment(),E.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class al extends Fh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class fh{constructor(u,E,B,Y){this.context=u,this.width=E,this.height=B;const vt=this.framebuffer=u.gl.createFramebuffer();this.colorAttachment=new Th(u,vt),Y&&(this.depthAttachment=new Fh(u,vt))}destroy(){const u=this.context.gl,E=this.colorAttachment.get();if(E&&u.deleteTexture(E),this.depthAttachment){const B=this.depthAttachment.get();B&&u.deleteRenderbuffer(B)}u.deleteFramebuffer(this.framebuffer)}}class nl{constructor(u,E=!1){if(this.gl=u,this.isWebGL2=E,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),E){const B=u;this.extVertexArrayObject={createVertexArrayOES:B.createVertexArray.bind(u),deleteVertexArrayOES:B.deleteVertexArray.bind(u),bindVertexArrayOES:B.bindVertexArray.bind(u)}}this.clearColor=new bp(this),this.clearDepth=new Uf(this),this.clearStencil=new qd(this),this.colorMask=new Vd(this),this.depthMask=new ep(this),this.stencilMask=new _p(this),this.stencilFunc=new lp(this),this.stencilOp=new Kh(this),this.stencilTest=new Qd(this),this.depthRange=new fd(this),this.depthTest=new Jd(this),this.depthFunc=new Yh(this),this.blend=new $d(this),this.blendFunc=new Jf(this),this.blendColor=new Sf(this),this.blendEquation=new If(this),this.cullFace=new Xf(this),this.cullFaceSide=new Of(this),this.frontFace=new jf(this),this.program=new vp(this),this.activeTexture=new Tp(this),this.viewport=new Zf(this),this.bindFramebuffer=new qp(this),this.bindRenderbuffer=new sm(this),this.bindTexture=new Wd(this),this.bindVertexBuffer=new $p(this),this.bindElementBuffer=new Lh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new lh(this),this.pixelStoreUnpack=new ih(this),this.pixelStoreUnpackPremultiplyAlpha=new Ah(this),this.pixelStoreUnpackFlipY=new zh(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=u.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=u.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=u.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),E||(this.extTextureHalfFloat=u.getExtension("OES_texture_half_float")),(E||this.extTextureHalfFloat&&u.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=E||u.getExtension("OES_standard_derivatives"),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,E){return new wf(this,u,E)}createVertexBuffer(u,E,B){return new cd(this,u,E,B)}createRenderbuffer(u,E,B){const Y=this.gl,vt=Y.createRenderbuffer();return this.bindRenderbuffer.set(vt),Y.renderbufferStorage(Y.RENDERBUFFER,u,E,B),this.bindRenderbuffer.set(null),vt}createFramebuffer(u,E,B){return new fh(this,u,E,B)}clear({color:u,depth:E,stencil:B}){const Y=this.gl;let vt=0;u&&(vt|=Y.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),E!==void 0&&(vt|=Y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(E),this.depthMask.set(!0)),B!==void 0&&(vt|=Y.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),Y.clear(vt)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){x(u.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Zs extends o.Evented{constructor(u,E,B,Y){if(super(),this.id=u,this.dispatcher=B,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(E,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},E),this._collectResourceTiming=E.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(Y),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const E=Array.isArray(this.map._language)?this.map._language.join():this.map._language,B=this.map._worldview;this._tileJSONRequest=Ld(this._options,this.map._requestManager,E,B,(Y,vt)=>{this._tileJSONRequest=null,this._loaded=!0,Y?(E&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${E}`),B&&B.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${B}`),this.fire(new o.ErrorEvent(Y))):vt&&(o.extend(this,vt),vt.bounds&&(this.tileBounds=new Kd(vt.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(vt.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(Y)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(u,E){const B=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),Y={request:this.map._requestManager.transformRequest(B,o.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(Y.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=E:u.request=u.actor.send("reloadTile",Y,vt.bind(this));else if(u.actor=this._tileWorkers[B]=this._tileWorkers[B]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",Y,vt.bind(this),void 0,!0);else{const mr=o.loadVectorTile.call({deduped:this._deduped},Y,(Ur,Gn)=>{Ur||!Gn?vt.call(this,Ur):(Y.data={cacheControl:Gn.cacheControl,expires:Gn.expires,rawData:Gn.rawData.slice(0)},u.actor&&u.actor.send("loadTile",Y,vt.bind(this),void 0,!0))},!0);u.request={cancel:mr}}function vt(mr,Ur){return delete u.request,u.aborted?E(null):mr&&mr.status!==404?E(mr):(Ur&&Ur.resourceTiming&&(u.resourceTiming=Ur.resourceTiming),this.map._refreshExpiredTiles&&Ur&&u.setExpiryData(Ur),u.loadVectorData(Ur,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),E(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ol extends o.Evented{constructor(u,E,B,Y){super(),this.id=u,this.dispatcher=B,this.setEventedParent(Y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},E),o.extend(this,o.pick(E,["url","scheme","tileSize"]))}load(u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ld(this._options,this.map._requestManager,null,null,(E,B)=>{this._tileJSONRequest=null,this._loaded=!0,E?this.fire(new o.ErrorEvent(E)):B&&(o.extend(this,B),B.bounds&&(this.tileBounds=new Kd(B.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(B.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(E)})}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,E){const B=o.exported.devicePixelRatio>=2,Y=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),B,this.tileSize);u.request=o.getImage(this.map._requestManager.transformRequest(Y,o.ResourceType.Tile),(vt,mr,Ur,Gn)=>(delete u.request,u.aborted?(u.state="unloaded",E(null)):vt?(u.state="errored",E(vt)):mr?(this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:Ur,expires:Gn}),u.setTexture(mr,this.map.painter),u.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void E(null)):E(null)))}static loadTileData(u,E,B){u.setTexture(E,B)}static unloadTileData(u,E){u.texture&&E.saveTileTexture(u.texture)}abortTile(u,E){u.request&&(u.request.cancel(),delete u.request),E()}unloadTile(u,E){u.texture&&this.map.painter.saveTileTexture(u.texture),E()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sh(L,u,E,B,Y,vt,mr,Ur){const Gn=[L,E,Y,u,B,vt,1,1,1],$s=[mr,Ur,1],el=o.adjoint([],Gn),[Wu,dh,gh]=o.transformMat3($s,$s,o.transpose(el,el));return o.multiply$1(Gn,[Wu,0,0,0,dh,0,0,0,gh],Gn)}class xh extends o.Evented{constructor(u,E,B,Y){super(),this.id=u,this.dispatcher=B,this.coordinates=E.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(Y),this.options=E,this._dirty=!1}load(u,E){this._loaded=E||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(B,Y)=>{if(this._imageRequest=null,this._loaded=!0,B)this.fire(new o.ErrorEvent(B));else if(Y){const{HTMLImageElement:vt}=o.window;this.image=Y instanceof vt?o.exported.getImageData(Y):Y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,u&&(this.coordinates=u),this._finishLoading()}})}loaded(){return this._loaded}updateImage(u){return this.image&&u.url?(this._imageRequest&&u.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=u.url,this.load(u.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(u){this.coordinates=u,this._boundsArray=void 0;const E=u.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(B){let Y=1/0,vt=1/0,mr=-1/0,Ur=-1/0;for(const Wu of B)Y=Math.min(Y,Wu.x),vt=Math.min(vt,Wu.y),mr=Math.max(mr,Wu.x),Ur=Math.max(Ur,Wu.y);const Gn=Math.max(mr-Y,Ur-vt),$s=Math.max(0,Math.floor(-Math.log(Gn)/Math.LN2)),el=Math.pow(2,$s);return new o.CanonicalTileID($s,Math.floor((Y+mr)/2*el),Math.floor((vt+Ur)/2*el))}(E),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(u){for(const Gn in this.tiles){const $s=this.tiles[Gn];$s.state!=="loaded"&&($s.state="loaded",$s.texture=this.texture)}if(this._boundsArray)return;const E=o.tileTransform(this.tileID,this.map.transform.projection),[B,Y,vt,mr]=this.coordinates.map(Gn=>{const $s=E.projection.project(Gn[0],Gn[1]);return o.getTilePoint(E,$s)._round()});this.perspectiveTransform=function(Gn,$s,el,Wu,dh,gh,Eh,yh,Ih,Qu){const bh=sh(0,0,Gn,0,0,$s,Gn,$s),kh=sh(el,Wu,dh,gh,Eh,yh,Ih,Qu);return o.multiply$1(kh,o.adjoint(bh,bh),kh),[kh[6]/kh[8]*Gn/o.EXTENT,kh[7]/kh[8]*$s/o.EXTENT]}(this.width,this.height,B.x,B.y,Y.x,Y.y,mr.x,mr.y,vt.x,vt.y);const Ur=this._boundsArray=new o.StructArrayLayout4i8;Ur.emplaceBack(B.x,B.y,0,0),Ur.emplaceBack(Y.x,Y.y,o.EXTENT,0),Ur.emplaceBack(mr.x,mr.y,0,o.EXTENT),Ur.emplaceBack(vt.x,vt.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=u.createVertexBuffer(Ur,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const u=this.map.painter.context,E=u.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(u,this.image,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(u)}loadTile(u,E){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},E(null)):(u.state="errored",E(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Mh={vector:Zs,raster:ol,"raster-dem":class extends ol{constructor(L,u,E,B){super(L,u,E,B),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}loadTile(L,u){const E=this.map._requestManager.normalizeTileURL(L.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function B(Y,vt){Y&&(L.state="errored",u(Y)),vt&&(L.dem=vt,L.dem.onDeserialize(),L.needsHillshadePrepare=!0,L.needsDEMTextureUpload=!0,L.state="loaded",u(null))}L.request=o.getImage(this.map._requestManager.transformRequest(E,o.ResourceType.Tile),function(Y,vt,mr,Ur){if(delete L.request,L.aborted)L.state="unloaded",u(null);else if(Y)L.state="errored",u(Y);else if(vt){this.map._refreshExpiredTiles&&L.setExpiryData({cacheControl:mr,expires:Ur});const Gn=o.window.ImageBitmap&&vt instanceof o.window.ImageBitmap&&(Ap==null&&(Ap=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Ap),$s=1-(vt.width-o.prevPowerOfTwo(vt.width))/2;$s<1||L.neighboringTiles||(L.neighboringTiles=this._getNeighboringTiles(L.tileID));const el=Gn?vt:o.exported.getImageData(vt,$s),Wu={uid:L.uid,coord:L.tileID,source:this.id,rawImageData:el,encoding:this.encoding,padding:$s};L.actor&&L.state!=="expired"||(L.actor=this.dispatcher.getActor(),L.actor.send("loadDEMTile",Wu,B.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(L){const u=L.canonical,E=Math.pow(2,u.z),B=(u.x-1+E)%E,Y=u.x===0?L.wrap-1:L.wrap,vt=(u.x+1+E)%E,mr=u.x+1===E?L.wrap+1:L.wrap,Ur={};return Ur[new o.OverscaledTileID(L.overscaledZ,Y,u.z,B,u.y).key]={backfilled:!1},Ur[new o.OverscaledTileID(L.overscaledZ,mr,u.z,vt,u.y).key]={backfilled:!1},u.y>0&&(Ur[new o.OverscaledTileID(L.overscaledZ,Y,u.z,B,u.y-1).key]={backfilled:!1},Ur[new o.OverscaledTileID(L.overscaledZ,L.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},Ur[new o.OverscaledTileID(L.overscaledZ,mr,u.z,vt,u.y-1).key]={backfilled:!1}),u.y+1<E&&(Ur[new o.OverscaledTileID(L.overscaledZ,Y,u.z,B,u.y+1).key]={backfilled:!1},Ur[new o.OverscaledTileID(L.overscaledZ,L.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},Ur[new o.OverscaledTileID(L.overscaledZ,mr,u.z,vt,u.y+1).key]={backfilled:!1}),Ur}unloadTile(L){L.demTexture&&this.map.painter.saveTileTexture(L.demTexture),L.fbo&&(L.fbo.destroy(),delete L.fbo),L.dem&&delete L.dem,delete L.neighboringTiles,L.state="unloaded"}},geojson:class extends o.Evented{constructor(L,u,E,B){super(),this.id=L,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(B),this._data=u.data,this._options=o.extend({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const Y=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*Y,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*Y,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.EXTENT,radius:(u.clusterRadius!==void 0?u.clusterRadius:50)*Y,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}onAdd(L){this.map=L,this.setData(this._data)}setData(L){return this._data=L,this._updateWorkerData(),this}getClusterExpansionZoom(L,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:L,source:this.id},u),this}getClusterChildren(L,u){return this.actor.send("geojson.getClusterChildren",{clusterId:L,source:this.id},u),this}getClusterLeaves(L,u,E,B){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:L,limit:u,offset:E},B),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const L=o.extend({},this.workerOptions),u=this._data;typeof u=="string"?(L.request=this.map._requestManager.transformRequest(o.exported.resolveURL(u),o.ResourceType.Source),L.request.collectResourceTiming=this._collectResourceTiming):L.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,L,(E,B)=>{if(this._loaded=!0,this._pendingLoad=null,E)this.fire(new o.ErrorEvent(E));else{const Y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&B&&B.resourceTiming&&B.resourceTiming[this.id]&&(Y.resourceTiming=B.resourceTiming[this.id]),this.fire(new o.Event("data",Y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(L,u){const E=L.actor?"reloadTile":"loadTile";L.actor=this.actor,L.request=this.actor.send(E,{type:this.type,uid:L.uid,tileID:L.tileID,tileZoom:L.tileZoom,zoom:L.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(B,Y)=>(delete L.request,L.unloadVectorData(),L.aborted?u(null):B?u(B):(L.loadVectorData(Y,this.map.painter,E==="reloadTile"),u(null))),void 0,E==="loadTile")}abortTile(L){L.request&&(L.request.cancel(),delete L.request),L.aborted=!0}unloadTile(L){L.unloadVectorData(),this.actor.send("removeTile",{uid:L.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends xh{constructor(L,u,E,B){super(L,u,E,B),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const L=this.options;this.urls=[];for(const u of L.urls)this.urls.push(this.map._requestManager.transformRequest(u,o.ResourceType.Source).url);o.getVideo(this.urls,(u,E)=>{this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):E&&(this.video=E,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(L){if(this.video){const u=this.video.seekable;L<u.start(0)||L>u.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=L}}getVideo(){return this.video}onAdd(L){this.map||(this.map=L,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const L=this.map.painter.context,u=L.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(L,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(L)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:xh,canvas:class extends xh{constructor(L,u,E,B){super(L,u,E,B),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(Y=>!Array.isArray(Y)||Y.length!==2||Y.some(vt=>typeof vt!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${L}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(L){this.map=L,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let L=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,L=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,L=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context;this.texture?(L||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(u,this.canvas,u.gl.RGBA,{premultiply:!0}),this._prepareData(u)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const L of[this.canvas.width,this.canvas.height])if(isNaN(L)||L<=0)return!0;return!1}},custom:class extends o.Evented{constructor(L,u,E,B){super(),this.id=L,this.type="custom",this._dataType="raster",this._dispatcher=E,this._implementation=u,this.setEventedParent(B),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kd(this._implementation.bounds,this.minzoom,this.maxzoom)),u.update=this._update.bind(this),u.clearTiles=this._clearTiles.bind(this),u.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(u,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(L){this._map=L,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(L),this.load()}onRemove(L){this._implementation.onRemove&&this._implementation.onRemove(L)}hasTile(L){if(this._implementation.hasTile){const{x:u,y:E,z:B}=L.canonical;return this._implementation.hasTile({x:u,y:E,z:B})}return!this.tileBounds||this.tileBounds.contains(L.canonical)}loadTile(L,u){const{x:E,y:B,z:Y}=L.tileID.canonical,vt=new o.window.AbortController;L.request=Promise.resolve(this._implementation.loadTile({x:E,y:B,z:Y},{signal:vt.signal})).then(function(mr){return delete L.request,L.aborted?(L.state="unloaded",u(null)):mr===void 0?(L.state="errored",u(null)):mr===null?(this.loadTileData(L,{width:this.tileSize,height:this.tileSize,data:null}),L.state="loaded",u(null)):function(Ur){return Ur instanceof o.window.ImageData||Ur instanceof o.window.HTMLCanvasElement||Ur instanceof o.window.ImageBitmap||Ur instanceof o.window.HTMLImageElement}(mr)?(this.loadTileData(L,mr),L.state="loaded",void u(null)):(L.state="errored",u(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(mr=>{mr.code!==20&&(L.state="errored",u(mr))}),L.request.cancel=()=>vt.abort()}loadTileData(L,u){ol.loadTileData(L,u,this._map.painter)}unloadTileData(L){ol.unloadTileData(L,this._map.painter)}unloadTile(L,u){if(this.unloadTileData(L),this._implementation.unloadTile){const{x:E,y:B,z:Y}=L.tileID.canonical;this._implementation.unloadTile({x:E,y:B,z:Y})}u()}abortTile(L,u){L.request&&L.request.cancel&&(L.request.cancel(),delete L.request),u()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(L=>({x:L.canonical.x,y:L.canonical.y,z:L.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Uh=function(L,u,E,B){const Y=new Mh[u.type](L,u,E,B);if(Y.id!==L)throw new Error(`Expected Source id to be ${L} instead of ${Y.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],Y),Y};function Nh(L,u){const E=o.identity([]);return o.scale(E,E,[.5*L.width,.5*-L.height,1]),o.translate(E,E,[1,-1,0]),o.multiply(E,E,L.calculateProjMatrix(u.toUnwrapped())),Float32Array.from(E)}function Zh(L,u,E,B,Y,vt,mr,Ur=!1){const Gn=L.tilesIn(B,mr,Ur);Gn.sort(Ad);const $s=[];for(const Wu of Gn)$s.push({wrappedTileID:Wu.tile.tileID.wrapped().key,queryResults:Wu.tile.queryRenderedFeatures(u,E,L._state,Wu,Y,vt,Nh(L.transform,Wu.tile.tileID),Ur)});const el=function(Wu){const dh={},gh={};for(const Eh of Wu){const yh=Eh.queryResults,Ih=Eh.wrappedTileID,Qu=gh[Ih]=gh[Ih]||{};for(const bh in yh){const kh=yh[bh],Oh=Qu[bh]=Qu[bh]||{},rd=dh[bh]=dh[bh]||[];for(const sd of kh)Oh[sd.featureIndex]||(Oh[sd.featureIndex]=!0,rd.push(sd))}}return dh}($s);for(const Wu in el)el[Wu].forEach(dh=>{const gh=dh.feature,Eh=gh.layer;Eh&&Eh.type!=="background"&&Eh.type!=="sky"&&(gh.source=Eh.source,Eh["source-layer"]&&(gh.sourceLayer=Eh["source-layer"]),gh.state=gh.id!==void 0?L.getFeatureState(Eh["source-layer"],gh.id):{})});return el}function td(L,u){const E=L.getRenderableIds().map(vt=>L.getTileByID(vt)),B=[],Y={};for(let vt=0;vt<E.length;vt++){const mr=E[vt],Ur=mr.tileID.canonical.key;Y[Ur]||(Y[Ur]=!0,mr.querySourceFeatures(B,u))}return B}function Ad(L,u){const E=L.tileID,B=u.tileID;return E.overscaledZ-B.overscaledZ||E.canonical.y-B.canonical.y||E.wrap-B.wrap||E.canonical.x-B.canonical.x}function Zd(){return Nd.workerClass!=null?new Nd.workerClass:new o.window.Worker(Nd.workerUrl)}const Fd="mapboxgl_preloaded_worker_pool";class Kf{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<Kf.workerCount;)this.workers.push(new Zd);return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach(E=>{E.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Fd]}numActive(){return Object.keys(this.active).length}}let up;function ap(){return up||(up=new Kf),up}function wp(L,u){const E={};for(const B in L)B!=="ref"&&(E[B]=L[B]);return o.refProperties.forEach(B=>{B in u&&(E[B]=u[B])}),E}function Hp(L){L=L.slice();const u=Object.create(null);for(let E=0;E<L.length;E++)u[L[E].id]=L[E];for(let E=0;E<L.length;E++)"ref"in L[E]&&(L[E]=wp(L[E],u[L[E].ref]));return L}Kf.workerCount=2;const Ip={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Gh(L,u,E){E.push({command:Ip.addSource,args:[L,u[L]]})}function Nf(L,u,E){u.push({command:Ip.removeSource,args:[L]}),E[L]=!0}function Hf(L,u,E,B){Nf(L,E,B),Gh(L,u,E)}function mp(L,u,E){let B;for(B in L[E])if(L[E].hasOwnProperty(B)&&B!=="data"&&!x(L[E][B],u[E][B]))return!1;for(B in u[E])if(u[E].hasOwnProperty(B)&&B!=="data"&&!x(L[E][B],u[E][B]))return!1;return!0}function Bp(L,u,E,B,Y,vt){let mr;for(mr in u=u||{},L=L||{})L.hasOwnProperty(mr)&&(x(L[mr],u[mr])||E.push({command:vt,args:[B,mr,u[mr],Y]}));for(mr in u)u.hasOwnProperty(mr)&&!L.hasOwnProperty(mr)&&(x(L[mr],u[mr])||E.push({command:vt,args:[B,mr,u[mr],Y]}))}function zp(L){return L.id}function um(L,u){return L[u.id]=u,L}class Nm{constructor(u,E){this.reset(u,E)}reset(u,E){this.points=u||[],this._distances=[0];for(let B=1;B<this.points.length;B++)this._distances[B]=this._distances[B-1]+this.points[B].dist(this.points[B-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(E||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=o.clamp(u,0,1);let E=1,B=this._distances[E];const Y=u*this.paddedLength+this.padding;for(;B<Y&&E<this._distances.length;)B=this._distances[++E];const vt=E-1,mr=this._distances[vt],Ur=B-mr,Gn=Ur>0?(Y-mr)/Ur:0;return this.points[vt].mult(1-Gn).add(this.points[E].mult(Gn))}}class a_{constructor(u,E,B){const Y=this.boxCells=[],vt=this.circleCells=[];this.xCellCount=Math.ceil(u/B),this.yCellCount=Math.ceil(E/B);for(let mr=0;mr<this.xCellCount*this.yCellCount;mr++)Y.push([]),vt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=E,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/E,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,E,B,Y,vt){this._forEachCell(E,B,Y,vt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(E),this.bboxes.push(B),this.bboxes.push(Y),this.bboxes.push(vt)}insertCircle(u,E,B,Y){this._forEachCell(E-Y,B-Y,E+Y,B+Y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(E),this.circles.push(B),this.circles.push(Y)}_insertBoxCell(u,E,B,Y,vt,mr){this.boxCells[vt].push(mr)}_insertCircleCell(u,E,B,Y,vt,mr){this.circleCells[vt].push(mr)}_query(u,E,B,Y,vt,mr){if(B<0||u>this.width||Y<0||E>this.height)return!vt&&[];const Ur=[];if(u<=0&&E<=0&&this.width<=B&&this.height<=Y){if(vt)return!0;for(let Gn=0;Gn<this.boxKeys.length;Gn++)Ur.push({key:this.boxKeys[Gn],x1:this.bboxes[4*Gn],y1:this.bboxes[4*Gn+1],x2:this.bboxes[4*Gn+2],y2:this.bboxes[4*Gn+3]});for(let Gn=0;Gn<this.circleKeys.length;Gn++){const $s=this.circles[3*Gn],el=this.circles[3*Gn+1],Wu=this.circles[3*Gn+2];Ur.push({key:this.circleKeys[Gn],x1:$s-Wu,y1:el-Wu,x2:$s+Wu,y2:el+Wu})}return mr?Ur.filter(mr):Ur}return this._forEachCell(u,E,B,Y,this._queryCell,Ur,{hitTest:vt,seenUids:{box:{},circle:{}}},mr),vt?Ur.length>0:Ur}_queryCircle(u,E,B,Y,vt){const mr=u-B,Ur=u+B,Gn=E-B,$s=E+B;if(Ur<0||mr>this.width||$s<0||Gn>this.height)return!Y&&[];const el=[];return this._forEachCell(mr,Gn,Ur,$s,this._queryCellCircle,el,{hitTest:Y,circle:{x:u,y:E,radius:B},seenUids:{box:{},circle:{}}},vt),Y?el.length>0:el}query(u,E,B,Y,vt){return this._query(u,E,B,Y,!1,vt)}hitTest(u,E,B,Y,vt){return this._query(u,E,B,Y,!0,vt)}hitTestCircle(u,E,B,Y){return this._queryCircle(u,E,B,!0,Y)}_queryCell(u,E,B,Y,vt,mr,Ur,Gn){const $s=Ur.seenUids,el=this.boxCells[vt];if(el!==null){const dh=this.bboxes;for(const gh of el)if(!$s.box[gh]){$s.box[gh]=!0;const Eh=4*gh;if(u<=dh[Eh+2]&&E<=dh[Eh+3]&&B>=dh[Eh+0]&&Y>=dh[Eh+1]&&(!Gn||Gn(this.boxKeys[gh]))){if(Ur.hitTest)return mr.push(!0),!0;mr.push({key:this.boxKeys[gh],x1:dh[Eh],y1:dh[Eh+1],x2:dh[Eh+2],y2:dh[Eh+3]})}}}const Wu=this.circleCells[vt];if(Wu!==null){const dh=this.circles;for(const gh of Wu)if(!$s.circle[gh]){$s.circle[gh]=!0;const Eh=3*gh;if(this._circleAndRectCollide(dh[Eh],dh[Eh+1],dh[Eh+2],u,E,B,Y)&&(!Gn||Gn(this.circleKeys[gh]))){if(Ur.hitTest)return mr.push(!0),!0;{const yh=dh[Eh],Ih=dh[Eh+1],Qu=dh[Eh+2];mr.push({key:this.circleKeys[gh],x1:yh-Qu,y1:Ih-Qu,x2:yh+Qu,y2:Ih+Qu})}}}}}_queryCellCircle(u,E,B,Y,vt,mr,Ur,Gn){const $s=Ur.circle,el=Ur.seenUids,Wu=this.boxCells[vt];if(Wu!==null){const gh=this.bboxes;for(const Eh of Wu)if(!el.box[Eh]){el.box[Eh]=!0;const yh=4*Eh;if(this._circleAndRectCollide($s.x,$s.y,$s.radius,gh[yh+0],gh[yh+1],gh[yh+2],gh[yh+3])&&(!Gn||Gn(this.boxKeys[Eh])))return mr.push(!0),!0}}const dh=this.circleCells[vt];if(dh!==null){const gh=this.circles;for(const Eh of dh)if(!el.circle[Eh]){el.circle[Eh]=!0;const yh=3*Eh;if(this._circlesCollide(gh[yh],gh[yh+1],gh[yh+2],$s.x,$s.y,$s.radius)&&(!Gn||Gn(this.circleKeys[Eh])))return mr.push(!0),!0}}}_forEachCell(u,E,B,Y,vt,mr,Ur,Gn){const $s=this._convertToXCellCoord(u),el=this._convertToYCellCoord(E),Wu=this._convertToXCellCoord(B),dh=this._convertToYCellCoord(Y);for(let gh=$s;gh<=Wu;gh++)for(let Eh=el;Eh<=dh;Eh++)if(vt.call(this,u,E,B,Y,this.xCellCount*Eh+gh,mr,Ur,Gn))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,E,B,Y,vt,mr){const Ur=Y-u,Gn=vt-E,$s=B+mr;return $s*$s>Ur*Ur+Gn*Gn}_circleAndRectCollide(u,E,B,Y,vt,mr,Ur){const Gn=(mr-Y)/2,$s=Math.abs(u-(Y+Gn));if($s>Gn+B)return!1;const el=(Ur-vt)/2,Wu=Math.abs(E-(vt+el));if(Wu>el+B)return!1;if($s<=Gn||Wu<=el)return!0;const dh=$s-Gn,gh=Wu-el;return dh*dh+gh*gh<=B*B}}const Ug={unknown:0,flipRequired:1,flipNotRequired:2},by=Math.tan(85*Math.PI/180);function Yd(L,u,E,B,Y,vt,mr){const Ur=o.create();if(E)if(vt.name==="globe"){const Gn=o.calculateGlobeLabelMatrix(Y,u);o.multiply(Ur,Ur,Gn)}else{const Gn=Zu([],mr);Ur[0]=Gn[0],Ur[1]=Gn[1],Ur[4]=Gn[2],Ur[5]=Gn[3],B||o.rotateZ(Ur,Ur,Y.angle)}else o.multiply(Ur,Y.labelPlaneMatrix,L);return Ur}function Mg(L,u,E,B,Y,vt,mr){const Ur=Yd(L,u,E,B,Y,vt,mr);return vt.name==="globe"&&E||(Ur[2]=Ur[6]=Ur[10]=Ur[14]=0),Ur}function km(L,u,E,B,Y,vt,mr){if(E){if(vt.name==="globe"){const Ur=Yd(L,u,E,B,Y,vt,mr);return o.invert(Ur,Ur),o.multiply(Ur,L,Ur),Ur}{const Ur=o.clone(L),Gn=o.identity([]);return Gn[0]=mr[0],Gn[1]=mr[1],Gn[4]=mr[2],Gn[5]=mr[3],o.multiply(Ur,Ur,Gn),B||o.rotateZ(Ur,Ur,-Y.angle),Ur}}return Y.glCoordMatrix}function sg(L,u,E,B){const Y=[L,u,E,1];E?o.transformMat4$1(Y,Y,B):Wh(Y,Y,B);const vt=Y[3];return Y[0]/=vt,Y[1]/=vt,Y[2]/=vt,Y}function wy(L,u){return Math.min(.5+L/u*.5,1.5)}function p_(L,u){const E=L[0]/L[3],B=L[1]/L[3];return E>=-u[0]&&E<=u[0]&&B>=-u[1]&&B<=u[1]}function a0(L,u,E,B,Y,vt,mr,Ur,Gn,$s){const el=E.transform,Wu=B?L.textSizeData:L.iconSizeData,dh=o.evaluateSizeForZoom(Wu,E.transform.zoom),gh=el.projection.name==="globe",Eh=[256/E.width*2+1,256/E.height*2+1],yh=B?L.text.dynamicLayoutVertexArray:L.icon.dynamicLayoutVertexArray;yh.clear();let Ih=null;gh&&(Ih=B?L.text.globeExtVertexArray:L.icon.globeExtVertexArray);const Qu=L.lineVertexArray,bh=B?L.text.placedSymbolArray:L.icon.placedSymbolArray,kh=E.transform.width/E.transform.height;let Oh,rd=!1;for(let sd=0;sd<bh.length;sd++){const ld=bh.get(sd),{numGlyphs:dd,writingMode:ud}=ld;if(ud!==o.WritingMode.vertical||rd||Oh===o.WritingMode.horizontal||(rd=!0),Oh=ud,(ld.hidden||ud===o.WritingMode.vertical)&&!rd){od(dd,yh);continue}rd=!1;const md=new o.Point(ld.tileAnchorX,ld.tileAnchorY);let{x:Af,y:Td,z:Gd}=el.projection.projectTilePoint(md.x,md.y,$s.canonical);if(Gn){const[Mp,fp,Fp]=Gn(md);Af+=Mp,Td+=fp,Gd+=Fp}const Od=[Af,Td,Gd,1];if(o.transformMat4$1(Od,Od,u),!p_(Od,Eh)){od(dd,yh);continue}const Lf=wy(E.transform.cameraToCenterDistance,Od[3]),Dd=o.evaluateSizeForFeature(Wu,dh,ld),yf=mr?Dd/Lf:Dd*Lf,zf=sg(Af,Td,Gd,Y);if(zf[3]<=0){od(dd,yh);continue}let Pf={};const Vf=mr?null:Gn,Lp=yr(ld,yf,!1,Ur,u,Y,vt,L.glyphOffsetArray,Qu,yh,Ih,zf,md,Pf,kh,Vf,el.projection,$s,mr);rd=Lp.useVertical,Vf&&Lp.needsFlipping&&(Pf={}),(Lp.notEnoughRoom||rd||Lp.needsFlipping&&yr(ld,yf,!0,Ur,u,Y,vt,L.glyphOffsetArray,Qu,yh,Ih,zf,md,Pf,kh,Vf,el.projection,$s,mr).notEnoughRoom)&&od(dd,yh)}B?(L.text.dynamicLayoutVertexBuffer.updateData(yh),Ih&&L.text.globeExtVertexBuffer.updateData(Ih)):(L.icon.dynamicLayoutVertexBuffer.updateData(yh),Ih&&L.icon.globeExtVertexBuffer.updateData(Ih))}function s0(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh){const{lineStartIndex:Ih,glyphStartIndex:Qu,segment:bh}=Ur,kh=Qu+Ur.numGlyphs,Oh=Ih+Ur.lineLength,rd=u.getoffsetX(Qu),sd=u.getoffsetX(kh-1),ld=Vh(L*rd,E,B,Y,vt,mr,bh,Ih,Oh,Gn,$s,el,Wu,dh,!0,gh,Eh,yh);if(!ld)return null;const dd=Vh(L*sd,E,B,Y,vt,mr,bh,Ih,Oh,Gn,$s,el,Wu,dh,!0,gh,Eh,yh);return dd?{first:ld,last:dd}:null}function mm(L,u,E,B){return L===o.WritingMode.horizontal&&Math.abs(B)>Math.abs(E)?{useVertical:!0}:L===o.WritingMode.vertical?B>0?{needsFlipping:!0}:null:u!==Ug.unknown&&function(Y,vt){return Y===0||Math.abs(vt/Y)>by}(E,B)?u===Ug.flipRequired?{needsFlipping:!0}:null:E<0?{needsFlipping:!0}:null}function yr(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh,Ih,Qu,bh){const kh=u/24,Oh=L.lineOffsetX*kh,rd=L.lineOffsetY*kh,{lineStartIndex:sd,glyphStartIndex:ld,numGlyphs:dd,segment:ud,writingMode:md,flipState:Af}=L,Td=sd+L.lineLength,Gd=Od=>{if(el){const[zf,Pf,Vf]=Od.up,Lp=$s.length;o.updateGlobeVertexNormal(el,Lp+0,zf,Pf,Vf),o.updateGlobeVertexNormal(el,Lp+1,zf,Pf,Vf),o.updateGlobeVertexNormal(el,Lp+2,zf,Pf,Vf),o.updateGlobeVertexNormal(el,Lp+3,zf,Pf,Vf)}const[Lf,Dd,yf]=Od.point;o.addDynamicAttributes($s,Lf,Dd,yf,Od.angle)};if(dd>1){const Od=s0(kh,Ur,Oh,rd,E,Wu,dh,L,Gn,vt,gh,yh,!1,Ih,Qu,bh);if(!Od)return{notEnoughRoom:!0};if(B&&!E){let[Lf,Dd,yf]=Od.first.point,[zf,Pf,Vf]=Od.last.point;[Lf,Dd]=sg(Lf,Dd,yf,mr),[zf,Pf]=sg(zf,Pf,Vf,mr);const Lp=mm(md,Af,(zf-Lf)*Eh,Pf-Dd);if(L.flipState=Lp&&Lp.needsFlipping?Ug.flipRequired:Ug.flipNotRequired,Lp)return Lp}Gd(Od.first);for(let Lf=ld+1;Lf<ld+dd-1;Lf++){const Dd=Vh(kh*Ur.getoffsetX(Lf),Oh,rd,E,Wu,dh,ud,sd,Td,Gn,vt,gh,yh,!1,!1,Ih,Qu,bh);if(!Dd)return $s.length-=4*(Lf-ld),{notEnoughRoom:!0};Gd(Dd)}Gd(Od.last)}else{if(B&&!E){const Lf=sg(dh.x,dh.y,0,Y),Dd=sd+ud+1,yf=new o.Point(Gn.getx(Dd),Gn.gety(Dd)),zf=sg(yf.x,yf.y,0,Y),Pf=zf[3]>0?zf:uh(dh,yf,Lf,1,Y,void 0,Ih,Qu.canonical),Vf=mm(md,Af,(Pf[0]-Lf[0])*Eh,Pf[1]-Lf[1]);if(L.flipState=Vf&&Vf.needsFlipping?Ug.flipRequired:Ug.flipNotRequired,Vf)return Vf}const Od=Vh(kh*Ur.getoffsetX(ld),Oh,rd,E,Wu,dh,ud,sd,Td,Gn,vt,gh,yh,!1,!1,Ih,Qu,bh);if(!Od)return{notEnoughRoom:!0};Gd(Od)}return{}}function Js(L,u,E,B,Y){const{x:vt,y:mr,z:Ur}=B.projectTilePoint(L.x,L.y,u);if(!Y)return sg(vt,mr,Ur,E);const[Gn,$s,el]=Y(L);return sg(vt+Gn,mr+$s,Ur+el,E)}function uh(L,u,E,B,Y,vt,mr,Ur){const Gn=Js(L.sub(u)._unit()._add(L),Ur,Y,mr,vt);return o.sub(Gn,E,Gn),o.normalize(Gn,Gn),o.scaleAndAdd(Gn,E,Gn,B)}function Vh(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh,Ih,Qu){const bh=B?L-u:L+u;let kh=bh>0?1:-1,Oh=0;B&&(kh*=-1,Oh=Math.PI),kh<0&&(Oh+=Math.PI);let rd=Ur+mr+(kh>0?0:1)|0,sd=Y,ld=Y,dd=0,ud=0;const md=Math.abs(bh),Af=[],Td=[];let Gd=vt,Od=Gd;const Lf=()=>uh(Od,Gd,ld,md-dd+1,el,dh,yh,Ih.canonical);for(;dd+ud<=md;){if(rd+=kh,rd<Ur||rd>=Gn)return null;if(ld=sd,Od=Gd,Af.push(ld),gh&&Td.push(Od),Gd=new o.Point($s.getx(rd),$s.gety(rd)),sd=Wu[rd],!sd){const Fp=Js(Gd,Ih.canonical,el,yh,dh);sd=Fp[3]>0?Wu[rd]=Fp:Lf()}dd+=ud,ud=o.distance(ld,sd)}Eh&&dh&&(Wu[rd]&&(sd=Lf(),ud=o.distance(ld,sd)),Wu[rd]=sd);const Dd=(md-dd)/ud,yf=Gd.sub(Od)._mult(Dd)._add(Od),zf=o.sub([],sd,ld),Pf=o.scaleAndAdd([],ld,zf,Dd);let Vf=[0,0,1],Lp=zf[0],Mp=zf[1];if(Qu&&(Vf=yh.upVector(Ih.canonical,yf.x,yf.y),Vf[0]!==0||Vf[1]!==0||Vf[2]!==1)){const Fp=[Vf[2],0,-Vf[0]],cm=o.cross([],Vf,Fp);o.normalize(Fp,Fp),o.normalize(cm,cm),Lp=o.dot(zf,Fp),Mp=o.dot(zf,cm)}if(E){const Fp=o.cross([],Vf,zf);o.normalize(Fp,Fp),o.scaleAndAdd(Pf,Pf,Fp,E*kh)}const fp=Oh+Math.atan2(Mp,Lp);return Af.push(Pf),gh&&Td.push(yf),{point:Pf,angle:fp,path:Af,tilePath:Td,up:Vf}}function od(L,u){const E=u.length,B=E+4*L;u.resize(B),u.float32.fill(-1/0,4*E,4*B)}function Wh(L,u,E){const B=u[0],Y=u[1];return L[0]=E[0]*B+E[4]*Y+E[12],L[1]=E[1]*B+E[5]*Y+E[13],L[3]=E[3]*B+E[7]*Y+E[15],L}const pd=100;class $f{constructor(u,E,B=new a_(u.width+200,u.height+200,25),Y=new a_(u.width+200,u.height+200,25)){this.transform=u,this.grid=B,this.ignoredGrid=Y,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+pd,this.screenBottomBoundary=u.height+pd,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.fogState=E}placeCollisionBox(u,E,B,Y,vt,mr,Ur,Gn){let $s=B.projectedAnchorX,el=B.projectedAnchorY,Wu=B.projectedAnchorZ;const dh=B.elevation,gh=B.tileID,Eh=u.getProjection();if(dh&&gh){const[sd,ld,dd]=Eh.upVector(gh.canonical,B.tileAnchorX,B.tileAnchorY),ud=Eh.upVectorScale(gh.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$s+=sd*dh*ud,el+=ld*dh*ud,Wu+=dd*dh*ud}const yh=this.projectAndGetPerspectiveRatio(Ur,$s,el,Wu,B.tileID,Eh.name==="globe"||!!dh||this.transform.pitch>0,Eh),Ih=mr*yh.perspectiveRatio,Qu=(B.x1*E+Y.x-B.padding)*Ih+yh.point.x,bh=(B.y1*E+Y.y-B.padding)*Ih+yh.point.y,kh=(B.x2*E+Y.x+B.padding)*Ih+yh.point.x,Oh=(B.y2*E+Y.y+B.padding)*Ih+yh.point.y,rd=yh.perspectiveRatio<=.55||yh.occluded;return!this.isInsideGrid(Qu,bh,kh,Oh)||!vt&&this.grid.hitTest(Qu,bh,kh,Oh,Gn)||rd?{box:[],offscreen:!1,occluded:yh.occluded}:{box:[Qu,bh,kh,Oh],offscreen:this.isOffscreen(Qu,bh,kh,Oh),occluded:!1}}placeCollisionCircles(u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh){const Ih=[],Qu=this.transform.elevation,bh=u.getProjection(),kh=Qu?Qu.getAtTileOffsetFunc(yh,this.transform.center.lat,this.transform.worldSize,bh):null,Oh=new o.Point(B.tileAnchorX,B.tileAnchorY);let{x:rd,y:sd,z:ld}=bh.projectTilePoint(Oh.x,Oh.y,yh.canonical);if(kh){const[yf,zf,Pf]=kh(Oh);rd+=yf,sd+=zf,ld+=Pf}const dd=bh.name==="globe",ud=this.projectAndGetPerspectiveRatio(Ur,rd,sd,ld,yh,dd||!!Qu||this.transform.pitch>0,bh),{perspectiveRatio:md}=ud,Af=(Wu?mr/md:mr*md)/o.ONE_EM,Td=sg(rd,sd,ld,Gn),Gd=ud.signedDistanceFromCamera>0?s0(Af,vt,B.lineOffsetX*Af,B.lineOffsetY*Af,!1,Td,Oh,B,Y,Gn,{},Qu&&!Wu?kh:null,Wu&&!!Qu,bh,yh,Wu):null;let Od=!1,Lf=!1,Dd=!0;if(Gd&&!ud.occluded){const yf=.5*gh*md+Eh,zf=new o.Point(-100,-100),Pf=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Vf=new Nm,{first:Lp,last:Mp}=Gd,fp=Lp.path.length;let Fp=[];for(let kp=fp-1;kp>=1;kp--)Fp.push(Lp.path[kp]);for(let kp=1;kp<Mp.path.length;kp++)Fp.push(Mp.path[kp]);const cm=2.5*yf;$s&&(Fp=Fp.map(([kp,_m,Lm],Rm)=>(kh&&!dd&&(Lm=kh(Rm<fp-1?Lp.tilePath[fp-1-Rm]:Mp.tilePath[Rm-fp+2])[2]),sg(kp,_m,Lm,$s))),Fp.some(kp=>kp[3]<=0)&&(Fp=[]));let Jp=[];if(Fp.length>0){let kp=1/0,_m=-1/0,Lm=1/0,Rm=-1/0;for(const Vm of Fp)kp=Math.min(kp,Vm[0]),Lm=Math.min(Lm,Vm[1]),_m=Math.max(_m,Vm[0]),Rm=Math.max(Rm,Vm[1]);_m>=zf.x&&kp<=Pf.x&&Rm>=zf.y&&Lm<=Pf.y&&(Jp=[Fp.map(Vm=>new o.Point(Vm[0],Vm[1]))],(kp<zf.x||_m>Pf.x||Lm<zf.y||Rm>Pf.y)&&(Jp=o.clipLine(Jp,zf.x,zf.y,Pf.x,Pf.y)))}for(const kp of Jp){Vf.reset(kp,.25*yf);let _m=0;_m=Vf.length<=.5*yf?1:Math.ceil(Vf.paddedLength/cm)+1;for(let Lm=0;Lm<_m;Lm++){const Rm=Lm/Math.max(_m-1,1),Vm=Vf.lerp(Rm),i_=Vm.x+pd,qg=Vm.y+pd;Ih.push(i_,qg,yf,0);const ey=i_-yf,ty=qg-yf,pm=i_+yf,Om=qg+yf;if(Dd=Dd&&this.isOffscreen(ey,ty,pm,Om),Lf=Lf||this.isInsideGrid(ey,ty,pm,Om),!E&&this.grid.hitTestCircle(i_,qg,yf,dh)&&(Od=!0,!el))return{circles:[],offscreen:!1,collisionDetected:Od,occluded:!1}}}}return{circles:!el&&Od||!Lf?[]:Ih,offscreen:Dd,collisionDetected:Od,occluded:ud.occluded}}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const E=[];let B=1/0,Y=1/0,vt=-1/0,mr=-1/0;for(const el of u){const Wu=new o.Point(el.x+pd,el.y+pd);B=Math.min(B,Wu.x),Y=Math.min(Y,Wu.y),vt=Math.max(vt,Wu.x),mr=Math.max(mr,Wu.y),E.push(Wu)}const Ur=this.grid.query(B,Y,vt,mr).concat(this.ignoredGrid.query(B,Y,vt,mr)),Gn={},$s={};for(const el of Ur){const Wu=el.key;if(Gn[Wu.bucketInstanceId]===void 0&&(Gn[Wu.bucketInstanceId]={}),Gn[Wu.bucketInstanceId][Wu.featureIndex])continue;const dh=[new o.Point(el.x1,el.y1),new o.Point(el.x2,el.y1),new o.Point(el.x2,el.y2),new o.Point(el.x1,el.y2)];o.polygonIntersectsPolygon(E,dh)&&(Gn[Wu.bucketInstanceId][Wu.featureIndex]=!0,$s[Wu.bucketInstanceId]===void 0&&($s[Wu.bucketInstanceId]=[]),$s[Wu.bucketInstanceId].push(Wu.featureIndex))}return $s}insertCollisionBox(u,E,B,Y,vt){(E?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:Y,collisionGroupID:vt},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,E,B,Y,vt){const mr=E?this.ignoredGrid:this.grid,Ur={bucketInstanceId:B,featureIndex:Y,collisionGroupID:vt};for(let Gn=0;Gn<u.length;Gn+=4)mr.insertCircle(Ur,u[Gn],u[Gn+1],u[Gn+2])}projectAndGetPerspectiveRatio(u,E,B,Y,vt,mr,Ur){const Gn=[E,B,Y,1];let $s=!1;Y||this.transform.pitch>0?(o.transformMat4$1(Gn,Gn,u),this.fogState&&vt&&Ur.name!=="globe"&&($s=function(dh,gh,Eh,yh,Ih,Qu){const bh=Qu.calculateFogTileMatrix(Ih),kh=[gh,Eh,yh];return o.transformMat4(kh,kh,bh),vd(dh,kh,Qu.pitch,Qu._fov)}(this.fogState,E,B,Y,vt.toUnwrapped(),this.transform)>.9)):Wh(Gn,Gn,u);const el=Gn[3];return{point:new o.Point((Gn[0]/el+1)/2*this.transform.width+pd,(-Gn[1]/el+1)/2*this.transform.height+pd),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(Ur)/el*.5,1.5),signedDistanceFromCamera:el,occluded:mr&&Gn[2]>el||$s}}isOffscreen(u,E,B,Y){return B<pd||u>=this.screenRightBoundary||Y<pd||E>this.screenBottomBoundary}isInsideGrid(u,E,B,Y){return B>=0&&u<this.gridRightBoundary&&Y>=0&&E<this.gridBottomBoundary}getViewportMatrix(){const u=o.identity([]);return o.translate(u,u,[-100,-100,0]),u}}function Tf(L,u,E){const B=u.createTileMatrix(L,L.worldSize,E.toUnwrapped());return o.multiply(new Float32Array(16),L.projMatrix,B)}function rp(L,u,E){if(u.projection.name===E.projection.name)return L.projMatrix;const B=E.clone();return B.setProjection(u.projection),Tf(B,u.getProjection(),L)}function Gf(L,u,E){return u.name===E.projection.name?L.projMatrix:Tf(E,u,L)}class op{constructor(u,E,B,Y){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?E:-E))):Y&&B?1:0,this.placed=B}isHidden(){return this.opacity===0&&!this.placed}}class Vp{constructor(u,E,B,Y,vt,mr=!1){this.text=new op(u?u.text:null,E,B,vt),this.icon=new op(u?u.icon:null,E,Y,vt),this.clipped=mr}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sm{constructor(u,E,B,Y=!1){this.text=u,this.icon=E,this.skipFade=B,this.clipped=Y}}class Xp{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Dm{constructor(u,E,B,Y,vt){this.bucketInstanceId=u,this.featureIndex=E,this.sourceLayerIndex=B,this.bucketIndex=Y,this.tileID=vt}}class Mf{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const E=++this.maxGroupID;this.collisionGroups[u]={ID:E,predicate:B=>B.collisionGroupID===E}}return this.collisionGroups[u]}}function Cp(L,u,E,B,Y){const{horizontalAlign:vt,verticalAlign:mr}=o.getAnchorAlignment(L),Ur=-(vt-.5)*u,Gn=-(mr-.5)*E,$s=o.evaluateVariableOffset(L,B);return new o.Point(Ur+$s[0]*Y,Gn+$s[1]*Y)}function Kp(L,u,E,B,Y){const vt=new o.Point(L,u);return E&&vt._rotate(B?Y:-Y),vt}class Ym{constructor(u,E,B,Y,vt){this.transform=u.clone(),this.projection=u.projection.name,this.collisionIndex=new $f(this.transform,vt),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=E,this.retainedQueryData={},this.collisionGroups=new Mf(B),this.collisionCircleArrays={},this.prevPlacement=Y,Y&&(Y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(u,E,B,Y){const vt=B.getBucket(E),mr=B.latestFeatureIndex;if(!vt||!mr||E.id!==vt.layerIds[0])return;const Ur=vt.layers[0].layout,Gn=B.collisionBoxArray,$s=Math.pow(2,this.transform.zoom-B.tileID.overscaledZ),el=B.tileSize/o.EXTENT,Wu=B.tileID.toUnwrapped();this.transform.setProjection(vt.projection);const dh=(gh=B.tileID,Eh=vt.getProjection(),yh=this.transform,Eh.name===this.projection?yh.calculateProjMatrix(gh.toUnwrapped()):Tf(yh,Eh,gh));var gh,Eh,yh;const Ih=Ur.get("text-pitch-alignment")==="map",Qu=Ur.get("text-rotation-alignment")==="map";E.compileFilter();const bh=E.dynamicFilter(),kh=E.dynamicFilterNeedsFeature(),Oh=this.transform.calculatePixelsToTileUnitsMatrix(B),rd=Mg(dh,B.tileID.canonical,Ih,Qu,this.transform,vt.getProjection(),Oh);let sd=null;if(Ih){const ud=km(dh,B.tileID.canonical,Ih,Qu,this.transform,vt.getProjection(),Oh);sd=o.multiply([],this.transform.labelPlaneMatrix,ud)}let ld=null;bh&&B.latestFeatureIndex&&(ld={unwrappedTileID:Wu,dynamicFilter:bh,dynamicFilterNeedsFeature:kh,featureIndex:B.latestFeatureIndex}),this.retainedQueryData[vt.bucketInstanceId]=new Dm(vt.bucketInstanceId,mr,vt.sourceLayerIndex,vt.index,B.tileID);const dd={bucket:vt,layout:Ur,posMatrix:dh,textLabelPlaneMatrix:rd,labelToScreenMatrix:sd,clippingData:ld,scale:$s,textPixelRatio:el,holdingForFade:B.holdingForFade(),collisionBoxArray:Gn,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(vt.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(vt.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(vt.sourceID)};if(Y)for(const ud of vt.sortKeyRanges){const{sortKey:md,symbolInstanceStart:Af,symbolInstanceEnd:Td}=ud;u.push({sortKey:md,symbolInstanceStart:Af,symbolInstanceEnd:Td,parameters:dd})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:vt.symbolInstances.length,parameters:dd})}attemptAnchorPlacement(u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh,Ih,Qu,bh){const{textOffset0:kh,textOffset1:Oh,crossTileID:rd}=dh,sd=[kh,Oh],ld=Cp(u,B,Y,sd,vt),dd=this.collisionIndex.placeCollisionBox(Eh,vt,E,Kp(ld.x,ld.y,mr,Ur,this.transform.angle),Wu,Gn,$s,el.predicate);if(Ih){const ud=Eh.getSymbolInstanceIconSize(bh,this.transform.zoom,dh.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Eh,ud,Ih,Kp(ld.x,ld.y,mr,Ur,this.transform.angle),Wu,Gn,$s,el.predicate).box.length===0)return}if(dd.box.length>0){let ud;return this.prevPlacement&&this.prevPlacement.variableOffsets[rd]&&this.prevPlacement.placements[rd]&&this.prevPlacement.placements[rd].text&&(ud=this.prevPlacement.variableOffsets[rd].anchor),this.variableOffsets[rd]={textOffset:sd,width:B,height:Y,anchor:u,textScale:vt,prevAnchor:ud},this.markUsedJustification(Eh,u,dh,yh),Eh.allowVerticalPlacement&&(this.markUsedOrientation(Eh,yh,dh),this.placedOrientations[rd]=yh),{shift:ld,placedGlyphBoxes:dd}}}placeLayerBucketPart(u,E,B,Y){const{bucket:vt,layout:mr,posMatrix:Ur,textLabelPlaneMatrix:Gn,labelToScreenMatrix:$s,clippingData:el,textPixelRatio:Wu,holdingForFade:dh,collisionBoxArray:gh,partiallyEvaluatedTextSize:Eh,partiallyEvaluatedIconSize:yh,collisionGroup:Ih}=u.parameters,Qu=mr.get("text-optional"),bh=mr.get("icon-optional"),kh=mr.get("text-allow-overlap"),Oh=mr.get("icon-allow-overlap"),rd=mr.get("text-rotation-alignment")==="map",sd=mr.get("text-pitch-alignment")==="map",ld=mr.get("icon-text-fit")!=="none",dd=mr.get("symbol-z-order")==="viewport-y";this.transform.setProjection(vt.projection);let ud=kh&&(Oh||!vt.hasIconData()||bh),md=Oh&&(kh||!vt.hasTextData()||Qu);!vt.collisionArrays&&gh&&vt.deserializeCollisionBoxes(gh),B&&Y&&vt.updateCollisionDebugBuffers(this.transform.zoom,gh);const Af=(Td,Gd,Od)=>{const{crossTileID:Lf,numVerticalGlyphVertices:Dd}=Td;if(el){const pm={zoom:this.transform.zoom,pitch:this.transform.pitch};let Om=null;if(el.dynamicFilterNeedsFeature){const vm=this.retainedQueryData[vt.bucketInstanceId];Om=el.featureIndex.loadFeature({featureIndex:Td.featureIndex,bucketIndex:vm.bucketIndex,sourceLayerIndex:vm.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,el.dynamicFilter)(pm,Om,this.retainedQueryData[vt.bucketInstanceId].tileID.canonical,new o.Point(Td.tileAnchorX,Td.tileAnchorY),this.transform.calculateDistanceTileData(el.unwrappedTileID)))return this.placements[Lf]=new Sm(!1,!1,!1,!0),void E.add(Lf)}if(E.has(Lf))return;if(dh)return void(this.placements[Lf]=new Sm(!1,!1,!1));let yf=!1,zf=!1,Pf=!0,Vf=!1,Lp=!1,Mp=null,fp={box:null,offscreen:null,occluded:null},Fp={box:null,offscreen:null,occluded:null},cm=null,Jp=null,kp=null,_m=0,Lm=0,Rm=0;Od.textFeatureIndex?_m=Od.textFeatureIndex:Td.useRuntimeCollisionCircles&&(_m=Td.featureIndex),Od.verticalTextFeatureIndex&&(Lm=Od.verticalTextFeatureIndex);const Vm=pm=>{pm.tileID=this.retainedQueryData[vt.bucketInstanceId].tileID;const Om=this.transform.elevation;(Om||pm.elevation)&&(pm.elevation=Om?Om.getAtTileOffset(pm.tileID,pm.tileAnchorX,pm.tileAnchorY):0)},i_=Od.textBox;if(i_){Vm(i_);const pm=vm=>{let kg=o.WritingMode.horizontal;if(vt.allowVerticalPlacement&&!vm&&this.prevPlacement){const N_=this.prevPlacement.placedOrientations[Lf];N_&&(this.placedOrientations[Lf]=N_,kg=N_,this.markUsedOrientation(vt,kg,Td))}return kg},Om=(vm,kg)=>{if(vt.allowVerticalPlacement&&Dd>0&&Od.verticalTextBox){for(const N_ of vt.writingModes)if(N_===o.WritingMode.vertical?(fp=kg(),Fp=fp):fp=vm(),fp&&fp.box&&fp.box.length)break}else fp=vm()};if(mr.get("text-variable-anchor")){let vm=mr.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lf]){const $m=this.prevPlacement.variableOffsets[Lf];vm.indexOf($m.anchor)>0&&(vm=vm.filter(u_=>u_!==$m.anchor),vm.unshift($m.anchor))}const kg=($m,u_,l1)=>{const gy=vt.getSymbolInstanceTextSize(Eh,Td,this.transform.zoom,Gd),O0=($m.x2-$m.x1)*gy+2*$m.padding,$0=($m.y2-$m.y1)*gy+2*$m.padding,nv=ld&&!Oh?u_:null;nv&&Vm(nv);let Tv={box:[],offscreen:!1,occluded:!1};const I1=kh?2*vm.length:vm.length;for(let c1=0;c1<I1;++c1){const tx=this.attemptAnchorPlacement(vm[c1%vm.length],$m,O0,$0,gy,rd,sd,Wu,Ur,Ih,c1>=vm.length,Td,Gd,vt,l1,nv,Eh,yh);if(tx&&(Tv=tx.placedGlyphBoxes,Tv&&Tv.box&&Tv.box.length)){yf=!0,Mp=tx.shift;break}}return Tv};Om(()=>kg(i_,Od.iconBox,o.WritingMode.horizontal),()=>{const $m=Od.verticalTextBox;return $m&&Vm($m),vt.allowVerticalPlacement&&!(fp&&fp.box&&fp.box.length)&&Dd>0&&$m?kg($m,Od.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),fp&&(yf=fp.box,Pf=fp.offscreen,Vf=fp.occluded);const N_=pm(!(!fp||!fp.box));if(!yf&&this.prevPlacement){const $m=this.prevPlacement.variableOffsets[Lf];$m&&(this.variableOffsets[Lf]=$m,this.markUsedJustification(vt,$m.anchor,Td,N_))}}else{const vm=(kg,N_)=>{const $m=vt.getSymbolInstanceTextSize(Eh,Td,this.transform.zoom,Gd),u_=this.collisionIndex.placeCollisionBox(vt,$m,kg,new o.Point(0,0),kh,Wu,Ur,Ih.predicate);return u_&&u_.box&&u_.box.length&&(this.markUsedOrientation(vt,N_,Td),this.placedOrientations[Lf]=N_),u_};Om(()=>vm(i_,o.WritingMode.horizontal),()=>{const kg=Od.verticalTextBox;return vt.allowVerticalPlacement&&Dd>0&&kg?(Vm(kg),vm(kg,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),pm(!!(fp&&fp.box&&fp.box.length))}}if(cm=fp,yf=cm&&cm.box&&cm.box.length>0,Pf=cm&&cm.offscreen,Vf=cm&&cm.occluded,Td.useRuntimeCollisionCircles){const pm=vt.text.placedSymbolArray.get(Td.centerJustifiedTextSymbolIndex>=0?Td.centerJustifiedTextSymbolIndex:Td.verticalPlacedTextSymbolIndex),Om=o.evaluateSizeForFeature(vt.textSizeData,Eh,pm),vm=mr.get("text-padding");Jp=this.collisionIndex.placeCollisionCircles(vt,kh,pm,vt.lineVertexArray,vt.glyphOffsetArray,Om,Ur,Gn,$s,B,sd,Ih.predicate,Td.collisionCircleDiameter*Om/o.ONE_EM,vm,this.retainedQueryData[vt.bucketInstanceId].tileID),yf=kh||Jp.circles.length>0&&!Jp.collisionDetected,Pf=Pf&&Jp.offscreen,Vf=Jp.occluded}if(Od.iconFeatureIndex&&(Rm=Od.iconFeatureIndex),Od.iconBox){const pm=Om=>{Vm(Om);const vm=ld&&Mp?Kp(Mp.x,Mp.y,rd,sd,this.transform.angle):new o.Point(0,0),kg=vt.getSymbolInstanceIconSize(yh,this.transform.zoom,Td.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(vt,kg,Om,vm,Oh,Wu,Ur,Ih.predicate)};Fp&&Fp.box&&Fp.box.length&&Od.verticalIconBox?(kp=pm(Od.verticalIconBox),zf=kp.box.length>0):(kp=pm(Od.iconBox),zf=kp.box.length>0),Pf=Pf&&kp.offscreen,Lp=kp.occluded}const qg=Qu||Td.numHorizontalGlyphVertices===0&&Dd===0,ey=bh||Td.numIconVertices===0;if(qg||ey?ey?qg||(zf=zf&&yf):yf=zf&&yf:zf=yf=zf&&yf,yf&&cm&&cm.box&&this.collisionIndex.insertCollisionBox(cm.box,mr.get("text-ignore-placement"),vt.bucketInstanceId,Fp&&Fp.box&&Lm?Lm:_m,Ih.ID),zf&&kp&&this.collisionIndex.insertCollisionBox(kp.box,mr.get("icon-ignore-placement"),vt.bucketInstanceId,Rm,Ih.ID),Jp&&(yf&&this.collisionIndex.insertCollisionCircles(Jp.circles,mr.get("text-ignore-placement"),vt.bucketInstanceId,_m,Ih.ID),B)){const pm=vt.bucketInstanceId;let Om=this.collisionCircleArrays[pm];Om===void 0&&(Om=this.collisionCircleArrays[pm]=new Xp);for(let vm=0;vm<Jp.circles.length;vm+=4)Om.circles.push(Jp.circles[vm+0]),Om.circles.push(Jp.circles[vm+1]),Om.circles.push(Jp.circles[vm+2]),Om.circles.push(Jp.collisionDetected?1:0)}const ty=vt.projection.name!=="globe";ud=ud&&(ty||!Vf),md=md&&(ty||!Lp),this.placements[Lf]=new Sm(yf||ud,zf||md,Pf||vt.justReloaded),E.add(Lf)};if(dd){const Td=vt.getSortedSymbolIndexes(this.transform.angle);for(let Gd=Td.length-1;Gd>=0;--Gd){const Od=Td[Gd];Af(vt.symbolInstances.get(Od),Od,vt.collisionArrays[Od])}}else for(let Td=u.symbolInstanceStart;Td<u.symbolInstanceEnd;Td++)Af(vt.symbolInstances.get(Td),Td,vt.collisionArrays[Td]);if(B&&vt.bucketInstanceId in this.collisionCircleArrays){const Td=this.collisionCircleArrays[vt.bucketInstanceId];o.invert(Td.invProjMatrix,Ur),Td.viewportMatrix=this.collisionIndex.getViewportMatrix()}vt.justReloaded=!1}markUsedJustification(u,E,B,Y){const{leftJustifiedTextSymbolIndex:vt,centerJustifiedTextSymbolIndex:mr,rightJustifiedTextSymbolIndex:Ur,verticalPlacedTextSymbolIndex:Gn,crossTileID:$s}=B,el=o.getAnchorJustification(E),Wu=Y===o.WritingMode.vertical?Gn:el==="left"?vt:el==="center"?mr:el==="right"?Ur:-1;vt>=0&&(u.text.placedSymbolArray.get(vt).crossTileID=Wu>=0&&vt!==Wu?0:$s),mr>=0&&(u.text.placedSymbolArray.get(mr).crossTileID=Wu>=0&&mr!==Wu?0:$s),Ur>=0&&(u.text.placedSymbolArray.get(Ur).crossTileID=Wu>=0&&Ur!==Wu?0:$s),Gn>=0&&(u.text.placedSymbolArray.get(Gn).crossTileID=Wu>=0&&Gn!==Wu?0:$s)}markUsedOrientation(u,E,B){const Y=E===o.WritingMode.horizontal||E===o.WritingMode.horizontalOnly?E:0,vt=E===o.WritingMode.vertical?E:0,{leftJustifiedTextSymbolIndex:mr,centerJustifiedTextSymbolIndex:Ur,rightJustifiedTextSymbolIndex:Gn,verticalPlacedTextSymbolIndex:$s}=B,el=u.text.placedSymbolArray;mr>=0&&(el.get(mr).placedOrientation=Y),Ur>=0&&(el.get(Ur).placedOrientation=Y),Gn>=0&&(el.get(Gn).placedOrientation=Y),$s>=0&&(el.get($s).placedOrientation=vt)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const E=this.prevPlacement;let B=!1;this.prevZoomAdjustment=E?E.zoomAdjustment(this.transform.zoom):0;const Y=E?E.symbolFadeChange(u):1,vt=E?E.opacities:{},mr=E?E.variableOffsets:{},Ur=E?E.placedOrientations:{};for(const Gn in this.placements){const $s=this.placements[Gn],el=vt[Gn];el?(this.opacities[Gn]=new Vp(el,Y,$s.text,$s.icon,null,$s.clipped),B=B||$s.text!==el.text.placed||$s.icon!==el.icon.placed):(this.opacities[Gn]=new Vp(null,Y,$s.text,$s.icon,$s.skipFade,$s.clipped),B=B||$s.text||$s.icon)}for(const Gn in vt){const $s=vt[Gn];if(!this.opacities[Gn]){const el=new Vp($s,Y,!1,!1);el.isHidden()||(this.opacities[Gn]=el,B=B||$s.text.placed||$s.icon.placed)}}for(const Gn in mr)this.variableOffsets[Gn]||!this.opacities[Gn]||this.opacities[Gn].isHidden()||(this.variableOffsets[Gn]=mr[Gn]);for(const Gn in Ur)this.placedOrientations[Gn]||!this.opacities[Gn]||this.opacities[Gn].isHidden()||(this.placedOrientations[Gn]=Ur[Gn]);B?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=E?E.lastPlacementChangeTime:u)}updateLayerOpacities(u,E){const B=new Set;for(const Y of E){const vt=Y.getBucket(u);vt&&Y.latestFeatureIndex&&u.id===vt.layerIds[0]&&this.updateBucketOpacities(vt,B,Y.collisionBoxArray)}}updateBucketOpacities(u,E,B){u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const Y=u.layers[0].layout,vt=!!u.layers[0].dynamicFilter(),mr=new Vp(null,0,!1,!1,!0),Ur=Y.get("text-allow-overlap"),Gn=Y.get("icon-allow-overlap"),$s=Y.get("text-variable-anchor"),el=Y.get("text-rotation-alignment")==="map",Wu=Y.get("text-pitch-alignment")==="map",dh=Y.get("icon-text-fit")!=="none",gh=new Vp(null,0,Ur&&(Gn||!u.hasIconData()||Y.get("icon-optional")),Gn&&(Ur||!u.hasTextData()||Y.get("text-optional")),!0);!u.collisionArrays&&B&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(B);const Eh=(Ih,Qu,bh)=>{for(let kh=0;kh<Qu/4;kh++)Ih.opacityVertexArray.emplaceBack(bh)};let yh=0;for(let Ih=0;Ih<u.symbolInstances.length;Ih++){const Qu=u.symbolInstances.get(Ih),{numHorizontalGlyphVertices:bh,numVerticalGlyphVertices:kh,crossTileID:Oh,numIconVertices:rd}=Qu,sd=E.has(Oh);let ld=this.opacities[Oh];sd?ld=mr:ld||(ld=gh,this.opacities[Oh]=ld),E.add(Oh);const dd=bh>0||kh>0,ud=rd>0,md=this.placedOrientations[Oh],Af=md===o.WritingMode.vertical,Td=md===o.WritingMode.horizontal||md===o.WritingMode.horizontalOnly;if(!dd&&!ud||ld.isHidden()||yh++,dd){const Gd=Vy(ld.text);Eh(u.text,bh,Af?zm:Gd),Eh(u.text,kh,Td?zm:Gd);const Od=ld.text.isHidden(),{leftJustifiedTextSymbolIndex:Lf,centerJustifiedTextSymbolIndex:Dd,rightJustifiedTextSymbolIndex:yf,verticalPlacedTextSymbolIndex:zf}=Qu,Pf=u.text.placedSymbolArray,Vf=Od||Af?1:0;Lf>=0&&(Pf.get(Lf).hidden=Vf),Dd>=0&&(Pf.get(Dd).hidden=Vf),yf>=0&&(Pf.get(yf).hidden=Vf),zf>=0&&(Pf.get(zf).hidden=Od||Td?1:0);const Lp=this.variableOffsets[Oh];Lp&&this.markUsedJustification(u,Lp.anchor,Qu,md);const Mp=this.placedOrientations[Oh];Mp&&(this.markUsedJustification(u,"left",Qu,Mp),this.markUsedOrientation(u,Mp,Qu))}if(ud){const Gd=Vy(ld.icon),{placedIconSymbolIndex:Od,verticalPlacedIconSymbolIndex:Lf}=Qu,Dd=u.icon.placedSymbolArray,yf=ld.icon.isHidden()?1:0;Od>=0&&(Eh(u.icon,rd,Af?zm:Gd),Dd.get(Od).hidden=yf),Lf>=0&&(Eh(u.icon,Qu.numVerticalIconVertices,Td?zm:Gd),Dd.get(Lf).hidden=yf)}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const Gd=u.collisionArrays[Ih];if(Gd){let Od=new o.Point(0,0),Lf=!0;if(Gd.textBox||Gd.verticalTextBox){if($s){const yf=this.variableOffsets[Oh];yf?(Od=Cp(yf.anchor,yf.width,yf.height,yf.textOffset,yf.textScale),el&&Od._rotate(Wu?this.transform.angle:-this.transform.angle)):Lf=!1}vt&&(Lf=!ld.clipped),Gd.textBox&&Mm(u.textCollisionBox.collisionVertexArray,ld.text.placed,!Lf||Af,Od.x,Od.y),Gd.verticalTextBox&&Mm(u.textCollisionBox.collisionVertexArray,ld.text.placed,!Lf||Td,Od.x,Od.y)}const Dd=Lf&&!!(!Td&&Gd.verticalIconBox);Gd.iconBox&&Mm(u.iconCollisionBox.collisionVertexArray,ld.icon.placed,Dd,dh?Od.x:0,dh?Od.y:0),Gd.verticalIconBox&&Mm(u.iconCollisionBox.collisionVertexArray,ld.icon.placed,!Dd,dh?Od.x:0,dh?Od.y:0)}}}if(u.fullyClipped=yh===0,u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){const Ih=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=Ih.invProjMatrix,u.placementViewportMatrix=Ih.viewportMatrix,u.collisionCircleArray=Ih.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,E){const B=this.zoomAtLastRecencyCheck===E?1-this.zoomAdjustment(E):1;return this.zoomAtLastRecencyCheck=E,this.commitTime+this.fadeDuration*B>u}setStale(){this.stale=!0}}function Mm(L,u,E,B,Y){L.emplaceBack(u?1:0,E?1:0,B||0,Y||0),L.emplaceBack(u?1:0,E?1:0,B||0,Y||0),L.emplaceBack(u?1:0,E?1:0,B||0,Y||0),L.emplaceBack(u?1:0,E?1:0,B||0,Y||0)}const lg=Math.pow(2,25),jm=Math.pow(2,24),Tm=Math.pow(2,17),Uy=Math.pow(2,16),vg=Math.pow(2,9),ng=Math.pow(2,8),l0=Math.pow(2,1);function Vy(L){if(L.opacity===0&&!L.placed)return 0;if(L.opacity===1&&L.placed)return 4294967295;const u=L.placed?1:0,E=Math.floor(127*L.opacity);return E*lg+u*jm+E*Tm+u*Uy+E*vg+u*ng+E*l0+u}const zm=0;class s_{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(u,E,B,Y,vt){const mr=this._bucketParts;for(;this._currentTileIndex<u.length;)if(E.getBucketParts(mr,Y,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,vt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,mr.sort((Ur,Gn)=>Ur.sortKey-Gn.sortKey));this._currentPartIndex<mr.length;){const Ur=mr[this._currentPartIndex];if(E.placeLayerBucketPart(Ur,this._seenCrossTileIDs,B,Ur.symbolInstanceStart===0),this._currentPartIndex++,vt())return!0}return!1}}class j0{constructor(u,E,B,Y,vt,mr,Ur,Gn){this.placement=new Ym(u,vt,mr,Ur,Gn),this._currentPlacementIndex=E.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=Y,this._done=!1}isDone(){return this._done}continuePlacement(u,E,B){const Y=o.exported.now(),vt=()=>{const mr=o.exported.now()-Y;return!this._forceFullPlacement&&mr>2};for(;this._currentPlacementIndex>=0;){const mr=E[u[this._currentPlacementIndex]],Ur=this.placement.collisionIndex.transform.zoom;if(mr.type==="symbol"&&(!mr.minzoom||mr.minzoom<=Ur)&&(!mr.maxzoom||mr.maxzoom>Ur)){if(this._inProgressLayer||(this._inProgressLayer=new s_(mr)),this._inProgressLayer.continuePlacement(B[mr.source],this.placement,this._showCollisionBoxes,mr,vt))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const Ey=512/o.EXTENT/2;class xg{constructor(u,E,B){this.tileID=u,this.bucketInstanceId=B,this.index=new o.KDBush(E.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const Y=u.canonical.x*o.EXTENT,vt=u.canonical.y*o.EXTENT;for(let mr=0;mr<E.length;mr++){const{key:Ur,crossTileID:Gn,tileAnchorX:$s,tileAnchorY:el}=E.get(mr),Wu=Math.floor((Y+$s)*Ey),dh=Math.floor((vt+el)*Ey);this.index.add(Wu,dh),this.keys.push(Ur),this.crossTileIDs.push(Gn)}this.index.finish()}findMatches(u,E,B){const Y=this.tileID.canonical.z<E.canonical.z?1:Math.pow(2,this.tileID.canonical.z-E.canonical.z),vt=Ey/Math.pow(2,E.canonical.z-this.tileID.canonical.z),mr=E.canonical.x*o.EXTENT,Ur=E.canonical.y*o.EXTENT;for(let Gn=0;Gn<u.length;Gn++){const $s=u.get(Gn);if($s.crossTileID)continue;const{key:el,tileAnchorX:Wu,tileAnchorY:dh}=$s,gh=Math.floor((mr+Wu)*vt),Eh=Math.floor((Ur+dh)*vt),yh=this.index.range(gh-Y,Eh-Y,gh+Y,Eh+Y);for(const Ih of yh){const Qu=this.crossTileIDs[Ih];if(this.keys[Ih]===el&&!B.has(Qu)){B.add(Qu),$s.crossTileID=Qu;break}}}}}class q0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const E=Math.round((u-this.lng)/360);if(E!==0)for(const B in this.indexes){const Y=this.indexes[B],vt={};for(const mr in Y){const Ur=Y[mr];Ur.tileID=Ur.tileID.unwrapTo(Ur.tileID.wrap+E),vt[Ur.tileID.key]=Ur}this.indexes[B]=vt}this.lng=u}addBucket(u,E,B){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===E.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let vt=0;vt<E.symbolInstances.length;vt++)E.symbolInstances.get(vt).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]=new Set);const Y=this.usedCrossTileIDs[u.overscaledZ];for(const vt in this.indexes){const mr=this.indexes[vt];if(Number(vt)>u.overscaledZ)for(const Ur in mr){const Gn=mr[Ur];Gn.tileID.isChildOf(u)&&Gn.findMatches(E.symbolInstances,u,Y)}else{const Ur=mr[u.scaledTo(Number(vt)).key];Ur&&Ur.findMatches(E.symbolInstances,u,Y)}}for(let vt=0;vt<E.symbolInstances.length;vt++){const mr=E.symbolInstances.get(vt);mr.crossTileID||(mr.crossTileID=B.generate(),Y.add(mr.crossTileID))}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new xg(u,E.symbolInstances,E.bucketInstanceId),!0}removeBucketCrossTileIDs(u,E){for(const B of E.crossTileIDs)this.usedCrossTileIDs[u].delete(B)}removeStaleBuckets(u){let E=!1;for(const B in this.indexes){const Y=this.indexes[B];for(const vt in Y)u[Y[vt].bucketInstanceId]||(this.removeBucketCrossTileIDs(B,Y[vt]),delete Y[vt],E=!0)}return E}}class G_{constructor(){this.layerIndexes={},this.crossTileIDs=new q0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,E,B,Y){let vt=this.layerIndexes[u.id];vt===void 0&&(vt=this.layerIndexes[u.id]=new fv);let mr=!1;const Ur={};Y.name!=="globe"&&vt.handleWrapJump(B);for(const Gn of E){const $s=Gn.getBucket(u);$s&&u.id===$s.layerIds[0]&&($s.bucketInstanceId||($s.bucketInstanceId=++this.maxBucketInstanceId),vt.addBucket(Gn.tileID,$s,this.crossTileIDs)&&(mr=!0),Ur[$s.bucketInstanceId]=!0)}return vt.removeStaleBuckets(Ur)&&(mr=!0),mr}pruneUnusedLayers(u){const E={};u.forEach(B=>{E[B]=!0});for(const B in this.layerIndexes)E[B]||delete this.layerIndexes[B]}}const P_=(L,u)=>o.emitValidationErrors(L,u&&u.filter(E=>E.identifier!=="source.canvas")),Sy=o.pick(Ip,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),pv=o.pick(Ip,["setCenter","setZoom","setBearing","setPitch"]),S0={version:8,layers:[],sources:{}},Jg={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Wp extends o.Evented{constructor(u,E={}){super(),this.map=u,this.dispatcher=new Sd(ap(),this),this.imageManager=new oh,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(u._requestManager,E.localFontFamily?o.LocalGlyphMode.all:E.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,E.localFontFamily||E.localIdeographFontFamily),this.crossTileSymbolIndex=new G_,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const B=this;this._rtlTextPluginCallback=Wp.registerForPluginStateChange(Y=>{B.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:Y.pluginStatus,pluginURL:Y.pluginURL},(vt,mr)=>{if(o.triggerPluginCompletionEvent(vt),mr&&mr.every(Ur=>Ur))for(const Ur in B._sourceCaches){const Gn=B._sourceCaches[Ur],$s=Gn.getSource().type;$s!=="vector"&&$s!=="geojson"||Gn.reload()}})}),this.on("data",Y=>{if(Y.dataType!=="source"||Y.sourceDataType!=="metadata")return;const vt=this.getSource(Y.sourceId);if(vt&&vt.vectorLayerIds)for(const mr in this._layers){const Ur=this._layers[mr];Ur.source===vt.id&&this._validateLayer(Ur)}})}loadURL(u,E={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const B=typeof E.validate=="boolean"?E.validate:!o.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,E.accessToken);const Y=this.map._requestManager.transformRequest(u,o.ResourceType.Style);this._request=o.getJSON(Y,(vt,mr)=>{this._request=null,vt?this.fire(new o.ErrorEvent(vt)):mr&&this._load(mr,B)})}loadJSON(u,E={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(u,E.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(S0,!1)}_updateLayerCount(u,E){const B=E?1:-1;u.is3D()&&(this._num3DLayers+=B),u.type==="circle"&&(this._numCircleLayers+=B),u.type==="symbol"&&(this._numSymbolLayers+=B)}_load(u,E){if(E&&P_(this,o.validateStyle(u)))return;this._loaded=!0,this.stylesheet=o.clone$1(u),this._updateMapProjection();for(const Y in u.sources)this.addSource(Y,u.sources[Y],{validate:!1});this._changed=!1,u.sprite?this._loadSprite(u.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(u.glyphs);const B=Hp(this.stylesheet.layers);this._order=B.map(Y=>Y.id),this._layers={},this._serializedLayers={};for(const Y of B){const vt=o.createStyleLayer(Y);vt.setEventedParent(this,{layer:{id:vt.id}}),this._layers[vt.id]=vt,this._serializedLayers[vt.id]=vt.serialize(),this._updateLayerCount(vt,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Sh(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(u){u?this.stylesheet.projection=u:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(u){this._spriteRequest=function(E,B,Y){let vt,mr,Ur;const Gn=o.exported.devicePixelRatio>1?"@2x":"";let $s=o.getJSON(B.transformRequest(B.normalizeSpriteURL(E,Gn,".json"),o.ResourceType.SpriteJSON),(dh,gh)=>{$s=null,Ur||(Ur=dh,vt=gh,Wu())}),el=o.getImage(B.transformRequest(B.normalizeSpriteURL(E,Gn,".png"),o.ResourceType.SpriteImage),(dh,gh)=>{el=null,Ur||(Ur=dh,mr=gh,Wu())});function Wu(){if(Ur)Y(Ur);else if(vt&&mr){const dh=o.exported.getImageData(mr),gh={};for(const Eh in vt){const{width:yh,height:Ih,x:Qu,y:bh,sdf:kh,pixelRatio:Oh,stretchX:rd,stretchY:sd,content:ld}=vt[Eh],dd=new o.RGBAImage({width:yh,height:Ih});o.RGBAImage.copy(dh,dd,{x:Qu,y:bh},{x:0,y:0},{width:yh,height:Ih}),gh[Eh]={data:dd,pixelRatio:Oh,sdf:kh,stretchX:rd,stretchY:sd,content:ld}}Y(null,gh)}}return{cancel(){$s&&($s.cancel(),$s=null),el&&(el.cancel(),el=null)}}}(u,this.map._requestManager,(E,B)=>{if(this._spriteRequest=null,E)this.fire(new o.ErrorEvent(E));else if(B)for(const Y in B)this.imageManager.addImage(Y,B[Y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(u){const E=this.getSource(u.source);if(!E)return;const B=u.sourceLayer;B&&(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(B)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${B}" does not exist on source "${E.id}" as specified by style layer "${u.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const u in this._sourceCaches)if(!this._sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(u){const E=[];for(const B of u){const Y=this._layers[B];Y.type!=="custom"&&E.push(Y.serialize())}return E}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const u in this._sourceCaches)if(this._sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(u){return!!this.terrain&&(typeof u.isLayerDraped=="function"?u.isLayerDraped():Jg[u.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(u){if(!this._loaded)return;const E=this._changed;if(this._changed){const Y=Object.keys(this._updatedLayers),vt=Object.keys(this._removedLayers);(Y.length||vt.length)&&this._updateWorkerLayers(Y,vt);for(const mr in this._updatedSources){const Ur=this._updatedSources[mr];Ur==="reload"?this._reloadSource(mr):Ur==="clear"&&this._clearSource(mr)}this._updateTilesForChangedImages();for(const mr in this._updatedPaintProps)this._layers[mr].updateTransitions(u);this.light.updateTransitions(u),this.fog&&this.fog.updateTransitions(u),this._resetUpdates()}const B={};for(const Y in this._sourceCaches){const vt=this._sourceCaches[Y];B[Y]=vt.used,vt.used=!1}for(const Y of this._order){const vt=this._layers[Y];if(vt.recalculate(u,this._availableImages),!vt.isHidden(u.zoom)){const Ur=this._getLayerSourceCache(vt);Ur&&(Ur.used=!0)}const mr=this.map.painter;if(mr){const Ur=vt.getProgramIds();if(!Ur)continue;const Gn=vt.getProgramConfiguration(u.zoom);for(const $s of Ur)mr.useProgram($s,Gn)}}for(const Y in B){const vt=this._sourceCaches[Y];B[Y]!==vt.used&&vt.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:vt.getSource().id}))}this.light.recalculate(u),this.terrain&&this.terrain.recalculate(u),this.fog&&this.fog.recalculate(u),this.z=u.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),E&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const E in this._sourceCaches)this._sourceCaches[E].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateWorkerLayers(u,E){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:E})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(u){if(this._checkLoaded(),P_(this,o.validateStyle(u)))return!1;(u=o.clone$1(u)).layers=Hp(u.layers);const E=function(Y,vt){if(!Y)return[{command:Ip.setStyle,args:[vt]}];let mr=[];try{if(!x(Y.version,vt.version))return[{command:Ip.setStyle,args:[vt]}];x(Y.center,vt.center)||mr.push({command:Ip.setCenter,args:[vt.center]}),x(Y.zoom,vt.zoom)||mr.push({command:Ip.setZoom,args:[vt.zoom]}),x(Y.bearing,vt.bearing)||mr.push({command:Ip.setBearing,args:[vt.bearing]}),x(Y.pitch,vt.pitch)||mr.push({command:Ip.setPitch,args:[vt.pitch]}),x(Y.sprite,vt.sprite)||mr.push({command:Ip.setSprite,args:[vt.sprite]}),x(Y.glyphs,vt.glyphs)||mr.push({command:Ip.setGlyphs,args:[vt.glyphs]}),x(Y.transition,vt.transition)||mr.push({command:Ip.setTransition,args:[vt.transition]}),x(Y.light,vt.light)||mr.push({command:Ip.setLight,args:[vt.light]}),x(Y.fog,vt.fog)||mr.push({command:Ip.setFog,args:[vt.fog]}),x(Y.projection,vt.projection)||mr.push({command:Ip.setProjection,args:[vt.projection]});const Ur={},Gn=[];(function(Wu,dh,gh,Eh){let yh;for(yh in dh=dh||{},Wu=Wu||{})Wu.hasOwnProperty(yh)&&(dh.hasOwnProperty(yh)||Nf(yh,gh,Eh));for(yh in dh){if(!dh.hasOwnProperty(yh))continue;const Ih=dh[yh];Wu.hasOwnProperty(yh)?x(Wu[yh],Ih)||(Wu[yh].type==="geojson"&&Ih.type==="geojson"&&mp(Wu,dh,yh)?gh.push({command:Ip.setGeoJSONSourceData,args:[yh,Ih.data]}):Hf(yh,dh,gh,Eh)):Gh(yh,dh,gh)}})(Y.sources,vt.sources,Gn,Ur);const $s=[];Y.layers&&Y.layers.forEach(Wu=>{Wu.source&&Ur[Wu.source]?mr.push({command:Ip.removeLayer,args:[Wu.id]}):$s.push(Wu)});let el=Y.terrain;el&&Ur[el.source]&&(mr.push({command:Ip.setTerrain,args:[void 0]}),el=void 0),mr=mr.concat(Gn),x(el,vt.terrain)||mr.push({command:Ip.setTerrain,args:[vt.terrain]}),function(Wu,dh,gh){dh=dh||[];const Eh=(Wu=Wu||[]).map(zp),yh=dh.map(zp),Ih=Wu.reduce(um,{}),Qu=dh.reduce(um,{}),bh=Eh.slice(),kh=Object.create(null);let Oh,rd,sd,ld,dd,ud,md;for(Oh=0,rd=0;Oh<Eh.length;Oh++)sd=Eh[Oh],Qu.hasOwnProperty(sd)?rd++:(gh.push({command:Ip.removeLayer,args:[sd]}),bh.splice(bh.indexOf(sd,rd),1));for(Oh=0,rd=0;Oh<yh.length;Oh++)sd=yh[yh.length-1-Oh],bh[bh.length-1-Oh]!==sd&&(Ih.hasOwnProperty(sd)?(gh.push({command:Ip.removeLayer,args:[sd]}),bh.splice(bh.lastIndexOf(sd,bh.length-rd),1)):rd++,ud=bh[bh.length-Oh],gh.push({command:Ip.addLayer,args:[Qu[sd],ud]}),bh.splice(bh.length-Oh,0,sd),kh[sd]=!0);for(Oh=0;Oh<yh.length;Oh++)if(sd=yh[Oh],ld=Ih[sd],dd=Qu[sd],!kh[sd]&&!x(ld,dd))if(x(ld.source,dd.source)&&x(ld["source-layer"],dd["source-layer"])&&x(ld.type,dd.type)){for(md in Bp(ld.layout,dd.layout,gh,sd,null,Ip.setLayoutProperty),Bp(ld.paint,dd.paint,gh,sd,null,Ip.setPaintProperty),x(ld.filter,dd.filter)||gh.push({command:Ip.setFilter,args:[sd,dd.filter]}),x(ld.minzoom,dd.minzoom)&&x(ld.maxzoom,dd.maxzoom)||gh.push({command:Ip.setLayerZoomRange,args:[sd,dd.minzoom,dd.maxzoom]}),ld)ld.hasOwnProperty(md)&&md!=="layout"&&md!=="paint"&&md!=="filter"&&md!=="metadata"&&md!=="minzoom"&&md!=="maxzoom"&&(md.indexOf("paint.")===0?Bp(ld[md],dd[md],gh,sd,md.slice(6),Ip.setPaintProperty):x(ld[md],dd[md])||gh.push({command:Ip.setLayerProperty,args:[sd,md,dd[md]]}));for(md in dd)dd.hasOwnProperty(md)&&!ld.hasOwnProperty(md)&&md!=="layout"&&md!=="paint"&&md!=="filter"&&md!=="metadata"&&md!=="minzoom"&&md!=="maxzoom"&&(md.indexOf("paint.")===0?Bp(ld[md],dd[md],gh,sd,md.slice(6),Ip.setPaintProperty):x(ld[md],dd[md])||gh.push({command:Ip.setLayerProperty,args:[sd,md,dd[md]]}))}else gh.push({command:Ip.removeLayer,args:[sd]}),ud=bh[bh.lastIndexOf(sd)+1],gh.push({command:Ip.addLayer,args:[dd,ud]})}($s,vt.layers,mr)}catch(Ur){console.warn("Unable to compute style diff:",Ur),mr=[{command:Ip.setStyle,args:[vt]}]}return mr}(this.serialize(),u).filter(Y=>!(Y.command in pv));if(E.length===0)return!1;const B=E.filter(Y=>!(Y.command in Sy));if(B.length>0)throw new Error(`Unimplemented: ${B.map(Y=>Y.command).join(", ")}.`);return E.forEach(Y=>{Y.command!=="setTransition"&&Y.command!=="setProjection"&&this[Y.command].apply(this,Y.args)}),this.stylesheet=u,this._updateMapProjection(),!0}addImage(u,E){return this.getImage(u)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(u,E),this._afterImageUpdated(u),this)}updateImage(u,E){this.imageManager.updateImage(u,E)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){return this.getImage(u)?(this.imageManager.removeImage(u),this._afterImageUpdated(u),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(u,E,B={}){if(this._checkLoaded(),this.getSource(u)!==void 0)throw new Error("There is already a source with this ID");if(!E.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(E).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(E.type)>=0&&this._validate(o.validateSource,`sources.${u}`,E,null,B))return;this.map&&this.map._collectResourceTiming&&(E.collectResourceTiming=!0);const Y=Uh(u,E,this.dispatcher,this);Y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(u),source:Y.serialize(),sourceId:u}));const vt=mr=>{const Ur=(mr?"symbol:":"other:")+u,Gn=this._sourceCaches[Ur]=new o.SourceCache(Ur,Y,mr);(mr?this._symbolSourceCaches:this._otherSourceCaches)[u]=Gn,Gn.style=this,Gn.onAdd(this.map)};vt(!1),E.type!=="vector"&&E.type!=="geojson"||vt(!0),Y.onAdd&&Y.onAdd(this.map),this._changed=!0}removeSource(u){this._checkLoaded();const E=this.getSource(u);if(!E)throw new Error("There is no source with this ID");for(const Y in this._layers)if(this._layers[Y].source===u)return this.fire(new o.ErrorEvent(new Error(`Source "${u}" cannot be removed while layer "${Y}" is using it.`)));if(this.terrain&&this.terrain.get().source===u)return this.fire(new o.ErrorEvent(new Error(`Source "${u}" cannot be removed while terrain is using it.`)));const B=this._getSourceCaches(u);for(const Y of B)delete this._sourceCaches[Y.id],delete this._updatedSources[Y.id],Y.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:Y.getSource().id})),Y.setEventedParent(null),Y.clearTiles();return delete this._otherSourceCaches[u],delete this._symbolSourceCaches[u],E.setEventedParent(null),E.onRemove&&E.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(u,E){this._checkLoaded(),this.getSource(u).setData(E),this._changed=!0}getSource(u){const E=this._getSourceCache(u);return E&&E.getSource()}_getSources(){const u=[];for(const E in this._otherSourceCaches){const B=this._getSourceCache(E);B&&u.push(B.getSource())}return u}addLayer(u,E,B={}){this._checkLoaded();const Y=u.id;if(this.getLayer(Y))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${Y}" already exists on this map`)));let vt;if(u.type==="custom"){if(P_(this,o.validateCustomStyleLayer(u)))return;vt=o.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(Y,u.source),u=o.clone$1(u),u=o.extend(u,{source:Y})),this._validate(o.validateLayer,`layers.${Y}`,u,{arrayIndex:-1},B))return;vt=o.createStyleLayer(u),this._validateLayer(vt),vt.setEventedParent(this,{layer:{id:Y}}),this._serializedLayers[vt.id]=vt.serialize(),this._updateLayerCount(vt,!0)}const mr=E?this._order.indexOf(E):this._order.length;if(E&&mr===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" does not exist on this map.`)));this._order.splice(mr,0,Y),this._layerOrderChanged=!0,this._layers[Y]=vt;const Ur=this._getLayerSourceCache(vt);if(this._removedLayers[Y]&&vt.source&&Ur&&vt.type!=="custom"){const Gn=this._removedLayers[Y];delete this._removedLayers[Y],Gn.type!==vt.type?this._updatedSources[vt.source]="clear":(this._updatedSources[vt.source]="reload",Ur.pause())}this._updateLayer(vt),vt.onAdd&&vt.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(u,E){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===E)return;const B=this._order.indexOf(u);this._order.splice(B,1);const Y=E?this._order.indexOf(E):this._order.length;E&&Y===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" does not exist on this map.`))):(this._order.splice(Y,0,u),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(u){this._checkLoaded();const E=this._layers[u];if(!E)return void this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be removed.`)));E.setEventedParent(null),this._updateLayerCount(E,!1);const B=this._order.indexOf(u);this._order.splice(B,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=E,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],E.onRemove&&E.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(u){return this._layers[u]}hasLayer(u){return u in this._layers}hasLayerType(u){for(const E in this._layers)if(this._layers[E].type===u)return!0;return!1}setLayerZoomRange(u,E,B){this._checkLoaded();const Y=this.getLayer(u);Y?Y.minzoom===E&&Y.maxzoom===B||(E!=null&&(Y.minzoom=E),B!=null&&(Y.maxzoom=B),this._updateLayer(Y)):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(u,E,B={}){this._checkLoaded();const Y=this.getLayer(u);if(Y){if(!x(Y.filter,E))return E==null?(Y.filter=void 0,void this._updateLayer(Y)):void(this._validate(o.validateFilter,`layers.${Y.id}.filter`,E,{layerType:Y.type},B)||(Y.filter=o.clone$1(E),this._updateLayer(Y)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be filtered.`)))}getFilter(u){const E=this.getLayer(u);return E&&o.clone$1(E.filter)}setLayoutProperty(u,E,B,Y={}){this._checkLoaded();const vt=this.getLayer(u);vt?x(vt.getLayoutProperty(E),B)||(vt.setLayoutProperty(E,B,Y),this._updateLayer(vt)):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(u,E){const B=this.getLayer(u);if(B)return B.getLayoutProperty(E);this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style.`)))}setPaintProperty(u,E,B,Y={}){this._checkLoaded();const vt=this.getLayer(u);vt?x(vt.getPaintProperty(E),B)||(vt.setPaintProperty(E,B,Y)&&this._updateLayer(vt),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(u,E){const B=this.getLayer(u);return B&&B.getPaintProperty(E)}setFeatureState(u,E){this._checkLoaded();const B=u.source,Y=u.sourceLayer,vt=this.getSource(B);if(!vt)return void this.fire(new o.ErrorEvent(new Error(`The source '${B}' does not exist in the map's style.`)));const mr=vt.type;if(mr==="geojson"&&Y)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(mr==="vector"&&!Y)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const Ur=this._getSourceCaches(B);for(const Gn of Ur)Gn.setFeatureState(Y,u.id,E)}removeFeatureState(u,E){this._checkLoaded();const B=u.source,Y=this.getSource(B);if(!Y)return void this.fire(new o.ErrorEvent(new Error(`The source '${B}' does not exist in the map's style.`)));const vt=Y.type,mr=vt==="vector"?u.sourceLayer:void 0;if(vt==="vector"&&!mr)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(E&&typeof u.id!="string"&&typeof u.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const Ur=this._getSourceCaches(B);for(const Gn of Ur)Gn.removeFeatureState(mr,u.id,E)}getFeatureState(u){this._checkLoaded();const E=u.source,B=u.sourceLayer,Y=this.getSource(E);if(Y){if(Y.type!=="vector"||B)return u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(E)[0].getFeatureState(B,u.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${E}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const u={};for(const E in this._sourceCaches){const B=this._sourceCaches[E].getSource();u[B.id]||(u[B.id]=B.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:u,layers:this._serializeLayers(this._order)},E=>E!==void 0)}_updateLayer(u){this._updatedLayers[u.id]=!0;const E=this._getLayerSourceCache(u);u.source&&!this._updatedSources[u.source]&&E&&E.getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",E.pause()),this._changed=!0,u.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(u){const E=mr=>this._layers[mr].type==="fill-extrusion",B={},Y=[];for(let mr=this._order.length-1;mr>=0;mr--){const Ur=this._order[mr];if(E(Ur)){B[Ur]=mr;for(const Gn of u){const $s=Gn[Ur];if($s)for(const el of $s)Y.push(el)}}}Y.sort((mr,Ur)=>Ur.intersectionZ-mr.intersectionZ);const vt=[];for(let mr=this._order.length-1;mr>=0;mr--){const Ur=this._order[mr];if(E(Ur))for(let Gn=Y.length-1;Gn>=0;Gn--){const $s=Y[Gn].feature;if(B[$s.layer.id]<mr)break;vt.push($s),Y.pop()}else for(const Gn of u){const $s=Gn[Ur];if($s)for(const el of $s)vt.push(el.feature)}}return vt}queryRenderedFeatures(u,E,B){E&&E.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",E.filter,null,E);const Y={};if(E&&E.layers){if(!Array.isArray(E.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Gn of E.layers){const $s=this._layers[Gn];if(!$s)return this.fire(new o.ErrorEvent(new Error(`The layer '${Gn}' does not exist in the map's style and cannot be queried for features.`))),[];Y[$s.source]=!0}}const vt=[];E.availableImages=this._availableImages;const mr=E&&E.layers?E.layers.some(Gn=>{const $s=this.getLayer(Gn);return $s&&$s.is3D()}):this.has3DLayers(),Ur=Hd.createFromScreenPoints(u,B);for(const Gn in this._sourceCaches){const $s=this._sourceCaches[Gn].getSource().id;E.layers&&!Y[$s]||vt.push(Zh(this._sourceCaches[Gn],this._layers,this._serializedLayers,Ur,E,B,mr,!!this.map._showQueryGeometry))}return this.placement&&vt.push(function(Gn,$s,el,Wu,dh,gh,Eh){const yh={},Ih=gh.queryRenderedSymbols(Wu),Qu=[];for(const bh of Object.keys(Ih).map(Number))Qu.push(Eh[bh]);Qu.sort(Ad);for(const bh of Qu){const kh=bh.featureIndex.lookupSymbolFeatures(Ih[bh.bucketInstanceId],$s,bh.bucketIndex,bh.sourceLayerIndex,dh.filter,dh.layers,dh.availableImages,Gn);for(const Oh in kh){const rd=yh[Oh]=yh[Oh]||[],sd=kh[Oh];sd.sort((ld,dd)=>{const ud=bh.featureSortOrder;if(ud){const md=ud.indexOf(ld.featureIndex);return ud.indexOf(dd.featureIndex)-md}return dd.featureIndex-ld.featureIndex});for(const ld of sd)rd.push(ld)}}for(const bh in yh)yh[bh].forEach(kh=>{const Oh=kh.feature,rd=el(Gn[bh]);if(!rd)return;const sd=rd.getFeatureState(Oh.layer["source-layer"],Oh.id);Oh.source=Oh.layer.source,Oh.layer["source-layer"]&&(Oh.sourceLayer=Oh.layer["source-layer"]),Oh.state=sd});return yh}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),Ur.screenGeometry,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(vt)}querySourceFeatures(u,E){E&&E.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",E.filter,null,E);const B=this._getSourceCaches(u);let Y=[];for(const vt of B)Y=Y.concat(td(vt,E));return Y}addSourceType(u,E,B){return Wp.getSourceType(u)?B(new Error(`A source type called "${u}" already exists.`)):(Wp.setSourceType(u,E),E.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:E.workerSourceURL},B):B(null,null))}getLight(){return this.light.getLight()}setLight(u,E={}){this._checkLoaded();const B=this.light.getLight();let Y=!1;for(const mr in u)if(!x(u[mr],B[mr])){Y=!0;break}if(!Y)return;const vt=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(u,E),this.light.updateTransitions(vt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(u,E=1){if(this._checkLoaded(),!u)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let B=u;if(E===1){if(typeof B.source=="object"){const Y="terrain-dem-src";this.addSource(Y,B.source),B=o.clone$1(B),B=o.extend(B,{source:Y})}if(this._validate(o.validateTerrain,"terrain",B))return}if(!this.terrain||this.terrain&&E!==this.terrain.drapeRenderMode){if(!B)return;this._createTerrain(B,E)}else{const Y=this.terrain,vt=Y.get();for(const mr of Object.keys(o.spec.terrain))!B.hasOwnProperty(mr)&&o.spec.terrain[mr].default&&(B[mr]=o.spec.terrain[mr].default);for(const mr in B)if(!x(B[mr],vt[mr])){Y.set(B),this.stylesheet.terrain=B;const Ur=this._setTransitionParameters({duration:0});Y.updateTransitions(Ur);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(u){const E=this.fog=new Cf(u,this.map.transform);this.stylesheet.fog=u;const B=this._setTransitionParameters({duration:0});E.updateTransitions(B)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const u of this.map._markers)u._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(u){if(this._checkLoaded(),!u)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const E=this.fog,B=E.get();Object.keys(u).length===0&&E.set(u);for(const Y in u)if(!x(u[Y],B[Y])){E.set(u),this.stylesheet.fog=u;const vt=this._setTransitionParameters({duration:0});E.updateTransitions(vt);break}}else this._createFog(u);this._markersNeedUpdate=!0}_setTransitionParameters(u){return{now:o.exported.now(),transition:o.extend(u,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const u=this._order.filter(B=>this.isLayerDraped(this._layers[B])),E=this._order.filter(B=>!this.isLayerDraped(this._layers[B]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...u),this._drapedFirstOrder.push(...E)}_createTerrain(u,E){const B=this.terrain=new hd(u,E);this.stylesheet.terrain=u,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const Y=this._setTransitionParameters({duration:0});B.updateTransitions(Y)}_force3DLayerUpdate(){for(const u in this._layers){const E=this._layers[u];E.type==="fill-extrusion"&&this._updateLayer(E)}}_forceSymbolLayerUpdate(){for(const u in this._layers){const E=this._layers[u];E.type==="symbol"&&this._updateLayer(E)}}_validate(u,E,B,Y,vt={}){return(!vt||vt.validate!==!1)&&P_(this,u.call(o.validateStyle,o.extend({key:E,style:this.serialize(),value:B,styleSpec:o.spec},Y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this._sourceCaches)this._sourceCaches[u].clearTiles(),this._sourceCaches[u].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(u){const E=this._getSourceCaches(u);for(const B of E)B.clearTiles()}_reloadSource(u){const E=this._getSourceCaches(u);for(const B of E)B.resume(),B.reload()}_reloadSources(){for(const u of this._getSources())u.reload&&u.reload()}_updateSources(u){for(const E in this._sourceCaches)this._sourceCaches[E].update(u)}_generateCollisionBoxes(){for(const u in this._sourceCaches){const E=this._sourceCaches[u];E.resume(),E.reload()}}_updatePlacement(u,E,B,Y,vt=!1){let mr=!1,Ur=!1;const Gn={};for(const $s of this._order){const el=this._layers[$s];if(el.type!=="symbol")continue;if(!Gn[el.source]){const dh=this._getLayerSourceCache(el);if(!dh)continue;Gn[el.source]=dh.getRenderableIds(!0).map(gh=>dh.getTileByID(gh)).sort((gh,Eh)=>Eh.tileID.overscaledZ-gh.tileID.overscaledZ||(gh.tileID.isLessThan(Eh.tileID)?-1:1))}const Wu=this.crossTileSymbolIndex.addLayer(el,Gn[el.source],u.center.lng,u.projection);mr=mr||Wu}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),vt=vt||this._layerOrderChanged||B===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(vt||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),u.zoom))&&(this.pauseablePlacement=new j0(u,this._order,vt,E,B,Y,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Gn),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),Ur=!0),mr&&this.pauseablePlacement.placement.setStale()),Ur||mr)for(const $s of this._order){const el=this._layers[$s];el.type==="symbol"&&this.placement.updateLayerOpacities(el,Gn[el.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const u in this._sourceCaches)this._sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,E,B){this.imageManager.getImages(E.icons,B),this._updateTilesForChangedImages();const Y=vt=>{vt&&vt.setDependencies(E.tileID.key,E.type,E.icons)};Y(this._otherSourceCaches[E.source]),Y(this._symbolSourceCaches[E.source])}getGlyphs(u,E,B){this.glyphManager.getGlyphs(E.stacks,B)}getResource(u,E,B){return o.makeRequest(E,B)}_getSourceCache(u){return this._otherSourceCaches[u]}_getLayerSourceCache(u){return u.type==="symbol"?this._symbolSourceCaches[u.source]:this._otherSourceCaches[u.source]}_getSourceCaches(u){const E=[];return this._otherSourceCaches[u]&&E.push(this._otherSourceCaches[u]),this._symbolSourceCaches[u]&&E.push(this._symbolSourceCaches[u]),E}_isSourceCacheLoaded(u){const E=this._getSourceCaches(u);return E.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${u}'`))),!1):E.every(B=>B.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wp.getSourceType=function(L){return Mh[L]},Wp.setSourceType=function(L,u){Mh[L]=u},Wp.registerForPluginStateChange=o.registerForPluginStateChange;var T0=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,bg="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Rg=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,jy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let j_={},q_={};const Ty=[];Z_(T0,Ty),Z_(Rg,Ty),Z_(jy,Ty),Z_(Qg,Ty),j_=fm("",Rg),q_=fm(Qg,jy);const gm=fm(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),qy=T0,cy=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var I0={background:fm(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fm(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fm(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fm("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fm(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fm(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fm("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fm("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fm("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fm(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:fm(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fm(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fm(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fm(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:fm(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:fm(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fm(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fm(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:fm(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:fm(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:fm(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:fm(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:fm(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:fm(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:fm(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:fm(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,bg),skyboxGradient:fm(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,bg),skyboxCapture:fm(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fm(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fm(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Z_(L,u){const E=L.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let B of E)if(B=B.trim(),B[0]==="#"&&B.includes("if")&&!B.includes("endif")){B=B.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const Y=B.split(" ");for(const vt of Y)u.includes(vt)||u.push(vt)}}function fm(L,u){const E=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,B=u.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),Y={},vt=[...Ty];return Z_(L,vt),Z_(u,vt),{fragmentSource:L=L.replace(E,(mr,Ur,Gn,$s,el)=>(Y[el]=!0,Ur==="define"?`
#ifndef HAS_UNIFORM_u_${el}
varying ${Gn} ${$s} ${el};
#else
uniform ${Gn} ${$s} u_${el};
#endif
`:`
#ifdef HAS_UNIFORM_u_${el}
    ${Gn} ${$s} ${el} = u_${el};
#endif
`)),vertexSource:u=u.replace(E,(mr,Ur,Gn,$s,el)=>{const Wu=$s==="float"?"vec2":"vec4",dh=el.match(/color/)?"color":Wu;return Y[el]?Ur==="define"?`
#ifndef HAS_UNIFORM_u_${el}
uniform lowp float u_${el}_t;
attribute ${Gn} ${Wu} a_${el};
varying ${Gn} ${$s} ${el};
#else
uniform ${Gn} ${$s} u_${el};
#endif
`:dh==="vec4"?`
#ifndef HAS_UNIFORM_u_${el}
    ${el} = a_${el};
#else
    ${Gn} ${$s} ${el} = u_${el};
#endif
`:`
#ifndef HAS_UNIFORM_u_${el}
    ${el} = unpack_mix_${dh}(a_${el}, u_${el}_t);
#else
    ${Gn} ${$s} ${el} = u_${el};
#endif
`:Ur==="define"?`
#ifndef HAS_UNIFORM_u_${el}
uniform lowp float u_${el}_t;
attribute ${Gn} ${Wu} a_${el};
#else
uniform ${Gn} ${$s} u_${el};
#endif
`:dh==="vec4"?`
#ifndef HAS_UNIFORM_u_${el}
    ${Gn} ${$s} ${el} = a_${el};
#else
    ${Gn} ${$s} ${el} = u_${el};
#endif
`:`
#ifndef HAS_UNIFORM_u_${el}
    ${Gn} ${$s} ${el} = unpack_mix_${dh}(a_${el}, u_${el}_t);
#else
    ${Gn} ${$s} ${el} = u_${el};
#endif
`}),staticAttributes:B,usedDefines:vt}}class mv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(u,E,B,Y,vt,mr,Ur){this.context=u;let Gn=this.boundPaintVertexBuffers.length!==Y.length;for(let el=0;!Gn&&el<Y.length;el++)this.boundPaintVertexBuffers[el]!==Y[el]&&(Gn=!0);let $s=this.boundDynamicVertexBuffers.length!==Ur.length;for(let el=0;!$s&&el<Ur.length;el++)this.boundDynamicVertexBuffers[el]!==Ur[el]&&($s=!0);if(!u.extVertexArrayObject||!this.vao||this.boundProgram!==E||this.boundLayoutVertexBuffer!==B||Gn||$s||this.boundIndexBuffer!==vt||this.boundVertexOffset!==mr)this.freshBind(E,B,Y,vt,mr,Ur);else{u.bindVertexArrayOES.set(this.vao);for(const el of Ur)el&&el.bind();vt&&vt.dynamicDraw&&vt.bind()}}freshBind(u,E,B,Y,vt,mr){let Ur;const Gn=u.numAttributes,$s=this.context,el=$s.gl;if($s.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$s.extVertexArrayObject.createVertexArrayOES(),$s.bindVertexArrayOES.set(this.vao),Ur=0,this.boundProgram=u,this.boundLayoutVertexBuffer=E,this.boundPaintVertexBuffers=B,this.boundIndexBuffer=Y,this.boundVertexOffset=vt,this.boundDynamicVertexBuffers=mr;else{Ur=$s.currentNumAttributes||0;for(let Wu=Gn;Wu<Ur;Wu++)el.disableVertexAttribArray(Wu)}E.enableAttributes(el,u),E.bind(),E.setVertexAttribPointers(el,u,vt);for(const Wu of B)Wu.enableAttributes(el,u),Wu.bind(),Wu.setVertexAttribPointers(el,u,vt);for(const Wu of mr)Wu&&(Wu.enableAttributes(el,u),Wu.bind(),Wu.setVertexAttribPointers(el,u,vt));Y&&Y.bind(),$s.currentNumAttributes=Gn}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Iy(L,u){const E=Math.pow(2,u.canonical.z),B=u.canonical.y;return[new o.MercatorCoordinate(0,B/E).toLngLat().lat,new o.MercatorCoordinate(0,(B+1)/E).toLngLat().lat]}function Z0(L,u,E,B,Y,vt,mr){const Ur=L.context,Gn=Ur.gl,$s=E.fbo;if(!$s)return;L.prepareDrawTile();const el=L.useProgram("hillshade");Ur.activeTexture.set(Gn.TEXTURE0),Gn.bindTexture(Gn.TEXTURE_2D,$s.colorAttachment.get());const Wu=((yh,Ih,Qu,bh)=>{const kh=Qu.paint.get("hillshade-shadow-color"),Oh=Qu.paint.get("hillshade-highlight-color"),rd=Qu.paint.get("hillshade-accent-color");let sd=Qu.paint.get("hillshade-illumination-direction")*(Math.PI/180);Qu.paint.get("hillshade-illumination-anchor")==="viewport"&&(sd-=yh.transform.angle);const ld=!yh.options.moving;return{u_matrix:bh||yh.transform.calculateProjMatrix(Ih.tileID.toUnwrapped(),ld),u_image:0,u_latrange:Iy(0,Ih.tileID),u_light:[Qu.paint.get("hillshade-exaggeration"),sd],u_shadow:kh,u_highlight:Oh,u_accent:rd}})(L,E,B,L.terrain?u.projMatrix:null);L.prepareDrawProgram(Ur,el,u.toUnwrapped());const{tileBoundsBuffer:dh,tileBoundsIndexBuffer:gh,tileBoundsSegments:Eh}=L.getTileBoundsBuffers(E);el.draw(Ur,Gn.TRIANGLES,Y,vt,mr,o.CullFaceMode.disabled,Wu,B.id,dh,gh,Eh)}function Zy(L,u,E){if(!u.needsDEMTextureUpload)return;const B=L.context,Y=B.gl;B.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||L.getTileTexture(E.stride);const vt=E.getPixels();u.demTexture?u.demTexture.update(vt,{premultiply:!1}):u.demTexture=new o.Texture(B,vt,Y.RGBA,{premultiply:!1}),u.needsDEMTextureUpload=!1}function Hy(L,u,E,B,Y,vt){const mr=L.context,Ur=mr.gl;if(!u.dem)return;const Gn=u.dem;if(mr.activeTexture.set(Ur.TEXTURE1),Zy(L,u,Gn),!u.demTexture)return;u.demTexture.bind(Ur.NEAREST,Ur.CLAMP_TO_EDGE);const $s=Gn.dim;mr.activeTexture.set(Ur.TEXTURE0);let el=u.fbo;if(!el){const Eh=new o.Texture(mr,{width:$s,height:$s,data:null},Ur.RGBA);Eh.bind(Ur.LINEAR,Ur.CLAMP_TO_EDGE),el=u.fbo=mr.createFramebuffer($s,$s,!0),el.colorAttachment.set(Eh.texture)}mr.bindFramebuffer.set(el.framebuffer),mr.viewport.set([0,0,$s,$s]);const{tileBoundsBuffer:Wu,tileBoundsIndexBuffer:dh,tileBoundsSegments:gh}=L.getMercatorTileBoundsBuffers();L.useProgram("hillshadePrepare").draw(mr,Ur.TRIANGLES,B,Y,vt,o.CullFaceMode.disabled,((Eh,yh)=>{const Ih=yh.stride,Qu=o.create();return o.ortho(Qu,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Qu,Qu,[0,-o.EXTENT,0]),{u_matrix:Qu,u_image:1,u_dimension:[Ih,Ih],u_zoom:Eh.overscaledZ,u_unpack:yh.unpackVector}})(u.tileID,Gn),E.id,Wu,dh,gh),u.needsHillshadePrepare=!1}const H_=L=>({u_matrix:new o.UniformMatrix4f(L),u_image0:new o.Uniform1i(L),u_skirt_height:new o.Uniform1f(L)}),Cy=(L,u)=>({u_matrix:L,u_image0:0,u_skirt_height:u}),c0=(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh)=>({u_proj_matrix:Float32Array.from(L),u_globe_matrix:u,u_normalize_matrix:Float32Array.from(B),u_merc_matrix:E,u_zoom_transition:Y,u_merc_center:vt,u_image0:0,u_frustum_tl:mr,u_frustum_tr:Ur,u_frustum_br:Gn,u_frustum_bl:$s,u_globe_pos:el,u_globe_radius:Wu,u_viewport:dh,u_grid_matrix:Eh?Float32Array.from(Eh):new Float32Array(9),u_skirt_height:gh});function Xy(L,u){return L!=null&&u!=null&&!(!L.hasData()||!u.hasData())&&L.demTexture!=null&&u.demTexture!=null&&L.tileID.key!==u.tileID.key}const m_=new class{constructor(){this.operations={}}newMorphing(L,u,E,B,Y){if(L in this.operations){const vt=this.operations[L];vt.to.tileID.key!==E.tileID.key&&(vt.queued=E)}else this.operations[L]={startTime:B,phase:0,duration:Y,from:u,to:E,queued:null}}getMorphValuesForProxy(L){if(!(L in this.operations))return null;const u=this.operations[L];return{from:u.from,to:u.to,phase:u.phase}}update(L){for(const u in this.operations){const E=this.operations[u];for(E.phase=(L-E.startTime)/E.duration;E.phase>=1||!this._validOp(E);)if(!this._nextOp(E,L)){delete this.operations[u];break}}}_nextOp(L,u){return!!L.queued&&(L.from=L.to,L.to=L.queued,L.queued=null,L.phase=0,L.startTime=u,!0)}_validOp(L){return L.from.hasData()&&L.to.hasData()}},X_={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Og(L){return 6*Math.pow(1.5,22-L)}function C0(L,u){const E=1<<L.z;return!u&&(L.x===0||L.x===E-1)||L.y===0||L.y===E-1}const l_=L=>({u_matrix:L});function g_(L,u,E,B,Y){if(Y>0){const vt=o.exported.now(),mr=(vt-L.timeAdded)/Y,Ur=u?(vt-u.timeAdded)/Y:-1,Gn=E.getSource(),$s=B.coveringZoomLevel({tileSize:Gn.tileSize,roundZoom:Gn.roundZoom}),el=!u||Math.abs(u.tileID.overscaledZ-$s)>Math.abs(L.tileID.overscaledZ-$s),Wu=el&&L.refreshedUponExpiration?1:o.clamp(el?mr:1-Ur,0,1);return L.refreshedUponExpiration&&mr>=1&&(L.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Wu}:{opacity:Wu,mix:0}}return{opacity:1,mix:0}}class e_ extends o.SourceCache{constructor(u){const E={type:"raster-dem",maxzoom:u.transform.maxZoom},B=new Sd(ap(),null),Y=Uh("mock-dem",E,B,u.style);super("mock-dem",Y,!1),Y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(u,E){u.state="loaded",E(null)}}class K_ extends o.SourceCache{constructor(u){const E=Uh("proxy",{type:"geojson",maxzoom:u.transform.maxZoom},new Sd(ap(),null),u.style);super("proxy",E,!1),E.setEventedParent(this),this.map=this.getSource().map=u,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(u,E,B){if(u.freezeTileCoverage)return;this.transform=u;const Y=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((vt,mr)=>{if(vt[mr.key]="",!this._tiles[mr.key]){const Ur=new o.Tile(mr,this._source.tileSize*mr.overscaleFactor(),u.tileZoom);Ur.state="loaded",this._tiles[mr.key]=Ur}return vt},{});for(const vt in this._tiles)vt in Y||(this.freeFBO(vt),this._tiles[vt].unloadVectorData(),delete this._tiles[vt])}freeFBO(u){const E=this.proxyCachedFBO[u];if(E!==void 0){const B=Object.values(E);this.renderCachePool.push(...B),delete this.proxyCachedFBO[u]}}deallocRenderCache(){this.renderCache.forEach(u=>u.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class t_ extends o.OverscaledTileID{constructor(u,E,B){super(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y),this.proxyTileKey=E,this.projMatrix=B}}class gv extends o.Elevation{constructor(u,E){super(),this.painter=u,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[B,Y,vt]=function(Gn){const $s=new o.StructArrayLayout2i4,el=new o.StructArrayLayout3ui6,Wu=131;$s.reserve(17161),el.reserve(33800);const dh=o.EXTENT/128,gh=o.EXTENT+dh/2,Eh=gh+dh;for(let Ih=-dh;Ih<Eh;Ih+=dh)for(let Qu=-dh;Qu<Eh;Qu+=dh){const bh=Qu<0||Qu>gh||Ih<0||Ih>gh?24575:0,kh=o.clamp(Math.round(Qu),0,o.EXTENT),Oh=o.clamp(Math.round(Ih),0,o.EXTENT);$s.emplaceBack(kh+bh,Oh)}const yh=(Ih,Qu)=>{const bh=Qu*Wu+Ih;el.emplaceBack(bh+1,bh,bh+Wu),el.emplaceBack(bh+Wu,bh+Wu+1,bh+1)};for(let Ih=1;Ih<129;Ih++)for(let Qu=1;Qu<129;Qu++)yh(Qu,Ih);return[0,129].forEach(Ih=>{for(let Qu=0;Qu<130;Qu++)yh(Qu,Ih),yh(Ih,Qu)}),[$s,el,32768]}(),mr=u.context;this.gridBuffer=mr.createVertexBuffer(B,o.posAttributes.members),this.gridIndexBuffer=mr.createIndexBuffer(Y),this.gridSegments=o.SegmentVector.simpleSegment(0,0,B.length,Y.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,B.length,vt),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new K_(E.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const Ur=mr.gl;this._overlapStencilMode=new o.StencilMode({func:Ur.GEQUAL,mask:255},0,255,Ur.KEEP,Ur.KEEP,Ur.REPLACE),this._previousZoom=u.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=E,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new e_(E.map)}set style(u){u.on("data",this._onStyleDataEvent.bind(this)),u.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=u,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(u,E,B){if(u&&u.terrain){this._style!==u&&(this.style=u),this.enabled=!0;const Y=u.terrain.properties;this.sourceCache=u.terrain.drapeRenderMode===0?this._mockSourceCache:u._getSourceCache(Y.get("source")),this._exaggeration=Y.get("exaggeration");const vt=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const mr=this.getScaledDemTileSize();this.sourceCache.update(E,mr,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,vt(),this._initializing=!0),vt(),E.updateElevation(!0,B),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(E),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(u){this._findCoveringTileCache[u]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const u=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||u.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${u.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${u.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(u){u.coord&&u.dataType==="source"?this._clearRenderCacheForTile(u.sourceCacheId,u.coord):u.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const u in this._style._sourceCaches)this._style._sourceCaches[u].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(u=>u.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const u=2*this.proxySourceCache.getSource().tileSize;return[u,u]}set useVertexMorphing(u){this._useVertexMorphing=u}updateTileBinding(u){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const E=this.proxySourceCache,B=this.painter.transform;this._initializing&&(this._initializing=B._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(B.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const Y=this.proxyCoords=E.getIds().map(Gn=>{const $s=E.getTileByID(Gn).tileID;return $s.projMatrix=B.calculateProjMatrix($s.toUnwrapped()),$s});(function(Gn,$s){const el=$s.transform.pointCoordinate($s.transform.getCameraPoint()),Wu=new o.Point(el.x,el.y);Gn.sort((dh,gh)=>{if(gh.overscaledZ-dh.overscaledZ)return gh.overscaledZ-dh.overscaledZ;const Eh=new o.Point(dh.canonical.x+(1<<dh.canonical.z)*dh.wrap,dh.canonical.y),yh=new o.Point(gh.canonical.x+(1<<gh.canonical.z)*gh.wrap,gh.canonical.y),Ih=Wu.mult(1<<dh.canonical.z);return Ih.x-=.5,Ih.y-=.5,Ih.distSqr(Eh)-Ih.distSqr(yh)})})(Y,this.painter),this._previousZoom=B.zoom;const vt=this.proxyToSource||{};this.proxyToSource={},Y.forEach(Gn=>{this.proxyToSource[Gn.key]={}}),this.terrainTileForTile={};const mr=this._style._sourceCaches;for(const Gn in mr){const $s=mr[Gn];if(!$s.used||($s!==this.sourceCache&&this.resetTileLookupCache($s.id),this._setupProxiedCoordsForOrtho($s,u[Gn],vt),$s.usedForTerrain))continue;const el=u[Gn];$s.getSource().reparseOverscaled&&this._assignTerrainTiles(el)}this.proxiedCoords[E.id]=Y.map(Gn=>new t_(Gn,Gn.key,this.orthoMatrix)),this._assignTerrainTiles(Y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(vt),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const Ur={};this._visibleDemTiles=[];for(const Gn of this.proxyCoords){const $s=this.terrainTileForTile[Gn.key];if(!$s)continue;const el=$s.tileID.key;el in Ur||(this._visibleDemTiles.push($s),Ur[el]=el)}}_assignTerrainTiles(u){this._initializing||u.forEach(E=>{if(this.terrainTileForTile[E.key])return;const B=this._findTileCoveringTileID(E,this.sourceCache);B&&(this.terrainTileForTile[E.key]=B)})}_prepareDEMTextures(){const u=this.painter.context,E=u.gl;for(const B in this.terrainTileForTile){const Y=this.terrainTileForTile[B],vt=Y.dem;!vt||Y.demTexture&&!Y.needsDEMTextureUpload||(u.activeTexture.set(E.TEXTURE1),Zy(this.painter,Y,vt))}}_prepareDemTileUniforms(u,E,B,Y){if(!E||E.demTexture==null)return!1;const vt=u.tileID.canonical,mr=Math.pow(2,E.tileID.canonical.z-vt.z),Ur=Y||"";return B[`u_dem_tl${Ur}`]=[vt.x*mr%1,vt.y*mr%1],B[`u_dem_scale${Ur}`]=mr,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const u=this.painter.context,E=u.gl;if(!this._emptyDepthBufferTexture){const B=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(u,B,E.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let u=0;const E=this._visibleDemTiles.reduce((B,Y)=>{if(!Y.dem)return B;const vt=Y.dem.tree.minimums[0];return vt>0&&u++,B+vt},0);return u?E/u:0}_updateEmptyDEMTexture(){const u=this.painter.context,E=u.gl;u.activeTexture.set(E.TEXTURE2);const B=this._getLoadedAreaMinimum(),Y=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(B,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let vt=this._emptyDEMTexture;return vt?vt.update(Y,{premultiply:!1}):vt=this._emptyDEMTexture=new o.Texture(u,Y,E.RGBA,{premultiply:!1}),vt}setupElevationDraw(u,E,B){const Y=this.painter.context,vt=Y.gl,mr=(Ur=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(Ur),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var Ur;mr.u_dem_size=this.sourceCache.getSource().tileSize,mr.u_exaggeration=this.exaggeration();let Gn=null,$s=null,el=1;if(B&&B.morphing&&this._useVertexMorphing){const Wu=B.morphing.srcDemTile,dh=B.morphing.dstDemTile;el=B.morphing.phase,Wu&&dh&&(this._prepareDemTileUniforms(u,Wu,mr,"_prev")&&($s=Wu),this._prepareDemTileUniforms(u,dh,mr)&&(Gn=dh))}if($s&&Gn?(Y.activeTexture.set(vt.TEXTURE2),Gn.demTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE,vt.NEAREST),Y.activeTexture.set(vt.TEXTURE4),$s.demTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE,vt.NEAREST),mr.u_dem_lerp=el):(Gn=this.terrainTileForTile[u.tileID.key],Y.activeTexture.set(vt.TEXTURE2),(this._prepareDemTileUniforms(u,Gn,mr)?Gn.demTexture:this.emptyDEMTexture).bind(vt.NEAREST,vt.CLAMP_TO_EDGE)),Y.activeTexture.set(vt.TEXTURE3),B&&B.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE),this._depthFBO&&(mr.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE),mr.u_depth_size_inv=[1,1]),B&&B.useMeterToDem&&Gn){const Wu=(1<<Gn.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;mr.u_meter_to_dem=Wu}if(B&&B.labelPlaneMatrixInv&&(mr.u_label_plane_matrix_inv=B.labelPlaneMatrixInv),E.setTerrainUniformValues(Y,mr),this.painter.transform.projection.name==="globe"){const Wu=this.globeUniformValues(this.painter.transform,u.tileID.canonical,B&&B.useDenormalizedUpVectorScale);E.setGlobeUniformValues(Y,Wu)}}globeUniformValues(u,E,B){const Y=u.projection;return{u_tile_tl_up:Y.upVector(E,0,0),u_tile_tr_up:Y.upVector(E,o.EXTENT,0),u_tile_br_up:Y.upVector(E,o.EXTENT,o.EXTENT),u_tile_bl_up:Y.upVector(E,0,o.EXTENT),u_tile_up_scale:B?o.globeMetersToEcef(1):Y.upVectorScale(E,u.center.lat,u.worldSize).metersToTile}}renderToBackBuffer(u){const E=this.painter,B=this.painter.context;u.length!==0&&(B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]),E.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(Y,vt,mr,Ur,Gn){if(Y.transform.projection.name==="globe")(function($s,el,Wu,dh,gh){const Eh=$s.context,yh=Eh.gl;let Ih,Qu;const bh=$s.options.showTerrainWireframe?2:0,kh=$s.transform,Oh=o.globeUseCustomAntiAliasing($s,Eh,kh),rd=(Lf,Dd)=>{if(Qu===Lf)return;const yf=[X_[Lf],"PROJECTION_GLOBE_VIEW"];Oh&&yf.push("CUSTOM_ANTIALIASING"),Dd&&yf.push(X_[bh]),Ih=$s.useProgram("globeRaster",null,yf),Qu=Lf},sd=$s.colorModeForRenderPass(),ld=new o.DepthMode(yh.LEQUAL,o.DepthMode.ReadWrite,$s.depthRangeFor3D);m_.update(gh);const dd=o.calculateGlobeMercatorMatrix(kh),ud=[o.mercatorXfromLng(kh.center.lng),o.mercatorYfromLat(kh.center.lat)],md=bh?[!1,!0]:[!1],Af=$s.globeSharedBuffers,Td=[kh.width*o.exported.devicePixelRatio,kh.height*o.exported.devicePixelRatio],Gd=Float32Array.from(kh.globeMatrix),Od={useDenormalizedUpVectorScale:!0};if(md.forEach(Lf=>{const Dd=$s.transform,yf=Og(Dd.zoom)*el.exaggeration();Qu=-1;const zf=Lf?yh.LINES:yh.TRIANGLES;for(const Pf of dh){const Vf=Wu.getTile(Pf),Lp=o.StencilMode.disabled,Mp=el.prevTerrainTileForTile[Pf.key],fp=el.terrainTileForTile[Pf.key];Xy(Mp,fp)&&m_.newMorphing(Pf.key,Mp,fp,gh,250),Eh.activeTexture.set(yh.TEXTURE0),Vf.texture.bind(yh.LINEAR,yh.CLAMP_TO_EDGE);const Fp=m_.getMorphValuesForProxy(Pf.key),cm=Fp?1:0;Fp&&o.extend$1(Od,{morphing:{srcDemTile:Fp.from,dstDemTile:Fp.to,phase:o.easeCubicInOut(Fp.phase)}});const Jp=o.tileCornersToBounds(Pf.canonical),kp=o.getLatitudinalLod(Jp.getCenter().lat),_m=o.getGridMatrix(Pf.canonical,Jp,kp,Dd.worldSize/Dd._pixelsPerMercatorPixel),Lm=o.globeNormalizeECEF(o.globeTileBounds(Pf.canonical)),Rm=c0(Dd.projMatrix,Gd,dd,Lm,o.globeToMercatorTransition(Dd.zoom),ud,Dd.frustumCorners.TL,Dd.frustumCorners.TR,Dd.frustumCorners.BR,Dd.frustumCorners.BL,Dd.globeCenterInViewSpace,Dd.globeRadius,Td,yf,_m);if(rd(cm,Lf),el.setupElevationDraw(Vf,Ih,Od),$s.prepareDrawProgram(Eh,Ih,Pf.toUnwrapped()),Af){const[Vm,i_,qg]=Lf?Af.getWirefameBuffers($s.context,kp):Af.getGridBuffers(kp,yf!==0);Ih.draw(Eh,zf,ld,Lp,sd,o.CullFaceMode.backCCW,Rm,"globe_raster",Vm,i_,qg)}}}),Af){const Lf=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Oh&&Lf.push("CUSTOM_ANTIALIASING"),Ih=$s.useProgram("globeRaster",null,Lf);for(const Dd of dh){const{x:yf,y:zf,z:Pf}=Dd.canonical,Vf=zf===0,Lp=zf===(1<<Pf)-1,[Mp,fp,Fp,cm]=Af.getPoleBuffers(Pf);if(cm&&(Vf||Lp)){const Jp=Wu.getTile(Dd);Eh.activeTexture.set(yh.TEXTURE0),Jp.texture.bind(yh.LINEAR,yh.CLAMP_TO_EDGE);let kp=o.globePoleMatrixForTile(Pf,yf,kh);const _m=o.globeNormalizeECEF(o.globeTileBounds(Dd.canonical)),Lm=(Rm,Vm)=>Rm.draw(Eh,yh.TRIANGLES,ld,o.StencilMode.disabled,sd,o.CullFaceMode.disabled,c0(kh.projMatrix,kp,kp,_m,0,ud,kh.frustumCorners.TL,kh.frustumCorners.TR,kh.frustumCorners.BR,kh.frustumCorners.BL,kh.globeCenterInViewSpace,kh.globeRadius,Td,0),"globe_pole_raster",Vm,Fp,cm);el.setupElevationDraw(Jp,Ih,Od),$s.prepareDrawProgram(Eh,Ih,Dd.toUnwrapped()),Vf&&Lm(Ih,Mp),Lp&&(kp=o.scale(o.create(),kp,[1,-1,1]),Lm(Ih,fp))}}}})(Y,vt,mr,Ur,Gn);else{const $s=Y.context,el=$s.gl;let Wu,dh;const gh=Y.options.showTerrainWireframe?2:0,Eh=(kh,Oh)=>{if(dh===kh)return;const rd=[X_[kh]];Oh&&rd.push(X_[gh]),Wu=Y.useProgram("terrainRaster",null,rd),dh=kh},yh=Y.colorModeForRenderPass(),Ih=new o.DepthMode(el.LEQUAL,o.DepthMode.ReadWrite,Y.depthRangeFor3D);m_.update(Gn);const Qu=Y.transform,bh=Og(Qu.zoom)*vt.exaggeration();(gh?[!1,!0]:[!1]).forEach(kh=>{dh=-1;const Oh=kh?el.LINES:el.TRIANGLES,[rd,sd]=kh?vt.getWirefameBuffer():[vt.gridIndexBuffer,vt.gridSegments];for(const ld of Ur){const dd=mr.getTile(ld),ud=o.StencilMode.disabled,md=vt.prevTerrainTileForTile[ld.key],Af=vt.terrainTileForTile[ld.key];Xy(md,Af)&&m_.newMorphing(ld.key,md,Af,Gn,250),$s.activeTexture.set(el.TEXTURE0),dd.texture.bind(el.LINEAR,el.CLAMP_TO_EDGE,el.LINEAR_MIPMAP_NEAREST);const Td=m_.getMorphValuesForProxy(ld.key),Gd=Td?1:0;let Od;Td&&(Od={morphing:{srcDemTile:Td.from,dstDemTile:Td.to,phase:o.easeCubicInOut(Td.phase)}});const Lf=Cy(ld.projMatrix,C0(ld.canonical,Qu.renderWorldCopies)?bh/10:bh);Eh(Gd,kh),vt.setupElevationDraw(dd,Wu,Od),Y.prepareDrawProgram($s,Wu,ld.toUnwrapped()),Wu.draw($s,Oh,Ih,ud,yh,o.CullFaceMode.backCCW,Lf,"terrain_raster",vt.gridBuffer,rd,sd)}})}}(E,this,this.proxySourceCache,u,this._updateTimestamp),this.renderingToTexture=!0,E.gpuTimingDeferredRenderEnd(),u.splice(0,u.length))}renderBatch(u){if(this._drapedRenderBatches.length===0)return u+1;this.renderingToTexture=!0;const E=this.painter,B=this.painter.context,Y=this.proxySourceCache,vt=this.proxiedCoords[Y.id],mr=this._drapedRenderBatches.shift(),Ur=[],Gn=E.style.order;let $s=0;for(const el of vt){const Wu=Y.getTileByID(el.proxyTileKey),dh=Y.proxyCachedFBO[el.key]?Y.proxyCachedFBO[el.key][u]:void 0,gh=dh!==void 0?Y.renderCache[dh]:this.pool[$s++],Eh=dh!==void 0;if(Wu.texture=gh.tex,Eh&&!gh.dirty){Ur.push(Wu.tileID);continue}let yh;B.bindFramebuffer.set(gh.fb.framebuffer),this.renderedToTile=!1,gh.dirty&&(B.clear({color:o.Color.transparent,stencil:0}),gh.dirty=!1);for(let Ih=mr.start;Ih<=mr.end;++Ih){const Qu=E.style._layers[Gn[Ih]];if(Qu.isHidden(E.transform.zoom))continue;const bh=E.style._getLayerSourceCache(Qu),kh=bh?this.proxyToSource[el.key][bh.id]:[el];if(!kh)continue;const Oh=kh;B.viewport.set([0,0,gh.fb.width,gh.fb.height]),yh!==(bh?bh.id:null)&&(this._setupStencil(gh,kh,Qu,bh),yh=bh?bh.id:null),E.renderLayer(E,bh,Qu,Oh)}this.renderedToTile?(gh.dirty=!0,Ur.push(Wu.tileID)):Eh||--$s,$s===5&&($s=0,this.renderToBackBuffer(Ur))}return this.renderToBackBuffer(Ur),this.renderingToTexture=!1,B.bindFramebuffer.set(null),B.viewport.set([0,0,E.width,E.height]),mr.end+1}postRender(){}renderCacheEfficiency(u){const E=u.order.length;if(E===0)return{efficiency:100};let B,Y=0,vt=0,mr=!1;for(let Ur=0;Ur<E;++Ur){const Gn=u._layers[u.order[Ur]];this._style.isLayerDraped(Gn)?(mr&&++Y,++vt):mr||(mr=!0,B=Gn.id)}return vt===0?{efficiency:100}:{efficiency:100*(1-Y/vt),firstUndrapedLayer:B}}getMinElevationBelowMSL(){let u=0;return this._visibleDemTiles.filter(E=>E.dem).forEach(E=>{u=Math.min(u,E.dem.tree.minimums[0])}),u===0?u:(u-30)*this._exaggeration}raycast(u,E,B){if(!this._visibleDemTiles)return null;const Y=this._visibleDemTiles.filter(vt=>vt.dem).map(vt=>{const mr=vt.tileID,Ur=1<<mr.overscaledZ,{x:Gn,y:$s}=mr.canonical,el=Gn/Ur,Wu=(Gn+1)/Ur,dh=$s/Ur,gh=($s+1)/Ur;return{minx:el,miny:dh,maxx:Wu,maxy:gh,t:vt.dem.tree.raycastRoot(el,dh,Wu,gh,u,E,B),tile:vt}});Y.sort((vt,mr)=>(vt.t!==null?vt.t:Number.MAX_VALUE)-(mr.t!==null?mr.t:Number.MAX_VALUE));for(const vt of Y){if(vt.t==null)return null;const mr=vt.tile.dem.tree.raycast(vt.minx,vt.miny,vt.maxx,vt.maxy,u,E,B);if(mr!=null)return mr}return null}_createFBO(){const u=this.painter.context,E=u.gl,B=this.drapeBufferSize;u.activeTexture.set(E.TEXTURE0);const Y=new o.Texture(u,{width:B[0],height:B[1],data:null},E.RGBA);Y.bind(E.LINEAR,E.CLAMP_TO_EDGE);const vt=u.createFramebuffer(B[0],B[1],!1);return vt.colorAttachment.set(Y.texture),vt.depthAttachment=new al(u,vt.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=u.createRenderbuffer(u.gl.DEPTH_STENCIL,B[0],B[1]),this._stencilRef=0,vt.depthAttachment.set(this._sharedDepthStencil),u.clear({stencil:0})):vt.depthAttachment.set(this._sharedDepthStencil),u.extTextureFilterAnisotropic&&!u.extTextureFilterAnisotropicForceOff&&E.texParameterf(E.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax),{fb:vt,tex:Y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u].hasTransition())return!0;return this._style.order.some(u=>{const E=this._style._layers[u],B=E.isHidden(this.painter.transform.zoom);return E.type==="custom"?!B&&E.shouldRedrape():!B&&E.hasTransition()})}_clearLineLayersFromRenderCache(){let u=!1;for(const B of this._style._getSources())if(B instanceof Zs){u=!0;break}if(!u)return;const E={};for(let B=0;B<this._style.order.length;++B){const Y=this._style._layers[this._style.order[B]],vt=this._style._getLayerSourceCache(Y);if(vt&&!E[vt.id]&&!Y.isHidden(this.painter.transform.zoom)&&Y.type==="line"&&Y.widthExpression()instanceof o.ZoomDependentExpression){E[vt.id]=!0;for(const mr of this.proxyCoords){const Ur=this.proxyToSource[mr.key][vt.id];if(Ur)for(const Gn of Ur)this._clearRenderCacheForTile(vt.id,Gn)}}}}_clearRasterLayersFromRenderCache(){let u=!1;for(const B in this._style._sourceCaches)if(this._style._sourceCaches[B]._source instanceof ol){u=!0;break}if(!u)return;const E={};for(let B=0;B<this._style.order.length;++B){const Y=this._style._layers[this._style.order[B]],vt=this._style._getLayerSourceCache(Y);if(!vt||E[vt.id]||Y.isHidden(this.painter.transform.zoom)||Y.type!=="raster")continue;const mr=Y.paint.get("raster-fade-duration");for(const Ur of this.proxyCoords){const Gn=this.proxyToSource[Ur.key][vt.id];if(Gn)for(const $s of Gn){const el=g_(vt.getTile($s),vt.findLoadedParent($s,0),vt,this.painter.transform,mr);(el.opacity!==1||el.mix!==0)&&this._clearRenderCacheForTile(vt.id,$s)}}}}_setupDrapedRenderBatches(){const u=this._style.order,E=u.length;if(E===0)return;const B=[];let Y,vt=0,mr=this._style._layers[u[vt]];for(;!this._style.isLayerDraped(mr)&&mr.isHidden(this.painter.transform.zoom)&&++vt<E;)mr=this._style._layers[u[vt]];for(;vt<E;++vt){const Ur=this._style._layers[u[vt]];Ur.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Ur)?Y===void 0&&(Y=vt):Y!==void 0&&(B.push({start:Y,end:vt-1}),Y=void 0))}Y!==void 0&&B.push({start:Y,end:vt-1}),this._drapedRenderBatches=B}_setupRenderCache(u){const E=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,E.renderCache.length>E.renderCachePool.length){const mr=Object.values(E.proxyCachedFBO);E.proxyCachedFBO={};for(let Ur=0;Ur<mr.length;++Ur){const Gn=Object.values(mr[Ur]);E.renderCachePool.push(...Gn)}}return}this._clearRasterLayersFromRenderCache();const B=this.proxyCoords,Y=this._tilesDirty;for(let mr=B.length-1;mr>=0;mr--){const Ur=B[mr];if(E.getTileByID(Ur.key),E.proxyCachedFBO[Ur.key]!==void 0){const Gn=u[Ur.key],$s=this.proxyToSource[Ur.key];let el=0;for(const Wu in $s){const dh=$s[Wu],gh=Gn[Wu];if(!gh||gh.length!==dh.length||dh.some((Eh,yh)=>Eh!==gh[yh]||Y[Wu]&&Y[Wu].hasOwnProperty(Eh.key))){el=-1;break}++el}for(const Wu in E.proxyCachedFBO[Ur.key])E.renderCache[E.proxyCachedFBO[Ur.key][Wu]].dirty=el<0||el!==Object.values(Gn).length}}const vt=[...this._drapedRenderBatches];vt.sort((mr,Ur)=>Ur.end-Ur.start-(mr.end-mr.start));for(const mr of vt)for(const Ur of B){if(E.proxyCachedFBO[Ur.key])continue;let Gn=E.renderCachePool.pop();Gn===void 0&&E.renderCache.length<50&&(Gn=E.renderCache.length,E.renderCache.push(this._createFBO())),Gn!==void 0&&(E.proxyCachedFBO[Ur.key]={},E.proxyCachedFBO[Ur.key][mr.start]=Gn,E.renderCache[Gn].dirty=!0)}this._tilesDirty={}}_setupStencil(u,E,B,Y){if(!Y||!this._sourceTilesOverlap[Y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const vt=this.painter.context,mr=vt.gl;if(E.length<=1)return void(this._overlapStencilType=!1);let Ur;if(B.isTileClipped())Ur=E.length,this._overlapStencilMode.test={func:mr.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(E[0].overscaledZ>E[E.length-1].overscaledZ))return void(this._overlapStencilType=!1);Ur=1,this._overlapStencilMode.test={func:mr.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+Ur>255&&(vt.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=Ur,this._overlapStencilMode.ref=this._stencilRef,B.isTileClipped()&&this._renderTileClippingMasks(E,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(u){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[u.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(u,E){const B=this.painter,Y=this.painter.context,vt=Y.gl;B._tileClippingMaskIDs={},Y.setColorMode(o.ColorMode.disabled),Y.setDepthMode(o.DepthMode.disabled);const mr=B.useProgram("clippingMask");for(const Ur of u){const Gn=B._tileClippingMaskIDs[Ur.key]=--E;mr.draw(Y,vt.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:vt.ALWAYS,mask:0},Gn,255,vt.KEEP,vt.KEEP,vt.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,l_(Ur.projMatrix),"$clipping",B.tileExtentBuffer,B.quadTriangleIndexBuffer,B.tileExtentSegments)}}pointCoordinate(u){const E=this.painter.transform;if(u.x<0||u.x>E.width||u.y<0||u.y>E.height)return null;const B=[u.x,u.y,1,1];o.transformMat4$1(B,B,E.pixelMatrixInverse),o.scale$1(B,B,1/B[3]),B[0]/=E.worldSize,B[1]/=E.worldSize;const Y=E._camera.position,vt=o.mercatorZfromAltitude(1,E.center.lat),mr=[Y[0],Y[1],Y[2]/vt,0],Ur=o.subtract([],B.slice(0,3),mr);o.normalize(Ur,Ur);const Gn=this.raycast(mr,Ur,this._exaggeration);return Gn!==null&&Gn?(o.scaleAndAdd(mr,mr,Ur,Gn),mr[3]=mr[2],mr[2]*=vt,mr):null}drawDepth(){const u=this.painter,E=u.context,B=this.proxySourceCache,Y=Math.ceil(u.width),vt=Math.ceil(u.height);if(!this._depthFBO||this._depthFBO.width===Y&&this._depthFBO.height===vt||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const mr=E.gl,Ur=E.createFramebuffer(Y,vt,!0);E.activeTexture.set(mr.TEXTURE0);const Gn=new o.Texture(E,{width:Y,height:vt,data:null},mr.RGBA);Gn.bind(mr.NEAREST,mr.CLAMP_TO_EDGE),Ur.colorAttachment.set(Gn.texture);const $s=E.createRenderbuffer(E.gl.DEPTH_COMPONENT16,Y,vt);Ur.depthAttachment.set($s),this._depthFBO=Ur,this._depthTexture=Gn}E.bindFramebuffer.set(this._depthFBO.framebuffer),E.viewport.set([0,0,Y,vt]),function(mr,Ur,Gn,$s){if(mr.transform.projection.name==="globe")return;const el=mr.context,Wu=el.gl;el.clear({depth:1});const dh=mr.useProgram("terrainDepth"),gh=new o.DepthMode(Wu.LESS,o.DepthMode.ReadWrite,mr.depthRangeFor3D);for(const Eh of $s){const yh=Gn.getTile(Eh),Ih=Cy(Eh.projMatrix,0);Ur.setupElevationDraw(yh,dh),dh.draw(el,Wu.TRIANGLES,gh,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Ih,"terrain_depth",Ur.gridBuffer,Ur.gridIndexBuffer,Ur.gridNoSkirtSegments)}}(u,this,B,this.proxyCoords)}_setupProxiedCoordsForOrtho(u,E,B){if(u.getSource()instanceof xh)return this._setupProxiedCoordsForImageSource(u,E,B);this._findCoveringTileCache[u.id]=this._findCoveringTileCache[u.id]||{};const Y=this.proxiedCoords[u.id]=[],vt=this.proxyCoords;for(let Ur=0;Ur<vt.length;Ur++){const Gn=vt[Ur],$s=this._findTileCoveringTileID(Gn,u);if($s){const el=this._createProxiedId(Gn,$s,B[Gn.key]&&B[Gn.key][u.id]);Y.push(el),this.proxyToSource[Gn.key][u.id]=[el]}}let mr=!1;for(let Ur=0;Ur<E.length;Ur++){const Gn=u.getTile(E[Ur]);if(!Gn||!Gn.hasData())continue;const $s=this._findTileCoveringTileID(Gn.tileID,this.proxySourceCache);if($s&&$s.tileID.canonical.z!==Gn.tileID.canonical.z){const el=this.proxyToSource[$s.tileID.key][u.id],Wu=this._createProxiedId($s.tileID,Gn,B[$s.tileID.key]&&B[$s.tileID.key][u.id]);el?el.splice(el.length-1,0,Wu):this.proxyToSource[$s.tileID.key][u.id]=[Wu],Y.push(Wu),mr=!0}}this._sourceTilesOverlap[u.id]=mr}_setupProxiedCoordsForImageSource(u,E,B){if(!u.getSource().loaded())return;const Y=this.proxiedCoords[u.id]=[],vt=this.proxyCoords,mr=u.getSource(),Ur=new o.Point(mr.tileID.x,mr.tileID.y)._div(1<<mr.tileID.z),Gn=mr.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((el,Wu)=>(el.min.x=Math.min(el.min.x,Wu.x-Ur.x),el.min.y=Math.min(el.min.y,Wu.y-Ur.y),el.max.x=Math.max(el.max.x,Wu.x-Ur.x),el.max.y=Math.max(el.max.y,Wu.y-Ur.y),el),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$s=(el,Wu)=>{const dh=el.wrap+el.canonical.x/(1<<el.canonical.z),gh=el.canonical.y/(1<<el.canonical.z),Eh=o.EXTENT/(1<<el.canonical.z),yh=Wu.wrap+Wu.canonical.x/(1<<Wu.canonical.z),Ih=Wu.canonical.y/(1<<Wu.canonical.z);return dh+Eh<yh+Gn.min.x||dh>yh+Gn.max.x||gh+Eh<Ih+Gn.min.y||gh>Ih+Gn.max.y};for(let el=0;el<vt.length;el++){const Wu=vt[el];for(let dh=0;dh<E.length;dh++){const gh=u.getTile(E[dh]);if(!gh||!gh.hasData()||$s(Wu,gh.tileID))continue;const Eh=this._createProxiedId(Wu,gh,B[Wu.key]&&B[Wu.key][u.id]),yh=this.proxyToSource[Wu.key][u.id];yh?yh.push(Eh):this.proxyToSource[Wu.key][u.id]=[Eh],Y.push(Eh)}}}_createProxiedId(u,E,B){let Y=this.orthoMatrix;if(B){const vt=B.find(mr=>mr.key===E.tileID.key);if(vt)return vt}if(E.tileID.key!==u.key){const vt=u.canonical.z-E.tileID.canonical.z;let mr,Ur,Gn;Y=o.create();const $s=E.tileID.wrap-u.wrap<<u.overscaledZ;vt>0?(mr=o.EXTENT>>vt,Ur=mr*((E.tileID.canonical.x<<vt)-u.canonical.x+$s),Gn=mr*((E.tileID.canonical.y<<vt)-u.canonical.y)):(mr=o.EXTENT<<-vt,Ur=o.EXTENT*(E.tileID.canonical.x-(u.canonical.x+$s<<-vt)),Gn=o.EXTENT*(E.tileID.canonical.y-(u.canonical.y<<-vt))),o.ortho(Y,0,mr,0,mr,0,1),o.translate(Y,Y,[Ur,Gn,0])}return new t_(E.tileID,u.key,Y)}_findTileCoveringTileID(u,E){let B=E.getTile(u);if(B&&B.hasData())return B;const Y=this._findCoveringTileCache[E.id],vt=Y[u.key];if(B=vt?E.getTileByID(vt):null,B&&B.hasData()||vt===null)return B;let mr=B?B.tileID:u,Ur=mr.overscaledZ;const Gn=E.getSource().minzoom,$s=[];if(!vt){const Wu=E.getSource().maxzoom;if(u.canonical.z>=Wu){const dh=u.canonical.z-Wu;E.getSource().reparseOverscaled?(Ur=Math.max(u.canonical.z+2,E.transform.tileZoom),mr=new o.OverscaledTileID(Ur,u.wrap,Wu,u.canonical.x>>dh,u.canonical.y>>dh)):dh!==0&&(Ur=Wu,mr=new o.OverscaledTileID(Ur,u.wrap,Wu,u.canonical.x>>dh,u.canonical.y>>dh))}mr.key!==u.key&&($s.push(mr.key),B=E.getTile(mr))}const el=Wu=>{$s.forEach(dh=>{Y[dh]=Wu}),$s.length=0};for(Ur-=1;Ur>=Gn&&(!B||!B.hasData());Ur--){B&&el(B.tileID.key);const Wu=mr.calculateScaledKey(Ur);if(B=E.getTileByID(Wu),B&&B.hasData())break;const dh=Y[Wu];if(dh===null)break;dh===void 0?$s.push(Wu):B=E.getTileByID(dh)}return el(B?B.tileID.key:null),B&&B.hasData()?B:null}findDEMTileFor(u){return this.enabled?this._findTileCoveringTileID(u,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(u,E){let B=this._tilesDirty[u];B||(B=this._tilesDirty[u]={}),B[E.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const u=function(E){let B=0;const Y=new o.StructArrayLayout2ui4,vt=131;for(let mr=1;mr<129;mr++){for(let Ur=1;Ur<129;Ur++)B=mr*vt+Ur,Y.emplaceBack(B,B+1),Y.emplaceBack(B,B+vt),Y.emplaceBack(B+1,B+vt),mr===128&&Y.emplaceBack(B+vt,B+vt+1);Y.emplaceBack(B+1,B+1+vt)}return Y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(u),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,u.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class im{static cacheKey(u,E,B,Y){let vt=`${E}${Y?Y.cacheKey:""}`;for(const mr of B)u.usedDefines.includes(mr)&&(vt+=`/${mr}`);return vt}constructor(u,E,B,Y,vt,mr){const Ur=u.gl;this.program=Ur.createProgram();const Gn=function(Qu){const bh=[];for(let kh=0;kh<Qu.length;kh++){if(Qu[kh]===null)continue;const Oh=Qu[kh].split(" ");bh.push(Oh.pop())}return bh}(B.staticAttributes),$s=Y?Y.getBinderAttributes():[],el=Gn.concat($s);let Wu=Y?Y.defines():[];Wu=Wu.concat(mr.map(Qu=>`#define ${Qu}`));const dh=u.isWebGL2?`#version 300 es
`:"",gh=dh+Wu.concat(u.extStandardDerivatives&&dh.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(cy):cy,cy,qy,gm.fragmentSource,q_.fragmentSource,B.fragmentSource).join(`
`),Eh=dh+Wu.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,qy,gm.vertexSource,q_.vertexSource,j_.vertexSource,B.vertexSource).join(`
`),yh=Ur.createShader(Ur.FRAGMENT_SHADER);if(Ur.isContextLost())return void(this.failedToCreate=!0);Ur.shaderSource(yh,gh),Ur.compileShader(yh),Ur.attachShader(this.program,yh);const Ih=Ur.createShader(Ur.VERTEX_SHADER);if(Ur.isContextLost())this.failedToCreate=!0;else{Ur.shaderSource(Ih,Eh),Ur.compileShader(Ih),Ur.attachShader(this.program,Ih),this.attributes={},this.numAttributes=el.length;for(let Qu=0;Qu<this.numAttributes;Qu++)el[Qu]&&(Ur.bindAttribLocation(this.program,Qu,el[Qu]),this.attributes[el[Qu]]=Qu);Ur.linkProgram(this.program),Ur.deleteShader(Ih),Ur.deleteShader(yh),this.fixedUniforms=vt(u),this.binderUniforms=Y?Y.getUniforms(u):[],mr.includes("TERRAIN")&&(this.terrainUniforms=(Qu=>({u_dem:new o.Uniform1i(Qu),u_dem_prev:new o.Uniform1i(Qu),u_dem_unpack:new o.Uniform4f(Qu),u_dem_tl:new o.Uniform2f(Qu),u_dem_scale:new o.Uniform1f(Qu),u_dem_tl_prev:new o.Uniform2f(Qu),u_dem_scale_prev:new o.Uniform1f(Qu),u_dem_size:new o.Uniform1f(Qu),u_dem_lerp:new o.Uniform1f(Qu),u_exaggeration:new o.Uniform1f(Qu),u_depth:new o.Uniform1i(Qu),u_depth_size_inv:new o.Uniform2f(Qu),u_meter_to_dem:new o.Uniform1f(Qu),u_label_plane_matrix_inv:new o.UniformMatrix4f(Qu)}))(u)),mr.includes("GLOBE")&&(this.globeUniforms=(Qu=>({u_tile_tl_up:new o.Uniform3f(Qu),u_tile_tr_up:new o.Uniform3f(Qu),u_tile_br_up:new o.Uniform3f(Qu),u_tile_bl_up:new o.Uniform3f(Qu),u_tile_up_scale:new o.Uniform1f(Qu)}))(u)),mr.includes("FOG")&&(this.fogUniforms=(Qu=>({u_fog_matrix:new o.UniformMatrix4f(Qu),u_fog_range:new o.Uniform2f(Qu),u_fog_color:new o.Uniform4f(Qu),u_fog_horizon_blend:new o.Uniform1f(Qu),u_fog_temporal_offset:new o.Uniform1f(Qu),u_frustum_tl:new o.Uniform3f(Qu),u_frustum_tr:new o.Uniform3f(Qu),u_frustum_br:new o.Uniform3f(Qu),u_frustum_bl:new o.Uniform3f(Qu),u_globe_pos:new o.Uniform3f(Qu),u_globe_radius:new o.Uniform1f(Qu),u_globe_transition:new o.Uniform1f(Qu),u_is_globe:new o.Uniform1i(Qu),u_viewport:new o.Uniform2f(Qu)}))(u))}}setTerrainUniformValues(u,E){if(!this.terrainUniforms)return;const B=this.terrainUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const Y in E)B[Y]&&B[Y].set(this.program,Y,E[Y])}}setGlobeUniformValues(u,E){if(!this.globeUniforms)return;const B=this.globeUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const Y in E)B[Y]&&B[Y].set(this.program,Y,E[Y])}}setFogUniformValues(u,E){if(!this.fogUniforms)return;const B=this.fogUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const Y in E)B[Y].set(this.program,Y,E[Y])}}draw(u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh){const Ih=u.gl;if(this.failedToCreate)return;u.program.set(this.program),u.setDepthMode(B),u.setStencilMode(Y),u.setColorMode(vt),u.setCullFace(mr);for(const bh of Object.keys(this.fixedUniforms))this.fixedUniforms[bh].set(this.program,bh,Ur[bh]);Eh&&Eh.setUniforms(this.program,u,this.binderUniforms,dh,{zoom:gh});const Qu={[Ih.LINES]:2,[Ih.TRIANGLES]:3,[Ih.LINE_STRIP]:1}[E];for(const bh of Wu.get()){const kh=bh.vaos||(bh.vaos={});(kh[Gn]||(kh[Gn]=new mv)).bind(u,this,$s,Eh?Eh.getPaintVertexBuffers():[],el,bh.vertexOffset,yh||[]),Ih.drawElements(E,bh.primitiveLength*Qu,Ih.UNSIGNED_SHORT,bh.primitiveOffset*Qu*2)}}}function uy(L,u){const E=Math.pow(2,u.tileID.overscaledZ),B=u.tileSize*Math.pow(2,L.transform.tileZoom)/E,Y=B*(u.tileID.canonical.x+u.tileID.wrap*E),vt=B*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_tile_units_to_pixels:1/yd(u,1,L.transform.tileZoom),u_pixel_coord_upper:[Y>>16,vt>>16],u_pixel_coord_lower:[65535&Y,65535&vt]}}const Hm=o.create(),Ky=(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el)=>{const Wu=u.style.light,dh=Wu.properties.get("position"),gh=[dh.x,dh.y,dh.z],Eh=o.create$1();Wu.properties.get("anchor")==="viewport"&&(o.fromRotation(Eh,-u.transform.angle),o.transformMat3(gh,gh,Eh));const yh=Wu.properties.get("color"),Ih=u.transform,Qu={u_matrix:L,u_lightpos:gh,u_lightintensity:Wu.properties.get("intensity"),u_lightcolor:[yh.r,yh.g,yh.b],u_vertical_gradient:+E,u_opacity:B,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:Y,u_edge_radius:vt};return Ih.projection.name==="globe"&&(Qu.u_tile_id=[mr.canonical.x,mr.canonical.y,1<<mr.canonical.z],Qu.u_zoom_transition=Gn,Qu.u_inv_rot_matrix=el,Qu.u_merc_center=$s,Qu.u_up_dir=Ih.projection.upVector(new o.CanonicalTileID(0,0,0),$s[0]*o.EXTENT,$s[1]*o.EXTENT),Qu.u_height_lift=Ur),Qu},lm=(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu)=>{const dh=Ky(L,u,E,B,Y,vt,mr,Gn,$s,el,Wu),gh={u_height_factor:-Math.pow(2,mr.overscaledZ)/Ur.tileSize/8};return o.extend(dh,uy(u,Ur),gh)},W_=L=>({u_matrix:L}),Am=(L,u,E)=>o.extend(W_(L),uy(u,E)),Im=(L,u)=>({u_matrix:L,u_world:u}),hy=(L,u,E,B)=>o.extend(Am(L,u,E),{u_world:B}),My=o.create(),H0=(L,u,E,B,Y,vt)=>{const mr=L.transform,Ur=mr.projection.name==="globe";let Gn;if(vt.paint.get("circle-pitch-alignment")==="map")if(Ur){const el=o.globePixelsToTileUnits(mr.zoom,u.canonical)*mr._pixelsPerMercatorPixel;Gn=Float32Array.from([el,0,0,el])}else Gn=mr.calculatePixelsToTileUnitsMatrix(E);else Gn=new Float32Array([mr.pixelsToGLUnits[0],0,0,mr.pixelsToGLUnits[1]]);const $s={u_camera_to_center_distance:mr.cameraToCenterDistance,u_matrix:L.translatePosMatrix(u.projMatrix,E,vt.paint.get("circle-translate"),vt.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:Gn,u_inv_rot_matrix:My,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Ur){$s.u_inv_rot_matrix=B,$s.u_merc_center=Y,$s.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],$s.u_zoom_transition=o.globeToMercatorTransition(mr.zoom);const el=Y[0]*o.EXTENT,Wu=Y[1]*o.EXTENT;$s.u_up_dir=mr.projection.upVector(new o.CanonicalTileID(0,0,0),el,Wu)}return $s},k_=L=>{const u=[];return L.paint.get("circle-pitch-alignment")==="map"&&u.push("PITCH_WITH_MAP"),L.paint.get("circle-pitch-scale")==="map"&&u.push("SCALE_WITH_MAP"),u},X0=(L,u,E,B)=>{const Y=o.EXTENT/E.tileSize;return{u_matrix:L,u_camera_to_center_distance:u.getCameraToCenterDistance(B),u_extrude_scale:[u.pixelsToGLUnits[0]/Y,u.pixelsToGLUnits[1]/Y]}},D_=(L,u,E=1)=>({u_matrix:L,u_color:u,u_overlay:0,u_overlay_scale:E}),Y_=o.create(),K0=(L,u,E,B,Y,vt,mr)=>{const Ur=L.transform,Gn=Ur.projection.name==="globe",$s=Gn?o.globePixelsToTileUnits(Ur.zoom,u.canonical)*Ur._pixelsPerMercatorPixel:yd(E,1,vt),el={u_matrix:u.projMatrix,u_extrude_scale:$s,u_intensity:mr,u_inv_rot_matrix:Y_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Gn){el.u_inv_rot_matrix=B,el.u_merc_center=Y,el.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],el.u_zoom_transition=o.globeToMercatorTransition(Ur.zoom);const Wu=Y[0]*o.EXTENT,dh=Y[1]*o.EXTENT;el.u_up_dir=Ur.projection.upVector(new o.CanonicalTileID(0,0,0),Wu,dh)}return el},u0=(L,u,E,B,Y,vt,mr)=>{const Ur=L.transform,Gn=Ur.calculatePixelsToTileUnitsMatrix(u);return{u_matrix:M0(L,u,E,B),u_pixels_to_tile_units:Gn,u_device_pixel_ratio:vt,u_units_to_pixels:[1/Ur.pixelsToGLUnits[0],1/Ur.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:Y,u_texsize:Wy(E)?u.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:J_(u,L.transform),u_alpha_discard_threshold:0,u_trim_offset:mr}},dy=(L,u,E,B,Y)=>{const vt=L.transform;return{u_matrix:M0(L,u,E,B),u_texsize:u.imageAtlasTexture.size,u_pixels_to_tile_units:vt.calculatePixelsToTileUnitsMatrix(u),u_device_pixel_ratio:Y,u_image:0,u_tile_units_to_pixels:J_(u,vt),u_units_to_pixels:[1/vt.pixelsToGLUnits[0],1/vt.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function J_(L,u){return 1/yd(L,1,u.tileZoom)}function M0(L,u,E,B){return L.translatePosMatrix(B||u.tileID.projMatrix,u,E.paint.get("line-translate"),E.paint.get("line-translate-anchor"))}function Wy(L){const u=L.paint.get("line-dasharray").value;return u.value||u.kind!=="constant"}const L_=(L,u,E,B,Y,vt)=>{return{u_matrix:L,u_tl_parent:u,u_scale_parent:E,u_fade_t:B.mix,u_opacity:B.opacity*Y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Y.paint.get("raster-brightness-min"),u_brightness_high:Y.paint.get("raster-brightness-max"),u_saturation_factor:(Ur=Y.paint.get("raster-saturation"),Ur>0?1-1/(1.001-Ur):-Ur),u_contrast_factor:(mr=Y.paint.get("raster-contrast"),mr>0?1/(1-mr):1+mr),u_spin_weights:__(Y.paint.get("raster-hue-rotate")),u_perspective_transform:vt};var mr,Ur};function __(L){L*=Math.PI/180;const u=Math.sin(L),E=Math.cos(L);return[(2*E+1)/3,(-Math.sqrt(3)*u-E+1)/3,(Math.sqrt(3)*u-E+1)/3]}const c_=o.create(),bd=(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh)=>{const Ih=Y.transform,Qu={u_is_size_zoom_constant:+(L==="constant"||L==="source"),u_is_size_feature_constant:+(L==="constant"||L==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ih.cameraToCenterDistance,u_rotate_symbol:+E,u_aspect_ratio:Ih.width/Ih.height,u_fade_change:Y.options.fadeDuration?Y.symbolFadeChange:1,u_matrix:vt,u_label_plane_matrix:mr,u_coord_matrix:Ur,u_is_text:+Gn,u_pitch_with_map:+B,u_texsize:$s,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:c_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:c_,u_up_vector:[0,-1,0]};return yh.name==="globe"&&(Qu.u_tile_id=[el.canonical.x,el.canonical.y,1<<el.canonical.z],Qu.u_zoom_transition=Wu,Qu.u_inv_rot_matrix=gh,Qu.u_merc_center=dh,Qu.u_camera_forward=Ih._camera.forward(),Qu.u_ecef_origin=o.globeECEFOrigin(Ih.globeMatrix,el.toUnwrapped()),Qu.u_tile_matrix=Float32Array.from(Ih.globeMatrix),Qu.u_up_vector=Eh),Qu},mf=(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh,Ih)=>o.extend(bd(L,u,E,B,Y,vt,mr,Ur,Gn,$s,Wu,dh,gh,Eh,yh,Ih),{u_gamma_scale:B?Y.transform.cameraToCenterDistance*Math.cos(Y.terrain?0:Y.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+el}),np=(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu,dh,gh,Eh,yh)=>o.extend(mf(L,u,E,B,Y,vt,mr,Ur,!0,Gn,!0,el,Wu,dh,gh,Eh,yh),{u_texsize_icon:$s,u_texture_icon:1}),Dp=(L,u,E)=>({u_matrix:L,u_opacity:u,u_color:E}),Fm=(L,u,E,B,Y)=>o.extend(function(vt,mr,Ur){const Gn=mr.imageManager.getPattern(vt.toString()),{width:$s,height:el}=mr.imageManager.getPixelSize(),Wu=Math.pow(2,Ur.tileID.overscaledZ),dh=Ur.tileSize*Math.pow(2,mr.transform.tileZoom)/Wu,gh=dh*(Ur.tileID.canonical.x+Ur.tileID.wrap*Wu),Eh=dh*Ur.tileID.canonical.y;return{u_image:0,u_pattern_tl:Gn.tl,u_pattern_br:Gn.br,u_texsize:[$s,el],u_pattern_size:Gn.displaySize,u_tile_units_to_pixels:1/yd(Ur,1,mr.transform.tileZoom),u_pixel_coord_upper:[gh>>16,Eh>>16],u_pixel_coord_lower:[65535&gh,65535&Eh]}}(B,E,Y),{u_matrix:L,u_opacity:u}),om={fillExtrusion:L=>({u_matrix:new o.UniformMatrix4f(L),u_lightpos:new o.Uniform3f(L),u_lightintensity:new o.Uniform1f(L),u_lightcolor:new o.Uniform3f(L),u_vertical_gradient:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_edge_radius:new o.Uniform1f(L),u_ao:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_up_dir:new o.Uniform3f(L),u_height_lift:new o.Uniform1f(L)}),fillExtrusionPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_lightpos:new o.Uniform3f(L),u_lightintensity:new o.Uniform1f(L),u_lightcolor:new o.Uniform3f(L),u_vertical_gradient:new o.Uniform1f(L),u_height_factor:new o.Uniform1f(L),u_edge_radius:new o.Uniform1f(L),u_ao:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_up_dir:new o.Uniform3f(L),u_height_lift:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L)}),fill:L=>({u_matrix:new o.UniformMatrix4f(L)}),fillPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),fillOutline:L=>({u_matrix:new o.UniformMatrix4f(L),u_world:new o.Uniform2f(L)}),fillOutlinePattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_world:new o.Uniform2f(L),u_image:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),circle:L=>({u_camera_to_center_distance:new o.Uniform1f(L),u_extrude_scale:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_up_dir:new o.Uniform3f(L)}),collisionBox:L=>({u_matrix:new o.UniformMatrix4f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_extrude_scale:new o.Uniform2f(L)}),collisionCircle:L=>({u_matrix:new o.UniformMatrix4f(L),u_inv_matrix:new o.UniformMatrix4f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_viewport_size:new o.Uniform2f(L)}),debug:L=>({u_color:new o.UniformColor(L),u_matrix:new o.UniformMatrix4f(L),u_overlay:new o.Uniform1i(L),u_overlay_scale:new o.Uniform1f(L)}),clippingMask:L=>({u_matrix:new o.UniformMatrix4f(L)}),heatmap:L=>({u_extrude_scale:new o.Uniform1f(L),u_intensity:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_up_dir:new o.Uniform3f(L)}),heatmapTexture:L=>({u_image:new o.Uniform1i(L),u_color_ramp:new o.Uniform1i(L),u_opacity:new o.Uniform1f(L)}),hillshade:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_latrange:new o.Uniform2f(L),u_light:new o.Uniform2f(L),u_shadow:new o.UniformColor(L),u_highlight:new o.UniformColor(L),u_accent:new o.UniformColor(L)}),hillshadePrepare:L=>({u_matrix:new o.UniformMatrix4f(L),u_image:new o.Uniform1i(L),u_dimension:new o.Uniform2f(L),u_zoom:new o.Uniform1f(L),u_unpack:new o.Uniform4f(L)}),line:L=>({u_matrix:new o.UniformMatrix4f(L),u_pixels_to_tile_units:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_units_to_pixels:new o.Uniform2f(L),u_dash_image:new o.Uniform1i(L),u_gradient_image:new o.Uniform1i(L),u_image_height:new o.Uniform1f(L),u_texsize:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_alpha_discard_threshold:new o.Uniform1f(L),u_trim_offset:new o.Uniform2f(L)}),linePattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_texsize:new o.Uniform2f(L),u_pixels_to_tile_units:new o.UniformMatrix2f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_units_to_pixels:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L),u_alpha_discard_threshold:new o.Uniform1f(L)}),raster:L=>({u_matrix:new o.UniformMatrix4f(L),u_tl_parent:new o.Uniform2f(L),u_scale_parent:new o.Uniform1f(L),u_fade_t:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_image0:new o.Uniform1i(L),u_image1:new o.Uniform1i(L),u_brightness_low:new o.Uniform1f(L),u_brightness_high:new o.Uniform1f(L),u_saturation_factor:new o.Uniform1f(L),u_contrast_factor:new o.Uniform1f(L),u_spin_weights:new o.Uniform3f(L),u_perspective_transform:new o.Uniform2f(L)}),symbolIcon:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_camera_forward:new o.Uniform3f(L),u_tile_matrix:new o.UniformMatrix4f(L),u_up_vector:new o.Uniform3f(L),u_ecef_origin:new o.Uniform3f(L),u_texture:new o.Uniform1i(L)}),symbolSDF:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_texture:new o.Uniform1i(L),u_gamma_scale:new o.Uniform1f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_tile_id:new o.Uniform3f(L),u_zoom_transition:new o.Uniform1f(L),u_inv_rot_matrix:new o.UniformMatrix4f(L),u_merc_center:new o.Uniform2f(L),u_camera_forward:new o.Uniform3f(L),u_tile_matrix:new o.UniformMatrix4f(L),u_up_vector:new o.Uniform3f(L),u_ecef_origin:new o.Uniform3f(L),u_is_halo:new o.Uniform1i(L)}),symbolTextAndIcon:L=>({u_is_size_zoom_constant:new o.Uniform1i(L),u_is_size_feature_constant:new o.Uniform1i(L),u_size_t:new o.Uniform1f(L),u_size:new o.Uniform1f(L),u_camera_to_center_distance:new o.Uniform1f(L),u_rotate_symbol:new o.Uniform1i(L),u_aspect_ratio:new o.Uniform1f(L),u_fade_change:new o.Uniform1f(L),u_matrix:new o.UniformMatrix4f(L),u_label_plane_matrix:new o.UniformMatrix4f(L),u_coord_matrix:new o.UniformMatrix4f(L),u_is_text:new o.Uniform1i(L),u_pitch_with_map:new o.Uniform1i(L),u_texsize:new o.Uniform2f(L),u_texsize_icon:new o.Uniform2f(L),u_texture:new o.Uniform1i(L),u_texture_icon:new o.Uniform1i(L),u_gamma_scale:new o.Uniform1f(L),u_device_pixel_ratio:new o.Uniform1f(L),u_is_halo:new o.Uniform1i(L)}),background:L=>({u_matrix:new o.UniformMatrix4f(L),u_opacity:new o.Uniform1f(L),u_color:new o.UniformColor(L)}),backgroundPattern:L=>({u_matrix:new o.UniformMatrix4f(L),u_opacity:new o.Uniform1f(L),u_image:new o.Uniform1i(L),u_pattern_tl:new o.Uniform2f(L),u_pattern_br:new o.Uniform2f(L),u_texsize:new o.Uniform2f(L),u_pattern_size:new o.Uniform2f(L),u_pixel_coord_upper:new o.Uniform2f(L),u_pixel_coord_lower:new o.Uniform2f(L),u_tile_units_to_pixels:new o.Uniform1f(L)}),terrainRaster:H_,terrainDepth:H_,skybox:L=>({u_matrix:new o.UniformMatrix4f(L),u_sun_direction:new o.Uniform3f(L),u_cubemap:new o.Uniform1i(L),u_opacity:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L)}),skyboxGradient:L=>({u_matrix:new o.UniformMatrix4f(L),u_color_ramp:new o.Uniform1i(L),u_center_direction:new o.Uniform3f(L),u_radius:new o.Uniform1f(L),u_opacity:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L)}),skyboxCapture:L=>({u_matrix_3f:new o.UniformMatrix3f(L),u_sun_direction:new o.Uniform3f(L),u_sun_intensity:new o.Uniform1f(L),u_color_tint_r:new o.Uniform4f(L),u_color_tint_m:new o.Uniform4f(L),u_luminance:new o.Uniform1f(L)}),globeRaster:L=>({u_proj_matrix:new o.UniformMatrix4f(L),u_globe_matrix:new o.UniformMatrix4f(L),u_normalize_matrix:new o.UniformMatrix4f(L),u_merc_matrix:new o.UniformMatrix4f(L),u_zoom_transition:new o.Uniform1f(L),u_merc_center:new o.Uniform2f(L),u_image0:new o.Uniform1i(L),u_grid_matrix:new o.UniformMatrix3f(L),u_skirt_height:new o.Uniform1f(L),u_frustum_tl:new o.Uniform3f(L),u_frustum_tr:new o.Uniform3f(L),u_frustum_br:new o.Uniform3f(L),u_frustum_bl:new o.Uniform3f(L),u_globe_pos:new o.Uniform3f(L),u_globe_radius:new o.Uniform1f(L),u_viewport:new o.Uniform2f(L)}),globeAtmosphere:L=>({u_frustum_tl:new o.Uniform3f(L),u_frustum_tr:new o.Uniform3f(L),u_frustum_br:new o.Uniform3f(L),u_frustum_bl:new o.Uniform3f(L),u_horizon:new o.Uniform1f(L),u_transition:new o.Uniform1f(L),u_fadeout_range:new o.Uniform1f(L),u_color:new o.Uniform4f(L),u_high_color:new o.Uniform4f(L),u_space_color:new o.Uniform4f(L),u_star_intensity:new o.Uniform1f(L),u_star_density:new o.Uniform1f(L),u_star_size:new o.Uniform1f(L),u_temporal_offset:new o.Uniform1f(L),u_horizon_angle:new o.Uniform1f(L),u_rotation_matrix:new o.UniformMatrix4f(L)})};let qm;function Um(L,u,E,B,Y,vt,mr){const Ur=L.context,Gn=Ur.gl,$s=L.transform,el=L.useProgram("collisionBox"),Wu=[];let dh=0,gh=0;for(let Oh=0;Oh<B.length;Oh++){const rd=B[Oh],sd=u.getTile(rd),ld=sd.getBucket(E);if(!ld)continue;const dd=rp(rd,ld,$s);let ud=dd;Y[0]===0&&Y[1]===0||(ud=L.translatePosMatrix(dd,sd,Y,vt));const md=mr?ld.textCollisionBox:ld.iconCollisionBox,Af=ld.collisionCircleArray;if(Af.length>0){const Td=o.create(),Gd=ud;o.mul(Td,ld.placementInvProjMatrix,$s.glCoordMatrix),o.mul(Td,Td,ld.placementViewportMatrix),Wu.push({circleArray:Af,circleOffset:gh,transform:Gd,invTransform:Td,projection:ld.getProjection()}),dh+=Af.length/4,gh=dh}md&&(L.terrain&&L.terrain.setupElevationDraw(sd,el),el.draw(Ur,Gn.LINES,o.DepthMode.disabled,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.disabled,X0(ud,$s,sd,ld.getProjection()),E.id,md.layoutVertexBuffer,md.indexBuffer,md.segments,null,$s.zoom,null,[md.collisionVertexBuffer,md.collisionVertexBufferExt]))}if(!mr||!Wu.length)return;const Eh=L.useProgram("collisionCircle"),yh=new o.StructArrayLayout2f1f2i16;yh.resize(4*dh),yh._trim();let Ih=0;for(const Oh of Wu)for(let rd=0;rd<Oh.circleArray.length/4;rd++){const sd=4*rd,ld=Oh.circleArray[sd+0],dd=Oh.circleArray[sd+1],ud=Oh.circleArray[sd+2],md=Oh.circleArray[sd+3];yh.emplace(Ih++,ld,dd,ud,md,0),yh.emplace(Ih++,ld,dd,ud,md,1),yh.emplace(Ih++,ld,dd,ud,md,2),yh.emplace(Ih++,ld,dd,ud,md,3)}(!qm||qm.length<2*dh)&&(qm=function(Oh){const rd=2*Oh,sd=new o.StructArrayLayout3ui6;sd.resize(rd),sd._trim();for(let ld=0;ld<rd;ld++){const dd=6*ld;sd.uint16[dd+0]=4*ld+0,sd.uint16[dd+1]=4*ld+1,sd.uint16[dd+2]=4*ld+2,sd.uint16[dd+3]=4*ld+2,sd.uint16[dd+4]=4*ld+3,sd.uint16[dd+5]=4*ld+0}return sd}(dh));const Qu=Ur.createIndexBuffer(qm,!0),bh=Ur.createVertexBuffer(yh,o.collisionCircleLayout.members,!0);for(const Oh of Wu){const rd={u_matrix:Oh.transform,u_inv_matrix:Oh.invTransform,u_camera_to_center_distance:(kh=$s).getCameraToCenterDistance(Oh.projection),u_viewport_size:[kh.width,kh.height]};Eh.draw(Ur,Gn.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,L.colorModeForRenderPass(),o.CullFaceMode.disabled,rd,E.id,bh,Qu,o.SegmentVector.simpleSegment(0,2*Oh.circleOffset,Oh.circleArray.length,Oh.circleArray.length/2),null,$s.zoom)}var kh;bh.destroy(),Qu.destroy()}const Ag=o.create();function Pm({width:L,height:u,anchor:E,textOffset:B,textScale:Y},vt){const{horizontalAlign:mr,verticalAlign:Ur}=o.getAnchorAlignment(E),Gn=-(mr-.5)*L,$s=-(Ur-.5)*u,el=o.evaluateVariableOffset(E,B);return new o.Point((Gn/Y+el[0])*vt,($s/Y+el[1])*vt)}function tp(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el){const Wu=L.text.placedSymbolArray,dh=L.text.dynamicLayoutVertexArray,gh=L.icon.dynamicLayoutVertexArray,Eh={},yh=L.getProjection(),Ih=Gf(Ur,yh,vt),Qu=vt.elevation,bh=yh.upVectorScale(Ur.canonical,vt.center.lat,vt.worldSize).metersToTile;dh.clear();for(let kh=0;kh<Wu.length;kh++){const Oh=Wu.get(kh),{tileAnchorX:rd,tileAnchorY:sd,numGlyphs:ld}=Oh,dd=Oh.hidden||!Oh.crossTileID||L.allowVerticalPlacement&&!Oh.placedOrientation?null:B[Oh.crossTileID];if(dd){let ud=0,md=0,Af=0;if(Qu){const Vf=Qu?Qu.getAtTileOffset(Ur,rd,sd):0,[Lp,Mp,fp]=yh.upVector(Ur.canonical,rd,sd);ud=Vf*Lp*bh,md=Vf*Mp*bh,Af=Vf*fp*bh}let[Td,Gd,Od,Lf]=sg(Oh.projectedAnchorX+ud,Oh.projectedAnchorY+md,Oh.projectedAnchorZ+Af,E?Ih:mr);const Dd=wy(vt.getCameraToCenterDistance(yh),Lf);let yf=Y.evaluateSizeForFeature(L.textSizeData,$s,Oh)*Dd/o.ONE_EM;E&&(yf*=L.tilePixelRatio/Gn);const zf=Pm(dd,yf);E?({x:Td,y:Gd,z:Od}=yh.projectTilePoint(rd+zf.x,sd+zf.y,Ur.canonical),[Td,Gd,Od]=sg(Td+ud,Gd+md,Od+Af,mr)):(u&&zf._rotate(-vt.angle),Td+=zf.x,Gd+=zf.y,Od=0);const Pf=L.allowVerticalPlacement&&Oh.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Vf=0;Vf<ld;Vf++)o.addDynamicAttributes(dh,Td,Gd,Od,Pf);el&&Oh.associatedIconIndex>=0&&(Eh[Oh.associatedIconIndex]={x:Td,y:Gd,z:Od,angle:Pf})}else od(ld,dh)}if(el){gh.clear();const kh=L.icon.placedSymbolArray;for(let Oh=0;Oh<kh.length;Oh++){const rd=kh.get(Oh),{numGlyphs:sd}=rd,ld=Eh[Oh];if(rd.hidden||!ld)od(sd,gh);else{const{x:dd,y:ud,z:md,angle:Af}=ld;for(let Td=0;Td<sd;Td++)o.addDynamicAttributes(gh,dd,ud,md,Af)}}L.icon.dynamicLayoutVertexBuffer.updateData(gh)}L.text.dynamicLayoutVertexBuffer.updateData(dh)}function $g(L,u,E){return E.iconsInText&&u?"symbolTextAndIcon":L?"symbolSDF":"symbolIcon"}function Bg(L,u,E,B,Y,vt,mr,Ur,Gn,$s,el,Wu){const dh=L.context,gh=dh.gl,Eh=L.transform,yh=Ur==="map",Ih=Gn==="map",Qu=yh&&E.layout.get("symbol-placement")!=="point",bh=yh&&!Ih&&!Qu,kh=E.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Oh=!1;const rd=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),sd=[o.mercatorXfromLng(Eh.center.lng),o.mercatorYfromLat(Eh.center.lat)],ld=E.layout.get("text-variable-anchor"),dd=Eh.projection.name==="globe",ud=[],md=[0,-1,0];let Af=md;!dd&&!Eh.mercatorFromTransition||yh||(Af=function(Td){const Gd=Td._camera.getWorldToCamera(Td.worldSize,1),Od=o.multiply([],Gd,Td.globeMatrix);o.invert(Od,Od);const Lf=[0,0,0],Dd=[0,1,0,0];return o.transformMat4$1(Dd,Dd,Od),Lf[0]=Dd[0],Lf[1]=Dd[1],Lf[2]=Dd[2],o.normalize(Lf,Lf),Lf}(Eh));for(const Td of B){const Gd=u.getTile(Td),Od=Gd.getBucket(E);if(!Od||Od.projection.name==="mercator"&&dd)continue;const Lf=Y?Od.text:Od.icon;if(!Lf||Od.fullyClipped||!Lf.segments.get().length)continue;const Dd=Lf.programConfigurations.get(E.id),yf=Y||Od.sdfIcons,zf=Y?Od.textSizeData:Od.iconSizeData,Pf=Ih||Eh.pitch!==0,Vf=o.evaluateSizeForZoom(zf,Eh.zoom);let Lp,Mp,fp,Fp,cm=[0,0],Jp=null;if(Y)Mp=Gd.glyphAtlasTexture,fp=gh.LINEAR,Lp=Gd.glyphAtlasTexture.size,Od.iconsInText&&(cm=Gd.imageAtlasTexture.size,Jp=Gd.imageAtlasTexture,Fp=Pf||L.options.rotating||L.options.zooming||zf.kind==="composite"||zf.kind==="camera"?gh.LINEAR:gh.NEAREST);else{const $0=E.layout.get("icon-size").constantOr(0)!==1||Od.iconsNeedLinear;Mp=Gd.imageAtlasTexture,fp=yf||L.options.rotating||L.options.zooming||$0||Pf?gh.LINEAR:gh.NEAREST,Lp=Gd.imageAtlasTexture.size}const kp=Od.projection.name==="globe",_m=kp?Af:md,Lm=kp?o.globeToMercatorTransition(Eh.zoom):0,Rm=Gf(Td,Od.getProjection(),Eh),Vm=Eh.calculatePixelsToTileUnitsMatrix(Gd),i_=Yd(Rm,Gd.tileID.canonical,Ih,yh,Eh,Od.getProjection(),Vm),qg=L.terrain&&Ih&&Qu?o.invert(o.create(),i_):Ag,ey=km(Rm,Gd.tileID.canonical,Ih,yh,Eh,Od.getProjection(),Vm),ty=ld&&Od.hasTextData(),pm=E.layout.get("icon-text-fit")!=="none"&&ty&&Od.hasIconData();if(Qu){const $0=Eh.elevation,nv=$0?$0.getAtTileOffsetFunc(Td,Eh.center.lat,Eh.worldSize,Od.getProjection()):null,Tv=Mg(Rm,Gd.tileID.canonical,Ih,yh,Eh,Od.getProjection(),Vm);a0(Od,Rm,L,Y,Tv,ey,Ih,$s,nv,Td)}const Om=Qu||Y&&ld||pm,vm=L.translatePosMatrix(Rm,Gd,vt,mr),kg=Om?Ag:i_,N_=L.translatePosMatrix(ey,Gd,vt,mr,!0),$m=Od.getProjection().createInversionMatrix(Eh,Td.canonical),u_=[];L.terrainRenderModeElevated()&&Ih&&u_.push("PITCH_WITH_MAP_TERRAIN"),kp&&u_.push("PROJECTION_GLOBE_VIEW"),Om&&u_.push("PROJECTED_POS_ON_VIEWPORT");const l1=yf&&E.paint.get(Y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gy;gy=yf?Od.iconsInText?np(zf.kind,Vf,bh,Ih,L,vm,kg,N_,Lp,cm,Td,Lm,sd,$m,_m,Od.getProjection()):mf(zf.kind,Vf,bh,Ih,L,vm,kg,N_,Y,Lp,!0,Td,Lm,sd,$m,_m,Od.getProjection()):bd(zf.kind,Vf,bh,Ih,L,vm,kg,N_,Y,Lp,Td,Lm,sd,$m,_m,Od.getProjection());const O0={program:L.useProgram($g(yf,Y,Od),Dd,u_),buffers:Lf,uniformValues:gy,atlasTexture:Mp,atlasTextureIcon:Jp,atlasInterpolation:fp,atlasInterpolationIcon:Fp,isSDF:yf,hasHalo:l1,tile:Gd,labelPlaneMatrixInv:qg};if(kh&&Od.canOverlap){Oh=!0;const $0=Lf.segments.get();for(const nv of $0)ud.push({segments:new o.SegmentVector([nv]),sortKey:nv.sortKey,state:O0})}else ud.push({segments:Lf.segments,sortKey:0,state:O0})}Oh&&ud.sort((Td,Gd)=>Td.sortKey-Gd.sortKey);for(const Td of ud){const Gd=Td.state;if(L.terrain&&L.terrain.setupElevationDraw(Gd.tile,Gd.program,{useDepthForOcclusion:!dd,labelPlaneMatrixInv:Gd.labelPlaneMatrixInv}),dh.activeTexture.set(gh.TEXTURE0),Gd.atlasTexture.bind(Gd.atlasInterpolation,gh.CLAMP_TO_EDGE),Gd.atlasTextureIcon&&(dh.activeTexture.set(gh.TEXTURE1),Gd.atlasTextureIcon&&Gd.atlasTextureIcon.bind(Gd.atlasInterpolationIcon,gh.CLAMP_TO_EDGE)),Gd.isSDF){const Od=Gd.uniformValues;Gd.hasHalo&&(Od.u_is_halo=1,Zm(Gd.buffers,Td.segments,E,L,Gd.program,rd,el,Wu,Od)),Od.u_is_halo=0}Zm(Gd.buffers,Td.segments,E,L,Gd.program,rd,el,Wu,Gd.uniformValues)}}function Zm(L,u,E,B,Y,vt,mr,Ur,Gn){const $s=B.context,el=[L.dynamicLayoutVertexBuffer,L.opacityVertexBuffer,L.globeExtVertexBuffer];Y.draw($s,$s.gl.TRIANGLES,vt,mr,Ur,o.CullFaceMode.disabled,Gn,E.id,L.layoutVertexBuffer,L.indexBuffer,u,E.paint,B.transform.zoom,L.programConfigurations.get(E.id),el)}function R_(L,u,E,B,Y,vt,mr){const Ur=L.context.gl,Gn=E.paint.get("fill-pattern"),$s=Gn&&Gn.constantOr(1);let el,Wu,dh,gh,Eh;mr?(Wu=$s&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",el=Ur.LINES):(Wu=$s?"fillPattern":"fill",el=Ur.TRIANGLES);for(const yh of B){const Ih=u.getTile(yh);if($s&&!Ih.patternsLoaded())continue;const Qu=Ih.getBucket(E);if(!Qu)continue;L.prepareDrawTile();const bh=Qu.programConfigurations.get(E.id),kh=L.useProgram(Wu,bh);$s&&(L.context.activeTexture.set(Ur.TEXTURE0),Ih.imageAtlasTexture.bind(Ur.LINEAR,Ur.CLAMP_TO_EDGE),bh.updatePaintBuffers());const Oh=Gn.constantOr(null);if(Oh&&Ih.imageAtlas){const sd=Ih.imageAtlas.patternPositions[Oh.toString()];sd&&bh.setConstantPatternPositions(sd)}const rd=L.translatePosMatrix(yh.projMatrix,Ih,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));if(mr){gh=Qu.indexBuffer2,Eh=Qu.segments2;const sd=L.terrain&&L.terrain.renderingToTexture?L.terrain.drapeBufferSize:[Ur.drawingBufferWidth,Ur.drawingBufferHeight];dh=Wu==="fillOutlinePattern"&&$s?hy(rd,L,Ih,sd):Im(rd,sd)}else gh=Qu.indexBuffer,Eh=Qu.segments,dh=$s?Am(rd,L,Ih):W_(rd);L.prepareDrawProgram(L.context,kh,yh.toUnwrapped()),kh.draw(L.context,el,Y,L.stencilModeForClipping(yh),vt,o.CullFaceMode.disabled,dh,E.id,Qu.layoutVertexBuffer,gh,Eh,E.paint,L.transform.zoom,bh)}}function ip(L,u,E,B,Y,vt,mr){const Ur=L.context,Gn=Ur.gl,$s=L.transform,el=E.paint.get("fill-extrusion-pattern"),Wu=el.constantOr(1),dh=E.paint.get("fill-extrusion-opacity"),gh=[E.paint.get("fill-extrusion-ambient-occlusion-intensity"),E.paint.get("fill-extrusion-ambient-occlusion-radius")],Eh=E.layout.get("fill-extrusion-edge-radius"),yh=Eh>0&&!E.paint.get("fill-extrusion-rounded-roof"),Ih=yh?0:Eh,Qu=$s.projection.name==="globe"?o.fillExtrusionHeightLift():0,bh=$s.projection.name==="globe",kh=bh?o.globeToMercatorTransition($s.zoom):0,Oh=[o.mercatorXfromLng($s.center.lng),o.mercatorYfromLat($s.center.lat)],rd=[];bh&&rd.push("PROJECTION_GLOBE_VIEW"),gh[0]>0&&rd.push("FAUX_AO"),yh&&rd.push("ZERO_ROOF_RADIUS");for(const sd of B){const ld=u.getTile(sd),dd=ld.getBucket(E);if(!dd||dd.projection.name!==$s.projection.name)continue;const ud=dd.programConfigurations.get(E.id),md=L.useProgram(Wu?"fillExtrusionPattern":"fillExtrusion",ud,rd);if(L.terrain){const yf=L.terrain;if(L.style.terrainSetForDrapingOnly())yf.setupElevationDraw(ld,md,{useMeterToDem:!0});else{if(!dd.enableTerrain)continue;if(yf.setupElevationDraw(ld,md,{useMeterToDem:!0}),Yy(Ur,u,sd,dd,E,yf),!dd.centroidVertexBuffer){const zf=md.attributes.a_centroid_pos;zf!==void 0&&Gn.vertexAttrib2f(zf,0,0)}}}Wu&&(L.context.activeTexture.set(Gn.TEXTURE0),ld.imageAtlasTexture.bind(Gn.LINEAR,Gn.CLAMP_TO_EDGE),ud.updatePaintBuffers());const Af=el.constantOr(null);if(Af&&ld.imageAtlas){const yf=ld.imageAtlas.patternPositions[Af.toString()];yf&&ud.setConstantPatternPositions(yf)}const Td=L.translatePosMatrix(sd.projMatrix,ld,E.paint.get("fill-extrusion-translate"),E.paint.get("fill-extrusion-translate-anchor")),Gd=$s.projection.createInversionMatrix($s,sd.canonical),Od=E.paint.get("fill-extrusion-vertical-gradient"),Lf=Wu?lm(Td,L,Od,dh,gh,Ih,sd,ld,Qu,kh,Oh,Gd):Ky(Td,L,Od,dh,gh,Ih,sd,Qu,kh,Oh,Gd);L.prepareDrawProgram(Ur,md,sd.toUnwrapped());const Dd=[];L.terrain&&Dd.push(dd.centroidVertexBuffer),bh&&Dd.push(dd.layoutVertexExtBuffer),md.draw(Ur,Ur.gl.TRIANGLES,Y,vt,mr,o.CullFaceMode.backCCW,Lf,E.id,dd.layoutVertexBuffer,dd.indexBuffer,dd.segments,E.paint,L.transform.zoom,ud,Dd)}}function Yy(L,u,E,B,Y,vt){const mr=[Qu=>{let bh=Qu.canonical.x-1,kh=Qu.wrap;return bh<0&&(bh=(1<<Qu.canonical.z)-1,kh--),new o.OverscaledTileID(Qu.overscaledZ,kh,Qu.canonical.z,bh,Qu.canonical.y)},Qu=>{let bh=Qu.canonical.x+1,kh=Qu.wrap;return bh===1<<Qu.canonical.z&&(bh=0,kh++),new o.OverscaledTileID(Qu.overscaledZ,kh,Qu.canonical.z,bh,Qu.canonical.y)},Qu=>new o.OverscaledTileID(Qu.overscaledZ,Qu.wrap,Qu.canonical.z,Qu.canonical.x,(Qu.canonical.y===0?1<<Qu.canonical.z:Qu.canonical.y)-1),Qu=>new o.OverscaledTileID(Qu.overscaledZ,Qu.wrap,Qu.canonical.z,Qu.canonical.x,Qu.canonical.y===(1<<Qu.canonical.z)-1?0:Qu.canonical.y+1)],Ur=Qu=>{const bh=u.getSource().minzoom,kh=rd=>{const sd=u.getTileByID(rd);if(sd&&sd.hasData())return sd.getBucket(Y)},Oh=[0,-1,1];for(const rd of Oh){if(Qu.overscaledZ+rd<bh)continue;const sd=kh(Qu.calculateScaledKey(Qu.overscaledZ+rd));if(sd)return sd}},Gn=[0,0,0],$s=(Qu,bh)=>(Gn[0]=Math.min(Qu.min.y,bh.min.y),Gn[1]=Math.max(Qu.max.y,bh.max.y),Gn[2]=o.EXTENT-bh.min.x>Qu.max.x?bh.min.x-o.EXTENT:Qu.max.x,Gn),el=(Qu,bh)=>(Gn[0]=Math.min(Qu.min.x,bh.min.x),Gn[1]=Math.max(Qu.max.x,bh.max.x),Gn[2]=o.EXTENT-bh.min.y>Qu.max.y?bh.min.y-o.EXTENT:Qu.max.y,Gn),Wu=[(Qu,bh)=>$s(Qu,bh),(Qu,bh)=>$s(bh,Qu),(Qu,bh)=>el(Qu,bh),(Qu,bh)=>el(bh,Qu)],dh=new o.Point(0,0);let gh,Eh,yh;const Ih=(Qu,bh,kh,Oh,rd)=>{const sd=[[Oh?kh:Qu,Oh?Qu:kh,0],[Oh?kh:bh,Oh?bh:kh,0]],ld=rd<0?o.EXTENT+rd:rd,dd=[Oh?ld:(Qu+bh)/2,Oh?(Qu+bh)/2:ld,0];return kh===0&&rd<0||kh!==0&&rd>0?vt.getForTilePoints(yh,[dd],!0,Eh):sd.push(dd),vt.getForTilePoints(E,sd,!0,gh),Math.max(sd[0][2],sd[1][2],dd[2])/vt.exaggeration()};for(let Qu=0;Qu<4;Qu++){const bh=(Qu<2?1:5)-Qu,kh=B.borders[Qu];if(kh.length===0)continue;const Oh=yh=mr[Qu](E),rd=Ur(Oh);if(!(rd&&rd instanceof o.FillExtrusionBucket&&rd.enableTerrain)||B.borderDoneWithNeighborZ[Qu]===rd.canonical.z&&rd.borderDoneWithNeighborZ[bh]===B.canonical.z||(Eh=vt.findDEMTileFor(Oh),!Eh||!Eh.dem))continue;if(!gh){const ud=vt.findDEMTileFor(E);if(!ud||!ud.dem)return;gh=ud}const sd=rd.borders[bh];let ld=0;const dd=rd.borderDoneWithNeighborZ[bh]!==B.canonical.z;if(B.canonical.z===rd.canonical.z){for(let ud=0;ud<kh.length;ud++){const md=B.featuresOnBorder[kh[ud]],Af=md.borders[Qu];let Td;for(;ld<sd.length&&(Td=rd.featuresOnBorder[sd[ld]],!(Td.borders[bh][1]>Af[0]+3));)dd&&rd.encodeCentroid(void 0,Td,!1),ld++;if(Td&&ld<sd.length){const Gd=ld;let Od=0;for(;!(Td.borders[bh][0]>Af[1]-3)&&(Od++,++ld!==sd.length);)Td=rd.featuresOnBorder[sd[ld]];if(Td=rd.featuresOnBorder[sd[Gd]],md.intersectsCount()>1||Td.intersectsCount()>1||Od!==1){Od!==1&&(ld=Gd),B.encodeCentroid(void 0,md,!1),dd&&rd.encodeCentroid(void 0,Td,!1);continue}const Lf=Wu[Qu](md,Td),Dd=Qu%2?o.EXTENT-1:0;dh.x=Ih(Lf[0],Math.min(o.EXTENT-1,Lf[1]),Dd,Qu<2,Lf[2]),dh.y=0,B.encodeCentroid(dh,md,!1),dd&&rd.encodeCentroid(dh,Td,!1)}else B.encodeCentroid(void 0,md,!1)}B.borderDoneWithNeighborZ[Qu]=rd.canonical.z,B.needsCentroidUpdate=!0,dd&&(rd.borderDoneWithNeighborZ[bh]=B.canonical.z,rd.needsCentroidUpdate=!0)}else{for(const ud of kh)B.encodeCentroid(void 0,B.featuresOnBorder[ud],!1);if(dd){for(const ud of sd)rd.encodeCentroid(void 0,rd.featuresOnBorder[ud],!1);rd.borderDoneWithNeighborZ[bh]=B.canonical.z,rd.needsCentroidUpdate=!0}B.borderDoneWithNeighborZ[Qu]=rd.canonical.z,B.needsCentroidUpdate=!0}}(B.needsCentroidUpdate||!B.centroidVertexBuffer&&B.centroidVertexArray.length!==0)&&B.uploadCentroid(L)}const O_=new o.Color(1,0,0,1),A0=new o.Color(0,1,0,1),W0=new o.Color(0,0,1,1),zv=new o.Color(1,0,1,1),P0=new o.Color(0,1,1,1);function xm(L,u,E){const B=L.context,Y=L.transform,vt=B.gl,mr=Y.projection.name==="globe",Ur=mr?["PROJECTION_GLOBE_VIEW"]:null;let Gn=E.projMatrix;if(mr&&o.globeToMercatorTransition(Y.zoom)>0){const md=o.transitionTileAABBinECEF(E.canonical,Y),Af=o.globeDenormalizeECEF(md);Gn=o.multiply(new Float32Array(16),Y.globeMatrix,Af),o.multiply(Gn,Y.projMatrix,Gn)}const $s=L.useProgram("debug",null,Ur),el=u.getTileByID(E.key);L.terrain&&L.terrain.setupElevationDraw(el,$s);const Wu=o.DepthMode.disabled,dh=o.StencilMode.disabled,gh=L.colorModeForRenderPass(),Eh="$debug";B.activeTexture.set(vt.TEXTURE0),L.emptyTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),mr?el._makeGlobeTileDebugBuffers(L.context,Y):el._makeDebugTileBoundsBuffers(L.context,Y.projection);const yh=el._tileDebugBuffer||L.debugBuffer,Ih=el._tileDebugIndexBuffer||L.debugIndexBuffer,Qu=el._tileDebugSegments||L.debugSegments;$s.draw(B,vt.LINE_STRIP,Wu,dh,gh,o.CullFaceMode.disabled,D_(Gn,o.Color.red),Eh,yh,Ih,Qu,null,null,null,[el._globeTileDebugBorderBuffer]);const bh=el.latestRawTileData,kh=Math.floor((bh&&bh.byteLength||0)/1024),Oh=u.getTile(E).tileSize,rd=512/Math.min(Oh,512)*(E.overscaledZ/Y.zoom)*.5;let sd=E.canonical.toString();E.overscaledZ!==E.canonical.z&&(sd+=` => ${E.overscaledZ}`),sd+=` ${kh}kb`,function(md,Af){md.initDebugOverlayCanvas();const Td=md.debugOverlayCanvas,Gd=md.context.gl,Od=md.debugOverlayCanvas.getContext("2d");Od.clearRect(0,0,Td.width,Td.height),Od.shadowColor="white",Od.shadowBlur=2,Od.lineWidth=1.5,Od.strokeStyle="white",Od.textBaseline="top",Od.font="bold 36px Open Sans, sans-serif",Od.fillText(Af,5,5),Od.strokeText(Af,5,5),md.debugOverlayTexture.update(Td),md.debugOverlayTexture.bind(Gd.LINEAR,Gd.CLAMP_TO_EDGE)}(L,sd);const ld=el._tileDebugTextBuffer||L.debugBuffer,dd=el._tileDebugTextIndexBuffer||L.quadTriangleIndexBuffer,ud=el._tileDebugTextSegments||L.debugSegments;$s.draw(B,vt.TRIANGLES,Wu,dh,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,D_(Gn,o.Color.transparent,rd),Eh,ld,dd,ud,null,null,null,[el._globeTileDebugTextBuffer])}function am(L,u,E,B){Vg(L,0,u+E/2,L.transform.width,E,B)}function y_(L,u,E,B){Vg(L,u-E/2,0,E,L.transform.height,B)}function Vg(L,u,E,B,Y,vt){const mr=L.context,Ur=mr.gl;Ur.enable(Ur.SCISSOR_TEST),Ur.scissor(u*o.exported.devicePixelRatio,E*o.exported.devicePixelRatio,B*o.exported.devicePixelRatio,Y*o.exported.devicePixelRatio),mr.clear({color:vt}),Ur.disable(Ur.SCISSOR_TEST)}const h0=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gg}=h0;function bm(L,u,E,B){L.emplaceBack(u,E,B)}class cg{constructor(u){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,bm(this.vertexArray,-1,-1,1),bm(this.vertexArray,1,-1,1),bm(this.vertexArray,-1,1,1),bm(this.vertexArray,1,1,1),bm(this.vertexArray,-1,-1,-1),bm(this.vertexArray,1,-1,-1),bm(this.vertexArray,-1,1,-1),bm(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=u.createVertexBuffer(this.vertexArray,Gg),this.indexBuffer=u.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Pg(L,u,E,B,Y,vt){const mr=L.gl,Ur=u.paint.get("sky-atmosphere-color"),Gn=u.paint.get("sky-atmosphere-halo-color"),$s=u.paint.get("sky-atmosphere-sun-intensity"),el=((Wu,dh,gh,Eh,yh)=>({u_matrix_3f:Wu,u_sun_direction:dh,u_sun_intensity:gh,u_color_tint_r:[Eh.r,Eh.g,Eh.b,Eh.a],u_color_tint_m:[yh.r,yh.g,yh.b,yh.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),B),Y,$s,Ur,Gn);mr.framebufferTexture2D(mr.FRAMEBUFFER,mr.COLOR_ATTACHMENT0,mr.TEXTURE_CUBE_MAP_POSITIVE_X+vt,u.skyboxTexture,0),E.draw(L,mr.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,el,"skyboxCapture",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}const v_=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fy{constructor(u){const E=new o.StructArrayLayout5f20;E.emplaceBack(-1,1,1,0,0),E.emplaceBack(1,1,1,1,0),E.emplaceBack(1,-1,1,1,1),E.emplaceBack(-1,-1,1,0,1);const B=new o.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,3,0),this.vertexBuffer=u.createVertexBuffer(E,v_.members),this.indexBuffer=u.createIndexBuffer(B),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fg={symbol:function(L,u,E,B,Y){if(L.renderPass!=="translucent")return;const vt=o.StencilMode.disabled,mr=L.colorModeForRenderPass();E.layout.get("text-variable-anchor")&&function(Ur,Gn,$s,el,Wu,dh,gh){const Eh=Gn.transform,yh=Wu==="map",Ih=dh==="map";for(const Qu of Ur){const bh=el.getTile(Qu),kh=bh.getBucket($s);if(!kh||!kh.text||!kh.text.segments.get().length)continue;const Oh=o.evaluateSizeForZoom(kh.textSizeData,Eh.zoom),rd=Gf(Qu,kh.getProjection(),Eh),sd=Eh.calculatePixelsToTileUnitsMatrix(bh),ld=Yd(rd,bh.tileID.canonical,Ih,yh,Eh,kh.getProjection(),sd),dd=$s.layout.get("icon-text-fit")!=="none"&&kh.hasIconData();if(Oh){const ud=Math.pow(2,Eh.zoom-bh.tileID.overscaledZ);tp(kh,yh,Ih,gh,o.symbolSize,Eh,ld,Qu,ud,Oh,dd)}}}(B,L,E,u,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),Y),E.paint.get("icon-opacity").constantOr(1)!==0&&Bg(L,u,E,B,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),vt,mr),E.paint.get("text-opacity").constantOr(1)!==0&&Bg(L,u,E,B,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),vt,mr),u.map.showCollisionBoxes&&(Um(L,u,E,B,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),Um(L,u,E,B,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))},circle:function(L,u,E,B){if(L.renderPass!=="translucent")return;const Y=E.paint.get("circle-opacity"),vt=E.paint.get("circle-stroke-width"),mr=E.paint.get("circle-stroke-opacity"),Ur=E.layout.get("circle-sort-key").constantOr(1)!==void 0;if(Y.constantOr(1)===0&&(vt.constantOr(1)===0||mr.constantOr(1)===0))return;const Gn=L.context,$s=Gn.gl,el=L.transform,Wu=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),dh=o.StencilMode.disabled,gh=L.colorModeForRenderPass(),Eh=el.projection.name==="globe",yh=[o.mercatorXfromLng(el.center.lng),o.mercatorYfromLat(el.center.lat)],Ih=[];for(let bh=0;bh<B.length;bh++){const kh=B[bh],Oh=u.getTile(kh),rd=Oh.getBucket(E);if(!rd||rd.projection.name!==el.projection.name)continue;const sd=rd.programConfigurations.get(E.id),ld=k_(E);Eh&&ld.push("PROJECTION_GLOBE_VIEW");const dd=L.useProgram("circle",sd,ld),ud=rd.layoutVertexBuffer,md=rd.globeExtVertexBuffer,Af=rd.indexBuffer,Td=el.projection.createInversionMatrix(el,kh.canonical),Gd={programConfiguration:sd,program:dd,layoutVertexBuffer:ud,globeExtVertexBuffer:md,indexBuffer:Af,uniformValues:H0(L,kh,Oh,Td,yh,E),tile:Oh};if(Ur){const Od=rd.segments.get();for(const Lf of Od)Ih.push({segments:new o.SegmentVector([Lf]),sortKey:Lf.sortKey,state:Gd})}else Ih.push({segments:rd.segments,sortKey:0,state:Gd})}Ur&&Ih.sort((bh,kh)=>bh.sortKey-kh.sortKey);const Qu={useDepthForOcclusion:!Eh};for(const bh of Ih){const{programConfiguration:kh,program:Oh,layoutVertexBuffer:rd,globeExtVertexBuffer:sd,indexBuffer:ld,uniformValues:dd,tile:ud}=bh.state,md=bh.segments;L.terrain&&L.terrain.setupElevationDraw(ud,Oh,Qu),L.prepareDrawProgram(Gn,Oh,ud.tileID.toUnwrapped()),Oh.draw(Gn,$s.TRIANGLES,Wu,dh,gh,o.CullFaceMode.disabled,dd,E.id,rd,ld,md,E.paint,el.zoom,kh,[sd])}},heatmap:function(L,u,E,B){if(E.paint.get("heatmap-opacity")!==0)if(L.renderPass==="offscreen"){const Y=L.context,vt=Y.gl,mr=o.StencilMode.disabled,Ur=new o.ColorMode([vt.ONE,vt.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(gh,Eh,yh,Ih){const Qu=gh.gl,bh=Eh.width*Ih,kh=Eh.height*Ih;gh.activeTexture.set(Qu.TEXTURE1),gh.viewport.set([0,0,bh,kh]);let Oh=yh.heatmapFbo;if(!Oh||Oh&&(Oh.width!==bh||Oh.height!==kh)){Oh&&Oh.destroy();const rd=Qu.createTexture();Qu.bindTexture(Qu.TEXTURE_2D,rd),Qu.texParameteri(Qu.TEXTURE_2D,Qu.TEXTURE_WRAP_S,Qu.CLAMP_TO_EDGE),Qu.texParameteri(Qu.TEXTURE_2D,Qu.TEXTURE_WRAP_T,Qu.CLAMP_TO_EDGE),Qu.texParameteri(Qu.TEXTURE_2D,Qu.TEXTURE_MIN_FILTER,Qu.LINEAR),Qu.texParameteri(Qu.TEXTURE_2D,Qu.TEXTURE_MAG_FILTER,Qu.LINEAR),Oh=yh.heatmapFbo=gh.createFramebuffer(bh,kh,!1),function(sd,ld,dd,ud,md,Af){const Td=sd.gl;Td.texImage2D(Td.TEXTURE_2D,0,sd.isWebGL2&&sd.extRenderToTextureHalfFloat?Td.RGBA16F:Td.RGBA,md,Af,0,Td.RGBA,sd.extRenderToTextureHalfFloat?sd.isWebGL2?Td.HALF_FLOAT:sd.extTextureHalfFloat.HALF_FLOAT_OES:Td.UNSIGNED_BYTE,null),ud.colorAttachment.set(dd)}(gh,0,rd,Oh,bh,kh)}else Qu.bindTexture(Qu.TEXTURE_2D,Oh.colorAttachment.get()),gh.bindFramebuffer.set(Oh.framebuffer)})(Y,L,E,L.transform.projection.name==="globe"?.5:.25),Y.clear({color:o.Color.transparent});const Gn=L.transform,$s=Gn.projection.name==="globe",el=$s?["PROJECTION_GLOBE_VIEW"]:null,Wu=$s?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,dh=[o.mercatorXfromLng(Gn.center.lng),o.mercatorYfromLat(Gn.center.lat)];for(let gh=0;gh<B.length;gh++){const Eh=B[gh];if(u.hasRenderableParent(Eh))continue;const yh=u.getTile(Eh),Ih=yh.getBucket(E);if(!Ih||Ih.projection.name!==Gn.projection.name)continue;const Qu=Ih.programConfigurations.get(E.id),bh=L.useProgram("heatmap",Qu,el),{zoom:kh}=L.transform;L.terrain&&L.terrain.setupElevationDraw(yh,bh),L.prepareDrawProgram(Y,bh,Eh.toUnwrapped());const Oh=Gn.projection.createInversionMatrix(Gn,Eh.canonical);bh.draw(Y,vt.TRIANGLES,o.DepthMode.disabled,mr,Ur,Wu,K0(L,Eh,yh,Oh,dh,kh,E.paint.get("heatmap-intensity")),E.id,Ih.layoutVertexBuffer,Ih.indexBuffer,Ih.segments,E.paint,L.transform.zoom,Qu,$s?[Ih.globeExtVertexBuffer]:null)}Y.viewport.set([0,0,L.width,L.height])}else L.renderPass==="translucent"&&(L.context.setColorMode(L.colorModeForRenderPass()),function(Y,vt){const mr=Y.context,Ur=mr.gl,Gn=vt.heatmapFbo;if(!Gn)return;mr.activeTexture.set(Ur.TEXTURE0),Ur.bindTexture(Ur.TEXTURE_2D,Gn.colorAttachment.get()),mr.activeTexture.set(Ur.TEXTURE1);let $s=vt.colorRampTexture;$s||($s=vt.colorRampTexture=new o.Texture(mr,vt.colorRamp,Ur.RGBA)),$s.bind(Ur.LINEAR,Ur.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(mr,Ur.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,Y.colorModeForRenderPass(),o.CullFaceMode.disabled,((el,Wu,dh,gh)=>({u_image:0,u_color_ramp:1,u_opacity:Wu.paint.get("heatmap-opacity")}))(0,vt),vt.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,vt.paint,Y.transform.zoom)}(L,E))},line:function(L,u,E,B){if(L.renderPass!=="translucent")return;const Y=E.paint.get("line-opacity"),vt=E.paint.get("line-width");if(Y.constantOr(1)===0||vt.constantOr(1)===0)return;const mr=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ur=L.colorModeForRenderPass(),Gn=L.terrain&&L.terrain.renderingToTexture?1:o.exported.devicePixelRatio,$s=E.paint.get("line-dasharray"),el=$s.constantOr(1),Wu=E.layout.get("line-cap"),dh=E.paint.get("line-pattern"),gh=dh.constantOr(1),Eh=E.paint.get("line-gradient"),yh=gh?"linePattern":"line",Ih=L.context,Qu=Ih.gl,bh=(Oh=>{const rd=[];Wy(Oh)&&rd.push("RENDER_LINE_DASH"),Oh.paint.get("line-gradient")&&rd.push("RENDER_LINE_GRADIENT");const sd=Oh.paint.get("line-trim-offset");sd[0]===0&&sd[1]===0||rd.push("RENDER_LINE_TRIM_OFFSET");const ld=Oh.paint.get("line-pattern").constantOr(1),dd=Oh.paint.get("line-opacity").constantOr(1)!==1;return!ld&&dd&&rd.push("RENDER_LINE_ALPHA_DISCARD"),rd})(E);let kh=bh.includes("RENDER_LINE_ALPHA_DISCARD");L.terrain&&L.terrain.clipOrMaskOverlapStencilType()&&(kh=!1);for(const Oh of B){const rd=u.getTile(Oh);if(gh&&!rd.patternsLoaded())continue;const sd=rd.getBucket(E);if(!sd)continue;L.prepareDrawTile();const ld=sd.programConfigurations.get(E.id),dd=L.useProgram(yh,ld,bh),ud=dh.constantOr(null);if(ud&&rd.imageAtlas){const yf=rd.imageAtlas.patternPositions[ud.toString()];yf&&ld.setConstantPatternPositions(yf)}const md=$s.constantOr(null),Af=Wu.constantOr(null);if(!gh&&md&&Af&&rd.lineAtlas){const yf=rd.lineAtlas.getDash(md,Af);yf&&ld.setConstantPatternPositions(yf)}let[Td,Gd]=E.paint.get("line-trim-offset");(Af==="round"||Af==="square")&&Td!==Gd&&(Td===0&&(Td-=1),Gd===1&&(Gd+=1));const Od=L.terrain?Oh.projMatrix:null,Lf=gh?dy(L,rd,E,Od,Gn):u0(L,rd,E,Od,sd.lineClipsArray.length,Gn,[Td,Gd]);if(Eh){const yf=sd.gradients[E.id];let zf=yf.texture;if(E.gradientVersion!==yf.version){let Pf=256;if(E.stepInterpolant){const Vf=u.getSource().maxzoom,Lp=Oh.canonical.z===Vf?Math.ceil(1<<L.transform.maxZoom-Oh.canonical.z):1;Pf=o.clamp(o.nextPowerOfTwo(sd.maxLineLength/o.EXTENT*1024*Lp),256,Ih.maxTextureSize)}yf.gradient=o.renderColorRamp({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:Pf,image:yf.gradient||void 0,clips:sd.lineClipsArray}),yf.texture?yf.texture.update(yf.gradient):yf.texture=new o.Texture(Ih,yf.gradient,Qu.RGBA),yf.version=E.gradientVersion,zf=yf.texture}Ih.activeTexture.set(Qu.TEXTURE1),zf.bind(E.stepInterpolant?Qu.NEAREST:Qu.LINEAR,Qu.CLAMP_TO_EDGE)}el&&(Ih.activeTexture.set(Qu.TEXTURE0),rd.lineAtlasTexture.bind(Qu.LINEAR,Qu.REPEAT),ld.updatePaintBuffers()),gh&&(Ih.activeTexture.set(Qu.TEXTURE0),rd.imageAtlasTexture.bind(Qu.LINEAR,Qu.CLAMP_TO_EDGE),ld.updatePaintBuffers()),L.prepareDrawProgram(Ih,dd,Oh.toUnwrapped());const Dd=yf=>{dd.draw(Ih,Qu.TRIANGLES,mr,yf,Ur,o.CullFaceMode.disabled,Lf,E.id,sd.layoutVertexBuffer,sd.indexBuffer,sd.segments,E.paint,L.transform.zoom,ld,[sd.layoutVertexBuffer2])};if(kh){const yf=L.stencilModeForClipping(Oh).ref;yf===0&&L.terrain&&Ih.clear({stencil:0});const zf={func:Qu.EQUAL,mask:255};Lf.u_alpha_discard_threshold=.8,Dd(new o.StencilMode(zf,yf,255,Qu.KEEP,Qu.KEEP,Qu.INVERT)),Lf.u_alpha_discard_threshold=0,Dd(new o.StencilMode(zf,yf,255,Qu.KEEP,Qu.KEEP,Qu.KEEP))}else Dd(L.stencilModeForClipping(Oh))}kh&&(L.resetStencilClippingMasks(),L.terrain&&Ih.clear({stencil:0}))},fill:function(L,u,E,B){const Y=E.paint.get("fill-color"),vt=E.paint.get("fill-opacity");if(vt.constantOr(1)===0)return;const mr=L.colorModeForRenderPass(),Ur=E.paint.get("fill-pattern"),Gn=L.opaquePassEnabledForLayer()&&!Ur.constantOr(1)&&Y.constantOr(o.Color.transparent).a===1&&vt.constantOr(0)===1?"opaque":"translucent";if(L.renderPass===Gn){const $s=L.depthModeForSublayer(1,L.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);R_(L,u,E,B,$s,mr,!1)}if(L.renderPass==="translucent"&&E.paint.get("fill-antialias")){const $s=L.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);R_(L,u,E,B,$s,mr,!0)}},"fill-extrusion":function(L,u,E,B){const Y=E.paint.get("fill-extrusion-opacity");if(Y!==0&&L.renderPass==="translucent"){const vt=new o.DepthMode(L.context.gl.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D);if(Y!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))ip(L,u,E,B,vt,o.StencilMode.disabled,o.ColorMode.disabled),ip(L,u,E,B,vt,L.stencilModeFor3D(),L.colorModeForRenderPass()),L.resetStencilClippingMasks();else{const mr=L.colorModeForRenderPass();ip(L,u,E,B,vt,o.StencilMode.disabled,mr)}}},hillshade:function(L,u,E,B){if(L.renderPass!=="offscreen"&&L.renderPass!=="translucent")return;const Y=L.context,vt=L.depthModeForSublayer(0,o.DepthMode.ReadOnly),mr=L.colorModeForRenderPass(),Ur=L.terrain&&L.terrain.renderingToTexture,[Gn,$s]=L.renderPass!=="translucent"||Ur?[{},B]:L.stencilConfigForOverlap(B);for(const el of $s){const Wu=u.getTile(el);if(Wu.needsHillshadePrepare&&L.renderPass==="offscreen")Hy(L,Wu,E,vt,o.StencilMode.disabled,mr);else if(L.renderPass==="translucent"){const dh=Ur&&L.terrain?L.terrain.stencilModeForRTTOverlap(el):Gn[el.overscaledZ];Z0(L,el,Wu,E,vt,dh,mr)}}Y.viewport.set([0,0,L.width,L.height]),L.resetStencilClippingMasks()},raster:function(L,u,E,B,Y,vt){if(L.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!B.length)return;const mr=L.context,Ur=mr.gl,Gn=u.getSource(),$s=L.useProgram("raster"),el=L.colorModeForRenderPass(),Wu=L.terrain&&L.terrain.renderingToTexture,[dh,gh]=Gn instanceof xh||Wu?[{},B]:L.stencilConfigForOverlap(B),Eh=gh[gh.length-1].overscaledZ,yh=!L.options.moving;for(const Ih of gh){const Qu=Wu?o.DepthMode.disabled:L.depthModeForSublayer(Ih.overscaledZ-Eh,E.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,Ur.LESS),bh=Ih.toUnwrapped(),kh=u.getTile(Ih);if(Wu&&(!kh||!kh.hasData()))continue;const Oh=Wu?Ih.projMatrix:L.transform.calculateProjMatrix(bh,yh),rd=L.terrain&&Wu?L.terrain.stencilModeForRTTOverlap(Ih):dh[Ih.overscaledZ],sd=vt?0:E.paint.get("raster-fade-duration");kh.registerFadeDuration(sd);const ld=u.findLoadedParent(Ih,0),dd=g_(kh,ld,u,L.transform,sd);let ud,md;L.terrain&&L.terrain.prepareDrawTile();const Af=E.paint.get("raster-resampling")==="nearest"?Ur.NEAREST:Ur.LINEAR;mr.activeTexture.set(Ur.TEXTURE0),kh.texture.bind(Af,Ur.CLAMP_TO_EDGE),mr.activeTexture.set(Ur.TEXTURE1),ld?(ld.texture.bind(Af,Ur.CLAMP_TO_EDGE),ud=Math.pow(2,ld.tileID.overscaledZ-kh.tileID.overscaledZ),md=[kh.tileID.canonical.x*ud%1,kh.tileID.canonical.y*ud%1]):kh.texture.bind(Af,Ur.CLAMP_TO_EDGE),kh.texture.useMipmap&&mr.extTextureFilterAnisotropic&&L.transform.pitch>20&&Ur.texParameterf(Ur.TEXTURE_2D,mr.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,mr.extTextureFilterAnisotropicMax);const Td=L_(Oh,md||[0,0],ud||1,dd,E,Gn instanceof xh?Gn.perspectiveTransform:[0,0]);if(L.prepareDrawProgram(mr,$s,bh),Gn instanceof xh)Gn.boundsBuffer&&Gn.boundsSegments&&$s.draw(mr,Ur.TRIANGLES,Qu,o.StencilMode.disabled,el,o.CullFaceMode.disabled,Td,E.id,Gn.boundsBuffer,L.quadTriangleIndexBuffer,Gn.boundsSegments);else{const{tileBoundsBuffer:Gd,tileBoundsIndexBuffer:Od,tileBoundsSegments:Lf}=L.getTileBoundsBuffers(kh);$s.draw(mr,Ur.TRIANGLES,Qu,rd,el,o.CullFaceMode.disabled,Td,E.id,Gd,Od,Lf)}}L.resetStencilClippingMasks()},background:function(L,u,E,B){const Y=E.paint.get("background-color"),vt=E.paint.get("background-opacity");if(vt===0)return;const mr=L.context,Ur=mr.gl,Gn=L.transform,$s=Gn.tileSize,el=E.paint.get("background-pattern");if(L.isPatternMissing(el))return;const Wu=!el&&Y.a===1&&vt===1&&L.opaquePassEnabledForLayer()?"opaque":"translucent";if(L.renderPass!==Wu)return;const dh=o.StencilMode.disabled,gh=L.depthModeForSublayer(0,Wu==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Eh=L.colorModeForRenderPass(),yh=L.useProgram(el?"backgroundPattern":"background");let Ih,Qu=B;Qu||(Ih=L.getBackgroundTiles(),Qu=Object.values(Ih).map(bh=>bh.tileID)),el&&(mr.activeTexture.set(Ur.TEXTURE0),L.imageManager.bind(L.context));for(const bh of Qu){const kh=bh.toUnwrapped(),Oh=B?bh.projMatrix:L.transform.calculateProjMatrix(kh);L.prepareDrawTile();const rd=u?u.getTile(bh):Ih?Ih[bh.key]:new o.Tile(bh,$s,Gn.zoom,L),sd=el?Fm(Oh,vt,L,el,{tileID:bh,tileSize:$s}):Dp(Oh,vt,Y);L.prepareDrawProgram(mr,yh,kh);const{tileBoundsBuffer:ld,tileBoundsIndexBuffer:dd,tileBoundsSegments:ud}=L.getTileBoundsBuffers(rd);yh.draw(mr,Ur.TRIANGLES,gh,dh,Eh,o.CullFaceMode.disabled,sd,E.id,ld,dd,ud)}},sky:function(L,u,E){const B=L.transform,Y=B.projection.name==="mercator"||B.projection.name==="globe"?1:o.smoothstep(7,8,B.zoom),vt=E.paint.get("sky-opacity")*Y;if(vt===0)return;const mr=L.context,Ur=E.paint.get("sky-type"),Gn=new o.DepthMode(mr.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),$s=L.frameCounter/1e3%1;Ur==="atmosphere"?L.renderPass==="offscreen"?E.needsSkyboxCapture(L)&&(function(el,Wu,dh,gh){const Eh=el.context,yh=Eh.gl;let Ih=Wu.skyboxFbo;if(!Ih){Ih=Wu.skyboxFbo=Eh.createFramebuffer(32,32,!1),Wu.skyboxGeometry=new cg(Eh),Wu.skyboxTexture=Eh.gl.createTexture(),yh.bindTexture(yh.TEXTURE_CUBE_MAP,Wu.skyboxTexture),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_WRAP_S,yh.CLAMP_TO_EDGE),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_WRAP_T,yh.CLAMP_TO_EDGE),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_MIN_FILTER,yh.LINEAR),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_MAG_FILTER,yh.LINEAR);for(let Oh=0;Oh<6;++Oh)yh.texImage2D(yh.TEXTURE_CUBE_MAP_POSITIVE_X+Oh,0,yh.RGBA,32,32,0,yh.RGBA,yh.UNSIGNED_BYTE,null)}Eh.bindFramebuffer.set(Ih.framebuffer),Eh.viewport.set([0,0,32,32]);const Qu=Wu.getCenter(el,!0),bh=el.useProgram("skyboxCapture"),kh=new Float64Array(16);o.identity(kh),o.rotateY(kh,kh,.5*-Math.PI),Pg(Eh,Wu,bh,kh,Qu,0),o.identity(kh),o.rotateY(kh,kh,.5*Math.PI),Pg(Eh,Wu,bh,kh,Qu,1),o.identity(kh),o.rotateX(kh,kh,.5*-Math.PI),Pg(Eh,Wu,bh,kh,Qu,2),o.identity(kh),o.rotateX(kh,kh,.5*Math.PI),Pg(Eh,Wu,bh,kh,Qu,3),o.identity(kh),Pg(Eh,Wu,bh,kh,Qu,4),o.identity(kh),o.rotateY(kh,kh,Math.PI),Pg(Eh,Wu,bh,kh,Qu,5),Eh.viewport.set([0,0,el.width,el.height])}(L,E),E.markSkyboxValid(L)):L.renderPass==="sky"&&function(el,Wu,dh,gh,Eh){const yh=el.context,Ih=yh.gl,Qu=el.transform,bh=el.useProgram("skybox");yh.activeTexture.set(Ih.TEXTURE0),Ih.bindTexture(Ih.TEXTURE_CUBE_MAP,Wu.skyboxTexture);const kh=((Oh,rd,sd,ld,dd)=>({u_matrix:Oh,u_sun_direction:rd,u_cubemap:0,u_opacity:ld,u_temporal_offset:dd}))(Qu.skyboxMatrix,Wu.getCenter(el,!1),0,gh,Eh);el.prepareDrawProgram(yh,bh),bh.draw(yh,Ih.TRIANGLES,dh,o.StencilMode.disabled,el.colorModeForRenderPass(),o.CullFaceMode.backCW,kh,"skybox",Wu.skyboxGeometry.vertexBuffer,Wu.skyboxGeometry.indexBuffer,Wu.skyboxGeometry.segment)}(L,E,Gn,vt,$s):Ur==="gradient"&&L.renderPass==="sky"&&function(el,Wu,dh,gh,Eh){const yh=el.context,Ih=yh.gl,Qu=el.transform,bh=el.useProgram("skyboxGradient");Wu.skyboxGeometry||(Wu.skyboxGeometry=new cg(yh)),yh.activeTexture.set(Ih.TEXTURE0);let kh=Wu.colorRampTexture;kh||(kh=Wu.colorRampTexture=new o.Texture(yh,Wu.colorRamp,Ih.RGBA)),kh.bind(Ih.LINEAR,Ih.CLAMP_TO_EDGE);const Oh=((rd,sd,ld,dd,ud)=>({u_matrix:rd,u_color_ramp:0,u_center_direction:sd,u_radius:o.degToRad(ld),u_opacity:dd,u_temporal_offset:ud}))(Qu.skyboxMatrix,Wu.getCenter(el,!1),Wu.paint.get("sky-gradient-radius"),gh,Eh);el.prepareDrawProgram(yh,bh),bh.draw(yh,Ih.TRIANGLES,dh,o.StencilMode.disabled,el.colorModeForRenderPass(),o.CullFaceMode.backCW,Oh,"skyboxGradient",Wu.skyboxGeometry.vertexBuffer,Wu.skyboxGeometry.indexBuffer,Wu.skyboxGeometry.segment)}(L,E,Gn,vt,$s)},debug:function(L,u,E){for(let B=0;B<E.length;B++)xm(L,u,E[B])},custom:function(L,u,E,B){const Y=L.context,vt=E.implementation;if(!L.transform.projection.unsupportedLayers||!L.transform.projection.unsupportedLayers.includes("custom")||L.terrain&&(L.terrain.renderingToTexture||L.renderPass==="offscreen")&&E.isLayerDraped()){if(L.renderPass==="offscreen"){const mr=vt.prerender;if(mr){if(L.setCustomLayerDefaults(),Y.setColorMode(L.colorModeForRenderPass()),L.transform.projection.name==="globe"){const Ur=L.transform.pointMerc;mr.call(vt,Y.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(L.transform.zoom),[Ur.x,Ur.y],L.transform.pixelsPerMeterRatio)}else mr.call(vt,Y.gl,L.transform.customLayerMatrix());Y.setDirty(),L.setBaseState()}}else if(L.renderPass==="translucent"){if(L.terrain&&L.terrain.renderingToTexture){const Ur=vt.renderToTile;if(Ur){const Gn=B[0].canonical,$s=new o.MercatorCoordinate(Gn.x+B[0].wrap*(1<<Gn.z),Gn.y,Gn.z);Y.setDepthMode(o.DepthMode.disabled),Y.setStencilMode(o.StencilMode.disabled),Y.setColorMode(L.colorModeForRenderPass()),L.setCustomLayerDefaults(),Ur.call(vt,Y.gl,$s),Y.setDirty(),L.setBaseState()}return}L.setCustomLayerDefaults(),Y.setColorMode(L.colorModeForRenderPass()),Y.setStencilMode(o.StencilMode.disabled);const mr=vt.renderingMode==="3d"?new o.DepthMode(L.context.gl.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D):L.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(Y.setDepthMode(mr),L.transform.projection.name==="globe"){const Ur=L.transform.pointMerc;vt.render(Y.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(L.transform.zoom),[Ur.x,Ur.y],L.transform.pixelsPerMeterRatio)}else vt.render(Y.gl,L.transform.customLayerMatrix());Y.setDirty(),L.setBaseState(),Y.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ay{constructor(u,E,B=!1){this.context=new nl(u,B),this.transform=E,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(u,E){const B=!!u&&!!u.terrain&&this.transform.projection.supportsTerrain;if(!(B||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gv(this,u));const Y=this._terrain;this.transform.elevation=B?Y:null,Y.update(u,this.transform,E)}_updateFog(u){const E=u.fog;if(!E||this.transform.projection.name==="globe"||E.getOpacity(this.transform.pitch)<1||E.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[B,Y]=E.getFovAdjustedRange(this.transform._fov);if(B>Y)return void(this.transform.fogCullDistSq=null);const vt=B+.78*(Y-B);this.transform.fogCullDistSq=vt*vt}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(u,E){if(this.width=u*o.exported.devicePixelRatio,this.height=E*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style.order)this.style._layers[B].resize()}setup(){const u=this.context,E=new o.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(o.EXTENT,0),E.emplaceBack(0,o.EXTENT),E.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=u.createVertexBuffer(E,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const B=new o.StructArrayLayout2i4;B.emplaceBack(0,0),B.emplaceBack(o.EXTENT,0),B.emplaceBack(0,o.EXTENT),B.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=u.createVertexBuffer(B,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const Y=new o.StructArrayLayout2i4;Y.emplaceBack(-1,-1),Y.emplaceBack(1,-1),Y.emplaceBack(-1,1),Y.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(Y,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const vt=new o.StructArrayLayout4i8;vt.emplaceBack(0,0,0,0),vt.emplaceBack(o.EXTENT,0,o.EXTENT,0),vt.emplaceBack(0,o.EXTENT,0,o.EXTENT),vt.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=u.createVertexBuffer(vt,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const mr=new o.StructArrayLayout3ui6;mr.emplaceBack(0,1,2),mr.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(mr);const Ur=new o.StructArrayLayout1ui2;for(const $s of[0,1,3,2,0])Ur.emplaceBack($s);this.debugIndexBuffer=u.createIndexBuffer(Ur),this.emptyTexture=new o.Texture(u,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),u.gl.RGBA),this.identityMat=o.create();const Gn=this.context.gl;this.stencilClearMode=new o.StencilMode({func:Gn.ALWAYS,mask:0},0,255,Gn.ZERO,Gn.ZERO,Gn.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new fy(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(u){return u._makeTileBoundsBuffers(this.context,this.transform.projection),u._tileBoundsBuffer?{tileBoundsBuffer:u._tileBoundsBuffer,tileBoundsIndexBuffer:u._tileBoundsIndexBuffer,tileBoundsSegments:u._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const u=this.context,E=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(u,E.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,l_(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(u,E,B){if(!E||this.currentStencilSource===E.id||!u.isTileClipped()||!B||B.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let Ur=!1;for(const Gn of B)if(this._tileClippingMaskIDs[Gn.key]===void 0){Ur=!0;break}if(!Ur)return}this.currentStencilSource=E.id;const Y=this.context,vt=Y.gl;this.nextStencilID+B.length>256&&this.clearStencil(),Y.setColorMode(o.ColorMode.disabled),Y.setDepthMode(o.DepthMode.disabled);const mr=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Ur of B){const Gn=E.getTile(Ur),$s=this._tileClippingMaskIDs[Ur.key]=this.nextStencilID++,{tileBoundsBuffer:el,tileBoundsIndexBuffer:Wu,tileBoundsSegments:dh}=this.getTileBoundsBuffers(Gn);mr.draw(Y,vt.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:vt.ALWAYS,mask:0},$s,255,vt.KEEP,vt.KEEP,vt.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,l_(Ur.projMatrix),"$clipping",el,Wu,dh)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,E=this.context.gl;return new o.StencilMode({func:E.NOTEQUAL,mask:255},u,255,E.KEEP,E.KEEP,E.REPLACE)}stencilModeForClipping(u){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(u);const E=this.context.gl;return new o.StencilMode({func:E.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,E.KEEP,E.KEEP,E.REPLACE)}stencilConfigForOverlap(u){const E=this.context.gl,B=u.sort((mr,Ur)=>Ur.overscaledZ-mr.overscaledZ),Y=B[B.length-1].overscaledZ,vt=B[0].overscaledZ-Y+1;if(vt>1){this.currentStencilSource=void 0,this.nextStencilID+vt>256&&this.clearStencil();const mr={};for(let Ur=0;Ur<vt;Ur++)mr[Ur+Y]=new o.StencilMode({func:E.GEQUAL,mask:255},Ur+this.nextStencilID,255,E.KEEP,E.KEEP,E.REPLACE);return this.nextStencilID+=vt,[mr,B]}return[{[Y]:o.StencilMode.disabled},B]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([u.CONSTANT_COLOR,u.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(u,E,B){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const Y=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new o.DepthMode(B||this.context.gl.LEQUAL,E,[Y,Y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,E){this.style=u,this.options=E,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const B=this.style.order,Y=this.style._sourceCaches;for(const $s in Y){const el=Y[$s];el.used&&el.prepare(this.context)}const vt={},mr={},Ur={};for(const $s in Y){const el=Y[$s];vt[$s]=el.getVisibleCoordinates(),mr[$s]=vt[$s].slice().reverse(),Ur[$s]=el.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $s=0;$s<B.length;$s++)if(this.style._layers[B[$s]].is3D()){this.opaquePassCutoff=$s;break}if(this.terrain&&(this.terrain.updateTileBinding(Ur),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const $s of B){const el=this.style._layers[$s],Wu=u._getLayerSourceCache(el);if(!el.hasOffscreenPass()||el.isHidden(this.transform.zoom))continue;const dh=Wu?mr[Wu.id]:void 0;(el.type==="custom"||el.isSky()||dh&&dh.length)&&this.renderLayer(this,Wu,el,dh)}this.depthRangeFor3D=[0,1-(u.order.length+2)*this.numSublayers*this.depthEpsilon];const Gn=this.terrain;if(Gn&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&Gn.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:E.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=E.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const $s=this.style._layers[B[this.currentLayer]],el=u._getLayerSourceCache($s);if($s.isSky())continue;const Wu=el?mr[el.id]:void 0;this._renderTileClippingMasks($s,el,Wu),this.renderLayer(this,el,$s,Wu)}if(this.style.fog&&this.transform.projection.supportsFog&&function($s,el){const Wu=$s.context,dh=Wu.gl,gh=$s.transform,Eh=new o.DepthMode(dh.LEQUAL,o.DepthMode.ReadOnly,[0,1]),yh=$s.useProgram("globeAtmosphere",null,gh.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ih=o.globeToMercatorTransition(gh.zoom),Qu=el.properties.get("color").toArray01(),bh=el.properties.get("high-color").toArray01(),kh=el.properties.get("space-color").toArray01PremultipliedAlpha(),Oh=o.identity$1([]);o.rotateY$1(Oh,Oh,-o.degToRad(gh._center.lng)),o.rotateX$1(Oh,Oh,o.degToRad(gh._center.lat)),o.rotateZ$1(Oh,Oh,gh.angle),o.rotateX$1(Oh,Oh,-gh._pitch);const rd=o.fromQuat(new Float32Array(16),Oh),sd=o.mapValue(el.properties.get("star-intensity"),0,1,0,.25),ld=5e-4,dd=o.mapValue(el.properties.get("horizon-blend"),0,1,ld,.25),ud=o.globeUseCustomAntiAliasing($s,Wu,gh)&&dd===ld?gh.worldSize/(2*Math.PI*1.025)-1:gh.globeRadius,md=$s.frameCounter/1e3%1,Af=o.length(gh.globeCenterInViewSpace),Td=Math.sqrt(Math.pow(Af,2)-Math.pow(ud,2)),Gd=Math.acos(Td/Af),Od=((Dd,yf,zf,Pf,Vf,Lp,Mp,fp,Fp,cm,Jp,kp,_m,Lm)=>({u_frustum_tl:Dd,u_frustum_tr:yf,u_frustum_br:zf,u_frustum_bl:Pf,u_horizon:Vf,u_transition:Lp,u_fadeout_range:Mp,u_color:fp,u_high_color:Fp,u_space_color:cm,u_star_intensity:Jp,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:kp,u_horizon_angle:_m,u_rotation_matrix:Lm}))(gh.frustumCorners.TL,gh.frustumCorners.TR,gh.frustumCorners.BR,gh.frustumCorners.BL,gh.frustumCorners.horizon,Ih,dd,Qu,bh,kh,sd,md,Gd,rd);$s.prepareDrawProgram(Wu,yh);const Lf=$s.atmosphereBuffer;Lf&&yh.draw(Wu,dh.TRIANGLES,Eh,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Od,"skybox",Lf.vertexBuffer,Lf.indexBuffer,Lf.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const $s=this.style._layers[B[this.currentLayer]],el=u._getLayerSourceCache($s);$s.isSky()&&this.renderLayer(this,el,$s,el?mr[el.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<B.length;){const $s=this.style._layers[B[this.currentLayer]],el=u._getLayerSourceCache($s);if($s.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped($s)){if($s.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Wu=el?($s.type==="symbol"?Ur:mr)[el.id]:void 0;this._renderTileClippingMasks($s,el,el?vt[el.id]:void 0),this.renderLayer(this,el,$s,Wu),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $s=null;o.values(this.style._layers).forEach(el=>{const Wu=u._getLayerSourceCache(el);Wu&&!el.isHidden(this.transform.zoom)&&(!$s||$s.getSource().maxzoom<Wu.getSource().maxzoom)&&($s=Wu)}),$s&&this.options.showTileBoundaries&&fg.debug(this,$s,$s.getVisibleCoordinates())}this.options.showPadding&&function($s){const el=$s.transform.padding;am($s,$s.transform.height-(el.top||0),3,O_),am($s,el.bottom||0,3,A0),y_($s,el.left||0,3,W0),y_($s,$s.transform.width-(el.right||0),3,zv);const Wu=$s.transform.centerPoint;(function(dh,gh,Eh,yh){Vg(dh,gh-1,Eh-10,2,20,yh),Vg(dh,gh-10,Eh-1,20,2,yh)})($s,Wu.x,$s.transform.height-Wu.y,P0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(u,E,B,Y){B.isHidden(this.transform.zoom)||(B.type==="background"||B.type==="sky"||B.type==="custom"||Y&&Y.length)&&(this.id=B.id,this.gpuTimingStart(B),(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes(B.type)||u.terrain&&B.type==="custom")&&fg[B.type](u,E,B,Y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(u){if(!this.options.gpuTiming)return;const E=this.context.extTimerQuery;let B=this.gpuTimers[u.id];B||(B=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:E.createQueryEXT()}),B.calls++,E.beginQueryEXT(E.TIME_ELAPSED_EXT,B.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const u=this.context.extTimerQuery,E=u.createQueryEXT();this.deferredRenderGpuTimeQueries.push(E),u.beginQueryEXT(u.TIME_ELAPSED_EXT,E)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}collectGpuTimers(){const u=this.gpuTimers;return this.gpuTimers={},u}collectDeferredRenderGpuQueries(){const u=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],u}queryGpuTimers(u){const E={};for(const B in u){const Y=u[B],vt=this.context.extTimerQuery,mr=vt.getQueryObjectEXT(Y.query,vt.QUERY_RESULT_EXT)/1e6;vt.deleteQueryEXT(Y.query),E[B]=mr}return E}queryGpuTimeDeferredRender(u){if(!this.options.gpuTimingDeferredRender)return 0;const E=this.context.extTimerQuery;let B=0;for(const Y of u)B+=E.getQueryObjectEXT(Y,E.QUERY_RESULT_EXT)/1e6,E.deleteQueryEXT(Y);return B}translatePosMatrix(u,E,B,Y,vt){if(!B[0]&&!B[1])return u;const mr=vt?Y==="map"?this.transform.angle:0:Y==="viewport"?-this.transform.angle:0;if(mr){const $s=Math.sin(mr),el=Math.cos(mr);B=[B[0]*el-B[1]*$s,B[0]*$s+B[1]*el]}const Ur=[vt?B[0]:yd(E,B[0],this.transform.zoom),vt?B[1]:yd(E,B[1],this.transform.zoom),0],Gn=new Float32Array(16);return o.translate(Gn,u,Ur),Gn}saveTileTexture(u){const E=this._tileTextures[u.size[0]];E?E.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const E=this._tileTextures[u];return E&&E.length>0?E.pop():null}isPatternMissing(u){return u===null||u!==void 0&&!this.imageManager.getPattern(u.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const u=this.terrain&&this.terrain.renderingToTexture,E=this.terrain&&this.terrain.exaggeration()===0,B=this.style&&this.style.fog,Y=[];return this.terrainRenderModeElevated()&&Y.push("TERRAIN"),this.transform.projection.name==="globe"&&Y.push("GLOBE"),E&&Y.push("ZERO_EXAGGERATION"),B&&!u&&B.getOpacity(this.transform.pitch)!==0&&Y.push("FOG"),u&&Y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&Y.push("OVERDRAW_INSPECTOR"),Y}useProgram(u,E,B){this.cache=this.cache||{};const Y=B||[],vt=this.currentGlobalDefines().concat(Y),mr=im.cacheKey(I0[u],u,vt,E);return this.cache[mr]||(this.cache[mr]=new im(this.context,u,I0[u],E,om[u],vt)),this.cache[mr]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(u,E,B){if(this.terrain&&this.terrain.renderingToTexture)return;const Y=this.style.fog;if(Y){const vt=Y.getOpacity(this.transform.pitch),mr=((Ur,Gn,$s,el,Wu,dh,gh,Eh,yh,Ih,Qu)=>{const bh=Ur.transform,kh=Gn.properties.get("color").toArray01();kh[3]=el;const Oh=Ur.frameCounter/1e3%1;return{u_fog_matrix:$s?bh.calculateFogTileMatrix($s):Ur.identityMat,u_fog_range:Gn.getFovAdjustedRange(bh._fov),u_fog_color:kh,u_fog_horizon_blend:Gn.properties.get("horizon-blend"),u_fog_temporal_offset:Oh,u_frustum_tl:Wu,u_frustum_tr:dh,u_frustum_br:gh,u_frustum_bl:Eh,u_globe_pos:yh,u_globe_radius:Ih,u_viewport:Qu,u_globe_transition:o.globeToMercatorTransition(bh.zoom),u_is_globe:+(bh.projection.name==="globe")}})(this,Y,B,vt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);E.setFogUniformValues(u,mr)}}setTileLoadedFlag(u){this.tileLoaded=u}saveCanvasCopy(){const u=this.canvasCopy();u&&(this.frameCopies.push(u),this.tileLoaded=!1)}canvasCopy(){const u=this.context.gl,E=u.createTexture();return u.bindTexture(u.TEXTURE_2D,E),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,u.drawingBufferWidth,u.drawingBufferHeight,0),E}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const u=this.style&&this.style.fog;return!!u&&u.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const u=this._backgroundTiles,E=this._backgroundTiles={},B=this.transform.coveringTiles({tileSize:512});for(const Y of B)E[Y.key]=u[Y.key]||new o.Tile(Y,512,this.transform.tileZoom,this);return E}clearBackgroundTiles(){this._backgroundTiles={}}}class ug{constructor(u=0,E=0,B=0,Y=0){if(isNaN(u)||u<0||isNaN(E)||E<0||isNaN(B)||B<0||isNaN(Y)||Y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=E,this.left=B,this.right=Y}interpolate(u,E,B){return E.top!=null&&u.top!=null&&(this.top=o.number(u.top,E.top,B)),E.bottom!=null&&u.bottom!=null&&(this.bottom=o.number(u.bottom,E.bottom,B)),E.left!=null&&u.left!=null&&(this.left=o.number(u.left,E.left,B)),E.right!=null&&u.right!=null&&(this.right=o.number(u.right,E.right,B)),this}getCenter(u,E){const B=o.clamp((this.left+u-this.right)/2,0,u),Y=o.clamp((this.top+E-this.bottom)/2,0,E);return new o.Point(B,Y)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new ug(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ym(L,u){const E=o.getColumn(L,3);o.fromQuat(L,u),o.setColumn(L,3,E)}function Yp(L,u){const E=o.identity$1([]);return o.rotateZ$1(E,E,-u),o.rotateX$1(E,E,-L),E}function $_(L,u){const E=[L[0],L[1],0],B=[u[0],u[1],0];if(o.length(E)>=1e-15){const mr=o.normalize([],E);o.scale$2(B,mr,o.dot(B,mr)),u[0]=B[0],u[1]=B[1]}const Y=o.cross([],u,L);if(o.len(Y)<1e-15)return null;const vt=Math.atan2(-Y[1],Y[0]);return Yp(Math.atan2(Math.sqrt(L[0]*L[0]+L[1]*L[1]),-L[2]),vt)}class k0{constructor(u,E){this.position=u,this.orientation=E}get position(){return this._position}set position(u){if(u){const E=u instanceof o.MercatorCoordinate?u:new o.MercatorCoordinate(u[0],u[1],u[2]);this._renderWorldCopies&&(E.x=o.wrap(E.x,0,1)),this._position=E}else this._position=null}lookAtPoint(u,E){if(this.orientation=null,!this.position)return;const B=this.position,Y=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(u)):0,vt=o.MercatorCoordinate.fromLngLat(u,Y),mr=[vt.x-B.x,vt.y-B.y,vt.z-B.z];E||(E=[0,0,1]),E[2]=Math.abs(E[2]),this.orientation=$_(mr,E)}setPitchBearing(u,E){this.orientation=Yp(o.degToRad(u),o.degToRad(-E))}}class Py{constructor(u,E){this._transform=o.identity([]),this.orientation=E,this.position=u}get mercatorPosition(){const u=this.position;return new o.MercatorCoordinate(u[0],u[1],u[2])}get position(){const u=o.getColumn(this._transform,3);return[u[0],u[1],u[2]]}set position(u){var E;u&&o.setColumn(this._transform,3,[(E=u)[0],E[1],E[2],1])}get orientation(){return this._orientation}set orientation(u){this._orientation=u||o.identity$1([]),u&&ym(this._transform,this._orientation)}getPitchBearing(){const u=this.forward(),E=this.right();return{bearing:Math.atan2(-E[1],E[0]),pitch:Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2])}}setPitchBearing(u,E){this._orientation=Yp(u,E),ym(this._transform,this._orientation)}forward(){const u=o.getColumn(this._transform,2);return[-u[0],-u[1],-u[2]]}up(){const u=o.getColumn(this._transform,1);return[-u[0],-u[1],-u[2]]}right(){const u=o.getColumn(this._transform,0);return[u[0],u[1],u[2]]}getCameraToWorld(u,E){const B=new Float64Array(16);return o.invert(B,this.getWorldToCamera(u,E)),B}getWorldToCameraPosition(u,E,B){const Y=this.position;o.scale$2(Y,Y,-u);const vt=new Float64Array(16);return o.fromScaling(vt,[B,B,B]),o.translate(vt,vt,Y),vt[10]*=E,vt}getWorldToCamera(u,E){const B=new Float64Array(16),Y=new Float64Array(4),vt=this.position;return o.conjugate(Y,this._orientation),o.scale$2(vt,vt,-u),o.fromQuat(B,Y),o.translate(B,B,vt),B[1]*=-1,B[5]*=-1,B[9]*=-1,B[13]*=-1,B[8]*=E,B[9]*=E,B[10]*=E,B[11]*=E,B}getCameraToClipPerspective(u,E,B,Y){const vt=new Float64Array(16);return o.perspective(vt,u,E,B,Y),vt}getDistanceToElevation(u,E=!1){const B=u===0?0:o.mercatorZfromAltitude(u,E?o.latFromMercatorY(this.position[1]):this.position[1]),Y=this.forward();return(B-this.position[2])/Y[2]}clone(){return new Py([...this.position],[...this.orientation])}}function x_(L,u){const E=b_(L.projection,L.zoom,L.width,L.height),B=function(vt,mr,Ur,Gn,$s){const el=new o.LngLat(Ur.lng-180*Q_,Ur.lat),Wu=new o.LngLat(Ur.lng+180*Q_,Ur.lat),dh=vt.project(el.lng,el.lat),gh=vt.project(Wu.lng,Wu.lat),Eh=-Math.atan2(gh.y-dh.y,gh.x-dh.x),yh=o.MercatorCoordinate.fromLngLat(Ur);yh.y=o.clamp(yh.y,-1+Q_,1-Q_);const Ih=yh.toLngLat(),Qu=vt.project(Ih.lng,Ih.lat),bh=o.MercatorCoordinate.fromLngLat(Ih);bh.x+=Q_;const kh=bh.toLngLat(),Oh=vt.project(kh.lng,kh.lat),rd=jp(Oh.x-Qu.x,Oh.y-Qu.y,Eh),sd=o.MercatorCoordinate.fromLngLat(Ih);sd.y+=Q_;const ld=sd.toLngLat(),dd=vt.project(ld.lng,ld.lat),ud=jp(dd.x-Qu.x,dd.y-Qu.y,Eh),md=Math.abs(rd.x)/Math.abs(ud.y),Af=o.identity([]);o.rotateZ(Af,Af,-Eh*(1-($s?0:Gn)));const Td=o.identity([]);return o.scale(Td,Td,[1,1-(1-md)*Gn,1]),Td[4]=-ud.x/ud.y*Gn,o.rotateZ(Td,Td,Eh),o.multiply(Td,Af,Td),Td}(L.projection,0,L.center,E,u),Y=_v(L);return o.scale(B,B,[Y,Y,1]),B}function _v(L){const u=L.projection,E=b_(L.projection,L.zoom,L.width,L.height),B=Pp(u,L.center),Y=Pp(u,o.LngLat.convert(u.center));return Math.pow(2,B*E+(1-E)*Y)}function b_(L,u,E,B,Y=1/0){const vt=L.range;if(!vt)return 0;const mr=Math.min(Y,Math.max(E,B)),Ur=Math.log(mr/1024)/Math.LN2;return o.smoothstep(vt[0]+Ur,vt[1]+Ur,u)}const Q_=1/4e4;function Pp(L,u){const E=o.clamp(u.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),B=new o.LngLat(u.lng-180*Q_,E),Y=new o.LngLat(u.lng+180*Q_,E),vt=L.project(B.lng,E),mr=L.project(Y.lng,E),Ur=o.MercatorCoordinate.fromLngLat(B),Gn=o.MercatorCoordinate.fromLngLat(Y),$s=mr.x-vt.x,el=mr.y-vt.y,Wu=Gn.x-Ur.x,dh=Gn.y-Ur.y,gh=Math.sqrt((Wu*Wu+dh*dh)/($s*$s+el*el));return Math.log(gh)/Math.LN2}function jp(L,u,E){const B=Math.cos(E),Y=Math.sin(E);return{x:L*B-u*Y,y:L*Y+u*B}}class py{constructor(u,E,B,Y,vt,mr,Ur){this.tileSize=512,this._renderWorldCopies=vt===void 0||vt,this._minZoom=u||0,this._maxZoom=E||22,this._minPitch=B??0,this._maxPitch=Y??60,this.setProjection(mr),this.setMaxBounds(Ur),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ug,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Py,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const u=new py(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return u._elevation=this._elevation,u._centerAltitude=this._centerAltitude,u._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,u.tileSize=this.tileSize,u.mercatorFromTransition=this.mercatorFromTransition,u.width=this.width,u.height=this.height,u.cameraElevationReference=this.cameraElevationReference,u._center=this._center,u._setZoom(this.zoom),u._seaLevelZoom=this._seaLevelZoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._nearZ=this._nearZ,u._farZ=this._farZ,u._averageElevation=this._averageElevation,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._camera=this._camera.clone(),u._calcMatrices(),u.freezeTileCoverage=this.freezeTileCoverage,u.frustumCorners=this.frustumCorners,u}get elevation(){return this._elevation}set elevation(u){this._elevation!==u&&(this._elevation=u,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(u,E=!1){const B=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||B)&&this._updateCameraOnTerrain(),(u||B)&&this._constrainCamera(E),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(u){this.projectionOptions=u||{name:"mercator"};const E=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const B=!x(E,this.getProjection());return B&&this._calcMatrices(),this.mercatorFromTransition=!1,B}setMercatorFromTransition(){const u=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const E=u!==this.projection.name;return E&&this._calcMatrices(),E}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get cameraWorldSize(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(u){this.rotation=u}get rotation(){return-this.angle/Math.PI*180}set rotation(u){const E=-u*Math.PI/180;var B;this.angle!==E&&(this._unmodified=!1,this.angle=E,this._calcMatrices(),this.rotationMatrix=(B=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(B[1]=0,B[2]=0),B[0]=1,B[3]=1,B),function(Y,vt,mr){var Ur=vt[0],Gn=vt[1],$s=vt[2],el=vt[3],Wu=Math.sin(mr),dh=Math.cos(mr);Y[0]=Ur*dh+$s*Wu,Y[1]=Gn*dh+el*Wu,Y[2]=Ur*-Wu+$s*dh,Y[3]=Gn*-Wu+el*dh}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const E=o.clamp(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==E&&(this._unmodified=!1,this._pitch=E,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const u=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/u)}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=o.degToRad(u),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(u){this._averageElevation=u,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(u){const E=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==E&&(this._unmodified=!1,this._setZoom(E),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(u){this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;this._centerAltitude=u.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=u.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const u=this._elevation,E=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],B=this.horizonLineFromTop();let Y=0,vt=0;for(let mr=0;mr<E.length;mr++){const Ur=new o.Point(E[mr][0]*this.width,B+E[mr][1]*(this.height-B)),Gn=u.pointCoordinate(Ur);if(!Gn)continue;const $s=1/Math.hypot(Gn[0]-this._camera.position[0],Gn[1]-this._camera.position[1]);Y+=Gn[3]*$s,vt+=$s}return vt===0?NaN:Y/vt}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const u=this._seaLevelZoom,E=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),B=this.pixelsPerMeter/this.worldSize*E,Y=this._mercatorZfromZoom(u),vt=this._mercatorZfromZoom(this._maxZoom),mr=Math.max(Y-B,vt);this._setZoom(this._zoomFromMercatorZ(mr))}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}computeZoomRelativeTo(u){const E=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,u.toAltitude()));let B;B=u.z<this._camera.position[2]?[E.x,E.y,E.z]:[u.x,u.y,u.z];const Y=o.length(o.sub([],this._camera.position,B));return o.clamp(this._zoomFromMercatorZ(Y),this._minZoom,this._maxZoom)}setFreeCameraOptions(u){if(!this.height||!u.position&&!u.orientation)return;this._updateCameraState();let E=!1;if(u.orientation&&!o.exactEquals(u.orientation,this._camera.orientation)&&(E=this._setCameraOrientation(u.orientation)),u.position){const B=[u.position.x,u.position.y,u.position.z];o.exactEquals$1(B,this._camera.position)||(this._setCameraPosition(B),E=!0)}E&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const u=this._camera.position,E=new k0;return E.position=new o.MercatorCoordinate(u[0],u[1],u[2]),E.orientation=this._camera.orientation,E._elevation=this.elevation,E._renderWorldCopies=this.renderWorldCopies,E}_setCameraOrientation(u){if(!o.length$1(u))return!1;o.normalize$1(u,u);const E=o.transformQuat([],[0,0,-1],u),B=o.transformQuat([],[0,-1,0],u);if(B[2]<0)return!1;const Y=$_(E,B);return!!Y&&(this._camera.orientation=Y,!0)}_setCameraPosition(u){const E=this.zoomScale(this.minZoom)*this.tileSize,B=this.zoomScale(this.maxZoom)*this.tileSize,Y=this.cameraToCenterDistance;u[2]=o.clamp(u[2],Y/B,Y/E),this._camera.position=u}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,E,B){this._unmodified=!1,this._edgeInsets.interpolate(u,E,B),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const E=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,E)}getVisibleUnwrappedCoordinates(u){const E=[new o.UnwrappedTileID(0,u)];if(this.renderWorldCopies){const B=this.pointCoordinate(new o.Point(0,0)),Y=this.pointCoordinate(new o.Point(this.width,0)),vt=this.pointCoordinate(new o.Point(this.width,this.height)),mr=this.pointCoordinate(new o.Point(0,this.height)),Ur=Math.floor(Math.min(B.x,Y.x,vt.x,mr.x)),Gn=Math.floor(Math.max(B.x,Y.x,vt.x,mr.x)),$s=1;for(let el=Ur-$s;el<=Gn+$s;el++)el!==0&&E.push(new o.UnwrappedTileID(el,u))}return E}coveringTiles(u){let E=this.coveringZoomLevel(u);const B=E,Y=this.elevation&&!u.isTerrainDEM,vt=this.projection.name==="mercator";if(u.minzoom!==void 0&&E<u.minzoom)return[];u.maxzoom!==void 0&&E>u.maxzoom&&(E=u.maxzoom);const mr=this.locationCoordinate(this.center),Ur=this.center.lat,Gn=1<<E,$s=[Gn*mr.x,Gn*mr.y,0],el=this.projection.name==="globe",Wu=!el,dh=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,E,Wu),gh=el?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Eh=Gn*o.mercatorZfromAltitude(1,this.center.lat),yh=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Ih=[Gn*gh.x,Gn*gh.y,yh*(Wu?1:Eh)],Qu=this.cameraToCenterDistance/u.tileSize*(u.roundZoom?1:.502),bh=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?E:0,kh=u.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Oh=u.isTerrainDEM?-kh:this._elevation?this._elevation.getMinElevationBelowMSL():0,rd=this.projection.isReprojectedInTileSpace?_v(this):1,sd=Dd=>{const zf=new o.MercatorCoordinate(Dd.x+25e-6,Dd.y,Dd.z),Pf=new o.MercatorCoordinate(Dd.x,Dd.y+25e-6,Dd.z),Vf=Dd.toLngLat(),Lp=zf.toLngLat(),Mp=Pf.toLngLat(),fp=this.locationCoordinate(Vf),Fp=this.locationCoordinate(Lp),cm=this.locationCoordinate(Mp),Jp=Math.hypot(Fp.x-fp.x,Fp.y-fp.y),kp=Math.hypot(cm.x-fp.x,cm.y-fp.y);return Math.sqrt(Jp*kp)*rd/25e-6},ld=Dd=>{const yf=kh,zf=Oh;return{aabb:o.tileAABB(this,Gn,0,0,0,Dd,zf,yf,this.projection),zoom:0,x:0,y:0,minZ:zf,maxZ:yf,wrap:Dd,fullyVisible:!1}},dd=[];let ud=[];const md=E,Af=u.reparseOverscaled?B:E,Td=Dd=>Dd*Dd,Gd=Td((yh-this._centerAltitude)*Eh),Od=Dd=>{if(!this._elevation||!Dd.tileID||!vt)return;const yf=this._elevation.getMinMaxForTile(Dd.tileID),zf=Dd.aabb;yf?(zf.min[2]=yf.min,zf.max[2]=yf.max,zf.center[2]=(zf.min[2]+zf.max[2])/2):(Dd.shouldSplit=Lf(Dd),Dd.shouldSplit||(zf.min[2]=zf.max[2]=zf.center[2]=this._centerAltitude))},Lf=Dd=>{if(Dd.zoom<bh)return!0;if(Dd.zoom===md)return!1;if(Dd.shouldSplit!=null)return Dd.shouldSplit;const yf=Dd.aabb.distanceX(Ih),zf=Dd.aabb.distanceY(Ih);let Pf=Gd,Vf=1;if(el){Pf=Td(Dd.aabb.distanceZ(Ih));const fp=Math.pow(2,Dd.zoom),Fp=o.latFromMercatorY((Dd.y+1)/fp),cm=o.latFromMercatorY(Dd.y/fp),Jp=Math.min(Math.max(Ur,Fp),cm),kp=o.circumferenceAtLatitude(Jp)/o.circumferenceAtLatitude(Ur);if(Vf=Jp===Ur?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,kp/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Dd.zoom===md-1&&kp>=.9)return!0}else if(Y&&(Pf=Td(Dd.aabb.distanceZ(Ih)*Eh)),this.projection.isReprojectedInTileSpace&&B<=5){const fp=Math.pow(2,Dd.zoom),Fp=sd(new o.MercatorCoordinate((Dd.x+.5)/fp,(Dd.y+.5)/fp));Vf=Fp>.85?1:Fp}const Lp=yf*yf+zf*zf+Pf,Mp=Td((1<<md-Dd.zoom)*Qu*Vf*((fp,Fp)=>{if(Fp*Td(.707)<fp)return 1;const cm=Math.sqrt(Fp/fp);return cm/(1.4144271570014144+(Math.pow(1.1,cm-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Pf,Gd),Lp));return Lp<Mp};if(this.renderWorldCopies)for(let Dd=1;Dd<=3;Dd++)dd.push(ld(-Dd)),dd.push(ld(Dd));for(dd.push(ld(0));dd.length>0;){const Dd=dd.pop(),yf=Dd.x,zf=Dd.y;let Pf=Dd.fullyVisible;if(!Pf){const Vf=Dd.aabb.intersects(dh);if(Vf===0)continue;Pf=Vf===2}if(Dd.zoom!==md&&Lf(Dd))for(let Vf=0;Vf<4;Vf++){const Lp=(yf<<1)+Vf%2,Mp=(zf<<1)+(Vf>>1),fp={aabb:vt?Dd.aabb.quadrant(Vf):o.tileAABB(this,Gn,Dd.zoom+1,Lp,Mp,Dd.wrap,Dd.minZ,Dd.maxZ,this.projection),zoom:Dd.zoom+1,x:Lp,y:Mp,wrap:Dd.wrap,fullyVisible:Pf,tileID:void 0,shouldSplit:void 0,minZ:Dd.minZ,maxZ:Dd.maxZ};Y&&!el&&(fp.tileID=new o.OverscaledTileID(Dd.zoom+1===md?Af:Dd.zoom+1,Dd.wrap,Dd.zoom+1,Lp,Mp),Od(fp)),dd.push(fp)}else{const Vf=Dd.zoom===md?Af:Dd.zoom;if(u.minzoom&&u.minzoom>Vf)continue;const Lp=$s[0]-(.5+yf+(Dd.wrap<<Dd.zoom))*(1<<E-Dd.zoom),Mp=$s[1]-.5-zf,fp=Dd.tileID?Dd.tileID:new o.OverscaledTileID(Vf,Dd.wrap,Dd.zoom,yf,zf);ud.push({tileID:fp,distanceSq:Lp*Lp+Mp*Mp})}}if(this.fogCullDistSq){const Dd=this.fogCullDistSq,yf=this.horizonLineFromTop();ud=ud.filter(zf=>{const Pf=[0,0,0,1],Vf=[o.EXTENT,o.EXTENT,0,1],Lp=this.calculateFogTileMatrix(zf.tileID.toUnwrapped());o.transformMat4$1(Pf,Pf,Lp),o.transformMat4$1(Vf,Vf,Lp);const Mp=o.getAABBPointSquareDist(Pf,Vf);if(Mp===0)return!0;let fp=!1;const Fp=this._elevation;if(Fp&&Mp>Dd&&yf!==0){const cm=this.calculateProjMatrix(zf.tileID.toUnwrapped());let Jp;u.isTerrainDEM||(Jp=Fp.getMinMaxForTile(zf.tileID)),Jp||(Jp={min:Oh,max:kh});const kp=o.furthestTileCorner(this.rotation),_m=[kp[0]*o.EXTENT,kp[1]*o.EXTENT,Jp.max];o.transformMat4(_m,_m,cm),fp=(1-_m[1])*this.height*.5<yf}return Mp<Dd||fp})}return ud.sort((Dd,yf)=>Dd.distanceSq-yf.distanceSq).map(Dd=>Dd.tileID)}resize(u,E){this.width=u,this.height=E,this.pixelsToGLUnits=[2/u,-2/E],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const E=o.clamp(u.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),B=this.projection.project(u.lng,E);return new o.Point(B.x*this.worldSize,B.y*this.worldSize)}unproject(u){return this.projection.unproject(u.x/this.worldSize,u.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(u,E){let B,Y;const vt=this.centerPoint;if(this.projection.name==="globe"){const Ur=this.worldSize;B=(E.x-vt.x)/Ur,Y=(E.y-vt.y)/Ur}else{const Ur=this.pointCoordinate(E),Gn=this.pointCoordinate(vt);B=Ur.x-Gn.x,Y=Ur.y-Gn.y}const mr=this.locationCoordinate(u);this.setLocation(new o.MercatorCoordinate(mr.x-B,mr.y-Y))}setLocation(u){this.center=this.coordinateLocation(u),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(u){return this.projection.locationPoint(this,u)}locationPoint3D(u){return this.projection.locationPoint(this,u,!0)}pointLocation(u){return this.coordinateLocation(this.pointCoordinate(u))}pointLocation3D(u){return this.coordinateLocation(this.pointCoordinate3D(u))}locationCoordinate(u,E){const B=E?o.mercatorZfromAltitude(E,u.lat):void 0,Y=this.projection.project(u.lng,u.lat);return new o.MercatorCoordinate(Y.x,Y.y,B)}coordinateLocation(u){return this.projection.unproject(u.x,u.y)}pointRayIntersection(u,E){const B=E??this._centerAltitude,Y=[u.x,u.y,0,1],vt=[u.x,u.y,1,1];o.transformMat4$1(Y,Y,this.pixelMatrixInverse),o.transformMat4$1(vt,vt,this.pixelMatrixInverse);const mr=vt[3];o.scale$1(Y,Y,1/Y[3]),o.scale$1(vt,vt,1/mr);const Ur=Y[2],Gn=vt[2];return{p0:Y,p1:vt,t:Ur===Gn?0:(B-Ur)/(Gn-Ur)}}screenPointToMercatorRay(u){const E=[u.x,u.y,0,1],B=[u.x,u.y,1,1];return o.transformMat4$1(E,E,this.pixelMatrixInverse),o.transformMat4$1(B,B,this.pixelMatrixInverse),o.scale$1(E,E,1/E[3]),o.scale$1(B,B,1/B[3]),E[2]=o.mercatorZfromAltitude(E[2],this._center.lat)*this.worldSize,B[2]=o.mercatorZfromAltitude(B[2],this._center.lat)*this.worldSize,o.scale$1(E,E,1/this.worldSize),o.scale$1(B,B,1/this.worldSize),new o.Ray([E[0],E[1],E[2]],o.normalize([],o.sub([],B,E)))}rayIntersectionCoordinate(u){const{p0:E,p1:B,t:Y}=u,vt=o.mercatorZfromAltitude(E[2],this._center.lat),mr=o.mercatorZfromAltitude(B[2],this._center.lat);return new o.MercatorCoordinate(o.number(E[0],B[0],Y)/this.worldSize,o.number(E[1],B[1],Y)/this.worldSize,o.number(vt,mr,Y))}pointCoordinate(u,E=this._centerAltitude){return this.projection.pointCoordinate(this,u.x,u.y,E)}pointCoordinate3D(u){if(!this.elevation)return this.pointCoordinate(u);let E=this.projection.pointCoordinate3D(this,u.x,u.y);if(E)return new o.MercatorCoordinate(E[0],E[1],E[2]);let B=0,Y=this.horizonLineFromTop();if(u.y>Y)return this.pointCoordinate(u);const vt=.02*Y,mr=u.clone();for(let Ur=0;Ur<10&&Y-B>vt;Ur++){mr.y=o.number(B,Y,.66);const Gn=this.projection.pointCoordinate3D(this,mr.x,mr.y);Gn?(Y=mr.y,E=Gn):B=mr.y}return E?new o.MercatorCoordinate(E[0],E[1],E[2]):this.pointCoordinate(u)}isPointAboveHorizon(u){return this.projection.isPointAboveHorizon(this,u)}isPointOnSurface(u){if(u.y<0||u.y>this.height||u.x<0||u.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(u);const E=this.pointCoordinate(u);return E.y>=0&&E.y<=1}_coordinatePoint(u,E){const B=E&&this.elevation?this.elevation.getAtPointOrZero(u,this._centerAltitude):this._centerAltitude,Y=[u.x*this.worldSize,u.y*this.worldSize,B+u.toAltitude(),1];return o.transformMat4$1(Y,Y,this.pixelMatrix),Y[3]>0?new o.Point(Y[0]/Y[3],Y[1]/Y[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:u,left:E}=this._edgeInsets,B=this.height-this._edgeInsets.bottom,Y=this.width-this._edgeInsets.right,vt=this.pointLocation3D(new o.Point(E,u)),mr=this.pointLocation3D(new o.Point(Y,u)),Ur=this.pointLocation3D(new o.Point(Y,B)),Gn=this.pointLocation3D(new o.Point(E,B));let $s=Math.min(vt.lng,mr.lng,Ur.lng,Gn.lng),el=Math.max(vt.lng,mr.lng,Ur.lng,Gn.lng),Wu=Math.min(vt.lat,mr.lat,Ur.lat,Gn.lat),dh=Math.max(vt.lat,mr.lat,Ur.lat,Gn.lat);const gh=Math.pow(2,-this.zoom)/16*270,Eh=this.projection.name==="globe"?1:4,yh=(Ih,Qu,bh,kh,Oh)=>{const rd=(Ih+bh)/2,sd=(Qu+kh)/2,ld=new o.Point(rd,sd),{lng:dd,lat:ud}=this.pointLocation3D(ld),md=Math.max(0,$s-dd,Wu-ud,dd-el,ud-dh);$s=Math.min($s,dd),el=Math.max(el,dd),Wu=Math.min(Wu,ud),dh=Math.max(dh,ud),(Oh<Eh||md>gh)&&(yh(Ih,Qu,rd,sd,Oh+1),yh(rd,sd,bh,kh,Oh+1))};if(yh(E,u,Y,u,1),yh(Y,u,Y,B,1),yh(Y,B,E,B,1),yh(E,B,E,u,1),this.projection.name==="globe"){const[Ih,Qu]=o.polesInViewport(this);Ih?(dh=90,el=180,$s=-180):Qu&&(Wu=-90,el=180,$s=-180)}return new o.LngLatBounds(new o.LngLat($s,Wu),new o.LngLat(el,dh))}_getBoundsRectangular(u,E){const{top:B,left:Y}=this._edgeInsets,vt=this.height-this._edgeInsets.bottom,mr=this.width-this._edgeInsets.right,Ur=new o.Point(Y,B),Gn=new o.Point(mr,B),$s=new o.Point(mr,vt),el=new o.Point(Y,vt);let Wu=this.pointCoordinate(Ur,u),dh=this.pointCoordinate(Gn,u);const gh=this.pointCoordinate($s,E),Eh=this.pointCoordinate(el,E),yh=(Ih,Qu)=>(Qu.y-Ih.y)/(Qu.x-Ih.x);return Wu.y>1&&dh.y>=0?Wu=new o.MercatorCoordinate((1-Eh.y)/yh(Eh,Wu)+Eh.x,1):Wu.y<0&&dh.y<=1&&(Wu=new o.MercatorCoordinate(-Eh.y/yh(Eh,Wu)+Eh.x,0)),dh.y>1&&Wu.y>=0?dh=new o.MercatorCoordinate((1-gh.y)/yh(gh,dh)+gh.x,1):dh.y<0&&Wu.y<=1&&(dh=new o.MercatorCoordinate(-gh.y/yh(gh,dh)+gh.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(Wu)).extend(this.coordinateLocation(dh)).extend(this.coordinateLocation(Eh)).extend(this.coordinateLocation(gh))}_getBoundsRectangularTerrain(){const u=this.elevation;if(!u.visibleDemTiles.length||u.isUsingMockSource())return this._getBoundsRectangular(0,0);const E=u.visibleDemTiles.reduce((B,Y)=>{if(Y.dem){const vt=Y.dem.tree;B.min=Math.min(B.min,vt.minimums[0]),B.max=Math.max(B.max,vt.maximums[0])}return B},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(E.min*u.exaggeration(),E.max*u.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(u=!0){const E=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,B=this.height/2-E*(1-this._horizonShift);return u?Math.max(0,B):B}getMaxBounds(){return this.maxBounds}setMaxBounds(u){this.maxBounds=u,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,u&&(this.minLat=u.getSouth(),this.maxLat=u.getNorth(),this.minLng=u.getWest(),this.maxLng=u.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(u,E){return this.projection.createTileMatrix(this,E,u)}calculateDistanceTileData(u){const E=u.key,B=this._distanceTileDataCache;if(B[E])return B[E];const Y=u.canonical,vt=1/this.height,mr=this.cameraWorldSize,Ur=mr/this.zoomScale(Y.z),Gn=(Y.x+Math.pow(2,Y.z)*u.wrap)*Ur,$s=Y.y*Ur,el=this.point;el.x*=mr/this.worldSize,el.y*=mr/this.worldSize;const Wu=this.angle,dh=Math.sin(-Wu),gh=-Math.cos(-Wu);return B[E]={bearing:[dh,gh],center:[(el.x-Gn)*vt,(el.y-$s)*vt],scale:Ur/o.EXTENT*vt},B[E]}calculateFogTileMatrix(u){const E=u.key,B=this._fogTileMatrixCache;if(B[E])return B[E];const Y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,u);return o.multiply(Y,this.worldToFogMatrix,Y),B[E]=new Float32Array(Y),B[E]}calculateProjMatrix(u,E=!1){const B=u.key,Y=E?this._alignedProjMatrixCache:this._projMatrixCache;if(Y[B])return Y[B];const vt=this.calculatePosMatrix(u,this.worldSize);return o.multiply(vt,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:E?this.alignedProjMatrix:this.projMatrix,vt),Y[B]=new Float32Array(vt),Y[B]}calculatePixelsToTileUnitsMatrix(u){const E=u.tileID.key,B=this._pixelsToTileUnitsCache;if(B[E])return B[E];const Y=function(vt,mr){const{scale:Ur}=vt.tileTransform,Gn=Ur*o.EXTENT/(vt.tileSize*Math.pow(2,mr.zoom-vt.tileID.overscaledZ+vt.tileID.canonical.z));return $s=new Float32Array(4),dh=(el=mr.inverseAdjustmentMatrix)[1],gh=el[2],Eh=el[3],Ih=(Wu=[Gn,Gn])[1],$s[0]=el[0]*(yh=Wu[0]),$s[1]=dh*yh,$s[2]=gh*Ih,$s[3]=Eh*Ih,$s;var $s,el,Wu,dh,gh,Eh,yh,Ih}(u,this);return B[E]=Y,B[E]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const u=1/this.worldSize,E=o.fromScaling([],[u,u,u]);return o.multiply(E,E,this.globeMatrix),E}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const u=this._elevation;this._updateCameraState();const E=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,B=this._computeCameraPosition(E),Y=this._camera.forward(),vt=o.mercatorZfromAltitude(1,this._center.lat);B[2]/=vt,Y[2]/=vt,o.normalize(Y,Y);const mr=u.raycast(B,Y,u.exaggeration());if(mr){const Ur=o.scaleAndAdd([],B,Y,mr),Gn=new o.MercatorCoordinate(Ur[0],Ur[1],o.mercatorZfromAltitude(Ur[2],o.latFromMercatorY(Ur[1]))),$s=(Gn.z+o.length([Gn.x-B[0],Gn.y-B[1],Gn.z-B[2]*vt]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($s),this._centerAltitude=Gn.toAltitude(),this._center=this.coordinateLocation(Gn),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(u=!1){if(!this._elevation)return;const E=this._elevation,B=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,Y=this._computeCameraPosition(B),vt=E.getAtPointOrZero(new o.MercatorCoordinate(...Y)),mr=this.pixelsPerMeter/this.worldSize*vt,Ur=this._minimumHeightOverTerrain(),Gn=Y[2]-mr;if(Gn<=Ur)if(Gn<0||u){const $s=this.locationCoordinate(this._center,this._centerAltitude),el=[Y[0],Y[1],$s.z-Y[2]],Wu=o.length(el);el[2]-=(Ur-Gn)/this._pixelsPerMercatorPixel;const dh=o.length(el);if(dh===0)return;o.scale$2(el,el,Wu/dh*this._pixelsPerMercatorPixel),this._camera.position=[Y[0],Y[1],$s.z*this._pixelsPerMercatorPixel-el[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||u){const dh=this.center;return dh.lat=o.clamp(dh.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!u)&&(dh.lng=o.clamp(dh.lng,this.minLng,this.maxLng)),this.center=dh,void(this._constraining=!1)}const E=this._unmodified,{x:B,y:Y}=this.point;let vt=0,mr=B,Ur=Y;const Gn=this.width/2,$s=this.height/2,el=this.worldMinY*this.scale,Wu=this.worldMaxY*this.scale;if(Y-$s<el&&(Ur=el+$s),Y+$s>Wu&&(Ur=Wu-$s),Wu-el<this.height&&(vt=Math.max(vt,this.height/(Wu-el)),Ur=(Wu+el)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const dh=this.worldMinX*this.scale,gh=this.worldMaxX*this.scale,Eh=this.worldSize/2-(dh+gh)/2;mr=(B+Eh+this.worldSize)%this.worldSize-Eh,mr-Gn<dh&&(mr=dh+Gn),mr+Gn>gh&&(mr=gh-Gn),gh-dh<this.width&&(vt=Math.max(vt,this.width/(gh-dh)),mr=(gh+dh)/2)}mr===B&&Ur===Y||(this.center=this.unproject(new o.Point(mr,Ur))),vt&&(this.zoom+=this.scaleZoom(vt)),this._constrainCamera(),this._unmodified=E,this._constraining=!1}_minZoomForBounds(){let u=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(u=Math.max(u,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),u}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,E=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const B=b_(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,B),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const Y=this.projection.zAxisUnit==="meters"?E:1,vt=this._camera.getWorldToCamera(this.worldSize,Y),mr=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);mr[8]=2*-u.x/this.width,mr[9]=2*u.y/this.height;let Ur=o.mul([],mr,vt);if(this.projection.isReprojectedInTileSpace){const sd=this.locationCoordinate(this.center),ld=o.identity([]);o.translate(ld,ld,[sd.x*this.worldSize,sd.y*this.worldSize,0]),o.multiply(ld,ld,x_(this)),o.translate(ld,ld,[-sd.x*this.worldSize,-sd.y*this.worldSize,0]),o.multiply(Ur,Ur,ld),this.inverseAdjustmentMatrix=function(dd){const ud=x_(dd,!0);return Zu([],[ud[0],ud[1],ud[4],ud[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],Ur,[this.worldSize,this.worldSize,this.worldSize/Y,1]),this.projMatrix=Ur,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const Gn=o.invert([],mr);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(Gn,this.horizonLineFromTop(),this.height);const $s=new Float32Array(16);o.identity($s),o.scale($s,$s,[1,-1,1]),o.rotateX($s,$s,this._pitch),o.rotateZ($s,$s,this.angle);const el=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Wu=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;el[8]=2*-u.x/this.width,el[9]=2*(u.y+Wu)/this.height,this.skyboxMatrix=o.multiply($s,el,$s);const dh=this.point,gh=dh.x,Eh=dh.y,yh=this.width%2/2,Ih=this.height%2/2,Qu=Math.cos(this.angle),bh=Math.sin(this.angle),kh=gh-Math.round(gh)+Qu*yh+bh*Ih,Oh=Eh-Math.round(Eh)+Qu*Ih+bh*yh,rd=new Float64Array(Ur);if(o.translate(rd,rd,[kh>.5?kh-1:kh,Oh>.5?Oh-1:Oh,0]),this.alignedProjMatrix=rd,Ur=o.create(),o.scale(Ur,Ur,[this.width/2,-this.height/2,1]),o.translate(Ur,Ur,[1,-1,0]),this.labelPlaneMatrix=Ur,Ur=o.create(),o.scale(Ur,Ur,[1,-1,1]),o.translate(Ur,Ur,[-1,-1,0]),o.scale(Ur,Ur,[2/this.width,2/this.height,1]),this.glCoordMatrix=Ur,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},Ur=o.invert(new Float64Array(16),this.pixelMatrix),!Ur)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Ur,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const sd=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(sd,sd,vt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Ur;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const u=this.cameraWorldSizeForFog,E=this.cameraPixelsPerMeter,B=this._camera.position,Y=1/this.height/this._pixelsPerMercatorPixel,vt=[u,u,E];o.scale$2(vt,vt,Y),o.scale$2(B,B,-1),o.multiply$2(B,B,vt);const mr=o.create();o.translate(mr,mr,B),o.scale(mr,mr,vt),this.mercatorFogMatrix=mr,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(u,E,Y)}_computeCameraPosition(u){const E=(u=u||this.pixelsPerMeter)/this.pixelsPerMeter,B=this._camera.forward(),Y=this.point,vt=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*E-u/this.worldSize*this._centerAltitude;return[Y.x/this.worldSize-B[0]*vt,Y.y/this.worldSize-B[1]*vt,u/this.worldSize*this._centerAltitude-B[2]*vt]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(u){const E=this._maxCameraBoundsDistance()*Math.cos(this._pitch),B=this._camera.position[2],Y=u[2];let vt=1;this.projection.wrap&&(this.center=this.center.wrap()),Y>0&&(vt=Math.min((E-B)/Y,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,u,vt),this._updateStateFromCamera()}_updateStateFromCamera(){const u=this._camera.position,E=this._camera.forward(),{pitch:B,bearing:Y}=this._camera.getPitchBearing(),vt=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,mr=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),Ur=Math.max((u[2]-vt)/Math.cos(B),mr),Gn=this._zoomFromMercatorZ(Ur);o.scaleAndAdd(u,u,E,Ur),this._pitch=o.clamp(B,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(Y,-Math.PI,Math.PI),this._setZoom(o.clamp(Gn,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(u[0],u[1],u[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(u){return Math.pow(2,u)*this.tileSize}_mercatorZfromZoom(u){return this.cameraToCenterDistance/this._worldSizeFromZoom(u)}_minimumHeightOverTerrain(){const u=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(u)}_zoomFromMercatorZ(u){return this.scaleZoom(this.cameraToCenterDistance/(u*this.tileSize))}zoomFromMercatorZAdjusted(u){let E=0,B=o.GLOBE_ZOOM_THRESHOLD_MAX,Y=0,vt=1/0;for(;B-E>1e-6&&B>E;){const mr=E+.5*(B-E),Ur=this.tileSize*Math.pow(2,mr),Gn=this.getCameraToCenterDistance(this.projection,mr,Ur),$s=this.scaleZoom(Gn/(u*this.tileSize)),el=Math.abs(mr-$s);el<vt&&(vt=el,Y=mr),mr<$s?E=mr:B=mr}return Y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(u,E){const B=Math.min(u.x,E.x),Y=Math.max(u.x,E.x),vt=Math.min(u.y,E.y),mr=Math.max(u.y,E.y);if(vt<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const Ur=[new o.Point(B,vt),new o.Point(Y,mr),new o.Point(B,mr),new o.Point(Y,vt)],Gn=this.renderWorldCopies?-3:0,$s=this.renderWorldCopies?4:1;for(const el of Ur){const Wu=this.pointRayIntersection(el);if(Wu.t<0)return!0;const dh=this.rayIntersectionCoordinate(Wu);if(dh.x<Gn||dh.y<0||dh.x>$s||dh.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(u,E){const B=o.length(o.sub([],this._camera.position,u)),Y=this._zoomFromMercatorZ(B)+E;return B-this._mercatorZfromZoom(Y)}getCameraPoint(){if(this.projection.name==="globe"){const u=function([E,B,Y],vt){const mr=[E,B,Y,1];o.transformMat4$1(mr,mr,vt);const Ur=mr[3]=Math.max(mr[3],1e-6);return mr[0]/=Ur,mr[1]/=Ur,mr[2]/=Ur,mr}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(u[0],u[1])}{const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,u))}}getCameraToCenterDistance(u,E=this.zoom,B=this.worldSize){const Y=b_(u,E,this.width,this.height,1024),vt=u.pixelSpaceConversion(this.center.lat,B,Y);return .5/Math.tan(.5*this._fov)*this.height*vt}getWorldToCameraMatrix(){const u=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(u,u,this.globeMatrix),u}}function d0(L,u){let E=!1,B=null;const Y=()=>{B=null,E&&(L(),B=setTimeout(Y,u),E=!1)};return()=>(E=!0,B||Y(),B)}class yv{constructor(u){this._hashName=u&&encodeURIComponent(u),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=d0(this._updateHashUnthrottled.bind(this),300)}addTo(u){return this._map=u,o.window.addEventListener("hashchange",this._onHashChange,!1),u.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const u=this._map;if(!u)return"";const E=Ng(u);if(this._hashName){const B=this._hashName;let Y=!1;const vt=o.window.location.hash.slice(1).split("&").map(mr=>{const Ur=mr.split("=")[0];return Ur===B?(Y=!0,`${Ur}=${E}`):mr}).filter(mr=>mr);return Y||vt.push(`${B}=${E}`),`#${vt.join("&")}`}return`#${E}`}_getCurrentHash(){const u=o.window.location.hash.replace("#","");if(this._hashName){let E;return u.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(E=B)}),(E&&E[1]||"").split("/")}return u.split("/")}_onHashChange(){const u=this._map;if(!u)return!1;const E=this._getCurrentHash();if(E.length>=3&&!E.some(B=>isNaN(B))){const B=u.dragRotate.isEnabled()&&u.touchZoomRotate.isEnabled()?+(E[3]||0):u.getBearing();return u.jumpTo({center:[+E[2],+E[1]],zoom:+E[0],bearing:B,pitch:+(E[4]||0)}),!0}return!1}_updateHashUnthrottled(){const u=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,u)}}function Ng(L,u){const E=L.getCenter(),B=Math.round(100*L.getZoom())/100,Y=Math.ceil((B*Math.LN2+Math.log(512/360/.5))/Math.LN10),vt=Math.pow(10,Y),mr=Math.round(E.lng*vt)/vt,Ur=Math.round(E.lat*vt)/vt,Gn=L.getBearing(),$s=L.getPitch();let el=u?`/${mr}/${Ur}/${B}`:`${B}/${Ur}/${mr}`;return(Gn||$s)&&(el+="/"+Math.round(10*Gn)/10),$s&&(el+=`/${Math.round($s)}`),el}const f0={linearity:.3,easing:o.bezier(0,0,.3,1)},w_=o.extend({deceleration:2500,maxSpeed:1400},f0),Fv=o.extend({deceleration:20,maxSpeed:1400},f0),hp=o.extend({deceleration:1e3,maxSpeed:360},f0),wm=o.extend({deceleration:1e3,maxSpeed:90},f0);class pg{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,E=o.exported.now();for(;u.length>0&&E-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const E={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:vt}of this._inertiaBuffer)E.zoom+=vt.zoomDelta||0,E.bearing+=vt.bearingDelta||0,E.pitch+=vt.pitchDelta||0,vt.panDelta&&E.pan._add(vt.panDelta),vt.around&&(E.around=vt.around),vt.pinchAround&&(E.pinchAround=vt.pinchAround);const B=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,Y={};if(E.pan.mag()){const vt=Jy(E.pan.mag(),B,o.extend({},w_,u||{}));Y.offset=E.pan.mult(vt.amount/E.pan.mag()),Y.center=this._map.transform.center,Y0(Y,vt)}if(E.zoom){const vt=Jy(E.zoom,B,Fv);Y.zoom=this._map.transform.zoom+vt.amount,Y0(Y,vt)}if(E.bearing){const vt=Jy(E.bearing,B,hp);Y.bearing=this._map.transform.bearing+o.clamp(vt.amount,-179,179),Y0(Y,vt)}if(E.pitch){const vt=Jy(E.pitch,B,wm);Y.pitch=this._map.transform.pitch+vt.amount,Y0(Y,vt)}if(Y.zoom||Y.bearing){const vt=E.pinchAround===void 0?E.around:E.pinchAround;Y.around=vt?this._map.unproject(vt):this._map.getCenter()}return this.clear(),Y.noMoveStart=!0,Y}}function Y0(L,u){(!L.duration||L.duration<u.duration)&&(L.duration=u.duration,L.easing=u.easing)}function Jy(L,u,E){const{maxSpeed:B,linearity:Y,deceleration:vt}=E,mr=o.clamp(L*Y/(u/1e3),-B,B),Ur=Math.abs(mr)/(vt*Y);return{easing:E.easing,duration:1e3*Ur,amount:mr*(Ur/2)}}class mg extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B,Y={}){const vt=rl(E.getCanvasContainer(),B),mr=E.unproject(vt);super(u,o.extend({point:vt,lngLat:mr,originalEvent:B},Y)),this._defaultPrevented=!1,this.target=E}}class ky extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B){const Y=u==="touchend"?B.changedTouches:B.touches,vt=ah(E.getCanvasContainer(),Y),mr=vt.map(Gn=>E.unproject(Gn)),Ur=vt.reduce((Gn,$s,el,Wu)=>Gn.add($s.div(Wu.length)),new o.Point(0,0));super(u,{points:vt,point:Ur,lngLats:mr,lngLat:E.unproject(Ur),originalEvent:B}),this._defaultPrevented=!1}}class J0 extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,E,B){super(u,{originalEvent:B}),this._defaultPrevented=!1}}class D0{constructor(u,E){this._map=u,this._clickTolerance=E.clickTolerance}reset(){this._mousedownPos=void 0}wheel(u){return this._firePreventable(new J0(u.type,this._map,u))}mousedown(u,E){return this._mousedownPos=E,this._firePreventable(new mg(u.type,this._map,u))}mouseup(u){this._map.fire(new mg(u.type,this._map,u))}preclick(u){const E=o.extend({},u);E.type="preclick",this._map.fire(new mg(E.type,this._map,E))}click(u,E){this._mousedownPos&&this._mousedownPos.dist(E)>=this._clickTolerance||(this.preclick(u),this._map.fire(new mg(u.type,this._map,u)))}dblclick(u){return this._firePreventable(new mg(u.type,this._map,u))}mouseover(u){this._map.fire(new mg(u.type,this._map,u))}mouseout(u){this._map.fire(new mg(u.type,this._map,u))}touchstart(u){return this._firePreventable(new ky(u.type,this._map,u))}touchmove(u){this._map.fire(new ky(u.type,this._map,u))}touchend(u){this._map.fire(new ky(u.type,this._map,u))}touchcancel(u){this._map.fire(new ky(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class p0{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(u){this._map.fire(new mg(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mg("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new mg(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uv{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=E.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,E){this.isEnabled()&&u.shiftKey&&u.button===0&&(Fn(),this._startPos=this._lastPos=E,this._active=!0)}mousemoveWindow(u,E){if(!this._active)return;const B=E,Y=this._startPos,vt=this._lastPos;if(!Y||!vt||vt.equals(B)||!this._box&&B.dist(Y)<this._clickTolerance)return;this._lastPos=B,this._box||(this._box=nt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));const mr=Math.min(Y.x,B.x),Ur=Math.max(Y.x,B.x),Gn=Math.min(Y.y,B.y),$s=Math.max(Y.y,B.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${mr}px,${Gn}px)`,this._box.style.width=Ur-mr+"px",this._box.style.height=$s-Gn+"px")})}mouseupWindow(u,E){if(!this._active)return;const B=this._startPos,Y=E;if(B&&u.button===0){if(this.reset(),Co(),B.x!==Y.x||B.y!==Y.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:u})),{cameraAnimation:vt=>vt.fitScreenCoordinates(B,Y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",u)}}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tl(),delete this._startPos,delete this._lastPos}_fireEvent(u,E){return this._map.fire(new o.Event(u,{originalEvent:E}))}}function Q0(L,u){const E={};for(let B=0;B<L.length;B++)E[L[B].identifier]=u[B];return E}class Qy{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(u,E,B){(this.centroid||B.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=u.timeStamp),B.length===this.numTouches&&(this.centroid=function(Y){const vt=new o.Point(0,0);for(const mr of Y)vt._add(mr);return vt.div(Y.length)}(E),this.touches=Q0(B,E)))}touchmove(u,E,B){if(this.aborted||!this.centroid)return;const Y=Q0(B,E);for(const vt in this.touches){const mr=Y[vt];(!mr||mr.dist(this.touches[vt])>30)&&(this.aborted=!0)}}touchend(u,E,B){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),B.length===0){const Y=!this.aborted&&this.centroid;if(this.reset(),Y)return Y}}}class ev{constructor(u){this.singleTap=new Qy(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(u,E,B){this.singleTap.touchstart(u,E,B)}touchmove(u,E,B){this.singleTap.touchmove(u,E,B)}touchend(u,E,B){const Y=this.singleTap.touchend(u,E,B);if(Y){const vt=u.timeStamp-this.lastTime<500,mr=!this.lastTap||this.lastTap.dist(Y)<30;if(vt&&mr||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=Y,this.count===this.numTaps)return this.reset(),Y}}}class n1{constructor(){this._zoomIn=new ev({numTouches:1,numTaps:2}),this._zoomOut=new ev({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,E,B){this._zoomIn.touchstart(u,E,B),this._zoomOut.touchstart(u,E,B)}touchmove(u,E,B){this._zoomIn.touchmove(u,E,B),this._zoomOut.touchmove(u,E,B)}touchend(u,E,B){const Y=this._zoomIn.touchend(u,E,B),vt=this._zoomOut.touchend(u,E,B);return Y?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:mr=>mr.easeTo({duration:300,zoom:mr.getZoom()+1,around:mr.unproject(Y)},{originalEvent:u})}):vt?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:mr=>mr.easeTo({duration:300,zoom:mr.getZoom()-1,around:mr.unproject(vt)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vv={0:1,2:2};class m0{constructor(u){this.reset(),this._clickTolerance=u.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(u,E){return!1}_move(u,E){return{}}mousedown(u,E){if(this._lastPoint)return;const B=ch(u);this._correctButton(u,B)&&(this._lastPoint=E,this._eventButton=B)}mousemoveWindow(u,E){const B=this._lastPoint;if(B){if(u.preventDefault(),this._eventButton!=null&&function(Y,vt){const mr=Vv[vt];return Y.buttons===void 0||(Y.buttons&mr)!==mr}(u,this._eventButton))this.reset();else if(this._moved||!(E.dist(B)<this._clickTolerance))return this._moved=!0,this._lastPoint=E,this._move(B,E)}}mouseupWindow(u){this._lastPoint&&ch(u)===this._eventButton&&(this._moved&&Co(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vv extends m0{mousedown(u,E){super.mousedown(u,E),this._lastPoint&&(this._active=!0)}_correctButton(u,E){return E===0&&!u.ctrlKey}_move(u,E){return{around:E,panDelta:E.sub(u)}}}class tv extends m0{_correctButton(u,E){return E===0&&u.ctrlKey||E===2}_move(u,E){const B=.8*(E.x-u.x);if(B)return this._active=!0,{bearingDelta:B}}contextmenu(u){u.preventDefault()}}class xv extends m0{_correctButton(u,E){return E===0&&u.ctrlKey||E===2}_move(u,E){const B=-.5*(E.y-u.y);if(B)return this._active=!0,{pitchDelta:B}}contextmenu(u){u.preventDefault()}}class my{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._minTouches=1,this._clickTolerance=E.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(u,E,B){return this._calculateTransform(u,E,B)}touchmove(u,E,B){if(this._active&&!(B.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(B.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return u.cancelable&&u.preventDefault(),this._calculateTransform(u,E,B)}}touchend(u,E,B){this._calculateTransform(u,E,B),this._active&&B.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,E,B){B.length>0&&(this._active=!0);const Y=Q0(B,E),vt=new o.Point(0,0),mr=new o.Point(0,0);let Ur=0;for(const $s in Y){const el=Y[$s],Wu=this._touches[$s];Wu&&(vt._add(el),mr._add(el.sub(Wu)),Ur++,Y[$s]=el)}if(this._touches=Y,Ur<this._minTouches||!mr.mag())return;const Gn=mr.div(Ur);return this._sum._add(Gn),this._sum.mag()<this._clickTolerance?void 0:{around:vt.div(Ur),panDelta:Gn}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=nt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class g0{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(u){}_move(u,E,B){return{}}touchstart(u,E,B){this._firstTwoTouches||B.length<2||(this._firstTwoTouches=[B[0].identifier,B[1].identifier],this._start([E[0],E[1]]))}touchmove(u,E,B){const Y=this._firstTwoTouches;if(!Y)return;u.preventDefault();const[vt,mr]=Y,Ur=L0(B,E,vt),Gn=L0(B,E,mr);if(!Ur||!Gn)return;const $s=this._aroundCenter?null:Ur.add(Gn).div(2);return this._move([Ur,Gn],$s,u)}touchend(u,E,B){if(!this._firstTwoTouches)return;const[Y,vt]=this._firstTwoTouches,mr=L0(B,E,Y),Ur=L0(B,E,vt);mr&&Ur||(this._active&&Co(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function L0(L,u,E){for(let B=0;B<L.length;B++)if(L[B].identifier===E)return u[B]}function bv(L,u){return Math.log(L/u)/Math.LN2}class wv extends g0{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,E){const B=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(bv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bv(this._distance,B),pinchAround:E}}}function Ev(L,u){return 180*L.angleWith(u)/Math.PI}class o1 extends g0{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,E){const B=this._vector;if(this._vector=u[0].sub(u[1]),B&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ev(this._vector,B),pinchAround:E}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const E=25/(Math.PI*this._minDiameter)*360,B=this._startVector;if(!B)return!1;const Y=Ev(u,B);return Math.abs(Y)<E}}function Dy(L){return Math.abs(L.y)>Math.abs(L.x)}class Sv extends g0{constructor(u){super(),this._map=u}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(u){this._lastPoints=u,Dy(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,E,B){const Y=this._lastPoints;if(!Y)return;const vt=u[0].sub(Y[0]),mr=u[1].sub(Y[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&B.touches.length<3||(this._valid=this.gestureBeginsVertically(vt,mr,B.timeStamp),!this._valid)?void 0:(this._lastPoints=u,this._active=!0,{pitchDelta:(vt.y+mr.y)/2*-.5})}gestureBeginsVertically(u,E,B){if(this._valid!==void 0)return this._valid;const Y=u.mag()>=2,vt=E.mag()>=2;if(!Y&&!vt)return;if(!Y||!vt)return this._firstMove==null&&(this._firstMove=B),B-this._firstMove<100&&void 0;const mr=u.y>0==E.y>0;return Dy(u)&&Dy(E)&&mr}}const Gv={panStep:100,bearingStep:15,pitchStep:10};class jv{constructor(){const u=Gv;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let E=0,B=0,Y=0,vt=0,mr=0;switch(u.keyCode){case 61:case 107:case 171:case 187:E=1;break;case 189:case 109:case 173:E=-1;break;case 37:u.shiftKey?B=-1:(u.preventDefault(),vt=-1);break;case 39:u.shiftKey?B=1:(u.preventDefault(),vt=1);break;case 38:u.shiftKey?Y=1:(u.preventDefault(),mr=-1);break;case 40:u.shiftKey?Y=-1:(u.preventDefault(),mr=1);break;default:return}return this._rotationDisabled&&(B=0,Y=0),{cameraAnimation:Ur=>{const Gn=Ur.getZoom();Ur.easeTo({duration:300,easeId:"keyboardHandler",easing:a1,zoom:E?Math.round(Gn)+E*(u.shiftKey?2:1):Gn,bearing:Ur.getBearing()+B*this._bearingStep,pitch:Ur.getPitch()+Y*this._pitchStep,offset:[-vt*this._panStep,-mr*this._panStep],center:Ur.getCenter()},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function a1(L){return L*(2-L)}const e0=4.000244140625;class iv{constructor(u,E){this._map=u,this._el=u.getCanvasContainer(),this._handler=E,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(u){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(u.ctrlKey||u.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let E=u.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const B=o.exported.now(),Y=B-(this._lastWheelEventTime||0);this._lastWheelEventTime=B,E!==0&&E%e0==0?this._type="wheel":E!==0&&Math.abs(E)<4?this._type="trackpad":Y>400?(this._type=null,this._lastValue=E,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(Y*E)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,E+=this._lastValue)),u.shiftKey&&E&&(E/=4),this._type&&(this._lastWheelEvent=u,this._delta-=E,this._active||this._start(u)),u.preventDefault()}_onTimeout(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const E=rl(this._el,u);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:E,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._map.transform;this._type==="wheel"&&u.projection.wrap&&(u._center.lng>=180||u._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const E=()=>u._terrainEnabled()&&this._aroundCoord?u.computeZoomRelativeTo(this._aroundCoord):u.zoom;if(this._delta!==0){const Gn=this._type==="wheel"&&Math.abs(this._delta)>e0?this._wheelZoomRate:this._defaultZoomRate;let $s=2/(1+Math.exp(-Math.abs(this._delta*Gn)));this._delta<0&&$s!==0&&($s=1/$s);const el=E(),Wu=Math.pow(2,el),dh=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):Wu;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(dh*$s))),this._type==="wheel"&&(this._startZoom=el,this._easing=this._smoothOutEasing(200)),this._delta=0}const B=typeof this._targetZoom=="number"?this._targetZoom:E(),Y=this._startZoom,vt=this._easing;let mr,Ur=!1;if(this._type==="wheel"&&Y&&vt){const Gn=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),$s=vt(Gn);mr=o.number(Y,B,$s),Gn<1?this._frameId||(this._frameId=!0):Ur=!0}else mr=B,Ur=!0;return this._active=!0,Ur&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Ur,zoomDelta:mr-E(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let E=o.ease;if(this._prevEase){const B=this._prevEase,Y=(o.exported.now()-B.start)/B.duration,vt=B.easing(Y+.01)-B.easing(Y),mr=.27/Math.sqrt(vt*vt+1e-4)*.01,Ur=Math.sqrt(.0729-mr*mr);E=o.bezier(mr,Ur,.25,1)}return this._prevEase={start:o.exported.now(),duration:u,easing:E},E}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=nt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class R0{constructor(u,E){this._clickZoom=u,this._tapZoom=E}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(u,E){return u.preventDefault(),{cameraAnimation:B=>{B.easeTo({duration:300,zoom:B.getZoom()+(u.shiftKey?-1:1),around:B.unproject(E)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class s1{constructor(){this._tap=new ev({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(u,E,B){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?B.length>0&&(this._swipePoint=E[0],this._swipeTouch=B[0].identifier):this._tap.touchstart(u,E,B))}touchmove(u,E,B){if(this._tapTime){if(this._swipePoint){if(B[0].identifier!==this._swipeTouch)return;const Y=E[0],vt=Y.y-this._swipePoint.y;return this._swipePoint=Y,u.preventDefault(),this._active=!0,{zoomDelta:vt/128}}}else this._tap.touchmove(u,E,B)}touchend(u,E,B){this._tapTime?this._swipePoint&&B.length===0&&this.reset():this._tap.touchend(u,E,B)&&(this._tapTime=u.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rv{constructor(u,E,B){this._el=u,this._mousePan=E,this._touchPan=B}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Q1{constructor(u,E,B){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=E,this._mousePitch=B}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ex{constructor(u,E,B,Y){this._el=u,this._touchZoom=E,this._touchRotate=B,this._tapDragZoom=Y,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const B_=L=>L.zoom||L.drag||L.pitch||L.rotate;class T1 extends o.Event{}class _0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(u,E){const B=o.sub([],E,u);this.radius=o.length(B[2]<0?o.div([],B,this.constants):[B[0],B[1],0])}projectRay(u){o.div(u,u,this.constants),o.normalize(u,u),o.mul$1(u,u,this.constants);const E=o.scale$2([],u,this.radius);if(E[2]>0){const B=o.scale$2([],[0,0,1],o.dot(E,[0,0,1])),Y=o.scale$2([],o.normalize([],[E[0],E[1],0]),this.radius),vt=o.add([],E,o.scale$2([],o.sub([],o.add([],Y,B),E),2));E[0]=vt[0],E[1]=vt[1]}return E}}function he(L){return L.panDelta&&L.panDelta.mag()||L.zoomDelta||L.bearingDelta||L.pitchDelta}class g{constructor(u,E){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pg(u),this._bearingSnap=E.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new _0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(E),o.bindAll(["handleEvent","handleWindowEvent"],this);const B=this._el;this._listeners=[[B,"touchstart",{passive:!0}],[B,"touchmove",{passive:!1}],[B,"touchend",void 0],[B,"touchcancel",void 0],[B,"mousedown",void 0],[B,"mousemove",void 0],[B,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[B,"mouseover",void 0],[B,"mouseout",void 0],[B,"dblclick",void 0],[B,"click",void 0],[B,"keydown",{capture:!1}],[B,"keyup",void 0],[B,"wheel",{passive:!1}],[B,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[Y,vt,mr]of this._listeners)Y.addEventListener(vt,Y===o.window.document?this.handleWindowEvent:this.handleEvent,mr)}destroy(){for(const[u,E,B]of this._listeners)u.removeEventListener(E,u===o.window.document?this.handleWindowEvent:this.handleEvent,B)}_addDefaultHandlers(u){const E=this._map,B=E.getCanvasContainer();this._add("mapEvent",new D0(E,u));const Y=E.boxZoom=new Uv(E,u);this._add("boxZoom",Y);const vt=new n1,mr=new jg;E.doubleClickZoom=new R0(mr,vt),this._add("tapZoom",vt),this._add("clickZoom",mr);const Ur=new s1;this._add("tapDragZoom",Ur);const Gn=E.touchPitch=new Sv(E);this._add("touchPitch",Gn);const $s=new tv(u),el=new xv(u);E.dragRotate=new Q1(u,$s,el),this._add("mouseRotate",$s,["mousePitch"]),this._add("mousePitch",el,["mouseRotate"]);const Wu=new vv(u),dh=new my(E,u);E.dragPan=new rv(B,Wu,dh),this._add("mousePan",Wu),this._add("touchPan",dh,["touchZoom","touchRotate"]);const gh=new o1,Eh=new wv;E.touchZoomRotate=new ex(B,Eh,gh,Ur),this._add("touchRotate",gh,["touchPan","touchZoom"]),this._add("touchZoom",Eh,["touchPan","touchRotate"]),this._add("blockableMapEvent",new p0(E));const yh=E.scrollZoom=new iv(E,this);this._add("scrollZoom",yh,["mousePan"]);const Ih=E.keyboard=new jv;this._add("keyboard",Ih);for(const Qu of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])u.interactive&&u[Qu]&&E[Qu].enable(u[Qu])}_add(u,E,B){this._handlers.push({handlerName:u,handler:E,allowed:B}),this._handlersById[u]=E}stop(u){if(!this._updatingCamera){for(const{handler:E}of this._handlers)E.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!B_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(u,E,B){for(const Y in u)if(Y!==B&&(!E||E.indexOf(Y)<0))return!0;return!1}handleWindowEvent(u){this.handleEvent(u,`${u.type}Window`)}_getMapTouches(u){const E=[];for(const B of u)this._el.contains(B.target)&&E.push(B);return E}handleEvent(u,E){this._updatingCamera=!0;const B=u.type==="renderFrame",Y=B?void 0:u,vt={needsRenderFrame:!1},mr={},Ur={},Gn=u.touches?this._getMapTouches(u.touches):void 0,$s=Gn?ah(this._el,Gn):B?void 0:rl(this._el,u);for(const{handlerName:dh,handler:gh,allowed:Eh}of this._handlers){if(!gh.isEnabled())continue;let yh;this._blockedByActive(Ur,Eh,dh)?gh.reset():gh[E||u.type]&&(yh=gh[E||u.type](u,$s,Gn),this.mergeHandlerResult(vt,mr,yh,dh,Y),yh&&yh.needsRenderFrame&&this._triggerRenderFrame()),(yh||gh.isActive())&&(Ur[dh]=gh)}const el={};for(const dh in this._previousActiveHandlers)Ur[dh]||(el[dh]=Y);this._previousActiveHandlers=Ur,(Object.keys(el).length||he(vt))&&(this._changes.push([vt,mr,el]),this._triggerRenderFrame()),(Object.keys(Ur).length||he(vt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Wu}=vt;Wu&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Wu(this._map))}mergeHandlerResult(u,E,B,Y,vt){if(!B)return;o.extend(u,B);const mr={handlerName:Y,originalEvent:B.originalEvent||vt};B.zoomDelta!==void 0&&(E.zoom=mr),B.panDelta!==void 0&&(E.drag=mr),B.pitchDelta!==void 0&&(E.pitch=mr),B.bearingDelta!==void 0&&(E.rotate=mr)}_applyChanges(){const u={},E={},B={};for(const[Y,vt,mr]of this._changes)Y.panDelta&&(u.panDelta=(u.panDelta||new o.Point(0,0))._add(Y.panDelta)),Y.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+Y.zoomDelta),Y.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+Y.bearingDelta),Y.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+Y.pitchDelta),Y.around!==void 0&&(u.around=Y.around),Y.aroundCoord!==void 0&&(u.aroundCoord=Y.aroundCoord),Y.pinchAround!==void 0&&(u.pinchAround=Y.pinchAround),Y.noInertia&&(u.noInertia=Y.noInertia),o.extend(E,vt),o.extend(B,mr);this._updateMapTransform(u,E,B),this._changes=[]}_updateMapTransform(u,E,B){const Y=this._map,vt=Y.transform,mr=bh=>[bh.x,bh.y,bh.z];if((bh=>{const kh=this._eventsInProgress.drag;return kh&&!this._handlersById[kh.handlerName].isActive()})()&&!he(u)){const bh=vt.zoom;vt.cameraElevationReference="sea",vt.recenterOnTerrain(),vt.cameraElevationReference="ground",bh!==vt.zoom&&this._map._update(!0)}if(vt._isCameraConstrained&&Y._stop(!0),!he(u))return void this._fireEvents(E,B,!0);let{panDelta:Ur,zoomDelta:Gn,bearingDelta:$s,pitchDelta:el,around:Wu,aroundCoord:dh,pinchAround:gh}=u;vt._isCameraConstrained&&(Gn>0&&(Gn=0),vt._isCameraConstrained=!1),gh!==void 0&&(Wu=gh),(Gn||(bh=>E[bh]&&!this._eventsInProgress[bh])("drag"))&&Wu&&(this._dragOrigin=mr(vt.pointCoordinate3D(Wu)),this._trackingEllipsoid.setup(vt._camera.position,this._dragOrigin)),vt.cameraElevationReference="sea",Y._stop(!0),Wu=Wu||Y.transform.centerPoint,$s&&(vt.bearing+=$s),el&&(vt.pitch+=el),vt._updateCameraState();const Eh=[0,0,0];if(Ur)if(vt.projection.name==="mercator"){const bh=this._trackingEllipsoid.projectRay(vt.screenPointToMercatorRay(Wu).dir),kh=this._trackingEllipsoid.projectRay(vt.screenPointToMercatorRay(Wu.sub(Ur)).dir);Eh[0]=kh[0]-bh[0],Eh[1]=kh[1]-bh[1]}else{const bh=vt.pointCoordinate(Wu);if(vt.projection.name==="globe"){Ur=Ur.rotate(-vt.angle);const kh=vt._pixelsPerMercatorPixel/vt.worldSize;Eh[0]=-Ur.x*o.mercatorScale(o.latFromMercatorY(bh.y))*kh,Eh[1]=-Ur.y*o.mercatorScale(vt.center.lat)*kh}else{const kh=vt.pointCoordinate(Wu.sub(Ur));bh&&kh&&(Eh[0]=kh.x-bh.x,Eh[1]=kh.y-bh.y)}}const yh=vt.zoom,Ih=[0,0,0];if(Gn){const bh=mr(dh||vt.pointCoordinate3D(Wu)),kh={dir:o.normalize([],o.sub([],bh,vt._camera.position))};if(kh.dir[2]<0){const Oh=vt.zoomDeltaToMovement(bh,Gn);o.scale$2(Ih,kh.dir,Oh)}}const Qu=o.add(Eh,Eh,Ih);vt._translateCameraConstrained(Qu),Gn&&Math.abs(vt.zoom-yh)>1e-4&&vt.recenterOnTerrain(),vt.cameraElevationReference="ground",this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(E,B,!0)}_fireEvents(u,E,B){const Y=B_(this._eventsInProgress),vt=B_(u),mr={};for(const el in u){const{originalEvent:Wu}=u[el];this._eventsInProgress[el]||(mr[`${el}start`]=Wu),this._eventsInProgress[el]=u[el]}!Y&&vt&&this._fireEvent("movestart",vt.originalEvent);for(const el in mr)this._fireEvent(el,mr[el]);vt&&this._fireEvent("move",vt.originalEvent);for(const el in u){const{originalEvent:Wu}=u[el];this._fireEvent(el,Wu)}const Ur={};let Gn;for(const el in this._eventsInProgress){const{handlerName:Wu,originalEvent:dh}=this._eventsInProgress[el];this._handlersById[Wu].isActive()||(delete this._eventsInProgress[el],Gn=E[Wu]||dh,Ur[`${el}end`]=Gn)}for(const el in Ur)this._fireEvent(el,Ur[el]);const $s=B_(this._eventsInProgress);if(B&&(Y||vt)&&!$s){this._updatingCamera=!0;const el=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Wu=dh=>dh!==0&&-this._bearingSnap<dh&&dh<this._bearingSnap;el?(Wu(el.bearing||this._map.getBearing())&&(el.bearing=0),this._map.easeTo(el,{originalEvent:Gn})):(this._map.fire(new o.Event("moveend",{originalEvent:Gn})),Wu(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(u,E){this._map.fire(new o.Event(u,E?{originalEvent:E}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(u=>{this._frameId=void 0,this.handleEvent(new T1("renderFrame",{timeStamp:u})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const A="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class X extends o.Evented{constructor(u,E){super(),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=E.bearingSnap,this._respectPrefersReducedMotion=E.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(u,E){return this.jumpTo({center:u},E)}panBy(u,E,B){return u=o.Point.convert(u).mult(-1),this.panTo(this.transform.center,o.extend({offset:u},E),B)}panTo(u,E,B){return this.easeTo(o.extend({center:u},E),B)}getZoom(){return this.transform.zoom}setZoom(u,E){return this.jumpTo({zoom:u},E),this}zoomTo(u,E,B){return this.easeTo(o.extend({zoom:u},E),B)}zoomIn(u,E){return this.zoomTo(this.getZoom()+1,u,E),this}zoomOut(u,E){return this.zoomTo(this.getZoom()-1,u,E),this}getBearing(){return this.transform.bearing}setBearing(u,E){return this.jumpTo({bearing:u},E),this}getPadding(){return this.transform.padding}setPadding(u,E){return this.jumpTo({padding:u},E),this}rotateTo(u,E,B){return this.easeTo(o.extend({bearing:u},E),B)}resetNorth(u,E){return this.rotateTo(0,o.extend({duration:1e3},u),E),this}resetNorthPitch(u,E){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},u),E),this}snapToNorth(u,E){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,E):this}getPitch(){return this.transform.pitch}setPitch(u,E){return this.jumpTo({pitch:u},E),this}cameraForBounds(u,E){u=o.LngLatBounds.convert(u);const B=E&&E.bearing||0,Y=E&&E.pitch||0,vt=u.getNorthWest(),mr=u.getSouthEast();return this._cameraForBounds(this.transform,vt,mr,B,Y,E)}_extendCameraOptions(u){const E={top:0,bottom:0,right:0,left:0};if(typeof(u=o.extend({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const B=u.padding;u.padding={top:B,bottom:B,right:B,left:B}}return u.padding=o.extend(E,u.padding),u}_minimumAABBFrustumDistance(u,E){const B=E.max[0]-E.min[0],Y=E.max[1]-E.min[1];return B/Y>u.aspect?B/(2*Math.tan(.5*u.fovX)*u.aspect):Y/(2*Math.tan(.5*u.fovY)*u.aspect)}_cameraForBoundsOnGlobe(u,E,B,Y,vt,mr){const Ur=u.clone(),Gn=this._extendCameraOptions(mr);Ur.bearing=Y,Ur.pitch=vt;const $s=o.LngLat.convert(E),el=o.LngLat.convert(B),Wu=.5*($s.lat+el.lat),dh=.5*($s.lng+el.lng),gh=o.latLngToECEF(Wu,dh),Eh=o.normalize([],gh),yh=o.normalize([],o.cross([],Eh,[0,1,0])),Ih=o.cross([],yh,Eh),Qu=[yh[0],yh[1],yh[2],0,Ih[0],Ih[1],Ih[2],0,Eh[0],Eh[1],Eh[2],0,0,0,0,1],bh=[gh,o.latLngToECEF($s.lat,$s.lng),o.latLngToECEF(el.lat,$s.lng),o.latLngToECEF(el.lat,el.lng),o.latLngToECEF($s.lat,el.lng),o.latLngToECEF(Wu,$s.lng),o.latLngToECEF(Wu,el.lng),o.latLngToECEF($s.lat,dh),o.latLngToECEF(el.lat,dh)];let kh=o.Aabb.fromPoints(bh.map(Pf=>[o.dot(yh,Pf),o.dot(Ih,Pf),o.dot(Eh,Pf)]));const Oh=o.transformMat4([],kh.center,Qu);o.squaredLength(Oh)===0&&o.set(Oh,0,0,1),o.normalize(Oh,Oh),o.scale$2(Oh,Oh,o.GLOBE_RADIUS),Ur.center=o.ecefToLatLng(Oh);const rd=Ur.getWorldToCameraMatrix(),sd=o.invert(new Float64Array(16),rd);kh=o.Aabb.applyTransform(kh,o.multiply([],rd,Qu)),o.transformMat4(Oh,Oh,rd);const ld=.5*(kh.max[2]-kh.min[2]),dd=this._minimumAABBFrustumDistance(Ur,kh),ud=o.scale$2([],[0,0,1],ld),md=o.add(ud,Oh,ud),Af=dd+(Ur.pitch===0?0:o.distance(Oh,md)),Td=Ur.globeCenterInViewSpace,Gd=o.sub([],Oh,[Td[0],Td[1],Td[2]]);o.normalize(Gd,Gd),o.scale$2(Gd,Gd,Af);const Od=o.add([],Oh,Gd);o.transformMat4(Od,Od,sd);const Lf=o.earthRadius/o.GLOBE_RADIUS,Dd=o.length(Od),yf=o.mercatorZfromAltitude(Math.max(Dd*Lf-o.earthRadius,Number.EPSILON),0),zf=Math.min(Ur.zoomFromMercatorZAdjusted(yf),Gn.maxZoom);return zf>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(Ur.setProjection({name:"mercator"}),Ur.zoom=zf,this._cameraForBounds(Ur,E,B,Y,vt,mr)):{center:Ur.center,zoom:zf,bearing:Y,pitch:vt}}queryTerrainElevation(u,E){const B=this.transform.elevation;return B?(E=o.extend({},{exaggerated:!0},E),B.getAtPoint(o.MercatorCoordinate.fromLngLat(u),null,E.exaggerated)):null}_cameraForBounds(u,E,B,Y,vt,mr){if(u.projection.name==="globe")return this._cameraForBoundsOnGlobe(u,E,B,Y,vt,mr);const Ur=u.clone(),Gn=this._extendCameraOptions(mr),$s=Ur.padding;Ur.bearing=Y,Ur.pitch=vt;const el=o.LngLat.convert(E),Wu=o.LngLat.convert(B),dh=new o.LngLat(el.lng,Wu.lat),gh=new o.LngLat(Wu.lng,el.lat),Eh=Ur.project(el),yh=Ur.project(Wu),Ih=this.queryTerrainElevation(el),Qu=this.queryTerrainElevation(Wu),bh=this.queryTerrainElevation(dh),kh=this.queryTerrainElevation(gh),Oh=[[Eh.x,Eh.y,Math.min(Ih||0,Qu||0,bh||0,kh||0)],[yh.x,yh.y,Math.max(Ih||0,Qu||0,bh||0,kh||0)]];let rd=o.Aabb.fromPoints(Oh);const sd=Ur.getWorldToCameraMatrix(),ld=o.invert(new Float64Array(16),sd);rd=o.Aabb.applyTransform(rd,sd);const dd=o.sub([],rd.max,rd.min),ud=$s.left||0,md=$s.right||0,Af=$s.bottom||0,Td=$s.top||0,{left:Gd,right:Od,top:Lf,bottom:Dd}=Gn.padding,yf=.5*(ud+md),zf=.5*(Td+Af),Pf=Math.min(Ur.scaleZoom(Ur.scale*Math.min((Ur.width-(ud+md+Gd+Od))/dd[0],(Ur.height-(Af+Td+Dd+Lf))/dd[1])),Gn.maxZoom),Vf=Ur.scale/Ur.zoomScale(Pf);rd=new o.Aabb([rd.min[0]-(Gd+yf)*Vf,rd.min[1]-(Dd+zf)*Vf,rd.min[2]],[rd.max[0]+(Od+yf)*Vf,rd.max[1]+(Lf+zf)*Vf,rd.max[2]]);const Lp=.5*dd[2],Mp=this._minimumAABBFrustumDistance(Ur,rd),fp=[0,0,1,0];o.transformMat4$1(fp,fp,sd),o.normalize$2(fp,fp);const Fp=o.scale$2([],fp,Mp+Lp),cm=o.add([],rd.center,Fp),Jp=(typeof Gn.offset.x=="number"&&typeof Gn.offset.y=="number"?new o.Point(Gn.offset.x,Gn.offset.y):o.Point.convert(Gn.offset)).rotate(-o.degToRad(Y));rd.center[0]-=Jp.x*Vf,rd.center[1]+=Jp.y*Vf,o.transformMat4(rd.center,rd.center,ld),o.transformMat4(cm,cm,ld);const kp=[rd.center[0],rd.center[1],cm[2]*Ur.pixelsPerMeter];o.scale$2(kp,kp,1/Ur.worldSize);const _m=o.lngFromMercatorX(kp[0]),Lm=o.latFromMercatorY(kp[1]),Rm=Math.min(Ur._zoomFromMercatorZ(kp[2]),Gn.maxZoom),Vm=new o.LngLat(_m,Lm);return Ur.mercatorFromTransition&&Rm<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(Ur.setProjection({name:"globe"}),Ur.zoom=Rm,this._cameraForBounds(Ur,E,B,Y,vt,mr)):{center:Vm,zoom:Rm,bearing:Y,pitch:vt}}fitBounds(u,E,B){const Y=this.cameraForBounds(u,E);return this._fitInternal(Y,E,B)}fitScreenCoordinates(u,E,B,Y,vt){const mr=o.Point.convert(u),Ur=o.Point.convert(E),Gn=new o.Point(Math.min(mr.x,Ur.x),Math.min(mr.y,Ur.y)),$s=new o.Point(Math.max(mr.x,Ur.x),Math.max(mr.y,Ur.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(mr,Ur))return this;const el=this.transform.pointLocation3D(Gn),Wu=this.transform.pointLocation3D($s),dh=this.transform.pointLocation3D(new o.Point(Gn.x,$s.y)),gh=this.transform.pointLocation3D(new o.Point($s.x,Gn.y)),Eh=[Math.min(el.lng,Wu.lng,dh.lng,gh.lng),Math.min(el.lat,Wu.lat,dh.lat,gh.lat)],yh=[Math.max(el.lng,Wu.lng,dh.lng,gh.lng),Math.max(el.lat,Wu.lat,dh.lat,gh.lat)],Ih=Y&&Y.pitch?Y.pitch:this.getPitch(),Qu=this._cameraForBounds(this.transform,Eh,yh,B,Ih,Y);return this._fitInternal(Qu,Y,vt)}_fitInternal(u,E,B){return u?(delete(E=o.extend(u,E)).padding,E.linear?this.easeTo(E,B):this.flyTo(E,B)):this}jumpTo(u,E){this.stop();const B=u.preloadOnly?this.transform.clone():this.transform;let Y=!1,vt=!1,mr=!1;return"zoom"in u&&B.zoom!==+u.zoom&&(Y=!0,B.zoom=+u.zoom),u.center!==void 0&&(B.center=o.LngLat.convert(u.center)),"bearing"in u&&B.bearing!==+u.bearing&&(vt=!0,B.bearing=+u.bearing),"pitch"in u&&B.pitch!==+u.pitch&&(mr=!0,B.pitch=+u.pitch),u.padding==null||B.isPaddingEqual(u.padding)||(B.padding=u.padding),u.preloadOnly?(this._preloadTiles(B),this):(this.fire(new o.Event("movestart",E)).fire(new o.Event("move",E)),Y&&this.fire(new o.Event("zoomstart",E)).fire(new o.Event("zoom",E)).fire(new o.Event("zoomend",E)),vt&&this.fire(new o.Event("rotatestart",E)).fire(new o.Event("rotate",E)).fire(new o.Event("rotateend",E)),mr&&this.fire(new o.Event("pitchstart",E)).fire(new o.Event("pitch",E)).fire(new o.Event("pitchend",E)),this.fire(new o.Event("moveend",E)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(A),this.transform.getFreeCameraOptions()}setFreeCameraOptions(u,E){const B=this.transform;if(!B.projection.supportsFreeCamera)return o.warnOnce(A),this;this.stop();const Y=B.zoom,vt=B.pitch,mr=B.bearing;B.setFreeCameraOptions(u);const Ur=Y!==B.zoom,Gn=vt!==B.pitch,$s=mr!==B.bearing;return this.fire(new o.Event("movestart",E)).fire(new o.Event("move",E)),Ur&&this.fire(new o.Event("zoomstart",E)).fire(new o.Event("zoom",E)).fire(new o.Event("zoomend",E)),$s&&this.fire(new o.Event("rotatestart",E)).fire(new o.Event("rotate",E)).fire(new o.Event("rotateend",E)),Gn&&this.fire(new o.Event("pitchstart",E)).fire(new o.Event("pitch",E)).fire(new o.Event("pitchend",E)),this.fire(new o.Event("moveend",E)),this}easeTo(u,E){this._stop(!1,u.easeId),((u=o.extend({offset:[0,0],duration:500,easing:o.ease},u)).animate===!1||this._prefersReducedMotion(u))&&(u.duration=0);const B=this.transform,Y=this.getZoom(),vt=this.getBearing(),mr=this.getPitch(),Ur=this.getPadding(),Gn="zoom"in u?+u.zoom:Y,$s="bearing"in u?this._normalizeBearing(u.bearing,vt):vt,el="pitch"in u?+u.pitch:mr,Wu="padding"in u?u.padding:B.padding,dh=o.Point.convert(u.offset);let gh,Eh,yh;if(B.projection.name==="globe"){const ud=o.MercatorCoordinate.fromLngLat(B.center),md=dh.rotate(-B.angle);ud.x+=md.x/B.worldSize,ud.y+=md.y/B.worldSize;const Af=ud.toLngLat(),Td=o.LngLat.convert(u.center||Af);this._normalizeCenter(Td),gh=B.centerPoint.add(md),Eh=new o.Point(ud.x,ud.y).mult(B.worldSize),yh=new o.Point(o.mercatorXfromLng(Td.lng),o.mercatorYfromLat(Td.lat)).mult(B.worldSize).sub(Eh)}else{gh=B.centerPoint.add(dh);const ud=B.pointLocation(gh),md=o.LngLat.convert(u.center||ud);this._normalizeCenter(md),Eh=B.project(ud),yh=B.project(md).sub(Eh)}const Ih=B.zoomScale(Gn-Y);let Qu,bh;u.around&&(Qu=o.LngLat.convert(u.around),bh=B.locationPoint(Qu));const kh=this._zooming||Gn!==Y,Oh=this._rotating||vt!==$s,rd=this._pitching||el!==mr,sd=!B.isPaddingEqual(Wu),ld=ud=>md=>{if(kh&&(ud.zoom=o.number(Y,Gn,md)),Oh&&(ud.bearing=o.number(vt,$s,md)),rd&&(ud.pitch=o.number(mr,el,md)),sd&&(ud.interpolatePadding(Ur,Wu,md),gh=ud.centerPoint.add(dh)),Qu)ud.setLocationAtPoint(Qu,bh);else{const Af=ud.zoomScale(ud.zoom-Y),Td=Gn>Y?Math.min(2,Ih):Math.max(.5,Ih),Gd=Math.pow(Td,1-md),Od=ud.unproject(Eh.add(yh.mult(md*Gd)).mult(Af));ud.setLocationAtPoint(ud.renderWorldCopies?Od.wrap():Od,gh)}return u.preloadOnly||this._fireMoveEvents(E),ud};if(u.preloadOnly){const ud=this._emulate(ld,u.duration,B);return this._preloadTiles(ud),this}const dd={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=kh,this._rotating=Oh,this._pitching=rd,this._padding=sd,this._easeId=u.easeId,this._prepareEase(E,u.noMoveStart,dd),this._ease(ld(B),ud=>{B.recenterOnTerrain(),this._afterEase(E,ud)},u),this}_prepareEase(u,E,B={}){this._moving=!0,this.transform.cameraElevationReference="sea",E||B.moving||this.fire(new o.Event("movestart",u)),this._zooming&&!B.zooming&&this.fire(new o.Event("zoomstart",u)),this._rotating&&!B.rotating&&this.fire(new o.Event("rotatestart",u)),this._pitching&&!B.pitching&&this.fire(new o.Event("pitchstart",u))}_fireMoveEvents(u){this.fire(new o.Event("move",u)),this._zooming&&this.fire(new o.Event("zoom",u)),this._rotating&&this.fire(new o.Event("rotate",u)),this._pitching&&this.fire(new o.Event("pitch",u))}_afterEase(u,E){if(this._easeId&&E&&this._easeId===E)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const B=this._zooming,Y=this._rotating,vt=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,B&&this.fire(new o.Event("zoomend",u)),Y&&this.fire(new o.Event("rotateend",u)),vt&&this.fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u))}flyTo(u,E){if(this._prefersReducedMotion(u)){const Pf=o.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pf,E)}this.stop(),u=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},u);const B=this.transform,Y=this.getZoom(),vt=this.getBearing(),mr=this.getPitch(),Ur=this.getPadding(),Gn="zoom"in u?o.clamp(+u.zoom,B.minZoom,B.maxZoom):Y,$s="bearing"in u?this._normalizeBearing(u.bearing,vt):vt,el="pitch"in u?+u.pitch:mr,Wu="padding"in u?u.padding:B.padding,dh=B.zoomScale(Gn-Y),gh=o.Point.convert(u.offset);let Eh=B.centerPoint.add(gh);const yh=B.pointLocation(Eh),Ih=o.LngLat.convert(u.center||yh);this._normalizeCenter(Ih);const Qu=B.project(yh),bh=B.project(Ih).sub(Qu);let kh=u.curve;const Oh=Math.max(B.width,B.height),rd=Oh/dh,sd=bh.mag();if("minZoom"in u){const Pf=o.clamp(Math.min(u.minZoom,Y,Gn),B.minZoom,B.maxZoom),Vf=Oh/B.zoomScale(Pf-Y);kh=Math.sqrt(Vf/sd*2)}const ld=kh*kh;function dd(Pf){const Vf=(rd*rd-Oh*Oh+(Pf?-1:1)*ld*ld*sd*sd)/(2*(Pf?rd:Oh)*ld*sd);return Math.log(Math.sqrt(Vf*Vf+1)-Vf)}function ud(Pf){return(Math.exp(Pf)-Math.exp(-Pf))/2}function md(Pf){return(Math.exp(Pf)+Math.exp(-Pf))/2}const Af=dd(0);let Td=function(Pf){return md(Af)/md(Af+kh*Pf)},Gd=function(Pf){return Oh*((md(Af)*(ud(Vf=Af+kh*Pf)/md(Vf))-ud(Af))/ld)/sd;var Vf},Od=(dd(1)-Af)/kh;if(Math.abs(sd)<1e-6||!isFinite(Od)){if(Math.abs(Oh-rd)<1e-6)return this.easeTo(u,E);const Pf=rd<Oh?-1:1;Od=Math.abs(Math.log(rd/Oh))/kh,Gd=function(){return 0},Td=function(Vf){return Math.exp(Pf*kh*Vf)}}u.duration="duration"in u?+u.duration:1e3*Od/("screenSpeed"in u?+u.screenSpeed/kh:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0);const Lf=vt!==$s,Dd=el!==mr,yf=!B.isPaddingEqual(Wu),zf=Pf=>Vf=>{const Lp=Vf*Od,Mp=1/Td(Lp);Pf.zoom=Vf===1?Gn:Y+Pf.scaleZoom(Mp),Lf&&(Pf.bearing=o.number(vt,$s,Vf)),Dd&&(Pf.pitch=o.number(mr,el,Vf)),yf&&(Pf.interpolatePadding(Ur,Wu,Vf),Eh=Pf.centerPoint.add(gh));const fp=Vf===1?Ih:Pf.unproject(Qu.add(bh.mult(Gd(Lp))).mult(Mp));return Pf.setLocationAtPoint(Pf.renderWorldCopies?fp.wrap():fp,Eh),Pf._updateCameraOnTerrain(),u.preloadOnly||this._fireMoveEvents(E),Pf};if(u.preloadOnly){const Pf=this._emulate(zf,u.duration,B);return this._preloadTiles(Pf),this}return this._zooming=!0,this._rotating=Lf,this._pitching=Dd,this._padding=yf,this._prepareEase(E,!1),this._ease(zf(B),()=>this._afterEase(E),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,E){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const B=this._onEaseEnd;this._onEaseEnd=void 0,B.call(this,E)}if(!u){const B=this.handlers;B&&B.stop(!1)}return this}_ease(u,E,B){B.animate===!1||B.duration===0?(u(1),E()):(this._easeStart=o.exported.now(),this._easeOptions=B,this._onEaseFrame=u,this._onEaseEnd=E,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const u=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),E=this._onEaseFrame;E&&E(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(u,E){u=o.wrap(u,-180,180);const B=Math.abs(u-E);return Math.abs(u-360-E)<B&&(u-=360),Math.abs(u+360-E)<B&&(u+=360),u}_normalizeCenter(u){const E=this.transform;if(!E.renderWorldCopies||E.maxBounds)return;const B=u.lng-E.center.lng;u.lng+=B>180?-360:B<-180?360:0}_prefersReducedMotion(u){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(u&&u.essential)}_emulate(u,E,B){const Y=Math.ceil(15*E/1e3),vt=[],mr=u(B.clone());for(let Ur=0;Ur<=Y;Ur++){const Gn=mr(Ur/Y);vt.push(Gn.clone())}return vt}}class _e{constructor(u={}){this.options=u,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(u){const E=this.options&&this.options.compact;return this._map=u,this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=nt("button","mapboxgl-ctrl-attrib-button",this._container),nt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=nt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),E&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),E===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(u,E){const B=this._map._getUIString(`AttributionControl.${E}`);u.setAttribute("aria-label",B),u.removeAttribute("title"),u.firstElementChild&&u.firstElementChild.setAttribute("title",B)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));const E=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(u){const B=E.reduce((Y,vt,mr)=>(vt.value&&(Y+=`${vt.key}=${vt.value}${mr<E.length-1?"&":""}`),Y),"?");u.href=`${o.config.FEEDBACK_URL}/${B}#${Ng(this._map,!0)}`,u.rel="noopener nofollow",this._setElementTitle(u,"MapFeedback")}}_updateData(u){!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let u=[];if(this._map.style.stylesheet){const Y=this._map.style.stylesheet;this.styleOwner=Y.owner,this.styleId=Y.id}const E=this._map.style._sourceCaches;for(const Y in E){const vt=E[Y];if(vt.used){const mr=vt.getSource();mr.attribution&&u.indexOf(mr.attribution)<0&&u.push(mr.attribution)}}u.sort((Y,vt)=>Y.length-vt.length),u=u.filter((Y,vt)=>{for(let mr=vt+1;mr<u.length;mr++)if(u[mr].indexOf(Y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=[...this.options.customAttribution,...u]:u.unshift(this.options.customAttribution));const B=u.join(" | ");B!==this._attribHTML&&(this._attribHTML=B,u.length?(this._innerContainer.innerHTML=B,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ft{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(u){this._map=u,this._container=nt("div","mapboxgl-ctrl");const E=nt("a","mapboxgl-ctrl-logo");return E.target="_blank",E.rel="noopener nofollow",E.href="https://www.mapbox.com/",E.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),E.setAttribute("rel","noopener nofollow"),this._container.appendChild(E),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const u=this._map.style._sourceCaches;if(Object.entries(u).length===0)return!0;for(const E in u){const B=u[E].getSource();if(B.hasOwnProperty("mapbox_logo")&&!B.mapbox_logo)return!1}return!0}_updateCompact(){const u=this._container.children;if(u.length){const E=u[0];this._map.getCanvasContainer().offsetWidth<250?E.classList.add("mapboxgl-compact"):E.classList.remove("mapboxgl-compact")}}}class Xr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const E=++this._id;return this._queue.push({callback:u,id:E,cancelled:!1}),E}remove(u){const E=this._currentlyRunning,B=E?this._queue.concat(E):this._queue;for(const Y of B)if(Y.id===u)return void(Y.cancelled=!0)}run(u=0){const E=this._currentlyRunning=this._queue;this._queue=[];for(const B of E)if(!B.cancelled&&(B.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function as(L,u,E){if(L=new o.LngLat(L.lng,L.lat),u){const B=new o.LngLat(L.lng-360,L.lat),Y=new o.LngLat(L.lng+360,L.lat),vt=360*Math.ceil(Math.abs(L.lng-E.center.lng)/360),mr=E.locationPoint(L).distSqr(u),Ur=u.x<0||u.y<0||u.x>E.width||u.y>E.height;E.locationPoint(B).distSqr(u)<mr&&(Ur||Math.abs(B.lng-E.center.lng)<vt)?L=B:E.locationPoint(Y).distSqr(u)<mr&&(Ur||Math.abs(Y.lng-E.center.lng)<vt)&&(L=Y)}for(;Math.abs(L.lng-E.center.lng)>180;){const B=E.locationPoint(L);if(B.x>=0&&B.y>=0&&B.x<=E.width&&B.y<=E.height)break;L.lng>E.center.lng?L.lng-=360:L.lng+=360}return L}const cs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class us extends o.Evented{constructor(u,E){if(super(),(u instanceof o.window.HTMLElement||E)&&(u=o.extend({element:u},E)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=u&&u.occludedOpacity||.2,u&&u.element)this._element=u.element,this._offset=o.Point.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=nt("div");const Y=41,vt=27,mr=ze("svg",{display:"block",height:Y*this._scale+"px",width:vt*this._scale+"px",viewBox:`0 0 ${vt} ${Y}`},this._element),Ur=ze("radialGradient",{id:"shadowGradient"},ze("defs",{},mr));ze("stop",{offset:"10%","stop-opacity":.4},Ur),ze("stop",{offset:"100%","stop-opacity":.05},Ur),ze("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},mr),ze("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},mr),ze("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},mr),ze("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},mr),this._offset=o.Point.convert(u&&u.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const B=this._element.classList;for(const Y in cs)B.remove(`mapboxgl-marker-anchor-${Y}`);B.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(u){return u===this._map||(this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._updateMoving),u.on("moveend",this._update),u.on("remove",this._clearFadeTimer),u._addMarker(this),this.setDraggable(this._draggable),this._update(),u.on("click",this._onMapClick)),this}remove(){const u=this._map;return u&&(u.off("click",this._onMapClick),u.off("move",this._updateMoving),u.off("moveend",this._update),u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler),u.off("mouseup",this._onUp),u.off("touchend",this._onUp),u.off("mousemove",this._onMove),u.off("touchmove",this._onMove),u.off("remove",this._clearFadeTimer),u._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const Y=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[Y,-1*(38.1-13.5+Y)],"bottom-right":[-Y,-1*(38.1-13.5+Y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,u._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(u){const E=u.code,B=u.charCode||u.keyCode;E!=="Space"&&E!=="Enter"&&B!==32&&B!==13||this.togglePopup()}_onMapClick(u){const E=u.originalEvent.target,B=this._element;this._popup&&(E===B||B.contains(E))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const u=this._popup;return u?(u.isOpen()?(u.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(u.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const u=this._map,E=this._pos;if(!u||!E)return!1;const B=u.unproject(E),Y=u.getFreeCameraOptions();if(!Y.position)return!1;const vt=Y.position.toLngLat();return vt.distanceTo(B)<.9*vt.distanceTo(this._lngLat)}_evaluateOpacity(){const u=this._map;if(!u)return;const E=this._pos;if(!E||E.x<0||E.x>u.transform.width||E.y<0||E.y>u.transform.height)return void this._clearFadeTimer();const B=u.unproject(E);let Y;u._showingGlobe()&&o.isLngLatBehindGlobe(u.transform,this._lngLat)?Y=0:(Y=1-u._queryFogOpacity(B),u.transform._terrainEnabled()&&u.getTerrain()&&this._behindTerrain()&&(Y*=this._occludedOpacity)),this._element.style.opacity=`${Y}`,this._element.style.pointerEvents=Y>0?"auto":"none",this._popup&&this._popup._setOpacity(Y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const u=this._pos;if(!u||!this._map)return;const E=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${u.x}px,${u.y}px)
            ${cs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${E.x}px,${E.y}px)
        `}_calculateXYTransform(){const u=this._pos,E=this._map,B=this.getPitchAlignment();if(!E||!u||B!=="map")return"";if(!E._showingGlobe()){const Gn=E.getPitch();return Gn?`rotateX(${Gn}deg)`:""}const Y=o.radToDeg(o.globeTiltAtLngLat(E.transform,this._lngLat)),vt=u.sub(o.globeCenterToScreenPoint(E.transform)),mr=Math.abs(vt.x)+Math.abs(vt.y);if(mr===0)return"";const Ur=Y/mr;return`rotateX(${-vt.y*Ur}deg) rotateY(${vt.x*Ur}deg)`}_calculateZTransform(){const u=this._pos,E=this._map;if(!E||!u)return"";let B=0;const Y=this.getRotationAlignment();if(Y==="map")if(E._showingGlobe()){const vt=E.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),mr=E.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(vt);B=o.radToDeg(Math.atan2(mr.y,mr.x))-90}else B=-E.getBearing();else if(Y==="horizon"){const vt=o.smoothstep(4,6,E.getZoom()),mr=o.globeCenterToScreenPoint(E.transform);mr.y+=vt*E.transform.height;const Ur=u.sub(mr),Gn=o.radToDeg(Math.atan2(Ur.y,Ur.x));B=(Gn>90?Gn-270:Gn+90)*(1-vt)}return B+=this._rotation,B?`rotateZ(${B}deg)`:""}_update(u){o.window.cancelAnimationFrame(this._updateFrameId);const E=this._map;E&&(E.transform.renderWorldCopies&&(this._lngLat=as(this._lngLat,this._pos,E.transform)),this._pos=E.project(this._lngLat),u===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),E._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(E._showingGlobe()||E.getTerrain()||E.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(u){return this._offset=o.Point.convert(u),this._update(),this}_onMove(u){const E=this._map;if(!E)return;const B=this._pointerdownPos,Y=this._positionDelta;if(B&&Y){if(!this._isDragging){const vt=this._clickTolerance||E._clickTolerance;if(u.point.dist(B)<vt)return;this._isDragging=!0}this._pos=u.point.sub(Y),this._lngLat=E.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const u=this._map;u&&(u.off("mousemove",this._onMove),u.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(u){const E=this._map,B=this._pos;E&&B&&this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(B),this._pointerdownPos=u.point,this._state="pending",E.on("mousemove",this._onMove),E.on("touchmove",this._onMove),E.once("mouseup",this._onUp),E.once("touchend",this._onUp))}setDraggable(u){this._draggable=!!u;const E=this._map;return E&&(u?(E.on("mousedown",this._addDragHandler),E.on("touchstart",this._addDragHandler)):(E.off("mousedown",this._addDragHandler),E.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(u){return this._occludedOpacity=u||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const th={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},eh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ph(L=new o.Point(0,0),u="bottom"){if(typeof L=="number"){const E=Math.round(Math.sqrt(.5*Math.pow(L,2)));switch(u){case"top":return new o.Point(0,L);case"top-left":return new o.Point(E,E);case"top-right":return new o.Point(-E,E);case"bottom":return new o.Point(0,-L);case"bottom-left":return new o.Point(E,-E);case"bottom-right":return new o.Point(-E,-E);case"left":return new o.Point(L,0);case"right":return new o.Point(-L,0)}return new o.Point(0,0)}return L instanceof o.Point||Array.isArray(L)?o.Point.convert(L):o.Point.convert(L[u]||[0,0])}class Rh{constructor(u){this.jumpTo(u)}getValue(u){if(u<=this._startTime)return this._start;if(u>=this._endTime)return this._end;const E=o.easeCubicInOut((u-this._startTime)/(this._endTime-this._startTime));return this._start*(1-E)+this._end*E}isEasing(u){return u>=this._startTime&&u<=this._endTime}jumpTo(u){this._startTime=-1/0,this._endTime=-1/0,this._start=u,this._end=u}easeTo(u,E,B){this._start=this.getValue(E),this._end=u,this._startTime=E,this._endTime=E+B}}const Bh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ch={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},ed={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ed{constructor(u,E,B=!1){this._clickTolerance=10,this.element=E,this.mouseRotate=new tv({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,B&&(this.mousePitch=new xv({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),E.addEventListener("mousedown",this.mousedown),E.addEventListener("touchstart",this.touchstart,{passive:!1}),E.addEventListener("touchmove",this.touchmove),E.addEventListener("touchend",this.touchend),E.addEventListener("touchcancel",this.reset)}down(u,E){this.mouseRotate.mousedown(u,E),this.mousePitch&&this.mousePitch.mousedown(u,E),Fn()}move(u,E){const B=this.map,Y=this.mouseRotate.mousemoveWindow(u,E),vt=Y&&Y.bearingDelta;if(vt&&B.setBearing(B.getBearing()+vt),this.mousePitch){const mr=this.mousePitch.mousemoveWindow(u,E),Ur=mr&&mr.pitchDelta;Ur&&B.setPitch(B.getPitch()+Ur)}}off(){const u=this.element;u.removeEventListener("mousedown",this.mousedown),u.removeEventListener("touchstart",this.touchstart,{passive:!1}),u.removeEventListener("touchmove",this.touchmove),u.removeEventListener("touchend",this.touchend),u.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tl(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(u){this.down(o.extend({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),rl(this.element,u)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(u){this.move(u,rl(this.element,u))}mouseup(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()}touchstart(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ah(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>u.preventDefault()},this._startPos))}touchmove(u){u.targetTouches.length!==1?this.reset():(this._lastPos=ah(this.element,u.targetTouches)[0],this.move({preventDefault:()=>u.preventDefault()},this._lastPos))}touchend(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _d={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qh={maxWidth:100,unit:"metric"},Md={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Nd={version:o.version,supported:C,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends X{constructor(L){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(L=o.extend({},Ch,L)).minZoom!=null&&L.maxZoom!=null&&L.minZoom>L.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(L.minPitch!=null&&L.maxPitch!=null&&L.minPitch>L.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(L.minPitch!=null&&L.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(L.maxPitch!=null&&L.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(L.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(L.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new py(L.minZoom,L.maxZoom,L.minPitch,L.maxPitch,L.renderWorldCopies),L),this._interactive=L.interactive,this._minTileCacheSize=L.minTileCacheSize,this._maxTileCacheSize=L.maxTileCacheSize,this._failIfMajorPerformanceCaveat=L.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=L.preserveDrawingBuffer,this._antialias=L.antialias,this._useWebGL2=L.useWebGL2,this._trackResize=L.trackResize,this._bearingSnap=L.bearingSnap,this._refreshExpiredTiles=L.refreshExpiredTiles,this._fadeDuration=L.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=L.crossSourceCollisions,this._collectResourceTiming=L.collectResourceTiming,this._optimizeForTerrain=L.optimizeForTerrain,this._language=this._parseLanguage(L.language),this._worldview=L.worldview,this._renderTaskQueue=new Xr,this._domRenderTaskQueue=new Xr,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Bh,L.locale),this._clickTolerance=L.clickTolerance,this._cooperativeGestures=L.cooperativeGestures,this._performanceMetricsCollection=L.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Rh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(L.transformRequest,L.accessToken,L.testMode),this._silenceAuthErrors=!!L.testMode,typeof L.container=="string"){if(this._container=o.window.document.getElementById(L.container),!this._container)throw new Error(`Container '${L.container}' not found.`)}else{if(!(L.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=L.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),L.maxBounds&&this.setMaxBounds(L.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new g(this,L),this._localFontFamily=L.localFontFamily,this._localIdeographFontFamily=L.localIdeographFontFamily,L.style&&this.setStyle(L.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),L.projection&&this.setProjection(L.projection),this._hash=L.hash&&new yv(typeof L.hash=="string"&&L.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:L.center,zoom:L.zoom,bearing:L.bearing,pitch:L.pitch}),L.bounds&&(this.resize(),this.fitBounds(L.bounds,o.extend({},L.fitBoundsOptions,{duration:0})))),this.resize(),L.attributionControl&&this.addControl(new _e({customAttribution:L.customAttribution})),this._logoControl=new Ft,this.addControl(this._logoControl,L.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.Event(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(L,u){if(u===void 0&&(u=L.getDefaultPosition?L.getDefaultPosition():"top-right"),!L||!L.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const E=L.onAdd(this);this._controls.push(L);const B=this._controlPositions[u];return u.indexOf("bottom")!==-1?B.insertBefore(E,B.firstChild):B.appendChild(E),this}removeControl(L){if(!L||!L.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(L);return u>-1&&this._controls.splice(u,1),L.onRemove(this),this}hasControl(L){return this._controls.indexOf(L)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(L){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const u=!this._moving;return u&&this.fire(new o.Event("movestart",L)).fire(new o.Event("move",L)),this.fire(new o.Event("resize",L)),u&&this.fire(new o.Event("moveend",L)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(L){return this.transform.setMaxBounds(o.LngLatBounds.convert(L)),this._update()}setMinZoom(L){if((L=L??-2)>=-2&&L<=this.transform.maxZoom)return this.transform.minZoom=L,this._update(),this.getZoom()<L?this.setZoom(L):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(L){if((L=L??22)>=this.transform.minZoom)return this.transform.maxZoom=L,this._update(),this.getZoom()>L?this.setZoom(L):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(L){if((L=L??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(L>=0&&L<=this.transform.maxPitch)return this.transform.minPitch=L,this._update(),this.getPitch()<L?this.setPitch(L):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(L){if((L=L??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(L>=this.transform.minPitch)return this.transform.maxPitch=L,this._update(),this.getPitch()>L?this.setPitch(L):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(L){return this.transform.renderWorldCopies=L,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(L){return L==="auto"?o.window.navigator.language:Array.isArray(L)?L.length===0?void 0:L.map(u=>u==="auto"?o.window.navigator.language:u):L}setLanguage(L){const u=this._parseLanguage(L);if(!this.style||u===this._language)return this;this._language=u,this.style._reloadSources();for(const E of this._controls)E._setLanguage&&E._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(L){return this.style&&L!==this._worldview?(this._worldview=L,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(L){return this._lazyInitEmptyStyle(),L?typeof L=="string"&&(L={name:L}):L=null,this._useExplicitProjection=!!L,this._prioritizeAndUpdateProjection(L,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const L=this.transform,u=L.projection.name;let E;u==="globe"&&L.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(L.setMercatorFromTransition(),E=!0):u==="mercator"&&L.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(L.setProjection({name:"globe"}),E=!0),E&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(L,u){return this._updateProjection(L||u||{name:"mercator"})}_updateProjection(L){let u;if(u=L.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(L),this.style.applyProjectionUpdate(),u){this.painter.clearBackgroundTiles();for(const E in this.style._sourceCaches)this.style._sourceCaches[E].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(L){return this.transform.locationPoint3D(o.LngLat.convert(L))}unproject(L){return this.transform.pointLocation3D(o.Point.convert(L))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(L,u,E){if(L==="mouseenter"||L==="mouseover"){let B=!1;const Y=mr=>{const Ur=u.filter($s=>this.getLayer($s)),Gn=Ur.length?this.queryRenderedFeatures(mr.point,{layers:Ur}):[];Gn.length?B||(B=!0,E.call(this,new mg(L,this,mr.originalEvent,{features:Gn}))):B=!1},vt=()=>{B=!1};return{layers:new Set(u),listener:E,delegates:{mousemove:Y,mouseout:vt}}}if(L==="mouseleave"||L==="mouseout"){let B=!1;const Y=mr=>{const Ur=u.filter(Gn=>this.getLayer(Gn));(Ur.length?this.queryRenderedFeatures(mr.point,{layers:Ur}):[]).length?B=!0:B&&(B=!1,E.call(this,new mg(L,this,mr.originalEvent)))},vt=mr=>{B&&(B=!1,E.call(this,new mg(L,this,mr.originalEvent)))};return{layers:new Set(u),listener:E,delegates:{mousemove:Y,mouseout:vt}}}{const B=Y=>{const vt=u.filter(Ur=>this.getLayer(Ur)),mr=vt.length?this.queryRenderedFeatures(Y.point,{layers:vt}):[];mr.length&&(Y.features=mr,E.call(this,Y),delete Y.features)};return{layers:new Set(u),listener:E,delegates:{[L]:B}}}}on(L,u,E){if(E===void 0)return super.on(L,u);Array.isArray(u)||(u=[u]);const B=this._createDelegatedListener(L,u,E);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[L]=this._delegatedListeners[L]||[],this._delegatedListeners[L].push(B);for(const Y in B.delegates)this.on(Y,B.delegates[Y]);return this}once(L,u,E){if(E===void 0)return super.once(L,u);Array.isArray(u)||(u=[u]);const B=this._createDelegatedListener(L,u,E);for(const Y in B.delegates)this.once(Y,B.delegates[Y]);return this}off(L,u,E){if(E===void 0)return super.off(L,u);u=new Set(Array.isArray(u)?u:[u]);const B=(vt,mr)=>{if(vt.size!==mr.size)return!1;for(const Ur of vt)if(!mr.has(Ur))return!1;return!0},Y=this._delegatedListeners?this._delegatedListeners[L]:void 0;return Y&&(vt=>{for(let mr=0;mr<vt.length;mr++){const Ur=vt[mr];if(Ur.listener===E&&B(Ur.layers,u)){for(const Gn in Ur.delegates)this.off(Gn,Ur.delegates[Gn]);return vt.splice(mr,1),this}}})(Y),this}queryRenderedFeatures(L,u){return this.style?(u!==void 0||L===void 0||L instanceof o.Point||Array.isArray(L)||(u=L,L=void 0),this.style.queryRenderedFeatures(L=L||[[0,0],[this.transform.width,this.transform.height]],u=u||{},this.transform)):[]}querySourceFeatures(L,u){return this.style.querySourceFeatures(L,u)}isPointOnSurface(L){const{name:u}=this.transform.projection;return u!=="globe"&&u!=="mercator"&&o.warnOnce(`${u} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(L))}setStyle(L,u){return(u=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},u)).diff!==!1&&u.localIdeographFontFamily===this._localIdeographFontFamily&&u.localFontFamily===this._localFontFamily&&this.style&&L?(this._diffStyle(L,u),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._localFontFamily=u.localFontFamily,this._updateStyle(L,u))}_getUIString(L){const u=this._locale[L];if(u==null)throw new Error(`Missing UI string '${L}'`);return u}_updateStyle(L,u){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),L&&(this.style=new Wp(this,u||{}),this.style.setEventedParent(this,{style:this.style}),typeof L=="string"?this.style.loadURL(L):this.style.loadJSON(L)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wp(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(L,u){if(typeof L=="string"){const E=this._requestManager.normalizeStyleURL(L),B=this._requestManager.transformRequest(E,o.ResourceType.Style);o.getJSON(B,(Y,vt)=>{Y?this.fire(new o.ErrorEvent(Y)):vt&&this._updateDiff(vt,u)})}else typeof L=="object"&&this._updateDiff(L,u)}_updateDiff(L,u){try{this.style.setState(L)&&this._update(!0)}catch(E){o.warnOnce(`Unable to perform style diff: ${E.message||E.error||E}.  Rebuilding the style from scratch.`),this._updateStyle(L,u)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(L,u){return this._lazyInitEmptyStyle(),this.style.addSource(L,u),this._update(!0)}isSourceLoaded(L){return!!this.style&&this.style._isSourceCacheLoaded(L)}areTilesLoaded(){const L=this.style&&this.style._sourceCaches;for(const u in L){const E=L[u]._tiles;for(const B in E){const Y=E[B];if(Y.state!=="loaded"&&Y.state!=="errored")return!1}}return!0}addSourceType(L,u,E){this._lazyInitEmptyStyle(),this.style.addSourceType(L,u,E)}removeSource(L){return this.style.removeSource(L),this._updateTerrain(),this._update(!0)}getSource(L){return this.style.getSource(L)}addImage(L,u,{pixelRatio:E=1,sdf:B=!1,stretchX:Y,stretchY:vt,content:mr}={}){if(this._lazyInitEmptyStyle(),u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap){const{width:Ur,height:Gn,data:$s}=o.exported.getImageData(u);this.style.addImage(L,{data:new o.RGBAImage({width:Ur,height:Gn},$s),pixelRatio:E,stretchX:Y,stretchY:vt,content:mr,sdf:B,version:0})}else if(u.width===void 0||u.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:Ur,height:Gn}=u,$s=u;this.style.addImage(L,{data:new o.RGBAImage({width:Ur,height:Gn},new Uint8Array($s.data)),pixelRatio:E,stretchX:Y,stretchY:vt,content:mr,sdf:B,version:0,userImage:$s}),$s.onAdd&&$s.onAdd(this,L)}}updateImage(L,u){const E=this.style.getImage(L);if(!E)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const B=u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap?o.exported.getImageData(u):u,{width:Y,height:vt}=B;Y!==void 0&&vt!==void 0?Y===E.data.width&&vt===E.data.height?(E.data.replace(B.data,!(u instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&u instanceof o.window.ImageBitmap)),this.style.updateImage(L,E)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${Y}, ${vt})
                must be that same as the previous version of the image
                (${E.data.width}, ${E.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(L){return L?!!this.style.getImage(L):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(L){this.style.removeImage(L)}loadImage(L,u){o.getImage(this._requestManager.transformRequest(L,o.ResourceType.Image),(E,B)=>{u(E,B instanceof o.window.HTMLImageElement?o.exported.getImageData(B):B)})}listImages(){return this.style.listImages()}addLayer(L,u){return this._lazyInitEmptyStyle(),this.style.addLayer(L,u),this._update(!0)}moveLayer(L,u){return this.style.moveLayer(L,u),this._update(!0)}removeLayer(L){return this.style.removeLayer(L),this._update(!0)}getLayer(L){return this.style.getLayer(L)}setLayerZoomRange(L,u,E){return this.style.setLayerZoomRange(L,u,E),this._update(!0)}setFilter(L,u,E={}){return this.style.setFilter(L,u,E),this._update(!0)}getFilter(L){return this.style.getFilter(L)}setPaintProperty(L,u,E,B={}){return this.style.setPaintProperty(L,u,E,B),this._update(!0)}getPaintProperty(L,u){return this.style.getPaintProperty(L,u)}setLayoutProperty(L,u,E,B={}){return this.style.setLayoutProperty(L,u,E,B),this._update(!0)}getLayoutProperty(L,u){return this.style.getLayoutProperty(L,u)}setLight(L,u={}){return this._lazyInitEmptyStyle(),this.style.setLight(L,u),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(L){return this._lazyInitEmptyStyle(),!L&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(L),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(L){return this._lazyInitEmptyStyle(),this.style.setFog(L),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(L){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(L),this.transform):0}setFeatureState(L,u){return this.style.setFeatureState(L,u),this._update()}removeFeatureState(L,u){return this.style.removeFeatureState(L,u),this._update()}getFeatureState(L){return this.style.getFeatureState(L)}_updateContainerDimensions(){if(!this._container)return;const L=this._container.getBoundingClientRect().width||400,u=this._container.getBoundingClientRect().height||300;let E,B,Y,vt=this._container;for(;vt&&(!B||!Y);){const mr=o.window.getComputedStyle(vt).transform;mr&&mr!=="none"&&(E=mr.match(/matrix.*\((.+)\)/)[1].split(", "),E[0]&&E[0]!=="0"&&E[0]!=="1"&&(B=E[0]),E[3]&&E[3]!=="0"&&E[3]!=="1"&&(Y=E[3])),vt=vt.parentElement}this._containerWidth=B?Math.abs(L/B):L,this._containerHeight=Y?Math.abs(u/Y):u}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const L=this._container;L.classList.add("mapboxgl-map"),(this._missingCSSCanary=nt("div","mapboxgl-canary",L)).style.visibility="hidden",this._detectMissingCSS();const u=this._canvasContainer=nt("div","mapboxgl-canvas-container",L);this._interactive&&u.classList.add("mapboxgl-interactive"),this._canvas=nt("canvas","mapboxgl-canvas",u),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const E=this._controlContainer=nt("div","mapboxgl-control-container",L),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Y=>{B[Y]=nt("div",`mapboxgl-ctrl-${Y}`,E)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(L,u){const E=o.exported.devicePixelRatio||1;this._canvas.width=E*Math.ceil(L),this._canvas.height=E*Math.ceil(u),this._canvas.style.width=`${L}px`,this._canvas.style.height=`${u}px`}_addMarker(L){this._markers.push(L)}_removeMarker(L){const u=this._markers.indexOf(L);u!==-1&&this._markers.splice(u,1)}_addPopup(L){this._popups.push(L)}_removePopup(L){const u=this._popups.indexOf(L);u!==-1&&this._popups.splice(u,1)}_setupPainter(){const L=o.extend({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),u=this._useWebGL2&&this._canvas.getContext("webgl2",L),E=u||this._canvas.getContext("webgl",L)||this._canvas.getContext("experimental-webgl",L);E?(this._useWebGL2&&!u&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(E,!0),this.painter=new Ay(E,this.transform,!!u),this.on("data",B=>{B.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(E)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(L){L.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:L}))}_contextRestored(L){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:L}))}_onMapScroll(L){if(L.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(L){return this.style?(this._styleDirty=this._styleDirty||L,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(L){return this._update(),this._renderTaskQueue.add(L)}_cancelRenderFrame(L){this._renderTaskQueue.remove(L)}_requestDomTask(L){!this.loaded()||this.loaded()&&!this.isMoving()?L():this._domRenderTaskQueue.add(L)}_render(L){let u;const E=this.painter.context.extTimerQuery,B=o.exported.now();if(this.listens("gpu-timing-frame")&&(u=E.createQueryEXT(),E.beginQueryEXT(E.TIME_ELAPSED_EXT,u)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(L),this._domRenderTaskQueue.run(L),this._removed)return;this._updateProjectionTransition();const Y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Ur=this.transform.zoom,Gn=this.transform.pitch,$s=o.exported.now(),el=new o.EvaluationParameters(Ur,{now:$s,fadeDuration:Y,pitch:Gn,transition:this.style.getTransition()});this.style.update(el)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let vt=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),vt=this._updateAverageElevation(B),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):vt=this._updateAverageElevation(B),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,Y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:Y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),u){const Ur=o.exported.now()-B;E.endQueryEXT(E.TIME_ELAPSED_EXT,u),setTimeout(()=>{const Gn=E.getQueryObjectEXT(u,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(u),this.fire(new o.Event("gpu-timing-frame",{cpuTime:Ur,gpuTime:Gn})),o.window.performance.mark("frame-gpu",{startTime:B,detail:{gpuTime:Gn}})},50)}if(this.listens("gpu-timing-layer")){const Ur=this.painter.collectGpuTimers();setTimeout(()=>{const Gn=this.painter.queryGpuTimers(Ur);this.fire(new o.Event("gpu-timing-layer",{layerTimes:Gn}))},50)}if(this.listens("gpu-timing-deferred-render")){const Ur=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Gn=this.painter.queryGpuTimeDeferredRender(Ur);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:Gn}))},50)}const mr=this._sourcesDirty||this._styleDirty||this._placementDirty||vt;if(mr||this._repaint)this.triggerRepaint();else{const Ur=!this.isMoving()&&this.loaded();if(Ur&&(vt=this._updateAverageElevation(B,!0)),vt)this.triggerRepaint();else if(this._triggerFrame(!1),Ur&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Gn=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:Gn})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||mr||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(L){for(const u of this._markers)L&&!this.getRenderWorldCopies()&&(u._lngLat=u._lngLat.wrap()),u._update();for(const u of this._popups)!L||this.getRenderWorldCopies()||u._trackPointer||(u._lngLat=u._lngLat.wrap()),u._update()}_updateAverageElevation(L,u=!1){const E=B=>(this.transform.averageElevation=B,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&E(0);if((u||L-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(L)){const B=this.transform.averageElevation;let Y=this.transform.sampleAverageElevation(),vt=!1;this.transform.elevation&&(vt=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(Y)?Y=0:this._averageElevationLastSampledAt=L;const mr=Math.abs(B-Y);if(mr>1){if(this._isInitialLoad||vt)return this._averageElevation.jumpTo(Y),E(Y);this._averageElevation.easeTo(Y,L,300)}else if(mr>1e-4)return this._averageElevation.jumpTo(Y),E(Y)}return!!this._averageElevation.isEasing(L)&&E(this._averageElevation.getValue(L))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,L=>{if(L&&(L.message===o.AUTH_ERR_MSG||L.status===401)){const u=this.painter.context.gl;o.storeAuthState(u,!1),this._logoControl instanceof Ft&&this._logoControl._updateLogo(),u&&u.clear(u.DEPTH_BUFFER_BIT|u.COLOR_BUFFER_BIT|u.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const L=this._isDragging();this.painter.updateTerrain(this.style,L)}_calculateSpeedIndex(){const L=this.painter.canvasCopy(),u=this.painter.getCanvasCopiesAndTimestamps();u.timeStamps.push(performance.now());const E=this.painter.context.gl,B=E.createFramebuffer();function Y(vt){E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,vt,0);const mr=new Uint8Array(E.drawingBufferWidth*E.drawingBufferHeight*4);return E.readPixels(0,0,E.drawingBufferWidth,E.drawingBufferHeight,E.RGBA,E.UNSIGNED_BYTE,mr),mr}return E.bindFramebuffer(E.FRAMEBUFFER,B),this._canvasPixelComparison(Y(L),u.canvasCopies.map(Y),u.timeStamps)}_canvasPixelComparison(L,u,E){let B=E[1]-E[0];const Y=L.length/4;for(let vt=0;vt<u.length;vt++){const mr=u[vt];let Ur=0;for(let Gn=0;Gn<mr.length;Gn+=4)mr[Gn]===L[Gn]&&mr[Gn+1]===L[Gn+1]&&mr[Gn+2]===L[Gn+2]&&mr[Gn+3]===L[Gn+3]&&(Ur+=1);B+=(E[vt+2]-E[vt+1])*(1-Ur/Y)}return B}remove(){this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const L=this.painter.context.gl.getExtension("WEBGL_lose_context");L&&L.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(L){this._renderNextFrame=this._renderNextFrame||L,this.style&&!this._frame&&(this._frame=o.exported.frame(u=>{const E=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,E&&this._render(u)}))}_preloadTiles(L){const u=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(u,(E,B)=>E._preloadTiles(L,B),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(L){this._trackResize&&this.resize({originalEvent:L})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(L){this._showTileBoundaries!==L&&(this._showTileBoundaries=L,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(L){this._showTerrainWireframe!==L&&(this._showTerrainWireframe=L,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(L){this._speedIndexTiming!==L&&(this._speedIndexTiming=L,this._update())}get showPadding(){return!!this._showPadding}set showPadding(L){this._showPadding!==L&&(this._showPadding=L,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(L){this._showCollisionBoxes!==L&&(this._showCollisionBoxes=L,L?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(L){this._showOverdrawInspector!==L&&(this._showOverdrawInspector=L,this._update())}get repaint(){return!!this._repaint}set repaint(L){this._repaint!==L&&(this._repaint=L,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(L){this._vertices=L,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(L){this._showTileAABBs!==L&&(this._showTileAABBs=L,L&&this._update())}_setCacheLimits(L,u){o.setCacheLimits(L,u)}get version(){return o.version}},NavigationControl:class{constructor(L){this.options=o.extend({},ed,L),this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",u=>{this._map&&this._map.zoomIn({},{originalEvent:u})}),nt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",u=>{this._map&&this._map.zoomOut({},{originalEvent:u})}),nt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",u=>{const E=this._map;E&&(this.options.visualizePitch?E.resetNorthPitch({},{originalEvent:u}):E.resetNorth({},{originalEvent:u}))}),this._compassIcon=nt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const L=this._map;if(!L)return;const u=L.getZoom(),E=u===L.getMaxZoom(),B=u===L.getMinZoom();this._zoomInButton.disabled=E,this._zoomOutButton.disabled=B,this._zoomInButton.setAttribute("aria-disabled",E.toString()),this._zoomOutButton.setAttribute("aria-disabled",B.toString())}_rotateCompassArrow(){const L=this._map;if(!L)return;const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(L.transform.pitch*(Math.PI/180)),.5)}) rotateX(${L.transform.pitch}deg) rotateZ(${L.transform.angle*(180/Math.PI)}deg)`:`rotate(${L.transform.angle*(180/Math.PI)}deg)`;L._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(L){return this._map=L,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),L.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&L.on("pitch",this._rotateCompassArrow),L.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ed(L,this._compass,this.options.visualizePitch)),this._container}onRemove(){const L=this._map;L&&(this._container.remove(),this.options.showZoom&&L.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&L.off("pitch",this._rotateCompassArrow),L.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(L,u){const E=nt("button",L,this._container);return E.type="button",E.addEventListener("click",u),E}_setButtonTitle(L,u){if(!this._map)return;const E=this._map._getUIString(`NavigationControl.${u}`);L.setAttribute("aria-label",E),L.firstElementChild&&L.firstElementChild.setAttribute("title",E)}},GeolocateControl:class extends o.Evented{constructor(L){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},_d,L),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=d0(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(L){return this._map=L,this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(L){const u=(E=!!this.options.geolocation)=>{this._supportsGeolocation=E,L(E)};this._supportsGeolocation!==void 0?L(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(E=>u(E.state!=="denied")).catch(()=>u()):u()}_isOutOfMapMaxBounds(L){const u=this._map.getMaxBounds(),E=L.coords;return!!u&&(E.longitude<u.getWest()||E.longitude>u.getEast()||E.latitude<u.getSouth()||E.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(L){if(this._map){if(this._isOutOfMapMaxBounds(L))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",L)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=L,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(L),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(L),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",L)),this._finish()}}_updateCamera(L){const u=new o.LngLat(L.coords.longitude,L.coords.latitude),E=L.coords.accuracy,B=this._map.getBearing(),Y=o.extend({bearing:B},this.options.fitBoundsOptions);this._map.fitBounds(u.toBounds(E),Y,{geolocateSource:!0})}_updateMarker(L){if(L){const u=new o.LngLat(L.coords.longitude,L.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=L.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const L=this._map.transform,u=o.mercatorZfromAltitude(1,L._center.lat)*L.worldSize,E=Math.ceil(2*this._accuracy*u);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(L){if(this._map){if(this.options.trackUserLocation)if(L.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(L.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",L)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(L){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=nt("button","mapboxgl-ctrl-geolocate",this._container),nt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",L===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=nt("div","mapboxgl-user-location"),this._dotElement.appendChild(nt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(nt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new us({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=nt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new us({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(L){this._userLocationDotMarker&&(L.webkitCompassHeading?this._heading=L.webkitCompassHeading:L.absolute===!0&&(this._heading=-1*L.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let L;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(L={maximumAge:6e5,timeout:0},this._noTimeout=!0):(L=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,L),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const L=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(u=>{u==="granted"&&L()}).catch(console.error):L()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_e,ScaleControl:class{constructor(L){this.options=o.extend({},qh,L),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const L=this.options.maxWidth||100,u=this._map,E=u._containerHeight/2,B=u._containerWidth/2-L/2,Y=u.unproject([B,E]),vt=u.unproject([B+L,E]),mr=Y.distanceTo(vt);if(this.options.unit==="imperial"){const Ur=3.2808*mr;Ur>5280?this._setScale(L,Ur/5280,"mile"):this._setScale(L,Ur,"foot")}else this.options.unit==="nautical"?this._setScale(L,mr/1852,"nautical-mile"):mr>=1e3?this._setScale(L,mr/1e3,"kilometer"):this._setScale(L,mr,"meter")}_setScale(L,u,E){this._map._requestDomTask(()=>{const B=function(vt){const mr=Math.pow(10,`${Math.floor(vt)}`.length-1);let Ur=vt/mr;return Ur=Ur>=10?10:Ur>=5?5:Ur>=3?3:Ur>=2?2:Ur>=1?1:function(Gn){const $s=Math.pow(10,Math.ceil(-Math.log(Gn)/Math.LN10));return Math.round(Gn*$s)/$s}(Ur),mr*Ur}(u),Y=B/u;this._container.innerHTML=this._isNumberFormatSupported&&E!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:E}).format(B):`${B}&nbsp;${Md[E]}`,this._container.style.width=L*Y+"px"})}onAdd(L){return this._map=L,this._language=L.getLanguage(),this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",L.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(L){this._language=L,this._update()}setUnit(L){this.options.unit=L,this._update()}},FullscreenControl:class{constructor(L){this._fullscreen=!1,L&&L.container&&(L.container instanceof o.window.HTMLElement?this._container=L.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(L){return this._map=L,this._container||(this._container=this._map.getContainer()),this._controlContainer=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const L=this._fullscreenButton=nt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);nt("span","mapboxgl-ctrl-icon",L).setAttribute("aria-hidden","true"),L.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const L=this._getTitle();this._fullscreenButton.setAttribute("aria-label",L),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",L)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(L){super(),this.options=o.extend(Object.create(th),L),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(L&&L.className?L.className.trim().split(/\s+/):[])}addTo(L){return this._map&&this.remove(),this._map=L,this.options.closeOnClick&&L.on("preclick",this._onClose),this.options.closeOnMove&&L.on("move",this._onClose),L.on("remove",this.remove),this._update(),L._addPopup(this),this._focusFirstElement(),this._trackPointer?(L.on("mousemove",this._onMouseEvent),L.on("mouseup",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")):L.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const L=this._map;return L&&(L.off("move",this._update),L.off("move",this._onClose),L.off("preclick",this._onClose),L.off("click",this._onClose),L.off("remove",this.remove),L.off("mousemove",this._onMouseEvent),L.off("mouseup",this._onMouseEvent),L.off("drag",this._onMouseEvent),L._canvasContainer&&L._canvasContainer.classList.remove("mapboxgl-track-pointer"),L._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(L){this._lngLat=o.LngLat.convert(L),this._pos=null,this._trackPointer=!1,this._update();const u=this._map;return u&&(u.on("move",this._update),u.off("mousemove",this._onMouseEvent),u._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const L=this._map;return L&&(L.off("move",this._update),L.on("mousemove",this._onMouseEvent),L.on("drag",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(L){return this.setDOMContent(o.window.document.createTextNode(L))}setHTML(L){const u=o.window.document.createDocumentFragment(),E=o.window.document.createElement("body");let B;for(E.innerHTML=L;B=E.firstChild,B;)u.appendChild(B);return this.setDOMContent(u)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(L){return this.options.maxWidth=L,this._update(),this}setDOMContent(L){let u=this._content;if(u)for(;u.hasChildNodes();)u.firstChild&&u.removeChild(u.firstChild);else u=this._content=nt("div","mapboxgl-popup-content",this._container||void 0);if(u.appendChild(L),this.options.closeButton){const E=this._closeButton=nt("button","mapboxgl-popup-close-button",u);E.type="button",E.setAttribute("aria-label","Close popup"),E.setAttribute("aria-hidden","true"),E.innerHTML="&#215;",E.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(L){return this._classList.add(L),this._updateClassList(),this}removeClassName(L){return this._classList.delete(L),this._updateClassList(),this}setOffset(L){return this.options.offset=L,this._update(),this}toggleClassName(L){let u;return this._classList.delete(L)?u=!1:(this._classList.add(L),u=!0),this._updateClassList(),u}_onMouseEvent(L){this._update(L.point)}_getAnchor(L){if(this.options.anchor)return this.options.anchor;const u=this._map,E=this._container,B=this._pos;if(!u||!E||!B)return"bottom";const Y=E.offsetWidth,vt=E.offsetHeight,mr=B.x<Y/2,Ur=B.x>u.transform.width-Y/2;if(B.y+L<vt)return mr?"top-left":Ur?"top-right":"top";if(B.y>u.transform.height-vt){if(mr)return"bottom-left";if(Ur)return"bottom-right"}return mr?"left":Ur?"right":"bottom"}_updateClassList(){const L=this._container;if(!L)return;const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),L.className=u.join(" ")}_update(L){const u=this._map,E=this._content;if(!u||!this._lngLat&&!this._trackPointer||!E)return;let B=this._container;if(B||(B=this._container=nt("div","mapboxgl-popup",u.getContainer()),this._tip=nt("div","mapboxgl-popup-tip",B),B.appendChild(E)),this.options.maxWidth&&B.style.maxWidth!==this.options.maxWidth&&(B.style.maxWidth=this.options.maxWidth),u.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=as(this._lngLat,this._pos,u.transform)),!this._trackPointer||L){const Y=this._pos=this._trackPointer&&L?L:u.project(this._lngLat),vt=ph(this.options.offset),mr=this._anchor=this._getAnchor(vt.y),Ur=ph(this.options.offset,mr),Gn=Y.add(Ur).round();u._requestDomTask(()=>{this._container&&mr&&(this._container.style.transform=`${cs[mr]} translate(${Gn.x}px,${Gn.y}px)`)})}if(!this._marker&&u._showingGlobe()){const Y=o.isLngLatBehindGlobe(u.transform,this._lngLat)?0:1;this._setOpacity(Y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const L=this._container.querySelector(eh);L&&L.focus()}_onClose(){this.remove()}_setOpacity(L){this._container&&(this._container.style.opacity=`${L}`),this._content&&(this._content.style.pointerEvents=L?"auto":"none")}},Marker:us,Style:Wp,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:k0,Evented:o.Evented,config:o.config,prewarm:function(){ap().acquire(Fd)},clearPrewarmedResources:function(){const L=up;L&&(L.isPreloaded()&&L.numActive()===1?(L.release(Fd),up=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(L){o.config.ACCESS_TOKEN=L},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(L){o.config.API_URL=L},get workerCount(){return Kf.workerCount},set workerCount(L){Kf.workerCount=L},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(L){o.config.MAX_PARALLEL_IMAGE_REQUESTS=L},clearStorage(L){o.clearTileCache(L)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Nd});var f=a;return f})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);var d2r=Math.PI/180,r2d=180/Math.PI;function tileToBBOX(e){var t=tile2lon(e[0]+1,e[2]),r=tile2lon(e[0],e[2]),n=tile2lat(e[1]+1,e[2]),a=tile2lat(e[1],e[2]);return[r,n,t,a]}function tileToGeoJSON(e){var t=tileToBBOX(e),r={type:"Polygon",coordinates:[[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]]};return r}function tile2lon(e,t){return e/Math.pow(2,t)*360-180}function tile2lat(e,t){var r=Math.PI-2*Math.PI*e/Math.pow(2,t);return r2d*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}function pointToTile(e,t,r){var n=pointToTileFraction(e,t,r);return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n}function getChildren(e){return[[e[0]*2,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2+1,e[2]+1],[e[0]*2,e[1]*2+1,e[2]+1]]}function getParent(e){return[e[0]>>1,e[1]>>1,e[2]-1]}function getSiblings(e){return getChildren(getParent(e))}function hasSiblings(e,t){for(var r=getSiblings(e),n=0;n<r.length;n++)if(!hasTile(t,r[n]))return!1;return!0}function hasTile(e,t){for(var r=0;r<e.length;r++)if(tilesEqual(e[r],t))return!0;return!1}function tilesEqual(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function tileToQuadkey(e){for(var t="",r=e[2];r>0;r--){var n=0,a=1<<r-1;e[0]&a&&n++,e[1]&a&&(n+=2),t+=n.toString()}return t}function quadkeyToTile(e){for(var t=0,r=0,n=e.length,a=n;a>0;a--){var s=1<<a-1,f=+e[n-a];f===1&&(t|=s),f===2&&(r|=s),f===3&&(t|=s,r|=s)}return[t,r,n]}function bboxToTile(e){var t=pointToTile(e[0],e[1],32),r=pointToTile(e[2],e[3],32),n=[t[0],t[1],r[0],r[1]],a=getBboxZoom(n);if(a===0)return[0,0,0];var s=n[0]>>>32-a,f=n[1]>>>32-a;return[s,f,a]}function getBboxZoom(e){for(var t=28,r=0;r<t;r++){var n=1<<32-(r+1);if((e[0]&n)!==(e[2]&n)||(e[1]&n)!==(e[3]&n))return r}return t}function pointToTileFraction(e,t,r){var n=Math.sin(t*d2r),a=Math.pow(2,r),s=a*(e/360+.5),f=a*(.5-.25*Math.log((1+n)/(1-n))/Math.PI);return s=s%a,s<0&&(s=s+a),[s,f,r]}var tilebelt={tileToGeoJSON,tileToBBOX,getChildren,getParent,getSiblings,hasTile,hasSiblings,tilesEqual,tileToQuadkey,quadkeyToTile,pointToTile,bboxToTile,pointToTileFraction};const tilebelt$1=getDefaultExportFromCjs(tilebelt);var earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936};function feature(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function point(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(e[0])||!isNumber(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return feature(n,t,r)}function polygon(e,t,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:e};return feature(o,t,r)}function radiansToLength(e,t){t===void 0&&(t="kilometers");var r=factors[t];if(!r)throw new Error(t+" units is invalid");return e*r}function lengthToRadians(e,t){t===void 0&&(t="kilometers");var r=factors[t];if(!r)throw new Error(t+" units is invalid");return e/r}function radiansToDegrees(e){var t=e%(2*Math.PI);return t*180/Math.PI}function degreesToRadians(e){var t=e%360;return t*Math.PI/180}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function geomEach(e,t){var r,n,a,s,f,o,x,C,P,ge,nt=0,ze=e.type==="FeatureCollection",Bt=e.type==="Feature",qr=ze?e.features.length:1;for(r=0;r<qr;r++){for(o=ze?e.features[r].geometry:Bt?e.geometry:e,C=ze?e.features[r].properties:Bt?e.properties:{},P=ze?e.features[r].bbox:Bt?e.bbox:void 0,ge=ze?e.features[r].id:Bt?e.id:void 0,x=o?o.type==="GeometryCollection":!1,f=x?o.geometries.length:1,a=0;a<f;a++){if(s=x?o.geometries[a]:o,s===null){if(t(null,nt,C,P,ge)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,nt,C,P,ge)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(t(s.geometries[n],nt,C,P,ge)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}nt++}}function geomReduce(e,t,r){var n=r;return geomEach(e,function(a,s,f,o,x){s===0&&r===void 0?n=a:n=t(n,a,s,f,o,x)}),n}function getCoord(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function distance(e,t,r){r===void 0&&(r={});var n=getCoord(e),a=getCoord(t),s=degreesToRadians(a[1]-n[1]),f=degreesToRadians(a[0]-n[0]),o=degreesToRadians(n[1]),x=degreesToRadians(a[1]),C=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(o)*Math.cos(x);return radiansToLength(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),r.units)}function bboxPolygon(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],o=[r,s],x=[a,s],C=[a,n];return polygon([[f,C,x,o,f]],t.properties,{bbox:e,id:t.id})}function destination(e,t,r,n){n===void 0&&(n={});var a=getCoord(e),s=degreesToRadians(a[0]),f=degreesToRadians(a[1]),o=degreesToRadians(r),x=lengthToRadians(t,n.units),C=Math.asin(Math.sin(f)*Math.cos(x)+Math.cos(f)*Math.sin(x)*Math.cos(o)),P=s+Math.atan2(Math.sin(o)*Math.sin(x)*Math.cos(f),Math.cos(x)-Math.sin(f)*Math.sin(C)),ge=radiansToDegrees(P),nt=radiansToDegrees(C);return point([ge,nt],n.properties)}function bearing(e,t,r){if(r===void 0&&(r={}),r.final===!0)return calculateFinalBearing(e,t);var n=getCoord(e),a=getCoord(t),s=degreesToRadians(n[0]),f=degreesToRadians(a[0]),o=degreesToRadians(n[1]),x=degreesToRadians(a[1]),C=Math.sin(f-s)*Math.cos(x),P=Math.cos(o)*Math.sin(x)-Math.sin(o)*Math.cos(x)*Math.cos(f-s);return radiansToDegrees(Math.atan2(C,P))}function calculateFinalBearing(e,t){var r=bearing(t,e);return r=(r+180)%360,r}function midpoint(e,t){var r=distance(e,t),n=bearing(e,t),a=destination(e,r/2,n);return a}var RADIUS=6378137;function area(e){return geomReduce(e,function(t,r){return t+calculateArea(r)},0)}function calculateArea(e){var t=0,r;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=polygonArea(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function polygonArea(e){var t=0;if(e&&e.length>0){t+=Math.abs(ringArea(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(ringArea(e[r]))}return t}function ringArea(e){var t,r,n,a,s,f,o,x=0,C=e.length;if(C>2){for(o=0;o<C;o++)o===C-2?(a=C-2,s=C-1,f=0):o===C-1?(a=C-1,s=0,f=1):(a=o,s=o+1,f=o+2),t=e[a],r=e[s],n=e[f],x+=(rad(n[0])-rad(t[0]))*Math.sin(rad(r[1]));x=x*RADIUS*RADIUS/2}return x}function rad(e){return e*Math.PI/180}const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,t){return e>=this.width||t>=this.height?0:this.getBit(t*this.width+e)},setBitXY(e,t){this.setBit(t*this.width+e)},clearBitXY(e,t){this.clearBit(t*this.width+e)},toggleBitXY(e,t){this.toggleBit(t*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const t in bitMethods)e.prototype[t]=bitMethods[t]}function checkProcessable(e,t={}){let{bitDepth:r,alpha:n,colorModel:a,components:s,channels:f}=t;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${r}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${n}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${a}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let o=`The process: ${e} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${o}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(o)}if(f&&(Array.isArray(f)||(f=[f]),!f.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${f}`)}function createBlob(e,t){e=e||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(e,t)}catch(s){if(s.name!=="TypeError")throw s;for(var r=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new r,a=0;a<e.length;a+=1)n.append(e[a]);return n.getBlob(t.type)}}function dataURLToBlob(e){var t=e.match(/data:([^;]+)/)[1],r=e.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(r));return createBlob([n],{type:t})}function canvasToBlob(e,t,r){return typeof e.toBlob=="function"?new Promise(function(n){e.toBlob(n,t,r)}):Promise.resolve(dataURLToBlob(e.toDataURL(t,r)))}function binaryStringToArrayBuffer(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=-1;++a<t;)n[a]=e.charCodeAt(a);return r}(function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function t(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;const f=n.length;let o=0,x=Math.max(32,f+(f>>1)+7),C=new Uint8Array(x>>3<<3);for(;s<f;){let P=n.charCodeAt(s++);if(P>=55296&&P<=56319){if(s<f){const ge=n.charCodeAt(s);(ge&64512)===56320&&(++s,P=((P&1023)<<10)+(ge&1023)+65536)}if(P>=55296&&P<=56319)continue}if(o+4>C.length){x+=8,x*=1+s/n.length*2,x=x>>3<<3;const ge=new Uint8Array(x);ge.set(C),C=ge}if(P&4294967168)if(!(P&4294965248))C[o++]=P>>6&31|192;else if(!(P&4294901760))C[o++]=P>>12&15|224,C[o++]=P>>6&63|128;else if(!(P&4292870144))C[o++]=P>>18&7|240,C[o++]=P>>12&63|128,C[o++]=P>>6&63|128;else continue;else{C[o++]=P;continue}C[o++]=P&63|128}return C.slice(0,o)};function r(n="utf-8",a={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(a.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const s=new Uint8Array(n);let f=0;const o=s.length,x=[];for(;f<o;){const C=s[f++];if(C===0)break;if(!(C&128))x.push(C);else if((C&224)===192){const P=s[f++]&63;x.push((C&31)<<6|P)}else if((C&240)===224){const P=s[f++]&63,ge=s[f++]&63;x.push((C&31)<<12|P<<6|ge)}else if((C&248)===240){const P=s[f++]&63,ge=s[f++]&63,nt=s[f++]&63;let ze=(C&7)<<18|P<<12|ge<<6|nt;ze>65535&&(ze-=65536,x.push(ze>>>10&1023|55296),ze=56320|ze&1023),x.push(ze)}}return String.fromCharCode.apply(null,x)},e.TextEncoder=t,e.TextDecoder=r})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$6(e,t="utf8"){return new TextDecoder(t).decode(e)}const encoder$1=new TextEncoder;function encode$4(e){return encoder$1.encode(e)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class lS{constructor(t=defaultByteLength$1,r={}){let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const a=r.offset?r.offset>>>0:0,s=t.byteLength-a;let f=a;(ArrayBuffer.isView(t)||t instanceof lS)&&(t.byteLength!==t.buffer.byteLength&&(f=t.byteOffset+a),t=t.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=t,this.length=s,this.byteLength=s,this.byteOffset=f,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,f,s),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const n=typedArrays[r].BYTES_PER_ELEMENT*t,a=this.byteOffset+this.offset,s=this.buffer.slice(a,a+n);if(this.littleEndian===hostBigEndian&&r!=="uint8"&&r!=="int8"){const o=new Uint8Array(this.buffer.slice(a,a+n));o.reverse();const x=new typedArrays[r](o.buffer);return this.offset+=n,x.reverse(),x}const f=new typedArrays[r](s);return this.offset+=n,f}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let n=0;n<t;n++)r+=this.readChar();return r}readUtf8(t=1){return decode$6(this.readBytes(t))}decodeText(t=1,r="utf-8"){return decode$6(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(encode$4(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(IOBuffer$5);var constants$d={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$4,constants$c=constants$d,tableLeft=[];for(let e=0;e<=8;e++)tableLeft.push(255<<e);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const r=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),a=r-n,s=this.bitDepth*this.width%8,f=s===0?0:8-s,o=r*this.height;let x,C,P=0,ge=0,nt=8;t.mark(),C=this.readUint8();for(let ze=this.height-1;ze>=0;ze--){const Bt=ze===0;t.reset(),t.skip(ze*r);for(let qr=0;qr<n;qr++){const _n=qr===n-1;ge<=f&&_n?(t.writeByte(C<<ge),(f===0||f===ge)&&!Bt&&(x=C,C=this.readByte())):ge===0?(x=C,C=this.readUint8(),t.writeByte(x)):(x=C,C=this.readUint8(),t.writeByte(x<<ge&tableLeft[ge]|C>>nt)),_n&&(P+=s||0,t.skip(a),ge=P%8,nt=8-ge)}}r>n&&(t.reset(),t.skip(o-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const r=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$c.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(r).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$c.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$c.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$3=function(t){return new Encoder(t).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1$1=4,Z_BINARY$1=0,Z_TEXT$1=1,Z_UNKNOWN$1$1=2;function zero$1$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK$1=0,STATIC_TREES$1=1,DYN_TREES$1=2,MIN_MATCH$1$1=3,MAX_MATCH$1$1=258,LENGTH_CODES$1$1=29,LITERALS$1$1=256,L_CODES$1$1=LITERALS$1$1+1+LENGTH_CODES$1$1,D_CODES$1$1=30,BL_CODES$1$1=19,HEAP_SIZE$1$1=2*L_CODES$1$1+1,MAX_BITS$1$1=15,Buf_size$1=16,MAX_BL_BITS$1=7,END_BLOCK$1=256,REP_3_6$1=16,REPZ_3_10$1=17,REPZ_11_138$1=18,extra_lbits$1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits$1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits$1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order$1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN$1=512,static_ltree$1=new Array((L_CODES$1$1+2)*2);zero$1$1(static_ltree$1);const static_dtree$1=new Array(D_CODES$1$1*2);zero$1$1(static_dtree$1);const _dist_code$1=new Array(DIST_CODE_LEN$1);zero$1$1(_dist_code$1);const _length_code$1=new Array(MAX_MATCH$1$1-MIN_MATCH$1$1+1);zero$1$1(_length_code$1);const base_length$1=new Array(LENGTH_CODES$1$1);zero$1$1(base_length$1);const base_dist$1=new Array(D_CODES$1$1);zero$1$1(base_dist$1);function StaticTreeDesc$1(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let static_l_desc$1,static_d_desc$1,static_bl_desc$1;function TreeDesc$1(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code$1=e=>e<256?_dist_code$1[e]:_dist_code$1[256+(e>>>7)],put_short$1=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits$1=(e,t,r)=>{e.bi_valid>Buf_size$1-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short$1(e,e.bi_buf),e.bi_buf=t>>Buf_size$1-e.bi_valid,e.bi_valid+=r-Buf_size$1):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},send_code$1=(e,t,r)=>{send_bits$1(e,r[t*2],r[t*2+1])},bi_reverse$1=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},bi_flush$1=e=>{e.bi_valid===16?(put_short$1(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen$1=(e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,x=t.stat_desc.max_length;let C,P,ge,nt,ze,Bt,qr=0;for(nt=0;nt<=MAX_BITS$1$1;nt++)e.bl_count[nt]=0;for(r[e.heap[e.heap_max]*2+1]=0,C=e.heap_max+1;C<HEAP_SIZE$1$1;C++)P=e.heap[C],nt=r[r[P*2+1]*2+1]+1,nt>x&&(nt=x,qr++),r[P*2+1]=nt,!(P>n)&&(e.bl_count[nt]++,ze=0,P>=o&&(ze=f[P-o]),Bt=r[P*2],e.opt_len+=Bt*(nt+ze),s&&(e.static_len+=Bt*(a[P*2+1]+ze)));if(qr!==0){do{for(nt=x-1;e.bl_count[nt]===0;)nt--;e.bl_count[nt]--,e.bl_count[nt+1]+=2,e.bl_count[x]--,qr-=2}while(qr>0);for(nt=x;nt!==0;nt--)for(P=e.bl_count[nt];P!==0;)ge=e.heap[--C],!(ge>n)&&(r[ge*2+1]!==nt&&(e.opt_len+=(nt-r[ge*2+1])*r[ge*2],r[ge*2+1]=nt),P--)}},gen_codes$1=(e,t,r)=>{const n=new Array(MAX_BITS$1$1+1);let a=0,s,f;for(s=1;s<=MAX_BITS$1$1;s++)a=a+r[s-1]<<1,n[s]=a;for(f=0;f<=t;f++){let o=e[f*2+1];o!==0&&(e[f*2]=bi_reverse$1(n[o]++,o))}},tr_static_init$1=()=>{let e,t,r,n,a;const s=new Array(MAX_BITS$1$1+1);for(r=0,n=0;n<LENGTH_CODES$1$1-1;n++)for(base_length$1[n]=r,e=0;e<1<<extra_lbits$1[n];e++)_length_code$1[r++]=n;for(_length_code$1[r-1]=n,a=0,n=0;n<16;n++)for(base_dist$1[n]=a,e=0;e<1<<extra_dbits$1[n];e++)_dist_code$1[a++]=n;for(a>>=7;n<D_CODES$1$1;n++)for(base_dist$1[n]=a<<7,e=0;e<1<<extra_dbits$1[n]-7;e++)_dist_code$1[256+a++]=n;for(t=0;t<=MAX_BITS$1$1;t++)s[t]=0;for(e=0;e<=143;)static_ltree$1[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree$1[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree$1[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree$1[e*2+1]=8,e++,s[8]++;for(gen_codes$1(static_ltree$1,L_CODES$1$1+1,s),e=0;e<D_CODES$1$1;e++)static_dtree$1[e*2+1]=5,static_dtree$1[e*2]=bi_reverse$1(e,5);static_l_desc$1=new StaticTreeDesc$1(static_ltree$1,extra_lbits$1,LITERALS$1$1+1,L_CODES$1$1,MAX_BITS$1$1),static_d_desc$1=new StaticTreeDesc$1(static_dtree$1,extra_dbits$1,0,D_CODES$1$1,MAX_BITS$1$1),static_bl_desc$1=new StaticTreeDesc$1(new Array(0),extra_blbits$1,0,BL_CODES$1$1,MAX_BL_BITS$1)},init_block$1=e=>{let t;for(t=0;t<L_CODES$1$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK$1*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup$1=e=>{e.bi_valid>8?put_short$1(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller$1=(e,t,r,n)=>{const a=t*2,s=r*2;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[r]},pqdownheap$1=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&smaller$1(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller$1(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},compress_block$1=(e,t,r)=>{let n,a,s=0,f,o;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+s++]&255,n+=(e.pending_buf[e.sym_buf+s++]&255)<<8,a=e.pending_buf[e.sym_buf+s++],n===0?send_code$1(e,a,t):(f=_length_code$1[a],send_code$1(e,f+LITERALS$1$1+1,t),o=extra_lbits$1[f],o!==0&&(a-=base_length$1[f],send_bits$1(e,a,o)),n--,f=d_code$1(n),send_code$1(e,f,r),o=extra_dbits$1[f],o!==0&&(n-=base_dist$1[f],send_bits$1(e,n,o)));while(s<e.sym_next);send_code$1(e,END_BLOCK$1,t)},build_tree$1=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let f,o,x=-1,C;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1$1,f=0;f<s;f++)r[f*2]!==0?(e.heap[++e.heap_len]=x=f,e.depth[f]=0):r[f*2+1]=0;for(;e.heap_len<2;)C=e.heap[++e.heap_len]=x<2?++x:0,r[C*2]=1,e.depth[C]=0,e.opt_len--,a&&(e.static_len-=n[C*2+1]);for(t.max_code=x,f=e.heap_len>>1;f>=1;f--)pqdownheap$1(e,r,f);C=s;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap$1(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=o,r[C*2]=r[f*2]+r[o*2],e.depth[C]=(e.depth[f]>=e.depth[o]?e.depth[f]:e.depth[o])+1,r[f*2+1]=r[o*2+1]=C,e.heap[1]=C++,pqdownheap$1(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen$1(e,t),gen_codes$1(r,x,e.bl_count)},scan_tree$1=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)&&(o<C?e.bl_tree[s*2]+=o:s!==0?(s!==a&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6$1*2]++):o<=10?e.bl_tree[REPZ_3_10$1*2]++:e.bl_tree[REPZ_11_138$1*2]++,o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4))},send_tree$1=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),n=0;n<=r;n++)if(s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)){if(o<C)do send_code$1(e,s,e.bl_tree);while(--o!==0);else s!==0?(s!==a&&(send_code$1(e,s,e.bl_tree),o--),send_code$1(e,REP_3_6$1,e.bl_tree),send_bits$1(e,o-3,2)):o<=10?(send_code$1(e,REPZ_3_10$1,e.bl_tree),send_bits$1(e,o-3,3)):(send_code$1(e,REPZ_11_138$1,e.bl_tree),send_bits$1(e,o-11,7));o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4)}},build_bl_tree$1=e=>{let t;for(scan_tree$1(e,e.dyn_ltree,e.l_desc.max_code),scan_tree$1(e,e.dyn_dtree,e.d_desc.max_code),build_tree$1(e,e.bl_desc),t=BL_CODES$1$1-1;t>=3&&e.bl_tree[bl_order$1[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees$1=(e,t,r,n)=>{let a;for(send_bits$1(e,t-257,5),send_bits$1(e,r-1,5),send_bits$1(e,n-4,4),a=0;a<n;a++)send_bits$1(e,e.bl_tree[bl_order$1[a]*2+1],3);send_tree$1(e,e.dyn_ltree,t-1),send_tree$1(e,e.dyn_dtree,r-1)},detect_data_type$1=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return Z_BINARY$1;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT$1;for(r=32;r<LITERALS$1$1;r++)if(e.dyn_ltree[r*2]!==0)return Z_TEXT$1;return Z_BINARY$1};let static_init_done$1=!1;const _tr_init$1$1=e=>{static_init_done$1||(tr_static_init$1(),static_init_done$1=!0),e.l_desc=new TreeDesc$1(e.dyn_ltree,static_l_desc$1),e.d_desc=new TreeDesc$1(e.dyn_dtree,static_d_desc$1),e.bl_desc=new TreeDesc$1(e.bl_tree,static_bl_desc$1),e.bi_buf=0,e.bi_valid=0,init_block$1(e)},_tr_stored_block$1$1=(e,t,r,n)=>{send_bits$1(e,(STORED_BLOCK$1<<1)+(n?1:0),3),bi_windup$1(e),put_short$1(e,r),put_short$1(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},_tr_align$1$1=e=>{send_bits$1(e,STATIC_TREES$1<<1,3),send_code$1(e,END_BLOCK$1,static_ltree$1),bi_flush$1(e)},_tr_flush_block$1$1=(e,t,r,n)=>{let a,s,f=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1$1&&(e.strm.data_type=detect_data_type$1(e)),build_tree$1(e,e.l_desc),build_tree$1(e,e.d_desc),f=build_bl_tree$1(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=r+5,r+4<=a&&t!==-1?_tr_stored_block$1$1(e,t,r,n):e.strategy===Z_FIXED$1$1||s===a?(send_bits$1(e,(STATIC_TREES$1<<1)+(n?1:0),3),compress_block$1(e,static_ltree$1,static_dtree$1)):(send_bits$1(e,(DYN_TREES$1<<1)+(n?1:0),3),send_all_trees$1(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),compress_block$1(e,e.dyn_ltree,e.dyn_dtree)),init_block$1(e),n&&bi_windup$1(e)},_tr_tally$1$1=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code$1[r]+LITERALS$1$1+1)*2]++,e.dyn_dtree[d_code$1(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1$1=_tr_init$1$1,_tr_stored_block_1$1=_tr_stored_block$1$1,_tr_flush_block_1$1=_tr_flush_block$1$1,_tr_tally_1$1=_tr_tally$1$1,_tr_align_1$1=_tr_align$1$1,trees$1={_tr_init:_tr_init_1$1,_tr_stored_block:_tr_stored_block_1$1,_tr_flush_block:_tr_flush_block_1$1,_tr_tally:_tr_tally_1$1,_tr_align:_tr_align_1$1};const adler32$1=(e,t,r,n)=>{let a=e&65535|0,s=e>>>16&65535|0,f=0;for(;r!==0;){f=r>2e3?2e3:r,r-=f;do a=a+t[n++]|0,s=s+a|0;while(--f);a%=65521,s%=65521}return a|s<<16|0};var adler32_1$1=adler32$1;const makeTable$1=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable$2=new Uint32Array(makeTable$1()),crc32$1=(e,t,r,n)=>{const a=crcTable$2,s=n+r;e^=-1;for(let f=n;f<s;f++)e=e>>>8^a[(e^t[f])&255];return e^-1};var crc32_1$1=crc32$1,messages$1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_tr_init$2,_tr_stored_block:_tr_stored_block$2,_tr_flush_block:_tr_flush_block$2,_tr_tally:_tr_tally$2,_tr_align:_tr_align$2}=trees$1,{Z_NO_FLUSH:Z_NO_FLUSH$2$1,Z_PARTIAL_FLUSH:Z_PARTIAL_FLUSH$1,Z_FULL_FLUSH:Z_FULL_FLUSH$1$1,Z_FINISH:Z_FINISH$3$1,Z_BLOCK:Z_BLOCK$1$1,Z_OK:Z_OK$3$1,Z_STREAM_END:Z_STREAM_END$3$1,Z_STREAM_ERROR:Z_STREAM_ERROR$2$1,Z_DATA_ERROR:Z_DATA_ERROR$2$1,Z_BUF_ERROR:Z_BUF_ERROR$1$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1$1,Z_FILTERED:Z_FILTERED$1,Z_HUFFMAN_ONLY:Z_HUFFMAN_ONLY$1,Z_RLE:Z_RLE$1,Z_FIXED:Z_FIXED$2,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1$1,Z_UNKNOWN:Z_UNKNOWN$2,Z_DEFLATED:Z_DEFLATED$2$1}=constants$2$2,MAX_MEM_LEVEL$1=9,MAX_WBITS$1$1=15,DEF_MEM_LEVEL$1=8,LENGTH_CODES$2=29,LITERALS$2=256,L_CODES$2=LITERALS$2+1+LENGTH_CODES$2,D_CODES$2=30,BL_CODES$2=19,HEAP_SIZE$2=2*L_CODES$2+1,MAX_BITS$2=15,MIN_MATCH$2=3,MAX_MATCH$2=258,MIN_LOOKAHEAD$1=MAX_MATCH$2+MIN_MATCH$2+1,PRESET_DICT$1=32,INIT_STATE$1=42,GZIP_STATE$1=57,EXTRA_STATE$1=69,NAME_STATE$1=73,COMMENT_STATE$1=91,HCRC_STATE$1=103,BUSY_STATE$1=113,FINISH_STATE$1=666,BS_NEED_MORE$1=1,BS_BLOCK_DONE$1=2,BS_FINISH_STARTED$1=3,BS_FINISH_DONE$1=4,OS_CODE$1=3,err$1=(e,t)=>(e.msg=messages$1[t],t),rank$1=e=>e*2-(e>4?9:0),zero$2=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash$1=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=a?r-a:0;while(--t);t=a,n=t;do r=e.prev[--n],e.prev[n]=r>=a?r-a:0;while(--t)};let HASH_ZLIB$1=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,HASH$1=HASH_ZLIB$1;const flush_pending$1=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},flush_block_only$1=(e,t)=>{_tr_flush_block$2(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending$1(e.strm)},put_byte$1=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB$1=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf$1=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),e.state.wrap===1?e.adler=adler32_1$1(e.adler,t,a,r):e.state.wrap===2&&(e.adler=crc32_1$1(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},longest_match$1=(e,t)=>{let r=e.max_chain_length,n=e.strstart,a,s,f=e.prev_length,o=e.nice_match;const x=e.strstart>e.w_size-MIN_LOOKAHEAD$1?e.strstart-(e.w_size-MIN_LOOKAHEAD$1):0,C=e.window,P=e.w_mask,ge=e.prev,nt=e.strstart+MAX_MATCH$2;let ze=C[n+f-1],Bt=C[n+f];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do if(a=t,!(C[a+f]!==Bt||C[a+f-1]!==ze||C[a]!==C[n]||C[++a]!==C[n+1])){n+=2,a++;do;while(C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&n<nt);if(s=MAX_MATCH$2-(nt-n),n=nt-MAX_MATCH$2,s>f){if(e.match_start=t,f=s,s>=o)break;ze=C[n+f-1],Bt=C[n+f]}}while((t=ge[t&P])>x&&--r!==0);return f<=e.lookahead?f:e.lookahead},fill_window$1=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD$1)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash$1(e),n+=t),e.strm.avail_in===0)break;if(r=read_buf$1(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH$2)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=HASH$1(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=HASH$1(e,e.ins_h,e.window[a+MIN_MATCH$2-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH$2)););}while(e.lookahead<MIN_LOOKAHEAD$1&&e.strm.avail_in!==0)},deflate_stored$1=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,s,f=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(n===0&&t!==Z_FINISH$3$1||t===Z_NO_FLUSH$2$1||n!==a+e.strm.avail_in)))break;f=t===Z_FINISH$3$1&&n===a+e.strm.avail_in?1:0,_tr_stored_block$2(e,0,0,f),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,flush_pending$1(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(read_buf$1(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(f===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?BS_FINISH_DONE$1:t!==Z_NO_FLUSH$2$1&&t!==Z_FINISH$3$1&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE$1:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf$1(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Z_FINISH$3$1)&&t!==Z_NO_FLUSH$2$1&&e.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,f=t===Z_FINISH$3$1&&e.strm.avail_in===0&&n===a?1:0,_tr_stored_block$2(e,e.block_start,n,f),e.block_start+=n,flush_pending$1(e.strm)),f?BS_FINISH_STARTED$1:BS_NEED_MORE$1)},deflate_fast$1=(e,t)=>{let r,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD$1){if(fill_window$1(e),e.lookahead<MIN_LOOKAHEAD$1&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH$2&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD$1&&(e.match_length=longest_match$1(e,r)),e.match_length>=MIN_MATCH$2)if(n=_tr_tally$2(e,e.strstart-e.match_start,e.match_length-MIN_MATCH$2),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH$2){e.match_length--;do e.strstart++,e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=e.strstart<MIN_MATCH$2-1?e.strstart:MIN_MATCH$2-1,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_slow$1=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<MIN_LOOKAHEAD$1){if(fill_window$1(e),e.lookahead<MIN_LOOKAHEAD$1&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH$2&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH$2-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD$1&&(e.match_length=longest_match$1(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED$1||e.match_length===MIN_MATCH$2&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH$2-1)),e.prev_length>=MIN_MATCH$2&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-MIN_MATCH$2,n=_tr_tally$2(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH$2),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=HASH$1(e,e.ins_h,e.window[e.strstart+MIN_MATCH$2-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH$2-1,e.strstart++,n&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}else if(e.match_available){if(n=_tr_tally$2(e,0,e.window[e.strstart-1]),n&&flush_block_only$1(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE$1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally$2(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH$2-1?e.strstart:MIN_MATCH$2-1,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_rle$1=(e,t)=>{let r,n,a,s;const f=e.window;for(;;){if(e.lookahead<=MAX_MATCH$2){if(fill_window$1(e),e.lookahead<=MAX_MATCH$2&&t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH$2&&e.strstart>0&&(a=e.strstart-1,n=f[a],n===f[++a]&&n===f[++a]&&n===f[++a])){s=e.strstart+MAX_MATCH$2;do;while(n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&a<s);e.match_length=MAX_MATCH$2-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH$2?(r=_tr_tally$2(e,1,e.match_length-MIN_MATCH$2),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=0,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1},deflate_huff$1=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(fill_window$1(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2$1)return BS_NEED_MORE$1;break}if(e.match_length=0,r=_tr_tally$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only$1(e,!1),e.strm.avail_out===0))return BS_NEED_MORE$1}return e.insert=0,t===Z_FINISH$3$1?(flush_block_only$1(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED$1:BS_FINISH_DONE$1):e.sym_next&&(flush_block_only$1(e,!1),e.strm.avail_out===0)?BS_NEED_MORE$1:BS_BLOCK_DONE$1};function Config$1(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const configuration_table$1=[new Config$1(0,0,0,0,deflate_stored$1),new Config$1(4,4,8,4,deflate_fast$1),new Config$1(4,5,16,8,deflate_fast$1),new Config$1(4,6,32,32,deflate_fast$1),new Config$1(4,4,16,16,deflate_slow$1),new Config$1(8,16,32,32,deflate_slow$1),new Config$1(8,16,128,128,deflate_slow$1),new Config$1(8,32,128,256,deflate_slow$1),new Config$1(32,128,258,1024,deflate_slow$1),new Config$1(32,258,258,4096,deflate_slow$1)],lm_init$1=e=>{e.window_size=2*e.w_size,zero$2(e.head),e.max_lazy_match=configuration_table$1[e.level].max_lazy,e.good_match=configuration_table$1[e.level].good_length,e.nice_match=configuration_table$1[e.level].nice_length,e.max_chain_length=configuration_table$1[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH$2-1,e.match_available=0,e.ins_h=0};function DeflateState$1(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2$1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE$2*2),this.dyn_dtree=new Uint16Array((2*D_CODES$2+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES$2+1)*2),zero$2(this.dyn_ltree),zero$2(this.dyn_dtree),zero$2(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS$2+1),this.heap=new Uint16Array(2*L_CODES$2+1),zero$2(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES$2+1),zero$2(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck$1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE$1&&t.status!==GZIP_STATE$1&&t.status!==EXTRA_STATE$1&&t.status!==NAME_STATE$1&&t.status!==COMMENT_STATE$1&&t.status!==HCRC_STATE$1&&t.status!==BUSY_STATE$1&&t.status!==FINISH_STATE$1?1:0},deflateResetKeep$1=e=>{if(deflateStateCheck$1(e))return err$1(e,Z_STREAM_ERROR$2$1);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN$2;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE$1:t.wrap?INIT_STATE$1:BUSY_STATE$1,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init$2(t),Z_OK$3$1},deflateReset$1=e=>{const t=deflateResetKeep$1(e);return t===Z_OK$3$1&&lm_init$1(e.state),t},deflateSetHeader$1=(e,t)=>deflateStateCheck$1(e)||e.state.wrap!==2?Z_STREAM_ERROR$2$1:(e.state.gzhead=t,Z_OK$3$1),deflateInit2$1=(e,t,r,n,a,s)=>{if(!e)return Z_STREAM_ERROR$2$1;let f=1;if(t===Z_DEFAULT_COMPRESSION$1$1&&(t=6),n<0?(f=0,n=-n):n>15&&(f=2,n-=16),a<1||a>MAX_MEM_LEVEL$1||r!==Z_DEFLATED$2$1||n<8||n>15||t<0||t>9||s<0||s>Z_FIXED$2||n===8&&f!==1)return err$1(e,Z_STREAM_ERROR$2$1);n===8&&(n=9);const o=new DeflateState$1;return e.state=o,o.strm=e,o.status=INIT_STATE$1,o.wrap=f,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH$2-1)/MIN_MATCH$2),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=s,o.method=r,deflateReset$1(e)},deflateInit$1=(e,t)=>deflateInit2$1(e,t,Z_DEFLATED$2$1,MAX_WBITS$1$1,DEF_MEM_LEVEL$1,Z_DEFAULT_STRATEGY$1$1),deflate$2$1=(e,t)=>{if(deflateStateCheck$1(e)||t>Z_BLOCK$1$1||t<0)return e?err$1(e,Z_STREAM_ERROR$2$1):Z_STREAM_ERROR$2$1;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===FINISH_STATE$1&&t!==Z_FINISH$3$1)return err$1(e,e.avail_out===0?Z_BUF_ERROR$1$1:Z_STREAM_ERROR$2$1);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(flush_pending$1(e),e.avail_out===0)return r.last_flush=-1,Z_OK$3$1}else if(e.avail_in===0&&rank$1(t)<=rank$1(n)&&t!==Z_FINISH$3$1)return err$1(e,Z_BUF_ERROR$1$1);if(r.status===FINISH_STATE$1&&e.avail_in!==0)return err$1(e,Z_BUF_ERROR$1$1);if(r.status===INIT_STATE$1&&r.wrap===0&&(r.status=BUSY_STATE$1),r.status===INIT_STATE$1){let a=Z_DEFLATED$2$1+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=Z_HUFFMAN_ONLY$1||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=PRESET_DICT$1),a+=31-a%31,putShortMSB$1(r,a),r.strstart!==0&&(putShortMSB$1(r,e.adler>>>16),putShortMSB$1(r,e.adler&65535)),e.adler=1,r.status=BUSY_STATE$1,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1}if(r.status===GZIP_STATE$1){if(e.adler=0,put_byte$1(r,31),put_byte$1(r,139),put_byte$1(r,8),r.gzhead)put_byte$1(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),put_byte$1(r,r.gzhead.time&255),put_byte$1(r,r.gzhead.time>>8&255),put_byte$1(r,r.gzhead.time>>16&255),put_byte$1(r,r.gzhead.time>>24&255),put_byte$1(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY$1||r.level<2?4:0),put_byte$1(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(put_byte$1(r,r.gzhead.extra.length&255),put_byte$1(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=EXTRA_STATE$1;else if(put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,0),put_byte$1(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY$1||r.level<2?4:0),put_byte$1(r,OS_CODE$1),r.status=BUSY_STATE$1,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1}if(r.status===EXTRA_STATE$1){if(r.gzhead.extra){let a=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let o=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex+=o,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1;a=0,s-=o}let f=new Uint8Array(r.gzhead.extra);r.pending_buf.set(f.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=NAME_STATE$1}if(r.status===NAME_STATE$1){if(r.gzhead.name){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1;a=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,put_byte$1(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=COMMENT_STATE$1}if(r.status===COMMENT_STATE$1){if(r.gzhead.comment){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1;a=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,put_byte$1(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1$1(e.adler,r.pending_buf,r.pending-a,a))}r.status=HCRC_STATE$1}if(r.status===HCRC_STATE$1){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(flush_pending$1(e),r.pending!==0))return r.last_flush=-1,Z_OK$3$1;put_byte$1(r,e.adler&255),put_byte$1(r,e.adler>>8&255),e.adler=0}if(r.status=BUSY_STATE$1,flush_pending$1(e),r.pending!==0)return r.last_flush=-1,Z_OK$3$1}if(e.avail_in!==0||r.lookahead!==0||t!==Z_NO_FLUSH$2$1&&r.status!==FINISH_STATE$1){let a=r.level===0?deflate_stored$1(r,t):r.strategy===Z_HUFFMAN_ONLY$1?deflate_huff$1(r,t):r.strategy===Z_RLE$1?deflate_rle$1(r,t):configuration_table$1[r.level].func(r,t);if((a===BS_FINISH_STARTED$1||a===BS_FINISH_DONE$1)&&(r.status=FINISH_STATE$1),a===BS_NEED_MORE$1||a===BS_FINISH_STARTED$1)return e.avail_out===0&&(r.last_flush=-1),Z_OK$3$1;if(a===BS_BLOCK_DONE$1&&(t===Z_PARTIAL_FLUSH$1?_tr_align$2(r):t!==Z_BLOCK$1$1&&(_tr_stored_block$2(r,0,0,!1),t===Z_FULL_FLUSH$1$1&&(zero$2(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),flush_pending$1(e),e.avail_out===0))return r.last_flush=-1,Z_OK$3$1}return t!==Z_FINISH$3$1?Z_OK$3$1:r.wrap<=0?Z_STREAM_END$3$1:(r.wrap===2?(put_byte$1(r,e.adler&255),put_byte$1(r,e.adler>>8&255),put_byte$1(r,e.adler>>16&255),put_byte$1(r,e.adler>>24&255),put_byte$1(r,e.total_in&255),put_byte$1(r,e.total_in>>8&255),put_byte$1(r,e.total_in>>16&255),put_byte$1(r,e.total_in>>24&255)):(putShortMSB$1(r,e.adler>>>16),putShortMSB$1(r,e.adler&65535)),flush_pending$1(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Z_OK$3$1:Z_STREAM_END$3$1)},deflateEnd$1=e=>{if(deflateStateCheck$1(e))return Z_STREAM_ERROR$2$1;const t=e.state.status;return e.state=null,t===BUSY_STATE$1?err$1(e,Z_DATA_ERROR$2$1):Z_OK$3$1},deflateSetDictionary$1=(e,t)=>{let r=t.length;if(deflateStateCheck$1(e))return Z_STREAM_ERROR$2$1;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==INIT_STATE$1||n.lookahead)return Z_STREAM_ERROR$2$1;if(a===1&&(e.adler=adler32_1$1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){a===0&&(zero$2(n.head),n.strstart=0,n.block_start=0,n.insert=0);let x=new Uint8Array(n.w_size);x.set(t.subarray(r-n.w_size,r),0),t=x,r=n.w_size}const s=e.avail_in,f=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,fill_window$1(n);n.lookahead>=MIN_MATCH$2;){let x=n.strstart,C=n.lookahead-(MIN_MATCH$2-1);do n.ins_h=HASH$1(n,n.ins_h,n.window[x+MIN_MATCH$2-1]),n.prev[x&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=x,x++;while(--C);n.strstart=x,n.lookahead=MIN_MATCH$2-1,fill_window$1(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH$2-1,n.match_available=0,e.next_in=f,e.input=o,e.avail_in=s,n.wrap=a,Z_OK$3$1};var deflateInit_1$1=deflateInit$1,deflateInit2_1$1=deflateInit2$1,deflateReset_1$1=deflateReset$1,deflateResetKeep_1$1=deflateResetKeep$1,deflateSetHeader_1$1=deflateSetHeader$1,deflate_2$1$1=deflate$2$1,deflateEnd_1$1=deflateEnd$1,deflateSetDictionary_1$1=deflateSetDictionary$1,deflateInfo$1="pako deflate (from Nodeca project)",deflate_1$2$1={deflateInit:deflateInit_1$1,deflateInit2:deflateInit2_1$1,deflateReset:deflateReset_1$1,deflateResetKeep:deflateResetKeep_1$1,deflateSetHeader:deflateSetHeader_1$1,deflate:deflate_2$1$1,deflateEnd:deflateEnd_1$1,deflateSetDictionary:deflateSetDictionary_1$1,deflateInfo:deflateInfo$1};const _has$1=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign$1=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)_has$1(r,n)&&(e[n]=r[n])}}return e},flattenChunks$1=e=>{let t=0;for(let n=0,a=e.length;n<a;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,a=0,s=e.length;n<s;n++){let f=e[n];r.set(f,a),a+=f.length}return r},common$1={assign:assign$1,flattenChunks:flattenChunks$1};let STR_APPLY_UIA_OK$1=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK$1=!1}const _utf8len$1=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len$1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len$1[254]=_utf8len$1[254]=1;var string2buf$1=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,a,s,f=e.length,o=0;for(a=0;a<f;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),s=0,a=0;s<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|r&63):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|r&63):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|r&63);return t};const buf2binstring$1=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK$1)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var buf2string$1=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,a;const s=new Array(r*2);for(a=0,n=0;n<r;){let f=e[n++];if(f<128){s[a++]=f;continue}let o=_utf8len$1[f];if(o>4){s[a++]=65533,n+=o-1;continue}for(f&=o===2?31:o===3?15:7;o>1&&n<r;)f=f<<6|e[n++]&63,o--;if(o>1){s[a++]=65533;continue}f<65536?s[a++]=f:(f-=65536,s[a++]=55296|f>>10&1023,s[a++]=56320|f&1023)}return buf2binstring$1(s,a)},utf8border$1=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+_utf8len$1[e[r]]>t?r:t},strings$1={string2buf:string2buf$1,buf2string:buf2string$1,utf8border:utf8border$1};function ZStream$1(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream$1=ZStream$1;const toString$1$2=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1$1,Z_SYNC_FLUSH:Z_SYNC_FLUSH$1,Z_FULL_FLUSH:Z_FULL_FLUSH$2,Z_FINISH:Z_FINISH$2$1,Z_OK:Z_OK$2$1,Z_STREAM_END:Z_STREAM_END$2$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$2,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$2,Z_DEFLATED:Z_DEFLATED$1$1}=constants$2$2;function Deflate$1$1(e){this.options=common$1.assign({level:Z_DEFAULT_COMPRESSION$2,method:Z_DEFLATED$1$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$2},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream$1,this.strm.avail_out=0;let r=deflate_1$2$1.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$2$1)throw new Error(messages$1[r]);if(t.header&&deflate_1$2$1.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings$1.string2buf(t.dictionary):toString$1$2.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=deflate_1$2$1.deflateSetDictionary(this.strm,n),r!==Z_OK$2$1)throw new Error(messages$1[r]);this._dict_set=!0}}Deflate$1$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH$2$1:Z_NO_FLUSH$1$1,typeof e=="string"?r.input=strings$1.string2buf(e):toString$1$2.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===Z_SYNC_FLUSH$1||s===Z_FULL_FLUSH$2)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(a=deflate_1$2$1.deflate(r,s),a===Z_STREAM_END$2$1)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=deflate_1$2$1.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z_OK$2$1;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Deflate$1$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1$1.prototype.onEnd=function(e){e===Z_OK$2$1&&(this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,t){const r=new Deflate$1$1(t);if(r.push(e,!0),r.err)throw r.msg||messages$1[r.err];return r.result}function deflateRaw$1(e,t){return t=t||{},t.raw=!0,deflate$1(e,t)}function gzip$1(e,t){return t=t||{},t.gzip=!0,deflate$1(e,t)}var Deflate_1$1=Deflate$1$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1$1=constants$2$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1$1};const BAD$1$1=16209,TYPE$1$1=16191;var inffast$1=function(t,r){let n,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n,Fn,tl,Io,Co,rl,ah,ch,ju,Zu,sl;const oh=t.state;n=t.next_in,Zu=t.input,a=n+(t.avail_in-5),s=t.next_out,sl=t.output,f=s-(r-t.avail_out),o=s+(t.avail_out-257),x=oh.dmax,C=oh.wsize,P=oh.whave,ge=oh.wnext,nt=oh.window,ze=oh.hold,Bt=oh.bits,qr=oh.lencode,_n=oh.distcode,Fn=(1<<oh.lenbits)-1,tl=(1<<oh.distbits)-1;e:do{Bt<15&&(ze+=Zu[n++]<<Bt,Bt+=8,ze+=Zu[n++]<<Bt,Bt+=8),Io=qr[ze&Fn];t:for(;;){if(Co=Io>>>24,ze>>>=Co,Bt-=Co,Co=Io>>>16&255,Co===0)sl[s++]=Io&65535;else if(Co&16){rl=Io&65535,Co&=15,Co&&(Bt<Co&&(ze+=Zu[n++]<<Bt,Bt+=8),rl+=ze&(1<<Co)-1,ze>>>=Co,Bt-=Co),Bt<15&&(ze+=Zu[n++]<<Bt,Bt+=8,ze+=Zu[n++]<<Bt,Bt+=8),Io=_n[ze&tl];i:for(;;){if(Co=Io>>>24,ze>>>=Co,Bt-=Co,Co=Io>>>16&255,Co&16){if(ah=Io&65535,Co&=15,Bt<Co&&(ze+=Zu[n++]<<Bt,Bt+=8,Bt<Co&&(ze+=Zu[n++]<<Bt,Bt+=8)),ah+=ze&(1<<Co)-1,ah>x){t.msg="invalid distance too far back",oh.mode=BAD$1$1;break e}if(ze>>>=Co,Bt-=Co,Co=s-f,ah>Co){if(Co=ah-Co,Co>P&&oh.sane){t.msg="invalid distance too far back",oh.mode=BAD$1$1;break e}if(ch=0,ju=nt,ge===0){if(ch+=C-Co,Co<rl){rl-=Co;do sl[s++]=nt[ch++];while(--Co);ch=s-ah,ju=sl}}else if(ge<Co){if(ch+=C+ge-Co,Co-=ge,Co<rl){rl-=Co;do sl[s++]=nt[ch++];while(--Co);if(ch=0,ge<rl){Co=ge,rl-=Co;do sl[s++]=nt[ch++];while(--Co);ch=s-ah,ju=sl}}}else if(ch+=ge-Co,Co<rl){rl-=Co;do sl[s++]=nt[ch++];while(--Co);ch=s-ah,ju=sl}for(;rl>2;)sl[s++]=ju[ch++],sl[s++]=ju[ch++],sl[s++]=ju[ch++],rl-=3;rl&&(sl[s++]=ju[ch++],rl>1&&(sl[s++]=ju[ch++]))}else{ch=s-ah;do sl[s++]=sl[ch++],sl[s++]=sl[ch++],sl[s++]=sl[ch++],rl-=3;while(rl>2);rl&&(sl[s++]=sl[ch++],rl>1&&(sl[s++]=sl[ch++]))}}else if(Co&64){t.msg="invalid distance code",oh.mode=BAD$1$1;break e}else{Io=_n[(Io&65535)+(ze&(1<<Co)-1)];continue i}break}}else if(Co&64)if(Co&32){oh.mode=TYPE$1$1;break e}else{t.msg="invalid literal/length code",oh.mode=BAD$1$1;break e}else{Io=qr[(Io&65535)+(ze&(1<<Co)-1)];continue t}break}}while(n<a&&s<o);rl=Bt>>3,n-=rl,Bt-=rl<<3,ze&=(1<<Bt)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?5+(a-n):5-(n-a),t.avail_out=s<o?257+(o-s):257-(s-o),oh.hold=ze,oh.bits=Bt};const MAXBITS$1=15,ENOUGH_LENS$1$1=852,ENOUGH_DISTS$1$1=592,CODES$1$1=0,LENS$1$1=1,DISTS$1$1=2,lbase$1=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext$1=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase$1=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext$1=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table$1=(e,t,r,n,a,s,f,o)=>{const x=o.bits;let C=0,P=0,ge=0,nt=0,ze=0,Bt=0,qr=0,_n=0,Fn=0,tl=0,Io,Co,rl,ah,ch,ju=null,Zu;const sl=new Uint16Array(MAXBITS$1+1),oh=new Uint16Array(MAXBITS$1+1);let hh=null,Sh,$h,hd;for(C=0;C<=MAXBITS$1;C++)sl[C]=0;for(P=0;P<n;P++)sl[t[r+P]]++;for(ze=x,nt=MAXBITS$1;nt>=1&&sl[nt]===0;nt--);if(ze>nt&&(ze=nt),nt===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,o.bits=1,0;for(ge=1;ge<nt&&sl[ge]===0;ge++);for(ze<ge&&(ze=ge),_n=1,C=1;C<=MAXBITS$1;C++)if(_n<<=1,_n-=sl[C],_n<0)return-1;if(_n>0&&(e===CODES$1$1||nt!==1))return-1;for(oh[1]=0,C=1;C<MAXBITS$1;C++)oh[C+1]=oh[C]+sl[C];for(P=0;P<n;P++)t[r+P]!==0&&(f[oh[t[r+P]]++]=P);if(e===CODES$1$1?(ju=hh=f,Zu=20):e===LENS$1$1?(ju=lbase$1,hh=lext$1,Zu=257):(ju=dbase$1,hh=dext$1,Zu=0),tl=0,P=0,C=ge,ch=s,Bt=ze,qr=0,rl=-1,Fn=1<<ze,ah=Fn-1,e===LENS$1$1&&Fn>ENOUGH_LENS$1$1||e===DISTS$1$1&&Fn>ENOUGH_DISTS$1$1)return 1;for(;;){Sh=C-qr,f[P]+1<Zu?($h=0,hd=f[P]):f[P]>=Zu?($h=hh[f[P]-Zu],hd=ju[f[P]-Zu]):($h=32+64,hd=0),Io=1<<C-qr,Co=1<<Bt,ge=Co;do Co-=Io,a[ch+(tl>>qr)+Co]=Sh<<24|$h<<16|hd|0;while(Co!==0);for(Io=1<<C-1;tl&Io;)Io>>=1;if(Io!==0?(tl&=Io-1,tl+=Io):tl=0,P++,--sl[C]===0){if(C===nt)break;C=t[r+f[P]]}if(C>ze&&(tl&ah)!==rl){for(qr===0&&(qr=ze),ch+=ge,Bt=C-qr,_n=1<<Bt;Bt+qr<nt&&(_n-=sl[Bt+qr],!(_n<=0));)Bt++,_n<<=1;if(Fn+=1<<Bt,e===LENS$1$1&&Fn>ENOUGH_LENS$1$1||e===DISTS$1$1&&Fn>ENOUGH_DISTS$1$1)return 1;rl=tl&ah,a[rl]=ze<<24|Bt<<16|ch-s|0}}return tl!==0&&(a[ch+tl]=C-qr<<24|64<<16|0),o.bits=ze,0};var inftrees$1=inflate_table$1;const CODES$2=0,LENS$2=1,DISTS$2=2,{Z_FINISH:Z_FINISH$1$1,Z_BLOCK:Z_BLOCK$2,Z_TREES:Z_TREES$1,Z_OK:Z_OK$1$1,Z_STREAM_END:Z_STREAM_END$1$1,Z_NEED_DICT:Z_NEED_DICT$1$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1$1,Z_DATA_ERROR:Z_DATA_ERROR$1$1,Z_MEM_ERROR:Z_MEM_ERROR$1$1,Z_BUF_ERROR:Z_BUF_ERROR$2,Z_DEFLATED:Z_DEFLATED$3}=constants$2$2,HEAD$1=16180,FLAGS$1=16181,TIME$1=16182,OS$1=16183,EXLEN$1=16184,EXTRA$1=16185,NAME$1=16186,COMMENT$1=16187,HCRC$1=16188,DICTID$1=16189,DICT$1=16190,TYPE$2=16191,TYPEDO$1=16192,STORED$1=16193,COPY_$1=16194,COPY$1=16195,TABLE$1=16196,LENLENS$1=16197,CODELENS$1=16198,LEN_$1=16199,LEN$1=16200,LENEXT$1=16201,DIST$1=16202,DISTEXT$1=16203,MATCH$1=16204,LIT$1=16205,CHECK$1=16206,LENGTH$1=16207,DONE$1=16208,BAD$2=16209,MEM$1=16210,SYNC$1=16211,ENOUGH_LENS$2=852,ENOUGH_DISTS$2=592,MAX_WBITS$2=15,DEF_WBITS$1=MAX_WBITS$2,zswap32$1=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState$1(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck$1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD$1||t.mode>SYNC$1?1:0},inflateResetKeep$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD$1,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS$2),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS$2),t.sane=1,t.back=-1,Z_OK$1$1},inflateReset$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep$1(e)},inflateReset2$1=(e,t)=>{let r;if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset$1(e))},inflateInit2$1=(e,t)=>{if(!e)return Z_STREAM_ERROR$1$1;const r=new InflateState$1;e.state=r,r.strm=e,r.window=null,r.mode=HEAD$1;const n=inflateReset2$1(e,t);return n!==Z_OK$1$1&&(e.state=null),n},inflateInit$1=e=>inflateInit2$1(e,DEF_WBITS$1);let virgin$1=!0,lenfix$1,distfix$1;const fixedtables$1=e=>{if(virgin$1){lenfix$1=new Int32Array(512),distfix$1=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees$1(LENS$2,e.lens,0,288,lenfix$1,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees$1(DISTS$2,e.lens,0,32,distfix$1,0,e.work,{bits:5}),virgin$1=!1}e.lencode=lenfix$1,e.lenbits=9,e.distcode=distfix$1,e.distbits=5},updatewindow$1=(e,t,r,n)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(r-n,r-n+a),s.wnext),n-=a,n?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},inflate$2$1=(e,t)=>{let r,n,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n=0,Fn,tl,Io,Co,rl,ah,ch,ju;const Zu=new Uint8Array(4);let sl,oh;const hh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck$1(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1$1;r=e.state,r.mode===TYPE$2&&(r.mode=TYPEDO$1),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,ge=o,nt=x,ju=Z_OK$1$1;e:for(;;)switch(r.mode){case HEAD$1:if(r.wrap===0){r.mode=TYPEDO$1;break}for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&2&&C===35615){r.wbits===0&&(r.wbits=15),r.check=0,Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1$1(r.check,Zu,2,0),C=0,P=0,r.mode=FLAGS$1;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((C&255)<<8)+(C>>8))%31){e.msg="incorrect header check",r.mode=BAD$2;break}if((C&15)!==Z_DEFLATED$3){e.msg="unknown compression method",r.mode=BAD$2;break}if(C>>>=4,P-=4,ch=(C&15)+8,r.wbits===0&&(r.wbits=ch),ch>15||ch>r.wbits){e.msg="invalid window size",r.mode=BAD$2;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=C&512?DICTID$1:TYPE$2,C=0,P=0;break;case FLAGS$1:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.flags=C,(r.flags&255)!==Z_DEFLATED$3){e.msg="unknown compression method",r.mode=BAD$2;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=BAD$2;break}r.head&&(r.head.text=C>>8&1),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1$1(r.check,Zu,2,0)),C=0,P=0,r.mode=TIME$1;case TIME$1:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.time=C),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,Zu[2]=C>>>16&255,Zu[3]=C>>>24&255,r.check=crc32_1$1(r.check,Zu,4,0)),C=0,P=0,r.mode=OS$1;case OS$1:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.xflags=C&255,r.head.os=C>>8),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1$1(r.check,Zu,2,0)),C=0,P=0,r.mode=EXLEN$1;case EXLEN$1:if(r.flags&1024){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length=C,r.head&&(r.head.extra_len=C),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1$1(r.check,Zu,2,0)),C=0,P=0}else r.head&&(r.head.extra=null);r.mode=EXTRA$1;case EXTRA$1:if(r.flags&1024&&(ze=r.length,ze>o&&(ze=o),ze&&(r.head&&(ch=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+ze),ch)),r.flags&512&&r.wrap&4&&(r.check=crc32_1$1(r.check,n,ze,s)),o-=ze,s+=ze,r.length-=ze),r.length))break e;r.length=0,r.mode=NAME$1;case NAME$1:if(r.flags&2048){if(o===0)break e;ze=0;do ch=n[s+ze++],r.head&&ch&&r.length<65536&&(r.head.name+=String.fromCharCode(ch));while(ch&&ze<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1$1(r.check,n,ze,s)),o-=ze,s+=ze,ch)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT$1;case COMMENT$1:if(r.flags&4096){if(o===0)break e;ze=0;do ch=n[s+ze++],r.head&&ch&&r.length<65536&&(r.head.comment+=String.fromCharCode(ch));while(ch&&ze<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1$1(r.check,n,ze,s)),o-=ze,s+=ze,ch)break e}else r.head&&(r.head.comment=null);r.mode=HCRC$1;case HCRC$1:if(r.flags&512){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.check&65535)){e.msg="header crc mismatch",r.mode=BAD$2;break}C=0,P=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE$2;break;case DICTID$1:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}e.adler=r.check=zswap32$1(C),C=0,P=0,r.mode=DICT$1;case DICT$1:if(r.havedict===0)return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,Z_NEED_DICT$1$1;e.adler=r.check=1,r.mode=TYPE$2;case TYPE$2:if(t===Z_BLOCK$2||t===Z_TREES$1)break e;case TYPEDO$1:if(r.last){C>>>=P&7,P-=P&7,r.mode=CHECK$1;break}for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}switch(r.last=C&1,C>>>=1,P-=1,C&3){case 0:r.mode=STORED$1;break;case 1:if(fixedtables$1(r),r.mode=LEN_$1,t===Z_TREES$1){C>>>=2,P-=2;break e}break;case 2:r.mode=TABLE$1;break;case 3:e.msg="invalid block type",r.mode=BAD$2}C>>>=2,P-=2;break;case STORED$1:for(C>>>=P&7,P-=P&7;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if((C&65535)!==(C>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD$2;break}if(r.length=C&65535,C=0,P=0,r.mode=COPY_$1,t===Z_TREES$1)break e;case COPY_$1:r.mode=COPY$1;case COPY$1:if(ze=r.length,ze){if(ze>o&&(ze=o),ze>x&&(ze=x),ze===0)break e;a.set(n.subarray(s,s+ze),f),o-=ze,s+=ze,x-=ze,f+=ze,r.length-=ze;break}r.mode=TYPE$2;break;case TABLE$1:for(;P<14;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.nlen=(C&31)+257,C>>>=5,P-=5,r.ndist=(C&31)+1,C>>>=5,P-=5,r.ncode=(C&15)+4,C>>>=4,P-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD$2;break}r.have=0,r.mode=LENLENS$1;case LENLENS$1:for(;r.have<r.ncode;){for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.lens[hh[r.have++]]=C&7,C>>>=3,P-=3}for(;r.have<19;)r.lens[hh[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,sl={bits:r.lenbits},ju=inftrees$1(CODES$2,r.lens,0,19,r.lencode,0,r.work,sl),r.lenbits=sl.bits,ju){e.msg="invalid code lengths set",r.mode=BAD$2;break}r.have=0,r.mode=CODELENS$1;case CODELENS$1:for(;r.have<r.nlen+r.ndist;){for(;_n=r.lencode[C&(1<<r.lenbits)-1],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(Io<16)C>>>=Fn,P-=Fn,r.lens[r.have++]=Io;else{if(Io===16){for(oh=Fn+2;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(C>>>=Fn,P-=Fn,r.have===0){e.msg="invalid bit length repeat",r.mode=BAD$2;break}ch=r.lens[r.have-1],ze=3+(C&3),C>>>=2,P-=2}else if(Io===17){for(oh=Fn+3;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Fn,P-=Fn,ch=0,ze=3+(C&7),C>>>=3,P-=3}else{for(oh=Fn+7;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Fn,P-=Fn,ch=0,ze=11+(C&127),C>>>=7,P-=7}if(r.have+ze>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD$2;break}for(;ze--;)r.lens[r.have++]=ch}}if(r.mode===BAD$2)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=BAD$2;break}if(r.lenbits=9,sl={bits:r.lenbits},ju=inftrees$1(LENS$2,r.lens,0,r.nlen,r.lencode,0,r.work,sl),r.lenbits=sl.bits,ju){e.msg="invalid literal/lengths set",r.mode=BAD$2;break}if(r.distbits=6,r.distcode=r.distdyn,sl={bits:r.distbits},ju=inftrees$1(DISTS$2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,sl),r.distbits=sl.bits,ju){e.msg="invalid distances set",r.mode=BAD$2;break}if(r.mode=LEN_$1,t===Z_TREES$1)break e;case LEN_$1:r.mode=LEN$1;case LEN$1:if(o>=6&&x>=258){e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,inffast$1(e,nt),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,r.mode===TYPE$2&&(r.back=-1);break}for(r.back=0;_n=r.lencode[C&(1<<r.lenbits)-1],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(tl&&!(tl&240)){for(Co=Fn,rl=tl,ah=Io;_n=r.lencode[ah+((C&(1<<Co+rl)-1)>>Co)],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Co+Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Co,P-=Co,r.back+=Co}if(C>>>=Fn,P-=Fn,r.back+=Fn,r.length=Io,tl===0){r.mode=LIT$1;break}if(tl&32){r.back=-1,r.mode=TYPE$2;break}if(tl&64){e.msg="invalid literal/length code",r.mode=BAD$2;break}r.extra=tl&15,r.mode=LENEXT$1;case LENEXT$1:if(r.extra){for(oh=r.extra;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST$1;case DIST$1:for(;_n=r.distcode[C&(1<<r.distbits)-1],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(!(tl&240)){for(Co=Fn,rl=tl,ah=Io;_n=r.distcode[ah+((C&(1<<Co+rl)-1)>>Co)],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Co+Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Co,P-=Co,r.back+=Co}if(C>>>=Fn,P-=Fn,r.back+=Fn,tl&64){e.msg="invalid distance code",r.mode=BAD$2;break}r.offset=Io,r.extra=tl&15,r.mode=DISTEXT$1;case DISTEXT$1:if(r.extra){for(oh=r.extra;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.offset+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD$2;break}r.mode=MATCH$1;case MATCH$1:if(x===0)break e;if(ze=nt-x,r.offset>ze){if(ze=r.offset-ze,ze>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD$2;break}ze>r.wnext?(ze-=r.wnext,Bt=r.wsize-ze):Bt=r.wnext-ze,ze>r.length&&(ze=r.length),qr=r.window}else qr=a,Bt=f-r.offset,ze=r.length;ze>x&&(ze=x),x-=ze,r.length-=ze;do a[f++]=qr[Bt++];while(--ze);r.length===0&&(r.mode=LEN$1);break;case LIT$1:if(x===0)break e;a[f++]=r.length,x--,r.mode=LEN$1;break;case CHECK$1:if(r.wrap){for(;P<32;){if(o===0)break e;o--,C|=n[s++]<<P,P+=8}if(nt-=x,e.total_out+=nt,r.total+=nt,r.wrap&4&&nt&&(e.adler=r.check=r.flags?crc32_1$1(r.check,a,nt,f-nt):adler32_1$1(r.check,a,nt,f-nt)),nt=x,r.wrap&4&&(r.flags?C:zswap32$1(C))!==r.check){e.msg="incorrect data check",r.mode=BAD$2;break}C=0,P=0}r.mode=LENGTH$1;case LENGTH$1:if(r.wrap&&r.flags){for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=BAD$2;break}C=0,P=0}r.mode=DONE$1;case DONE$1:ju=Z_STREAM_END$1$1;break e;case BAD$2:ju=Z_DATA_ERROR$1$1;break e;case MEM$1:return Z_MEM_ERROR$1$1;case SYNC$1:default:return Z_STREAM_ERROR$1$1}return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,(r.wsize||nt!==e.avail_out&&r.mode<BAD$2&&(r.mode<CHECK$1||t!==Z_FINISH$1$1))&&updatewindow$1(e,e.output,e.next_out,nt-e.avail_out),ge-=e.avail_in,nt-=e.avail_out,e.total_in+=ge,e.total_out+=nt,r.total+=nt,r.wrap&4&&nt&&(e.adler=r.check=r.flags?crc32_1$1(r.check,a,nt,e.next_out-nt):adler32_1$1(r.check,a,nt,e.next_out-nt)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$2?128:0)+(r.mode===LEN_$1||r.mode===COPY_$1?256:0),(ge===0&&nt===0||t===Z_FINISH$1$1)&&ju===Z_OK$1$1&&(ju=Z_BUF_ERROR$2),ju},inflateEnd$1=e=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1$1},inflateGetHeader$1=(e,t)=>{if(inflateStateCheck$1(e))return Z_STREAM_ERROR$1$1;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,Z_OK$1$1):Z_STREAM_ERROR$1$1},inflateSetDictionary$1=(e,t)=>{const r=t.length;let n,a,s;return inflateStateCheck$1(e)||(n=e.state,n.wrap!==0&&n.mode!==DICT$1)?Z_STREAM_ERROR$1$1:n.mode===DICT$1&&(a=1,a=adler32_1$1(a,t,r,0),a!==n.check)?Z_DATA_ERROR$1$1:(s=updatewindow$1(e,t,r,r),s?(n.mode=MEM$1,Z_MEM_ERROR$1$1):(n.havedict=1,Z_OK$1$1))};var inflateReset_1$1=inflateReset$1,inflateReset2_1$1=inflateReset2$1,inflateResetKeep_1$1=inflateResetKeep$1,inflateInit_1$1=inflateInit$1,inflateInit2_1$1=inflateInit2$1,inflate_2$1$1=inflate$2$1,inflateEnd_1$1=inflateEnd$1,inflateGetHeader_1$1=inflateGetHeader$1,inflateSetDictionary_1$1=inflateSetDictionary$1,inflateInfo$1="pako inflate (from Nodeca project)",inflate_1$2$1={inflateReset:inflateReset_1$1,inflateReset2:inflateReset2_1$1,inflateResetKeep:inflateResetKeep_1$1,inflateInit:inflateInit_1$1,inflateInit2:inflateInit2_1$1,inflate:inflate_2$1$1,inflateEnd:inflateEnd_1$1,inflateGetHeader:inflateGetHeader_1$1,inflateSetDictionary:inflateSetDictionary_1$1,inflateInfo:inflateInfo$1};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader$1=GZheader$1;const toString$6=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$3,Z_FINISH:Z_FINISH$4,Z_OK:Z_OK$4,Z_STREAM_END:Z_STREAM_END$4,Z_NEED_DICT:Z_NEED_DICT$2,Z_STREAM_ERROR:Z_STREAM_ERROR$3,Z_DATA_ERROR:Z_DATA_ERROR$3,Z_MEM_ERROR:Z_MEM_ERROR$2}=constants$2$2;function Inflate$1$1(e){this.options=common$1.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream$1,this.strm.avail_out=0;let r=inflate_1$2$1.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK$4)throw new Error(messages$1[r]);if(this.header=new gzheader$1,inflate_1$2$1.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings$1.string2buf(t.dictionary):toString$6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1$2$1.inflateSetDictionary(this.strm,t.dictionary),r!==Z_OK$4)))throw new Error(messages$1[r])}Inflate$1$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,f,o;if(this.ended)return!1;for(t===~~t?f=t:f=t===!0?Z_FINISH$4:Z_NO_FLUSH$3,toString$6.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=inflate_1$2$1.inflate(r,f),s===Z_NEED_DICT$2&&a&&(s=inflate_1$2$1.inflateSetDictionary(r,a),s===Z_OK$4?s=inflate_1$2$1.inflate(r,f):s===Z_DATA_ERROR$3&&(s=Z_NEED_DICT$2));r.avail_in>0&&s===Z_STREAM_END$4&&r.state.wrap>0&&e[r.next_in]!==0;)inflate_1$2$1.inflateReset(r),s=inflate_1$2$1.inflate(r,f);switch(s){case Z_STREAM_ERROR$3:case Z_DATA_ERROR$3:case Z_NEED_DICT$2:case Z_MEM_ERROR$2:return this.onEnd(s),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(r.avail_out===0||s===Z_STREAM_END$4))if(this.options.to==="string"){let x=strings$1.utf8border(r.output,r.next_out),C=r.next_out-x,P=strings$1.buf2string(r.output,x);r.next_out=C,r.avail_out=n-C,C&&r.output.set(r.output.subarray(x,x+C),0),this.onData(P)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===Z_OK$4&&o===0)){if(s===Z_STREAM_END$4)return s=inflate_1$2$1.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Inflate$1$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1$1.prototype.onEnd=function(e){e===Z_OK$4&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1$1(e,t){const r=new Inflate$1$1(t);if(r.push(e),r.err)throw r.msg||messages$1[r.err];return r.result}function inflateRaw$1$1(e,t){return t=t||{},t.raw=!0,inflate$1$1(e,t)}var Inflate_1$1$1=Inflate$1$1,inflate_2$2=inflate$1$1,inflateRaw_1$1$1=inflateRaw$1$1,ungzip$1$1=inflate$1$1,constants$b=constants$2$2,inflate_1$1$1={Inflate:Inflate_1$1$1,inflate:inflate_2$2,inflateRaw:inflateRaw_1$1$1,ungzip:ungzip$1$1,constants:constants$b};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate:Inflate$2,inflate:inflate$3,inflateRaw:inflateRaw$2,ungzip:ungzip$2}=inflate_1$1$1;var deflate_1=deflate,Inflate_1=Inflate$2,inflate_1$3=inflate$3;const pngSignature=[137,80,78,71,13,10,26,10],crcTable$1=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable$1[e]=t}const initialCrc=4294967295;function updateCrc(e,t,r){let n=e;for(let a=0;a<r;a++)n=crcTable$1[(n^t[a])&255]^n>>>8;return n}function crc(e,t){return(updateCrc(initialCrc,e,t)^initialCrc)>>>0}var ColorType;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,r={}){super(t);const{checkCrc:n=!1}=r;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),r=this.readChars(4),n=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${r}`);if(this._checkCrc){const a=this.readUint32(),s=t+4,f=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(f!==a)throw new Error(`CRC mismatch for chunk ${r}. Expected ${a}, found ${f}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const r=this.readUint8();this._colorType=r;let n;switch(r){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const r=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let a=0;a<r;a++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(this._colorType===3){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let r=0;for(;r<t;r++){const n=this.readByte();this._palette[r].push(n)}for(;r<this._palette.length;r++)this._palette[r].push(255)}}decodeiCCP(t){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;const a=this.readUint8();if(a!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const s=this.readBytes(t-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:inflate_1$3(s)}}decodetEXt(t){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;this._png.text[r]=this.readChars(t-r.length-1)}decodepHYs(){const t=this.readUint32(),r=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:r,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const r=this._png.height,n=this._png.channels*this._png.depth/8,a=this._png.width*n,s=new Uint8Array(this._png.height*a);let f=empty,o=0,x,C;for(let P=0;P<r;P++){switch(x=t.subarray(o+1,o+1+a),C=s.subarray(P*a,(P+1)*a),t[o]){case 0:unfilterNone(x,C,a);break;case 1:unfilterSub(x,C,a,n);break;case 2:unfilterUp(x,C,f,a);break;case 3:unfilterAverage(x,C,f,a,n);break;case 4:unfilterPaeth(x,C,f,a,n);break;default:throw new Error(`Unsupported filter: ${t[o]}`)}f=C,o+=a+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const P=new Uint16Array(s.buffer);if(osIsLittleEndian)for(let ge=0;ge<P.length;ge++)P[ge]=swap16(P[ge]);this._png.data=P}else this._png.data=s}}function unfilterNone(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function unfilterSub(e,t,r,n){let a=0;for(;a<n;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+t[a-n]&255}function unfilterUp(e,t,r,n){let a=0;if(r.length===0)for(;a<n;a++)t[a]=e[a];else for(;a<n;a++)t[a]=e[a]+r[a]&255}function unfilterAverage(e,t,r,n,a){let s=0;if(r.length===0){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+(t[s-a]>>1)&255}else{for(;s<a;s++)t[s]=e[s]+(r[s]>>1)&255;for(;s<n;s++)t[s]=e[s]+(t[s-a]+r[s]>>1)&255}}function unfilterPaeth(e,t,r,n,a){let s=0;if(r.length===0){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-a]&255}else{for(;s<a;s++)t[s]=e[s]+r[s]&255;for(;s<n;s++)t[s]=e[s]+paethPredictor(t[s-a],r[s],r[s-a])&255}}function paethPredictor(e,t,r){const n=e+t-r,a=Math.abs(n-e),s=Math.abs(n-t),f=Math.abs(n-r);return a<=s&&a<=f?e:s<=f?t:r}function swap16(e){return(e&255)<<8|e>>8&255}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,r={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,r.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:r,channels:n,depth:a,data:s}=this._png,f=n*t,o=new IOBuffer$4().setBigEndian();let x=0;for(let ge=0;ge<r;ge++)if(o.writeByte(0),a===8)x=writeDataBytes(s,o,f,x);else if(a===16)x=writeDataUint16(s,o,f,x);else throw new Error("unreachable");const C=o.toArray(),P=deflate_1(C,this._zlibOptions);this.encodeIDAT(P)}_checkData(t){const{colorType:r,channels:n,depth:a}=getColorType(t),s={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:n,data:t.data,depth:a,text:{}};this._colorType=r;const f=s.width*s.height*n;if(s.data.length!==f)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${f}`);return s}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function getColorType(e){const{channels:t=4,depth:r=8}=e;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(r!==8&&r!==16)throw new RangeError(`unsupported bit depth: ${r}`);const n={channels:t,depth:r,colorType:ColorType.UNKNOWN};switch(t){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(e,t,r,n){for(let a=0;a<r;a++)t.writeByte(e[n++]);return n}function writeDataUint16(e,t,r,n){for(let a=0;a<r;a++)t.writeUint16(e[n++]);return n}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,t){return new PngDecoder(e,t).decode()}function encodePng$1(e,t){return new PngEncoder(e,t).encode()}var encoder={exports:{}};(function(e){function t(n){var a=Math.floor,s=new Array(64),f=new Array(64),o=new Array(64),x=new Array(64),C,P,ge,nt,ze=new Array(65535),Bt=new Array(65535),qr=new Array(64),_n=new Array(64),Fn=[],tl=0,Io=7,Co=new Array(64),rl=new Array(64),ah=new Array(64),ch=new Array(256),ju=new Array(2048),Zu,sl=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],oh=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],hh=[0,1,2,3,4,5,6,7,8,9,10,11],Sh=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],$h=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],hd=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],vd=[0,1,2,3,4,5,6,7,8,9,10,11],Ef=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Cd=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Cf(Kh){for(var Qd=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],fd=0;fd<64;fd++){var Jd=a((Qd[fd]*Kh+50)/100);Jd<1?Jd=1:Jd>255&&(Jd=255),s[sl[fd]]=Jd}for(var Yh=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],$d=0;$d<64;$d++){var Jf=a((Yh[$d]*Kh+50)/100);Jf<1?Jf=1:Jf>255&&(Jf=255),f[sl[$d]]=Jf}for(var Sf=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],If=0,Xf=0;Xf<8;Xf++)for(var Of=0;Of<8;Of++)o[If]=1/(s[sl[If]]*Sf[Xf]*Sf[Of]*8),x[If]=1/(f[sl[If]]*Sf[Xf]*Sf[Of]*8),If++}function Sd(Kh,Qd){for(var fd=0,Jd=0,Yh=new Array,$d=1;$d<=16;$d++){for(var Jf=1;Jf<=Kh[$d];Jf++)Yh[Qd[Jd]]=[],Yh[Qd[Jd]][0]=fd,Yh[Qd[Jd]][1]=$d,Jd++,fd++;fd*=2}return Yh}function yd(){C=Sd(oh,hh),P=Sd(hd,vd),ge=Sd(Sh,$h),nt=Sd(Ef,Cd)}function Hd(){for(var Kh=1,Qd=2,fd=1;fd<=15;fd++){for(var Jd=Kh;Jd<Qd;Jd++)Bt[32767+Jd]=fd,ze[32767+Jd]=[],ze[32767+Jd][1]=fd,ze[32767+Jd][0]=Jd;for(var Yh=-(Qd-1);Yh<=-Kh;Yh++)Bt[32767+Yh]=fd,ze[32767+Yh]=[],ze[32767+Yh][1]=fd,ze[32767+Yh][0]=Qd-1+Yh;Kh<<=1,Qd<<=1}}function xd(){for(var Kh=0;Kh<256;Kh++)ju[Kh]=19595*Kh,ju[Kh+256>>0]=38470*Kh,ju[Kh+512>>0]=7471*Kh+32768,ju[Kh+768>>0]=-11059*Kh,ju[Kh+1024>>0]=-21709*Kh,ju[Kh+1280>>0]=32768*Kh+8421375,ju[Kh+1536>>0]=-27439*Kh,ju[Kh+1792>>0]=-5329*Kh}function Pd(Kh){for(var Qd=Kh[0],fd=Kh[1]-1;fd>=0;)Qd&1<<fd&&(tl|=1<<Io),fd--,Io--,Io<0&&(tl==255?(zd(255),zd(0)):zd(tl),Io=7,tl=0)}function zd(Kh){Fn.push(Kh)}function Ld(Kh){zd(Kh>>8&255),zd(Kh&255)}function Kd(Kh,Qd){var fd,Jd,Yh,$d,Jf,Sf,If,Xf,Of=0,jf,Ap=8,vp=64;for(jf=0;jf<Ap;++jf){fd=Kh[Of],Jd=Kh[Of+1],Yh=Kh[Of+2],$d=Kh[Of+3],Jf=Kh[Of+4],Sf=Kh[Of+5],If=Kh[Of+6],Xf=Kh[Of+7];var Tp=fd+Xf,Zf=fd-Xf,qp=Jd+If,sm=Jd-If,Wd=Yh+Sf,$p=Yh-Sf,Lh=$d+Jf,lh=$d-Jf,ih=Tp+Lh,Ah=Tp-Lh,zh=qp+Wd,Qh=qp-Wd;Kh[Of]=ih+zh,Kh[Of+4]=ih-zh;var Th=(Qh+Ah)*.707106781;Kh[Of+2]=Ah+Th,Kh[Of+6]=Ah-Th,ih=lh+$p,zh=$p+sm,Qh=sm+Zf;var Fh=(ih-Qh)*.382683433,al=.5411961*ih+Fh,fh=1.306562965*Qh+Fh,nl=zh*.707106781,Zs=Zf+nl,ol=Zf-nl;Kh[Of+5]=ol+al,Kh[Of+3]=ol-al,Kh[Of+1]=Zs+fh,Kh[Of+7]=Zs-fh,Of+=8}for(Of=0,jf=0;jf<Ap;++jf){fd=Kh[Of],Jd=Kh[Of+8],Yh=Kh[Of+16],$d=Kh[Of+24],Jf=Kh[Of+32],Sf=Kh[Of+40],If=Kh[Of+48],Xf=Kh[Of+56];var sh=fd+Xf,xh=fd-Xf,Mh=Jd+If,Uh=Jd-If,Nh=Yh+Sf,Zh=Yh-Sf,td=$d+Jf,Ad=$d-Jf,Zd=sh+td,Fd=sh-td,Kf=Mh+Nh,up=Mh-Nh;Kh[Of]=Zd+Kf,Kh[Of+32]=Zd-Kf;var ap=(up+Fd)*.707106781;Kh[Of+16]=Fd+ap,Kh[Of+48]=Fd-ap,Zd=Ad+Zh,Kf=Zh+Uh,up=Uh+xh;var wp=(Zd-up)*.382683433,Hp=.5411961*Zd+wp,Ip=1.306562965*up+wp,Gh=Kf*.707106781,Nf=xh+Gh,Hf=xh-Gh;Kh[Of+40]=Hf+Hp,Kh[Of+24]=Hf-Hp,Kh[Of+8]=Nf+Ip,Kh[Of+56]=Nf-Ip,Of++}var mp;for(jf=0;jf<vp;++jf)mp=Kh[jf]*Qd[jf],qr[jf]=mp>0?mp+.5|0:mp-.5|0;return qr}function wf(){Ld(65504),Ld(16),zd(74),zd(70),zd(73),zd(70),zd(0),zd(1),zd(1),zd(0),Ld(1),Ld(1),zd(0),zd(0)}function kd(Kh){if(Kh){Ld(65505),Kh[0]===69&&Kh[1]===120&&Kh[2]===105&&Kh[3]===102?Ld(Kh.length+2):(Ld(Kh.length+5+2),zd(69),zd(120),zd(105),zd(102),zd(0));for(var Qd=0;Qd<Kh.length;Qd++)zd(Kh[Qd])}}function cd(Kh,Qd){Ld(65472),Ld(17),zd(8),Ld(Qd),Ld(Kh),zd(3),zd(1),zd(17),zd(0),zd(2),zd(17),zd(1),zd(3),zd(17),zd(1)}function gd(){Ld(65499),Ld(132),zd(0);for(var Kh=0;Kh<64;Kh++)zd(s[Kh]);zd(1);for(var Qd=0;Qd<64;Qd++)zd(f[Qd])}function bp(){Ld(65476),Ld(418),zd(0);for(var Kh=0;Kh<16;Kh++)zd(oh[Kh+1]);for(var Qd=0;Qd<=11;Qd++)zd(hh[Qd]);zd(16);for(var fd=0;fd<16;fd++)zd(Sh[fd+1]);for(var Jd=0;Jd<=161;Jd++)zd($h[Jd]);zd(1);for(var Yh=0;Yh<16;Yh++)zd(hd[Yh+1]);for(var $d=0;$d<=11;$d++)zd(vd[$d]);zd(17);for(var Jf=0;Jf<16;Jf++)zd(Ef[Jf+1]);for(var Sf=0;Sf<=161;Sf++)zd(Cd[Sf])}function Uf(Kh){typeof Kh>"u"||Kh.constructor!==Array||Kh.forEach(Qd=>{if(typeof Qd=="string"){Ld(65534);var fd=Qd.length;Ld(fd+2);var Jd;for(Jd=0;Jd<fd;Jd++)zd(Qd.charCodeAt(Jd))}})}function qd(){Ld(65498),Ld(12),zd(3),zd(1),zd(0),zd(2),zd(17),zd(3),zd(17),zd(0),zd(63),zd(0)}function Vd(Kh,Qd,fd,Jd,Yh){for(var $d=Yh[0],Jf=Yh[240],Sf,If=16,Xf=63,Of=64,jf=Kd(Kh,Qd),Ap=0;Ap<Of;++Ap)_n[sl[Ap]]=jf[Ap];var vp=_n[0]-fd;fd=_n[0],vp==0?Pd(Jd[0]):(Sf=32767+vp,Pd(Jd[Bt[Sf]]),Pd(ze[Sf]));for(var Tp=63;Tp>0&&_n[Tp]==0;Tp--);if(Tp==0)return Pd($d),fd;for(var Zf=1,qp;Zf<=Tp;){for(var sm=Zf;_n[Zf]==0&&Zf<=Tp;++Zf);var Wd=Zf-sm;if(Wd>=If){qp=Wd>>4;for(var $p=1;$p<=qp;++$p)Pd(Jf);Wd=Wd&15}Sf=32767+_n[Zf],Pd(Yh[(Wd<<4)+Bt[Sf]]),Pd(ze[Sf]),Zf++}return Tp!=Xf&&Pd($d),fd}function ep(){for(var Kh=String.fromCharCode,Qd=0;Qd<256;Qd++)ch[Qd]=Kh(Qd)}this.encode=function(Kh,Qd){new Date().getTime(),Qd&&_p(Qd),Fn=new Array,tl=0,Io=7,Ld(65496),wf(),Uf(Kh.comments),kd(Kh.exifBuffer),gd(),cd(Kh.width,Kh.height),bp(),qd();var fd=0,Jd=0,Yh=0;tl=0,Io=7,this.encode.displayName="_encode_";for(var $d=Kh.data,Jf=Kh.width,Sf=Kh.height,If=Jf*4,Xf,Of=0,jf,Ap,vp,Tp,Zf,qp,sm,Wd;Of<Sf;){for(Xf=0;Xf<If;){for(Tp=If*Of+Xf,Zf=Tp,qp=-1,sm=0,Wd=0;Wd<64;Wd++)sm=Wd>>3,qp=(Wd&7)*4,Zf=Tp+sm*If+qp,Of+sm>=Sf&&(Zf-=If*(Of+1+sm-Sf)),Xf+qp>=If&&(Zf-=Xf+qp-If+4),jf=$d[Zf++],Ap=$d[Zf++],vp=$d[Zf++],Co[Wd]=(ju[jf]+ju[Ap+256>>0]+ju[vp+512>>0]>>16)-128,rl[Wd]=(ju[jf+768>>0]+ju[Ap+1024>>0]+ju[vp+1280>>0]>>16)-128,ah[Wd]=(ju[jf+1280>>0]+ju[Ap+1536>>0]+ju[vp+1792>>0]>>16)-128;fd=Vd(Co,o,fd,C,ge),Jd=Vd(rl,x,Jd,P,nt),Yh=Vd(ah,x,Yh,P,nt),Xf+=32}Of+=8}if(Io>=0){var $p=[];$p[1]=Io+1,$p[0]=(1<<Io+1)-1,Pd($p)}return Ld(65497),Buffer.from(Fn)};function _p(Kh){if(Kh<=0&&(Kh=1),Kh>100&&(Kh=100),Zu!=Kh){var Qd=0;Kh<50?Qd=Math.floor(5e3/Kh):Qd=Math.floor(200-Kh*2),Cf(Qd),Zu=Kh}}function lp(){var Kh=new Date().getTime();n||(n=50),ep(),yd(),Hd(),xd(),_p(n),new Date().getTime()-Kh}lp()}e.exports=r;function r(n,a){typeof a>"u"&&(a=50);var s=new t(a),f=s.encode(n,a);return{data:f,width:n.width,height:n.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(e){var t=function(){var a=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,f=799,o=3406,x=2276,C=1567,P=3784,ge=5793,nt=2896;function ze(){}function Bt(rl,ah){for(var ch=0,ju=[],Zu,sl,oh=16;oh>0&&!rl[oh-1];)oh--;ju.push({children:[],index:0});var hh=ju[0],Sh;for(Zu=0;Zu<oh;Zu++){for(sl=0;sl<rl[Zu];sl++){for(hh=ju.pop(),hh.children[hh.index]=ah[ch];hh.index>0;){if(ju.length===0)throw new Error("Could not recreate Huffman Table");hh=ju.pop()}for(hh.index++,ju.push(hh);ju.length<=Zu;)ju.push(Sh={children:[],index:0}),hh.children[hh.index]=Sh.children,hh=Sh;ch++}Zu+1<oh&&(ju.push(Sh={children:[],index:0}),hh.children[hh.index]=Sh.children,hh=Sh)}return ju[0].children}function qr(rl,ah,ch,ju,Zu,sl,oh,hh,Sh,$h){ch.precision,ch.samplesPerLine,ch.scanLines;var hd=ch.mcusPerLine,vd=ch.progressive;ch.maxH,ch.maxV;var Ef=ah,Cd=0,Cf=0;function Sd(){if(Cf>0)return Cf--,Cd>>Cf&1;if(Cd=rl[ah++],Cd==255){var Sf=rl[ah++];if(Sf)throw new Error("unexpected marker: "+(Cd<<8|Sf).toString(16))}return Cf=7,Cd>>>7}function yd(Sf){for(var If=Sf,Xf;(Xf=Sd())!==null;){if(If=If[Xf],typeof If=="number")return If;if(typeof If!="object")throw new Error("invalid huffman sequence")}return null}function Hd(Sf){for(var If=0;Sf>0;){var Xf=Sd();if(Xf===null)return;If=If<<1|Xf,Sf--}return If}function xd(Sf){var If=Hd(Sf);return If>=1<<Sf-1?If:If+(-1<<Sf)+1}function Pd(Sf,If){var Xf=yd(Sf.huffmanTableDC),Of=Xf===0?0:xd(Xf);If[0]=Sf.pred+=Of;for(var jf=1;jf<64;){var Ap=yd(Sf.huffmanTableAC),vp=Ap&15,Tp=Ap>>4;if(vp===0){if(Tp<15)break;jf+=16;continue}jf+=Tp;var Zf=a[jf];If[Zf]=xd(vp),jf++}}function zd(Sf,If){var Xf=yd(Sf.huffmanTableDC),Of=Xf===0?0:xd(Xf)<<Sh;If[0]=Sf.pred+=Of}function Ld(Sf,If){If[0]|=Sd()<<Sh}var Kd=0;function wf(Sf,If){if(Kd>0){Kd--;return}for(var Xf=sl,Of=oh;Xf<=Of;){var jf=yd(Sf.huffmanTableAC),Ap=jf&15,vp=jf>>4;if(Ap===0){if(vp<15){Kd=Hd(vp)+(1<<vp)-1;break}Xf+=16;continue}Xf+=vp;var Tp=a[Xf];If[Tp]=xd(Ap)*(1<<Sh),Xf++}}var kd=0,cd;function gd(Sf,If){for(var Xf=sl,Of=oh,jf=0;Xf<=Of;){var Ap=a[Xf],vp=If[Ap]<0?-1:1;switch(kd){case 0:var Tp=yd(Sf.huffmanTableAC),Zf=Tp&15,jf=Tp>>4;if(Zf===0)jf<15?(Kd=Hd(jf)+(1<<jf),kd=4):(jf=16,kd=1);else{if(Zf!==1)throw new Error("invalid ACn encoding");cd=xd(Zf),kd=jf?2:3}continue;case 1:case 2:If[Ap]?If[Ap]+=(Sd()<<Sh)*vp:(jf--,jf===0&&(kd=kd==2?3:0));break;case 3:If[Ap]?If[Ap]+=(Sd()<<Sh)*vp:(If[Ap]=cd<<Sh,kd=0);break;case 4:If[Ap]&&(If[Ap]+=(Sd()<<Sh)*vp);break}Xf++}kd===4&&(Kd--,Kd===0&&(kd=0))}function bp(Sf,If,Xf,Of,jf){var Ap=Xf/hd|0,vp=Xf%hd,Tp=Ap*Sf.v+Of,Zf=vp*Sf.h+jf;Sf.blocks[Tp]===void 0&&$h.tolerantDecoding||If(Sf,Sf.blocks[Tp][Zf])}function Uf(Sf,If,Xf){var Of=Xf/Sf.blocksPerLine|0,jf=Xf%Sf.blocksPerLine;Sf.blocks[Of]===void 0&&$h.tolerantDecoding||If(Sf,Sf.blocks[Of][jf])}var qd=ju.length,Vd,ep,_p,lp,Kh,Qd;vd?sl===0?Qd=hh===0?zd:Ld:Qd=hh===0?wf:gd:Qd=Pd;var fd=0,Jd,Yh;qd==1?Yh=ju[0].blocksPerLine*ju[0].blocksPerColumn:Yh=hd*ch.mcusPerColumn,Zu||(Zu=Yh);for(var $d,Jf;fd<Yh;){for(ep=0;ep<qd;ep++)ju[ep].pred=0;if(Kd=0,qd==1)for(Vd=ju[0],Kh=0;Kh<Zu;Kh++)Uf(Vd,Qd,fd),fd++;else for(Kh=0;Kh<Zu;Kh++){for(ep=0;ep<qd;ep++)for(Vd=ju[ep],$d=Vd.h,Jf=Vd.v,_p=0;_p<Jf;_p++)for(lp=0;lp<$d;lp++)bp(Vd,Qd,fd,_p,lp);if(fd++,fd===Yh)break}if(fd===Yh)do{if(rl[ah]===255&&rl[ah+1]!==0)break;ah+=1}while(ah<rl.length-2);if(Cf=0,Jd=rl[ah]<<8|rl[ah+1],Jd<65280)throw new Error("marker was not found");if(Jd>=65488&&Jd<=65495)ah+=2;else break}return ah-Ef}function _n(rl,ah){var ch=[],ju=ah.blocksPerLine,Zu=ah.blocksPerColumn,sl=ju<<3,oh=new Int32Array(64),hh=new Uint8Array(64);function Sh(Hd,xd,Pd){var zd=ah.quantizationTable,Ld,Kd,wf,kd,cd,gd,bp,Uf,qd,Vd=Pd,ep;for(ep=0;ep<64;ep++)Vd[ep]=Hd[ep]*zd[ep];for(ep=0;ep<8;++ep){var _p=8*ep;if(Vd[1+_p]==0&&Vd[2+_p]==0&&Vd[3+_p]==0&&Vd[4+_p]==0&&Vd[5+_p]==0&&Vd[6+_p]==0&&Vd[7+_p]==0){qd=ge*Vd[0+_p]+512>>10,Vd[0+_p]=qd,Vd[1+_p]=qd,Vd[2+_p]=qd,Vd[3+_p]=qd,Vd[4+_p]=qd,Vd[5+_p]=qd,Vd[6+_p]=qd,Vd[7+_p]=qd;continue}Ld=ge*Vd[0+_p]+128>>8,Kd=ge*Vd[4+_p]+128>>8,wf=Vd[2+_p],kd=Vd[6+_p],cd=nt*(Vd[1+_p]-Vd[7+_p])+128>>8,Uf=nt*(Vd[1+_p]+Vd[7+_p])+128>>8,gd=Vd[3+_p]<<4,bp=Vd[5+_p]<<4,qd=Ld-Kd+1>>1,Ld=Ld+Kd+1>>1,Kd=qd,qd=wf*P+kd*C+128>>8,wf=wf*C-kd*P+128>>8,kd=qd,qd=cd-bp+1>>1,cd=cd+bp+1>>1,bp=qd,qd=Uf+gd+1>>1,gd=Uf-gd+1>>1,Uf=qd,qd=Ld-kd+1>>1,Ld=Ld+kd+1>>1,kd=qd,qd=Kd-wf+1>>1,Kd=Kd+wf+1>>1,wf=qd,qd=cd*x+Uf*o+2048>>12,cd=cd*o-Uf*x+2048>>12,Uf=qd,qd=gd*f+bp*s+2048>>12,gd=gd*s-bp*f+2048>>12,bp=qd,Vd[0+_p]=Ld+Uf,Vd[7+_p]=Ld-Uf,Vd[1+_p]=Kd+bp,Vd[6+_p]=Kd-bp,Vd[2+_p]=wf+gd,Vd[5+_p]=wf-gd,Vd[3+_p]=kd+cd,Vd[4+_p]=kd-cd}for(ep=0;ep<8;++ep){var lp=ep;if(Vd[8+lp]==0&&Vd[16+lp]==0&&Vd[24+lp]==0&&Vd[32+lp]==0&&Vd[40+lp]==0&&Vd[48+lp]==0&&Vd[56+lp]==0){qd=ge*Pd[ep+0]+8192>>14,Vd[0+lp]=qd,Vd[8+lp]=qd,Vd[16+lp]=qd,Vd[24+lp]=qd,Vd[32+lp]=qd,Vd[40+lp]=qd,Vd[48+lp]=qd,Vd[56+lp]=qd;continue}Ld=ge*Vd[0+lp]+2048>>12,Kd=ge*Vd[32+lp]+2048>>12,wf=Vd[16+lp],kd=Vd[48+lp],cd=nt*(Vd[8+lp]-Vd[56+lp])+2048>>12,Uf=nt*(Vd[8+lp]+Vd[56+lp])+2048>>12,gd=Vd[24+lp],bp=Vd[40+lp],qd=Ld-Kd+1>>1,Ld=Ld+Kd+1>>1,Kd=qd,qd=wf*P+kd*C+2048>>12,wf=wf*C-kd*P+2048>>12,kd=qd,qd=cd-bp+1>>1,cd=cd+bp+1>>1,bp=qd,qd=Uf+gd+1>>1,gd=Uf-gd+1>>1,Uf=qd,qd=Ld-kd+1>>1,Ld=Ld+kd+1>>1,kd=qd,qd=Kd-wf+1>>1,Kd=Kd+wf+1>>1,wf=qd,qd=cd*x+Uf*o+2048>>12,cd=cd*o-Uf*x+2048>>12,Uf=qd,qd=gd*f+bp*s+2048>>12,gd=gd*s-bp*f+2048>>12,bp=qd,Vd[0+lp]=Ld+Uf,Vd[56+lp]=Ld-Uf,Vd[8+lp]=Kd+bp,Vd[48+lp]=Kd-bp,Vd[16+lp]=wf+gd,Vd[40+lp]=wf-gd,Vd[24+lp]=kd+cd,Vd[32+lp]=kd-cd}for(ep=0;ep<64;++ep){var Kh=128+(Vd[ep]+8>>4);xd[ep]=Kh<0?0:Kh>255?255:Kh}}Co(sl*Zu*8);for(var $h,hd,vd=0;vd<Zu;vd++){var Ef=vd<<3;for($h=0;$h<8;$h++)ch.push(new Uint8Array(sl));for(var Cd=0;Cd<ju;Cd++){Sh(ah.blocks[vd][Cd],hh,oh);var Cf=0,Sd=Cd<<3;for(hd=0;hd<8;hd++){var yd=ch[Ef+hd];for($h=0;$h<8;$h++)yd[Sd+$h]=hh[Cf++]}}}return ch}function Fn(rl){return rl<0?0:rl>255?255:rl}ze.prototype={load:function(ah){var ch=new XMLHttpRequest;ch.open("GET",ah,!0),ch.responseType="arraybuffer",ch.onload=function(){var ju=new Uint8Array(ch.response||ch.mozResponseArrayBuffer);this.parse(ju),this.onload&&this.onload()}.bind(this),ch.send(null)},parse:function(ah){var ch=this.opts.maxResolutionInMP*1e3*1e3,ju=0;ah.length;function Zu(){var vp=ah[ju]<<8|ah[ju+1];return ju+=2,vp}function sl(){var vp=Zu(),Tp=ah.subarray(ju,ju+vp-2);return ju+=Tp.length,Tp}function oh(vp){var Tp=1,Zf=1,qp,sm;for(sm in vp.components)vp.components.hasOwnProperty(sm)&&(qp=vp.components[sm],Tp<qp.h&&(Tp=qp.h),Zf<qp.v&&(Zf=qp.v));var Wd=Math.ceil(vp.samplesPerLine/8/Tp),$p=Math.ceil(vp.scanLines/8/Zf);for(sm in vp.components)if(vp.components.hasOwnProperty(sm)){qp=vp.components[sm];var Lh=Math.ceil(Math.ceil(vp.samplesPerLine/8)*qp.h/Tp),lh=Math.ceil(Math.ceil(vp.scanLines/8)*qp.v/Zf),ih=Wd*qp.h,Ah=$p*qp.v,zh=Ah*ih,Qh=[];Co(zh*256);for(var Th=0;Th<Ah;Th++){for(var Fh=[],al=0;al<ih;al++)Fh.push(new Int32Array(64));Qh.push(Fh)}qp.blocksPerLine=Lh,qp.blocksPerColumn=lh,qp.blocks=Qh}vp.maxH=Tp,vp.maxV=Zf,vp.mcusPerLine=Wd,vp.mcusPerColumn=$p}var hh=null,Sh=null,$h,hd,vd=[],Ef=[],Cd=[],Cf=[],Sd=Zu(),yd=-1;if(this.comments=[],Sd!=65496)throw new Error("SOI not found");for(Sd=Zu();Sd!=65497;){var Hd,xd;switch(Sd){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Pd=sl();if(Sd===65534){var zd=String.fromCharCode.apply(null,Pd);this.comments.push(zd)}Sd===65504&&Pd[0]===74&&Pd[1]===70&&Pd[2]===73&&Pd[3]===70&&Pd[4]===0&&(hh={version:{major:Pd[5],minor:Pd[6]},densityUnits:Pd[7],xDensity:Pd[8]<<8|Pd[9],yDensity:Pd[10]<<8|Pd[11],thumbWidth:Pd[12],thumbHeight:Pd[13],thumbData:Pd.subarray(14,14+3*Pd[12]*Pd[13])}),Sd===65505&&Pd[0]===69&&Pd[1]===120&&Pd[2]===105&&Pd[3]===102&&Pd[4]===0&&(this.exifBuffer=Pd.subarray(5,Pd.length)),Sd===65518&&Pd[0]===65&&Pd[1]===100&&Pd[2]===111&&Pd[3]===98&&Pd[4]===101&&Pd[5]===0&&(Sh={version:Pd[6],flags0:Pd[7]<<8|Pd[8],flags1:Pd[9]<<8|Pd[10],transformCode:Pd[11]});break;case 65499:for(var Ld=Zu(),Kd=Ld+ju-2;ju<Kd;){var wf=ah[ju++];Co(256);var kd=new Int32Array(64);if(wf>>4)if(wf>>4===1)for(xd=0;xd<64;xd++){var cd=a[xd];kd[cd]=Zu()}else throw new Error("DQT: invalid table spec");else for(xd=0;xd<64;xd++){var cd=a[xd];kd[cd]=ah[ju++]}vd[wf&15]=kd}break;case 65472:case 65473:case 65474:Zu(),$h={},$h.extended=Sd===65473,$h.progressive=Sd===65474,$h.precision=ah[ju++],$h.scanLines=Zu(),$h.samplesPerLine=Zu(),$h.components={},$h.componentsOrder=[];var gd=$h.scanLines*$h.samplesPerLine;if(gd>ch){var bp=Math.ceil((gd-ch)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${bp}MP`)}var Uf=ah[ju++],qd;for(Hd=0;Hd<Uf;Hd++){qd=ah[ju];var Vd=ah[ju+1]>>4,ep=ah[ju+1]&15,_p=ah[ju+2];if(Vd<=0||ep<=0)throw new Error("Invalid sampling factor, expected values above 0");$h.componentsOrder.push(qd),$h.components[qd]={h:Vd,v:ep,quantizationIdx:_p},ju+=3}oh($h),Ef.push($h);break;case 65476:var lp=Zu();for(Hd=2;Hd<lp;){var Kh=ah[ju++],Qd=new Uint8Array(16),fd=0;for(xd=0;xd<16;xd++,ju++)fd+=Qd[xd]=ah[ju];Co(16+fd);var Jd=new Uint8Array(fd);for(xd=0;xd<fd;xd++,ju++)Jd[xd]=ah[ju];Hd+=17+fd,(Kh>>4?Cd:Cf)[Kh&15]=Bt(Qd,Jd)}break;case 65501:Zu(),hd=Zu();break;case 65500:Zu(),Zu();break;case 65498:Zu();var Yh=ah[ju++],$d=[],Jf;for(Hd=0;Hd<Yh;Hd++){Jf=$h.components[ah[ju++]];var Sf=ah[ju++];Jf.huffmanTableDC=Cf[Sf>>4],Jf.huffmanTableAC=Cd[Sf&15],$d.push(Jf)}var If=ah[ju++],Xf=ah[ju++],Of=ah[ju++],jf=qr(ah,ju,$h,$d,hd,If,Xf,Of>>4,Of&15,this.opts);ju+=jf;break;case 65535:ah[ju]!==255&&ju--;break;default:if(ah[ju-3]==255&&ah[ju-2]>=192&&ah[ju-2]<=254){ju-=3;break}else if(Sd===224||Sd==225){if(yd!==-1)throw new Error(`first unknown JPEG marker at offset ${yd.toString(16)}, second unknown JPEG marker ${Sd.toString(16)} at offset ${(ju-1).toString(16)}`);yd=ju-1;const vp=Zu();if(ah[ju+vp-2]===255){ju+=vp-2;break}}throw new Error("unknown JPEG marker "+Sd.toString(16))}Sd=Zu()}if(Ef.length!=1)throw new Error("only single frame JPEGs supported");for(var Hd=0;Hd<Ef.length;Hd++){var Ap=Ef[Hd].components;for(var xd in Ap)Ap[xd].quantizationTable=vd[Ap[xd].quantizationIdx],delete Ap[xd].quantizationIdx}this.width=$h.samplesPerLine,this.height=$h.scanLines,this.jfif=hh,this.adobe=Sh,this.components=[];for(var Hd=0;Hd<$h.componentsOrder.length;Hd++){var Jf=$h.components[$h.componentsOrder[Hd]];this.components.push({lines:_n($h,Jf),scaleX:Jf.h/$h.maxH,scaleY:Jf.v/$h.maxV})}},getData:function(ah,ch){var ju=this.width/ah,Zu=this.height/ch,sl,oh,hh,Sh,$h,hd,vd,Ef,Cd,Cf,Sd=0,yd,Hd,xd,Pd,zd,Ld,Kd,wf,kd,cd,gd,bp=ah*ch*this.components.length;Co(bp);var Uf=new Uint8Array(bp);switch(this.components.length){case 1:for(sl=this.components[0],Cf=0;Cf<ch;Cf++)for($h=sl.lines[0|Cf*sl.scaleY*Zu],Cd=0;Cd<ah;Cd++)yd=$h[0|Cd*sl.scaleX*ju],Uf[Sd++]=yd;break;case 2:for(sl=this.components[0],oh=this.components[1],Cf=0;Cf<ch;Cf++)for($h=sl.lines[0|Cf*sl.scaleY*Zu],hd=oh.lines[0|Cf*oh.scaleY*Zu],Cd=0;Cd<ah;Cd++)yd=$h[0|Cd*sl.scaleX*ju],Uf[Sd++]=yd,yd=hd[0|Cd*oh.scaleX*ju],Uf[Sd++]=yd;break;case 3:for(gd=!0,this.adobe&&this.adobe.transformCode?gd=!0:typeof this.opts.colorTransform<"u"&&(gd=!!this.opts.colorTransform),sl=this.components[0],oh=this.components[1],hh=this.components[2],Cf=0;Cf<ch;Cf++)for($h=sl.lines[0|Cf*sl.scaleY*Zu],hd=oh.lines[0|Cf*oh.scaleY*Zu],vd=hh.lines[0|Cf*hh.scaleY*Zu],Cd=0;Cd<ah;Cd++)gd?(yd=$h[0|Cd*sl.scaleX*ju],Hd=hd[0|Cd*oh.scaleX*ju],xd=vd[0|Cd*hh.scaleX*ju],wf=Fn(yd+1.402*(xd-128)),kd=Fn(yd-.3441363*(Hd-128)-.71413636*(xd-128)),cd=Fn(yd+1.772*(Hd-128))):(wf=$h[0|Cd*sl.scaleX*ju],kd=hd[0|Cd*oh.scaleX*ju],cd=vd[0|Cd*hh.scaleX*ju]),Uf[Sd++]=wf,Uf[Sd++]=kd,Uf[Sd++]=cd;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(gd=!1,this.adobe&&this.adobe.transformCode?gd=!0:typeof this.opts.colorTransform<"u"&&(gd=!!this.opts.colorTransform),sl=this.components[0],oh=this.components[1],hh=this.components[2],Sh=this.components[3],Cf=0;Cf<ch;Cf++)for($h=sl.lines[0|Cf*sl.scaleY*Zu],hd=oh.lines[0|Cf*oh.scaleY*Zu],vd=hh.lines[0|Cf*hh.scaleY*Zu],Ef=Sh.lines[0|Cf*Sh.scaleY*Zu],Cd=0;Cd<ah;Cd++)gd?(yd=$h[0|Cd*sl.scaleX*ju],Hd=hd[0|Cd*oh.scaleX*ju],xd=vd[0|Cd*hh.scaleX*ju],Pd=Ef[0|Cd*Sh.scaleX*ju],zd=255-Fn(yd+1.402*(xd-128)),Ld=255-Fn(yd-.3441363*(Hd-128)-.71413636*(xd-128)),Kd=255-Fn(yd+1.772*(Hd-128))):(zd=$h[0|Cd*sl.scaleX*ju],Ld=hd[0|Cd*oh.scaleX*ju],Kd=vd[0|Cd*hh.scaleX*ju],Pd=Ef[0|Cd*Sh.scaleX*ju]),Uf[Sd++]=255-zd,Uf[Sd++]=255-Ld,Uf[Sd++]=255-Kd,Uf[Sd++]=255-Pd;break;default:throw new Error("Unsupported color mode")}return Uf},copyToImageData:function(ah,ch){var ju=ah.width,Zu=ah.height,sl=ah.data,oh=this.getData(ju,Zu),hh=0,Sh=0,$h,hd,vd,Ef,Cd,Cf,Sd,yd,Hd;switch(this.components.length){case 1:for(hd=0;hd<Zu;hd++)for($h=0;$h<ju;$h++)vd=oh[hh++],sl[Sh++]=vd,sl[Sh++]=vd,sl[Sh++]=vd,ch&&(sl[Sh++]=255);break;case 3:for(hd=0;hd<Zu;hd++)for($h=0;$h<ju;$h++)Sd=oh[hh++],yd=oh[hh++],Hd=oh[hh++],sl[Sh++]=Sd,sl[Sh++]=yd,sl[Sh++]=Hd,ch&&(sl[Sh++]=255);break;case 4:for(hd=0;hd<Zu;hd++)for($h=0;$h<ju;$h++)Cd=oh[hh++],Cf=oh[hh++],vd=oh[hh++],Ef=oh[hh++],Sd=255-Fn(Cd*(1-Ef/255)+Ef),yd=255-Fn(Cf*(1-Ef/255)+Ef),Hd=255-Fn(vd*(1-Ef/255)+Ef),sl[Sh++]=Sd,sl[Sh++]=yd,sl[Sh++]=Hd,ch&&(sl[Sh++]=255);break;default:throw new Error("Unsupported color mode")}}};var tl=0,Io=0;function Co(rl=0){var ah=tl+rl;if(ah>Io){var ch=Math.ceil((ah-Io)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ch}MB`)}tl=ah}return ze.resetMaxMemoryUsage=function(rl){tl=0,Io=rl},ze.getBytesAllocated=function(){return tl},ze.requestMemoryAllocation=Co,ze}();e.exports=r;function r(n,a={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},f={...s,...a},o=new Uint8Array(n),x=new t;x.opts=f,t.resetMaxMemoryUsage(f.maxMemoryUsageInMB*1024*1024),x.parse(o);var C=f.formatAsRGBA?4:3,P=x.width*x.height*C;try{t.requestMemoryAllocation(P);var ge={width:x.width,height:x.height,exifBuffer:x.exifBuffer,data:f.useTArray?new Uint8Array(P):Buffer.alloc(P)};x.comments.length>0&&(ge.comments=x.comments)}catch(nt){throw nt instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+P):nt instanceof ReferenceError&&nt.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):nt}return x.copyToImageData(ge,f.formatAsRGBA),ge}})(decoder);var decoderExports=decoder.exports,encode$2=encoderExports,decode$5=decoderExports,jpegJs={encode:encode$2,decode:decode$5};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode$1(e){let t,r=e.length,n="";for(t=0;t<r;t+=3)n+=chars[e[t]>>2],n+=chars[(e[t]&3)<<4|e[t+1]>>4],n+=chars[(e[t+1]&15)<<2|e[t+2]>>6],n+=chars[e[t+2]&63];return r%3===2?n=`${n.substring(0,n.length-1)}=`:r%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$4(e){let t=e.length*.75,r=e.length,n=0,a,s,f,o;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const x=new Uint8Array(t);for(let C=0;C<r;C+=4)a=lookup[e.charCodeAt(C)],s=lookup[e.charCodeAt(C+1)],f=lookup[e.charCodeAt(C+2)],o=lookup[e.charCodeAt(C+3)],x[n++]=a<<2|s>>4,x[n++]=(s&15)<<4|f>>2,x[n++]=(f&3)<<6|o&63;return x}function toBase64URL(e,t){const r=encode$1(e);return`data:${t};base64,${r}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(e,t){let r=self.document.createElement("canvas");return r.width=e,r.height=t,r}function fetchBinary(e,{withCredentials:t=!1}={}){return new Promise(function(r,n){let a=new self.XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.withCredentials=t,a.onload=function(s){this.status!==200?n(s):r(this.response)},a.onerror=n,a.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,t={}){const r={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJs.encode(r,t.quality).data}function encodePng(e,t){const r={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(r.depth===1||r.depth===32)&&(r.depth=8,r.channels=4,r.data=e.getRGBAData()),encodePng$1(r,t)}const exportMethods={save(e,t={}){const{useCanvas:r=!1,encoder:n=void 0}=t;let{format:a}=t;if(!a){const s=/\.(?<format>[a-zA-Z]+)$/.exec(e);s&&(a=s.groups.format.toLowerCase())}if(!a)throw new Error("file format not provided");return new Promise((s,f)=>{let o,x;switch(a.toLowerCase()){case"png":{r?o=this.getCanvas().pngStream():x=encodePng(this,n);break}case"jpg":case"jpeg":r?o=this.getCanvas().jpegStream():x=encodeJpeg(this,n);break;case"bmp":x=encode$3(this,n);break;default:throw new RangeError(`invalid output format: ${a}`)}if(o){let C=createWriteStream();C.on("finish",s),C.on("error",f),o.pipe(C)}else x&&writeFile()})},toDataURL(e="image/png",t={}){typeof e=="object"&&(t=e,e="image/png");const{useCanvas:r=!1,encoder:n=void 0}=t;e=getType(e);function a(s,f){const o=s(f,n);return toBase64URL(o,e)}return e==="image/bmp"?a(encode$3,this):e==="image/png"&&!r?a(encodePng,this):e==="image/jpeg"&&!r?a(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:t="png",encoder:r=void 0}=e;switch(t.toLowerCase()){case"png":return encodePng(this,r);case"jpeg":case"jpg":return encodeJpeg(this,r);case"bmp":return encode$3(this,r);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(e="image/png",t={}){if(t.async)return this.toDataURL(e,t).then(function(r){return r.substring(r.indexOf(",")+1)});{const r=this.toDataURL(e,t);return r.substring(r.indexOf(",")+1)}},toBlob(e="image/png",t=.8){return canvasToBlob(this.getCanvas(),e,t)},getCanvas(){const e=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(e,0,0),t}};function setExportMethods(e){for(const t in exportMethods)e.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name="has-own",version$3="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$3={name,version:version$3,description,main,scripts,author,license,repository,homepage,devDependencies};(function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=t=function(a,s){return r.call(s,a)},t.version=require$$0$3.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,t,r={}){let{inPlace:n=!1,returnThis:a=!0,partialArgs:s=[]}=r;return n?Image$1.prototype[e]=function(...f){this.computed=null;let o=t.apply(this,[...s,...f]);return a?this:o}:Image$1.prototype[e]=function(...f){return t.apply(this,[...s,...f])},Image$1}function extendProperty(e,t,r={}){let{partialArgs:n=[]}=r;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let a=t.apply(this,n);return this.computed[e]=a,a},Object.defineProperty(Image$1.prototype,e,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(e={}){const{clamped:t}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const r=this.width*this.height*4;let n=t?new Uint8ClampedArray(r):new Uint8Array(r);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(e,t){for(let r=0;r<e.size;r++){const n=e.getBit(r);t[r*4]=n*255,t[r*4+1]=n*255,t[r*4+2]=n*255}}function fillDataFromGrey32(e,t){const r=e.min[0],a=e.max[0]-r;for(let s=0;s<e.size;s++){const f=Math.floor(255*(e.data[s]-r)/a);t[s*4]=f,t[s*4+1]=f,t[s*4+2]=f}}function fillDataFromRGB32(e,t){const r=Math.min(...e.min),a=Math.max(...e.max)-r;for(let s=0;s<e.size;s++){const f=Math.floor(255*(e.data[s*3]-r)/a),o=Math.floor(255*(e.data[s*3+1]-r)/a),x=Math.floor(255*(e.data[s*3+2]-r)/a);t[s*4]=f,t[s*4+1]=o,t[s*4+2]=x}}function fillDataFromGrey(e,t){for(let r=0;r<e.size;r++)t[r*4]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+1]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+2]=e.data[r*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,t){for(let r=0;r<e.size;r++)t[r*4]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+1]=e.data[r*e.channels+1]>>>e.bitDepth-8,t[r*4+2]=e.data[r*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,t){for(let r=0;r<e.size;r++)t[r*4+3]=e.data[r*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,t){for(let r=0;r<e.size;r++)t[r*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const t=kinds[e];if(!t)throw new RangeError(`invalid image kind: ${e}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:t,alpha:r,bitDepth:n,colorModel:a}=e;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(r!==0&&r!==1&&typeof r!="boolean")throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[a])throw new RangeError(`invalid colorModel: ${a}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,t,r){let n=t*e;return r===1&&(n=Math.ceil(n/8)),n}function createPixelArray(e,t,r,n,a,s){const f=n*e;let o;switch(a){case 1:o=new Uint8Array(Math.ceil(f/8));break;case 8:o=new Uint8Array(f);break;case 16:o=new Uint16Array(f);break;case 32:o=new Float32Array(f);break;default:throw new Error(`Cannot create pixel array for bit depth ${a}`)}if(r)for(let x=t;x<o.length;x+=n)o[x]=s;return o}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(t,r){r=r||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let n=t.byteLength;const a=r.offset?r.offset>>>0:0;t.buffer&&(n=t.byteLength-a,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+a,t.byteOffset+t.byteLength):a?t=t.buffer.slice(a):t=t.buffer),this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const r=this._increment+this._increment;this._increment=r;const n=this.length+r,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=this.readByte();return r}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var r=0;r<t;r++)charArray[r]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const r=tags$1[this.kind].tagsById;for(var t of this.fields.keys())r[t]&&(this._map[r[t]]=this.fields.get(t))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,r=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(r[1],r[2]-1,r[3]),t.setHours(r[4],r[5],r[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(e){return typeof e=="number"?[e]:e}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(e,t){return types$1.get(e)[0]*t};ifdValue.readData=function(e,t,r){return types$1.get(t)[1](e,r)};function readByte$1(e,t){if(t===1)return e.readUint8();for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.readUint8();return r}function readASCII$1(e,t){for(var r=[],n="",a=0;a<t;a++){var s=String.fromCharCode(e.readUint8());s==="\0"?(r.push(n),n=""):n+=s}return r.length===1?r[0]:r}function readShort$1(e,t){if(t===1)return e.readUint16();for(var r=new Uint16Array(t),n=0;n<t;n++)r[n]=e.readUint16();return r}function readLong$1(e,t){if(t===1)return e.readUint32();for(var r=new Uint32Array(t),n=0;n<t;n++)r[n]=e.readUint32();return r}function readRational$1(e,t){if(t===1)return e.readUint32()/e.readUint32();for(var r=new Array(t),n=0;n<t;n++)r[n]=e.readUint32()/e.readUint32();return r}function readSByte$1(e,t){if(t===1)return e.readInt8();for(var r=new Int8Array(t),n=0;n<t;n++)r[n]=e.readInt8();return r}function readSShort$1(e,t){if(t===1)return e.readInt16();for(var r=new Int16Array(t),n=0;n<t;n++)r[n]=e.readInt16();return r}function readSLong$1(e,t){if(t===1)return e.readInt32();for(var r=new Int32Array(t),n=0;n<t;n++)r[n]=e.readInt32();return r}function readSRational$1(e,t){if(t===1)return e.readInt32()/e.readInt32();for(var r=new Array(t),n=0;n<t;n++)r[n]=e.readInt32()/e.readInt32();return r}function readFloat$1(e,t){if(t===1)return e.readFloat32();for(var r=new Float32Array(t),n=0;n<t;n++)r[n]=e.readFloat32();return r}function readDouble$1(e,t){if(t===1)return e.readFloat64();for(var r=new Float64Array(t),n=0;n<t;n++)r[n]=e.readFloat64();return r}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(t,r){super(t,r),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$d,t);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(t)),t.onlyFirst)return r[0];return r}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var r;t.kind?r=new IFD$1(t.kind):r=new TiffIFD;const n=this.readUint16();for(var a=0;a<n;a++)this.decodeIFDEntry(r);return t.ignoreImageData||this.decodeImageData(r),this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const r=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}IFDValue.getByteLength(a,s)>4&&this.seek(this.readUint32());const o=IFDValue.readData(this,a,s);if(t.fields.set(n,o),n===34665||n===34853){let x=this.offset,C;n===34665?C="exif":n===34853&&(C="gps"),this._nextIFD=o,t[C]=this.decodeIFD({kind:C,ignoreImageData:!0}),this.offset=x}this.seek(r),this.skip(12)}decodeImageData(t){const r=t.orientation;switch(r&&r!==1&&unsupported$1("orientation",r),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const r=t.width,n=t.height,a=validateBitDepth(t.bitsPerSample),s=t.sampleFormat;let f=r*n;const o=getDataArray$1(f,1,a,s),x=t.compression,P=t.rowsPerStrip*r,ge=t.stripOffsets,nt=t.stripByteCounts;for(var ze=0,Bt=0;Bt<ge.length;Bt++){var qr=this.getStripData(x,ge[Bt],nt[Bt]),_n=f>P?P:f;f-=_n,a===8?ze=fill8bit$1(o,qr,ze,_n):a===16?ze=fill16bit$1(o,qr,ze,_n,this.isLittleEndian()):a===32&&s===3?ze=fillFloat32$1(o,qr,ze,_n,this.isLittleEndian()):unsupported$1("bitDepth",a)}t.data=o}getStripData(t,r,n){switch(t){case 1:return new DataView(this.buffer,r,n);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(e,t,r,n){return r===8?new Uint8Array(e*t):r===16?new Uint16Array(e*t):r===32&&n===3?new Float32Array(e*t):unsupported$1("bit depth / sample format",r+" / "+n)}function fill8bit$1(e,t,r,n){for(var a=0;a<n;a++)e[r++]=t.getUint8(a);return r}function fill16bit$1(e,t,r,n,a){for(var s=0;s<n*2;s+=2)e[r++]=t.getUint16(s,a);return r}function fillFloat32$1(e,t,r,n,a){for(var s=0;s<n*4;s+=4)e[r++]=t.getFloat32(s,a);return r}function unsupported$1(e,t){throw new Error("Unsupported "+e+": "+t)}function validateBitDepth(e){if(e.length){const r=e;e=r[0];for(var t=0;t<r.length;t++)r[t]!==e&&unsupported$1("bit depth",r)}return e}const TIFFDecoder$1=tiffDecoder;var decode$3=function(t,r){return new TIFFDecoder$1(t,r).decode(r)};src$4.decode=decode$3;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$2(e){const t=new IOBuffer(e),r={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const s=t.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){const f=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});r.exif=f}}return r}var decode_1=decode$2,decode$1=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=e=>[...e].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,t=0){let r=e[t],n=1,a=0;for(;++a<8;)n*=256,r+=e[t+a]*n;return r}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(!(t&&t.length>1))return null;const r=(a,s)=>{s=Object.assign({offset:0},s);for(let f=0;f<a.length;f++)if(s.mask){if(a[f]!==(s.mask[f]&t[f+s.offset]))return!1}else if(a[f]!==t[f+s.offset])return!1;return!0},n=(a,s)=>r(toBytes(a),s);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const a=(x,C=0)=>x.findIndex((P,ge,nt)=>ge>=C&&nt[ge]===80&&nt[ge+1]===75&&nt[ge+2]===3&&nt[ge+3]===4);let s=0,f=!1,o=null;do{const x=s+30;if(f||(f=r(oxmlContentTypes,{offset:x})||r(oxmlRels,{offset:x})),o||(n("word/",{offset:x})?o={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:x})?o={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:x})&&(o={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),f&&o)return o;s=a(t,x)}while(s>=0);if(o)return o}if(r([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const a=t.subarray(4,4100),s=a.findIndex((f,o,x)=>x[o]===66&&x[o+1]===130);if(s!==-1){const f=s+3,o=x=>[...x].every((C,P)=>a[f+P]===C.charCodeAt(0));if(o("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(o("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let a=30;do{const s=readUInt64LE(t,a+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:a})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}a+=s}while(a+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let a=0;a<2&&a<t.length-16;a++){if(r([73,68,51],{offset:a})||r([255,226],{offset:a,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:a,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:a,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:a,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(t)}catch(r){reject(r)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=e=>{const t=fileType(e);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(e,t,r){let n=0;for(;n<e.length;){for(let a=r;a<t*r;a+=r)for(let s=0;s<r;s++)e[n+a+s]=e[n+a+s]+e[n+a-(r-s)]&255;n+=t*r}}function applyHorizontalDifferencing16Bit(e,t,r){let n=0;for(;n<e.length;){for(let a=r;a<t*r;a+=r)for(let s=0;s<r;s++)e[n+a+s]=e[n+a+s]+e[n+a-(r-s)]&65535;n+=t*r}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let r of this.fields.keys())t[r]&&(this._map[t[r]]=this.fields.get(r));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,t){const r=types.get(e);if(!r)throw new Error(`type not found: ${e}`);return r[0]*t}function readData(e,t,r){const n=types.get(t);if(!n)throw new Error(`type not found: ${t}`);return n[1](e,r)}function readByte(e,t){if(t===1)return e.readUint8();let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.readUint8();return r}function readASCII(e,t){let r=[],n="";for(let a=0;a<t;a++){let s=String.fromCharCode(e.readUint8());s==="\0"?(r.push(n),n=""):n+=s}return r.length===1?r[0]:r}function readShort(e,t){if(t===1)return e.readUint16();let r=new Uint16Array(t);for(let n=0;n<t;n++)r[n]=e.readUint16();return r}function readLong(e,t){if(t===1)return e.readUint32();let r=new Uint32Array(t);for(let n=0;n<t;n++)r[n]=e.readUint32();return r}function readRational(e,t){if(t===1)return e.readUint32()/e.readUint32();let r=new Array(t);for(let n=0;n<t;n++)r[n]=e.readUint32()/e.readUint32();return r}function readSByte(e,t){if(t===1)return e.readInt8();let r=new Int8Array(t);for(let n=0;n<t;n++)r[n]=e.readInt8();return r}function readSShort(e,t){if(t===1)return e.readInt16();let r=new Int16Array(t);for(let n=0;n<t;n++)r[n]=e.readInt16();return r}function readSLong(e,t){if(t===1)return e.readInt32();let r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.readInt32();return r}function readSRational(e,t){if(t===1)return e.readInt32()/e.readInt32();let r=new Array(t);for(let n=0;n<t;n++)r[n]=e.readInt32()/e.readInt32();return r}function readFloat(e,t){if(t===1)return e.readFloat32();let r=new Float32Array(t);for(let n=0;n<t;n++)r[n]=e.readFloat32();return r}function readDouble(e,t){if(t===1)return e.readFloat64();let r=new Float64Array(t);for(let n=0;n<t;n++)r[n]=e.readFloat64();return r}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const e=[];for(let t=256;t<4096;t++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,r=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),r=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(r).concat(this.stringFromCode(t)[0])),r=t;else{const a=this.stringFromCode(r).concat(this.stringFromCode(r)[0]);this.writeString(a),this.addStringToTable(a),r=t}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,r=dateTimeRegex.exec(this.dateTime);if(r===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(r[1]),Number(r[2])-1,Number(r[3])),t.setHours(Number(r[4]),Number(r[5]),Number(r[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,r=this.get("ColorMap");if(!r)return;if(r.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const n=[];for(let a=0;a<t;a++)n.push([r[a],r[a+t],r[a+2*t]]);return n}}function alwaysArray(e){return typeof e=="number"?[e]:e}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,r)=>{e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},send_code=(e,t,r)=>{send_bits(e,r[t*2],r[t*2+1])},bi_reverse=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,x=t.stat_desc.max_length;let C,P,ge,nt,ze,Bt,qr=0;for(nt=0;nt<=MAX_BITS$1;nt++)e.bl_count[nt]=0;for(r[e.heap[e.heap_max]*2+1]=0,C=e.heap_max+1;C<HEAP_SIZE$1;C++)P=e.heap[C],nt=r[r[P*2+1]*2+1]+1,nt>x&&(nt=x,qr++),r[P*2+1]=nt,!(P>n)&&(e.bl_count[nt]++,ze=0,P>=o&&(ze=f[P-o]),Bt=r[P*2],e.opt_len+=Bt*(nt+ze),s&&(e.static_len+=Bt*(a[P*2+1]+ze)));if(qr!==0){do{for(nt=x-1;e.bl_count[nt]===0;)nt--;e.bl_count[nt]--,e.bl_count[nt+1]+=2,e.bl_count[x]--,qr-=2}while(qr>0);for(nt=x;nt!==0;nt--)for(P=e.bl_count[nt];P!==0;)ge=e.heap[--C],!(ge>n)&&(r[ge*2+1]!==nt&&(e.opt_len+=(nt-r[ge*2+1])*r[ge*2],r[ge*2+1]=nt),P--)}},gen_codes=(e,t,r)=>{const n=new Array(MAX_BITS$1+1);let a=0,s,f;for(s=1;s<=MAX_BITS$1;s++)a=a+r[s-1]<<1,n[s]=a;for(f=0;f<=t;f++){let o=e[f*2+1];o!==0&&(e[f*2]=bi_reverse(n[o]++,o))}},tr_static_init=()=>{let e,t,r,n,a;const s=new Array(MAX_BITS$1+1);for(r=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,a=0,n=0;n<16;n++)for(base_dist[n]=a,e=0;e<1<<extra_dbits[n];e++)_dist_code[a++]=n;for(a>>=7;n<D_CODES$1;n++)for(base_dist[n]=a<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+a++]=n;for(t=0;t<=MAX_BITS$1;t++)s[t]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,t,r,n)=>{const a=t*2,s=r*2;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[r]},pqdownheap=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&smaller(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},compress_block=(e,t,r)=>{let n,a,s=0,f,o;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+s++]&255,n+=(e.pending_buf[e.sym_buf+s++]&255)<<8,a=e.pending_buf[e.sym_buf+s++],n===0?send_code(e,a,t):(f=_length_code[a],send_code(e,f+LITERALS$1+1,t),o=extra_lbits[f],o!==0&&(a-=base_length[f],send_bits(e,a,o)),n--,f=d_code(n),send_code(e,f,r),o=extra_dbits[f],o!==0&&(n-=base_dist[f],send_bits(e,n,o)));while(s<e.sym_next);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let f,o,x=-1,C;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,f=0;f<s;f++)r[f*2]!==0?(e.heap[++e.heap_len]=x=f,e.depth[f]=0):r[f*2+1]=0;for(;e.heap_len<2;)C=e.heap[++e.heap_len]=x<2?++x:0,r[C*2]=1,e.depth[C]=0,e.opt_len--,a&&(e.static_len-=n[C*2+1]);for(t.max_code=x,f=e.heap_len>>1;f>=1;f--)pqdownheap(e,r,f);C=s;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=o,r[C*2]=r[f*2]+r[o*2],e.depth[C]=(e.depth[f]>=e.depth[o]?e.depth[f]:e.depth[o])+1,r[f*2+1]=r[o*2+1]=C,e.heap[1]=C++,pqdownheap(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(r,x,e.bl_count)},scan_tree=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)&&(o<C?e.bl_tree[s*2]+=o:s!==0?(s!==a&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6*2]++):o<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4))},send_tree=(e,t,r)=>{let n,a=-1,s,f=t[0*2+1],o=0,x=7,C=4;for(f===0&&(x=138,C=3),n=0;n<=r;n++)if(s=f,f=t[(n+1)*2+1],!(++o<x&&s===f)){if(o<C)do send_code(e,s,e.bl_tree);while(--o!==0);else s!==0?(s!==a&&(send_code(e,s,e.bl_tree),o--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,o-3,2)):o<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,o-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,o-11,7));o=0,a=s,f===0?(x=138,C=3):s===f?(x=6,C=3):(x=7,C=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&e.bl_tree[bl_order[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,r,n)=>{let a;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),a=0;a<n;a++)send_bits(e,e.bl_tree[bl_order[a]*2+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)},detect_data_type=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(r=32;r<LITERALS$1;r++)if(e.dyn_ltree[r*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,t,r,n)=>{send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(e),put_short(e,r),put_short(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,t,r,n)=>{let a,s,f=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),f=build_bl_tree(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=r+5,r+4<=a&&t!==-1?_tr_stored_block$1(e,t,r,n):e.strategy===Z_FIXED$1||s===a?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},_tr_tally$1=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code[r]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,t,r,n)=>{let a=e&65535|0,s=e>>>16&65535|0,f=0;for(;r!==0;){f=r>2e3?2e3:r,r-=f;do a=a+t[n++]|0,s=s+a|0;while(--f);a%=65521,s%=65521}return a|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable=new Uint32Array(makeTable()),crc32=(e,t,r,n)=>{const a=crcTable,s=n+r;e^=-1;for(let f=n;f<s;f++)e=e>>>8^a[(e^t[f])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2$1,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=messages[t],t),rank=e=>e*2-(e>4?9:0),zero=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=a?r-a:0;while(--t);t=a,n=t;do r=e.prev[--n],e.prev[n]=r>=a?r-a:0;while(--t)};let HASH_ZLIB=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),e.state.wrap===1?e.adler=adler32_1(e.adler,t,a,r):e.state.wrap===2&&(e.adler=crc32_1(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},longest_match=(e,t)=>{let r=e.max_chain_length,n=e.strstart,a,s,f=e.prev_length,o=e.nice_match;const x=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,C=e.window,P=e.w_mask,ge=e.prev,nt=e.strstart+MAX_MATCH;let ze=C[n+f-1],Bt=C[n+f];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do if(a=t,!(C[a+f]!==Bt||C[a+f-1]!==ze||C[a]!==C[n]||C[++a]!==C[n+1])){n+=2,a++;do;while(C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&C[++n]===C[++a]&&n<nt);if(s=MAX_MATCH-(nt-n),n=nt-MAX_MATCH,s>f){if(e.match_start=t,f=s,s>=o)break;ze=C[n+f-1],Bt=C[n+f]}}while((t=ge[t&P])>x&&--r!==0);return f<=e.lookahead?f:e.lookahead},fill_window=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),n+=t),e.strm.avail_in===0)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=HASH(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[a+MIN_MATCH-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,s,f=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(n===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||n!==a+e.strm.avail_in)))break;f=t===Z_FINISH$3&&n===a+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,f),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,flush_pending(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(read_buf(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(f===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&e.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,f=t===Z_FINISH$3&&e.strm.avail_in===0&&n===a?1:0,_tr_stored_block(e,e.block_start,n,f),e.block_start+=n,flush_pending(e.strm)),f?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,t)=>{let r,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH)if(n=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-MIN_MATCH,n=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(n=_tr_tally(e,0,e.window[e.strstart-1]),n&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let r,n,a,s;const f=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(a=e.strstart-1,n=f[a],n===f[++a]&&n===f[++a]&&n===f[++a])){s=e.strstart+MAX_MATCH;do;while(n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&n===f[++a]&&a<s);e.match_length=MAX_MATCH-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(r=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK$3&&lm_init(e.state),t},deflateSetHeader=(e,t)=>deflateStateCheck(e)||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=t,Z_OK$3),deflateInit2=(e,t,r,n,a,s)=>{if(!e)return Z_STREAM_ERROR$2;let f=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(f=0,n=-n):n>15&&(f=2,n-=16),a<1||a>MAX_MEM_LEVEL||r!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||s<0||s>Z_FIXED||n===8&&f!==1)return err(e,Z_STREAM_ERROR$2);n===8&&(n=9);const o=new DeflateState;return e.state=o,o.strm=e,o.status=INIT_STATE,o.wrap=f,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH-1)/MIN_MATCH),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=s,o.method=r,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,t)=>{if(deflateStateCheck(e)||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===FINISH_STATE&&t!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(flush_pending(e),e.avail_out===0)return r.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(t)<=rank(n)&&t!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(r.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(r.status===INIT_STATE&&r.wrap===0&&(r.status=BUSY_STATE),r.status===INIT_STATE){let a=Z_DEFLATED$2+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=Z_HUFFMAN_ONLY||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=PRESET_DICT),a+=31-a%31,putShortMSB(r,a),r.strstart!==0&&(putShortMSB(r,e.adler>>>16),putShortMSB(r,e.adler&65535)),e.adler=1,r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(r.status===GZIP_STATE){if(e.adler=0,put_byte(r,31),put_byte(r,139),put_byte(r,8),r.gzhead)put_byte(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),put_byte(r,r.gzhead.time&255),put_byte(r,r.gzhead.time>>8&255),put_byte(r,r.gzhead.time>>16&255),put_byte(r,r.gzhead.time>>24&255),put_byte(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(put_byte(r,r.gzhead.extra.length&255),put_byte(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=EXTRA_STATE;else if(put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,OS_CODE),r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(r.status===EXTRA_STATE){if(r.gzhead.extra){let a=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let o=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex+=o,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0,s-=o}let f=new Uint8Array(r.gzhead.extra);r.pending_buf.set(f.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=NAME_STATE}if(r.status===NAME_STATE){if(r.gzhead.name){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,put_byte(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=COMMENT_STATE}if(r.status===COMMENT_STATE){if(r.gzhead.comment){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,put_byte(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a))}r.status=HCRC_STATE}if(r.status===HCRC_STATE){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(flush_pending(e),r.pending!==0))return r.last_flush=-1,Z_OK$3;put_byte(r,e.adler&255),put_byte(r,e.adler>>8&255),e.adler=0}if(r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(e.avail_in!==0||r.lookahead!==0||t!==Z_NO_FLUSH$2&&r.status!==FINISH_STATE){let a=r.level===0?deflate_stored(r,t):r.strategy===Z_HUFFMAN_ONLY?deflate_huff(r,t):r.strategy===Z_RLE?deflate_rle(r,t):configuration_table[r.level].func(r,t);if((a===BS_FINISH_STARTED||a===BS_FINISH_DONE)&&(r.status=FINISH_STATE),a===BS_NEED_MORE||a===BS_FINISH_STARTED)return e.avail_out===0&&(r.last_flush=-1),Z_OK$3;if(a===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(r):t!==Z_BLOCK$1&&(_tr_stored_block(r,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),flush_pending(e),e.avail_out===0))return r.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:r.wrap<=0?Z_STREAM_END$3:(r.wrap===2?(put_byte(r,e.adler&255),put_byte(r,e.adler>>8&255),put_byte(r,e.adler>>16&255),put_byte(r,e.adler>>24&255),put_byte(r,e.total_in&255),put_byte(r,e.total_in>>8&255),put_byte(r,e.total_in>>16&255),put_byte(r,e.total_in>>24&255)):(putShortMSB(r,e.adler>>>16),putShortMSB(r,e.adler&65535)),flush_pending(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const t=e.state.status;return e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,t)=>{let r=t.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(a===1&&(e.adler=adler32_1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){a===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let x=new Uint8Array(n.w_size);x.set(t.subarray(r-n.w_size,r),0),t=x,r=n.w_size}const s=e.avail_in,f=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,fill_window(n);n.lookahead>=MIN_MATCH;){let x=n.strstart,C=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[x+MIN_MATCH-1]),n.prev[x&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=x,x++;while(--C);n.strstart=x,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,e.next_in=f,e.input=o,e.avail_in=s,n.wrap=a,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)_has(r,n)&&(e[n]=r[n])}}return e},flattenChunks=e=>{let t=0;for(let n=0,a=e.length;n<a;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,a=0,s=e.length;n<s;n++){let f=e[n];r.set(f,a),a+=f.length}return r},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,a,s,f=e.length,o=0;for(a=0;a<f;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),s=0,a=0;s<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<f&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|r&63):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|r&63):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|r&63);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var buf2string=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,a;const s=new Array(r*2);for(a=0,n=0;n<r;){let f=e[n++];if(f<128){s[a++]=f;continue}let o=_utf8len[f];if(o>4){s[a++]=65533,n+=o-1;continue}for(f&=o===2?31:o===3?15:7;o>1&&n<r;)f=f<<6|e[n++]&63,o--;if(o>1){s[a++]=65533;continue}f<65536?s[a++]=f:(f-=65536,s[a++]=55296|f>>10&1023,s[a++]=56320|f&1023)}return buf2binstring(s,a)},utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+_utf8len[e[r]]>t?r:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2$1;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$2)throw new Error(messages[r]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=deflate_1$2.deflateSetDictionary(this.strm,n),r!==Z_OK$2)throw new Error(messages[r]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?r.input=strings.string2buf(e):toString$1$1.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(a=deflate_1$2.deflate(r,s),a===Z_STREAM_END$2)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=deflate_1$2.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z_OK$2;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const BAD$1=16209,TYPE$1=16191;var inffast=function e(t,r){let n,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n,Fn,tl,Io,Co,rl,ah,ch,ju,Zu,sl;const oh=t.state;n=t.next_in,Zu=t.input,a=n+(t.avail_in-5),s=t.next_out,sl=t.output,f=s-(r-t.avail_out),o=s+(t.avail_out-257),x=oh.dmax,C=oh.wsize,P=oh.whave,ge=oh.wnext,nt=oh.window,ze=oh.hold,Bt=oh.bits,qr=oh.lencode,_n=oh.distcode,Fn=(1<<oh.lenbits)-1,tl=(1<<oh.distbits)-1;e:do{Bt<15&&(ze+=Zu[n++]<<Bt,Bt+=8,ze+=Zu[n++]<<Bt,Bt+=8),Io=qr[ze&Fn];t:for(;;){if(Co=Io>>>24,ze>>>=Co,Bt-=Co,Co=Io>>>16&255,Co===0)sl[s++]=Io&65535;else if(Co&16){rl=Io&65535,Co&=15,Co&&(Bt<Co&&(ze+=Zu[n++]<<Bt,Bt+=8),rl+=ze&(1<<Co)-1,ze>>>=Co,Bt-=Co),Bt<15&&(ze+=Zu[n++]<<Bt,Bt+=8,ze+=Zu[n++]<<Bt,Bt+=8),Io=_n[ze&tl];i:for(;;){if(Co=Io>>>24,ze>>>=Co,Bt-=Co,Co=Io>>>16&255,Co&16){if(ah=Io&65535,Co&=15,Bt<Co&&(ze+=Zu[n++]<<Bt,Bt+=8,Bt<Co&&(ze+=Zu[n++]<<Bt,Bt+=8)),ah+=ze&(1<<Co)-1,ah>x){t.msg="invalid distance too far back",oh.mode=BAD$1;break e}if(ze>>>=Co,Bt-=Co,Co=s-f,ah>Co){if(Co=ah-Co,Co>P&&oh.sane){t.msg="invalid distance too far back",oh.mode=BAD$1;break e}if(ch=0,ju=nt,ge===0){if(ch+=C-Co,Co<rl){rl-=Co;do sl[s++]=nt[ch++];while(--Co);ch=s-ah,ju=sl}}else if(ge<Co){if(ch+=C+ge-Co,Co-=ge,Co<rl){rl-=Co;do sl[s++]=nt[ch++];while(--Co);if(ch=0,ge<rl){Co=ge,rl-=Co;do sl[s++]=nt[ch++];while(--Co);ch=s-ah,ju=sl}}}else if(ch+=ge-Co,Co<rl){rl-=Co;do sl[s++]=nt[ch++];while(--Co);ch=s-ah,ju=sl}for(;rl>2;)sl[s++]=ju[ch++],sl[s++]=ju[ch++],sl[s++]=ju[ch++],rl-=3;rl&&(sl[s++]=ju[ch++],rl>1&&(sl[s++]=ju[ch++]))}else{ch=s-ah;do sl[s++]=sl[ch++],sl[s++]=sl[ch++],sl[s++]=sl[ch++],rl-=3;while(rl>2);rl&&(sl[s++]=sl[ch++],rl>1&&(sl[s++]=sl[ch++]))}}else if(Co&64){t.msg="invalid distance code",oh.mode=BAD$1;break e}else{Io=_n[(Io&65535)+(ze&(1<<Co)-1)];continue i}break}}else if(Co&64)if(Co&32){oh.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",oh.mode=BAD$1;break e}else{Io=qr[(Io&65535)+(ze&(1<<Co)-1)];continue t}break}}while(n<a&&s<o);rl=Bt>>3,n-=rl,Bt-=rl<<3,ze&=(1<<Bt)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?5+(a-n):5-(n-a),t.avail_out=s<o?257+(o-s):257-(s-o),oh.hold=ze,oh.bits=Bt};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,t,r,n,a,s,f,o)=>{const x=o.bits;let C=0,P=0,ge=0,nt=0,ze=0,Bt=0,qr=0,_n=0,Fn=0,tl=0,Io,Co,rl,ah,ch,ju=null,Zu;const sl=new Uint16Array(MAXBITS+1),oh=new Uint16Array(MAXBITS+1);let hh=null,Sh,$h,hd;for(C=0;C<=MAXBITS;C++)sl[C]=0;for(P=0;P<n;P++)sl[t[r+P]]++;for(ze=x,nt=MAXBITS;nt>=1&&sl[nt]===0;nt--);if(ze>nt&&(ze=nt),nt===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,o.bits=1,0;for(ge=1;ge<nt&&sl[ge]===0;ge++);for(ze<ge&&(ze=ge),_n=1,C=1;C<=MAXBITS;C++)if(_n<<=1,_n-=sl[C],_n<0)return-1;if(_n>0&&(e===CODES$1||nt!==1))return-1;for(oh[1]=0,C=1;C<MAXBITS;C++)oh[C+1]=oh[C]+sl[C];for(P=0;P<n;P++)t[r+P]!==0&&(f[oh[t[r+P]]++]=P);if(e===CODES$1?(ju=hh=f,Zu=20):e===LENS$1?(ju=lbase,hh=lext,Zu=257):(ju=dbase,hh=dext,Zu=0),tl=0,P=0,C=ge,ch=s,Bt=ze,qr=0,rl=-1,Fn=1<<ze,ah=Fn-1,e===LENS$1&&Fn>ENOUGH_LENS$1||e===DISTS$1&&Fn>ENOUGH_DISTS$1)return 1;for(;;){Sh=C-qr,f[P]+1<Zu?($h=0,hd=f[P]):f[P]>=Zu?($h=hh[f[P]-Zu],hd=ju[f[P]-Zu]):($h=32+64,hd=0),Io=1<<C-qr,Co=1<<Bt,ge=Co;do Co-=Io,a[ch+(tl>>qr)+Co]=Sh<<24|$h<<16|hd|0;while(Co!==0);for(Io=1<<C-1;tl&Io;)Io>>=1;if(Io!==0?(tl&=Io-1,tl+=Io):tl=0,P++,--sl[C]===0){if(C===nt)break;C=t[r+f[P]]}if(C>ze&&(tl&ah)!==rl){for(qr===0&&(qr=ze),ch+=ge,Bt=C-qr,_n=1<<Bt;Bt+qr<nt&&(_n-=sl[Bt+qr],!(_n<=0));)Bt++,_n<<=1;if(Fn+=1<<Bt,e===LENS$1&&Fn>ENOUGH_LENS$1||e===DISTS$1&&Fn>ENOUGH_DISTS$1)return 1;rl=tl&ah,a[rl]=ze<<24|Bt<<16|ch-s|0}}return tl!==0&&(a[ch+tl]=C-qr<<24|64<<16|0),o.bits=ze,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2$1,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let r;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const r=new InflateState;e.state=r,r.strm=e,r.window=null,r.mode=HEAD;const n=inflateReset2(e,t);return n!==Z_OK$1&&(e.state=null),n},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,r,n)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(r-n,r-n+a),s.wnext),n-=a,n?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},inflate$2=(e,t)=>{let r,n,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n=0,Fn,tl,Io,Co,rl,ah,ch,ju;const Zu=new Uint8Array(4);let sl,oh;const hh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;r=e.state,r.mode===TYPE&&(r.mode=TYPEDO),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,ge=o,nt=x,ju=Z_OK$1;e:for(;;)switch(r.mode){case HEAD:if(r.wrap===0){r.mode=TYPEDO;break}for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&2&&C===35615){r.wbits===0&&(r.wbits=15),r.check=0,Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1(r.check,Zu,2,0),C=0,P=0,r.mode=FLAGS;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((C&255)<<8)+(C>>8))%31){e.msg="incorrect header check",r.mode=BAD;break}if((C&15)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(C>>>=4,P-=4,ch=(C&15)+8,r.wbits===0&&(r.wbits=ch),ch>15||ch>r.wbits){e.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=C&512?DICTID:TYPE,C=0,P=0;break;case FLAGS:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.flags=C,(r.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=C>>8&1),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1(r.check,Zu,2,0)),C=0,P=0,r.mode=TIME;case TIME:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.time=C),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,Zu[2]=C>>>16&255,Zu[3]=C>>>24&255,r.check=crc32_1(r.check,Zu,4,0)),C=0,P=0,r.mode=OS;case OS:for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.head&&(r.head.xflags=C&255,r.head.os=C>>8),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1(r.check,Zu,2,0)),C=0,P=0,r.mode=EXLEN;case EXLEN:if(r.flags&1024){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length=C,r.head&&(r.head.extra_len=C),r.flags&512&&r.wrap&4&&(Zu[0]=C&255,Zu[1]=C>>>8&255,r.check=crc32_1(r.check,Zu,2,0)),C=0,P=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(r.flags&1024&&(ze=r.length,ze>o&&(ze=o),ze&&(r.head&&(ch=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+ze),ch)),r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,ze,s)),o-=ze,s+=ze,r.length-=ze),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(r.flags&2048){if(o===0)break e;ze=0;do ch=n[s+ze++],r.head&&ch&&r.length<65536&&(r.head.name+=String.fromCharCode(ch));while(ch&&ze<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,ze,s)),o-=ze,s+=ze,ch)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(r.flags&4096){if(o===0)break e;ze=0;do ch=n[s+ze++],r.head&&ch&&r.length<65536&&(r.head.comment+=String.fromCharCode(ch));while(ch&&ze<o);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,ze,s)),o-=ze,s+=ze,ch)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(r.flags&512){for(;P<16;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.check&65535)){e.msg="header crc mismatch",r.mode=BAD;break}C=0,P=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}e.adler=r.check=zswap32(C),C=0,P=0,r.mode=DICT;case DICT:if(r.havedict===0)return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,Z_NEED_DICT$1;e.adler=r.check=1,r.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(r.last){C>>>=P&7,P-=P&7,r.mode=CHECK;break}for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}switch(r.last=C&1,C>>>=1,P-=1,C&3){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){C>>>=2,P-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD}C>>>=2,P-=2;break;case STORED:for(C>>>=P&7,P-=P&7;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if((C&65535)!==(C>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=C&65535,C=0,P=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(ze=r.length,ze){if(ze>o&&(ze=o),ze>x&&(ze=x),ze===0)break e;a.set(n.subarray(s,s+ze),f),o-=ze,s+=ze,x-=ze,f+=ze,r.length-=ze;break}r.mode=TYPE;break;case TABLE:for(;P<14;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.nlen=(C&31)+257,C>>>=5,P-=5,r.ndist=(C&31)+1,C>>>=5,P-=5,r.ncode=(C&15)+4,C>>>=4,P-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;P<3;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.lens[hh[r.have++]]=C&7,C>>>=3,P-=3}for(;r.have<19;)r.lens[hh[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,sl={bits:r.lenbits},ju=inftrees(CODES,r.lens,0,19,r.lencode,0,r.work,sl),r.lenbits=sl.bits,ju){e.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;_n=r.lencode[C&(1<<r.lenbits)-1],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(Io<16)C>>>=Fn,P-=Fn,r.lens[r.have++]=Io;else{if(Io===16){for(oh=Fn+2;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(C>>>=Fn,P-=Fn,r.have===0){e.msg="invalid bit length repeat",r.mode=BAD;break}ch=r.lens[r.have-1],ze=3+(C&3),C>>>=2,P-=2}else if(Io===17){for(oh=Fn+3;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Fn,P-=Fn,ch=0,ze=3+(C&7),C>>>=3,P-=3}else{for(oh=Fn+7;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Fn,P-=Fn,ch=0,ze=11+(C&127),C>>>=7,P-=7}if(r.have+ze>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD;break}for(;ze--;)r.lens[r.have++]=ch}}if(r.mode===BAD)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,sl={bits:r.lenbits},ju=inftrees(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,sl),r.lenbits=sl.bits,ju){e.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,sl={bits:r.distbits},ju=inftrees(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,sl),r.distbits=sl.bits,ju){e.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(o>=6&&x>=258){e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,inffast(e,nt),f=e.next_out,a=e.output,x=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,C=r.hold,P=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;_n=r.lencode[C&(1<<r.lenbits)-1],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(tl&&!(tl&240)){for(Co=Fn,rl=tl,ah=Io;_n=r.lencode[ah+((C&(1<<Co+rl)-1)>>Co)],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Co+Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Co,P-=Co,r.back+=Co}if(C>>>=Fn,P-=Fn,r.back+=Fn,r.length=Io,tl===0){r.mode=LIT;break}if(tl&32){r.back=-1,r.mode=TYPE;break}if(tl&64){e.msg="invalid literal/length code",r.mode=BAD;break}r.extra=tl&15,r.mode=LENEXT;case LENEXT:if(r.extra){for(oh=r.extra;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.length+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;_n=r.distcode[C&(1<<r.distbits)-1],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(!(tl&240)){for(Co=Fn,rl=tl,ah=Io;_n=r.distcode[ah+((C&(1<<Co+rl)-1)>>Co)],Fn=_n>>>24,tl=_n>>>16&255,Io=_n&65535,!(Co+Fn<=P);){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}C>>>=Co,P-=Co,r.back+=Co}if(C>>>=Fn,P-=Fn,r.back+=Fn,tl&64){e.msg="invalid distance code",r.mode=BAD;break}r.offset=Io,r.extra=tl&15,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(oh=r.extra;P<oh;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}r.offset+=C&(1<<r.extra)-1,C>>>=r.extra,P-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(x===0)break e;if(ze=nt-x,r.offset>ze){if(ze=r.offset-ze,ze>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break}ze>r.wnext?(ze-=r.wnext,Bt=r.wsize-ze):Bt=r.wnext-ze,ze>r.length&&(ze=r.length),qr=r.window}else qr=a,Bt=f-r.offset,ze=r.length;ze>x&&(ze=x),x-=ze,r.length-=ze;do a[f++]=qr[Bt++];while(--ze);r.length===0&&(r.mode=LEN);break;case LIT:if(x===0)break e;a[f++]=r.length,x--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;P<32;){if(o===0)break e;o--,C|=n[s++]<<P,P+=8}if(nt-=x,e.total_out+=nt,r.total+=nt,r.wrap&4&&nt&&(e.adler=r.check=r.flags?crc32_1(r.check,a,nt,f-nt):adler32_1(r.check,a,nt,f-nt)),nt=x,r.wrap&4&&(r.flags?C:zswap32(C))!==r.check){e.msg="incorrect data check",r.mode=BAD;break}C=0,P=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;P<32;){if(o===0)break e;o--,C+=n[s++]<<P,P+=8}if(r.wrap&4&&C!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=BAD;break}C=0,P=0}r.mode=DONE;case DONE:ju=Z_STREAM_END$1;break e;case BAD:ju=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=f,e.avail_out=x,e.next_in=s,e.avail_in=o,r.hold=C,r.bits=P,(r.wsize||nt!==e.avail_out&&r.mode<BAD&&(r.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,nt-e.avail_out),ge-=e.avail_in,nt-=e.avail_out,e.total_in+=ge,e.total_out+=nt,r.total+=nt,r.wrap&4&&nt&&(e.adler=r.check=r.flags?crc32_1(r.check,a,nt,e.next_out-nt):adler32_1(r.check,a,nt,e.next_out-nt)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(ge===0&&nt===0||t===Z_FINISH$1)&&ju===Z_OK$1&&(ju=Z_BUF_ERROR),ju},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,t)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(e,t)=>{const r=t.length;let n,a,s;return inflateStateCheck(e)||(n=e.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(a=1,a=adler32_1(a,t,r,0),a!==n.check)?Z_DATA_ERROR$1:(s=updatewindow(e,t,r,r),s?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$5=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2$1;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$5.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),r!==Z_OK)))throw new Error(messages[r])}Inflate$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,f,o;if(this.ended)return!1;for(t===~~t?f=t:f=t===!0?Z_FINISH:Z_NO_FLUSH,toString$5.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=inflate_1$2.inflate(r,f),s===Z_NEED_DICT&&a&&(s=inflate_1$2.inflateSetDictionary(r,a),s===Z_OK?s=inflate_1$2.inflate(r,f):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));r.avail_in>0&&s===Z_STREAM_END&&r.state.wrap>0&&e[r.next_in]!==0;)inflate_1$2.inflateReset(r),s=inflate_1$2.inflate(r,f);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(r.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let x=strings.utf8border(r.output,r.next_out),C=r.next_out-x,P=strings.buf2string(r.output,x);r.next_out=C,r.avail_out=n-C,C&&r.output.set(r.output.subarray(x,x+C),0),this.onData(P)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===Z_OK&&o===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,t){const r=new Inflate$1(t);if(r.push(e),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw$1(e,t){return t=t||{},t.raw=!0,inflate$1(e,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants$a=constants$2$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants$a};const{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var inflate_1=inflate;function decompressZlib(e){const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=inflate_1(t);return new DataView(r.buffer,r.byteOffset,r.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$c,t);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(t,!0)),t.onlyFirst)return[r[0]];return r}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,r){this.seek(this._nextIFD);let n;if(r)n=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");n=new IFD(t.kind)}const a=this.readUint16();for(let s=0;s<a;s++)this.decodeIFDEntry(n);if(!t.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const r=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}getByteLength(a,s)>4&&this.seek(this.readUint32());const o=readData(this,a,s);if(t.fields.set(n,o),n===34665||n===34853){let x=this.offset,C="exif";n===34665?C="exif":n===34853&&(C="gps"),this._nextIFD=o,t[C]=this.decodeIFD({kind:C,ignoreImageData:!0},!1),this.offset=x}this.seek(r),this.skip(12)}decodeImageData(t){const r=t.orientation;if(r&&r!==1)throw unsupported("orientation",r);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const n=t.bitsPerSample,a=Math.pow(2,n)-1;for(let s=0;s<t.data.length;s++)t.data[s]=a-t.data[s]}}readStripData(t){const r=t.width,n=t.height,a=t.bitsPerSample,s=t.sampleFormat,f=r*n*t.samplesPerPixel,o=getDataArray(f,a,s),C=t.rowsPerStrip*r*t.samplesPerPixel,P=t.stripOffsets,ge=t.stripByteCounts||guessStripByteCounts(t);let nt=f,ze=0;for(let Bt=0;Bt<P.length;Bt++){let qr=new DataView(this.buffer,this.byteOffset+P[Bt],ge[Bt]),_n=nt>C?C:nt;nt-=_n;let Fn=qr;switch(t.compression){case 1:break;case 5:{Fn=decompressLzw(qr);break}case 8:{Fn=decompressZlib(qr);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}ze=this.fillUncompressed(a,s,o,Fn,ze,_n)}t.data=o}fillUncompressed(t,r,n,a,s,f){if(t===8)return fill8bit(n,a,s,f);if(t===16)return fill16bit(n,a,s,f,this.isLittleEndian());if(t===32&&r===3)return fillFloat32(n,a,s,f,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const r=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(r===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(r===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${r}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:r,components:n,maxSampleValue:a}=t;for(let s=0;s<r.length;s+=n){const f=r[s+n-1];for(let o=0;o<n-1;o++)r[s+o]=Math.round(r[s+o]*a/f)}}}}function getDataArray(e,t,r){if(t===8)return new Uint8Array(e);if(t===16)return new Uint16Array(e);if(t===32&&r===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${t} / ${r}`)}function fill8bit(e,t,r,n){for(let a=0;a<n;a++)e[r++]=t.getUint8(a);return r}function fill16bit(e,t,r,n,a){for(let s=0;s<n*2;s+=2)e[r++]=t.getUint16(s,a);return r}function fillFloat32(e,t,r,n,a){for(let s=0;s<n*4;s+=4)e[r++]=t.getFloat32(s,a);return r}function unsupported(e,t){return new Error(`Unsupported ${e}: ${t}`)}function decodeTIFF(e,t){return new TIFFDecoder(e).decode(t)}function matchAndCrop(e={}){let{algorithm:t="matchToPrevious",ignoreBorder:r=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=t==="matchToPrevious",a=this[0],s=[];s[0]={position:[0,0],image:this[0]};let f=[0,0];for(let nt=1;nt<this.length;nt++){let ze=a.getBestMatch(this[nt],{border:r});s[nt]={position:[ze[0]+f[0],ze[1]+f[1]],image:this[nt]},n&&(f[0]+=ze[0],f[1]+=ze[1],a=this[nt])}let o=0,x=0,C=0,P=0;for(let nt=0;nt<s.length;nt++){let ze=s[nt];ze.position[0]>o&&(o=ze.position[0]),ze.position[0]<x&&(x=ze.position[0]),ze.position[1]>C&&(C=ze.position[1]),ze.position[1]<P&&(P=ze.position[1])}x=0-x,P=0-P;for(let nt=0;nt<s.length;nt++){let ze=s[nt];ze.crop=ze.image.crop({x:o-ze.position[0],y:C-ze.position[1],width:a.width-x-o,height:a.height-P-C})}let ge=[];for(let nt=0;nt<s.length;nt++)ge[nt]=s[nt].crop;return new Stack$3(ge)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let t=1;t<this.length;t++)for(let r=0;r<e.length;r++)e[r]=Math.min(e[r],this[t].min[r]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let t=1;t<this.length;t++)for(let r=0;r<e.length;r++)e[r]=Math.max(e[r],this[t].max[r]);return e}function median$2(e){let t=e.reduce((f,o)=>f+o);if(t===0)throw new Error("unreachable");let r=0,n=0,a=t/2,s;for(;;){if(e[r]>0){if(s!==void 0)return(s+r)/2;if(n+=e[r],n>a)return r;n===a&&(s=r)}r++}}function mean$2(e){let t=0,r=0;for(let n=0;n<e.length;n++)t+=e[n],r+=e[n]*n;return t===0?0:r/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=median$2(n)}return t}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(e);for(let r=1;r<this.length;r++){let n=this[r].getHistogram(e);for(let a=0;a<t.length;a++)t[a]+=n[a]}return t}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(e),r=t[0].length;for(let n=1;n<this.length;n++){let a=this[n].getHistograms(e);for(let s=0;s<t.length;s++)for(let f=0;f<r;f++)t[s][f]+=a[s][f]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let a=this[n];for(let s=0;s<this[0].data.length;s++)e[s]+=a.data[s]}let t=Image$1.createFrom(this[0]),r=t.data;for(let n=0;n<this[0].data.length;n++)r[n]=e[n]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(0);for(const t of this)for(let r=0;r<e.data.length;r++)e.data[r]=Math.max(t.data[r],e.data[r]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(e.maxValue);for(const t of this)for(let r=0;r<e.data.length;r++)e.data[r]=Math.min(t.data[r],e.data[r]);return e}function extend$5(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0},Stack$3=class Mx extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let r=0;r<t.length;r++)this[r]=t[r]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image$1.load)).then(r=>new Mx(r))}static extendMethod(t,r,n={}){let{inPlace:a=!1,returnThis:s=!0,partialArgs:f=[]}=n;return a?Mx.prototype[t]=function(...o){this.computed=null;let x=r.apply(this,[...f,...o]);return s?this:x}:Mx.prototype[t]=function(...o){return r.apply(this,[...f,...o])},Mx}static extendProperty(t,r,n={}){let{partialArgs:a=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let s=r.apply(this,a);return this.computed[t]=s,s},Object.defineProperty(Mx.prototype,t,computedPropertyDescriptor),Mx}checkProcessable(t,r={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,r);for(let n=1;n<this.length;n++){if((r.sameSize===void 0||r.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((r.sameSize===void 0||r.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((r.sameAlpha===void 0||r.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((r.sameBitDepth===void 0||r.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((r.sameColorModel===void 0||r.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((r.sameNumberChannels===void 0||r.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}};Array[Symbol.species]||(Stack$3.prototype.map=function(e,t){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let r=new Stack$3(this.length);for(let n=0;n<this.length;n++)r[n]=e.call(t,this[n],n,this);return r});extend$5(Stack$3);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(e,t){if(typeof e=="string")return loadURL(e,t);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,t&&t.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,t,r){const n=imageType$1(e);if(n)switch(n.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,r);default:return loadGeneric(a(n.mime))}return loadGeneric(a("application/octet-stream"));function a(s){return t||toBase64URL(e,s)}}function loadURL(e,t){const r=e.slice(0,64).match(isDataURL);let n;return r!==null?n=Promise.resolve(decode$4(e.slice(r[0].length))):n=fetchBinary(e,t),n.then(a=>{const s=new Uint8Array(a);return loadBinary(s,r?e:void 0,t&&t.ignorePalette)})}function loadPNG(e){const t=decodePng(e);let r=t.channels,n,a=0;return r===2||r===4?(n=r-1,a=1):n=r,t.palette?loadPNGFromPalette(t):new Image$1(t.width,t.height,t.data,{components:n,alpha:a,bitDepth:t.depth})}function loadPNGFromPalette(e){const t=e.width*e.height,r=e.palette[0].length,n=new Uint8Array(t*r),a=8/e.depth,s=e.depth<8?a:1,f=parseInt("1".repeat(e.depth),2),o=r===4;let x=0;for(let C=0;C<t;C++){const P=Math.floor(C/s);let ge=e.data[P];e.depth<8&&(ge=ge>>>e.depth*(a-1-C%a)&f);const nt=e.palette[ge];n[x++]=nt[0],n[x++]=nt[1],n[x++]=nt[2],o&&(n[x++]=nt[3])}return new Image$1(e.width,e.height,n,{components:3,alpha:o,bitDepth:8})}function loadJPEG(e){const t=decode$1(e);let r;t.exif&&(r=getMetadata(t.exif));const n=jpegJs.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let a=new Image$1(n.width,n.height,n.data,{meta:r});if(r&&r.tiff.tags.Orientation){const s=r.tiff.tags.Orientation;s>2&&(a=a.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(a=a.flipX())}return a}function loadTIFF(e,t){let r=decodeTIFF(e);return r.length===1?getImageFromIFD(r[0],t):new Stack$3(r.map(function(n){return getImageFromIFD(n,t)}))}function getMetadata(e){const t={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(t.exif=e.exif),e.gps&&(t.gps=e.gps),t}function getImageFromIFD(e,t){if(!t&&e.type===3){const r=new Uint16Array(3*e.width*e.height),n=e.palette;let a=0;for(let s=0;s<e.data.length;s++){const f=e.data[s],o=n[f];r[a++]=o[0],r[a++]=o[1],r[a++]=o[2]}return new Image$1(e.width,e.height,r,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image$1(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,t){return t=t||{},new Promise(function(r,n){let a=new DOMImage;a.onload=function(){let s=a.width,f=a.height,x=createCanvas(s,f).getContext("2d");x.drawImage(a,0,0,s,f);let C=x.getImageData(0,0,s,f).data;r(new Image$1(s,f,C,t))},a.onerror=function(){n(new Error(`Could not load ${e}`))},a.src=e})}const valueMethods={getValueXY(e,t,r){return this.data[(t*this.width+e)*this.channels+r]},setValueXY(e,t,r,n){return this.data[(t*this.width+e)*this.channels+r]=n,this.computed=null,this},getValue(e,t){return this.data[e*this.channels+t]},setValue(e,t,r){return this.data[e*this.channels+t]=r,this.computed=null,this},getPixelXY(e,t){return this.getPixel(t*this.width+e)},setPixelXY(e,t,r){return this.setPixel(t*this.width+e,r)},getPixel(e){const t=new Array(this.channels),r=e*this.channels;for(let n=0;n<this.channels;n++)t[n]=this.data[r+n];return t},setPixel(e,t){const r=e*this.channels;for(let n=0;n<t.length;n++)this.data[r+n]=t[n];return this.computed=null,this}};function setValueMethods(e){for(const t in valueMethods)e.prototype[t]=valueMethods[t]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,t,r,n={}){const{out:a}=t;if(a===void 0)return n.copy?e.clone():Image$1.createFrom(e,r);{if(!Image$1.isImage(a))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(e),r);for(const f in s)if(a[f]!==s[f])throw new RangeError(`cannot use out. Its ${f} must be "${s[f]}" (found "${a[f]}")`);return a}}function getOutputImageOrInPlace(e,t,r){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,t,null,r)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,e);return absolute(this,t),t}function absolute(e,t){for(let r=0;r<e.data.length;r++)t.data[r]=Math.abs(e.data[r])}function copyAlphaChannel(e,t){if(e.alpha===1&&t.alpha===1)for(let r=0;r<e.size;r++)t.data[r*t.channels+t.components]=e.data[r*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(e,t){for(let r=0;r<e.data.length;r++)t.data[r]=~e.data[r]}function invertColor(e,t){for(let r=0;r<e.data.length;r+=e.channels)for(let n=0;n<e.components;n++)t.data[r+n]=e.maxValue-e.data[r+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let t=e*this.width*this.channels;for(let r=0;r<Math.floor(this.width/2);r++){let n=r*this.channels+t,a=(this.width-r-1)*this.channels+t;for(let s=0;s<this.channels;s++){let f=this.data[n+s];this.data[n+s]=this.data[a+s],this.data[a+s]=f}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let t=0;t<this.width;t++){let r=t*this.channels+e*this.width*this.channels,n=t*this.channels+(this.height-1-e)*this.channels*this.width;for(let a=0;a<this.channels;a++){let s=this.data[r+a];this.data[r+a]=this.data[n+a],this.data[n+a]=s}}return this}function blurFilter(e={}){const{radius:t=1}=e;if(t<1)throw new Error("radius must be greater than 1");const r=2*t+1,n=new Array(r);for(let a=0;a<r;a++){n[a]=new Array(r);for(let s=0;s<r;s++)n[a][s]=1/(r*r)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(e){(function(){function t(a){for(var s=0,f=a.length-1,o=void 0,x=void 0,C=void 0,P=n(s,f);;){if(f<=s)return a[P];if(f==s+1)return a[s]>a[f]&&r(a,s,f),a[P];for(o=n(s,f),a[o]>a[f]&&r(a,o,f),a[s]>a[f]&&r(a,s,f),a[o]>a[s]&&r(a,o,s),r(a,o,s+1),x=s+1,C=f;;){do x++;while(a[s]>a[x]);do C--;while(a[C]>a[s]);if(C<x)break;r(a,x,C)}r(a,s,C),C<=P&&(s=x),C>=P&&(f=C-1)}}var r=function(s,f,o){var x;return x=[s[o],s[f]],s[f]=x[0],s[o]=x[1],x},n=function(s,f){return~~((s+f)/2)};e.exports?e.exports=t:window.median=t})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(e,t={}){let{channels:r,allowAlpha:n,defaultAlpha:a}=t;return typeof n!="boolean"&&(n=!0),typeof r>"u"?allChannels(e,a):validateChannels(e,r,n)}function allChannels(e,t){let r=t?e.channels:e.components,n=new Array(r);for(let a=0;a<r;a++)n[a]=a;return n}function validateChannels(e,t,r){Array.isArray(t)||(t=[t]);for(let n=0;n<t.length;n++)t[n]=validateChannel(e,t[n],r);return t}function validateChannel(e,t,r=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof t=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(t==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=e.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!r&&t>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(e={}){let{radius:t=1,border:r="copy",channels:n}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let a=t,s=t,f=Image$1.createFrom(this),o=(a*2+1)*(s*2+1),x=new Array(o);for(let C=0;C<n.length;C++){let P=n[C];for(let ge=s;ge<this.height-s;ge++)for(let nt=a;nt<this.width-a;nt++){let ze=0;for(let qr=-s;qr<=s;qr++)for(let _n=-a;_n<=a;_n++){let Fn=((ge+qr)*this.width+nt+_n)*this.channels+P;x[ze++]=this.data[Fn]}let Bt=(ge*this.width+nt)*this.channels+P;f.data[Bt]=quickSelectMedian(x)}}if(this.alpha&&!n.includes(this.channels))for(let C=this.components;C<this.data.length;C=C+this.channels)f.data[C]=this.data[C];return f.setBorder({size:[a,s],algorithm:r}),f}function gaussianFilter(e={}){let{radius:t=1,sigma:r,channels:n,border:a="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(t,r);return this.convolution([s,s],{border:a,channels:n,algorithm:"separable"})}function getKernel(e,t){const r=e*2+1,n=new Array(r),a=t||((r-1)*.5-1)*.3+.8,s=-.5/(a*a);let f=0;for(let o=0;o<r;o++){const x=o-e,C=Math.exp(s*x*x);n[o]=C,f+=C}for(let o=0;o<r;o++)n[o]/=f;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(e){(function(){var t;t=e;var r={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+r.release+", released "+r.date};for(var n=0,a=null,s=null,f={init:function(C){if(C!==0&&!(C&C-1))n=C,f._initArray(),f._makeBitReversalTable(),f._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(C,P){f.fft(C,P,1)},ifft1d:function(C,P){var ge=1/n;f.fft(C,P,-1);for(var nt=0;nt<n;nt++)C[nt]*=ge,P[nt]*=ge},bt1d:function(C,P){f.fft(C,P,-1)},fft2d:function(C,P){for(var ge=[],nt=[],ze=0,Bt=0;Bt<n;Bt++){ze=Bt*n;for(var qr=0;qr<n;qr++)ge[qr]=C[qr+ze],nt[qr]=P[qr+ze];f.fft1d(ge,nt);for(var _n=0;_n<n;_n++)C[_n+ze]=ge[_n],P[_n+ze]=nt[_n]}for(var Fn=0;Fn<n;Fn++){for(var tl=0;tl<n;tl++)ze=Fn+tl*n,ge[tl]=C[ze],nt[tl]=P[ze];f.fft1d(ge,nt);for(var Io=0;Io<n;Io++)ze=Fn+Io*n,C[ze]=ge[Io],P[ze]=nt[Io]}},ifft2d:function(C,P){for(var ge=[],nt=[],ze=0,Bt=0;Bt<n;Bt++){ze=Bt*n;for(var qr=0;qr<n;qr++)ge[qr]=C[qr+ze],nt[qr]=P[qr+ze];f.ifft1d(ge,nt);for(var _n=0;_n<n;_n++)C[_n+ze]=ge[_n],P[_n+ze]=nt[_n]}for(var Fn=0;Fn<n;Fn++){for(var tl=0;tl<n;tl++)ze=Fn+tl*n,ge[tl]=C[ze],nt[tl]=P[ze];f.ifft1d(ge,nt);for(var Io=0;Io<n;Io++)ze=Fn+Io*n,C[ze]=ge[Io],P[ze]=nt[Io]}},fft:function(C,P,ge){for(var nt,ze,Bt,qr,_n,Fn,tl,Io,Co,rl=n>>2,ah=0;ah<n;ah++)qr=a[ah],ah<qr&&(_n=C[ah],C[ah]=C[qr],C[qr]=_n,_n=P[ah],P[ah]=P[qr],P[qr]=_n);for(var ch=1;ch<n;ch<<=1){ze=0,nt=n/(ch<<1);for(var ju=0;ju<ch;ju++){Fn=s[ze+rl],tl=ge*s[ze];for(var Zu=ju;Zu<n;Zu+=ch<<1)Bt=Zu+ch,Io=Fn*C[Bt]+tl*P[Bt],Co=Fn*P[Bt]-tl*C[Bt],C[Bt]=C[Zu]-Io,C[Zu]+=Io,P[Bt]=P[Zu]-Co,P[Zu]+=Co;ze+=nt}}},_initArray:function(){typeof Uint32Array<"u"?a=new Uint32Array(n):a=[],typeof Float64Array<"u"?s=new Float64Array(n*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var C=0,P=0,ge=0;for(a[0]=0;++C<n;){for(ge=n>>1;ge<=P;)P-=ge,ge>>=1;P+=ge,a[C]=P}},_makeCosSinTable:function(){var C=n>>1,P=n>>2,ge=n>>3,nt=C+P,ze=Math.sin(Math.PI/n),Bt=2*ze*ze,qr=Math.sqrt(Bt*(2-Bt)),_n=s[P]=1,Fn=s[0]=0;ze=2*Bt;for(var tl=1;tl<ge;tl++)_n-=Bt,Bt+=ze*_n,Fn+=qr,qr-=ze*Fn,s[tl]=Fn,s[P-tl]=_n;ge!==0&&(s[ge]=Math.sqrt(.5));for(var Io=0;Io<P;Io++)s[C-Io]=s[Io];for(var Co=0;Co<nt;Co++)s[Co+C]=-s[Co]}},o=["init","fft1d","ifft1d","fft2d","ifft2d"],x=0;x<o.length;x++)t[o[x]]=f[o[x]];return t.bt=f.bt1d,t.fft=f.fft1d,t.ifft=f.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(e,t,r){var n=new Array(t*r),a=t/2,s=(r-1)*2;FFT$1.init(a);for(var f={re:new Array(a),im:new Array(a)},o=0;o<r;o++){for(var x=a-1;x>=0;x--)f.re[x]=e[x*2*r+o],f.im[x]=e[(x*2+1)*r+o];FFT$1.bt(f.re,f.im);for(var x=a-1;x>=0;x--)n[x*2*r+o]=f.re[x],n[(x*2+1)*r+o]=f.im[x]}var C=new Array(a*s);FFT$1.init(s);for(var P={re:new Array(s),im:new Array(s)},ge=s*a,x=0;x<t;x+=2){P.re[0]=n[x*r],P.im[0]=n[(x+1)*r];for(var o=1;o<r;o++)P.re[o]=n[x*r+o],P.im[o]=n[(x+1)*r+o],P.re[s-o]=n[x*r+o],P.im[s-o]=-n[(x+1)*r+o];FFT$1.bt(P.re,P.im);for(var nt=x/2*s,o=s-1;o>=0;o--)C[nt+o]=P.re[o]/ge}return C},fft2DArray:function(e,t,r,n){Object.assign({},{inplace:!0});var a=r/2+1,s=t*2,f=new Array(s*a);FFT$1.init(r);for(var o={re:new Array(r),im:new Array(r)},x={re:new Array(r),im:new Array(r)},C={re:new Array(r),im:new Array(r)},P,ge,nt,ze,Bt,qr=0;qr<t/2;qr++){P=qr*2*r,o.re=e.slice(P,P+r),P=(qr*2+1)*r,o.im=e.slice(P,P+r),FFT$1.fft1d(o.re,o.im),this.reconstructTwoRealFFT(o,x,C),ge=qr*4*a,nt=(qr*4+1)*a,ze=(qr*4+2)*a,Bt=(qr*4+3)*a;for(var _n=a-1;_n>=0;_n--)f[ge+_n]=x.re[_n],f[nt+_n]=x.im[_n],f[ze+_n]=C.re[_n],f[Bt+_n]=C.im[_n]}x=null,C=null;var Fn=new Array(s*a);FFT$1.init(t);for(var tl={re:new Array(t),im:new Array(t)},Io=a-1;Io>=0;Io--){for(var qr=t-1;qr>=0;qr--)tl.re[qr]=f[qr*2*a+Io],tl.im[qr]=f[(qr*2+1)*a+Io],isNaN(tl.re[qr])&&(tl.re[qr]=0),isNaN(tl.im[qr])&&(tl.im[qr]=0);FFT$1.fft1d(tl.re,tl.im);for(var qr=t-1;qr>=0;qr--)Fn[qr*2*a+Io]=tl.re[qr],Fn[(qr*2+1)*a+Io]=tl.im[qr]}return Fn},reconstructTwoRealFFT:function(e,t,r){var n=e.re.length;t.re[0]=e.re[0],t.im[0]=0,r.re[0]=e.im[0],r.im[0]=0;for(var a,s,f,o,x,C=n/2;C>0;C--)x=n-C,a=.5*(e.re[C]-e.re[x]),s=.5*(e.re[C]+e.re[x]),f=.5*(e.im[C]-e.im[x]),o=.5*(e.im[C]+e.im[x]),t.re[C]=s,t.im[C]=f,t.re[x]=s,t.im[x]=-f,r.re[C]=o,r.im[C]=-a,r.re[x]=o,r.im[x]=a},convolute2DI:function(e,t,r,n){for(var a,s,f=0;f<r/2;f++)for(var o=0;o<n;o++)a=e[f*2*n+o]*t[f*2*n+o]-e[(f*2+1)*n+o]*t[(f*2+1)*n+o],s=e[f*2*n+o]*t[(f*2+1)*n+o]+e[(f*2+1)*n+o]*t[f*2*n+o],e[f*2*n+o]=a,e[(f*2+1)*n+o]=s},convolute:function(e,t,r,n,a){for(var s=new Array(n*r),f=0;f<r*n;f++)s[f]=e[f];s=this.fft2DArray(s,r,n);for(var o=t.length,x=t[0].length,C=new Array(n*r),f=0;f<n*r;f++)C[f]=0;for(var P,ge,nt=Math.floor((o-1)/2),ze=Math.floor((x-1)/2),Bt=0;Bt<o;Bt++){P=(Bt-nt+r)%r;for(var qr=0;qr<x;qr++)ge=(qr-ze+n)%n,C[P*n+ge]=t[Bt][qr]}C=this.fft2DArray(C,r,n);var _n=r*2,Fn=n/2+1;return this.convolute2DI(s,C,_n,Fn),this.ifft2DArray(s,_n,Fn)},toRadix2:function(e,t,r){var n,a,s,f,o=r,x=t;if(!(r!==0&&!(r&r-1))){for(o=0;r>>++o;);o=1<<o}if(!(t!==0&&!(t&t-1))){for(x=0;t>>++x;);x=1<<x}if(x==t&&o==r)return{data:e,rows:t,cols:r};var C=new Array(x*o),P=Math.floor((x-t)/2)-t,ge=Math.floor((o-r)/2)-r;for(n=0;n<x;n++)for(s=n*o,f=(n-P)%t*r,a=0;a<o;a++)C[s+a]=e[f+(a-ge)%r];return{data:C,rows:x,cols:o}},crop:function(e,t,r,n,a,s){if(t==n&&r==a)return e;Object.assign({},s);var f=new Array(a*n),o=Math.floor((t-n)/2),x=Math.floor((r-a)/2),C,P,ge,nt;for(ge=0;ge<n;ge++)for(C=ge*a,P=(ge+o)*r,nt=0;nt<a;nt++)f[C+nt]=e[P+(nt+x)];return f}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(e,t,r){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),f,o;if(s.rows&&s.cols)f=s.rows,o=s.cols;else throw new Error("Invalid number of rows or columns "+f+" "+o);var x=s.divisor,C,P,ge=t.length,nt=t[0].length;if(s.normalize)for(x=0,C=0;C<ge;C++)for(P=0;P<nt;P++)x+=t[C][P];if(x===0)throw new RangeError("convolution: The divisor is equal to zero");var ze=FFTUtils.toRadix2(a,f,o),Bt=FFTUtils.convolute(ze.data,t,ze.rows,ze.cols);if(Bt=FFTUtils.crop(Bt,ze.rows,ze.cols,f,o),x!=0&&x!=1)for(C=0;C<Bt.length;C++)Bt[C]/=x;return Bt}function convolutionDirect(e,t,r){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),f,o;if(s.rows&&s.cols)f=s.rows,o=s.cols;else throw new Error("Invalid number of rows or columns "+f+" "+o);var x=s.divisor,C=t.length,P=t[0].length,ge,nt,ze,Bt,qr,_n,Fn,tl,Io;if(s.normalize)for(x=0,ge=0;ge<C;ge++)for(nt=0;nt<P;nt++)x+=t[ge][nt];if(x===0)throw new RangeError("convolution: The divisor is equal to zero");var Co=new Array(f*o),rl=Math.floor(C/2),ah=Math.floor(P/2);for(Bt=0;Bt<f;Bt++)for(ze=0;ze<o;ze++){for(_n=0,nt=0;nt<C;nt++)for(ge=0;ge<P;ge++)Fn=t[C-nt-1][P-ge-1],tl=(Bt+nt-rl+f)%f,Io=(ze+ge-ah+o)%o,qr=tl*o+Io,_n+=a[qr]*Fn;qr=Bt*o+ze,Co[qr]=_n/x}return Co}function LoG(e,t,r){var n=1e3;r&&r.factor&&(n=r.factor);var a=new Array(t),s,f,o,x;n*=-1;var C=(t-1)/2,P=2*e*e;for(s=0;s<t;s++)for(a[s]=new Array(t),x=(s-C)*(s-C),f=0;f<t;f++)o=-((f-C)*(f-C)+x)/P,a[s][f]=Math.round(n*(1+o)*Math.exp(o));return a}function matrix2Array(e){var t=e,r,n;if(typeof e[0]!="number"){r=e.length,n=e[0].length,t=new Array(r*n);for(var a=0;a<r;a++)for(var s=0;s<n;s++)t[a*n+s]=e[a][s]}else{var f=Math.sqrt(e.length);Number.isInteger(f)&&(r=f,n=f)}return{data:t,rows:r,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite$1(e)&&Math.floor(e)===e};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(e){let t,r;if(Array.isArray(e))if(Array.isArray(e[0])){if(!(e.length&1)||!(e[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(e.length/2),r=Math.floor(e[0].length/2)}else{let n=Math.sqrt(e.length);if(isInteger$1(n))r=t=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let a=new Array(n);for(let s=0;s<n;s++){a[s]=new Array(n);for(let f=0;f<n;f++)a[s][f]=e[s*n+f]}e=a}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:r,kHeight:t}}function clamp(e,t){return Math.round(Math.min(Math.max(e,0),t.maxValue))}function directConvolution(e,t,r){if(r===void 0){const s=e.length+t.length-1;r=new Array(s)}fill(r);for(var n=0;n<e.length;n++)for(var a=0;a<t.length;a++)r[n+a]+=e[n]*t[a];return r}function fill(e){for(var t=0;t<e.length;t++)e[t]=0}function FFT(e){if(this.size=e|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(this.size*2),r=0;r<t.length;r+=2){const x=Math.PI*r/this.size;t[r]=Math.cos(x),t[r+1]=-Math.sin(x)}this.table=t;for(var n=0,a=1;this.size>a;a<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var f=0;f<this._width;f+=2){var o=this._width-f-2;this._bitrev[s]|=(s>>>f&3)<<o}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function e(t,r){for(var n=r||new Array(t.length>>>1),a=0;a<t.length;a+=2)n[a>>>1]=t[a];return n};FFT.prototype.createComplexArray=function e(){const t=new Array(this._csize);for(var r=0;r<t.length;r++)t[r]=0;return t};FFT.prototype.toComplexArray=function e(t,r){for(var n=r||this.createComplexArray(),a=0;a<n.length;a+=2)n[a]=t[a>>>1],n[a+1]=0;return n};FFT.prototype.completeSpectrum=function e(t){for(var r=this._csize,n=r>>>1,a=2;a<n;a+=2)t[r-a]=t[a],t[r-a+1]=-t[a+1]};FFT.prototype.transform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function e(){var t=this._out,r=this._csize,n=this._width,a=1<<n,s=r/a<<1,f,o,x=this._bitrev;if(s===4)for(f=0,o=0;f<r;f+=s,o++){const qr=x[o];this._singleTransform2(f,qr,a)}else for(f=0,o=0;f<r;f+=s,o++){const qr=x[o];this._singleTransform4(f,qr,a)}var C=this._inv?-1:1,P=this.table;for(a>>=2;a>=2;a>>=2){s=r/a<<1;var ge=s>>>2;for(f=0;f<r;f+=s)for(var nt=f+ge,ze=f,Bt=0;ze<nt;ze+=2,Bt+=a){const qr=ze,_n=qr+ge,Fn=_n+ge,tl=Fn+ge,Io=t[qr],Co=t[qr+1],rl=t[_n],ah=t[_n+1],ch=t[Fn],ju=t[Fn+1],Zu=t[tl],sl=t[tl+1],oh=Io,hh=Co,Sh=P[Bt],$h=C*P[Bt+1],hd=rl*Sh-ah*$h,vd=rl*$h+ah*Sh,Ef=P[2*Bt],Cd=C*P[2*Bt+1],Cf=ch*Ef-ju*Cd,Sd=ch*Cd+ju*Ef,yd=P[3*Bt],Hd=C*P[3*Bt+1],xd=Zu*yd-sl*Hd,Pd=Zu*Hd+sl*yd,zd=oh+Cf,Ld=hh+Sd,Kd=oh-Cf,wf=hh-Sd,kd=hd+xd,cd=vd+Pd,gd=C*(hd-xd),bp=C*(vd-Pd),Uf=zd+kd,qd=Ld+cd,Vd=zd-kd,ep=Ld-cd,_p=Kd+bp,lp=wf-gd,Kh=Kd-bp,Qd=wf+gd;t[qr]=Uf,t[qr+1]=qd,t[_n]=_p,t[_n+1]=lp,t[Fn]=Vd,t[Fn+1]=ep,t[tl]=Kh,t[tl+1]=Qd}}};FFT.prototype._singleTransform2=function e(t,r,n){const a=this._out,s=this._data,f=s[r],o=s[r+1],x=s[r+n],C=s[r+n+1],P=f+x,ge=o+C,nt=f-x,ze=o-C;a[t]=P,a[t+1]=ge,a[t+2]=nt,a[t+3]=ze};FFT.prototype._singleTransform4=function e(t,r,n){const a=this._out,s=this._data,f=this._inv?-1:1,o=n*2,x=n*3,C=s[r],P=s[r+1],ge=s[r+n],nt=s[r+n+1],ze=s[r+o],Bt=s[r+o+1],qr=s[r+x],_n=s[r+x+1],Fn=C+ze,tl=P+Bt,Io=C-ze,Co=P-Bt,rl=ge+qr,ah=nt+_n,ch=f*(ge-qr),ju=f*(nt-_n),Zu=Fn+rl,sl=tl+ah,oh=Io+ju,hh=Co-ch,Sh=Fn-rl,$h=tl-ah,hd=Io-ju,vd=Co+ch;a[t]=Zu,a[t+1]=sl,a[t+2]=oh,a[t+3]=hh,a[t+4]=Sh,a[t+5]=$h,a[t+6]=hd,a[t+7]=vd};FFT.prototype._realTransform4=function e(){var t=this._out,r=this._csize,n=this._width,a=1<<n,s=r/a<<1,f,o,x=this._bitrev;if(s===4)for(f=0,o=0;f<r;f+=s,o++){const Zf=x[o];this._singleRealTransform2(f,Zf>>>1,a>>>1)}else for(f=0,o=0;f<r;f+=s,o++){const Zf=x[o];this._singleRealTransform4(f,Zf>>>1,a>>>1)}var C=this._inv?-1:1,P=this.table;for(a>>=2;a>=2;a>>=2){s=r/a<<1;var ge=s>>>1,nt=ge>>>1,ze=nt>>>1;for(f=0;f<r;f+=s)for(var Bt=0,qr=0;Bt<=ze;Bt+=2,qr+=a){var _n=f+Bt,Fn=_n+nt,tl=Fn+nt,Io=tl+nt,Co=t[_n],rl=t[_n+1],ah=t[Fn],ch=t[Fn+1],ju=t[tl],Zu=t[tl+1],sl=t[Io],oh=t[Io+1],hh=Co,Sh=rl,$h=P[qr],hd=C*P[qr+1],vd=ah*$h-ch*hd,Ef=ah*hd+ch*$h,Cd=P[2*qr],Cf=C*P[2*qr+1],Sd=ju*Cd-Zu*Cf,yd=ju*Cf+Zu*Cd,Hd=P[3*qr],xd=C*P[3*qr+1],Pd=sl*Hd-oh*xd,zd=sl*xd+oh*Hd,Ld=hh+Sd,Kd=Sh+yd,wf=hh-Sd,kd=Sh-yd,cd=vd+Pd,gd=Ef+zd,bp=C*(vd-Pd),Uf=C*(Ef-zd),qd=Ld+cd,Vd=Kd+gd,ep=wf+Uf,_p=kd-bp;if(t[_n]=qd,t[_n+1]=Vd,t[Fn]=ep,t[Fn+1]=_p,Bt===0){var lp=Ld-cd,Kh=Kd-gd;t[tl]=lp,t[tl+1]=Kh;continue}if(Bt!==ze){var Qd=wf,fd=-kd,Jd=Ld,Yh=-Kd,$d=-C*Uf,Jf=-C*bp,Sf=-C*gd,If=-C*cd,Xf=Qd+$d,Of=fd+Jf,jf=Jd+If,Ap=Yh-Sf,vp=f+nt-Bt,Tp=f+ge-Bt;t[vp]=Xf,t[vp+1]=Of,t[Tp]=jf,t[Tp+1]=Ap}}}};FFT.prototype._singleRealTransform2=function e(t,r,n){const a=this._out,s=this._data,f=s[r],o=s[r+n],x=f+o,C=f-o;a[t]=x,a[t+1]=0,a[t+2]=C,a[t+3]=0};FFT.prototype._singleRealTransform4=function e(t,r,n){const a=this._out,s=this._data,f=this._inv?-1:1,o=n*2,x=n*3,C=s[r],P=s[r+n],ge=s[r+o],nt=s[r+x],ze=C+ge,Bt=C-ge,qr=P+nt,_n=f*(P-nt),Fn=ze+qr,tl=Bt,Io=-_n,Co=ze-qr,rl=Bt,ah=_n;a[t]=Fn,a[t+1]=0,a[t+2]=tl,a[t+3]=Io,a[t+4]=Co,a[t+5]=0,a[t+6]=rl,a[t+7]=ah};function convolutionSeparable(e,t,r,n){const a=new Array(e.length);let s,f,o,x;x=t[1],o=(x.length-1)/2,f=new Array(r+x.length-1),s=new Array(r);for(let C=0;C<n;C++){for(let P=0;P<r;P++)s[P]=e[C*r+P];directConvolution(s,x,f);for(let P=0;P<r;P++)a[C*r+P]=f[o+P]}x=t[0],o=(x.length-1)/2,f=new Array(n+x.length-1),s=new Array(n);for(let C=0;C<r;C++){for(let P=0;P<n;P++)s[P]=a[P*r+C];directConvolution(s,x,f);for(let P=0;P<n;P++)a[P*r+C]=f[o+P]}return a}const toString$4=Object.prototype.toString;function isAnyArray(e){const t=toString$4.call(e);return t.endsWith("Array]")&&!t.includes("Big")}function max$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,a=t.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var f=e[n],o=n+1;o<s;o++)e[o]>f&&(f=e[o]);return f}function min$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,a=t.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var f=e[n],o=n+1;o<s;o++)e[o]<f&&(f=e[o]);return f}function rescale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(t.output!==void 0){if(!isAnyArray(t.output))throw new TypeError("output option must be an array if specified");r=t.output}else r=new Array(e.length);var n=min$1(e),a=max$1(e);if(n===a)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=t.min,f=s===void 0?t.autoMinMax?n:0:s,o=t.max,x=o===void 0?t.autoMinMax?a:1:o;if(f>=x)throw new RangeError("min option must be smaller than max option");for(var C=(x-f)/(a-n),P=0;P<e.length;P++)r[P]=(e[P]-n)*C+f;return r}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(e,t={}){const{maxRows:r=15,maxColumns:n=10,maxNumSize:a=8,padMinus:s="auto"}=t;return`${e.constructor.name} {
${indent}[
${indentData}${inspectData(e,r,n,a,s)}
${indent}]
${indent}rows: ${e.rows}
${indent}columns: ${e.columns}
}`}function inspectData(e,t,r,n,a){const{rows:s,columns:f}=e,o=Math.min(s,t),x=Math.min(f,r),C=[];if(a==="auto"){a=!1;e:for(let P=0;P<o;P++)for(let ge=0;ge<x;ge++)if(e.get(P,ge)<0){a=!0;break e}}for(let P=0;P<o;P++){let ge=[];for(let nt=0;nt<x;nt++)ge.push(formatNumber(e.get(P,nt),n,a));C.push(`${ge.join(" ")}`)}return x!==f&&(C[C.length-1]+=` ... ${f-r} more columns`),o!==s&&C.push(`... ${s-t} more rows`),C.join(`
${indentData}`)}function formatNumber(e,t,r){return(e>=0&&r?` ${formatNumber2(e,t-1)}`:formatNumber2(e,t)).padEnd(t)}function formatNumber2(e,t){let r=e.toString();if(r.length<=t)return r;let n=e.toFixed(t);if(n.length>t&&(n=e.toFixed(Math.max(0,t-(n.length-t)))),n.length<=t&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let a=e.toExponential(t);return a.length>t&&(a=e.toExponential(Math.max(0,t-(a.length-t)))),a.slice(0)}function installMathOperations(e,t){e.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},e.prototype.addS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n);return this},e.prototype.addM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n.get(a,s));return this},e.add=function(n,a){return new t(n).add(a)},e.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},e.prototype.subS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n);return this},e.prototype.subM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n.get(a,s));return this},e.sub=function(n,a){return new t(n).sub(a)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},e.prototype.mulS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n);return this},e.prototype.mulM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n.get(a,s));return this},e.mul=function(n,a){return new t(n).mul(a)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},e.prototype.divS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n);return this},e.prototype.divM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n.get(a,s));return this},e.div=function(n,a){return new t(n).div(a)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},e.prototype.modS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n);return this},e.prototype.modM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n.get(a,s));return this},e.mod=function(n,a){return new t(n).mod(a)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},e.prototype.andS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n);return this},e.prototype.andM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n.get(a,s));return this},e.and=function(n,a){return new t(n).and(a)},e.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},e.prototype.orS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n);return this},e.prototype.orM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n.get(a,s));return this},e.or=function(n,a){return new t(n).or(a)},e.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},e.prototype.xorS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n);return this},e.prototype.xorM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n.get(a,s));return this},e.xor=function(n,a){return new t(n).xor(a)},e.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},e.prototype.leftShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n);return this},e.prototype.leftShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n.get(a,s));return this},e.leftShift=function(n,a){return new t(n).leftShift(a)},e.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},e.prototype.signPropagatingRightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n);return this},e.prototype.signPropagatingRightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n.get(a,s));return this},e.signPropagatingRightShift=function(n,a){return new t(n).signPropagatingRightShift(a)},e.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},e.prototype.rightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n);return this},e.prototype.rightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n.get(a,s));return this},e.rightShift=function(n,a){return new t(n).rightShift(a)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,~this.get(n,a));return this},e.not=function(n){return new t(n).not()},e.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.abs(this.get(n,a)));return this},e.abs=function(n){return new t(n).abs()},e.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acos(this.get(n,a)));return this},e.acos=function(n){return new t(n).acos()},e.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acosh(this.get(n,a)));return this},e.acosh=function(n){return new t(n).acosh()},e.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asin(this.get(n,a)));return this},e.asin=function(n){return new t(n).asin()},e.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asinh(this.get(n,a)));return this},e.asinh=function(n){return new t(n).asinh()},e.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atan(this.get(n,a)));return this},e.atan=function(n){return new t(n).atan()},e.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atanh(this.get(n,a)));return this},e.atanh=function(n){return new t(n).atanh()},e.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cbrt(this.get(n,a)));return this},e.cbrt=function(n){return new t(n).cbrt()},e.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.ceil(this.get(n,a)));return this},e.ceil=function(n){return new t(n).ceil()},e.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.clz32(this.get(n,a)));return this},e.clz32=function(n){return new t(n).clz32()},e.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cos(this.get(n,a)));return this},e.cos=function(n){return new t(n).cos()},e.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cosh(this.get(n,a)));return this},e.cosh=function(n){return new t(n).cosh()},e.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.exp(this.get(n,a)));return this},e.exp=function(n){return new t(n).exp()},e.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.expm1(this.get(n,a)));return this},e.expm1=function(n){return new t(n).expm1()},e.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.floor(this.get(n,a)));return this},e.floor=function(n){return new t(n).floor()},e.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.fround(this.get(n,a)));return this},e.fround=function(n){return new t(n).fround()},e.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log(this.get(n,a)));return this},e.log=function(n){return new t(n).log()},e.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log1p(this.get(n,a)));return this},e.log1p=function(n){return new t(n).log1p()},e.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log10(this.get(n,a)));return this},e.log10=function(n){return new t(n).log10()},e.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log2(this.get(n,a)));return this},e.log2=function(n){return new t(n).log2()},e.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.round(this.get(n,a)));return this},e.round=function(n){return new t(n).round()},e.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sign(this.get(n,a)));return this},e.sign=function(n){return new t(n).sign()},e.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sin(this.get(n,a)));return this},e.sin=function(n){return new t(n).sin()},e.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sinh(this.get(n,a)));return this},e.sinh=function(n){return new t(n).sinh()},e.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sqrt(this.get(n,a)));return this},e.sqrt=function(n){return new t(n).sqrt()},e.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tan(this.get(n,a)));return this},e.tan=function(n){return new t(n).tan()},e.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tanh(this.get(n,a)));return this},e.tanh=function(n){return new t(n).tanh()},e.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.trunc(this.get(n,a)));return this},e.trunc=function(n){return new t(n).trunc()},e.pow=function(n,a){return new t(n).pow(a)},e.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},e.prototype.powS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n));return this},e.prototype.powM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n.get(a,s)));return this}}function checkRowIndex(e,t,r){let n=r?e.rows:e.rows-1;if(t<0||t>n)throw new RangeError("Row index out of range")}function checkColumnIndex(e,t,r){let n=r?e.columns:e.columns-1;if(t<0||t>n)throw new RangeError("Column index out of range")}function checkRowVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(e,t){if(!isAnyArray(t))throw new TypeError("row indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(e,t){if(!isAnyArray(t))throw new TypeError("column indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.columns)throw new RangeError("column indices are out of range")}function checkRange(e,t,r,n,a){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",r),checkNumber("startColumn",n),checkNumber("endColumn",a),t>r||n>a||t<0||t>=e.rows||r<0||r>=e.rows||n<0||n>=e.columns||a<0||a>=e.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(e,t=0){let r=[];for(let n=0;n<e;n++)r.push(t);return r}function checkNumber(e,t){if(typeof t!="number")throw new TypeError(`${e} must be a number`)}function checkNonEmpty(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(e){let t=newArray$2(e.rows);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]+=e.get(r,n);return t}function sumByColumn(e){let t=newArray$2(e.columns);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]+=e.get(r,n);return t}function sumAll(e){let t=0;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t+=e.get(r,n);return t}function productByRow(e){let t=newArray$2(e.rows,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]*=e.get(r,n);return t}function productByColumn(e){let t=newArray$2(e.columns,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]*=e.get(r,n);return t}function productAll(e){let t=1;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t*=e.get(r,n);return t}function varianceByRow(e,t,r){const n=e.rows,a=e.columns,s=[];for(let f=0;f<n;f++){let o=0,x=0,C=0;for(let P=0;P<a;P++)C=e.get(f,P)-r[f],o+=C,x+=C*C;t?s.push((x-o*o/a)/(a-1)):s.push((x-o*o/a)/a)}return s}function varianceByColumn(e,t,r){const n=e.rows,a=e.columns,s=[];for(let f=0;f<a;f++){let o=0,x=0,C=0;for(let P=0;P<n;P++)C=e.get(P,f)-r[f],o+=C,x+=C*C;t?s.push((x-o*o/n)/(n-1)):s.push((x-o*o/n)/n)}return s}function varianceAll(e,t,r){const n=e.rows,a=e.columns,s=n*a;let f=0,o=0,x=0;for(let C=0;C<n;C++)for(let P=0;P<a;P++)x=e.get(C,P)-r,f+=x,o+=x*x;return t?(o-f*f/s)/(s-1):(o-f*f/s)/s}function centerByRow(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[r])}function centerByColumn(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[n])}function centerAll(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t)}function getScaleByRow(e){const t=[];for(let r=0;r<e.rows;r++){let n=0;for(let a=0;a<e.columns;a++)n+=Math.pow(e.get(r,a),2)/(e.columns-1);t.push(Math.sqrt(n))}return t}function scaleByRow(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[r])}function getScaleByColumn(e){const t=[];for(let r=0;r<e.columns;r++){let n=0;for(let a=0;a<e.rows;a++)n+=Math.pow(e.get(a,r),2)/(e.rows-1);t.push(Math.sqrt(n))}return t}function scaleByColumn(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[n])}function getScaleAll(e){const t=e.size-1;let r=0;for(let n=0;n<e.columns;n++)for(let a=0;a<e.rows;a++)r+=Math.pow(e.get(a,n),2)/t;return Math.sqrt(r)}function scaleAll(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t)}class AbstractMatrix{static from1DArray(t,r,n){if(t*r!==n.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix$2(t,r);for(let f=0;f<t;f++)for(let o=0;o<r;o++)s.set(f,o,n[f*r+o]);return s}static rowVector(t){let r=new Matrix$2(1,t.length);for(let n=0;n<t.length;n++)r.set(0,n,t[n]);return r}static columnVector(t){let r=new Matrix$2(t.length,1);for(let n=0;n<t.length;n++)r.set(n,0,t[n]);return r}static zeros(t,r){return new Matrix$2(t,r)}static ones(t,r){return new Matrix$2(t,r).fill(1)}static rand(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:a=Math.random}=n;let s=new Matrix$2(t,r);for(let f=0;f<t;f++)for(let o=0;o<r;o++)s.set(f,o,a());return s}static randInt(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:a=0,max:s=1e3,random:f=Math.random}=n;if(!Number.isInteger(a))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(a>=s)throw new RangeError("min must be smaller than max");let o=s-a,x=new Matrix$2(t,r);for(let C=0;C<t;C++)for(let P=0;P<r;P++){let ge=a+Math.round(f()*o);x.set(C,P,ge)}return x}static eye(t,r,n){r===void 0&&(r=t),n===void 0&&(n=1);let a=Math.min(t,r),s=this.zeros(t,r);for(let f=0;f<a;f++)s.set(f,f,n);return s}static diag(t,r,n){let a=t.length;r===void 0&&(r=a),n===void 0&&(n=r);let s=Math.min(a,r,n),f=this.zeros(r,n);for(let o=0;o<s;o++)f.set(o,o,t[o]);return f}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,a=t.columns,s=new Matrix$2(n,a);for(let f=0;f<n;f++)for(let o=0;o<a;o++)s.set(f,o,Math.min(t.get(f,o),r.get(f,o)));return s}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,a=t.columns,s=new this(n,a);for(let f=0;f<n;f++)for(let o=0;o<a;o++)s.set(f,o,Math.max(t.get(f,o),r.get(f,o)));return s}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix$2(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.call(this,r,n);return this}to1DArray(){let t=[];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.push(this.get(r,n));return t}to2DArray(){let t=[];for(let r=0;r<this.rows;r++){t.push([]);for(let n=0;n<this.columns;n++)t[r].push(this.get(r,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}isEchelonForm(){let t=0,r=0,n=-1,a=!0,s=!1;for(;t<this.rows&&a;){for(r=0,s=!1;r<this.columns&&s===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(s=!0,n=r):(a=!1,s=!0);t++}return a}isReducedEchelonForm(){let t=0,r=0,n=-1,a=!0,s=!1;for(;t<this.rows&&a;){for(r=0,s=!1;r<this.columns&&s===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(s=!0,n=r):(a=!1,s=!0);for(let f=r+1;f<this.rows;f++)this.get(t,f)!==0&&(a=!1);t++}return a}echelonForm(){let t=this.clone(),r=0,n=0;for(;r<t.rows&&n<t.columns;){let a=r;for(let s=r;s<t.rows;s++)t.get(s,n)>t.get(a,n)&&(a=s);if(t.get(a,n)===0)n++;else{t.swapRows(r,a);let s=t.get(r,n);for(let f=n;f<t.columns;f++)t.set(r,f,t.get(r,f)/s);for(let f=r+1;f<t.rows;f++){let o=t.get(f,n)/t.get(r,n);t.set(f,n,0);for(let x=n+1;x<t.columns;x++)t.set(f,x,t.get(f,x)-t.get(r,x)*o)}r++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),r=t.columns,n=t.rows,a=n-1;for(;a>=0;)if(t.maxRow(a)===0)a--;else{let s=0,f=!1;for(;s<n&&f===!1;)t.get(a,s)===1?f=!0:s++;for(let o=0;o<a;o++){let x=t.get(o,s);for(let C=s;C<r;C++){let P=t.get(o,C)-x*t.get(a,C);t.set(o,C,P)}}a--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:n=1}=t;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let a=new Matrix$2(this.rows*r,this.columns*n);for(let s=0;s<r;s++)for(let f=0;f<n;f++)a.setSubMatrix(this,this.rows*s,this.columns*f);return a}fill(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let r=[];for(let n=0;n<this.columns;n++)r.push(this.get(t,n));return r}getRowVector(t){return Matrix$2.rowVector(this.getRow(t))}setRow(t,r){checkRowIndex(this,t),r=checkRowVector(this,r);for(let n=0;n<this.columns;n++)this.set(t,n,r[n]);return this}swapRows(t,r){checkRowIndex(this,t),checkRowIndex(this,r);for(let n=0;n<this.columns;n++){let a=this.get(t,n);this.set(t,n,this.get(r,n)),this.set(r,n,a)}return this}getColumn(t){checkColumnIndex(this,t);let r=[];for(let n=0;n<this.rows;n++)r.push(this.get(n,t));return r}getColumnVector(t){return Matrix$2.columnVector(this.getColumn(t))}setColumn(t,r){checkColumnIndex(this,t),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++)this.set(n,t,r[n]);return this}swapColumns(t,r){checkColumnIndex(this,t),checkColumnIndex(this,r);for(let n=0;n<this.rows;n++){let a=this.get(n,t);this.set(n,t,this.get(n,r)),this.set(n,r,a)}return this}addRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[n]);return this}subRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[n]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[n]);return this}divRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[n]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[r]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[r]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[r]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[r]);return this}mulRow(t,r){checkRowIndex(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*r);return this}mulColumn(t,r){checkColumnIndex(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*r);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r[n]&&(r[n]=this.get(n,a));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r[a]&&(r[a]=this.get(n,a));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r&&(r=this.get(n,a));return r}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>t&&(t=this.get(n,a),r[0]=n,r[1]=a);return r}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r[n]&&(r[n]=this.get(n,a));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r[a]&&(r[a]=this.get(n,a));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r&&(r=this.get(n,a));return r}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<t&&(t=this.get(n,a),r[0]=n,r[1]=a);return r}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n));return r}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let r=this.get(t,0),n=[t,0];for(let a=1;a<this.columns;a++)this.get(t,a)>r&&(r=this.get(t,a),n[1]=a);return n}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n));return r}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let r=this.get(t,0),n=[t,0];for(let a=1;a<this.columns;a++)this.get(t,a)<r&&(r=this.get(t,a),n[1]=a);return n}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>r&&(r=this.get(n,t));return r}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let r=this.get(0,t),n=[0,t];for(let a=1;a<this.rows;a++)this.get(a,t)>r&&(r=this.get(a,t),n[0]=a);return n}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<r&&(r=this.get(n,t));return r}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let r=this.get(0,t),n=[0,t];for(let a=1;a<this.rows;a++)this.get(a,t)<r&&(r=this.get(a,t),n[0]=a);return n}diag(){let t=Math.min(this.rows,this.columns),r=[];for(let n=0;n<t;n++)r.push(this.get(n,n));return r}norm(t="frobenius"){let r=0;if(t==="max")return this.max();if(t==="frobenius"){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)r=r+this.get(n,a)*this.get(n,a);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t+=this.get(r,n),this.set(r,n,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let r=this.to1DArray();if(r.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let a=0;a<r.length;a++)n+=r[a]*t[a];return n}mmul(t){t=Matrix$2.checkMatrix(t);let r=this.rows,n=this.columns,a=t.columns,s=new Matrix$2(r,a),f=new Float64Array(n);for(let o=0;o<a;o++){for(let x=0;x<n;x++)f[x]=t.get(x,o);for(let x=0;x<r;x++){let C=0;for(let P=0;P<n;P++)C+=this.get(x,P)*f[P];s.set(x,o,C)}}return s}strassen2x2(t){t=Matrix$2.checkMatrix(t);let r=new Matrix$2(2,2);const n=this.get(0,0),a=t.get(0,0),s=this.get(0,1),f=t.get(0,1),o=this.get(1,0),x=t.get(1,0),C=this.get(1,1),P=t.get(1,1),ge=(n+C)*(a+P),nt=(o+C)*a,ze=n*(f-P),Bt=C*(x-a),qr=(n+s)*P,_n=(o-n)*(a+f),Fn=(s-C)*(x+P),tl=ge+Bt-qr+Fn,Io=ze+qr,Co=nt+Bt,rl=ge-nt+ze+_n;return r.set(0,0,tl),r.set(0,1,Io),r.set(1,0,Co),r.set(1,1,rl),r}strassen3x3(t){t=Matrix$2.checkMatrix(t);let r=new Matrix$2(3,3);const n=this.get(0,0),a=this.get(0,1),s=this.get(0,2),f=this.get(1,0),o=this.get(1,1),x=this.get(1,2),C=this.get(2,0),P=this.get(2,1),ge=this.get(2,2),nt=t.get(0,0),ze=t.get(0,1),Bt=t.get(0,2),qr=t.get(1,0),_n=t.get(1,1),Fn=t.get(1,2),tl=t.get(2,0),Io=t.get(2,1),Co=t.get(2,2),rl=(n+a+s-f-o-P-ge)*_n,ah=(n-f)*(-ze+_n),ch=o*(-nt+ze+qr-_n-Fn-tl+Co),ju=(-n+f+o)*(nt-ze+_n),Zu=(f+o)*(-nt+ze),sl=n*nt,oh=(-n+C+P)*(nt-Bt+Fn),hh=(-n+C)*(Bt-Fn),Sh=(C+P)*(-nt+Bt),$h=(n+a+s-o-x-C-P)*Fn,hd=P*(-nt+Bt+qr-_n-Fn-tl+Io),vd=(-s+P+ge)*(_n+tl-Io),Ef=(s-ge)*(_n-Io),Cd=s*tl,Cf=(P+ge)*(-tl+Io),Sd=(-s+o+x)*(Fn+tl-Co),yd=(s-x)*(Fn-Co),Hd=(o+x)*(-tl+Co),xd=a*qr,Pd=x*Io,zd=f*Bt,Ld=C*ze,Kd=ge*Co,wf=sl+Cd+xd,kd=rl+ju+Zu+sl+vd+Cd+Cf,cd=sl+oh+Sh+$h+Cd+Sd+Hd,gd=ah+ch+ju+sl+Cd+Sd+yd,bp=ah+ju+Zu+sl+Pd,Uf=Cd+Sd+yd+Hd+zd,qd=sl+oh+hh+hd+vd+Ef+Cd,Vd=vd+Ef+Cd+Cf+Ld,ep=sl+oh+hh+Sh+Kd;return r.set(0,0,wf),r.set(0,1,kd),r.set(0,2,cd),r.set(1,0,gd),r.set(1,1,bp),r.set(1,2,Uf),r.set(2,0,qd),r.set(2,1,Vd),r.set(2,2,ep),r}mmulStrassen(t){t=Matrix$2.checkMatrix(t);let r=this.clone(),n=r.rows,a=r.columns,s=t.rows,f=t.columns;a!==s&&console.warn(`Multiplying ${n} x ${a} and ${s} x ${f} matrix: dimensions do not match.`);function o(ge,nt,ze){let Bt=ge.rows,qr=ge.columns;if(Bt===nt&&qr===ze)return ge;{let _n=AbstractMatrix.zeros(nt,ze);return _n=_n.setSubMatrix(ge,0,0),_n}}let x=Math.max(n,s),C=Math.max(a,f);r=o(r,x,C),t=o(t,x,C);function P(ge,nt,ze,Bt){if(ze<=512||Bt<=512)return ge.mmul(nt);ze%2===1&&Bt%2===1?(ge=o(ge,ze+1,Bt+1),nt=o(nt,ze+1,Bt+1)):ze%2===1?(ge=o(ge,ze+1,Bt),nt=o(nt,ze+1,Bt)):Bt%2===1&&(ge=o(ge,ze,Bt+1),nt=o(nt,ze,Bt+1));let qr=parseInt(ge.rows/2,10),_n=parseInt(ge.columns/2,10),Fn=ge.subMatrix(0,qr-1,0,_n-1),tl=nt.subMatrix(0,qr-1,0,_n-1),Io=ge.subMatrix(0,qr-1,_n,ge.columns-1),Co=nt.subMatrix(0,qr-1,_n,nt.columns-1),rl=ge.subMatrix(qr,ge.rows-1,0,_n-1),ah=nt.subMatrix(qr,nt.rows-1,0,_n-1),ch=ge.subMatrix(qr,ge.rows-1,_n,ge.columns-1),ju=nt.subMatrix(qr,nt.rows-1,_n,nt.columns-1),Zu=P(AbstractMatrix.add(Fn,ch),AbstractMatrix.add(tl,ju),qr,_n),sl=P(AbstractMatrix.add(rl,ch),tl,qr,_n),oh=P(Fn,AbstractMatrix.sub(Co,ju),qr,_n),hh=P(ch,AbstractMatrix.sub(ah,tl),qr,_n),Sh=P(AbstractMatrix.add(Fn,Io),ju,qr,_n),$h=P(AbstractMatrix.sub(rl,Fn),AbstractMatrix.add(tl,Co),qr,_n),hd=P(AbstractMatrix.sub(Io,ch),AbstractMatrix.add(ah,ju),qr,_n),vd=AbstractMatrix.add(Zu,hh);vd.sub(Sh),vd.add(hd);let Ef=AbstractMatrix.add(oh,Sh),Cd=AbstractMatrix.add(sl,hh),Cf=AbstractMatrix.sub(Zu,sl);Cf.add(oh),Cf.add($h);let Sd=AbstractMatrix.zeros(2*vd.rows,2*vd.columns);return Sd=Sd.setSubMatrix(vd,0,0),Sd=Sd.setSubMatrix(Ef,vd.rows,0),Sd=Sd.setSubMatrix(Cd,0,vd.columns),Sd=Sd.setSubMatrix(Cf,vd.rows,vd.columns),Sd.subMatrix(0,ze-1,0,Bt-1)}return P(r,t,x,C)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.rows;s++){const f=this.getRow(s);f.length>0&&rescale(f,{min:r,max:n,output:f}),a.setRow(s,f)}return a}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.columns;s++){const f=this.getColumn(s);f.length&&rescale(f,{min:r,max:n,output:f}),a.setColumn(s,f)}return a}flipRows(){const t=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let n=0;n<t;n++){let a=this.get(r,n),s=this.get(r,this.columns-1-n);this.set(r,n,s),this.set(r,this.columns-1-n,a)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let n=0;n<t;n++){let a=this.get(n,r),s=this.get(this.rows-1-n,r);this.set(n,r,s),this.set(this.rows-1-n,r,a)}return this}kroneckerProduct(t){t=Matrix$2.checkMatrix(t);let r=this.rows,n=this.columns,a=t.rows,s=t.columns,f=new Matrix$2(r*a,n*s);for(let o=0;o<r;o++)for(let x=0;x<n;x++)for(let C=0;C<a;C++)for(let P=0;P<s;P++)f.set(a*o+C,s*x+P,this.get(o,x)*t.get(C,P));return f}kroneckerSum(t){if(t=Matrix$2.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,n=t.rows,a=this.kroneckerProduct(Matrix$2.eye(n,n)),s=Matrix$2.eye(r,r).kroneckerProduct(t);return a.add(s)}transpose(){let t=new Matrix$2(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(n,r,this.get(r,n));return t}sortRows(t=compareNumbers){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t=compareNumbers){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,n,a){checkRange(this,t,r,n,a);let s=new Matrix$2(r-t+1,a-n+1);for(let f=t;f<=r;f++)for(let o=n;o<=a;o++)s.set(f-t,o-n,this.get(f,o));return s}subMatrixRow(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.columns-1),r>n||r<0||r>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let a=new Matrix$2(t.length,n-r+1);for(let s=0;s<t.length;s++)for(let f=r;f<=n;f++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);a.set(s,f-r,this.get(t[s],f))}return a}subMatrixColumn(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.rows-1),r>n||r<0||r>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let a=new Matrix$2(n-r+1,t.length);for(let s=0;s<t.length;s++)for(let f=r;f<=n;f++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);a.set(f-r,s,this.get(f,t[s]))}return a}setSubMatrix(t,r,n){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return this;let a=r+t.rows-1,s=n+t.columns-1;checkRange(this,r,a,n,s);for(let f=0;f<t.rows;f++)for(let o=0;o<t.columns;o++)this.set(r+f,n+o,t.get(f,o));return this}selection(t,r){checkRowIndices(this,t),checkColumnIndices(this,r);let n=new Matrix$2(t.length,r.length);for(let a=0;a<t.length;a++){let s=t[a];for(let f=0;f<r.length;f++){let o=r[f];n.set(a,f,this.get(s,o))}}return n}trace(){let t=Math.min(this.rows,this.columns),r=0;for(let n=0;n<t;n++)r+=this.get(n,n);return r}clone(){let t=new Matrix$2(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(r,n,this.get(r,n));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const r=this.sum(t);switch(t){case"row":{for(let n=0;n<this.rows;n++)r[n]/=this.columns;return r}case"column":{for(let n=0;n<this.columns;n++)r[n]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:a=this.mean(t)}=r;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByRow(this,n,a)}case"column":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByColumn(this,n,a)}case void 0:{if(typeof a!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,a)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,r){typeof t=="object"&&(r=t,t=void 0);const n=this.variance(t,r);if(t===void 0)return Math.sqrt(n);for(let a=0;a<n.length;a++)n[a]=Math.sqrt(n[a]);return n}center(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:n=this.mean(t)}=r;switch(t){case"row":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");let n=r.scale;switch(t){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(e,t){return e-t}function isArrayOfNumbers(e){return e.every(t=>typeof t=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;let Matrix$2=class cS extends AbstractMatrix{constructor(t,r){if(super(),cS.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let n=0;n<t;n++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(t)){const n=t;if(t=n.length,r=t?n[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let a=0;a<t;a++){if(n[a].length!==r)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(n[a]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[a]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=t,this.columns=r}set(t,r,n){return this.data[t][r]=n,this}get(t,r){return this.data[t][r]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,r){return r===void 0&&(r=t,t=this.rows),checkRowIndex(this,t,!0),r=Float64Array.from(checkRowVector(this,r)),this.data.splice(t,0,r),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns-1);for(let a=0;a<t;a++)n[a]=this.data[r][a];for(let a=t+1;a<this.columns;a++)n[a-1]=this.data[r][a];this.data[r]=n}return this.columns-=1,this}addColumn(t,r){typeof r>"u"&&(r=t,t=this.columns),checkColumnIndex(this,t,!0),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++){const a=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)a[s]=this.data[n][s];for(a[s++]=r[n];s<this.columns+1;s++)a[s]=this.data[n][s-1];this.data[n]=a}return this.columns+=1,this}};installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(t,r,n){super(),this.matrix=t,this.rows=r,this.columns=n}}class MatrixColumnView extends BaseView{constructor(t,r){checkColumnIndex(t,r),super(t,t.rows,1),this.column=r}set(t,r,n){return this.matrix.set(t,this.column,n),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,r){checkColumnIndices(t,r),super(t,t.rows,r.length),this.columnIndices=r}set(t,r,n){return this.matrix.set(t,this.columnIndices[r],n),this}get(t,r){return this.matrix.get(t,this.columnIndices[r])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(t,this.columns-r-1,n),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(this.rows-t-1,r,n),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}class MatrixRowView extends BaseView{constructor(t,r){checkRowIndex(t,r),super(t,1,t.columns),this.row=r}set(t,r,n){return this.matrix.set(this.row,r,n),this}get(t,r){return this.matrix.get(this.row,r)}}class MatrixRowSelectionView extends BaseView{constructor(t,r){checkRowIndices(t,r),super(t,r.length,t.columns),this.rowIndices=r}set(t,r,n){return this.matrix.set(this.rowIndices[t],r,n),this}get(t,r){return this.matrix.get(this.rowIndices[t],r)}}class MatrixSelectionView extends BaseView{constructor(t,r,n){checkRowIndices(t,r),checkColumnIndices(t,n),super(t,r.length,n.length),this.rowIndices=r,this.columnIndices=n}set(t,r,n){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],n),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}}class MatrixSubView extends BaseView{constructor(t,r,n,a,s){checkRange(t,r,n,a,s),super(t,n-r+1,s-a+1),this.startRow=r,this.startColumn=a}set(t,r,n){return this.matrix.set(this.startRow+t,this.startColumn+r,n),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}let MatrixTransposeView$1=class extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,r,n){return this.matrix.set(r,t,n),this}get(t,r){return this.matrix.get(r,t)}};class WrapperMatrix1D extends AbstractMatrix{constructor(t,r={}){const{rows:n=1}=r;if(t.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=t.length/n,this.data=t}set(t,r,n){let a=this._calculateIndex(t,r);return this.data[a]=n,this}get(t,r){let n=this._calculateIndex(t,r);return this.data[n]}_calculateIndex(t,r){return t*this.columns+r}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,r,n){return this.data[t][r]=n,this}get(t,r){return this.data[t][r]}}function wrap(e,t){if(isAnyArray(e))return e[0]&&isAnyArray(e[0])?new WrapperMatrix2D(e):new WrapperMatrix1D(e,t);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let r=t.clone(),n=r.rows,a=r.columns,s=new Float64Array(n),f=1,o,x,C,P,ge,nt,ze,Bt,qr;for(o=0;o<n;o++)s[o]=o;for(Bt=new Float64Array(n),x=0;x<a;x++){for(o=0;o<n;o++)Bt[o]=r.get(o,x);for(o=0;o<n;o++){for(qr=Math.min(o,x),ge=0,C=0;C<qr;C++)ge+=r.get(o,C)*Bt[C];Bt[o]-=ge,r.set(o,x,Bt[o])}for(P=x,o=x+1;o<n;o++)Math.abs(Bt[o])>Math.abs(Bt[P])&&(P=o);if(P!==x){for(C=0;C<a;C++)nt=r.get(P,C),r.set(P,C,r.get(x,C)),r.set(x,C,nt);ze=s[P],s[P]=s[x],s[x]=ze,f=-f}if(x<n&&r.get(x,x)!==0)for(o=x+1;o<n;o++)r.set(o,x,r.get(o,x)/r.get(x,x))}this.LU=r,this.pivotVector=s,this.pivotSign=f}isSingular(){let t=this.LU,r=t.columns;for(let n=0;n<r;n++)if(t.get(n,n)===0)return!0;return!1}solve(t){t=Matrix$2.checkMatrix(t);let r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let a=t.columns,s=t.subMatrixRow(this.pivotVector,0,a-1),f=r.columns,o,x,C;for(C=0;C<f;C++)for(o=C+1;o<f;o++)for(x=0;x<a;x++)s.set(o,x,s.get(o,x)-s.get(C,x)*r.get(o,C));for(C=f-1;C>=0;C--){for(x=0;x<a;x++)s.set(C,x,s.get(C,x)/r.get(C,C));for(o=0;o<C;o++)for(x=0;x<a;x++)s.set(o,x,s.get(o,x)-s.get(C,x)*r.get(o,C))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,n=t.columns;for(let a=0;a<n;a++)r*=t.get(a,a);return r}get lowerTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,a=new Matrix$2(r,n);for(let s=0;s<r;s++)for(let f=0;f<n;f++)s>f?a.set(s,f,t.get(s,f)):s===f?a.set(s,f,1):a.set(s,f,0);return a}get upperTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,a=new Matrix$2(r,n);for(let s=0;s<r;s++)for(let f=0;f<n;f++)s<=f?a.set(s,f,t.get(s,f)):a.set(s,f,0);return a}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):t!==0?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}class QrDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let r=t.clone(),n=t.rows,a=t.columns,s=new Float64Array(a),f,o,x,C;for(x=0;x<a;x++){let P=0;for(f=x;f<n;f++)P=hypotenuse$1(P,r.get(f,x));if(P!==0){for(r.get(x,x)<0&&(P=-P),f=x;f<n;f++)r.set(f,x,r.get(f,x)/P);for(r.set(x,x,r.get(x,x)+1),o=x+1;o<a;o++){for(C=0,f=x;f<n;f++)C+=r.get(f,x)*r.get(f,o);for(C=-C/r.get(x,x),f=x;f<n;f++)r.set(f,o,r.get(f,o)+C*r.get(f,x))}}s[x]=-P}this.QR=r,this.Rdiag=s}solve(t){t=Matrix$2.checkMatrix(t);let r=this.QR,n=r.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let a=t.columns,s=t.clone(),f=r.columns,o,x,C,P;for(C=0;C<f;C++)for(x=0;x<a;x++){for(P=0,o=C;o<n;o++)P+=r.get(o,C)*s.get(o,x);for(P=-P/r.get(C,C),o=C;o<n;o++)s.set(o,x,s.get(o,x)+P*r.get(o,C))}for(C=f-1;C>=0;C--){for(x=0;x<a;x++)s.set(C,x,s.get(C,x)/this.Rdiag[C]);for(o=0;o<C;o++)for(x=0;x<a;x++)s.set(o,x,s.get(o,x)-s.get(C,x)*r.get(o,C))}return s.subMatrix(0,f-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let r=0;r<t;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,r=t.columns,n=new Matrix$2(r,r),a,s;for(a=0;a<r;a++)for(s=0;s<r;s++)a<s?n.set(a,s,t.get(a,s)):a===s?n.set(a,s,this.Rdiag[a]):n.set(a,s,0);return n}get orthogonalMatrix(){let t=this.QR,r=t.rows,n=t.columns,a=new Matrix$2(r,n),s,f,o,x;for(o=n-1;o>=0;o--){for(s=0;s<r;s++)a.set(s,o,0);for(a.set(o,o,1),f=o;f<n;f++)if(t.get(o,o)!==0){for(x=0,s=o;s<r;s++)x+=t.get(s,o)*a.get(s,f);for(x=-x/t.get(o,o),s=o;s<r;s++)a.set(s,f,a.get(s,f)+x*t.get(s,o))}}return a}}class SingularValueDecomposition{constructor(t,r={}){if(t=WrapperMatrix2D.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,a=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:f=!0,autoTranspose:o=!1}=r;let x=!!s,C=!!f,P=!1,ge;if(n<a)if(!o)ge=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{ge=t.transpose(),n=ge.rows,a=ge.columns,P=!0;let sl=x;x=C,C=sl}else ge=t.clone();let nt=Math.min(n,a),ze=Math.min(n+1,a),Bt=new Float64Array(ze),qr=new Matrix$2(n,nt),_n=new Matrix$2(a,a),Fn=new Float64Array(a),tl=new Float64Array(n),Io=new Float64Array(ze);for(let sl=0;sl<ze;sl++)Io[sl]=sl;let Co=Math.min(n-1,a),rl=Math.max(0,Math.min(a-2,n)),ah=Math.max(Co,rl);for(let sl=0;sl<ah;sl++){if(sl<Co){Bt[sl]=0;for(let oh=sl;oh<n;oh++)Bt[sl]=hypotenuse$1(Bt[sl],ge.get(oh,sl));if(Bt[sl]!==0){ge.get(sl,sl)<0&&(Bt[sl]=-Bt[sl]);for(let oh=sl;oh<n;oh++)ge.set(oh,sl,ge.get(oh,sl)/Bt[sl]);ge.set(sl,sl,ge.get(sl,sl)+1)}Bt[sl]=-Bt[sl]}for(let oh=sl+1;oh<a;oh++){if(sl<Co&&Bt[sl]!==0){let hh=0;for(let Sh=sl;Sh<n;Sh++)hh+=ge.get(Sh,sl)*ge.get(Sh,oh);hh=-hh/ge.get(sl,sl);for(let Sh=sl;Sh<n;Sh++)ge.set(Sh,oh,ge.get(Sh,oh)+hh*ge.get(Sh,sl))}Fn[oh]=ge.get(sl,oh)}if(x&&sl<Co)for(let oh=sl;oh<n;oh++)qr.set(oh,sl,ge.get(oh,sl));if(sl<rl){Fn[sl]=0;for(let oh=sl+1;oh<a;oh++)Fn[sl]=hypotenuse$1(Fn[sl],Fn[oh]);if(Fn[sl]!==0){Fn[sl+1]<0&&(Fn[sl]=0-Fn[sl]);for(let oh=sl+1;oh<a;oh++)Fn[oh]/=Fn[sl];Fn[sl+1]+=1}if(Fn[sl]=-Fn[sl],sl+1<n&&Fn[sl]!==0){for(let oh=sl+1;oh<n;oh++)tl[oh]=0;for(let oh=sl+1;oh<n;oh++)for(let hh=sl+1;hh<a;hh++)tl[oh]+=Fn[hh]*ge.get(oh,hh);for(let oh=sl+1;oh<a;oh++){let hh=-Fn[oh]/Fn[sl+1];for(let Sh=sl+1;Sh<n;Sh++)ge.set(Sh,oh,ge.get(Sh,oh)+hh*tl[Sh])}}if(C)for(let oh=sl+1;oh<a;oh++)_n.set(oh,sl,Fn[oh])}}let ch=Math.min(a,n+1);if(Co<a&&(Bt[Co]=ge.get(Co,Co)),n<ch&&(Bt[ch-1]=0),rl+1<ch&&(Fn[rl]=ge.get(rl,ch-1)),Fn[ch-1]=0,x){for(let sl=Co;sl<nt;sl++){for(let oh=0;oh<n;oh++)qr.set(oh,sl,0);qr.set(sl,sl,1)}for(let sl=Co-1;sl>=0;sl--)if(Bt[sl]!==0){for(let oh=sl+1;oh<nt;oh++){let hh=0;for(let Sh=sl;Sh<n;Sh++)hh+=qr.get(Sh,sl)*qr.get(Sh,oh);hh=-hh/qr.get(sl,sl);for(let Sh=sl;Sh<n;Sh++)qr.set(Sh,oh,qr.get(Sh,oh)+hh*qr.get(Sh,sl))}for(let oh=sl;oh<n;oh++)qr.set(oh,sl,-qr.get(oh,sl));qr.set(sl,sl,1+qr.get(sl,sl));for(let oh=0;oh<sl-1;oh++)qr.set(oh,sl,0)}else{for(let oh=0;oh<n;oh++)qr.set(oh,sl,0);qr.set(sl,sl,1)}}if(C)for(let sl=a-1;sl>=0;sl--){if(sl<rl&&Fn[sl]!==0)for(let oh=sl+1;oh<a;oh++){let hh=0;for(let Sh=sl+1;Sh<a;Sh++)hh+=_n.get(Sh,sl)*_n.get(Sh,oh);hh=-hh/_n.get(sl+1,sl);for(let Sh=sl+1;Sh<a;Sh++)_n.set(Sh,oh,_n.get(Sh,oh)+hh*_n.get(Sh,sl))}for(let oh=0;oh<a;oh++)_n.set(oh,sl,0);_n.set(sl,sl,1)}let ju=ch-1,Zu=Number.EPSILON;for(;ch>0;){let sl,oh;for(sl=ch-2;sl>=-1&&sl!==-1;sl--){const hh=Number.MIN_VALUE+Zu*Math.abs(Bt[sl]+Math.abs(Bt[sl+1]));if(Math.abs(Fn[sl])<=hh||Number.isNaN(Fn[sl])){Fn[sl]=0;break}}if(sl===ch-2)oh=4;else{let hh;for(hh=ch-1;hh>=sl&&hh!==sl;hh--){let Sh=(hh!==ch?Math.abs(Fn[hh]):0)+(hh!==sl+1?Math.abs(Fn[hh-1]):0);if(Math.abs(Bt[hh])<=Zu*Sh){Bt[hh]=0;break}}hh===sl?oh=3:hh===ch-1?oh=1:(oh=2,sl=hh)}switch(sl++,oh){case 1:{let hh=Fn[ch-2];Fn[ch-2]=0;for(let Sh=ch-2;Sh>=sl;Sh--){let $h=hypotenuse$1(Bt[Sh],hh),hd=Bt[Sh]/$h,vd=hh/$h;if(Bt[Sh]=$h,Sh!==sl&&(hh=-vd*Fn[Sh-1],Fn[Sh-1]=hd*Fn[Sh-1]),C)for(let Ef=0;Ef<a;Ef++)$h=hd*_n.get(Ef,Sh)+vd*_n.get(Ef,ch-1),_n.set(Ef,ch-1,-vd*_n.get(Ef,Sh)+hd*_n.get(Ef,ch-1)),_n.set(Ef,Sh,$h)}break}case 2:{let hh=Fn[sl-1];Fn[sl-1]=0;for(let Sh=sl;Sh<ch;Sh++){let $h=hypotenuse$1(Bt[Sh],hh),hd=Bt[Sh]/$h,vd=hh/$h;if(Bt[Sh]=$h,hh=-vd*Fn[Sh],Fn[Sh]=hd*Fn[Sh],x)for(let Ef=0;Ef<n;Ef++)$h=hd*qr.get(Ef,Sh)+vd*qr.get(Ef,sl-1),qr.set(Ef,sl-1,-vd*qr.get(Ef,Sh)+hd*qr.get(Ef,sl-1)),qr.set(Ef,Sh,$h)}break}case 3:{const hh=Math.max(Math.abs(Bt[ch-1]),Math.abs(Bt[ch-2]),Math.abs(Fn[ch-2]),Math.abs(Bt[sl]),Math.abs(Fn[sl])),Sh=Bt[ch-1]/hh,$h=Bt[ch-2]/hh,hd=Fn[ch-2]/hh,vd=Bt[sl]/hh,Ef=Fn[sl]/hh,Cd=(($h+Sh)*($h-Sh)+hd*hd)/2,Cf=Sh*hd*(Sh*hd);let Sd=0;(Cd!==0||Cf!==0)&&(Cd<0?Sd=0-Math.sqrt(Cd*Cd+Cf):Sd=Math.sqrt(Cd*Cd+Cf),Sd=Cf/(Cd+Sd));let yd=(vd+Sh)*(vd-Sh)+Sd,Hd=vd*Ef;for(let xd=sl;xd<ch-1;xd++){let Pd=hypotenuse$1(yd,Hd);Pd===0&&(Pd=Number.MIN_VALUE);let zd=yd/Pd,Ld=Hd/Pd;if(xd!==sl&&(Fn[xd-1]=Pd),yd=zd*Bt[xd]+Ld*Fn[xd],Fn[xd]=zd*Fn[xd]-Ld*Bt[xd],Hd=Ld*Bt[xd+1],Bt[xd+1]=zd*Bt[xd+1],C)for(let Kd=0;Kd<a;Kd++)Pd=zd*_n.get(Kd,xd)+Ld*_n.get(Kd,xd+1),_n.set(Kd,xd+1,-Ld*_n.get(Kd,xd)+zd*_n.get(Kd,xd+1)),_n.set(Kd,xd,Pd);if(Pd=hypotenuse$1(yd,Hd),Pd===0&&(Pd=Number.MIN_VALUE),zd=yd/Pd,Ld=Hd/Pd,Bt[xd]=Pd,yd=zd*Fn[xd]+Ld*Bt[xd+1],Bt[xd+1]=-Ld*Fn[xd]+zd*Bt[xd+1],Hd=Ld*Fn[xd+1],Fn[xd+1]=zd*Fn[xd+1],x&&xd<n-1)for(let Kd=0;Kd<n;Kd++)Pd=zd*qr.get(Kd,xd)+Ld*qr.get(Kd,xd+1),qr.set(Kd,xd+1,-Ld*qr.get(Kd,xd)+zd*qr.get(Kd,xd+1)),qr.set(Kd,xd,Pd)}Fn[ch-2]=yd;break}case 4:{if(Bt[sl]<=0&&(Bt[sl]=Bt[sl]<0?-Bt[sl]:0,C))for(let hh=0;hh<=ju;hh++)_n.set(hh,sl,-_n.get(hh,sl));for(;sl<ju&&!(Bt[sl]>=Bt[sl+1]);){let hh=Bt[sl];if(Bt[sl]=Bt[sl+1],Bt[sl+1]=hh,C&&sl<a-1)for(let Sh=0;Sh<a;Sh++)hh=_n.get(Sh,sl+1),_n.set(Sh,sl+1,_n.get(Sh,sl)),_n.set(Sh,sl,hh);if(x&&sl<n-1)for(let Sh=0;Sh<n;Sh++)hh=qr.get(Sh,sl+1),qr.set(Sh,sl+1,qr.get(Sh,sl)),qr.set(Sh,sl,hh);sl++}ch--;break}}}if(P){let sl=_n;_n=qr,qr=sl}this.m=n,this.n=a,this.s=Bt,this.U=qr,this.V=_n}solve(t){let r=t,n=this.threshold,a=this.s.length,s=Matrix$2.zeros(a,a);for(let nt=0;nt<a;nt++)Math.abs(this.s[nt])<=n?s.set(nt,nt,0):s.set(nt,nt,1/this.s[nt]);let f=this.U,o=this.rightSingularVectors,x=o.mmul(s),C=o.rows,P=f.rows,ge=Matrix$2.zeros(C,P);for(let nt=0;nt<C;nt++)for(let ze=0;ze<P;ze++){let Bt=0;for(let qr=0;qr<a;qr++)Bt+=x.get(nt,qr)*f.get(ze,qr);ge.set(nt,ze,Bt)}return ge.mmul(r)}solveForDiagonal(t){return this.solve(Matrix$2.diag(t))}inverse(){let t=this.V,r=this.threshold,n=t.rows,a=t.columns,s=new Matrix$2(n,this.s.length);for(let P=0;P<n;P++)for(let ge=0;ge<a;ge++)Math.abs(this.s[ge])>r&&s.set(P,ge,t.get(P,ge)/this.s[ge]);let f=this.U,o=f.rows,x=f.columns,C=new Matrix$2(n,o);for(let P=0;P<n;P++)for(let ge=0;ge<o;ge++){let nt=0;for(let ze=0;ze<x;ze++)nt+=s.get(P,ze)*f.get(ge,ze);C.set(P,ge,nt)}return C}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,n=this.s;for(let a=0,s=n.length;a<s;a++)n[a]>t&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(e,t=!1){return e=WrapperMatrix2D.checkMatrix(e),t?new SingularValueDecomposition(e).inverse():solve(e,Matrix$2.eye(e.rows))}function solve(e,t,r=!1){return e=WrapperMatrix2D.checkMatrix(e),t=WrapperMatrix2D.checkMatrix(t),r?new SingularValueDecomposition(e).solve(t):e.isSquare()?new LuDecomposition(e).solve(t):new QrDecomposition(e).solve(t)}function determinant(e){if(e=Matrix$2.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let t,r,n,a;if(e.columns===2)return t=e.get(0,0),r=e.get(0,1),n=e.get(1,0),a=e.get(1,1),t*a-r*n;if(e.columns===3){let s,f,o;return s=new MatrixSelectionView(e,[1,2],[1,2]),f=new MatrixSelectionView(e,[1,2],[0,2]),o=new MatrixSelectionView(e,[1,2],[0,1]),t=e.get(0,0),r=e.get(0,1),n=e.get(0,2),t*determinant(s)-r*determinant(f)+n*determinant(o)}else return new LuDecomposition(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(e,t){let r=[];for(let n=0;n<e;n++)n!==t&&r.push(n);return r}function dependenciesOneRow(e,t,r,n=1e-9,a=1e-9){if(e>a)return new Array(t.rows+1).fill(0);{let s=t.addRow(r,[0]);for(let f=0;f<s.rows;f++)Math.abs(s.get(f,0))<n&&s.set(f,0,0);return s.to1DArray()}}function linearDependencies(e,t={}){const{thresholdValue:r=1e-9,thresholdError:n=1e-9}=t;e=Matrix$2.checkMatrix(e);let a=e.rows,s=new Matrix$2(a,a);for(let f=0;f<a;f++){let o=Matrix$2.columnVector(e.getRow(f)),x=e.subMatrixRow(xrange(a,f)).transpose(),P=new SingularValueDecomposition(x).solve(o),ge=Matrix$2.sub(o,x.mmul(P)).abs().max();s.setRow(f,dependenciesOneRow(ge,P,f,r,n))}return s}function pseudoInverse(e,t=Number.EPSILON){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return e.transpose();let r=new SingularValueDecomposition(e,{autoTranspose:!0}),n=r.leftSingularVectors,a=r.rightSingularVectors,s=r.diagonal;for(let f=0;f<s.length;f++)Math.abs(s[f])>t?s[f]=1/s[f]:s[f]=0;return a.mmul(Matrix$2.diag(s).mmul(n.transpose()))}function covariance(e,t=e,r={}){e=new Matrix$2(e);let n=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(r=t,t=e,n=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0}=r;a&&(e=e.center("column"),n||(t=t.center("column")));const s=e.transpose().mmul(t);for(let f=0;f<s.rows;f++)for(let o=0;o<s.columns;o++)s.set(f,o,s.get(f,o)*(1/(e.rows-1)));return s}function correlation(e,t=e,r={}){e=new Matrix$2(e);let n=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(r=t,t=e,n=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0,scale:s=!0}=r;a&&(e.center("column"),n||t.center("column")),s&&(e.scale("column"),n||t.scale("column"));const f=e.standardDeviation("column",{unbiased:!0}),o=n?f:t.standardDeviation("column",{unbiased:!0}),x=e.transpose().mmul(t);for(let C=0;C<x.rows;C++)for(let P=0;P<x.columns;P++)x.set(C,P,x.get(C,P)*(1/(f[C]*o[P]))*(1/(e.rows-1)));return x}class EigenvalueDecomposition{constructor(t,r={}){const{assumeSymmetric:n=!1}=r;if(t=WrapperMatrix2D.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let a=t.columns,s=new Matrix$2(a,a),f=new Float64Array(a),o=new Float64Array(a),x=t,C,P,ge=!1;if(n?ge=!0:ge=t.isSymmetric(),ge){for(C=0;C<a;C++)for(P=0;P<a;P++)s.set(C,P,x.get(C,P));tred2(a,o,f,s),tql2(a,o,f,s)}else{let nt=new Matrix$2(a,a),ze=new Float64Array(a);for(P=0;P<a;P++)for(C=0;C<a;C++)nt.set(C,P,x.get(C,P));orthes(a,nt,ze,s),hqr2(a,o,f,s,nt)}this.n=a,this.e=o,this.d=f,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,r=this.e,n=this.d,a=new Matrix$2(t,t),s,f;for(s=0;s<t;s++){for(f=0;f<t;f++)a.set(s,f,0);a.set(s,s,n[s]),r[s]>0?a.set(s,s+1,r[s]):r[s]<0&&a.set(s,s-1,r[s])}return a}}function tred2(e,t,r,n){let a,s,f,o,x,C,P,ge;for(x=0;x<e;x++)r[x]=n.get(e-1,x);for(o=e-1;o>0;o--){for(ge=0,f=0,C=0;C<o;C++)ge=ge+Math.abs(r[C]);if(ge===0)for(t[o]=r[o-1],x=0;x<o;x++)r[x]=n.get(o-1,x),n.set(o,x,0),n.set(x,o,0);else{for(C=0;C<o;C++)r[C]/=ge,f+=r[C]*r[C];for(a=r[o-1],s=Math.sqrt(f),a>0&&(s=-s),t[o]=ge*s,f=f-a*s,r[o-1]=a-s,x=0;x<o;x++)t[x]=0;for(x=0;x<o;x++){for(a=r[x],n.set(x,o,a),s=t[x]+n.get(x,x)*a,C=x+1;C<=o-1;C++)s+=n.get(C,x)*r[C],t[C]+=n.get(C,x)*a;t[x]=s}for(a=0,x=0;x<o;x++)t[x]/=f,a+=t[x]*r[x];for(P=a/(f+f),x=0;x<o;x++)t[x]-=P*r[x];for(x=0;x<o;x++){for(a=r[x],s=t[x],C=x;C<=o-1;C++)n.set(C,x,n.get(C,x)-(a*t[C]+s*r[C]));r[x]=n.get(o-1,x),n.set(o,x,0)}}r[o]=f}for(o=0;o<e-1;o++){if(n.set(e-1,o,n.get(o,o)),n.set(o,o,1),f=r[o+1],f!==0){for(C=0;C<=o;C++)r[C]=n.get(C,o+1)/f;for(x=0;x<=o;x++){for(s=0,C=0;C<=o;C++)s+=n.get(C,o+1)*n.get(C,x);for(C=0;C<=o;C++)n.set(C,x,n.get(C,x)-s*r[C])}}for(C=0;C<=o;C++)n.set(C,o+1,0)}for(x=0;x<e;x++)r[x]=n.get(e-1,x),n.set(e-1,x,0);n.set(e-1,e-1,1),t[0]=0}function tql2(e,t,r,n){let a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n,Fn,tl,Io;for(f=1;f<e;f++)t[f-1]=t[f];t[e-1]=0;let Co=0,rl=0,ah=Number.EPSILON;for(C=0;C<e;C++){for(rl=Math.max(rl,Math.abs(r[C])+Math.abs(t[C])),P=C;P<e&&!(Math.abs(t[P])<=ah*rl);)P++;if(P>C)do{for(a=r[C],ge=(r[C+1]-a)/(2*t[C]),nt=hypotenuse$1(ge,1),ge<0&&(nt=-nt),r[C]=t[C]/(ge+nt),r[C+1]=t[C]*(ge+nt),ze=r[C+1],s=a-r[C],f=C+2;f<e;f++)r[f]-=s;for(Co=Co+s,ge=r[P],Bt=1,qr=Bt,_n=Bt,Fn=t[C+1],tl=0,Io=0,f=P-1;f>=C;f--)for(_n=qr,qr=Bt,Io=tl,a=Bt*t[f],s=Bt*ge,nt=hypotenuse$1(ge,t[f]),t[f+1]=tl*nt,tl=t[f]/nt,Bt=ge/nt,ge=Bt*r[f]-tl*a,r[f+1]=s+tl*(Bt*a+tl*r[f]),x=0;x<e;x++)s=n.get(x,f+1),n.set(x,f+1,tl*n.get(x,f)+Bt*s),n.set(x,f,Bt*n.get(x,f)-tl*s);ge=-tl*Io*_n*Fn*t[C]/ze,t[C]=tl*ge,r[C]=Bt*ge}while(Math.abs(t[C])>ah*rl);r[C]=r[C]+Co,t[C]=0}for(f=0;f<e-1;f++){for(x=f,ge=r[f],o=f+1;o<e;o++)r[o]<ge&&(x=o,ge=r[o]);if(x!==f)for(r[x]=r[f],r[f]=ge,o=0;o<e;o++)ge=n.get(o,f),n.set(o,f,n.get(o,x)),n.set(o,x,ge)}}function orthes(e,t,r,n){let a=0,s=e-1,f,o,x,C,P,ge,nt;for(ge=a+1;ge<=s-1;ge++){for(nt=0,C=ge;C<=s;C++)nt=nt+Math.abs(t.get(C,ge-1));if(nt!==0){for(x=0,C=s;C>=ge;C--)r[C]=t.get(C,ge-1)/nt,x+=r[C]*r[C];for(o=Math.sqrt(x),r[ge]>0&&(o=-o),x=x-r[ge]*o,r[ge]=r[ge]-o,P=ge;P<e;P++){for(f=0,C=s;C>=ge;C--)f+=r[C]*t.get(C,P);for(f=f/x,C=ge;C<=s;C++)t.set(C,P,t.get(C,P)-f*r[C])}for(C=0;C<=s;C++){for(f=0,P=s;P>=ge;P--)f+=r[P]*t.get(C,P);for(f=f/x,P=ge;P<=s;P++)t.set(C,P,t.get(C,P)-f*r[P])}r[ge]=nt*r[ge],t.set(ge,ge-1,nt*o)}}for(C=0;C<e;C++)for(P=0;P<e;P++)n.set(C,P,C===P?1:0);for(ge=s-1;ge>=a+1;ge--)if(t.get(ge,ge-1)!==0){for(C=ge+1;C<=s;C++)r[C]=t.get(C,ge-1);for(P=ge;P<=s;P++){for(o=0,C=ge;C<=s;C++)o+=r[C]*n.get(C,P);for(o=o/r[ge]/t.get(ge,ge-1),C=ge;C<=s;C++)n.set(C,P,n.get(C,P)+o*r[C])}}}function hqr2(e,t,r,n,a){let s=e-1,f=0,o=e-1,x=Number.EPSILON,C=0,P=0,ge=0,nt=0,ze=0,Bt=0,qr=0,_n=0,Fn,tl,Io,Co,rl,ah,ch,ju,Zu,sl,oh,hh,Sh,$h,hd;for(Fn=0;Fn<e;Fn++)for((Fn<f||Fn>o)&&(r[Fn]=a.get(Fn,Fn),t[Fn]=0),tl=Math.max(Fn-1,0);tl<e;tl++)P=P+Math.abs(a.get(Fn,tl));for(;s>=f;){for(Co=s;Co>f&&(Bt=Math.abs(a.get(Co-1,Co-1))+Math.abs(a.get(Co,Co)),Bt===0&&(Bt=P),!(Math.abs(a.get(Co,Co-1))<x*Bt));)Co--;if(Co===s)a.set(s,s,a.get(s,s)+C),r[s]=a.get(s,s),t[s]=0,s--,_n=0;else if(Co===s-1){if(ch=a.get(s,s-1)*a.get(s-1,s),ge=(a.get(s-1,s-1)-a.get(s,s))/2,nt=ge*ge+ch,qr=Math.sqrt(Math.abs(nt)),a.set(s,s,a.get(s,s)+C),a.set(s-1,s-1,a.get(s-1,s-1)+C),ju=a.get(s,s),nt>=0){for(qr=ge>=0?ge+qr:ge-qr,r[s-1]=ju+qr,r[s]=r[s-1],qr!==0&&(r[s]=ju-ch/qr),t[s-1]=0,t[s]=0,ju=a.get(s,s-1),Bt=Math.abs(ju)+Math.abs(qr),ge=ju/Bt,nt=qr/Bt,ze=Math.sqrt(ge*ge+nt*nt),ge=ge/ze,nt=nt/ze,tl=s-1;tl<e;tl++)qr=a.get(s-1,tl),a.set(s-1,tl,nt*qr+ge*a.get(s,tl)),a.set(s,tl,nt*a.get(s,tl)-ge*qr);for(Fn=0;Fn<=s;Fn++)qr=a.get(Fn,s-1),a.set(Fn,s-1,nt*qr+ge*a.get(Fn,s)),a.set(Fn,s,nt*a.get(Fn,s)-ge*qr);for(Fn=f;Fn<=o;Fn++)qr=n.get(Fn,s-1),n.set(Fn,s-1,nt*qr+ge*n.get(Fn,s)),n.set(Fn,s,nt*n.get(Fn,s)-ge*qr)}else r[s-1]=ju+ge,r[s]=ju+ge,t[s-1]=qr,t[s]=-qr;s=s-2,_n=0}else{if(ju=a.get(s,s),Zu=0,ch=0,Co<s&&(Zu=a.get(s-1,s-1),ch=a.get(s,s-1)*a.get(s-1,s)),_n===10){for(C+=ju,Fn=f;Fn<=s;Fn++)a.set(Fn,Fn,a.get(Fn,Fn)-ju);Bt=Math.abs(a.get(s,s-1))+Math.abs(a.get(s-1,s-2)),ju=Zu=.75*Bt,ch=-.4375*Bt*Bt}if(_n===30&&(Bt=(Zu-ju)/2,Bt=Bt*Bt+ch,Bt>0)){for(Bt=Math.sqrt(Bt),Zu<ju&&(Bt=-Bt),Bt=ju-ch/((Zu-ju)/2+Bt),Fn=f;Fn<=s;Fn++)a.set(Fn,Fn,a.get(Fn,Fn)-Bt);C+=Bt,ju=Zu=ch=.964}for(_n=_n+1,rl=s-2;rl>=Co&&(qr=a.get(rl,rl),ze=ju-qr,Bt=Zu-qr,ge=(ze*Bt-ch)/a.get(rl+1,rl)+a.get(rl,rl+1),nt=a.get(rl+1,rl+1)-qr-ze-Bt,ze=a.get(rl+2,rl+1),Bt=Math.abs(ge)+Math.abs(nt)+Math.abs(ze),ge=ge/Bt,nt=nt/Bt,ze=ze/Bt,!(rl===Co||Math.abs(a.get(rl,rl-1))*(Math.abs(nt)+Math.abs(ze))<x*(Math.abs(ge)*(Math.abs(a.get(rl-1,rl-1))+Math.abs(qr)+Math.abs(a.get(rl+1,rl+1))))));)rl--;for(Fn=rl+2;Fn<=s;Fn++)a.set(Fn,Fn-2,0),Fn>rl+2&&a.set(Fn,Fn-3,0);for(Io=rl;Io<=s-1&&($h=Io!==s-1,Io!==rl&&(ge=a.get(Io,Io-1),nt=a.get(Io+1,Io-1),ze=$h?a.get(Io+2,Io-1):0,ju=Math.abs(ge)+Math.abs(nt)+Math.abs(ze),ju!==0&&(ge=ge/ju,nt=nt/ju,ze=ze/ju)),ju!==0);Io++)if(Bt=Math.sqrt(ge*ge+nt*nt+ze*ze),ge<0&&(Bt=-Bt),Bt!==0){for(Io!==rl?a.set(Io,Io-1,-Bt*ju):Co!==rl&&a.set(Io,Io-1,-a.get(Io,Io-1)),ge=ge+Bt,ju=ge/Bt,Zu=nt/Bt,qr=ze/Bt,nt=nt/ge,ze=ze/ge,tl=Io;tl<e;tl++)ge=a.get(Io,tl)+nt*a.get(Io+1,tl),$h&&(ge=ge+ze*a.get(Io+2,tl),a.set(Io+2,tl,a.get(Io+2,tl)-ge*qr)),a.set(Io,tl,a.get(Io,tl)-ge*ju),a.set(Io+1,tl,a.get(Io+1,tl)-ge*Zu);for(Fn=0;Fn<=Math.min(s,Io+3);Fn++)ge=ju*a.get(Fn,Io)+Zu*a.get(Fn,Io+1),$h&&(ge=ge+qr*a.get(Fn,Io+2),a.set(Fn,Io+2,a.get(Fn,Io+2)-ge*ze)),a.set(Fn,Io,a.get(Fn,Io)-ge),a.set(Fn,Io+1,a.get(Fn,Io+1)-ge*nt);for(Fn=f;Fn<=o;Fn++)ge=ju*n.get(Fn,Io)+Zu*n.get(Fn,Io+1),$h&&(ge=ge+qr*n.get(Fn,Io+2),n.set(Fn,Io+2,n.get(Fn,Io+2)-ge*ze)),n.set(Fn,Io,n.get(Fn,Io)-ge),n.set(Fn,Io+1,n.get(Fn,Io+1)-ge*nt)}}}if(P!==0){for(s=e-1;s>=0;s--)if(ge=r[s],nt=t[s],nt===0)for(Co=s,a.set(s,s,1),Fn=s-1;Fn>=0;Fn--){for(ch=a.get(Fn,Fn)-ge,ze=0,tl=Co;tl<=s;tl++)ze=ze+a.get(Fn,tl)*a.get(tl,s);if(t[Fn]<0)qr=ch,Bt=ze;else if(Co=Fn,t[Fn]===0?a.set(Fn,s,ch!==0?-ze/ch:-ze/(x*P)):(ju=a.get(Fn,Fn+1),Zu=a.get(Fn+1,Fn),nt=(r[Fn]-ge)*(r[Fn]-ge)+t[Fn]*t[Fn],ah=(ju*Bt-qr*ze)/nt,a.set(Fn,s,ah),a.set(Fn+1,s,Math.abs(ju)>Math.abs(qr)?(-ze-ch*ah)/ju:(-Bt-Zu*ah)/qr)),ah=Math.abs(a.get(Fn,s)),x*ah*ah>1)for(tl=Fn;tl<=s;tl++)a.set(tl,s,a.get(tl,s)/ah)}else if(nt<0)for(Co=s-1,Math.abs(a.get(s,s-1))>Math.abs(a.get(s-1,s))?(a.set(s-1,s-1,nt/a.get(s,s-1)),a.set(s-1,s,-(a.get(s,s)-ge)/a.get(s,s-1))):(hd=cdiv(0,-a.get(s-1,s),a.get(s-1,s-1)-ge,nt),a.set(s-1,s-1,hd[0]),a.set(s-1,s,hd[1])),a.set(s,s-1,0),a.set(s,s,1),Fn=s-2;Fn>=0;Fn--){for(sl=0,oh=0,tl=Co;tl<=s;tl++)sl=sl+a.get(Fn,tl)*a.get(tl,s-1),oh=oh+a.get(Fn,tl)*a.get(tl,s);if(ch=a.get(Fn,Fn)-ge,t[Fn]<0)qr=ch,ze=sl,Bt=oh;else if(Co=Fn,t[Fn]===0?(hd=cdiv(-sl,-oh,ch,nt),a.set(Fn,s-1,hd[0]),a.set(Fn,s,hd[1])):(ju=a.get(Fn,Fn+1),Zu=a.get(Fn+1,Fn),hh=(r[Fn]-ge)*(r[Fn]-ge)+t[Fn]*t[Fn]-nt*nt,Sh=(r[Fn]-ge)*2*nt,hh===0&&Sh===0&&(hh=x*P*(Math.abs(ch)+Math.abs(nt)+Math.abs(ju)+Math.abs(Zu)+Math.abs(qr))),hd=cdiv(ju*ze-qr*sl+nt*oh,ju*Bt-qr*oh-nt*sl,hh,Sh),a.set(Fn,s-1,hd[0]),a.set(Fn,s,hd[1]),Math.abs(ju)>Math.abs(qr)+Math.abs(nt)?(a.set(Fn+1,s-1,(-sl-ch*a.get(Fn,s-1)+nt*a.get(Fn,s))/ju),a.set(Fn+1,s,(-oh-ch*a.get(Fn,s)-nt*a.get(Fn,s-1))/ju)):(hd=cdiv(-ze-Zu*a.get(Fn,s-1),-Bt-Zu*a.get(Fn,s),qr,nt),a.set(Fn+1,s-1,hd[0]),a.set(Fn+1,s,hd[1]))),ah=Math.max(Math.abs(a.get(Fn,s-1)),Math.abs(a.get(Fn,s))),x*ah*ah>1)for(tl=Fn;tl<=s;tl++)a.set(tl,s-1,a.get(tl,s-1)/ah),a.set(tl,s,a.get(tl,s)/ah)}for(Fn=0;Fn<e;Fn++)if(Fn<f||Fn>o)for(tl=Fn;tl<e;tl++)n.set(Fn,tl,a.get(Fn,tl));for(tl=e-1;tl>=f;tl--)for(Fn=f;Fn<=o;Fn++){for(qr=0,Io=f;Io<=Math.min(tl,o);Io++)qr=qr+n.get(Fn,Io)*a.get(Io,tl);n.set(Fn,tl,qr)}}}function cdiv(e,t,r,n){let a,s;return Math.abs(r)>Math.abs(n)?(a=n/r,s=r+a*n,[(e+a*t)/s,(t-a*e)/s]):(a=r/n,s=n+a*r,[(a*e+t)/s,(a*t-e)/s])}class CholeskyDecomposition{constructor(t){if(t=WrapperMatrix2D.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let r=t,n=r.rows,a=new Matrix$2(n,n),s=!0,f,o,x;for(o=0;o<n;o++){let C=0;for(x=0;x<o;x++){let P=0;for(f=0;f<x;f++)P+=a.get(x,f)*a.get(o,f);P=(r.get(o,x)-P)/a.get(x,x),a.set(o,x,P),C=C+P*P}for(C=r.get(o,o)-C,s&=C>0,a.set(o,o,Math.sqrt(Math.max(C,0))),x=o+1;x<n;x++)a.set(o,x,0)}this.L=a,this.positiveDefinite=!!s}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let r=this.L,n=r.rows;if(t.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let a=t.columns,s=t.clone(),f,o,x;for(x=0;x<n;x++)for(o=0;o<a;o++){for(f=0;f<x;f++)s.set(x,o,s.get(x,o)-s.get(f,o)*r.get(x,f));s.set(x,o,s.get(x,o)/r.get(x,x))}for(x=n-1;x>=0;x--)for(o=0;o<a;o++){for(f=x+1;f<n;f++)s.set(x,o,s.get(x,o)-s.get(f,o)*r.get(f,x));s.set(x,o,s.get(x,o)/r.get(x,x))}return s}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,r={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:n}=r;const{scaleScores:a=!1,maxIterations:s=1e3,terminationCriteria:f=1e-10}=r;let o;if(n){if(isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$2.columnVector(n):n=WrapperMatrix2D.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");o=n.getColumnVector(0)}else o=t.getColumnVector(0);let x=1,C,P,ge,nt;for(let ze=0;ze<s&&x>f;ze++)ge=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),ge=ge.div(ge.norm()),C=t.mmul(ge).div(ge.transpose().mmul(ge).get(0,0)),ze>0&&(x=C.clone().sub(nt).pow(2).sum()),nt=C.clone(),n?(P=n.transpose().mmul(C).div(C.transpose().mmul(C).get(0,0)),P=P.div(P.norm()),o=n.mmul(P).div(P.transpose().mmul(P).get(0,0))):o=C;if(n){let ze=t.transpose().mmul(C).div(C.transpose().mmul(C).get(0,0));ze=ze.div(ze.norm());let Bt=t.clone().sub(C.clone().mmul(ze.transpose())),qr=o.transpose().mmul(C).div(C.transpose().mmul(C).get(0,0)),_n=n.clone().sub(C.clone().mulS(qr.get(0,0)).mmul(P.transpose()));this.t=C,this.p=ze.transpose(),this.w=ge.transpose(),this.q=P,this.u=o,this.s=C.transpose().mmul(C),this.xResidual=Bt,this.yResidual=_n,this.betas=qr}else this.w=ge.transpose(),this.s=C.transpose().mmul(C).sqrt(),a?this.t=C.clone().div(this.s.get(0,0)):this.t=C,this.xResidual=t.sub(C.mmul(ge.transpose()))}}const src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO:CholeskyDecomposition,CholeskyDecomposition,EVD:EigenvalueDecomposition,EigenvalueDecomposition,LU:LuDecomposition,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS:nipals,Nipals:nipals,QR:QrDecomposition,QrDecomposition,SVD:SingularValueDecomposition,SingularValueDecomposition,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:Matrix$2,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(e){const t=new SingularValueDecomposition(e,{autoTranspose:!0});if(t.rank!==1)return null;const r=Math.sqrt(t.s[0]),n=t.U.to2DArray().map(s=>s[0]*r),a=t.V.to2DArray().map(s=>s[0]*r);return[n,a]}function convolution(e,t={}){let{channels:r,bitDepth:n,normalize:a=!1,divisor:s=1,border:f="copy",algorithm:o="auto"}=t,x={};n&&(x.bitDepth=n);let C=Image$1.createFrom(this,x);if(r=validateArrayOfChannels(this,r),o!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(o==="auto"){let Co=getSeparatedKernel(e);Co!==null?(o="separable",e=Co):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?o="fft":o="direct"}let P,ge;o==="separable"?(P=Math.floor(e[0].length/2),ge=Math.floor(e[1].length/2)):(P=Math.floor(e.length/2),ge=Math.floor(e[0].length/2));let nt=C.isClamped,ze=new Array(this.height*this.width),Bt,qr,_n,Fn,tl,Io;for(Fn=0;Fn<r.length;Fn++){for(tl=r[Fn],_n=0;_n<this.height;_n++)for(qr=0;qr<this.width;qr++)Bt=_n*this.width+qr,ze[Bt]=this.data[Bt*this.channels+tl];if(o==="direct")Io=src$2.direct(ze,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});else if(o==="separable"){if(Io=convolutionSeparable(ze,e,this.width,this.height),a){s=0;for(let Co=0;Co<e[0].length;Co++)for(let rl=0;rl<e[1].length;rl++)s+=e[0][Co]*e[1][rl]}if(s!==1)for(let Co=0;Co<Io.length;Co++)Io[Co]/=s}else Io=src$2.fft(ze,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});for(_n=0;_n<this.height;_n++)for(qr=0;qr<this.width;qr++)Bt=_n*this.width+qr,nt?C.data[Bt*this.channels+tl]=clamp(Io[Bt],C):C.data[Bt*this.channels+tl]=Io[Bt]}if(this.alpha&&!r.includes(this.channels))for(qr=this.components;qr<this.data.length;qr=qr+this.channels)C.data[qr]=this.data[qr];return f!=="periodic"&&C.setBorder({size:[ge,P],algorithm:f}),C}function gradientFilter(e={}){let{direction:t="xy",border:r="copy",kernelX:n,kernelY:a,channels:s,bitDepth:f=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:s,border:r,bitDepth:f});case"y":if(!a)throw new Error("kernelY option is missing");return convolution.call(this,a,{channels:s,border:r,bitDepth:f});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!a)throw new Error("kernelY option is missing");const o=convolution.call(this,n,{channels:s,border:r,bitDepth:32}),x=convolution.call(this,a,{channels:s,border:r,bitDepth:32});return o.hypotenuse(x,{bitDepth:f,channels:s})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(e,t){e=e||0;for(var r=new Array(e),n=0;n<e;n++)r[n]=t;return r}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(e={}){let{algorithm:t="range",channels:r,min:n=this.min,max:a=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),r=validateArrayOfChannels(this,{channels:r}),r.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((s,f)=>r.includes(f))),Array.isArray(a)&&a.length===this.channels&&(a=a.filter((s,f)=>r.includes(f)))),t){case"range":n<0&&(n=0),a>this.maxValue&&(a=this.maxValue),Array.isArray(n)||(n=newArray$1(r.length,n)),Array.isArray(a)||(a=newArray$1(r.length,a)),processImage(this,n,a,r);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(e,t,r,n){let a=1e-5,s=new Array(n.length);for(let f=0;f<n.length;f++)t[f]===0&&r[f]===e.maxValue||r[f]===t[f]?s[f]=0:s[f]=(e.maxValue+1-a)/(r[f]-t[f]),t[f]+=(.5-a/2)/s[f];for(let f=0;f<n.length;f++){let o=n[f];if(s[f]!==0)for(let x=0;x<e.data.length;x+=e.channels)e.data[x+o]=Math.min(Math.max(0,(e.data[x+o]-t[f])*s[f]+.5|0),e.maxValue)}}var toString$3=Object.prototype.toString,isArrayType=function e(t){return toString$3.call(t).substr(-6,5)==="Array"};const isArray$b=getDefaultExportFromCjs(isArrayType);function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image$1)return e.data;if(!isArray$b(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,t={}){let{channels:r}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]+e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]+e>>0)}return this}function subtract(e,t={}){let{channels:r}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]-e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,this.data[s+a]-e>>0)}return this}function subtractImage(e,t={}){let{channels:r,absolute:n=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let a=this.clone();r=validateArrayOfChannels(this,{channels:r});for(let s=0;s<r.length;s++){let f=r[s];for(let o=f;o<this.data.length;o+=this.channels){let x=this.data[o]-e.data[o];n?a.data[o]=Math.abs(x):a.data[o]=Math.max(x,0)}}return a}function hypotenuse(e,t={}){let{bitDepth:r=this.bitDepth,channels:n}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let a=Image$1.createFrom(this,{bitDepth:r});n=validateArrayOfChannels(this,{channels:n});let s=a.isClamped;for(let f=0;f<n.length;f++){let o=n[f];for(let x=o;x<this.data.length;x+=this.channels){let C=Math.hypot(this.data[x],e.data[x]);s?a.data[x]=Math.min(Math.max(Math.round(C),0),a.maxValue):a.data[x]=C}}return a}function multiply(e,t={}){let{channels:r}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]*e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]*e>>0)}return this}function divide(e,t={}){let{channels:r}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]/e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray(t)){const r=[];for(let n=0;n<t.length;n++)r.push(this._predict(t[n]));return r}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,r){if(!isAnyArray(t)||!isAnyArray(r)||t.length!==r.length)throw new Error("x and y must be arrays of the same length");const n=t.length,a=new Array(n);for(let ze=0;ze<n;ze++)a[ze]=this._predict(t[ze]);let s=0,f=0,o=0,x=0,C=0,P=0,ge=0;for(let ze=0;ze<n;ze++)s+=a[ze],f+=r[ze],C+=a[ze]*a[ze],P+=r[ze]*r[ze],ge+=a[ze]*r[ze],r[ze]!==0&&(o+=(r[ze]-a[ze])*(r[ze]-a[ze])/r[ze]),x+=(r[ze]-a[ze])*(r[ze]-a[ze]);const nt=(n*ge-s*f)/Math.sqrt((n*C-s*s)*(n*P-f*f));return{r:nt,r2:nt*nt,chi2:o,rmsd:Math.sqrt(x/n)}}}const require$$0$2=getAugmentedNamespace(src$1);function squaredEuclidean$4(e,t){let r=0;for(let n=0;n<e.length;n++)r+=(e[n]-t[n])*(e[n]-t[n]);return r}function euclidean$2(e,t){return Math.sqrt(squaredEuclidean$4(e,t))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,r){const n=squaredEuclidean$3(t,r);return Math.exp(-n/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$a,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,r){for(var n=0,a=0;a<t.length;a++)n+=t[a]*r[a];return Math.pow(this.scale*n+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$9,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,r){for(var n=0,a=0;a<t.length;a++)n+=t[a]*r[a];return Math.tanh(this.alpha*n+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,r){for(var n=0,a=Math.min(t.length,r.length),s=1;s<=a;++s)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[s-1],s)-Math.pow(r[s-1],s),2)),this.degree);return n}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma}compute(t,r){return 1/(1+squaredEuclidean$2(t,r)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0$1,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,r){const n=euclidean$1(t,r);return Math.exp(-n/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,r){for(var n=Math.min(t.length,r.length),a=0,s=0;s<n;++s)a+=Math.min(t[s],r[s]);return a}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0$1,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma}compute(t,r){const n=euclidean(t,r);return Math.exp(-n/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$4,t),this.constant=t.constant}compute(t,r){return Math.sqrt(squaredEuclidean$1(t,r)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0$1,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.constant=t.constant}compute(t,r){const n=squaredEuclidean(t,r);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$2,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,r){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var n=kernelType[t];if(n)this.kernelFunction=new n(r);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,r){if(t=Matrix$1.checkMatrix(t),r===void 0?r=t:r=Matrix$1.checkMatrix(r),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(r));const n=new Matrix$1(t.rows,r.rows);if(t===r)for(let a=0;a<t.rows;a++)for(let s=a;s<t.rows;s++){const f=this.kernelFunction.compute(t.getRow(a),t.getRow(s));n.set(a,s,f),n.set(s,a,f)}else for(let a=0;a<t.rows;a++)for(let s=0;s<r.rows;s++)n.set(a,s,this.kernelFunction.compute(t.getRow(a),r.getRow(s)));return n}}var kernel=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,r,n){if(super(),t===!0)this.alpha=r.alpha,this.inputs=r.inputs,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=new Kernel$1(r.kernelType,r.kernelOptions);else{t=Matrix$2.checkMatrix(t),n=Object.assign({},defaultOptions$2,n);const a=new Kernel$1(n.kernelType,n.kernelOptions),s=a.compute(t),f=t.rows;s.add(Matrix$2.eye(f,f).mul(n.lambda)),this.alpha=solve(s,r),this.inputs=t,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=a}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(e,t,r){const n=new KernelRidgeRegression(e,t,r),a=new Array(this.size);for(let o=0;o<this.width;o++)for(let x=0;x<this.height;x++)a[x*this.width+o]=[o,x];const s=n.predict(a),f=Image$1.createFrom(this);for(let o=0;o<this.size;o++)f.data[o]=Math.min(this.maxValue,Math.max(0,s[o][0]));return f}function dilate(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of t)for(const f of s)if(f!==1){n=!1;break e}let a=this;for(let s=0;s<r;s++)if(this.bitDepth===1)if(n){const f=a.clone();a=dilateOnceBinaryOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=dilateOnceBinary(a,f,t)}else if(n){const f=Image$1.createFrom(a);a=dilateOnceGreyOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=dilateOnceGrey(a,f,t)}return a}function dilateOnceGrey(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=0;for(let P=0;P<a;P++)for(let ge=0;ge<n;ge++){if(r[ge][P]!==1)continue;let nt=ge-s+x,ze=P-f+o;if(nt<0||ze<0||nt>=e.width||ze>=e.height)continue;const Bt=e.getValueXY(nt,ze,0);Bt>C&&(C=Bt)}t.setValueXY(x,o,0,C)}return t}function dilateOnceGreyOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){let C=0;for(let P=Math.max(0,o-s);P<Math.min(e.height,o+s+1);P++){const ge=e.getValueXY(x,P,0);ge>C&&(C=ge)}f[x]=C}for(let x=0;x<e.width;x++){let C=0;for(let P=Math.max(0,x-a);P<Math.min(e.width,x+a+1);P++)f[P]>C&&(C=f[P]);t.setValueXY(x,o,0,C)}}return t}function dilateOnceBinary(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=0;e:for(let P=0;P<a;P++)for(let ge=0;ge<n;ge++){if(r[ge][P]!==1)continue;let nt=ge-s+x,ze=P-f+o;if(ze<0||nt<0||nt>=e.width||ze>=e.height)continue;if(e.getBitXY(nt,ze)===1){C=1;break e}}C===1&&t.setBitXY(x,o)}return t}function dilateOnceBinaryOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(1);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){f[x]=0;for(let C=Math.max(0,o-s);C<Math.min(e.height,o+s+1);C++)if(e.getBitXY(x,C)===1){f[x]=1;break}}for(let x=0;x<e.width;x++)if(t.getBitXY(x,o)!==1){for(let C=Math.max(0,x-a);C<Math.min(e.width,x+a+1);C++)if(f[C]===1){t.setBitXY(x,o);break}}}return t}function erode(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of t)for(const f of s)if(f!==1){n=!1;break e}let a=this;for(let s=0;s<r;s++)if(this.bitDepth===1)if(n){const f=a.clone();a=erodeOnceBinaryOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=erodeOnceBinary(a,f,t)}else if(n){const f=Image$1.createFrom(a);a=erodeOnceGreyOnlyOnes(a,f,t.length,t[0].length)}else{const f=Image$1.createFrom(a);a=erodeOnceGrey(a,f,t)}return a}function erodeOnceGrey(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=e.maxValue;for(let P=0;P<a;P++)for(let ge=0;ge<n;ge++){if(r[ge][P]!==1)continue;let nt=ge-s+x,ze=P-f+o;if(nt<0||ze<0||nt>=e.width||ze>=e.height)continue;const Bt=e.getValueXY(nt,ze,0);Bt<C&&(C=Bt)}t.setValueXY(x,o,0,C)}return t}function erodeOnceGreyOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){let C=e.maxValue;for(let P=Math.max(0,o-s);P<Math.min(e.height,o+s+1);P++){const ge=e.getValueXY(x,P,0);ge<C&&(C=ge)}f[x]=C}for(let x=0;x<e.width;x++){let C=e.maxValue;for(let P=Math.max(0,x-a);P<Math.min(e.width,x+a+1);P++)f[P]<C&&(C=f[P]);t.setValueXY(x,o,0,C)}}return t}function erodeOnceBinary(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,f=(a-1)/2;for(let o=0;o<e.height;o++)for(let x=0;x<e.width;x++){let C=1;e:for(let P=0;P<a;P++)for(let ge=0;ge<n;ge++){if(r[ge][P]!==1)continue;let nt=ge-s+x,ze=P-f+o;if(ze<0||nt<0||nt>=e.width||ze>=e.height)continue;if(e.getBitXY(nt,ze)===0){C=0;break e}}C===1&&t.setBitXY(x,o)}return t}function erodeOnceBinaryOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,f=[];for(let o=0;o<e.width;o++)f.push(0);for(let o=0;o<e.height;o++){for(let x=0;x<e.width;x++){f[x]=1;for(let C=Math.max(0,o-s);C<Math.min(e.height,o+s+1);C++)if(e.getBitXY(x,C)===0){f[x]=0;break}}for(let x=0;x<e.width;x++)if(t.getBitXY(x,o)!==0){for(let C=Math.max(0,x-a);C<Math.min(e.width,x+a+1);C++)if(f[C]===0){t.clearBitXY(x,o);break}}}return t}function open(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.erode({kernel:t}),n=n.dilate({kernel:t});return n}function close(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.dilate({kernel:t}).erode({kernel:t});return n}function topHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.open({kernel:t}).subtractImage(n,{absolute:!0});return n}function blackHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.close({kernel:t}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++){let s=n.dilate({kernel:t}),f=n.erode({kernel:t});n=s.subtractImage(f,{absolute:!0})}return n}function order4Points(e){let t=0,r=0,n=0,a=0,s=e[0][0],f=0;for(let C=1;C<e.length;C++)e[C][0]<s&&(s=e[C][0],f=C);let o=e[(f+1)%e.length][0],x=(f+1)%e.length;for(let C=1;C<e.length;C++)e[C][0]<o&&C!==f&&(o=e[C][0],x=C);return e[x][1]<e[f][1]?(t=e[x],a=e[f],f!==(x+1)%4?(r=e[(x+1)%4],n=e[(x+2)%4]):(r=e[(x+2)%4],n=e[(x+3)%4])):(a=e[x],t=e[f],x!==(f+1)%4?(r=e[(f+1)%4],n=e[(f+2)%4]):(r=e[(f+2)%4],n=e[(f+3)%4])),[t,r,n,a]}function distance2Points(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function crossVect(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dotVect(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function computeWidthAndHeigth(e,t,r,n,a,s){let f=Math.max(distance2Points(e,t),distance2Points(n,r)),o=Math.max(distance2Points(e,n),distance2Points(t,r)),x=0,C=0,P=Math.ceil(a/2),ge=Math.ceil(s/2),nt=f/o,ze=[e[0],e[1],1],Bt=[t[0],t[1],1],qr=[n[0],n[1],1],_n=[r[0],r[1],1],Fn=dotVect(crossVect(ze,_n),qr)/dotVect(crossVect(Bt,_n),qr),tl=dotVect(crossVect(ze,_n),Bt)/dotVect(crossVect(qr,_n),Bt),Io=[Fn*Bt[0]-ze[0],Fn*Bt[1]-ze[1],Fn*Bt[2]-ze[2]],Co=[tl*qr[0]-ze[0],tl*qr[1]-ze[1],tl*qr[2]-ze[2]],rl=Io[0],ah=Io[1],ch=Io[2],ju=Co[0],Zu=Co[1],sl=Co[2],oh=1/(ch*sl)*(rl*ju-(rl*sl+ch*ju)*P+ch*sl*P*P+(ah*Zu-(ah*sl+ch*Zu)*ge+ch*sl*ge*ge));oh>=0?oh=Math.sqrt(oh):oh=Math.sqrt(-oh);let hh=new Matrix$2([[oh,0,P],[0,oh,ge],[0,0,1]]),Sh=hh.transpose(),$h=inverse(Sh),hd=inverse(hh),vd=Matrix$2.rowVector(Io),Ef=Matrix$2.rowVector(Co),Cd=Math.sqrt(dotVect(vd.mmul($h).mmul(hd).to1DArray(),Io)/dotVect(Ef.mmul($h).mmul(hd).to1DArray(),Co));return Cd===0||nt===0?(x=Math.ceil(f),C=Math.ceil(o)):Cd<nt?(x=Math.ceil(f),C=Math.ceil(x/Cd)):(C=Math.ceil(o),x=Math.ceil(Cd*C)),[x,C]}function projectionPoint(e,t,r,n,a,s,f,o,x,C,P,ge){let[nt,ze]=[(r*e+n*t+a)/(x*e+C*t+1),(s*e+f*t+o)/(x*e+C*t+1)];return P.getValueXY(Math.floor(nt),Math.floor(ze),ge)}function warpingFourPoints(e,t={}){let{calculateRatio:r=!0}=t;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[n,a,s,f]=e,o=[n,a,s,f],[x,C,P,ge]=order4Points(o),nt,ze;r?[nt,ze]=computeWidthAndHeigth(x,C,P,ge,this.width,this.height):(nt=Math.ceil(Math.max(distance2Points(x,C),distance2Points(ge,P))),ze=Math.ceil(Math.max(distance2Points(x,ge),distance2Points(C,P))));let Bt=Image$1.createFrom(this,{width:nt,height:ze}),[qr,_n]=x,[Fn,tl]=C,[Io,Co]=P,[rl,ah]=ge,[ch,ju]=[0,0],[Zu,sl]=[0,nt-1],[oh,hh]=[ze-1,nt-1],[Sh,$h]=[ze-1,0],hd=new Matrix$2([[ch,ju,1,0,0,0,-ch*qr,-ju*qr],[Zu,sl,1,0,0,0,-Zu*Fn,-sl*Fn],[oh,hh,1,0,0,0,-oh*Io,-ju*Io],[Sh,$h,1,0,0,0,-Sh*rl,-$h*rl],[0,0,0,ch,ju,1,-ch*_n,-ju*_n],[0,0,0,Zu,sl,1,-Zu*tl,-sl*tl],[0,0,0,oh,hh,1,-oh*Co,-hh*Co],[0,0,0,Sh,$h,1,-Sh*ah,-$h*ah]]),vd=Matrix$2.columnVector([qr,Fn,Io,rl,_n,tl,Co,ah]),Cd=new SingularValueDecomposition(hd).solve(vd),[Cf,Sd,yd,Hd,xd,Pd,zd,Ld]=Cd.to1DArray(),Kd=new Matrix$2(ze,nt);for(let wf=0;wf<this.channels;wf++){for(let kd=0;kd<ze;kd++)for(let cd=0;cd<nt;cd++)Kd.set(kd,cd,projectionPoint(kd,cd,Cf,Sd,yd,Hd,xd,Pd,zd,Ld,this,wf));Bt.setMatrix(Kd,{channel:wf})}return Bt}function crop(e={}){let{x:t=0,y:r=0,width:n=this.width-t,height:a=this.height-r}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a),t>this.width-1||r>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${r}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||a<=0)throw new RangeError(`crop: width and height (width:${n}; height:${a}) must be positive numbers`);if(t<0||r<0)throw new RangeError(`crop: x and y (x:${t}, y:${r}) must be positive numbers`);if(n>this.width-t||a>this.height-r)throw new RangeError(`crop: (x: ${t}, y:${r}, width:${n}, height:${a}) size is out of range`);let s=this;if(this.bitDepth===1){const f=new Image$1(n,a,{kind:"BINARY",parent:this});s=cropBinary(this,f,t,r,n,a)}else{const f=Image$1.createFrom(this,{width:n,height:a,position:[t,r]});s=cropDefault(this,f,t,r,n,a)}return s}function cropDefault(e,t,r,n,a,s){let f=a*e.channels,o=n+s,x=0,C=r*e.channels;for(let P=n;P<o;P++){let ge=P*e.width*e.channels+C,nt=ge+f;for(;ge<nt;ge++)t.data[x++]=e.data[ge]}return t}function cropBinary(e,t,r,n,a,s){let f=a*e.channels,o=n+s,x=0,C=r*e.channels;for(let P=n;P<o;P++){let ge=P*e.width*e.channels+C,nt=ge+f;for(;ge<nt;ge++)e.getBit(ge)&&t.setBit(x),++x}return t}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=e;let r=findLeft(this,t,this.components);if(r===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,t,this.components,r),a=findBottom(this,t,this.components,r),s=findRight(this,t,this.components,r,n,a);return this.crop({x:r,y:n,width:s-r+1,height:a-n+1})}function findLeft(e,t,r){for(let n=0;n<e.width;n++)for(let a=0;a<e.height;a++)if(e.getValueXY(n,a,r)>=t)return n;return-1}function findTop(e,t,r,n){for(let a=0;a<e.height;a++)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,r)>=t)return a;return-1}function findBottom(e,t,r,n){for(let a=e.height-1;a>=0;a--)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,r)>=t)return a;return-1}function findRight(e,t,r,n,a,s){for(let f=e.width-1;f>=n;f--)for(let o=a;o<=s;o++)if(e.getValueXY(f,o,r)>=t)return f;return-1}function getFactor(e){if(typeof e=="string"){const t=e[e.length-1];e=parseFloat(e),t==="%"&&(e/=100)}return e}function getThreshold$1(e,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*t}else{if(typeof e=="number")return e<1?e*t:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,t,r){e=getFactor(e);let n=Math.round(e*t),a=Math.round(e*r);return n<=0&&(n=1),a<=0&&(a=1),{width:n,height:a}}function checkRow(e,t){if(t<0||t>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${t}`)}function checkColumn(e,t){if(t<0||t>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${t}`)}function checkChannel(e,t){if(t<0||t>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,t,r){const n=this.width/t,a=this.height/r;if(this.bitDepth>1)for(let s=0;s<t;s++){const f=Math.floor((s+.5)*n);for(let o=0;o<r;o++){const x=Math.floor((o+.5)*a);for(let C=0;C<this.channels;C++)e.setValueXY(s,o,C,this.getValueXY(f,x,C))}}else for(let s=0;s<t;s++){const f=Math.floor((s+.5)*n);for(let o=0;o<r;o++){const x=Math.floor((o+.5)*a);this.getBitXY(f,x)&&e.setBitXY(s,o)}}}function resize(e={}){const{factor:t=1,interpolation:r=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=e,a=checkInterpolation(r);let s=e.width,f=e.height;if(s||(f&&n?s=Math.round(f*(this.width/this.height)):s=this.width),f||(n?f=Math.round(s*(this.height/this.width)):f=this.height),{width:s,height:f}=factorDimensions(t,s,f),s===this.width&&f===this.height){const P=this.clone();return P.position=[0,0],P}let o=Math.round((this.width-s)/2),x=Math.round((this.height-f)/2);const C=Image$1.createFrom(this,{width:s,height:f,position:[o,x]});switch(a){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,C,s,f);break;default:throw new Error(`unsupported resize interpolation: ${a}`)}return C}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSV}),t=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let a=r[n],s=r[n+1],f=r[n+2],o=Math.min(a,s,f),x=Math.max(a,s,f),C=x-o,P=0,ge=x===0?0:C/x,nt=x;if(x!==o){switch(x){case a:P=(s-f)/C+(s<f?6:0);break;case s:P=(f-a)/C+2;break;case f:P=(a-s)/C+4;break;default:throw new Error("unreachable")}P/=6}e.data[t++]=P*this.maxValue,e.data[t++]=ge*this.maxValue,e.data[t++]=nt,this.alpha&&(e.data[t++]=r[n+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),r=0,n=this.data;for(let a=0;a<n.length;a+=this.channels){let s=n[a],f=n[a+1],o=n[a+2],x=Math.max(s,f,o),C=Math.min(s,f,o),P=0,ge=0,nt=(x+C)/2;if(x!==C){let ze=x-C;switch(ge=nt>t?ze/(2-x-C):ze/(x+C),x){case s:P=(f-o)/ze+(f<o?6:0);break;case f:P=(o-s)/ze+2;break;case o:P=(s-f)/ze+4;break;default:throw new Error("unreachable")}P/=6}e.data[r++]=P*this.maxValue,e.data[r++]=ge*this.maxValue,e.data[r++]=nt,this.alpha&&(e.data[r++]=n[a+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let a=r[n],s=r[n+1],f=r[n+2],o=Math.min(this.maxValue-a,this.maxValue-s,this.maxValue-f),x=(this.maxValue-a-o)/(1-o/this.maxValue),C=(this.maxValue-s-o)/(1-o/this.maxValue),P=(this.maxValue-f-o)/(1-o/this.maxValue);e.data[t++]=Math.round(x),e.data[t++]=Math.round(C),e.data[t++]=Math.round(P),e.data[t++]=Math.round(o),this.alpha&&(e.data[t++]=r[n+3])}return e}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,t,r){return e*6966+t*23436+r*2366>>15},luma601(e,t,r){return e*9798+t*19235+r*3735>>15},maximum(e,t,r){return Math.max(e,t,r)},minimum(e,t,r){return Math.min(e,t,r)},average(e,t,r){return(e+t+r)/3>>0},minmax(e,t,r){return(Math.max(e,t,r)+Math.min(e,t,r))/2},red(e){return e},green(e,t){return t},blue(e,t,r){return r},cyan(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-e-a)/(1-a/n.maxValue)>>0},magenta(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-t-a)/(1-a/n.maxValue)>>0},yellow(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-r-a)/(1-a/n.maxValue)>>0},black(e,t,r,n){return Math.min(n.maxValue-e,n.maxValue-t,n.maxValue-r)},hue(e,t,r,n){let a=methods$1.min(e,t,r),s=methods$1.max(e,t,r);if(s===a)return 0;let f=0,o=s-a;switch(s){case e:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-e)/o+2;break;case r:f=(e-t)/o+4;break;default:throw new Error("unreachable")}return f/6*n.maxValue>>0},saturation(e,t,r,n){let a=methods$1.min(e,t,r),s=methods$1.max(e,t,r),f=s-a;return s===0?0:f/s*n.maxValue},lightness(e,t,r){let n=methods$1.min(e,t,r);return(methods$1.max(e,t,r)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:t="luma709",keepAlpha:r=!1,mergeAlpha:n=!0}=e;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),r&=this.alpha,n&=this.alpha,r&&(n=!1);let a=getOutputImage(this,e,{components:1,alpha:r,colorModel:GREY$1}),s;if(typeof t=="function")s=t;else if(s=methods$1[t.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${t}`);let f=0;for(let o=0;o<this.data.length;o+=this.channels)n?a.data[f++]=clamp(s(this.data[o],this.data[o+1],this.data[o+2],this)*this.data[o+this.components]/this.maxValue,this):(a.data[f++]=clamp(s(this.data[o],this.data[o+1],this.data[o+2],this),this),a.alpha&&(a.data[f++]=this.data[o+this.components]));return a}function huang(e){let t=0;for(let P=0;P<e.length;P++)if(e[P]!==0){t=P;break}let r=e.length-1;for(let P=e.length-1;P>=t;P--)if(e[P]!==0){r=P;break}let n=1/(r-t),a=new Array(e.length),s=0,f=0;for(let P=t;P<e.length;P++)s+=P*e[P],f+=e[P],a[P]=s/f;let o=new Array(e.length);s=f=0;for(let P=r;P>0;P--)s+=P*e[P],f+=e[P],o[P-1]=s/f;let x=-1,C=Number.MAX_VALUE;for(let P=0;P<e.length;P++){let ge=0,nt;for(let ze=0;ze<=P;ze++)nt=1/(1+n*Math.abs(ze-a[P])),nt<1e-6||nt>.999999||(ge+=e[ze]*(-nt*Math.log(nt)-(1-nt)*Math.log(1-nt)));for(let ze=P+1;ze<e.length;ze++)nt=1/(1+n*Math.abs(ze-o[P])),nt<1e-6||nt>.999999||(ge+=e[ze]*(-nt*Math.log(nt)-(1-nt)*Math.log(1-nt)));ge<C&&(C=ge,x=P)}return x}function intermodes(e){let t=e.slice(),r=0;for(;!bimodalTest$1(t);){let a=0,s=0,f=t[0];for(let o=0;o<e.length-1;o++)a=s,s=f,f=t[o+1],t[o]=(a+s+f)/3;if(t[e.length-1]=(s+f)/3,r++,r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let a=1;a<e.length-1;a++)t[a-1]<t[a]&&t[a+1]<t[a]&&(n+=a);return Math.floor(n/2)}function bimodalTest$1(e){let t=!1,r=0;for(let n=1;n<e.length-1;n++)if(e[n-1]<e[n]&&e[n+1]<e[n]&&(r++,r>2))return!1;return r===2&&(t=!0),t}function isodata(e){let t,r,n,a,s=0;for(let f=1;f<e.length;f++)if(e[f]>0){s=f+1;break}for(;;){t=0,n=0;for(let f=0;f<s;f++)n=n+e[f],t=t+e[f]*f;a=0,r=0;for(let f=s+1;f<e.length;f++)r+=e[f],a+=e[f]*f;if(n>0&&r>0&&(t/=n,a/=r,s===Math.round((t+a)/2)))break;if(s++,s>e.length-2)throw new Error("Threshold not found")}return s}function li$1(e,t){let r,n,a,s,f,o,x,C,P,ge,nt,ze;nt=.5,ge=0;for(let Bt=0;Bt<e.length;Bt++)ge+=Bt*e[Bt];ge/=t,x=ge;do{o=x,r=o+.5|0,n=0,s=0;for(let Bt=0;Bt<=r;Bt++)n+=Bt*e[Bt],s+=e[Bt];C=s===0?0:n/s,a=0,f=0;for(let Bt=r+1;Bt<e.length;Bt++)a+=Bt*e[Bt],f+=e[Bt];P=f===0?0:a/f,ze=(C-P)/(Math.log(C)-Math.log(P)),ze<-Number.EPSILON?x=ze-.5|0:x=ze+.5|0}while(Math.abs(x-o)>nt);return r}function maxEntropy(e,t){let r=new Array(e.length);for(let nt=0;nt<e.length;nt++)r[nt]=e[nt]/t;let n=new Array(e.length),a=new Array(e.length);n[0]=r[0],a[0]=1-n[0];for(let nt=1;nt<e.length;nt++)n[nt]=n[nt-1]+r[nt],a[nt]=1-n[nt];let s=0;for(let nt=0;nt<e.length;nt++)if(Math.abs(n[nt])>=Number.EPSILON){s=nt;break}let f=e.length-1;for(let nt=e.length-1;nt>=s;nt--)if(Math.abs(a[nt])>=Number.EPSILON){f=nt;break}let o=-1,x,C=Number.MIN_VALUE,P,ge;for(let nt=s;nt<=f;nt++){P=0;for(let ze=0;ze<=nt;ze++)e[ze]!==0&&(P-=r[ze]/n[nt]*Math.log(r[ze]/n[nt]));ge=0;for(let ze=nt+1;ze<e.length;ze++)e[ze]!==0&&(ge-=r[ze]/a[nt]*Math.log(r[ze]/a[nt]));x=P+ge,C<x&&(C=x,o=nt)}return o}function mean$1(e,t){let r=0;for(let n=0;n<e.length;n++)r+=n*e[n];return Math.floor(r/t)}function minError(e,t){let r,n=-2,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr=0;for(let _n=0;_n<e.length;_n++)qr+=_n*e[_n];for(qr/=t,r=qr;r!==n;){let _n=sumA(e,r),Fn=sumA(e,e.length-1),tl=sumB(e,r),Io=sumB(e,e.length-1),Co=sumC(e,r),rl=sumC(e,e.length-1);if(a=tl/_n,s=(Io-tl)/(Fn-_n),f=_n/Fn,o=(Fn-_n)/Fn,x=Co/_n-a*a,C=(rl-Co)/(Fn-_n)-s*s,P=1/x-1/C,ge=a/x-s/C,nt=a*a/x-s*s/C+Math.log10(x*(o*o)/(C*(f*f))),ze=ge*ge-P*nt,ze<0)return r;n=r,Bt=(ge+Math.sqrt(ze))/P,isNaN(Bt)?r=n:r=Math.floor(Bt)}return r}function sumA(e,t){let r=0;for(let n=0;n<=t;n++)r+=e[n];return r}function sumB(e,t){let r=0;for(let n=0;n<=t;n++)r+=n*e[n];return r}function sumC(e,t){let r=0;for(let n=0;n<=t;n++)r+=n*n*e[n];return r}function minimum(e){if(e.length<2)return 0;let t=0,r=-1,n=-1,a=new Array(e.length);for(let s=0;s<e.length;s++)a[s]=e[s],e[s]>0&&(n=s);for(;!bimodalTest(a);)if(a=smoothed(a),t++,t>1e4)return r;return r=minimumBetweenPeeks(a,n),r}function smoothed(e){let t=new Array(e.length);for(let r=1;r<e.length-1;r++)t[r]=(e[r-1]+e[r]+e[r+1])/3;return t[0]=(e[0]+e[1])/3,t[e.length-1]=(e[e.length-2]+e[e.length-1])/3,t}function minimumBetweenPeeks(e,t){let r;for(let n=1;n<t;n++)if(e[n-1]>e[n]&&e[n+1]>=e[n]){r=n;break}return r}function bimodalTest(e){let t=e.length,r=!1,n=0;for(let a=1;a<t-1;a++)if(e[a-1]<e[a]&&e[a+1]<e[a]&&(n++,n>2))return!1;return n===2&&(r=!0),r}function moments(e,t){let r=1,n=0,a=0,s=0,f=0,o,x,C,P,ge,nt,ze=-1,Bt=e.length,qr=new Array(Bt);for(let _n=0;_n<Bt;_n++)qr[_n]=e[_n]/t;for(let _n=0;_n<Bt;_n++)n+=_n*qr[_n],a+=_n*_n*qr[_n],s+=_n*_n*_n*qr[_n];x=r*a-n*n,C=(-a*a+n*s)/x,P=(r*-s+a*n)/x,ge=.5*(-P-Math.sqrt(P*P-4*C)),nt=.5*(-P+Math.sqrt(P*P-4*C)),o=(nt-n)/(nt-ge);for(let _n=0;_n<Bt;_n++)if(f+=qr[_n],f>o){ze=_n;break}return ze}function otsu(e,t){let r=0,n=0,a=0,s=0,f=0;for(let o=0;o<e.length;o++)f+=o*e[o];for(let o=0;o<e.length;o++){n=n+e[o];const x=t-n;if(n===0||x===0)continue;r=r+o*e[o];const C=(f-r)/x,P=n*x*(r/n-C)*(r/n-C);P>=a&&(s=o,a=P)}return s}function percentile(e){let t=-1,r=.5,n=new Array(e.length),a=partialSum(e,e.length-1),s=1;for(let f=0;f<e.length;f++)n[f]=Math.abs(partialSum(e,f)/a-r),n[f]<s&&(s=n[f],t=f);return t}function partialSum(e,t){let r=0;for(let n=0;n<=t;n++)r+=e[n];return r}function renyiEntropy(e,t){let r,n,a,s=new Array(e.length),f=new Array(e.length),o=new Array(e.length),x=0,C=0,P=0,ge=0,nt=0,ze=0,qr=1/(1-.5),Fn=1/(1-2);for(let rl=0;rl<e.length;rl++)s[rl]=e[rl]/t;f[0]=s[0],o[0]=1-f[0];for(let rl=1;rl<e.length;rl++)f[rl]=f[rl-1]+s[rl],o[rl]=1-f[rl];n=0;for(let rl=0;rl<e.length;rl++)if(Math.abs(f[rl])>=Number.EPSILON){n=rl;break}a=e.length-1;for(let rl=e.length-1;rl>=n;rl--)if(Math.abs(o[rl])>=Number.EPSILON){a=rl;break}for(let rl=n;rl<=a;rl++){let ah=0,ch=0,ju=0;for(let hd=0;hd<=rl;hd++)e[hd]!==0&&(ah-=s[hd]/f[rl]*Math.log(s[hd]/f[rl])),ch+=Math.sqrt(s[hd]/f[rl]),ju+=s[hd]*s[hd]/(f[rl]*f[rl]);let Zu=0,sl=0,oh=0;for(let hd=rl+1;hd<e.length;hd++)e[hd]!==0&&(Zu-=s[hd]/o[rl]*Math.log(s[hd]/o[rl])),sl+=Math.sqrt(s[hd]/o[rl]),oh+=s[hd]*s[hd]/(o[rl]*o[rl]);let hh=ah+Zu,Sh=qr*(ch*sl>0?Math.log(ch*sl):0),$h=Fn*(ju*oh>0?Math.log(ju*oh):0);hh>ge&&(ge=hh,x=rl),Sh>nt&&(nt=Sh,C=rl),$h>ze&&(ze=$h,P=rl)}let tl=[x,C,P];tl.sort((rl,ah)=>rl-ah);let Io;Math.abs(tl[0]-tl[1])<=5?Math.abs(tl[1]-tl[2])<=5?Io=[1,2,1]:Io=[0,1,3]:Math.abs(tl[1]-tl[2])<=5?Io=[3,1,0]:Io=[1,2,1];let Co=f[tl[2]]-f[tl[0]];return r=Math.round(tl[0]*(f[tl[0]]+.25*Co*Io[0])+.25*tl[1]*Co*Io[1]+tl[2]*(o[tl[2]]+.25*Co*Io[2])),r}function shanbhag(e,t){let r=new Array(e.length);for(let ze=0;ze<e.length;ze++)r[ze]=e[ze]/t;let n=new Array(e.length),a=new Array(e.length);n[0]=r[0],a[0]=1-n[0];for(let ze=1;ze<e.length;ze++)n[ze]=n[ze-1]+r[ze],a[ze]=1-n[ze];let s=0;for(let ze=0;ze<e.length;ze++)if(Math.abs(n[ze])>=Number.EPSILON){s=ze;break}let f=e.length-1;for(let ze=e.length-1;ze>=s;ze--)if(Math.abs(a[ze])>=Number.EPSILON){f=ze;break}let o=-1,x=Number.MAX_VALUE,C,P,ge,nt;for(let ze=s;ze<=f;ze++){ge=0,C=.5/n[ze];for(let Bt=1;Bt<=ze;Bt++)ge-=r[Bt]*Math.log(1-C*n[Bt-1]);ge*=C,nt=0,C=.5/a[ze];for(let Bt=ze+1;Bt<e.length;Bt++)nt-=r[Bt]*Math.log(1-C*a[Bt]);nt*=C,P=Math.abs(ge-nt),P<x&&(x=P,o=ze)}return o}function triangle$1(e){let t=0,r=0,n=0,a=0;for(let ge=0;ge<e.length;ge++)if(e[ge]>0){t=ge;break}t>0&&t--;for(let ge=e.length-1;ge>0;ge--)if(e[ge]>0){a=ge;break}a<e.length-1&&a++;for(let ge=0;ge<e.length;ge++)e[ge]>r&&(n=ge,r=e[ge]);let s=!1;if(n-t<a-n){s=!0;let ge=0,nt=e.length-1;for(;ge<nt;){let ze=e[ge];e[ge]=e[nt],e[nt]=ze,ge++,nt--}t=e.length-1-a,n=e.length-1-n}if(t===n)return t;let f,o,x;f=e[n],o=t-n,x=Math.sqrt(f*f+o*o),f/=x,o/=x,x=f*t+o*e[t];let C=t,P=0;for(let ge=t+1;ge<=n;ge++){let nt=f*ge+o*e[ge]-x;nt>P&&(C=ge,P=nt)}if(C--,s){let ge=0,nt=e.length-1;for(;ge<nt;){let ze=e[ge];e[ge]=e[nt],e[nt]=ze,ge++,nt--}return e.length-1-C}else return C}function yen(e,t){let r=new Array(e.length);for(let C=0;C<e.length;C++)r[C]=e[C]/t;let n=new Array(e.length);n[0]=r[0];for(let C=1;C<e.length;C++)n[C]=n[C-1]+r[C];let a=new Array(e.length);a[0]=r[0]*r[0];for(let C=1;C<e.length;C++)a[C]=a[C-1]+r[C]*r[C];let s=new Array(e.length);s[e.length-1]=0;for(let C=e.length-2;C>=0;C--)s[C]=s[C+1]+r[C+1]*r[C+1];let f=-1,o=Number.MIN_VALUE,x;for(let C=0;C<e.length;C++)x=-1*(a[C]*s[C]>0?Math.log(a[C]*s[C]):0)+2*(n[C]*(1-n[C])>0?Math.log(n[C]*(1-n[C])):0),x>o&&(o=x,f=C);return f}const methods={huang,intermodes,isodata,li:li$1,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:t=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let r=methods[t.toLowerCase()];if(r){let n=this.getHistogram();return r(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:t=THRESHOLD,threshold:r=.5,useAlpha:n=!0,invert:a=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?r=getThreshold$1(r,this.maxValue):r=getThreshold.call(this,e);let s=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),f=0;if(this.alpha&&n)for(let o=0;o<this.data.length;o+=this.channels){let x=this.data[o]+(this.maxValue-this.data[o])*(this.maxValue-this.data[o+1])/this.maxValue;(a&&x<=r||!a&&x>=r)&&s.setBit(f),f++}else for(let o=0;o<this.data.length;o+=this.channels)(a&&this.data[o]<=r||!a&&this.data[o]>=r)&&s.setBit(f),f++;return s}function copyImage(e,t,r,n){let a=e.width,s=e.height,f=t.width,o=e.channels;for(let x=0;x<a;x++)for(let C=0;C<s;C++)for(let P=0;P<o;P++){let ge=(C*a+x)*o+P,nt=((n+C)*f+r+x)*o+P;t.data[nt]=e.data[ge]}}function pad(e={}){let{size:t=0,algorithm:r="copy",color:n}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),r==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let x=0;x<n.length;x++)n[x]===0&&(n[x]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let a=this.width+t[0]*2,s=this.height+t[1]*2,f=this.channels,o=Image$1.createFrom(this,{width:a,height:s});copyImage(this,o,t[0],t[1]);for(let x=t[0];x<a-t[0];x++)for(let C=0;C<f;C++){let P=n[C]||o.data[(t[1]*a+x)*f+C];for(let ge=0;ge<t[1];ge++)o.data[(ge*a+x)*f+C]=P;P=n[C]||o.data[((s-t[1]-1)*a+x)*f+C];for(let ge=s-t[1];ge<s;ge++)o.data[(ge*a+x)*f+C]=P}for(let x=0;x<s;x++)for(let C=0;C<f;C++){let P=n[C]||o.data[(x*a+t[0])*f+C];for(let ge=0;ge<t[0];ge++)o.data[(x*a+ge)*f+C]=P;P=n[C]||o.data[(x*a+a-t[0]-1)*f+C];for(let ge=a-t[0];ge<a;ge++)o.data[(x*a+ge)*f+C]=P}return o}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let t=Image$1.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(t.data[r]=255);else for(let r=0;r<this.data.length;r++)t.data[r]=this.data[r]>>8;break;case 16:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(t.data[r]=65535);else for(let r=0;r<this.data.length;r++)t.data[r]=this.data[r]<<8|this.data[r];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(e,t={}){const{interpolation:r=validInterpolations.nearestneighbor,width:n=this.width,height:a=this.height}=t;if(typeof e!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(r),f=e*Math.PI/180,o=Math.floor(Math.abs(n*Math.cos(f))+Math.abs(a*Math.sin(f))),x=Math.floor(Math.abs(a*Math.cos(f))+Math.abs(n*Math.sin(f))),C=Math.cos(-f),P=Math.sin(-f);let ge=o/2,nt=x/2;o%2===0?(ge=ge-.5,x%2===0?nt=nt-.5:nt=Math.floor(nt)):(ge=Math.floor(ge),x%2===0?nt=nt-.5:nt=Math.floor(nt));const ze=Math.floor(n/2-ge),Bt=Math.floor(a/2-nt);if(this.bitDepth===1){const qr=new Image$1(o,x,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,qr,ze,Bt,ge,nt,C,P);case validInterpolations.bilinear:return rotateBinaryBilinear(this,qr,ze,Bt,ge,nt,C,P);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const qr=Image$1.createFrom(this,{width:o,height:x});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,qr,ze,Bt,ge,nt,C,P);case validInterpolations.bilinear:return rotateBilinear(this,qr,ze,Bt,ge,nt,C,P);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(e,t,r,n,a,s,f,o){for(let x=0;x<t.width;x+=1)for(let C=0;C<t.height;C+=1)for(let P=0;P<e.channels;P++){let ge=Math.round((x-a)*f-(C-s)*o+a)+r,nt=Math.round((C-s)*f+(x-a)*o+s)+n;ge<0||ge>=e.width||nt<0||nt>=e.height?e.alpha===1&&P===e.channels-1?t.setValueXY(x,C,P,0):t.setValueXY(x,C,P,e.maxValue):t.setValueXY(x,C,P,e.getValueXY(ge,nt,P))}return t}function rotateBinaryNearestNeighbor(e,t,r,n,a,s,f,o){for(let x=0;x<t.width;x+=1)for(let C=0;C<t.height;C+=1){let P=Math.round((x-a)*f-(C-s)*o+a)+r,ge=Math.round((C-s)*f+(x-a)*o+s)+n;(P<0||P>=e.width||ge<0||ge>=e.height||e.getBitXY(P,ge))&&t.setBitXY(x,C)}return t}function rotateBilinear(e,t,r,n,a,s,f,o){let x=e.width*e.channels;for(let C=0;C<t.height;C++)for(let P=0;P<t.width;P++){let ge=(P-a)*f-(C-s)*o+a+r,nt=(C-s)*f+(P-a)*o+s+n,ze=ge|0,Bt=nt|0,qr=ge-ze,_n=nt-Bt;for(let Fn=0;Fn<e.channels;Fn++)if(ge<0||ge>=e.width||nt<0||nt>=e.height)e.alpha===1&&Fn===e.channels-1?t.setValueXY(P,C,Fn,0):t.setValueXY(P,C,Fn,e.maxValue);else{let tl=(Bt*e.width+ze)*e.channels+Fn,Io=e.data[tl],Co=e.data[tl+e.channels],rl=e.data[tl+x],ah=e.data[tl+x+e.channels],ch=Io+qr*(Co-Io)+_n*(rl-Io)+qr*_n*(Io-Co-rl+ah)|0;t.setValueXY(P,C,Fn,ch)}}return t}function rotateBinaryBilinear(e,t,r,n,a,s,f,o){let x=e.width;for(let C=0;C<t.height;C++)for(let P=0;P<t.width;P++){let ge=(P-a)*f-(C-s)*o+a+r,nt=(C-s)*f+(P-a)*o+s+n,ze=ge|0,Bt=nt|0,qr=ge-ze,_n=nt-Bt;if(ge<0||ge>=e.width||nt<0||nt>=e.height)t.setBitXY(P,C);else{let Fn=Bt*e.width+ze,tl=e.getBit(Fn),Io=e.getBit(Fn+1),Co=e.getBit(Fn+x),rl=e.getBit(Fn+1+x);(tl|qr&Io-tl|_n&Co-tl|qr&_n&tl-Io-Co+rl)>0&&t.setBitXY(P,C)}}return t}function rotate$1(e,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,t)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=e.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)this.getBitXY(n,r)&&e.setBitXY(r,t-n);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),t=e.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(r,t-n,a,this.getValueXY(n,r,a));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=e.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)this.getBitXY(n,r)&&e.setBitXY(t-r,n);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),t=e.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(t-r,n,a,this.getValueXY(n,r,a));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),t=e.width-1,r=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.getBitXY(a,n)&&e.setBitXY(t-a,r-n);return e}else{const e=Image$1.createFrom(this),t=e.width-1,r=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)for(let s=0;s<this.channels;s++)e.setValueXY(t-a,r-n,s,this.getValueXY(a,n,s));return e}}function insert(e,t={}){const r=getImageParameters(e);this.checkProcessable("insert",r);let{x:n=0,y:a=0}=t;const s=getOutputImageOrInPlace(this,t,{copy:!0}),f=Math.min(s.height,a+e.height),o=Math.min(s.width,n+e.width);if(s.bitDepth===1)for(let x=a;x<f;x++)for(let C=n;C<o;C++)e.getBitXY(C-n,x-a)?s.setBitXY(C,x):s.clearBitXY(C,x);else for(let x=a;x<f;x++)for(let C=n;C<o;C++)s.setPixelXY(C,x,e.getPixelXY(C-n,x-a));return s}function setBorder(e={}){let{size:t=0,algorithm:r="copy",color:n}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),r==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let o=0;o<n.length;o++)n[o]===0&&(n[o]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let a=t[0],s=t[1],f=this.channels;for(let o=a;o<this.width-a;o++)for(let x=0;x<f;x++){let C=n[x]||this.data[(o+this.width*s)*f+x];for(let P=0;P<s;P++)this.data[(P*this.width+o)*f+x]=C;C=n[x]||this.data[(o+this.width*(this.height-s-1))*f+x];for(let P=this.height-s;P<this.height;P++)this.data[(P*this.width+o)*f+x]=C}for(let o=0;o<this.height;o++)for(let x=0;x<f;x++){let C=n[x]||this.data[(o*this.width+a)*f+x];for(let P=0;P<a;P++)this.data[(o*this.width+P)*f+x]=C;C=n[x]||this.data[(o*this.width+this.width-a-1)*f+x];for(let P=this.width-a;P<this.width;P++)this.data[(o*this.width+P)*f+x]=C}return this}function split(e={}){let{preserveAlpha:t=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack$3([this.clone()]);let r=new Stack$3,n=this.data;if(this.alpha&&t)for(let a=0;a<this.components;a++){let s=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),f=0;for(let o=0;o<n.length;o+=this.channels)s.data[f++]=n[o+a],s.data[f++]=n[o+this.components];r.push(s)}else for(let a=0;a<this.channels;a++){let s=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),f=0;for(let o=0;o<n.length;o+=this.channels)s.data[f++]=n[o+a];r.push(s)}return r}function getChannel(e,t={}){let{keepAlpha:r=!1,mergeAlpha:n=!1}=t;r&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let a=Image$1.createFrom(this,{components:1,alpha:r,colorModel:GREY$1}),s=0;for(let f=0;f<this.data.length;f+=this.channels)n?a.data[s++]=this.data[f+e]*this.data[f+this.components]/this.maxValue:(a.data[s++]=this.data[f+e],r&&(a.data[s++]=this.data[f+this.components]));return a}function combineChannels(e=defaultCombineMethod,t={}){let{mergeAlpha:r=!1,keepAlpha:n=!1}=t;r&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let a=Image$1.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),s=0;for(let f=0;f<this.size;f++){let o=e(this.getPixel(f));r?a.data[s++]=o*this.data[f*this.channels+this.components]/this.maxValue:(a.data[s++]=o,n&&(a.data[s++]=this.data[f*this.channels+this.components]))}return a}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let r=e;for(let n=0;n<t.data.length;n++)this.data[r]=t.data[n],r+=this.channels;return this}function getSimilarity(e,t={}){let{shift:r=[0,0],average:n,channels:a,defaultAlpha:s,normalize:f,border:o=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(o)||(o=[o,o]),a=validateArrayOfChannels(this,{channels:a,defaultAlpha:s}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let x=Math.max(o[0],-r[0]),C=Math.min(this.width-o[0],this.width-r[0]),P=Math.max(o[1],-r[1]),ge=Math.min(this.height-o[1],this.height-r[1]),nt=newArray$1(a.length,0);for(let ze=0;ze<a.length;ze++){let Bt=a[ze],qr=f?this.sum[Bt]:Math.max(this.sum[Bt],e.sum[Bt]),_n=f?e.sum[Bt]:Math.max(this.sum[Bt],e.sum[Bt]);if(qr!==0&&_n!==0)for(let Fn=x;Fn<C;Fn++)for(let tl=P;tl<ge;tl++){let Io=Fn*this.multiplierX+tl*this.multiplierY+Bt,Co=Io+r[0]*this.multiplierX+r[1]*this.multiplierY;nt[ze]+=Math.min(this.data[Io]/qr,e.data[Co]/_n)}}return n?nt.reduce((ze,Bt)=>ze+Bt)/nt.length:nt}function getPixelsGrid(e={}){let{sampling:t=[10,10],painted:r=!1,mask:n}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const a=t[0],s=t[1],f=[],o=[],x=this.width/a,C=this.height/s;let P=Math.floor(x/2);for(let nt=0;nt<a;nt++){let ze=Math.floor(C/2);for(let Bt=0;Bt<s;Bt++){let qr=Math.round(P),_n=Math.round(ze);(!n||n.getBitXY(qr,_n))&&(f.push([qr,_n]),o.push(this.getPixelXY(qr,_n))),ze+=C}P+=x}const ge={xyS:f,zS:o};return r&&(ge.painted=this.rgba8().paintPoints(f)),ge}function Matrix(e,t,r){const n=new Array(e);for(let a=0;a<e;a++)n[a]=new Array(t);if(r)for(let a=0;a<e;a++)for(let s=0;s<t;s++)n[a][s]=r;return n.width=e,n.height=t,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(e,t){let r=this[e][t],n=[e,t];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]<r&&(r=this[a][s],n=[a,s]);return{position:n,value:r}};Matrix.prototype.localMax=function(e,t){let r=this[e][t],n=[e,t];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]>r&&(r=this[a][s],n=[a,s]);return{position:n,value:r}};Matrix.prototype.localSearch=function(e,t,r){let n=[];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]===r&&n.push([a,s]);return n};function getBestMatch(e,t={}){let{border:r}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(e.width,e.height,-1/0),a=Math.floor(e.width/2),s=Math.floor(e.height/2),f=a,o=s,x=!1;for(;!x;){let C=n.localSearch(a,s,-1/0);for(let ge=0;ge<C.length;ge++){let nt=C[ge],ze=this.getSimilarity(e,{border:r,shift:[f-nt[0],o-nt[1]]});n[nt[0]][nt[1]]=ze}let P=n.localMax(a,s);P.position[0]!==a||P.position[1]!==s?(a=P.position[0],s=P.position[1]):x=!0}return[a-f,s-o]}function getRow(e,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,t);let r=new Array(this.width),n=0,a=e*this.width*this.channels+t,s=a+this.width*this.channels;for(let f=a;f<s;f+=this.channels)r[n++]=this.data[f];return r}function getColumn(e,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,t);let r=new Array(this.height),n=0,a=this.width*this.channels;for(let s=t+e*this.channels;s<this.data.length;s+=a)r[n++]=this.data[s];return r}function getMatrix(e={}){let{channel:t}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let r=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)r.set(n,a,this.getValueXY(a,n,t));return r}function setMatrix(e,t={}){e=new Matrix$2(e);let{channel:r}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.setValueXY(a,n,r,e.get(n,a))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),t=0;for(let r=0;r<this.data.length;r+=this.channels){let n=new Array(this.components);for(let a=0;a<this.components;a++)n[a]=this.data[r+a];e[t++]=n}return e}function getIntersection(e){let t=this,r=t.getClosestCommonParent(e),n=t.getRelativePosition(r,{defaultFurther:!0}),a=getRelativePositionForAllPixels(t,n),s=e.getRelativePosition(r,{defaultFurther:!0}),f=getRelativePositionForAllPixels(e,s),o=getCommonSurface(a,f),x={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let C=0;C<o.length;C++){let P=o[C],ge=[P[0]-n[0],P[1]-n[1]],nt=[P[0]-s[0],P[1]-s[1]],ze=t.getBitXY(ge[0],ge[1]),Bt=e.getBitXY(nt[0],nt[1]);ze===1&&Bt===1&&x.commonWhitePixels.push(P)}for(let C=0;C<a.length;C++){let P,ge;C!==0&&(P=Math.floor(C/t.width),ge=C%t.width),t.getBitXY(P,ge)===1&&x.whitePixelsMask1.push(a[C])}for(let C=0;C<f.length;C++){let P=0,ge=0;C!==0&&(P=Math.floor(C/e.width),ge=C%e.width),e.getBitXY(P,ge)===1&&x.whitePixelsMask2.push(f[C])}return x}function getRelativePositionForAllPixels(e,t){let r=[];for(let n=0;n<e.height;n++)for(let a=0;a<e.width;a++){let s=[n,a];r.push([s[0]+t[0],s[1]+t[1]])}return r}function getCommonSurface(e,t){let r=0,n=0,a=[];for(;r<e.length&&n<t.length;)e[r][0]===t[n][0]&&e[r][1]===t[n][1]?(a.push(e[r]),r++,n++):e[r][0]<t[n][0]||e[r][0]===t[n][0]&&e[r][1]<t[n][1]?r++:n++;return a}function getClosestCommonParent(e){let t=getDepth(this),r=getDepth(e),n;if(t>=r?n=getFurthestParent(this,t):n=getFurthestParent(e,r),t===0||r===0)return n;let a=this,s=e;for(;t!==r;)if(t>r){if(a=a.parent,a===null)return n;t=t-1}else{if(s=s.parent,s===null)return n;r=r-1}for(;a!==s&&a!==null&&s!==null;)if(a=a.parent,s=s.parent,a===null||s===null)return n;return a!==s?n:a}function getDepth(e){let t=0,r=e;for(;r.parent!=null;)r=r.parent,t++;return t}function getFurthestParent(e,t){let r=e;for(;t>0;)r=r.parent,t=t-1;return r}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,t){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$1,t);const r=e.width,n=e.height,a=e.maxValue,s={sigma:t.gaussianBlur,radius:3},f=e.gaussianFilter(s),o=f.convolution(Gy,convOptions),x=f.convolution(Gx,convOptions),C=x.hypotenuse(o),P=e.constructor,ge=new P(r,n,{kind:"GREY",bitDepth:32}),nt=new P(r,n,{kind:"GREY",bitDepth:32}),ze=new P(r,n,{kind:"GREY"});for(var Bt=1;Bt<r-1;Bt++)for(var qr=1;qr<n-1;qr++){var _n=(Math.round(Math.atan2(x.getValueXY(Bt,qr,0),o.getValueXY(Bt,qr,0))*(5/Math.PI))+5)%5;_n===0&&(C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt,qr-1,0)||C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt,qr+1,0))||_n===1&&(C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt-1,qr+1,0)||C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt+1,qr-1,0))||_n===2&&(C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt-1,qr,0)||C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt+1,qr,0))||_n===3&&(C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt-1,qr-1,0)||C.getValueXY(Bt,qr,0)<=C.getValueXY(Bt+1,qr+1,0))||ge.setValueXY(Bt,qr,0,C.getValueXY(Bt,qr,0))}for(Bt=0;Bt<r*n;++Bt){var Fn=ge.data[Bt],tl=0;Fn>t.highThreshold&&(tl++,ze.data[Bt]=a),Fn>t.lowThreshold&&tl++,nt.data[Bt]=tl}var Io=[];for(Bt=1;Bt<r-1;++Bt)for(qr=1;qr<n-1;++qr)if(nt.getValueXY(Bt,qr,0)===1){e:for(var Co=Bt-1;Co<Bt+2;++Co)for(var rl=qr-1;rl<qr+2;++rl)if(nt.getValueXY(Co,rl,0)===2){Io.push([Bt,qr]),ze.setValueXY(Bt,qr,0,a);break e}}for(;Io.length>0;){var ah=[];for(Bt=0;Bt<Io.length;++Bt)for(qr=-1;qr<2;++qr)for(Co=-1;Co<2;++Co)if(!(qr===0&&Co===0)){var ch=Io[Bt][0]+qr,ju=Io[Bt][1]+Co;nt.getValueXY(ch,ju,0)===1&&ze.getValueXY(ch,ju,0)===0&&(ah.push([ch,ju]),ze.setValueXY(ch,ju,0,a))}Io=ah}return ze}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,t={}){let{position:r}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&(r=e.getRelativePosition(this),!r))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image$1.createFrom(this,{width:e.width,height:e.height,alpha:1,position:r,parent:this});for(let a=0;a<e.width;a++)for(let s=0;s<e.height;s++){for(let f=0;f<this.channels;f++){let o=this.getValueXY(a+r[0],s+r[1],f);n.setValueXY(a,s,f,o)}e.getBitXY(a,s)||n.setValueXY(a,s,this.components,0)}return n}else{let n=Image$1.createFrom(this,{width:e.width,height:e.height,position:r,parent:this});for(let a=0;a<e.height;a++)for(let s=0;s<e.width;s++)e.getBitXY(s,a)&&this.getBitXY(s+r[0],a+r[1])&&n.setBitXY(s,a);return n}}var fastList={exports:{}};(function(e,t){(function(){function r(a,s,f){this.next=f,f&&(f.prev=this),this.prev=s,s&&(s.next=this),this.data=a}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(a){this._tail=new r(a,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var a=this._tail;return this._tail=a.prev,a.prev&&(a.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),a.data}},unshift:function(a){this._head=new r(a,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var a=this._head;return this._head=a.next,a.next&&(a.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),a.data}},item:function(a){a<0&&(a=this.length+a);for(var s=this._head;a-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(a,s){if(a||(a=0),s||(s=this.length),s<0&&(s=this.length+s),a<0&&(a=this.length+a),s===a)return[];if(s<a)throw new Error("invalid offset: "+a+","+s+" (length="+this.length+")");for(var f=s-a,o=new Array(f),x=0,C=this._head;a-- >0&&C;)C=C.next;for(;x<f&&C;)o[x++]=C.data,C=C.next;return o},drop:function(){n.call(this)},forEach:function(a,s){for(var f=this._head,o=0,x=this.length;o<x&&f;)a.call(s||this,f.data,o,this),f=f.next,o++},map:function(a,s){var f=new n;return this.forEach(function(o,x,C){f.push(a.call(s||C,o,x,C))}),f},filter:function(a,s){var f=new n;return this.forEach(function(o,x,C){a.call(s||C,o,x,C)&&f.push(o)}),f},reduce:function(a,s,f){var o=0,x=this._head,C=this.length;for(s||(o=1,s=x&&x.data,x=x&&x.next);o<C&&x;)s=a.call(f||this,s,x.data,this),o++,x=x.next;return s}},e.exports=n})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(e={}){const{x:t=0,y:r=0,inPlace:n=!0}=e,a=n?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,r))return a;const f=new LinkedList;for(f.push(new Node(t,r));f.length>0;){const o=f.shift();a.setBitXY(o.x,o.y);for(let x=o.x+1;x<this.width&&(!a.getBitXY(x,o.y)&&!this.getBitXY(x,o.y));x++)a.setBitXY(x,o.y),o.y+1<this.height&&!this.getBitXY(x,o.y+1)&&f.push(new Node(x,o.y+1)),o.y-1>=0&&!this.getBitXY(x,o.y-1)&&f.push(new Node(x,o.y-1));for(let x=o.x-1;x>=0&&(!a.getBitXY(x,o.y)&&!this.getBitXY(x,o.y));x++)a.setBitXY(x,o.y),o.y+1<this.height&&!this.getBitXY(x,o.y+1)&&f.push(new Node(x,o.y+1)),o.y-1>=0&&!this.getBitXY(x,o.y-1)&&f.push(new Node(x,o.y-1))}return a}function Node(e,t){this.x=e,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function hsv2rgb(e,t,r){t=t/100,r=r/100;var n=[],a=r*t,s=e/60,f=a*(1-Math.abs(s%2-1)),o=r-a;return s>=0&&s<1?n=[a,f,0]:s>=1&&s<2?n=[f,a,0]:s>=2&&s<3?n=[0,a,f]:e>=3&&s<4?n=[0,f,a]:e>=4&&s<5?n=[f,0,a]:e>=5&&s<=6?n=[a,0,f]:n=[0,0,0],{r:Math.round(255*(n[0]+o)),g:Math.round(255*(n[1]+o)),b:Math.round(255*(n[2]+o))}}function hsl2hsv(e,t,r){return t*=(r<50?r:100-r)/100,{h:e,s:2*t/(r+t)*100,v:r+t}}function hsl2rgb$1(e,t,r){var n=hsl2hsv(e,t,r);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var t=colors[e.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(e){var t=e.match(/rgb\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function rgba$1(e){var t=e.match(/rgba\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:r[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var t=e.match(/hsl\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */),n=parseInt(r[0],10),a=parseInt(r[1],10),s=parseInt(r[2],10),f=hsl2rgb$1(n,a,s);return _extends({},f,{a:100})}}function hsla(e){var t=e.match(/hsla\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */),n=parseInt(r[0],10),a=parseInt(r[1],10),s=parseInt(r[2],10),f=parseInt(parseFloat(r[3])*100,10),o=hsl2rgb$1(n,a,s);return _extends({},o,{a:f})}}function css2array(e){let t=parse(e);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hsl2rgb(e,t,r){let n,a,s,f,o,x;return t/=100,r/=100,t===0?f=o=x=r*255:(r<=.5?a=r*(t+1):a=r+t-r*t,n=r*2-a,s=e/360,f=hue2rgb(n,a,s+1/3),o=hue2rgb(n,a,s),x=hue2rgb(n,a,s-1/3)),{r:f,g:o,b:x}}function getDistinctColors(e){let t=new Array(e),r=0;for(let n=0;n<360;n+=360/e){r++;let a=hsl2rgb(n,100,30+r%4*15);t[r-1]=[Math.round(a.r*255),Math.round(a.g*255),Math.round(a.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:t,colors:r,randomColors:n,numberColors:a=50}=e;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(r)return r=r.map(function(s){return Array.isArray(s)?s:css2array(s)}),r;if(n){r=new Array(a);for(let s=0;s<a;s++)r[s]=getRandomColor()}return getDistinctColors(a)}function paintLabels(e,t,r={}){let{color:n="blue",colors:a,font:s="12px Helvetica",rotate:f=0}=r;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),a?a=a.map(function(C){return Array.isArray(C)?C:css2array(C)}):a=[n],e.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(f)||(f=[f]);let x=this.getCanvas().getContext("2d");for(let C=0;C<e.length;C++){x.save();let P=a[C%a.length];x.fillStyle=`rgba(${P[0]},${P[1]},${P[2]},${P[3]/this.maxValue})`,x.font=s[C%s.length];let ge=t[C];x.translate(ge[0],ge[1]),x.rotate(f[C%f.length]/180*Math.PI),x.fillText(e[C],0,0),x.restore()}return this.data=Uint8Array.from(x.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,t={}){let{alpha:r=255,labels:n=[],labelsPosition:a=[],labelColor:s="blue",labelFont:f="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let o=getColors(Object.assign({},t,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let x=0;x<e.length;x++){let C=e[x],P=o[x%o.length];for(let ge=0;ge<C.width;ge++)for(let nt=0;nt<C.height;nt++)if(C.getBitXY(ge,nt))for(let ze=0;ze<Math.min(this.components,P.length);ze++)if(r===255)this.setValueXY(ge+C.position[0],nt+C.position[1],ze,P[ze]);else{let Bt=this.getValueXY(ge+C.position[0],nt+C.position[1],ze);Bt=Math.round((Bt*(255-r)+P[ze]*r)/255),this.setValueXY(ge+C.position[0],nt+C.position[1],ze,Bt)}}if(Array.isArray(n)&&n.length>0){let C=this.getCanvas().getContext("2d");C.fillStyle=s,C.font=f;for(let P=0;P<Math.min(e.length,n.length);P++){let ge=a[P]?a[P]:e[P].position;C.fillText(n[P],ge[0],ge[1])}this.data=Uint8Array.from(C.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,t){let r=new Array(e);for(let n=0;n<e;n++)r[n]=new Array(t).fill(0);return r}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:r="cross",shape:n,size:a,width:s,height:f,filled:o=!0}=t;if(a&&(s=a,f=a),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,f,{filled:o});break;case"circle":case"ellipse":this.matrix=ellipse(s,f,{filled:o});break;case"triangle":this.matrix=triangle(s,f,{filled:o});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(r)switch(r.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${r}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,r=[];for(let n=0;n<t.length;n++)for(let a=0;a<t[0].length;a++)t[n][a]&&r.push([a-this.halfWidth,n-this.halfHeight]);return r}getMask(){let t=new Image$1(this.width,this.height,{kind:BINARY});for(let r=0;r<this.matrix.length;r++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[r][n]&&t.setBitXY(n,r);return t}}function rectangle(e,t,r){const n=zerosMatrix(t,e);if(r.filled)for(let a=0;a<t;a++)for(let s=0;s<e;s++)n[a][s]=1;else{for(let a of[0,t-1])for(let s=0;s<e;s++)n[a][s]=1;for(let a=0;a<t;a++)for(let s of[0,e-1])n[a][s]=1}return n}function ellipse(e,t,r){const n=zerosMatrix(t,e);let a=1-t%2,s=1-e%2,f=Math.floor((e-1)/2),o=Math.floor((t-1)/2),x=f*f,C=o*o;if(r.filled)for(let P=0;P<=o;P++){let ge=Math.floor(Math.sqrt(x-x*P*P/C));for(let nt=f-ge;nt<=f;nt++)n[o-P][nt]=1,n[o+P+a][nt]=1,n[o-P][e-nt-1]=1,n[o+P+a][e-nt-1]=1}else{for(let P=0;P<=o;P++){let ge=Math.floor(Math.sqrt(x-x*P*P/C)),nt=f-ge;n[o-P][nt]=1,n[o+P+a][nt]=1,n[o-P][e-nt-1]=1,n[o+P+a][e-nt-1]=1}for(let P=0;P<=f;P++){let ge=Math.floor(Math.sqrt(C-C*P*P/x)),nt=o-ge;n[nt][f-P]=1,n[nt][f+P+s]=1,n[t-nt-1][f-P]=1,n[t-nt-1][f+P+s]=1}}return n}function triangle(e,t,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(t,e);for(let a=0;a<t;a++){let s=Math.floor((1-a/t)*e/2);for(let f=s;f<e-s;f++)n[a][f]=1}return n}function paintPoints(e,t={}){let{shape:r}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length})),a=new Shape(r).getPoints(),s=Math.min(this.channels,n[0].length);for(let f=0;f<e.length;f++){let o=n[f%n.length],x=e[f][0],C=e[f][1];for(let P=0;P<a.length;P++){let ge=a[P][0],nt=a[P][1];if(x+ge>=0&&C+nt>=0&&x+ge<this.width&&C+nt<this.height){let ze=(x+ge+(C+nt)*this.width)*this.channels;for(let Bt=0;Bt<s;Bt++)this.data[ze+Bt]=o[Bt]}}}return this}function paintPolyline(e,t={}){let{color:r=[this.maxValue,0,0],closed:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let a=Math.min(this.channels,r.length);for(let s=0;s<e.length-1+n;s++){let f=e[s],o=e[(s+1)%e.length],x=o[0]-f[0],C=o[1]-f[1],P=Math.max(Math.abs(x),Math.abs(C)),ge=x/P,nt=C/P,ze=f[0],Bt=f[1];for(let qr=0;qr<=P;qr++){let _n=Math.round(ze),Fn=Math.round(Bt);if(_n>=0&&Fn>=0&&_n<this.width&&Fn<this.height)if(this.bitDepth===1)this.setBitXY(_n,Fn);else{let tl=(_n+Fn*this.width)*this.channels;for(let Io=0;Io<a;Io++)this.data[tl+Io]=r[Io]}ze=ze+ge,Bt=Bt+nt}}return this}function paintPolylines(e,t={}){let r=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length}));for(let a=0;a<e.length;a++)r.color=n[a%n.length],this.paintPolyline(e[a],r);return this}function paintPolygon(e,t={}){let{color:r=[this.maxValue,0,0],filled:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let a=deleteDouble(e);if(n===!1)return this.paintPolyline(e,t);{let s=Array(this.height);for(let f=0;f<this.height;f++){s[f]=[];for(let o=0;o<this.width;o++)s[f].push(0)}for(let f=0;f<a.length;f++){const o=lineBetweenTwoPoints(a[f],a[(f+1)%a.length]);for(let x=0;x<this.height;x++)for(let C=0;C<this.width;C++)isAtTheRightOfTheLine(C,x,o,this.height)&&(s[x][C]=s[x][C]===0?1:0)}for(let f=0;f<this.height;f++)for(let o=0;o<this.width;o++)if(s[f][o]===1)if(this.bitDepth===1)this.setBitXY(o,f);else{let x=Math.min(this.channels,r.length),C=(o+f*this.width)*this.channels;for(let P=0;P<x;P++)this.data[C+P]=r[P]}return this.paintPolyline(e,t)}}function deleteDouble(e){let t=[];for(let r=0;r<e.length;r++)if(!(e[r][0]===e[(r+1)%e.length][0]&&e[r][1]===e[(r+1)%e.length][1])){if(e[r][0]===e[(r-1+e.length)%e.length][0]&&e[r][1]===e[(r-1+e.length)%e.length][1])continue;if(e[(r+1)%e.length][0]===e[(r-1+e.length)%e.length][0]&&e[(r-1+e.length)%e.length][1]===e[(r+1)%e.length][1])continue;t.push(e[r])}return t}function lineBetweenTwoPoints(e,t){if(e[0]===t[0])return{a:0,b:e[0],vertical:!0};{const r=(t[1]-e[1])/(t[0]-e[0]),n=e[1]-r*e[0];return{a:r,b:n,vertical:!1}}}function isAtTheRightOfTheLine(e,t,r,n){if(r.vertical===!0)return r.b<=e;if(r.a===0)return!1;{const a=(t-r.b)/r.a;return a<e&&a>=0&&a<=n}}function paintPolygons(e,t={}){let r=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length}));for(let a=0;a<e.length;a++)r.color=n[a%n.length],this.paintPolygon(e[a],r);return this}function getHistogram(e={}){let{maxSlots:t=256,channel:r,useAlpha:n=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}return getChannelHistogram.call(this,r,{useAlpha:n,maxSlots:t})}function getHistograms(e={}){const{maxSlots:t=256,useAlpha:r=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(r?this.components:this.channels);for(let a=0;a<n.length;a++)n[a]=getChannelHistogram.call(this,a,{useAlpha:r,maxSlots:t});return n}function getChannelHistogram(e,t){let{useAlpha:r,maxSlots:n}=t;if(this.bitDepth===1){let x=[0,0];for(let C=0;C<this.height;C++)for(let P=0;P<this.width;P++){let ge=this.getBitXY(C,P);ge===0?x[0]+=1:ge===1&&(x[1]+=1)}return x}let a=Math.log2(n);if(!isInteger$1(a))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>a&&(s=this.bitDepth-a);let f=this.data,o=newArray$1(Math.pow(2,Math.min(this.bitDepth,a)),0);if(r&&this.alpha){let x=this.channels-e-1;for(let C=e;C<f.length;C+=this.channels)o[f[C]>>s]+=f[C+x]/this.maxValue}else for(let x=e;x<f.length;x+=this.channels)o[f[x]>>s]++;return o}function getColorHistogram(e={}){let{useAlpha:t=!0,nbSlots:r=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(r)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let a=this.bitDepth-n,s=this.data,f=newArray$1(Math.pow(8,n),0),o=Math.pow(2,n*2),x=Math.pow(2,n);for(let C=0;C<s.length;C+=this.channels){let P=(s[C]>>a)*o+(s[C+1]>>a)*x+(s[C+2]>>a);t&&this.alpha?f[P]+=s[C+this.channels-1]/this.maxValue:f[P]++}return f}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)this.data[t+r]<e[r]&&(e[r]=this.data[t+r]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)this.data[t+r]>e[r]&&(e[r]=this.data[t+r]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray$1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)e[r]+=this.data[t+r];return e}function getMoment(e=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let r=0;for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.getBitXY(n,a)===1&&(r+=n**e*a**t);return r}function localMaxima(e={}){let{mask:t,region:r=3,removeClosePoints:n=0,invert:a=!1,maxEquals:s=2}=e,f=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),r*=4;let o=a?0:1,x=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],C=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],P=r<=8?1:2,ge=[];for(let nt=P;nt<f.height-P;nt++)for(let ze=P;ze<f.width-P;ze++){if(t&&t.getBitXY(ze,nt)!==o)continue;let Bt=0,qr=0,_n=f.data[ze+nt*f.width];for(let Fn=0;Fn<r;Fn++)a?f.data[ze+x[Fn]+(nt+C[Fn])*f.width]>_n&&Bt++:f.data[ze+x[Fn]+(nt+C[Fn])*f.width]<_n&&Bt++,f.data[ze+x[Fn]+(nt+C[Fn])*f.width]===_n&&qr++;Bt+qr===r&&qr<=s&&ge.push([ze,nt])}if(n>0)for(let nt=0;nt<ge.length;nt++)for(let ze=nt+1;ze<ge.length;ze++)Math.sqrt(Math.pow(ge[nt][0]-ge[ze][0],2)+Math.pow(ge[nt][1]-ge[ze][1],2))<n&&(ge[nt][0]=ge[nt][0]+ge[ze][0]>>1,ge[nt][1]=ge[nt][1]+ge[ze][1]>>1,ge.splice(ze,1),ze--);return ge}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=mean$2(n)}return t}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=median$2(n)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let t=0;t<this.width;t++)for(let r=0;r<this.height;r++)this.getBitXY(t,r)===1&&e.push([t,r]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let t=0;t<this.height;t++)for(let r=0;r<this.width;r++)if(this.getBitXY(r,t)===1)for(e.push([r,t]),this.getBitXY(r+1,t)!==1?(e.push([r+1,t]),e.push([r+1,t+1]),this.getBitXY(r,t+1)!==1&&e.push([r,t+1])):this.getBitXY(r,t+1)!==1&&(e.push([r,t+1]),e.push([r+1,t+1]));r<this.width-2&&this.getBitXY(r+1,t)===1&&this.getBitXY(r+2,t)===1;)r++;return e}function getRelativePosition(e,t={}){if(this===e)return[0,0];let r=[0,0],n=this;for(;n;){if(n===e)return r;n.position&&(r[0]+=n.position[0],r[1]+=n.position[1]),n=n.parent}return t.defaultFurther?r:!1}function countAlphaPixels(e={}){let{alpha:t=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let r=0;if(t!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===t&&r++;return r}else return this.size}function monotoneChainConvexHull$1(e,t={}){const{sorted:r}=t;r||(e=e.slice().sort(byXThenY));const n=e.length,a=new Array(n*2);let s=0;for(let o=0;o<n;o++){const x=e[o];for(;s>=2&&cw(a[s-2],a[s-1],x)<=0;)s--;a[s++]=x}const f=s+1;for(let o=n-2;o>=0;o--){const x=e[o];for(;s>=f&&cw(a[s-2],a[s-1],x)<=0;)s--;a[s++]=x}return a.slice(0,s-1)}function cw(e,t,r){return(t[1]-e[1])*(r[0]-e[0])-(t[0]-e[0])*(r[1]-e[1])}function byXThenY(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let t=0;t<e.length;t++)e[t][0]=Math.round(e[t][0]),e[t][1]=Math.round(e[t][1]);return e}function difference(e,t){return[e[0]-t[0],e[1]-t[1]]}function normalize(e){let t=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/t,e[1]/t]}function rotate(e,t,r){r===void 0&&(r=new Array(t.length));let n=Math.cos(e),a=Math.sin(e);for(let s=0;s<r.length;++s)r[s]=[n*t[s][0]-a*t[s][1],a*t[s][0]+n*t[s][1]];return r}function perimeter(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r][0],a=e[r][1],s=e[r===e.length-1?0:r+1][0],f=e[r===e.length-1?0:r+1][1];t+=Math.sqrt((s-n)**2+(f-a)**2)}return t}function surface(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r][0],a=e[r===e.length-1?0:r+1][1],s=e[r===e.length-1?0:r+1][0],f=e[r][1];t+=n*a*.5,t-=s*f*.5}return Math.abs(t)}function minMax(e){let t=1/0,r=1/0,n=-1/0,a=-1/0;for(let s=0;s<e.length;s++)e[s][0]<t&&(t=e[s][0]),e[s][0]>n&&(n=e[s][0]),e[s][1]<r&&(r=e[s][1]),e[s][1]>a&&(a=e[s][1]);return[[t,r],[n,a]]}function moveToZeroZero(e,t){t===void 0&&(t=new Array(e.length).fill(0).map(()=>[]));let r=minMax(e),n=r[0][0],a=r[0][1];for(let s=0;s<e.length;s++)t[s][0]=e[s][0]-n,t[s][1]=e[s][1]-a;return t}function minimalBoundingRectangle(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const r=new Array(t.length);let n=1/0,a=0,s;for(let f=0;f<r.length;f++){let o=getAngle$1(t[f],t[(f+1)%r.length]);rotate(-o,t,r);let x=r[f][0],C=r[f][1],P=r[(f+1)%r.length][0],ge=r[(f+1)%r.length][1],nt=!0,ze=0,Bt=0,qr=0;for(let Io=0;Io<r.length;Io++){let Co=r[Io][0],rl=r[Io][1],ah=(Co-x)/(P-x);nt===!0?(nt=!1,ze=ah,Bt=ah):(ah<ze&&(ze=ah),ah>Bt&&(Bt=ah));let ch=(-(P-x)*rl+P*C-ge*x)/(P-x);Math.abs(ch)>Math.abs(qr)&&(qr=ch)}let _n=[x+ze*(P-x),C],Fn=[x+Bt*(P-x),C],tl=Math.abs(qr*(ze-Bt)*(P-x));tl<n&&(a=o,n=tl,s=[_n,Fn,[Fn[0],Fn[1]-qr],[_n[0],_n[1]-qr]])}return rotate(a,s,s),s}function getAngle$1(e,t){let r=difference(t,e),n=normalize(r),a=Math.acos(n[0]);return n[1]<0?-a:a}function extend$4(e){let t={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,t),e.extendMethod("add",add,t),e.extendMethod("subtract",subtract,t),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,t),e.extendMethod("divide",divide,t),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,t),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,t),e.extendMethod("paintMasks",paintMasks,t),e.extendMethod("paintPoints",paintPoints,t),e.extendMethod("paintPolyline",paintPolyline,t),e.extendMethod("paintPolylines",paintPolylines,t),e.extendMethod("paintPolygon",paintPolygon,t),e.extendMethod("paintPolygons",paintPolygons,t),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){function r(al){return typeof al=="string"||al instanceof String}var n=Number.isFinite||window.isFinite;function a(al){return n(al)}function s(al){return al}function f(al){var fh={};return al.filter(function(nl){return fh.hasOwnProperty(nl)?!1:fh[nl]=!0})}function o(al,fh){if(fh.length!==al.length)return!1;for(var nl=0;nl<al.length;nl++)if(fh[nl].compareArray&&!fh[nl].compareArray(al[nl])||fh[nl]!==al[nl])return!1;return!0}function x(al,fh){Object.keys(fh).forEach(function(nl){al[nl]=fh[nl]})}function C(){for(var al=1,fh=0,nl=0;nl<arguments.length;nl++){var Zs=arguments[nl];fh=fh+nt(Zs),al*=Zs}return fh!==0?ge(al,fh):al}function P(al,fh){if(fh===0)throw new Error("Divide by zero");var nl=Math.pow(10,nt(fh)),Zs=nl/(nl*fh);return C(al,Zs)}function ge(al,fh){return Math.round(al*Math.pow(10,fh))/Math.pow(10,fh)}function nt(al){if(!isFinite(al))return 0;for(var fh=0;al%1!==0;)al*=10,fh++;return fh}function ze(){var al;if(!this)return al=Object.create(ze.prototype),ze.apply(al,arguments),al;al=Error.apply(this,arguments),this.name="QtyError",this.message=al.message,this.stack=al.stack}ze.prototype=Object.create(Error.prototype,{constructor:{value:ze}});function Bt(al,fh){throw new ze("Incompatible units: "+al+" and "+fh)}var qr={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},_n=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],Fn="<1>",tl=[Fn];function Io(al,fh){var nl=fh[1],Zs=fh[3]||[],ol=fh[4]||[];if(!a(nl))throw new ze(al+": Invalid unit definition. 'scalar' must be a number");Zs.forEach(function(sh){if(qr[sh]===void 0)throw new ze(al+": Invalid unit definition. Unit "+sh+" in 'numerator' is not recognized")}),ol.forEach(function(sh){if(qr[sh]===void 0)throw new ze(al+": Invalid unit definition. Unit "+sh+" in 'denominator' is not recognized")})}var Co={},rl={},ah={},ch={},ju={};for(var Zu in qr)if(qr.hasOwnProperty(Zu)){var sl=qr[Zu];if(sl[2]==="prefix"){Co[Zu]=sl[1];for(var oh=0;oh<sl[0].length;oh++)rl[sl[0][oh]]=Zu}else{Io(Zu,sl),ah[Zu]={scalar:sl[1],numerator:sl[3],denominator:sl[4]};for(var hh=0;hh<sl[0].length;hh++)ch[sl[0][hh]]=Zu}ju[Zu]=sl[0][0]}function Sh(al){var fh,nl=[],Zs=Object.keys(qr);if(typeof al>"u")for(fh=0;fh<Zs.length;fh++)["","prefix"].indexOf(qr[Zs[fh]][2])===-1&&nl.push(Zs[fh].substr(1,Zs[fh].length-2));else{if(this.getKinds().indexOf(al)===-1)throw new ze("Kind not recognized");for(fh=0;fh<Zs.length;fh++)qr[Zs[fh]][2]===al&&nl.push(Zs[fh].substr(1,Zs[fh].length-2))}return nl.sort(function(ol,sh){return ol.toLowerCase()<sh.toLowerCase()?-1:ol.toLowerCase()>sh.toLowerCase()?1:0})}function $h(al){if(!ch[al])throw new ze("Unit not recognized");return qr[ch[al]][0]}var hd=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function vd(){if(this.signature)return this.signature;for(var al=Ef.call(this),fh=0;fh<al.length;fh++)al[fh]*=Math.pow(20,fh);return al.reduce(function(nl,Zs){return nl+Zs},0)}function Ef(){if(!this.isBase())return Ef.call(this.toBase());for(var al=new Array(hd.length),fh=0;fh<al.length;fh++)al[fh]=0;for(var nl,Zs,ol=0;ol<this.numerator.length;ol++)(nl=qr[this.numerator[ol]])&&(Zs=hd.indexOf(nl[2]),Zs>=0&&(al[Zs]=al[Zs]+1));for(var sh=0;sh<this.denominator.length;sh++)(nl=qr[this.denominator[sh]])&&(Zs=hd.indexOf(nl[2]),Zs>=0&&(al[Zs]=al[Zs]-1));return al}var Cd="[+-]",Cf="\\d+",Sd=Cd+"?"+Cf,yd="\\."+Cf,Hd="(?:"+Cf+"(?:"+yd+")?)|(?:"+yd+")",xd="[Ee]"+Sd,Pd="(?:"+Hd+")(?:"+xd+")?",zd=Cd+"?\\s*"+Pd,Ld="("+zd+")?\\s*([^/]*)(?:/(.+))?",Kd=new RegExp("^"+Ld+"$"),wf="\\^|\\*{2}",kd="[01234]",cd=new RegExp("([^ \\*\\d]+?)(?:"+wf+")?(-?"+kd+"(?![a-zA-Z]))"),gd=new RegExp("([^ \\*\\d]+?)(?:"+wf+")?("+kd+"(?![a-zA-Z]))");function bp(al){r(al)||(al=al.toString()),al=al.trim();var fh=Kd.exec(al);if(!fh)throw new ze(al+": Quantity not recognized");var nl=fh[1];nl?(nl=nl.replace(/\s/g,""),this.scalar=parseFloat(nl)):this.scalar=1;for(var Zs=fh[2],ol=fh[3],sh,xh,Mh;fh=cd.exec(Zs);){if(sh=parseFloat(fh[2]),isNaN(sh))throw new ze("Unit exponent is not a number");if(sh===0&&!_p.test(fh[1]))throw new ze("Unit not recognized");xh=fh[1]+" ",Mh="";for(var Uh=0;Uh<Math.abs(sh);Uh++)Mh+=xh;sh>=0?Zs=Zs.replace(fh[0],Mh):(ol=ol?ol+Mh:Mh,Zs=Zs.replace(fh[0],""))}for(;fh=gd.exec(ol);){if(sh=parseFloat(fh[2]),isNaN(sh))throw new ze("Unit exponent is not a number");if(sh===0&&!_p.test(fh[1]))throw new ze("Unit not recognized");xh=fh[1]+" ",Mh="";for(var Nh=0;Nh<sh;Nh++)Mh+=xh;ol=ol.replace(fh[0],Mh)}Zs&&(this.numerator=Qd(Zs.trim())),ol&&(this.denominator=Qd(ol.trim()))}var Uf=Object.keys(rl).sort(function(al,fh){return fh.length-al.length}).join("|"),qd=Object.keys(ch).sort(function(al,fh){return fh.length-al.length}).join("|"),Vd="\\b|$",ep="("+Uf+")??("+qd+")(?:"+Vd+")",_p=new RegExp("^\\s*("+ep+"[\\s\\*]*)+$"),lp=new RegExp(ep,"g"),Kh={};function Qd(al){var fh=Kh[al];if(fh)return fh;var nl,Zs=[];if(!_p.test(al))throw new ze("Unit not recognized");for(;nl=lp.exec(al);)Zs.push(nl.slice(1));return Zs=Zs.map(function(ol){return rl[ol[0]]?[rl[ol[0]],ch[ol[1]]]:[ch[ol[1]]]}),Zs=Zs.reduce(function(ol,sh){return ol.concat(sh)},[]),Zs=Zs.filter(function(ol){return ol}),Kh[al]=Zs,Zs}function fd(al){if(!r(al))throw new ze("Argument should be a string");try{return this(al)}catch{return null}}function Jd(al){return al instanceof Yh}function Yh(al,fh){if($d.apply(null,arguments),!Jd(this))return new Yh(al,fh);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=tl,this.denominator=tl,Jf(al)?(this.scalar=al.scalar,this.numerator=al.numerator&&al.numerator.length!==0?al.numerator:tl,this.denominator=al.denominator&&al.denominator.length!==0?al.denominator:tl):fh?(bp.call(this,fh),this.scalar=al):bp.call(this,al),this.denominator.join("*").indexOf("temp")>=0)throw new ze("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new ze("Cannot multiply by temperatures");if(!o(this.denominator,tl))throw new ze("Cannot divide with temperatures")}if(this.initValue=al,Sf.call(this),this.isTemperature()&&this.baseScalar<0)throw new ze("Temperatures must not be less than absolute zero")}Yh.prototype={constructor:Yh};function $d(al,fh){if(fh){if(!(a(al)&&r(fh)))throw new ze("Only number accepted as initialization value when units are explicitly provided")}else if(!(r(al)||a(al)||Jd(al)||Jf(al)))throw new ze("Only string, number or quantity accepted as single initialization value")}function Jf(al){return al&&typeof al=="object"&&al.hasOwnProperty("scalar")}function Sf(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=vd.call(this);else{var al=this.toBase();this.baseScalar=al.scalar,this.signature=al.signature}}var If={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function Xf(){return f(Object.keys(If).map(function(al){return If[al]}))}Yh.prototype.kind=function(){return If[this.signature.toString()]},x(Yh.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&o(this.denominator,tl)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Of(al,fh){var nl=al.units(),Zs=fh.to(nl),ol=Yh(vp(nl));return Yh({scalar:al.scalar-Zs.scalar,numerator:ol.numerator,denominator:ol.denominator})}function jf(al,fh){var nl=fh.to(vp(al.units()));return Yh({scalar:al.scalar-nl.scalar,numerator:al.numerator,denominator:al.denominator})}function Ap(al,fh){var nl=fh.to(vp(al.units()));return Yh({scalar:al.scalar+nl.scalar,numerator:al.numerator,denominator:al.denominator})}function vp(al){if(al==="tempK")return"degK";if(al==="tempC")return"degC";if(al==="tempF")return"degF";if(al==="tempR")return"degR";throw new ze("Unknown type for temp conversion from: "+al)}function Tp(al,fh){var nl=Zf(al),Zs=fh.units(),ol;if(Zs==="degK")ol=nl.scalar;else if(Zs==="degC")ol=nl.scalar;else if(Zs==="degF")ol=nl.scalar*9/5;else if(Zs==="degR")ol=nl.scalar*9/5;else throw new ze("Unknown type for degree conversion to: "+Zs);return Yh({scalar:ol,numerator:fh.numerator,denominator:fh.denominator})}function Zf(al){var fh=al.units(),nl;if(fh.match(/(deg)[CFRK]/))nl=al.baseScalar;else if(fh==="tempK")nl=al.scalar;else if(fh==="tempC")nl=al.scalar;else if(fh==="tempF")nl=al.scalar*5/9;else if(fh==="tempR")nl=al.scalar*5/9;else throw new ze("Unknown type for temp conversion from: "+fh);return Yh({scalar:nl,numerator:["<kelvin>"],denominator:tl})}function qp(al,fh){var nl=fh.units(),Zs;if(nl==="tempK")Zs=al.baseScalar;else if(nl==="tempC")Zs=al.baseScalar-273.15;else if(nl==="tempF")Zs=al.baseScalar*9/5-459.67;else if(nl==="tempR")Zs=al.baseScalar*9/5;else throw new ze("Unknown type for temp conversion to: "+nl);return Yh({scalar:Zs,numerator:fh.numerator,denominator:fh.denominator})}function sm(al){var fh=al.units(),nl;if(fh.match(/(deg)[CFRK]/))nl=al.baseScalar;else if(fh==="tempK")nl=al.scalar;else if(fh==="tempC")nl=al.scalar+273.15;else if(fh==="tempF")nl=(al.scalar+459.67)*5/9;else if(fh==="tempR")nl=al.scalar*5/9;else throw new ze("Unknown type for temp conversion from: "+fh);return Yh({scalar:nl,numerator:["<temp-K>"],denominator:tl})}x(Yh.prototype,{to:function(al){var fh,nl;if(al==null)return this;if(!r(al))return this.to(al.units());if(fh=this._conversionCache[al],fh)return fh;if(nl=Yh(al),nl.units()===this.units())return this;if(!this.isCompatible(nl))this.isInverse(nl)?nl=this.inverse().to(al):Bt(this.units(),nl.units());else if(nl.isTemperature())nl=qp(this,nl);else if(nl.isDegrees())nl=Tp(this,nl);else{var Zs=P(this.baseScalar,nl.baseScalar);nl=Yh({scalar:Zs,numerator:nl.numerator,denominator:nl.denominator})}return this._conversionCache[al]=nl,nl},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return sm(this);var al=$p[this.units()];return al||(al=Lh(this.numerator,this.denominator),$p[this.units()]=al),al.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new ze("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(al){if(r(al)&&(al=Yh(al)),a(al)&&(al=Yh(al+" "+this.units())),this.isUnitless()?al.isUnitless()||Bt(this.units(),al.units()):al=al.to(this.units()),al.scalar===0)throw new ze("Divide by zero");var fh=C(Math.round(this.scalar/al.scalar),al.scalar);return Yh(fh+this.units())}});function Wd(al,fh){var nl=Yh(al),Zs=Yh(fh);if(nl.eq(Zs))return s;var ol;return nl.isTemperature()?ol=function(sh){return nl.mul(sh).to(Zs).scalar}:ol=function(sh){return sh*nl.baseScalar/Zs.baseScalar},function(xh){var Mh,Uh,Nh;if(Array.isArray(xh)){for(Uh=xh.length,Nh=[],Mh=0;Mh<Uh;Mh++)Nh.push(ol(xh[Mh]));return Nh}else return ol(xh)}}var $p={};function Lh(al,fh){for(var nl=[],Zs=[],ol=1,sh,xh=0;xh<al.length;xh++)sh=al[xh],Co[sh]?ol=C(ol,Co[sh]):ah[sh]&&(ol*=ah[sh].scalar,ah[sh].numerator&&nl.push(ah[sh].numerator),ah[sh].denominator&&Zs.push(ah[sh].denominator));for(var Mh=0;Mh<fh.length;Mh++)sh=fh[Mh],Co[sh]?ol/=Co[sh]:ah[sh]&&(ol/=ah[sh].scalar,ah[sh].numerator&&Zs.push(ah[sh].numerator),ah[sh].denominator&&nl.push(ah[sh].denominator));return nl=nl.reduce(function(Uh,Nh){return Uh.concat(Nh)},[]),Zs=Zs.reduce(function(Uh,Nh){return Uh.concat(Nh)},[]),Yh({scalar:ol,numerator:nl,denominator:Zs})}Yh.parse=fd,Yh.getUnits=Sh,Yh.getAliases=$h,Yh.mulSafe=C,Yh.divSafe=P,Yh.getKinds=Xf,Yh.swiftConverter=Wd,Yh.Error=ze,x(Yh.prototype,{add:function(al){if(r(al)&&(al=Yh(al)),this.isCompatible(al)||Bt(this.units(),al.units()),this.isTemperature()&&al.isTemperature())throw new ze("Cannot add two temperatures");return this.isTemperature()?Ap(this,al):al.isTemperature()?Ap(al,this):Yh({scalar:this.scalar+al.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(al){if(r(al)&&(al=Yh(al)),this.isCompatible(al)||Bt(this.units(),al.units()),this.isTemperature()&&al.isTemperature())return Of(this,al);if(this.isTemperature())return jf(this,al);if(al.isTemperature())throw new ze("Cannot subtract a temperature from a differential degree unit");return Yh({scalar:this.scalar-al.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(al){if(a(al))return Yh({scalar:C(this.scalar,al),numerator:this.numerator,denominator:this.denominator});if(r(al)&&(al=Yh(al)),(this.isTemperature()||al.isTemperature())&&!(this.isUnitless()||al.isUnitless()))throw new ze("Cannot multiply by temperatures");var fh=this,nl=al;fh.isCompatible(nl)&&fh.signature!==400&&(nl=nl.to(fh));var Zs=lh(fh.numerator,fh.denominator,nl.numerator,nl.denominator);return Yh({scalar:C(fh.scalar,nl.scalar,Zs[2]),numerator:Zs[0],denominator:Zs[1]})},div:function(al){if(a(al)){if(al===0)throw new ze("Divide by zero");return Yh({scalar:this.scalar/al,numerator:this.numerator,denominator:this.denominator})}else r(al)&&(al=Yh(al));if(al.scalar===0)throw new ze("Divide by zero");if(al.isTemperature())throw new ze("Cannot divide with temperatures");if(this.isTemperature()&&!al.isUnitless())throw new ze("Cannot divide with temperatures");var fh=this,nl=al;fh.isCompatible(nl)&&fh.signature!==400&&(nl=nl.to(fh));var Zs=lh(fh.numerator,fh.denominator,nl.denominator,nl.numerator);return Yh({scalar:C(fh.scalar,Zs[2])/nl.scalar,numerator:Zs[0],denominator:Zs[1]})},inverse:function(){if(this.isTemperature())throw new ze("Cannot divide with temperatures");if(this.scalar===0)throw new ze("Divide by zero");return Yh({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function lh(al,fh,nl,Zs){function ol(Zd){return Zd!==Fn}al=al.filter(ol),nl=nl.filter(ol),fh=fh.filter(ol),Zs=Zs.filter(ol);var sh={};function xh(Zd,Fd){for(var Kf,up,ap,wp=0;wp<Zd.length;wp++)if(Co[Zd[wp]]?(Kf=Zd[wp+1],up=Zd[wp],ap=Co[up],wp++):(Kf=Zd[wp],up=null,ap=1),Kf&&Kf!==Fn)if(sh[Kf]){sh[Kf][0]+=Fd;var Hp=sh[Kf][2]?Co[sh[Kf][2]]:1;sh[Kf][Fd===1?3:4]*=P(ap,Hp)}else sh[Kf]=[Fd,Kf,up,1,1]}xh(al,1),xh(fh,-1),xh(nl,1),xh(Zs,-1);var Mh=[],Uh=[],Nh=1;for(var Zh in sh)if(sh.hasOwnProperty(Zh)){var td=sh[Zh],Ad;if(td[0]>0)for(Ad=0;Ad<td[0];Ad++)Mh.push(td[2]===null?td[1]:[td[2],td[1]]);else if(td[0]<0)for(Ad=0;Ad<-td[0];Ad++)Uh.push(td[2]===null?td[1]:[td[2],td[1]]);Nh*=P(td[3],td[4])}return Mh.length===0&&(Mh=tl),Uh.length===0&&(Uh=tl),Mh=Mh.reduce(function(Zd,Fd){return Zd.concat(Fd)},[]),Uh=Uh.reduce(function(Zd,Fd){return Zd.concat(Fd)},[]),[Mh,Uh,Nh]}x(Yh.prototype,{eq:function(al){return this.compareTo(al)===0},lt:function(al){return this.compareTo(al)===-1},lte:function(al){return this.eq(al)||this.lt(al)},gt:function(al){return this.compareTo(al)===1},gte:function(al){return this.eq(al)||this.gt(al)},compareTo:function(al){if(r(al))return this.compareTo(Yh(al));if(this.isCompatible(al)||Bt(this.units(),al.units()),this.baseScalar<al.baseScalar)return-1;if(this.baseScalar===al.baseScalar)return 0;if(this.baseScalar>al.baseScalar)return 1},same:function(al){return this.scalar===al.scalar&&this.units()===al.units()}}),x(Yh.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(al){return o(al,tl)})},isCompatible:function(al){return r(al)?this.isCompatible(Yh(al)):Jd(al)&&al.signature!==void 0?this.signature===al.signature:!1},isInverse:function(al){return this.inverse().isCompatible(al)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(al){al!==Fn&&_n.indexOf(al)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function ih(){}ih.prototype.get=function(al){return arguments.length>1&&(al=Array.apply(null,arguments)),al.reduce(function(fh,nl,Zs){if(fh){var ol=fh[nl];return Zs===al.length-1?ol?ol.data:void 0:ol}},this)},ih.prototype.set=function(al,fh){return arguments.length>2&&(al=Array.prototype.slice.call(arguments,0,-1),fh=arguments[arguments.length-1]),al.reduce(function(nl,Zs,ol){var sh=nl[Zs];return sh===void 0&&(sh=nl[Zs]={}),ol===al.length-1?(sh.data=fh,fh):sh},this)};function Ah(al,fh){return(al+" "+fh).trim()}Yh.formatter=Ah,x(Yh.prototype,{units:function(){if(this._units!==void 0)return this._units;var al=o(this.numerator,tl),fh=o(this.denominator,tl);if(al&&fh)return this._units="",this._units;var nl=Qh(this.numerator),Zs=Qh(this.denominator);return this._units=nl+(fh?"":"/"+Zs),this._units},toString:function(al,fh){var nl;if(a(al))nl=this.units(),fh=al;else if(r(al))nl=al;else if(Jd(al))return this.toPrec(al).toString(fh);var Zs=this.to(nl),ol=fh!==void 0?ge(Zs.scalar,fh):Zs.scalar;return Zs=(ol+" "+Zs.units()).trim(),Zs},format:function(al,fh){arguments.length===1&&typeof al=="function"&&(fh=al,al=void 0),fh=fh||Yh.formatter;var nl=this.to(al);return fh.call(this,nl.scalar,nl.units())}});var zh=new ih;function Qh(al){var fh=zh.get(al);if(fh)return fh;var nl=o(al,tl);return nl?fh="1":fh=Fh(Th(al)).join("*"),zh.set(al,fh),fh}function Th(al){for(var fh=[],nl,Zs,ol=0;ol<al.length;ol++)nl=al[ol],Zs=al[ol+1],Co[nl]?(fh.push(ju[nl]+ju[Zs]),ol++):fh.push(ju[nl]);return fh}function Fh(al){var fh=al.reduce(function(nl,Zs){var ol=nl[Zs];return ol||nl.push(ol=nl[Zs]=[Zs,0]),ol[1]++,nl},[]);return fh.map(function(nl){return nl[0]+(nl[1]>1?nl[1]:"")})}return Yh.version="1.7.6",Yh})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(e,t=""){let r=t.split(".");for(let n of r){if(e[n]===void 0)return;e=e[n]}return e}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(e,t,r){var n=e*t,a=SPLITTER*e,s=a-e,f=a-s,o=e-f,x=SPLITTER*t,C=x-t,P=x-C,ge=t-P,nt=n-f*P,ze=nt-o*P,Bt=ze-f*ge,qr=o*ge-Bt;return r?(r[0]=qr,r[1]=n,r):[qr,n]}var robustSum=linearExpansionSum;function scalarScalar$1(e,t){var r=e+t,n=r-e,a=r-n,s=t-n,f=e-a,o=f+s;return o?[o,r]:[r]}function linearExpansionSum(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return scalarScalar$1(e[0],t[0]);var a=r+n,s=new Array(a),f=0,o=0,x=0,C=Math.abs,P=e[o],ge=C(P),nt=t[x],ze=C(nt),Bt,qr;ge<ze?(qr=P,o+=1,o<r&&(P=e[o],ge=C(P))):(qr=nt,x+=1,x<n&&(nt=t[x],ze=C(nt))),o<r&&ge<ze||x>=n?(Bt=P,o+=1,o<r&&(P=e[o],ge=C(P))):(Bt=nt,x+=1,x<n&&(nt=t[x],ze=C(nt)));for(var _n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,Io=tl,Co=_n,rl,ah,ch,ju,Zu;o<r&&x<n;)ge<ze?(Bt=P,o+=1,o<r&&(P=e[o],ge=C(P))):(Bt=nt,x+=1,x<n&&(nt=t[x],ze=C(nt))),qr=Io,_n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,tl&&(s[f++]=tl),rl=Co+_n,ah=rl-Co,ch=rl-ah,ju=_n-ah,Zu=Co-ch,Io=Zu+ju,Co=rl;for(;o<r;)Bt=P,qr=Io,_n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,tl&&(s[f++]=tl),rl=Co+_n,ah=rl-Co,ch=rl-ah,ju=_n-ah,Zu=Co-ch,Io=Zu+ju,Co=rl,o+=1,o<r&&(P=e[o]);for(;x<n;)Bt=nt,qr=Io,_n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,tl&&(s[f++]=tl),rl=Co+_n,ah=rl-Co,ch=rl-ah,ju=_n-ah,Zu=Co-ch,Io=Zu+ju,Co=rl,x+=1,x<n&&(nt=t[x]);return Io&&(s[f++]=Io),Co&&(s[f++]=Co),f||(s[f++]=0),s.length=f,s}var twoSum$1=fastTwoSum;function fastTwoSum(e,t,r){var n=e+t,a=n-e,s=n-a,f=t-a,o=e-s;return r?(r[0]=o+f,r[1]=n,r):[o+f,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,t){var r=e.length;if(r===1){var n=twoProduct(e[0],t);return n[0]?n:[n[1]]}var a=new Array(2*r),s=[.1,.1],f=[.1,.1],o=0;twoProduct(e[0],t,s),s[0]&&(a[o++]=s[0]);for(var x=1;x<r;++x){twoProduct(e[x],t,f);var C=s[1];twoSum(C,f[0],s),s[0]&&(a[o++]=s[0]);var P=f[1],ge=s[1],nt=P+ge,ze=nt-P,Bt=ge-ze;s[1]=nt,Bt&&(a[o++]=Bt)}return s[1]&&(a[o++]=s[1]),o===0&&(a[o++]=0),a.length=o,a}var robustDiff=robustSubtract;function scalarScalar(e,t){var r=e+t,n=r-e,a=r-n,s=t-n,f=e-a,o=f+s;return o?[o,r]:[r]}function robustSubtract(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return scalarScalar(e[0],-t[0]);var a=r+n,s=new Array(a),f=0,o=0,x=0,C=Math.abs,P=e[o],ge=C(P),nt=-t[x],ze=C(nt),Bt,qr;ge<ze?(qr=P,o+=1,o<r&&(P=e[o],ge=C(P))):(qr=nt,x+=1,x<n&&(nt=-t[x],ze=C(nt))),o<r&&ge<ze||x>=n?(Bt=P,o+=1,o<r&&(P=e[o],ge=C(P))):(Bt=nt,x+=1,x<n&&(nt=-t[x],ze=C(nt)));for(var _n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,Io=tl,Co=_n,rl,ah,ch,ju,Zu;o<r&&x<n;)ge<ze?(Bt=P,o+=1,o<r&&(P=e[o],ge=C(P))):(Bt=nt,x+=1,x<n&&(nt=-t[x],ze=C(nt))),qr=Io,_n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,tl&&(s[f++]=tl),rl=Co+_n,ah=rl-Co,ch=rl-ah,ju=_n-ah,Zu=Co-ch,Io=Zu+ju,Co=rl;for(;o<r;)Bt=P,qr=Io,_n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,tl&&(s[f++]=tl),rl=Co+_n,ah=rl-Co,ch=rl-ah,ju=_n-ah,Zu=Co-ch,Io=Zu+ju,Co=rl,o+=1,o<r&&(P=e[o]);for(;x<n;)Bt=nt,qr=Io,_n=Bt+qr,Fn=_n-Bt,tl=qr-Fn,tl&&(s[f++]=tl),rl=Co+_n,ah=rl-Co,ch=rl-ah,ju=_n-ah,Zu=Co-ch,Io=Zu+ju,Co=rl,x+=1,x<n&&(nt=-t[x]);return Io&&(s[f++]=Io),Co&&(s[f++]=Co),f||(s[f++]=0),s.length=f,s}(function(e){var t=twoProduct_1,r=robustSum,n=robustScale,a=robustDiff,s=5,f=11102230246251565e-32,o=(3+16*f)*f,x=(7+56*f)*f;function C(Io,Co,rl,ah){return function(ju,Zu,sl){var oh=Io(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0]))),hh=Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),Sh=ah(oh,hh);return Sh[Sh.length-1]}}function P(Io,Co,rl,ah){return function(ju,Zu,sl,oh){var hh=Io(Io(rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),Zu[2]),Io(rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),-sl[2]),rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),oh[2]))),Io(rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),oh[2])))),Sh=Io(Io(rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),ju[2]),Io(rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),-sl[2]),rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),oh[2]))),Io(rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),sl[2])))),$h=ah(hh,Sh);return $h[$h.length-1]}}function ge(Io,Co,rl,ah){return function(ju,Zu,sl,oh,hh){var Sh=Io(Io(Io(rl(Io(rl(Io(Co(oh[1],hh[0]),Co(-hh[1],oh[0])),sl[2]),Io(rl(Io(Co(sl[1],hh[0]),Co(-hh[1],sl[0])),-oh[2]),rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),hh[2]))),Zu[3]),Io(rl(Io(rl(Io(Co(oh[1],hh[0]),Co(-hh[1],oh[0])),Zu[2]),Io(rl(Io(Co(Zu[1],hh[0]),Co(-hh[1],Zu[0])),-oh[2]),rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),hh[2]))),-sl[3]),rl(Io(rl(Io(Co(sl[1],hh[0]),Co(-hh[1],sl[0])),Zu[2]),Io(rl(Io(Co(Zu[1],hh[0]),Co(-hh[1],Zu[0])),-sl[2]),rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),hh[2]))),oh[3]))),Io(rl(Io(rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),Zu[2]),Io(rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),-sl[2]),rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),oh[2]))),-hh[3]),Io(rl(Io(rl(Io(Co(oh[1],hh[0]),Co(-hh[1],oh[0])),Zu[2]),Io(rl(Io(Co(Zu[1],hh[0]),Co(-hh[1],Zu[0])),-oh[2]),rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),hh[2]))),ju[3]),rl(Io(rl(Io(Co(oh[1],hh[0]),Co(-hh[1],oh[0])),ju[2]),Io(rl(Io(Co(ju[1],hh[0]),Co(-hh[1],ju[0])),-oh[2]),rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),hh[2]))),-Zu[3])))),Io(Io(rl(Io(rl(Io(Co(Zu[1],hh[0]),Co(-hh[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],hh[0]),Co(-hh[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),hh[2]))),oh[3]),Io(rl(Io(rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),oh[2]))),-hh[3]),rl(Io(rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),Zu[2]),Io(rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),-sl[2]),rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),oh[2]))),ju[3]))),Io(rl(Io(rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),ju[2]),Io(rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),-sl[2]),rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),oh[2]))),-Zu[3]),Io(rl(Io(rl(Io(Co(Zu[1],oh[0]),Co(-oh[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),oh[2]))),sl[3]),rl(Io(rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),sl[2]))),-oh[3]))))),$h=Io(Io(Io(rl(Io(rl(Io(Co(oh[1],hh[0]),Co(-hh[1],oh[0])),sl[2]),Io(rl(Io(Co(sl[1],hh[0]),Co(-hh[1],sl[0])),-oh[2]),rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),hh[2]))),ju[3]),rl(Io(rl(Io(Co(oh[1],hh[0]),Co(-hh[1],oh[0])),ju[2]),Io(rl(Io(Co(ju[1],hh[0]),Co(-hh[1],ju[0])),-oh[2]),rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),hh[2]))),-sl[3])),Io(rl(Io(rl(Io(Co(sl[1],hh[0]),Co(-hh[1],sl[0])),ju[2]),Io(rl(Io(Co(ju[1],hh[0]),Co(-hh[1],ju[0])),-sl[2]),rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),hh[2]))),oh[3]),rl(Io(rl(Io(Co(sl[1],oh[0]),Co(-oh[1],sl[0])),ju[2]),Io(rl(Io(Co(ju[1],oh[0]),Co(-oh[1],ju[0])),-sl[2]),rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),oh[2]))),-hh[3]))),Io(Io(rl(Io(rl(Io(Co(sl[1],hh[0]),Co(-hh[1],sl[0])),Zu[2]),Io(rl(Io(Co(Zu[1],hh[0]),Co(-hh[1],Zu[0])),-sl[2]),rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),hh[2]))),ju[3]),rl(Io(rl(Io(Co(sl[1],hh[0]),Co(-hh[1],sl[0])),ju[2]),Io(rl(Io(Co(ju[1],hh[0]),Co(-hh[1],ju[0])),-sl[2]),rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),hh[2]))),-Zu[3])),Io(rl(Io(rl(Io(Co(Zu[1],hh[0]),Co(-hh[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],hh[0]),Co(-hh[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),hh[2]))),sl[3]),rl(Io(rl(Io(Co(Zu[1],sl[0]),Co(-sl[1],Zu[0])),ju[2]),Io(rl(Io(Co(ju[1],sl[0]),Co(-sl[1],ju[0])),-Zu[2]),rl(Io(Co(ju[1],Zu[0]),Co(-Zu[1],ju[0])),sl[2]))),-hh[3])))),hd=ah(Sh,$h);return hd[hd.length-1]}}function nt(Io){var Co=Io===3?C:Io===4?P:ge;return Co(r,t,n,a)}var ze=nt(3),Bt=nt(4),qr=[function(){return 0},function(){return 0},function(Co,rl){return rl[0]-Co[0]},function(Co,rl,ah){var ch=(Co[1]-ah[1])*(rl[0]-ah[0]),ju=(Co[0]-ah[0])*(rl[1]-ah[1]),Zu=ch-ju,sl;if(ch>0){if(ju<=0)return Zu;sl=ch+ju}else if(ch<0){if(ju>=0)return Zu;sl=-(ch+ju)}else return Zu;var oh=o*sl;return Zu>=oh||Zu<=-oh?Zu:ze(Co,rl,ah)},function(Co,rl,ah,ch){var ju=Co[0]-ch[0],Zu=rl[0]-ch[0],sl=ah[0]-ch[0],oh=Co[1]-ch[1],hh=rl[1]-ch[1],Sh=ah[1]-ch[1],$h=Co[2]-ch[2],hd=rl[2]-ch[2],vd=ah[2]-ch[2],Ef=Zu*Sh,Cd=sl*hh,Cf=sl*oh,Sd=ju*Sh,yd=ju*hh,Hd=Zu*oh,xd=$h*(Ef-Cd)+hd*(Cf-Sd)+vd*(yd-Hd),Pd=(Math.abs(Ef)+Math.abs(Cd))*Math.abs($h)+(Math.abs(Cf)+Math.abs(Sd))*Math.abs(hd)+(Math.abs(yd)+Math.abs(Hd))*Math.abs(vd),zd=x*Pd;return xd>zd||-xd>zd?xd:Bt(Co,rl,ah,ch)}];function _n(Io){var Co=qr[Io.length];return Co||(Co=qr[Io.length]=nt(Io.length)),Co.apply(void 0,Io)}function Fn(Io,Co,rl,ah,ch,ju,Zu){return function(oh,hh,Sh,$h,hd){switch(arguments.length){case 0:case 1:return 0;case 2:return ah(oh,hh);case 3:return ch(oh,hh,Sh);case 4:return ju(oh,hh,Sh,$h);case 5:return Zu(oh,hh,Sh,$h,hd)}for(var vd=new Array(arguments.length),Ef=0;Ef<arguments.length;++Ef)vd[Ef]=arguments[Ef];return Io(vd)}}function tl(){for(;qr.length<=s;)qr.push(nt(qr.length));e.exports=Fn.apply(void 0,[_n].concat(qr));for(var Io=0;Io<=s;++Io)e.exports[Io]=qr[Io]}tl()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(e,t){for(var r=t[0],n=t[1],a=e.length,s=1,f=a,o=0,x=a-1;o<f;x=o++){var C=e[o],P=e[x],ge=C[1],nt=P[1];if(nt<ge){if(nt<n&&n<ge){var ze=orient(C,P,t);if(ze===0)return 0;s^=0<ze|0}else if(n===ge){var Bt=e[(o+1)%a],qr=Bt[1];if(ge<qr){var ze=orient(C,P,t);if(ze===0)return 0;s^=0<ze|0}}}else if(ge<nt){if(ge<n&&n<nt){var ze=orient(C,P,t);if(ze===0)return 0;s^=ze<0|0}else if(n===ge){var Bt=e[(o+1)%a],qr=Bt[1];if(qr<ge){var ze=orient(C,P,t);if(ze===0)return 0;s^=ze<0|0}}}else if(n===ge){var _n=Math.min(C[0],P[0]),Fn=Math.max(C[0],P[0]);if(o===0){for(;x>0;){var tl=(x+a-1)%a,Io=e[tl];if(Io[1]!==n)break;var Co=Io[0];_n=Math.min(_n,Co),Fn=Math.max(Fn,Co),x=tl}if(x===0)return _n<=r&&r<=Fn?0:1;f=x+1}for(var rl=e[(x+a-1)%a][1];o+1<f;){var Io=e[o+1];if(Io[1]!==n)break;var Co=Io[0];_n=Math.min(_n,Co),Fn=Math.max(Fn,Co),o+=1}if(_n<=r&&r<=Fn)return 0;var ah=e[(o+1)%a][1];r<_n&&rl<n!=ah<n&&(s^=1)}}return 2*s-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const r=new Array(t.length);let n=1/0,a=0,s=[];for(let C=0;C<t.length;C++){let P=getAngle(t[C],t[(C+1)%t.length]);rotate(-P,t,r);let ge=0,nt=[];for(let ze=0;ze<t.length;ze++){let Bt=Math.abs(r[C][1]-r[ze][1]);Bt>ge&&(ge=Bt,nt=[],nt.push([r[ze][0],r[C][1]],[r[ze][0],r[ze][1]]))}ge<n&&(n=ge,a=P,s=nt)}rotate(a,s,s);let f=0,o=[],x=0;for(let C=0;C<t.length-1;C++)for(let P=C+1;P<t.length;P++){let ge=(t[C][0]-t[P][0])**2+(t[C][1]-t[P][1])**2;ge>x&&(x=ge,f=Math.sqrt(ge),o=[t[C],t[P]])}return{min:n,minLine:s,max:f,maxLine:o,aspectRatio:n/f}}function getAngle(e,t){let r=difference(t,e),n=normalize(r),a=Math.acos(n[0]);return n[1]<0?-a:a}class Roi{constructor(t,r){this.map=t,this.id=r,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:r=1,kind:n=""}=t;let a;switch(n){case"contour":a=this.contourMask;break;case"box":a=this.boxMask;break;case"filled":a=this.filledMask;break;case"center":a=this.centerMask;break;case"mbr":a=this.mbrFilledMask;break;case"hull":a=this.convexHullFilledMask;break;case"hullContour":a=this.convexHullMask;break;case"mbrContour":a=this.mbrMask;break;case"feret":a=this.feretMask;break;default:a=this.mask}return r<1&&(a=a.resize({factor:r}),a.parent=this.mask.parent,a.position[0]+=this.minX,a.position[1]+=this.minY),a}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,r=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let a=0;a<t.length;a++)n.includes(t[a])||(this.computed.externalIDs.push(t[a]),this.computed.externalLengths.push(r[a]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&n>0&&n<this.height-1?(this.map.data[r-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(r,n):t.setBitXY(r,n));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)t.setBitXY(r,0),t.setBitXY(r,this.height-1);for(let r=0;r<this.height;r++)t.setBitXY(0,r),t.setBitXY(this.width-1,r);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&t.setBitXY(r,n);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++){let a=r+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[a])&&t.setBitXY(r,n)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.map.data[n+this.minX+(a+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&a>0&&a<this.height-1?(this.map.data[n-1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a+1+this.minY)*this.map.width]!==this.id)&&(t.push([n,a]),t.push([n+1,a]),t.push([n,a+1]),t.push([n+1,a+1])):(t.push([n,a]),t.push([n+1,a]),t.push([n,a+1]),t.push([n+1,a+1])));const r=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:r,surface:surface(r),perimeter:perimeter(r)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,r=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=r}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(t.polyline,[n,a])!==1&&r.setBitXY(n,a);this.computed.convexHullFilledMask=r}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let r=t[0],n=t[1],a=t[2],s=Math.sqrt((r[0]-n[0])**2+(r[1]-n[1])**2),f=Math.sqrt((a[0]-n[0])**2+(a[1]-n[1])**2);this.computed.mbr={width:s,height:f,elongation:1-s/f,aspectRatio:s/f,surface:s*f,perimeter:(s+f)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,r=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-r*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const r=minMax(t),n=new Image$1(r[1][0]-r[0][0]+1,r[1][1]-r[0][1]+1,{kind:BINARY,position:[this.minX+r[0][0],this.minY+r[0][1]],parent:this.map.parent});t=moveToZeroZero(t),n.paintPolyline(t,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),r=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(r,[n,a])!==1&&t.setBitXY(n,a);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let a=(r+this.minY)*this.map.width+n+this.minX;this.map.data[a]===this.id&&t.push([n,r])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,r;const n=this.points;for(let a=0;a<n.length;a++)for(let s=a+1;s<n.length;s++){let f=Math.pow(n[a][0]-n[s][0],2)+Math.pow(n[a][1]-n[s][1],2);f>=t&&(t=f,r=[n[a],n[s]])}this.computed.maxLengthPoints=r}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,r=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=r}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let t=e.map,r=t.data,n=new Set,a=new Map,s=new Set,f=[1,0,-1,0],o=[0,1,0,-1];for(let P=e.minX;P<=e.maxX;P++)for(let ge=e.minY;ge<=e.maxY;ge++){let nt=P+ge*t.width;if(r[nt]===e.id)for(let ze=0;ze<4;ze++){let Bt=P+f[ze],qr=ge+o[ze];if(Bt>=0&&qr>=0&&Bt<t.width&&qr<t.height){let _n=Bt+qr*t.width;if(r[_n]!==e.id&&!s.has(_n)){s.add(_n),n.add(r[_n]);let Fn=a.get(r[_n]);Fn?a.set(r[_n],++Fn):a.set(r[_n],1)}}}}let x=Array.from(n),C=x.map(function(P){return a.get(P)});return{ids:x,lengths:C}}function getBoxIDs(e){let t=new Set,r=e.map,n=r.data;for(let a of[0,e.height-1])for(let s=0;s<e.width;s++){let f=(a+e.minY)*r.width+s+e.minX;if(s-e.minX>0&&n[f]===e.id&&n[f-1]!==e.id){let o=n[f-1];t.add(o)}if(r.width-s-e.minX>1&&n[f]===e.id&&n[f+1]!==e.id){let o=n[f+1];t.add(o)}}for(let a of[0,e.width-1])for(let s=0;s<e.height;s++){let f=(s+e.minY)*r.width+a+e.minX;if(s-e.minY>0&&n[f]===e.id&&n[f-r.width]!==e.id){let o=n[f-r.width];t.add(o)}if(r.height-s-e.minY>1&&n[f]===e.id&&n[f+r.width]!==e.id){let o=n[f+r.width];t.add(o)}}return Array.from(t)}function getBox(e){let t=0,r=e.map,n=r.data,a=[0];e.height>1&&(a[1]=e.height-1);for(let f of a)for(let o=1;o<e.width-1;o++){let x=(f+e.minY)*r.width+o+e.minX;n[x]===e.id&&t++}let s=[0];e.width>1&&(s[1]=e.width-1);for(let f of s)for(let o=0;o<e.height;o++){let x=(o+e.minY)*r.width+f+e.minX;n[x]===e.id&&t++}return t}function getBorder(e){let t=0,r=e.map,n=r.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let f=(s+e.minY)*r.width+a+e.minX;n[f]===e.id&&(n[f-1]!==e.id||n[f+1]!==e.id||n[f-r.width]!==e.id||n[f+r.width]!==e.id)&&t++}return t+e.box}function getPerimeterInfo(e){let t=e.map,r=t.data,n=0,a=0,s=0,f=0;for(let o=0;o<e.width;o++)for(let x=0;x<e.height;x++){let C=(x+e.minY)*t.width+o+e.minX;if(r[C]===e.id){let P=0;switch((o===0||e.externalIDs.includes(r[C-1]))&&P++,(o===e.width-1||e.externalIDs.includes(r[C+1]))&&P++,(x===0||e.externalIDs.includes(r[C-t.width]))&&P++,(x===e.height-1||e.externalIDs.includes(r[C+t.width]))&&P++,P){case 1:n++;break;case 2:a++;break;case 3:s++;break;case 4:f++;break}}}return{one:n,two:a,three:s,four:f}}function getExternal(e){let t=0,r=e.map,n=r.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let f=(s+e.minY)*r.width+a+e.minX;n[f]===e.id&&(e.externalIDs.includes(n[f-1])||e.externalIDs.includes(n[f+1])||e.externalIDs.includes(n[f-r.width])||e.externalIDs.includes(n[f+r.width]))&&t++}return t+e.box}function getHolesInfo(e){let t=0,r=e.map.width,n=e.map.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let f=(s+e.minY)*r+a+e.minX;e.internalIDs.includes(n[f])&&n[f]!==e.id&&t++}return{number:e.internalIDs.length-1,surface:t}}function getInternalIDs(e){let t=[e.id],r=e.map,n=r.data;if(e.height>2)for(let s=0;s<e.width;s++){let f=e.minY*r.width+s+e.minX;if(t.includes(n[f])){let o=n[f+r.width];!t.includes(o)&&!e.boxIDs.includes(o)&&t.push(o)}}let a=new Array(4);for(let s=1;s<e.width-1;s++)for(let f=1;f<e.height-1;f++){let o=(f+e.minY)*r.width+s+e.minX;if(t.includes(n[o])){a[0]=n[o-1],a[1]=n[o+1],a[2]=n[o-r.width],a[3]=n[o+r.width];for(let x=0;x<4;x++){let C=a[x];!t.includes(C)&&!e.boxIDs.includes(C)&&t.push(C)}}}return t}class RoiLayer{constructor(t,r){this.roiMap=t,this.options=r,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,r={};this.roiMap.positive=0,this.roiMap.negative=0;for(let o=0;o<t.length;o++)t[o]&&!r[t[o]]&&(r[t[o]]=!0,t[o]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let o in r)n[o]=new Roi(this.roiMap,o*1);let a=this.roiMap.width,s=this.roiMap.height;for(let o=0;o<s;o++)for(let x=0;x<a;x++){let C=o*a+x;if(t[C]!==0){const P=t[C],ge=n[P];x<ge.minX&&(ge.minX=x),x>ge.maxX&&(ge.maxX=x),o<ge.minY&&(ge.minY=o),o>ge.maxY&&(ge.maxY=o),ge.meanX+=x,ge.meanY+=o,ge.surface++}}let f=[];for(let o in r)n[o].meanX/=n[o].surface,n[o].meanY/=n[o].surface,f.push(n[o]);return f}}function commonBorderLength(e){let t=e.data,r=[1,0,-1,0],n=[0,1,0,-1],a=e.minMax,s=-a.min,f=a.max+s,o=[];for(let C=0;C<=f;C++)o.push(Object.create(null));for(let C=0;C<e.width;C++)for(let P=0;P<e.height;P++){let ge=C+P*e.width,nt=t[ge];if(nt!==0){let ze=Object.create(null),Bt=!1;for(let qr=0;qr<4;qr++){let _n=C+r[qr],Fn=P+n[qr];if(_n>=0&&Fn>=0&&_n<e.width&&Fn<e.height){let tl=t[_n+Fn*e.width];nt!==tl&&(Bt=!0,tl!==0&&ze[tl]===void 0&&(ze[tl]=!0,o[tl+s][nt]?o[tl+s][nt]++:o[tl+s][nt]=1))}else Bt=!0}Bt&&(o[nt+s][nt]?o[nt+s][nt]++:o[nt+s][nt]=1)}}let x={};for(let C=0;C<o.length;C++)Object.keys(o[C]).length>0&&(x[C-s]=o[C]);return x}function mergeRoi(e={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:r=5,maxCommonBorderLength:n=100,minCommonBorderRatio:a=.3,maxCommonBorderRatio:s=1}=e;let f=function(_n,Fn,tl){return _n[tl]>=r&&_n[tl]<=n};typeof t=="function"&&(f=t),t.toLowerCase()==="commonborderratio"&&(f=function(_n,Fn,tl){let Io=Math.min(_n[tl]/_n[Fn],1);return Io>=a&&Io<=s});const o=this,x=o.commonBorderLength;let C={},P={};for(let _n of Object.keys(x)){let Fn=x[_n],tl=Object.keys(Fn);for(let Io of tl)if(Io!==_n&&f(Fn,_n,Io)){let Co=Io;P[Io]&&(Co=P[Io]);let rl=_n;if(P[_n]&&(rl=P[_n]),Number(Co)!==rl){let ah=Math.min(Co,rl),ch=Math.max(Co,rl);if(C[ah]||(C[ah]={}),C[ah][ch]=!0,P[ch]=ah,C[ch]){for(let ju of Object.keys(C[ch]))C[ah][ju]=!0,P[ju]=ah;delete C[ch]}}}}let ge=o.minMax,nt=-ge.min,ze=ge.max+nt,Bt=new Array(ze+1).fill(0);for(let _n of Object.keys(P))Bt[Number(_n)+nt]=P[_n];let qr=o.data;for(let _n=0;_n<qr.length;_n++){let Fn=qr[_n];if(Fn!==0){let tl=Bt[Fn+nt];tl!==0&&(qr[_n]=tl)}}return o.computed={},o}class RoiMap{constructor(t,r){this.parent=t,this.width=t.width,this.height=t.height,this.data=r,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<t&&(t=this.data[n]),this.data[n]>r&&(r=this.data[n]);return{min:t,max:r}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const r=t[0],n=t.slice(1);for(let a=0;a<this.data.length;a++)n.includes(this.data[a])&&(this.data[a]=r)}rowsInfo(){let t=new Array(this.height),r=0;for(let n=0;n<this.data.length;n+=this.width){let a={row:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[r++]=a;let s={},f={},o=[],x=this.data[n],C=0;for(let P=n;P<n+this.width;P++){let ge=this.data[P];x!==ge&&(x=ge,o.push(C),C=0),C++,ge>0?(a.positivePixel++,s[ge]||(s[ge]=!0)):ge<0?(a.negativePixel++,f[ge]||(f[ge]=!0)):a.zeroPixel++}o.push(C),a.medianChange=o.sort((P,ge)=>P-ge)[Math.floor(o.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(f),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),r=0;for(let n=0;n<this.width;n++){let a={col:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[r++]=a;let s={},f={},o=[],x=this.data[n],C=0;for(let P=n;P<n+this.data.length;P+=this.width){let ge=this.data[P];x!==ge&&(x=ge,o.push(C),C=0),C++,ge>0?(a.positivePixel++,s[ge]||(s[ge]=!0)):ge<0?(a.negativePixel++,f[ge]||(f[ge]=!0)):a.zeroPixel++}o.push(C),a.medianChange=o.sort((P,ge)=>P-ge)[Math.floor(o.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(f),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return t}}function fromMask(e,t={}){const{allowCorners:r=!1}=t,n=65535;let a=new Int16Array(e.size),s=0,f=0,o=new Uint16Array(n+1),x=new Uint16Array(n+1);for(let P=0;P<e.width;P++)for(let ge=0;ge<e.height;ge++)a[ge*e.width+P]===0&&C(P,ge);function C(P,ge){let nt=0,ze=0,Bt=e.getBitXY(P,ge),qr=Bt?++s:--f;if(s>32767||f<-32768)throw new Error("Too many regions of interest");for(o[0]=P,x[0]=ge;nt<=ze;){let _n=o[nt&n],Fn=x[nt&n];if(a[Fn*e.width+_n]=qr,_n>0&&a[Fn*e.width+_n-1]===0&&e.getBitXY(_n-1,Fn)===Bt&&(ze++,o[ze&n]=_n-1,x[ze&n]=Fn,a[Fn*e.width+_n-1]=-32768),Fn>0&&a[(Fn-1)*e.width+_n]===0&&e.getBitXY(_n,Fn-1)===Bt&&(ze++,o[ze&n]=_n,x[ze&n]=Fn-1,a[(Fn-1)*e.width+_n]=-32768),_n<e.width-1&&a[Fn*e.width+_n+1]===0&&e.getBitXY(_n+1,Fn)===Bt&&(ze++,o[ze&n]=_n+1,x[ze&n]=Fn,a[Fn*e.width+_n+1]=-32768),Fn<e.height-1&&a[(Fn+1)*e.width+_n]===0&&e.getBitXY(_n,Fn+1)===Bt&&(ze++,o[ze&n]=_n,x[ze&n]=Fn+1,a[(Fn+1)*e.width+_n]=-32768),r&&(_n>0&&Fn>0&&a[(Fn-1)*e.width+_n-1]===0&&e.getBitXY(_n-1,Fn-1)===Bt&&(ze++,o[ze&n]=_n-1,x[ze&n]=Fn-1,a[(Fn-1)*e.width+_n-1]=-32768),_n<e.width-1&&Fn>0&&a[(Fn-1)*e.width+_n+1]===0&&e.getBitXY(_n+1,Fn-1)===Bt&&(ze++,o[ze&n]=_n+1,x[ze&n]=Fn-1,a[(Fn-1)*e.width+_n+1]=-32768),_n>0&&Fn<e.height-1&&a[(Fn+1)*e.width+_n-1]===0&&e.getBitXY(_n-1,Fn+1)===Bt&&(ze++,o[ze&n]=_n-1,x[ze&n]=Fn+1,a[(Fn+1)*e.width+_n-1]=-32768),_n<e.width-1&&Fn<e.height-1&&a[(Fn+1)*e.width+_n+1]===0&&e.getBitXY(_n+1,Fn+1)===Bt&&(ze++,o[ze&n]=_n+1,x[ze&n]=Fn+1,a[(Fn+1)*e.width+_n+1]=-32768)),nt++,ze-nt>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,a)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var r=this.nodes.get(t);return r||(r=new DisjointSetNode(t),this.nodes.set(t,r)),r}union(t,r){const n=this.find(t),a=this.find(r);n!==a&&(n.rank<a.rank?n.parent=a:n.rank>a.rank?a.parent=n:(a.parent=n,n.rank++))}find(t){for(var r=t;r.parent!==null;)r=r.parent;for(var n=t;n.parent!==null;){var a=n;n=n.parent,a.parent=r}return r}connected(t,r){return this.find(t)===this.find(r)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(e){this.value=e,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,t={}){const{allowCorners:r=!1}=t;let n=4;r&&(n=8);let a,s,f;if(n===8)a=direction8X,s=direction8Y,f=neighbours8;else if(n===4)a=direction4X,s=direction4Y,f=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const o=e.size,x=e.width,C=e.height,P=new Array(o),ge=new Uint32Array(o),nt=new DisjointSet$1;let ze=1;for(let Bt=0;Bt<C;Bt++)for(let qr=0;qr<x;qr++){const _n=qr+Bt*x;if(e.getBit(_n)){let Fn=null;for(let tl=0;tl<f.length;tl++){const Io=qr+a[tl],Co=Bt+s[tl];if(Io>=0&&Co>=0&&Io<x&&Co<C){const rl=Io+Co*x;let ah=P[rl];ah?(f[tl]=ah,(!Fn||f[tl].value<Fn.value)&&(Fn=f[tl])):f[tl]=null}}if(!Fn)P[_n]=nt.add(ze++);else{P[_n]=Fn;for(let tl=0;tl<f.length;tl++)f[tl]&&f[tl]!==Fn&&nt.union(Fn,f[tl])}}}for(let Bt=0;Bt<C;Bt++)for(let qr=0;qr<x;qr++){const _n=qr+Bt*x;e.getBit(_n)&&(ge[_n]=nt.find(P[_n]).value)}return new RoiMap(e,ge)}function fromMaxima(e={}){let{allowCorner:t=!0,onlyTop:r=!1,invert:n=!1}=e,a=this;a.checkProcessable("fromMaxima",{components:[1]});const s=1,f=2;let o=0,x=0,C=new Int16Array(a.size),P=new Int8Array(a.size),ge=new Float32Array(a.size),nt=1048575,ze=new Uint16Array(nt+1),Bt=new Uint16Array(nt+1),qr=0,_n=0,Fn=new Uint16Array(nt+1),tl=new Uint16Array(nt+1),Io=0,Co=0;for(rl(a);qr<_n;){let ju=ze[qr&nt],Zu=Bt[qr&nt];ch(ju,Zu,f),qr++}return new RoiMap(a,C);function rl({maxima:ju=!0}){for(let Zu=1;Zu<a.height-1;Zu++)for(let sl=1;sl<a.width-1;sl++){let oh=sl+Zu*a.width;if(P[oh]===0){let hh=ju?a.data[oh]:-a.data[sl+Zu*a.width];if(a.data[Zu*a.width+sl-1]>hh||a.data[Zu*a.width+sl+1]>hh||a.data[(Zu-1)*a.width+sl]>hh||a.data[(Zu+1)*a.width+sl]>hh||t&&(a.data[(Zu-1)*a.width+sl-1]>hh||a.data[(Zu-1)*a.width+sl+1]>hh||a.data[(Zu+1)*a.width+sl-1]>hh||a.data[(Zu+1)*a.width+sl+1]>hh))continue;C[oh]=ju?++o:--x,ah(sl,Zu)||(ju?--o:++x)}}}function ah(ju,Zu){let sl=_n;Io=0,Co=1,Fn[0]=ju,tl[0]=Zu;let oh=!0;for(;Io<Co;){let hh=Fn[Io&nt],Sh=tl[Io&nt];oh&=ch(hh,Sh,s),Io++}if(!oh){for(let hh=0;hh<Co;hh++){let Sh=Fn[hh&nt],hd=tl[hh&nt]*a.width+Sh;C[hd]=0}_n=sl}return oh}function ch(ju,Zu,sl){let oh=C[Zu*a.width+ju],hh=a.data[Zu*a.width+ju];for(let Sh=Zu-1;Sh<=Zu+1;Sh++)for(let $h=ju-1;$h<=ju+1;$h++){let hd=Sh*a.width+$h;if(P[hd]===0)switch(P[hd]=1,ge[hd]=a.data[hd]-hh,sl){case s:if(ge[hd]===0){if($h===0||Sh===0||$h===a.width-1||Sh===a.height-1)return!1;C[hd]=oh,Fn[Co&nt]=$h,tl[Co&nt]=Sh,Co++}else{if(ge[hd]>0)return!1;r||(C[hd]=oh,ze[_n&nt]=$h,Bt[_n&nt]=Sh,_n++)}break;case f:ge[hd]<=0&&(C[hd]=oh,ze[_n&nt]=$h,Bt[_n&nt]=Sh,_n++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,t={}){let r=new Shape(t),n=new Int16Array(this.size),a=0,s=r.getPoints();for(let f=0;f<e.length;f++){a++;let o=e[f][0],x=e[f][1];for(let C=0;C<s.length;C++){let P=s[C][0],ge=s[C][1];o+P>=0&&x+ge>=0&&o+P<this.width&&x+ge<this.height&&(n[o+P+(x+ge)*this.width]=a)}}return new RoiMap(this,n)}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,a,s){function f(C,P){if(!a[C]){if(!n[C]){var ge=typeof commonjsRequire=="function"&&commonjsRequire;if(!P&&ge)return ge(C,!0);if(o)return o(C,!0);var nt=new Error("Cannot find module '"+C+"'");throw nt.code="MODULE_NOT_FOUND",nt}var ze=a[C]={exports:{}};n[C][0].call(ze.exports,function(Bt){var qr=n[C][1][Bt];return f(qr||Bt)},ze,ze.exports,r,n,a,s)}return a[C].exports}for(var o=typeof commonjsRequire=="function"&&commonjsRequire,x=0;x<s.length;x++)f(s[x]);return f}({1:[function(r,n,a){var s,f,o,x,C,P=function(nt,ze){for(var Bt in ze)ge.call(ze,Bt)&&(nt[Bt]=ze[Bt]);function qr(){this.constructor=nt}return qr.prototype=ze.prototype,nt.prototype=new qr,nt.__super__=ze.prototype,nt},ge={}.hasOwnProperty;s=r("./PriorityQueue/AbstractPriorityQueue"),f=r("./PriorityQueue/ArrayStrategy"),x=r("./PriorityQueue/BinaryHeapStrategy"),o=r("./PriorityQueue/BHeapStrategy"),C=function(nt){P(ze,nt);function ze(Bt){Bt||(Bt={}),Bt.strategy||(Bt.strategy=x),Bt.comparator||(Bt.comparator=function(qr,_n){return(qr||0)-(_n||0)}),ze.__super__.constructor.call(this,Bt)}return ze}(s),C.ArrayStrategy=f,C.BinaryHeapStrategy=x,C.BHeapStrategy=o,n.exports=C},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(r,n,a){n.exports=function(){function s(f){var o;if(f?.strategy==null)throw"Must pass options.strategy, a strategy";if(f?.comparator==null)throw"Must pass options.comparator, a comparator";this.priv=new f.strategy(f),this.length=(f!=null&&(o=f.initialValues)!=null?o.length:void 0)||0}return s.prototype.queue=function(f){this.length++,this.priv.queue(f)},s.prototype.dequeue=function(f){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(f){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(r,n,a){var s;s=function(f,o,x){var C,P,ge;for(P=0,C=f.length;P<C;)ge=P+C>>>1,x(f[ge],o)>=0?P=ge+1:C=ge;return P},n.exports=function(){function f(o){var x;this.options=o,this.comparator=this.options.comparator,this.data=((x=this.options.initialValues)!=null?x.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return f.prototype.queue=function(o){var x;x=s(this.data,o,this.comparator),this.data.splice(x,0,o)},f.prototype.dequeue=function(){return this.data.pop()},f.prototype.peek=function(){return this.data[this.data.length-1]},f.prototype.clear=function(){this.data.length=0},f}()},{}],4:[function(r,n,a){n.exports=function(){function s(f){var o,x,C,P,ge,nt,ze,Bt;for(this.comparator=f?.comparator||function(qr,_n){return qr-_n},this.pageSize=f?.pageSize||512,this.length=0,ze=0;1<<ze<this.pageSize;)ze+=1;if(1<<ze!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=ze,this._emptyMemoryPageTemplate=o=[],x=0,ge=this.pageSize;0<=ge?x<ge:x>ge;0<=ge?++x:--x)o.push(null);if(this._memory=[],this._mask=this.pageSize-1,f.initialValues)for(nt=f.initialValues,C=0,P=nt.length;C<P;C++)Bt=nt[C],this.queue(Bt)}return s.prototype.queue=function(f){this.length+=1,this._write(this.length,f),this._bubbleUp(this.length,f)},s.prototype.dequeue=function(){var f,o;return f=this._read(1),o=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,o),this._bubbleDown(1,o)),f},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(f,o){var x;for(x=f>>this._shift;x>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[x][f&this._mask]=o},s.prototype._read=function(f){return this._memory[f>>this._shift][f&this._mask]},s.prototype._bubbleUp=function(f,o){var x,C,P,ge;for(x=this.comparator;f>1&&(C=f&this._mask,f<this.pageSize||C>3?P=f&~this._mask|C>>1:C<2?(P=f-this.pageSize>>this._shift,P+=P&~(this._mask>>1),P|=this.pageSize>>1):P=f-2,ge=this._read(P),!(x(ge,o)<0));)this._write(P,o),this._write(f,ge),f=P},s.prototype._bubbleDown=function(f,o){var x,C,P,ge,nt;for(nt=this.comparator;f<this.length;)if(f>this._mask&&!(f&this._mask-1)?x=C=f+2:f&this.pageSize>>1?(x=(f&~this._mask)>>1,x|=f&this._mask>>1,x=x+1<<this._shift,C=x+1):(x=f+(f&this._mask),C=x+1),x!==C&&C<=this.length)if(P=this._read(x),ge=this._read(C),nt(P,o)<0&&nt(P,ge)<=0)this._write(x,o),this._write(f,P),f=x;else if(nt(ge,o)<0)this._write(C,o),this._write(f,ge),f=C;else break;else if(x<=this.length)if(P=this._read(x),nt(P,o)<0)this._write(x,o),this._write(f,P),f=x;else break;else break},s}()},{}],5:[function(r,n,a){n.exports=function(){function s(f){var o;this.comparator=f?.comparator||function(x,C){return x-C},this.length=0,this.data=((o=f.initialValues)!=null?o.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var f,o,x;if(this.data.length>0)for(f=o=1,x=this.data.length;1<=x?o<x:o>x;f=1<=x?++o:--o)this._bubbleUp(f)},s.prototype.queue=function(f){this.data.push(f),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var f,o;return o=this.data[0],f=this.data.pop(),this.data.length>0&&(this.data[0]=f,this._bubbleDown(0)),o},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(f){for(var o,x;f>0&&(o=f-1>>>1,this.comparator(this.data[f],this.data[o])<0);)x=this.data[o],this.data[o]=this.data[f],this.data[f]=x,f=o},s.prototype._bubbleDown=function(f){var o,x,C,P,ge;for(o=this.data.length-1;x=(f<<1)+1,P=x+1,C=f,x<=o&&this.comparator(this.data[x],this.data[C])<0&&(C=x),P<=o&&this.comparator(this.data[P],this.data[C])<0&&(C=P),C!==f;)ge=this.data[C],this.data[C]=this.data[f],this.data[f]=ge,f=C},s}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:t,mask:r,image:n,fillMaxValue:a=this.maxValue,invert:s=!1}=e,f=n||this;f.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,t||(t=f.getLocalMaxima({invert:s,mask:r}));let o=s?0:1,x=new Int16Array(f.size),C=f.width,P=f.height,ge=new PriorityQueue({comparator:(nt,ze)=>nt[2]-ze[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let nt=0;nt<t.length;nt++){let ze=t[nt][0]+t[nt][1]*C;x[ze]=nt+1;let Bt=f.data[ze];(s&&Bt<=a||!s&&Bt>=a)&&ge.queue([t[nt][0],t[nt][1],Bt])}for(;ge.length>0;){let nt=ge.dequeue(),ze=nt[0]+nt[1]*C;for(let Bt=0;Bt<4;Bt++){let qr=nt[0]+dxs[Bt],_n=nt[1]+dys[Bt];if(qr>=0&&_n>=0&&qr<C&&_n<P){let Fn=qr+_n*C;if(!r||r.getBit(Fn)===o){let tl=f.data[Fn];(s&&tl<=a||!s&&tl>=a)&&x[Fn]===0&&(x[Fn]=x[ze],ge.queue([nt[0]+dxs[Bt],nt[1]+dys[Bt],tl]))}}}}return new RoiMap(f,x)}class RoiManager{constructor(t,r={}){this._image=t,this._options=r,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let r=Object.assign({},this._options,t),n=fromMaxima.call(this._image,t);this._layers[r.label]=new RoiLayer(n,r)}fromPoints(t,r={}){let n=Object.assign({},this._options,r),a=fromPoints.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}putMap(t,r={}){let n=new RoiMap(this._image,t),a=Object.assign({},this._options,r);return this._layers[a.label]=new RoiLayer(n,a),this}fromWaterShed(t={}){let r=Object.assign({},this._options,t),n=fromWaterShed.call(this._image,t);this._layers[r.label]=new RoiLayer(n,r)}fromMask(t,r={}){let n=Object.assign({},this._options,r),a=fromMask.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}fromMaskConnectedComponentLabelingAlgorithm(t,r={}){let n=Object.assign({},this._options,r),a=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}getMap(t={}){let r=Object.assign({},this._options,t);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let r=this.getRois(t);if(r){let n=new Array(r.length);for(let a=0;a<r.length;a++)n[a]=r[a].id;return n}throw new Error("ROIs not found")}getRois(t={}){let{label:r=this._options.label,positive:n=!0,negative:a=!0,minSurface:s=0,maxSurface:f=Number.POSITIVE_INFINITY,minWidth:o=0,maxWidth:x=Number.POSITIVE_INFINITY,minHeight:C=0,maxHeight:P=Number.POSITIVE_INFINITY,minRatio:ge=0,maxRatio:nt=Number.POSITIVE_INFINITY}=t;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const ze=this._layers[r].roi,Bt=[];for(const qr of ze)(qr.id<0&&a||qr.id>0&&n)&&qr.surface>=s&&qr.surface<=f&&qr.width>=o&&qr.width<=x&&qr.height>=C&&qr.height<=P&&qr.ratio>=ge&&qr.ratio<=nt&&Bt.push(qr);return Bt}getRoi(t,r={}){const{label:n=this._options.label}=r;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const a=this._layers[n].roi.find(s=>s.id===t);if(!a)throw new Error(`found no Roi with id ${t}`);return a}getMasks(t={}){let r=this.getRois(t),n=new Array(r.length);for(let a=0;a<r.length;a++)n[a]=r[a].getMask(t);return n}getAnalysisMasks(t={}){const{analysisProperty:r}=t;let n=`${r}Mask`,a=this.getRois(t);return a.length===0||!a[0][n]?[]:a.map(s=>s[n])}getData(t={}){let r=Object.assign({},this._options,t);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap.data}paint(t={}){let{labelProperty:r,analysisProperty:n}=t;this._painted||(this._painted=this._image.rgba8());let a=this.getMasks(t);if(r){const s=this.getRois(t);t.labels=s.map(C=>deepValue(C,r));const f=Math.max(...t.labels);let o=!1,x=!1;if(r.includes("surface")?o=!0:/(?:perimeter|min|max|external|width|height|length)/.test(r)&&(x=!0),isFinite(f)){let C="";if(t.unit!=="pixel"&&t.pixelSize&&(x||o)){C=o?`${t.unit}^2`:t.unit;let P=o?"m^2":"m",ge=o?t.pixelSize**2:t.pixelSize;const nt=Qty.swiftConverter(P,C);t.labels=t.labels.map(ze=>nt(ge*ze))}f>50?t.labels=t.labels.map(P=>Math.round(P)+C):f>10?t.labels=t.labels.map(P=>P.toFixed(1)+C):t.labels=t.labels.map(P=>P.toFixed(2)+C)}t.labelsPosition=s.map(C=>[C.meanX,C.meanY])}if(this._painted.paintMasks(a,t),n){let s=this.getAnalysisMasks(t);this._painted.paintMasks(s,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let r=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(t);for(let a=0;a<n.length;a++){let s=n[a];for(let f=0;f<s.width;f++)for(let o=0;o<s.height;o++)s.getBitXY(f,o)&&r.setBitXY(f+s.position[0],o+s.position[1])}return r}resetPainted(t={}){const{image:r}=t;r?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const r=this.getMap(t);return r.mergeRoi(t),this.putMap(r.data,t),this}mergeRois(t,r={}){if(!Array.isArray(t)||t.some(a=>!Number.isInteger(a)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(a=>this.getRoi(a));const n=this.getMap(r);return n.mergeRois(t),this.putMap(n.data,r),this}findCorrespondingRoi(t,r={}){let n=this.getRois(r),a=[];for(let s=0;s<n.length;s++){let f=n[s],o=f.minX,x=f.minY,C=f.points,P=Math.sign(f.id),ge=correspondingRoisInformation(o,x,C,t,P);a.push(ge)}return a}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(e,t,r,n,a){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let f=0;f<r.length;f++){let o=r[f],x=o[0],C=o[1],P=x+e+(C+t)*n.width,ge=n.data[P];(ge>0||ge<0)&&(s.id.includes(ge)?s.surface[s.id.indexOf(ge)]+=1:(s.id.push(ge),s.surface.push(1)))}for(let f=0;f<s.id.length;f++)Math.sign(s.id[f])===a?s.same+=s.surface[f]:s.opposite+=s.surface[f],s.roiSurfaceCovered[f]=s.surface[f]/r.length;return s.total=s.opposite+s.same,s}const objectToString$3=Object.prototype.toString;let Image$1=class Ww{constructor(t,r,n,a){if(arguments.length===1?(a=t,{width:t,height:r,data:n}=a):n&&!n.length&&(a=n,{data:n}=a),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a={}),typeof a!="object"||a===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=a;if(typeof s!="string")throw new TypeError("kind must be a string");const f=getKind(s),o=Object.assign({},a);for(const qr in f)o[qr]===void 0&&(o[qr]=f[qr]);verifyKindDefinition(o);const{components:x,bitDepth:C,colorModel:P}=o,ge=o.alpha+0,nt=t*r,ze=x+ge,Bt=C===32?Number.MAX_VALUE:2**C-1;if(n===void 0)n=createPixelArray(nt,x,ge,ze,C,Bt);else{const qr=getTheoreticalPixelArraySize(nt,ze,C);if(n.length!==qr)throw new RangeError(`incorrect data size: ${n.length}. Should be ${qr}`)}this.width=t,this.height=r,this.data=n,this.size=nt,this.components=x,this.alpha=ge,this.bitDepth=C,this.maxValue=Bt,this.colorModel=P,this.channels=ze,this.meta=a.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:a.parent||null}),this.position=a.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString$3.call(t)==="[object IJSImage]"}static fromCanvas(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Ww(n.width,n.height,n.data)}static createFrom(t,r){const n=getImageParameters(t);return Object.assign(n,{parent:t,position:[0,0]},r),new Ww(n)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Ww(this.width,this.height,t,this)}apply(t){for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let a=(r*this.width+n)*this.channels;t.call(this,a)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$4(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function e(){this._listeners={}}e.prototype.on=function(r,n){if(this._listeners[r])throw new RangeError("there is already a listener for "+r);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[r]=n},e.prototype._send=function(r,n,a){a===void 0?a=[]:Array.isArray(a)||(a=[a]),self.postMessage({id:r,data:n},a)},e.prototype._trigger=function(r,n){if(!this._listeners[r])throw new Error("event "+r+" is not defined");this._listeners[r].apply(null,n)};var t=new e;self.onmessage=function(r){switch(r.data.action){case"exec":r.data.args.unshift(function(n,a){t._send(r.data.id,n,a)}),t._trigger(r.data.event,r.data.args);break;case"ping":t._send(r.data.id,"pong");break;default:throw new Error("unexpected action: "+r.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function e(t,r){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(r)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(e,t){if(typeof e!="string"&&typeof e!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=e.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var r=t.deps;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}WorkerManager.prototype._init=function(e){for(var t=workerTemplate.newWorkerURL(this._workerCode,e),r=0;r<this._numWorkers;r++){var n=new Worker(t);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=r,this._workers.set(n,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(e,t){if(!this._terminated){this._working--,e.running=!1;var r=this._workers.get(e);r&&r[1](t.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(e,t){if(!this._terminated){this._working--,e.running=!1;var r=this._workers.get(e);r&&r[0](t.data.data),this._workers.set(e,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!e.running)for(var t=0;t<this._waiting.length;t++){var r=this._waiting[t];if(!(typeof r[4]=="number"&&r[4]!==e.id)){this._waiting.splice(t,1),e.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,r[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(e,t){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var n of this._workers.keys())r.push(this.post(e,t,[],n.id));return Promise.all(r)};WorkerManager.prototype.post=function(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);var a=this;return new Promise(function(s,f){if(a._terminated)throw new Error("Cannot post (terminated)");a._waiting.push([e,t,r,[s,f],n]),a._exec()})};var src=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,t,r){t=Object.assign({},defaultOptions,t);const n=this.manager;return Array.isArray(e)?Promise.all(e.map(function(a){const s=runOnce(n,a,t);return typeof r=="function"&&s.then(r),s})):runOnce(n,e,t)}function runOnce(e,t,r){return e.post("data",[t,r]).then(function(n){for(let a in n)n[a]=new Image$1(n[a]);return n})}function work(){worker.on("data",function(e,t,r){t=new IJS(t);const n={},a=[],s=t.grey(),f=s.sobelFilter();ze("sobel",f);const o=f.level().mask({threshold:r.threshold});ze("mask",o);const x=f.getRoiManager();x.fromMask(o);const C=x.getMask(r.roi);ze("realMask",C);const P=s.getPixelsGrid({sampling:r.sampling,mask:C}),ge=t.getBackground(P.xyS,P.zS,r.regression);ze("background",ge);const nt=t.subtract(ge);n.result=nt,a.push(nt.data.buffer),e(n,a);function ze(Bt,qr){r.include.includes(Bt)&&(n[Bt]=qr,a.push(qr.data.buffer))}})}const background={run,work};function extend$3(e){e.extendMethod("background",background)}let Worker$1=class uS{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,r){let n,a,s={};function f(...o){return n||(this.checkUrl(),a=this.url,n=new WorkerManager$1(r.work,{deps:a}),s.manager=n),r.run.call(s,...o)}f.reset=function(){n&&(n.terminate(),n=new WorkerManager$1(r.work,{deps:a}),s.manager=n)},uS.prototype[t]=f}};extend$3(Worker$1);function getTileInfo(e,t,r,n,a,s,f){let o={},x;r===!1&&(x=tilebelt$1.pointToTile(e,t,s),n=x[0],a=x[1]);let C=40075016686e-3*Math.abs(Math.cos(t))/Math.pow(2,s),P=C/512;o.z=s,o.x=n,o.y=a,o.pointLng=e,o.pointLat=t,o.tileWidthInMeters=C,o.metersPerPixel=P,o.mapboxTileName=o.z+"-"+o.x+"-"+o.y,o.tile=[o.x,o.y,o.z],r===!1?o.bbox=tilebelt$1.tileToBBOX(o.tile):o.bbox=f,o.polygon_bb=getTileGeoJsonBB(o.bbox),o.area_bb=getAreaBB(o.bbox);const ge=new mapboxgl.LngLatBounds(o.bbox);o.bboxCT=ge.getCenter(),o.bboxSW=ge.getSouthWest(),o.bboxNE=ge.getNorthEast(),o.bboxNW=ge.getNorthWest(),o.bboxSE=ge.getSouthEast(),o.bboxW=ge.getWest().toFixed(5),o.bboxS=ge.getSouth().toFixed(5),o.bboxE=ge.getEast().toFixed(5),o.bboxN=ge.getNorth().toFixed(5),o.topLeft=o.bboxNW,o.bottomLeft=o.bboxSW,o.topRight=o.bboxNE,o.bottomRight=o.bboxSE,o.center=o.bboxCT;const nt=point([o.bboxNE.lng,o.bboxNE.lat]),ze=point([o.bboxSW.lng,o.bboxNE.lat]),Bt=point([o.bboxNE.lng,o.bboxSW.lat]),qr=point([o.bboxSW.lng,o.bboxSW.lat]),_n=midpoint(nt,Bt),Fn=midpoint(ze,qr);return o.distance=distance(_n,Fn,"kilometers").toFixed(2),o.maxPngValue=65535,o.rgbFileName="terrain-rgb-"+o.mapboxTileName+".png",o.mapFileName="map-"+o.mapboxTileName+".png",o.satFileName="sat-"+o.mapboxTileName+".png",o.thirtyTwoFileName="thirtytwo-"+o.mapboxTileName+".png",o.tileInfoFileName="tile-info-"+o.mapboxTileName+".json",o.geoJsonFileName="geojson-"+o.mapboxTileName+".json",o}function getAreaBB(e){let t=bboxPolygon(e);return area(t)}function getTileGeoJsonBB(e){let t=bboxPolygon(e);return{type:"Feature",geometry:{type:t.geometry.type,coordinates:t.geometry.coordinates}}}function getFeaturesFromBB(e,t,r){t.swPt=e.project(t.bboxSW),t.nePt=e.project(t.bboxNE),t.nwPt=e.project(t.bboxNW),t.sePt=e.project(t.bboxSE);let n=e.queryRenderedFeatures([t.swPt,t.nePt]);return r===!0&&(n=getUniqueFeatures(n)),n}function getUniqueFeatures(e){const t=new Set,r=[];for(const n of e){const a=n.properties.name,s=n.geometry.type;let f=a+"-"+s;t.has(f)||(t.add(f),r.push(n))}return r}async function loadImageFromArray(e){try{return await Image$1.load(e)}catch(t){console.log(t)}}function getHeightFromRgb(e,t,r){return-1e4+(e*256*256+t*256+r)*.1}function getHeightArray(e){let t=[],r=e.getPixelsArray();for(const n of r){let a=n[0],s=n[1],f=n[2],o=getHeightFromRgb(a,s,f);o=parseFloat(o),t.push(o)}return t}async function downloadTerrainRgb(e){return await(await fetch(e)).arrayBuffer()}async function unrealRemoteControl(e,t){let r,n={},a="";const s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{r=await fetch(t,s)}catch(f){a=f}return n.response=r,n.error=a,n}async function getMapboxTerrainRgb(e){let t,r;return t=await downloadTerrainRgb(e),r=await loadImageFromArray(t),idbKeyval.set("rgbImageArrayBuffer",t),r}function convertImage(e,t,r,n,a){return new Image$1(e,t,r,{kind:a,bitDepth:n})}function createHeightMapImage(e,t,r){let n={},a=getHeightArray(e);idbKeyval.set("decodedHeightArray",a);let s=convertImage(e.width,e.height,a,t,r);return n.minElevation=s.min[0],n.maxElevation=s.max[0],n.image=s,n.decodedHeightArray=a,n}const mapUtils={getTileInfo,getFeaturesFromBB,getMapboxTerrainRgb,createHeightMapImage,loadImageFromArray,unrealRemoteControl,downloadTerrainRgb,convertImage,getTileGeoJsonBB};function mitt(e){return{all:e=e||new Map,on:function(t,r){var n=e.get(t);n?n.push(r):e.set(t,[r])},off:function(t,r){var n=e.get(t);n&&(r?n.splice(n.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var n=e.get(t);n&&n.slice().map(function(a){a(r)}),(n=e.get("*"))&&n.slice().map(function(a){a(t,r)})}}}const emitter=mitt();var immutable=extend$2,hasOwnProperty$9=Object.prototype.hasOwnProperty;function extend$2(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)hasOwnProperty$9.call(r,n)&&(e[n]=r[n])}return e}var fuzzy$1={exports:{}};(function(e,t){(function(){var r={};e.exports=r,r.simpleFilter=function(n,a){return a.filter(function(s){return r.test(n,s)})},r.test=function(n,a){return r.match(n,a)!==null},r.match=function(n,a,s){s=s||{};var f=0,o=[],x=a.length,C=0,P=0,ge=s.pre||"",nt=s.post||"",ze=s.caseSensitive&&a||a.toLowerCase(),Bt;n=s.caseSensitive&&n||n.toLowerCase();for(var qr=0;qr<x;qr++)Bt=a[qr],ze[qr]===n[f]?(Bt=ge+Bt+nt,f+=1,P+=1+P):P=0,C+=P,o[o.length]=Bt;return f===n.length?(C=ze===n?1/0:C,{rendered:o.join(""),score:C}):null},r.filter=function(n,a,s){return!a||a.length===0?[]:typeof n!="string"?a:(s=s||{},a.reduce(function(f,o,x,C){var P=o;s.extract&&(P=s.extract(o));var ge=r.match(n,P,s);return ge!=null&&(f[f.length]={string:ge.rendered,score:ge.score,index:x,original:o}),f},[]).sort(function(f,o){var x=o.score-f.score;return x||f.index-o.index}))}})()})(fuzzy$1);var fuzzyExports=fuzzy$1.exports,List$1=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(e){this.items.push(e)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};List$1.prototype.drawItem=function(e,t){var r=document.createElement("li"),n=document.createElement("a");t&&(r.className+=" active"),n.innerHTML=e.string,r.appendChild(n),this.element.appendChild(r),r.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),r.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};List$1.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};List$1.prototype.move=function(e){this.active=e,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var list=List$1,extend$1=immutable,fuzzy=fuzzyExports,List=list,Suggestions$1=function(e,t,r){return r=r||{},this.options=extend$1({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r),this.el=e,this.data=t||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(n){this.handleKeyUp(n.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(n){this.handleKeyDown(n)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(n){this.handlePaste(n)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(t){for(var r=0;r<t.length&&(this.list.add(t[r]),r!==this.options.limit-1);r++);this.list.draw()}.bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(e){this.data=e,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(e){return e=e.toLowerCase(),e};Suggestions$1.prototype.match=function(e,t){return e.indexOf(t)>-1};Suggestions$1.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(n){return this.getItemValue(n)}.bind(this)},r;this.options.filter?(r=fuzzy.filter(this.query,this.data,t),r=r.map(function(n){return{original:n.original,string:this.render(n.original,n.string)}}.bind(this))):r=this.data.map(function(n){var a=this.render(n);return{original:n,string:a}}.bind(this)),e(r)};Suggestions$1.prototype.getItemValue=function(e){return e};Suggestions$1.prototype.render=function(e,t){if(t)return t;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),n=this.normalize(r),a=n.lastIndexOf(this.query);a>-1;){var s=a+this.query.length;r=r.slice(0,a)+"<strong>"+r.slice(a,s)+"</strong>"+r.slice(s),a=n.slice(0,a).lastIndexOf(this.query)}return r};Suggestions$1.prototype.renderError=function(e){this.list.drawError(e)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window<"u"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT$1="Expected a function",NAN=0/0,symbolTag$2="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal$2=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf$1=typeof self=="object"&&self&&self.Object===Object&&self,root$9=freeGlobal$2||freeSelf$1||Function("return this")(),objectProto$c=Object.prototype,objectToString$2=objectProto$c.toString,nativeMax$1=Math.max,nativeMin=Math.min,now=function(){return root$9.Date.now()};function debounce$1(e,t,r){var n,a,s,f,o,x,C=0,P=!1,ge=!1,nt=!0;if(typeof e!="function")throw new TypeError(FUNC_ERROR_TEXT$1);t=toNumber(t)||0,isObject$5(r)&&(P=!!r.leading,ge="maxWait"in r,s=ge?nativeMax$1(toNumber(r.maxWait)||0,t):s,nt="trailing"in r?!!r.trailing:nt);function ze(ah){var ch=n,ju=a;return n=a=void 0,C=ah,f=e.apply(ju,ch),f}function Bt(ah){return C=ah,o=setTimeout(Fn,t),P?ze(ah):f}function qr(ah){var ch=ah-x,ju=ah-C,Zu=t-ch;return ge?nativeMin(Zu,s-ju):Zu}function _n(ah){var ch=ah-x,ju=ah-C;return x===void 0||ch>=t||ch<0||ge&&ju>=s}function Fn(){var ah=now();if(_n(ah))return tl(ah);o=setTimeout(Fn,qr(ah))}function tl(ah){return o=void 0,nt&&n?ze(ah):(n=a=void 0,f)}function Io(){o!==void 0&&clearTimeout(o),C=0,n=x=a=o=void 0}function Co(){return o===void 0?f:tl(now())}function rl(){var ah=now(),ch=_n(ah);if(n=arguments,a=this,x=ah,ch){if(o===void 0)return Bt(x);if(ge)return o=setTimeout(Fn,t),ze(x)}return o===void 0&&(o=setTimeout(Fn,t)),f}return rl.cancel=Io,rl.flush=Co,rl}function isObject$5(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function isObjectLike$6(e){return!!e&&typeof e=="object"}function isSymbol$6(e){return typeof e=="symbol"||isObjectLike$6(e)&&objectToString$2.call(e)==symbolTag$2}function toNumber(e){if(typeof e=="number")return e;if(isSymbol$6(e))return NAN;if(isObject$5(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=isObject$5(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var lodash_debounce=debounce$1,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function e(t,r,n){return Function.prototype.apply.call(t,r,n)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}var NumberIsNaN=Number.isNaN||function e(t){return t!==t};function EventEmitter$3(){EventEmitter$3.init.call(this)}events$1.exports=EventEmitter$3;events$1.exports.once=once;EventEmitter$3.EventEmitter=EventEmitter$3;EventEmitter$3.prototype._events=void 0;EventEmitter$3.prototype._eventsCount=0;EventEmitter$3.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(EventEmitter$3,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}});EventEmitter$3.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$3.prototype.setMaxListeners=function e(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(e){return e._maxListeners===void 0?EventEmitter$3.defaultMaxListeners:e._maxListeners}EventEmitter$3.prototype.getMaxListeners=function e(){return _getMaxListeners(this)};EventEmitter$3.prototype.emit=function e(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var a=t==="error",s=this._events;if(s!==void 0)a=a&&s.error===void 0;else if(!a)return!1;if(a){var f;if(r.length>0&&(f=r[0]),f instanceof Error)throw f;var o=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw o.context=f,o}var x=s[t];if(x===void 0)return!1;if(typeof x=="function")ReflectApply(x,this,r);else for(var C=x.length,P=arrayClone(x,C),n=0;n<C;++n)ReflectApply(P[n],this,r);return!0};function _addListener(e,t,r,n){var a,s,f;if(checkListener(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),f=s[t]),f===void 0)f=s[t]=r,++e._eventsCount;else if(typeof f=="function"?f=s[t]=n?[r,f]:[f,r]:n?f.unshift(r):f.push(r),a=_getMaxListeners(e),a>0&&f.length>a&&!f.warned){f.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=f.length,ProcessEmitWarning(o)}return e}EventEmitter$3.prototype.addListener=function e(t,r){return _addListener(this,t,r,!1)};EventEmitter$3.prototype.on=EventEmitter$3.prototype.addListener;EventEmitter$3.prototype.prependListener=function e(t,r){return _addListener(this,t,r,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=onceWrapper.bind(n);return a.listener=r,n.wrapFn=a,a}EventEmitter$3.prototype.once=function e(t,r){return checkListener(r),this.on(t,_onceWrap(this,t,r)),this};EventEmitter$3.prototype.prependOnceListener=function e(t,r){return checkListener(r),this.prependListener(t,_onceWrap(this,t,r)),this};EventEmitter$3.prototype.removeListener=function e(t,r){var n,a,s,f,o;if(checkListener(r),a=this._events,a===void 0)return this;if(n=a[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete a[t],a.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(s=-1,f=n.length-1;f>=0;f--)if(n[f]===r||n[f].listener===r){o=n[f].listener,s=f;break}if(s<0)return this;s===0?n.shift():spliceOne(n,s),n.length===1&&(a[t]=n[0]),a.removeListener!==void 0&&this.emit("removeListener",t,o||r)}return this};EventEmitter$3.prototype.off=EventEmitter$3.prototype.removeListener;EventEmitter$3.prototype.removeAllListeners=function e(t){var r,n,a;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),f;for(a=0;a<s.length;++a)f=s[a],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(a=r.length-1;a>=0;a--)this.removeListener(t,r[a]);return this};function _listeners(e,t,r){var n=e._events;if(n===void 0)return[];var a=n[t];return a===void 0?[]:typeof a=="function"?r?[a.listener||a]:[a]:r?unwrapListeners(a):arrayClone(a,a.length)}EventEmitter$3.prototype.listeners=function e(t){return _listeners(this,t,!0)};EventEmitter$3.prototype.rawListeners=function e(t){return _listeners(this,t,!1)};EventEmitter$3.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):listenerCount.call(e,t)};EventEmitter$3.prototype.listenerCount=listenerCount;function listenerCount(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}EventEmitter$3.prototype.eventNames=function e(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function once(e,t){return new Promise(function(r,n){function a(f){e.removeListener(t,s),n(f)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",a),r([].slice.call(arguments))}eventTargetAgnosticAddListener(e,t,s,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(e,a,{once:!0})})}function addErrorHandlerIfEventEmitter(e,t,r){typeof e.on=="function"&&eventTargetAgnosticAddListener(e,"error",t,r)}function eventTargetAgnosticAddListener(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function a(s){n.once&&e.removeEventListener(t,a),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var eventsExports=events$1.exports;const EventEmitter$4=getDefaultExportFromCjs(eventsExports);var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam$1(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink$1(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var r=t[1],n=t[2].split(";"),a=null,s=n.reduce(function(f,o){var x=parseParam$1(o);return x?x.key==="rel"?(a||(a=x.value),f):(f[x.key]=x.value,f):f},{});return a?{url:r,rel:a,params:s}:null}function parseLinkHeader$3(e){return e?e.split(/,\s*</).reduce(function(t,r){var n=parseLink$1(r);if(!n)return t;var a=n.rel.split(/\s+/);return a.forEach(function(s){t[s]||(t[s]={url:n.url,params:n.params})}),t},{}):{}}var parseLinkHeader_1$1=parseLinkHeader$3,parseLinkHeader$2=parseLinkHeader_1$1;function MapiResponse$3(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader$2(this.headers.link)}MapiResponse$3.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$3.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse$1=MapiResponse$3,constants$9={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$8=constants$9;function MapiError$3(e){var t=e.type||constants$8.ERROR_HTTP,r;if(e.body)try{r=JSON.parse(e.body)}catch{r=e.body}else r=null;var n=e.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:t===constants$8.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=r}var mapiError$1=MapiError$3;function parseSingleHeader$1(e){var t=e.indexOf(":"),r=e.substring(0,t).trim().toLowerCase(),n=e.substring(t+1).trim();return{name:r,value:n}}function parseHeaders$3(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(r){var n=parseSingleHeader$1(r);t[n.name]=n.value}),t}var parseHeaders_1$1=parseHeaders$3,MapiResponse$2=mapiResponse$1,MapiError$2=mapiError$1,constants$7=constants$9,parseHeaders$2=parseHeaders_1$1,requestsUnderway$1={};function browserAbort$1(e){var t=requestsUnderway$1[e.id];t&&(t.abort(),delete requestsUnderway$1[e.id])}function createResponse$1(e,t){return new MapiResponse$2(e,{body:t.response,headers:parseHeaders$2(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent$1(e){var t=e.total,r=e.loaded,n=100*r/t;return{total:t,transferred:r,percent:n}}function sendRequestXhr$1(e,t){return new Promise(function(r,n){t.onprogress=function(f){e.emitter.emit(constants$7.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent$1(f))};var a=e.file;a&&(t.upload.onprogress=function(f){e.emitter.emit(constants$7.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent$1(f))}),t.onerror=function(f){n(f)},t.onabort=function(){var f=new MapiError$2({request:e,type:constants$7.ERROR_REQUEST_ABORTED});n(f)},t.onload=function(){if(delete requestsUnderway$1[e.id],t.status<200||t.status>=400){var f=new MapiError$2({request:e,body:t.response,statusCode:t.status});n(f);return}r(t)};var s=e.body;typeof s=="string"?t.send(s):s?t.send(JSON.stringify(s)):a?t.send(a):t.send(),requestsUnderway$1[e.id]=t}).then(function(r){return createResponse$1(e,r)})}function createRequestXhr$1(e,t){var r=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(a){n.setRequestHeader(a,e.headers[a])}),n}function browserSend$1(e){return Promise.resolve().then(function(){var t=createRequestXhr$1(e,e.client.accessToken);return sendRequestXhr$1(e,t)})}var browserLayer$1={browserAbort:browserAbort$1,sendRequestXhr:sendRequestXhr$1,browserSend:browserSend$1,createRequestXhr:createRequestXhr$1},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */base64$1.exports;(function(e,t){(function(r){var n=t,a=e&&e.exports==n&&e,s=typeof commonjsGlobal=="object"&&commonjsGlobal;(s.global===s||s.window===s)&&(r=s);var f=function(Bt){this.message=Bt};f.prototype=new Error,f.prototype.name="InvalidCharacterError";var o=function(Bt){throw new f(Bt)},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/[\t\n\f\r ]/g,P=function(Bt){Bt=String(Bt).replace(C,"");var qr=Bt.length;qr%4==0&&(Bt=Bt.replace(/==?$/,""),qr=Bt.length),(qr%4==1||/[^+a-zA-Z0-9/]/.test(Bt))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var _n=0,Fn,tl,Io="",Co=-1;++Co<qr;)tl=x.indexOf(Bt.charAt(Co)),Fn=_n%4?Fn*64+tl:tl,_n++%4&&(Io+=String.fromCharCode(255&Fn>>(-2*_n&6)));return Io},ge=function(Bt){Bt=String(Bt),/[^\0-\xFF]/.test(Bt)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var qr=Bt.length%3,_n="",Fn=-1,tl,Io,Co,rl,ah=Bt.length-qr;++Fn<ah;)tl=Bt.charCodeAt(Fn)<<16,Io=Bt.charCodeAt(++Fn)<<8,Co=Bt.charCodeAt(++Fn),rl=tl+Io+Co,_n+=x.charAt(rl>>18&63)+x.charAt(rl>>12&63)+x.charAt(rl>>6&63)+x.charAt(rl&63);return qr==2?(tl=Bt.charCodeAt(Fn)<<8,Io=Bt.charCodeAt(++Fn),rl=tl+Io,_n+=x.charAt(rl>>10)+x.charAt(rl>>4&63)+x.charAt(rl<<2&63)+"="):qr==1&&(rl=Bt.charCodeAt(Fn),_n+=x.charAt(rl>>2)+x.charAt(rl<<4&63)+"=="),_n},nt={encode:ge,decode:P,version:"0.1.0"};if(n&&!n.nodeType)if(a)a.exports=nt;else for(var ze in nt)nt.hasOwnProperty(ze)&&(n[ze]=nt[ze]);else r.base64=nt})(commonjsGlobal)})(base64$1,base64$1.exports);var base64Exports=base64$1.exports,base64=base64Exports,tokenCache={};function parseToken$4(e){if(tokenCache[e])return tokenCache[e];var t=e.split("."),r=t[0],n=t[1];if(!n)throw new Error("Invalid token");var a=parsePaylod(n),s={usage:r,user:a.u};return has(a,"a")&&(s.authorization=a.a),has(a,"exp")&&(s.expires=a.exp*1e3),has(a,"iat")&&(s.created=a.iat*1e3),has(a,"scopes")&&(s.scopes=a.scopes),has(a,"client")&&(s.client=a.client),has(a,"ll")&&(s.lastLogin=a.ll),has(a,"iu")&&(s.impersonator=a.iu),tokenCache[e]=s,s}function parsePaylod(e){try{return JSON.parse(base64.decode(e))}catch{throw new Error("Invalid token")}}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var parseMapboxToken=parseToken$4,eventemitter3={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(x,C,P){this.fn=x,this.context=C,this.once=P||!1}function s(x,C,P,ge,nt){if(typeof P!="function")throw new TypeError("The listener must be a function");var ze=new a(P,ge||x,nt),Bt=r?r+C:C;return x._events[Bt]?x._events[Bt].fn?x._events[Bt]=[x._events[Bt],ze]:x._events[Bt].push(ze):(x._events[Bt]=ze,x._eventsCount++),x}function f(x,C){--x._eventsCount===0?x._events=new n:delete x._events[C]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var C=[],P,ge;if(this._eventsCount===0)return C;for(ge in P=this._events)t.call(P,ge)&&C.push(r?ge.slice(1):ge);return Object.getOwnPropertySymbols?C.concat(Object.getOwnPropertySymbols(P)):C},o.prototype.listeners=function(C){var P=r?r+C:C,ge=this._events[P];if(!ge)return[];if(ge.fn)return[ge.fn];for(var nt=0,ze=ge.length,Bt=new Array(ze);nt<ze;nt++)Bt[nt]=ge[nt].fn;return Bt},o.prototype.listenerCount=function(C){var P=r?r+C:C,ge=this._events[P];return ge?ge.fn?1:ge.length:0},o.prototype.emit=function(C,P,ge,nt,ze,Bt){var qr=r?r+C:C;if(!this._events[qr])return!1;var _n=this._events[qr],Fn=arguments.length,tl,Io;if(_n.fn){switch(_n.once&&this.removeListener(C,_n.fn,void 0,!0),Fn){case 1:return _n.fn.call(_n.context),!0;case 2:return _n.fn.call(_n.context,P),!0;case 3:return _n.fn.call(_n.context,P,ge),!0;case 4:return _n.fn.call(_n.context,P,ge,nt),!0;case 5:return _n.fn.call(_n.context,P,ge,nt,ze),!0;case 6:return _n.fn.call(_n.context,P,ge,nt,ze,Bt),!0}for(Io=1,tl=new Array(Fn-1);Io<Fn;Io++)tl[Io-1]=arguments[Io];_n.fn.apply(_n.context,tl)}else{var Co=_n.length,rl;for(Io=0;Io<Co;Io++)switch(_n[Io].once&&this.removeListener(C,_n[Io].fn,void 0,!0),Fn){case 1:_n[Io].fn.call(_n[Io].context);break;case 2:_n[Io].fn.call(_n[Io].context,P);break;case 3:_n[Io].fn.call(_n[Io].context,P,ge);break;case 4:_n[Io].fn.call(_n[Io].context,P,ge,nt);break;default:if(!tl)for(rl=1,tl=new Array(Fn-1);rl<Fn;rl++)tl[rl-1]=arguments[rl];_n[Io].fn.apply(_n[Io].context,tl)}}return!0},o.prototype.on=function(C,P,ge){return s(this,C,P,ge,!1)},o.prototype.once=function(C,P,ge){return s(this,C,P,ge,!0)},o.prototype.removeListener=function(C,P,ge,nt){var ze=r?r+C:C;if(!this._events[ze])return this;if(!P)return f(this,ze),this;var Bt=this._events[ze];if(Bt.fn)Bt.fn===P&&(!nt||Bt.once)&&(!ge||Bt.context===ge)&&f(this,ze);else{for(var qr=0,_n=[],Fn=Bt.length;qr<Fn;qr++)(Bt[qr].fn!==P||nt&&!Bt[qr].once||ge&&Bt[qr].context!==ge)&&_n.push(Bt[qr]);_n.length?this._events[ze]=_n.length===1?_n[0]:_n:f(this,ze)}return this},o.prototype.removeAllListeners=function(C){var P;return C?(P=r?r+C:C,this._events[P]&&f(this,P)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;function encodeArray$1(e){return e.map(encodeURIComponent).join(",")}function encodeValue$1(e){return Array.isArray(e)?encodeArray$1(e):encodeURIComponent(String(e))}function appendQueryParam$1(e,t,r){if(r===!1||r===null)return e;var n=/\?/.test(e)?"&":"?",a=encodeURIComponent(t);return r!==void 0&&r!==""&&r!==!0&&(a+="="+encodeValue$1(r)),""+e+n+a}function appendQueryObject$1(e,t){if(!t)return e;var r=e;return Object.keys(t).forEach(function(n){var a=t[n];a!==void 0&&(Array.isArray(a)&&(a=a.filter(function(s){return s!=null}).join(",")),r=appendQueryParam$1(r,n,a))}),r}function prependOrigin$1(e,t){if(!t||e.slice(0,4)==="http")return e;var r=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+r+e}function interpolateRouteParams$1(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var a=t[n];if(a===void 0)throw new Error("Unspecified route parameter "+n);var s=encodeValue$1(a);return"/"+s}):e}var urlUtils$3={appendQueryObject:appendQueryObject$1,appendQueryParam:appendQueryParam$1,prependOrigin:prependOrigin$1,interpolateRouteParams:interpolateRouteParams$1},parseToken$3=parseMapboxToken,xtend$6=immutable,EventEmitter$2=eventemitter3Exports,urlUtils$2=urlUtils$3,constants$6=constants$9,requestId$1=1;function MapiRequest$3(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};t.body&&(r["content-type"]="application/json");var n=xtend$6(r,t.headers),a=Object.keys(n).reduce(function(s,f){return s[f.toLowerCase()]=n[f],s},{});this.id=requestId$1++,this._options=t,this.emitter=new EventEmitter$2,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=a}MapiRequest$3.prototype.url=function e(t){var r=urlUtils$2.prependOrigin(this.path,this.origin);r=urlUtils$2.appendQueryObject(r,this.query);var n=this.params,a=t??this.client.accessToken;if(a){r=urlUtils$2.appendQueryParam(r,"access_token",a);var s=parseToken$3(a).user;n=xtend$6({ownerId:s},n)}return r=urlUtils$2.interpolateRouteParams(r,n),r};MapiRequest$3.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(r){return t.response=r,t.emitter.emit(constants$6.EVENT_RESPONSE,r),r},function(r){throw t.error=r,t.emitter.emit(constants$6.EVENT_ERROR,r),r})};MapiRequest$3.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$3.prototype.eachPage=function e(t){var r=this;function n(f){function o(){delete r._nextPageRequest;var x=f.nextPage();x&&(r._nextPageRequest=x,s(x))}t(null,f,o)}function a(f){t(f,null,function(){})}function s(f){f.send().then(n,a)}s(this)};MapiRequest$3.prototype.clone=function e(){return this._extend()};MapiRequest$3.prototype._extend=function e(t){var r=xtend$6(this._options,t);return new MapiRequest$3(this.client,r)};var mapiRequest$1=MapiRequest$3,parseToken$2=parseMapboxToken,MapiRequest$2=mapiRequest$1,constants$5=constants$9;function MapiClient$5(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken$2(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$5.API_ORIGIN}MapiClient$5.prototype.createRequest=function e(t){return new MapiRequest$2(this,t)};var mapiClient$1=MapiClient$5,browser$1=browserLayer$1,MapiClient$4=mapiClient$1;function BrowserClient$1(e){MapiClient$4.call(this,e)}BrowserClient$1.prototype=Object.create(MapiClient$4.prototype);BrowserClient$1.prototype.constructor=BrowserClient$1;BrowserClient$1.prototype.sendRequest=browser$1.browserSend;BrowserClient$1.prototype.abortRequest=browser$1.browserAbort;function createBrowserClient$1(e){return new BrowserClient$1(e)}var browserClient$1=createBrowserClient$1,client=browserClient$1,mapboxSdk=client,toString$2=Object.prototype.toString,isPlainObj=function(e){var t;return toString$2.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$5=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$5={};v$5.assert=function(e,t){return t=t||{},function(r){var n=validate(e,r);if(n){var a=processMessage(n,t);throw t.apiName&&(a=t.apiName+": "+a),new Error(a)}}};v$5.shape=function e(t){var r=objectEntries(t);return function(a){var s=validate(v$5.plainObject,a);if(s)return s;for(var f,o,x=[],C=0;C<r.length;C++)f=r[C].key,o=r[C].value,s=validate(o,a[f]),s&&x.push([f].concat(s));return x.length<2?x[0]:function(P){x=x.map(function(ze){var Bt=ze[0],qr=processMessage(ze,P).split(`
`).join(NEWLINE_INDENT);return"- "+Bt+": "+qr});var ge=P.path.join("."),nt=ge===DEFAULT_ERROR_PATH?"":" of "+ge;return"The following properties"+nt+" have invalid values:"+NEWLINE_INDENT+x.join(NEWLINE_INDENT)}}};v$5.strictShape=function e(t){var r=v$5.shape(t);return function(a){var s=r(a);if(s)return s;var f=Object.keys(a).reduce(function(o,x){return t[x]===void 0&&o.push(x),o},[]);if(f.length!==0)return function(){return"The following keys are invalid: "+f.join(", ")}}};v$5.arrayOf=function e(t){return createArrayValidator(t)};v$5.tuple=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(t)};function createArrayValidator(e){var t=Array.isArray(e),r=function(n){return t?e[n]:e};return function(a){var s=validate(v$5.plainArray,a);if(s)return s;if(t&&a.length!==e.length)return"an array with "+e.length+" items";for(var f=0;f<a.length;f++)if(s=validate(r(f),a[f]),s)return[f].concat(s)}}v$5.required=function e(t){function r(n){return n==null?function(a){return formatErrorMessage(a,isArrayCulprit(a.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return r.__required=!0,r};v$5.oneOfType=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var a=t.map(function(s){return validate(s,n)}).filter(Boolean);if(a.length===t.length)return a.every(function(s){return s.length===1&&typeof s[0]=="string"})?orList(a.map(function(s){return s[0]})):a.reduce(function(s,f){return f.length>s.length?f:s})}};v$5.equal=function e(t){return function(n){if(n!==t)return JSON.stringify(t)}};v$5.oneOf=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),r=t.map(function(n){return v$5.equal(n)});return v$5.oneOfType.apply(this,r)};v$5.range=function e(t){var r=t[0],n=t[1];return function(s){var f=validate(v$5.number,s);if(f||s<r||s>n)return"number between "+r+" & "+n+" (inclusive)"}};v$5.any=function e(){};v$5.boolean=function e(t){if(typeof t!="boolean")return"boolean"};v$5.number=function e(t){if(typeof t!="number")return"number"};v$5.plainArray=function e(t){if(!Array.isArray(t))return"array"};v$5.plainObject=function e(t){if(!isPlainObject(t))return"object"};v$5.string=function e(t){if(typeof t!="string")return"string"};v$5.func=function e(t){if(typeof t!="function")return"function"};function validate(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var r=e(t);if(r)return Array.isArray(r)?r:[r]}}function processMessage(e,t){var r=e.length,n=e[r-1],a=e.slice(0,r-1);return a.length===0&&(a=[DEFAULT_ERROR_PATH]),t=xtend$5(t,{path:a}),typeof n=="function"?n(t):formatErrorMessage(t,prettifyResult(n))}function orList(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function prettifyResult(e){return"must be "+addArticle(e)+"."}function addArticle(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function formatErrorMessage(e,t){var r=isArrayCulprit(e.path),n=e.path.join(".")+" "+t,a=r?"Item at position ":"";return a+n}function isArrayCulprit(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function objectEntries(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}v$5.validate=validate;v$5.processMessage=processMessage;var lib$1=v$5,xtend$4=immutable,v$4=lib$1;function file$1(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape$1(e,t){return v$4.assert(v$4.strictShape(e),t)}function date$1(e){var t="date";if(typeof e=="boolean")return t;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return t}catch{return t}}function coordinates$2(e){return v$4.tuple(v$4.number,v$4.number)(e)}var validator$1=xtend$4(v$4,{file:file$1,date:date$1,coordinates:coordinates$2,assertShape:assertShape$1});function pick$3(e,t){var r=function(n,a){return t.indexOf(n)!==-1&&a!==void 0};return typeof t=="function"&&(r=t),Object.keys(e).filter(function(n){return r(n,e[n])}).reduce(function(n,a){return n[a]=e[a],n},{})}var pick_1$1=pick$3;function objectMap$3(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(n,e[n]),r},{})}var objectMap_1$1=objectMap$3,objectMap$2=objectMap_1$1;function stringifyBoolean$1(e){return objectMap$2(e,function(t,r){return typeof r=="boolean"?JSON.stringify(r):r})}var stringifyBooleans$3=stringifyBoolean$1,MapiClient$3=mapiClient$1,createClient$1=browserClient$1;function createServiceFactory$3(e){return function(t){var r;MapiClient$3.prototype.isPrototypeOf(t)?r=t:r=createClient$1(t);var n=Object.create(e);return n.client=r,n}}var createServiceFactory_1$1=createServiceFactory$3,xtend$3=immutable,v$3=validator$1,pick$2=pick_1$1,stringifyBooleans$2=stringifyBooleans$3,createServiceFactory$2=createServiceFactory_1$1,Geocoding$1={},featureTypes$1=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding$1.forwardGeocode=function(e){v$3.assertShape({query:v$3.required(v$3.string),mode:v$3.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$3.arrayOf(v$3.string),proximity:v$3.oneOf(v$3.coordinates,"ip"),types:v$3.arrayOf(v$3.oneOf(featureTypes$1)),autocomplete:v$3.boolean,bbox:v$3.arrayOf(v$3.number),limit:v$3.number,language:v$3.arrayOf(v$3.string),routing:v$3.boolean,fuzzyMatch:v$3.boolean,worldview:v$3.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};Geocoding$1.reverseGeocode=function(e){v$3.assertShape({query:v$3.required(v$3.coordinates),mode:v$3.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$3.arrayOf(v$3.string),types:v$3.arrayOf(v$3.oneOf(featureTypes$1)),bbox:v$3.arrayOf(v$3.number),limit:v$3.number,language:v$3.arrayOf(v$3.string),reverseMode:v$3.oneOf("distance","score"),routing:v$3.boolean,worldview:v$3.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};var geocoding$2=createServiceFactory$2(Geocoding$1);let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random=e=>crypto.getRandomValues(new Uint8Array(e)),customRandom=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,a=-~(1.6*n*t/e.length);return(s=t)=>{let f="";for(;;){let o=r(a),x=a;for(;x--;)if(f+=e[o[x]&n]||"",f.length===s)return f}}},customAlphabet=(e,t=21)=>customRandom(e,t,random),nanoid$1=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,r)=>(r&=63,r<36?t+=r.toString(36):r<62?t+=(r-26).toString(36).toUpperCase():r>62?t+="-":t+="_",t),"");const index_browser=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet,customRandom,nanoid:nanoid$1,random,urlAlphabet},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(index_browser);var nanoid=require$$0.nanoid;function MapboxEventManager$1(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(e,t){var r=this.getSelectedIndex(e,t),n=this.getEventPayload("search.select",t);if(n.resultIndex=r,n.resultPlaceName=e.place_name,n.resultId=e.id,!(r===this.lastSentIndex&&n.queryString===this.lastSentInput||r==-1)&&(this.lastSentIndex=r,this.lastSentInput=n.queryString,!!n.queryString))return this.push(n)},start:function(e){var t=this.getEventPayload("search.start",e);if(t.queryString)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var r=this.getEventPayload("search.keystroke",t);if(r.lastAction=e.key,!!r.queryString)return this.push(r)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var r=this.getRequestOptions(e);this.request(r,function(n){if(n)return this.handleError(n,t);if(t)return t()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t){var r;t.options.proximity?typeof t.options.proximity=="object"?r=[t.options.proximity.longitude,t.options.proximity.latitude]:t.options.proximity==="ip"?r=[999,999]:r=t.options.proximity:r=null;var n=t._map?t._map.getZoom():void 0,a={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:r,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:n,keyboardLocale:this.locale};return e==="search.select"?a.queryString=t.inputString:e!="search.select"&&t._inputEl?a.queryString=t._inputEl.value:a.queryString=t.inputString,a},request:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},r.open(e.method,e.host+"/"+e.path,!0);for(var n in e.headers){var a=e.headers[n];r.setRequestHeader(n,a)}r.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var r=t._typeahead.data,n=e.id,a=r.map(function(f){return f.id}),s=a.indexOf(n);return s}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},localization$1={placeholder},subtag$1={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():t[r]=n()})(commonjsGlobal,"subtag",function(){var t="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(x){return x.match(r)||[]}function a(x){return n(x).filter(function(C,P){return C&&P})}function s(x){return x=n(x),{language:x[1]||t,extlang:x[2]||t,script:x[3]||t,region:x[4]||t}}function f(x,C,P){Object.defineProperty(x,C,{value:P,enumerable:!0})}function o(x,C,P){function ge(nt){return n(nt)[x]||t}f(ge,"pattern",C),f(s,P,ge)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),f(s,"split",a),s})})(subtag$1);var subtagExports=subtag$1.exports;function Geolocation$1(){}Geolocation$1.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,r){window.navigator.geolocation.getCurrentPosition(t,r,e)})}};var geolocation$1=Geolocation$1;function transformFeatureToGeolocationText(e,t){const r=getAddressInfo(e),n=["address","street","place","country"];var a;if(typeof t=="function")return t(r);const s=n.indexOf(t);return s===-1?a=n:a=n.slice(s),a.reduce(function(f,o){return r[o]?(f!==""&&(f=f+", "),f+r[o]):f},"")}function getAddressInfo(e){const t=e.address||"",r=e.text||"",n=e.place_name||"",s={address:n.split(",")[0],houseNumber:t,street:r,placeName:n};return e.context.forEach(function(f){const o=f.id.split(".")[0];s[o]=f.text}),s}const REVERSE_GEOCODE_COORD_RGX=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var utils$1={transformFeatureToGeolocationText,getAddressInfo,REVERSE_GEOCODE_COORD_RGX},Typeahead=suggestions,debounce=lodash_debounce,extend=immutable,EventEmitter$1=eventsExports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding$2,MapboxEventManager=events,localization=localization$1,subtag=subtagExports,Geolocation=geolocation$1,utils=utils$1;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function getFooterNode(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function MapboxGeocoder(e){this._eventEmitter=new EventEmitter$1,this.options=extend({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Geolocation}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const a=r.onAdd();n.appendChild(a)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const r=document.querySelectorAll(e);if(r.length===0)throw new Error("Element ",e,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(C){this.eventManager.keyevent(C,this)}.bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(r),t.appendChild(this._inputEl),t.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(s),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var f=this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),f.getItemValue=this.options.getItemValue;var o=f.list.draw,x=this._footerNode=getFooterNode();return f.list.draw=function(){o.call(this),x.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),x.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(x)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const r={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(r).send().then(function(n){const a=n.body.features[0];if(a){const s=utils.transformFeatureToGeolocationText(a,this.options.addressAccuracy);this._setInputValue(s),a.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:a})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=t,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,r=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var n=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,a=n?n.value:"";if(!a)return this.fresh=!0,e.keyCode!==r&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[r,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&exceptions[e.properties.short_code])t=extend({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[e.properties.short_code].bbox,t);else if(e.bbox){var r=e.bbox;t=extend({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)}else{var n={zoom:this.options.zoom};t=extend({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var r;return e.localGeocoderOnly?r=GEOCODE_REQUEST_TYPE.LOCAL:e.reverseGeocode&&utils.REVERSE_GEOCODE_COORD_RGX.test(t)?r=GEOCODE_REQUEST_TYPE.REVERSE:r=GEOCODE_REQUEST_TYPE.FORWARD,r},_setupConfig:function(e,t){const r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var a=this,s=r.reduce(function(o,x){if(a.options[x]===void 0||a.options[x]===null)return o;["countries","types","language"].indexOf(x)>-1?o[x]=a.options[x].split(n):o[x]=a.options[x];const C=typeof a.options[x].longitude=="number"&&typeof a.options[x].latitude=="number";if(x==="proximity"&&C){const P=a.options[x].longitude,ge=a.options[x].latitude;o[x]=[P,ge]}return o},{});switch(e){case GEOCODE_REQUEST_TYPE.REVERSE:{var f=t.split(n).map(function(o){return parseFloat(o,10)});a.options.flipCoordinates||f.reverse(),s.types&&s.types[0],s=extend(s,{query:f,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(o){o in s&&delete s[o]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:{const o=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(o)&&(t=t.replace(/,/g," ")),s=extend(s,{query:t})}break}return s},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),r=this._setupConfig(t,e);var n;switch(t){case GEOCODE_REQUEST_TYPE.LOCAL:n=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:n=this.geocoderService.forwardGeocode(r).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:n=this.geocoderService.reverseGeocode(r).send();break}var a=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],s=[],f=null;return n.catch(function(o){f=o}.bind(this)).then(function(o){this._hideLoadingIcon();var x={};return o?o.statusCode=="200"&&(x=o.body,x.request=o.request,x.headers=o.headers):x={type:"FeatureCollection",features:[]},x.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),x.features=x.features?a.concat(x.features):a,this.options.externalGeocoder?(s=this.options.externalGeocoder(e,x.features)||Promise.resolve([]),s.then(function(C){return x.features=x.features?C.concat(x.features):C,x},function(){return x})):x}.bind(this)).then(function(o){if(f)throw f;this.options.filter&&o.features.length&&(o.features=o.features.filter(this.options.filter)),o.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",o),this._typeahead.update(o.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",o))}.bind(this)).catch(function(o){this._hideLoadingIcon(),this._hideAttribution(),a.length&&this.options.localGeocoder||s.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(a)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:a}),this._eventEmitter.emit("error",{error:o})}.bind(this)),n},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var r=t.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=subtag.language(e),r=localization.placeholder[t];if(r)return r}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},r=extend({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(r),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var lib=MapboxGeocoder;const MapboxGeocoder$1=getDefaultExportFromCjs(lib);var xtend$2=immutable,v$2=lib$1;function file(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape(e,t){return v$2.assert(v$2.strictShape(e),t)}function date(e){var t="date";if(typeof e=="boolean")return t;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return t}catch{return t}}function coordinates$1(e){return v$2.tuple(v$2.number,v$2.number)(e)}var validator=xtend$2(v$2,{file,date,coordinates:coordinates$1,assertShape});function pick$1(e,t){var r=function(n,a){return t.indexOf(n)!==-1&&a!==void 0};return typeof t=="function"&&(r=t),Object.keys(e).filter(function(n){return r(n,e[n])}).reduce(function(n,a){return n[a]=e[a],n},{})}var pick_1=pick$1;function objectMap$1(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(n,e[n]),r},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(e){return objectMap(e,function(t,r){return typeof r=="boolean"?JSON.stringify(r):r})}var stringifyBooleans$1=stringifyBoolean;function encodeArray(e){return e.map(encodeURIComponent).join(",")}function encodeValue(e){return Array.isArray(e)?encodeArray(e):encodeURIComponent(String(e))}function appendQueryParam(e,t,r){if(r===!1||r===null)return e;var n=/\?/.test(e)?"&":"?",a=encodeURIComponent(t);return r!==void 0&&r!==""&&r!==!0&&(a+="="+encodeValue(r)),""+e+n+a}function appendQueryObject(e,t){if(!t)return e;var r=e;return Object.keys(t).forEach(function(n){var a=t[n];a!==void 0&&(Array.isArray(a)&&(a=a.filter(function(s){return s!=null}).join(",")),r=appendQueryParam(r,n,a))}),r}function prependOrigin(e,t){if(!t||e.slice(0,4)==="http")return e;var r=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+r+e}function interpolateRouteParams(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var a=t[n];if(a===void 0)throw new Error("Unspecified route parameter "+n);var s=encodeValue(a);return"/"+s}):e}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},constants$4={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},parseToken$1=parseMapboxToken,xtend$1=immutable,EventEmitter=eventemitter3Exports,urlUtils=urlUtils$1,constants$3=constants$4,requestId=1;function MapiRequest$1(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};t.body&&(r["content-type"]="application/json");var n=xtend$1(r,t.headers),a=Object.keys(n).reduce(function(s,f){return s[f.toLowerCase()]=n[f],s},{});this.id=requestId++,this._options=t,this.emitter=new EventEmitter,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=a}MapiRequest$1.prototype.url=function e(t){var r=urlUtils.prependOrigin(this.path,this.origin);r=urlUtils.appendQueryObject(r,this.query);var n=this.params,a=t??this.client.accessToken;if(a){r=urlUtils.appendQueryParam(r,"access_token",a);var s=parseToken$1(a).user;n=xtend$1({ownerId:s},n)}return r=urlUtils.interpolateRouteParams(r,n),r};MapiRequest$1.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(r){return t.response=r,t.emitter.emit(constants$3.EVENT_RESPONSE,r),r},function(r){throw t.error=r,t.emitter.emit(constants$3.EVENT_ERROR,r),r})};MapiRequest$1.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function e(t){var r=this;function n(f){function o(){delete r._nextPageRequest;var x=f.nextPage();x&&(r._nextPageRequest=x,s(x))}t(null,f,o)}function a(f){t(f,null,function(){})}function s(f){f.send().then(n,a)}s(this)};MapiRequest$1.prototype.clone=function e(){return this._extend()};MapiRequest$1.prototype._extend=function e(t){var r=xtend$1(this._options,t);return new MapiRequest$1(this.client,r)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants$2=constants$4;function MapiClient$2(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$2.API_ORIGIN}MapiClient$2.prototype.createRequest=function e(t){return new MapiRequest(this,t)};var mapiClient=MapiClient$2;function parseParam(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var r=t[1],n=t[2].split(";"),a=null,s=n.reduce(function(f,o){var x=parseParam(o);return x?x.key==="rel"?(a||(a=x.value),f):(f[x.key]=x.value,f):f},{});return a?{url:r,rel:a,params:s}:null}function parseLinkHeader$1(e){return e?e.split(/,\s*</).reduce(function(t,r){var n=parseLink(r);if(!n)return t;var a=n.rel.split(/\s+/);return a.forEach(function(s){t[s]||(t[s]={url:n.url,params:n.params})}),t},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$1=constants$4;function MapiError$1(e){var t=e.type||constants$1.ERROR_HTTP,r;if(e.body)try{r=JSON.parse(e.body)}catch{r=e.body}else r=null;var n=e.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:t===constants$1.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=r}var mapiError=MapiError$1;function parseSingleHeader(e){var t=e.indexOf(":"),r=e.substring(0,t).trim().toLowerCase(),n=e.substring(t+1).trim();return{name:r,value:n}}function parseHeaders$1(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(r){var n=parseSingleHeader(r);t[n.name]=n.value}),t}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants=constants$4,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(e){var t=requestsUnderway[e.id];t&&(t.abort(),delete requestsUnderway[e.id])}function createResponse(e,t){return new MapiResponse(e,{body:t.response,headers:parseHeaders(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent(e){var t=e.total,r=e.loaded,n=100*r/t;return{total:t,transferred:r,percent:n}}function sendRequestXhr(e,t){return new Promise(function(r,n){t.onprogress=function(f){e.emitter.emit(constants.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(f))};var a=e.file;a&&(t.upload.onprogress=function(f){e.emitter.emit(constants.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(f))}),t.onerror=function(f){n(f)},t.onabort=function(){var f=new MapiError({request:e,type:constants.ERROR_REQUEST_ABORTED});n(f)},t.onload=function(){if(delete requestsUnderway[e.id],t.status<200||t.status>=400){var f=new MapiError({request:e,body:t.response,statusCode:t.status});n(f);return}r(t)};var s=e.body;typeof s=="string"?t.send(s):s?t.send(JSON.stringify(s)):a?t.send(a):t.send(),requestsUnderway[e.id]=t}).then(function(r){return createResponse(e,r)})}function createRequestXhr(e,t){var r=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(a){n.setRequestHeader(a,e.headers[a])}),n}function browserSend(e){return Promise.resolve().then(function(){var t=createRequestXhr(e,e.client.accessToken);return sendRequestXhr(e,t)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(e){MapiClient$1.call(this,e)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(e){return new BrowserClient(e)}var browserClient=createBrowserClient,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(e){return function(t){var r;MapiClient.prototype.isPrototypeOf(t)?r=t:r=createClient(t);var n=Object.create(e);return n.client=r,n}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v$1=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(e){v$1.assertShape({query:v$1.required(v$1.string),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),proximity:v$1.oneOf(v$1.coordinates,"ip"),types:v$1.arrayOf(v$1.oneOf(featureTypes)),autocomplete:v$1.boolean,bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),routing:v$1.boolean,fuzzyMatch:v$1.boolean,worldview:v$1.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};Geocoding.reverseGeocode=function(e){v$1.assertShape({query:v$1.required(v$1.coordinates),mode:v$1.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$1.arrayOf(v$1.string),types:v$1.arrayOf(v$1.oneOf(featureTypes)),bbox:v$1.arrayOf(v$1.number),limit:v$1.number,language:v$1.arrayOf(v$1.string),reverseMode:v$1.oneOf("distance","score"),routing:v$1.boolean,worldview:v$1.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};var geocoding$1=createServiceFactory(Geocoding);const mbxGeocoding=getDefaultExportFromCjs(geocoding$1);var mapboxGlDraw$1={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){var r=function(yr,Js){var uh={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Vh={on:function(Wh,pd,$f){if(uh[Wh]===void 0)throw new Error("Invalid event type: "+Wh);uh[Wh].push({selector:pd,fn:$f})},render:function(Wh){Js.store.featureChanged(Wh)}},od=function(Wh,pd){for(var $f=uh[Wh],Tf=$f.length;Tf--;){var rp=$f[Tf];if(rp.selector(pd)){rp.fn.call(Vh,pd)||Js.store.render(),Js.ui.updateMapClasses();break}}};return yr.start.call(Vh),{render:yr.render,stop:function(){yr.stop&&yr.stop()},trash:function(){yr.trash&&(yr.trash(),Js.store.render())},combineFeatures:function(){yr.combineFeatures&&yr.combineFeatures()},uncombineFeatures:function(){yr.uncombineFeatures&&yr.uncombineFeatures()},drag:function(Wh){od("drag",Wh)},click:function(Wh){od("click",Wh)},mousemove:function(Wh){od("mousemove",Wh)},mousedown:function(Wh){od("mousedown",Wh)},mouseup:function(Wh){od("mouseup",Wh)},mouseout:function(Wh){od("mouseout",Wh)},keydown:function(Wh){od("keydown",Wh)},keyup:function(Wh){od("keyup",Wh)},touchstart:function(Wh){od("touchstart",Wh)},touchmove:function(Wh){od("touchmove",Wh)},touchend:function(Wh){od("touchend",Wh)},tap:function(Wh){od("tap",Wh)}}};function n(yr){if(yr.__esModule)return yr;var Js=yr.default;if(typeof Js=="function"){var uh=function Vh(){if(this instanceof Vh){var od=[null];od.push.apply(od,arguments);var Wh=Function.bind.apply(Js,od);return new Wh}return Js.apply(this,arguments)};uh.prototype=Js.prototype}else uh={};return Object.defineProperty(uh,"__esModule",{value:!0}),Object.keys(yr).forEach(function(Vh){var od=Object.getOwnPropertyDescriptor(yr,Vh);Object.defineProperty(uh,Vh,od.get?od:{enumerable:!0,get:function(){return yr[Vh]}})}),uh}var a={},s={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},f=s;function o(yr){var Js=0;if(yr&&yr.length>0){Js+=Math.abs(x(yr[0]));for(var uh=1;uh<yr.length;uh++)Js-=Math.abs(x(yr[uh]))}return Js}function x(yr){var Js,uh,Vh,od,Wh,pd,$f=0,Tf=yr.length;if(Tf>2){for(pd=0;pd<Tf;pd++)pd===Tf-2?(Vh=Tf-2,od=Tf-1,Wh=0):pd===Tf-1?(Vh=Tf-1,od=0,Wh=1):(Vh=pd,od=pd+1,Wh=pd+2),Js=yr[Vh],uh=yr[od],$f+=(C(yr[Wh][0])-C(Js[0]))*Math.sin(C(uh[1]));$f=$f*f.RADIUS*f.RADIUS/2}return $f}function C(yr){return yr*Math.PI/180}a.geometry=function yr(Js){var uh,Vh=0;switch(Js.type){case"Polygon":return o(Js.coordinates);case"MultiPolygon":for(uh=0;uh<Js.coordinates.length;uh++)Vh+=o(Js.coordinates[uh]);return Vh;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(uh=0;uh<Js.geometries.length;uh++)Vh+=yr(Js.geometries[uh]);return Vh}},a.ring=x;var P={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},ge={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},nt={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ze={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Bt={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},qr={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},_n={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Fn={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},tl={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Io={ACTIVE:"true",INACTIVE:"false"},Co=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],rl=-85,ah=Object.freeze({__proto__:null,classes:P,sources:ge,cursors:nt,types:ze,geojsonTypes:Bt,modes:qr,events:_n,updateActions:Fn,meta:tl,activeStates:Io,interactions:Co,LAT_MIN:-90,LAT_RENDERED_MIN:rl,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ch={Point:0,LineString:1,MultiLineString:1,Polygon:2};function ju(yr,Js){var uh=ch[yr.geometry.type]-ch[Js.geometry.type];return uh===0&&yr.geometry.type===Bt.POLYGON?yr.area-Js.area:uh}function Zu(yr){return yr.map(function(Js){return Js.geometry.type===Bt.POLYGON&&(Js.area=a.geometry({type:Bt.FEATURE,property:{},geometry:Js.geometry})),Js}).sort(ju).map(function(Js){return delete Js.area,Js})}function sl(yr,Js){return Js===void 0&&(Js=0),[[yr.point.x-Js,yr.point.y-Js],[yr.point.x+Js,yr.point.y+Js]]}function oh(yr){if(this._items={},this._nums={},this._length=yr?yr.length:0,yr)for(var Js=0,uh=yr.length;Js<uh;Js++)this.add(yr[Js]),yr[Js]!==void 0&&(typeof yr[Js]=="string"?this._items[yr[Js]]=Js:this._nums[yr[Js]]=Js)}oh.prototype.add=function(yr){return this.has(yr)||(this._length++,typeof yr=="string"?this._items[yr]=this._length:this._nums[yr]=this._length),this},oh.prototype.delete=function(yr){return this.has(yr)===!1||(this._length--,delete this._items[yr],delete this._nums[yr]),this},oh.prototype.has=function(yr){return(typeof yr=="string"||typeof yr=="number")&&(this._items[yr]!==void 0||this._nums[yr]!==void 0)},oh.prototype.values=function(){var yr=this,Js=[];return Object.keys(this._items).forEach(function(uh){Js.push({k:uh,v:yr._items[uh]})}),Object.keys(this._nums).forEach(function(uh){Js.push({k:JSON.parse(uh),v:yr._nums[uh]})}),Js.sort(function(uh,Vh){return uh.v-Vh.v}).map(function(uh){return uh.k})},oh.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var hh=[tl.FEATURE,tl.MIDPOINT,tl.VERTEX],Sh={click:function(yr,Js,uh){return $h(yr,Js,uh,uh.options.clickBuffer)},touch:function(yr,Js,uh){return $h(yr,Js,uh,uh.options.touchBuffer)}};function $h(yr,Js,uh,Vh){if(uh.map===null)return[];var od=yr?sl(yr,Vh):Js,Wh={};uh.options.styles&&(Wh.layers=uh.options.styles.map(function(rp){return rp.id}));var pd=uh.map.queryRenderedFeatures(od,Wh).filter(function(rp){return hh.indexOf(rp.properties.meta)!==-1}),$f=new oh,Tf=[];return pd.forEach(function(rp){var Gf=rp.properties.id;$f.has(Gf)||($f.add(Gf),Tf.push(rp))}),Zu(Tf)}function hd(yr,Js){var uh=Sh.click(yr,null,Js),Vh={mouse:nt.NONE};return uh[0]&&(Vh.mouse=uh[0].properties.active===Io.ACTIVE?nt.MOVE:nt.POINTER,Vh.feature=uh[0].properties.meta),Js.events.currentModeName().indexOf("draw")!==-1&&(Vh.mouse=nt.ADD),Js.ui.queueMapClasses(Vh),Js.ui.updateMapClasses(),uh[0]}function vd(yr,Js){var uh=yr.x-Js.x,Vh=yr.y-Js.y;return Math.sqrt(uh*uh+Vh*Vh)}function Ef(yr,Js,uh){uh===void 0&&(uh={});var Vh=uh.fineTolerance!=null?uh.fineTolerance:4,od=uh.grossTolerance!=null?uh.grossTolerance:12,Wh=uh.interval!=null?uh.interval:500;yr.point=yr.point||Js.point,yr.time=yr.time||Js.time;var pd=vd(yr.point,Js.point);return pd<Vh||pd<od&&Js.time-yr.time<Wh}function Cd(yr,Js,uh){uh===void 0&&(uh={});var Vh=uh.tolerance!=null?uh.tolerance:25,od=uh.interval!=null?uh.interval:250;return yr.point=yr.point||Js.point,yr.time=yr.time||Js.time,vd(yr.point,Js.point)<Vh&&Js.time-yr.time<od}var Cf={},Sd={get exports(){return Cf},set exports(yr){Cf=yr}}.exports=function(yr,Js){if(Js||(Js=16),yr===void 0&&(yr=128),yr<=0)return"0";for(var uh=Math.log(Math.pow(2,yr))/Math.log(Js),Vh=2;uh===1/0;Vh*=2)uh=Math.log(Math.pow(2,yr/Vh))/Math.log(Js)*Vh;var od=uh-Math.floor(uh),Wh="";for(Vh=0;Vh<Math.floor(uh);Vh++)Wh=Math.floor(Math.random()*Js).toString(Js)+Wh;if(od){var pd=Math.pow(Js,od);Wh=Math.floor(Math.random()*pd).toString(Js)+Wh}var $f=parseInt(Wh,Js);return $f!==1/0&&$f>=Math.pow(2,yr)?Sd(yr,Js):Wh};Sd.rack=function(yr,Js,uh){var Vh=function(Wh){var pd=0;do{if(pd++>10){if(!uh)throw new Error("too many ID collisions, use more bits");yr+=uh}var $f=Sd(yr,Js)}while(Object.hasOwnProperty.call(od,$f));return od[$f]=Wh,$f},od=Vh.hats={};return Vh.get=function(Wh){return Vh.hats[Wh]},Vh.set=function(Wh,pd){return Vh.hats[Wh]=pd,Vh},Vh.bits=yr||128,Vh.base=Js||16,Vh};var yd=function(yr,Js){this.ctx=yr,this.properties=Js.properties||{},this.coordinates=Js.geometry.coordinates,this.id=Js.id||Cf(),this.type=Js.geometry.type};yd.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},yd.prototype.incomingCoords=function(yr){this.setCoordinates(yr)},yd.prototype.setCoordinates=function(yr){this.coordinates=yr,this.changed()},yd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},yd.prototype.setProperty=function(yr,Js){this.properties[yr]=Js},yd.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Bt.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},yd.prototype.internal=function(yr){var Js={id:this.id,meta:tl.FEATURE,"meta:type":this.type,active:Io.INACTIVE,mode:yr};if(this.ctx.options.userProperties)for(var uh in this.properties)Js["user_"+uh]=this.properties[uh];return{type:Bt.FEATURE,properties:Js,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Hd=function(yr,Js){yd.call(this,yr,Js)};(Hd.prototype=Object.create(yd.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Hd.prototype.updateCoordinate=function(yr,Js,uh){this.coordinates=arguments.length===3?[Js,uh]:[yr,Js],this.changed()},Hd.prototype.getCoordinate=function(){return this.getCoordinates()};var xd=function(yr,Js){yd.call(this,yr,Js)};(xd.prototype=Object.create(yd.prototype)).isValid=function(){return this.coordinates.length>1},xd.prototype.addCoordinate=function(yr,Js,uh){this.changed();var Vh=parseInt(yr,10);this.coordinates.splice(Vh,0,[Js,uh])},xd.prototype.getCoordinate=function(yr){var Js=parseInt(yr,10);return JSON.parse(JSON.stringify(this.coordinates[Js]))},xd.prototype.removeCoordinate=function(yr){this.changed(),this.coordinates.splice(parseInt(yr,10),1)},xd.prototype.updateCoordinate=function(yr,Js,uh){var Vh=parseInt(yr,10);this.coordinates[Vh]=[Js,uh],this.changed()};var Pd=function(yr,Js){yd.call(this,yr,Js),this.coordinates=this.coordinates.map(function(uh){return uh.slice(0,-1)})};(Pd.prototype=Object.create(yd.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(yr){return yr.length>2})},Pd.prototype.incomingCoords=function(yr){this.coordinates=yr.map(function(Js){return Js.slice(0,-1)}),this.changed()},Pd.prototype.setCoordinates=function(yr){this.coordinates=yr,this.changed()},Pd.prototype.addCoordinate=function(yr,Js,uh){this.changed();var Vh=yr.split(".").map(function(od){return parseInt(od,10)});this.coordinates[Vh[0]].splice(Vh[1],0,[Js,uh])},Pd.prototype.removeCoordinate=function(yr){this.changed();var Js=yr.split(".").map(function(Vh){return parseInt(Vh,10)}),uh=this.coordinates[Js[0]];uh&&(uh.splice(Js[1],1),uh.length<3&&this.coordinates.splice(Js[0],1))},Pd.prototype.getCoordinate=function(yr){var Js=yr.split(".").map(function(Vh){return parseInt(Vh,10)}),uh=this.coordinates[Js[0]];return JSON.parse(JSON.stringify(uh[Js[1]]))},Pd.prototype.getCoordinates=function(){return this.coordinates.map(function(yr){return yr.concat([yr[0]])})},Pd.prototype.updateCoordinate=function(yr,Js,uh){this.changed();var Vh=yr.split("."),od=parseInt(Vh[0],10),Wh=parseInt(Vh[1],10);this.coordinates[od]===void 0&&(this.coordinates[od]=[]),this.coordinates[od][Wh]=[Js,uh]};var zd={MultiPoint:Hd,MultiLineString:xd,MultiPolygon:Pd},Ld=function(yr,Js,uh,Vh,od){var Wh=uh.split("."),pd=parseInt(Wh[0],10),$f=Wh[1]?Wh.slice(1).join("."):null;return yr[pd][Js]($f,Vh,od)},Kd=function(yr,Js){if(yd.call(this,yr,Js),delete this.coordinates,this.model=zd[Js.geometry.type],this.model===void 0)throw new TypeError(Js.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(Js.geometry.coordinates)};function wf(yr){this.map=yr.map,this.drawConfig=JSON.parse(JSON.stringify(yr.options||{})),this._ctx=yr}(Kd.prototype=Object.create(yd.prototype))._coordinatesToFeatures=function(yr){var Js=this,uh=this.model.bind(this);return yr.map(function(Vh){return new uh(Js.ctx,{id:Cf(),type:Bt.FEATURE,properties:{},geometry:{coordinates:Vh,type:Js.type.replace("Multi","")}})})},Kd.prototype.isValid=function(){return this.features.every(function(yr){return yr.isValid()})},Kd.prototype.setCoordinates=function(yr){this.features=this._coordinatesToFeatures(yr),this.changed()},Kd.prototype.getCoordinate=function(yr){return Ld(this.features,"getCoordinate",yr)},Kd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(yr){return yr.type===Bt.POLYGON?yr.getCoordinates():yr.coordinates})))},Kd.prototype.updateCoordinate=function(yr,Js,uh){Ld(this.features,"updateCoordinate",yr,Js,uh),this.changed()},Kd.prototype.addCoordinate=function(yr,Js,uh){Ld(this.features,"addCoordinate",yr,Js,uh),this.changed()},Kd.prototype.removeCoordinate=function(yr){Ld(this.features,"removeCoordinate",yr),this.changed()},Kd.prototype.getFeatures=function(){return this.features},wf.prototype.setSelected=function(yr){return this._ctx.store.setSelected(yr)},wf.prototype.setSelectedCoordinates=function(yr){var Js=this;this._ctx.store.setSelectedCoordinates(yr),yr.reduce(function(uh,Vh){return uh[Vh.feature_id]===void 0&&(uh[Vh.feature_id]=!0,Js._ctx.store.get(Vh.feature_id).changed()),uh},{})},wf.prototype.getSelected=function(){return this._ctx.store.getSelected()},wf.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},wf.prototype.isSelected=function(yr){return this._ctx.store.isSelected(yr)},wf.prototype.getFeature=function(yr){return this._ctx.store.get(yr)},wf.prototype.select=function(yr){return this._ctx.store.select(yr)},wf.prototype.deselect=function(yr){return this._ctx.store.deselect(yr)},wf.prototype.deleteFeature=function(yr,Js){return Js===void 0&&(Js={}),this._ctx.store.delete(yr,Js)},wf.prototype.addFeature=function(yr){return this._ctx.store.add(yr)},wf.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},wf.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},wf.prototype.setActionableState=function(yr){yr===void 0&&(yr={});var Js={trash:yr.trash||!1,combineFeatures:yr.combineFeatures||!1,uncombineFeatures:yr.uncombineFeatures||!1};return this._ctx.events.actionable(Js)},wf.prototype.changeMode=function(yr,Js,uh){return Js===void 0&&(Js={}),uh===void 0&&(uh={}),this._ctx.events.changeMode(yr,Js,uh)},wf.prototype.updateUIClasses=function(yr){return this._ctx.ui.queueMapClasses(yr)},wf.prototype.activateUIButton=function(yr){return this._ctx.ui.setActiveButton(yr)},wf.prototype.featuresAt=function(yr,Js,uh){if(uh===void 0&&(uh="click"),uh!=="click"&&uh!=="touch")throw new Error("invalid buffer type");return Sh[uh](yr,Js,this._ctx)},wf.prototype.newFeature=function(yr){var Js=yr.geometry.type;return Js===Bt.POINT?new Hd(this._ctx,yr):Js===Bt.LINE_STRING?new xd(this._ctx,yr):Js===Bt.POLYGON?new Pd(this._ctx,yr):new Kd(this._ctx,yr)},wf.prototype.isInstanceOf=function(yr,Js){if(yr===Bt.POINT)return Js instanceof Hd;if(yr===Bt.LINE_STRING)return Js instanceof xd;if(yr===Bt.POLYGON)return Js instanceof Pd;if(yr==="MultiFeature")return Js instanceof Kd;throw new Error("Unknown feature class: "+yr)},wf.prototype.doRender=function(yr){return this._ctx.store.featureChanged(yr)},wf.prototype.onSetup=function(){},wf.prototype.onDrag=function(){},wf.prototype.onClick=function(){},wf.prototype.onMouseMove=function(){},wf.prototype.onMouseDown=function(){},wf.prototype.onMouseUp=function(){},wf.prototype.onMouseOut=function(){},wf.prototype.onKeyUp=function(){},wf.prototype.onKeyDown=function(){},wf.prototype.onTouchStart=function(){},wf.prototype.onTouchMove=function(){},wf.prototype.onTouchEnd=function(){},wf.prototype.onTap=function(){},wf.prototype.onStop=function(){},wf.prototype.onTrash=function(){},wf.prototype.onCombineFeature=function(){},wf.prototype.onUncombineFeature=function(){},wf.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var kd={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},cd=Object.keys(kd);function gd(yr){var Js=Object.keys(yr);return function(uh,Vh){Vh===void 0&&(Vh={});var od={},Wh=Js.reduce(function(pd,$f){return pd[$f]=yr[$f],pd},new wf(uh));return{start:function(){var pd=this;od=Wh.onSetup(Vh),cd.forEach(function($f){var Tf,rp=kd[$f],Gf=function(){return!1};yr[rp]&&(Gf=function(){return!0}),pd.on($f,Gf,(Tf=rp,function(op){return Wh[Tf](od,op)}))})},stop:function(){Wh.onStop(od)},trash:function(){Wh.onTrash(od)},combineFeatures:function(){Wh.onCombineFeatures(od)},uncombineFeatures:function(){Wh.onUncombineFeatures(od)},render:function(pd,$f){Wh.toDisplayFeatures(od,pd,$f)}}}}function bp(yr){return[].concat(yr).filter(function(Js){return Js!==void 0})}function Uf(){var yr=this;if(!(yr.ctx.map&&yr.ctx.map.getSource(ge.HOT)!==void 0))return Tf();var Js=yr.ctx.events.currentModeName();yr.ctx.ui.queueMapClasses({mode:Js});var uh=[],Vh=[];yr.isDirty?Vh=yr.getAllIds():(uh=yr.getChangedIds().filter(function(rp){return yr.get(rp)!==void 0}),Vh=yr.sources.hot.filter(function(rp){return rp.properties.id&&uh.indexOf(rp.properties.id)===-1&&yr.get(rp.properties.id)!==void 0}).map(function(rp){return rp.properties.id})),yr.sources.hot=[];var od=yr.sources.cold.length;yr.sources.cold=yr.isDirty?[]:yr.sources.cold.filter(function(rp){var Gf=rp.properties.id||rp.properties.parent;return uh.indexOf(Gf)===-1});var Wh=od!==yr.sources.cold.length||Vh.length>0;function pd(rp,Gf){var op=yr.get(rp).internal(Js);yr.ctx.events.currentModeRender(op,function(Vp){yr.sources[Gf].push(Vp)})}if(uh.forEach(function(rp){return pd(rp,"hot")}),Vh.forEach(function(rp){return pd(rp,"cold")}),Wh&&yr.ctx.map.getSource(ge.COLD).setData({type:Bt.FEATURE_COLLECTION,features:yr.sources.cold}),yr.ctx.map.getSource(ge.HOT).setData({type:Bt.FEATURE_COLLECTION,features:yr.sources.hot}),yr._emitSelectionChange&&(yr.ctx.map.fire(_n.SELECTION_CHANGE,{features:yr.getSelected().map(function(rp){return rp.toGeoJSON()}),points:yr.getSelectedCoordinates().map(function(rp){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:rp.coordinates}}})}),yr._emitSelectionChange=!1),yr._deletedFeaturesToEmit.length){var $f=yr._deletedFeaturesToEmit.map(function(rp){return rp.toGeoJSON()});yr._deletedFeaturesToEmit=[],yr.ctx.map.fire(_n.DELETE,{features:$f})}function Tf(){yr.isDirty=!1,yr.clearChangedIds()}Tf(),yr.ctx.map.fire(_n.RENDER,{})}function qd(yr){var Js,uh=this;this._features={},this._featureIds=new oh,this._selectedFeatureIds=new oh,this._selectedCoordinates=[],this._changedFeatureIds=new oh,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=yr,this.sources={hot:[],cold:[]},this.render=function(){Js||(Js=requestAnimationFrame(function(){Js=null,Uf.call(uh)}))},this.isDirty=!1}function Vd(yr,Js){var uh=yr._selectedCoordinates.filter(function(Vh){return yr._selectedFeatureIds.has(Vh.feature_id)});yr._selectedCoordinates.length===uh.length||Js.silent||(yr._emitSelectionChange=!0),yr._selectedCoordinates=uh}qd.prototype.createRenderBatch=function(){var yr=this,Js=this.render,uh=0;return this.render=function(){uh++},function(){yr.render=Js,uh>0&&yr.render()}},qd.prototype.setDirty=function(){return this.isDirty=!0,this},qd.prototype.featureChanged=function(yr){return this._changedFeatureIds.add(yr),this},qd.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},qd.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},qd.prototype.getAllIds=function(){return this._featureIds.values()},qd.prototype.add=function(yr){return this.featureChanged(yr.id),this._features[yr.id]=yr,this._featureIds.add(yr.id),this},qd.prototype.delete=function(yr,Js){var uh=this;return Js===void 0&&(Js={}),bp(yr).forEach(function(Vh){uh._featureIds.has(Vh)&&(uh._featureIds.delete(Vh),uh._selectedFeatureIds.delete(Vh),Js.silent||uh._deletedFeaturesToEmit.indexOf(uh._features[Vh])===-1&&uh._deletedFeaturesToEmit.push(uh._features[Vh]),delete uh._features[Vh],uh.isDirty=!0)}),Vd(this,Js),this},qd.prototype.get=function(yr){return this._features[yr]},qd.prototype.getAll=function(){var yr=this;return Object.keys(this._features).map(function(Js){return yr._features[Js]})},qd.prototype.select=function(yr,Js){var uh=this;return Js===void 0&&(Js={}),bp(yr).forEach(function(Vh){uh._selectedFeatureIds.has(Vh)||(uh._selectedFeatureIds.add(Vh),uh._changedFeatureIds.add(Vh),Js.silent||(uh._emitSelectionChange=!0))}),this},qd.prototype.deselect=function(yr,Js){var uh=this;return Js===void 0&&(Js={}),bp(yr).forEach(function(Vh){uh._selectedFeatureIds.has(Vh)&&(uh._selectedFeatureIds.delete(Vh),uh._changedFeatureIds.add(Vh),Js.silent||(uh._emitSelectionChange=!0))}),Vd(this,Js),this},qd.prototype.clearSelected=function(yr){return yr===void 0&&(yr={}),this.deselect(this._selectedFeatureIds.values(),{silent:yr.silent}),this},qd.prototype.setSelected=function(yr,Js){var uh=this;return Js===void 0&&(Js={}),yr=bp(yr),this.deselect(this._selectedFeatureIds.values().filter(function(Vh){return yr.indexOf(Vh)===-1}),{silent:Js.silent}),this.select(yr.filter(function(Vh){return!uh._selectedFeatureIds.has(Vh)}),{silent:Js.silent}),this},qd.prototype.setSelectedCoordinates=function(yr){return this._selectedCoordinates=yr,this._emitSelectionChange=!0,this},qd.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},qd.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},qd.prototype.getSelected=function(){var yr=this;return this._selectedFeatureIds.values().map(function(Js){return yr.get(Js)})},qd.prototype.getSelectedCoordinates=function(){var yr=this;return this._selectedCoordinates.map(function(Js){return{coordinates:yr.get(Js.feature_id).getCoordinate(Js.coord_path)}})},qd.prototype.isSelected=function(yr){return this._selectedFeatureIds.has(yr)},qd.prototype.setFeatureProperty=function(yr,Js,uh){this.get(yr).setProperty(Js,uh),this.featureChanged(yr)},qd.prototype.storeMapConfig=function(){var yr=this;Co.forEach(function(Js){yr.ctx.map[Js]&&(yr._mapInitialConfig[Js]=yr.ctx.map[Js].isEnabled())})},qd.prototype.restoreMapConfig=function(){var yr=this;Object.keys(this._mapInitialConfig).forEach(function(Js){yr._mapInitialConfig[Js]?yr.ctx.map[Js].enable():yr.ctx.map[Js].disable()})},qd.prototype.getInitialConfigValue=function(yr){return this._mapInitialConfig[yr]===void 0||this._mapInitialConfig[yr]};var ep=function(){for(var yr=arguments,Js={},uh=0;uh<arguments.length;uh++){var Vh=yr[uh];for(var od in Vh)_p.call(Vh,od)&&(Js[od]=Vh[od])}return Js},_p=Object.prototype.hasOwnProperty,lp=["mode","feature","mouse"];function Kh(yr){var Js=null,uh=null,Vh={onRemove:function(){return yr.map.off("load",Vh.connect),clearInterval(uh),Vh.removeLayers(),yr.store.restoreMapConfig(),yr.ui.removeButtons(),yr.events.removeEventListeners(),yr.ui.clearMapClasses(),yr.map=null,yr.container=null,yr.store=null,Js&&Js.parentNode&&Js.parentNode.removeChild(Js),Js=null,this},connect:function(){yr.map.off("load",Vh.connect),clearInterval(uh),Vh.addLayers(),yr.store.storeMapConfig(),yr.events.addEventListeners()},onAdd:function(od){var Wh=od.fire;return od.fire=function(pd,$f){var Tf=arguments;return Wh.length===1&&arguments.length!==1&&(Tf=[ep({},{type:pd},$f)]),Wh.apply(od,Tf)},yr.map=od,yr.events=function(pd){var $f=Object.keys(pd.options.modes).reduce(function(Mf,Cp){return Mf[Cp]=gd(pd.options.modes[Cp]),Mf},{}),Tf={},rp={},Gf={},op=null,Vp=null;Gf.drag=function(Mf,Cp){Cp({point:Mf.point,time:new Date().getTime()})?(pd.ui.queueMapClasses({mouse:nt.DRAG}),Vp.drag(Mf)):Mf.originalEvent.stopPropagation()},Gf.mousedrag=function(Mf){Gf.drag(Mf,function(Cp){return!Ef(Tf,Cp)})},Gf.touchdrag=function(Mf){Gf.drag(Mf,function(Cp){return!Cd(rp,Cp)})},Gf.mousemove=function(Mf){if((Mf.originalEvent.buttons!==void 0?Mf.originalEvent.buttons:Mf.originalEvent.which)===1)return Gf.mousedrag(Mf);var Cp=hd(Mf,pd);Mf.featureTarget=Cp,Vp.mousemove(Mf)},Gf.mousedown=function(Mf){Tf={time:new Date().getTime(),point:Mf.point};var Cp=hd(Mf,pd);Mf.featureTarget=Cp,Vp.mousedown(Mf)},Gf.mouseup=function(Mf){var Cp=hd(Mf,pd);Mf.featureTarget=Cp,Ef(Tf,{point:Mf.point,time:new Date().getTime()})?Vp.click(Mf):Vp.mouseup(Mf)},Gf.mouseout=function(Mf){Vp.mouseout(Mf)},Gf.touchstart=function(Mf){if(Mf.originalEvent.preventDefault(),pd.options.touchEnabled){rp={time:new Date().getTime(),point:Mf.point};var Cp=Sh.touch(Mf,null,pd)[0];Mf.featureTarget=Cp,Vp.touchstart(Mf)}},Gf.touchmove=function(Mf){if(Mf.originalEvent.preventDefault(),pd.options.touchEnabled)return Vp.touchmove(Mf),Gf.touchdrag(Mf)},Gf.touchend=function(Mf){if(Mf.originalEvent.preventDefault(),pd.options.touchEnabled){var Cp=Sh.touch(Mf,null,pd)[0];Mf.featureTarget=Cp,Cd(rp,{time:new Date().getTime(),point:Mf.point})?Vp.tap(Mf):Vp.touchend(Mf)}};var Sm=function(Mf){return!(Mf===8||Mf===46||Mf>=48&&Mf<=57)};function Xp(Mf,Cp,Kp){Kp===void 0&&(Kp={}),Vp.stop();var Ym=$f[Mf];if(Ym===void 0)throw new Error(Mf+" is not valid");op=Mf;var Mm=Ym(pd,Cp);Vp=r(Mm,pd),Kp.silent||pd.map.fire(_n.MODE_CHANGE,{mode:Mf}),pd.store.setDirty(),pd.store.render()}Gf.keydown=function(Mf){(Mf.srcElement||Mf.target).classList[0]==="mapboxgl-canvas"&&(Mf.keyCode!==8&&Mf.keyCode!==46||!pd.options.controls.trash?Sm(Mf.keyCode)?Vp.keydown(Mf):Mf.keyCode===49&&pd.options.controls.point?Xp(qr.DRAW_POINT):Mf.keyCode===50&&pd.options.controls.line_string?Xp(qr.DRAW_LINE_STRING):Mf.keyCode===51&&pd.options.controls.polygon&&Xp(qr.DRAW_POLYGON):(Mf.preventDefault(),Vp.trash()))},Gf.keyup=function(Mf){Sm(Mf.keyCode)&&Vp.keyup(Mf)},Gf.zoomend=function(){pd.store.changeZoom()},Gf.data=function(Mf){if(Mf.dataType==="style"){var Cp=pd.setup,Kp=pd.map,Ym=pd.options,Mm=pd.store;Ym.styles.some(function(lg){return Kp.getLayer(lg.id)})||(Cp.addLayers(),Mm.setDirty(),Mm.render())}};var Dm={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){op=pd.options.defaultMode,Vp=r($f[op](pd),pd)},changeMode:Xp,actionable:function(Mf){var Cp=!1;Object.keys(Mf).forEach(function(Kp){if(Dm[Kp]===void 0)throw new Error("Invalid action type");Dm[Kp]!==Mf[Kp]&&(Cp=!0),Dm[Kp]=Mf[Kp]}),Cp&&pd.map.fire(_n.ACTIONABLE,{actions:Dm})},currentModeName:function(){return op},currentModeRender:function(Mf,Cp){return Vp.render(Mf,Cp)},fire:function(Mf,Cp){Gf[Mf]&&Gf[Mf](Cp)},addEventListeners:function(){pd.map.on("mousemove",Gf.mousemove),pd.map.on("mousedown",Gf.mousedown),pd.map.on("mouseup",Gf.mouseup),pd.map.on("data",Gf.data),pd.map.on("touchmove",Gf.touchmove),pd.map.on("touchstart",Gf.touchstart),pd.map.on("touchend",Gf.touchend),pd.container.addEventListener("mouseout",Gf.mouseout),pd.options.keybindings&&(pd.container.addEventListener("keydown",Gf.keydown),pd.container.addEventListener("keyup",Gf.keyup))},removeEventListeners:function(){pd.map.off("mousemove",Gf.mousemove),pd.map.off("mousedown",Gf.mousedown),pd.map.off("mouseup",Gf.mouseup),pd.map.off("data",Gf.data),pd.map.off("touchmove",Gf.touchmove),pd.map.off("touchstart",Gf.touchstart),pd.map.off("touchend",Gf.touchend),pd.container.removeEventListener("mouseout",Gf.mouseout),pd.options.keybindings&&(pd.container.removeEventListener("keydown",Gf.keydown),pd.container.removeEventListener("keyup",Gf.keyup))},trash:function(Mf){Vp.trash(Mf)},combineFeatures:function(){Vp.combineFeatures()},uncombineFeatures:function(){Vp.uncombineFeatures()},getMode:function(){return op}}}(yr),yr.ui=function(pd){var $f={},Tf=null,rp={mode:null,feature:null,mouse:null},Gf={mode:null,feature:null,mouse:null};function op(Mf){Gf=ep(Gf,Mf)}function Vp(){var Mf,Cp;if(pd.container){var Kp=[],Ym=[];lp.forEach(function(Mm){Gf[Mm]!==rp[Mm]&&(Kp.push(Mm+"-"+rp[Mm]),Gf[Mm]!==null&&Ym.push(Mm+"-"+Gf[Mm]))}),Kp.length>0&&(Mf=pd.container.classList).remove.apply(Mf,Kp),Ym.length>0&&(Cp=pd.container.classList).add.apply(Cp,Ym),rp=ep(rp,Gf)}}function Sm(Mf,Cp){Cp===void 0&&(Cp={});var Kp=document.createElement("button");return Kp.className=P.CONTROL_BUTTON+" "+Cp.className,Kp.setAttribute("title",Cp.title),Cp.container.appendChild(Kp),Kp.addEventListener("click",function(Ym){if(Ym.preventDefault(),Ym.stopPropagation(),Ym.target===Tf)return Xp(),void Cp.onDeactivate();Dm(Mf),Cp.onActivate()},!0),Kp}function Xp(){Tf&&(Tf.classList.remove(P.ACTIVE_BUTTON),Tf=null)}function Dm(Mf){Xp();var Cp=$f[Mf];Cp&&Cp&&Mf!=="trash"&&(Cp.classList.add(P.ACTIVE_BUTTON),Tf=Cp)}return{setActiveButton:Dm,queueMapClasses:op,updateMapClasses:Vp,clearMapClasses:function(){op({mode:null,feature:null,mouse:null}),Vp()},addButtons:function(){var Mf=pd.options.controls,Cp=document.createElement("div");return Cp.className=P.CONTROL_GROUP+" "+P.CONTROL_BASE,Mf&&(Mf[ze.LINE]&&($f[ze.LINE]=Sm(ze.LINE,{container:Cp,className:P.CONTROL_BUTTON_LINE,title:"LineString tool "+(pd.options.keybindings?"(l)":""),onActivate:function(){return pd.events.changeMode(qr.DRAW_LINE_STRING)},onDeactivate:function(){return pd.events.trash()}})),Mf[ze.POLYGON]&&($f[ze.POLYGON]=Sm(ze.POLYGON,{container:Cp,className:P.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(pd.options.keybindings?"(p)":""),onActivate:function(){return pd.events.changeMode(qr.DRAW_POLYGON)},onDeactivate:function(){return pd.events.trash()}})),Mf[ze.POINT]&&($f[ze.POINT]=Sm(ze.POINT,{container:Cp,className:P.CONTROL_BUTTON_POINT,title:"Marker tool "+(pd.options.keybindings?"(m)":""),onActivate:function(){return pd.events.changeMode(qr.DRAW_POINT)},onDeactivate:function(){return pd.events.trash()}})),Mf.trash&&($f.trash=Sm("trash",{container:Cp,className:P.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){pd.events.trash()}})),Mf.combine_features&&($f.combine_features=Sm("combineFeatures",{container:Cp,className:P.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){pd.events.combineFeatures()}})),Mf.uncombine_features&&($f.uncombine_features=Sm("uncombineFeatures",{container:Cp,className:P.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){pd.events.uncombineFeatures()}}))),Cp},removeButtons:function(){Object.keys($f).forEach(function(Mf){var Cp=$f[Mf];Cp.parentNode&&Cp.parentNode.removeChild(Cp),delete $f[Mf]})}}}(yr),yr.container=od.getContainer(),yr.store=new qd(yr),Js=yr.ui.addButtons(),yr.options.boxSelect&&(od.boxZoom.disable(),od.dragPan.disable(),od.dragPan.enable()),od.loaded()?Vh.connect():(od.on("load",Vh.connect),uh=setInterval(function(){od.loaded()&&Vh.connect()},16)),yr.events.start(),Js},addLayers:function(){yr.map.addSource(ge.COLD,{data:{type:Bt.FEATURE_COLLECTION,features:[]},type:"geojson"}),yr.map.addSource(ge.HOT,{data:{type:Bt.FEATURE_COLLECTION,features:[]},type:"geojson"}),yr.options.styles.forEach(function(od){yr.map.addLayer(od)}),yr.store.setDirty(!0),yr.store.render()},removeLayers:function(){yr.options.styles.forEach(function(od){yr.map.getLayer(od.id)&&yr.map.removeLayer(od.id)}),yr.map.getSource(ge.COLD)&&yr.map.removeSource(ge.COLD),yr.map.getSource(ge.HOT)&&yr.map.removeSource(ge.HOT)}};return yr.setup=Vh,Vh}var Qd=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function fd(yr){return function(Js){var uh=Js.featureTarget;return!!uh&&!!uh.properties&&uh.properties.meta===yr}}function Jd(yr){return!!yr.originalEvent&&!!yr.originalEvent.shiftKey&&yr.originalEvent.button===0}function Yh(yr){return!!yr.featureTarget&&!!yr.featureTarget.properties&&yr.featureTarget.properties.active===Io.ACTIVE&&yr.featureTarget.properties.meta===tl.FEATURE}function $d(yr){return!!yr.featureTarget&&!!yr.featureTarget.properties&&yr.featureTarget.properties.active===Io.INACTIVE&&yr.featureTarget.properties.meta===tl.FEATURE}function Jf(yr){return yr.featureTarget===void 0}function Sf(yr){return!!yr.featureTarget&&!!yr.featureTarget.properties&&yr.featureTarget.properties.meta===tl.FEATURE}function If(yr){var Js=yr.featureTarget;return!!Js&&!!Js.properties&&Js.properties.meta===tl.VERTEX}function Xf(yr){return!!yr.originalEvent&&yr.originalEvent.shiftKey===!0}function Of(yr){return yr.keyCode===27}function jf(yr){return yr.keyCode===13}var Ap=Object.freeze({__proto__:null,isOfMetaType:fd,isShiftMousedown:Jd,isActiveFeature:Yh,isInactiveFeature:$d,noTarget:Jf,isFeature:Sf,isVertex:If,isShiftDown:Xf,isEscapeKey:Of,isEnterKey:jf,isTrue:function(){return!0}}),vp=Tp;function Tp(yr,Js){this.x=yr,this.y=Js}function Zf(yr,Js){var uh=Js.getBoundingClientRect();return new vp(yr.clientX-uh.left-(Js.clientLeft||0),yr.clientY-uh.top-(Js.clientTop||0))}function qp(yr,Js,uh,Vh){return{type:Bt.FEATURE,properties:{meta:tl.VERTEX,parent:yr,coord_path:uh,active:Vh?Io.ACTIVE:Io.INACTIVE},geometry:{type:Bt.POINT,coordinates:Js}}}function sm(yr,Js,uh){var Vh=Js.geometry.coordinates,od=uh.geometry.coordinates;if(Vh[1]>85||Vh[1]<rl||od[1]>85||od[1]<rl)return null;var Wh={lng:(Vh[0]+od[0])/2,lat:(Vh[1]+od[1])/2};return{type:Bt.FEATURE,properties:{meta:tl.MIDPOINT,parent:yr,lng:Wh.lng,lat:Wh.lat,coord_path:uh.properties.coord_path},geometry:{type:Bt.POINT,coordinates:[Wh.lng,Wh.lat]}}}function Wd(yr,Js,uh){Js===void 0&&(Js={}),uh===void 0&&(uh=null);var Vh,od=yr.geometry,Wh=od.type,pd=od.coordinates,$f=yr.properties&&yr.properties.id,Tf=[];function rp(op,Vp){var Sm="",Xp=null;op.forEach(function(Dm,Mf){var Cp=Vp!=null?Vp+"."+Mf:String(Mf),Kp=qp($f,Dm,Cp,Gf(Cp));if(Js.midpoints&&Xp){var Ym=sm($f,Xp,Kp);Ym&&Tf.push(Ym)}Xp=Kp;var Mm=JSON.stringify(Dm);Sm!==Mm&&Tf.push(Kp),Mf===0&&(Sm=Mm)})}function Gf(op){return!!Js.selectedPaths&&Js.selectedPaths.indexOf(op)!==-1}return Wh===Bt.POINT?Tf.push(qp($f,pd,uh,Gf(uh))):Wh===Bt.POLYGON?pd.forEach(function(op,Vp){rp(op,uh!==null?uh+"."+Vp:String(Vp))}):Wh===Bt.LINE_STRING?rp(pd,uh):Wh.indexOf(Bt.MULTI_PREFIX)===0&&(Vh=Wh.replace(Bt.MULTI_PREFIX,""),pd.forEach(function(op,Vp){var Sm={type:Bt.FEATURE,properties:yr.properties,geometry:{type:Vh,coordinates:op}};Tf=Tf.concat(Wd(Sm,Js,Vp))})),Tf}Tp.prototype={clone:function(){return new Tp(this.x,this.y)},add:function(yr){return this.clone()._add(yr)},sub:function(yr){return this.clone()._sub(yr)},multByPoint:function(yr){return this.clone()._multByPoint(yr)},divByPoint:function(yr){return this.clone()._divByPoint(yr)},mult:function(yr){return this.clone()._mult(yr)},div:function(yr){return this.clone()._div(yr)},rotate:function(yr){return this.clone()._rotate(yr)},rotateAround:function(yr,Js){return this.clone()._rotateAround(yr,Js)},matMult:function(yr){return this.clone()._matMult(yr)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(yr){return this.x===yr.x&&this.y===yr.y},dist:function(yr){return Math.sqrt(this.distSqr(yr))},distSqr:function(yr){var Js=yr.x-this.x,uh=yr.y-this.y;return Js*Js+uh*uh},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(yr){return Math.atan2(this.y-yr.y,this.x-yr.x)},angleWith:function(yr){return this.angleWithSep(yr.x,yr.y)},angleWithSep:function(yr,Js){return Math.atan2(this.x*Js-this.y*yr,this.x*yr+this.y*Js)},_matMult:function(yr){var Js=yr[0]*this.x+yr[1]*this.y,uh=yr[2]*this.x+yr[3]*this.y;return this.x=Js,this.y=uh,this},_add:function(yr){return this.x+=yr.x,this.y+=yr.y,this},_sub:function(yr){return this.x-=yr.x,this.y-=yr.y,this},_mult:function(yr){return this.x*=yr,this.y*=yr,this},_div:function(yr){return this.x/=yr,this.y/=yr,this},_multByPoint:function(yr){return this.x*=yr.x,this.y*=yr.y,this},_divByPoint:function(yr){return this.x/=yr.x,this.y/=yr.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var yr=this.y;return this.y=this.x,this.x=-yr,this},_rotate:function(yr){var Js=Math.cos(yr),uh=Math.sin(yr),Vh=Js*this.x-uh*this.y,od=uh*this.x+Js*this.y;return this.x=Vh,this.y=od,this},_rotateAround:function(yr,Js){var uh=Math.cos(yr),Vh=Math.sin(yr),od=Js.x+uh*(this.x-Js.x)-Vh*(this.y-Js.y),Wh=Js.y+Vh*(this.x-Js.x)+uh*(this.y-Js.y);return this.x=od,this.y=Wh,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tp.convert=function(yr){return yr instanceof Tp?yr:Array.isArray(yr)?new Tp(yr[0],yr[1]):yr};var $p={enable:function(yr){setTimeout(function(){yr.map&&yr.map.doubleClickZoom&&yr._ctx&&yr._ctx.store&&yr._ctx.store.getInitialConfigValue&&yr._ctx.store.getInitialConfigValue("doubleClickZoom")&&yr.map.doubleClickZoom.enable()},0)},disable:function(yr){setTimeout(function(){yr.map&&yr.map.doubleClickZoom&&yr.map.doubleClickZoom.disable()},0)}},Lh={},lh={get exports(){return Lh},set exports(yr){Lh=yr}},ih=function(yr){if(!yr||!yr.type)return null;var Js=Ah[yr.type];if(!Js)return null;if(Js==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:yr}]};if(Js==="feature")return{type:"FeatureCollection",features:[yr]};if(Js==="featurecollection")return yr},Ah={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},zh=Object.freeze({__proto__:null,default:function yr(Js){switch(Js&&Js.type||null){case"FeatureCollection":return Js.features=Js.features.reduce(function(uh,Vh){return uh.concat(yr(Vh))},[]),Js;case"Feature":return Js.geometry?yr(Js.geometry).map(function(uh){var Vh={type:"Feature",properties:JSON.parse(JSON.stringify(Js.properties)),geometry:uh};return Js.id!==void 0&&(Vh.id=Js.id),Vh}):[Js];case"MultiPoint":return Js.coordinates.map(function(uh){return{type:"Point",coordinates:uh}});case"MultiPolygon":return Js.coordinates.map(function(uh){return{type:"Polygon",coordinates:uh}});case"MultiLineString":return Js.coordinates.map(function(uh){return{type:"LineString",coordinates:uh}});case"GeometryCollection":return Js.geometries.map(yr).reduce(function(uh,Vh){return uh.concat(Vh)},[]);case"Point":case"Polygon":case"LineString":return[Js]}}}),Qh=ih,Th=n(zh),Fh=function(yr){return function Js(uh){return Array.isArray(uh)&&uh.length&&typeof uh[0]=="number"?[uh]:uh.reduce(function(Vh,od){return Array.isArray(od)&&Array.isArray(od[0])?Vh.concat(Js(od)):(Vh.push(od),Vh)},[])}(yr)};Th instanceof Function||(Th=Th.default);var al={},fh={get exports(){return al},set exports(yr){al=yr}}.exports=function(yr){return new nl(yr)};function nl(yr){this.value=yr}function Zs(yr,Js,uh){var Vh=[],od=[],Wh=!0;return function pd($f){var Tf=uh?ol($f):$f,rp={},Gf=!0,op={node:Tf,node_:$f,path:[].concat(Vh),parent:od[od.length-1],parents:od,key:Vh.slice(-1)[0],isRoot:Vh.length===0,level:Vh.length,circular:null,update:function(Xp,Dm){op.isRoot||(op.parent.node[op.key]=Xp),op.node=Xp,Dm&&(Gf=!1)},delete:function(Xp){delete op.parent.node[op.key],Xp&&(Gf=!1)},remove:function(Xp){Mh(op.parent.node)?op.parent.node.splice(op.key,1):delete op.parent.node[op.key],Xp&&(Gf=!1)},keys:null,before:function(Xp){rp.before=Xp},after:function(Xp){rp.after=Xp},pre:function(Xp){rp.pre=Xp},post:function(Xp){rp.post=Xp},stop:function(){Wh=!1},block:function(){Gf=!1}};if(!Wh)return op;function Vp(){if(typeof op.node=="object"&&op.node!==null){op.keys&&op.node_===op.node||(op.keys=sh(op.node)),op.isLeaf=op.keys.length==0;for(var Xp=0;Xp<od.length;Xp++)if(od[Xp].node_===$f){op.circular=od[Xp];break}}else op.isLeaf=!0,op.keys=null;op.notLeaf=!op.isLeaf,op.notRoot=!op.isRoot}Vp();var Sm=Js.call(op,op.node);return Sm!==void 0&&op.update&&op.update(Sm),rp.before&&rp.before.call(op,op.node),Gf&&(typeof op.node!="object"||op.node===null||op.circular||(od.push(op),Vp(),Uh(op.keys,function(Xp,Dm){Vh.push(Xp),rp.pre&&rp.pre.call(op,op.node[Xp],Xp);var Mf=pd(op.node[Xp]);uh&&Nh.call(op.node,Xp)&&(op.node[Xp]=Mf.node),Mf.isLast=Dm==op.keys.length-1,Mf.isFirst=Dm==0,rp.post&&rp.post.call(op,Mf),Vh.pop()}),od.pop()),rp.after&&rp.after.call(op,op.node)),op}(yr).node}function ol(yr){if(typeof yr=="object"&&yr!==null){var Js;if(Mh(yr))Js=[];else if(xh(yr)==="[object Date]")Js=new Date(yr.getTime?yr.getTime():yr);else if(function(od){return xh(od)==="[object RegExp]"}(yr))Js=new RegExp(yr);else if(function(od){return xh(od)==="[object Error]"}(yr))Js={message:yr.message};else if(function(od){return xh(od)==="[object Boolean]"}(yr))Js=new Boolean(yr);else if(function(od){return xh(od)==="[object Number]"}(yr))Js=new Number(yr);else if(function(od){return xh(od)==="[object String]"}(yr))Js=new String(yr);else if(Object.create&&Object.getPrototypeOf)Js=Object.create(Object.getPrototypeOf(yr));else if(yr.constructor===Object)Js={};else{var uh=yr.constructor&&yr.constructor.prototype||yr.__proto__||{},Vh=function(){};Vh.prototype=uh,Js=new Vh}return Uh(sh(yr),function(od){Js[od]=yr[od]}),Js}return yr}nl.prototype.get=function(yr){for(var Js=this.value,uh=0;uh<yr.length;uh++){var Vh=yr[uh];if(!Js||!Nh.call(Js,Vh)){Js=void 0;break}Js=Js[Vh]}return Js},nl.prototype.has=function(yr){for(var Js=this.value,uh=0;uh<yr.length;uh++){var Vh=yr[uh];if(!Js||!Nh.call(Js,Vh))return!1;Js=Js[Vh]}return!0},nl.prototype.set=function(yr,Js){for(var uh=this.value,Vh=0;Vh<yr.length-1;Vh++){var od=yr[Vh];Nh.call(uh,od)||(uh[od]={}),uh=uh[od]}return uh[yr[Vh]]=Js,Js},nl.prototype.map=function(yr){return Zs(this.value,yr,!0)},nl.prototype.forEach=function(yr){return this.value=Zs(this.value,yr,!1),this.value},nl.prototype.reduce=function(yr,Js){var uh=arguments.length===1,Vh=uh?this.value:Js;return this.forEach(function(od){this.isRoot&&uh||(Vh=yr.call(this,Vh,od))}),Vh},nl.prototype.paths=function(){var yr=[];return this.forEach(function(Js){yr.push(this.path)}),yr},nl.prototype.nodes=function(){var yr=[];return this.forEach(function(Js){yr.push(this.node)}),yr},nl.prototype.clone=function(){var yr=[],Js=[];return function uh(Vh){for(var od=0;od<yr.length;od++)if(yr[od]===Vh)return Js[od];if(typeof Vh=="object"&&Vh!==null){var Wh=ol(Vh);return yr.push(Vh),Js.push(Wh),Uh(sh(Vh),function(pd){Wh[pd]=uh(Vh[pd])}),yr.pop(),Js.pop(),Wh}return Vh}(this.value)};var sh=Object.keys||function(yr){var Js=[];for(var uh in yr)Js.push(uh);return Js};function xh(yr){return Object.prototype.toString.call(yr)}var Mh=Array.isArray||function(yr){return Object.prototype.toString.call(yr)==="[object Array]"},Uh=function(yr,Js){if(yr.forEach)return yr.forEach(Js);for(var uh=0;uh<yr.length;uh++)Js(yr[uh],uh,yr)};Uh(sh(nl.prototype),function(yr){fh[yr]=function(Js){var uh=[].slice.call(arguments,1),Vh=new nl(Js);return Vh[yr].apply(Vh,uh)}});var Nh=Object.hasOwnProperty||function(yr,Js){return Js in yr},Zh=td;function td(yr){if(!(this instanceof td))return new td(yr);this._bbox=yr||[1/0,1/0,-1/0,-1/0],this._valid=!!yr}td.prototype.include=function(yr){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],yr[0]),this._bbox[1]=Math.min(this._bbox[1],yr[1]),this._bbox[2]=Math.max(this._bbox[2],yr[0]),this._bbox[3]=Math.max(this._bbox[3],yr[1]),this},td.prototype.equals=function(yr){var Js;return Js=yr instanceof td?yr.bbox():yr,this._bbox[0]==Js[0]&&this._bbox[1]==Js[1]&&this._bbox[2]==Js[2]&&this._bbox[3]==Js[3]},td.prototype.center=function(yr){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},td.prototype.union=function(yr){var Js;return this._valid=!0,Js=yr instanceof td?yr.bbox():yr,this._bbox[0]=Math.min(this._bbox[0],Js[0]),this._bbox[1]=Math.min(this._bbox[1],Js[1]),this._bbox[2]=Math.max(this._bbox[2],Js[2]),this._bbox[3]=Math.max(this._bbox[3],Js[3]),this},td.prototype.bbox=function(){return this._valid?this._bbox:null},td.prototype.contains=function(yr){if(!yr)return this._fastContains();if(!this._valid)return null;var Js=yr[0],uh=yr[1];return this._bbox[0]<=Js&&this._bbox[1]<=uh&&this._bbox[2]>=Js&&this._bbox[3]>=uh},td.prototype.intersect=function(yr){return this._valid?(Js=yr instanceof td?yr.bbox():yr,!(this._bbox[0]>Js[2]||this._bbox[2]<Js[0]||this._bbox[3]<Js[1]||this._bbox[1]>Js[3])):null;var Js},td.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var yr="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",yr)},td.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ad=function(yr){if(!yr)return[];var Js=Th(Qh(yr)),uh=[];return Js.features.forEach(function(Vh){Vh.geometry&&(uh=uh.concat(Fh(Vh.geometry.coordinates)))}),uh},Zd=al,Fd=Zh,Kf={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},up=Object.keys(Kf);function ap(yr){for(var Js=Fd(),uh=Ad(yr),Vh=0;Vh<uh.length;Vh++)Js.include(uh[Vh]);return Js}lh.exports=function(yr){return ap(yr).bbox()},Lh.polygon=function(yr){return ap(yr).polygon()},Lh.bboxify=function(yr){return Zd(yr).map(function(Js){Js&&up.some(function(uh){return!!Js[uh]&&Kf[uh].indexOf(Js.type)!==-1})&&(Js.bbox=ap(Js).bbox(),this.update(Js))})};var wp=-90;function Hp(yr,Js){var uh=wp,Vh=90,od=wp,Wh=90,pd=270,$f=-270;yr.forEach(function(rp){var Gf=Lh(rp),op=Gf[1],Vp=Gf[3],Sm=Gf[0],Xp=Gf[2];op>uh&&(uh=op),Vp<Vh&&(Vh=Vp),Vp>od&&(od=Vp),op<Wh&&(Wh=op),Sm<pd&&(pd=Sm),Xp>$f&&($f=Xp)});var Tf=Js;return uh+Tf.lat>85&&(Tf.lat=85-uh),od+Tf.lat>90&&(Tf.lat=90-od),Vh+Tf.lat<-85&&(Tf.lat=-85-Vh),Wh+Tf.lat<wp&&(Tf.lat=wp-Wh),pd+Tf.lng<=-270&&(Tf.lng+=360*Math.ceil(Math.abs(Tf.lng)/360)),$f+Tf.lng>=270&&(Tf.lng-=360*Math.ceil(Math.abs(Tf.lng)/360)),Tf}function Ip(yr,Js){var uh=Hp(yr.map(function(Vh){return Vh.toGeoJSON()}),Js);yr.forEach(function(Vh){var od,Wh=Vh.getCoordinates(),pd=function(Tf){var rp={lng:Tf[0]+uh.lng,lat:Tf[1]+uh.lat};return[rp.lng,rp.lat]},$f=function(Tf){return Tf.map(function(rp){return pd(rp)})};Vh.type===Bt.POINT?od=pd(Wh):Vh.type===Bt.LINE_STRING||Vh.type===Bt.MULTI_POINT?od=Wh.map(pd):Vh.type===Bt.POLYGON||Vh.type===Bt.MULTI_LINE_STRING?od=Wh.map($f):Vh.type===Bt.MULTI_POLYGON&&(od=Wh.map(function(Tf){return Tf.map(function(rp){return $f(rp)})})),Vh.incomingCoords(od)})}var Gh={onSetup:function(yr){var Js=this,uh={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:yr.featureIds||[]};return this.setSelected(uh.initiallySelectedFeatureIds.filter(function(Vh){return Js.getFeature(Vh)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),uh},fireUpdate:function(){this.map.fire(_n.UPDATE,{action:Fn.MOVE,features:this.getSelected().map(function(yr){return yr.toGeoJSON()})})},fireActionable:function(){var yr=this,Js=this.getSelected(),uh=Js.filter(function($f){return yr.isInstanceOf("MultiFeature",$f)}),Vh=!1;if(Js.length>1){Vh=!0;var od=Js[0].type.replace("Multi","");Js.forEach(function($f){$f.type.replace("Multi","")!==od&&(Vh=!1)})}var Wh=uh.length>0,pd=Js.length>0;this.setActionableState({combineFeatures:Vh,uncombineFeatures:Wh,trash:pd})},getUniqueIds:function(yr){return yr.length?yr.map(function(Js){return Js.properties.id}).filter(function(Js){return Js!==void 0}).reduce(function(Js,uh){return Js.add(uh),Js},new oh).values():[]},stopExtendedInteractions:function(yr){yr.boxSelectElement&&(yr.boxSelectElement.parentNode&&yr.boxSelectElement.parentNode.removeChild(yr.boxSelectElement),yr.boxSelectElement=null),this.map.dragPan.enable(),yr.boxSelecting=!1,yr.canBoxSelect=!1,yr.dragMoving=!1,yr.canDragMove=!1},onStop:function(){$p.enable(this)},onMouseMove:function(yr){return this.stopExtendedInteractions(yr),!0},onMouseOut:function(yr){return!yr.dragMoving||this.fireUpdate()}};Gh.onTap=Gh.onClick=function(yr,Js){return Jf(Js)?this.clickAnywhere(yr,Js):fd(tl.VERTEX)(Js)?this.clickOnVertex(yr,Js):Sf(Js)?this.clickOnFeature(yr,Js):void 0},Gh.clickAnywhere=function(yr){var Js=this,uh=this.getSelectedIds();uh.length&&(this.clearSelectedFeatures(),uh.forEach(function(Vh){return Js.doRender(Vh)})),$p.enable(this),this.stopExtendedInteractions(yr)},Gh.clickOnVertex=function(yr,Js){this.changeMode(qr.DIRECT_SELECT,{featureId:Js.featureTarget.properties.parent,coordPath:Js.featureTarget.properties.coord_path,startPos:Js.lngLat}),this.updateUIClasses({mouse:nt.MOVE})},Gh.startOnActiveFeature=function(yr,Js){this.stopExtendedInteractions(yr),this.map.dragPan.disable(),this.doRender(Js.featureTarget.properties.id),yr.canDragMove=!0,yr.dragMoveLocation=Js.lngLat},Gh.clickOnFeature=function(yr,Js){var uh=this;$p.disable(this),this.stopExtendedInteractions(yr);var Vh=Xf(Js),od=this.getSelectedIds(),Wh=Js.featureTarget.properties.id,pd=this.isSelected(Wh);if(!Vh&&pd&&this.getFeature(Wh).type!==Bt.POINT)return this.changeMode(qr.DIRECT_SELECT,{featureId:Wh});pd&&Vh?(this.deselect(Wh),this.updateUIClasses({mouse:nt.POINTER}),od.length===1&&$p.enable(this)):!pd&&Vh?(this.select(Wh),this.updateUIClasses({mouse:nt.MOVE})):pd||Vh||(od.forEach(function($f){return uh.doRender($f)}),this.setSelected(Wh),this.updateUIClasses({mouse:nt.MOVE})),this.doRender(Wh)},Gh.onMouseDown=function(yr,Js){return Yh(Js)?this.startOnActiveFeature(yr,Js):this.drawConfig.boxSelect&&Jd(Js)?this.startBoxSelect(yr,Js):void 0},Gh.startBoxSelect=function(yr,Js){this.stopExtendedInteractions(yr),this.map.dragPan.disable(),yr.boxSelectStartLocation=Zf(Js.originalEvent,this.map.getContainer()),yr.canBoxSelect=!0},Gh.onTouchStart=function(yr,Js){if(Yh(Js))return this.startOnActiveFeature(yr,Js)},Gh.onDrag=function(yr,Js){return yr.canDragMove?this.dragMove(yr,Js):this.drawConfig.boxSelect&&yr.canBoxSelect?this.whileBoxSelect(yr,Js):void 0},Gh.whileBoxSelect=function(yr,Js){yr.boxSelecting=!0,this.updateUIClasses({mouse:nt.ADD}),yr.boxSelectElement||(yr.boxSelectElement=document.createElement("div"),yr.boxSelectElement.classList.add(P.BOX_SELECT),this.map.getContainer().appendChild(yr.boxSelectElement));var uh=Zf(Js.originalEvent,this.map.getContainer()),Vh=Math.min(yr.boxSelectStartLocation.x,uh.x),od=Math.max(yr.boxSelectStartLocation.x,uh.x),Wh=Math.min(yr.boxSelectStartLocation.y,uh.y),pd=Math.max(yr.boxSelectStartLocation.y,uh.y),$f="translate("+Vh+"px, "+Wh+"px)";yr.boxSelectElement.style.transform=$f,yr.boxSelectElement.style.WebkitTransform=$f,yr.boxSelectElement.style.width=od-Vh+"px",yr.boxSelectElement.style.height=pd-Wh+"px"},Gh.dragMove=function(yr,Js){yr.dragMoving=!0,Js.originalEvent.stopPropagation();var uh={lng:Js.lngLat.lng-yr.dragMoveLocation.lng,lat:Js.lngLat.lat-yr.dragMoveLocation.lat};Ip(this.getSelected(),uh),yr.dragMoveLocation=Js.lngLat},Gh.onTouchEnd=Gh.onMouseUp=function(yr,Js){var uh=this;if(yr.dragMoving)this.fireUpdate();else if(yr.boxSelecting){var Vh=[yr.boxSelectStartLocation,Zf(Js.originalEvent,this.map.getContainer())],od=this.featuresAt(null,Vh,"click"),Wh=this.getUniqueIds(od).filter(function(pd){return!uh.isSelected(pd)});Wh.length&&(this.select(Wh),Wh.forEach(function(pd){return uh.doRender(pd)}),this.updateUIClasses({mouse:nt.MOVE}))}this.stopExtendedInteractions(yr)},Gh.toDisplayFeatures=function(yr,Js,uh){Js.properties.active=this.isSelected(Js.properties.id)?Io.ACTIVE:Io.INACTIVE,uh(Js),this.fireActionable(),Js.properties.active===Io.ACTIVE&&Js.geometry.type!==Bt.POINT&&Wd(Js).forEach(uh)},Gh.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Gh.onCombineFeatures=function(){var yr=this.getSelected();if(!(yr.length===0||yr.length<2)){for(var Js=[],uh=[],Vh=yr[0].type.replace("Multi",""),od=0;od<yr.length;od++){var Wh=yr[od];if(Wh.type.replace("Multi","")!==Vh)return;Wh.type.includes("Multi")?Wh.getCoordinates().forEach(function($f){Js.push($f)}):Js.push(Wh.getCoordinates()),uh.push(Wh.toGeoJSON())}if(uh.length>1){var pd=this.newFeature({type:Bt.FEATURE,properties:uh[0].properties,geometry:{type:"Multi"+Vh,coordinates:Js}});this.addFeature(pd),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([pd.id]),this.map.fire(_n.COMBINE_FEATURES,{createdFeatures:[pd.toGeoJSON()],deletedFeatures:uh})}this.fireActionable()}},Gh.onUncombineFeatures=function(){var yr=this,Js=this.getSelected();if(Js.length!==0){for(var uh=[],Vh=[],od=function(pd){var $f=Js[pd];yr.isInstanceOf("MultiFeature",$f)&&($f.getFeatures().forEach(function(Tf){yr.addFeature(Tf),Tf.properties=$f.properties,uh.push(Tf.toGeoJSON()),yr.select([Tf.id])}),yr.deleteFeature($f.id,{silent:!0}),Vh.push($f.toGeoJSON()))},Wh=0;Wh<Js.length;Wh++)od(Wh);uh.length>1&&this.map.fire(_n.UNCOMBINE_FEATURES,{createdFeatures:uh,deletedFeatures:Vh}),this.fireActionable()}};var Nf=fd(tl.VERTEX),Hf=fd(tl.MIDPOINT),mp={fireUpdate:function(){this.map.fire(_n.UPDATE,{action:Fn.CHANGE_COORDINATES,features:this.getSelected().map(function(yr){return yr.toGeoJSON()})})},fireActionable:function(yr){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:yr.selectedCoordPaths.length>0})},startDragging:function(yr,Js){this.map.dragPan.disable(),yr.canDragMove=!0,yr.dragMoveLocation=Js.lngLat},stopDragging:function(yr){this.map.dragPan.enable(),yr.dragMoving=!1,yr.canDragMove=!1,yr.dragMoveLocation=null},onVertex:function(yr,Js){this.startDragging(yr,Js);var uh=Js.featureTarget.properties,Vh=yr.selectedCoordPaths.indexOf(uh.coord_path);Xf(Js)||Vh!==-1?Xf(Js)&&Vh===-1&&yr.selectedCoordPaths.push(uh.coord_path):yr.selectedCoordPaths=[uh.coord_path];var od=this.pathsToCoordinates(yr.featureId,yr.selectedCoordPaths);this.setSelectedCoordinates(od)},onMidpoint:function(yr,Js){this.startDragging(yr,Js);var uh=Js.featureTarget.properties;yr.feature.addCoordinate(uh.coord_path,uh.lng,uh.lat),this.fireUpdate(),yr.selectedCoordPaths=[uh.coord_path]},pathsToCoordinates:function(yr,Js){return Js.map(function(uh){return{feature_id:yr,coord_path:uh}})},onFeature:function(yr,Js){yr.selectedCoordPaths.length===0?this.startDragging(yr,Js):this.stopDragging(yr)},dragFeature:function(yr,Js,uh){Ip(this.getSelected(),uh),yr.dragMoveLocation=Js.lngLat},dragVertex:function(yr,Js,uh){for(var Vh=yr.selectedCoordPaths.map(function($f){return yr.feature.getCoordinate($f)}),od=Hp(Vh.map(function($f){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:$f}}}),uh),Wh=0;Wh<Vh.length;Wh++){var pd=Vh[Wh];yr.feature.updateCoordinate(yr.selectedCoordPaths[Wh],pd[0]+od.lng,pd[1]+od.lat)}},clickNoTarget:function(){this.changeMode(qr.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(qr.SIMPLE_SELECT)},clickActiveFeature:function(yr){yr.selectedCoordPaths=[],this.clearSelectedCoordinates(),yr.feature.changed()},onSetup:function(yr){var Js=yr.featureId,uh=this.getFeature(Js);if(!uh)throw new Error("You must provide a featureId to enter direct_select mode");if(uh.type===Bt.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Vh={featureId:Js,feature:uh,dragMoveLocation:yr.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:yr.coordPath?[yr.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(Js,Vh.selectedCoordPaths)),this.setSelected(Js),$p.disable(this),this.setActionableState({trash:!0}),Vh},onStop:function(){$p.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(yr,Js,uh){yr.featureId===Js.properties.id?(Js.properties.active=Io.ACTIVE,uh(Js),Wd(Js,{map:this.map,midpoints:!0,selectedPaths:yr.selectedCoordPaths}).forEach(uh)):(Js.properties.active=Io.INACTIVE,uh(Js)),this.fireActionable(yr)},onTrash:function(yr){yr.selectedCoordPaths.sort(function(Js,uh){return uh.localeCompare(Js,"en",{numeric:!0})}).forEach(function(Js){return yr.feature.removeCoordinate(Js)}),this.fireUpdate(),yr.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(yr),yr.feature.isValid()===!1&&(this.deleteFeature([yr.featureId]),this.changeMode(qr.SIMPLE_SELECT,{}))},onMouseMove:function(yr,Js){var uh=Yh(Js),Vh=Nf(Js),od=yr.selectedCoordPaths.length===0;return uh&&od||Vh&&!od?this.updateUIClasses({mouse:nt.MOVE}):this.updateUIClasses({mouse:nt.NONE}),this.stopDragging(yr),!0},onMouseOut:function(yr){return yr.dragMoving&&this.fireUpdate(),!0}};mp.onTouchStart=mp.onMouseDown=function(yr,Js){return Nf(Js)?this.onVertex(yr,Js):Yh(Js)?this.onFeature(yr,Js):Hf(Js)?this.onMidpoint(yr,Js):void 0},mp.onDrag=function(yr,Js){if(yr.canDragMove===!0){yr.dragMoving=!0,Js.originalEvent.stopPropagation();var uh={lng:Js.lngLat.lng-yr.dragMoveLocation.lng,lat:Js.lngLat.lat-yr.dragMoveLocation.lat};yr.selectedCoordPaths.length>0?this.dragVertex(yr,Js,uh):this.dragFeature(yr,Js,uh),yr.dragMoveLocation=Js.lngLat}},mp.onClick=function(yr,Js){return Jf(Js)?this.clickNoTarget(yr,Js):Yh(Js)?this.clickActiveFeature(yr,Js):$d(Js)?this.clickInactive(yr,Js):void this.stopDragging(yr)},mp.onTap=function(yr,Js){return Jf(Js)?this.clickNoTarget(yr,Js):Yh(Js)?this.clickActiveFeature(yr,Js):$d(Js)?this.clickInactive(yr,Js):void 0},mp.onTouchEnd=mp.onMouseUp=function(yr){yr.dragMoving&&this.fireUpdate(),this.stopDragging(yr)};var Bp={};function zp(yr,Js){return!!yr.lngLat&&yr.lngLat.lng===Js[0]&&yr.lngLat.lat===Js[1]}Bp.onSetup=function(){var yr=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:[]}});return this.addFeature(yr),this.clearSelectedFeatures(),this.updateUIClasses({mouse:nt.ADD}),this.activateUIButton(ze.POINT),this.setActionableState({trash:!0}),{point:yr}},Bp.stopDrawingAndRemove=function(yr){this.deleteFeature([yr.point.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT)},Bp.onTap=Bp.onClick=function(yr,Js){this.updateUIClasses({mouse:nt.MOVE}),yr.point.updateCoordinate("",Js.lngLat.lng,Js.lngLat.lat),this.map.fire(_n.CREATE,{features:[yr.point.toGeoJSON()]}),this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.point.id]})},Bp.onStop=function(yr){this.activateUIButton(),yr.point.getCoordinate().length||this.deleteFeature([yr.point.id],{silent:!0})},Bp.toDisplayFeatures=function(yr,Js,uh){var Vh=Js.properties.id===yr.point.id;if(Js.properties.active=Vh?Io.ACTIVE:Io.INACTIVE,!Vh)return uh(Js)},Bp.onTrash=Bp.stopDrawingAndRemove,Bp.onKeyUp=function(yr,Js){if(Of(Js)||jf(Js))return this.stopDrawingAndRemove(yr,Js)};var um={onSetup:function(){var yr=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.POLYGON,coordinates:[[]]}});return this.addFeature(yr),this.clearSelectedFeatures(),$p.disable(this),this.updateUIClasses({mouse:nt.ADD}),this.activateUIButton(ze.POLYGON),this.setActionableState({trash:!0}),{polygon:yr,currentVertexPosition:0}},clickAnywhere:function(yr,Js){if(yr.currentVertexPosition>0&&zp(Js,yr.polygon.coordinates[0][yr.currentVertexPosition-1]))return this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.polygon.id]});this.updateUIClasses({mouse:nt.ADD}),yr.polygon.updateCoordinate("0."+yr.currentVertexPosition,Js.lngLat.lng,Js.lngLat.lat),yr.currentVertexPosition++,yr.polygon.updateCoordinate("0."+yr.currentVertexPosition,Js.lngLat.lng,Js.lngLat.lat)},clickOnVertex:function(yr){return this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.polygon.id]})},onMouseMove:function(yr,Js){yr.polygon.updateCoordinate("0."+yr.currentVertexPosition,Js.lngLat.lng,Js.lngLat.lat),If(Js)&&this.updateUIClasses({mouse:nt.POINTER})}};um.onTap=um.onClick=function(yr,Js){return If(Js)?this.clickOnVertex(yr,Js):this.clickAnywhere(yr,Js)},um.onKeyUp=function(yr,Js){Of(Js)?(this.deleteFeature([yr.polygon.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT)):jf(Js)&&this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.polygon.id]})},um.onStop=function(yr){this.updateUIClasses({mouse:nt.NONE}),$p.enable(this),this.activateUIButton(),this.getFeature(yr.polygon.id)!==void 0&&(yr.polygon.removeCoordinate("0."+yr.currentVertexPosition),yr.polygon.isValid()?this.map.fire(_n.CREATE,{features:[yr.polygon.toGeoJSON()]}):(this.deleteFeature([yr.polygon.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT,{},{silent:!0})))},um.toDisplayFeatures=function(yr,Js,uh){var Vh=Js.properties.id===yr.polygon.id;if(Js.properties.active=Vh?Io.ACTIVE:Io.INACTIVE,!Vh)return uh(Js);if(Js.geometry.coordinates.length!==0){var od=Js.geometry.coordinates[0].length;if(!(od<3)){if(Js.properties.meta=tl.FEATURE,uh(qp(yr.polygon.id,Js.geometry.coordinates[0][0],"0.0",!1)),od>3){var Wh=Js.geometry.coordinates[0].length-3;uh(qp(yr.polygon.id,Js.geometry.coordinates[0][Wh],"0."+Wh,!1))}if(od<=4){var pd=[[Js.geometry.coordinates[0][0][0],Js.geometry.coordinates[0][0][1]],[Js.geometry.coordinates[0][1][0],Js.geometry.coordinates[0][1][1]]];if(uh({type:Bt.FEATURE,properties:Js.properties,geometry:{coordinates:pd,type:Bt.LINE_STRING}}),od===3)return}return uh(Js)}}},um.onTrash=function(yr){this.deleteFeature([yr.polygon.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT)};var Nm={onSetup:function(yr){var Js,uh,Vh=(yr=yr||{}).featureId,od="forward";if(Vh){if(!(Js=this.getFeature(Vh)))throw new Error("Could not find a feature with the provided featureId");var Wh=yr.from;if(Wh&&Wh.type==="Feature"&&Wh.geometry&&Wh.geometry.type==="Point"&&(Wh=Wh.geometry),Wh&&Wh.type==="Point"&&Wh.coordinates&&Wh.coordinates.length===2&&(Wh=Wh.coordinates),!Wh||!Array.isArray(Wh))throw new Error("Please use the `from` property to indicate which point to continue the line from");var pd=Js.coordinates.length-1;if(Js.coordinates[pd][0]===Wh[0]&&Js.coordinates[pd][1]===Wh[1])uh=pd+1,Js.addCoordinate.apply(Js,[uh].concat(Js.coordinates[pd]));else{if(Js.coordinates[0][0]!==Wh[0]||Js.coordinates[0][1]!==Wh[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");od="backwards",uh=0,Js.addCoordinate.apply(Js,[uh].concat(Js.coordinates[0]))}}else Js=this.newFeature({type:Bt.FEATURE,properties:{},geometry:{type:Bt.LINE_STRING,coordinates:[]}}),uh=0,this.addFeature(Js);return this.clearSelectedFeatures(),$p.disable(this),this.updateUIClasses({mouse:nt.ADD}),this.activateUIButton(ze.LINE),this.setActionableState({trash:!0}),{line:Js,currentVertexPosition:uh,direction:od}},clickAnywhere:function(yr,Js){if(yr.currentVertexPosition>0&&zp(Js,yr.line.coordinates[yr.currentVertexPosition-1])||yr.direction==="backwards"&&zp(Js,yr.line.coordinates[yr.currentVertexPosition+1]))return this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.line.id]});this.updateUIClasses({mouse:nt.ADD}),yr.line.updateCoordinate(yr.currentVertexPosition,Js.lngLat.lng,Js.lngLat.lat),yr.direction==="forward"?(yr.currentVertexPosition++,yr.line.updateCoordinate(yr.currentVertexPosition,Js.lngLat.lng,Js.lngLat.lat)):yr.line.addCoordinate(0,Js.lngLat.lng,Js.lngLat.lat)},clickOnVertex:function(yr){return this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.line.id]})},onMouseMove:function(yr,Js){yr.line.updateCoordinate(yr.currentVertexPosition,Js.lngLat.lng,Js.lngLat.lat),If(Js)&&this.updateUIClasses({mouse:nt.POINTER})}};Nm.onTap=Nm.onClick=function(yr,Js){if(If(Js))return this.clickOnVertex(yr,Js);this.clickAnywhere(yr,Js)},Nm.onKeyUp=function(yr,Js){jf(Js)?this.changeMode(qr.SIMPLE_SELECT,{featureIds:[yr.line.id]}):Of(Js)&&(this.deleteFeature([yr.line.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT))},Nm.onStop=function(yr){$p.enable(this),this.activateUIButton(),this.getFeature(yr.line.id)!==void 0&&(yr.line.removeCoordinate(""+yr.currentVertexPosition),yr.line.isValid()?this.map.fire(_n.CREATE,{features:[yr.line.toGeoJSON()]}):(this.deleteFeature([yr.line.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT,{},{silent:!0})))},Nm.onTrash=function(yr){this.deleteFeature([yr.line.id],{silent:!0}),this.changeMode(qr.SIMPLE_SELECT)},Nm.toDisplayFeatures=function(yr,Js,uh){var Vh=Js.properties.id===yr.line.id;if(Js.properties.active=Vh?Io.ACTIVE:Io.INACTIVE,!Vh)return uh(Js);Js.geometry.coordinates.length<2||(Js.properties.meta=tl.FEATURE,uh(qp(yr.line.id,Js.geometry.coordinates[yr.direction==="forward"?Js.geometry.coordinates.length-2:1],""+(yr.direction==="forward"?Js.geometry.coordinates.length-2:1),!1)),uh(Js))};var a_={simple_select:Gh,direct_select:mp,draw_point:Bp,draw_polygon:um,draw_line_string:Nm},Ug={defaultMode:qr.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Qd,modes:a_,controls:{},userProperties:!1},by={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Yd={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Mg(yr,Js){return yr.map(function(uh){return uh.source?uh:ep(uh,{id:uh.id+"."+Js,source:Js==="hot"?ge.HOT:ge.COLD})})}var km={};(function(yr,Js){var uh="__lodash_hash_undefined__",Vh=9007199254740991,od="[object Arguments]",Wh="[object Array]",pd="[object Boolean]",$f="[object Date]",Tf="[object Error]",rp="[object Function]",Gf="[object Map]",op="[object Number]",Vp="[object Object]",Sm="[object Promise]",Xp="[object RegExp]",Dm="[object Set]",Mf="[object String]",Cp="[object Symbol]",Kp="[object WeakMap]",Ym="[object ArrayBuffer]",Mm="[object DataView]",lg=/^\[object .+?Constructor\]$/,jm=/^(?:0|[1-9]\d*)$/,Tm={};Tm["[object Float32Array]"]=Tm["[object Float64Array]"]=Tm["[object Int8Array]"]=Tm["[object Int16Array]"]=Tm["[object Int32Array]"]=Tm["[object Uint8Array]"]=Tm["[object Uint8ClampedArray]"]=Tm["[object Uint16Array]"]=Tm["[object Uint32Array]"]=!0,Tm[od]=Tm[Wh]=Tm[Ym]=Tm[pd]=Tm[Mm]=Tm[$f]=Tm[Tf]=Tm[rp]=Tm[Gf]=Tm[op]=Tm[Vp]=Tm[Xp]=Tm[Dm]=Tm[Mf]=Tm[Kp]=!1;var Uy=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,vg=typeof self=="object"&&self&&self.Object===Object&&self,ng=Uy||vg||Function("return this")(),l0=Js&&!Js.nodeType&&Js,Vy=l0&&yr&&!yr.nodeType&&yr,zm=Vy&&Vy.exports===l0,s_=zm&&Uy.process,j0=function(){try{return s_&&s_.binding&&s_.binding("util")}catch{}}(),Ey=j0&&j0.isTypedArray;function xg(bd,mf){for(var np=-1,Dp=bd==null?0:bd.length;++np<Dp;)if(mf(bd[np],np,bd))return!0;return!1}function q0(bd){var mf=-1,np=Array(bd.size);return bd.forEach(function(Dp,Fm){np[++mf]=[Fm,Dp]}),np}function fv(bd){var mf=-1,np=Array(bd.size);return bd.forEach(function(Dp){np[++mf]=Dp}),np}var G_,P_,Sy,pv=Array.prototype,S0=Function.prototype,Jg=Object.prototype,Wp=ng["__core-js_shared__"],T0=S0.toString,bg=Jg.hasOwnProperty,Rg=(G_=/[^.]+$/.exec(Wp&&Wp.keys&&Wp.keys.IE_PROTO||""))?"Symbol(src)_1."+G_:"",jy=Jg.toString,Qg=RegExp("^"+T0.call(bg).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j_=zm?ng.Buffer:void 0,q_=ng.Symbol,Ty=ng.Uint8Array,gm=Jg.propertyIsEnumerable,qy=pv.splice,cy=q_?q_.toStringTag:void 0,I0=Object.getOwnPropertySymbols,Z_=j_?j_.isBuffer:void 0,fm=(P_=Object.keys,Sy=Object,function(bd){return P_(Sy(bd))}),mv=My(ng,"DataView"),Iy=My(ng,"Map"),Z0=My(ng,"Promise"),Zy=My(ng,"Set"),Hy=My(ng,"WeakMap"),H_=My(Object,"create"),Cy=D_(mv),c0=D_(Iy),Xy=D_(Z0),m_=D_(Zy),X_=D_(Hy),Og=q_?q_.prototype:void 0,C0=Og?Og.valueOf:void 0;function l_(bd){var mf=-1,np=bd==null?0:bd.length;for(this.clear();++mf<np;){var Dp=bd[mf];this.set(Dp[0],Dp[1])}}function g_(bd){var mf=-1,np=bd==null?0:bd.length;for(this.clear();++mf<np;){var Dp=bd[mf];this.set(Dp[0],Dp[1])}}function e_(bd){var mf=-1,np=bd==null?0:bd.length;for(this.clear();++mf<np;){var Dp=bd[mf];this.set(Dp[0],Dp[1])}}function K_(bd){var mf=-1,np=bd==null?0:bd.length;for(this.__data__=new e_;++mf<np;)this.add(bd[mf])}function t_(bd){var mf=this.__data__=new g_(bd);this.size=mf.size}function gv(bd,mf){var np=u0(bd),Dp=!np&&K0(bd),Fm=!np&&!Dp&&dy(bd),om=!np&&!Dp&&!Fm&&__(bd),qm=np||Dp||Fm||om,Um=qm?function(tp,$g){for(var Bg=-1,Zm=Array(tp);++Bg<tp;)Zm[Bg]=$g(Bg);return Zm}(bd.length,String):[],Ag=Um.length;for(var Pm in bd)!mf&&!bg.call(bd,Pm)||qm&&(Pm=="length"||Fm&&(Pm=="offset"||Pm=="parent")||om&&(Pm=="buffer"||Pm=="byteLength"||Pm=="byteOffset")||X0(Pm,Ag))||Um.push(Pm);return Um}function im(bd,mf){for(var np=bd.length;np--;)if(Y_(bd[np][0],mf))return np;return-1}function uy(bd){return bd==null?bd===void 0?"[object Undefined]":"[object Null]":cy&&cy in Object(bd)?function(mf){var np=bg.call(mf,cy),Dp=mf[cy];try{mf[cy]=void 0;var Fm=!0}catch{}var om=jy.call(mf);return Fm&&(np?mf[cy]=Dp:delete mf[cy]),om}(bd):function(mf){return jy.call(mf)}(bd)}function Hm(bd){return L_(bd)&&uy(bd)==od}function Ky(bd,mf,np,Dp,Fm){return bd===mf||(bd==null||mf==null||!L_(bd)&&!L_(mf)?bd!=bd&&mf!=mf:function(om,qm,Um,Ag,Pm,tp){var $g=u0(om),Bg=u0(qm),Zm=$g?Wh:k_(om),R_=Bg?Wh:k_(qm),ip=(Zm=Zm==od?Vp:Zm)==Vp,Yy=(R_=R_==od?Vp:R_)==Vp,O_=Zm==R_;if(O_&&dy(om)){if(!dy(qm))return!1;$g=!0,ip=!1}if(O_&&!ip)return tp||(tp=new t_),$g||__(om)?Am(om,qm,Um,Ag,Pm,tp):function(xm,am,y_,Vg,h0,Gg,bm){switch(y_){case Mm:if(xm.byteLength!=am.byteLength||xm.byteOffset!=am.byteOffset)return!1;xm=xm.buffer,am=am.buffer;case Ym:return!(xm.byteLength!=am.byteLength||!Gg(new Ty(xm),new Ty(am)));case pd:case $f:case op:return Y_(+xm,+am);case Tf:return xm.name==am.name&&xm.message==am.message;case Xp:case Mf:return xm==am+"";case Gf:var cg=q0;case Dm:var Pg=1&Vg;if(cg||(cg=fv),xm.size!=am.size&&!Pg)return!1;var v_=bm.get(xm);if(v_)return v_==am;Vg|=2,bm.set(xm,am);var fy=Am(cg(xm),cg(am),Vg,h0,Gg,bm);return bm.delete(xm),fy;case Cp:if(C0)return C0.call(xm)==C0.call(am)}return!1}(om,qm,Zm,Um,Ag,Pm,tp);if(!(1&Um)){var A0=ip&&bg.call(om,"__wrapped__"),W0=Yy&&bg.call(qm,"__wrapped__");if(A0||W0){var zv=A0?om.value():om,P0=W0?qm.value():qm;return tp||(tp=new t_),Pm(zv,P0,Um,Ag,tp)}}return O_?(tp||(tp=new t_),function(xm,am,y_,Vg,h0,Gg){var bm=1&y_,cg=Im(xm),Pg=cg.length,v_=Im(am).length;if(Pg!=v_&&!bm)return!1;for(var fy=Pg;fy--;){var fg=cg[fy];if(!(bm?fg in am:bg.call(am,fg)))return!1}var Ay=Gg.get(xm);if(Ay&&Gg.get(am))return Ay==am;var ug=!0;Gg.set(xm,am),Gg.set(am,xm);for(var ym=bm;++fy<Pg;){var Yp=xm[fg=cg[fy]],$_=am[fg];if(Vg)var k0=bm?Vg($_,Yp,fg,am,xm,Gg):Vg(Yp,$_,fg,xm,am,Gg);if(!(k0===void 0?Yp===$_||h0(Yp,$_,y_,Vg,Gg):k0)){ug=!1;break}ym||(ym=fg=="constructor")}if(ug&&!ym){var Py=xm.constructor,x_=am.constructor;Py==x_||!("constructor"in xm)||!("constructor"in am)||typeof Py=="function"&&Py instanceof Py&&typeof x_=="function"&&x_ instanceof x_||(ug=!1)}return Gg.delete(xm),Gg.delete(am),ug}(om,qm,Um,Ag,Pm,tp)):!1}(bd,mf,np,Dp,Ky,Fm))}function lm(bd){return!(!Wy(bd)||function(mf){return!!Rg&&Rg in mf}(bd))&&(J_(bd)?Qg:lg).test(D_(bd))}function W_(bd){if(np=(mf=bd)&&mf.constructor,Dp=typeof np=="function"&&np.prototype||Jg,mf!==Dp)return fm(bd);var mf,np,Dp,Fm=[];for(var om in Object(bd))bg.call(bd,om)&&om!="constructor"&&Fm.push(om);return Fm}function Am(bd,mf,np,Dp,Fm,om){var qm=1&np,Um=bd.length,Ag=mf.length;if(Um!=Ag&&!(qm&&Ag>Um))return!1;var Pm=om.get(bd);if(Pm&&om.get(mf))return Pm==mf;var tp=-1,$g=!0,Bg=2&np?new K_:void 0;for(om.set(bd,mf),om.set(mf,bd);++tp<Um;){var Zm=bd[tp],R_=mf[tp];if(Dp)var ip=qm?Dp(R_,Zm,tp,mf,bd,om):Dp(Zm,R_,tp,bd,mf,om);if(ip!==void 0){if(ip)continue;$g=!1;break}if(Bg){if(!xg(mf,function(Yy,O_){if(A0=O_,!Bg.has(A0)&&(Zm===Yy||Fm(Zm,Yy,np,Dp,om)))return Bg.push(O_);var A0})){$g=!1;break}}else if(Zm!==R_&&!Fm(Zm,R_,np,Dp,om)){$g=!1;break}}return om.delete(bd),om.delete(mf),$g}function Im(bd){return function(mf,np,Dp){var Fm=np(mf);return u0(mf)?Fm:function(om,qm){for(var Um=-1,Ag=qm.length,Pm=om.length;++Um<Ag;)om[Pm+Um]=qm[Um];return om}(Fm,Dp(mf))}(bd,c_,H0)}function hy(bd,mf){var np,Dp,Fm=bd.__data__;return((Dp=typeof(np=mf))=="string"||Dp=="number"||Dp=="symbol"||Dp=="boolean"?np!=="__proto__":np===null)?Fm[typeof mf=="string"?"string":"hash"]:Fm.map}function My(bd,mf){var np=function(Dp,Fm){return Dp?.[Fm]}(bd,mf);return lm(np)?np:void 0}l_.prototype.clear=function(){this.__data__=H_?H_(null):{},this.size=0},l_.prototype.delete=function(bd){var mf=this.has(bd)&&delete this.__data__[bd];return this.size-=mf?1:0,mf},l_.prototype.get=function(bd){var mf=this.__data__;if(H_){var np=mf[bd];return np===uh?void 0:np}return bg.call(mf,bd)?mf[bd]:void 0},l_.prototype.has=function(bd){var mf=this.__data__;return H_?mf[bd]!==void 0:bg.call(mf,bd)},l_.prototype.set=function(bd,mf){var np=this.__data__;return this.size+=this.has(bd)?0:1,np[bd]=H_&&mf===void 0?uh:mf,this},g_.prototype.clear=function(){this.__data__=[],this.size=0},g_.prototype.delete=function(bd){var mf=this.__data__,np=im(mf,bd);return!(np<0)&&(np==mf.length-1?mf.pop():qy.call(mf,np,1),--this.size,!0)},g_.prototype.get=function(bd){var mf=this.__data__,np=im(mf,bd);return np<0?void 0:mf[np][1]},g_.prototype.has=function(bd){return im(this.__data__,bd)>-1},g_.prototype.set=function(bd,mf){var np=this.__data__,Dp=im(np,bd);return Dp<0?(++this.size,np.push([bd,mf])):np[Dp][1]=mf,this},e_.prototype.clear=function(){this.size=0,this.__data__={hash:new l_,map:new(Iy||g_),string:new l_}},e_.prototype.delete=function(bd){var mf=hy(this,bd).delete(bd);return this.size-=mf?1:0,mf},e_.prototype.get=function(bd){return hy(this,bd).get(bd)},e_.prototype.has=function(bd){return hy(this,bd).has(bd)},e_.prototype.set=function(bd,mf){var np=hy(this,bd),Dp=np.size;return np.set(bd,mf),this.size+=np.size==Dp?0:1,this},K_.prototype.add=K_.prototype.push=function(bd){return this.__data__.set(bd,uh),this},K_.prototype.has=function(bd){return this.__data__.has(bd)},t_.prototype.clear=function(){this.__data__=new g_,this.size=0},t_.prototype.delete=function(bd){var mf=this.__data__,np=mf.delete(bd);return this.size=mf.size,np},t_.prototype.get=function(bd){return this.__data__.get(bd)},t_.prototype.has=function(bd){return this.__data__.has(bd)},t_.prototype.set=function(bd,mf){var np=this.__data__;if(np instanceof g_){var Dp=np.__data__;if(!Iy||Dp.length<199)return Dp.push([bd,mf]),this.size=++np.size,this;np=this.__data__=new e_(Dp)}return np.set(bd,mf),this.size=np.size,this};var H0=I0?function(bd){return bd==null?[]:(bd=Object(bd),function(mf,np){for(var Dp=-1,Fm=mf==null?0:mf.length,om=0,qm=[];++Dp<Fm;){var Um=mf[Dp];np(Um,Dp,mf)&&(qm[om++]=Um)}return qm}(I0(bd),function(mf){return gm.call(bd,mf)}))}:function(){return[]},k_=uy;function X0(bd,mf){return!!(mf=mf??Vh)&&(typeof bd=="number"||jm.test(bd))&&bd>-1&&bd%1==0&&bd<mf}function D_(bd){if(bd!=null){try{return T0.call(bd)}catch{}try{return bd+""}catch{}}return""}function Y_(bd,mf){return bd===mf||bd!=bd&&mf!=mf}(mv&&k_(new mv(new ArrayBuffer(1)))!=Mm||Iy&&k_(new Iy)!=Gf||Z0&&k_(Z0.resolve())!=Sm||Zy&&k_(new Zy)!=Dm||Hy&&k_(new Hy)!=Kp)&&(k_=function(bd){var mf=uy(bd),np=mf==Vp?bd.constructor:void 0,Dp=np?D_(np):"";if(Dp)switch(Dp){case Cy:return Mm;case c0:return Gf;case Xy:return Sm;case m_:return Dm;case X_:return Kp}return mf});var K0=Hm(function(){return arguments}())?Hm:function(bd){return L_(bd)&&bg.call(bd,"callee")&&!gm.call(bd,"callee")},u0=Array.isArray,dy=Z_||function(){return!1};function J_(bd){if(!Wy(bd))return!1;var mf=uy(bd);return mf==rp||mf=="[object GeneratorFunction]"||mf=="[object AsyncFunction]"||mf=="[object Proxy]"}function M0(bd){return typeof bd=="number"&&bd>-1&&bd%1==0&&bd<=Vh}function Wy(bd){var mf=typeof bd;return bd!=null&&(mf=="object"||mf=="function")}function L_(bd){return bd!=null&&typeof bd=="object"}var __=Ey?function(bd){return function(mf){return bd(mf)}}(Ey):function(bd){return L_(bd)&&M0(bd.length)&&!!Tm[uy(bd)]};function c_(bd){return(mf=bd)!=null&&M0(mf.length)&&!J_(mf)?gv(bd):W_(bd);var mf}yr.exports=function(bd,mf){return Ky(bd,mf)}})({get exports(){return km},set exports(yr){km=yr}},km);var sg=km;function wy(yr,Js){return yr.length===Js.length&&JSON.stringify(yr.map(function(uh){return uh}).sort())===JSON.stringify(Js.map(function(uh){return uh}).sort())}var p_={Polygon:Pd,LineString:xd,Point:Hd,MultiPolygon:Kd,MultiLineString:Kd,MultiPoint:Kd},a0=Object.freeze({__proto__:null,CommonSelectors:Ap,constrainFeatureMovement:Hp,createMidPoint:sm,createSupplementaryPoints:Wd,createVertex:qp,doubleClickZoom:$p,euclideanDistance:vd,featuresAt:Sh,getFeatureAtAndSetCursors:hd,isClick:Ef,isEventAtCoordinates:zp,isTap:Cd,mapEventToBoundingBox:sl,ModeHandler:r,moveFeatures:Ip,sortFeatures:Zu,stringSetsAreEqual:wy,StringSet:oh,theme:Qd,toDenseArray:bp}),s0=function(yr,Js){var uh={options:yr=function(od){od===void 0&&(od={});var Wh=ep(od);return od.controls||(Wh.controls={}),od.displayControlsDefault===!1?Wh.controls=ep(Yd,od.controls):Wh.controls=ep(by,od.controls),(Wh=ep(Ug,Wh)).styles=Mg(Wh.styles,"cold").concat(Mg(Wh.styles,"hot")),Wh}(yr)};Js=function(od,Wh){return Wh.modes=qr,Wh.getFeatureIdsAt=function(pd){return Sh.click({point:pd},null,od).map(function($f){return $f.properties.id})},Wh.getSelectedIds=function(){return od.store.getSelectedIds()},Wh.getSelected=function(){return{type:Bt.FEATURE_COLLECTION,features:od.store.getSelectedIds().map(function(pd){return od.store.get(pd)}).map(function(pd){return pd.toGeoJSON()})}},Wh.getSelectedPoints=function(){return{type:Bt.FEATURE_COLLECTION,features:od.store.getSelectedCoordinates().map(function(pd){return{type:Bt.FEATURE,properties:{},geometry:{type:Bt.POINT,coordinates:pd.coordinates}}})}},Wh.set=function(pd){if(pd.type===void 0||pd.type!==Bt.FEATURE_COLLECTION||!Array.isArray(pd.features))throw new Error("Invalid FeatureCollection");var $f=od.store.createRenderBatch(),Tf=od.store.getAllIds().slice(),rp=Wh.add(pd),Gf=new oh(rp);return(Tf=Tf.filter(function(op){return!Gf.has(op)})).length&&Wh.delete(Tf),$f(),rp},Wh.add=function(pd){var $f=JSON.parse(JSON.stringify(ih(pd))).features.map(function(Tf){if(Tf.id=Tf.id||Cf(),Tf.geometry===null)throw new Error("Invalid geometry: null");if(od.store.get(Tf.id)===void 0||od.store.get(Tf.id).type!==Tf.geometry.type){var rp=p_[Tf.geometry.type];if(rp===void 0)throw new Error("Invalid geometry type: "+Tf.geometry.type+".");var Gf=new rp(od,Tf);od.store.add(Gf)}else{var op=od.store.get(Tf.id);op.properties=Tf.properties,sg(op.getCoordinates(),Tf.geometry.coordinates)||op.incomingCoords(Tf.geometry.coordinates)}return Tf.id});return od.store.render(),$f},Wh.get=function(pd){var $f=od.store.get(pd);if($f)return $f.toGeoJSON()},Wh.getAll=function(){return{type:Bt.FEATURE_COLLECTION,features:od.store.getAll().map(function(pd){return pd.toGeoJSON()})}},Wh.delete=function(pd){return od.store.delete(pd,{silent:!0}),Wh.getMode()!==qr.DIRECT_SELECT||od.store.getSelectedIds().length?od.store.render():od.events.changeMode(qr.SIMPLE_SELECT,void 0,{silent:!0}),Wh},Wh.deleteAll=function(){return od.store.delete(od.store.getAllIds(),{silent:!0}),Wh.getMode()===qr.DIRECT_SELECT?od.events.changeMode(qr.SIMPLE_SELECT,void 0,{silent:!0}):od.store.render(),Wh},Wh.changeMode=function(pd,$f){return $f===void 0&&($f={}),pd===qr.SIMPLE_SELECT&&Wh.getMode()===qr.SIMPLE_SELECT?(wy($f.featureIds||[],od.store.getSelectedIds())||(od.store.setSelected($f.featureIds,{silent:!0}),od.store.render()),Wh):(pd===qr.DIRECT_SELECT&&Wh.getMode()===qr.DIRECT_SELECT&&$f.featureId===od.store.getSelectedIds()[0]||od.events.changeMode(pd,$f,{silent:!0}),Wh)},Wh.getMode=function(){return od.events.getMode()},Wh.trash=function(){return od.events.trash({silent:!0}),Wh},Wh.combineFeatures=function(){return od.events.combineFeatures({silent:!0}),Wh},Wh.uncombineFeatures=function(){return od.events.uncombineFeatures({silent:!0}),Wh},Wh.setFeatureProperty=function(pd,$f,Tf){return od.store.setFeatureProperty(pd,$f,Tf),Wh},Wh}(uh,Js),uh.api=Js;var Vh=Kh(uh);return Js.onAdd=Vh.onAdd,Js.onRemove=Vh.onRemove,Js.types=ze,Js.options=yr,Js};function mm(yr){s0(yr,this)}return mm.modes=a_,mm.constants=ah,mm.lib=a0,mm})})(mapboxGlDraw$1);var mapboxGlDrawExports=mapboxGlDraw$1.exports;const MapboxDraw=getDefaultExportFromCjs(mapboxGlDrawExports),mapboxGlDraw="";var DrawAssistedRectangle$2={};Object.defineProperty(DrawAssistedRectangle$2,"__esModule",{value:!0});var doubleClickZoom$1={enable:function e(t){setTimeout(function(){!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable:function e(t){setTimeout(function(){!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}},DrawAssistedRectangle$1={onSetup:function e(t){var r=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(r),this.clearSelectedFeatures(),doubleClickZoom$1.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:r,currentVertexPosition:0}},onTap:function e(t,r){this.onClick(t,r)},onClick:function e(t,r){if(t.currentVertexPosition===2){var n=this.calculatepXY3(t,r,!1);return n&&t.rectangle.updateCoordinate("0."+(t.currentVertexPosition+1),n[0],n[1]),this.updateUIClasses({mouse:"pointer"}),this.changeMode("simple_select",{featuresId:t.rectangle.id})}else t.rectangle.updateCoordinate("0."+t.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),t.currentVertexPosition++,t.rectangle.updateCoordinate("0."+t.currentVertexPosition,r.lngLat.lng,r.lngLat.lat)},onMouseMove:function e(t,r){if(t.rectangle.updateCoordinate("0."+t.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),t.currentVertexPosition&&t.currentVertexPosition>0&&this.calculateOrientedAnglePolygon(t),t.currentVertexPosition===2){var n=this.calculatepXY3(t,r,!0);n&&t.rectangle.updateCoordinate("0."+(t.currentVertexPosition+1),n[0],n[1])}},deegrees2meters:function e(t){var r=t[0]*2003750834e-2/180,n=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return n=n*2003750834e-2/180,[r,n]},meters2degress:function e(t){var r=t[0]*180/2003750834e-2,n=Math.atan(Math.exp(t[1]*Math.PI/2003750834e-2))*360/Math.PI-90;return[r,n]},calculateOrientedAnglePolygon:function e(t){var r=t.rectangle.getCoordinate("0.0"),n=this.deegrees2meters(r),a=t.rectangle.getCoordinate("0.1"),s=this.deegrees2meters(a),f=Math.atan2(s[1]-n[1],s[0]-n[0])*180/Math.PI,o=-1*(f+90),x=o<0?o+360:o;t.angle=parseFloat(x.toFixed(2))},calculatepXY3:function e(t,r,n){var a=t.rectangle.getCoordinate("0.0"),s=this.deegrees2meters(a),f=t.rectangle.getCoordinate("0.1"),o=this.deegrees2meters(f),x=this.deegrees2meters([r.lngLat.lng,r.lngLat.lat]),C=this.deegrees2meters([r.lngLat.lng,r.lngLat.lat]);if(s[0]===o[0])x=[C[0],o[1]];else if(s[1]===o[1])x=[o[0],C[1]];else{var P=(o[1]-s[1])/(o[0]-s[0]),ge=-1/P;Math.abs(ge)<1?x[1]=ge*(C[0]-o[0])+o[1]:x[0]=o[0]+(x[1]-o[1])/ge}var nt=[o[0]-s[0],o[1]-s[1]],ze=[x[0]-nt[0],x[1]-nt[1]],Bt=this.meters2degress(x),qr=this.meters2degress(ze);return t.rectangle.updateCoordinate("0.2",Bt[0],Bt[1]),t.rectangle.updateCoordinate("0.3",qr[0],qr[1]),qr},onKeyUp:function e(t,r){if(r.keyCode===27)return this.changeMode("simple_select")},onStop:function e(t){doubleClickZoom$1.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.getFeature(t.rectangle.id)!==void 0&&(t.rectangle.removeCoordinate("0.4"),t.rectangle.isValid()?this.map.fire("draw.create",{features:[t.rectangle.toGeoJSON()]}):(this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function e(t,r,n){var a=r.properties.id===t.rectangle.id;if(r.properties.active=a?"true":"false",r.properties.angle=t.angle,r.angle=t.angle,!a)return n(r);var s=r.geometry.coordinates[0].length;if(s<3){var f=r.geometry.coordinates[0][0],o={type:"Feature",properties:r.properties,angle:t.angle,geometry:{coordinates:r.geometry.coordinates[0][0],type:"Point"}};f&&n(o);return}if(s>=3&&s<=4){var x=[[r.geometry.coordinates[0][0][0],r.geometry.coordinates[0][0][1]],[r.geometry.coordinates[0][1][0],r.geometry.coordinates[0][1][1]]];if(n({type:"Feature",properties:r.properties,angle:t.angle,geometry:{coordinates:x,type:"LineString"}}),s===3)return}return n(r)},onTrash:function e(t){this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select")}},_default=DrawAssistedRectangle$2.default=DrawAssistedRectangle$1;class MapboxGLButtonControl{constructor({className:t="",title:r="",eventHandler:n=evtHndlr}){this._className=t,this._title=r,this._eventHandler=n}onAdd(t){return this._btn=document.createElement("button"),this._btn.className="mapboxgl-ctrl-icon "+this._className,this._btn.type="button",this._btn.title=this._title,this._btn.onclick=this._eventHandler,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const styles="";var tilesInBbox={};function lonToX(e,t){var r=Math.pow(2,t),n=Math.floor((e+180)/360*r);return n}function latToY(e,t){var r=e*Math.PI/180,n=Math.pow(2,t),a=Math.floor((1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2*n);return a}tilesInBbox.tilesInBbox=function(e,t){for(var r=[],n=lonToX(e.left,t),a=lonToX(e.right,t),s=latToY(e.top,t),f=latToY(e.bottom,t),o=n;o<=a;){for(var x=s;x<=f;)r.push({x:o,y:x,z:t}),x++;o++}return r};function useQuasar(){return inject(quasarKey)}var freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$6=root$7.Symbol,_Symbol=Symbol$6,Symbol$5=_Symbol,objectProto$b=Object.prototype,hasOwnProperty$8=objectProto$b.hasOwnProperty,nativeObjectToString$1=objectProto$b.toString,symToStringTag$1=Symbol$5?Symbol$5.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$8.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch{}var a=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),a}var _getRawTag=getRawTag$1,objectProto$a=Object.prototype,nativeObjectToString=objectProto$a.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$4=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$4?Symbol$4.toStringTag:void 0;function baseGetTag$5(e){return e==null?e===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$5;function isObjectLike$5(e){return e!=null&&typeof e=="object"}var isObjectLike_1=isObjectLike$5,baseGetTag$4=_baseGetTag,isObjectLike$4=isObjectLike_1,symbolTag$1="[object Symbol]";function isSymbol$5(e){return typeof e=="symbol"||isObjectLike$4(e)&&baseGetTag$4(e)==symbolTag$1}var isSymbol_1=isSymbol$5,isSymbol$4=isSymbol_1;function baseExtremum$2(e,t,r){for(var n=-1,a=e.length;++n<a;){var s=e[n],f=t(s);if(f!=null&&(o===void 0?f===f&&!isSymbol$4(f):r(f,o)))var o=f,x=s}return x}var _baseExtremum=baseExtremum$2;function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$3(e,t){return e===t||e!==e&&t!==t}var eq_1=eq$3,eq$2=eq_1;function assocIndexOf$4(e,t){for(var r=e.length;r--;)if(eq$2(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():splice.call(t,r,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$4.prototype.clear=listCacheClear;ListCache$4.prototype.delete=listCacheDelete;ListCache$4.prototype.get=listCacheGet;ListCache$4.prototype.has=listCacheHas;ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1;function isObject$4(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var isObject_1=isObject$4,baseGetTag$3=_baseGetTag,isObject$3=isObject_1,asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$3(e))return!1;var t=baseGetTag$3(e);return t==funcTag$1||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$2(e){if(e!=null){try{return funcToString$1.call(e)}catch{}try{return e+""}catch{}}return""}var _toSource=toSource$2,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$2=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$9=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$7=objectProto$9.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$7).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){if(!isObject$2(e)||isMasked(e))return!1;var t=isFunction$1(e)?reIsNative:reIsHostCtor;return t.test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return e?.[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$7(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$7,getNative$6=_getNative,root$5=_root,Map$5=getNative$6(root$5,"Map"),_Map=Map$5,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$6.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?t[e]!==void 0:hasOwnProperty$5.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&t===void 0?HASH_UNDEFINED$1:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash$1.prototype.clear=hashClear;Hash$1.prototype.delete=hashDelete;Hash$1.prototype.get=hashGet;Hash$1.prototype.has=hashHas;Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$4=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$4||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r[typeof t=="string"?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$3(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache$3.prototype.clear=mapCacheClear;MapCache$3.prototype.delete=mapCacheDelete;MapCache$3.prototype.get=mapCacheGet;MapCache$3.prototype.has=mapCacheHas;MapCache$3.prototype.set=mapCacheSet;var _MapCache=MapCache$3,ListCache$1=_ListCache,Map$3=_Map,MapCache$2=_MapCache,LARGE_ARRAY_SIZE=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var n=r.__data__;if(!Map$3||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$2(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$2(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$2.prototype.clear=stackClear;Stack$2.prototype.delete=stackDelete;Stack$2.prototype.get=stackGet;Stack$2.prototype.has=stackHas;Stack$2.prototype.set=stackSet;var _Stack=Stack$2,HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd$1(e){return this.__data__.set(e,HASH_UNDEFINED),this}var _setCacheAdd=setCacheAdd$1;function setCacheHas$1(e){return this.__data__.has(e)}var _setCacheHas=setCacheHas$1,MapCache$1=_MapCache,setCacheAdd=_setCacheAdd,setCacheHas=_setCacheHas;function SetCache$1(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new MapCache$1;++t<r;)this.add(e[t])}SetCache$1.prototype.add=SetCache$1.prototype.push=setCacheAdd;SetCache$1.prototype.has=setCacheHas;var _SetCache=SetCache$1;function arraySome$1(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _arraySome=arraySome$1;function cacheHas$1(e,t){return e.has(t)}var _cacheHas=cacheHas$1,SetCache=_SetCache,arraySome=_arraySome,cacheHas=_cacheHas,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays$2(e,t,r,n,a,s){var f=r&COMPARE_PARTIAL_FLAG$5,o=e.length,x=t.length;if(o!=x&&!(f&&x>o))return!1;var C=s.get(e),P=s.get(t);if(C&&P)return C==t&&P==e;var ge=-1,nt=!0,ze=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(s.set(e,t),s.set(t,e);++ge<o;){var Bt=e[ge],qr=t[ge];if(n)var _n=f?n(qr,Bt,ge,t,e,s):n(Bt,qr,ge,e,t,s);if(_n!==void 0){if(_n)continue;nt=!1;break}if(ze){if(!arraySome(t,function(Fn,tl){if(!cacheHas(ze,tl)&&(Bt===Fn||a(Bt,Fn,r,n,s)))return ze.push(tl)})){nt=!1;break}}else if(!(Bt===qr||a(Bt,qr,r,n,s))){nt=!1;break}}return s.delete(e),s.delete(t),nt}var _equalArrays=equalArrays$2,root$4=_root,Uint8Array$2=root$4.Uint8Array,_Uint8Array=Uint8Array$2;function mapToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var _mapToArray=mapToArray$1;function setToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var _setToArray=setToArray$1,Symbol$3=_Symbol,Uint8Array$1=_Uint8Array,eq$1=eq_1,equalArrays$1=_equalArrays,mapToArray=_mapToArray,setToArray=_setToArray,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",mapTag$2="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$2="[object DataView]",symbolProto$1=Symbol$3?Symbol$3.prototype:void 0,symbolValueOf=symbolProto$1?symbolProto$1.valueOf:void 0;function equalByTag$1(e,t,r,n,a,s,f){switch(r){case dataViewTag$2:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag$1:return!(e.byteLength!=t.byteLength||!s(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag$1:case dateTag$1:case numberTag$1:return eq$1(+e,+t);case errorTag$1:return e.name==t.name&&e.message==t.message;case regexpTag$1:case stringTag$1:return e==t+"";case mapTag$2:var o=mapToArray;case setTag$2:var x=n&COMPARE_PARTIAL_FLAG$4;if(o||(o=setToArray),e.size!=t.size&&!x)return!1;var C=f.get(e);if(C)return C==t;n|=COMPARE_UNORDERED_FLAG$2,f.set(e,t);var P=equalArrays$1(o(e),o(t),n,a,s,f);return f.delete(e),P;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var _equalByTag=equalByTag$1;function arrayPush$2(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var _arrayPush=arrayPush$2,isArray$a=Array.isArray,isArray_1=isArray$a,arrayPush$1=_arrayPush,isArray$9=isArray_1;function baseGetAllKeys$1(e,t,r){var n=t(e);return isArray$9(e)?n:arrayPush$1(n,r(e))}var _baseGetAllKeys=baseGetAllKeys$1;function arrayFilter$1(e,t){for(var r=-1,n=e==null?0:e.length,a=0,s=[];++r<n;){var f=e[r];t(f,r,e)&&(s[a++]=f)}return s}var _arrayFilter=arrayFilter$1;function stubArray$1(){return[]}var stubArray_1=stubArray$1,arrayFilter=_arrayFilter,stubArray=stubArray_1,objectProto$6=Object.prototype,propertyIsEnumerable$1=objectProto$6.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols$1=nativeGetSymbols?function(e){return e==null?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable$1.call(e,t)}))}:stubArray,_getSymbols=getSymbols$1;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1,baseGetTag$2=_baseGetTag,isObjectLike$3=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$3(e)&&baseGetTag$2(e)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$2=isObjectLike_1,objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty,propertyIsEnumerable=objectProto$5.propertyIsEnumerable,isArguments$3=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$2(e)&&hasOwnProperty$4.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments$3,isBuffer$2={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;isBuffer$2.exports;(function(e,t){var r=_root,n=stubFalse_1,a=t&&!t.nodeType&&t,s=a&&!0&&e&&!e.nodeType&&e,f=s&&s.exports===a,o=f?r.Buffer:void 0,x=o?o.isBuffer:void 0,C=x||n;e.exports=C})(isBuffer$2,isBuffer$2.exports);var isBufferExports=isBuffer$2.exports,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$3(e,t){var r=typeof e;return t=t??MAX_SAFE_INTEGER$1,!!t&&(r=="number"||r!="symbol"&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$3,MAX_SAFE_INTEGER=9007199254740991;function isLength$3(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$3,baseGetTag$1=_baseGetTag,isLength$2=isLength_1,isObjectLike$1=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag$1="[object Map]",numberTag="[object Number]",objectTag$2="[object Object]",regexpTag="[object RegExp]",setTag$1="[object Set]",stringTag="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag$1]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag$1]=typedArrayTags[numberTag]=typedArrayTags[objectTag$2]=typedArrayTags[regexpTag]=typedArrayTags[setTag$1]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag$1]=!1;function baseIsTypedArray$1(e){return isObjectLike$1(e)&&isLength$2(e.length)&&!!typedArrayTags[baseGetTag$1(e)]}var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$2(e){return function(t){return e(t)}}var _baseUnary=baseUnary$2,_nodeUtil={exports:{}};_nodeUtil.exports;(function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,s=a&&a.exports===n,f=s&&r.process,o=function(){try{var x=a&&a.require&&a.require("util").types;return x||f&&f.binding&&f.binding("util")}catch{}}();e.exports=o})(_nodeUtil,_nodeUtil.exports);var _nodeUtilExports=_nodeUtil.exports,baseIsTypedArray=_baseIsTypedArray,baseUnary$1=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary$1(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$2,baseTimes=_baseTimes,isArguments$2=isArguments_1,isArray$8=isArray_1,isBuffer$1=isBufferExports,isIndex$2=_isIndex,isTypedArray$1=isTypedArray_1,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function arrayLikeKeys$1(e,t){var r=isArray$8(e),n=!r&&isArguments$2(e),a=!r&&!n&&isBuffer$1(e),s=!r&&!n&&!a&&isTypedArray$1(e),f=r||n||a||s,o=f?baseTimes(e.length,String):[],x=o.length;for(var C in e)(t||hasOwnProperty$3.call(e,C))&&!(f&&(C=="length"||a&&(C=="offset"||C=="parent")||s&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||isIndex$2(C,x)))&&o.push(C);return o}var _arrayLikeKeys=arrayLikeKeys$1,objectProto$3=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||objectProto$3;return e===r}var _isPrototype=isPrototype$1;function overArg$1(e,t){return function(r){return e(t(r))}}var _overArg=overArg$1,overArg=_overArg,nativeKeys$1=overArg(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype=_isPrototype,nativeKeys=_nativeKeys,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function baseKeys$1(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$2.call(e,r)&&r!="constructor"&&t.push(r);return t}var _baseKeys=baseKeys$1,isFunction=isFunction_1,isLength$1=isLength_1;function isArrayLike$4(e){return e!=null&&isLength$1(e.length)&&!isFunction(e)}var isArrayLike_1=isArrayLike$4,arrayLikeKeys=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$3=isArrayLike_1;function keys$3(e){return isArrayLike$3(e)?arrayLikeKeys(e):baseKeys(e)}var keys_1=keys$3,baseGetAllKeys=_baseGetAllKeys,getSymbols=_getSymbols,keys$2=keys_1;function getAllKeys$1(e){return baseGetAllKeys(e,keys$2,getSymbols)}var _getAllKeys=getAllKeys$1,getAllKeys=_getAllKeys,COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects$1(e,t,r,n,a,s){var f=r&COMPARE_PARTIAL_FLAG$3,o=getAllKeys(e),x=o.length,C=getAllKeys(t),P=C.length;if(x!=P&&!f)return!1;for(var ge=x;ge--;){var nt=o[ge];if(!(f?nt in t:hasOwnProperty$1.call(t,nt)))return!1}var ze=s.get(e),Bt=s.get(t);if(ze&&Bt)return ze==t&&Bt==e;var qr=!0;s.set(e,t),s.set(t,e);for(var _n=f;++ge<x;){nt=o[ge];var Fn=e[nt],tl=t[nt];if(n)var Io=f?n(tl,Fn,nt,t,e,s):n(Fn,tl,nt,e,t,s);if(!(Io===void 0?Fn===tl||a(Fn,tl,r,n,s):Io)){qr=!1;break}_n||(_n=nt=="constructor")}if(qr&&!_n){var Co=e.constructor,rl=t.constructor;Co!=rl&&"constructor"in e&&"constructor"in t&&!(typeof Co=="function"&&Co instanceof Co&&typeof rl=="function"&&rl instanceof rl)&&(qr=!1)}return s.delete(e),s.delete(t),qr}var _equalObjects=equalObjects$1,getNative$4=_getNative,root$3=_root,DataView$2=getNative$4(root$3,"DataView"),_DataView=DataView$2,getNative$3=_getNative,root$2=_root,Promise$2=getNative$3(root$2,"Promise"),_Promise=Promise$2,getNative$2=_getNative,root$1=_root,Set$2=getNative$2(root$1,"Set"),_Set=Set$2,getNative$1=_getNative,root=_root,WeakMap$2=getNative$1(root,"WeakMap"),_WeakMap=WeakMap$2,DataView$1=_DataView,Map$2=_Map,Promise$1=_Promise,Set$1=_Set,WeakMap$1=_WeakMap,baseGetTag=_baseGetTag,toSource=_toSource,mapTag="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$2),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag$1=baseGetTag;(DataView$1&&getTag$1(new DataView$1(new ArrayBuffer(1)))!=dataViewTag||Map$2&&getTag$1(new Map$2)!=mapTag||Promise$1&&getTag$1(Promise$1.resolve())!=promiseTag||Set$1&&getTag$1(new Set$1)!=setTag||WeakMap$1&&getTag$1(new WeakMap$1)!=weakMapTag)&&(getTag$1=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return t});var _getTag=getTag$1,Stack$1=_Stack,equalArrays=_equalArrays,equalByTag=_equalByTag,equalObjects=_equalObjects,getTag=_getTag,isArray$7=isArray_1,isBuffer=isBufferExports,isTypedArray=isTypedArray_1,COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep$1(e,t,r,n,a,s){var f=isArray$7(e),o=isArray$7(t),x=f?arrayTag:getTag(e),C=o?arrayTag:getTag(t);x=x==argsTag?objectTag:x,C=C==argsTag?objectTag:C;var P=x==objectTag,ge=C==objectTag,nt=x==C;if(nt&&isBuffer(e)){if(!isBuffer(t))return!1;f=!0,P=!1}if(nt&&!P)return s||(s=new Stack$1),f||isTypedArray(e)?equalArrays(e,t,r,n,a,s):equalByTag(e,t,x,r,n,a,s);if(!(r&COMPARE_PARTIAL_FLAG$2)){var ze=P&&hasOwnProperty.call(e,"__wrapped__"),Bt=ge&&hasOwnProperty.call(t,"__wrapped__");if(ze||Bt){var qr=ze?e.value():e,_n=Bt?t.value():t;return s||(s=new Stack$1),a(qr,_n,r,n,s)}}return nt?(s||(s=new Stack$1),equalObjects(e,t,r,n,a,s)):!1}var _baseIsEqualDeep=baseIsEqualDeep$1,baseIsEqualDeep=_baseIsEqualDeep,isObjectLike=isObjectLike_1;function baseIsEqual$2(e,t,r,n,a){return e===t?!0:e==null||t==null||!isObjectLike(e)&&!isObjectLike(t)?e!==e&&t!==t:baseIsEqualDeep(e,t,r,n,baseIsEqual$2,a)}var _baseIsEqual=baseIsEqual$2,Stack=_Stack,baseIsEqual$1=_baseIsEqual,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch$1(e,t,r,n){var a=r.length,s=a,f=!n;if(e==null)return!s;for(e=Object(e);a--;){var o=r[a];if(f&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++a<s;){o=r[a];var x=o[0],C=e[x],P=o[1];if(f&&o[2]){if(C===void 0&&!(x in e))return!1}else{var ge=new Stack;if(n)var nt=n(C,P,x,e,t,ge);if(!(nt===void 0?baseIsEqual$1(P,C,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,ge):nt))return!1}}return!0}var _baseIsMatch=baseIsMatch$1,isObject$1=isObject_1;function isStrictComparable$2(e){return e===e&&!isObject$1(e)}var _isStrictComparable=isStrictComparable$2,isStrictComparable$1=_isStrictComparable,keys$1=keys_1;function getMatchData$1(e){for(var t=keys$1(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,isStrictComparable$1(a)]}return t}var _getMatchData=getMatchData$1;function matchesStrictComparable$2(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var _matchesStrictComparable=matchesStrictComparable$2,baseIsMatch=_baseIsMatch,getMatchData=_getMatchData,matchesStrictComparable$1=_matchesStrictComparable;function baseMatches$1(e){var t=getMatchData(e);return t.length==1&&t[0][2]?matchesStrictComparable$1(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}var _baseMatches=baseMatches$1,isArray$6=isArray_1,isSymbol$3=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$3(e,t){if(isArray$6(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||isSymbol$3(e)?!0:reIsPlainProp.test(e)||!reIsDeepProp.test(e)||t!=null&&e in Object(t)}var _isKey=isKey$3,MapCache=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var f=e.apply(this,n);return r.cache=s.set(a,f)||s,f};return r.cache=new(memoize$1.Cache||MapCache),r}memoize$1.Cache=MapCache;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(e){var t=memoize(e,function(n){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),n}),r=t.cache;return t}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rePropName,function(r,n,a,s){t.push(a?s.replace(reEscapeChar,"$1"):n||r)}),t}),_stringToPath=stringToPath$1;function arrayMap$2(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var _arrayMap=arrayMap$2,Symbol$2=_Symbol,arrayMap$1=_arrayMap,isArray$5=isArray_1,isSymbol$2=isSymbol_1,INFINITY$1=1/0,symbolProto=Symbol$2?Symbol$2.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString$1(e){if(typeof e=="string")return e;if(isArray$5(e))return arrayMap$1(e,baseToString$1)+"";if(isSymbol$2(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return t=="0"&&1/e==-INFINITY$1?"-0":t}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$1(e){return e==null?"":baseToString(e)}var toString_1=toString$1,isArray$4=isArray_1,isKey$2=_isKey,stringToPath=_stringToPath,toString=toString_1;function castPath$2(e,t){return isArray$4(e)?e:isKey$2(e,t)?[e]:stringToPath(toString(e))}var _castPath=castPath$2,isSymbol$1=isSymbol_1,INFINITY=1/0;function toKey$4(e){if(typeof e=="string"||isSymbol$1(e))return e;var t=e+"";return t=="0"&&1/e==-INFINITY?"-0":t}var _toKey=toKey$4,castPath$1=_castPath,toKey$3=_toKey;function baseGet$3(e,t){t=castPath$1(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[toKey$3(t[r++])];return r&&r==n?e:void 0}var _baseGet=baseGet$3,baseGet$2=_baseGet;function get$2(e,t,r){var n=e==null?void 0:baseGet$2(e,t);return n===void 0?r:n}var get_1=get$2;function baseHasIn$1(e,t){return e!=null&&t in Object(e)}var _baseHasIn=baseHasIn$1,castPath=_castPath,isArguments$1=isArguments_1,isArray$3=isArray_1,isIndex$1=_isIndex,isLength=isLength_1,toKey$2=_toKey;function hasPath$1(e,t,r){t=castPath(t,e);for(var n=-1,a=t.length,s=!1;++n<a;){var f=toKey$2(t[n]);if(!(s=e!=null&&r(e,f)))break;e=e[f]}return s||++n!=a?s:(a=e==null?0:e.length,!!a&&isLength(a)&&isIndex$1(f,a)&&(isArray$3(e)||isArguments$1(e)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$1(e,t){return e!=null&&hasPath(e,t,baseHasIn)}var hasIn_1=hasIn$1,baseIsEqual=_baseIsEqual,get$1=get_1,hasIn=hasIn_1,isKey$1=_isKey,isStrictComparable=_isStrictComparable,matchesStrictComparable=_matchesStrictComparable,toKey$1=_toKey,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty$1(e,t){return isKey$1(e)&&isStrictComparable(t)?matchesStrictComparable(toKey$1(e),t):function(r){var n=get$1(r,e);return n===void 0&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var _baseMatchesProperty=baseMatchesProperty$1;function identity$4(e){return e}var identity_1=identity$4;function baseProperty$1(e){return function(t){return t?.[e]}}var _baseProperty=baseProperty$1,baseGet$1=_baseGet;function basePropertyDeep$1(e){return function(t){return baseGet$1(t,e)}}var _basePropertyDeep=basePropertyDeep$1,baseProperty=_baseProperty,basePropertyDeep=_basePropertyDeep,isKey=_isKey,toKey=_toKey;function property$1(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}var property_1=property$1,baseMatches=_baseMatches,baseMatchesProperty=_baseMatchesProperty,identity$3=identity_1,isArray$2=isArray_1,property=property_1;function baseIteratee$3(e){return typeof e=="function"?e:e==null?identity$3:typeof e=="object"?isArray$2(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var _baseIteratee=baseIteratee$3;function baseLt$1(e,t){return e<t}var _baseLt=baseLt$1,baseExtremum$1=_baseExtremum,baseIteratee$2=_baseIteratee,baseLt=_baseLt;function minBy(e,t){return e&&e.length?baseExtremum$1(e,baseIteratee$2(t),baseLt):void 0}var minBy_1=minBy;const minBy$1=getDefaultExportFromCjs(minBy_1);function baseGt$1(e,t){return e>t}var _baseGt=baseGt$1,baseExtremum=_baseExtremum,baseGt=_baseGt,baseIteratee$1=_baseIteratee;function maxBy(e,t){return e&&e.length?baseExtremum(e,baseIteratee$1(t),baseGt):void 0}var maxBy_1=maxBy;const maxBy$1=getDefaultExportFromCjs(maxBy_1);var Symbol$1=_Symbol,isArguments=isArguments_1,isArray$1=isArray_1,spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable$1(e){return isArray$1(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$1(e,t,r,n,a){var s=-1,f=e.length;for(r||(r=isFlattenable),a||(a=[]);++s<f;){var o=e[s];t>0&&r(o)?t>1?baseFlatten$1(o,t-1,r,n,a):arrayPush(a,o):n||(a[a.length]=o)}return a}var _baseFlatten=baseFlatten$1;function createBaseFor$1(e){return function(t,r,n){for(var a=-1,s=Object(t),f=n(t),o=f.length;o--;){var x=f[e?o:++a];if(r(s[x],x,s)===!1)break}return t}}var _createBaseFor=createBaseFor$1,createBaseFor=_createBaseFor,baseFor$1=createBaseFor(),_baseFor=baseFor$1,baseFor=_baseFor,keys=keys_1;function baseForOwn$1(e,t){return e&&baseFor(e,t,keys)}var _baseForOwn=baseForOwn$1,isArrayLike$2=isArrayLike_1;function createBaseEach$1(e,t){return function(r,n){if(r==null)return r;if(!isArrayLike$2(r))return e(r,n);for(var a=r.length,s=t?a:-1,f=Object(r);(t?s--:++s<a)&&n(f[s],s,f)!==!1;);return r}}var _createBaseEach=createBaseEach$1,baseForOwn=_baseForOwn,createBaseEach=_createBaseEach,baseEach$1=createBaseEach(baseForOwn),_baseEach=baseEach$1,baseEach=_baseEach,isArrayLike$1=isArrayLike_1;function baseMap$1(e,t){var r=-1,n=isArrayLike$1(e)?Array(e.length):[];return baseEach(e,function(a,s,f){n[++r]=t(a,s,f)}),n}var _baseMap=baseMap$1;function baseSortBy$1(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var _baseSortBy=baseSortBy$1,isSymbol=isSymbol_1;function compareAscending$1(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,s=isSymbol(e),f=t!==void 0,o=t===null,x=t===t,C=isSymbol(t);if(!o&&!C&&!s&&e>t||s&&f&&x&&!o&&!C||n&&f&&x||!r&&x||!a)return 1;if(!n&&!s&&!C&&e<t||C&&r&&a&&!n&&!s||o&&r&&a||!f&&a||!x)return-1}return 0}var _compareAscending=compareAscending$1,compareAscending=_compareAscending;function compareMultiple$1(e,t,r){for(var n=-1,a=e.criteria,s=t.criteria,f=a.length,o=r.length;++n<f;){var x=compareAscending(a[n],s[n]);if(x){if(n>=o)return x;var C=r[n];return x*(C=="desc"?-1:1)}}return e.index-t.index}var _compareMultiple=compareMultiple$1,arrayMap=_arrayMap,baseGet=_baseGet,baseIteratee=_baseIteratee,baseMap=_baseMap,baseSortBy=_baseSortBy,baseUnary=_baseUnary,compareMultiple=_compareMultiple,identity$2=identity_1,isArray=isArray_1;function baseOrderBy$1(e,t,r){t.length?t=arrayMap(t,function(s){return isArray(s)?function(f){return baseGet(f,s.length===1?s[0]:s)}:s}):t=[identity$2];var n=-1;t=arrayMap(t,baseUnary(baseIteratee));var a=baseMap(e,function(s,f,o){var x=arrayMap(t,function(C){return C(s)});return{criteria:x,index:++n,value:s}});return baseSortBy(a,function(s,f){return compareMultiple(s,f,r)})}var _baseOrderBy=baseOrderBy$1;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax=Math.max;function overRest$1(e,t,r){return t=nativeMax(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,s=nativeMax(n.length-t,0),f=Array(s);++a<s;)f[a]=n[t+a];a=-1;for(var o=Array(t+1);++a<t;)o[a]=n[a];return o[t]=r(f),apply(e,this,o)}}var _overRest=overRest$1;function constant$1(e){return function(){return e}}var constant_1=constant$1,getNative=_getNative,defineProperty$1=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch{}}(),_defineProperty=defineProperty$1,constant=constant_1,defineProperty=_defineProperty,identity$1=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$1,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var n=nativeNow(),a=HOT_SPAN-(n-r);if(r=n,a>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$1=shortOut(baseSetToString),_setToString=setToString$1,identity=identity_1,overRest=_overRest,setToString=_setToString;function baseRest$1(e,t){return setToString(overRest(e,t,identity),e+"")}var _baseRest=baseRest$1,eq=eq_1,isArrayLike=isArrayLike_1,isIndex=_isIndex,isObject=isObject_1;function isIterateeCall$1(e,t,r){if(!isObject(r))return!1;var n=typeof t;return(n=="number"?isArrayLike(r)&&isIndex(t,r.length):n=="string"&&t in r)?eq(r[t],e):!1}var _isIterateeCall=isIterateeCall$1,baseFlatten=_baseFlatten,baseOrderBy=_baseOrderBy,baseRest=_baseRest,isIterateeCall=_isIterateeCall,sortBy=baseRest(function(e,t){if(e==null)return[];var r=t.length;return r>1&&isIterateeCall(e,t[0],t[1])?t=[]:r>2&&isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),baseOrderBy(e,baseFlatten(t,1),[])}),sortBy_1=sortBy;const sortBy$1=getDefaultExportFromCjs(sortBy_1);async function combineTilesJimp(e,t,r){const n=minBy$1(e,qr=>qr.x).x,a=minBy$1(e,qr=>qr.y).y,s=qr=>({x:qr.x-n,y:qr.y-a,buffer:qr.buffer}),f=sortBy$1(e.map(s),["y","x"]),o=1+maxBy$1(f,qr=>qr.x).x,x=1+maxBy$1(f,qr=>qr.y).y,C=t*o,P=r*x;async function ge(qr){for(let _n of f){let Fn=Buffer.from(_n.buffer),tl=_n.y*r,Io=_n.x*t,Co=await Jimp.read(Fn);qr.composite(Co,Io,tl)}return qr}let nt=await Jimp.read(Buffer.from(f[0].buffer));return nt.background(4294967295),nt.resize(C,P),await(await ge(nt)).getBufferAsync(Jimp.MIME_PNG)}const mapboxMapViewer_vue_vue_type_style_index_0_lang="";let draw$1,geocoder;const STYLES_DRAW$1=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#FF0000","fill-outline-color":"#D20C0C","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":3}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#ee0508","fill-opacity":.8}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c40b0b","line-width":2}}],_sfc_main$5={name:"mapbox-map-viewer",setup(){const e=useQuasar();return{alert:ref(!1),alertMsg:ref(""),tileInfoString:ref(""),dirHandle:ref(""),qt:e,style_url:ref(""),zoom:ref(""),access_token:ref(""),rasterFromStyle:ref(!1),mapbox_raster_png_dem:ref(""),mapbox_api_url:ref(""),drawmode:ref("simple_select"),mapbox_rgb_image_url:ref(""),map:ref(""),features:ref([]),threedview:ref(!1),layers:ref(["hillshading","bounding_box","undersea-features-lines","undersea-features-points","undersea-features-points-label","10m-bathymetry-81bsvj"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Undersea Lines",value:"undersea-features-lines"},{label:"Undersea Points",value:"undersea-features-points"},{label:"Undersea Labels",value:"undersea-features-points-label"},{label:"Depth",value:"10m-bathymetry-81bsvj"},{label:"Satellite",value:"satellite"},{label:"3D",value:"3d"}]}},mounted(){},methods:{async changeLayers(e){for(const t of this.layer_type)e.includes(t.value)?t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","visible"):this.map.setTerrain({source:"mapbox-3d",exaggeration:1.5}):t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","none"):this.map.setTerrain(null)},changeDrawMode(e){let t=document.getElementsByClassName("mapbox-gl-draw_polygon")[0],r=document.getElementsByClassName("mapbox-gl-draw_line")[0],n=e.target;n.title==="Select single tile"?(r.style.backgroundColor="white",t.style.backgroundColor="green",draw$1.deleteAll(),draw$1.changeMode("simple_select"),this.drawmode="simple_select"):n.title==="Draw Rectangle to select multiple tiles"&&(r.style.backgroundColor="green",t.style.backgroundColor="white",draw$1.deleteAll(),draw$1.changeMode("draw_assisted_rectangle"),this.drawmode="draw_assisted_rectangle",this.map.setPaintProperty("bounding_box","fill-opacity",0)),console.log(this.drawmode)},loadMapSourcesLayers(e){this.rasterFromStyle===!1&&(e.addSource("mapbox_terrain_dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1"}),e.addSource("satellite",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:512}),e.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}}),e.addLayer({id:"hillshading",source:"mapbox_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),e.addSource("bathymetry",{type:"vector",url:"mapbox://mapbox-public.bathymetry"}),e.addLayer({id:"undersea-features-lines",type:"line",source:"bathymetry","source-layer":"undersea-features-lines",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff69b4","line-width":2}}),e.addLayer({id:"undersea-features-points",type:"circle",source:"bathymetry","source-layer":"undersea-features-points",paint:{"circle-radius":4,"circle-color":"#01fe01"}}),e.addLayer({id:"undersea-features-points-label",type:"symbol",source:"bathymetry","source-layer":"undersea-features-points",layout:{"text-field":"{name}","text-anchor":"top-left","text-size":12}}),e.addSource("10m-bathymetry-81bsvj",{type:"vector",url:"mapbox://mapbox.9tm8dx88"}),e.addSource("mapbox-3d",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:15}),e.addLayer({id:"10m-bathymetry-81bsvj",type:"fill",source:"10m-bathymetry-81bsvj","source-layer":"10m-bathymetry-81bsvj",layout:{},paint:{"fill-outline-color":"hsla(337, 82%, 62%, 0)","fill-color":["interpolate",["cubic-bezier",0,.5,1,.5],["get","DEPTH"],200,"#78bced",9e3,"#15659f"]}},"land-structure-polygon"))},coordinateFeature(e,t){return{center:[e,t],geometry:{type:"Point",coordinates:[e,t]},place_name:"Lat: "+t+" Lng: "+e,place_type:["coordinate"],properties:{},type:"Feature"}},resizeMap(){this.map.resize()},async geoCodeReverse(e){mbxGeocoding({accessToken:mapboxgl.accessToken}).reverseGeocode({query:[e.pointLng,e.pointLat]}).send().then(function(r){if(r&&r.body&&r.body.features){e.address=r.body.features[0].place_name;let n=r.body.features[0].context;for(let a of n){let s=a.id;switch(s.substring(0,s.indexOf("."))){case"neighborhood":e.neighborhood=a.text;break;case"postcode":e.postcode=a.text;break;case"locality":e.locality=a.text;break;case"place":e.place=a.text;break;case"district":e.district=a.text;break;case"region":e.region=a.text;break;case"country":e.country=a.text;break}}}})},updateBBox(e){let t=e.features[0].geometry.coordinates[0],r,n,a,s;r=t[3][0],n=t[3][1],a=t[1][0],s=t[1][1];let f=[r,n,a,s],o=mapUtils.getTileInfo(0,0,!0,0,0,0,f);idbKeyval.set("tile_info",o)},async loadMapboxMap(){this.access_token=await idbKeyval.get("mapbox_access_token"),console.log(this.access_token),mapboxgl.accessToken=this.access_token,this.mapbox_api_url=await idbKeyval.get("mapbox_api_url"),this.dirHandle=await idbKeyval.get("dirHandle"),this.style_url=await idbKeyval.get("mapbox_style_url"),this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem");let e=this;if(!mapboxgl.supported())this.alertMsg="Your browser does not support Mapbox GL",this.alert=!0;else{let o=function(x){return x*(2-x)},t=new mapboxgl.Map({container:"map",trackResize:!0,style:e.style_url,center:[-121.7598,46.876],zoom:9,maxZoom:14,doubleClickZoom:!1,antialias:!0,boxZoom:!0,failIfMajorPerformanceCaveat:!0});this.map=t,this.map.doubleClickZoom.disable();const r=function(x){const C=x.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!C)return null;const P=Number(C[1]),ge=Number(C[2]),nt=[];return(P<-90||P>90)&&nt.push(e.coordinateFeature(P,ge)),(ge<-90||ge>90)&&nt.push(e.coordinateFeature(ge,P)),nt.length===0&&(nt.push(e.coordinateFeature(P,ge)),nt.push(e.coordinateFeature(ge,P))),nt};geocoder=new MapboxGeocoder$1({accessToken:this.access_token,mapboxgl,localGeocoder:r,zoom:10,placeholder:"Try: Lng , Lat or Name",reverseGeocode:!0}),t.addControl(geocoder),t.addControl(new mapboxgl.FullscreenControl({})),t.addControl(new mapboxgl.NavigationControl),draw$1=new MapboxDraw({modes:{...MapboxDraw.modes,draw_assisted_rectangle:_default},displayControlsDefault:!1,controls:{},userProperties:!0,styles:STYLES_DRAW$1}),t.addControl(draw$1);const n=new MapboxGLButtonControl({className:"mapbox-gl-draw_polygon",title:"Select single tile",eventHandler:e.changeDrawMode});t.addControl(n);const a=new MapboxGLButtonControl({className:"mapbox-gl-draw_line",title:"Draw Rectangle to select multiple tiles",eventHandler:e.changeDrawMode});t.addControl(a);const s=100,f=25;t.on("wheel",()=>{e.zoom=Math.floor(t.getZoom())}),t.on("load",function(){let x=document.getElementsByClassName("mapbox-gl-draw_polygon")[0];x.style.backgroundColor="green",draw$1.changeMode("simple_select"),this.drawmode="simple_select",e.loadMapSourcesLayers(t),t.getCanvas().focus(),t.getCanvas().addEventListener("keydown",C=>{C.preventDefault(),C.which===87?t.panBy([0,-s],{easing:o}):C.which===83?t.panBy([0,s],{easing:o}):C.which===65?t.easeTo({bearing:t.getBearing()-f,easing:o}):C.which===68&&t.easeTo({bearing:t.getBearing()+f,easing:o})},!0)}),t.on("error",x=>{console.error(x)}),t.on("draw.create",function(x){console.log("draw mode create "+x.type),e.updateBBox(x)}),t.on("draw.update",function(x){console.log("draw mode update "+x.type),e.updateBBox(x)}),t.on("draw.selectionchange",function(x){console.log("draw mode selectionchange "+x.type)}),t.on("draw.delete",function(x){console.log("draw mode delete "+x.type)}),t.on("draw.modechange",x=>{console.log("draw mode CHANGE "+x.mode)}),t.on("click",async function(x){if(e.drawmode==="simple_select"){let C=x.lngLat.lng,P=x.lngLat.lat,ge=Math.floor(t.getZoom());e.zoom=ge;let nt=mapUtils.getTileInfo(C,P,!1,0,0,ge);idbKeyval.set("tile_info",nt),e.tileInfoString="Slippy Tile Info String: "+nt.x+","+nt.y+","+nt.z+" Bounding Box sides in KM: "+nt.distance,t.getSource("bounding_box_source").setData(nt.polygon_bb),t.setPaintProperty("bounding_box","fill-opacity",.45)}}),t.on("dblclick",async function(x){let C=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(C,!0)===!1){console.error(`User did not grant permission to '${C.name}'`);return}let P=await idbKeyval.get("tile_info"),ge=!0;if(e.tileInfoString="Slippy Tile Info String: "+P.x+","+P.y+","+P.z+" Bounding Box sides in KM: "+P.distance,e.drawmode==="simple_select"){e.qt.loading.show(),e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${P.z}/${P.x}/${P.y}@2x.pngraw?access_token=`+e.access_token;let nt=await mapUtils.getMapboxTerrainRgb(e.mapbox_rgb_image_url),ze=await nt.toBuffer();await idbKeyval.set("rgb_image_buffer",ze),await fileUtils.writeFileToDisk(C,P.rgbFileName,ze);let Bt=mapUtils.createHeightMapImage(nt,32,"GREY");if(await fileUtils.fileExists(C,P.thirtyTwoFileName)===!1){let _n=await Bt.image.toBuffer();await fileUtils.writeFileToDisk(C,P.thirtyTwoFileName,_n)}emitter.emit("updatePreviewImage",{dir_handle:C,tile_info:P,preview_image_info:Bt,map:t,updateStats:ge}),e.qt.loading.hide()}else if(e.drawmode==="draw_assisted_rectangle"){e.qt.loading.show();let nt=await idbKeyval.get("exportOptionsModel"),ze=await idbKeyval.get("saveStitchingFiles"),Bt=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",qr=await idbKeyval.get("mapbox_raster_style_url")||"",_n=Math.floor(t.getZoom()),Fn={left:P.bbox[0],bottom:P.bbox[1],right:P.bbox[2],top:P.bbox[3]},tl=tilesInBbox.tilesInBbox(Fn,_n),Io=[],Co=[],rl=[];try{for(let hh of tl){let Sh={};P=mapUtils.getTileInfo(0,0,!0,hh.x,hh.y,hh.z,P.bbox),e.tileInfoString="Slippy Tile Info String: "+P.x+","+P.y+","+P.z+" Bounding Box sides in KM: "+P.distance,e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${P.z}/${P.x}/${P.y}@2x.pngraw?access_token=`+e.access_token;let hd=await(await mapUtils.getMapboxTerrainRgb(e.mapbox_rgb_image_url)).toBuffer();if(ze===!0&&await fileUtils.writeFileToDisk(C,P.rgbFileName,hd),Sh.x=P.x,Sh.y=P.y,Sh.buffer=hd,Io.push(Sh),nt.includes("raster_style")){let vd=Bt+"/"+qr+`/tiles/512/${P.z}/${P.x}/${P.y}@2x?access_token=`+e.access_token,Cd=await(await mapUtils.getMapboxTerrainRgb(vd)).toBuffer();Sh={},Sh.x=P.x,Sh.y=P.y,Sh.buffer=Cd,Co.push(Sh)}if(nt.includes("satellite")){let Ef=await idbKeyval.get("mapbox_satellite_endpoint")+`/${P.z}/${P.x}/${P.y}@2x?access_token=`+e.access_token,Cf=await(await mapUtils.getMapboxTerrainRgb(Ef)).toBuffer();Sh={},Sh.x=P.x,Sh.y=P.y,Sh.buffer=Cf,rl.push(Sh)}}idbKeyval.set("tile_info",P);const ah=512;let ch=await combineTilesJimp(Io,ah,ah);if(await idbKeyval.set("rgb_image_buffer",ch),await fileUtils.writeFileToDisk(C,P.rgbFileName,ch),nt.includes("raster_style")){let hh=await combineTilesJimp(Co,ah,ah);await idbKeyval.set("splat_image_buffer",hh),await fileUtils.writeFileToDisk(C,"splat_"+P.rgbFileName,hh)}if(nt.includes("satellite")){let hh=await combineTilesJimp(rl,ah,ah);await idbKeyval.set("sat_image_buffer",hh),await fileUtils.writeFileToDisk(C,"sat_"+P.rgbFileName,hh)}let ju=await idbKeyval.get("rgb_image_buffer"),Zu=await mapUtils.loadImageFromArray(ju),sl=mapUtils.createHeightMapImage(Zu,32,"GREY");if(await fileUtils.fileExists(C,P.thirtyTwoFileName)===!1){let hh=await sl.image.toBuffer();await fileUtils.writeFileToDisk(C,P.thirtyTwoFileName,hh)}emitter.emit("updatePreviewImage",{dir_handle:C,tile_info:P,preview_image_info:sl,map:t,updateStats:ge}),e.qt.loading.hide()}catch(ah){console.log(ah),e.alertMsg=ah,e.alert=!0,e.qt.loading.hide()}e.qt.loading.hide()}})}}}},_hoisted_1$5={id:"map"},_hoisted_2$4=createBaseVNode("pre",{id:"features"},null,-1),_hoisted_3$4={class:"row no-wrap q-pa-md"},_hoisted_4$4={class:"column"},_hoisted_5$4=createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1),_hoisted_6$4=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$5(e,t,r,n,a,s){return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$5,[_hoisted_2$4,createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("div",_hoisted_4$4,[_hoisted_5$4,createVNode(QOptionGroup,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:n.layer_type,type:"toggle",modelValue:n.layers,"onUpdate:modelValue":[t[0]||(t[0]=f=>n.layers=f),s.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),createTextVNode("       "+toDisplayString(" Zoom: "+this.zoom+" "+this.tileInfoString),1)]),_:1})]),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[1]||(t[1]=f=>n.alert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_6$4]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const MapboxMapViewer=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),maptilerSdk="";var maplibreGl={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){var r,n,a;function s(o,x){if(!r)r=x;else if(!n)n=x;else{var C="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",P={};r(P),a=x(P),typeof window<"u"&&(a.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}s(["exports"],function(o){var x=C;function C(_,p,S,j){this.cx=3*_,this.bx=3*(S-_)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p,this.by=3*(j-p)-this.cy,this.ay=1-this.cy-this.by,this.p1x=_,this.p1y=p,this.p2x=S,this.p2y=j}function P(_,p,S,j){const ut=new x(_,p,S,j);return function(Ot){return ut.solve(Ot)}}C.prototype={sampleCurveX:function(_){return((this.ax*_+this.bx)*_+this.cx)*_},sampleCurveY:function(_){return((this.ay*_+this.by)*_+this.cy)*_},sampleCurveDerivativeX:function(_){return(3*this.ax*_+2*this.bx)*_+this.cx},solveCurveX:function(_,p){if(p===void 0&&(p=1e-6),_<0)return 0;if(_>1)return 1;for(var S=_,j=0;j<8;j++){var ut=this.sampleCurveX(S)-_;if(Math.abs(ut)<p)return S;var Ot=this.sampleCurveDerivativeX(S);if(Math.abs(Ot)<1e-6)break;S-=ut/Ot}var fi=0,kn=1;for(S=_,j=0;j<20&&(ut=this.sampleCurveX(S),!(Math.abs(ut-_)<p));j++)_>ut?fi=S:kn=S,S=.5*(kn-fi)+fi;return S},solve:function(_,p){return this.sampleCurveY(this.solveCurveX(_,p))}};const ge=P(.25,.1,.25,1);function nt(_,p,S){return Math.min(S,Math.max(p,_))}function ze(_,p,S){const j=S-p,ut=((_-p)%j+j)%j+p;return ut===p?S:ut}function Bt(_,...p){for(const S of p)for(const j in S)_[j]=S[j];return _}let qr=1;function _n(_,p){_.forEach(S=>{p[S]&&(p[S]=p[S].bind(p))})}function Fn(_,p,S){const j={};for(const ut in _)j[ut]=p.call(S||this,_[ut],ut,_);return j}function tl(_,p,S){const j={};for(const ut in _)p.call(S||this,_[ut],ut,_)&&(j[ut]=_[ut]);return j}function Io(_){return Array.isArray(_)?_.map(Io):typeof _=="object"&&_?Fn(_,Io):_}const Co={};function rl(_){Co[_]||(typeof console<"u"&&console.warn(_),Co[_]=!0)}function ah(_,p,S){return(S.y-_.y)*(p.x-_.x)>(p.y-_.y)*(S.x-_.x)}function ch(_){let p=0;for(let S,j,ut=0,Ot=_.length,fi=Ot-1;ut<Ot;fi=ut++)S=_[ut],j=_[fi],p+=(j.x-S.x)*(S.y+j.y);return p}function ju(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Zu=null;function sl(_){if(Zu==null){const p=_.navigator?_.navigator.userAgent:null;Zu=!!_.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return Zu}function oh(_){return typeof ImageBitmap<"u"&&_ instanceof ImageBitmap}const hh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Sh,$h;const hd={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_){const p=requestAnimationFrame(_);return{cancel:()=>cancelAnimationFrame(p)}},getImageData(_,p=0){return this.getImageCanvasContext(_).getImageData(-p,-p,_.width+2*p,_.height+2*p)},getImageCanvasContext(_){const p=window.document.createElement("canvas"),S=p.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("failed to create canvas 2d context");return p.width=_.width,p.height=_.height,S.drawImage(_,0,0,_.width,_.height),S},resolveURL:_=>(Sh||(Sh=document.createElement("a")),Sh.href=_,Sh.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&($h==null&&($h=matchMedia("(prefers-reduced-motion: reduce)")),$h.matches)}};var vd=Ef;function Ef(_,p){this.x=_,this.y=p}Ef.prototype={clone:function(){return new Ef(this.x,this.y)},add:function(_){return this.clone()._add(_)},sub:function(_){return this.clone()._sub(_)},multByPoint:function(_){return this.clone()._multByPoint(_)},divByPoint:function(_){return this.clone()._divByPoint(_)},mult:function(_){return this.clone()._mult(_)},div:function(_){return this.clone()._div(_)},rotate:function(_){return this.clone()._rotate(_)},rotateAround:function(_,p){return this.clone()._rotateAround(_,p)},matMult:function(_){return this.clone()._matMult(_)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(_){return this.x===_.x&&this.y===_.y},dist:function(_){return Math.sqrt(this.distSqr(_))},distSqr:function(_){var p=_.x-this.x,S=_.y-this.y;return p*p+S*S},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(_){return Math.atan2(this.y-_.y,this.x-_.x)},angleWith:function(_){return this.angleWithSep(_.x,_.y)},angleWithSep:function(_,p){return Math.atan2(this.x*p-this.y*_,this.x*_+this.y*p)},_matMult:function(_){var p=_[2]*this.x+_[3]*this.y;return this.x=_[0]*this.x+_[1]*this.y,this.y=p,this},_add:function(_){return this.x+=_.x,this.y+=_.y,this},_sub:function(_){return this.x-=_.x,this.y-=_.y,this},_mult:function(_){return this.x*=_,this.y*=_,this},_div:function(_){return this.x/=_,this.y/=_,this},_multByPoint:function(_){return this.x*=_.x,this.y*=_.y,this},_divByPoint:function(_){return this.x/=_.x,this.y/=_.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var _=this.y;return this.y=this.x,this.x=-_,this},_rotate:function(_){var p=Math.cos(_),S=Math.sin(_),j=S*this.x+p*this.y;return this.x=p*this.x-S*this.y,this.y=j,this},_rotateAround:function(_,p){var S=Math.cos(_),j=Math.sin(_),ut=p.y+j*(this.x-p.x)+S*(this.y-p.y);return this.x=p.x+S*(this.x-p.x)-j*(this.y-p.y),this.y=ut,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ef.convert=function(_){return _ instanceof Ef?_:Array.isArray(_)?new Ef(_[0],_[1]):_};const Cd={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,REGISTERED_PROTOCOLS:{}};class Cf extends Error{constructor(p,S,j,ut){super(`AJAXError: ${S} (${p}): ${j}`),this.status=p,this.statusText=S,this.url=j,this.body=ut}}const Sd=ju()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function yd(_,p){const S=new AbortController,j=new Request(_.url,{method:_.method||"GET",body:_.body,credentials:_.credentials,headers:_.headers,referrer:Sd(),signal:S.signal});let ut=!1,Ot=!1;return _.type==="json"&&j.headers.set("Accept","application/json"),Ot||fetch(j).then(fi=>fi.ok?(kn=>{(_.type==="arrayBuffer"?kn.arrayBuffer():_.type==="json"?kn.json():kn.text()).then(ss=>{Ot||(ut=!0,p(null,ss,kn.headers.get("Cache-Control"),kn.headers.get("Expires")))}).catch(ss=>{Ot||p(new Error(ss.message))})})(fi):fi.blob().then(kn=>p(new Cf(fi.status,fi.statusText,_.url,kn)))).catch(fi=>{fi.code!==20&&p(new Error(fi.message))}),{cancel:()=>{Ot=!0,ut||S.abort()}}}const Hd=function(_,p){if(/:\/\//.test(_.url)&&!/^https?:|^file:/.test(_.url)){if(ju()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",_,p);if(!ju()){const j=_.url.substring(0,_.url.indexOf("://"));return(Cd.REGISTERED_PROTOCOLS[j]||yd)(_,p)}}if(!(/^file:/.test(S=_.url)||/^file:/.test(Sd())&&!/^\w+:/.test(S))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return yd(_,p);if(ju()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",_,p,void 0,!0)}var S;return function(j,ut){const Ot=new XMLHttpRequest;Ot.open(j.method||"GET",j.url,!0),j.type==="arrayBuffer"&&(Ot.responseType="arraybuffer");for(const fi in j.headers)Ot.setRequestHeader(fi,j.headers[fi]);return j.type==="json"&&(Ot.responseType="text",Ot.setRequestHeader("Accept","application/json")),Ot.withCredentials=j.credentials==="include",Ot.onerror=()=>{ut(new Error(Ot.statusText))},Ot.onload=()=>{if((Ot.status>=200&&Ot.status<300||Ot.status===0)&&Ot.response!==null){let fi=Ot.response;if(j.type==="json")try{fi=JSON.parse(Ot.response)}catch(kn){return ut(kn)}ut(null,fi,Ot.getResponseHeader("Cache-Control"),Ot.getResponseHeader("Expires"))}else{const fi=new Blob([Ot.response],{type:Ot.getResponseHeader("Content-Type")});ut(new Cf(Ot.status,Ot.statusText,j.url,fi))}},Ot.send(j.body),{cancel:()=>Ot.abort()}}(_,p)},xd=function(_,p){return Hd(Bt(_,{type:"arrayBuffer"}),p)};function Pd(_){const p=window.document.createElement("a");return p.href=_,p.protocol===window.document.location.protocol&&p.host===window.document.location.host}function zd(_,p,S){S[_]&&S[_].indexOf(p)!==-1||(S[_]=S[_]||[],S[_].push(p))}function Ld(_,p,S){if(S&&S[_]){const j=S[_].indexOf(p);j!==-1&&S[_].splice(j,1)}}class Kd{constructor(p,S={}){Bt(this,S),this.type=p}}class wf extends Kd{constructor(p,S={}){super("error",Bt({error:p},S))}}class kd{on(p,S){return this._listeners=this._listeners||{},zd(p,S,this._listeners),this}off(p,S){return Ld(p,S,this._listeners),Ld(p,S,this._oneTimeListeners),this}once(p,S){return S?(this._oneTimeListeners=this._oneTimeListeners||{},zd(p,S,this._oneTimeListeners),this):new Promise(j=>this.once(p,j))}fire(p,S){typeof p=="string"&&(p=new Kd(p,S||{}));const j=p.type;if(this.listens(j)){p.target=this;const ut=this._listeners&&this._listeners[j]?this._listeners[j].slice():[];for(const kn of ut)kn.call(this,p);const Ot=this._oneTimeListeners&&this._oneTimeListeners[j]?this._oneTimeListeners[j].slice():[];for(const kn of Ot)Ld(j,kn,this._oneTimeListeners),kn.call(this,p);const fi=this._eventedParent;fi&&(Bt(p,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),fi.fire(p))}else p instanceof wf&&console.error(p.error);return this}listens(p){return this._listeners&&this._listeners[p]&&this._listeners[p].length>0||this._oneTimeListeners&&this._oneTimeListeners[p]&&this._oneTimeListeners[p].length>0||this._eventedParent&&this._eventedParent.listens(p)}setEventedParent(p,S){return this._eventedParent=p,this._eventedParentData=S,this}}var cd={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class gd{constructor(p,S,j,ut){this.message=(p?`${p}: `:"")+j,ut&&(this.identifier=ut),S!=null&&S.__line__&&(this.line=S.__line__)}}function bp(_){const p=_.value;return p?[new gd(_.key,p,"constants have been deprecated as of v8")]:[]}function Uf(_,...p){for(const S of p)for(const j in S)_[j]=S[j];return _}function qd(_){return _ instanceof Number||_ instanceof String||_ instanceof Boolean?_.valueOf():_}function Vd(_){if(Array.isArray(_))return _.map(Vd);if(_ instanceof Object&&!(_ instanceof Number||_ instanceof String||_ instanceof Boolean)){const p={};for(const S in _)p[S]=Vd(_[S]);return p}return qd(_)}class ep extends Error{constructor(p,S){super(S),this.message=S,this.key=p}}class _p{constructor(p,S=[]){this.parent=p,this.bindings={};for(const[j,ut]of S)this.bindings[j]=ut}concat(p){return new _p(this,p)}get(p){if(this.bindings[p])return this.bindings[p];if(this.parent)return this.parent.get(p);throw new Error(`${p} not found in scope.`)}has(p){return!!this.bindings[p]||!!this.parent&&this.parent.has(p)}}const lp={kind:"null"},Kh={kind:"number"},Qd={kind:"string"},fd={kind:"boolean"},Jd={kind:"color"},Yh={kind:"object"},$d={kind:"value"},Jf={kind:"collator"},Sf={kind:"formatted"},If={kind:"padding"},Xf={kind:"resolvedImage"};function Of(_,p){return{kind:"array",itemType:_,N:p}}function jf(_){if(_.kind==="array"){const p=jf(_.itemType);return typeof _.N=="number"?`array<${p}, ${_.N}>`:_.itemType.kind==="value"?"array":`array<${p}>`}return _.kind}const Ap=[lp,Kh,Qd,fd,Jd,Sf,Yh,Of($d),If,Xf];function vp(_,p){if(p.kind==="error")return null;if(_.kind==="array"){if(p.kind==="array"&&(p.N===0&&p.itemType.kind==="value"||!vp(_.itemType,p.itemType))&&(typeof _.N!="number"||_.N===p.N))return null}else{if(_.kind===p.kind)return null;if(_.kind==="value"){for(const S of Ap)if(!vp(S,p))return null}}return`Expected ${jf(_)} but found ${jf(p)} instead.`}function Tp(_,p){return p.some(S=>S.kind===_.kind)}function Zf(_,p){return p.some(S=>S==="null"?_===null:S==="array"?Array.isArray(_):S==="object"?_&&!Array.isArray(_)&&typeof _=="object":S===typeof _)}var qp,sm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Wd(_){return(_=Math.round(_))<0?0:_>255?255:_}function $p(_){return Wd(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function Lh(_){return(p=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:p>1?1:p;var p}function lh(_,p,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?_+(p-_)*S*6:2*S<1?p:3*S<2?_+(p-_)*(2/3-S)*6:_}try{qp={}.parseCSSColor=function(_){var p,S=_.replace(/ /g,"").toLowerCase();if(S in sm)return sm[S].slice();if(S[0]==="#")return S.length===4?(p=parseInt(S.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:S.length===7&&(p=parseInt(S.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var j=S.indexOf("("),ut=S.indexOf(")");if(j!==-1&&ut+1===S.length){var Ot=S.substr(0,j),fi=S.substr(j+1,ut-(j+1)).split(","),kn=1;switch(Ot){case"rgba":if(fi.length!==4)return null;kn=Lh(fi.pop());case"rgb":return fi.length!==3?null:[$p(fi[0]),$p(fi[1]),$p(fi[2]),kn];case"hsla":if(fi.length!==4)return null;kn=Lh(fi.pop());case"hsl":if(fi.length!==3)return null;var ss=(parseFloat(fi[0])%360+360)%360/360,ul=Lh(fi[1]),Ju=Lh(fi[2]),nh=Ju<=.5?Ju*(ul+1):Ju+ul-Ju*ul,mh=2*Ju-nh;return[Wd(255*lh(mh,nh,ss+1/3)),Wd(255*lh(mh,nh,ss)),Wd(255*lh(mh,nh,ss-1/3)),kn];default:return null}}return null}}catch{}class ih{constructor(p,S,j,ut=1){this.r=p,this.g=S,this.b=j,this.a=ut}static parse(p){if(!p)return;if(p instanceof ih)return p;if(typeof p!="string")return;const S=qp(p);return S?new ih(S[0]/255*S[3],S[1]/255*S[3],S[2]/255*S[3],S[3]):void 0}toString(){const[p,S,j,ut]=this.toArray();return`rgba(${Math.round(p)},${Math.round(S)},${Math.round(j)},${ut})`}toArray(){const{r:p,g:S,b:j,a:ut}=this;return ut===0?[0,0,0,0]:[255*p/ut,255*S/ut,255*j/ut,ut]}}ih.black=new ih(0,0,0,1),ih.white=new ih(1,1,1,1),ih.transparent=new ih(0,0,0,0),ih.red=new ih(1,0,0,1);class Ah{constructor(p,S,j){this.sensitivity=p?S?"variant":"case":S?"accent":"base",this.locale=j,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(p,S){return this.collator.compare(p,S)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zh{constructor(p,S,j,ut,Ot){this.text=p,this.image=S,this.scale=j,this.fontStack=ut,this.textColor=Ot}}class Qh{constructor(p){this.sections=p}static fromString(p){return new Qh([new zh(p,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(p=>p.text.length!==0||p.image&&p.image.name.length!==0)}static factory(p){return p instanceof Qh?p:Qh.fromString(p)}toString(){return this.sections.length===0?"":this.sections.map(p=>p.text).join("")}}class Th{constructor(p){this.values=p.slice()}static parse(p){if(p instanceof Th)return p;if(typeof p=="number")return new Th([p,p,p,p]);if(Array.isArray(p)&&!(p.length<1||p.length>4)){for(const S of p)if(typeof S!="number")return;switch(p.length){case 1:p=[p[0],p[0],p[0],p[0]];break;case 2:p=[p[0],p[1],p[0],p[1]];break;case 3:p=[p[0],p[1],p[2],p[1]]}return new Th(p)}}toString(){return JSON.stringify(this.values)}}class Fh{constructor(p){this.name=p.name,this.available=p.available}toString(){return this.name}static fromString(p){return p?new Fh({name:p,available:!1}):null}}function al(_,p,S,j){return typeof _=="number"&&_>=0&&_<=255&&typeof p=="number"&&p>=0&&p<=255&&typeof S=="number"&&S>=0&&S<=255?j===void 0||typeof j=="number"&&j>=0&&j<=1?null:`Invalid rgba value [${[_,p,S,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof j=="number"?[_,p,S,j]:[_,p,S]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fh(_){if(_===null||typeof _=="string"||typeof _=="boolean"||typeof _=="number"||_ instanceof ih||_ instanceof Ah||_ instanceof Qh||_ instanceof Th||_ instanceof Fh)return!0;if(Array.isArray(_)){for(const p of _)if(!fh(p))return!1;return!0}if(typeof _=="object"){for(const p in _)if(!fh(_[p]))return!1;return!0}return!1}function nl(_){if(_===null)return lp;if(typeof _=="string")return Qd;if(typeof _=="boolean")return fd;if(typeof _=="number")return Kh;if(_ instanceof ih)return Jd;if(_ instanceof Ah)return Jf;if(_ instanceof Qh)return Sf;if(_ instanceof Th)return If;if(_ instanceof Fh)return Xf;if(Array.isArray(_)){const p=_.length;let S;for(const j of _){const ut=nl(j);if(S){if(S===ut)continue;S=$d;break}S=ut}return Of(S||$d,p)}return Yh}function Zs(_){const p=typeof _;return _===null?"":p==="string"||p==="number"||p==="boolean"?String(_):_ instanceof ih||_ instanceof Qh||_ instanceof Th||_ instanceof Fh?_.toString():JSON.stringify(_)}class ol{constructor(p,S){this.type=p,this.value=S}static parse(p,S){if(p.length!==2)return S.error(`'literal' expression requires exactly one argument, but found ${p.length-1} instead.`);if(!fh(p[1]))return S.error("invalid value");const j=p[1];let ut=nl(j);const Ot=S.expectedType;return ut.kind!=="array"||ut.N!==0||!Ot||Ot.kind!=="array"||typeof Ot.N=="number"&&Ot.N!==0||(ut=Ot),new ol(ut,j)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class sh{constructor(p){this.name="ExpressionEvaluationError",this.message=p}toJSON(){return this.message}}const xh={string:Qd,number:Kh,boolean:fd,object:Yh};class Mh{constructor(p,S){this.type=p,this.args=S}static parse(p,S){if(p.length<2)return S.error("Expected at least one argument.");let j,ut=1;const Ot=p[0];if(Ot==="array"){let kn,ss;if(p.length>2){const ul=p[1];if(typeof ul!="string"||!(ul in xh)||ul==="object")return S.error('The item type argument of "array" must be one of string, number, boolean',1);kn=xh[ul],ut++}else kn=$d;if(p.length>3){if(p[2]!==null&&(typeof p[2]!="number"||p[2]<0||p[2]!==Math.floor(p[2])))return S.error('The length argument to "array" must be a positive integer literal',2);ss=p[2],ut++}j=Of(kn,ss)}else{if(!xh[Ot])throw new Error(`Types doesn't contain name = ${Ot}`);j=xh[Ot]}const fi=[];for(;ut<p.length;ut++){const kn=S.parse(p[ut],ut,$d);if(!kn)return null;fi.push(kn)}return new Mh(j,fi)}evaluate(p){for(let S=0;S<this.args.length;S++){const j=this.args[S].evaluate(p);if(!vp(this.type,nl(j)))return j;if(S===this.args.length-1)throw new sh(`Expected value to be of type ${jf(this.type)}, but found ${jf(nl(j))} instead.`)}throw new Error}eachChild(p){this.args.forEach(p)}outputDefined(){return this.args.every(p=>p.outputDefined())}}const Uh={"to-boolean":fd,"to-color":Jd,"to-number":Kh,"to-string":Qd};class Nh{constructor(p,S){this.type=p,this.args=S}static parse(p,S){if(p.length<2)return S.error("Expected at least one argument.");const j=p[0];if(!Uh[j])throw new Error(`Can't parse ${j} as it is not part of the known types`);if((j==="to-boolean"||j==="to-string")&&p.length!==2)return S.error("Expected one argument.");const ut=Uh[j],Ot=[];for(let fi=1;fi<p.length;fi++){const kn=S.parse(p[fi],fi,$d);if(!kn)return null;Ot.push(kn)}return new Nh(ut,Ot)}evaluate(p){if(this.type.kind==="boolean")return!!this.args[0].evaluate(p);if(this.type.kind==="color"){let S,j;for(const ut of this.args){if(S=ut.evaluate(p),j=null,S instanceof ih)return S;if(typeof S=="string"){const Ot=p.parseColor(S);if(Ot)return Ot}else if(Array.isArray(S)&&(j=S.length<3||S.length>4?`Invalid rbga value ${JSON.stringify(S)}: expected an array containing either three or four numeric values.`:al(S[0],S[1],S[2],S[3]),!j))return new ih(S[0]/255,S[1]/255,S[2]/255,S[3])}throw new sh(j||`Could not parse color from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="padding"){let S;for(const j of this.args){S=j.evaluate(p);const ut=Th.parse(S);if(ut)return ut}throw new sh(`Could not parse padding from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="number"){let S=null;for(const j of this.args){if(S=j.evaluate(p),S===null)return 0;const ut=Number(S);if(!isNaN(ut))return ut}throw new sh(`Could not convert ${JSON.stringify(S)} to number.`)}return this.type.kind==="formatted"?Qh.fromString(Zs(this.args[0].evaluate(p))):this.type.kind==="resolvedImage"?Fh.fromString(Zs(this.args[0].evaluate(p))):Zs(this.args[0].evaluate(p))}eachChild(p){this.args.forEach(p)}outputDefined(){return this.args.every(p=>p.outputDefined())}}const Zh=["Unknown","Point","LineString","Polygon"];class td{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(p){let S=this._parseColorCache[p];return S||(S=this._parseColorCache[p]=ih.parse(p)),S}}class Ad{constructor(p,S,j,ut){this.name=p,this.type=S,this._evaluate=j,this.args=ut}evaluate(p){return this._evaluate(p,this.args)}eachChild(p){this.args.forEach(p)}outputDefined(){return!1}static parse(p,S){const j=p[0],ut=Ad.definitions[j];if(!ut)return S.error(`Unknown expression "${j}". If you wanted a literal array, use ["literal", [...]].`,0);const Ot=Array.isArray(ut)?ut[0]:ut.type,fi=Array.isArray(ut)?[[ut[1],ut[2]]]:ut.overloads,kn=fi.filter(([ul])=>!Array.isArray(ul)||ul.length===p.length-1);let ss=null;for(const[ul,Ju]of kn){ss=new wy(S.registry,S.path,null,S.scope);const nh=[];let mh=!1;for(let _h=1;_h<p.length;_h++){const wh=p[_h],Jh=Array.isArray(ul)?ul[_h-1]:ul.type,Hh=ss.parse(wh,1+nh.length,Jh);if(!Hh){mh=!0;break}nh.push(Hh)}if(!mh)if(Array.isArray(ul)&&ul.length!==nh.length)ss.error(`Expected ${ul.length} arguments, but found ${nh.length} instead.`);else{for(let _h=0;_h<nh.length;_h++){const wh=Array.isArray(ul)?ul[_h]:ul.type,Jh=nh[_h];ss.concat(_h+1).checkSubtype(wh,Jh.type)}if(ss.errors.length===0)return new Ad(j,Ot,Ju,nh)}}if(kn.length===1)S.errors.push(...ss.errors);else{const ul=(kn.length?kn:fi).map(([nh])=>{return mh=nh,Array.isArray(mh)?`(${mh.map(jf).join(", ")})`:`(${jf(mh.type)}...)`;var mh}).join(" | "),Ju=[];for(let nh=1;nh<p.length;nh++){const mh=S.parse(p[nh],1+Ju.length);if(!mh)return null;Ju.push(jf(mh.type))}S.error(`Expected arguments of type ${ul}, but found (${Ju.join(", ")}) instead.`)}return null}static register(p,S){Ad.definitions=S;for(const j in S)p[j]=Ad}}class Zd{constructor(p,S,j){this.type=Jf,this.locale=j,this.caseSensitive=p,this.diacriticSensitive=S}static parse(p,S){if(p.length!==2)return S.error("Expected one argument.");const j=p[1];if(typeof j!="object"||Array.isArray(j))return S.error("Collator options argument must be an object.");const ut=S.parse(j["case-sensitive"]!==void 0&&j["case-sensitive"],1,fd);if(!ut)return null;const Ot=S.parse(j["diacritic-sensitive"]!==void 0&&j["diacritic-sensitive"],1,fd);if(!Ot)return null;let fi=null;return j.locale&&(fi=S.parse(j.locale,1,Qd),!fi)?null:new Zd(ut,Ot,fi)}evaluate(p){return new Ah(this.caseSensitive.evaluate(p),this.diacriticSensitive.evaluate(p),this.locale?this.locale.evaluate(p):null)}eachChild(p){p(this.caseSensitive),p(this.diacriticSensitive),this.locale&&p(this.locale)}outputDefined(){return!1}}const Fd=8192;function Kf(_,p){_[0]=Math.min(_[0],p[0]),_[1]=Math.min(_[1],p[1]),_[2]=Math.max(_[2],p[0]),_[3]=Math.max(_[3],p[1])}function up(_,p){return!(_[0]<=p[0]||_[2]>=p[2]||_[1]<=p[1]||_[3]>=p[3])}function ap(_,p){const S=(180+_[0])/360,j=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_[1]*Math.PI/360)))/360,ut=Math.pow(2,p.z);return[Math.round(S*ut*Fd),Math.round(j*ut*Fd)]}function wp(_,p,S){const j=_[0]-p[0],ut=_[1]-p[1],Ot=_[0]-S[0],fi=_[1]-S[1];return j*fi-Ot*ut==0&&j*Ot<=0&&ut*fi<=0}function Hp(_,p){let S=!1;for(let fi=0,kn=p.length;fi<kn;fi++){const ss=p[fi];for(let ul=0,Ju=ss.length;ul<Ju-1;ul++){if(wp(_,ss[ul],ss[ul+1]))return!1;(ut=ss[ul])[1]>(j=_)[1]!=(Ot=ss[ul+1])[1]>j[1]&&j[0]<(Ot[0]-ut[0])*(j[1]-ut[1])/(Ot[1]-ut[1])+ut[0]&&(S=!S)}}var j,ut,Ot;return S}function Ip(_,p){for(let S=0;S<p.length;S++)if(Hp(_,p[S]))return!0;return!1}function Gh(_,p,S,j){const ut=j[0]-S[0],Ot=j[1]-S[1],fi=(_[0]-S[0])*Ot-ut*(_[1]-S[1]),kn=(p[0]-S[0])*Ot-ut*(p[1]-S[1]);return fi>0&&kn<0||fi<0&&kn>0}function Nf(_,p,S){for(const ul of S)for(let Ju=0;Ju<ul.length-1;++Ju)if((kn=[(fi=ul[Ju+1])[0]-(Ot=ul[Ju])[0],fi[1]-Ot[1]])[0]*(ss=[(ut=p)[0]-(j=_)[0],ut[1]-j[1]])[1]-kn[1]*ss[0]!=0&&Gh(j,ut,Ot,fi)&&Gh(Ot,fi,j,ut))return!0;var j,ut,Ot,fi,kn,ss;return!1}function Hf(_,p){for(let S=0;S<_.length;++S)if(!Hp(_[S],p))return!1;for(let S=0;S<_.length-1;++S)if(Nf(_[S],_[S+1],p))return!1;return!0}function mp(_,p){for(let S=0;S<p.length;S++)if(Hf(_,p[S]))return!0;return!1}function Bp(_,p,S){const j=[];for(let ut=0;ut<_.length;ut++){const Ot=[];for(let fi=0;fi<_[ut].length;fi++){const kn=ap(_[ut][fi],S);Kf(p,kn),Ot.push(kn)}j.push(Ot)}return j}function zp(_,p,S){const j=[];for(let ut=0;ut<_.length;ut++){const Ot=Bp(_[ut],p,S);j.push(Ot)}return j}function um(_,p,S,j){if(_[0]<S[0]||_[0]>S[2]){const ut=.5*j;let Ot=_[0]-S[0]>ut?-j:S[0]-_[0]>ut?j:0;Ot===0&&(Ot=_[0]-S[2]>ut?-j:S[2]-_[0]>ut?j:0),_[0]+=Ot}Kf(p,_)}function Nm(_,p,S,j){const ut=Math.pow(2,j.z)*Fd,Ot=[j.x*Fd,j.y*Fd],fi=[];for(const kn of _)for(const ss of kn){const ul=[ss.x+Ot[0],ss.y+Ot[1]];um(ul,p,S,ut),fi.push(ul)}return fi}function a_(_,p,S,j){const ut=Math.pow(2,j.z)*Fd,Ot=[j.x*Fd,j.y*Fd],fi=[];for(const ss of _){const ul=[];for(const Ju of ss){const nh=[Ju.x+Ot[0],Ju.y+Ot[1]];Kf(p,nh),ul.push(nh)}fi.push(ul)}if(p[2]-p[0]<=ut/2){(kn=p)[0]=kn[1]=1/0,kn[2]=kn[3]=-1/0;for(const ss of fi)for(const ul of ss)um(ul,p,S,ut)}var kn;return fi}class Ug{constructor(p,S){this.type=fd,this.geojson=p,this.geometries=S}static parse(p,S){if(p.length!==2)return S.error(`'within' expression requires exactly one argument, but found ${p.length-1} instead.`);if(fh(p[1])){const j=p[1];if(j.type==="FeatureCollection")for(let ut=0;ut<j.features.length;++ut){const Ot=j.features[ut].geometry.type;if(Ot==="Polygon"||Ot==="MultiPolygon")return new Ug(j,j.features[ut].geometry)}else if(j.type==="Feature"){const ut=j.geometry.type;if(ut==="Polygon"||ut==="MultiPolygon")return new Ug(j,j.geometry)}else if(j.type==="Polygon"||j.type==="MultiPolygon")return new Ug(j,j)}return S.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(p){if(p.geometry()!=null&&p.canonicalID()!=null){if(p.geometryType()==="Point")return function(S,j){const ut=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],fi=S.canonicalID();if(j.type==="Polygon"){const kn=Bp(j.coordinates,Ot,fi),ss=Nm(S.geometry(),ut,Ot,fi);if(!up(ut,Ot))return!1;for(const ul of ss)if(!Hp(ul,kn))return!1}if(j.type==="MultiPolygon"){const kn=zp(j.coordinates,Ot,fi),ss=Nm(S.geometry(),ut,Ot,fi);if(!up(ut,Ot))return!1;for(const ul of ss)if(!Ip(ul,kn))return!1}return!0}(p,this.geometries);if(p.geometryType()==="LineString")return function(S,j){const ut=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],fi=S.canonicalID();if(j.type==="Polygon"){const kn=Bp(j.coordinates,Ot,fi),ss=a_(S.geometry(),ut,Ot,fi);if(!up(ut,Ot))return!1;for(const ul of ss)if(!Hf(ul,kn))return!1}if(j.type==="MultiPolygon"){const kn=zp(j.coordinates,Ot,fi),ss=a_(S.geometry(),ut,Ot,fi);if(!up(ut,Ot))return!1;for(const ul of ss)if(!mp(ul,kn))return!1}return!0}(p,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function by(_){if(_ instanceof Ad&&(_.name==="get"&&_.args.length===1||_.name==="feature-state"||_.name==="has"&&_.args.length===1||_.name==="properties"||_.name==="geometry-type"||_.name==="id"||/^filter-/.test(_.name))||_ instanceof Ug)return!1;let p=!0;return _.eachChild(S=>{p&&!by(S)&&(p=!1)}),p}function Yd(_){if(_ instanceof Ad&&_.name==="feature-state")return!1;let p=!0;return _.eachChild(S=>{p&&!Yd(S)&&(p=!1)}),p}function Mg(_,p){if(_ instanceof Ad&&p.indexOf(_.name)>=0)return!1;let S=!0;return _.eachChild(j=>{S&&!Mg(j,p)&&(S=!1)}),S}class km{constructor(p,S){this.type=S.type,this.name=p,this.boundExpression=S}static parse(p,S){if(p.length!==2||typeof p[1]!="string")return S.error("'var' expression requires exactly one string literal argument.");const j=p[1];return S.scope.has(j)?new km(j,S.scope.get(j)):S.error(`Unknown variable "${j}". Make sure "${j}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(p){return this.boundExpression.evaluate(p)}eachChild(){}outputDefined(){return!1}}class sg{constructor(p,S=[],j,ut=new _p,Ot=[]){this.registry=p,this.path=S,this.key=S.map(fi=>`[${fi}]`).join(""),this.scope=ut,this.errors=Ot,this.expectedType=j}parse(p,S,j,ut,Ot={}){return S?this.concat(S,j,ut)._parse(p,Ot):this._parse(p,Ot)}_parse(p,S){function j(ut,Ot,fi){return fi==="assert"?new Mh(Ot,[ut]):fi==="coerce"?new Nh(Ot,[ut]):ut}if(p!==null&&typeof p!="string"&&typeof p!="boolean"&&typeof p!="number"||(p=["literal",p]),Array.isArray(p)){if(p.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ut=p[0];if(typeof ut!="string")return this.error(`Expression name must be a string, but found ${typeof ut} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Ot=this.registry[ut];if(Ot){let fi=Ot.parse(p,this);if(!fi)return null;if(this.expectedType){const kn=this.expectedType,ss=fi.type;if(kn.kind!=="string"&&kn.kind!=="number"&&kn.kind!=="boolean"&&kn.kind!=="object"&&kn.kind!=="array"||ss.kind!=="value")if(kn.kind!=="color"&&kn.kind!=="formatted"&&kn.kind!=="resolvedImage"||ss.kind!=="value"&&ss.kind!=="string")if(kn.kind!=="padding"||ss.kind!=="value"&&ss.kind!=="number"&&ss.kind!=="array"){if(this.checkSubtype(kn,ss))return null}else fi=j(fi,kn,S.typeAnnotation||"coerce");else fi=j(fi,kn,S.typeAnnotation||"coerce");else fi=j(fi,kn,S.typeAnnotation||"assert")}if(!(fi instanceof ol)&&fi.type.kind!=="resolvedImage"&&p_(fi)){const kn=new td;try{fi=new ol(fi.type,fi.evaluate(kn))}catch(ss){return this.error(ss.message),null}}return fi}return this.error(`Unknown expression "${ut}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(p===void 0?"'undefined' value invalid. Use null instead.":typeof p=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof p} instead.`)}concat(p,S,j){const ut=typeof p=="number"?this.path.concat(p):this.path,Ot=j?this.scope.concat(j):this.scope;return new sg(this.registry,ut,S||null,Ot,this.errors)}error(p,...S){const j=`${this.key}${S.map(ut=>`[${ut}]`).join("")}`;this.errors.push(new ep(j,p))}checkSubtype(p,S){const j=vp(p,S);return j&&this.error(j),j}}var wy=sg;function p_(_){if(_ instanceof km)return p_(_.boundExpression);if(_ instanceof Ad&&_.name==="error"||_ instanceof Zd||_ instanceof Ug)return!1;const p=_ instanceof Nh||_ instanceof Mh;let S=!0;return _.eachChild(j=>{S=p?S&&p_(j):S&&j instanceof ol}),!!S&&by(_)&&Mg(_,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function a0(_,p){const S=_.length-1;let j,ut,Ot=0,fi=S,kn=0;for(;Ot<=fi;)if(kn=Math.floor((Ot+fi)/2),j=_[kn],ut=_[kn+1],j<=p){if(kn===S||p<ut)return kn;Ot=kn+1}else{if(!(j>p))throw new sh("Input is not a number.");fi=kn-1}return 0}class s0{constructor(p,S,j){this.type=p,this.input=S,this.labels=[],this.outputs=[];for(const[ut,Ot]of j)this.labels.push(ut),this.outputs.push(Ot)}static parse(p,S){if(p.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${p.length-1}.`);if((p.length-1)%2!=0)return S.error("Expected an even number of arguments.");const j=S.parse(p[1],1,Kh);if(!j)return null;const ut=[];let Ot=null;S.expectedType&&S.expectedType.kind!=="value"&&(Ot=S.expectedType);for(let fi=1;fi<p.length;fi+=2){const kn=fi===1?-1/0:p[fi],ss=p[fi+1],ul=fi,Ju=fi+1;if(typeof kn!="number")return S.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ul);if(ut.length&&ut[ut.length-1][0]>=kn)return S.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ul);const nh=S.parse(ss,Ju,Ot);if(!nh)return null;Ot=Ot||nh.type,ut.push([kn,nh])}return new s0(Ot,j,ut)}evaluate(p){const S=this.labels,j=this.outputs;if(S.length===1)return j[0].evaluate(p);const ut=this.input.evaluate(p);if(ut<=S[0])return j[0].evaluate(p);const Ot=S.length;return ut>=S[Ot-1]?j[Ot-1].evaluate(p):j[a0(S,ut)].evaluate(p)}eachChild(p){p(this.input);for(const S of this.outputs)p(S)}outputDefined(){return this.outputs.every(p=>p.outputDefined())}}function mm(_,p,S){return _*(1-S)+p*S}var yr=Object.freeze({__proto__:null,array:function(_,p,S){return _.map((j,ut)=>mm(j,p[ut],S))},color:function(_,p,S){return new ih(mm(_.r,p.r,S),mm(_.g,p.g,S),mm(_.b,p.b,S),mm(_.a,p.a,S))},number:mm,padding:function(_,p,S){const j=_.values,ut=p.values;return new Th([mm(j[0],ut[0],S),mm(j[1],ut[1],S),mm(j[2],ut[2],S),mm(j[3],ut[3],S)])}});const Js=.95047,uh=1.08883,Vh=4/29,od=6/29,Wh=3*od*od,pd=Math.PI/180,$f=180/Math.PI;function Tf(_){return _>.008856451679035631?Math.pow(_,1/3):_/Wh+Vh}function rp(_){return _>od?_*_*_:Wh*(_-Vh)}function Gf(_){return 255*(_<=.0031308?12.92*_:1.055*Math.pow(_,1/2.4)-.055)}function op(_){return(_/=255)<=.04045?_/12.92:Math.pow((_+.055)/1.055,2.4)}function Vp(_){const p=op(_.r),S=op(_.g),j=op(_.b),ut=Tf((.4124564*p+.3575761*S+.1804375*j)/Js),Ot=Tf((.2126729*p+.7151522*S+.072175*j)/1);return{l:116*Ot-16,a:500*(ut-Ot),b:200*(Ot-Tf((.0193339*p+.119192*S+.9503041*j)/uh)),alpha:_.a}}function Sm(_){let p=(_.l+16)/116,S=isNaN(_.a)?p:p+_.a/500,j=isNaN(_.b)?p:p-_.b/200;return p=1*rp(p),S=Js*rp(S),j=uh*rp(j),new ih(Gf(3.2404542*S-1.5371385*p-.4985314*j),Gf(-.969266*S+1.8760108*p+.041556*j),Gf(.0556434*S-.2040259*p+1.0572252*j),_.alpha)}function Xp(_,p,S){const j=p-_;return _+S*(j>180||j<-180?j-360*Math.round(j/360):j)}const Dm={forward:Vp,reverse:Sm,interpolate:function(_,p,S){return{l:mm(_.l,p.l,S),a:mm(_.a,p.a,S),b:mm(_.b,p.b,S),alpha:mm(_.alpha,p.alpha,S)}}},Mf={forward:function(_){const{l:p,a:S,b:j}=Vp(_),ut=Math.atan2(j,S)*$f;return{h:ut<0?ut+360:ut,c:Math.sqrt(S*S+j*j),l:p,alpha:_.a}},reverse:function(_){const p=_.h*pd,S=_.c;return Sm({l:_.l,a:Math.cos(p)*S,b:Math.sin(p)*S,alpha:_.alpha})},interpolate:function(_,p,S){return{h:Xp(_.h,p.h,S),c:mm(_.c,p.c,S),l:mm(_.l,p.l,S),alpha:mm(_.alpha,p.alpha,S)}}};var Cp=Object.freeze({__proto__:null,hcl:Mf,lab:Dm});class Kp{constructor(p,S,j,ut,Ot){this.type=p,this.operator=S,this.interpolation=j,this.input=ut,this.labels=[],this.outputs=[];for(const[fi,kn]of Ot)this.labels.push(fi),this.outputs.push(kn)}static interpolationFactor(p,S,j,ut){let Ot=0;if(p.name==="exponential")Ot=Ym(S,p.base,j,ut);else if(p.name==="linear")Ot=Ym(S,1,j,ut);else if(p.name==="cubic-bezier"){const fi=p.controlPoints;Ot=new x(fi[0],fi[1],fi[2],fi[3]).solve(Ym(S,1,j,ut))}return Ot}static parse(p,S){let[j,ut,Ot,...fi]=p;if(!Array.isArray(ut)||ut.length===0)return S.error("Expected an interpolation type expression.",1);if(ut[0]==="linear")ut={name:"linear"};else if(ut[0]==="exponential"){const ul=ut[1];if(typeof ul!="number")return S.error("Exponential interpolation requires a numeric base.",1,1);ut={name:"exponential",base:ul}}else{if(ut[0]!=="cubic-bezier")return S.error(`Unknown interpolation type ${String(ut[0])}`,1,0);{const ul=ut.slice(1);if(ul.length!==4||ul.some(Ju=>typeof Ju!="number"||Ju<0||Ju>1))return S.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ut={name:"cubic-bezier",controlPoints:ul}}}if(p.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${p.length-1}.`);if((p.length-1)%2!=0)return S.error("Expected an even number of arguments.");if(Ot=S.parse(Ot,2,Kh),!Ot)return null;const kn=[];let ss=null;j==="interpolate-hcl"||j==="interpolate-lab"?ss=Jd:S.expectedType&&S.expectedType.kind!=="value"&&(ss=S.expectedType);for(let ul=0;ul<fi.length;ul+=2){const Ju=fi[ul],nh=fi[ul+1],mh=ul+3,_h=ul+4;if(typeof Ju!="number")return S.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',mh);if(kn.length&&kn[kn.length-1][0]>=Ju)return S.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',mh);const wh=S.parse(nh,_h,ss);if(!wh)return null;ss=ss||wh.type,kn.push([Ju,wh])}return ss.kind==="number"||ss.kind==="color"||ss.kind==="padding"||ss.kind==="array"&&ss.itemType.kind==="number"&&typeof ss.N=="number"?new Kp(ss,j,ut,Ot,kn):S.error(`Type ${jf(ss)} is not interpolatable.`)}evaluate(p){const S=this.labels,j=this.outputs;if(S.length===1)return j[0].evaluate(p);const ut=this.input.evaluate(p);if(ut<=S[0])return j[0].evaluate(p);const Ot=S.length;if(ut>=S[Ot-1])return j[Ot-1].evaluate(p);const fi=a0(S,ut),kn=Kp.interpolationFactor(this.interpolation,ut,S[fi],S[fi+1]),ss=j[fi].evaluate(p),ul=j[fi+1].evaluate(p);return this.operator==="interpolate"?yr[this.type.kind.toLowerCase()](ss,ul,kn):this.operator==="interpolate-hcl"?Mf.reverse(Mf.interpolate(Mf.forward(ss),Mf.forward(ul),kn)):Dm.reverse(Dm.interpolate(Dm.forward(ss),Dm.forward(ul),kn))}eachChild(p){p(this.input);for(const S of this.outputs)p(S)}outputDefined(){return this.outputs.every(p=>p.outputDefined())}}function Ym(_,p,S,j){const ut=j-S,Ot=_-S;return ut===0?0:p===1?Ot/ut:(Math.pow(p,Ot)-1)/(Math.pow(p,ut)-1)}class Mm{constructor(p,S){this.type=p,this.args=S}static parse(p,S){if(p.length<2)return S.error("Expectected at least one argument.");let j=null;const ut=S.expectedType;ut&&ut.kind!=="value"&&(j=ut);const Ot=[];for(const kn of p.slice(1)){const ss=S.parse(kn,1+Ot.length,j,void 0,{typeAnnotation:"omit"});if(!ss)return null;j=j||ss.type,Ot.push(ss)}if(!j)throw new Error("No output type");const fi=ut&&Ot.some(kn=>vp(ut,kn.type));return new Mm(fi?$d:j,Ot)}evaluate(p){let S,j=null,ut=0;for(const Ot of this.args)if(ut++,j=Ot.evaluate(p),j&&j instanceof Fh&&!j.available&&(S||(S=j.name),j=null,ut===this.args.length&&(j=S)),j!==null)break;return j}eachChild(p){this.args.forEach(p)}outputDefined(){return this.args.every(p=>p.outputDefined())}}class lg{constructor(p,S){this.type=S.type,this.bindings=[].concat(p),this.result=S}evaluate(p){return this.result.evaluate(p)}eachChild(p){for(const S of this.bindings)p(S[1]);p(this.result)}static parse(p,S){if(p.length<4)return S.error(`Expected at least 3 arguments, but found ${p.length-1} instead.`);const j=[];for(let Ot=1;Ot<p.length-1;Ot+=2){const fi=p[Ot];if(typeof fi!="string")return S.error(`Expected string, but found ${typeof fi} instead.`,Ot);if(/[^a-zA-Z0-9_]/.test(fi))return S.error("Variable names must contain only alphanumeric characters or '_'.",Ot);const kn=S.parse(p[Ot+1],Ot+1);if(!kn)return null;j.push([fi,kn])}const ut=S.parse(p[p.length-1],p.length-1,S.expectedType,j);return ut?new lg(j,ut):null}outputDefined(){return this.result.outputDefined()}}class jm{constructor(p,S,j){this.type=p,this.index=S,this.input=j}static parse(p,S){if(p.length!==3)return S.error(`Expected 2 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,Kh),ut=S.parse(p[2],2,Of(S.expectedType||$d));return j&&ut?new jm(ut.type.itemType,j,ut):null}evaluate(p){const S=this.index.evaluate(p),j=this.input.evaluate(p);if(S<0)throw new sh(`Array index out of bounds: ${S} < 0.`);if(S>=j.length)throw new sh(`Array index out of bounds: ${S} > ${j.length-1}.`);if(S!==Math.floor(S))throw new sh(`Array index must be an integer, but found ${S} instead.`);return j[S]}eachChild(p){p(this.index),p(this.input)}outputDefined(){return!1}}class Tm{constructor(p,S){this.type=fd,this.needle=p,this.haystack=S}static parse(p,S){if(p.length!==3)return S.error(`Expected 2 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,$d),ut=S.parse(p[2],2,$d);return j&&ut?Tp(j.type,[fd,Qd,Kh,lp,$d])?new Tm(j,ut):S.error(`Expected first argument to be of type boolean, string, number or null, but found ${jf(j.type)} instead`):null}evaluate(p){const S=this.needle.evaluate(p),j=this.haystack.evaluate(p);if(!j)return!1;if(!Zf(S,["boolean","string","number","null"]))throw new sh(`Expected first argument to be of type boolean, string, number or null, but found ${jf(nl(S))} instead.`);if(!Zf(j,["string","array"]))throw new sh(`Expected second argument to be of type array or string, but found ${jf(nl(j))} instead.`);return j.indexOf(S)>=0}eachChild(p){p(this.needle),p(this.haystack)}outputDefined(){return!0}}class Uy{constructor(p,S,j){this.type=Kh,this.needle=p,this.haystack=S,this.fromIndex=j}static parse(p,S){if(p.length<=2||p.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,$d),ut=S.parse(p[2],2,$d);if(!j||!ut)return null;if(!Tp(j.type,[fd,Qd,Kh,lp,$d]))return S.error(`Expected first argument to be of type boolean, string, number or null, but found ${jf(j.type)} instead`);if(p.length===4){const Ot=S.parse(p[3],3,Kh);return Ot?new Uy(j,ut,Ot):null}return new Uy(j,ut)}evaluate(p){const S=this.needle.evaluate(p),j=this.haystack.evaluate(p);if(!Zf(S,["boolean","string","number","null"]))throw new sh(`Expected first argument to be of type boolean, string, number or null, but found ${jf(nl(S))} instead.`);if(!Zf(j,["string","array"]))throw new sh(`Expected second argument to be of type array or string, but found ${jf(nl(j))} instead.`);if(this.fromIndex){const ut=this.fromIndex.evaluate(p);return j.indexOf(S,ut)}return j.indexOf(S)}eachChild(p){p(this.needle),p(this.haystack),this.fromIndex&&p(this.fromIndex)}outputDefined(){return!1}}class vg{constructor(p,S,j,ut,Ot,fi){this.inputType=p,this.type=S,this.input=j,this.cases=ut,this.outputs=Ot,this.otherwise=fi}static parse(p,S){if(p.length<5)return S.error(`Expected at least 4 arguments, but found only ${p.length-1}.`);if(p.length%2!=1)return S.error("Expected an even number of arguments.");let j,ut;S.expectedType&&S.expectedType.kind!=="value"&&(ut=S.expectedType);const Ot={},fi=[];for(let ul=2;ul<p.length-1;ul+=2){let Ju=p[ul];const nh=p[ul+1];Array.isArray(Ju)||(Ju=[Ju]);const mh=S.concat(ul);if(Ju.length===0)return mh.error("Expected at least one branch label.");for(const wh of Ju){if(typeof wh!="number"&&typeof wh!="string")return mh.error("Branch labels must be numbers or strings.");if(typeof wh=="number"&&Math.abs(wh)>Number.MAX_SAFE_INTEGER)return mh.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof wh=="number"&&Math.floor(wh)!==wh)return mh.error("Numeric branch labels must be integer values.");if(j){if(mh.checkSubtype(j,nl(wh)))return null}else j=nl(wh);if(Ot[String(wh)]!==void 0)return mh.error("Branch labels must be unique.");Ot[String(wh)]=fi.length}const _h=S.parse(nh,ul,ut);if(!_h)return null;ut=ut||_h.type,fi.push(_h)}const kn=S.parse(p[1],1,$d);if(!kn)return null;const ss=S.parse(p[p.length-1],p.length-1,ut);return ss?kn.type.kind!=="value"&&S.concat(1).checkSubtype(j,kn.type)?null:new vg(j,ut,kn,Ot,fi,ss):null}evaluate(p){const S=this.input.evaluate(p);return(nl(S)===this.inputType&&this.outputs[this.cases[S]]||this.otherwise).evaluate(p)}eachChild(p){p(this.input),this.outputs.forEach(p),p(this.otherwise)}outputDefined(){return this.outputs.every(p=>p.outputDefined())&&this.otherwise.outputDefined()}}class ng{constructor(p,S,j){this.type=p,this.branches=S,this.otherwise=j}static parse(p,S){if(p.length<4)return S.error(`Expected at least 3 arguments, but found only ${p.length-1}.`);if(p.length%2!=0)return S.error("Expected an odd number of arguments.");let j;S.expectedType&&S.expectedType.kind!=="value"&&(j=S.expectedType);const ut=[];for(let fi=1;fi<p.length-1;fi+=2){const kn=S.parse(p[fi],fi,fd);if(!kn)return null;const ss=S.parse(p[fi+1],fi+1,j);if(!ss)return null;ut.push([kn,ss]),j=j||ss.type}const Ot=S.parse(p[p.length-1],p.length-1,j);if(!Ot)return null;if(!j)throw new Error("Can't infer output type");return new ng(j,ut,Ot)}evaluate(p){for(const[S,j]of this.branches)if(S.evaluate(p))return j.evaluate(p);return this.otherwise.evaluate(p)}eachChild(p){for(const[S,j]of this.branches)p(S),p(j);p(this.otherwise)}outputDefined(){return this.branches.every(([p,S])=>S.outputDefined())&&this.otherwise.outputDefined()}}class l0{constructor(p,S,j,ut){this.type=p,this.input=S,this.beginIndex=j,this.endIndex=ut}static parse(p,S){if(p.length<=2||p.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${p.length-1} instead.`);const j=S.parse(p[1],1,$d),ut=S.parse(p[2],2,Kh);if(!j||!ut)return null;if(!Tp(j.type,[Of($d),Qd,$d]))return S.error(`Expected first argument to be of type array or string, but found ${jf(j.type)} instead`);if(p.length===4){const Ot=S.parse(p[3],3,Kh);return Ot?new l0(j.type,j,ut,Ot):null}return new l0(j.type,j,ut)}evaluate(p){const S=this.input.evaluate(p),j=this.beginIndex.evaluate(p);if(!Zf(S,["string","array"]))throw new sh(`Expected first argument to be of type array or string, but found ${jf(nl(S))} instead.`);if(this.endIndex){const ut=this.endIndex.evaluate(p);return S.slice(j,ut)}return S.slice(j)}eachChild(p){p(this.input),p(this.beginIndex),this.endIndex&&p(this.endIndex)}outputDefined(){return!1}}function Vy(_,p){return _==="=="||_==="!="?p.kind==="boolean"||p.kind==="string"||p.kind==="number"||p.kind==="null"||p.kind==="value":p.kind==="string"||p.kind==="number"||p.kind==="value"}function zm(_,p,S,j){return j.compare(p,S)===0}function s_(_,p,S){const j=_!=="=="&&_!=="!=";return class hS{constructor(Ot,fi,kn){this.type=fd,this.lhs=Ot,this.rhs=fi,this.collator=kn,this.hasUntypedArgument=Ot.type.kind==="value"||fi.type.kind==="value"}static parse(Ot,fi){if(Ot.length!==3&&Ot.length!==4)return fi.error("Expected two or three arguments.");const kn=Ot[0];let ss=fi.parse(Ot[1],1,$d);if(!ss)return null;if(!Vy(kn,ss.type))return fi.concat(1).error(`"${kn}" comparisons are not supported for type '${jf(ss.type)}'.`);let ul=fi.parse(Ot[2],2,$d);if(!ul)return null;if(!Vy(kn,ul.type))return fi.concat(2).error(`"${kn}" comparisons are not supported for type '${jf(ul.type)}'.`);if(ss.type.kind!==ul.type.kind&&ss.type.kind!=="value"&&ul.type.kind!=="value")return fi.error(`Cannot compare types '${jf(ss.type)}' and '${jf(ul.type)}'.`);j&&(ss.type.kind==="value"&&ul.type.kind!=="value"?ss=new Mh(ul.type,[ss]):ss.type.kind!=="value"&&ul.type.kind==="value"&&(ul=new Mh(ss.type,[ul])));let Ju=null;if(Ot.length===4){if(ss.type.kind!=="string"&&ul.type.kind!=="string"&&ss.type.kind!=="value"&&ul.type.kind!=="value")return fi.error("Cannot use collator to compare non-string types.");if(Ju=fi.parse(Ot[3],3,Jf),!Ju)return null}return new hS(ss,ul,Ju)}evaluate(Ot){const fi=this.lhs.evaluate(Ot),kn=this.rhs.evaluate(Ot);if(j&&this.hasUntypedArgument){const ss=nl(fi),ul=nl(kn);if(ss.kind!==ul.kind||ss.kind!=="string"&&ss.kind!=="number")throw new sh(`Expected arguments for "${_}" to be (string, string) or (number, number), but found (${ss.kind}, ${ul.kind}) instead.`)}if(this.collator&&!j&&this.hasUntypedArgument){const ss=nl(fi),ul=nl(kn);if(ss.kind!=="string"||ul.kind!=="string")return p(Ot,fi,kn)}return this.collator?S(Ot,fi,kn,this.collator.evaluate(Ot)):p(Ot,fi,kn)}eachChild(Ot){Ot(this.lhs),Ot(this.rhs),this.collator&&Ot(this.collator)}outputDefined(){return!0}}}const j0=s_("==",function(_,p,S){return p===S},zm),Ey=s_("!=",function(_,p,S){return p!==S},function(_,p,S,j){return!zm(0,p,S,j)}),xg=s_("<",function(_,p,S){return p<S},function(_,p,S,j){return j.compare(p,S)<0}),q0=s_(">",function(_,p,S){return p>S},function(_,p,S,j){return j.compare(p,S)>0}),fv=s_("<=",function(_,p,S){return p<=S},function(_,p,S,j){return j.compare(p,S)<=0}),G_=s_(">=",function(_,p,S){return p>=S},function(_,p,S,j){return j.compare(p,S)>=0});class P_{constructor(p,S,j,ut,Ot){this.type=Qd,this.number=p,this.locale=S,this.currency=j,this.minFractionDigits=ut,this.maxFractionDigits=Ot}static parse(p,S){if(p.length!==3)return S.error("Expected two arguments.");const j=S.parse(p[1],1,Kh);if(!j)return null;const ut=p[2];if(typeof ut!="object"||Array.isArray(ut))return S.error("NumberFormat options argument must be an object.");let Ot=null;if(ut.locale&&(Ot=S.parse(ut.locale,1,Qd),!Ot))return null;let fi=null;if(ut.currency&&(fi=S.parse(ut.currency,1,Qd),!fi))return null;let kn=null;if(ut["min-fraction-digits"]&&(kn=S.parse(ut["min-fraction-digits"],1,Kh),!kn))return null;let ss=null;return ut["max-fraction-digits"]&&(ss=S.parse(ut["max-fraction-digits"],1,Kh),!ss)?null:new P_(j,Ot,fi,kn,ss)}evaluate(p){return new Intl.NumberFormat(this.locale?this.locale.evaluate(p):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(p):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(p):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(p):void 0}).format(this.number.evaluate(p))}eachChild(p){p(this.number),this.locale&&p(this.locale),this.currency&&p(this.currency),this.minFractionDigits&&p(this.minFractionDigits),this.maxFractionDigits&&p(this.maxFractionDigits)}outputDefined(){return!1}}class Sy{constructor(p){this.type=Sf,this.sections=p}static parse(p,S){if(p.length<2)return S.error("Expected at least one argument.");const j=p[1];if(!Array.isArray(j)&&typeof j=="object")return S.error("First argument must be an image or text section.");const ut=[];let Ot=!1;for(let fi=1;fi<=p.length-1;++fi){const kn=p[fi];if(Ot&&typeof kn=="object"&&!Array.isArray(kn)){Ot=!1;let ss=null;if(kn["font-scale"]&&(ss=S.parse(kn["font-scale"],1,Kh),!ss))return null;let ul=null;if(kn["text-font"]&&(ul=S.parse(kn["text-font"],1,Of(Qd)),!ul))return null;let Ju=null;if(kn["text-color"]&&(Ju=S.parse(kn["text-color"],1,Jd),!Ju))return null;const nh=ut[ut.length-1];nh.scale=ss,nh.font=ul,nh.textColor=Ju}else{const ss=S.parse(p[fi],1,$d);if(!ss)return null;const ul=ss.type.kind;if(ul!=="string"&&ul!=="value"&&ul!=="null"&&ul!=="resolvedImage")return S.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Ot=!0,ut.push({content:ss,scale:null,font:null,textColor:null})}}return new Sy(ut)}evaluate(p){return new Qh(this.sections.map(S=>{const j=S.content.evaluate(p);return nl(j)===Xf?new zh("",j,null,null,null):new zh(Zs(j),null,S.scale?S.scale.evaluate(p):null,S.font?S.font.evaluate(p).join(","):null,S.textColor?S.textColor.evaluate(p):null)}))}eachChild(p){for(const S of this.sections)p(S.content),S.scale&&p(S.scale),S.font&&p(S.font),S.textColor&&p(S.textColor)}outputDefined(){return!1}}class pv{constructor(p){this.type=Xf,this.input=p}static parse(p,S){if(p.length!==2)return S.error("Expected two arguments.");const j=S.parse(p[1],1,Qd);return j?new pv(j):S.error("No image name provided.")}evaluate(p){const S=this.input.evaluate(p),j=Fh.fromString(S);return j&&p.availableImages&&(j.available=p.availableImages.indexOf(S)>-1),j}eachChild(p){p(this.input)}outputDefined(){return!1}}class S0{constructor(p){this.type=Kh,this.input=p}static parse(p,S){if(p.length!==2)return S.error(`Expected 1 argument, but found ${p.length-1} instead.`);const j=S.parse(p[1],1);return j?j.type.kind!=="array"&&j.type.kind!=="string"&&j.type.kind!=="value"?S.error(`Expected argument of type string or array, but found ${jf(j.type)} instead.`):new S0(j):null}evaluate(p){const S=this.input.evaluate(p);if(typeof S=="string"||Array.isArray(S))return S.length;throw new sh(`Expected value to be of type string or array, but found ${jf(nl(S))} instead.`)}eachChild(p){p(this.input)}outputDefined(){return!1}}const Jg={"==":j0,"!=":Ey,">":q0,"<":xg,">=":G_,"<=":fv,array:Mh,at:jm,boolean:Mh,case:ng,coalesce:Mm,collator:Zd,format:Sy,image:pv,in:Tm,"index-of":Uy,interpolate:Kp,"interpolate-hcl":Kp,"interpolate-lab":Kp,length:S0,let:lg,literal:ol,match:vg,number:Mh,"number-format":P_,object:Mh,slice:l0,step:s0,string:Mh,"to-boolean":Nh,"to-color":Nh,"to-number":Nh,"to-string":Nh,var:km,within:Ug};function Wp(_,[p,S,j,ut]){p=p.evaluate(_),S=S.evaluate(_),j=j.evaluate(_);const Ot=ut?ut.evaluate(_):1,fi=al(p,S,j,Ot);if(fi)throw new sh(fi);return new ih(p/255*Ot,S/255*Ot,j/255*Ot,Ot)}function T0(_,p){return _ in p}function bg(_,p){const S=p[_];return S===void 0?null:S}function Rg(_){return{type:_}}function jy(_){return{result:"success",value:_}}function Qg(_){return{result:"error",value:_}}function j_(_){return _["property-type"]==="data-driven"||_["property-type"]==="cross-faded-data-driven"}function q_(_){return!!_.expression&&_.expression.parameters.indexOf("zoom")>-1}function Ty(_){return!!_.expression&&_.expression.interpolated}function gm(_){return _ instanceof Number?"number":_ instanceof String?"string":_ instanceof Boolean?"boolean":Array.isArray(_)?"array":_===null?"null":typeof _}function qy(_){return typeof _=="object"&&_!==null&&!Array.isArray(_)}function cy(_){return _}function I0(_,p){const S=p.type==="color",j=_.stops&&typeof _.stops[0][0]=="object",ut=j||!(j||_.property!==void 0),Ot=_.type||(Ty(p)?"exponential":"interval");if(S||p.type==="padding"){const ul=S?ih.parse:Th.parse;(_=Uf({},_)).stops&&(_.stops=_.stops.map(Ju=>[Ju[0],ul(Ju[1])])),_.default=ul(_.default?_.default:p.default)}if(_.colorSpace&&_.colorSpace!=="rgb"&&!Cp[_.colorSpace])throw new Error(`Unknown color space: ${_.colorSpace}`);let fi,kn,ss;if(Ot==="exponential")fi=Iy;else if(Ot==="interval")fi=mv;else if(Ot==="categorical"){fi=fm,kn=Object.create(null);for(const ul of _.stops)kn[ul[0]]=ul[1];ss=typeof _.stops[0][0]}else{if(Ot!=="identity")throw new Error(`Unknown function type "${Ot}"`);fi=Z0}if(j){const ul={},Ju=[];for(let _h=0;_h<_.stops.length;_h++){const wh=_.stops[_h],Jh=wh[0].zoom;ul[Jh]===void 0&&(ul[Jh]={zoom:Jh,type:_.type,property:_.property,default:_.default,stops:[]},Ju.push(Jh)),ul[Jh].stops.push([wh[0].value,wh[1]])}const nh=[];for(const _h of Ju)nh.push([ul[_h].zoom,I0(ul[_h],p)]);const mh={name:"linear"};return{kind:"composite",interpolationType:mh,interpolationFactor:Kp.interpolationFactor.bind(void 0,mh),zoomStops:nh.map(_h=>_h[0]),evaluate:({zoom:_h},wh)=>Iy({stops:nh,base:_.base},p,_h).evaluate(_h,wh)}}if(ut){const ul=Ot==="exponential"?{name:"exponential",base:_.base!==void 0?_.base:1}:null;return{kind:"camera",interpolationType:ul,interpolationFactor:Kp.interpolationFactor.bind(void 0,ul),zoomStops:_.stops.map(Ju=>Ju[0]),evaluate:({zoom:Ju})=>fi(_,p,Ju,kn,ss)}}return{kind:"source",evaluate(ul,Ju){const nh=Ju&&Ju.properties?Ju.properties[_.property]:void 0;return nh===void 0?Z_(_.default,p.default):fi(_,p,nh,kn,ss)}}}function Z_(_,p,S){return _!==void 0?_:p!==void 0?p:S!==void 0?S:void 0}function fm(_,p,S,j,ut){return Z_(typeof S===ut?j[S]:void 0,_.default,p.default)}function mv(_,p,S){if(gm(S)!=="number")return Z_(_.default,p.default);const j=_.stops.length;if(j===1||S<=_.stops[0][0])return _.stops[0][1];if(S>=_.stops[j-1][0])return _.stops[j-1][1];const ut=a0(_.stops.map(Ot=>Ot[0]),S);return _.stops[ut][1]}function Iy(_,p,S){const j=_.base!==void 0?_.base:1;if(gm(S)!=="number")return Z_(_.default,p.default);const ut=_.stops.length;if(ut===1||S<=_.stops[0][0])return _.stops[0][1];if(S>=_.stops[ut-1][0])return _.stops[ut-1][1];const Ot=a0(_.stops.map(Ju=>Ju[0]),S),fi=function(Ju,nh,mh,_h){const wh=_h-mh,Jh=Ju-mh;return wh===0?0:nh===1?Jh/wh:(Math.pow(nh,Jh)-1)/(Math.pow(nh,wh)-1)}(S,j,_.stops[Ot][0],_.stops[Ot+1][0]),kn=_.stops[Ot][1],ss=_.stops[Ot+1][1];let ul=yr[p.type]||cy;if(_.colorSpace&&_.colorSpace!=="rgb"){const Ju=Cp[_.colorSpace];ul=(nh,mh)=>Ju.reverse(Ju.interpolate(Ju.forward(nh),Ju.forward(mh),fi))}return typeof kn.evaluate=="function"?{evaluate(...Ju){const nh=kn.evaluate.apply(void 0,Ju),mh=ss.evaluate.apply(void 0,Ju);if(nh!==void 0&&mh!==void 0)return ul(nh,mh,fi)}}:ul(kn,ss,fi)}function Z0(_,p,S){switch(p.type){case"color":S=ih.parse(S);break;case"formatted":S=Qh.fromString(S.toString());break;case"resolvedImage":S=Fh.fromString(S.toString());break;case"padding":S=Th.parse(S);break;default:gm(S)===p.type||p.type==="enum"&&p.values[S]||(S=void 0)}return Z_(S,_.default,p.default)}Ad.register(Jg,{error:[{kind:"error"},[Qd],(_,[p])=>{throw new sh(p.evaluate(_))}],typeof:[Qd,[$d],(_,[p])=>jf(nl(p.evaluate(_)))],"to-rgba":[Of(Kh,4),[Jd],(_,[p])=>p.evaluate(_).toArray()],rgb:[Jd,[Kh,Kh,Kh],Wp],rgba:[Jd,[Kh,Kh,Kh,Kh],Wp],has:{type:fd,overloads:[[[Qd],(_,[p])=>T0(p.evaluate(_),_.properties())],[[Qd,Yh],(_,[p,S])=>T0(p.evaluate(_),S.evaluate(_))]]},get:{type:$d,overloads:[[[Qd],(_,[p])=>bg(p.evaluate(_),_.properties())],[[Qd,Yh],(_,[p,S])=>bg(p.evaluate(_),S.evaluate(_))]]},"feature-state":[$d,[Qd],(_,[p])=>bg(p.evaluate(_),_.featureState||{})],properties:[Yh,[],_=>_.properties()],"geometry-type":[Qd,[],_=>_.geometryType()],id:[$d,[],_=>_.id()],zoom:[Kh,[],_=>_.globals.zoom],"heatmap-density":[Kh,[],_=>_.globals.heatmapDensity||0],"line-progress":[Kh,[],_=>_.globals.lineProgress||0],accumulated:[$d,[],_=>_.globals.accumulated===void 0?null:_.globals.accumulated],"+":[Kh,Rg(Kh),(_,p)=>{let S=0;for(const j of p)S+=j.evaluate(_);return S}],"*":[Kh,Rg(Kh),(_,p)=>{let S=1;for(const j of p)S*=j.evaluate(_);return S}],"-":{type:Kh,overloads:[[[Kh,Kh],(_,[p,S])=>p.evaluate(_)-S.evaluate(_)],[[Kh],(_,[p])=>-p.evaluate(_)]]},"/":[Kh,[Kh,Kh],(_,[p,S])=>p.evaluate(_)/S.evaluate(_)],"%":[Kh,[Kh,Kh],(_,[p,S])=>p.evaluate(_)%S.evaluate(_)],ln2:[Kh,[],()=>Math.LN2],pi:[Kh,[],()=>Math.PI],e:[Kh,[],()=>Math.E],"^":[Kh,[Kh,Kh],(_,[p,S])=>Math.pow(p.evaluate(_),S.evaluate(_))],sqrt:[Kh,[Kh],(_,[p])=>Math.sqrt(p.evaluate(_))],log10:[Kh,[Kh],(_,[p])=>Math.log(p.evaluate(_))/Math.LN10],ln:[Kh,[Kh],(_,[p])=>Math.log(p.evaluate(_))],log2:[Kh,[Kh],(_,[p])=>Math.log(p.evaluate(_))/Math.LN2],sin:[Kh,[Kh],(_,[p])=>Math.sin(p.evaluate(_))],cos:[Kh,[Kh],(_,[p])=>Math.cos(p.evaluate(_))],tan:[Kh,[Kh],(_,[p])=>Math.tan(p.evaluate(_))],asin:[Kh,[Kh],(_,[p])=>Math.asin(p.evaluate(_))],acos:[Kh,[Kh],(_,[p])=>Math.acos(p.evaluate(_))],atan:[Kh,[Kh],(_,[p])=>Math.atan(p.evaluate(_))],min:[Kh,Rg(Kh),(_,p)=>Math.min(...p.map(S=>S.evaluate(_)))],max:[Kh,Rg(Kh),(_,p)=>Math.max(...p.map(S=>S.evaluate(_)))],abs:[Kh,[Kh],(_,[p])=>Math.abs(p.evaluate(_))],round:[Kh,[Kh],(_,[p])=>{const S=p.evaluate(_);return S<0?-Math.round(-S):Math.round(S)}],floor:[Kh,[Kh],(_,[p])=>Math.floor(p.evaluate(_))],ceil:[Kh,[Kh],(_,[p])=>Math.ceil(p.evaluate(_))],"filter-==":[fd,[Qd,$d],(_,[p,S])=>_.properties()[p.value]===S.value],"filter-id-==":[fd,[$d],(_,[p])=>_.id()===p.value],"filter-type-==":[fd,[Qd],(_,[p])=>_.geometryType()===p.value],"filter-<":[fd,[Qd,$d],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j<ut}],"filter-id-<":[fd,[$d],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S<j}],"filter->":[fd,[Qd,$d],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j>ut}],"filter-id->":[fd,[$d],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S>j}],"filter-<=":[fd,[Qd,$d],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j<=ut}],"filter-id-<=":[fd,[$d],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S<=j}],"filter->=":[fd,[Qd,$d],(_,[p,S])=>{const j=_.properties()[p.value],ut=S.value;return typeof j==typeof ut&&j>=ut}],"filter-id->=":[fd,[$d],(_,[p])=>{const S=_.id(),j=p.value;return typeof S==typeof j&&S>=j}],"filter-has":[fd,[$d],(_,[p])=>p.value in _.properties()],"filter-has-id":[fd,[],_=>_.id()!==null&&_.id()!==void 0],"filter-type-in":[fd,[Of(Qd)],(_,[p])=>p.value.indexOf(_.geometryType())>=0],"filter-id-in":[fd,[Of($d)],(_,[p])=>p.value.indexOf(_.id())>=0],"filter-in-small":[fd,[Qd,Of($d)],(_,[p,S])=>S.value.indexOf(_.properties()[p.value])>=0],"filter-in-large":[fd,[Qd,Of($d)],(_,[p,S])=>function(j,ut,Ot,fi){for(;Ot<=fi;){const kn=Ot+fi>>1;if(ut[kn]===j)return!0;ut[kn]>j?fi=kn-1:Ot=kn+1}return!1}(_.properties()[p.value],S.value,0,S.value.length-1)],all:{type:fd,overloads:[[[fd,fd],(_,[p,S])=>p.evaluate(_)&&S.evaluate(_)],[Rg(fd),(_,p)=>{for(const S of p)if(!S.evaluate(_))return!1;return!0}]]},any:{type:fd,overloads:[[[fd,fd],(_,[p,S])=>p.evaluate(_)||S.evaluate(_)],[Rg(fd),(_,p)=>{for(const S of p)if(S.evaluate(_))return!0;return!1}]]},"!":[fd,[fd],(_,[p])=>!p.evaluate(_)],"is-supported-script":[fd,[Qd],(_,[p])=>{const S=_.globals&&_.globals.isSupportedScript;return!S||S(p.evaluate(_))}],upcase:[Qd,[Qd],(_,[p])=>p.evaluate(_).toUpperCase()],downcase:[Qd,[Qd],(_,[p])=>p.evaluate(_).toLowerCase()],concat:[Qd,Rg($d),(_,p)=>p.map(S=>Zs(S.evaluate(_))).join("")],"resolved-locale":[Qd,[Jf],(_,[p])=>p.evaluate(_).resolvedLocale()]});class Zy{constructor(p,S){this.expression=p,this._warningHistory={},this._evaluator=new td,this._defaultValue=S?function(j){return j.type==="color"&&qy(j.default)?new ih(0,0,0,0):j.type==="color"?ih.parse(j.default)||null:j.type==="padding"?Th.parse(j.default)||null:j.default===void 0?null:j.default}(S):null,this._enumValues=S&&S.type==="enum"?S.values:null}evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi){return this._evaluator.globals=p,this._evaluator.feature=S,this._evaluator.featureState=j,this._evaluator.canonical=ut,this._evaluator.availableImages=Ot||null,this._evaluator.formattedSection=fi,this.expression.evaluate(this._evaluator)}evaluate(p,S,j,ut,Ot,fi){this._evaluator.globals=p,this._evaluator.feature=S||null,this._evaluator.featureState=j||null,this._evaluator.canonical=ut,this._evaluator.availableImages=Ot||null,this._evaluator.formattedSection=fi||null;try{const kn=this.expression.evaluate(this._evaluator);if(kn==null||typeof kn=="number"&&kn!=kn)return this._defaultValue;if(this._enumValues&&!(kn in this._enumValues))throw new sh(`Expected value to be one of ${Object.keys(this._enumValues).map(ss=>JSON.stringify(ss)).join(", ")}, but found ${JSON.stringify(kn)} instead.`);return kn}catch(kn){return this._warningHistory[kn.message]||(this._warningHistory[kn.message]=!0,typeof console<"u"&&console.warn(kn.message)),this._defaultValue}}}function Hy(_){return Array.isArray(_)&&_.length>0&&typeof _[0]=="string"&&_[0]in Jg}function H_(_,p){const S=new wy(Jg,[],p?function(ut){const Ot={color:Jd,string:Qd,number:Kh,enum:Qd,boolean:fd,formatted:Sf,padding:If,resolvedImage:Xf};return ut.type==="array"?Of(Ot[ut.value]||$d,ut.length):Ot[ut.type]}(p):void 0),j=S.parse(_,void 0,void 0,void 0,p&&p.type==="string"?{typeAnnotation:"coerce"}:void 0);return j?jy(new Zy(j,p)):Qg(S.errors)}class Cy{constructor(p,S){this.kind=p,this._styleExpression=S,this.isStateDependent=p!=="constant"&&!Yd(S.expression)}evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi){return this._styleExpression.evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi)}evaluate(p,S,j,ut,Ot,fi){return this._styleExpression.evaluate(p,S,j,ut,Ot,fi)}}class c0{constructor(p,S,j,ut){this.kind=p,this.zoomStops=j,this._styleExpression=S,this.isStateDependent=p!=="camera"&&!Yd(S.expression),this.interpolationType=ut}evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi){return this._styleExpression.evaluateWithoutErrorHandling(p,S,j,ut,Ot,fi)}evaluate(p,S,j,ut,Ot,fi){return this._styleExpression.evaluate(p,S,j,ut,Ot,fi)}interpolationFactor(p,S,j){return this.interpolationType?Kp.interpolationFactor(this.interpolationType,p,S,j):0}}function Xy(_,p){const S=H_(_,p);if(S.result==="error")return S;const j=S.value.expression,ut=by(j);if(!ut&&!j_(p))return Qg([new ep("","data expressions not supported")]);const Ot=Mg(j,["zoom"]);if(!Ot&&!q_(p))return Qg([new ep("","zoom expressions not supported")]);const fi=X_(j);return fi||Ot?fi instanceof ep?Qg([fi]):fi instanceof Kp&&!Ty(p)?Qg([new ep("",'"interpolate" expressions cannot be used with this property')]):jy(fi?new c0(ut?"camera":"composite",S.value,fi.labels,fi instanceof Kp?fi.interpolation:void 0):new Cy(ut?"constant":"source",S.value)):Qg([new ep("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class m_{constructor(p,S){this._parameters=p,this._specification=S,Uf(this,I0(this._parameters,this._specification))}static deserialize(p){return new m_(p._parameters,p._specification)}static serialize(p){return{_parameters:p._parameters,_specification:p._specification}}}function X_(_){let p=null;if(_ instanceof lg)p=X_(_.result);else if(_ instanceof Mm){for(const S of _.args)if(p=X_(S),p)break}else(_ instanceof s0||_ instanceof Kp)&&_.input instanceof Ad&&_.input.name==="zoom"&&(p=_);return p instanceof ep||_.eachChild(S=>{const j=X_(S);j instanceof ep?p=j:!p&&j?p=new ep("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):p&&j&&p!==j&&(p=new ep("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),p}function Og(_){const p=_.key,S=_.value,j=_.valueSpec||{},ut=_.objectElementValidators||{},Ot=_.style,fi=_.styleSpec,kn=_.validateSpec;let ss=[];const ul=gm(S);if(ul!=="object")return[new gd(p,S,`object expected, ${ul} found`)];for(const Ju in S){const nh=Ju.split(".")[0],mh=j[nh]||j["*"];let _h;if(ut[nh])_h=ut[nh];else if(j[nh])_h=kn;else if(ut["*"])_h=ut["*"];else{if(!j["*"]){ss.push(new gd(p,S[Ju],`unknown property "${Ju}"`));continue}_h=kn}ss=ss.concat(_h({key:(p&&`${p}.`)+Ju,value:S[Ju],valueSpec:mh,style:Ot,styleSpec:fi,object:S,objectKey:Ju,validateSpec:kn},S))}for(const Ju in j)ut[Ju]||j[Ju].required&&j[Ju].default===void 0&&S[Ju]===void 0&&ss.push(new gd(p,S,`missing required property "${Ju}"`));return ss}function C0(_){const p=_.value,S=_.valueSpec,j=_.style,ut=_.styleSpec,Ot=_.key,fi=_.arrayElementValidator||_.validateSpec;if(gm(p)!=="array")return[new gd(Ot,p,`array expected, ${gm(p)} found`)];if(S.length&&p.length!==S.length)return[new gd(Ot,p,`array length ${S.length} expected, length ${p.length} found`)];if(S["min-length"]&&p.length<S["min-length"])return[new gd(Ot,p,`array length at least ${S["min-length"]} expected, length ${p.length} found`)];let kn={type:S.value,values:S.values};ut.$version<7&&(kn.function=S.function),gm(S.value)==="object"&&(kn=S.value);let ss=[];for(let ul=0;ul<p.length;ul++)ss=ss.concat(fi({array:p,arrayIndex:ul,value:p[ul],valueSpec:kn,validateSpec:_.validateSpec,style:j,styleSpec:ut,key:`${Ot}[${ul}]`}));return ss}function l_(_){const p=_.key,S=_.value,j=_.valueSpec;let ut=gm(S);return ut==="number"&&S!=S&&(ut="NaN"),ut!=="number"?[new gd(p,S,`number expected, ${ut} found`)]:"minimum"in j&&S<j.minimum?[new gd(p,S,`${S} is less than the minimum value ${j.minimum}`)]:"maximum"in j&&S>j.maximum?[new gd(p,S,`${S} is greater than the maximum value ${j.maximum}`)]:[]}function g_(_){const p=_.valueSpec,S=qd(_.value.type);let j,ut,Ot,fi={};const kn=S!=="categorical"&&_.value.property===void 0,ss=!kn,ul=gm(_.value.stops)==="array"&&gm(_.value.stops[0])==="array"&&gm(_.value.stops[0][0])==="object",Ju=Og({key:_.key,value:_.value,valueSpec:_.styleSpec.function,validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{stops:function(_h){if(S==="identity")return[new gd(_h.key,_h.value,'identity function may not have a "stops" property')];let wh=[];const Jh=_h.value;return wh=wh.concat(C0({key:_h.key,value:Jh,valueSpec:_h.valueSpec,validateSpec:_h.validateSpec,style:_h.style,styleSpec:_h.styleSpec,arrayElementValidator:nh})),gm(Jh)==="array"&&Jh.length===0&&wh.push(new gd(_h.key,Jh,"array must have at least one stop")),wh},default:function(_h){return _h.validateSpec({key:_h.key,value:_h.value,valueSpec:p,validateSpec:_h.validateSpec,style:_h.style,styleSpec:_h.styleSpec})}}});return S==="identity"&&kn&&Ju.push(new gd(_.key,_.value,'missing required property "property"')),S==="identity"||_.value.stops||Ju.push(new gd(_.key,_.value,'missing required property "stops"')),S==="exponential"&&_.valueSpec.expression&&!Ty(_.valueSpec)&&Ju.push(new gd(_.key,_.value,"exponential functions not supported")),_.styleSpec.$version>=8&&(ss&&!j_(_.valueSpec)?Ju.push(new gd(_.key,_.value,"property functions not supported")):kn&&!q_(_.valueSpec)&&Ju.push(new gd(_.key,_.value,"zoom functions not supported"))),S!=="categorical"&&!ul||_.value.property!==void 0||Ju.push(new gd(_.key,_.value,'"property" property is required')),Ju;function nh(_h){let wh=[];const Jh=_h.value,Hh=_h.key;if(gm(Jh)!=="array")return[new gd(Hh,Jh,`array expected, ${gm(Jh)} found`)];if(Jh.length!==2)return[new gd(Hh,Jh,`array length 2 expected, length ${Jh.length} found`)];if(ul){if(gm(Jh[0])!=="object")return[new gd(Hh,Jh,`object expected, ${gm(Jh[0])} found`)];if(Jh[0].zoom===void 0)return[new gd(Hh,Jh,"object stop key must have zoom")];if(Jh[0].value===void 0)return[new gd(Hh,Jh,"object stop key must have value")];if(Ot&&Ot>qd(Jh[0].zoom))return[new gd(Hh,Jh[0].zoom,"stop zoom values must appear in ascending order")];qd(Jh[0].zoom)!==Ot&&(Ot=qd(Jh[0].zoom),ut=void 0,fi={}),wh=wh.concat(Og({key:`${Hh}[0]`,value:Jh[0],valueSpec:{zoom:{}},validateSpec:_h.validateSpec,style:_h.style,styleSpec:_h.styleSpec,objectElementValidators:{zoom:l_,value:mh}}))}else wh=wh.concat(mh({key:`${Hh}[0]`,value:Jh[0],valueSpec:{},validateSpec:_h.validateSpec,style:_h.style,styleSpec:_h.styleSpec},Jh));return Hy(Vd(Jh[1]))?wh.concat([new gd(`${Hh}[1]`,Jh[1],"expressions are not allowed in function stops.")]):wh.concat(_h.validateSpec({key:`${Hh}[1]`,value:Jh[1],valueSpec:p,validateSpec:_h.validateSpec,style:_h.style,styleSpec:_h.styleSpec}))}function mh(_h,wh){const Jh=gm(_h.value),Hh=qd(_h.value),Id=_h.value!==null?_h.value:wh;if(j){if(Jh!==j)return[new gd(_h.key,Id,`${Jh} stop domain type must match previous stop domain type ${j}`)]}else j=Jh;if(Jh!=="number"&&Jh!=="string"&&Jh!=="boolean")return[new gd(_h.key,Id,"stop domain value must be a number, string, or boolean")];if(Jh!=="number"&&S!=="categorical"){let jd=`number expected, ${Jh} found`;return j_(p)&&S===void 0&&(jd+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gd(_h.key,Id,jd)]}return S!=="categorical"||Jh!=="number"||isFinite(Hh)&&Math.floor(Hh)===Hh?S!=="categorical"&&Jh==="number"&&ut!==void 0&&Hh<ut?[new gd(_h.key,Id,"stop domain values must appear in ascending order")]:(ut=Hh,S==="categorical"&&Hh in fi?[new gd(_h.key,Id,"stop domain values must be unique")]:(fi[Hh]=!0,[])):[new gd(_h.key,Id,`integer expected, found ${Hh}`)]}}function e_(_){const p=(_.expressionContext==="property"?Xy:H_)(Vd(_.value),_.valueSpec);if(p.result==="error")return p.value.map(j=>new gd(`${_.key}${j.key}`,_.value,j.message));const S=p.value.expression||p.value._styleExpression.expression;if(_.expressionContext==="property"&&_.propertyKey==="text-font"&&!S.outputDefined())return[new gd(_.key,_.value,`Invalid data expression for "${_.propertyKey}". Output values must be contained as literals within the expression.`)];if(_.expressionContext==="property"&&_.propertyType==="layout"&&!Yd(S))return[new gd(_.key,_.value,'"feature-state" data expressions are not supported with layout properties.')];if(_.expressionContext==="filter"&&!Yd(S))return[new gd(_.key,_.value,'"feature-state" data expressions are not supported with filters.')];if(_.expressionContext&&_.expressionContext.indexOf("cluster")===0){if(!Mg(S,["zoom","feature-state"]))return[new gd(_.key,_.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(_.expressionContext==="cluster-initial"&&!by(S))return[new gd(_.key,_.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function K_(_){const p=_.key,S=_.value,j=_.valueSpec,ut=[];return Array.isArray(j.values)?j.values.indexOf(qd(S))===-1&&ut.push(new gd(p,S,`expected one of [${j.values.join(", ")}], ${JSON.stringify(S)} found`)):Object.keys(j.values).indexOf(qd(S))===-1&&ut.push(new gd(p,S,`expected one of [${Object.keys(j.values).join(", ")}], ${JSON.stringify(S)} found`)),ut}function t_(_){if(_===!0||_===!1)return!0;if(!Array.isArray(_)||_.length===0)return!1;switch(_[0]){case"has":return _.length>=2&&_[1]!=="$id"&&_[1]!=="$type";case"in":return _.length>=3&&(typeof _[1]!="string"||Array.isArray(_[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return _.length!==3||Array.isArray(_[1])||Array.isArray(_[2]);case"any":case"all":for(const p of _.slice(1))if(!t_(p)&&typeof p!="boolean")return!1;return!0;default:return!0}}const gv={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function im(_){if(_==null)return{filter:()=>!0,needGeometry:!1};t_(_)||(_=Ky(_));const p=H_(_,gv);if(p.result==="error")throw new Error(p.value.map(S=>`${S.key}: ${S.message}`).join(", "));return{filter:(S,j,ut)=>p.value.evaluate(S,j,{},ut),needGeometry:Hm(_)}}function uy(_,p){return _<p?-1:_>p?1:0}function Hm(_){if(!Array.isArray(_))return!1;if(_[0]==="within")return!0;for(let p=1;p<_.length;p++)if(Hm(_[p]))return!0;return!1}function Ky(_){if(!_)return!0;const p=_[0];return _.length<=1?p!=="any":p==="=="?lm(_[1],_[2],"=="):p==="!="?Im(lm(_[1],_[2],"==")):p==="<"||p===">"||p==="<="||p===">="?lm(_[1],_[2],p):p==="any"?(S=_.slice(1),["any"].concat(S.map(Ky))):p==="all"?["all"].concat(_.slice(1).map(Ky)):p==="none"?["all"].concat(_.slice(1).map(Ky).map(Im)):p==="in"?W_(_[1],_.slice(2)):p==="!in"?Im(W_(_[1],_.slice(2))):p==="has"?Am(_[1]):p==="!has"?Im(Am(_[1])):p!=="within"||_;var S}function lm(_,p,S){switch(_){case"$type":return[`filter-type-${S}`,p];case"$id":return[`filter-id-${S}`,p];default:return[`filter-${S}`,_,p]}}function W_(_,p){if(p.length===0)return!1;switch(_){case"$type":return["filter-type-in",["literal",p]];case"$id":return["filter-id-in",["literal",p]];default:return p.length>200&&!p.some(S=>typeof S!=typeof p[0])?["filter-in-large",_,["literal",p.sort(uy)]]:["filter-in-small",_,["literal",p]]}}function Am(_){switch(_){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",_]}}function Im(_){return["!",_]}function hy(_){return t_(Vd(_.value))?e_(Uf({},_,{expressionContext:"filter",valueSpec:{value:"boolean"}})):My(_)}function My(_){const p=_.value,S=_.key;if(gm(p)!=="array")return[new gd(S,p,`array expected, ${gm(p)} found`)];const j=_.styleSpec;let ut,Ot=[];if(p.length<1)return[new gd(S,p,"filter array must have at least 1 element")];switch(Ot=Ot.concat(K_({key:`${S}[0]`,value:p[0],valueSpec:j.filter_operator,style:_.style,styleSpec:_.styleSpec})),qd(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&qd(p[1])==="$type"&&Ot.push(new gd(S,p,`"$type" cannot be use with operator "${p[0]}"`));case"==":case"!=":p.length!==3&&Ot.push(new gd(S,p,`filter array for operator "${p[0]}" must have 3 elements`));case"in":case"!in":p.length>=2&&(ut=gm(p[1]),ut!=="string"&&Ot.push(new gd(`${S}[1]`,p[1],`string expected, ${ut} found`)));for(let fi=2;fi<p.length;fi++)ut=gm(p[fi]),qd(p[1])==="$type"?Ot=Ot.concat(K_({key:`${S}[${fi}]`,value:p[fi],valueSpec:j.geometry_type,style:_.style,styleSpec:_.styleSpec})):ut!=="string"&&ut!=="number"&&ut!=="boolean"&&Ot.push(new gd(`${S}[${fi}]`,p[fi],`string, number, or boolean expected, ${ut} found`));break;case"any":case"all":case"none":for(let fi=1;fi<p.length;fi++)Ot=Ot.concat(My({key:`${S}[${fi}]`,value:p[fi],style:_.style,styleSpec:_.styleSpec}));break;case"has":case"!has":ut=gm(p[1]),p.length!==2?Ot.push(new gd(S,p,`filter array for "${p[0]}" operator must have 2 elements`)):ut!=="string"&&Ot.push(new gd(`${S}[1]`,p[1],`string expected, ${ut} found`));break;case"within":ut=gm(p[1]),p.length!==2?Ot.push(new gd(S,p,`filter array for "${p[0]}" operator must have 2 elements`)):ut!=="object"&&Ot.push(new gd(`${S}[1]`,p[1],`object expected, ${ut} found`))}return Ot}function H0(_,p){const S=_.key,j=_.validateSpec,ut=_.style,Ot=_.styleSpec,fi=_.value,kn=_.objectKey,ss=Ot[`${p}_${_.layerType}`];if(!ss)return[];const ul=kn.match(/^(.*)-transition$/);if(p==="paint"&&ul&&ss[ul[1]]&&ss[ul[1]].transition)return j({key:S,value:fi,valueSpec:Ot.transition,style:ut,styleSpec:Ot});const Ju=_.valueSpec||ss[kn];if(!Ju)return[new gd(S,fi,`unknown property "${kn}"`)];let nh;if(gm(fi)==="string"&&j_(Ju)&&!Ju.tokens&&(nh=/^{([^}]+)}$/.exec(fi)))return[new gd(S,fi,`"${kn}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(nh[1])} }\`.`)];const mh=[];return _.layerType==="symbol"&&(kn==="text-field"&&ut&&!ut.glyphs&&mh.push(new gd(S,fi,'use of "text-field" requires a style "glyphs" property')),kn==="text-font"&&qy(Vd(fi))&&qd(fi.type)==="identity"&&mh.push(new gd(S,fi,'"text-font" does not support identity functions'))),mh.concat(j({key:_.key,value:fi,valueSpec:Ju,style:ut,styleSpec:Ot,expressionContext:"property",propertyType:p,propertyKey:kn}))}function k_(_){return H0(_,"paint")}function X0(_){return H0(_,"layout")}function D_(_){let p=[];const S=_.value,j=_.key,ut=_.style,Ot=_.styleSpec;S.type||S.ref||p.push(new gd(j,S,'either "type" or "ref" is required'));let fi=qd(S.type);const kn=qd(S.ref);if(S.id){const ss=qd(S.id);for(let ul=0;ul<_.arrayIndex;ul++){const Ju=ut.layers[ul];qd(Ju.id)===ss&&p.push(new gd(j,S.id,`duplicate layer id "${S.id}", previously used at line ${Ju.id.__line__}`))}}if("ref"in S){let ss;["type","source","source-layer","filter","layout"].forEach(ul=>{ul in S&&p.push(new gd(j,S[ul],`"${ul}" is prohibited for ref layers`))}),ut.layers.forEach(ul=>{qd(ul.id)===kn&&(ss=ul)}),ss?ss.ref?p.push(new gd(j,S.ref,"ref cannot reference another ref layer")):fi=qd(ss.type):p.push(new gd(j,S.ref,`ref layer "${kn}" not found`))}else if(fi!=="background")if(S.source){const ss=ut.sources&&ut.sources[S.source],ul=ss&&qd(ss.type);ss?ul==="vector"&&fi==="raster"?p.push(new gd(j,S.source,`layer "${S.id}" requires a raster source`)):ul==="raster"&&fi!=="raster"?p.push(new gd(j,S.source,`layer "${S.id}" requires a vector source`)):ul!=="vector"||S["source-layer"]?ul==="raster-dem"&&fi!=="hillshade"?p.push(new gd(j,S.source,"raster-dem source can only be used with layer type 'hillshade'.")):fi!=="line"||!S.paint||!S.paint["line-gradient"]||ul==="geojson"&&ss.lineMetrics||p.push(new gd(j,S,`layer "${S.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):p.push(new gd(j,S,`layer "${S.id}" must specify a "source-layer"`)):p.push(new gd(j,S.source,`source "${S.source}" not found`))}else p.push(new gd(j,S,'missing required property "source"'));return p=p.concat(Og({key:j,value:S,valueSpec:Ot.layer,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":()=>[],type:()=>_.validateSpec({key:`${j}.type`,value:S.type,valueSpec:Ot.layer.type,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,object:S,objectKey:"type"}),filter:hy,layout:ss=>Og({layer:S,key:ss.key,value:ss.value,style:ss.style,styleSpec:ss.styleSpec,validateSpec:ss.validateSpec,objectElementValidators:{"*":ul=>X0(Uf({layerType:fi},ul))}}),paint:ss=>Og({layer:S,key:ss.key,value:ss.value,style:ss.style,styleSpec:ss.styleSpec,validateSpec:ss.validateSpec,objectElementValidators:{"*":ul=>k_(Uf({layerType:fi},ul))}})}})),p}function Y_(_){const p=_.value,S=_.key,j=gm(p);return j!=="string"?[new gd(S,p,`string expected, ${j} found`)]:[]}const K0={promoteId:function({key:_,value:p}){if(gm(p)==="string")return Y_({key:_,value:p});{const S=[];for(const j in p)S.push(...Y_({key:`${_}.${j}`,value:p[j]}));return S}}};function u0(_){const p=_.value,S=_.key,j=_.styleSpec,ut=_.style,Ot=_.validateSpec;if(!p.type)return[new gd(S,p,'"type" is required')];const fi=qd(p.type);let kn;switch(fi){case"vector":case"raster":case"raster-dem":return kn=Og({key:S,value:p,valueSpec:j[`source_${fi.replace("-","_")}`],style:_.style,styleSpec:j,objectElementValidators:K0,validateSpec:Ot}),kn;case"geojson":if(kn=Og({key:S,value:p,valueSpec:j.source_geojson,style:ut,styleSpec:j,validateSpec:Ot,objectElementValidators:K0}),p.cluster)for(const ss in p.clusterProperties){const[ul,Ju]=p.clusterProperties[ss],nh=typeof ul=="string"?[ul,["accumulated"],["get",ss]]:ul;kn.push(...e_({key:`${S}.${ss}.map`,value:Ju,validateSpec:Ot,expressionContext:"cluster-map"})),kn.push(...e_({key:`${S}.${ss}.reduce`,value:nh,validateSpec:Ot,expressionContext:"cluster-reduce"}))}return kn;case"video":return Og({key:S,value:p,valueSpec:j.source_video,style:ut,validateSpec:Ot,styleSpec:j});case"image":return Og({key:S,value:p,valueSpec:j.source_image,style:ut,validateSpec:Ot,styleSpec:j});case"canvas":return[new gd(S,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return K_({key:`${S}.type`,value:p.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ut,validateSpec:Ot,styleSpec:j})}}function dy(_){const p=_.value,S=_.styleSpec,j=S.light,ut=_.style;let Ot=[];const fi=gm(p);if(p===void 0)return Ot;if(fi!=="object")return Ot=Ot.concat([new gd("light",p,`object expected, ${fi} found`)]),Ot;for(const kn in p){const ss=kn.match(/^(.*)-transition$/);Ot=Ot.concat(ss&&j[ss[1]]&&j[ss[1]].transition?_.validateSpec({key:kn,value:p[kn],valueSpec:S.transition,validateSpec:_.validateSpec,style:ut,styleSpec:S}):j[kn]?_.validateSpec({key:kn,value:p[kn],valueSpec:j[kn],validateSpec:_.validateSpec,style:ut,styleSpec:S}):[new gd(kn,p[kn],`unknown property "${kn}"`)])}return Ot}function J_(_){const p=_.value,S=_.styleSpec,j=S.terrain,ut=_.style;let Ot=[];const fi=gm(p);if(p===void 0)return Ot;if(fi!=="object")return Ot=Ot.concat([new gd("terrain",p,`object expected, ${fi} found`)]),Ot;for(const kn in p)Ot=Ot.concat(j[kn]?_.validateSpec({key:kn,value:p[kn],valueSpec:j[kn],validateSpec:_.validateSpec,style:ut,styleSpec:S}):[new gd(kn,p[kn],`unknown property "${kn}"`)]);return Ot}function M0(_){let p=[];const S=_.value,j=_.key;if(Array.isArray(S)){const ut=[],Ot=[];for(const fi in S)S[fi].id&&ut.includes(S[fi].id)&&p.push(new gd(j,S,`all the sprites' ids must be unique, but ${S[fi].id} is duplicated`)),ut.push(S[fi].id),S[fi].url&&Ot.includes(S[fi].url)&&p.push(new gd(j,S,`all the sprites' URLs must be unique, but ${S[fi].url} is duplicated`)),Ot.push(S[fi].url),p=p.concat(Og({key:`${j}[${fi}]`,value:S[fi],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:_.validateSpec}));return p}return Y_({key:j,value:S})}const Wy={"*":()=>[],array:C0,boolean:function(_){const p=_.value,S=_.key,j=gm(p);return j!=="boolean"?[new gd(S,p,`boolean expected, ${j} found`)]:[]},number:l_,color:function(_){const p=_.key,S=_.value,j=gm(S);return j!=="string"?[new gd(p,S,`color expected, ${j} found`)]:qp(S)===null?[new gd(p,S,`color expected, "${S}" found`)]:[]},constants:bp,enum:K_,filter:hy,function:g_,layer:D_,object:Og,source:u0,light:dy,terrain:J_,string:Y_,formatted:function(_){return Y_(_).length===0?[]:e_(_)},resolvedImage:function(_){return Y_(_).length===0?[]:e_(_)},padding:function(_){const p=_.key,S=_.value;if(gm(S)==="array"){if(S.length<1||S.length>4)return[new gd(p,S,`padding requires 1 to 4 values; ${S.length} values found`)];const j={type:"number"};let ut=[];for(let Ot=0;Ot<S.length;Ot++)ut=ut.concat(_.validateSpec({key:`${p}[${Ot}]`,value:S[Ot],validateSpec:_.validateSpec,valueSpec:j}));return ut}return l_({key:p,value:S,valueSpec:{}})},sprite:M0};function L_(_){const p=_.value,S=_.valueSpec,j=_.styleSpec;return _.validateSpec=L_,S.expression&&qy(qd(p))?g_(_):S.expression&&Hy(Vd(p))?e_(_):S.type&&Wy[S.type]?Wy[S.type](_):Og(Uf({},_,{valueSpec:S.type?j[S.type]:S}))}function __(_){const p=_.value,S=_.key,j=Y_(_);return j.length||(p.indexOf("{fontstack}")===-1&&j.push(new gd(S,p,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&j.push(new gd(S,p,'"glyphs" url must include a "{range}" token'))),j}function c_(_,p=cd){let S=[];return S=S.concat(L_({key:"",value:_,valueSpec:p.$root,styleSpec:p,style:_,validateSpec:L_,objectElementValidators:{glyphs:__,"*":()=>[]}})),_.constants&&(S=S.concat(bp({key:"constants",value:_.constants,style:_,styleSpec:p,validateSpec:L_}))),mf(S)}function bd(_){return function(p){return _({...p,validateSpec:L_})}}function mf(_){return[].concat(_).sort((p,S)=>p.line-S.line)}function np(_){return function(...p){return mf(_.apply(this,p))}}c_.source=np(bd(u0)),c_.sprite=np(bd(M0)),c_.glyphs=np(bd(__)),c_.light=np(bd(dy)),c_.terrain=np(bd(J_)),c_.layer=np(bd(D_)),c_.filter=np(bd(hy)),c_.paintProperty=np(bd(k_)),c_.layoutProperty=np(bd(X0));const Dp=c_,Fm=Dp.light,om=Dp.paintProperty,qm=Dp.layoutProperty;function Um(_,p){let S=!1;if(p&&p.length)for(const j of p)_.fire(new wf(new Error(j.message))),S=!0;return S}class Ag{constructor(p,S,j){const ut=this.cells=[];if(p instanceof ArrayBuffer){this.arrayBuffer=p;const fi=new Int32Array(this.arrayBuffer);p=fi[0],this.d=(S=fi[1])+2*(j=fi[2]);for(let ss=0;ss<this.d*this.d;ss++){const ul=fi[3+ss],Ju=fi[3+ss+1];ut.push(ul===Ju?null:fi.subarray(ul,Ju))}const kn=fi[3+ut.length+1];this.keys=fi.subarray(fi[3+ut.length],kn),this.bboxes=fi.subarray(kn),this.insert=this._insertReadonly}else{this.d=S+2*j;for(let fi=0;fi<this.d*this.d;fi++)ut.push([]);this.keys=[],this.bboxes=[]}this.n=S,this.extent=p,this.padding=j,this.scale=S/p,this.uid=0;const Ot=j/S*p;this.min=-Ot,this.max=p+Ot}insert(p,S,j,ut,Ot){this._forEachCell(S,j,ut,Ot,this._insertCell,this.uid++,void 0,void 0),this.keys.push(p),this.bboxes.push(S),this.bboxes.push(j),this.bboxes.push(ut),this.bboxes.push(Ot)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(p,S,j,ut,Ot,fi){this.cells[Ot].push(fi)}query(p,S,j,ut,Ot){const fi=this.min,kn=this.max;if(p<=fi&&S<=fi&&kn<=j&&kn<=ut&&!Ot)return Array.prototype.slice.call(this.keys);{const ss=[];return this._forEachCell(p,S,j,ut,this._queryCell,ss,{},Ot),ss}}_queryCell(p,S,j,ut,Ot,fi,kn,ss){const ul=this.cells[Ot];if(ul!==null){const Ju=this.keys,nh=this.bboxes;for(let mh=0;mh<ul.length;mh++){const _h=ul[mh];if(kn[_h]===void 0){const wh=4*_h;(ss?ss(nh[wh+0],nh[wh+1],nh[wh+2],nh[wh+3]):p<=nh[wh+2]&&S<=nh[wh+3]&&j>=nh[wh+0]&&ut>=nh[wh+1])?(kn[_h]=!0,fi.push(Ju[_h])):kn[_h]=!1}}}}_forEachCell(p,S,j,ut,Ot,fi,kn,ss){const ul=this._convertToCellCoord(p),Ju=this._convertToCellCoord(S),nh=this._convertToCellCoord(j),mh=this._convertToCellCoord(ut);for(let _h=ul;_h<=nh;_h++)for(let wh=Ju;wh<=mh;wh++){const Jh=this.d*wh+_h;if((!ss||ss(this._convertFromCellCoord(_h),this._convertFromCellCoord(wh),this._convertFromCellCoord(_h+1),this._convertFromCellCoord(wh+1)))&&Ot.call(this,p,S,j,ut,Jh,fi,kn,ss))return}}_convertFromCellCoord(p){return(p-this.padding)/this.scale}_convertToCellCoord(p){return Math.max(0,Math.min(this.d-1,Math.floor(p*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const p=this.cells,S=3+this.cells.length+1+1;let j=0;for(let fi=0;fi<this.cells.length;fi++)j+=this.cells[fi].length;const ut=new Int32Array(S+j+this.keys.length+this.bboxes.length);ut[0]=this.extent,ut[1]=this.n,ut[2]=this.padding;let Ot=S;for(let fi=0;fi<p.length;fi++){const kn=p[fi];ut[3+fi]=Ot,ut.set(kn,Ot),Ot+=kn.length}return ut[3+p.length]=Ot,ut.set(this.keys,Ot),Ot+=this.keys.length,ut[3+p.length+1]=Ot,ut.set(this.bboxes,Ot),Ot+=this.bboxes.length,ut.buffer}static serialize(p,S){const j=p.toArrayBuffer();return S&&S.push(j),{buffer:j}}static deserialize(p){return new Ag(p.buffer)}}const Pm={};function tp(_,p,S={}){if(Pm[_])throw new Error(`${_} is already registered.`);Object.defineProperty(p,"_classRegistryKey",{value:_,writeable:!1}),Pm[_]={klass:p,omit:S.omit||[],shallow:S.shallow||[]}}tp("Object",Object),tp("TransferableGridIndex",Ag),tp("Color",ih),tp("Error",Error),tp("AJAXError",Cf),tp("ResolvedImage",Fh),tp("StylePropertyFunction",m_),tp("StyleExpression",Zy,{omit:["_evaluator"]}),tp("ZoomDependentExpression",c0),tp("ZoomConstantExpression",Cy),tp("CompoundExpression",Ad,{omit:["_evaluate"]});for(const _ in Jg)Jg[_]._classRegistryKey||tp(`Expression_${_}`,Jg[_]);function $g(_){return _&&typeof ArrayBuffer<"u"&&(_ instanceof ArrayBuffer||_.constructor&&_.constructor.name==="ArrayBuffer")}function Bg(_,p){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||_ instanceof Blob)return _;if($g(_)||oh(_))return p&&p.push(_),_;if(ArrayBuffer.isView(_)){const S=_;return p&&p.push(S.buffer),S}if(_ instanceof ImageData)return p&&p.push(_.data.buffer),_;if(Array.isArray(_)){const S=[];for(const j of _)S.push(Bg(j,p));return S}if(typeof _=="object"){const S=_.constructor,j=S._classRegistryKey;if(!j)throw new Error("can't serialize object of unregistered class");if(!Pm[j])throw new Error(`${j} is not registered.`);const ut=S.serialize?S.serialize(_,p):{};if(S.serialize){if(p&&ut===p[p.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Ot in _){if(!_.hasOwnProperty(Ot)||Pm[j].omit.indexOf(Ot)>=0)continue;const fi=_[Ot];ut[Ot]=Pm[j].shallow.indexOf(Ot)>=0?fi:Bg(fi,p)}_ instanceof Error&&(ut.message=_.message)}if(ut.$name)throw new Error("$name property is reserved for worker serialization logic.");return j!=="Object"&&(ut.$name=j),ut}throw new Error("can't serialize object of type "+typeof _)}function Zm(_){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||_ instanceof Blob||$g(_)||oh(_)||ArrayBuffer.isView(_)||_ instanceof ImageData)return _;if(Array.isArray(_))return _.map(Zm);if(typeof _=="object"){const p=_.$name||"Object";if(!Pm[p])throw new Error(`can't deserialize unregistered class ${p}`);const{klass:S}=Pm[p];if(!S)throw new Error(`can't deserialize unregistered class ${p}`);if(S.deserialize)return S.deserialize(_);const j=Object.create(S.prototype);for(const ut of Object.keys(_)){if(ut==="$name")continue;const Ot=_[ut];j[ut]=Pm[p].shallow.indexOf(ut)>=0?Ot:Zm(Ot)}return j}throw new Error("can't deserialize object of type "+typeof _)}class R_{constructor(){this.first=!0}update(p,S){const j=Math.floor(p);return this.first?(this.first=!1,this.lastIntegerZoom=j,this.lastIntegerZoomTime=0,this.lastZoom=p,this.lastFloorZoom=j,!0):(this.lastFloorZoom>j?(this.lastIntegerZoom=j+1,this.lastIntegerZoomTime=S):this.lastFloorZoom<j&&(this.lastIntegerZoom=j,this.lastIntegerZoomTime=S),p!==this.lastZoom&&(this.lastZoom=p,this.lastFloorZoom=j,!0))}}const ip={"Latin-1 Supplement":_=>_>=128&&_<=255,Arabic:_=>_>=1536&&_<=1791,"Arabic Supplement":_=>_>=1872&&_<=1919,"Arabic Extended-A":_=>_>=2208&&_<=2303,"Hangul Jamo":_=>_>=4352&&_<=4607,"Unified Canadian Aboriginal Syllabics":_=>_>=5120&&_<=5759,Khmer:_=>_>=6016&&_<=6143,"Unified Canadian Aboriginal Syllabics Extended":_=>_>=6320&&_<=6399,"General Punctuation":_=>_>=8192&&_<=8303,"Letterlike Symbols":_=>_>=8448&&_<=8527,"Number Forms":_=>_>=8528&&_<=8591,"Miscellaneous Technical":_=>_>=8960&&_<=9215,"Control Pictures":_=>_>=9216&&_<=9279,"Optical Character Recognition":_=>_>=9280&&_<=9311,"Enclosed Alphanumerics":_=>_>=9312&&_<=9471,"Geometric Shapes":_=>_>=9632&&_<=9727,"Miscellaneous Symbols":_=>_>=9728&&_<=9983,"Miscellaneous Symbols and Arrows":_=>_>=11008&&_<=11263,"CJK Radicals Supplement":_=>_>=11904&&_<=12031,"Kangxi Radicals":_=>_>=12032&&_<=12255,"Ideographic Description Characters":_=>_>=12272&&_<=12287,"CJK Symbols and Punctuation":_=>_>=12288&&_<=12351,Hiragana:_=>_>=12352&&_<=12447,Katakana:_=>_>=12448&&_<=12543,Bopomofo:_=>_>=12544&&_<=12591,"Hangul Compatibility Jamo":_=>_>=12592&&_<=12687,Kanbun:_=>_>=12688&&_<=12703,"Bopomofo Extended":_=>_>=12704&&_<=12735,"CJK Strokes":_=>_>=12736&&_<=12783,"Katakana Phonetic Extensions":_=>_>=12784&&_<=12799,"Enclosed CJK Letters and Months":_=>_>=12800&&_<=13055,"CJK Compatibility":_=>_>=13056&&_<=13311,"CJK Unified Ideographs Extension A":_=>_>=13312&&_<=19903,"Yijing Hexagram Symbols":_=>_>=19904&&_<=19967,"CJK Unified Ideographs":_=>_>=19968&&_<=40959,"Yi Syllables":_=>_>=40960&&_<=42127,"Yi Radicals":_=>_>=42128&&_<=42191,"Hangul Jamo Extended-A":_=>_>=43360&&_<=43391,"Hangul Syllables":_=>_>=44032&&_<=55215,"Hangul Jamo Extended-B":_=>_>=55216&&_<=55295,"Private Use Area":_=>_>=57344&&_<=63743,"CJK Compatibility Ideographs":_=>_>=63744&&_<=64255,"Arabic Presentation Forms-A":_=>_>=64336&&_<=65023,"Vertical Forms":_=>_>=65040&&_<=65055,"CJK Compatibility Forms":_=>_>=65072&&_<=65103,"Small Form Variants":_=>_>=65104&&_<=65135,"Arabic Presentation Forms-B":_=>_>=65136&&_<=65279,"Halfwidth and Fullwidth Forms":_=>_>=65280&&_<=65519};function Yy(_){for(const p of _)if(W0(p.charCodeAt(0)))return!0;return!1}function O_(_){for(const p of _)if(!A0(p.charCodeAt(0)))return!1;return!0}function A0(_){return!(ip.Arabic(_)||ip["Arabic Supplement"](_)||ip["Arabic Extended-A"](_)||ip["Arabic Presentation Forms-A"](_)||ip["Arabic Presentation Forms-B"](_))}function W0(_){return!(_!==746&&_!==747&&(_<4352||!(ip["Bopomofo Extended"](_)||ip.Bopomofo(_)||ip["CJK Compatibility Forms"](_)&&!(_>=65097&&_<=65103)||ip["CJK Compatibility Ideographs"](_)||ip["CJK Compatibility"](_)||ip["CJK Radicals Supplement"](_)||ip["CJK Strokes"](_)||!(!ip["CJK Symbols and Punctuation"](_)||_>=12296&&_<=12305||_>=12308&&_<=12319||_===12336)||ip["CJK Unified Ideographs Extension A"](_)||ip["CJK Unified Ideographs"](_)||ip["Enclosed CJK Letters and Months"](_)||ip["Hangul Compatibility Jamo"](_)||ip["Hangul Jamo Extended-A"](_)||ip["Hangul Jamo Extended-B"](_)||ip["Hangul Jamo"](_)||ip["Hangul Syllables"](_)||ip.Hiragana(_)||ip["Ideographic Description Characters"](_)||ip.Kanbun(_)||ip["Kangxi Radicals"](_)||ip["Katakana Phonetic Extensions"](_)||ip.Katakana(_)&&_!==12540||!(!ip["Halfwidth and Fullwidth Forms"](_)||_===65288||_===65289||_===65293||_>=65306&&_<=65310||_===65339||_===65341||_===65343||_>=65371&&_<=65503||_===65507||_>=65512&&_<=65519)||!(!ip["Small Form Variants"](_)||_>=65112&&_<=65118||_>=65123&&_<=65126)||ip["Unified Canadian Aboriginal Syllabics"](_)||ip["Unified Canadian Aboriginal Syllabics Extended"](_)||ip["Vertical Forms"](_)||ip["Yijing Hexagram Symbols"](_)||ip["Yi Syllables"](_)||ip["Yi Radicals"](_))))}function zv(_){return!(W0(_)||function(p){return!!(ip["Latin-1 Supplement"](p)&&(p===167||p===169||p===174||p===177||p===188||p===189||p===190||p===215||p===247)||ip["General Punctuation"](p)&&(p===8214||p===8224||p===8225||p===8240||p===8241||p===8251||p===8252||p===8258||p===8263||p===8264||p===8265||p===8273)||ip["Letterlike Symbols"](p)||ip["Number Forms"](p)||ip["Miscellaneous Technical"](p)&&(p>=8960&&p<=8967||p>=8972&&p<=8991||p>=8996&&p<=9e3||p===9003||p>=9085&&p<=9114||p>=9150&&p<=9165||p===9167||p>=9169&&p<=9179||p>=9186&&p<=9215)||ip["Control Pictures"](p)&&p!==9251||ip["Optical Character Recognition"](p)||ip["Enclosed Alphanumerics"](p)||ip["Geometric Shapes"](p)||ip["Miscellaneous Symbols"](p)&&!(p>=9754&&p<=9759)||ip["Miscellaneous Symbols and Arrows"](p)&&(p>=11026&&p<=11055||p>=11088&&p<=11097||p>=11192&&p<=11243)||ip["CJK Symbols and Punctuation"](p)||ip.Katakana(p)||ip["Private Use Area"](p)||ip["CJK Compatibility Forms"](p)||ip["Small Form Variants"](p)||ip["Halfwidth and Fullwidth Forms"](p)||p===8734||p===8756||p===8757||p>=9984&&p<=10087||p>=10102&&p<=10131||p===65532||p===65533)}(_))}function P0(_){return _>=1424&&_<=2303||ip["Arabic Presentation Forms-A"](_)||ip["Arabic Presentation Forms-B"](_)}function xm(_,p){return!(!p&&P0(_)||_>=2304&&_<=3583||_>=3840&&_<=4255||ip.Khmer(_))}function am(_){for(const p of _)if(P0(p.charCodeAt(0)))return!0;return!1}const y_="deferred",Vg="loading",h0="loaded";let Gg=null,bm="unavailable",cg=null;const Pg=function(_){_&&typeof _=="string"&&_.indexOf("NetworkError")>-1&&(bm="error"),Gg&&Gg(_)};function v_(){fy.fire(new Kd("pluginStateChange",{pluginStatus:bm,pluginURL:cg}))}const fy=new kd,fg=function(){return bm},Ay=function(){if(bm!==y_||!cg)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bm=Vg,v_(),cg&&xd({url:cg},_=>{_?Pg(_):(bm=h0,v_())})},ug={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bm===h0||ug.applyArabicShaping!=null,isLoading:()=>bm===Vg,setState(_){if(!ju())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");bm=_.pluginStatus,cg=_.pluginURL},isParsed(){if(!ju())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return ug.applyArabicShaping!=null&&ug.processBidirectionalText!=null&&ug.processStyledBidirectionalText!=null},getPluginURL(){if(!ju())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return cg}};class ym{constructor(p,S){this.zoom=p,S?(this.now=S.now,this.fadeDuration=S.fadeDuration,this.zoomHistory=S.zoomHistory,this.transition=S.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new R_,this.transition={})}isSupportedScript(p){return function(S,j){for(const ut of S)if(!xm(ut.charCodeAt(0),j))return!1;return!0}(p,ug.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const p=this.zoom,S=p-Math.floor(p),j=this.crossFadingFactor();return p>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:S+(1-S)*j}:{fromScale:.5,toScale:1,t:1-(1-j)*S}}}class Yp{constructor(p,S){this.property=p,this.value=S,this.expression=function(j,ut){if(qy(j))return new m_(j,ut);if(Hy(j)){const Ot=Xy(j,ut);if(Ot.result==="error")throw new Error(Ot.value.map(fi=>`${fi.key}: ${fi.message}`).join(", "));return Ot.value}{let Ot=j;return ut.type==="color"&&typeof j=="string"?Ot=ih.parse(j):ut.type!=="padding"||typeof j!="number"&&!Array.isArray(j)||(Ot=Th.parse(j)),{kind:"constant",evaluate:()=>Ot}}}(S===void 0?p.specification.default:S,p.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(p,S,j){return this.property.possiblyEvaluate(this,p,S,j)}}class $_{constructor(p){this.property=p,this.value=new Yp(p,void 0)}transitioned(p,S){return new Py(this.property,this.value,S,Bt({},p.transition,this.transition),p.now)}untransitioned(){return new Py(this.property,this.value,null,{},0)}}class k0{constructor(p){this._properties=p,this._values=Object.create(p.defaultTransitionablePropertyValues)}getValue(p){return Io(this._values[p].value.value)}setValue(p,S){Object.prototype.hasOwnProperty.call(this._values,p)||(this._values[p]=new $_(this._values[p].property)),this._values[p].value=new Yp(this._values[p].property,S===null?void 0:Io(S))}getTransition(p){return Io(this._values[p].transition)}setTransition(p,S){Object.prototype.hasOwnProperty.call(this._values,p)||(this._values[p]=new $_(this._values[p].property)),this._values[p].transition=Io(S)||void 0}serialize(){const p={};for(const S of Object.keys(this._values)){const j=this.getValue(S);j!==void 0&&(p[S]=j);const ut=this.getTransition(S);ut!==void 0&&(p[`${S}-transition`]=ut)}return p}transitioned(p,S){const j=new x_(this._properties);for(const ut of Object.keys(this._values))j._values[ut]=this._values[ut].transitioned(p,S._values[ut]);return j}untransitioned(){const p=new x_(this._properties);for(const S of Object.keys(this._values))p._values[S]=this._values[S].untransitioned();return p}}class Py{constructor(p,S,j,ut,Ot){this.property=p,this.value=S,this.begin=Ot+ut.delay||0,this.end=this.begin+ut.duration||0,p.specification.transition&&(ut.delay||ut.duration)&&(this.prior=j)}possiblyEvaluate(p,S,j){const ut=p.now||0,Ot=this.value.possiblyEvaluate(p,S,j),fi=this.prior;if(fi){if(ut>this.end)return this.prior=null,Ot;if(this.value.isDataDriven())return this.prior=null,Ot;if(ut<this.begin)return fi.possiblyEvaluate(p,S,j);{const kn=(ut-this.begin)/(this.end-this.begin);return this.property.interpolate(fi.possiblyEvaluate(p,S,j),Ot,function(ss){if(ss<=0)return 0;if(ss>=1)return 1;const ul=ss*ss,Ju=ul*ss;return 4*(ss<.5?Ju:3*(ss-ul)+Ju-.75)}(kn))}}return Ot}}class x_{constructor(p){this._properties=p,this._values=Object.create(p.defaultTransitioningPropertyValues)}possiblyEvaluate(p,S,j){const ut=new Q_(this._properties);for(const Ot of Object.keys(this._values))ut._values[Ot]=this._values[Ot].possiblyEvaluate(p,S,j);return ut}hasTransition(){for(const p of Object.keys(this._values))if(this._values[p].prior)return!0;return!1}}class _v{constructor(p){this._properties=p,this._values=Object.create(p.defaultPropertyValues)}getValue(p){return Io(this._values[p].value)}setValue(p,S){this._values[p]=new Yp(this._values[p].property,S===null?void 0:Io(S))}serialize(){const p={};for(const S of Object.keys(this._values)){const j=this.getValue(S);j!==void 0&&(p[S]=j)}return p}possiblyEvaluate(p,S,j){const ut=new Q_(this._properties);for(const Ot of Object.keys(this._values))ut._values[Ot]=this._values[Ot].possiblyEvaluate(p,S,j);return ut}}class b_{constructor(p,S,j){this.property=p,this.value=S,this.parameters=j}isConstant(){return this.value.kind==="constant"}constantOr(p){return this.value.kind==="constant"?this.value.value:p}evaluate(p,S,j,ut){return this.property.evaluate(this.value,this.parameters,p,S,j,ut)}}class Q_{constructor(p){this._properties=p,this._values=Object.create(p.defaultPossiblyEvaluatedValues)}get(p){return this._values[p]}}class Pp{constructor(p){this.specification=p}possiblyEvaluate(p,S){if(p.isDataDriven())throw new Error("Value should not be data driven");return p.expression.evaluate(S)}interpolate(p,S,j){const ut=yr[this.specification.type];return ut?ut(p,S,j):p}}class jp{constructor(p,S){this.specification=p,this.overrides=S}possiblyEvaluate(p,S,j,ut){return new b_(this,p.expression.kind==="constant"||p.expression.kind==="camera"?{kind:"constant",value:p.expression.evaluate(S,null,{},j,ut)}:p.expression,S)}interpolate(p,S,j){if(p.value.kind!=="constant"||S.value.kind!=="constant")return p;if(p.value.value===void 0||S.value.value===void 0)return new b_(this,{kind:"constant",value:void 0},p.parameters);const ut=yr[this.specification.type];return ut?new b_(this,{kind:"constant",value:ut(p.value.value,S.value.value,j)},p.parameters):p}evaluate(p,S,j,ut,Ot,fi){return p.kind==="constant"?p.value:p.evaluate(S,j,ut,Ot,fi)}}class py extends jp{possiblyEvaluate(p,S,j,ut){if(p.value===void 0)return new b_(this,{kind:"constant",value:void 0},S);if(p.expression.kind==="constant"){const Ot=p.expression.evaluate(S,null,{},j,ut),fi=p.property.specification.type==="resolvedImage"&&typeof Ot!="string"?Ot.name:Ot,kn=this._calculate(fi,fi,fi,S);return new b_(this,{kind:"constant",value:kn},S)}if(p.expression.kind==="camera"){const Ot=this._calculate(p.expression.evaluate({zoom:S.zoom-1}),p.expression.evaluate({zoom:S.zoom}),p.expression.evaluate({zoom:S.zoom+1}),S);return new b_(this,{kind:"constant",value:Ot},S)}return new b_(this,p.expression,S)}evaluate(p,S,j,ut,Ot,fi){if(p.kind==="source"){const kn=p.evaluate(S,j,ut,Ot,fi);return this._calculate(kn,kn,kn,S)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(S.zoom)-1},j,ut),p.evaluate({zoom:Math.floor(S.zoom)},j,ut),p.evaluate({zoom:Math.floor(S.zoom)+1},j,ut),S):p.value}_calculate(p,S,j,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:p,to:S}:{from:j,to:S}}interpolate(p){return p}}class d0{constructor(p){this.specification=p}possiblyEvaluate(p,S,j,ut){if(p.value!==void 0){if(p.expression.kind==="constant"){const Ot=p.expression.evaluate(S,null,{},j,ut);return this._calculate(Ot,Ot,Ot,S)}return this._calculate(p.expression.evaluate(new ym(Math.floor(S.zoom-1),S)),p.expression.evaluate(new ym(Math.floor(S.zoom),S)),p.expression.evaluate(new ym(Math.floor(S.zoom+1),S)),S)}}_calculate(p,S,j,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:p,to:S}:{from:j,to:S}}interpolate(p){return p}}class yv{constructor(p){this.specification=p}possiblyEvaluate(p,S,j,ut){return!!p.expression.evaluate(S,null,{},j,ut)}interpolate(){return!1}}class Ng{constructor(p){this.properties=p,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const S in p){const j=p[S];j.specification.overridable&&this.overridableProperties.push(S);const ut=this.defaultPropertyValues[S]=new Yp(j,void 0),Ot=this.defaultTransitionablePropertyValues[S]=new $_(j);this.defaultTransitioningPropertyValues[S]=Ot.untransitioned(),this.defaultPossiblyEvaluatedValues[S]=ut.possiblyEvaluate({})}}}tp("DataDrivenProperty",jp),tp("DataConstantProperty",Pp),tp("CrossFadedDataDrivenProperty",py),tp("CrossFadedProperty",d0),tp("ColorRampProperty",yv);const f0="-transition";class w_ extends kd{constructor(p,S){if(super(),this.id=p.id,this.type=p.type,this._featureFilter={filter:()=>!0,needGeometry:!1},p.type!=="custom"&&(this.metadata=p.metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),S.layout&&(this._unevaluatedLayout=new _v(S.layout)),S.paint)){this._transitionablePaint=new k0(S.paint);for(const j in p.paint)this.setPaintProperty(j,p.paint[j],{validate:!1});for(const j in p.layout)this.setLayoutProperty(j,p.layout[j],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Q_(S.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)}setLayoutProperty(p,S,j={}){S!=null&&this._validate(qm,`layers.${this.id}.layout.${p}`,p,S,j)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,S):this.visibility=S)}getPaintProperty(p){return p.endsWith(f0)?this._transitionablePaint.getTransition(p.slice(0,-f0.length)):this._transitionablePaint.getValue(p)}setPaintProperty(p,S,j={}){if(S!=null&&this._validate(om,`layers.${this.id}.paint.${p}`,p,S,j))return!1;if(p.endsWith(f0))return this._transitionablePaint.setTransition(p.slice(0,-f0.length),S||void 0),!1;{const ut=this._transitionablePaint._values[p],Ot=ut.property.specification["property-type"]==="cross-faded-data-driven",fi=ut.value.isDataDriven(),kn=ut.value;this._transitionablePaint.setValue(p,S),this._handleSpecialPaintPropertyUpdate(p);const ss=this._transitionablePaint._values[p].value;return ss.isDataDriven()||fi||Ot||this._handleOverridablePaintPropertyUpdate(p,kn,ss)}}_handleSpecialPaintPropertyUpdate(p){}_handleOverridablePaintPropertyUpdate(p,S,j){return!1}isHidden(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"}updateTransitions(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(p,S){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,S)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,S)}serialize(){const p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),tl(p,(S,j)=>!(S===void 0||j==="layout"&&!Object.keys(S).length||j==="paint"&&!Object.keys(S).length))}_validate(p,S,j,ut,Ot={}){return(!Ot||Ot.validate!==!1)&&Um(this,p.call(Dp,{key:S,layerType:this.type,objectKey:j,value:ut,styleSpec:cd,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const p in this.paint._values){const S=this.paint.get(p);if(S instanceof b_&&j_(S.property.specification)&&(S.value.kind==="source"||S.value.kind==="composite")&&S.value.isStateDependent)return!0}return!1}}const Fv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hp{constructor(p,S){this._structArray=p,this._pos1=S*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wm{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(p,S){return p._trim(),S&&(p.isTransferred=!0,S.push(p.arrayBuffer)),{length:p.length,arrayBuffer:p.arrayBuffer}}static deserialize(p){const S=Object.create(this.prototype);return S.arrayBuffer=p.arrayBuffer,S.length=p.length,S.capacity=p.arrayBuffer.byteLength/S.bytesPerElement,S._refreshViews(),S}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(p){this.reserve(p),this.length=p}reserve(p){if(p>this.capacity){this.capacity=Math.max(p,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const S=this.uint8;this._refreshViews(),S&&this.uint8.set(S)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function pg(_,p=1){let S=0,j=0;return{members:_.map(ut=>{const Ot=Fv[ut.type].BYTES_PER_ELEMENT,fi=S=Y0(S,Math.max(p,Ot)),kn=ut.components||1;return j=Math.max(j,Ot),S+=Ot*kn,{name:ut.name,type:ut.type,components:kn,offset:fi}}),size:Y0(S,Math.max(j,p)),alignment:p}}function Y0(_,p){return Math.ceil(_/p)*p}class Jy extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S){const j=this.length;return this.resize(j+1),this.emplace(j,p,S)}emplace(p,S,j){const ut=2*p;return this.int16[ut+0]=S,this.int16[ut+1]=j,p}}Jy.prototype.bytesPerElement=4,tp("StructArrayLayout2i4",Jy);class mg extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=3*p;return this.int16[Ot+0]=S,this.int16[Ot+1]=j,this.int16[Ot+2]=ut,p}}mg.prototype.bytesPerElement=6,tp("StructArrayLayout3i6",mg);class ky extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,p,S,j,ut)}emplace(p,S,j,ut,Ot){const fi=4*p;return this.int16[fi+0]=S,this.int16[fi+1]=j,this.int16[fi+2]=ut,this.int16[fi+3]=Ot,p}}ky.prototype.bytesPerElement=8,tp("StructArrayLayout4i8",ky);class J0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi){const kn=this.length;return this.resize(kn+1),this.emplace(kn,p,S,j,ut,Ot,fi)}emplace(p,S,j,ut,Ot,fi,kn){const ss=6*p;return this.int16[ss+0]=S,this.int16[ss+1]=j,this.int16[ss+2]=ut,this.int16[ss+3]=Ot,this.int16[ss+4]=fi,this.int16[ss+5]=kn,p}}J0.prototype.bytesPerElement=12,tp("StructArrayLayout2i4i12",J0);class D0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi){const kn=this.length;return this.resize(kn+1),this.emplace(kn,p,S,j,ut,Ot,fi)}emplace(p,S,j,ut,Ot,fi,kn){const ss=4*p,ul=8*p;return this.int16[ss+0]=S,this.int16[ss+1]=j,this.uint8[ul+4]=ut,this.uint8[ul+5]=Ot,this.uint8[ul+6]=fi,this.uint8[ul+7]=kn,p}}D0.prototype.bytesPerElement=8,tp("StructArrayLayout2i4ub8",D0);class p0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S){const j=this.length;return this.resize(j+1),this.emplace(j,p,S)}emplace(p,S,j){const ut=2*p;return this.float32[ut+0]=S,this.float32[ut+1]=j,p}}p0.prototype.bytesPerElement=8,tp("StructArrayLayout2f8",p0);class Uv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,kn,ss,ul,Ju){const nh=this.length;return this.resize(nh+1),this.emplace(nh,p,S,j,ut,Ot,fi,kn,ss,ul,Ju)}emplace(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh){const mh=10*p;return this.uint16[mh+0]=S,this.uint16[mh+1]=j,this.uint16[mh+2]=ut,this.uint16[mh+3]=Ot,this.uint16[mh+4]=fi,this.uint16[mh+5]=kn,this.uint16[mh+6]=ss,this.uint16[mh+7]=ul,this.uint16[mh+8]=Ju,this.uint16[mh+9]=nh,p}}Uv.prototype.bytesPerElement=20,tp("StructArrayLayout10ui20",Uv);class Q0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh){const _h=this.length;return this.resize(_h+1),this.emplace(_h,p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh)}emplace(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h){const wh=12*p;return this.int16[wh+0]=S,this.int16[wh+1]=j,this.int16[wh+2]=ut,this.int16[wh+3]=Ot,this.uint16[wh+4]=fi,this.uint16[wh+5]=kn,this.uint16[wh+6]=ss,this.uint16[wh+7]=ul,this.int16[wh+8]=Ju,this.int16[wh+9]=nh,this.int16[wh+10]=mh,this.int16[wh+11]=_h,p}}Q0.prototype.bytesPerElement=24,tp("StructArrayLayout4i4ui4i24",Q0);class Qy extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=3*p;return this.float32[Ot+0]=S,this.float32[Ot+1]=j,this.float32[Ot+2]=ut,p}}Qy.prototype.bytesPerElement=12,tp("StructArrayLayout3f12",Qy);class ev extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(p){const S=this.length;return this.resize(S+1),this.emplace(S,p)}emplace(p,S){return this.uint32[1*p+0]=S,p}}ev.prototype.bytesPerElement=4,tp("StructArrayLayout1ul4",ev);class n1 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,kn,ss,ul){const Ju=this.length;return this.resize(Ju+1),this.emplace(Ju,p,S,j,ut,Ot,fi,kn,ss,ul)}emplace(p,S,j,ut,Ot,fi,kn,ss,ul,Ju){const nh=10*p,mh=5*p;return this.int16[nh+0]=S,this.int16[nh+1]=j,this.int16[nh+2]=ut,this.int16[nh+3]=Ot,this.int16[nh+4]=fi,this.int16[nh+5]=kn,this.uint32[mh+3]=ss,this.uint16[nh+8]=ul,this.uint16[nh+9]=Ju,p}}n1.prototype.bytesPerElement=20,tp("StructArrayLayout6i1ul2ui20",n1);class Vv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi){const kn=this.length;return this.resize(kn+1),this.emplace(kn,p,S,j,ut,Ot,fi)}emplace(p,S,j,ut,Ot,fi,kn){const ss=6*p;return this.int16[ss+0]=S,this.int16[ss+1]=j,this.int16[ss+2]=ut,this.int16[ss+3]=Ot,this.int16[ss+4]=fi,this.int16[ss+5]=kn,p}}Vv.prototype.bytesPerElement=12,tp("StructArrayLayout2i2i2i12",Vv);class m0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot){const fi=this.length;return this.resize(fi+1),this.emplace(fi,p,S,j,ut,Ot)}emplace(p,S,j,ut,Ot,fi){const kn=4*p,ss=8*p;return this.float32[kn+0]=S,this.float32[kn+1]=j,this.float32[kn+2]=ut,this.int16[ss+6]=Ot,this.int16[ss+7]=fi,p}}m0.prototype.bytesPerElement=16,tp("StructArrayLayout2f1f2i16",m0);class vv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,p,S,j,ut)}emplace(p,S,j,ut,Ot){const fi=12*p,kn=3*p;return this.uint8[fi+0]=S,this.uint8[fi+1]=j,this.float32[kn+1]=ut,this.float32[kn+2]=Ot,p}}vv.prototype.bytesPerElement=12,tp("StructArrayLayout2ub2f12",vv);class tv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=3*p;return this.uint16[Ot+0]=S,this.uint16[Ot+1]=j,this.uint16[Ot+2]=ut,p}}tv.prototype.bytesPerElement=6,tp("StructArrayLayout3ui6",tv);class xv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh,Hh,Id){const jd=this.length;return this.resize(jd+1),this.emplace(jd,p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh,Hh,Id)}emplace(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh,Hh,Id,jd){const wd=24*p,Ud=12*p,Bf=48*p;return this.int16[wd+0]=S,this.int16[wd+1]=j,this.uint16[wd+2]=ut,this.uint16[wd+3]=Ot,this.uint32[Ud+2]=fi,this.uint32[Ud+3]=kn,this.uint32[Ud+4]=ss,this.uint16[wd+10]=ul,this.uint16[wd+11]=Ju,this.uint16[wd+12]=nh,this.float32[Ud+7]=mh,this.float32[Ud+8]=_h,this.uint8[Bf+36]=wh,this.uint8[Bf+37]=Jh,this.uint8[Bf+38]=Hh,this.uint32[Ud+10]=Id,this.int16[wd+22]=jd,p}}xv.prototype.bytesPerElement=48,tp("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xv);class my extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh,Hh,Id,jd,wd,Ud,Bf,Rf,Ep,Op,yp,sp,cp,xp){const gp=this.length;return this.resize(gp+1),this.emplace(gp,p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh,Hh,Id,jd,wd,Ud,Bf,Rf,Ep,Op,yp,sp,cp,xp)}emplace(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh,Hh,Id,jd,wd,Ud,Bf,Rf,Ep,Op,yp,sp,cp,xp,gp){const Wf=34*p,Gp=17*p;return this.int16[Wf+0]=S,this.int16[Wf+1]=j,this.int16[Wf+2]=ut,this.int16[Wf+3]=Ot,this.int16[Wf+4]=fi,this.int16[Wf+5]=kn,this.int16[Wf+6]=ss,this.int16[Wf+7]=ul,this.uint16[Wf+8]=Ju,this.uint16[Wf+9]=nh,this.uint16[Wf+10]=mh,this.uint16[Wf+11]=_h,this.uint16[Wf+12]=wh,this.uint16[Wf+13]=Jh,this.uint16[Wf+14]=Hh,this.uint16[Wf+15]=Id,this.uint16[Wf+16]=jd,this.uint16[Wf+17]=wd,this.uint16[Wf+18]=Ud,this.uint16[Wf+19]=Bf,this.uint16[Wf+20]=Rf,this.uint16[Wf+21]=Ep,this.uint16[Wf+22]=Op,this.uint32[Gp+12]=yp,this.float32[Gp+13]=sp,this.float32[Gp+14]=cp,this.float32[Gp+15]=xp,this.float32[Gp+16]=gp,p}}my.prototype.bytesPerElement=68,tp("StructArrayLayout8i15ui1ul4f68",my);class g0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p){const S=this.length;return this.resize(S+1),this.emplace(S,p)}emplace(p,S){return this.float32[1*p+0]=S,p}}g0.prototype.bytesPerElement=4,tp("StructArrayLayout1f4",g0);class L0 extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S,j){const ut=this.length;return this.resize(ut+1),this.emplace(ut,p,S,j)}emplace(p,S,j,ut){const Ot=4*p;return this.uint32[2*p+0]=S,this.uint16[Ot+2]=j,this.uint16[Ot+3]=ut,p}}L0.prototype.bytesPerElement=8,tp("StructArrayLayout1ul2ui8",L0);class bv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p,S){const j=this.length;return this.resize(j+1),this.emplace(j,p,S)}emplace(p,S,j){const ut=2*p;return this.uint16[ut+0]=S,this.uint16[ut+1]=j,p}}bv.prototype.bytesPerElement=4,tp("StructArrayLayout2ui4",bv);class wv extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(p){const S=this.length;return this.resize(S+1),this.emplace(S,p)}emplace(p,S){return this.uint16[1*p+0]=S,p}}wv.prototype.bytesPerElement=2,tp("StructArrayLayout1ui2",wv);class Ev extends wm{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(p,S,j,ut){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,p,S,j,ut)}emplace(p,S,j,ut,Ot){const fi=4*p;return this.float32[fi+0]=S,this.float32[fi+1]=j,this.float32[fi+2]=ut,this.float32[fi+3]=Ot,p}}Ev.prototype.bytesPerElement=16,tp("StructArrayLayout4f16",Ev);class o1 extends hp{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new vd(this.anchorPointX,this.anchorPointY)}}o1.prototype.size=20;class Dy extends n1{get(p){return new o1(this,p)}}tp("CollisionBoxArray",Dy);class Sv extends hp{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(p){this._structArray.uint8[this._pos1+37]=p}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(p){this._structArray.uint8[this._pos1+38]=p}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(p){this._structArray.uint32[this._pos4+10]=p}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Sv.prototype.size=48;class Gv extends xv{get(p){return new Sv(this,p)}}tp("PlacedSymbolArray",Gv);class jv extends hp{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(p){this._structArray.uint32[this._pos4+12]=p}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}jv.prototype.size=68;class a1 extends my{get(p){return new jv(this,p)}}tp("SymbolInstanceArray",a1);class e0 extends g0{getoffsetX(p){return this.float32[1*p+0]}}tp("GlyphOffsetArray",e0);class iv extends mg{getx(p){return this.int16[3*p+0]}gety(p){return this.int16[3*p+1]}gettileUnitDistanceFromAnchor(p){return this.int16[3*p+2]}}tp("SymbolLineVertexArray",iv);class R0 extends hp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}R0.prototype.size=8;class jg extends L0{get(p){return new R0(this,p)}}tp("FeatureIndexArray",jg);class s1 extends Jy{}class rv extends Jy{}class Q1 extends Jy{}class ex extends J0{}class B_ extends D0{}class T1 extends p0{}class _0 extends Uv{}class he extends Q0{}class g extends Qy{}class A extends ev{}class X extends Vv{}class _e extends vv{}class Ft extends tv{}class Xr extends bv{}const as=pg([{name:"a_pos",components:2,type:"Int16"}],4),{members:cs}=as;class us{constructor(p=[]){this.segments=p}prepareSegment(p,S,j,ut){let Ot=this.segments[this.segments.length-1];return p>us.MAX_VERTEX_ARRAY_LENGTH&&rl(`Max vertices per segment is ${us.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${p}`),(!Ot||Ot.vertexLength+p>us.MAX_VERTEX_ARRAY_LENGTH||Ot.sortKey!==ut)&&(Ot={vertexOffset:S.length,primitiveOffset:j.length,vertexLength:0,primitiveLength:0},ut!==void 0&&(Ot.sortKey=ut),this.segments.push(Ot)),Ot}get(){return this.segments}destroy(){for(const p of this.segments)for(const S in p.vaos)p.vaos[S].destroy()}static simpleSegment(p,S,j,ut){return new us([{vertexOffset:p,primitiveOffset:S,vertexLength:j,primitiveLength:ut,vaos:{},sortKey:0}])}}function th(_,p){return 256*(_=nt(Math.floor(_),0,255))+nt(Math.floor(p),0,255)}us.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tp("SegmentVector",us);const eh=pg([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ph={},Rh={get exports(){return ph},set exports(_){ph=_}},Bh={};({get exports(){return Bh},set exports(_){Bh=_}}).exports=function(_,p){var S,j,ut,Ot,fi,kn,ss,ul;for(j=_.length-(S=3&_.length),ut=p,fi=3432918353,kn=461845907,ul=0;ul<j;)ss=255&_.charCodeAt(ul)|(255&_.charCodeAt(++ul))<<8|(255&_.charCodeAt(++ul))<<16|(255&_.charCodeAt(++ul))<<24,++ul,ut=27492+(65535&(Ot=5*(65535&(ut=(ut^=ss=(65535&(ss=(ss=(65535&ss)*fi+(((ss>>>16)*fi&65535)<<16)&4294967295)<<15|ss>>>17))*kn+(((ss>>>16)*kn&65535)<<16)&4294967295)<<13|ut>>>19))+((5*(ut>>>16)&65535)<<16)&4294967295))+((58964+(Ot>>>16)&65535)<<16);switch(ss=0,S){case 3:ss^=(255&_.charCodeAt(ul+2))<<16;case 2:ss^=(255&_.charCodeAt(ul+1))<<8;case 1:ut^=ss=(65535&(ss=(ss=(65535&(ss^=255&_.charCodeAt(ul)))*fi+(((ss>>>16)*fi&65535)<<16)&4294967295)<<15|ss>>>17))*kn+(((ss>>>16)*kn&65535)<<16)&4294967295}return ut^=_.length,ut=2246822507*(65535&(ut^=ut>>>16))+((2246822507*(ut>>>16)&65535)<<16)&4294967295,ut=3266489909*(65535&(ut^=ut>>>13))+((3266489909*(ut>>>16)&65535)<<16)&4294967295,(ut^=ut>>>16)>>>0};var Ch={};({get exports(){return Ch},set exports(_){Ch=_}}).exports=function(_,p){for(var S,j=_.length,ut=p^j,Ot=0;j>=4;)S=1540483477*(65535&(S=255&_.charCodeAt(Ot)|(255&_.charCodeAt(++Ot))<<8|(255&_.charCodeAt(++Ot))<<16|(255&_.charCodeAt(++Ot))<<24))+((1540483477*(S>>>16)&65535)<<16),ut=1540483477*(65535&ut)+((1540483477*(ut>>>16)&65535)<<16)^(S=1540483477*(65535&(S^=S>>>24))+((1540483477*(S>>>16)&65535)<<16)),j-=4,++Ot;switch(j){case 3:ut^=(255&_.charCodeAt(Ot+2))<<16;case 2:ut^=(255&_.charCodeAt(Ot+1))<<8;case 1:ut=1540483477*(65535&(ut^=255&_.charCodeAt(Ot)))+((1540483477*(ut>>>16)&65535)<<16)}return ut=1540483477*(65535&(ut^=ut>>>13))+((1540483477*(ut>>>16)&65535)<<16),(ut^=ut>>>15)>>>0};var ed=Bh,Ed=Ch;Rh.exports=ed,ph.murmur3=ed,ph.murmur2=Ed;class _d{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(p,S,j,ut){this.ids.push(qh(p)),this.positions.push(S,j,ut)}getPositions(p){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const S=qh(p);let j=0,ut=this.ids.length-1;for(;j<ut;){const fi=j+ut>>1;this.ids[fi]>=S?ut=fi:j=fi+1}const Ot=[];for(;this.ids[j]===S;)Ot.push({index:this.positions[3*j],start:this.positions[3*j+1],end:this.positions[3*j+2]}),j++;return Ot}static serialize(p,S){const j=new Float64Array(p.ids),ut=new Uint32Array(p.positions);return Md(j,ut,0,j.length-1),S&&S.push(j.buffer,ut.buffer),{ids:j,positions:ut}}static deserialize(p){const S=new _d;return S.ids=p.ids,S.positions=p.positions,S.indexed=!0,S}}function qh(_){const p=+_;return!isNaN(p)&&p<=Number.MAX_SAFE_INTEGER?p:ph(String(_))}function Md(_,p,S,j){for(;S<j;){const ut=_[S+j>>1];let Ot=S-1,fi=j+1;for(;;){do Ot++;while(_[Ot]<ut);do fi--;while(_[fi]>ut);if(Ot>=fi)break;Nd(_,Ot,fi),Nd(p,3*Ot,3*fi),Nd(p,3*Ot+1,3*fi+1),Nd(p,3*Ot+2,3*fi+2)}fi-S<j-fi?(Md(_,p,S,fi),S=fi+1):(Md(_,p,fi+1,j),j=fi)}}function Nd(_,p,S){const j=_[p];_[p]=_[S],_[S]=j}tp("FeaturePositionMap",_d);class L{constructor(p,S){this.gl=p.gl,this.location=S}}class u extends L{constructor(p,S){super(p,S),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class E extends L{constructor(p,S){super(p,S),this.current=[0,0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))}}class B extends L{constructor(p,S){super(p,S),this.current=ih.transparent}set(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))}}const Y=new Float32Array(16);function vt(_){return[th(255*_.r,255*_.g),th(255*_.b,255*_.a)]}class mr{constructor(p,S,j){this.value=p,this.uniformNames=S.map(ut=>`u_${ut}`),this.type=j}setUniform(p,S,j){p.set(j.constantOr(this.value))}getBinding(p,S,j){return this.type==="color"?new B(p,S):new u(p,S)}}class Ur{constructor(p,S){this.uniformNames=S.map(j=>`u_${j}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(p,S){this.pixelRatioFrom=S.pixelRatio,this.pixelRatioTo=p.pixelRatio,this.patternFrom=S.tlbr,this.patternTo=p.tlbr}setUniform(p,S,j,ut){const Ot=ut==="u_pattern_to"?this.patternTo:ut==="u_pattern_from"?this.patternFrom:ut==="u_pixel_ratio_to"?this.pixelRatioTo:ut==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Ot&&p.set(Ot)}getBinding(p,S,j){return j.substr(0,9)==="u_pattern"?new E(p,S):new u(p,S)}}class Gn{constructor(p,S,j,ut){this.expression=p,this.type=j,this.maxValue=0,this.paintVertexAttributes=S.map(Ot=>({name:`a_${Ot}`,type:"Float32",components:j==="color"?2:1,offset:0})),this.paintVertexArray=new ut}populatePaintArray(p,S,j,ut,Ot){const fi=this.paintVertexArray.length,kn=this.expression.evaluate(new ym(0),S,{},ut,[],Ot);this.paintVertexArray.resize(p),this._setPaintValue(fi,p,kn)}updatePaintArray(p,S,j,ut){const Ot=this.expression.evaluate({zoom:0},j,ut);this._setPaintValue(p,S,Ot)}_setPaintValue(p,S,j){if(this.type==="color"){const ut=vt(j);for(let Ot=p;Ot<S;Ot++)this.paintVertexArray.emplace(Ot,ut[0],ut[1])}else{for(let ut=p;ut<S;ut++)this.paintVertexArray.emplace(ut,j);this.maxValue=Math.max(this.maxValue,Math.abs(j))}}upload(p){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=p.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class $s{constructor(p,S,j,ut,Ot,fi){this.expression=p,this.uniformNames=S.map(kn=>`u_${kn}_t`),this.type=j,this.useIntegerZoom=ut,this.zoom=Ot,this.maxValue=0,this.paintVertexAttributes=S.map(kn=>({name:`a_${kn}`,type:"Float32",components:j==="color"?4:2,offset:0})),this.paintVertexArray=new fi}populatePaintArray(p,S,j,ut,Ot){const fi=this.expression.evaluate(new ym(this.zoom),S,{},ut,[],Ot),kn=this.expression.evaluate(new ym(this.zoom+1),S,{},ut,[],Ot),ss=this.paintVertexArray.length;this.paintVertexArray.resize(p),this._setPaintValue(ss,p,fi,kn)}updatePaintArray(p,S,j,ut){const Ot=this.expression.evaluate({zoom:this.zoom},j,ut),fi=this.expression.evaluate({zoom:this.zoom+1},j,ut);this._setPaintValue(p,S,Ot,fi)}_setPaintValue(p,S,j,ut){if(this.type==="color"){const Ot=vt(j),fi=vt(ut);for(let kn=p;kn<S;kn++)this.paintVertexArray.emplace(kn,Ot[0],Ot[1],fi[0],fi[1])}else{for(let Ot=p;Ot<S;Ot++)this.paintVertexArray.emplace(Ot,j,ut);this.maxValue=Math.max(this.maxValue,Math.abs(j),Math.abs(ut))}}upload(p){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=p.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(p,S){const j=this.useIntegerZoom?Math.floor(S.zoom):S.zoom,ut=nt(this.expression.interpolationFactor(j,this.zoom,this.zoom+1),0,1);p.set(ut)}getBinding(p,S,j){return new u(p,S)}}class el{constructor(p,S,j,ut,Ot,fi){this.expression=p,this.type=S,this.useIntegerZoom=j,this.zoom=ut,this.layerId=fi,this.zoomInPaintVertexArray=new Ot,this.zoomOutPaintVertexArray=new Ot}populatePaintArray(p,S,j){const ut=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(p),this.zoomOutPaintVertexArray.resize(p),this._setPaintValues(ut,p,S.patterns&&S.patterns[this.layerId],j)}updatePaintArray(p,S,j,ut,Ot){this._setPaintValues(p,S,j.patterns&&j.patterns[this.layerId],Ot)}_setPaintValues(p,S,j,ut){if(!ut||!j)return;const{min:Ot,mid:fi,max:kn}=j,ss=ut[Ot],ul=ut[fi],Ju=ut[kn];if(ss&&ul&&Ju)for(let nh=p;nh<S;nh++)this.zoomInPaintVertexArray.emplace(nh,ul.tl[0],ul.tl[1],ul.br[0],ul.br[1],ss.tl[0],ss.tl[1],ss.br[0],ss.br[1],ul.pixelRatio,ss.pixelRatio),this.zoomOutPaintVertexArray.emplace(nh,ul.tl[0],ul.tl[1],ul.br[0],ul.br[1],Ju.tl[0],Ju.tl[1],Ju.br[0],Ju.br[1],ul.pixelRatio,Ju.pixelRatio)}upload(p){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=p.createVertexBuffer(this.zoomInPaintVertexArray,eh.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=p.createVertexBuffer(this.zoomOutPaintVertexArray,eh.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wu{constructor(p,S,j){this.binders={},this._buffers=[];const ut=[];for(const Ot in p.paint._values){if(!j(Ot))continue;const fi=p.paint.get(Ot);if(!(fi instanceof b_&&j_(fi.property.specification)))continue;const kn=gh(Ot,p.type),ss=fi.value,ul=fi.property.specification.type,Ju=fi.property.useIntegerZoom,nh=fi.property.specification["property-type"],mh=nh==="cross-faded"||nh==="cross-faded-data-driven";if(ss.kind==="constant")this.binders[Ot]=mh?new Ur(ss.value,kn):new mr(ss.value,kn,ul),ut.push(`/u_${Ot}`);else if(ss.kind==="source"||mh){const _h=Eh(Ot,ul,"source");this.binders[Ot]=mh?new el(ss,ul,Ju,S,_h,p.id):new Gn(ss,kn,ul,_h),ut.push(`/a_${Ot}`)}else{const _h=Eh(Ot,ul,"composite");this.binders[Ot]=new $s(ss,kn,ul,Ju,S,_h),ut.push(`/z_${Ot}`)}}this.cacheKey=ut.sort().join("")}getMaxValue(p){const S=this.binders[p];return S instanceof Gn||S instanceof $s?S.maxValue:0}populatePaintArrays(p,S,j,ut,Ot){for(const fi in this.binders){const kn=this.binders[fi];(kn instanceof Gn||kn instanceof $s||kn instanceof el)&&kn.populatePaintArray(p,S,j,ut,Ot)}}setConstantPatternPositions(p,S){for(const j in this.binders){const ut=this.binders[j];ut instanceof Ur&&ut.setConstantPatternPositions(p,S)}}updatePaintArrays(p,S,j,ut,Ot){let fi=!1;for(const kn in p){const ss=S.getPositions(kn);for(const ul of ss){const Ju=j.feature(ul.index);for(const nh in this.binders){const mh=this.binders[nh];if((mh instanceof Gn||mh instanceof $s||mh instanceof el)&&mh.expression.isStateDependent===!0){const _h=ut.paint.get(nh);mh.expression=_h.value,mh.updatePaintArray(ul.start,ul.end,Ju,p[kn],Ot),fi=!0}}}}return fi}defines(){const p=[];for(const S in this.binders){const j=this.binders[S];(j instanceof mr||j instanceof Ur)&&p.push(...j.uniformNames.map(ut=>`#define HAS_UNIFORM_${ut}`))}return p}getBinderAttributes(){const p=[];for(const S in this.binders){const j=this.binders[S];if(j instanceof Gn||j instanceof $s)for(let ut=0;ut<j.paintVertexAttributes.length;ut++)p.push(j.paintVertexAttributes[ut].name);else if(j instanceof el)for(let ut=0;ut<eh.members.length;ut++)p.push(eh.members[ut].name)}return p}getBinderUniforms(){const p=[];for(const S in this.binders){const j=this.binders[S];if(j instanceof mr||j instanceof Ur||j instanceof $s)for(const ut of j.uniformNames)p.push(ut)}return p}getPaintVertexBuffers(){return this._buffers}getUniforms(p,S){const j=[];for(const ut in this.binders){const Ot=this.binders[ut];if(Ot instanceof mr||Ot instanceof Ur||Ot instanceof $s){for(const fi of Ot.uniformNames)if(S[fi]){const kn=Ot.getBinding(p,S[fi],fi);j.push({name:fi,property:ut,binding:kn})}}}return j}setUniforms(p,S,j,ut){for(const{name:Ot,property:fi,binding:kn}of S)this.binders[fi].setUniform(kn,ut,j.get(fi),Ot)}updatePaintBuffers(p){this._buffers=[];for(const S in this.binders){const j=this.binders[S];if(p&&j instanceof el){const ut=p.fromScale===2?j.zoomInPaintVertexBuffer:j.zoomOutPaintVertexBuffer;ut&&this._buffers.push(ut)}else(j instanceof Gn||j instanceof $s)&&j.paintVertexBuffer&&this._buffers.push(j.paintVertexBuffer)}}upload(p){for(const S in this.binders){const j=this.binders[S];(j instanceof Gn||j instanceof $s||j instanceof el)&&j.upload(p)}this.updatePaintBuffers()}destroy(){for(const p in this.binders){const S=this.binders[p];(S instanceof Gn||S instanceof $s||S instanceof el)&&S.destroy()}}}class dh{constructor(p,S,j=()=>!0){this.programConfigurations={};for(const ut of p)this.programConfigurations[ut.id]=new Wu(ut,S,j);this.needsUpload=!1,this._featureMap=new _d,this._bufferOffset=0}populatePaintArrays(p,S,j,ut,Ot,fi){for(const kn in this.programConfigurations)this.programConfigurations[kn].populatePaintArrays(p,S,ut,Ot,fi);S.id!==void 0&&this._featureMap.add(S.id,j,this._bufferOffset,p),this._bufferOffset=p,this.needsUpload=!0}updatePaintArrays(p,S,j,ut){for(const Ot of j)this.needsUpload=this.programConfigurations[Ot.id].updatePaintArrays(p,this._featureMap,S,Ot,ut)||this.needsUpload}get(p){return this.programConfigurations[p]}upload(p){if(this.needsUpload){for(const S in this.programConfigurations)this.programConfigurations[S].upload(p);this.needsUpload=!1}}destroy(){for(const p in this.programConfigurations)this.programConfigurations[p].destroy()}}function gh(_,p){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[_]||[_.replace(`${p}-`,"").replace(/-/g,"_")]}function Eh(_,p,S){const j={color:{source:p0,composite:Ev},number:{source:g0,composite:p0}},ut=function(Ot){return{"line-pattern":{source:_0,composite:_0},"fill-pattern":{source:_0,composite:_0},"fill-extrusion-pattern":{source:_0,composite:_0}}[Ot]}(_);return ut&&ut[S]||j[p][S]}tp("ConstantBinder",mr),tp("CrossFadedConstantBinder",Ur),tp("SourceExpressionBinder",Gn),tp("CrossFadedCompositeBinder",el),tp("CompositeExpressionBinder",$s),tp("ProgramConfiguration",Wu,{omit:["_buffers"]}),tp("ProgramConfigurationSet",dh);var yh=8192;const Ih=Math.pow(2,14)-1,Qu=-Ih-1;function bh(_){const p=yh/_.extent,S=_.loadGeometry();for(let j=0;j<S.length;j++){const ut=S[j];for(let Ot=0;Ot<ut.length;Ot++){const fi=ut[Ot],kn=Math.round(fi.x*p),ss=Math.round(fi.y*p);fi.x=nt(kn,Qu,Ih),fi.y=nt(ss,Qu,Ih),(kn<fi.x||kn>fi.x+1||ss<fi.y||ss>fi.y+1)&&rl("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return S}function kh(_,p){return{type:_.type,id:_.id,properties:_.properties,geometry:p?bh(_):[]}}function Oh(_,p,S,j,ut){_.emplaceBack(2*p+(j+1)/2,2*S+(ut+1)/2)}class rd{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.layoutVertexArray=new rv,this.indexArray=new Ft,this.segments=new us,this.programConfigurations=new dh(p.layers,p.zoom),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){const ut=this.layers[0],Ot=[];let fi=null,kn=!1;ut.type==="circle"&&(fi=ut.layout.get("circle-sort-key"),kn=!fi.isConstant());for(const{feature:ss,id:ul,index:Ju,sourceLayerIndex:nh}of p){const mh=this.layers[0]._featureFilter.needGeometry,_h=kh(ss,mh);if(!this.layers[0]._featureFilter.filter(new ym(this.zoom),_h,j))continue;const wh=kn?fi.evaluate(_h,{},j):void 0,Jh={id:ul,properties:ss.properties,type:ss.type,sourceLayerIndex:nh,index:Ju,geometry:mh?_h.geometry:bh(ss),patterns:{},sortKey:wh};Ot.push(Jh)}kn&&Ot.sort((ss,ul)=>ss.sortKey-ul.sortKey);for(const ss of Ot){const{geometry:ul,index:Ju,sourceLayerIndex:nh}=ss,mh=p[Ju].feature;this.addFeature(ss,ul,Ju,j),S.featureIndex.insert(mh,ul,Ju,nh,this.index)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,cs),this.indexBuffer=p.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(p,S,j,ut){for(const Ot of S)for(const fi of Ot){const kn=fi.x,ss=fi.y;if(kn<0||kn>=yh||ss<0||ss>=yh)continue;const ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,p.sortKey),Ju=ul.vertexLength;Oh(this.layoutVertexArray,kn,ss,-1,-1),Oh(this.layoutVertexArray,kn,ss,1,-1),Oh(this.layoutVertexArray,kn,ss,1,1),Oh(this.layoutVertexArray,kn,ss,-1,1),this.indexArray.emplaceBack(Ju,Ju+1,Ju+2),this.indexArray.emplaceBack(Ju,Ju+3,Ju+2),ul.vertexLength+=4,ul.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,{},ut)}}function sd(_,p){for(let S=0;S<_.length;S++)if(Lf(p,_[S]))return!0;for(let S=0;S<p.length;S++)if(Lf(_,p[S]))return!0;return!!md(_,p)}function ld(_,p,S){return!!Lf(_,p)||!!Td(p,_,S)}function dd(_,p){if(_.length===1)return Od(p,_[0]);for(let S=0;S<p.length;S++){const j=p[S];for(let ut=0;ut<j.length;ut++)if(Lf(_,j[ut]))return!0}for(let S=0;S<_.length;S++)if(Od(p,_[S]))return!0;for(let S=0;S<p.length;S++)if(md(_,p[S]))return!0;return!1}function ud(_,p,S){if(_.length>1){if(md(_,p))return!0;for(let j=0;j<p.length;j++)if(Td(p[j],_,S))return!0}for(let j=0;j<_.length;j++)if(Td(_[j],p,S))return!0;return!1}function md(_,p){if(_.length===0||p.length===0)return!1;for(let S=0;S<_.length-1;S++){const j=_[S],ut=_[S+1];for(let Ot=0;Ot<p.length-1;Ot++)if(Af(j,ut,p[Ot],p[Ot+1]))return!0}return!1}function Af(_,p,S,j){return ah(_,S,j)!==ah(p,S,j)&&ah(_,p,S)!==ah(_,p,j)}function Td(_,p,S){const j=S*S;if(p.length===1)return _.distSqr(p[0])<j;for(let ut=1;ut<p.length;ut++)if(Gd(_,p[ut-1],p[ut])<j)return!0;return!1}function Gd(_,p,S){const j=p.distSqr(S);if(j===0)return _.distSqr(p);const ut=((_.x-p.x)*(S.x-p.x)+(_.y-p.y)*(S.y-p.y))/j;return _.distSqr(ut<0?p:ut>1?S:S.sub(p)._mult(ut)._add(p))}function Od(_,p){let S,j,ut,Ot=!1;for(let fi=0;fi<_.length;fi++){S=_[fi];for(let kn=0,ss=S.length-1;kn<S.length;ss=kn++)j=S[kn],ut=S[ss],j.y>p.y!=ut.y>p.y&&p.x<(ut.x-j.x)*(p.y-j.y)/(ut.y-j.y)+j.x&&(Ot=!Ot)}return Ot}function Lf(_,p){let S=!1;for(let j=0,ut=_.length-1;j<_.length;ut=j++){const Ot=_[j],fi=_[ut];Ot.y>p.y!=fi.y>p.y&&p.x<(fi.x-Ot.x)*(p.y-Ot.y)/(fi.y-Ot.y)+Ot.x&&(S=!S)}return S}function Dd(_,p,S){const j=S[0],ut=S[2];if(_.x<j.x&&p.x<j.x||_.x>ut.x&&p.x>ut.x||_.y<j.y&&p.y<j.y||_.y>ut.y&&p.y>ut.y)return!1;const Ot=ah(_,p,S[0]);return Ot!==ah(_,p,S[1])||Ot!==ah(_,p,S[2])||Ot!==ah(_,p,S[3])}function yf(_,p,S){const j=p.paint.get(_).value;return j.kind==="constant"?j.value:S.programConfigurations.get(p.id).getMaxValue(_)}function zf(_){return Math.sqrt(_[0]*_[0]+_[1]*_[1])}function Pf(_,p,S,j,ut){if(!p[0]&&!p[1])return _;const Ot=vd.convert(p)._mult(ut);S==="viewport"&&Ot._rotate(-j);const fi=[];for(let kn=0;kn<_.length;kn++)fi.push(_[kn].sub(Ot));return fi}tp("CircleBucket",rd,{omit:["layers"]});const Vf=new Ng({"circle-sort-key":new jp(cd.layout_circle["circle-sort-key"])});var Lp={paint:new Ng({"circle-radius":new jp(cd.paint_circle["circle-radius"]),"circle-color":new jp(cd.paint_circle["circle-color"]),"circle-blur":new jp(cd.paint_circle["circle-blur"]),"circle-opacity":new jp(cd.paint_circle["circle-opacity"]),"circle-translate":new Pp(cd.paint_circle["circle-translate"]),"circle-translate-anchor":new Pp(cd.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pp(cd.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pp(cd.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jp(cd.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jp(cd.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jp(cd.paint_circle["circle-stroke-opacity"])}),layout:Vf},Mp=1e-6,fp=typeof Float32Array<"u"?Float32Array:Array;function Fp(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function cm(_,p,S){var j=p[0],ut=p[1],Ot=p[2],fi=p[3],kn=p[4],ss=p[5],ul=p[6],Ju=p[7],nh=p[8],mh=p[9],_h=p[10],wh=p[11],Jh=p[12],Hh=p[13],Id=p[14],jd=p[15],wd=S[0],Ud=S[1],Bf=S[2],Rf=S[3];return _[0]=wd*j+Ud*kn+Bf*nh+Rf*Jh,_[1]=wd*ut+Ud*ss+Bf*mh+Rf*Hh,_[2]=wd*Ot+Ud*ul+Bf*_h+Rf*Id,_[3]=wd*fi+Ud*Ju+Bf*wh+Rf*jd,_[4]=(wd=S[4])*j+(Ud=S[5])*kn+(Bf=S[6])*nh+(Rf=S[7])*Jh,_[5]=wd*ut+Ud*ss+Bf*mh+Rf*Hh,_[6]=wd*Ot+Ud*ul+Bf*_h+Rf*Id,_[7]=wd*fi+Ud*Ju+Bf*wh+Rf*jd,_[8]=(wd=S[8])*j+(Ud=S[9])*kn+(Bf=S[10])*nh+(Rf=S[11])*Jh,_[9]=wd*ut+Ud*ss+Bf*mh+Rf*Hh,_[10]=wd*Ot+Ud*ul+Bf*_h+Rf*Id,_[11]=wd*fi+Ud*Ju+Bf*wh+Rf*jd,_[12]=(wd=S[12])*j+(Ud=S[13])*kn+(Bf=S[14])*nh+(Rf=S[15])*Jh,_[13]=wd*ut+Ud*ss+Bf*mh+Rf*Hh,_[14]=wd*Ot+Ud*ul+Bf*_h+Rf*Id,_[15]=wd*fi+Ud*Ju+Bf*wh+Rf*jd,_}Math.hypot||(Math.hypot=function(){for(var _=0,p=arguments.length;p--;)_+=arguments[p]*arguments[p];return Math.sqrt(_)});var Jp,kp=cm;function _m(_,p,S){var j=p[0],ut=p[1],Ot=p[2],fi=p[3];return _[0]=S[0]*j+S[4]*ut+S[8]*Ot+S[12]*fi,_[1]=S[1]*j+S[5]*ut+S[9]*Ot+S[13]*fi,_[2]=S[2]*j+S[6]*ut+S[10]*Ot+S[14]*fi,_[3]=S[3]*j+S[7]*ut+S[11]*Ot+S[15]*fi,_}function Lm(_,p){const S=_m([],[_.x,_.y,0,1],p);return new vd(S[0]/S[3],S[1]/S[3])}Jp=new fp(4),fp!=Float32Array&&(Jp[0]=0,Jp[1]=0,Jp[2]=0,Jp[3]=0);class Rm extends rd{}tp("HeatmapBucket",Rm,{omit:["layers"]});var Vm={paint:new Ng({"heatmap-radius":new jp(cd.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jp(cd.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pp(cd.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yv(cd.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pp(cd.paint_heatmap["heatmap-opacity"])})};function i_(_,{width:p,height:S},j,ut){if(ut){if(ut instanceof Uint8ClampedArray)ut=new Uint8Array(ut.buffer);else if(ut.length!==p*S*j)throw new RangeError(`mismatched image size. expected: ${ut.length} but got: ${p*S*j}`)}else ut=new Uint8Array(p*S*j);return _.width=p,_.height=S,_.data=ut,_}function qg(_,{width:p,height:S},j){if(p===_.width&&S===_.height)return;const ut=i_({},{width:p,height:S},j);ey(_,ut,{x:0,y:0},{x:0,y:0},{width:Math.min(_.width,p),height:Math.min(_.height,S)},j),_.width=p,_.height=S,_.data=ut.data}function ey(_,p,S,j,ut,Ot){if(ut.width===0||ut.height===0)return p;if(ut.width>_.width||ut.height>_.height||S.x>_.width-ut.width||S.y>_.height-ut.height)throw new RangeError("out of range source coordinates for image copy");if(ut.width>p.width||ut.height>p.height||j.x>p.width-ut.width||j.y>p.height-ut.height)throw new RangeError("out of range destination coordinates for image copy");const fi=_.data,kn=p.data;if(fi===kn)throw new Error("srcData equals dstData, so image is already copied");for(let ss=0;ss<ut.height;ss++){const ul=((S.y+ss)*_.width+S.x)*Ot,Ju=((j.y+ss)*p.width+j.x)*Ot;for(let nh=0;nh<ut.width*Ot;nh++)kn[Ju+nh]=fi[ul+nh]}return p}class ty{constructor(p,S){i_(this,p,1,S)}resize(p){qg(this,p,1)}clone(){return new ty({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(p,S,j,ut,Ot){ey(p,S,j,ut,Ot,1)}}class pm{constructor(p,S){i_(this,p,4,S)}resize(p){qg(this,p,4)}replace(p,S){S?this.data.set(p):this.data=p instanceof Uint8ClampedArray?new Uint8Array(p.buffer):p}clone(){return new pm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(p,S,j,ut,Ot){ey(p,S,j,ut,Ot,4)}}function Om(_){const p={},S=_.resolution||256,j=_.clips?_.clips.length:1,ut=_.image||new pm({width:S,height:j});if(Math.log(S)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${S}`);const Ot=(fi,kn,ss)=>{p[_.evaluationKey]=ss;const ul=_.expression.evaluate(p);ut.data[fi+kn+0]=Math.floor(255*ul.r/ul.a),ut.data[fi+kn+1]=Math.floor(255*ul.g/ul.a),ut.data[fi+kn+2]=Math.floor(255*ul.b/ul.a),ut.data[fi+kn+3]=Math.floor(255*ul.a)};if(_.clips)for(let fi=0,kn=0;fi<j;++fi,kn+=4*S)for(let ss=0,ul=0;ss<S;ss++,ul+=4){const Ju=ss/(S-1),{start:nh,end:mh}=_.clips[fi];Ot(kn,ul,nh*(1-Ju)+mh*Ju)}else for(let fi=0,kn=0;fi<S;fi++,kn+=4)Ot(0,kn,fi/(S-1));return ut}tp("AlphaImage",ty),tp("RGBAImage",pm);var vm={paint:new Ng({"hillshade-illumination-direction":new Pp(cd.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pp(cd.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pp(cd.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pp(cd.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pp(cd.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pp(cd.paint_hillshade["hillshade-accent-color"])})};const kg=pg([{name:"a_pos",components:2,type:"Int16"}],4),{members:N_}=kg;var $m={};function u_(_,p,S){S=S||2;var j,ut,Ot,fi,kn,ss,ul,Ju=p&&p.length,nh=Ju?p[0]*S:_.length,mh=l1(_,0,nh,S,!0),_h=[];if(!mh||mh.next===mh.prev)return _h;if(Ju&&(mh=function(Jh,Hh,Id,jd){var wd,Ud,Bf,Rf=[];for(wd=0,Ud=Hh.length;wd<Ud;wd++)(Bf=l1(Jh,Hh[wd]*jd,wd<Ud-1?Hh[wd+1]*jd:Jh.length,jd,!1))===Bf.next&&(Bf.steiner=!0),Rf.push(Yw(Bf));for(Rf.sort(c1),wd=0;wd<Rf.length;wd++)Id=tx(Rf[wd],Id);return Id}(_,p,mh,S)),_.length>80*S){j=Ot=_[0],ut=fi=_[1];for(var wh=S;wh<nh;wh+=S)(kn=_[wh])<j&&(j=kn),(ss=_[wh+1])<ut&&(ut=ss),kn>Ot&&(Ot=kn),ss>fi&&(fi=ss);ul=(ul=Math.max(Ot-j,fi-ut))!==0?32767/ul:0}return O0(mh,_h,S,j,ut,ul,0),_h}function l1(_,p,S,j,ut){var Ot,fi;if(ut===nx(_,p,S,j)>0)for(Ot=p;Ot<S;Ot+=j)fi=nw(Ot,_[Ot],_[Ot+1],fi);else for(Ot=S-j;Ot>=p;Ot-=j)fi=nw(Ot,_[Ot],_[Ot+1],fi);return fi&&C1(fi,fi.next)&&(rx(fi),fi=fi.next),fi}function gy(_,p){if(!_)return _;p||(p=_);var S,j=_;do if(S=!1,j.steiner||!C1(j,j.next)&&wg(j.prev,j,j.next)!==0)j=j.next;else{if(rx(j),(j=p=j.prev)===j.next)break;S=!0}while(S||j!==p);return p}function O0(_,p,S,j,ut,Ot,fi){if(_){!fi&&Ot&&function(Ju,nh,mh,_h){var wh=Ju;do wh.z===0&&(wh.z=Ax(wh.x,wh.y,nh,mh,_h)),wh.prevZ=wh.prev,wh.nextZ=wh.next,wh=wh.next;while(wh!==Ju);wh.prevZ.nextZ=null,wh.prevZ=null,function(Jh){var Hh,Id,jd,wd,Ud,Bf,Rf,Ep,Op=1;do{for(Id=Jh,Jh=null,Ud=null,Bf=0;Id;){for(Bf++,jd=Id,Rf=0,Hh=0;Hh<Op&&(Rf++,jd=jd.nextZ);Hh++);for(Ep=Op;Rf>0||Ep>0&&jd;)Rf!==0&&(Ep===0||!jd||Id.z<=jd.z)?(wd=Id,Id=Id.nextZ,Rf--):(wd=jd,jd=jd.nextZ,Ep--),Ud?Ud.nextZ=wd:Jh=wd,wd.prevZ=Ud,Ud=wd;Id=jd}Ud.nextZ=null,Op*=2}while(Bf>1)}(wh)}(_,j,ut,Ot);for(var kn,ss,ul=_;_.prev!==_.next;)if(kn=_.prev,ss=_.next,Ot?nv(_,j,ut,Ot):$0(_))p.push(kn.i/S|0),p.push(_.i/S|0),p.push(ss.i/S|0),rx(_),_=ss.next,ul=ss.next;else if((_=ss)===ul){fi?fi===1?O0(_=Tv(gy(_),p,S),p,S,j,ut,Ot,2):fi===2&&I1(_,p,S,j,ut,Ot):O0(gy(_),p,S,j,ut,Ot,1);break}}}function $0(_){var p=_.prev,S=_,j=_.next;if(wg(p,S,j)>=0)return!1;for(var ut=p.x,Ot=S.x,fi=j.x,kn=p.y,ss=S.y,ul=j.y,Ju=ut<Ot?ut<fi?ut:fi:Ot<fi?Ot:fi,nh=kn<ss?kn<ul?kn:ul:ss<ul?ss:ul,mh=ut>Ot?ut>fi?ut:fi:Ot>fi?Ot:fi,_h=kn>ss?kn>ul?kn:ul:ss>ul?ss:ul,wh=j.next;wh!==p;){if(wh.x>=Ju&&wh.x<=mh&&wh.y>=nh&&wh.y<=_h&&qv(ut,kn,Ot,ss,fi,ul,wh.x,wh.y)&&wg(wh.prev,wh,wh.next)>=0)return!1;wh=wh.next}return!0}function nv(_,p,S,j){var ut=_.prev,Ot=_,fi=_.next;if(wg(ut,Ot,fi)>=0)return!1;for(var kn=ut.x,ss=Ot.x,ul=fi.x,Ju=ut.y,nh=Ot.y,mh=fi.y,_h=kn<ss?kn<ul?kn:ul:ss<ul?ss:ul,wh=Ju<nh?Ju<mh?Ju:mh:nh<mh?nh:mh,Jh=kn>ss?kn>ul?kn:ul:ss>ul?ss:ul,Hh=Ju>nh?Ju>mh?Ju:mh:nh>mh?nh:mh,Id=Ax(_h,wh,p,S,j),jd=Ax(Jh,Hh,p,S,j),wd=_.prevZ,Ud=_.nextZ;wd&&wd.z>=Id&&Ud&&Ud.z<=jd;){if(wd.x>=_h&&wd.x<=Jh&&wd.y>=wh&&wd.y<=Hh&&wd!==ut&&wd!==fi&&qv(kn,Ju,ss,nh,ul,mh,wd.x,wd.y)&&wg(wd.prev,wd,wd.next)>=0||(wd=wd.prevZ,Ud.x>=_h&&Ud.x<=Jh&&Ud.y>=wh&&Ud.y<=Hh&&Ud!==ut&&Ud!==fi&&qv(kn,Ju,ss,nh,ul,mh,Ud.x,Ud.y)&&wg(Ud.prev,Ud,Ud.next)>=0))return!1;Ud=Ud.nextZ}for(;wd&&wd.z>=Id;){if(wd.x>=_h&&wd.x<=Jh&&wd.y>=wh&&wd.y<=Hh&&wd!==ut&&wd!==fi&&qv(kn,Ju,ss,nh,ul,mh,wd.x,wd.y)&&wg(wd.prev,wd,wd.next)>=0)return!1;wd=wd.prevZ}for(;Ud&&Ud.z<=jd;){if(Ud.x>=_h&&Ud.x<=Jh&&Ud.y>=wh&&Ud.y<=Hh&&Ud!==ut&&Ud!==fi&&qv(kn,Ju,ss,nh,ul,mh,Ud.x,Ud.y)&&wg(Ud.prev,Ud,Ud.next)>=0)return!1;Ud=Ud.nextZ}return!0}function Tv(_,p,S){var j=_;do{var ut=j.prev,Ot=j.next.next;!C1(ut,Ot)&&ix(ut,j,j.next,Ot)&&M1(ut,Ot)&&M1(Ot,ut)&&(p.push(ut.i/S|0),p.push(j.i/S|0),p.push(Ot.i/S|0),rx(j),rx(j.next),j=_=Ot),j=j.next}while(j!==_);return gy(j)}function I1(_,p,S,j,ut,Ot){var fi=_;do{for(var kn=fi.next.next;kn!==fi.prev;){if(fi.i!==kn.i&&Px(fi,kn)){var ss=cb(fi,kn);return fi=gy(fi,fi.next),ss=gy(ss,ss.next),O0(fi,p,S,j,ut,Ot,0),void O0(ss,p,S,j,ut,Ot,0)}kn=kn.next}fi=fi.next}while(fi!==_)}function c1(_,p){return _.x-p.x}function tx(_,p){var S=function(ut,Ot){var fi,kn=Ot,ss=ut.x,ul=ut.y,Ju=-1/0;do{if(ul<=kn.y&&ul>=kn.next.y&&kn.next.y!==kn.y){var nh=kn.x+(ul-kn.y)*(kn.next.x-kn.x)/(kn.next.y-kn.y);if(nh<=ss&&nh>Ju&&(Ju=nh,fi=kn.x<kn.next.x?kn:kn.next,nh===ss))return fi}kn=kn.next}while(kn!==Ot);if(!fi)return null;var mh,_h=fi,wh=fi.x,Jh=fi.y,Hh=1/0;kn=fi;do ss>=kn.x&&kn.x>=wh&&ss!==kn.x&&qv(ul<Jh?ss:Ju,ul,wh,Jh,ul<Jh?Ju:ss,ul,kn.x,kn.y)&&(mh=Math.abs(ul-kn.y)/(ss-kn.x),M1(kn,ut)&&(mh<Hh||mh===Hh&&(kn.x>fi.x||kn.x===fi.x&&rw(fi,kn)))&&(fi=kn,Hh=mh)),kn=kn.next;while(kn!==_h);return fi}(_,p);if(!S)return p;var j=cb(S,_);return gy(j,j.next),gy(S,S.next)}function rw(_,p){return wg(_.prev,_,p.prev)<0&&wg(p.next,_,_.next)<0}function Ax(_,p,S,j,ut){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-S)*ut|0)|_<<8))|_<<4))|_<<2))|_<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-j)*ut|0)|p<<8))|p<<4))|p<<2))|p<<1))<<1}function Yw(_){var p=_,S=_;do(p.x<S.x||p.x===S.x&&p.y<S.y)&&(S=p),p=p.next;while(p!==_);return S}function qv(_,p,S,j,ut,Ot,fi,kn){return(ut-fi)*(p-kn)>=(_-fi)*(Ot-kn)&&(_-fi)*(j-kn)>=(S-fi)*(p-kn)&&(S-fi)*(Ot-kn)>=(ut-fi)*(j-kn)}function Px(_,p){return _.next.i!==p.i&&_.prev.i!==p.i&&!function(S,j){var ut=S;do{if(ut.i!==S.i&&ut.next.i!==S.i&&ut.i!==j.i&&ut.next.i!==j.i&&ix(ut,ut.next,S,j))return!0;ut=ut.next}while(ut!==S);return!1}(_,p)&&(M1(_,p)&&M1(p,_)&&function(S,j){var ut=S,Ot=!1,fi=(S.x+j.x)/2,kn=(S.y+j.y)/2;do ut.y>kn!=ut.next.y>kn&&ut.next.y!==ut.y&&fi<(ut.next.x-ut.x)*(kn-ut.y)/(ut.next.y-ut.y)+ut.x&&(Ot=!Ot),ut=ut.next;while(ut!==S);return Ot}(_,p)&&(wg(_.prev,_,p.prev)||wg(_,p.prev,p))||C1(_,p)&&wg(_.prev,_,_.next)>0&&wg(p.prev,p,p.next)>0)}function wg(_,p,S){return(p.y-_.y)*(S.x-p.x)-(p.x-_.x)*(S.y-p.y)}function C1(_,p){return _.x===p.x&&_.y===p.y}function ix(_,p,S,j){var ut=u1(wg(_,p,S)),Ot=u1(wg(_,p,j)),fi=u1(wg(S,j,_)),kn=u1(wg(S,j,p));return ut!==Ot&&fi!==kn||!(ut!==0||!y0(_,S,p))||!(Ot!==0||!y0(_,j,p))||!(fi!==0||!y0(S,_,j))||!(kn!==0||!y0(S,p,j))}function y0(_,p,S){return p.x<=Math.max(_.x,S.x)&&p.x>=Math.min(_.x,S.x)&&p.y<=Math.max(_.y,S.y)&&p.y>=Math.min(_.y,S.y)}function u1(_){return _>0?1:_<0?-1:0}function M1(_,p){return wg(_.prev,_,_.next)<0?wg(_,p,_.next)>=0&&wg(_,_.prev,p)>=0:wg(_,p,_.prev)<0||wg(_,_.next,p)<0}function cb(_,p){var S=new ub(_.i,_.x,_.y),j=new ub(p.i,p.x,p.y),ut=_.next,Ot=p.prev;return _.next=p,p.prev=_,S.next=ut,ut.prev=S,j.next=S,S.prev=j,Ot.next=j,j.prev=Ot,j}function nw(_,p,S,j){var ut=new ub(_,p,S);return j?(ut.next=j.next,ut.prev=j,j.next.prev=ut,j.next=ut):(ut.prev=ut,ut.next=ut),ut}function rx(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function ub(_,p,S){this.i=_,this.x=p,this.y=S,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nx(_,p,S,j){for(var ut=0,Ot=p,fi=S-j;Ot<S;Ot+=j)ut+=(_[fi]-_[Ot])*(_[Ot+1]+_[fi+1]),fi=Ot;return ut}function ox(_,p,S,j,ut){h1(_,p,S||0,j||_.length-1,ut||B0)}function h1(_,p,S,j,ut){for(;j>S;){if(j-S>600){var Ot=j-S+1,fi=p-S+1,kn=Math.log(Ot),ss=.5*Math.exp(2*kn/3),ul=.5*Math.sqrt(kn*ss*(Ot-ss)/Ot)*(fi-Ot/2<0?-1:1);h1(_,p,Math.max(S,Math.floor(p-fi*ss/Ot+ul)),Math.min(j,Math.floor(p+(Ot-fi)*ss/Ot+ul)),ut)}var Ju=_[p],nh=S,mh=j;for(t0(_,S,p),ut(_[j],Ju)>0&&t0(_,S,j);nh<mh;){for(t0(_,nh,mh),nh++,mh--;ut(_[nh],Ju)<0;)nh++;for(;ut(_[mh],Ju)>0;)mh--}ut(_[S],Ju)===0?t0(_,S,mh):t0(_,++mh,j),mh<=p&&(S=mh+1),p<=mh&&(j=mh-1)}}function t0(_,p,S){var j=_[p];_[p]=_[S],_[S]=j}function B0(_,p){return _<p?-1:_>p?1:0}function ov(_,p){const S=_.length;if(S<=1)return[_];const j=[];let ut,Ot;for(let fi=0;fi<S;fi++){const kn=ch(_[fi]);kn!==0&&(_[fi].area=Math.abs(kn),Ot===void 0&&(Ot=kn<0),Ot===kn<0?(ut&&j.push(ut),ut=[_[fi]]):ut.push(_[fi]))}if(ut&&j.push(ut),p>1)for(let fi=0;fi<j.length;fi++)j[fi].length<=p||(ox(j[fi],p,1,j[fi].length-1,Zv),j[fi]=j[fi].slice(0,p));return j}function Zv(_,p){return p.area-_.area}function Iv(_,p,S){const j=S.patternDependencies;let ut=!1;for(const Ot of p){const fi=Ot.paint.get(`${_}-pattern`);fi.isConstant()||(ut=!0);const kn=fi.constantOr(null);kn&&(ut=!0,j[kn.to]=!0,j[kn.from]=!0)}return ut}function hb(_,p,S,j,ut){const Ot=ut.patternDependencies;for(const fi of p){const kn=fi.paint.get(`${_}-pattern`).value;if(kn.kind!=="constant"){let ss=kn.evaluate({zoom:j-1},S,{},ut.availableImages),ul=kn.evaluate({zoom:j},S,{},ut.availableImages),Ju=kn.evaluate({zoom:j+1},S,{},ut.availableImages);ss=ss&&ss.name?ss.name:ss,ul=ul&&ul.name?ul.name:ul,Ju=Ju&&Ju.name?Ju.name:Ju,Ot[ss]=!0,Ot[ul]=!0,Ot[Ju]=!0,S.patterns[fi.id]={min:ss,mid:ul,max:Ju}}}return S}({get exports(){return $m},set exports(_){$m=_}}).exports=u_,$m.default=u_,u_.deviation=function(_,p,S,j){var ut=p&&p.length,Ot=Math.abs(nx(_,0,ut?p[0]*S:_.length,S));if(ut)for(var fi=0,kn=p.length;fi<kn;fi++)Ot-=Math.abs(nx(_,p[fi]*S,fi<kn-1?p[fi+1]*S:_.length,S));var ss=0;for(fi=0;fi<j.length;fi+=3){var ul=j[fi]*S,Ju=j[fi+1]*S,nh=j[fi+2]*S;ss+=Math.abs((_[ul]-_[nh])*(_[Ju+1]-_[ul+1])-(_[ul]-_[Ju])*(_[nh+1]-_[ul+1]))}return Ot===0&&ss===0?0:Math.abs((ss-Ot)/Ot)},u_.flatten=function(_){for(var p=_[0][0].length,S={vertices:[],holes:[],dimensions:p},j=0,ut=0;ut<_.length;ut++){for(var Ot=0;Ot<_[ut].length;Ot++)for(var fi=0;fi<p;fi++)S.vertices.push(_[ut][Ot][fi]);ut>0&&S.holes.push(j+=_[ut-1].length)}return S};class db{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Q1,this.indexArray=new Ft,this.indexArray2=new Xr,this.programConfigurations=new dh(p.layers,p.zoom),this.segments=new us,this.segments2=new us,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){this.hasPattern=Iv("fill",this.layers,S);const ut=this.layers[0].layout.get("fill-sort-key"),Ot=!ut.isConstant(),fi=[];for(const{feature:kn,id:ss,index:ul,sourceLayerIndex:Ju}of p){const nh=this.layers[0]._featureFilter.needGeometry,mh=kh(kn,nh);if(!this.layers[0]._featureFilter.filter(new ym(this.zoom),mh,j))continue;const _h=Ot?ut.evaluate(mh,{},j,S.availableImages):void 0,wh={id:ss,properties:kn.properties,type:kn.type,sourceLayerIndex:Ju,index:ul,geometry:nh?mh.geometry:bh(kn),patterns:{},sortKey:_h};fi.push(wh)}Ot&&fi.sort((kn,ss)=>kn.sortKey-ss.sortKey);for(const kn of fi){const{geometry:ss,index:ul,sourceLayerIndex:Ju}=kn;if(this.hasPattern){const nh=hb("fill",this.layers,kn,this.zoom,S);this.patternFeatures.push(nh)}else this.addFeature(kn,ss,ul,j,{});S.featureIndex.insert(p[ul].feature,ss,ul,Ju,this.index)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}addFeatures(p,S,j){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,N_),this.indexBuffer=p.createIndexBuffer(this.indexArray),this.indexBuffer2=p.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(p,S,j,ut,Ot){for(const fi of ov(S,500)){let kn=0;for(const _h of fi)kn+=_h.length;const ss=this.segments.prepareSegment(kn,this.layoutVertexArray,this.indexArray),ul=ss.vertexLength,Ju=[],nh=[];for(const _h of fi){if(_h.length===0)continue;_h!==fi[0]&&nh.push(Ju.length/2);const wh=this.segments2.prepareSegment(_h.length,this.layoutVertexArray,this.indexArray2),Jh=wh.vertexLength;this.layoutVertexArray.emplaceBack(_h[0].x,_h[0].y),this.indexArray2.emplaceBack(Jh+_h.length-1,Jh),Ju.push(_h[0].x),Ju.push(_h[0].y);for(let Hh=1;Hh<_h.length;Hh++)this.layoutVertexArray.emplaceBack(_h[Hh].x,_h[Hh].y),this.indexArray2.emplaceBack(Jh+Hh-1,Jh+Hh),Ju.push(_h[Hh].x),Ju.push(_h[Hh].y);wh.vertexLength+=_h.length,wh.primitiveLength+=_h.length}const mh=$m(Ju,nh);for(let _h=0;_h<mh.length;_h+=3)this.indexArray.emplaceBack(ul+mh[_h],ul+mh[_h+1],ul+mh[_h+2]);ss.vertexLength+=kn,ss.primitiveLength+=mh.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,Ot,ut)}}tp("FillBucket",db,{omit:["layers","patternFeatures"]});const Jw=new Ng({"fill-sort-key":new jp(cd.layout_fill["fill-sort-key"])});var Qw={paint:new Ng({"fill-antialias":new Pp(cd.paint_fill["fill-antialias"]),"fill-opacity":new jp(cd.paint_fill["fill-opacity"]),"fill-color":new jp(cd.paint_fill["fill-color"]),"fill-outline-color":new jp(cd.paint_fill["fill-outline-color"]),"fill-translate":new Pp(cd.paint_fill["fill-translate"]),"fill-translate-anchor":new Pp(cd.paint_fill["fill-translate-anchor"]),"fill-pattern":new py(cd.paint_fill["fill-pattern"])}),layout:Jw};const ow=pg([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),aw=pg([{name:"a_centroid",components:2,type:"Int16"}],4),{members:N0}=ow;var Hv={},e2=vd,Eg=Rp;function Rp(_,p,S,j,ut){this.properties={},this.extent=S,this.type=0,this._pbf=_,this._geometry=-1,this._keys=j,this._values=ut,_.readFields(Xv,this,p)}function Xv(_,p,S){_==1?p.id=S.readVarint():_==2?function(j,ut){for(var Ot=j.readVarint()+j.pos;j.pos<Ot;){var fi=ut._keys[j.readVarint()],kn=ut._values[j.readVarint()];ut.properties[fi]=kn}}(S,p):_==3?p.type=S.readVarint():_==4&&(p._geometry=S.pos)}function kx(_){for(var p,S,j=0,ut=0,Ot=_.length,fi=Ot-1;ut<Ot;fi=ut++)j+=((S=_[fi]).x-(p=_[ut]).x)*(p.y+S.y);return j}Rp.types=["Unknown","Point","LineString","Polygon"],Rp.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var p,S=_.readVarint()+_.pos,j=1,ut=0,Ot=0,fi=0,kn=[];_.pos<S;){if(ut<=0){var ss=_.readVarint();j=7&ss,ut=ss>>3}if(ut--,j===1||j===2)Ot+=_.readSVarint(),fi+=_.readSVarint(),j===1&&(p&&kn.push(p),p=[]),p.push(new e2(Ot,fi));else{if(j!==7)throw new Error("unknown command "+j);p&&p.push(p[0].clone())}}return p&&kn.push(p),kn},Rp.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var p=_.readVarint()+_.pos,S=1,j=0,ut=0,Ot=0,fi=1/0,kn=-1/0,ss=1/0,ul=-1/0;_.pos<p;){if(j<=0){var Ju=_.readVarint();S=7&Ju,j=Ju>>3}if(j--,S===1||S===2)(ut+=_.readSVarint())<fi&&(fi=ut),ut>kn&&(kn=ut),(Ot+=_.readSVarint())<ss&&(ss=Ot),Ot>ul&&(ul=Ot);else if(S!==7)throw new Error("unknown command "+S)}return[fi,ss,kn,ul]},Rp.prototype.toGeoJSON=function(_,p,S){var j,ut,Ot=this.extent*Math.pow(2,S),fi=this.extent*_,kn=this.extent*p,ss=this.loadGeometry(),ul=Rp.types[this.type];function Ju(_h){for(var wh=0;wh<_h.length;wh++){var Jh=_h[wh];_h[wh]=[360*(Jh.x+fi)/Ot-180,360/Math.PI*Math.atan(Math.exp((180-360*(Jh.y+kn)/Ot)*Math.PI/180))-90]}}switch(this.type){case 1:var nh=[];for(j=0;j<ss.length;j++)nh[j]=ss[j][0];Ju(ss=nh);break;case 2:for(j=0;j<ss.length;j++)Ju(ss[j]);break;case 3:for(ss=function(_h){var wh=_h.length;if(wh<=1)return[_h];for(var Jh,Hh,Id=[],jd=0;jd<wh;jd++){var wd=kx(_h[jd]);wd!==0&&(Hh===void 0&&(Hh=wd<0),Hh===wd<0?(Jh&&Id.push(Jh),Jh=[_h[jd]]):Jh.push(_h[jd]))}return Jh&&Id.push(Jh),Id}(ss),j=0;j<ss.length;j++)for(ut=0;ut<ss[j].length;ut++)Ju(ss[j][ut])}ss.length===1?ss=ss[0]:ul="Multi"+ul;var mh={type:"Feature",geometry:{type:ul,coordinates:ss},properties:this.properties};return"id"in this&&(mh.id=this.id),mh};var Ly=Eg,fb=pb;function pb(_,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=_,this._keys=[],this._values=[],this._features=[],_.readFields(z0,this,p),this.length=this._features.length}function z0(_,p,S){_===15?p.version=S.readVarint():_===1?p.name=S.readString():_===5?p.extent=S.readVarint():_===2?p._features.push(S.pos):_===3?p._keys.push(S.readString()):_===4&&p._values.push(function(j){for(var ut=null,Ot=j.readVarint()+j.pos;j.pos<Ot;){var fi=j.readVarint()>>3;ut=fi===1?j.readString():fi===2?j.readFloat():fi===3?j.readDouble():fi===4?j.readVarint64():fi===5?j.readVarint():fi===6?j.readSVarint():fi===7?j.readBoolean():null}return ut}(S))}pb.prototype.feature=function(_){if(_<0||_>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[_];var p=this._pbf.readVarint()+this._pbf.pos;return new Ly(this._pbf,p,this.extent,this._keys,this._values)};var mb=fb;function d1(_,p,S){if(_===3){var j=new mb(S,S.readVarint()+S.pos);j.length&&(p[j.name]=j)}}Hv.VectorTile=function(_,p){this.layers=_.readFields(d1,{},p)},Hv.VectorTileFeature=Eg,Hv.VectorTileLayer=fb;const ax=Hv.VectorTileFeature.types,Cv=Math.pow(2,13);function f1(_,p,S,j,ut,Ot,fi,kn){_.emplaceBack(p,S,2*Math.floor(j*Cv)+fi,ut*Cv*2,Ot*Cv*2,Math.round(kn))}class A1{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.layoutVertexArray=new ex,this.centroidVertexArray=new s1,this.indexArray=new Ft,this.programConfigurations=new dh(p.layers,p.zoom),this.segments=new us,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){this.features=[],this.hasPattern=Iv("fill-extrusion",this.layers,S);for(const{feature:ut,id:Ot,index:fi,sourceLayerIndex:kn}of p){const ss=this.layers[0]._featureFilter.needGeometry,ul=kh(ut,ss);if(!this.layers[0]._featureFilter.filter(new ym(this.zoom),ul,j))continue;const Ju={id:Ot,sourceLayerIndex:kn,index:fi,geometry:ss?ul.geometry:bh(ut),properties:ut.properties,type:ut.type,patterns:{}};this.hasPattern?this.features.push(hb("fill-extrusion",this.layers,Ju,this.zoom,S)):this.addFeature(Ju,Ju.geometry,fi,j,{}),S.featureIndex.insert(ut,Ju.geometry,fi,kn,this.index,!0)}}addFeatures(p,S,j){for(const ut of this.features){const{geometry:Ot}=ut;this.addFeature(ut,Ot,ut.index,S,j)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,N0),this.centroidVertexBuffer=p.createVertexBuffer(this.centroidVertexArray,aw.members,!0),this.indexBuffer=p.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(p,S,j,ut,Ot){const fi={x:0,y:0,vertexCount:0};for(const kn of ov(S,500)){let ss=0;for(const wh of kn)ss+=wh.length;let ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const wh of kn){if(wh.length===0||lw(wh))continue;let Jh=0;for(let Hh=0;Hh<wh.length;Hh++){const Id=wh[Hh];if(Hh>=1){const jd=wh[Hh-1];if(!sw(Id,jd)){ul.vertexLength+4>us.MAX_VERTEX_ARRAY_LENGTH&&(ul=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const wd=Id.sub(jd)._perp()._unit(),Ud=jd.dist(Id);Jh+Ud>32768&&(Jh=0),f1(this.layoutVertexArray,Id.x,Id.y,wd.x,wd.y,0,0,Jh),f1(this.layoutVertexArray,Id.x,Id.y,wd.x,wd.y,0,1,Jh),fi.x+=2*Id.x,fi.y+=2*Id.y,fi.vertexCount+=2,Jh+=Ud,f1(this.layoutVertexArray,jd.x,jd.y,wd.x,wd.y,0,0,Jh),f1(this.layoutVertexArray,jd.x,jd.y,wd.x,wd.y,0,1,Jh),fi.x+=2*jd.x,fi.y+=2*jd.y,fi.vertexCount+=2;const Bf=ul.vertexLength;this.indexArray.emplaceBack(Bf,Bf+2,Bf+1),this.indexArray.emplaceBack(Bf+1,Bf+2,Bf+3),ul.vertexLength+=4,ul.primitiveLength+=2}}}}if(ul.vertexLength+ss>us.MAX_VERTEX_ARRAY_LENGTH&&(ul=this.segments.prepareSegment(ss,this.layoutVertexArray,this.indexArray)),ax[p.type]!=="Polygon")continue;const Ju=[],nh=[],mh=ul.vertexLength;for(const wh of kn)if(wh.length!==0){wh!==kn[0]&&nh.push(Ju.length/2);for(let Jh=0;Jh<wh.length;Jh++){const Hh=wh[Jh];f1(this.layoutVertexArray,Hh.x,Hh.y,0,0,1,1,0),fi.x+=Hh.x,fi.y+=Hh.y,fi.vertexCount+=1,Ju.push(Hh.x),Ju.push(Hh.y)}}const _h=$m(Ju,nh);for(let wh=0;wh<_h.length;wh+=3)this.indexArray.emplaceBack(mh+_h[wh],mh+_h[wh+2],mh+_h[wh+1]);ul.primitiveLength+=_h.length/3,ul.vertexLength+=ss}for(let kn=0;kn<fi.vertexCount;kn++)this.centroidVertexArray.emplaceBack(Math.floor(fi.x/fi.vertexCount),Math.floor(fi.y/fi.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,Ot,ut)}}function sw(_,p){return _.x===p.x&&(_.x<0||_.x>yh)||_.y===p.y&&(_.y<0||_.y>yh)}function lw(_){return _.every(p=>p.x<0)||_.every(p=>p.x>yh)||_.every(p=>p.y<0)||_.every(p=>p.y>yh)}tp("FillExtrusionBucket",A1,{omit:["layers","features"]});var t2={paint:new Ng({"fill-extrusion-opacity":new Pp(cd["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jp(cd["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pp(cd["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pp(cd["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new py(cd["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jp(cd["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jp(cd["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pp(cd["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function p1(_,p){return _.x*p.x+_.y*p.y}function gb(_,p){if(_.length===1){let S=0;const j=p[S++];let ut;for(;!ut||j.equals(ut);)if(ut=p[S++],!ut)return 1/0;for(;S<p.length;S++){const Ot=p[S],fi=_[0],kn=ut.sub(j),ss=Ot.sub(j),ul=fi.sub(j),Ju=p1(kn,kn),nh=p1(kn,ss),mh=p1(ss,ss),_h=p1(ul,kn),wh=p1(ul,ss),Jh=Ju*mh-nh*nh,Hh=(mh*_h-nh*wh)/Jh,Id=(Ju*wh-nh*_h)/Jh,jd=j.z*(1-Hh-Id)+ut.z*Hh+Ot.z*Id;if(isFinite(jd))return jd}return 1/0}{let S=1/0;for(const j of p)S=Math.min(S,j.z);return S}}const sx=pg([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:P1}=sx,Mv=pg([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_b}=Mv,uw=Hv.VectorTileFeature.types,lx=Math.cos(Math.PI/180*37.5),k1=Math.pow(2,14)/.5;class _y{constructor(p){this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(S=>S.id),this.index=p.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(S=>{this.gradients[S.id]={}}),this.layoutVertexArray=new B_,this.layoutVertexArray2=new T1,this.indexArray=new Ft,this.programConfigurations=new dh(p.layers,p.zoom),this.segments=new us,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(p,S,j){this.hasPattern=Iv("line",this.layers,S);const ut=this.layers[0].layout.get("line-sort-key"),Ot=!ut.isConstant(),fi=[];for(const{feature:kn,id:ss,index:ul,sourceLayerIndex:Ju}of p){const nh=this.layers[0]._featureFilter.needGeometry,mh=kh(kn,nh);if(!this.layers[0]._featureFilter.filter(new ym(this.zoom),mh,j))continue;const _h=Ot?ut.evaluate(mh,{},j):void 0,wh={id:ss,properties:kn.properties,type:kn.type,sourceLayerIndex:Ju,index:ul,geometry:nh?mh.geometry:bh(kn),patterns:{},sortKey:_h};fi.push(wh)}Ot&&fi.sort((kn,ss)=>kn.sortKey-ss.sortKey);for(const kn of fi){const{geometry:ss,index:ul,sourceLayerIndex:Ju}=kn;if(this.hasPattern){const nh=hb("line",this.layers,kn,this.zoom,S);this.patternFeatures.push(nh)}else this.addFeature(kn,ss,ul,j,{});S.featureIndex.insert(p[ul].feature,ss,ul,Ju,this.index)}}update(p,S,j){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(p,S,this.stateDependentLayers,j)}addFeatures(p,S,j){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,j)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(p){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=p.createVertexBuffer(this.layoutVertexArray2,_b)),this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,P1),this.indexBuffer=p.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(p),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(p){if(p.properties&&Object.prototype.hasOwnProperty.call(p.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(p.properties,"mapbox_clip_end"))return{start:+p.properties.mapbox_clip_start,end:+p.properties.mapbox_clip_end}}addFeature(p,S,j,ut,Ot){const fi=this.layers[0].layout,kn=fi.get("line-join").evaluate(p,{}),ss=fi.get("line-cap"),ul=fi.get("line-miter-limit"),Ju=fi.get("line-round-limit");this.lineClips=this.lineFeatureClips(p);for(const nh of S)this.addLine(nh,p,kn,ss,ul,Ju);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,p,j,Ot,ut)}addLine(p,S,j,ut,Ot,fi){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Id=0;Id<p.length-1;Id++)this.totalDistance+=p[Id].dist(p[Id+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const kn=uw[S.type]==="Polygon";let ss=p.length;for(;ss>=2&&p[ss-1].equals(p[ss-2]);)ss--;let ul=0;for(;ul<ss-1&&p[ul].equals(p[ul+1]);)ul++;if(ss<(kn?3:2))return;j==="bevel"&&(Ot=1.05);const Ju=this.overscaling<=16?122880/(512*this.overscaling):0,nh=this.segments.prepareSegment(10*ss,this.layoutVertexArray,this.indexArray);let mh,_h,wh,Jh,Hh;this.e1=this.e2=-1,kn&&(mh=p[ss-2],Hh=p[ul].sub(mh)._unit()._perp());for(let Id=ul;Id<ss;Id++){if(wh=Id===ss-1?kn?p[ul+1]:void 0:p[Id+1],wh&&p[Id].equals(wh))continue;Hh&&(Jh=Hh),mh&&(_h=mh),mh=p[Id],Hh=wh?wh.sub(mh)._unit()._perp():Jh,Jh=Jh||Hh;let jd=Jh.add(Hh);jd.x===0&&jd.y===0||jd._unit();const wd=Jh.x*Hh.x+Jh.y*Hh.y,Ud=jd.x*Hh.x+jd.y*Hh.y,Bf=Ud!==0?1/Ud:1/0,Rf=2*Math.sqrt(2-2*Ud),Ep=Ud<lx&&_h&&wh,Op=Jh.x*Hh.y-Jh.y*Hh.x>0;if(Ep&&Id>ul){const cp=mh.dist(_h);if(cp>2*Ju){const xp=mh.sub(mh.sub(_h)._mult(Ju/cp)._round());this.updateDistance(_h,xp),this.addCurrentVertex(xp,Jh,0,0,nh),_h=xp}}const yp=_h&&wh;let sp=yp?j:kn?"butt":ut;if(yp&&sp==="round"&&(Bf<fi?sp="miter":Bf<=2&&(sp="fakeround")),sp==="miter"&&Bf>Ot&&(sp="bevel"),sp==="bevel"&&(Bf>2&&(sp="flipbevel"),Bf<Ot&&(sp="miter")),_h&&this.updateDistance(_h,mh),sp==="miter")jd._mult(Bf),this.addCurrentVertex(mh,jd,0,0,nh);else if(sp==="flipbevel"){if(Bf>100)jd=Hh.mult(-1);else{const cp=Bf*Jh.add(Hh).mag()/Jh.sub(Hh).mag();jd._perp()._mult(cp*(Op?-1:1))}this.addCurrentVertex(mh,jd,0,0,nh),this.addCurrentVertex(mh,jd.mult(-1),0,0,nh)}else if(sp==="bevel"||sp==="fakeround"){const cp=-Math.sqrt(Bf*Bf-1),xp=Op?cp:0,gp=Op?0:cp;if(_h&&this.addCurrentVertex(mh,Jh,xp,gp,nh),sp==="fakeround"){const Wf=Math.round(180*Rf/Math.PI/20);for(let Gp=1;Gp<Wf;Gp++){let Np=Gp/Wf;if(Np!==.5){const og=Np-.5;Np+=Np*og*(Np-1)*((1.0904+wd*(wd*(3.55645-1.43519*wd)-3.2452))*og*og+(.848013+wd*(.215638*wd-1.06021)))}const hm=Hh.sub(Jh)._mult(Np)._add(Jh)._unit()._mult(Op?-1:1);this.addHalfVertex(mh,hm.x,hm.y,!1,Op,0,nh)}}wh&&this.addCurrentVertex(mh,Hh,-xp,-gp,nh)}else if(sp==="butt")this.addCurrentVertex(mh,jd,0,0,nh);else if(sp==="square"){const cp=_h?1:-1;this.addCurrentVertex(mh,jd,cp,cp,nh)}else sp==="round"&&(_h&&(this.addCurrentVertex(mh,Jh,0,0,nh),this.addCurrentVertex(mh,Jh,1,1,nh,!0)),wh&&(this.addCurrentVertex(mh,Hh,-1,-1,nh,!0),this.addCurrentVertex(mh,Hh,0,0,nh)));if(Ep&&Id<ss-1){const cp=mh.dist(wh);if(cp>2*Ju){const xp=mh.add(wh.sub(mh)._mult(Ju/cp)._round());this.updateDistance(mh,xp),this.addCurrentVertex(xp,Hh,0,0,nh),mh=xp}}}}addCurrentVertex(p,S,j,ut,Ot,fi=!1){const kn=S.y*ut-S.x,ss=-S.y-S.x*ut;this.addHalfVertex(p,S.x+S.y*j,S.y-S.x*j,fi,!1,j,Ot),this.addHalfVertex(p,kn,ss,fi,!0,-ut,Ot),this.distance>k1/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(p,S,j,ut,Ot,fi))}addHalfVertex({x:p,y:S},j,ut,Ot,fi,kn,ss){const ul=.5*(this.lineClips?this.scaledDistance*(k1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((p<<1)+(Ot?1:0),(S<<1)+(fi?1:0),Math.round(63*j)+128,Math.round(63*ut)+128,1+(kn===0?0:kn<0?-1:1)|(63&ul)<<2,ul>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ju=ss.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ju),ss.primitiveLength++),fi?this.e2=Ju:this.e1=Ju}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(p,S){this.distance+=p.dist(S),this.updateScaledDistance()}}tp("LineBucket",_y,{omit:["layers","patternFeatures"]});const cx=new Ng({"line-cap":new Pp(cd.layout_line["line-cap"]),"line-join":new jp(cd.layout_line["line-join"]),"line-miter-limit":new Pp(cd.layout_line["line-miter-limit"]),"line-round-limit":new Pp(cd.layout_line["line-round-limit"]),"line-sort-key":new jp(cd.layout_line["line-sort-key"])});var z_={paint:new Ng({"line-opacity":new jp(cd.paint_line["line-opacity"]),"line-color":new jp(cd.paint_line["line-color"]),"line-translate":new Pp(cd.paint_line["line-translate"]),"line-translate-anchor":new Pp(cd.paint_line["line-translate-anchor"]),"line-width":new jp(cd.paint_line["line-width"]),"line-gap-width":new jp(cd.paint_line["line-gap-width"]),"line-offset":new jp(cd.paint_line["line-offset"]),"line-blur":new jp(cd.paint_line["line-blur"]),"line-dasharray":new d0(cd.paint_line["line-dasharray"]),"line-pattern":new py(cd.paint_line["line-pattern"]),"line-gradient":new yv(cd.paint_line["line-gradient"])}),layout:cx};const i0=new class extends jp{possiblyEvaluate(_,p){return p=new ym(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),super.possiblyEvaluate(_,p)}evaluate(_,p,S,j){return p=Bt({},p,{zoom:Math.floor(p.zoom)}),super.evaluate(_,p,S,j)}}(z_.paint.properties["line-width"].specification);function Dx(_,p){return p>0?p+2*_:_}i0.useIntegerZoom=!0;const Sg=pg([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hw=pg([{name:"a_projected_pos",components:3,type:"Float32"}],4);pg([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ux=pg([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);pg([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const v0=pg([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),i2=pg([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function r2(_,p,S){return _.sections.forEach(j=>{j.text=function(ut,Ot,fi){const kn=Ot.layout.get("text-transform").evaluate(fi,{});return kn==="uppercase"?ut=ut.toLocaleUpperCase():kn==="lowercase"&&(ut=ut.toLocaleLowerCase()),ug.applyArabicShaping&&(ut=ug.applyArabicShaping(ut)),ut}(j.text,p,S)}),_}pg([{name:"triangle",components:3,type:"Uint16"}]),pg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pg([{type:"Float32",name:"offsetX"}]),pg([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const D1={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var r_=24,Av=Gm,yb=function(_,p,S,j,ut){var Ot,fi,kn=8*ut-j-1,ss=(1<<kn)-1,ul=ss>>1,Ju=-7,nh=S?ut-1:0,mh=S?-1:1,_h=_[p+nh];for(nh+=mh,Ot=_h&(1<<-Ju)-1,_h>>=-Ju,Ju+=kn;Ju>0;Ot=256*Ot+_[p+nh],nh+=mh,Ju-=8);for(fi=Ot&(1<<-Ju)-1,Ot>>=-Ju,Ju+=j;Ju>0;fi=256*fi+_[p+nh],nh+=mh,Ju-=8);if(Ot===0)Ot=1-ul;else{if(Ot===ss)return fi?NaN:1/0*(_h?-1:1);fi+=Math.pow(2,j),Ot-=ul}return(_h?-1:1)*fi*Math.pow(2,Ot-j)},vb=function(_,p,S,j,ut,Ot){var fi,kn,ss,ul=8*Ot-ut-1,Ju=(1<<ul)-1,nh=Ju>>1,mh=ut===23?Math.pow(2,-24)-Math.pow(2,-77):0,_h=j?0:Ot-1,wh=j?1:-1,Jh=p<0||p===0&&1/p<0?1:0;for(p=Math.abs(p),isNaN(p)||p===1/0?(kn=isNaN(p)?1:0,fi=Ju):(fi=Math.floor(Math.log(p)/Math.LN2),p*(ss=Math.pow(2,-fi))<1&&(fi--,ss*=2),(p+=fi+nh>=1?mh/ss:mh*Math.pow(2,1-nh))*ss>=2&&(fi++,ss/=2),fi+nh>=Ju?(kn=0,fi=Ju):fi+nh>=1?(kn=(p*ss-1)*Math.pow(2,ut),fi+=nh):(kn=p*Math.pow(2,nh-1)*Math.pow(2,ut),fi=0));ut>=8;_[S+_h]=255&kn,_h+=wh,kn/=256,ut-=8);for(fi=fi<<ut|kn,ul+=ut;ul>0;_[S+_h]=255&fi,_h+=wh,fi/=256,ul-=8);_[S+_h-wh]|=128*Jh};function Gm(_){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(_)?_:new Uint8Array(_||0),this.pos=0,this.type=0,this.length=this.buf.length}Gm.Varint=0,Gm.Fixed64=1,Gm.Bytes=2,Gm.Fixed32=5;var Pv,xb=4294967296,dw=1/xb,bb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function av(_){return _.type===Gm.Bytes?_.readVarint()+_.pos:_.pos+1}function sv(_,p,S){return S?4294967296*p+(_>>>0):4294967296*(p>>>0)+(_>>>0)}function Lx(_,p,S){var j=p<=16383?1:p<=2097151?2:p<=268435455?3:Math.floor(Math.log(p)/(7*Math.LN2));S.realloc(j);for(var ut=S.pos-1;ut>=_;ut--)S.buf[ut+j]=S.buf[ut]}function wb(_,p){for(var S=0;S<_.length;S++)p.writeVarint(_[S])}function Eb(_,p){for(var S=0;S<_.length;S++)p.writeSVarint(_[S])}function iy(_,p){for(var S=0;S<_.length;S++)p.writeFloat(_[S])}function Sb(_,p){for(var S=0;S<_.length;S++)p.writeDouble(_[S])}function fw(_,p){for(var S=0;S<_.length;S++)p.writeBoolean(_[S])}function lv(_,p){for(var S=0;S<_.length;S++)p.writeFixed32(_[S])}function n2(_,p){for(var S=0;S<_.length;S++)p.writeSFixed32(_[S])}function m1(_,p){for(var S=0;S<_.length;S++)p.writeFixed64(_[S])}function hx(_,p){for(var S=0;S<_.length;S++)p.writeSFixed64(_[S])}function yy(_,p){return(_[p]|_[p+1]<<8|_[p+2]<<16)+16777216*_[p+3]}function F_(_,p,S){_[S]=p,_[S+1]=p>>>8,_[S+2]=p>>>16,_[S+3]=p>>>24}function pw(_,p){return(_[p]|_[p+1]<<8|_[p+2]<<16)+(_[p+3]<<24)}function Rx(_,p,S){_===1&&S.readMessage(mw,p)}function mw(_,p,S){if(_===3){const{id:j,bitmap:ut,width:Ot,height:fi,left:kn,top:ss,advance:ul}=S.readMessage(o2,{});p.push({id:j,bitmap:new ty({width:Ot+6,height:fi+6},ut),metrics:{width:Ot,height:fi,left:kn,top:ss,advance:ul}})}}function o2(_,p,S){_===1?p.id=S.readVarint():_===2?p.bitmap=S.readBytes():_===3?p.width=S.readVarint():_===4?p.height=S.readVarint():_===5?p.left=S.readSVarint():_===6?p.top=S.readSVarint():_===7&&(p.advance=S.readVarint())}function Ox(_){let p=0,S=0;for(const fi of _)p+=fi.w*fi.h,S=Math.max(S,fi.w);_.sort((fi,kn)=>kn.h-fi.h);const j=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(p/.95)),S),h:1/0}];let ut=0,Ot=0;for(const fi of _)for(let kn=j.length-1;kn>=0;kn--){const ss=j[kn];if(!(fi.w>ss.w||fi.h>ss.h)){if(fi.x=ss.x,fi.y=ss.y,Ot=Math.max(Ot,fi.y+fi.h),ut=Math.max(ut,fi.x+fi.w),fi.w===ss.w&&fi.h===ss.h){const ul=j.pop();kn<j.length&&(j[kn]=ul)}else fi.h===ss.h?(ss.x+=fi.w,ss.w-=fi.w):fi.w===ss.w?(ss.y+=fi.h,ss.h-=fi.h):(j.push({x:ss.x+fi.w,y:ss.y,w:ss.w-fi.w,h:fi.h}),ss.y+=fi.h,ss.h-=fi.h);break}}return{w:ut,h:Ot,fill:p/(ut*Ot)||0}}Gm.prototype={destroy:function(){this.buf=null},readFields:function(_,p,S){for(S=S||this.length;this.pos<S;){var j=this.readVarint(),ut=j>>3,Ot=this.pos;this.type=7&j,_(ut,p,this),this.pos===Ot&&this.skip(j)}return p},readMessage:function(_,p){return this.readFields(_,p,this.readVarint()+this.pos)},readFixed32:function(){var _=yy(this.buf,this.pos);return this.pos+=4,_},readSFixed32:function(){var _=pw(this.buf,this.pos);return this.pos+=4,_},readFixed64:function(){var _=yy(this.buf,this.pos)+yy(this.buf,this.pos+4)*xb;return this.pos+=8,_},readSFixed64:function(){var _=yy(this.buf,this.pos)+pw(this.buf,this.pos+4)*xb;return this.pos+=8,_},readFloat:function(){var _=yb(this.buf,this.pos,!0,23,4);return this.pos+=4,_},readDouble:function(){var _=yb(this.buf,this.pos,!0,52,8);return this.pos+=8,_},readVarint:function(_){var p,S,j=this.buf;return p=127&(S=j[this.pos++]),S<128?p:(p|=(127&(S=j[this.pos++]))<<7,S<128?p:(p|=(127&(S=j[this.pos++]))<<14,S<128?p:(p|=(127&(S=j[this.pos++]))<<21,S<128?p:function(ut,Ot,fi){var kn,ss,ul=fi.buf;if(kn=(112&(ss=ul[fi.pos++]))>>4,ss<128||(kn|=(127&(ss=ul[fi.pos++]))<<3,ss<128)||(kn|=(127&(ss=ul[fi.pos++]))<<10,ss<128)||(kn|=(127&(ss=ul[fi.pos++]))<<17,ss<128)||(kn|=(127&(ss=ul[fi.pos++]))<<24,ss<128)||(kn|=(1&(ss=ul[fi.pos++]))<<31,ss<128))return sv(ut,kn,Ot);throw new Error("Expected varint not more than 10 bytes")}(p|=(15&(S=j[this.pos]))<<28,_,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var _=this.readVarint();return _%2==1?(_+1)/-2:_/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var _=this.readVarint()+this.pos,p=this.pos;return this.pos=_,_-p>=12&&bb?function(S,j,ut){return bb.decode(S.subarray(j,ut))}(this.buf,p,_):function(S,j,ut){for(var Ot="",fi=j;fi<ut;){var kn,ss,ul,Ju=S[fi],nh=null,mh=Ju>239?4:Ju>223?3:Ju>191?2:1;if(fi+mh>ut)break;mh===1?Ju<128&&(nh=Ju):mh===2?(192&(kn=S[fi+1]))==128&&(nh=(31&Ju)<<6|63&kn)<=127&&(nh=null):mh===3?(ss=S[fi+2],(192&(kn=S[fi+1]))==128&&(192&ss)==128&&((nh=(15&Ju)<<12|(63&kn)<<6|63&ss)<=2047||nh>=55296&&nh<=57343)&&(nh=null)):mh===4&&(ss=S[fi+2],ul=S[fi+3],(192&(kn=S[fi+1]))==128&&(192&ss)==128&&(192&ul)==128&&((nh=(15&Ju)<<18|(63&kn)<<12|(63&ss)<<6|63&ul)<=65535||nh>=1114112)&&(nh=null)),nh===null?(nh=65533,mh=1):nh>65535&&(nh-=65536,Ot+=String.fromCharCode(nh>>>10&1023|55296),nh=56320|1023&nh),Ot+=String.fromCharCode(nh),fi+=mh}return Ot}(this.buf,p,_)},readBytes:function(){var _=this.readVarint()+this.pos,p=this.buf.subarray(this.pos,_);return this.pos=_,p},readPackedVarint:function(_,p){if(this.type!==Gm.Bytes)return _.push(this.readVarint(p));var S=av(this);for(_=_||[];this.pos<S;)_.push(this.readVarint(p));return _},readPackedSVarint:function(_){if(this.type!==Gm.Bytes)return _.push(this.readSVarint());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readSVarint());return _},readPackedBoolean:function(_){if(this.type!==Gm.Bytes)return _.push(this.readBoolean());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readBoolean());return _},readPackedFloat:function(_){if(this.type!==Gm.Bytes)return _.push(this.readFloat());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readFloat());return _},readPackedDouble:function(_){if(this.type!==Gm.Bytes)return _.push(this.readDouble());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readDouble());return _},readPackedFixed32:function(_){if(this.type!==Gm.Bytes)return _.push(this.readFixed32());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readFixed32());return _},readPackedSFixed32:function(_){if(this.type!==Gm.Bytes)return _.push(this.readSFixed32());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readSFixed32());return _},readPackedFixed64:function(_){if(this.type!==Gm.Bytes)return _.push(this.readFixed64());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readFixed64());return _},readPackedSFixed64:function(_){if(this.type!==Gm.Bytes)return _.push(this.readSFixed64());var p=av(this);for(_=_||[];this.pos<p;)_.push(this.readSFixed64());return _},skip:function(_){var p=7&_;if(p===Gm.Varint)for(;this.buf[this.pos++]>127;);else if(p===Gm.Bytes)this.pos=this.readVarint()+this.pos;else if(p===Gm.Fixed32)this.pos+=4;else{if(p!==Gm.Fixed64)throw new Error("Unimplemented type: "+p);this.pos+=8}},writeTag:function(_,p){this.writeVarint(_<<3|p)},realloc:function(_){for(var p=this.length||16;p<this.pos+_;)p*=2;if(p!==this.length){var S=new Uint8Array(p);S.set(this.buf),this.buf=S,this.length=p}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(_){this.realloc(4),F_(this.buf,_,this.pos),this.pos+=4},writeSFixed32:function(_){this.realloc(4),F_(this.buf,_,this.pos),this.pos+=4},writeFixed64:function(_){this.realloc(8),F_(this.buf,-1&_,this.pos),F_(this.buf,Math.floor(_*dw),this.pos+4),this.pos+=8},writeSFixed64:function(_){this.realloc(8),F_(this.buf,-1&_,this.pos),F_(this.buf,Math.floor(_*dw),this.pos+4),this.pos+=8},writeVarint:function(_){(_=+_||0)>268435455||_<0?function(p,S){var j,ut;if(p>=0?(j=p%4294967296|0,ut=p/4294967296|0):(ut=~(-p/4294967296),4294967295^(j=~(-p%4294967296))?j=j+1|0:(j=0,ut=ut+1|0)),p>=18446744073709552e3||p<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");S.realloc(10),function(Ot,fi,kn){kn.buf[kn.pos++]=127&Ot|128,Ot>>>=7,kn.buf[kn.pos++]=127&Ot|128,Ot>>>=7,kn.buf[kn.pos++]=127&Ot|128,Ot>>>=7,kn.buf[kn.pos++]=127&Ot|128,kn.buf[kn.pos]=127&(Ot>>>=7)}(j,0,S),function(Ot,fi){var kn=(7&Ot)<<4;fi.buf[fi.pos++]|=kn|((Ot>>>=3)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot|((Ot>>>=7)?128:0),Ot&&(fi.buf[fi.pos++]=127&Ot)))))}(ut,S)}(_,this):(this.realloc(4),this.buf[this.pos++]=127&_|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=_>>>7&127))))},writeSVarint:function(_){this.writeVarint(_<0?2*-_-1:2*_)},writeBoolean:function(_){this.writeVarint(!!_)},writeString:function(_){_=String(_),this.realloc(4*_.length),this.pos++;var p=this.pos;this.pos=function(j,ut,Ot){for(var fi,kn,ss=0;ss<ut.length;ss++){if((fi=ut.charCodeAt(ss))>55295&&fi<57344){if(!kn){fi>56319||ss+1===ut.length?(j[Ot++]=239,j[Ot++]=191,j[Ot++]=189):kn=fi;continue}if(fi<56320){j[Ot++]=239,j[Ot++]=191,j[Ot++]=189,kn=fi;continue}fi=kn-55296<<10|fi-56320|65536,kn=null}else kn&&(j[Ot++]=239,j[Ot++]=191,j[Ot++]=189,kn=null);fi<128?j[Ot++]=fi:(fi<2048?j[Ot++]=fi>>6|192:(fi<65536?j[Ot++]=fi>>12|224:(j[Ot++]=fi>>18|240,j[Ot++]=fi>>12&63|128),j[Ot++]=fi>>6&63|128),j[Ot++]=63&fi|128)}return Ot}(this.buf,_,this.pos);var S=this.pos-p;S>=128&&Lx(p,S,this),this.pos=p-1,this.writeVarint(S),this.pos+=S},writeFloat:function(_){this.realloc(4),vb(this.buf,_,this.pos,!0,23,4),this.pos+=4},writeDouble:function(_){this.realloc(8),vb(this.buf,_,this.pos,!0,52,8),this.pos+=8},writeBytes:function(_){var p=_.length;this.writeVarint(p),this.realloc(p);for(var S=0;S<p;S++)this.buf[this.pos++]=_[S]},writeRawMessage:function(_,p){this.pos++;var S=this.pos;_(p,this);var j=this.pos-S;j>=128&&Lx(S,j,this),this.pos=S-1,this.writeVarint(j),this.pos+=j},writeMessage:function(_,p,S){this.writeTag(_,Gm.Bytes),this.writeRawMessage(p,S)},writePackedVarint:function(_,p){p.length&&this.writeMessage(_,wb,p)},writePackedSVarint:function(_,p){p.length&&this.writeMessage(_,Eb,p)},writePackedBoolean:function(_,p){p.length&&this.writeMessage(_,fw,p)},writePackedFloat:function(_,p){p.length&&this.writeMessage(_,iy,p)},writePackedDouble:function(_,p){p.length&&this.writeMessage(_,Sb,p)},writePackedFixed32:function(_,p){p.length&&this.writeMessage(_,lv,p)},writePackedSFixed32:function(_,p){p.length&&this.writeMessage(_,n2,p)},writePackedFixed64:function(_,p){p.length&&this.writeMessage(_,m1,p)},writePackedSFixed64:function(_,p){p.length&&this.writeMessage(_,hx,p)},writeBytesField:function(_,p){this.writeTag(_,Gm.Bytes),this.writeBytes(p)},writeFixed32Field:function(_,p){this.writeTag(_,Gm.Fixed32),this.writeFixed32(p)},writeSFixed32Field:function(_,p){this.writeTag(_,Gm.Fixed32),this.writeSFixed32(p)},writeFixed64Field:function(_,p){this.writeTag(_,Gm.Fixed64),this.writeFixed64(p)},writeSFixed64Field:function(_,p){this.writeTag(_,Gm.Fixed64),this.writeSFixed64(p)},writeVarintField:function(_,p){this.writeTag(_,Gm.Varint),this.writeVarint(p)},writeSVarintField:function(_,p){this.writeTag(_,Gm.Varint),this.writeSVarint(p)},writeStringField:function(_,p){this.writeTag(_,Gm.Bytes),this.writeString(p)},writeFloatField:function(_,p){this.writeTag(_,Gm.Fixed32),this.writeFloat(p)},writeDoubleField:function(_,p){this.writeTag(_,Gm.Fixed64),this.writeDouble(p)},writeBooleanField:function(_,p){this.writeVarintField(_,!!p)}};class x0{constructor(p,{pixelRatio:S,version:j,stretchX:ut,stretchY:Ot,content:fi}){this.paddedRect=p,this.pixelRatio=S,this.stretchX=ut,this.stretchY=Ot,this.content=fi,this.version=j}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kv{constructor(p,S){const j={},ut={};this.haveRenderCallbacks=[];const Ot=[];this.addImages(p,j,Ot),this.addImages(S,ut,Ot);const{w:fi,h:kn}=Ox(Ot),ss=new pm({width:fi||1,height:kn||1});for(const ul in p){const Ju=p[ul],nh=j[ul].paddedRect;pm.copy(Ju.data,ss,{x:0,y:0},{x:nh.x+1,y:nh.y+1},Ju.data)}for(const ul in S){const Ju=S[ul],nh=ut[ul].paddedRect,mh=nh.x+1,_h=nh.y+1,wh=Ju.data.width,Jh=Ju.data.height;pm.copy(Ju.data,ss,{x:0,y:0},{x:mh,y:_h},Ju.data),pm.copy(Ju.data,ss,{x:0,y:Jh-1},{x:mh,y:_h-1},{width:wh,height:1}),pm.copy(Ju.data,ss,{x:0,y:0},{x:mh,y:_h+Jh},{width:wh,height:1}),pm.copy(Ju.data,ss,{x:wh-1,y:0},{x:mh-1,y:_h},{width:1,height:Jh}),pm.copy(Ju.data,ss,{x:0,y:0},{x:mh+wh,y:_h},{width:1,height:Jh})}this.image=ss,this.iconPositions=j,this.patternPositions=ut}addImages(p,S,j){for(const ut in p){const Ot=p[ut],fi={x:0,y:0,w:Ot.data.width+2,h:Ot.data.height+2};j.push(fi),S[ut]=new x0(fi,Ot),Ot.hasRenderCallback&&this.haveRenderCallbacks.push(ut)}}patchUpdatedImages(p,S){p.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const j in p.updatedImages)this.patchUpdatedImage(this.iconPositions[j],p.getImage(j),S),this.patchUpdatedImage(this.patternPositions[j],p.getImage(j),S)}patchUpdatedImage(p,S,j){if(!p||!S||p.version===S.version)return;p.version=S.version;const[ut,Ot]=p.tl;j.update(S.data,void 0,{x:ut,y:Ot})}}tp("ImagePosition",x0),tp("ImageAtlas",Kv),o.WritingMode=void 0,(Pv=o.WritingMode||(o.WritingMode={}))[Pv.none=0]="none",Pv[Pv.horizontal=1]="horizontal",Pv[Pv.vertical=2]="vertical",Pv[Pv.horizontalOnly=3]="horizontalOnly";const dx=-17;class L1{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(p,S){const j=new L1;return j.scale=p||1,j.fontStack=S,j}static forImage(p){const S=new L1;return S.imageName=p,S}}class R1{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(p,S){const j=new R1;for(let ut=0;ut<p.sections.length;ut++){const Ot=p.sections[ut];Ot.image?j.addImageSection(Ot):j.addTextSection(Ot,S)}return j}length(){return this.text.length}getSection(p){return this.sections[this.sectionIndex[p]]}getSectionIndex(p){return this.sectionIndex[p]}getCharCode(p){return this.text.charCodeAt(p)}verticalizePunctuation(){this.text=function(p){let S="";for(let j=0;j<p.length;j++){const ut=p.charCodeAt(j+1)||null,Ot=p.charCodeAt(j-1)||null;S+=ut&&zv(ut)&&!D1[p[j+1]]||Ot&&zv(Ot)&&!D1[p[j-1]]||!D1[p[j]]?p[j]:D1[p[j]]}return S}(this.text)}trim(){let p=0;for(let j=0;j<this.text.length&&O1[this.text.charCodeAt(j)];j++)p++;let S=this.text.length;for(let j=this.text.length-1;j>=0&&j>=p&&O1[this.text.charCodeAt(j)];j--)S--;this.text=this.text.substring(p,S),this.sectionIndex=this.sectionIndex.slice(p,S)}substring(p,S){const j=new R1;return j.text=this.text.substring(p,S),j.sectionIndex=this.sectionIndex.slice(p,S),j.sections=this.sections,j}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((p,S)=>Math.max(p,this.sections[S].scale),0)}addTextSection(p,S){this.text+=p.text,this.sections.push(L1.forText(p.scale,p.fontStack||S));const j=this.sections.length-1;for(let ut=0;ut<p.text.length;++ut)this.sectionIndex.push(j)}addImageSection(p){const S=p.image?p.image.name:"";if(S.length===0)return void rl("Can't add FormattedSection with an empty image.");const j=this.getNextImageSectionCharCode();j?(this.text+=String.fromCharCode(j),this.sections.push(L1.forImage(S)),this.sectionIndex.push(this.sections.length-1)):rl("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function g1(_,p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh){const Hh=R1.fromFeature(_,ut);let Id;nh===o.WritingMode.vertical&&Hh.verticalizePunctuation();const{processBidirectionalText:jd,processStyledBidirectionalText:wd}=ug;if(jd&&Hh.sections.length===1){Id=[];const Rf=jd(Hh.toString(),fx(Hh,ul,Ot,p,j,_h,wh));for(const Ep of Rf){const Op=new R1;Op.text=Ep,Op.sections=Hh.sections;for(let yp=0;yp<Ep.length;yp++)Op.sectionIndex.push(0);Id.push(Op)}}else if(wd){Id=[];const Rf=wd(Hh.text,Hh.sectionIndex,fx(Hh,ul,Ot,p,j,_h,wh));for(const Ep of Rf){const Op=new R1;Op.text=Ep[0],Op.sectionIndex=Ep[1],Op.sections=Hh.sections,Id.push(Op)}}else Id=function(Rf,Ep){const Op=[],yp=Rf.text;let sp=0;for(const cp of Ep)Op.push(Rf.substring(sp,cp)),sp=cp;return sp<yp.length&&Op.push(Rf.substring(sp,yp.length)),Op}(Hh,fx(Hh,ul,Ot,p,j,_h,wh));const Ud=[],Bf={positionedLines:Ud,text:Hh.toString(),top:Ju[1],bottom:Ju[1],left:Ju[0],right:Ju[0],writingMode:nh,iconsInText:!1,verticalizable:!1};return function(Rf,Ep,Op,yp,sp,cp,xp,gp,Wf,Gp,Np,hm){let og=0,Jm=dx,Tg=0,ny=0;const E_=gp==="right"?1:gp==="left"?0:.5;let zg=0;for(const Dg of sp){Dg.trim();const T_=Dg.getMaxScale(),I_=(T_-1)*r_,U_={positionedGlyphs:[],lineOffset:0};Rf.positionedLines[zg]=U_;const oy=U_.positionedGlyphs;let ay=0;if(!Dg.length()){Jm+=cp,++zg;continue}for(let d_=0;d_<Dg.length();d_++){const dm=Dg.getSection(d_),Oy=Dg.getSectionIndex(d_),f_=Dg.getCharCode(d_);let n_=0,n0=null,dg=null,vy=null,$y=r_;const sy=!(Wf===o.WritingMode.horizontal||!Np&&!W0(f_)||Np&&(O1[f_]||(Ig=f_,ip.Arabic(Ig)||ip["Arabic Supplement"](Ig)||ip["Arabic Extended-A"](Ig)||ip["Arabic Presentation Forms-A"](Ig)||ip["Arabic Presentation Forms-B"](Ig))));if(dm.imageName){const By=yp[dm.imageName];if(!By)continue;vy=dm.imageName,Rf.iconsInText=Rf.iconsInText||!0,dg=By.paddedRect;const ly=By.displaySize;dm.scale=dm.scale*r_/hm,n0={width:ly[0],height:ly[1],left:1,top:-3,advance:sy?ly[1]:ly[0]},n_=I_+(r_-ly[1]*dm.scale),$y=n0.advance;const Rv=sy?ly[0]*dm.scale-r_*T_:ly[1]*dm.scale-r_*T_;Rv>0&&Rv>ay&&(ay=Rv)}else{const By=Op[dm.fontStack],ly=By&&By[f_];if(ly&&ly.rect)dg=ly.rect,n0=ly.metrics;else{const Rv=Ep[dm.fontStack],xx=Rv&&Rv[f_];if(!xx)continue;n0=xx.metrics}n_=(T_-dm.scale)*r_}sy?(Rf.verticalizable=!0,oy.push({glyph:f_,imageName:vy,x:og,y:Jm+n_,vertical:sy,scale:dm.scale,fontStack:dm.fontStack,sectionIndex:Oy,metrics:n0,rect:dg}),og+=$y*dm.scale+Gp):(oy.push({glyph:f_,imageName:vy,x:og,y:Jm+n_,vertical:sy,scale:dm.scale,fontStack:dm.fontStack,sectionIndex:Oy,metrics:n0,rect:dg}),og+=n0.advance*dm.scale+Gp)}oy.length!==0&&(Tg=Math.max(og-Gp,Tg),z1(oy,0,oy.length-1,E_,ay)),og=0;const _g=cp*T_+ay;U_.lineOffset=Math.max(ay,I_),Jm+=_g,ny=Math.max(_g,ny),++zg}var Ig;const Fg=Jm-dx,{horizontalAlign:S_,verticalAlign:h_}=Bx(xp);(function(Dg,T_,I_,U_,oy,ay,_g,d_,dm){const Oy=(T_-I_)*oy;let f_=0;f_=ay!==_g?-d_*U_-dx:(-U_*dm+.5)*_g;for(const n_ of Dg)for(const n0 of n_.positionedGlyphs)n0.x+=Oy,n0.y+=f_})(Rf.positionedLines,E_,S_,h_,Tg,ny,cp,Fg,sp.length),Rf.top+=-h_*Fg,Rf.bottom=Rf.top+Fg,Rf.left+=-S_*Tg,Rf.right=Rf.left+Tg}(Bf,p,S,j,Id,fi,kn,ss,nh,ul,mh,Jh),!function(Rf){for(const Ep of Rf)if(Ep.positionedGlyphs.length!==0)return!1;return!0}(Ud)&&Bf}const O1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _1(_,p,S,j,ut,Ot){if(p.imageName){const fi=j[p.imageName];return fi?fi.displaySize[0]*p.scale*r_/Ot+ut:0}{const fi=S[p.fontStack],kn=fi&&fi[_];return kn?kn.metrics.advance*p.scale+ut:0}}function B1(_,p,S,j){const ut=Math.pow(_-p,2);return j?_<p?ut/2:2*ut:ut+Math.abs(S)*S}function $x(_,p,S){let j=0;return _===10&&(j-=1e4),S&&(j+=150),_!==40&&_!==65288||(j+=50),p!==41&&p!==65289||(j+=50),j}function Tb(_,p,S,j,ut,Ot){let fi=null,kn=B1(p,S,ut,Ot);for(const ss of j){const ul=B1(p-ss.x,S,ut,Ot)+ss.badness;ul<=kn&&(fi=ss,kn=ul)}return{index:_,x:p,priorBreak:fi,badness:kn}}function N1(_){return _?N1(_.priorBreak).concat(_.index):[]}function fx(_,p,S,j,ut,Ot,fi){if(Ot!=="point")return[];if(!_)return[];const kn=[],ss=function(mh,_h,wh,Jh,Hh,Id){let jd=0;for(let wd=0;wd<mh.length();wd++){const Ud=mh.getSection(wd);jd+=_1(mh.getCharCode(wd),Ud,Jh,Hh,_h,Id)}return jd/Math.max(1,Math.ceil(jd/wh))}(_,p,S,j,ut,fi),ul=_.text.indexOf("​")>=0;let Ju=0;for(let mh=0;mh<_.length();mh++){const _h=_.getSection(mh),wh=_.getCharCode(mh);if(O1[wh]||(Ju+=_1(wh,_h,j,ut,p,fi)),mh<_.length()-1){const Jh=!((nh=wh)<11904||!(ip["Bopomofo Extended"](nh)||ip.Bopomofo(nh)||ip["CJK Compatibility Forms"](nh)||ip["CJK Compatibility Ideographs"](nh)||ip["CJK Compatibility"](nh)||ip["CJK Radicals Supplement"](nh)||ip["CJK Strokes"](nh)||ip["CJK Symbols and Punctuation"](nh)||ip["CJK Unified Ideographs Extension A"](nh)||ip["CJK Unified Ideographs"](nh)||ip["Enclosed CJK Letters and Months"](nh)||ip["Halfwidth and Fullwidth Forms"](nh)||ip.Hiragana(nh)||ip["Ideographic Description Characters"](nh)||ip["Kangxi Radicals"](nh)||ip["Katakana Phonetic Extensions"](nh)||ip.Katakana(nh)||ip["Vertical Forms"](nh)||ip["Yi Radicals"](nh)||ip["Yi Syllables"](nh)));($1[wh]||Jh||_h.imageName)&&kn.push(Tb(mh+1,Ju,ss,kn,$x(wh,_.getCharCode(mh+1),Jh&&ul),!1))}}var nh;return N1(Tb(_.length(),Ju,ss,kn,0,!0))}function Bx(_){let p=.5,S=.5;switch(_){case"right":case"top-right":case"bottom-right":p=1;break;case"left":case"top-left":case"bottom-left":p=0}switch(_){case"bottom":case"bottom-right":case"bottom-left":S=1;break;case"top":case"top-right":case"top-left":S=0}return{horizontalAlign:p,verticalAlign:S}}function z1(_,p,S,j,ut){if(!j&&!ut)return;const Ot=_[S],fi=(_[S].x+Ot.metrics.advance*Ot.scale)*j;for(let kn=p;kn<=S;kn++)_[kn].x-=fi,_[kn].y+=ut}function gw(_,p,S){const{horizontalAlign:j,verticalAlign:ut}=Bx(S),Ot=p[0]-_.displaySize[0]*j,fi=p[1]-_.displaySize[1]*ut;return{image:_,top:fi,bottom:fi+_.displaySize[1],left:Ot,right:Ot+_.displaySize[0]}}function Nx(_,p,S,j,ut,Ot){const fi=_.image;let kn;if(fi.content){const Hh=fi.content,Id=fi.pixelRatio||1;kn=[Hh[0]/Id,Hh[1]/Id,fi.displaySize[0]-Hh[2]/Id,fi.displaySize[1]-Hh[3]/Id]}const ss=p.left*Ot,ul=p.right*Ot;let Ju,nh,mh,_h;S==="width"||S==="both"?(_h=ut[0]+ss-j[3],nh=ut[0]+ul+j[1]):(_h=ut[0]+(ss+ul-fi.displaySize[0])/2,nh=_h+fi.displaySize[0]);const wh=p.top*Ot,Jh=p.bottom*Ot;return S==="height"||S==="both"?(Ju=ut[1]+wh-j[0],mh=ut[1]+Jh+j[2]):(Ju=ut[1]+(wh+Jh-fi.displaySize[1])/2,mh=Ju+fi.displaySize[1]),{image:fi,top:Ju,right:nh,bottom:mh,left:_h,collisionPadding:kn}}const cv=128;function _w(_,p){const{expression:S}=p;if(S.kind==="constant")return{kind:"constant",layoutSize:S.evaluate(new ym(_+1))};if(S.kind==="source")return{kind:"source"};{const{zoomStops:j,interpolationType:ut}=S;let Ot=0;for(;Ot<j.length&&j[Ot]<=_;)Ot++;Ot=Math.max(0,Ot-1);let fi=Ot;for(;fi<j.length&&j[fi]<_+1;)fi++;fi=Math.min(j.length-1,fi);const kn=j[Ot],ss=j[fi];return S.kind==="composite"?{kind:"composite",minZoom:kn,maxZoom:ss,interpolationType:ut}:{kind:"camera",minZoom:kn,maxZoom:ss,minSize:S.evaluate(new ym(kn)),maxSize:S.evaluate(new ym(ss)),interpolationType:ut}}}class Wv extends vd{constructor(p,S,j,ut){super(p,S),this.angle=j,ut!==void 0&&(this.segment=ut)}clone(){return new Wv(this.x,this.y,this.angle,this.segment)}}function F1(_,p,S,j,ut){if(p.segment===void 0)return!0;let Ot=p,fi=p.segment+1,kn=0;for(;kn>-S/2;){if(fi--,fi<0)return!1;kn-=_[fi].dist(Ot),Ot=_[fi]}kn+=_[fi].dist(_[fi+1]),fi++;const ss=[];let ul=0;for(;kn<S/2;){const Ju=_[fi],nh=_[fi+1];if(!nh)return!1;let mh=_[fi-1].angleTo(Ju)-Ju.angleTo(nh);for(mh=Math.abs((mh+3*Math.PI)%(2*Math.PI)-Math.PI),ss.push({distance:kn,angleDelta:mh}),ul+=mh;kn-ss[0].distance>j;)ul-=ss.shift().angleDelta;if(ul>ut)return!1;fi++,kn+=Ju.dist(nh)}return!0}function Ib(_){let p=0;for(let S=0;S<_.length-1;S++)p+=_[S].dist(_[S+1]);return p}function kv(_,p,S){return _?.6*p*S:0}function Bm(_,p){return Math.max(_?_.right-_.left:0,p?p.right-p.left:0)}function Cb(_,p,S,j,ut,Ot){const fi=kv(S,ut,Ot),kn=Bm(S,j)*Ot;let ss=0;const ul=Ib(_)/2;for(let Ju=0;Ju<_.length-1;Ju++){const nh=_[Ju],mh=_[Ju+1],_h=nh.dist(mh);if(ss+_h>ul){const wh=(ul-ss)/_h,Jh=mm(nh.x,mh.x,wh),Hh=mm(nh.y,mh.y,wh),Id=new Wv(Jh,Hh,mh.angleTo(nh),Ju);return Id._round(),!fi||F1(_,Id,kn,fi,p)?Id:void 0}ss+=_h}}function uv(_,p,S,j,ut,Ot,fi,kn,ss){const ul=kv(j,Ot,fi),Ju=Bm(j,ut),nh=Ju*fi,mh=_[0].x===0||_[0].x===ss||_[0].y===0||_[0].y===ss;return p-nh<p/4&&(p=nh+p/4),F0(_,mh?p/2*kn%p:(Ju/2+2*Ot)*fi*kn%p,p,ul,S,nh,mh,!1,ss)}function F0(_,p,S,j,ut,Ot,fi,kn,ss){const ul=Ot/2,Ju=Ib(_);let nh=0,mh=p-S,_h=[];for(let wh=0;wh<_.length-1;wh++){const Jh=_[wh],Hh=_[wh+1],Id=Jh.dist(Hh),jd=Hh.angleTo(Jh);for(;mh+S<nh+Id;){mh+=S;const wd=(mh-nh)/Id,Ud=mm(Jh.x,Hh.x,wd),Bf=mm(Jh.y,Hh.y,wd);if(Ud>=0&&Ud<ss&&Bf>=0&&Bf<ss&&mh-ul>=0&&mh+ul<=Ju){const Rf=new Wv(Ud,Bf,jd,wh);Rf._round(),j&&!F1(_,Rf,Ot,j,ut)||_h.push(Rf)}}nh+=Id}return kn||_h.length||fi||(_h=F0(_,nh/2,S,j,ut,Ot,fi,!0,ss)),_h}function b0(_,p,S,j,ut){const Ot=[];for(let fi=0;fi<_.length;fi++){const kn=_[fi];let ss;for(let ul=0;ul<kn.length-1;ul++){let Ju=kn[ul],nh=kn[ul+1];Ju.x<p&&nh.x<p||(Ju.x<p?Ju=new vd(p,Ju.y+(p-Ju.x)/(nh.x-Ju.x)*(nh.y-Ju.y))._round():nh.x<p&&(nh=new vd(p,Ju.y+(p-Ju.x)/(nh.x-Ju.x)*(nh.y-Ju.y))._round()),Ju.y<S&&nh.y<S||(Ju.y<S?Ju=new vd(Ju.x+(S-Ju.y)/(nh.y-Ju.y)*(nh.x-Ju.x),S)._round():nh.y<S&&(nh=new vd(Ju.x+(S-Ju.y)/(nh.y-Ju.y)*(nh.x-Ju.x),S)._round()),Ju.x>=j&&nh.x>=j||(Ju.x>=j?Ju=new vd(j,Ju.y+(j-Ju.x)/(nh.x-Ju.x)*(nh.y-Ju.y))._round():nh.x>=j&&(nh=new vd(j,Ju.y+(j-Ju.x)/(nh.x-Ju.x)*(nh.y-Ju.y))._round()),Ju.y>=ut&&nh.y>=ut||(Ju.y>=ut?Ju=new vd(Ju.x+(ut-Ju.y)/(nh.y-Ju.y)*(nh.x-Ju.x),ut)._round():nh.y>=ut&&(nh=new vd(Ju.x+(ut-Ju.y)/(nh.y-Ju.y)*(nh.x-Ju.x),ut)._round()),ss&&Ju.equals(ss[ss.length-1])||(ss=[Ju],Ot.push(ss)),ss.push(nh)))))}}return Ot}function Ry(_,p,S,j){const ut=[],Ot=_.image,fi=Ot.pixelRatio,kn=Ot.paddedRect.w-2,ss=Ot.paddedRect.h-2,ul=_.right-_.left,Ju=_.bottom-_.top,nh=Ot.stretchX||[[0,kn]],mh=Ot.stretchY||[[0,ss]],_h=(cp,xp)=>cp+xp[1]-xp[0],wh=nh.reduce(_h,0),Jh=mh.reduce(_h,0),Hh=kn-wh,Id=ss-Jh;let jd=0,wd=wh,Ud=0,Bf=Jh,Rf=0,Ep=Hh,Op=0,yp=Id;if(Ot.content&&j){const cp=Ot.content;jd=Zg(nh,0,cp[0]),Ud=Zg(mh,0,cp[1]),wd=Zg(nh,cp[0],cp[2]),Bf=Zg(mh,cp[1],cp[3]),Rf=cp[0]-jd,Op=cp[1]-Ud,Ep=cp[2]-cp[0]-wd,yp=cp[3]-cp[1]-Bf}const sp=(cp,xp,gp,Wf)=>{const Gp=Hg(cp.stretch-jd,wd,ul,_.left),Np=px(cp.fixed-Rf,Ep,cp.stretch,wh),hm=Hg(xp.stretch-Ud,Bf,Ju,_.top),og=px(xp.fixed-Op,yp,xp.stretch,Jh),Jm=Hg(gp.stretch-jd,wd,ul,_.left),Tg=px(gp.fixed-Rf,Ep,gp.stretch,wh),ny=Hg(Wf.stretch-Ud,Bf,Ju,_.top),E_=px(Wf.fixed-Op,yp,Wf.stretch,Jh),zg=new vd(Gp,hm),Ig=new vd(Jm,hm),Fg=new vd(Jm,ny),S_=new vd(Gp,ny),h_=new vd(Np/fi,og/fi),Dg=new vd(Tg/fi,E_/fi),T_=p*Math.PI/180;if(T_){const oy=Math.sin(T_),ay=Math.cos(T_),_g=[ay,-oy,oy,ay];zg._matMult(_g),Ig._matMult(_g),S_._matMult(_g),Fg._matMult(_g)}const I_=cp.stretch+cp.fixed,U_=xp.stretch+xp.fixed;return{tl:zg,tr:Ig,bl:S_,br:Fg,tex:{x:Ot.paddedRect.x+1+I_,y:Ot.paddedRect.y+1+U_,w:gp.stretch+gp.fixed-I_,h:Wf.stretch+Wf.fixed-U_},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:h_,pixelOffsetBR:Dg,minFontScaleX:Ep/fi/ul,minFontScaleY:yp/fi/Ju,isSDF:S}};if(j&&(Ot.stretchX||Ot.stretchY)){const cp=Mb(nh,Hh,wh),xp=Mb(mh,Id,Jh);for(let gp=0;gp<cp.length-1;gp++){const Wf=cp[gp],Gp=cp[gp+1];for(let Np=0;Np<xp.length-1;Np++)ut.push(sp(Wf,xp[Np],Gp,xp[Np+1]))}}else ut.push(sp({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:kn+1},{fixed:0,stretch:ss+1}));return ut}function Zg(_,p,S){let j=0;for(const ut of _)j+=Math.max(p,Math.min(S,ut[1]))-Math.max(p,Math.min(S,ut[0]));return j}function Mb(_,p,S){const j=[{fixed:-1,stretch:0}];for(const[ut,Ot]of _){const fi=j[j.length-1];j.push({fixed:ut-fi.stretch,stretch:fi.stretch}),j.push({fixed:ut-fi.stretch,stretch:fi.stretch+(Ot-ut)})}return j.push({fixed:p+1,stretch:S}),j}function Hg(_,p,S,j){return _/p*S+j}function px(_,p,S,j){return _-p*S/j}tp("Anchor",Wv);class Dv{constructor(p,S,j,ut,Ot,fi,kn,ss,ul,Ju){if(this.boxStartIndex=p.length,ul){let nh=fi.top,mh=fi.bottom;const _h=fi.collisionPadding;_h&&(nh-=_h[1],mh+=_h[3]);let wh=mh-nh;wh>0&&(wh=Math.max(10,wh),this.circleDiameter=wh)}else{let nh=fi.top*kn-ss[0],mh=fi.bottom*kn+ss[2],_h=fi.left*kn-ss[3],wh=fi.right*kn+ss[1];const Jh=fi.collisionPadding;if(Jh&&(_h-=Jh[0]*kn,nh-=Jh[1]*kn,wh+=Jh[2]*kn,mh+=Jh[3]*kn),Ju){const Hh=new vd(_h,nh),Id=new vd(wh,nh),jd=new vd(_h,mh),wd=new vd(wh,mh),Ud=Ju*Math.PI/180;Hh._rotate(Ud),Id._rotate(Ud),jd._rotate(Ud),wd._rotate(Ud),_h=Math.min(Hh.x,Id.x,jd.x,wd.x),wh=Math.max(Hh.x,Id.x,jd.x,wd.x),nh=Math.min(Hh.y,Id.y,jd.y,wd.y),mh=Math.max(Hh.y,Id.y,jd.y,wd.y)}p.emplaceBack(S.x,S.y,_h,nh,wh,mh,j,ut,Ot)}this.boxEndIndex=p.length}}class Ab{constructor(p=[],S=yw){if(this.data=p,this.length=this.data.length,this.compare=S,this.length>0)for(let j=(this.length>>1)-1;j>=0;j--)this._down(j)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const p=this.data[0],S=this.data.pop();return this.length--,this.length>0&&(this.data[0]=S,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:S,compare:j}=this,ut=S[p];for(;p>0;){const Ot=p-1>>1,fi=S[Ot];if(j(ut,fi)>=0)break;S[p]=fi,p=Ot}S[p]=ut}_down(p){const{data:S,compare:j}=this,ut=this.length>>1,Ot=S[p];for(;p<ut;){let fi=1+(p<<1),kn=S[fi];const ss=fi+1;if(ss<this.length&&j(S[ss],kn)<0&&(fi=ss,kn=S[ss]),j(kn,Ot)>=0)break;S[p]=kn,p=fi}S[p]=Ot}}function yw(_,p){return _<p?-1:_>p?1:0}function Pb(_,p=1,S=!1){let j=1/0,ut=1/0,Ot=-1/0,fi=-1/0;const kn=_[0];for(let _h=0;_h<kn.length;_h++){const wh=kn[_h];(!_h||wh.x<j)&&(j=wh.x),(!_h||wh.y<ut)&&(ut=wh.y),(!_h||wh.x>Ot)&&(Ot=wh.x),(!_h||wh.y>fi)&&(fi=wh.y)}const ss=Math.min(Ot-j,fi-ut);let ul=ss/2;const Ju=new Ab([],a2);if(ss===0)return new vd(j,ut);for(let _h=j;_h<Ot;_h+=ss)for(let wh=ut;wh<fi;wh+=ss)Ju.push(new Yv(_h+ul,wh+ul,ul,_));let nh=function(_h){let wh=0,Jh=0,Hh=0;const Id=_h[0];for(let jd=0,wd=Id.length,Ud=wd-1;jd<wd;Ud=jd++){const Bf=Id[jd],Rf=Id[Ud],Ep=Bf.x*Rf.y-Rf.x*Bf.y;Jh+=(Bf.x+Rf.x)*Ep,Hh+=(Bf.y+Rf.y)*Ep,wh+=3*Ep}return new Yv(Jh/wh,Hh/wh,0,_h)}(_),mh=Ju.length;for(;Ju.length;){const _h=Ju.pop();(_h.d>nh.d||!nh.d)&&(nh=_h,S&&console.log("found best %d after %d probes",Math.round(1e4*_h.d)/1e4,mh)),_h.max-nh.d<=p||(ul=_h.h/2,Ju.push(new Yv(_h.p.x-ul,_h.p.y-ul,ul,_)),Ju.push(new Yv(_h.p.x+ul,_h.p.y-ul,ul,_)),Ju.push(new Yv(_h.p.x-ul,_h.p.y+ul,ul,_)),Ju.push(new Yv(_h.p.x+ul,_h.p.y+ul,ul,_)),mh+=4)}return S&&(console.log(`num probes: ${mh}`),console.log(`best distance: ${nh.d}`)),nh.p}function a2(_,p){return p.max-_.max}function Yv(_,p,S,j){this.p=new vd(_,p),this.h=S,this.d=function(ut,Ot){let fi=!1,kn=1/0;for(let ss=0;ss<Ot.length;ss++){const ul=Ot[ss];for(let Ju=0,nh=ul.length,mh=nh-1;Ju<nh;mh=Ju++){const _h=ul[Ju],wh=ul[mh];_h.y>ut.y!=wh.y>ut.y&&ut.x<(wh.x-_h.x)*(ut.y-_h.y)/(wh.y-_h.y)+_h.x&&(fi=!fi),kn=Math.min(kn,Gd(ut,_h,wh))}}return(fi?1:-1)*Math.sqrt(kn)}(this.p,j),this.max=this.d+this.h*Math.SQRT2}const zx=Number.POSITIVE_INFINITY;function vw(_,p){return p[1]!==zx?function(S,j,ut){let Ot=0,fi=0;switch(j=Math.abs(j),ut=Math.abs(ut),S){case"top-right":case"top-left":case"top":fi=ut-7;break;case"bottom-right":case"bottom-left":case"bottom":fi=7-ut}switch(S){case"top-right":case"bottom-right":case"right":Ot=-j;break;case"top-left":case"bottom-left":case"left":Ot=j}return[Ot,fi]}(_,p[0],p[1]):function(S,j){let ut=0,Ot=0;j<0&&(j=0);const fi=j/Math.sqrt(2);switch(S){case"top-right":case"top-left":Ot=fi-7;break;case"bottom-right":case"bottom-left":Ot=7-fi;break;case"bottom":Ot=7-j;break;case"top":Ot=j-7}switch(S){case"top-right":case"bottom-right":ut=-fi;break;case"top-left":case"bottom-left":ut=fi;break;case"left":ut=j;break;case"right":ut=-j}return[ut,Ot]}(_,p[0])}function U0(_){switch(_){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function y1(_,p,S,j,ut,Ot,fi,kn,ss,ul,Ju){let nh=Ot.textMaxSize.evaluate(p,{});nh===void 0&&(nh=fi);const mh=_.layers[0].layout,_h=mh.get("icon-offset").evaluate(p,{},Ju),wh=Fx(S.horizontal),Jh=fi/24,Hh=_.tilePixelRatio*Jh,Id=_.tilePixelRatio*nh/24,jd=_.tilePixelRatio*kn,wd=_.tilePixelRatio*mh.get("symbol-spacing"),Ud=mh.get("text-padding")*_.tilePixelRatio,Bf=function(Wf,Gp,Np,hm=1){const og=Wf.get("icon-padding").evaluate(Gp,{},Np),Jm=og&&og.values;return[Jm[0]*hm,Jm[1]*hm,Jm[2]*hm,Jm[3]*hm]}(mh,p,Ju,_.tilePixelRatio),Rf=mh.get("text-max-angle")/180*Math.PI,Ep=mh.get("text-rotation-alignment")!=="viewport"&&mh.get("symbol-placement")!=="point",Op=mh.get("icon-rotation-alignment")==="map"&&mh.get("symbol-placement")!=="point",yp=mh.get("symbol-placement"),sp=wd/2,cp=mh.get("icon-text-fit");let xp;j&&cp!=="none"&&(_.allowVerticalPlacement&&S.vertical&&(xp=Nx(j,S.vertical,cp,mh.get("icon-text-fit-padding"),_h,Jh)),wh&&(j=Nx(j,wh,cp,mh.get("icon-text-fit-padding"),_h,Jh)));const gp=(Wf,Gp)=>{Gp.x<0||Gp.x>=yh||Gp.y<0||Gp.y>=yh||function(Np,hm,og,Jm,Tg,ny,E_,zg,Ig,Fg,S_,h_,Dg,T_,I_,U_,oy,ay,_g,d_,dm,Oy,f_,n_,n0){const dg=Np.addToLineVertexArray(hm,og);let vy,$y,sy,By,ly=0,Rv=0,xx=0,kw=0,Fb=-1,Ub=-1;const Ov={};let bx=ph(""),Vb=0,Yx=0;if(zg._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Vb,Yx]=zg.layout.get("text-offset").evaluate(dm,{},n_).map(C_=>C_*r_):(Vb=zg.layout.get("text-radial-offset").evaluate(dm,{},n_)*r_,Yx=zx),Np.allowVerticalPlacement&&Jm.vertical){const C_=zg.layout.get("text-rotate").evaluate(dm,{},n_)+90;sy=new Dv(Ig,hm,Fg,S_,h_,Jm.vertical,Dg,T_,I_,C_),E_&&(By=new Dv(Ig,hm,Fg,S_,h_,E_,oy,ay,I_,C_))}if(Tg){const C_=zg.layout.get("icon-rotate").evaluate(dm,{}),xy=zg.layout.get("icon-text-fit")!=="none",wx=Ry(Tg,C_,f_,xy),Ex=E_?Ry(E_,C_,f_,xy):void 0;$y=new Dv(Ig,hm,Fg,S_,h_,Tg,oy,ay,!1,C_),ly=4*wx.length;const q1=Np.iconSizeData;let w1=null;q1.kind==="source"?(w1=[cv*zg.layout.get("icon-size").evaluate(dm,{})],w1[0]>V0&&rl(`${Np.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):q1.kind==="composite"&&(w1=[cv*Oy.compositeIconSizes[0].evaluate(dm,{},n_),cv*Oy.compositeIconSizes[1].evaluate(dm,{},n_)],(w1[0]>V0||w1[1]>V0)&&rl(`${Np.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Np.addSymbols(Np.icon,wx,w1,d_,_g,dm,o.WritingMode.none,hm,dg.lineStartIndex,dg.lineLength,-1,n_),Fb=Np.icon.placedSymbolArray.length-1,Ex&&(Rv=4*Ex.length,Np.addSymbols(Np.icon,Ex,w1,d_,_g,dm,o.WritingMode.vertical,hm,dg.lineStartIndex,dg.lineLength,-1,n_),Ub=Np.icon.placedSymbolArray.length-1)}const Gb=Object.keys(Jm.horizontal);for(const C_ of Gb){const xy=Jm.horizontal[C_];if(!vy){bx=ph(xy.text);const Ex=zg.layout.get("text-rotate").evaluate(dm,{},n_);vy=new Dv(Ig,hm,Fg,S_,h_,xy,Dg,T_,I_,Ex)}const wx=xy.positionedLines.length===1;if(xx+=mx(Np,hm,xy,ny,zg,I_,dm,U_,dg,Jm.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,wx?Gb:[C_],Ov,Fb,Oy,n_),wx)break}Jm.vertical&&(kw+=mx(Np,hm,Jm.vertical,ny,zg,I_,dm,U_,dg,o.WritingMode.vertical,["vertical"],Ov,Ub,Oy,n_));const Dw=vy?vy.boxStartIndex:Np.collisionBoxArray.length,f2=vy?vy.boxEndIndex:Np.collisionBoxArray.length,p2=sy?sy.boxStartIndex:Np.collisionBoxArray.length,m2=sy?sy.boxEndIndex:Np.collisionBoxArray.length,g2=$y?$y.boxStartIndex:Np.collisionBoxArray.length,_2=$y?$y.boxEndIndex:Np.collisionBoxArray.length,Lw=By?By.boxStartIndex:Np.collisionBoxArray.length,y2=By?By.boxEndIndex:Np.collisionBoxArray.length;let Qm=-1;const Ny=(C_,xy)=>C_&&C_.circleDiameter?Math.max(C_.circleDiameter,xy):xy;Qm=Ny(vy,Qm),Qm=Ny(sy,Qm),Qm=Ny($y,Qm),Qm=Ny(By,Qm);const Jx=Qm>-1?1:0;Jx&&(Qm*=n0/r_),Np.glyphOffsetArray.length>=v1.MAX_GLYPHS&&rl("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dm.sortKey!==void 0&&Np.addToSortKeyRanges(Np.symbolInstances.length,dm.sortKey),Np.symbolInstances.emplaceBack(hm.x,hm.y,Ov.right>=0?Ov.right:-1,Ov.center>=0?Ov.center:-1,Ov.left>=0?Ov.left:-1,Ov.vertical||-1,Fb,Ub,bx,Dw,f2,p2,m2,g2,_2,Lw,y2,Fg,xx,kw,ly,Rv,Jx,0,Dg,Vb,Yx,Qm)}(_,Gp,Wf,S,j,ut,xp,_.layers[0],_.collisionBoxArray,p.index,p.sourceLayerIndex,_.index,Hh,[Ud,Ud,Ud,Ud],Ep,ss,jd,Bf,Op,_h,p,Ot,ul,Ju,fi)};if(yp==="line")for(const Wf of b0(p.geometry,0,0,yh,yh)){const Gp=uv(Wf,wd,Rf,S.vertical||wh,j,24,Id,_.overscaling,yh);for(const Np of Gp)wh&&xw(_,wh.text,sp,Np)||gp(Wf,Np)}else if(yp==="line-center"){for(const Wf of p.geometry)if(Wf.length>1){const Gp=Cb(Wf,Rf,S.vertical||wh,j,24,Id);Gp&&gp(Wf,Gp)}}else if(p.type==="Polygon")for(const Wf of ov(p.geometry,0)){const Gp=Pb(Wf,16);gp(Wf[0],new Wv(Gp.x,Gp.y,0))}else if(p.type==="LineString")for(const Wf of p.geometry)gp(Wf,new Wv(Wf[0].x,Wf[0].y,0));else if(p.type==="Point")for(const Wf of p.geometry)for(const Gp of Wf)gp([Gp],new Wv(Gp.x,Gp.y,0))}const V0=32640;function mx(_,p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh){const Jh=function(jd,wd,Ud,Bf,Rf,Ep,Op,yp){const sp=Bf.layout.get("text-rotate").evaluate(Ep,{})*Math.PI/180,cp=[];for(const xp of wd.positionedLines)for(const gp of xp.positionedGlyphs){if(!gp.rect)continue;const Wf=gp.rect||{};let Gp=4,Np=!0,hm=1,og=0;const Jm=(Rf||yp)&&gp.vertical,Tg=gp.metrics.advance*gp.scale/2;if(yp&&wd.verticalizable&&(og=xp.lineOffset/2-(gp.imageName?-(r_-gp.metrics.width*gp.scale)/2:(gp.scale-1)*r_)),gp.imageName){const _g=Op[gp.imageName];Np=_g.sdf,hm=_g.pixelRatio,Gp=1/hm}const ny=Rf?[gp.x+Tg,gp.y]:[0,0];let E_=Rf?[0,0]:[gp.x+Tg+Ud[0],gp.y+Ud[1]-og],zg=[0,0];Jm&&(zg=E_,E_=[0,0]);const Ig=(gp.metrics.left-Gp)*gp.scale-Tg+E_[0],Fg=(-gp.metrics.top-Gp)*gp.scale+E_[1],S_=Ig+Wf.w*gp.scale/hm,h_=Fg+Wf.h*gp.scale/hm,Dg=new vd(Ig,Fg),T_=new vd(S_,Fg),I_=new vd(Ig,h_),U_=new vd(S_,h_);if(Jm){const _g=new vd(-Tg,Tg-dx),d_=-Math.PI/2,dm=12-Tg,Oy=new vd(22-dm,-(gp.imageName?dm:0)),f_=new vd(...zg);Dg._rotateAround(d_,_g)._add(Oy)._add(f_),T_._rotateAround(d_,_g)._add(Oy)._add(f_),I_._rotateAround(d_,_g)._add(Oy)._add(f_),U_._rotateAround(d_,_g)._add(Oy)._add(f_)}if(sp){const _g=Math.sin(sp),d_=Math.cos(sp),dm=[d_,-_g,_g,d_];Dg._matMult(dm),T_._matMult(dm),I_._matMult(dm),U_._matMult(dm)}const oy=new vd(0,0),ay=new vd(0,0);cp.push({tl:Dg,tr:T_,bl:I_,br:U_,tex:Wf,writingMode:wd.writingMode,glyphOffset:ny,sectionIndex:gp.sectionIndex,isSDF:Np,pixelOffsetTL:oy,pixelOffsetBR:ay,minFontScaleX:0,minFontScaleY:0})}return cp}(0,S,kn,ut,Ot,fi,j,_.allowVerticalPlacement),Hh=_.textSizeData;let Id=null;Hh.kind==="source"?(Id=[cv*ut.layout.get("text-size").evaluate(fi,{})],Id[0]>V0&&rl(`${_.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Hh.kind==="composite"&&(Id=[cv*_h.compositeTextSizes[0].evaluate(fi,{},wh),cv*_h.compositeTextSizes[1].evaluate(fi,{},wh)],(Id[0]>V0||Id[1]>V0)&&rl(`${_.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),_.addSymbols(_.text,Jh,Id,kn,Ot,fi,ul,p,ss.lineStartIndex,ss.lineLength,mh,wh);for(const jd of Ju)nh[jd]=_.text.placedSymbolArray.length-1;return 4*Jh.length}function Fx(_){for(const p in _)return _[p];return null}function xw(_,p,S,j){const ut=_.compareText;if(p in ut){const Ot=ut[p];for(let fi=Ot.length-1;fi>=0;fi--)if(j.dist(Ot[fi])<S)return!0}else ut[p]=[];return ut[p].push(j),!1}const s2=Hv.VectorTileFeature.types,bw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ux(_,p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh){const _h=kn?Math.min(V0,Math.round(kn[0])):0,wh=kn?Math.min(V0,Math.round(kn[1])):0;_.emplaceBack(p,S,Math.round(32*j),Math.round(32*ut),Ot,fi,(_h<<1)+(ss?1:0),wh,16*ul,16*Ju,256*nh,256*mh)}function gx(_,p,S){_.emplaceBack(p.x,p.y,S),_.emplaceBack(p.x,p.y,S),_.emplaceBack(p.x,p.y,S),_.emplaceBack(p.x,p.y,S)}function l2(_){for(const p of _.sections)if(am(p.text))return!0;return!1}class _x{constructor(p){this.layoutVertexArray=new he,this.indexArray=new Ft,this.programConfigurations=p,this.segments=new us,this.dynamicLayoutVertexArray=new g,this.opacityVertexArray=new A,this.hasVisibleVertices=!1,this.placedSymbolArray=new Gv}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(p,S,j,ut){this.isEmpty()||(j&&(this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,Sg.members),this.indexBuffer=p.createIndexBuffer(this.indexArray,S),this.dynamicLayoutVertexBuffer=p.createVertexBuffer(this.dynamicLayoutVertexArray,hw.members,!0),this.opacityVertexBuffer=p.createVertexBuffer(this.opacityVertexArray,bw,!0),this.opacityVertexBuffer.itemSize=1),(j||ut)&&this.programConfigurations.upload(p))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tp("SymbolBuffers",_x);class Vx{constructor(p,S,j){this.layoutVertexArray=new p,this.layoutAttributes=S,this.indexArray=new j,this.segments=new us,this.collisionVertexArray=new _e}upload(p){this.layoutVertexBuffer=p.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=p.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=p.createVertexBuffer(this.collisionVertexArray,ux.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tp("CollisionBuffers",Vx);class v1{constructor(p){this.collisionBoxArray=p.collisionBoxArray,this.zoom=p.zoom,this.overscaling=p.overscaling,this.layers=p.layers,this.layerIds=this.layers.map(fi=>fi.id),this.index=p.index,this.pixelRatio=p.pixelRatio,this.sourceLayerIndex=p.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Fp([]),this.placementViewportMatrix=Fp([]);const S=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_w(this.zoom,S["text-size"]),this.iconSizeData=_w(this.zoom,S["icon-size"]);const j=this.layers[0].layout,ut=j.get("symbol-sort-key"),Ot=j.get("symbol-z-order");this.canOverlap=U1(j,"text-overlap","text-allow-overlap")!=="never"||U1(j,"icon-overlap","icon-allow-overlap")!=="never"||j.get("text-ignore-placement")||j.get("icon-ignore-placement"),this.sortFeaturesByKey=Ot!=="viewport-y"&&!ut.isConstant(),this.sortFeaturesByY=(Ot==="viewport-y"||Ot==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,j.get("symbol-placement")==="point"&&(this.writingModes=j.get("text-writing-mode").map(fi=>o.WritingMode[fi])),this.stateDependentLayerIds=this.layers.filter(fi=>fi.isStateDependent()).map(fi=>fi.id),this.sourceID=p.sourceID}createArrays(){this.text=new _x(new dh(this.layers,this.zoom,p=>/^text/.test(p))),this.icon=new _x(new dh(this.layers,this.zoom,p=>/^icon/.test(p))),this.glyphOffsetArray=new e0,this.lineVertexArray=new iv,this.symbolInstances=new a1}calculateGlyphDependencies(p,S,j,ut,Ot){for(let fi=0;fi<p.length;fi++)if(S[p.charCodeAt(fi)]=!0,(j||ut)&&Ot){const kn=D1[p.charAt(fi)];kn&&(S[kn.charCodeAt(0)]=!0)}}populate(p,S,j){const ut=this.layers[0],Ot=ut.layout,fi=Ot.get("text-font"),kn=Ot.get("text-field"),ss=Ot.get("icon-image"),ul=(kn.value.kind!=="constant"||kn.value.value instanceof Qh&&!kn.value.value.isEmpty()||kn.value.value.toString().length>0)&&(fi.value.kind!=="constant"||fi.value.value.length>0),Ju=ss.value.kind!=="constant"||!!ss.value.value||Object.keys(ss.parameters).length>0,nh=Ot.get("symbol-sort-key");if(this.features=[],!ul&&!Ju)return;const mh=S.iconDependencies,_h=S.glyphDependencies,wh=S.availableImages,Jh=new ym(this.zoom);for(const{feature:Hh,id:Id,index:jd,sourceLayerIndex:wd}of p){const Ud=ut._featureFilter.needGeometry,Bf=kh(Hh,Ud);if(!ut._featureFilter.filter(Jh,Bf,j))continue;let Rf,Ep;if(Ud||(Bf.geometry=bh(Hh)),ul){const yp=ut.getValueAndResolveTokens("text-field",Bf,j,wh),sp=Qh.factory(yp);l2(sp)&&(this.hasRTLText=!0),(!this.hasRTLText||fg()==="unavailable"||this.hasRTLText&&ug.isParsed())&&(Rf=r2(sp,ut,Bf))}if(Ju){const yp=ut.getValueAndResolveTokens("icon-image",Bf,j,wh);Ep=yp instanceof Fh?yp:Fh.fromString(yp)}if(!Rf&&!Ep)continue;const Op=this.sortFeaturesByKey?nh.evaluate(Bf,{},j):void 0;if(this.features.push({id:Id,text:Rf,icon:Ep,index:jd,sourceLayerIndex:wd,geometry:Bf.geometry,properties:Hh.properties,type:s2[Hh.type],sortKey:Op}),Ep&&(mh[Ep.name]=!0),Rf){const yp=fi.evaluate(Bf,{},j).join(","),sp=Ot.get("text-rotation-alignment")!=="viewport"&&Ot.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const cp of Rf.sections)if(cp.image)mh[cp.image.name]=!0;else{const xp=Yy(Rf.toString()),gp=cp.fontStack||yp,Wf=_h[gp]=_h[gp]||{};this.calculateGlyphDependencies(cp.text,Wf,sp,this.allowVerticalPlacement,xp)}}}Ot.get("symbol-placement")==="line"&&(this.features=function(Hh){const Id={},jd={},wd=[];let Ud=0;function Bf(yp){wd.push(Hh[yp]),Ud++}function Rf(yp,sp,cp){const xp=jd[yp];return delete jd[yp],jd[sp]=xp,wd[xp].geometry[0].pop(),wd[xp].geometry[0]=wd[xp].geometry[0].concat(cp[0]),xp}function Ep(yp,sp,cp){const xp=Id[sp];return delete Id[sp],Id[yp]=xp,wd[xp].geometry[0].shift(),wd[xp].geometry[0]=cp[0].concat(wd[xp].geometry[0]),xp}function Op(yp,sp,cp){const xp=cp?sp[0][sp[0].length-1]:sp[0][0];return`${yp}:${xp.x}:${xp.y}`}for(let yp=0;yp<Hh.length;yp++){const sp=Hh[yp],cp=sp.geometry,xp=sp.text?sp.text.toString():null;if(!xp){Bf(yp);continue}const gp=Op(xp,cp),Wf=Op(xp,cp,!0);if(gp in jd&&Wf in Id&&jd[gp]!==Id[Wf]){const Gp=Ep(gp,Wf,cp),Np=Rf(gp,Wf,wd[Gp].geometry);delete Id[gp],delete jd[Wf],jd[Op(xp,wd[Np].geometry,!0)]=Np,wd[Gp].geometry=null}else gp in jd?Rf(gp,Wf,cp):Wf in Id?Ep(gp,Wf,cp):(Bf(yp),Id[gp]=Ud-1,jd[Wf]=Ud-1)}return wd.filter(yp=>yp.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Hh,Id)=>Hh.sortKey-Id.sortKey)}update(p,S,j){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(p,S,this.layers,j),this.icon.programConfigurations.updatePaintArrays(p,S,this.layers,j))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(p){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(p),this.iconCollisionBox.upload(p)),this.text.upload(p,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(p,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(p,S){const j=this.lineVertexArray.length;if(p.segment!==void 0){let ut=p.dist(S[p.segment+1]),Ot=p.dist(S[p.segment]);const fi={};for(let kn=p.segment+1;kn<S.length;kn++)fi[kn]={x:S[kn].x,y:S[kn].y,tileUnitDistanceFromAnchor:ut},kn<S.length-1&&(ut+=S[kn+1].dist(S[kn]));for(let kn=p.segment||0;kn>=0;kn--)fi[kn]={x:S[kn].x,y:S[kn].y,tileUnitDistanceFromAnchor:Ot},kn>0&&(Ot+=S[kn-1].dist(S[kn]));for(let kn=0;kn<S.length;kn++){const ss=fi[kn];this.lineVertexArray.emplaceBack(ss.x,ss.y,ss.tileUnitDistanceFromAnchor)}}return{lineStartIndex:j,lineLength:this.lineVertexArray.length-j}}addSymbols(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh){const _h=p.indexArray,wh=p.layoutVertexArray,Jh=p.segments.prepareSegment(4*S.length,wh,_h,this.canOverlap?fi.sortKey:void 0),Hh=this.glyphOffsetArray.length,Id=Jh.vertexLength,jd=this.allowVerticalPlacement&&kn===o.WritingMode.vertical?Math.PI/2:0,wd=fi.text&&fi.text.sections;for(let Ud=0;Ud<S.length;Ud++){const{tl:Bf,tr:Rf,bl:Ep,br:Op,tex:yp,pixelOffsetTL:sp,pixelOffsetBR:cp,minFontScaleX:xp,minFontScaleY:gp,glyphOffset:Wf,isSDF:Gp,sectionIndex:Np}=S[Ud],hm=Jh.vertexLength,og=Wf[1];Ux(wh,ss.x,ss.y,Bf.x,og+Bf.y,yp.x,yp.y,j,Gp,sp.x,sp.y,xp,gp),Ux(wh,ss.x,ss.y,Rf.x,og+Rf.y,yp.x+yp.w,yp.y,j,Gp,cp.x,sp.y,xp,gp),Ux(wh,ss.x,ss.y,Ep.x,og+Ep.y,yp.x,yp.y+yp.h,j,Gp,sp.x,cp.y,xp,gp),Ux(wh,ss.x,ss.y,Op.x,og+Op.y,yp.x+yp.w,yp.y+yp.h,j,Gp,cp.x,cp.y,xp,gp),gx(p.dynamicLayoutVertexArray,ss,jd),_h.emplaceBack(hm,hm+1,hm+2),_h.emplaceBack(hm+1,hm+2,hm+3),Jh.vertexLength+=4,Jh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wf[0]),Ud!==S.length-1&&Np===S[Ud+1].sectionIndex||p.programConfigurations.populatePaintArrays(wh.length,fi,fi.index,{},mh,wd&&wd[Np])}p.placedSymbolArray.emplaceBack(ss.x,ss.y,Hh,this.glyphOffsetArray.length-Hh,Id,ul,Ju,ss.segment,j?j[0]:0,j?j[1]:0,ut[0],ut[1],kn,0,!1,0,nh)}_addCollisionDebugVertex(p,S,j,ut,Ot,fi){return S.emplaceBack(0,0),p.emplaceBack(j.x,j.y,ut,Ot,Math.round(fi.x),Math.round(fi.y))}addCollisionDebugVertices(p,S,j,ut,Ot,fi,kn){const ss=Ot.segments.prepareSegment(4,Ot.layoutVertexArray,Ot.indexArray),ul=ss.vertexLength,Ju=Ot.layoutVertexArray,nh=Ot.collisionVertexArray,mh=kn.anchorX,_h=kn.anchorY;this._addCollisionDebugVertex(Ju,nh,fi,mh,_h,new vd(p,S)),this._addCollisionDebugVertex(Ju,nh,fi,mh,_h,new vd(j,S)),this._addCollisionDebugVertex(Ju,nh,fi,mh,_h,new vd(j,ut)),this._addCollisionDebugVertex(Ju,nh,fi,mh,_h,new vd(p,ut)),ss.vertexLength+=4;const wh=Ot.indexArray;wh.emplaceBack(ul,ul+1),wh.emplaceBack(ul+1,ul+2),wh.emplaceBack(ul+2,ul+3),wh.emplaceBack(ul+3,ul),ss.primitiveLength+=4}addDebugCollisionBoxes(p,S,j,ut){for(let Ot=p;Ot<S;Ot++){const fi=this.collisionBoxArray.get(Ot);this.addCollisionDebugVertices(fi.x1,fi.y1,fi.x2,fi.y2,ut?this.textCollisionBox:this.iconCollisionBox,fi.anchorPoint,j)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vx(X,v0.members,Xr),this.iconCollisionBox=new Vx(X,v0.members,Xr);for(let p=0;p<this.symbolInstances.length;p++){const S=this.symbolInstances.get(p);this.addDebugCollisionBoxes(S.textBoxStartIndex,S.textBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.iconBoxStartIndex,S.iconBoxEndIndex,S,!1),this.addDebugCollisionBoxes(S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,!1)}}_deserializeCollisionBoxesForSymbol(p,S,j,ut,Ot,fi,kn,ss,ul){const Ju={};for(let nh=S;nh<j;nh++){const mh=p.get(nh);Ju.textBox={x1:mh.x1,y1:mh.y1,x2:mh.x2,y2:mh.y2,anchorPointX:mh.anchorPointX,anchorPointY:mh.anchorPointY},Ju.textFeatureIndex=mh.featureIndex;break}for(let nh=ut;nh<Ot;nh++){const mh=p.get(nh);Ju.verticalTextBox={x1:mh.x1,y1:mh.y1,x2:mh.x2,y2:mh.y2,anchorPointX:mh.anchorPointX,anchorPointY:mh.anchorPointY},Ju.verticalTextFeatureIndex=mh.featureIndex;break}for(let nh=fi;nh<kn;nh++){const mh=p.get(nh);Ju.iconBox={x1:mh.x1,y1:mh.y1,x2:mh.x2,y2:mh.y2,anchorPointX:mh.anchorPointX,anchorPointY:mh.anchorPointY},Ju.iconFeatureIndex=mh.featureIndex;break}for(let nh=ss;nh<ul;nh++){const mh=p.get(nh);Ju.verticalIconBox={x1:mh.x1,y1:mh.y1,x2:mh.x2,y2:mh.y2,anchorPointX:mh.anchorPointX,anchorPointY:mh.anchorPointY},Ju.verticalIconFeatureIndex=mh.featureIndex;break}return Ju}deserializeCollisionBoxes(p){this.collisionArrays=[];for(let S=0;S<this.symbolInstances.length;S++){const j=this.symbolInstances.get(S);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(p,j.textBoxStartIndex,j.textBoxEndIndex,j.verticalTextBoxStartIndex,j.verticalTextBoxEndIndex,j.iconBoxStartIndex,j.iconBoxEndIndex,j.verticalIconBoxStartIndex,j.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(p,S){const j=p.placedSymbolArray.get(S),ut=j.vertexStartIndex+4*j.numGlyphs;for(let Ot=j.vertexStartIndex;Ot<ut;Ot+=4)p.indexArray.emplaceBack(Ot,Ot+1,Ot+2),p.indexArray.emplaceBack(Ot+1,Ot+2,Ot+3)}getSortedSymbolIndexes(p){if(this.sortedAngle===p&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const S=Math.sin(p),j=Math.cos(p),ut=[],Ot=[],fi=[];for(let kn=0;kn<this.symbolInstances.length;++kn){fi.push(kn);const ss=this.symbolInstances.get(kn);ut.push(0|Math.round(S*ss.anchorX+j*ss.anchorY)),Ot.push(ss.featureIndex)}return fi.sort((kn,ss)=>ut[kn]-ut[ss]||Ot[ss]-Ot[kn]),fi}addToSortKeyRanges(p,S){const j=this.sortKeyRanges[this.sortKeyRanges.length-1];j&&j.sortKey===S?j.symbolInstanceEnd=p+1:this.sortKeyRanges.push({sortKey:S,symbolInstanceStart:p,symbolInstanceEnd:p+1})}sortFeatures(p){if(this.sortFeaturesByY&&this.sortedAngle!==p&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(p),this.sortedAngle=p,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const S of this.symbolInstanceIndexes){const j=this.symbolInstances.get(S);this.featureSortOrder.push(j.featureIndex),[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach((ut,Ot,fi)=>{ut>=0&&fi.indexOf(ut)===Ot&&this.addIndicesForPlacedSymbol(this.text,ut)}),j.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,j.verticalPlacedTextSymbolIndex),j.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,j.placedIconSymbolIndex),j.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,j.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tp("SymbolBucket",v1,{omit:["layers","collisionBoxArray","features","compareText"]}),v1.MAX_GLYPHS=65535,v1.addDynamicAttributes=gx;const x1=new Ng({"symbol-placement":new Pp(cd.layout_symbol["symbol-placement"]),"symbol-spacing":new Pp(cd.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pp(cd.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jp(cd.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pp(cd.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pp(cd.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Pp(cd.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Pp(cd.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pp(cd.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pp(cd.layout_symbol["icon-rotation-alignment"]),"icon-size":new jp(cd.layout_symbol["icon-size"]),"icon-text-fit":new Pp(cd.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pp(cd.layout_symbol["icon-text-fit-padding"]),"icon-image":new jp(cd.layout_symbol["icon-image"]),"icon-rotate":new jp(cd.layout_symbol["icon-rotate"]),"icon-padding":new jp(cd.layout_symbol["icon-padding"]),"icon-keep-upright":new Pp(cd.layout_symbol["icon-keep-upright"]),"icon-offset":new jp(cd.layout_symbol["icon-offset"]),"icon-anchor":new jp(cd.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pp(cd.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pp(cd.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pp(cd.layout_symbol["text-rotation-alignment"]),"text-field":new jp(cd.layout_symbol["text-field"]),"text-font":new jp(cd.layout_symbol["text-font"]),"text-size":new jp(cd.layout_symbol["text-size"]),"text-max-width":new jp(cd.layout_symbol["text-max-width"]),"text-line-height":new Pp(cd.layout_symbol["text-line-height"]),"text-letter-spacing":new jp(cd.layout_symbol["text-letter-spacing"]),"text-justify":new jp(cd.layout_symbol["text-justify"]),"text-radial-offset":new jp(cd.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pp(cd.layout_symbol["text-variable-anchor"]),"text-anchor":new jp(cd.layout_symbol["text-anchor"]),"text-max-angle":new Pp(cd.layout_symbol["text-max-angle"]),"text-writing-mode":new Pp(cd.layout_symbol["text-writing-mode"]),"text-rotate":new jp(cd.layout_symbol["text-rotate"]),"text-padding":new Pp(cd.layout_symbol["text-padding"]),"text-keep-upright":new Pp(cd.layout_symbol["text-keep-upright"]),"text-transform":new jp(cd.layout_symbol["text-transform"]),"text-offset":new jp(cd.layout_symbol["text-offset"]),"text-allow-overlap":new Pp(cd.layout_symbol["text-allow-overlap"]),"text-overlap":new Pp(cd.layout_symbol["text-overlap"]),"text-ignore-placement":new Pp(cd.layout_symbol["text-ignore-placement"]),"text-optional":new Pp(cd.layout_symbol["text-optional"])});var jx={paint:new Ng({"icon-opacity":new jp(cd.paint_symbol["icon-opacity"]),"icon-color":new jp(cd.paint_symbol["icon-color"]),"icon-halo-color":new jp(cd.paint_symbol["icon-halo-color"]),"icon-halo-width":new jp(cd.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jp(cd.paint_symbol["icon-halo-blur"]),"icon-translate":new Pp(cd.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pp(cd.paint_symbol["icon-translate-anchor"]),"text-opacity":new jp(cd.paint_symbol["text-opacity"]),"text-color":new jp(cd.paint_symbol["text-color"],{runtimeType:Jd,getOverride:_=>_.textColor,hasOverride:_=>!!_.textColor}),"text-halo-color":new jp(cd.paint_symbol["text-halo-color"]),"text-halo-width":new jp(cd.paint_symbol["text-halo-width"]),"text-halo-blur":new jp(cd.paint_symbol["text-halo-blur"]),"text-translate":new Pp(cd.paint_symbol["text-translate"]),"text-translate-anchor":new Pp(cd.paint_symbol["text-translate-anchor"])}),layout:x1};class ww{constructor(p){if(p.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=p.property.overrides?p.property.overrides.runtimeType:lp,this.defaultValue=p}evaluate(p){if(p.formattedSection){const S=this.defaultValue.property.overrides;if(S&&S.hasOverride(p.formattedSection))return S.getOverride(p.formattedSection)}return p.feature&&p.featureState?this.defaultValue.evaluate(p.feature,p.featureState):this.defaultValue.property.specification.default}eachChild(p){this.defaultValue.isConstant()||p(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tp("FormatSectionOverride",ww,{omit:["defaultValue"]});class Lv extends w_{constructor(p){super(p,jx)}recalculate(p,S){if(super.recalculate(p,S),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const j=this.layout.get("text-writing-mode");if(j){const ut=[];for(const Ot of j)ut.indexOf(Ot)<0&&ut.push(Ot);this.layout._values["text-writing-mode"]=ut}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(p,S,j,ut){const Ot=this.layout.get(p).evaluate(S,{},j,ut),fi=this._unevaluatedLayout._values[p];return fi.isDataDriven()||Hy(fi.value)||!Ot?Ot:function(kn,ss){return ss.replace(/{([^{}]+)}/g,(ul,Ju)=>Ju in kn?String(kn[Ju]):"")}(S.properties,Ot)}createBucket(p){return new v1(p)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const p of jx.paint.overridableProperties){if(!Lv.hasPaintOverride(this.layout,p))continue;const S=this.paint.get(p),j=new ww(S),ut=new Zy(j,S.property.specification);let Ot=null;Ot=S.value.kind==="constant"||S.value.kind==="source"?new Cy("source",ut):new c0("composite",ut,S.value.zoomStops),this.paint._values[p]=new b_(S.property,Ot,S.parameters)}}_handleOverridablePaintPropertyUpdate(p,S,j){return!(!this.layout||S.isDataDriven()||j.isDataDriven())&&Lv.hasPaintOverride(this.layout,p)}static hasPaintOverride(p,S){const j=p.get("text-field"),ut=jx.paint.properties[S];let Ot=!1;const fi=kn=>{for(const ss of kn)if(ut.overrides&&ut.overrides.hasOverride(ss))return void(Ot=!0)};if(j.value.kind==="constant"&&j.value.value instanceof Qh)fi(j.value.value.sections);else if(j.value.kind==="source"){const kn=ul=>{Ot||(ul instanceof ol&&nl(ul.value)===Sf?fi(ul.value.sections):ul instanceof Sy?fi(ul.sections):ul.eachChild(kn))},ss=j.value;ss._styleExpression&&kn(ss._styleExpression.expression)}return Ot}}function U1(_,p,S){let j="never";const ut=_.get(p);return ut?j=ut:_.get(S)&&(j="always"),j}var Ew={paint:new Ng({"background-color":new Pp(cd.paint_background["background-color"]),"background-pattern":new d0(cd.paint_background["background-pattern"]),"background-opacity":new Pp(cd.paint_background["background-opacity"])})},Sw={paint:new Ng({"raster-opacity":new Pp(cd.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pp(cd.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pp(cd.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pp(cd.paint_raster["raster-brightness-max"]),"raster-saturation":new Pp(cd.paint_raster["raster-saturation"]),"raster-contrast":new Pp(cd.paint_raster["raster-contrast"]),"raster-resampling":new Pp(cd.paint_raster["raster-resampling"]),"raster-fade-duration":new Pp(cd.paint_raster["raster-fade-duration"])})};class c2 extends w_{constructor(p){super(p,{}),this.onAdd=S=>{this.implementation.onAdd&&this.implementation.onAdd(S,S.painter.context.gl)},this.onRemove=S=>{this.implementation.onRemove&&this.implementation.onRemove(S,S.painter.context.gl)},this.implementation=p}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const u2={circle:class extends w_{constructor(_){super(_,Lp)}createBucket(_){return new rd(_)}queryRadius(_){const p=_;return yf("circle-radius",this,p)+yf("circle-stroke-width",this,p)+zf(this.paint.get("circle-translate"))}queryIntersectsFeature(_,p,S,j,ut,Ot,fi,kn){const ss=Pf(_,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),Ot.angle,fi),ul=this.paint.get("circle-radius").evaluate(p,S)+this.paint.get("circle-stroke-width").evaluate(p,S),Ju=this.paint.get("circle-pitch-alignment")==="map",nh=Ju?ss:function(_h,wh){return _h.map(Jh=>Lm(Jh,wh))}(ss,kn),mh=Ju?ul*fi:ul;for(const _h of j)for(const wh of _h){const Jh=Ju?wh:Lm(wh,kn);let Hh=mh;const Id=_m([],[wh.x,wh.y,0,1],kn);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Hh*=Id[3]/Ot.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Hh*=Ot.cameraToCenterDistance/Id[3]),ld(nh,Jh,Hh))return!0}return!1}},heatmap:class extends w_{createBucket(_){return new Rm(_)}constructor(_){super(_,Vm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(_){_==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Om({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends w_{constructor(_){super(_,vm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends w_{constructor(_){super(_,Qw)}recalculate(_,p){super.recalculate(_,p);const S=this.paint._values["fill-outline-color"];S.value.kind==="constant"&&S.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(_){return new db(_)}queryRadius(){return zf(this.paint.get("fill-translate"))}queryIntersectsFeature(_,p,S,j,ut,Ot,fi){return dd(Pf(_,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),Ot.angle,fi),j)}isTileClipped(){return!0}},"fill-extrusion":class extends w_{constructor(_){super(_,t2)}createBucket(_){return new A1(_)}queryRadius(){return zf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(_,p,S,j,ut,Ot,fi,kn){const ss=Pf(_,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),Ot.angle,fi),ul=this.paint.get("fill-extrusion-height").evaluate(p,S),Ju=this.paint.get("fill-extrusion-base").evaluate(p,S),nh=function(_h,wh,Jh,Hh){const Id=[];for(const jd of _h){const wd=[jd.x,jd.y,0,1];_m(wd,wd,wh),Id.push(new vd(wd[0]/wd[3],wd[1]/wd[3]))}return Id}(ss,kn),mh=function(_h,wh,Jh,Hh){const Id=[],jd=[],wd=Hh[8]*wh,Ud=Hh[9]*wh,Bf=Hh[10]*wh,Rf=Hh[11]*wh,Ep=Hh[8]*Jh,Op=Hh[9]*Jh,yp=Hh[10]*Jh,sp=Hh[11]*Jh;for(const cp of _h){const xp=[],gp=[];for(const Wf of cp){const Gp=Wf.x,Np=Wf.y,hm=Hh[0]*Gp+Hh[4]*Np+Hh[12],og=Hh[1]*Gp+Hh[5]*Np+Hh[13],Jm=Hh[2]*Gp+Hh[6]*Np+Hh[14],Tg=Hh[3]*Gp+Hh[7]*Np+Hh[15],ny=Jm+Bf,E_=Tg+Rf,zg=hm+Ep,Ig=og+Op,Fg=Jm+yp,S_=Tg+sp,h_=new vd((hm+wd)/E_,(og+Ud)/E_);h_.z=ny/E_,xp.push(h_);const Dg=new vd(zg/S_,Ig/S_);Dg.z=Fg/S_,gp.push(Dg)}Id.push(xp),jd.push(gp)}return[Id,jd]}(j,Ju,ul,kn);return function(_h,wh,Jh){let Hh=1/0;dd(Jh,wh)&&(Hh=gb(Jh,wh[0]));for(let Id=0;Id<wh.length;Id++){const jd=wh[Id],wd=_h[Id];for(let Ud=0;Ud<jd.length-1;Ud++){const Bf=jd[Ud],Rf=[Bf,jd[Ud+1],wd[Ud+1],wd[Ud],Bf];sd(Jh,Rf)&&(Hh=Math.min(Hh,gb(Jh,Rf)))}}return Hh!==1/0&&Hh}(mh[0],mh[1],nh)}},line:class extends w_{constructor(_){super(_,z_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(_){_==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof s0,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(_,p){super.recalculate(_,p),this.paint._values["line-floorwidth"]=i0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,_)}createBucket(_){return new _y(_)}queryRadius(_){const p=_,S=Dx(yf("line-width",this,p),yf("line-gap-width",this,p)),j=yf("line-offset",this,p);return S/2+Math.abs(j)+zf(this.paint.get("line-translate"))}queryIntersectsFeature(_,p,S,j,ut,Ot,fi){const kn=Pf(_,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),Ot.angle,fi),ss=fi/2*Dx(this.paint.get("line-width").evaluate(p,S),this.paint.get("line-gap-width").evaluate(p,S)),ul=this.paint.get("line-offset").evaluate(p,S);return ul&&(j=function(Ju,nh){const mh=[];for(let _h=0;_h<Ju.length;_h++){const wh=Ju[_h],Jh=[];for(let Hh=0;Hh<wh.length;Hh++){const Id=wh[Hh-1],jd=wh[Hh],wd=wh[Hh+1],Ud=Hh===0?new vd(0,0):jd.sub(Id)._unit()._perp(),Bf=Hh===wh.length-1?new vd(0,0):wd.sub(jd)._unit()._perp(),Rf=Ud._add(Bf)._unit(),Ep=Rf.x*Bf.x+Rf.y*Bf.y;Ep!==0&&Rf._mult(1/Ep),Jh.push(Rf._mult(nh)._add(jd))}mh.push(Jh)}return mh}(j,ul*fi)),function(Ju,nh,mh){for(let _h=0;_h<nh.length;_h++){const wh=nh[_h];if(Ju.length>=3){for(let Jh=0;Jh<wh.length;Jh++)if(Lf(Ju,wh[Jh]))return!0}if(ud(Ju,wh,mh))return!0}return!1}(kn,j,ss)}isTileClipped(){return!0}},symbol:Lv,background:class extends w_{constructor(_){super(_,Ew)}},raster:class extends w_{constructor(_){super(_,Sw)}}};class Tw{constructor(p){this._callback=p,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const kb=63710088e-1;class gg{constructor(p,S){if(isNaN(p)||isNaN(S))throw new Error(`Invalid LngLat object: (${p}, ${S})`);if(this.lng=+p,this.lat=+S,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new gg(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(p){const S=Math.PI/180,j=this.lat*S,ut=p.lat*S,Ot=Math.sin(j)*Math.sin(ut)+Math.cos(j)*Math.cos(ut)*Math.cos((p.lng-this.lng)*S);return kb*Math.acos(Math.min(Ot,1))}toBounds(p=0){const S=360*p/40075017,j=S/Math.cos(Math.PI/180*this.lat);return new Iw(new gg(this.lng-j,this.lat-S),new gg(this.lng+j,this.lat+S))}static convert(p){if(p instanceof gg)return p;if(Array.isArray(p)&&(p.length===2||p.length===3))return new gg(Number(p[0]),Number(p[1]));if(!Array.isArray(p)&&typeof p=="object"&&p!==null)return new gg(Number("lng"in p?p.lng:p.lon),Number(p.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class V1{constructor(p,S){p&&(S?this.setSouthWest(p).setNorthEast(S):p.length===4?this.setSouthWest([p[0],p[1]]).setNorthEast([p[2],p[3]]):this.setSouthWest(p[0]).setNorthEast(p[1]))}setNorthEast(p){return this._ne=p instanceof gg?new gg(p.lng,p.lat):gg.convert(p),this}setSouthWest(p){return this._sw=p instanceof gg?new gg(p.lng,p.lat):gg.convert(p),this}extend(p){const S=this._sw,j=this._ne;let ut,Ot;if(p instanceof gg)ut=p,Ot=p;else{if(!(p instanceof V1))return Array.isArray(p)?p.length===4||p.every(Array.isArray)?this.extend(V1.convert(p)):this.extend(gg.convert(p)):this;if(ut=p._sw,Ot=p._ne,!ut||!Ot)return this}return S||j?(S.lng=Math.min(ut.lng,S.lng),S.lat=Math.min(ut.lat,S.lat),j.lng=Math.max(Ot.lng,j.lng),j.lat=Math.max(Ot.lat,j.lat)):(this._sw=new gg(ut.lng,ut.lat),this._ne=new gg(Ot.lng,Ot.lat)),this}getCenter(){return new gg((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new gg(this.getWest(),this.getNorth())}getSouthEast(){return new gg(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(p){const{lng:S,lat:j}=gg.convert(p);let ut=this._sw.lng<=S&&S<=this._ne.lng;return this._sw.lng>this._ne.lng&&(ut=this._sw.lng>=S&&S>=this._ne.lng),this._sw.lat<=j&&j<=this._ne.lat&&ut}static convert(p){return p instanceof V1?p:p&&new V1(p)}}var Iw=V1;const Db=2*Math.PI*kb;function Lb(_){return Db*Math.cos(_*Math.PI/180)}function Rb(_){return(180+_)/360}function qx(_){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_*Math.PI/360)))/360}function hv(_,p){return _/Lb(p)}function ry(_){return 360/Math.PI*Math.atan(Math.exp((180-360*_)*Math.PI/180))-90}class Zx{constructor(p,S,j=0){this.x=+p,this.y=+S,this.z=+j}static fromLngLat(p,S=0){const j=gg.convert(p);return new Zx(Rb(j.lng),qx(j.lat),hv(S,j.lat))}toLngLat(){return new gg(360*this.x-180,ry(this.y))}toAltitude(){return this.z*Lb(ry(this.y))}meterInMercatorCoordinateUnits(){return 1/Db*(p=ry(this.y),1/Math.cos(p*Math.PI/180));var p}}function Hx(_,p,S){var j=2*Math.PI*6378137/256/Math.pow(2,S);return[_*j-2*Math.PI*6378137/2,p*j-2*Math.PI*6378137/2]}class Ob{constructor(p,S,j){if(p<0||p>25||j<0||j>=Math.pow(2,p)||S<0||S>=Math.pow(2,p))throw new Error(`x=${S}, y=${j}, z=${p} outside of bounds. 0<=x<${Math.pow(2,p)}, 0<=y<${Math.pow(2,p)} 0<=z<=25 `);this.z=p,this.x=S,this.y=j,this.key=b1(0,p,p,S,j)}equals(p){return this.z===p.z&&this.x===p.x&&this.y===p.y}url(p,S,j){const ut=(fi=this.y,kn=this.z,ss=Hx(256*(Ot=this.x),256*(fi=Math.pow(2,kn)-fi-1),kn),ul=Hx(256*(Ot+1),256*(fi+1),kn),ss[0]+","+ss[1]+","+ul[0]+","+ul[1]);var Ot,fi,kn,ss,ul;const Ju=function(nh,mh,_h){let wh,Jh="";for(let Hh=nh;Hh>0;Hh--)wh=1<<Hh-1,Jh+=(mh&wh?1:0)+(_h&wh?2:0);return Jh}(this.z,this.x,this.y);return p[(this.x+this.y)%p.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(j==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,S>1?"@2x":"").replace(/{quadkey}/g,Ju).replace(/{bbox-epsg-3857}/g,ut)}isChildOf(p){const S=this.z-p.z;return S>0&&p.x===this.x>>S&&p.y===this.y>>S}getTilePoint(p){const S=Math.pow(2,this.z);return new vd((p.x*S-this.x)*yh,(p.y*S-this.y)*yh)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cw{constructor(p,S){this.wrap=p,this.canonical=S,this.key=b1(p,S.z,S.z,S.x,S.y)}}class r0{constructor(p,S,j,ut,Ot){if(p<j)throw new Error(`overscaledZ should be >= z; overscaledZ = ${p}; z = ${j}`);this.overscaledZ=p,this.wrap=S,this.canonical=new Ob(j,+ut,+Ot),this.key=b1(S,p,j,ut,Ot)}clone(){return new r0(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(p){return this.overscaledZ===p.overscaledZ&&this.wrap===p.wrap&&this.canonical.equals(p.canonical)}scaledTo(p){if(p>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${p}; overscaledZ = ${this.overscaledZ}`);const S=this.canonical.z-p;return p>this.canonical.z?new r0(p,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new r0(p,this.wrap,p,this.canonical.x>>S,this.canonical.y>>S)}calculateScaledKey(p,S){if(p>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${p}; overscaledZ = ${this.overscaledZ}`);const j=this.canonical.z-p;return p>this.canonical.z?b1(this.wrap*+S,p,this.canonical.z,this.canonical.x,this.canonical.y):b1(this.wrap*+S,p,p,this.canonical.x>>j,this.canonical.y>>j)}isChildOf(p){if(p.wrap!==this.wrap)return!1;const S=this.canonical.z-p.canonical.z;return p.overscaledZ===0||p.overscaledZ<this.overscaledZ&&p.canonical.x===this.canonical.x>>S&&p.canonical.y===this.canonical.y>>S}children(p){if(this.overscaledZ>=p)return[new r0(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const S=this.canonical.z+1,j=2*this.canonical.x,ut=2*this.canonical.y;return[new r0(S,this.wrap,S,j,ut),new r0(S,this.wrap,S,j+1,ut),new r0(S,this.wrap,S,j,ut+1),new r0(S,this.wrap,S,j+1,ut+1)]}isLessThan(p){return this.wrap<p.wrap||!(this.wrap>p.wrap)&&(this.overscaledZ<p.overscaledZ||!(this.overscaledZ>p.overscaledZ)&&(this.canonical.x<p.canonical.x||!(this.canonical.x>p.canonical.x)&&this.canonical.y<p.canonical.y))}wrapped(){return new r0(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(p){return new r0(this.overscaledZ,p,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(p){return this.canonical.getTilePoint(new Zx(p.x-this.wrap,p.y))}}function b1(_,p,S,j,ut){(_*=2)<0&&(_=-1*_-1);const Ot=1<<S;return(Ot*Ot*_+Ot*ut+j).toString(36)+S.toString(36)+p.toString(36)}tp("CanonicalTileID",Ob),tp("OverscaledTileID",r0,{omit:["posMatrix"]});class yx{constructor(p,S,j){if(this.uid=p,S.height!==S.width)throw new RangeError("DEM tiles must be square");if(j&&j!=="mapbox"&&j!=="terrarium")return void rl(`"${j}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=S.height;const ut=this.dim=S.height-2;this.data=new Uint32Array(S.data.buffer),this.encoding=j||"mapbox";for(let Ot=0;Ot<ut;Ot++)this.data[this._idx(-1,Ot)]=this.data[this._idx(0,Ot)],this.data[this._idx(ut,Ot)]=this.data[this._idx(ut-1,Ot)],this.data[this._idx(Ot,-1)]=this.data[this._idx(Ot,0)],this.data[this._idx(Ot,ut)]=this.data[this._idx(Ot,ut-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ut,-1)]=this.data[this._idx(ut-1,0)],this.data[this._idx(-1,ut)]=this.data[this._idx(0,ut-1)],this.data[this._idx(ut,ut)]=this.data[this._idx(ut-1,ut-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Ot=0;Ot<ut;Ot++)for(let fi=0;fi<ut;fi++){const kn=this.get(Ot,fi);kn>this.max&&(this.max=kn),kn<this.min&&(this.min=kn)}}get(p,S){const j=new Uint8Array(this.data.buffer),ut=4*this._idx(p,S);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(j[ut],j[ut+1],j[ut+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(p,S){if(p<-1||p>=this.dim+1||S<-1||S>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(S+1)*this.stride+(p+1)}_unpackMapbox(p,S,j){return(256*p*256+256*S+j)/10-1e4}_unpackTerrarium(p,S,j){return 256*p+S+j/256-32768}getPixels(){return new pm({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(p,S,j){if(this.dim!==p.dim)throw new Error("dem dimension mismatch");let ut=S*this.dim,Ot=S*this.dim+this.dim,fi=j*this.dim,kn=j*this.dim+this.dim;switch(S){case-1:ut=Ot-1;break;case 1:Ot=ut+1}switch(j){case-1:fi=kn-1;break;case 1:kn=fi+1}const ss=-S*this.dim,ul=-j*this.dim;for(let Ju=fi;Ju<kn;Ju++)for(let nh=ut;nh<Ot;nh++)this.data[this._idx(nh,Ju)]=p.data[this._idx(nh+ss,Ju+ul)]}}tp("DEMData",yx);class $b{constructor(p){this._stringToNumber={},this._numberToString=[];for(let S=0;S<p.length;S++){const j=p[S];this._stringToNumber[j]=S,this._numberToString[S]=j}}encode(p){return this._stringToNumber[p]}decode(p){if(p>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${p} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[p]}}class Jv{constructor(p,S,j,ut,Ot){this.type="Feature",this._vectorTileFeature=p,p._z=S,p._x=j,p._y=ut,this.properties=p.properties,this.id=Ot}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(p){this._geometry=p}toJSON(){const p={geometry:this.geometry};for(const S in this)S!=="_geometry"&&S!=="_vectorTileFeature"&&(p[S]=this[S]);return p}}class G1{constructor(p,S){this.tileID=p,this.x=p.canonical.x,this.y=p.canonical.y,this.z=p.canonical.z,this.grid=new Ag(yh,16,0),this.grid3D=new Ag(yh,16,0),this.featureIndexArray=new jg,this.promoteId=S}insert(p,S,j,ut,Ot,fi){const kn=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(j,ut,Ot);const ss=fi?this.grid3D:this.grid;for(let ul=0;ul<S.length;ul++){const Ju=S[ul],nh=[1/0,1/0,-1/0,-1/0];for(let mh=0;mh<Ju.length;mh++){const _h=Ju[mh];nh[0]=Math.min(nh[0],_h.x),nh[1]=Math.min(nh[1],_h.y),nh[2]=Math.max(nh[2],_h.x),nh[3]=Math.max(nh[3],_h.y)}nh[0]<yh&&nh[1]<yh&&nh[2]>=0&&nh[3]>=0&&ss.insert(kn,nh[0],nh[1],nh[2],nh[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hv.VectorTile(new Av(this.rawTileData)).layers,this.sourceLayerCoder=new $b(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(p,S,j,ut){this.loadVTLayers();const Ot=p.params||{},fi=yh/p.tileSize/p.scale,kn=im(Ot.filter),ss=p.queryGeometry,ul=p.queryPadding*fi,Ju=Aw(ss),nh=this.grid.query(Ju.minX-ul,Ju.minY-ul,Ju.maxX+ul,Ju.maxY+ul),mh=Aw(p.cameraQueryGeometry),_h=this.grid3D.query(mh.minX-ul,mh.minY-ul,mh.maxX+ul,mh.maxY+ul,(Hh,Id,jd,wd)=>function(Ud,Bf,Rf,Ep,Op){for(const sp of Ud)if(Bf<=sp.x&&Rf<=sp.y&&Ep>=sp.x&&Op>=sp.y)return!0;const yp=[new vd(Bf,Rf),new vd(Bf,Op),new vd(Ep,Op),new vd(Ep,Rf)];if(Ud.length>2){for(const sp of yp)if(Lf(Ud,sp))return!0}for(let sp=0;sp<Ud.length-1;sp++)if(Dd(Ud[sp],Ud[sp+1],yp))return!0;return!1}(p.cameraQueryGeometry,Hh-ul,Id-ul,jd+ul,wd+ul));for(const Hh of _h)nh.push(Hh);nh.sort(h2);const wh={};let Jh;for(let Hh=0;Hh<nh.length;Hh++){const Id=nh[Hh];if(Id===Jh)continue;Jh=Id;const jd=this.featureIndexArray.get(Id);let wd=null;this.loadMatchingFeature(wh,jd.bucketIndex,jd.sourceLayerIndex,jd.featureIndex,kn,Ot.layers,Ot.availableImages,S,j,ut,(Ud,Bf,Rf)=>(wd||(wd=bh(Ud)),Bf.queryIntersectsFeature(ss,Ud,Rf,wd,this.z,p.transform,fi,p.pixelPosMatrix)))}return wh}loadMatchingFeature(p,S,j,ut,Ot,fi,kn,ss,ul,Ju,nh){const mh=this.bucketLayerIDs[S];if(fi&&!function(Hh,Id){for(let jd=0;jd<Hh.length;jd++)if(Id.indexOf(Hh[jd])>=0)return!0;return!1}(fi,mh))return;const _h=this.sourceLayerCoder.decode(j),wh=this.vtLayers[_h].feature(ut);if(Ot.needGeometry){const Hh=kh(wh,!0);if(!Ot.filter(new ym(this.tileID.overscaledZ),Hh,this.tileID.canonical))return}else if(!Ot.filter(new ym(this.tileID.overscaledZ),wh))return;const Jh=this.getId(wh,_h);for(let Hh=0;Hh<mh.length;Hh++){const Id=mh[Hh];if(fi&&fi.indexOf(Id)<0)continue;const jd=ss[Id];if(!jd)continue;let wd={};Jh&&Ju&&(wd=Ju.getState(jd.sourceLayer||"_geojsonTileLayer",Jh));const Ud=Bt({},ul[Id]);Ud.paint=Mw(Ud.paint,jd.paint,wh,wd,kn),Ud.layout=Mw(Ud.layout,jd.layout,wh,wd,kn);const Bf=!nh||nh(wh,jd,wd);if(!Bf)continue;const Rf=new Jv(wh,this.z,this.x,this.y,Jh);Rf.layer=Ud;let Ep=p[Id];Ep===void 0&&(Ep=p[Id]=[]),Ep.push({featureIndex:ut,feature:Rf,intersectionZ:Bf})}}lookupSymbolFeatures(p,S,j,ut,Ot,fi,kn,ss){const ul={};this.loadVTLayers();const Ju=im(Ot);for(const nh of p)this.loadMatchingFeature(ul,j,ut,nh,Ju,fi,kn,ss,S);return ul}hasLayer(p){for(const S of this.bucketLayerIDs)for(const j of S)if(p===j)return!0;return!1}getId(p,S){let j=p.id;return this.promoteId&&(j=p.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[S]],typeof j=="boolean"&&(j=Number(j))),j}}function Mw(_,p,S,j,ut){return Fn(_,(Ot,fi)=>{const kn=p instanceof Q_?p.get(fi):null;return kn&&kn.evaluate?kn.evaluate(S,j,ut):kn})}function Aw(_){let p=1/0,S=1/0,j=-1/0,ut=-1/0;for(const Ot of _)p=Math.min(p,Ot.x),S=Math.min(S,Ot.y),j=Math.max(j,Ot.x),ut=Math.max(ut,Ot.y);return{minX:p,minY:S,maxX:j,maxY:ut}}function h2(_,p){return p-_}function Bb(_,p,S,j,ut,Ot){if(ut-j<=S)return;const fi=j+ut>>1;Pw(_,p,fi,j,ut,Ot%2),Bb(_,p,S,j,fi-1,Ot+1),Bb(_,p,S,fi+1,ut,Ot+1)}function Pw(_,p,S,j,ut,Ot){for(;ut>j;){if(ut-j>600){const ul=ut-j+1,Ju=S-j+1,nh=Math.log(ul),mh=.5*Math.exp(2*nh/3),_h=.5*Math.sqrt(nh*mh*(ul-mh)/ul)*(Ju-ul/2<0?-1:1);Pw(_,p,S,Math.max(j,Math.floor(S-Ju*mh/ul+_h)),Math.min(ut,Math.floor(S+(ul-Ju)*mh/ul+_h)),Ot)}const fi=p[2*S+Ot];let kn=j,ss=ut;for(vx(_,p,j,S),p[2*ut+Ot]>fi&&vx(_,p,j,ut);kn<ss;){for(vx(_,p,kn,ss),kn++,ss--;p[2*kn+Ot]<fi;)kn++;for(;p[2*ss+Ot]>fi;)ss--}p[2*j+Ot]===fi?vx(_,p,j,ss):(ss++,vx(_,p,ss,ut)),ss<=S&&(j=ss+1),S<=ss&&(ut=ss-1)}}function vx(_,p,S,j){Nb(_,S,j),Nb(p,2*S,2*j),Nb(p,2*S+1,2*j+1)}function Nb(_,p,S){const j=_[p];_[p]=_[S],_[S]=j}function Xx(_,p,S,j){const ut=_-S,Ot=p-j;return ut*ut+Ot*Ot}tp("FeatureIndex",G1,{omit:["rawTileData","sourceLayerCoder"]});const d2=_=>_[0],j1=_=>_[1];var zb;o.PerformanceMarkers=void 0,(zb=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",zb.load="load",zb.fullLoad="fullLoad";let hg=null,Qv=[];const Kx=1e3/30,Wx={mark(_){performance.mark(_)},frame(_){const p=_;hg!=null&&Qv.push(p-hg),hg=p},clearMetrics(){hg=null,Qv=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const _ in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[_])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const _=performance.getEntriesByName("loadTime")[0].duration,p=performance.getEntriesByName("fullLoadTime")[0].duration,S=Qv.length,j=1/(Qv.reduce((Ot,fi)=>Ot+fi,0)/S/1e3),ut=Qv.filter(Ot=>Ot>Kx).reduce((Ot,fi)=>Ot+(fi-Kx)/Kx,0);return{loadTime:_,fullLoadTime:p,fps:j,percentDroppedFrames:ut/(S+ut)*100}}};o.AJAXError=Cf,o.ARRAY_TYPE=fp,o.Actor=class{constructor(_,p,S){this.target=_,this.parent=p,this.mapId=S,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_n(["receive","process"],this),this.invoker=new Tw(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ju()?_:window}send(_,p,S,j,ut=!1){const Ot=Math.round(1e18*Math.random()).toString(36).substring(0,10);S&&(this.callbacks[Ot]=S);const fi=sl(this.globalScope)?void 0:[];return this.target.postMessage({id:Ot,type:_,hasCallback:!!S,targetMapId:j,mustQueue:ut,sourceMapId:this.mapId,data:Bg(p,fi)},fi),{cancel:()=>{S&&delete this.callbacks[Ot],this.target.postMessage({id:Ot,type:"<cancel>",targetMapId:j,sourceMapId:this.mapId})}}}receive(_){const p=_.data,S=p.id;if(S&&(!p.targetMapId||this.mapId===p.targetMapId))if(p.type==="<cancel>"){delete this.tasks[S];const j=this.cancelCallbacks[S];delete this.cancelCallbacks[S],j&&j()}else ju()||p.mustQueue?(this.tasks[S]=p,this.taskQueue.push(S),this.invoker.trigger()):this.processTask(S,p)}process(){if(!this.taskQueue.length)return;const _=this.taskQueue.shift(),p=this.tasks[_];delete this.tasks[_],this.taskQueue.length&&this.invoker.trigger(),p&&this.processTask(_,p)}processTask(_,p){if(p.type==="<response>"){const S=this.callbacks[_];delete this.callbacks[_],S&&(p.error?S(Zm(p.error)):S(null,Zm(p.data)))}else{let S=!1;const j=sl(this.globalScope)?void 0:[],ut=p.hasCallback?(kn,ss)=>{S=!0,delete this.cancelCallbacks[_],this.target.postMessage({id:_,type:"<response>",sourceMapId:this.mapId,error:kn?Bg(kn):null,data:Bg(ss,j)},j)}:kn=>{S=!0};let Ot=null;const fi=Zm(p.data);if(this.parent[p.type])Ot=this.parent[p.type](p.sourceMapId,fi,ut);else if(this.parent.getWorkerSource){const kn=p.type.split(".");Ot=this.parent.getWorkerSource(p.sourceMapId,kn[0],fi.source)[kn[1]](fi,ut)}else ut(new Error(`Could not find function ${p.type}`));!S&&Ot&&Ot.cancel&&(this.cancelCallbacks[_]=Ot.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=ty,o.CanonicalTileID=Ob,o.CollisionBoxArray=Dy,o.CollisionCircleLayoutArray=class extends m0{},o.Color=ih,o.DEMData=yx,o.DataConstantProperty=Pp,o.DictionaryCoder=$b,o.EXTENT=yh,o.ErrorEvent=wf,o.EvaluationParameters=ym,o.Event=Kd,o.Evented=kd,o.FeatureIndex=G1,o.FillBucket=db,o.FillExtrusionBucket=A1,o.GeoJSONFeature=Jv,o.ImageAtlas=Kv,o.ImagePosition=x0,o.KDBush=class{constructor(_,p=d2,S=j1,j=64,ut=Float64Array){this.nodeSize=j,this.points=_;const Ot=_.length<65536?Uint16Array:Uint32Array,fi=this.ids=new Ot(_.length),kn=this.coords=new ut(2*_.length);for(let ss=0;ss<_.length;ss++)fi[ss]=ss,kn[2*ss]=p(_[ss]),kn[2*ss+1]=S(_[ss]);Bb(fi,kn,j,0,fi.length-1,0)}range(_,p,S,j){return function(ut,Ot,fi,kn,ss,ul,Ju){const nh=[0,ut.length-1,0],mh=[];let _h,wh;for(;nh.length;){const Jh=nh.pop(),Hh=nh.pop(),Id=nh.pop();if(Hh-Id<=Ju){for(let Ud=Id;Ud<=Hh;Ud++)_h=Ot[2*Ud],wh=Ot[2*Ud+1],_h>=fi&&_h<=ss&&wh>=kn&&wh<=ul&&mh.push(ut[Ud]);continue}const jd=Math.floor((Id+Hh)/2);_h=Ot[2*jd],wh=Ot[2*jd+1],_h>=fi&&_h<=ss&&wh>=kn&&wh<=ul&&mh.push(ut[jd]);const wd=(Jh+1)%2;(Jh===0?fi<=_h:kn<=wh)&&(nh.push(Id),nh.push(jd-1),nh.push(wd)),(Jh===0?ss>=_h:ul>=wh)&&(nh.push(jd+1),nh.push(Hh),nh.push(wd))}return mh}(this.ids,this.coords,_,p,S,j,this.nodeSize)}within(_,p,S){return function(j,ut,Ot,fi,kn,ss){const ul=[0,j.length-1,0],Ju=[],nh=kn*kn;for(;ul.length;){const mh=ul.pop(),_h=ul.pop(),wh=ul.pop();if(_h-wh<=ss){for(let wd=wh;wd<=_h;wd++)Xx(ut[2*wd],ut[2*wd+1],Ot,fi)<=nh&&Ju.push(j[wd]);continue}const Jh=Math.floor((wh+_h)/2),Hh=ut[2*Jh],Id=ut[2*Jh+1];Xx(Hh,Id,Ot,fi)<=nh&&Ju.push(j[Jh]);const jd=(mh+1)%2;(mh===0?Ot-kn<=Hh:fi-kn<=Id)&&(ul.push(wh),ul.push(Jh-1),ul.push(jd)),(mh===0?Ot+kn>=Hh:fi+kn>=Id)&&(ul.push(Jh+1),ul.push(_h),ul.push(jd))}return Ju}(this.ids,this.coords,_,p,S,this.nodeSize)}},o.LineBucket=_y,o.LineStripIndexArray=class extends wv{},o.LngLat=gg,o.LngLatBounds=Iw,o.MercatorCoordinate=Zx,o.ONE_EM=r_,o.OverscaledTileID=r0,o.PerformanceUtils=Wx,o.Pos3dArray=class extends mg{},o.PosArray=s1,o.Properties=Ng,o.QuadTriangleArray=class extends tv{},o.RGBAImage=pm,o.RasterBoundsArray=class extends ky{},o.RequestPerformance=class{constructor(_){this._marks={start:[_.url,"start"].join("#"),end:[_.url,"end"].join("#"),measure:_.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let _=performance.getEntriesByName(this._marks.measure);return _.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),_=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),_}},o.SegmentVector=us,o.SymbolBucket=v1,o.Transitionable=k0,o.TriangleIndexArray=Ft,o.Uniform1f=u,o.Uniform1i=class extends L{constructor(_,p){super(_,p),this.current=0}set(_){this.current!==_&&(this.current=_,this.gl.uniform1i(this.location,_))}},o.Uniform2f=class extends L{constructor(_,p){super(_,p),this.current=[0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]||(this.current=_,this.gl.uniform2f(this.location,_[0],_[1]))}},o.Uniform3f=class extends L{constructor(_,p){super(_,p),this.current=[0,0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]&&_[2]===this.current[2]||(this.current=_,this.gl.uniform3f(this.location,_[0],_[1],_[2]))}},o.Uniform4f=E,o.UniformColor=B,o.UniformMatrix4f=class extends L{constructor(_,p){super(_,p),this.current=Y}set(_){if(_[12]!==this.current[12]||_[0]!==this.current[0])return this.current=_,void this.gl.uniformMatrix4fv(this.location,!1,_);for(let p=1;p<16;p++)if(_[p]!==this.current[p]){this.current=_,this.gl.uniformMatrix4fv(this.location,!1,_);break}}},o.UnwrappedTileID=Cw,o.ValidationError=gd,o.ZoomHistory=R_,o.addDynamicAttributes=gx,o.arrayBufferToImage=function(_,p){const S=new Image;S.onload=()=>{p(null,S),URL.revokeObjectURL(S.src),S.onload=null,window.requestAnimationFrame(()=>{S.src=hh})},S.onerror=()=>p(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(_)],{type:"image/png"});S.src=_.byteLength?URL.createObjectURL(j):hh},o.arrayBufferToImageBitmap=function(_,p){const S=new Blob([new Uint8Array(_)],{type:"image/png"});createImageBitmap(S).then(j=>{p(null,j)}).catch(j=>{p(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(_,p,S){if(!_.length)return S(null,[]);let j=_.length;const ut=new Array(_.length);let Ot=null;_.forEach((fi,kn)=>{p(fi,(ss,ul)=>{ss&&(Ot=ss),ut[kn]=ul,--j==0&&S(Ot,ut)})})},o.bezier=P,o.bindAll=_n,o.clamp=nt,o.clipLine=b0,o.clone=function(_){var p=new fp(16);return p[0]=_[0],p[1]=_[1],p[2]=_[2],p[3]=_[3],p[4]=_[4],p[5]=_[5],p[6]=_[6],p[7]=_[7],p[8]=_[8],p[9]=_[9],p[10]=_[10],p[11]=_[11],p[12]=_[12],p[13]=_[13],p[14]=_[14],p[15]=_[15],p},o.clone$1=Io,o.collisionCircleLayout=i2,o.config=Cd,o.copy=function(_,p){return _[0]=p[0],_[1]=p[1],_[2]=p[2],_[3]=p[3],_[4]=p[4],_[5]=p[5],_[6]=p[6],_[7]=p[7],_[8]=p[8],_[9]=p[9],_[10]=p[10],_[11]=p[11],_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15],_},o.create=function(){var _=new fp(16);return fp!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},o.createExpression=H_,o.createFilter=im,o.createLayout=pg,o.createStyleLayer=function(_){return _.type==="custom"?new c2(_):new u2[_.type](_)},o.dot=function(_,p){return _[0]*p[0]+_[1]*p[1]+_[2]*p[2]+_[3]*p[3]},o.earthRadius=kb,o.ease=ge,o.emitValidationErrors=Um,o.equals=function(_,p){var S=_[0],j=_[1],ut=_[2],Ot=_[3],fi=_[4],kn=_[5],ss=_[6],ul=_[7],Ju=_[8],nh=_[9],mh=_[10],_h=_[11],wh=_[12],Jh=_[13],Hh=_[14],Id=_[15],jd=p[0],wd=p[1],Ud=p[2],Bf=p[3],Rf=p[4],Ep=p[5],Op=p[6],yp=p[7],sp=p[8],cp=p[9],xp=p[10],gp=p[11],Wf=p[12],Gp=p[13],Np=p[14],hm=p[15];return Math.abs(S-jd)<=Mp*Math.max(1,Math.abs(S),Math.abs(jd))&&Math.abs(j-wd)<=Mp*Math.max(1,Math.abs(j),Math.abs(wd))&&Math.abs(ut-Ud)<=Mp*Math.max(1,Math.abs(ut),Math.abs(Ud))&&Math.abs(Ot-Bf)<=Mp*Math.max(1,Math.abs(Ot),Math.abs(Bf))&&Math.abs(fi-Rf)<=Mp*Math.max(1,Math.abs(fi),Math.abs(Rf))&&Math.abs(kn-Ep)<=Mp*Math.max(1,Math.abs(kn),Math.abs(Ep))&&Math.abs(ss-Op)<=Mp*Math.max(1,Math.abs(ss),Math.abs(Op))&&Math.abs(ul-yp)<=Mp*Math.max(1,Math.abs(ul),Math.abs(yp))&&Math.abs(Ju-sp)<=Mp*Math.max(1,Math.abs(Ju),Math.abs(sp))&&Math.abs(nh-cp)<=Mp*Math.max(1,Math.abs(nh),Math.abs(cp))&&Math.abs(mh-xp)<=Mp*Math.max(1,Math.abs(mh),Math.abs(xp))&&Math.abs(_h-gp)<=Mp*Math.max(1,Math.abs(_h),Math.abs(gp))&&Math.abs(wh-Wf)<=Mp*Math.max(1,Math.abs(wh),Math.abs(Wf))&&Math.abs(Jh-Gp)<=Mp*Math.max(1,Math.abs(Jh),Math.abs(Gp))&&Math.abs(Hh-Np)<=Mp*Math.max(1,Math.abs(Hh),Math.abs(Np))&&Math.abs(Id-hm)<=Mp*Math.max(1,Math.abs(Id),Math.abs(hm))},o.evaluateSizeForFeature=function(_,{uSize:p,uSizeT:S},{lowerSize:j,upperSize:ut}){return _.kind==="source"?j/cv:_.kind==="composite"?mm(j/cv,ut/cv,S):p},o.evaluateSizeForZoom=function(_,p){let S=0,j=0;if(_.kind==="constant")j=_.layoutSize;else if(_.kind!=="source"){const{interpolationType:ut,minZoom:Ot,maxZoom:fi}=_,kn=ut?nt(Kp.interpolationFactor(ut,p,Ot,fi),0,1):0;_.kind==="camera"?j=mm(_.minSize,_.maxSize,kn):S=kn}return{uSizeT:S,uSize:j}},o.evaluateVariableOffset=vw,o.evented=fy,o.exported=hd,o.extend=Bt,o.filterObject=tl,o.fromScaling=function(_,p){return _[0]=p[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=p[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=p[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},o.getAnchorAlignment=Bx,o.getAnchorJustification=U0,o.getArrayBuffer=xd,o.getJSON=function(_,p){return Hd(Bt(_,{type:"json"}),p)},o.getOverlapMode=U1,o.getRTLTextPluginStatus=fg,o.getReferrer=Sd,o.getVideo=function(_,p){const S=window.document.createElement("video");S.muted=!0,S.onloadstart=function(){p(null,S)};for(let j=0;j<_.length;j++){const ut=window.document.createElement("source");Pd(_[j])||(S.crossOrigin="Anonymous"),ut.src=_[j],S.appendChild(ut)}return{cancel:()=>{}}},o.identity=Fp,o.invert=function(_,p){var S=p[0],j=p[1],ut=p[2],Ot=p[3],fi=p[4],kn=p[5],ss=p[6],ul=p[7],Ju=p[8],nh=p[9],mh=p[10],_h=p[11],wh=p[12],Jh=p[13],Hh=p[14],Id=p[15],jd=S*kn-j*fi,wd=S*ss-ut*fi,Ud=S*ul-Ot*fi,Bf=j*ss-ut*kn,Rf=j*ul-Ot*kn,Ep=ut*ul-Ot*ss,Op=Ju*Jh-nh*wh,yp=Ju*Hh-mh*wh,sp=Ju*Id-_h*wh,cp=nh*Hh-mh*Jh,xp=nh*Id-_h*Jh,gp=mh*Id-_h*Hh,Wf=jd*gp-wd*xp+Ud*cp+Bf*sp-Rf*yp+Ep*Op;return Wf?(_[0]=(kn*gp-ss*xp+ul*cp)*(Wf=1/Wf),_[1]=(ut*xp-j*gp-Ot*cp)*Wf,_[2]=(Jh*Ep-Hh*Rf+Id*Bf)*Wf,_[3]=(mh*Rf-nh*Ep-_h*Bf)*Wf,_[4]=(ss*sp-fi*gp-ul*yp)*Wf,_[5]=(S*gp-ut*sp+Ot*yp)*Wf,_[6]=(Hh*Ud-wh*Ep-Id*wd)*Wf,_[7]=(Ju*Ep-mh*Ud+_h*wd)*Wf,_[8]=(fi*xp-kn*sp+ul*Op)*Wf,_[9]=(j*sp-S*xp-Ot*Op)*Wf,_[10]=(wh*Rf-Jh*Ud+Id*jd)*Wf,_[11]=(nh*Ud-Ju*Rf-_h*jd)*Wf,_[12]=(kn*yp-fi*cp-ss*Op)*Wf,_[13]=(S*cp-j*yp+ut*Op)*Wf,_[14]=(Jh*wd-wh*Bf-Hh*jd)*Wf,_[15]=(Ju*Bf-nh*wd+mh*jd)*Wf,_):null},o.isImageBitmap=oh,o.isSafari=sl,o.isWorker=ju,o.keysDifference=function(_,p){const S=[];for(const j in _)j in p||S.push(j);return S},o.lazyLoadRTLTextPlugin=function(){ug.isLoading()||ug.isLoaded()||fg()!=="deferred"||Ay()},o.makeRequest=Hd,o.mapObject=Fn,o.mercatorXfromLng=Rb,o.mercatorYfromLat=qx,o.mercatorZfromAltitude=hv,o.mul=kp,o.mul$1=function(_,p,S){return _[0]=p[0]*S[0],_[1]=p[1]*S[1],_[2]=p[2]*S[2],_[3]=p[3]*S[3],_},o.multiply=cm,o.nextPowerOfTwo=function(_){return _<=1?1:Math.pow(2,Math.ceil(Math.log(_)/Math.LN2))},o.number=mm,o.ortho=function(_,p,S,j,ut,Ot,fi){var kn=1/(p-S),ss=1/(j-ut),ul=1/(Ot-fi);return _[0]=-2*kn,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*ss,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*ul,_[11]=0,_[12]=(p+S)*kn,_[13]=(ut+j)*ss,_[14]=(fi+Ot)*ul,_[15]=1,_},o.parseCacheControl=function(_){const p={};if(_.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(S,j,ut,Ot)=>{const fi=ut||Ot;return p[j]=!fi||fi.toLowerCase(),""}),p["max-age"]){const S=parseInt(p["max-age"],10);isNaN(S)?delete p["max-age"]:p["max-age"]=S}return p},o.parseGlyphPbf=function(_){return new Av(_).readFields(Rx,[])},o.pbf=Av,o.performSymbolLayout=function(_){_.bucket.createArrays(),_.bucket.tilePixelRatio=yh/(512*_.bucket.overscaling),_.bucket.compareText={},_.bucket.iconsNeedLinear=!1;const p=_.bucket.layers[0].layout,S=_.bucket.layers[0]._unevaluatedLayout._values,j={layoutIconSize:S["icon-size"].possiblyEvaluate(new ym(_.bucket.zoom+1),_.canonical),layoutTextSize:S["text-size"].possiblyEvaluate(new ym(_.bucket.zoom+1),_.canonical),textMaxSize:S["text-size"].possiblyEvaluate(new ym(18))};if(_.bucket.textSizeData.kind==="composite"){const{minZoom:ss,maxZoom:ul}=_.bucket.textSizeData;j.compositeTextSizes=[S["text-size"].possiblyEvaluate(new ym(ss),_.canonical),S["text-size"].possiblyEvaluate(new ym(ul),_.canonical)]}if(_.bucket.iconSizeData.kind==="composite"){const{minZoom:ss,maxZoom:ul}=_.bucket.iconSizeData;j.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new ym(ss),_.canonical),S["icon-size"].possiblyEvaluate(new ym(ul),_.canonical)]}const ut=p.get("text-line-height")*r_,Ot=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point",fi=p.get("text-keep-upright"),kn=p.get("text-size");for(const ss of _.bucket.features){const ul=p.get("text-font").evaluate(ss,{},_.canonical).join(","),Ju=kn.evaluate(ss,{},_.canonical),nh=j.layoutTextSize.evaluate(ss,{},_.canonical),mh=j.layoutIconSize.evaluate(ss,{},_.canonical),_h={horizontal:{},vertical:void 0},wh=ss.text;let Jh,Hh=[0,0];if(wh){const wd=wh.toString(),Ud=p.get("text-letter-spacing").evaluate(ss,{},_.canonical)*r_,Bf=O_(wd)?Ud:0,Rf=p.get("text-anchor").evaluate(ss,{},_.canonical),Ep=p.get("text-variable-anchor");if(!Ep){const xp=p.get("text-radial-offset").evaluate(ss,{},_.canonical);Hh=xp?vw(Rf,[xp*r_,zx]):p.get("text-offset").evaluate(ss,{},_.canonical).map(gp=>gp*r_)}let Op=Ot?"center":p.get("text-justify").evaluate(ss,{},_.canonical);const yp=p.get("symbol-placement"),sp=yp==="point"?p.get("text-max-width").evaluate(ss,{},_.canonical)*r_:0,cp=()=>{_.bucket.allowVerticalPlacement&&Yy(wd)&&(_h.vertical=g1(wh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,sp,ut,Rf,"left",Bf,Hh,o.WritingMode.vertical,!0,yp,nh,Ju))};if(!Ot&&Ep){const xp=Op==="auto"?Ep.map(Wf=>U0(Wf)):[Op];let gp=!1;for(let Wf=0;Wf<xp.length;Wf++){const Gp=xp[Wf];if(!_h.horizontal[Gp])if(gp)_h.horizontal[Gp]=_h.horizontal[0];else{const Np=g1(wh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,sp,ut,"center",Gp,Bf,Hh,o.WritingMode.horizontal,!1,yp,nh,Ju);Np&&(_h.horizontal[Gp]=Np,gp=Np.positionedLines.length===1)}}cp()}else{Op==="auto"&&(Op=U0(Rf));const xp=g1(wh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,sp,ut,Rf,Op,Bf,Hh,o.WritingMode.horizontal,!1,yp,nh,Ju);xp&&(_h.horizontal[Op]=xp),cp(),Yy(wd)&&Ot&&fi&&(_h.vertical=g1(wh,_.glyphMap,_.glyphPositions,_.imagePositions,ul,sp,ut,Rf,Op,Bf,Hh,o.WritingMode.vertical,!1,yp,nh,Ju))}}let Id=!1;if(ss.icon&&ss.icon.name){const wd=_.imageMap[ss.icon.name];wd&&(Jh=gw(_.imagePositions[ss.icon.name],p.get("icon-offset").evaluate(ss,{},_.canonical),p.get("icon-anchor").evaluate(ss,{},_.canonical)),Id=!!wd.sdf,_.bucket.sdfIcons===void 0?_.bucket.sdfIcons=Id:_.bucket.sdfIcons!==Id&&rl("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wd.pixelRatio!==_.bucket.pixelRatio||p.get("icon-rotate").constantOr(1)!==0)&&(_.bucket.iconsNeedLinear=!0))}const jd=Fx(_h.horizontal)||_h.vertical;_.bucket.iconsInText=!!jd&&jd.iconsInText,(jd||Jh)&&y1(_.bucket,ss,_h,Jh,_.imageMap,j,nh,mh,Hh,Id,_.canonical)}_.showCollisionBoxes&&_.bucket.generateCollisionDebugBuffers()},o.perspective=function(_,p,S,j,ut){var Ot,fi=1/Math.tan(p/2);return _[0]=fi/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=fi,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,ut!=null&&ut!==1/0?(_[10]=(ut+j)*(Ot=1/(j-ut)),_[14]=2*ut*j*Ot):(_[10]=-1,_[14]=-2*j),_},o.pick=function(_,p){const S={};for(let j=0;j<p.length;j++){const ut=p[j];ut in _&&(S[ut]=_[ut])}return S},o.plugin=ug,o.pointGeometry=vd,o.polygonIntersectsPolygon=sd,o.potpack=Ox,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=tp,o.registerForPluginStateChange=function(_){return _({pluginStatus:bm,pluginURL:cg}),fy.on("pluginStateChange",_),_},o.renderColorRamp=Om,o.rotateX=function(_,p,S){var j=Math.sin(S),ut=Math.cos(S),Ot=p[4],fi=p[5],kn=p[6],ss=p[7],ul=p[8],Ju=p[9],nh=p[10],mh=p[11];return p!==_&&(_[0]=p[0],_[1]=p[1],_[2]=p[2],_[3]=p[3],_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15]),_[4]=Ot*ut+ul*j,_[5]=fi*ut+Ju*j,_[6]=kn*ut+nh*j,_[7]=ss*ut+mh*j,_[8]=ul*ut-Ot*j,_[9]=Ju*ut-fi*j,_[10]=nh*ut-kn*j,_[11]=mh*ut-ss*j,_},o.rotateZ=function(_,p,S){var j=Math.sin(S),ut=Math.cos(S),Ot=p[0],fi=p[1],kn=p[2],ss=p[3],ul=p[4],Ju=p[5],nh=p[6],mh=p[7];return p!==_&&(_[8]=p[8],_[9]=p[9],_[10]=p[10],_[11]=p[11],_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15]),_[0]=Ot*ut+ul*j,_[1]=fi*ut+Ju*j,_[2]=kn*ut+nh*j,_[3]=ss*ut+mh*j,_[4]=ul*ut-Ot*j,_[5]=Ju*ut-fi*j,_[6]=nh*ut-kn*j,_[7]=mh*ut-ss*j,_},o.scale=function(_,p,S){var j=S[0],ut=S[1],Ot=S[2];return _[0]=p[0]*j,_[1]=p[1]*j,_[2]=p[2]*j,_[3]=p[3]*j,_[4]=p[4]*ut,_[5]=p[5]*ut,_[6]=p[6]*ut,_[7]=p[7]*ut,_[8]=p[8]*Ot,_[9]=p[9]*Ot,_[10]=p[10]*Ot,_[11]=p[11]*Ot,_[12]=p[12],_[13]=p[13],_[14]=p[14],_[15]=p[15],_},o.setRTLTextPlugin=function(_,p,S=!1){if(bm===y_||bm===Vg||bm===h0)throw new Error("setRTLTextPlugin cannot be called multiple times.");cg=hd.resolveURL(_),bm=y_,Gg=p,v_(),S||Ay()},o.spec=cd,o.sphericalToCartesian=function([_,p,S]){return p+=90,p*=Math.PI/180,S*=Math.PI/180,{x:_*Math.cos(p)*Math.sin(S),y:_*Math.sin(p)*Math.sin(S),z:_*Math.cos(S)}},o.toEvaluationFeature=kh,o.transformMat4=_m,o.translate=function(_,p,S){var j,ut,Ot,fi,kn,ss,ul,Ju,nh,mh,_h,wh,Jh=S[0],Hh=S[1],Id=S[2];return p===_?(_[12]=p[0]*Jh+p[4]*Hh+p[8]*Id+p[12],_[13]=p[1]*Jh+p[5]*Hh+p[9]*Id+p[13],_[14]=p[2]*Jh+p[6]*Hh+p[10]*Id+p[14],_[15]=p[3]*Jh+p[7]*Hh+p[11]*Id+p[15]):(ut=p[1],Ot=p[2],fi=p[3],kn=p[4],ss=p[5],ul=p[6],Ju=p[7],nh=p[8],mh=p[9],_h=p[10],wh=p[11],_[0]=j=p[0],_[1]=ut,_[2]=Ot,_[3]=fi,_[4]=kn,_[5]=ss,_[6]=ul,_[7]=Ju,_[8]=nh,_[9]=mh,_[10]=_h,_[11]=wh,_[12]=j*Jh+kn*Hh+nh*Id+p[12],_[13]=ut*Jh+ss*Hh+mh*Id+p[13],_[14]=Ot*Jh+ul*Hh+_h*Id+p[14],_[15]=fi*Jh+Ju*Hh+wh*Id+p[15]),_},o.triggerPluginCompletionEvent=Pg,o.unicodeBlockLookup=ip,o.uniqueId=function(){return qr++},o.validateCustomStyleLayer=function(_){const p=[],S=_.id;return S===void 0&&p.push({message:`layers.${S}: missing required property "id"`}),_.render===void 0&&p.push({message:`layers.${S}: missing required method "render"`}),_.renderingMode&&_.renderingMode!=="2d"&&_.renderingMode!=="3d"&&p.push({message:`layers.${S}: property "renderingMode" must be either "2d" or "3d"`}),p},o.validateLight=Fm,o.validateStyle=Dp,o.vectorTile=Hv,o.warnOnce=rl,o.wrap=ze}),s(["./shared"],function(o){function x(nl){const Zs=typeof nl;if(Zs==="number"||Zs==="boolean"||Zs==="string"||nl==null)return JSON.stringify(nl);if(Array.isArray(nl)){let xh="[";for(const Mh of nl)xh+=`${x(Mh)},`;return`${xh}]`}const ol=Object.keys(nl).sort();let sh="{";for(let xh=0;xh<ol.length;xh++)sh+=`${JSON.stringify(ol[xh])}:${x(nl[ol[xh]])},`;return`${sh}}`}function C(nl){let Zs="";for(const ol of o.refProperties)Zs+=`/${x(nl[ol])}`;return Zs}class P{constructor(Zs){this.keyCache={},Zs&&this.replace(Zs)}replace(Zs){this._layerConfigs={},this._layers={},this.update(Zs,[])}update(Zs,ol){for(const xh of Zs){this._layerConfigs[xh.id]=xh;const Mh=this._layers[xh.id]=o.createStyleLayer(xh);Mh._featureFilter=o.createFilter(Mh.filter),this.keyCache[xh.id]&&delete this.keyCache[xh.id]}for(const xh of ol)delete this.keyCache[xh],delete this._layerConfigs[xh],delete this._layers[xh];this.familiesBySource={};const sh=function(xh,Mh){const Uh={};for(let Zh=0;Zh<xh.length;Zh++){const td=Mh&&Mh[xh[Zh].id]||C(xh[Zh]);Mh&&(Mh[xh[Zh].id]=td);let Ad=Uh[td];Ad||(Ad=Uh[td]=[]),Ad.push(xh[Zh])}const Nh=[];for(const Zh in Uh)Nh.push(Uh[Zh]);return Nh}(Object.values(this._layerConfigs),this.keyCache);for(const xh of sh){const Mh=xh.map(Zd=>this._layers[Zd.id]),Uh=Mh[0];if(Uh.visibility==="none")continue;const Nh=Uh.source||"";let Zh=this.familiesBySource[Nh];Zh||(Zh=this.familiesBySource[Nh]={});const td=Uh.sourceLayer||"_geojsonTileLayer";let Ad=Zh[td];Ad||(Ad=Zh[td]=[]),Ad.push(Mh)}}}class ge{constructor(Zs){const ol={},sh=[];for(const Nh in Zs){const Zh=Zs[Nh],td=ol[Nh]={};for(const Ad in Zh){const Zd=Zh[+Ad];if(!Zd||Zd.bitmap.width===0||Zd.bitmap.height===0)continue;const Fd={x:0,y:0,w:Zd.bitmap.width+2,h:Zd.bitmap.height+2};sh.push(Fd),td[Ad]={rect:Fd,metrics:Zd.metrics}}}const{w:xh,h:Mh}=o.potpack(sh),Uh=new o.AlphaImage({width:xh||1,height:Mh||1});for(const Nh in Zs){const Zh=Zs[Nh];for(const td in Zh){const Ad=Zh[+td];if(!Ad||Ad.bitmap.width===0||Ad.bitmap.height===0)continue;const Zd=ol[Nh][td].rect;o.AlphaImage.copy(Ad.bitmap,Uh,{x:0,y:0},{x:Zd.x+1,y:Zd.y+1},Ad.bitmap)}}this.image=Uh,this.positions=ol}}o.register("GlyphAtlas",ge);class nt{constructor(Zs){this.tileID=new o.OverscaledTileID(Zs.tileID.overscaledZ,Zs.tileID.wrap,Zs.tileID.canonical.z,Zs.tileID.canonical.x,Zs.tileID.canonical.y),this.uid=Zs.uid,this.zoom=Zs.zoom,this.pixelRatio=Zs.pixelRatio,this.tileSize=Zs.tileSize,this.source=Zs.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Zs.showCollisionBoxes,this.collectResourceTiming=!!Zs.collectResourceTiming,this.returnDependencies=!!Zs.returnDependencies,this.promoteId=Zs.promoteId}parse(Zs,ol,sh,xh,Mh){this.status="parsing",this.data=Zs,this.collisionBoxArray=new o.CollisionBoxArray;const Uh=new o.DictionaryCoder(Object.keys(Zs.layers).sort()),Nh=new o.FeatureIndex(this.tileID,this.promoteId);Nh.bucketLayerIDs=[];const Zh={},td={featureIndex:Nh,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:sh},Ad=ol.familiesBySource[this.source];for(const Gh in Ad){const Nf=Zs.layers[Gh];if(!Nf)continue;Nf.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${Gh}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Hf=Uh.encode(Gh),mp=[];for(let Bp=0;Bp<Nf.length;Bp++){const zp=Nf.feature(Bp),um=Nh.getId(zp,Gh);mp.push({feature:zp,id:um,index:Bp,sourceLayerIndex:Hf})}for(const Bp of Ad[Gh]){const zp=Bp[0];zp.source!==this.source&&o.warnOnce(`layer.source = ${zp.source} does not equal this.source = ${this.source}`),zp.minzoom&&this.zoom<Math.floor(zp.minzoom)||zp.maxzoom&&this.zoom>=zp.maxzoom||zp.visibility!=="none"&&(ze(Bp,this.zoom,sh),(Zh[zp.id]=zp.createBucket({index:Nh.bucketLayerIDs.length,layers:Bp,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Hf,sourceID:this.source})).populate(mp,td,this.tileID.canonical),Nh.bucketLayerIDs.push(Bp.map(um=>um.id)))}}let Zd,Fd,Kf,up;const ap=o.mapObject(td.glyphDependencies,Gh=>Object.keys(Gh).map(Number));Object.keys(ap).length?xh.send("getGlyphs",{uid:this.uid,stacks:ap,source:this.source,tileID:this.tileID,type:"glyphs"},(Gh,Nf)=>{Zd||(Zd=Gh,Fd=Nf,Ip.call(this))}):Fd={};const wp=Object.keys(td.iconDependencies);wp.length?xh.send("getImages",{icons:wp,source:this.source,tileID:this.tileID,type:"icons"},(Gh,Nf)=>{Zd||(Zd=Gh,Kf=Nf,Ip.call(this))}):Kf={};const Hp=Object.keys(td.patternDependencies);function Ip(){if(Zd)return Mh(Zd);if(Fd&&Kf&&up){const Gh=new ge(Fd),Nf=new o.ImageAtlas(Kf,up);for(const Hf in Zh){const mp=Zh[Hf];mp instanceof o.SymbolBucket?(ze(mp.layers,this.zoom,sh),o.performSymbolLayout({bucket:mp,glyphMap:Fd,glyphPositions:Gh.positions,imageMap:Kf,imagePositions:Nf.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):mp.hasPattern&&(mp instanceof o.LineBucket||mp instanceof o.FillBucket||mp instanceof o.FillExtrusionBucket)&&(ze(mp.layers,this.zoom,sh),mp.addFeatures(td,this.tileID.canonical,Nf.patternPositions))}this.status="done",Mh(null,{buckets:Object.values(Zh).filter(Hf=>!Hf.isEmpty()),featureIndex:Nh,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gh.image,imageAtlas:Nf,glyphMap:this.returnDependencies?Fd:null,iconMap:this.returnDependencies?Kf:null,glyphPositions:this.returnDependencies?Gh.positions:null})}}Hp.length?xh.send("getImages",{icons:Hp,source:this.source,tileID:this.tileID,type:"patterns"},(Gh,Nf)=>{Zd||(Zd=Gh,up=Nf,Ip.call(this))}):up={},Ip.call(this)}}function ze(nl,Zs,ol){const sh=new o.EvaluationParameters(Zs);for(const xh of nl)xh.recalculate(sh,ol)}function Bt(nl,Zs){const ol=o.getArrayBuffer(nl.request,(sh,xh,Mh,Uh)=>{sh?Zs(sh):xh&&Zs(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(xh)),rawData:xh,cacheControl:Mh,expires:Uh})});return()=>{ol.cancel(),Zs()}}class qr{constructor(Zs,ol,sh,xh){this.actor=Zs,this.layerIndex=ol,this.availableImages=sh,this.loadVectorData=xh||Bt,this.loading={},this.loaded={}}loadTile(Zs,ol){const sh=Zs.uid;this.loading||(this.loading={});const xh=!!(Zs&&Zs.request&&Zs.request.collectResourceTiming)&&new o.RequestPerformance(Zs.request),Mh=this.loading[sh]=new nt(Zs);Mh.abort=this.loadVectorData(Zs,(Uh,Nh)=>{if(delete this.loading[sh],Uh||!Nh)return Mh.status="done",this.loaded[sh]=Mh,ol(Uh);const Zh=Nh.rawData,td={};Nh.expires&&(td.expires=Nh.expires),Nh.cacheControl&&(td.cacheControl=Nh.cacheControl);const Ad={};if(xh){const Zd=xh.finish();Zd&&(Ad.resourceTiming=JSON.parse(JSON.stringify(Zd)))}Mh.vectorTile=Nh.vectorTile,Mh.parse(Nh.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zd,Fd)=>{if(Zd||!Fd)return ol(Zd);ol(null,o.extend({rawTileData:Zh.slice(0)},Fd,td,Ad))}),this.loaded=this.loaded||{},this.loaded[sh]=Mh})}reloadTile(Zs,ol){const sh=this.loaded,xh=Zs.uid,Mh=this;if(sh&&sh[xh]){const Uh=sh[xh];Uh.showCollisionBoxes=Zs.showCollisionBoxes;const Nh=(Zh,td)=>{const Ad=Uh.reloadCallback;Ad&&(delete Uh.reloadCallback,Uh.parse(Uh.vectorTile,Mh.layerIndex,this.availableImages,Mh.actor,Ad)),ol(Zh,td)};Uh.status==="parsing"?Uh.reloadCallback=Nh:Uh.status==="done"&&(Uh.vectorTile?Uh.parse(Uh.vectorTile,this.layerIndex,this.availableImages,this.actor,Nh):Nh())}}abortTile(Zs,ol){const sh=this.loading,xh=Zs.uid;sh&&sh[xh]&&sh[xh].abort&&(sh[xh].abort(),delete sh[xh]),ol()}removeTile(Zs,ol){const sh=this.loaded,xh=Zs.uid;sh&&sh[xh]&&delete sh[xh],ol()}}class _n{constructor(){this.loaded={}}loadTile(Zs,ol){const{uid:sh,encoding:xh,rawImageData:Mh}=Zs,Uh=o.isImageBitmap(Mh)?this.getImageData(Mh):Mh,Nh=new o.DEMData(sh,Uh,xh);this.loaded=this.loaded||{},this.loaded[sh]=Nh,ol(null,Nh)}getImageData(Zs){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Zs.width,Zs.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Zs.width,this.offscreenCanvas.height=Zs.height,this.offscreenCanvasContext.drawImage(Zs,0,0,Zs.width,Zs.height);const ol=this.offscreenCanvasContext.getImageData(-1,-1,Zs.width+2,Zs.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:ol.width,height:ol.height},ol.data)}removeTile(Zs){const ol=this.loaded,sh=Zs.uid;ol&&ol[sh]&&delete ol[sh]}}var Fn=function nl(Zs,ol){var sh,xh=Zs&&Zs.type;if(xh==="FeatureCollection")for(sh=0;sh<Zs.features.length;sh++)nl(Zs.features[sh],ol);else if(xh==="GeometryCollection")for(sh=0;sh<Zs.geometries.length;sh++)nl(Zs.geometries[sh],ol);else if(xh==="Feature")nl(Zs.geometry,ol);else if(xh==="Polygon")tl(Zs.coordinates,ol);else if(xh==="MultiPolygon")for(sh=0;sh<Zs.coordinates.length;sh++)tl(Zs.coordinates[sh],ol);return Zs};function tl(nl,Zs){if(nl.length!==0){Io(nl[0],Zs);for(var ol=1;ol<nl.length;ol++)Io(nl[ol],!Zs)}}function Io(nl,Zs){for(var ol=0,sh=0,xh=0,Mh=nl.length,Uh=Mh-1;xh<Mh;Uh=xh++){var Nh=(nl[xh][0]-nl[Uh][0])*(nl[Uh][1]+nl[xh][1]),Zh=ol+Nh;sh+=Math.abs(ol)>=Math.abs(Nh)?ol-Zh+Nh:Nh-Zh+ol,ol=Zh}ol+sh>=0!=!!Zs&&nl.reverse()}const Co=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var rl={},ah={get exports(){return rl},set exports(nl){rl=nl}},ch=o.pointGeometry,ju=o.vectorTile.VectorTileFeature,Zu=sl;function sl(nl,Zs){this.options=Zs||{},this.features=nl,this.length=nl.length}function oh(nl,Zs){this.id=typeof nl.id=="number"?nl.id:void 0,this.type=nl.type,this.rawGeometry=nl.type===1?[nl.geometry]:nl.geometry,this.properties=nl.tags,this.extent=Zs||4096}sl.prototype.feature=function(nl){return new oh(this.features[nl],this.options.extent)},oh.prototype.loadGeometry=function(){var nl=this.rawGeometry;this.geometry=[];for(var Zs=0;Zs<nl.length;Zs++){for(var ol=nl[Zs],sh=[],xh=0;xh<ol.length;xh++)sh.push(new ch(ol[xh][0],ol[xh][1]));this.geometry.push(sh)}return this.geometry},oh.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var nl=this.geometry,Zs=1/0,ol=-1/0,sh=1/0,xh=-1/0,Mh=0;Mh<nl.length;Mh++)for(var Uh=nl[Mh],Nh=0;Nh<Uh.length;Nh++){var Zh=Uh[Nh];Zs=Math.min(Zs,Zh.x),ol=Math.max(ol,Zh.x),sh=Math.min(sh,Zh.y),xh=Math.max(xh,Zh.y)}return[Zs,sh,ol,xh]},oh.prototype.toGeoJSON=ju.prototype.toGeoJSON;var hh=o.pbf,Sh=Zu;function $h(nl){var Zs=new hh;return function(ol,sh){for(var xh in ol.layers)sh.writeMessage(3,hd,ol.layers[xh])}(nl,Zs),Zs.finish()}function hd(nl,Zs){var ol;Zs.writeVarintField(15,nl.version||1),Zs.writeStringField(1,nl.name||""),Zs.writeVarintField(5,nl.extent||4096);var sh={keys:[],values:[],keycache:{},valuecache:{}};for(ol=0;ol<nl.length;ol++)sh.feature=nl.feature(ol),Zs.writeMessage(2,vd,sh);var xh=sh.keys;for(ol=0;ol<xh.length;ol++)Zs.writeStringField(3,xh[ol]);var Mh=sh.values;for(ol=0;ol<Mh.length;ol++)Zs.writeMessage(4,yd,Mh[ol])}function vd(nl,Zs){var ol=nl.feature;ol.id!==void 0&&Zs.writeVarintField(1,ol.id),Zs.writeMessage(2,Ef,nl),Zs.writeVarintField(3,ol.type),Zs.writeMessage(4,Sd,ol)}function Ef(nl,Zs){var ol=nl.feature,sh=nl.keys,xh=nl.values,Mh=nl.keycache,Uh=nl.valuecache;for(var Nh in ol.properties){var Zh=ol.properties[Nh],td=Mh[Nh];if(Zh!==null){td===void 0&&(sh.push(Nh),Mh[Nh]=td=sh.length-1),Zs.writeVarint(td);var Ad=typeof Zh;Ad!=="string"&&Ad!=="boolean"&&Ad!=="number"&&(Zh=JSON.stringify(Zh));var Zd=Ad+":"+Zh,Fd=Uh[Zd];Fd===void 0&&(xh.push(Zh),Uh[Zd]=Fd=xh.length-1),Zs.writeVarint(Fd)}}}function Cd(nl,Zs){return(Zs<<3)+(7&nl)}function Cf(nl){return nl<<1^nl>>31}function Sd(nl,Zs){for(var ol=nl.loadGeometry(),sh=nl.type,xh=0,Mh=0,Uh=ol.length,Nh=0;Nh<Uh;Nh++){var Zh=ol[Nh],td=1;sh===1&&(td=Zh.length),Zs.writeVarint(Cd(1,td));for(var Ad=sh===3?Zh.length-1:Zh.length,Zd=0;Zd<Ad;Zd++){Zd===1&&sh!==1&&Zs.writeVarint(Cd(2,Ad-1));var Fd=Zh[Zd].x-xh,Kf=Zh[Zd].y-Mh;Zs.writeVarint(Cf(Fd)),Zs.writeVarint(Cf(Kf)),xh+=Fd,Mh+=Kf}sh===3&&Zs.writeVarint(Cd(7,1))}}function yd(nl,Zs){var ol=typeof nl;ol==="string"?Zs.writeStringField(1,nl):ol==="boolean"?Zs.writeBooleanField(7,nl):ol==="number"&&(nl%1!=0?Zs.writeDoubleField(3,nl):nl<0?Zs.writeSVarintField(6,nl):Zs.writeVarintField(5,nl))}ah.exports=$h,rl.fromVectorTileJs=$h,rl.fromGeojsonVt=function(nl,Zs){Zs=Zs||{};var ol={};for(var sh in nl)ol[sh]=new Sh(nl[sh].features,Zs),ol[sh].name=sh,ol[sh].version=Zs.version,ol[sh].extent=Zs.extent;return $h({layers:ol})},rl.GeoJSONWrapper=Sh;const Hd={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nl=>nl},xd=Math.fround||(Pd=new Float32Array(1),nl=>(Pd[0]=+nl,Pd[0]));var Pd;class zd{constructor(Zs){this.options=Uf(Object.create(Hd),Zs),this.trees=new Array(this.options.maxZoom+1)}load(Zs){const{log:ol,minZoom:sh,maxZoom:xh,nodeSize:Mh}=this.options;ol&&console.time("total time");const Uh=`prepare ${Zs.length} points`;ol&&console.time(Uh),this.points=Zs;let Nh=[];for(let Zh=0;Zh<Zs.length;Zh++)Zs[Zh].geometry&&Nh.push(Kd(Zs[Zh],Zh));this.trees[xh+1]=new o.KDBush(Nh,qd,Vd,Mh,Float32Array),ol&&console.timeEnd(Uh);for(let Zh=xh;Zh>=sh;Zh--){const td=+Date.now();Nh=this._cluster(Nh,Zh),this.trees[Zh]=new o.KDBush(Nh,qd,Vd,Mh,Float32Array),ol&&console.log("z%d: %d clusters in %dms",Zh,Nh.length,+Date.now()-td)}return ol&&console.timeEnd("total time"),this}getClusters(Zs,ol){let sh=((Zs[0]+180)%360+360)%360-180;const xh=Math.max(-90,Math.min(90,Zs[1]));let Mh=Zs[2]===180?180:((Zs[2]+180)%360+360)%360-180;const Uh=Math.max(-90,Math.min(90,Zs[3]));if(Zs[2]-Zs[0]>=360)sh=-180,Mh=180;else if(sh>Mh){const Ad=this.getClusters([sh,xh,180,Uh],ol),Zd=this.getClusters([-180,xh,Mh,Uh],ol);return Ad.concat(Zd)}const Nh=this.trees[this._limitZoom(ol)],Zh=Nh.range(cd(sh),gd(Uh),cd(Mh),gd(xh)),td=[];for(const Ad of Zh){const Zd=Nh.points[Ad];td.push(Zd.numPoints?wf(Zd):this.points[Zd.index])}return td}getChildren(Zs){const ol=this._getOriginId(Zs),sh=this._getOriginZoom(Zs),xh="No cluster with the specified id.",Mh=this.trees[sh];if(!Mh)throw new Error(xh);const Uh=Mh.points[ol];if(!Uh)throw new Error(xh);const Nh=this.options.radius/(this.options.extent*Math.pow(2,sh-1)),Zh=Mh.within(Uh.x,Uh.y,Nh),td=[];for(const Ad of Zh){const Zd=Mh.points[Ad];Zd.parentId===Zs&&td.push(Zd.numPoints?wf(Zd):this.points[Zd.index])}if(td.length===0)throw new Error(xh);return td}getLeaves(Zs,ol,sh){const xh=[];return this._appendLeaves(xh,Zs,ol=ol||10,sh=sh||0,0),xh}getTile(Zs,ol,sh){const xh=this.trees[this._limitZoom(Zs)],Mh=Math.pow(2,Zs),{extent:Uh,radius:Nh}=this.options,Zh=Nh/Uh,td=(sh-Zh)/Mh,Ad=(sh+1+Zh)/Mh,Zd={features:[]};return this._addTileFeatures(xh.range((ol-Zh)/Mh,td,(ol+1+Zh)/Mh,Ad),xh.points,ol,sh,Mh,Zd),ol===0&&this._addTileFeatures(xh.range(1-Zh/Mh,td,1,Ad),xh.points,Mh,sh,Mh,Zd),ol===Mh-1&&this._addTileFeatures(xh.range(0,td,Zh/Mh,Ad),xh.points,-1,sh,Mh,Zd),Zd.features.length?Zd:null}getClusterExpansionZoom(Zs){let ol=this._getOriginZoom(Zs)-1;for(;ol<=this.options.maxZoom;){const sh=this.getChildren(Zs);if(ol++,sh.length!==1)break;Zs=sh[0].properties.cluster_id}return ol}_appendLeaves(Zs,ol,sh,xh,Mh){const Uh=this.getChildren(ol);for(const Nh of Uh){const Zh=Nh.properties;if(Zh&&Zh.cluster?Mh+Zh.point_count<=xh?Mh+=Zh.point_count:Mh=this._appendLeaves(Zs,Zh.cluster_id,sh,xh,Mh):Mh<xh?Mh++:Zs.push(Nh),Zs.length===sh)break}return Mh}_addTileFeatures(Zs,ol,sh,xh,Mh,Uh){for(const Nh of Zs){const Zh=ol[Nh],td=Zh.numPoints;let Ad,Zd,Fd;if(td)Ad=kd(Zh),Zd=Zh.x,Fd=Zh.y;else{const ap=this.points[Zh.index];Ad=ap.properties,Zd=cd(ap.geometry.coordinates[0]),Fd=gd(ap.geometry.coordinates[1])}const Kf={type:1,geometry:[[Math.round(this.options.extent*(Zd*Mh-sh)),Math.round(this.options.extent*(Fd*Mh-xh))]],tags:Ad};let up;td?up=Zh.id:this.options.generateId?up=Zh.index:this.points[Zh.index].id&&(up=this.points[Zh.index].id),up!==void 0&&(Kf.id=up),Uh.features.push(Kf)}}_limitZoom(Zs){return Math.max(this.options.minZoom,Math.min(Math.floor(+Zs),this.options.maxZoom+1))}_cluster(Zs,ol){const sh=[],{radius:xh,extent:Mh,reduce:Uh,minPoints:Nh}=this.options,Zh=xh/(Mh*Math.pow(2,ol));for(let td=0;td<Zs.length;td++){const Ad=Zs[td];if(Ad.zoom<=ol)continue;Ad.zoom=ol;const Zd=this.trees[ol+1],Fd=Zd.within(Ad.x,Ad.y,Zh),Kf=Ad.numPoints||1;let up=Kf;for(const ap of Fd){const wp=Zd.points[ap];wp.zoom>ol&&(up+=wp.numPoints||1)}if(up>Kf&&up>=Nh){let ap=Ad.x*Kf,wp=Ad.y*Kf,Hp=Uh&&Kf>1?this._map(Ad,!0):null;const Ip=(td<<5)+(ol+1)+this.points.length;for(const Gh of Fd){const Nf=Zd.points[Gh];if(Nf.zoom<=ol)continue;Nf.zoom=ol;const Hf=Nf.numPoints||1;ap+=Nf.x*Hf,wp+=Nf.y*Hf,Nf.parentId=Ip,Uh&&(Hp||(Hp=this._map(Ad,!0)),Uh(Hp,this._map(Nf)))}Ad.parentId=Ip,sh.push(Ld(ap/up,wp/up,Ip,up,Hp))}else if(sh.push(Ad),up>1)for(const ap of Fd){const wp=Zd.points[ap];wp.zoom<=ol||(wp.zoom=ol,sh.push(wp))}}return sh}_getOriginId(Zs){return Zs-this.points.length>>5}_getOriginZoom(Zs){return(Zs-this.points.length)%32}_map(Zs,ol){if(Zs.numPoints)return ol?Uf({},Zs.properties):Zs.properties;const sh=this.points[Zs.index].properties,xh=this.options.map(sh);return ol&&xh===sh?Uf({},xh):xh}}function Ld(nl,Zs,ol,sh,xh){return{x:xd(nl),y:xd(Zs),zoom:1/0,id:ol,parentId:-1,numPoints:sh,properties:xh}}function Kd(nl,Zs){const[ol,sh]=nl.geometry.coordinates;return{x:xd(cd(ol)),y:xd(gd(sh)),zoom:1/0,index:Zs,parentId:-1}}function wf(nl){return{type:"Feature",id:nl.id,properties:kd(nl),geometry:{type:"Point",coordinates:[(Zs=nl.x,360*(Zs-.5)),bp(nl.y)]}};var Zs}function kd(nl){const Zs=nl.numPoints,ol=Zs>=1e4?`${Math.round(Zs/1e3)}k`:Zs>=1e3?Math.round(Zs/100)/10+"k":Zs;return Uf(Uf({},nl.properties),{cluster:!0,cluster_id:nl.id,point_count:Zs,point_count_abbreviated:ol})}function cd(nl){return nl/360+.5}function gd(nl){const Zs=Math.sin(nl*Math.PI/180),ol=.5-.25*Math.log((1+Zs)/(1-Zs))/Math.PI;return ol<0?0:ol>1?1:ol}function bp(nl){const Zs=(180-360*nl)*Math.PI/180;return 360*Math.atan(Math.exp(Zs))/Math.PI-90}function Uf(nl,Zs){for(const ol in Zs)nl[ol]=Zs[ol];return nl}function qd(nl){return nl.x}function Vd(nl){return nl.y}function ep(nl,Zs,ol,sh){for(var xh,Mh=sh,Uh=ol-Zs>>1,Nh=ol-Zs,Zh=nl[Zs],td=nl[Zs+1],Ad=nl[ol],Zd=nl[ol+1],Fd=Zs+3;Fd<ol;Fd+=3){var Kf=_p(nl[Fd],nl[Fd+1],Zh,td,Ad,Zd);if(Kf>Mh)xh=Fd,Mh=Kf;else if(Kf===Mh){var up=Math.abs(Fd-Uh);up<Nh&&(xh=Fd,Nh=up)}}Mh>sh&&(xh-Zs>3&&ep(nl,Zs,xh,sh),nl[xh+2]=Mh,ol-xh>3&&ep(nl,xh,ol,sh))}function _p(nl,Zs,ol,sh,xh,Mh){var Uh=xh-ol,Nh=Mh-sh;if(Uh!==0||Nh!==0){var Zh=((nl-ol)*Uh+(Zs-sh)*Nh)/(Uh*Uh+Nh*Nh);Zh>1?(ol=xh,sh=Mh):Zh>0&&(ol+=Uh*Zh,sh+=Nh*Zh)}return(Uh=nl-ol)*Uh+(Nh=Zs-sh)*Nh}function lp(nl,Zs,ol,sh){var xh={id:nl===void 0?null:nl,type:Zs,geometry:ol,tags:sh,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Mh){var Uh=Mh.geometry,Nh=Mh.type;if(Nh==="Point"||Nh==="MultiPoint"||Nh==="LineString")Kh(Mh,Uh);else if(Nh==="Polygon"||Nh==="MultiLineString")for(var Zh=0;Zh<Uh.length;Zh++)Kh(Mh,Uh[Zh]);else if(Nh==="MultiPolygon")for(Zh=0;Zh<Uh.length;Zh++)for(var td=0;td<Uh[Zh].length;td++)Kh(Mh,Uh[Zh][td])}(xh),xh}function Kh(nl,Zs){for(var ol=0;ol<Zs.length;ol+=3)nl.minX=Math.min(nl.minX,Zs[ol]),nl.minY=Math.min(nl.minY,Zs[ol+1]),nl.maxX=Math.max(nl.maxX,Zs[ol]),nl.maxY=Math.max(nl.maxY,Zs[ol+1])}function Qd(nl,Zs,ol,sh){if(Zs.geometry){var xh=Zs.geometry.coordinates,Mh=Zs.geometry.type,Uh=Math.pow(ol.tolerance/((1<<ol.maxZoom)*ol.extent),2),Nh=[],Zh=Zs.id;if(ol.promoteId?Zh=Zs.properties[ol.promoteId]:ol.generateId&&(Zh=sh||0),Mh==="Point")fd(xh,Nh);else if(Mh==="MultiPoint")for(var td=0;td<xh.length;td++)fd(xh[td],Nh);else if(Mh==="LineString")Jd(xh,Nh,Uh,!1);else if(Mh==="MultiLineString"){if(ol.lineMetrics){for(td=0;td<xh.length;td++)Jd(xh[td],Nh=[],Uh,!1),nl.push(lp(Zh,"LineString",Nh,Zs.properties));return}Yh(xh,Nh,Uh,!1)}else if(Mh==="Polygon")Yh(xh,Nh,Uh,!0);else{if(Mh!=="MultiPolygon"){if(Mh==="GeometryCollection"){for(td=0;td<Zs.geometry.geometries.length;td++)Qd(nl,{id:Zh,geometry:Zs.geometry.geometries[td],properties:Zs.properties},ol,sh);return}throw new Error("Input data is not a valid GeoJSON object.")}for(td=0;td<xh.length;td++){var Ad=[];Yh(xh[td],Ad,Uh,!0),Nh.push(Ad)}}nl.push(lp(Zh,Mh,Nh,Zs.properties))}}function fd(nl,Zs){Zs.push($d(nl[0])),Zs.push(Jf(nl[1])),Zs.push(0)}function Jd(nl,Zs,ol,sh){for(var xh,Mh,Uh=0,Nh=0;Nh<nl.length;Nh++){var Zh=$d(nl[Nh][0]),td=Jf(nl[Nh][1]);Zs.push(Zh),Zs.push(td),Zs.push(0),Nh>0&&(Uh+=sh?(xh*td-Zh*Mh)/2:Math.sqrt(Math.pow(Zh-xh,2)+Math.pow(td-Mh,2))),xh=Zh,Mh=td}var Ad=Zs.length-3;Zs[2]=1,ep(Zs,0,Ad,ol),Zs[Ad+2]=1,Zs.size=Math.abs(Uh),Zs.start=0,Zs.end=Zs.size}function Yh(nl,Zs,ol,sh){for(var xh=0;xh<nl.length;xh++){var Mh=[];Jd(nl[xh],Mh,ol,sh),Zs.push(Mh)}}function $d(nl){return nl/360+.5}function Jf(nl){var Zs=Math.sin(nl*Math.PI/180),ol=.5-.25*Math.log((1+Zs)/(1-Zs))/Math.PI;return ol<0?0:ol>1?1:ol}function Sf(nl,Zs,ol,sh,xh,Mh,Uh,Nh){if(sh/=Zs,Mh>=(ol/=Zs)&&Uh<sh)return nl;if(Uh<ol||Mh>=sh)return null;for(var Zh=[],td=0;td<nl.length;td++){var Ad=nl[td],Zd=Ad.geometry,Fd=Ad.type,Kf=xh===0?Ad.minX:Ad.minY,up=xh===0?Ad.maxX:Ad.maxY;if(Kf>=ol&&up<sh)Zh.push(Ad);else if(!(up<ol||Kf>=sh)){var ap=[];if(Fd==="Point"||Fd==="MultiPoint")If(Zd,ap,ol,sh,xh);else if(Fd==="LineString")Xf(Zd,ap,ol,sh,xh,!1,Nh.lineMetrics);else if(Fd==="MultiLineString")jf(Zd,ap,ol,sh,xh,!1);else if(Fd==="Polygon")jf(Zd,ap,ol,sh,xh,!0);else if(Fd==="MultiPolygon")for(var wp=0;wp<Zd.length;wp++){var Hp=[];jf(Zd[wp],Hp,ol,sh,xh,!0),Hp.length&&ap.push(Hp)}if(ap.length){if(Nh.lineMetrics&&Fd==="LineString"){for(wp=0;wp<ap.length;wp++)Zh.push(lp(Ad.id,Fd,ap[wp],Ad.tags));continue}Fd!=="LineString"&&Fd!=="MultiLineString"||(ap.length===1?(Fd="LineString",ap=ap[0]):Fd="MultiLineString"),Fd!=="Point"&&Fd!=="MultiPoint"||(Fd=ap.length===3?"Point":"MultiPoint"),Zh.push(lp(Ad.id,Fd,ap,Ad.tags))}}}return Zh.length?Zh:null}function If(nl,Zs,ol,sh,xh){for(var Mh=0;Mh<nl.length;Mh+=3){var Uh=nl[Mh+xh];Uh>=ol&&Uh<=sh&&(Zs.push(nl[Mh]),Zs.push(nl[Mh+1]),Zs.push(nl[Mh+2]))}}function Xf(nl,Zs,ol,sh,xh,Mh,Uh){for(var Nh,Zh,td=Of(nl),Ad=xh===0?vp:Tp,Zd=nl.start,Fd=0;Fd<nl.length-3;Fd+=3){var Kf=nl[Fd],up=nl[Fd+1],ap=nl[Fd+2],wp=nl[Fd+3],Hp=nl[Fd+4],Ip=xh===0?Kf:up,Gh=xh===0?wp:Hp,Nf=!1;Uh&&(Nh=Math.sqrt(Math.pow(Kf-wp,2)+Math.pow(up-Hp,2))),Ip<ol?Gh>ol&&(Zh=Ad(td,Kf,up,wp,Hp,ol),Uh&&(td.start=Zd+Nh*Zh)):Ip>sh?Gh<sh&&(Zh=Ad(td,Kf,up,wp,Hp,sh),Uh&&(td.start=Zd+Nh*Zh)):Ap(td,Kf,up,ap),Gh<ol&&Ip>=ol&&(Zh=Ad(td,Kf,up,wp,Hp,ol),Nf=!0),Gh>sh&&Ip<=sh&&(Zh=Ad(td,Kf,up,wp,Hp,sh),Nf=!0),!Mh&&Nf&&(Uh&&(td.end=Zd+Nh*Zh),Zs.push(td),td=Of(nl)),Uh&&(Zd+=Nh)}var Hf=nl.length-3;Kf=nl[Hf],up=nl[Hf+1],ap=nl[Hf+2],(Ip=xh===0?Kf:up)>=ol&&Ip<=sh&&Ap(td,Kf,up,ap),Hf=td.length-3,Mh&&Hf>=3&&(td[Hf]!==td[0]||td[Hf+1]!==td[1])&&Ap(td,td[0],td[1],td[2]),td.length&&Zs.push(td)}function Of(nl){var Zs=[];return Zs.size=nl.size,Zs.start=nl.start,Zs.end=nl.end,Zs}function jf(nl,Zs,ol,sh,xh,Mh){for(var Uh=0;Uh<nl.length;Uh++)Xf(nl[Uh],Zs,ol,sh,xh,Mh,!1)}function Ap(nl,Zs,ol,sh){nl.push(Zs),nl.push(ol),nl.push(sh)}function vp(nl,Zs,ol,sh,xh,Mh){var Uh=(Mh-Zs)/(sh-Zs);return nl.push(Mh),nl.push(ol+(xh-ol)*Uh),nl.push(1),Uh}function Tp(nl,Zs,ol,sh,xh,Mh){var Uh=(Mh-ol)/(xh-ol);return nl.push(Zs+(sh-Zs)*Uh),nl.push(Mh),nl.push(1),Uh}function Zf(nl,Zs){for(var ol=[],sh=0;sh<nl.length;sh++){var xh,Mh=nl[sh],Uh=Mh.type;if(Uh==="Point"||Uh==="MultiPoint"||Uh==="LineString")xh=qp(Mh.geometry,Zs);else if(Uh==="MultiLineString"||Uh==="Polygon"){xh=[];for(var Nh=0;Nh<Mh.geometry.length;Nh++)xh.push(qp(Mh.geometry[Nh],Zs))}else if(Uh==="MultiPolygon")for(xh=[],Nh=0;Nh<Mh.geometry.length;Nh++){for(var Zh=[],td=0;td<Mh.geometry[Nh].length;td++)Zh.push(qp(Mh.geometry[Nh][td],Zs));xh.push(Zh)}ol.push(lp(Mh.id,Uh,xh,Mh.tags))}return ol}function qp(nl,Zs){var ol=[];ol.size=nl.size,nl.start!==void 0&&(ol.start=nl.start,ol.end=nl.end);for(var sh=0;sh<nl.length;sh+=3)ol.push(nl[sh]+Zs,nl[sh+1],nl[sh+2]);return ol}function sm(nl,Zs){if(nl.transformed)return nl;var ol,sh,xh,Mh=1<<nl.z,Uh=nl.x,Nh=nl.y;for(ol=0;ol<nl.features.length;ol++){var Zh=nl.features[ol],td=Zh.geometry,Ad=Zh.type;if(Zh.geometry=[],Ad===1)for(sh=0;sh<td.length;sh+=2)Zh.geometry.push(Wd(td[sh],td[sh+1],Zs,Mh,Uh,Nh));else for(sh=0;sh<td.length;sh++){var Zd=[];for(xh=0;xh<td[sh].length;xh+=2)Zd.push(Wd(td[sh][xh],td[sh][xh+1],Zs,Mh,Uh,Nh));Zh.geometry.push(Zd)}}return nl.transformed=!0,nl}function Wd(nl,Zs,ol,sh,xh,Mh){return[Math.round(ol*(nl*sh-xh)),Math.round(ol*(Zs*sh-Mh))]}function $p(nl,Zs,ol,sh,xh){for(var Mh=Zs===xh.maxZoom?0:xh.tolerance/((1<<Zs)*xh.extent),Uh={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ol,y:sh,z:Zs,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Nh=0;Nh<nl.length;Nh++){Uh.numFeatures++,Lh(Uh,nl[Nh],Mh,xh);var Zh=nl[Nh].minX,td=nl[Nh].minY,Ad=nl[Nh].maxX,Zd=nl[Nh].maxY;Zh<Uh.minX&&(Uh.minX=Zh),td<Uh.minY&&(Uh.minY=td),Ad>Uh.maxX&&(Uh.maxX=Ad),Zd>Uh.maxY&&(Uh.maxY=Zd)}return Uh}function Lh(nl,Zs,ol,sh){var xh=Zs.geometry,Mh=Zs.type,Uh=[];if(Mh==="Point"||Mh==="MultiPoint")for(var Nh=0;Nh<xh.length;Nh+=3)Uh.push(xh[Nh]),Uh.push(xh[Nh+1]),nl.numPoints++,nl.numSimplified++;else if(Mh==="LineString")lh(Uh,xh,nl,ol,!1,!1);else if(Mh==="MultiLineString"||Mh==="Polygon")for(Nh=0;Nh<xh.length;Nh++)lh(Uh,xh[Nh],nl,ol,Mh==="Polygon",Nh===0);else if(Mh==="MultiPolygon")for(var Zh=0;Zh<xh.length;Zh++){var td=xh[Zh];for(Nh=0;Nh<td.length;Nh++)lh(Uh,td[Nh],nl,ol,!0,Nh===0)}if(Uh.length){var Ad=Zs.tags||null;if(Mh==="LineString"&&sh.lineMetrics){for(var Zd in Ad={},Zs.tags)Ad[Zd]=Zs.tags[Zd];Ad.mapbox_clip_start=xh.start/xh.size,Ad.mapbox_clip_end=xh.end/xh.size}var Fd={geometry:Uh,type:Mh==="Polygon"||Mh==="MultiPolygon"?3:Mh==="LineString"||Mh==="MultiLineString"?2:1,tags:Ad};Zs.id!==null&&(Fd.id=Zs.id),nl.features.push(Fd)}}function lh(nl,Zs,ol,sh,xh,Mh){var Uh=sh*sh;if(sh>0&&Zs.size<(xh?Uh:sh))ol.numPoints+=Zs.length/3;else{for(var Nh=[],Zh=0;Zh<Zs.length;Zh+=3)(sh===0||Zs[Zh+2]>Uh)&&(ol.numSimplified++,Nh.push(Zs[Zh]),Nh.push(Zs[Zh+1])),ol.numPoints++;xh&&function(td,Ad){for(var Zd=0,Fd=0,Kf=td.length,up=Kf-2;Fd<Kf;up=Fd,Fd+=2)Zd+=(td[Fd]-td[up])*(td[Fd+1]+td[up+1]);if(Zd>0===Ad)for(Fd=0,Kf=td.length;Fd<Kf/2;Fd+=2){var ap=td[Fd],wp=td[Fd+1];td[Fd]=td[Kf-2-Fd],td[Fd+1]=td[Kf-1-Fd],td[Kf-2-Fd]=ap,td[Kf-1-Fd]=wp}}(Nh,Mh),nl.push(Nh)}}function ih(nl,Zs){var ol=(Zs=this.options=function(xh,Mh){for(var Uh in Mh)xh[Uh]=Mh[Uh];return xh}(Object.create(this.options),Zs)).debug;if(ol&&console.time("preprocess data"),Zs.maxZoom<0||Zs.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Zs.promoteId&&Zs.generateId)throw new Error("promoteId and generateId cannot be used together.");var sh=function(xh,Mh){var Uh=[];if(xh.type==="FeatureCollection")for(var Nh=0;Nh<xh.features.length;Nh++)Qd(Uh,xh.features[Nh],Mh,Nh);else Qd(Uh,xh.type==="Feature"?xh:{geometry:xh},Mh);return Uh}(nl,Zs);this.tiles={},this.tileCoords=[],ol&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Zs.indexMaxZoom,Zs.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),sh=function(xh,Mh){var Uh=Mh.buffer/Mh.extent,Nh=xh,Zh=Sf(xh,1,-1-Uh,Uh,0,-1,2,Mh),td=Sf(xh,1,1-Uh,2+Uh,0,-1,2,Mh);return(Zh||td)&&(Nh=Sf(xh,1,-Uh,1+Uh,0,-1,2,Mh)||[],Zh&&(Nh=Zf(Zh,1).concat(Nh)),td&&(Nh=Nh.concat(Zf(td,-1)))),Nh}(sh,Zs),sh.length&&this.splitTile(sh,0,0,0),ol&&(sh.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ah(nl,Zs,ol){return 32*((1<<nl)*ol+Zs)+nl}function zh(nl,Zs){return Zs?nl.properties[Zs]:nl.id}function Qh(nl,Zs){if(nl==null)return!0;if(nl.type==="Feature")return zh(nl,Zs)!=null;if(nl.type==="FeatureCollection"){const ol=new Set;for(const sh of nl.features){const xh=zh(sh,Zs);if(xh==null||ol.has(xh))return!1;ol.add(xh)}return!0}return!1}function Th(nl,Zs){const ol=new Map;if(nl!=null)if(nl.type==="Feature")ol.set(zh(nl,Zs),nl);else for(const sh of nl.features)ol.set(zh(sh,Zs),sh);return ol}function Fh(nl,Zs){const ol=nl.tileID.canonical;if(!this._geoJSONIndex)return Zs(null,null);const sh=this._geoJSONIndex.getTile(ol.z,ol.x,ol.y);if(!sh)return Zs(null,null);const xh=new class{constructor(Uh){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Uh.length,this._features=Uh}feature(Uh){return new class{constructor(Nh){this._feature=Nh,this.extent=o.EXTENT,this.type=Nh.type,this.properties=Nh.tags,"id"in Nh&&!isNaN(Nh.id)&&(this.id=parseInt(Nh.id,10))}loadGeometry(){if(this._feature.type===1){const Nh=[];for(const Zh of this._feature.geometry)Nh.push([new o.pointGeometry(Zh[0],Zh[1])]);return Nh}{const Nh=[];for(const Zh of this._feature.geometry){const td=[];for(const Ad of Zh)td.push(new o.pointGeometry(Ad[0],Ad[1]));Nh.push(td)}return Nh}}toGeoJSON(Nh,Zh,td){return Co.call(this,Nh,Zh,td)}}(this._features[Uh])}}(sh.features);let Mh=rl(xh);Mh.byteOffset===0&&Mh.byteLength===Mh.buffer.byteLength||(Mh=new Uint8Array(Mh)),Zs(null,{vectorTile:xh,rawData:Mh.buffer})}ih.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ih.prototype.splitTile=function(nl,Zs,ol,sh,xh,Mh,Uh){for(var Nh=[nl,Zs,ol,sh],Zh=this.options,td=Zh.debug;Nh.length;){sh=Nh.pop(),ol=Nh.pop(),Zs=Nh.pop(),nl=Nh.pop();var Ad=1<<Zs,Zd=Ah(Zs,ol,sh),Fd=this.tiles[Zd];if(!Fd&&(td>1&&console.time("creation"),Fd=this.tiles[Zd]=$p(nl,Zs,ol,sh,Zh),this.tileCoords.push({z:Zs,x:ol,y:sh}),td)){td>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Zs,ol,sh,Fd.numFeatures,Fd.numPoints,Fd.numSimplified),console.timeEnd("creation"));var Kf="z"+Zs;this.stats[Kf]=(this.stats[Kf]||0)+1,this.total++}if(Fd.source=nl,xh){if(Zs===Zh.maxZoom||Zs===xh)continue;var up=1<<xh-Zs;if(ol!==Math.floor(Mh/up)||sh!==Math.floor(Uh/up))continue}else if(Zs===Zh.indexMaxZoom||Fd.numPoints<=Zh.indexMaxPoints)continue;if(Fd.source=null,nl.length!==0){td>1&&console.time("clipping");var ap,wp,Hp,Ip,Gh,Nf,Hf=.5*Zh.buffer/Zh.extent,mp=.5-Hf,Bp=.5+Hf,zp=1+Hf;ap=wp=Hp=Ip=null,Gh=Sf(nl,Ad,ol-Hf,ol+Bp,0,Fd.minX,Fd.maxX,Zh),Nf=Sf(nl,Ad,ol+mp,ol+zp,0,Fd.minX,Fd.maxX,Zh),nl=null,Gh&&(ap=Sf(Gh,Ad,sh-Hf,sh+Bp,1,Fd.minY,Fd.maxY,Zh),wp=Sf(Gh,Ad,sh+mp,sh+zp,1,Fd.minY,Fd.maxY,Zh),Gh=null),Nf&&(Hp=Sf(Nf,Ad,sh-Hf,sh+Bp,1,Fd.minY,Fd.maxY,Zh),Ip=Sf(Nf,Ad,sh+mp,sh+zp,1,Fd.minY,Fd.maxY,Zh),Nf=null),td>1&&console.timeEnd("clipping"),Nh.push(ap||[],Zs+1,2*ol,2*sh),Nh.push(wp||[],Zs+1,2*ol,2*sh+1),Nh.push(Hp||[],Zs+1,2*ol+1,2*sh),Nh.push(Ip||[],Zs+1,2*ol+1,2*sh+1)}}},ih.prototype.getTile=function(nl,Zs,ol){var sh=this.options,xh=sh.extent,Mh=sh.debug;if(nl<0||nl>24)return null;var Uh=1<<nl,Nh=Ah(nl,Zs=(Zs%Uh+Uh)%Uh,ol);if(this.tiles[Nh])return sm(this.tiles[Nh],xh);Mh>1&&console.log("drilling down to z%d-%d-%d",nl,Zs,ol);for(var Zh,td=nl,Ad=Zs,Zd=ol;!Zh&&td>0;)td--,Ad=Math.floor(Ad/2),Zd=Math.floor(Zd/2),Zh=this.tiles[Ah(td,Ad,Zd)];return Zh&&Zh.source?(Mh>1&&console.log("found parent tile z%d-%d-%d",td,Ad,Zd),Mh>1&&console.time("drilling down"),this.splitTile(Zh.source,td,Ad,Zd,nl,Zs,ol),Mh>1&&console.timeEnd("drilling down"),this.tiles[Nh]?sm(this.tiles[Nh],xh):null):null};class al extends qr{constructor(Zs,ol,sh,xh){super(Zs,ol,sh,Fh),this._dataUpdateable=new Map,this.loadGeoJSON=(Mh,Uh)=>{const{promoteId:Nh}=Mh;if(Mh.request)return o.getJSON(Mh.request,(Zh,td,Ad,Zd)=>{this._dataUpdateable=Qh(td,Nh)?Th(td,Nh):void 0,Uh(Zh,td,Ad,Zd)});if(typeof Mh.data=="string")try{const Zh=JSON.parse(Mh.data);this._dataUpdateable=Qh(Zh,Nh)?Th(Zh,Nh):void 0,Uh(null,Zh)}catch{Uh(new Error(`Input data given to '${Mh.source}' is not a valid GeoJSON object.`))}else Mh.dataDiff?this._dataUpdateable?(function(Zh,td,Ad){var Zd,Fd,Kf,up;if(td.removeAll&&Zh.clear(),td.remove)for(const ap of td.remove)Zh.delete(ap);if(td.add)for(const ap of td.add){const wp=zh(ap,Ad);wp!=null&&Zh.set(wp,ap)}if(td.update)for(const ap of td.update){let wp=Zh.get(ap.id);if(wp==null)continue;const Hp=!ap.removeAllProperties&&(((Zd=ap.removeProperties)===null||Zd===void 0?void 0:Zd.length)>0||((Fd=ap.addOrUpdateProperties)===null||Fd===void 0?void 0:Fd.length)>0);if((ap.newGeometry||ap.removeAllProperties||Hp)&&(wp={...wp},Zh.set(ap.id,wp),Hp&&(wp.properties={...wp.properties})),ap.newGeometry&&(wp.geometry=ap.newGeometry),ap.removeAllProperties)wp.properties={};else if(((Kf=ap.removeProperties)===null||Kf===void 0?void 0:Kf.length)>0)for(const Ip of ap.removeProperties)Object.prototype.hasOwnProperty.call(wp.properties,Ip)&&delete wp.properties[Ip];if(((up=ap.addOrUpdateProperties)===null||up===void 0?void 0:up.length)>0)for(const{key:Ip,value:Gh}of ap.addOrUpdateProperties)wp.properties[Ip]=Gh}}(this._dataUpdateable,Mh.dataDiff,Nh),Uh(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Uh(new Error(`Cannot update existing geojson data in ${Mh.source}`)):Uh(new Error(`Input data given to '${Mh.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},xh&&(this.loadGeoJSON=xh)}loadData(Zs,ol){var sh;(sh=this._pendingRequest)===null||sh===void 0||sh.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const xh=!!(Zs&&Zs.request&&Zs.request.collectResourceTiming)&&new o.RequestPerformance(Zs.request);this._pendingCallback=ol,this._pendingRequest=this.loadGeoJSON(Zs,(Mh,Uh)=>{if(delete this._pendingCallback,delete this._pendingRequest,Mh||!Uh)return ol(Mh);if(typeof Uh!="object")return ol(new Error(`Input data given to '${Zs.source}' is not a valid GeoJSON object.`));{Fn(Uh,!0);try{if(Zs.filter){const Zh=o.createExpression(Zs.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Zh.result==="error")throw new Error(Zh.value.map(Ad=>`${Ad.key}: ${Ad.message}`).join(", "));Uh={type:"FeatureCollection",features:Uh.features.filter(Ad=>Zh.value.evaluate({zoom:0},Ad))}}this._geoJSONIndex=Zs.cluster?new zd(function({superclusterOptions:Zh,clusterProperties:td}){if(!td||!Zh)return Zh;const Ad={},Zd={},Fd={accumulated:null,zoom:0},Kf={properties:null},up=Object.keys(td);for(const ap of up){const[wp,Hp]=td[ap],Ip=o.createExpression(Hp),Gh=o.createExpression(typeof wp=="string"?[wp,["accumulated"],["get",ap]]:wp);Ad[ap]=Ip.value,Zd[ap]=Gh.value}return Zh.map=ap=>{Kf.properties=ap;const wp={};for(const Hp of up)wp[Hp]=Ad[Hp].evaluate(Fd,Kf);return wp},Zh.reduce=(ap,wp)=>{Kf.properties=wp;for(const Hp of up)Fd.accumulated=ap[Hp],ap[Hp]=Zd[Hp].evaluate(Fd,Kf)},Zh}(Zs)).load(Uh.features):function(Zh,td){return new ih(Zh,td)}(Uh,Zs.geojsonVtOptions)}catch(Zh){return ol(Zh)}this.loaded={};const Nh={};if(xh){const Zh=xh.finish();Zh&&(Nh.resourceTiming={},Nh.resourceTiming[Zs.source]=JSON.parse(JSON.stringify(Zh)))}ol(null,Nh)}})}reloadTile(Zs,ol){const sh=this.loaded;return sh&&sh[Zs.uid]?super.reloadTile(Zs,ol):this.loadTile(Zs,ol)}removeSource(Zs,ol){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ol()}getClusterExpansionZoom(Zs,ol){try{ol(null,this._geoJSONIndex.getClusterExpansionZoom(Zs.clusterId))}catch(sh){ol(sh)}}getClusterChildren(Zs,ol){try{ol(null,this._geoJSONIndex.getChildren(Zs.clusterId))}catch(sh){ol(sh)}}getClusterLeaves(Zs,ol){try{ol(null,this._geoJSONIndex.getLeaves(Zs.clusterId,Zs.limit,Zs.offset))}catch(sh){ol(sh)}}}class fh{constructor(Zs){this.self=Zs,this.actor=new o.Actor(Zs,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:qr,geojson:al},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ol,sh)=>{if(this.workerSourceTypes[ol])throw new Error(`Worker source with name "${ol}" already registered.`);this.workerSourceTypes[ol]=sh},this.self.registerRTLTextPlugin=ol=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ol.applyArabicShaping,o.plugin.processBidirectionalText=ol.processBidirectionalText,o.plugin.processStyledBidirectionalText=ol.processStyledBidirectionalText}}setReferrer(Zs,ol){this.referrer=ol}setImages(Zs,ol,sh){this.availableImages[Zs]=ol;for(const xh in this.workerSources[Zs]){const Mh=this.workerSources[Zs][xh];for(const Uh in Mh)Mh[Uh].availableImages=ol}sh()}setLayers(Zs,ol,sh){this.getLayerIndex(Zs).replace(ol),sh()}updateLayers(Zs,ol,sh){this.getLayerIndex(Zs).update(ol.layers,ol.removedIds),sh()}loadTile(Zs,ol,sh){this.getWorkerSource(Zs,ol.type,ol.source).loadTile(ol,sh)}loadDEMTile(Zs,ol,sh){this.getDEMWorkerSource(Zs,ol.source).loadTile(ol,sh)}reloadTile(Zs,ol,sh){this.getWorkerSource(Zs,ol.type,ol.source).reloadTile(ol,sh)}abortTile(Zs,ol,sh){this.getWorkerSource(Zs,ol.type,ol.source).abortTile(ol,sh)}removeTile(Zs,ol,sh){this.getWorkerSource(Zs,ol.type,ol.source).removeTile(ol,sh)}removeDEMTile(Zs,ol){this.getDEMWorkerSource(Zs,ol.source).removeTile(ol)}removeSource(Zs,ol,sh){if(!this.workerSources[Zs]||!this.workerSources[Zs][ol.type]||!this.workerSources[Zs][ol.type][ol.source])return;const xh=this.workerSources[Zs][ol.type][ol.source];delete this.workerSources[Zs][ol.type][ol.source],xh.removeSource!==void 0?xh.removeSource(ol,sh):sh()}loadWorkerSource(Zs,ol,sh){try{this.self.importScripts(ol.url),sh()}catch(xh){sh(xh.toString())}}syncRTLPluginState(Zs,ol,sh){try{o.plugin.setState(ol);const xh=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&xh!=null){this.self.importScripts(xh);const Mh=o.plugin.isParsed();sh(Mh?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xh}`),Mh)}}catch(xh){sh(xh.toString())}}getAvailableImages(Zs){let ol=this.availableImages[Zs];return ol||(ol=[]),ol}getLayerIndex(Zs){let ol=this.layerIndexes[Zs];return ol||(ol=this.layerIndexes[Zs]=new P),ol}getWorkerSource(Zs,ol,sh){if(this.workerSources[Zs]||(this.workerSources[Zs]={}),this.workerSources[Zs][ol]||(this.workerSources[Zs][ol]={}),!this.workerSources[Zs][ol][sh]){const xh={send:(Mh,Uh,Nh)=>{this.actor.send(Mh,Uh,Nh,Zs)}};this.workerSources[Zs][ol][sh]=new this.workerSourceTypes[ol](xh,this.getLayerIndex(Zs),this.getAvailableImages(Zs))}return this.workerSources[Zs][ol][sh]}getDEMWorkerSource(Zs,ol){return this.demWorkerSources[Zs]||(this.demWorkerSources[Zs]={}),this.demWorkerSources[Zs][ol]||(this.demWorkerSources[Zs][ol]=new _n),this.demWorkerSources[Zs][ol]}}return o.isWorker()&&(self.worker=new fh(self)),fh}),s(["./shared"],function(o){var x=C;function C(he){return!function(g){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var X,_e,Ft=new Blob([""],{type:"text/javascript"}),Xr=URL.createObjectURL(Ft);try{_e=new Worker(Xr),X=!0}catch{X=!1}return _e&&_e.terminate(),URL.revokeObjectURL(Xr),X}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var X=document.createElement("canvas");X.width=X.height=1;var _e=X.getContext("2d");if(!_e)return!1;var Ft=_e.getImageData(0,0,1,1);return Ft&&Ft.width===X.width}()?(P[A=g&&g.failIfMajorPerformanceCaveat]===void 0&&(P[A]=function(X){var _e,Ft=function(Xr){var as=document.createElement("canvas"),cs=Object.create(C.webGLContextAttributes);return cs.failIfMajorPerformanceCaveat=Xr,as.getContext("webgl",cs)||as.getContext("experimental-webgl",cs)}(X);if(!Ft)return!1;try{_e=Ft.createShader(Ft.VERTEX_SHADER)}catch{return!1}return!(!_e||Ft.isContextLost())&&(Ft.shaderSource(_e,"void main() {}"),Ft.compileShader(_e),Ft.getShaderParameter(_e,Ft.COMPILE_STATUS)===!0)}(A)),P[A]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}(he)}var P={};C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var ge="3.0.0-pre.4";function nt(he,g){if(Array.isArray(he)){if(!Array.isArray(g)||he.length!==g.length)return!1;for(let A=0;A<he.length;A++)if(!nt(he[A],g[A]))return!1;return!0}if(typeof he=="object"&&he!==null&&g!==null){if(typeof g!="object"||Object.keys(he).length!==Object.keys(g).length)return!1;for(const A in he)if(!nt(he[A],g[A]))return!1;return!0}return he===g}class ze{static testProp(g){if(!ze.docStyle)return g[0];for(let A=0;A<g.length;A++)if(g[A]in ze.docStyle)return g[A];return g[0]}static create(g,A,X){const _e=window.document.createElement(g);return A!==void 0&&(_e.className=A),X&&X.appendChild(_e),_e}static createNS(g,A){return window.document.createElementNS(g,A)}static disableDrag(){ze.docStyle&&ze.selectProp&&(ze.userSelect=ze.docStyle[ze.selectProp],ze.docStyle[ze.selectProp]="none")}static enableDrag(){ze.docStyle&&ze.selectProp&&(ze.docStyle[ze.selectProp]=ze.userSelect)}static setTransform(g,A){g.style[ze.transformProp]=A}static addEventListener(g,A,X,_e={}){g.addEventListener(A,X,"passive"in _e?_e:_e.capture)}static removeEventListener(g,A,X,_e={}){g.removeEventListener(A,X,"passive"in _e?_e:_e.capture)}static suppressClickInternal(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ze.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ze.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ze.suppressClickInternal,!0)},0)}static mousePos(g,A){const X=g.getBoundingClientRect();return new o.pointGeometry(A.clientX-X.left-g.clientLeft,A.clientY-X.top-g.clientTop)}static touchPos(g,A){const X=g.getBoundingClientRect(),_e=[];for(let Ft=0;Ft<A.length;Ft++)_e.push(new o.pointGeometry(A[Ft].clientX-X.left-g.clientLeft,A[Ft].clientY-X.top-g.clientTop));return _e}static mouseButton(g){return g.button}static remove(g){g.parentNode&&g.parentNode.removeChild(g)}}ze.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ze.selectProp=ze.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ze.transformProp=ze.testProp(["transform","WebkitTransform"]);const Bt={supported:!1,testSupport:function(he){!Fn&&_n&&(tl?Io(he):qr=he)}};let qr,_n,Fn=!1,tl=!1;function Io(he){const g=he.createTexture();he.bindTexture(he.TEXTURE_2D,g);try{if(he.texImage2D(he.TEXTURE_2D,0,he.RGBA,he.RGBA,he.UNSIGNED_BYTE,_n),he.isContextLost())return;Bt.supported=!0}catch{}he.deleteTexture(g),Fn=!0}var Co;typeof document<"u"&&(_n=document.createElement("img"),_n.onload=function(){qr&&Io(qr),qr=null,tl=!0},_n.onerror=function(){Fn=!0,qr=null},_n.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(he){let g,A,X,_e;he.resetRequestQueue=()=>{g=[],A=0,X=0,_e={}},he.addThrottleControl=as=>{const cs=X++;return _e[cs]=as,cs},he.removeThrottleControl=as=>{delete _e[as]};const Ft=()=>{const as=Object.keys(_e);let cs=!1;if(as.length>0){for(const us of as)if(cs=_e[us](),cs)break}return cs};he.getImage=(as,cs)=>{Bt.supported&&(as.headers||(as.headers={}),as.headers.accept="image/webp,*/*");const us={requestParameters:as,callback:cs,cancelled:!1,completed:!1,cancel:()=>{}};return g.push(us),Ft()||he.processQueue(),us};const Xr=as=>{const{requestParameters:cs,callback:us}=as;return o.getArrayBuffer(cs,(th,eh,ph,Rh)=>{th?us(th):eh&&((Bh,Ch)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(Bh,Ch):o.arrayBufferToImage(Bh,Ch)})(eh,(Bh,Ch)=>{Bh!=null?us(Bh):Ch!=null&&us(null,Ch,{cacheControl:ph,expires:Rh})}),as.cancelled||(as.completed=!0,A--,Ft()||he.processQueue())})};he.processQueue=(as=0)=>{as<=0&&(as=Ft()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS);for(let cs=A;cs<as&&g.length>0;cs++){const us=g.shift();if(us.cancelled)continue;const th=Xr(us);A++,us.innerRequest=th,us.cancel=()=>{var eh;(eh=us).completed||eh.cancelled||(A--,eh.cancelled=!0,eh.innerRequest.cancel(),he.processQueue())}}return g.length}}(Co||(Co={})),Co.resetRequestQueue();var rl,ah=Co;(function(he){he.Glyphs="Glyphs",he.Image="Image",he.Source="Source",he.SpriteImage="SpriteImage",he.SpriteJSON="SpriteJSON",he.Style="Style",he.Tile="Tile",he.Unknown="Unknown"})(rl||(rl={}));class ch{constructor(g){this._transformRequestFn=g}transformRequest(g,A){return this._transformRequestFn&&this._transformRequestFn(g,A)||{url:g}}normalizeSpriteURL(g,A,X){const _e=function(Ft){const Xr=Ft.match(ju);if(!Xr)throw new Error(`Unable to parse URL "${Ft}"`);return{protocol:Xr[1],authority:Xr[2],path:Xr[3]||"/",params:Xr[4]?Xr[4].split("&"):[]}}(g);return _e.path+=`${A}${X}`,function(Ft){const Xr=Ft.params.length?`?${Ft.params.join("&")}`:"";return`${Ft.protocol}://${Ft.authority}${Ft.path}${Xr}`}(_e)}setTransformRequest(g){this._transformRequestFn=g}}const ju=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zu(he){var g=new o.ARRAY_TYPE(3);return g[0]=he[0],g[1]=he[1],g[2]=he[2],g}var sl,oh=function(he,g,A){return he[0]=g[0]-A[0],he[1]=g[1]-A[1],he[2]=g[2]-A[2],he};sl=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(sl[0]=0,sl[1]=0,sl[2]=0);var hh=function(he){var g=he[0],A=he[1];return g*g+A*A};function Sh(he){return typeof he=="string"?[{id:"default",url:he}]:he??[]}(function(){var he=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(he[0]=0,he[1]=0)})();class $h{constructor(g,A,X,_e){this.context=g,this.format=X,this.texture=g.gl.createTexture(),this.update(A,_e)}update(g,A,X){const{width:_e,height:Ft}=g,Xr=!(this.size&&this.size[0]===_e&&this.size[1]===Ft||X),{context:as}=this,{gl:cs}=as;if(this.useMipmap=!!(A&&A.useMipmap),cs.bindTexture(cs.TEXTURE_2D,this.texture),as.pixelStoreUnpackFlipY.set(!1),as.pixelStoreUnpack.set(1),as.pixelStoreUnpackPremultiplyAlpha.set(this.format===cs.RGBA&&(!A||A.premultiply!==!1)),Xr)this.size=[_e,Ft],g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||o.isImageBitmap(g)?cs.texImage2D(cs.TEXTURE_2D,0,this.format,this.format,cs.UNSIGNED_BYTE,g):cs.texImage2D(cs.TEXTURE_2D,0,this.format,_e,Ft,0,this.format,cs.UNSIGNED_BYTE,g.data);else{const{x:us,y:th}=X||{x:0,y:0};g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||o.isImageBitmap(g)?cs.texSubImage2D(cs.TEXTURE_2D,0,us,th,cs.RGBA,cs.UNSIGNED_BYTE,g):cs.texSubImage2D(cs.TEXTURE_2D,0,us,th,_e,Ft,cs.RGBA,cs.UNSIGNED_BYTE,g.data)}this.useMipmap&&this.isSizePowerOfTwo()&&cs.generateMipmap(cs.TEXTURE_2D)}bind(g,A,X){const{context:_e}=this,{gl:Ft}=_e;Ft.bindTexture(Ft.TEXTURE_2D,this.texture),X!==Ft.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(X=Ft.LINEAR),g!==this.filter&&(Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MAG_FILTER,g),Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MIN_FILTER,X||g),this.filter=g),A!==this.wrap&&(Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_S,A),Ft.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_T,A),this.wrap=A)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:g}=this.context;g.deleteTexture(this.texture),this.texture=null}}function hd(he){const{userImage:g}=he;return!!(g&&g.render&&g.render())&&(he.data.replace(new Uint8Array(g.data.buffer)),!0)}class vd extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(g){if(this.loaded!==g&&(this.loaded=g,g)){for(const{ids:A,callback:X}of this.requestors)this._notify(A,X);this.requestors=[]}}getImage(g){const A=this.images[g];if(A&&!A.data&&A.spriteData){const X=A.spriteData;A.data=new o.RGBAImage({width:X.width,height:X.height},X.context.getImageData(X.x,X.y,X.width,X.height).data),A.spriteData=null}return A}addImage(g,A){if(this.images[g])throw new Error(`Image id ${g} already exist, use updateImage instead`);this._validate(g,A)&&(this.images[g]=A)}_validate(g,A){let X=!0;const _e=A.data||A.spriteData;return this._validateStretch(A.stretchX,_e&&_e.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "stretchX" value`))),X=!1),this._validateStretch(A.stretchY,_e&&_e.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "stretchY" value`))),X=!1),this._validateContent(A.content,A)||(this.fire(new o.ErrorEvent(new Error(`Image "${g}" has invalid "content" value`))),X=!1),X}_validateStretch(g,A){if(!g)return!0;let X=0;for(const _e of g){if(_e[0]<X||_e[1]<_e[0]||A<_e[1])return!1;X=_e[1]}return!0}_validateContent(g,A){if(!g)return!0;if(g.length!==4)return!1;const X=A.spriteData,_e=X&&X.width||A.data.width,Ft=X&&X.height||A.data.height;return!(g[0]<0||_e<g[0]||g[1]<0||Ft<g[1]||g[2]<0||_e<g[2]||g[3]<0||Ft<g[3]||g[2]<g[0]||g[3]<g[1])}updateImage(g,A,X=!0){const _e=this.getImage(g);if(X&&(_e.data.width!==A.data.width||_e.data.height!==A.data.height))throw new Error(`size mismatch between old image (${_e.data.width}x${_e.data.height}) and new image (${A.data.width}x${A.data.height}).`);A.version=_e.version+1,this.images[g]=A,this.updatedImages[g]=!0}removeImage(g){const A=this.images[g];delete this.images[g],delete this.patterns[g],A.userImage&&A.userImage.onRemove&&A.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(g,A){let X=!0;if(!this.isLoaded())for(const _e of g)this.images[_e]||(X=!1);this.isLoaded()||X?this._notify(g,A):this.requestors.push({ids:g,callback:A})}_notify(g,A){const X={};for(const _e of g){const Ft=this.getImage(_e);Ft?X[_e]={data:Ft.data.clone(),pixelRatio:Ft.pixelRatio,sdf:Ft.sdf,version:Ft.version,stretchX:Ft.stretchX,stretchY:Ft.stretchY,content:Ft.content,hasRenderCallback:!!(Ft.userImage&&Ft.userImage.render)}:(this.fire(new o.Event("styleimagemissing",{id:_e})),o.warnOnce(`Image "${_e}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`))}A(null,X)}getPixelSize(){const{width:g,height:A}=this.atlasImage;return{width:g,height:A}}getPattern(g){const A=this.patterns[g],X=this.getImage(g);if(!X)return null;if(A&&A.position.version===X.version)return A.position;if(A)A.position.version=X.version;else{const _e={w:X.data.width+2,h:X.data.height+2,x:0,y:0},Ft=new o.ImagePosition(_e,X);this.patterns[g]={bin:_e,position:Ft}}return this._updatePatternAtlas(),this.patterns[g].position}bind(g){const A=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new $h(g,this.atlasImage,A.RGBA),this.atlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE)}_updatePatternAtlas(){const g=[];for(const Ft in this.patterns)g.push(this.patterns[Ft].bin);const{w:A,h:X}=o.potpack(g),_e=this.atlasImage;_e.resize({width:A||1,height:X||1});for(const Ft in this.patterns){const{bin:Xr}=this.patterns[Ft],as=Xr.x+1,cs=Xr.y+1,us=this.getImage(Ft).data,th=us.width,eh=us.height;o.RGBAImage.copy(us,_e,{x:0,y:0},{x:as,y:cs},{width:th,height:eh}),o.RGBAImage.copy(us,_e,{x:0,y:eh-1},{x:as,y:cs-1},{width:th,height:1}),o.RGBAImage.copy(us,_e,{x:0,y:0},{x:as,y:cs+eh},{width:th,height:1}),o.RGBAImage.copy(us,_e,{x:th-1,y:0},{x:as-1,y:cs},{width:1,height:eh}),o.RGBAImage.copy(us,_e,{x:0,y:0},{x:as+th,y:cs},{width:1,height:eh})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(g){for(const A of g){if(this.callbackDispatchedThisFrame[A])continue;this.callbackDispatchedThisFrame[A]=!0;const X=this.getImage(A);X||o.warnOnce(`Image with ID: "${A}" was not found`),hd(X)&&this.updateImage(A,X)}}}const Ef=1e20;function Cd(he,g,A,X,_e,Ft,Xr,as,cs){for(let us=g;us<g+X;us++)Cf(he,A*Ft+us,Ft,_e,Xr,as,cs);for(let us=A;us<A+_e;us++)Cf(he,us*Ft+g,1,X,Xr,as,cs)}function Cf(he,g,A,X,_e,Ft,Xr){Ft[0]=0,Xr[0]=-Ef,Xr[1]=Ef,_e[0]=he[g];for(let as=1,cs=0,us=0;as<X;as++){_e[as]=he[g+as*A];const th=as*as;do{const eh=Ft[cs];us=(_e[as]-_e[eh]+th-eh*eh)/(as-eh)/2}while(us<=Xr[cs]&&--cs>-1);cs++,Ft[cs]=as,Xr[cs]=us,Xr[cs+1]=Ef}for(let as=0,cs=0;as<X;as++){for(;Xr[cs+1]<as;)cs++;const us=Ft[cs],th=as-us;he[g+as*A]=_e[us]+th*th}}class Sd{constructor(g,A){this.requestManager=g,this.localIdeographFontFamily=A,this.entries={}}setURL(g){this.url=g}getGlyphs(g,A){const X=[];for(const _e in g)for(const Ft of g[_e])X.push({stack:_e,id:Ft});o.asyncAll(X,({stack:_e,id:Ft},Xr)=>{let as=this.entries[_e];as||(as=this.entries[_e]={glyphs:{},requests:{},ranges:{}});let cs=as.glyphs[Ft];if(cs!==void 0)return void Xr(null,{stack:_e,id:Ft,glyph:cs});if(cs=this._tinySDF(as,_e,Ft),cs)return as.glyphs[Ft]=cs,void Xr(null,{stack:_e,id:Ft,glyph:cs});const us=Math.floor(Ft/256);if(256*us>65535)return void Xr(new Error("glyphs > 65535 not supported"));if(as.ranges[us])return void Xr(null,{stack:_e,id:Ft,glyph:cs});if(!this.url)return void Xr(new Error("glyphsUrl is not set"));let th=as.requests[us];th||(th=as.requests[us]=[],Sd.loadGlyphRange(_e,us,this.url,this.requestManager,(eh,ph)=>{if(ph){for(const Rh in ph)this._doesCharSupportLocalGlyph(+Rh)||(as.glyphs[+Rh]=ph[+Rh]);as.ranges[us]=!0}for(const Rh of th)Rh(eh,ph);delete as.requests[us]})),th.push((eh,ph)=>{eh?Xr(eh):ph&&Xr(null,{stack:_e,id:Ft,glyph:ph[Ft]||null})})},(_e,Ft)=>{if(_e)A(_e);else if(Ft){const Xr={};for(const{stack:as,id:cs,glyph:us}of Ft)(Xr[as]||(Xr[as]={}))[cs]=us&&{id:us.id,bitmap:us.bitmap.clone(),metrics:us.metrics};A(null,Xr)}})}_doesCharSupportLocalGlyph(g){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](g)||o.unicodeBlockLookup["Hangul Syllables"](g)||o.unicodeBlockLookup.Hiragana(g)||o.unicodeBlockLookup.Katakana(g))}_tinySDF(g,A,X){const _e=this.localIdeographFontFamily;if(!_e||!this._doesCharSupportLocalGlyph(X))return;let Ft=g.tinySDF;if(!Ft){let as="400";/bold/i.test(A)?as="900":/medium/i.test(A)?as="500":/light/i.test(A)&&(as="200"),Ft=g.tinySDF=new Sd.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_e,fontWeight:as})}const Xr=Ft.draw(String.fromCharCode(X));return{id:X,bitmap:new o.AlphaImage({width:Xr.width||30,height:Xr.height||30},Xr.data),metrics:{width:Xr.glyphWidth||24,height:Xr.glyphHeight||24,left:Xr.glyphLeft||0,top:Xr.glyphTop-27||-8,advance:Xr.glyphAdvance||24}}}}Sd.loadGlyphRange=function(he,g,A,X,_e){const Ft=256*g,Xr=Ft+255,as=X.transformRequest(A.replace("{fontstack}",he).replace("{range}",`${Ft}-${Xr}`),rl.Glyphs);o.getArrayBuffer(as,(cs,us)=>{if(cs)_e(cs);else if(us){const th={};for(const eh of o.parseGlyphPbf(us))th[eh.id]=eh;_e(null,th)}})},Sd.TinySDF=class{constructor({fontSize:he=24,buffer:g=3,radius:A=8,cutoff:X=.25,fontFamily:_e="sans-serif",fontWeight:Ft="normal",fontStyle:Xr="normal"}={}){this.buffer=g,this.cutoff=X,this.radius=A;const as=this.size=he+4*g,cs=this._createCanvas(as),us=this.ctx=cs.getContext("2d",{willReadFrequently:!0});us.font=`${Xr} ${Ft} ${he}px ${_e}`,us.textBaseline="alphabetic",us.textAlign="left",us.fillStyle="black",this.gridOuter=new Float64Array(as*as),this.gridInner=new Float64Array(as*as),this.f=new Float64Array(as),this.z=new Float64Array(as+1),this.v=new Uint16Array(as)}_createCanvas(he){const g=document.createElement("canvas");return g.width=g.height=he,g}draw(he){const{width:g,actualBoundingBoxAscent:A,actualBoundingBoxDescent:X,actualBoundingBoxLeft:_e,actualBoundingBoxRight:Ft}=this.ctx.measureText(he),Xr=Math.ceil(A),as=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(Ft-_e))),cs=Math.min(this.size-this.buffer,Xr+Math.ceil(X)),us=as+2*this.buffer,th=cs+2*this.buffer,eh=Math.max(us*th,0),ph=new Uint8ClampedArray(eh),Rh={data:ph,width:us,height:th,glyphWidth:as,glyphHeight:cs,glyphTop:Xr,glyphLeft:0,glyphAdvance:g};if(as===0||cs===0)return Rh;const{ctx:Bh,buffer:Ch,gridInner:ed,gridOuter:Ed}=this;Bh.clearRect(Ch,Ch,as,cs),Bh.fillText(he,Ch,Ch+Xr);const _d=Bh.getImageData(Ch,Ch,as,cs);Ed.fill(Ef,0,eh),ed.fill(0,0,eh);for(let qh=0;qh<cs;qh++)for(let Md=0;Md<as;Md++){const Nd=_d.data[4*(qh*as+Md)+3]/255;if(Nd===0)continue;const L=(qh+Ch)*us+Md+Ch;if(Nd===1)Ed[L]=0,ed[L]=Ef;else{const u=.5-Nd;Ed[L]=u>0?u*u:0,ed[L]=u<0?u*u:0}}Cd(Ed,0,0,us,th,us,this.f,this.v,this.z),Cd(ed,Ch,Ch,as,cs,us,this.f,this.v,this.z);for(let qh=0;qh<eh;qh++){const Md=Math.sqrt(Ed[qh])-Math.sqrt(ed[qh]);ph[qh]=Math.round(255-255*(Md/this.radius+this.cutoff))}return Rh}};const yd=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(he,g){return o.sphericalToCartesian(he.expression.evaluate(g))}interpolate(he,g,A){return{x:o.number(he.x,g.x,A),y:o.number(he.y,g.y,A),z:o.number(he.z,g.z,A)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Hd="-transition";class xd extends o.Evented{constructor(g){super(),this._transitionable=new o.Transitionable(yd),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(g,A={}){if(!this._validate(o.validateLight,g,A))for(const X in g){const _e=g[X];X.endsWith(Hd)?this._transitionable.setTransition(X.slice(0,-Hd.length),_e):this._transitionable.setValue(X,_e)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,A,X){return(!X||X.validate!==!1)&&o.emitValidationErrors(this,g.call(o.validateStyle,o.extend({value:A,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Pd{constructor(g,A){this.width=g,this.height=A,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(g,A){const X=g.join(",")+String(A);return this.dashEntry[X]||(this.dashEntry[X]=this.addDash(g,A)),this.dashEntry[X]}getDashRanges(g,A,X){const _e=[];let Ft=g.length%2==1?-g[g.length-1]*X:0,Xr=g[0]*X,as=!0;_e.push({left:Ft,right:Xr,isDash:as,zeroLength:g[0]===0});let cs=g[0];for(let us=1;us<g.length;us++){as=!as;const th=g[us];Ft=cs*X,cs+=th,Xr=cs*X,_e.push({left:Ft,right:Xr,isDash:as,zeroLength:th===0})}return _e}addRoundDash(g,A,X){const _e=A/2;for(let Ft=-X;Ft<=X;Ft++){const Xr=this.width*(this.nextRow+X+Ft);let as=0,cs=g[as];for(let us=0;us<this.width;us++){us/cs.right>1&&(cs=g[++as]);const th=Math.abs(us-cs.left),eh=Math.abs(us-cs.right),ph=Math.min(th,eh);let Rh;const Bh=Ft/X*(_e+1);if(cs.isDash){const Ch=_e-Math.abs(Bh);Rh=Math.sqrt(ph*ph+Ch*Ch)}else Rh=_e-Math.sqrt(ph*ph+Bh*Bh);this.data[Xr+us]=Math.max(0,Math.min(255,Rh+128))}}}addRegularDash(g){for(let as=g.length-1;as>=0;--as){const cs=g[as],us=g[as+1];cs.zeroLength?g.splice(as,1):us&&us.isDash===cs.isDash&&(us.left=cs.left,g.splice(as,1))}const A=g[0],X=g[g.length-1];A.isDash===X.isDash&&(A.left=X.left-this.width,X.right=A.right+this.width);const _e=this.width*this.nextRow;let Ft=0,Xr=g[Ft];for(let as=0;as<this.width;as++){as/Xr.right>1&&(Xr=g[++Ft]);const cs=Math.abs(as-Xr.left),us=Math.abs(as-Xr.right),th=Math.min(cs,us);this.data[_e+as]=Math.max(0,Math.min(255,(Xr.isDash?th:-th)+128))}}addDash(g,A){const X=A?7:0,_e=2*X+1;if(this.nextRow+_e>this.height)return o.warnOnce("LineAtlas out of space"),null;let Ft=0;for(let as=0;as<g.length;as++)Ft+=g[as];if(Ft!==0){const as=this.width/Ft,cs=this.getDashRanges(g,this.width,as);A?this.addRoundDash(cs,as,X):this.addRegularDash(cs)}const Xr={y:(this.nextRow+X+.5)/this.height,height:2*X/this.height,width:Ft};return this.nextRow+=_e,this.dirty=!0,Xr}bind(g){const A=g.gl;this.texture?(A.bindTexture(A.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,A.texSubImage2D(A.TEXTURE_2D,0,0,0,this.width,this.height,A.ALPHA,A.UNSIGNED_BYTE,this.data))):(this.texture=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.texture),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texImage2D(A.TEXTURE_2D,0,A.ALPHA,this.width,this.height,0,A.ALPHA,A.UNSIGNED_BYTE,this.data))}}class zd{constructor(g,A,X){this.workerPool=g,this.actors=[],this.currentActor=0,this.id=X;const _e=this.workerPool.acquire(X);for(let Ft=0;Ft<_e.length;Ft++){const Xr=new zd.Actor(_e[Ft],A,X);Xr.name=`Worker ${Ft}`,this.actors.push(Xr)}if(!this.actors.length)throw new Error("No actors found")}broadcast(g,A,X){o.asyncAll(this.actors,(_e,Ft)=>{_e.send(g,A,Ft)},X=X||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(g=!0){this.actors.forEach(A=>{A.remove()}),this.actors=[],g&&this.workerPool.release(this.id)}}function Ld(he,g,A){const X=function(_e,Ft){if(_e)return A(_e);if(Ft){const Xr=o.pick(o.extend(Ft,he),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);Ft.vector_layers&&(Xr.vectorLayers=Ft.vector_layers,Xr.vectorLayerIds=Xr.vectorLayers.map(as=>as.id)),A(null,Xr)}};return he.url?o.getJSON(g.transformRequest(he.url,rl.Source),X):o.exported.frame(()=>X(null,he))}zd.Actor=o.Actor;class Kd{constructor(g,A,X){this.bounds=o.LngLatBounds.convert(this.validateBounds(g)),this.minzoom=A||0,this.maxzoom=X||24}validateBounds(g){return Array.isArray(g)&&g.length===4?[Math.max(-180,g[0]),Math.max(-90,g[1]),Math.min(180,g[2]),Math.min(90,g[3])]:[-180,-90,180,90]}contains(g){const A=Math.pow(2,g.z),X=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*A),_e=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*A),Ft=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*A),Xr=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*A);return g.x>=X&&g.x<Ft&&g.y>=_e&&g.y<Xr}}class wf extends o.Evented{constructor(g,A,X,_e){if(super(),this.id=g,this.dispatcher=X,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(A,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},A),this._collectResourceTiming=A.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_e)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ld(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new o.ErrorEvent(g)):A&&(o.extend(this,A),A.bounds&&(this.tileBounds=new Kd(A.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(g,A){const X=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_e={request:this.map._requestManager.transformRequest(X,rl.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function Ft(Xr,as){return delete g.request,g.aborted?A(null):Xr&&Xr.status!==404?A(Xr):(as&&as.resourceTiming&&(g.resourceTiming=as.resourceTiming),this.map._refreshExpiredTiles&&as&&g.setExpiryData(as),g.loadVectorData(as,this.map.painter),A(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}_e.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=A:g.request=g.actor.send("reloadTile",_e,Ft.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",_e,Ft.bind(this)))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class kd extends o.Evented{constructor(g,A,X,_e){super(),this.id=g,this.dispatcher=X,this.setEventedParent(_e),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},A),o.extend(this,o.pick(A,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ld(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new o.ErrorEvent(g)):A&&(o.extend(this,A),A.bounds&&(this.tileBounds=new Kd(A.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(g){this.map=g,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,A){const X=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);g.request=ah.getImage(this.map._requestManager.transformRequest(X,rl.Tile),(_e,Ft,Xr)=>{if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(_e)g.state="errored",A(_e);else if(Ft){this.map._refreshExpiredTiles&&g.setExpiryData(Xr);const as=this.map.painter.context,cs=as.gl;g.texture=this.map.painter.getTileTexture(Ft.width),g.texture?g.texture.update(Ft,{useMipmap:!0}):(g.texture=new $h(as,Ft,cs.RGBA,{useMipmap:!0}),g.texture.bind(cs.LINEAR,cs.CLAMP_TO_EDGE,cs.LINEAR_MIPMAP_NEAREST),as.extTextureFilterAnisotropic&&cs.texParameterf(cs.TEXTURE_2D,as.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,as.extTextureFilterAnisotropicMax)),g.state="loaded",A(null)}})}abortTile(g,A){g.request&&(g.request.cancel(),delete g.request),A()}unloadTile(g,A){g.texture&&this.map.painter.saveTileTexture(g.texture),A()}hasTransition(){return!1}}let cd;class gd extends kd{constructor(g,A,X,_e){super(g,A,X,_e),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},A),this.encoding=A.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(g,A){const X=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _e(Ft,Xr){Ft&&(g.state="errored",A(Ft)),Xr&&(g.dem=Xr,g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0,g.state="loaded",A(null))}g.request=ah.getImage(this.map._requestManager.transformRequest(X,rl.Tile),function(Ft,Xr){if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(Ft)g.state="errored",A(Ft);else if(Xr){this.map._refreshExpiredTiles&&g.setExpiryData(Xr),delete Xr.cacheControl,delete Xr.expires;const as=o.isImageBitmap(Xr)&&(cd==null&&(cd=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),cd)?Xr:o.exported.getImageData(Xr,1),cs={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:as,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",cs,_e.bind(this)))}}.bind(this)),g.neighboringTiles=this._getNeighboringTiles(g.tileID)}_getNeighboringTiles(g){const A=g.canonical,X=Math.pow(2,A.z),_e=(A.x-1+X)%X,Ft=A.x===0?g.wrap-1:g.wrap,Xr=(A.x+1+X)%X,as=A.x+1===X?g.wrap+1:g.wrap,cs={};return cs[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,_e,A.y).key]={backfilled:!1},cs[new o.OverscaledTileID(g.overscaledZ,as,A.z,Xr,A.y).key]={backfilled:!1},A.y>0&&(cs[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,_e,A.y-1).key]={backfilled:!1},cs[new o.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y-1).key]={backfilled:!1},cs[new o.OverscaledTileID(g.overscaledZ,as,A.z,Xr,A.y-1).key]={backfilled:!1}),A.y+1<X&&(cs[new o.OverscaledTileID(g.overscaledZ,Ft,A.z,_e,A.y+1).key]={backfilled:!1},cs[new o.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y+1).key]={backfilled:!1},cs[new o.OverscaledTileID(g.overscaledZ,as,A.z,Xr,A.y+1).key]={backfilled:!1}),cs}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})}}class bp extends o.Evented{constructor(g,A,X,_e){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=X.getActor(),this.setEventedParent(_e),this._data=A.data,this._options=o.extend({},A),this._collectResourceTiming=A.collectResourceTiming,A.maxzoom!==void 0&&(this.maxzoom=A.maxzoom),A.type&&(this.type=A.type),A.attribution&&(this.attribution=A.attribution),this.promoteId=A.promoteId;const Ft=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:A.cluster||!1,geojsonVtOptions:{buffer:(A.buffer!==void 0?A.buffer:128)*Ft,tolerance:(A.tolerance!==void 0?A.tolerance:.375)*Ft,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:A.lineMetrics||!1,generateId:A.generateId||!1},superclusterOptions:{maxZoom:A.clusterMaxZoom!==void 0?A.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,A.clusterMinPoints||2),extent:o.EXTENT,radius:(A.clusterRadius||50)*Ft,log:!1,generateId:A.generateId||!1},clusterProperties:A.clusterProperties,filter:A.filter},A.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(g){this.map=g,this.load()}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){return this._updateWorkerData(g),this}setClusterOptions(g){return this.workerOptions.cluster=g.cluster,g&&(g.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=g.clusterRadius),g.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=g.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(g,A){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},A),this}getClusterChildren(g,A){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},A),this}getClusterLeaves(g,A,X,_e){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:A,offset:X},_e),this}_updateWorkerData(g){const A=o.extend({},this.workerOptions);g?A.dataDiff=g:typeof this._data=="string"?(A.request=this.map._requestManager.transformRequest(o.exported.resolveURL(this._data),rl.Source),A.request.collectResourceTiming=this._collectResourceTiming):A.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,A,(X,_e)=>{if(this._pendingLoads--,this._removed||_e&&_e.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let Ft=null;if(_e&&_e.resourceTiming&&_e.resourceTiming[this.id]&&(Ft=_e.resourceTiming[this.id].slice(0)),X)return void this.fire(new o.ErrorEvent(X));const Xr={dataType:"source"};this._collectResourceTiming&&Ft&&Ft.length>0&&o.extend(Xr,{resourceTiming:Ft}),this.fire(new o.Event("data",{...Xr,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...Xr,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(g,A){const X=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const _e={type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request=this.actor.send(X,_e,(Ft,Xr)=>(delete g.request,g.unloadVectorData(),g.aborted?A(null):Ft?A(Ft):(g.loadVectorData(Xr,this.map.painter,X==="reloadTile"),A(null))))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Uf=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qd extends o.Evented{constructor(g,A,X,_e){super(),this.id=g,this.dispatcher=X,this.coordinates=A.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_e),this.options=A}load(g,A){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ah.getImage(this.map._requestManager.transformRequest(this.url,rl.Image),(X,_e)=>{this._request=null,this._loaded=!0,X?this.fire(new o.ErrorEvent(X)):_e&&(this.image=_e,g&&(this.coordinates=g),A&&A(),this._finishLoading())})}loaded(){return this._loaded}updateImage(g){return g.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=g.url,this.load(g.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(g){this.map=g,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(g){this.coordinates=g;const A=g.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(_e){let Ft=1/0,Xr=1/0,as=-1/0,cs=-1/0;for(const ph of _e)Ft=Math.min(Ft,ph.x),Xr=Math.min(Xr,ph.y),as=Math.max(as,ph.x),cs=Math.max(cs,ph.y);const us=Math.max(as-Ft,cs-Xr),th=Math.max(0,Math.floor(-Math.log(us)/Math.LN2)),eh=Math.pow(2,th);return new o.CanonicalTileID(th,Math.floor((Ft+as)/2*eh),Math.floor((Xr+cs)/2*eh))}(A),this.minzoom=this.maxzoom=this.tileID.z;const X=A.map(_e=>this.tileID.getTilePoint(_e)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(X[0].x,X[0].y,0,0),this._boundsArray.emplaceBack(X[1].x,X[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(X[3].x,X[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(X[2].x,X[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Uf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new $h(g,this.image,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));for(const X in this.tiles){const _e=this.tiles[X];_e.state!=="loaded"&&(_e.state="loaded",_e.texture=this.texture)}}loadTile(g,A){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},A(null)):(g.state="errored",A(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vd extends qd{constructor(g,A,X,_e){super(g,A,X,_e),this.roundZoom=!0,this.type="video",this.options=A}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const A of g.urls)this.urls.push(this.map._requestManager.transformRequest(A,rl.Source).url);o.getVideo(this.urls,(A,X)=>{this._loaded=!0,A?this.fire(new o.ErrorEvent(A)):X&&(this.video=X,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const A=this.video.seekable;g<A.start(0)||g>A.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${A.start(0)} and ${A.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Uf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.texSubImage2D(A.TEXTURE_2D,0,0,0,A.RGBA,A.UNSIGNED_BYTE,this.video)):(this.texture=new $h(g,this.video,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));for(const X in this.tiles){const _e=this.tiles[X];_e.state!=="loaded"&&(_e.state="loaded",_e.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ep extends qd{constructor(g,A,X,_e){super(g,A,X,_e),A.coordinates?Array.isArray(A.coordinates)&&A.coordinates.length===4&&!A.coordinates.some(Ft=>!Array.isArray(Ft)||Ft.length!==2||Ft.some(Xr=>typeof Xr!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),A.animate&&typeof A.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),A.canvas?typeof A.canvas=="string"||A.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=A,this.animate=A.animate===void 0||A.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const A=this.map.painter.context,X=A.gl;this.boundsBuffer||(this.boundsBuffer=A.createVertexBuffer(this._boundsArray,Uf.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new $h(A,this.canvas,X.RGBA,{premultiply:!0});for(const _e in this.tiles){const Ft=this.tiles[_e];Ft.state!=="loaded"&&(Ft.state="loaded",Ft.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}}const _p={vector:wf,raster:kd,"raster-dem":gd,geojson:bp,video:Vd,image:qd,canvas:ep};function lp(he,g){const A=o.create();return o.translate(A,A,[1,1,0]),o.scale(A,A,[.5*he.width,.5*he.height,1]),o.multiply(A,A,he.calculatePosMatrix(g.toUnwrapped()))}function Kh(he,g,A,X,_e,Ft){const Xr=function(eh,ph,Rh){if(eh)for(const Bh of eh){const Ch=ph[Bh];if(Ch&&Ch.source===Rh&&Ch.type==="fill-extrusion")return!0}else for(const Bh in ph){const Ch=ph[Bh];if(Ch.source===Rh&&Ch.type==="fill-extrusion")return!0}return!1}(_e&&_e.layers,g,he.id),as=Ft.maxPitchScaleFactor(),cs=he.tilesIn(X,as,Xr);cs.sort(Qd);const us=[];for(const eh of cs)us.push({wrappedTileID:eh.tileID.wrapped().key,queryResults:eh.tile.queryRenderedFeatures(g,A,he._state,eh.queryGeometry,eh.cameraQueryGeometry,eh.scale,_e,Ft,as,lp(he.transform,eh.tileID))});const th=function(eh){const ph={},Rh={};for(const Bh of eh){const Ch=Bh.queryResults,ed=Bh.wrappedTileID,Ed=Rh[ed]=Rh[ed]||{};for(const _d in Ch){const qh=Ch[_d],Md=Ed[_d]=Ed[_d]||{},Nd=ph[_d]=ph[_d]||[];for(const L of qh)Md[L.featureIndex]||(Md[L.featureIndex]=!0,Nd.push(L))}}return ph}(us);for(const eh in th)th[eh].forEach(ph=>{const Rh=ph.feature,Bh=he.getFeatureState(Rh.layer["source-layer"],Rh.id);Rh.source=Rh.layer.source,Rh.layer["source-layer"]&&(Rh.sourceLayer=Rh.layer["source-layer"]),Rh.state=Bh});return th}function Qd(he,g){const A=he.tileID,X=g.tileID;return A.overscaledZ-X.overscaledZ||A.canonical.y-X.canonical.y||A.wrap-X.wrap||A.canonical.x-X.canonical.x}class fd{constructor(g,A){this.tileID=g,this.uid=o.uniqueId(),this.uses=0,this.tileSize=A,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(g){const A=g+this.timeAdded;A<o.exported.now()||this.fadeEndTime&&A<this.fadeEndTime||(this.fadeEndTime=A)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(g){this.demTexture&&g.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(g,A,X){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",g){g.featureIndex&&(this.latestFeatureIndex=g.featureIndex,g.rawTileData?(this.latestRawTileData=g.rawTileData,this.latestFeatureIndex.rawTileData=g.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=g.collisionBoxArray,this.buckets=function(_e,Ft){const Xr={};if(!Ft)return Xr;for(const as of _e){const cs=as.layerIds.map(us=>Ft.getLayer(us)).filter(Boolean);if(cs.length!==0){as.layers=cs,as.stateDependentLayerIds&&(as.stateDependentLayers=as.stateDependentLayerIds.map(us=>cs.filter(th=>th.id===us)[0]));for(const us of cs)Xr[us.id]=as}}return Xr}(g.buckets,A.style),this.hasSymbolBuckets=!1;for(const _e in this.buckets){const Ft=this.buckets[_e];if(Ft instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!X)break;Ft.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _e in this.buckets){const Ft=this.buckets[_e];if(Ft instanceof o.SymbolBucket&&Ft.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _e in this.buckets){const Ft=this.buckets[_e];this.queryPadding=Math.max(this.queryPadding,A.style.getLayer(_e).queryRadius(Ft))}g.imageAtlas&&(this.imageAtlas=g.imageAtlas),g.glyphAtlasImage&&(this.glyphAtlasImage=g.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const g in this.buckets)this.buckets[g].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(g){return this.buckets[g.id]}upload(g){for(const X in this.buckets){const _e=this.buckets[X];_e.uploadPending()&&_e.upload(g)}const A=g.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $h(g,this.imageAtlas.image,A.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $h(g,this.glyphAtlasImage,A.ALPHA),this.glyphAtlasImage=null)}prepare(g){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(g,this.imageAtlasTexture)}queryRenderedFeatures(g,A,X,_e,Ft,Xr,as,cs,us,th){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_e,cameraQueryGeometry:Ft,scale:Xr,tileSize:this.tileSize,pixelPosMatrix:th,transform:cs,params:as,queryPadding:this.queryPadding*us},g,A,X):{}}querySourceFeatures(g,A){const X=this.latestFeatureIndex;if(!X||!X.rawTileData)return;const _e=X.loadVTLayers(),Ft=A&&A.sourceLayer?A.sourceLayer:"",Xr=_e._geojsonTileLayer||_e[Ft];if(!Xr)return;const as=o.createFilter(A&&A.filter),{z:cs,x:us,y:th}=this.tileID.canonical,eh={z:cs,x:us,y:th};for(let ph=0;ph<Xr.length;ph++){const Rh=Xr.feature(ph);if(as.needGeometry){const ed=o.toEvaluationFeature(Rh,!0);if(!as.filter(new o.EvaluationParameters(this.tileID.overscaledZ),ed,this.tileID.canonical))continue}else if(!as.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Rh))continue;const Bh=X.getId(Rh,Ft),Ch=new o.GeoJSONFeature(Rh,cs,us,th,Bh);Ch.tile=eh,g.push(Ch)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(g){const A=this.expirationTime;if(g.cacheControl){const X=o.parseCacheControl(g.cacheControl);X["max-age"]&&(this.expirationTime=Date.now()+1e3*X["max-age"])}else g.expires&&(this.expirationTime=new Date(g.expires).getTime());if(this.expirationTime){const X=Date.now();let _e=!1;if(this.expirationTime>X)_e=!1;else if(A)if(this.expirationTime<A)_e=!0;else{const Ft=this.expirationTime-A;Ft?this.expirationTime=X+Math.max(Ft,3e4):_e=!0}else _e=!0;_e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(g,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(g).length===0)return;const X=this.latestFeatureIndex.loadVTLayers();for(const _e in this.buckets){if(!A.style.hasLayer(_e))continue;const Ft=this.buckets[_e],Xr=Ft.layers[0].sourceLayer||"_geojsonTileLayer",as=X[Xr],cs=g[Xr];if(!as||!cs||Object.keys(cs).length===0)continue;Ft.update(cs,as,this.imageAtlas&&this.imageAtlas.patternPositions||{});const us=A&&A.style&&A.style.getLayer(_e);us&&(this.queryPadding=Math.max(this.queryPadding,us.queryRadius(Ft)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(g){this.symbolFadeHoldUntil=o.exported.now()+g}setDependencies(g,A){const X={};for(const _e of A)X[_e]=!0;this.dependencies[g]=X}hasDependency(g,A){for(const X of g){const _e=this.dependencies[X];if(_e){for(const Ft of A)if(_e[Ft])return!0}}return!1}}class Jd{constructor(g,A){this.max=g,this.onRemove=A,this.reset()}reset(){for(const g in this.data)for(const A of this.data[g])A.timeout&&clearTimeout(A.timeout),this.onRemove(A.value);return this.data={},this.order=[],this}add(g,A,X){const _e=g.wrapped().key;this.data[_e]===void 0&&(this.data[_e]=[]);const Ft={value:A,timeout:void 0};if(X!==void 0&&(Ft.timeout=setTimeout(()=>{this.remove(g,Ft)},X)),this.data[_e].push(Ft),this.order.push(_e),this.order.length>this.max){const Xr=this._getAndRemoveByKey(this.order[0]);Xr&&this.onRemove(Xr)}return this}has(g){return g.wrapped().key in this.data}getAndRemove(g){return this.has(g)?this._getAndRemoveByKey(g.wrapped().key):null}_getAndRemoveByKey(g){const A=this.data[g].shift();return A.timeout&&clearTimeout(A.timeout),this.data[g].length===0&&delete this.data[g],this.order.splice(this.order.indexOf(g),1),A.value}getByKey(g){const A=this.data[g];return A?A[0].value:null}get(g){return this.has(g)?this.data[g.wrapped().key][0].value:null}remove(g,A){if(!this.has(g))return this;const X=g.wrapped().key,_e=A===void 0?0:this.data[X].indexOf(A),Ft=this.data[X][_e];return this.data[X].splice(_e,1),Ft.timeout&&clearTimeout(Ft.timeout),this.data[X].length===0&&delete this.data[X],this.onRemove(Ft.value),this.order.splice(this.order.indexOf(X),1),this}setMaxSize(g){for(this.max=g;this.order.length>this.max;){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}filter(g){const A=[];for(const X in this.data)for(const _e of this.data[X])g(_e.value)||A.push(_e);for(const X of A)this.remove(X.value.tileID,X)}}class Yh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(g,A,X){const _e=String(A);if(this.stateChanges[g]=this.stateChanges[g]||{},this.stateChanges[g][_e]=this.stateChanges[g][_e]||{},o.extend(this.stateChanges[g][_e],X),this.deletedStates[g]===null){this.deletedStates[g]={};for(const Ft in this.state[g])Ft!==_e&&(this.deletedStates[g][Ft]=null)}else if(this.deletedStates[g]&&this.deletedStates[g][_e]===null){this.deletedStates[g][_e]={};for(const Ft in this.state[g][_e])X[Ft]||(this.deletedStates[g][_e][Ft]=null)}else for(const Ft in X)this.deletedStates[g]&&this.deletedStates[g][_e]&&this.deletedStates[g][_e][Ft]===null&&delete this.deletedStates[g][_e][Ft]}removeFeatureState(g,A,X){if(this.deletedStates[g]===null)return;const _e=String(A);if(this.deletedStates[g]=this.deletedStates[g]||{},X&&A!==void 0)this.deletedStates[g][_e]!==null&&(this.deletedStates[g][_e]=this.deletedStates[g][_e]||{},this.deletedStates[g][_e][X]=null);else if(A!==void 0)if(this.stateChanges[g]&&this.stateChanges[g][_e])for(X in this.deletedStates[g][_e]={},this.stateChanges[g][_e])this.deletedStates[g][_e][X]=null;else this.deletedStates[g][_e]=null;else this.deletedStates[g]=null}getState(g,A){const X=String(A),_e=o.extend({},(this.state[g]||{})[X],(this.stateChanges[g]||{})[X]);if(this.deletedStates[g]===null)return{};if(this.deletedStates[g]){const Ft=this.deletedStates[g][A];if(Ft===null)return{};for(const Xr in Ft)delete _e[Xr]}return _e}initializeTileState(g,A){g.setFeatureState(this.state,A)}coalesceChanges(g,A){const X={};for(const _e in this.stateChanges){this.state[_e]=this.state[_e]||{};const Ft={};for(const Xr in this.stateChanges[_e])this.state[_e][Xr]||(this.state[_e][Xr]={}),o.extend(this.state[_e][Xr],this.stateChanges[_e][Xr]),Ft[Xr]=this.state[_e][Xr];X[_e]=Ft}for(const _e in this.deletedStates){this.state[_e]=this.state[_e]||{};const Ft={};if(this.deletedStates[_e]===null)for(const Xr in this.state[_e])Ft[Xr]={},this.state[_e][Xr]={};else for(const Xr in this.deletedStates[_e]){if(this.deletedStates[_e][Xr]===null)this.state[_e][Xr]={};else for(const as of Object.keys(this.deletedStates[_e][Xr]))delete this.state[_e][Xr][as];Ft[Xr]=this.state[_e][Xr]}X[_e]=X[_e]||{},o.extend(X[_e],Ft)}if(this.stateChanges={},this.deletedStates={},Object.keys(X).length!==0)for(const _e in g)g[_e].setFeatureState(X,A)}}class $d extends o.Evented{constructor(g,A,X){super(),this.id=g,this.dispatcher=X,this.on("data",_e=>{_e.dataType==="source"&&_e.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_e.dataType==="source"&&_e.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_e,Ft,Xr,as){const cs=new _p[Ft.type](_e,Ft,Xr,as);if(cs.id!==_e)throw new Error(`Expected Source id to be ${_e} instead of ${cs.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],cs),cs}(g,A,X,this),this._tiles={},this._cache=new Jd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Yh}onAdd(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(g)}onRemove(g){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(g)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const g in this._tiles){const A=this._tiles[g];if(A.state!=="loaded"&&A.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(g,A){return this._source.loadTile(g,A)}_unloadTile(g){if(this._source.unloadTile)return this._source.unloadTile(g,()=>{})}_abortTile(g){this._source.abortTile&&this._source.abortTile(g,()=>{}),this._source.fire(new o.Event("dataabort",{tile:g,coord:g.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(g){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const A in this._tiles){const X=this._tiles[A];X.upload(g),X.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(g=>g.tileID).sort(Jf).map(g=>g.key)}getRenderableIds(g){const A=[];for(const X in this._tiles)this._isIdRenderable(X,g)&&A.push(this._tiles[X]);return g?A.sort((X,_e)=>{const Ft=X.tileID,Xr=_e.tileID,as=new o.pointGeometry(Ft.canonical.x,Ft.canonical.y)._rotate(this.transform.angle),cs=new o.pointGeometry(Xr.canonical.x,Xr.canonical.y)._rotate(this.transform.angle);return Ft.overscaledZ-Xr.overscaledZ||cs.y-as.y||cs.x-as.x}).map(X=>X.tileID.key):A.map(X=>X.tileID).sort(Jf).map(X=>X.key)}hasRenderableParent(g){const A=this.findLoadedParent(g,0);return!!A&&this._isIdRenderable(A.tileID.key)}_isIdRenderable(g,A){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(A||!this._tiles[g].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const g in this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")}}_reloadTile(g,A){const X=this._tiles[g];X&&(X.state!=="loading"&&(X.state=A),this._loadTile(X,this._tileLoaded.bind(this,X,g,A)))}_tileLoaded(g,A,X,_e){if(_e)return g.state="errored",void(_e.status!==404?this._source.fire(new o.ErrorEvent(_e,{tile:g})):this.update(this.transform,this.terrain));g.timeAdded=o.exported.now(),X==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(A,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),g.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:g,coord:g.tileID}))}_backfillDEM(g){const A=this.getRenderableIds();for(let _e=0;_e<A.length;_e++){const Ft=A[_e];if(g.neighboringTiles&&g.neighboringTiles[Ft]){const Xr=this.getTileByID(Ft);X(g,Xr),X(Xr,g)}}function X(_e,Ft){_e.needsHillshadePrepare=!0,_e.needsTerrainPrepare=!0;let Xr=Ft.tileID.canonical.x-_e.tileID.canonical.x;const as=Ft.tileID.canonical.y-_e.tileID.canonical.y,cs=Math.pow(2,_e.tileID.canonical.z),us=Ft.tileID.key;Xr===0&&as===0||Math.abs(as)>1||(Math.abs(Xr)>1&&(Math.abs(Xr+cs)===1?Xr+=cs:Math.abs(Xr-cs)===1&&(Xr-=cs)),Ft.dem&&_e.dem&&(_e.dem.backfillBorder(Ft.dem,Xr,as),_e.neighboringTiles&&_e.neighboringTiles[us]&&(_e.neighboringTiles[us].backfilled=!0)))}}getTile(g){return this.getTileByID(g.key)}getTileByID(g){return this._tiles[g]}_retainLoadedChildren(g,A,X,_e){for(const Ft in this._tiles){let Xr=this._tiles[Ft];if(_e[Ft]||!Xr.hasData()||Xr.tileID.overscaledZ<=A||Xr.tileID.overscaledZ>X)continue;let as=Xr.tileID;for(;Xr&&Xr.tileID.overscaledZ>A+1;){const us=Xr.tileID.scaledTo(Xr.tileID.overscaledZ-1);Xr=this._tiles[us.key],Xr&&Xr.hasData()&&(as=us)}let cs=as;for(;cs.overscaledZ>A;)if(cs=cs.scaledTo(cs.overscaledZ-1),g[cs.key]){_e[as.key]=as;break}}}findLoadedParent(g,A){if(g.key in this._loadedParentTiles){const X=this._loadedParentTiles[g.key];return X&&X.tileID.overscaledZ>=A?X:null}for(let X=g.overscaledZ-1;X>=A;X--){const _e=g.scaledTo(X),Ft=this._getLoadedTile(_e);if(Ft)return Ft}}_getLoadedTile(g){const A=this._tiles[g.key];return A&&A.hasData()?A:this._cache.getByKey(g.wrapped().key)}updateCacheSize(g){const A=Math.ceil(g.width/this._source.tileSize)+1,X=Math.ceil(g.height/this._source.tileSize)+1,_e=Math.floor(A*X*5),Ft=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_e):_e;this._cache.setMaxSize(Ft)}handleWrapJump(g){const A=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,A){const X={};for(const _e in this._tiles){const Ft=this._tiles[_e];Ft.tileID=Ft.tileID.unwrapTo(Ft.tileID.wrap+A),X[Ft.tileID.key]=Ft}this._tiles=X;for(const _e in this._timers)clearTimeout(this._timers[_e]),delete this._timers[_e];for(const _e in this._tiles)this._setTileReloadTimer(_e,this._tiles[_e])}}update(g,A){if(this.transform=g,this.terrain=A,!this._sourceLoaded||this._paused)return;let X;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?X=g.getVisibleUnwrappedCoordinates(this._source.tileID).map(us=>new o.OverscaledTileID(us.canonical.z,us.wrap,us.canonical.z,us.canonical.x,us.canonical.y)):(X=g.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:A}),this._source.hasTile&&(X=X.filter(us=>this._source.hasTile(us)))):X=[];const _e=g.coveringZoomLevel(this._source),Ft=Math.max(_e-$d.maxOverzooming,this._source.minzoom),Xr=Math.max(_e+$d.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const us={};for(const th of X)if(th.canonical.z>this._source.minzoom){const eh=th.scaledTo(th.canonical.z-1);us[eh.key]=eh;const ph=th.scaledTo(Math.max(this._source.minzoom,Math.min(th.canonical.z,5)));us[ph.key]=ph}X=X.concat(Object.values(us))}const as=this._updateRetainedTiles(X,_e);if(Sf(this._source.type)){const us={},th={},eh=Object.keys(as);for(const ph of eh){const Rh=as[ph],Bh=this._tiles[ph];if(!Bh||Bh.fadeEndTime&&Bh.fadeEndTime<=o.exported.now())continue;const Ch=this.findLoadedParent(Rh,Ft);Ch&&(this._addTile(Ch.tileID),us[Ch.tileID.key]=Ch.tileID),th[ph]=Rh}this._retainLoadedChildren(th,_e,Xr,as);for(const ph in us)as[ph]||(this._coveredTiles[ph]=!0,as[ph]=us[ph]);if(A){const ph={},Rh={};for(const Bh of X)this._tiles[Bh.key].hasData()?ph[Bh.key]=Bh:Rh[Bh.key]=Bh;for(const Bh in Rh){const Ch=Rh[Bh].children(this._source.maxzoom);this._tiles[Ch[0].key]&&this._tiles[Ch[1].key]&&this._tiles[Ch[2].key]&&this._tiles[Ch[3].key]&&(ph[Ch[0].key]=as[Ch[0].key]=Ch[0],ph[Ch[1].key]=as[Ch[1].key]=Ch[1],ph[Ch[2].key]=as[Ch[2].key]=Ch[2],ph[Ch[3].key]=as[Ch[3].key]=Ch[3],delete Rh[Bh])}for(const Bh in Rh){const Ch=this.findLoadedParent(Rh[Bh],this._source.minzoom);if(Ch){ph[Ch.tileID.key]=as[Ch.tileID.key]=Ch.tileID;for(const ed in ph)ph[ed].isChildOf(Ch.tileID)&&delete ph[ed]}}for(const Bh in this._tiles)ph[Bh]||(this._coveredTiles[Bh]=!0)}}for(const us in as)this._tiles[us].clearFadeHold();const cs=o.keysDifference(this._tiles,as);for(const us of cs){const th=this._tiles[us];th.hasSymbolBuckets&&!th.holdingForFade()?th.setHoldDuration(this.map._fadeDuration):th.hasSymbolBuckets&&!th.symbolFadeFinished()||this._removeTile(us)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)}_updateRetainedTiles(g,A){const X={},_e={},Ft=Math.max(A-$d.maxOverzooming,this._source.minzoom),Xr=Math.max(A+$d.maxUnderzooming,this._source.minzoom),as={};for(const cs of g){const us=this._addTile(cs);X[cs.key]=cs,us.hasData()||A<this._source.maxzoom&&(as[cs.key]=cs)}this._retainLoadedChildren(as,A,Xr,X);for(const cs of g){let us=this._tiles[cs.key];if(us.hasData())continue;if(A+1>this._source.maxzoom){const eh=cs.children(this._source.maxzoom)[0],ph=this.getTile(eh);if(ph&&ph.hasData()){X[eh.key]=eh;continue}}else{const eh=cs.children(this._source.maxzoom);if(X[eh[0].key]&&X[eh[1].key]&&X[eh[2].key]&&X[eh[3].key])continue}let th=us.wasRequested();for(let eh=cs.overscaledZ-1;eh>=Ft;--eh){const ph=cs.scaledTo(eh);if(_e[ph.key]||(_e[ph.key]=!0,us=this.getTile(ph),!us&&th&&(us=this._addTile(ph)),us&&(X[ph.key]=ph,th=us.wasRequested(),us.hasData())))break}}return X}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const g in this._tiles){const A=[];let X,_e=this._tiles[g].tileID;for(;_e.overscaledZ>0;){if(_e.key in this._loadedParentTiles){X=this._loadedParentTiles[_e.key];break}A.push(_e.key);const Ft=_e.scaledTo(_e.overscaledZ-1);if(X=this._getLoadedTile(Ft),X)break;_e=Ft}for(const Ft of A)this._loadedParentTiles[Ft]=X}}_addTile(g){let A=this._tiles[g.key];if(A)return A;A=this._cache.getAndRemove(g),A&&(this._setTileReloadTimer(g.key,A),A.tileID=g,this._state.initializeTileState(A,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,A)));const X=A;return A||(A=new fd(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(A,this._tileLoaded.bind(this,A,g.key,A.state))),A.uses++,this._tiles[g.key]=A,X||this._source.fire(new o.Event("dataloading",{tile:A,coord:A.tileID,dataType:"source"})),A}_setTileReloadTimer(g,A){g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);const X=A.getExpiryTimeout();X&&(this._timers[g]=setTimeout(()=>{this._reloadTile(g,"expired"),delete this._timers[g]},X))}_removeTile(g){const A=this._tiles[g];A&&(A.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),A.uses>0||(A.hasData()&&A.state!=="reloading"?this._cache.add(A.tileID,A,A.getExpiryTimeout()):(A.aborted=!0,this._abortTile(A),this._unloadTile(A))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const g in this._tiles)this._removeTile(g);this._cache.reset()}tilesIn(g,A,X){const _e=[],Ft=this.transform;if(!Ft)return _e;const Xr=X?Ft.getCameraQueryGeometry(g):g,as=g.map(Bh=>Ft.pointCoordinate(Bh,this.terrain)),cs=Xr.map(Bh=>Ft.pointCoordinate(Bh,this.terrain)),us=this.getIds();let th=1/0,eh=1/0,ph=-1/0,Rh=-1/0;for(const Bh of cs)th=Math.min(th,Bh.x),eh=Math.min(eh,Bh.y),ph=Math.max(ph,Bh.x),Rh=Math.max(Rh,Bh.y);for(let Bh=0;Bh<us.length;Bh++){const Ch=this._tiles[us[Bh]];if(Ch.holdingForFade())continue;const ed=Ch.tileID,Ed=Math.pow(2,Ft.zoom-Ch.tileID.overscaledZ),_d=A*Ch.queryPadding*o.EXTENT/Ch.tileSize/Ed,qh=[ed.getTilePoint(new o.MercatorCoordinate(th,eh)),ed.getTilePoint(new o.MercatorCoordinate(ph,Rh))];if(qh[0].x-_d<o.EXTENT&&qh[0].y-_d<o.EXTENT&&qh[1].x+_d>=0&&qh[1].y+_d>=0){const Md=as.map(L=>ed.getTilePoint(L)),Nd=cs.map(L=>ed.getTilePoint(L));_e.push({tile:Ch,tileID:ed,queryGeometry:Md,cameraQueryGeometry:Nd,scale:Ed})}}return _e}getVisibleCoordinates(g){const A=this.getRenderableIds(g).map(X=>this._tiles[X].tileID);for(const X of A)X.posMatrix=this.transform.calculatePosMatrix(X.toUnwrapped());return A}hasTransition(){if(this._source.hasTransition())return!0;if(Sf(this._source.type))for(const g in this._tiles){const A=this._tiles[g];if(A.fadeEndTime!==void 0&&A.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(g,A,X){this._state.updateState(g=g||"_geojsonTileLayer",A,X)}removeFeatureState(g,A,X){this._state.removeFeatureState(g=g||"_geojsonTileLayer",A,X)}getFeatureState(g,A){return this._state.getState(g=g||"_geojsonTileLayer",A)}setDependencies(g,A,X){const _e=this._tiles[g];_e&&_e.setDependencies(A,X)}reloadTilesForDependencies(g,A){for(const X in this._tiles)this._tiles[X].hasDependency(g,A)&&this._reloadTile(X,"reloading");this._cache.filter(X=>!X.hasDependency(g,A))}}function Jf(he,g){const A=Math.abs(2*he.wrap)-+(he.wrap<0),X=Math.abs(2*g.wrap)-+(g.wrap<0);return he.overscaledZ-g.overscaledZ||X-A||g.canonical.y-he.canonical.y||g.canonical.x-he.canonical.x}function Sf(he){return he==="raster"||he==="image"||he==="video"}$d.maxOverzooming=10,$d.maxUnderzooming=3;const If="mapboxgl_preloaded_worker_pool";class Xf{constructor(){this.active={}}acquire(g){if(!this.workers)for(this.workers=[];this.workers.length<Xf.workerCount;)this.workers.push(new Worker(_0.workerUrl));return this.active[g]=!0,this.workers.slice()}release(g){delete this.active[g],this.numActive()===0&&(this.workers.forEach(A=>{A.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[If]}numActive(){return Object.keys(this.active).length}}const Of=Math.floor(o.exported.hardwareConcurrency/2);let jf;function Ap(){return jf||(jf=new Xf),jf}function vp(he,g){const A={};for(const X in he)X!=="ref"&&(A[X]=he[X]);return o.refProperties.forEach(X=>{X in g&&(A[X]=g[X])}),A}function Tp(he){he=he.slice();const g=Object.create(null);for(let A=0;A<he.length;A++)g[he[A].id]=he[A];for(let A=0;A<he.length;A++)"ref"in he[A]&&(he[A]=vp(he[A],g[he[A].ref]));return he}Xf.workerCount=Math.max(Math.min(Of,6),1);const Zf={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function qp(he,g,A){A.push({command:Zf.addSource,args:[he,g[he]]})}function sm(he,g,A){g.push({command:Zf.removeSource,args:[he]}),A[he]=!0}function Wd(he,g,A,X){sm(he,A,X),qp(he,g,A)}function $p(he,g,A){let X;for(X in he[A])if(Object.prototype.hasOwnProperty.call(he[A],X)&&X!=="data"&&!nt(he[A][X],g[A][X]))return!1;for(X in g[A])if(Object.prototype.hasOwnProperty.call(g[A],X)&&X!=="data"&&!nt(he[A][X],g[A][X]))return!1;return!0}function Lh(he,g,A,X,_e,Ft){let Xr;for(Xr in g=g||{},he=he||{})Object.prototype.hasOwnProperty.call(he,Xr)&&(nt(he[Xr],g[Xr])||A.push({command:Ft,args:[X,Xr,g[Xr],_e]}));for(Xr in g)Object.prototype.hasOwnProperty.call(g,Xr)&&!Object.prototype.hasOwnProperty.call(he,Xr)&&(nt(he[Xr],g[Xr])||A.push({command:Ft,args:[X,Xr,g[Xr],_e]}))}function lh(he){return he.id}function ih(he,g){return he[g.id]=g,he}class Ah{constructor(g,A){this.reset(g,A)}reset(g,A){this.points=g||[],this._distances=[0];for(let X=1;X<this.points.length;X++)this._distances[X]=this._distances[X-1]+this.points[X].dist(this.points[X-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(A||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(g){if(this.points.length===1)return this.points[0];g=o.clamp(g,0,1);let A=1,X=this._distances[A];const _e=g*this.paddedLength+this.padding;for(;X<_e&&A<this._distances.length;)X=this._distances[++A];const Ft=A-1,Xr=this._distances[Ft],as=X-Xr,cs=as>0?(_e-Xr)/as:0;return this.points[Ft].mult(1-cs).add(this.points[A].mult(cs))}}function zh(he,g){let A=!0;return he==="always"||he!=="never"&&g!=="never"||(A=!1),A}class Qh{constructor(g,A,X){const _e=this.boxCells=[],Ft=this.circleCells=[];this.xCellCount=Math.ceil(g/X),this.yCellCount=Math.ceil(A/X);for(let Xr=0;Xr<this.xCellCount*this.yCellCount;Xr++)_e.push([]),Ft.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=g,this.height=A,this.xScale=this.xCellCount/g,this.yScale=this.yCellCount/A,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(g,A,X,_e,Ft){this._forEachCell(A,X,_e,Ft,this._insertBoxCell,this.boxUid++),this.boxKeys.push(g),this.bboxes.push(A),this.bboxes.push(X),this.bboxes.push(_e),this.bboxes.push(Ft)}insertCircle(g,A,X,_e){this._forEachCell(A-_e,X-_e,A+_e,X+_e,this._insertCircleCell,this.circleUid++),this.circleKeys.push(g),this.circles.push(A),this.circles.push(X),this.circles.push(_e)}_insertBoxCell(g,A,X,_e,Ft,Xr){this.boxCells[Ft].push(Xr)}_insertCircleCell(g,A,X,_e,Ft,Xr){this.circleCells[Ft].push(Xr)}_query(g,A,X,_e,Ft,Xr,as){if(X<0||g>this.width||_e<0||A>this.height)return[];const cs=[];if(g<=0&&A<=0&&this.width<=X&&this.height<=_e){if(Ft)return[{key:null,x1:g,y1:A,x2:X,y2:_e}];for(let us=0;us<this.boxKeys.length;us++)cs.push({key:this.boxKeys[us],x1:this.bboxes[4*us],y1:this.bboxes[4*us+1],x2:this.bboxes[4*us+2],y2:this.bboxes[4*us+3]});for(let us=0;us<this.circleKeys.length;us++){const th=this.circles[3*us],eh=this.circles[3*us+1],ph=this.circles[3*us+2];cs.push({key:this.circleKeys[us],x1:th-ph,y1:eh-ph,x2:th+ph,y2:eh+ph})}}else this._forEachCell(g,A,X,_e,this._queryCell,cs,{hitTest:Ft,overlapMode:Xr,seenUids:{box:{},circle:{}}},as);return cs}query(g,A,X,_e){return this._query(g,A,X,_e,!1,null)}hitTest(g,A,X,_e,Ft,Xr){return this._query(g,A,X,_e,!0,Ft,Xr).length>0}hitTestCircle(g,A,X,_e,Ft){const Xr=g-X,as=g+X,cs=A-X,us=A+X;if(as<0||Xr>this.width||us<0||cs>this.height)return!1;const th=[];return this._forEachCell(Xr,cs,as,us,this._queryCellCircle,th,{hitTest:!0,overlapMode:_e,circle:{x:g,y:A,radius:X},seenUids:{box:{},circle:{}}},Ft),th.length>0}_queryCell(g,A,X,_e,Ft,Xr,as,cs){const{seenUids:us,hitTest:th,overlapMode:eh}=as,ph=this.boxCells[Ft];if(ph!==null){const Bh=this.bboxes;for(const Ch of ph)if(!us.box[Ch]){us.box[Ch]=!0;const ed=4*Ch,Ed=this.boxKeys[Ch];if(g<=Bh[ed+2]&&A<=Bh[ed+3]&&X>=Bh[ed+0]&&_e>=Bh[ed+1]&&(!cs||cs(Ed))&&(!th||!zh(eh,Ed.overlapMode))&&(Xr.push({key:Ed,x1:Bh[ed],y1:Bh[ed+1],x2:Bh[ed+2],y2:Bh[ed+3]}),th))return!0}}const Rh=this.circleCells[Ft];if(Rh!==null){const Bh=this.circles;for(const Ch of Rh)if(!us.circle[Ch]){us.circle[Ch]=!0;const ed=3*Ch,Ed=this.circleKeys[Ch];if(this._circleAndRectCollide(Bh[ed],Bh[ed+1],Bh[ed+2],g,A,X,_e)&&(!cs||cs(Ed))&&(!th||!zh(eh,Ed.overlapMode))){const _d=Bh[ed],qh=Bh[ed+1],Md=Bh[ed+2];if(Xr.push({key:Ed,x1:_d-Md,y1:qh-Md,x2:_d+Md,y2:qh+Md}),th)return!0}}}return!1}_queryCellCircle(g,A,X,_e,Ft,Xr,as,cs){const{circle:us,seenUids:th,overlapMode:eh}=as,ph=this.boxCells[Ft];if(ph!==null){const Bh=this.bboxes;for(const Ch of ph)if(!th.box[Ch]){th.box[Ch]=!0;const ed=4*Ch,Ed=this.boxKeys[Ch];if(this._circleAndRectCollide(us.x,us.y,us.radius,Bh[ed+0],Bh[ed+1],Bh[ed+2],Bh[ed+3])&&(!cs||cs(Ed))&&!zh(eh,Ed.overlapMode))return Xr.push(!0),!0}}const Rh=this.circleCells[Ft];if(Rh!==null){const Bh=this.circles;for(const Ch of Rh)if(!th.circle[Ch]){th.circle[Ch]=!0;const ed=3*Ch,Ed=this.circleKeys[Ch];if(this._circlesCollide(Bh[ed],Bh[ed+1],Bh[ed+2],us.x,us.y,us.radius)&&(!cs||cs(Ed))&&!zh(eh,Ed.overlapMode))return Xr.push(!0),!0}}}_forEachCell(g,A,X,_e,Ft,Xr,as,cs){const us=this._convertToXCellCoord(g),th=this._convertToYCellCoord(A),eh=this._convertToXCellCoord(X),ph=this._convertToYCellCoord(_e);for(let Rh=us;Rh<=eh;Rh++)for(let Bh=th;Bh<=ph;Bh++)if(Ft.call(this,g,A,X,_e,this.xCellCount*Bh+Rh,Xr,as,cs))return}_convertToXCellCoord(g){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(g*this.xScale)))}_convertToYCellCoord(g){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(g*this.yScale)))}_circlesCollide(g,A,X,_e,Ft,Xr){const as=_e-g,cs=Ft-A,us=X+Xr;return us*us>as*as+cs*cs}_circleAndRectCollide(g,A,X,_e,Ft,Xr,as){const cs=(Xr-_e)/2,us=Math.abs(g-(_e+cs));if(us>cs+X)return!1;const th=(as-Ft)/2,eh=Math.abs(A-(Ft+th));if(eh>th+X)return!1;if(us<=cs||eh<=th)return!0;const ph=us-cs,Rh=eh-th;return ph*ph+Rh*Rh<=X*X}}function Th(he,g,A,X,_e){const Ft=o.create();return g?(o.scale(Ft,Ft,[1/_e,1/_e,1]),A||o.rotateZ(Ft,Ft,X.angle)):o.multiply(Ft,X.labelPlaneMatrix,he),Ft}function Fh(he,g,A,X,_e){if(g){const Ft=o.clone(he);return o.scale(Ft,Ft,[_e,_e,1]),A||o.rotateZ(Ft,Ft,-X.angle),Ft}return X.glCoordMatrix}function al(he,g,A){let X;A?(X=[he.x,he.y,A(he.x,he.y),1],o.transformMat4(X,X,g)):(X=[he.x,he.y,0,1],td(X,X,g));const _e=X[3];return{point:new o.pointGeometry(X[0]/_e,X[1]/_e),signedDistanceFromCamera:_e}}function fh(he,g){return .5+he/g*.5}function nl(he,g){const A=he[0]/he[3],X=he[1]/he[3];return A>=-g[0]&&A<=g[0]&&X>=-g[1]&&X<=g[1]}function Zs(he,g,A,X,_e,Ft,Xr,as,cs,us){const th=X?he.textSizeData:he.iconSizeData,eh=o.evaluateSizeForZoom(th,A.transform.zoom),ph=[256/A.width*2+1,256/A.height*2+1],Rh=X?he.text.dynamicLayoutVertexArray:he.icon.dynamicLayoutVertexArray;Rh.clear();const Bh=he.lineVertexArray,Ch=X?he.text.placedSymbolArray:he.icon.placedSymbolArray,ed=A.transform.width/A.transform.height;let Ed=!1;for(let _d=0;_d<Ch.length;_d++){const qh=Ch.get(_d);if(qh.hidden||qh.writingMode===o.WritingMode.vertical&&!Ed){Zh(qh.numGlyphs,Rh);continue}let Md;if(Ed=!1,us?(Md=[qh.anchorX,qh.anchorY,us(qh.anchorX,qh.anchorY),1],o.transformMat4(Md,Md,g)):(Md=[qh.anchorX,qh.anchorY,0,1],td(Md,Md,g)),!nl(Md,ph)){Zh(qh.numGlyphs,Rh);continue}const Nd=fh(A.transform.cameraToCenterDistance,Md[3]),L=o.evaluateSizeForFeature(th,eh,qh),u=Xr?L/Nd:L*Nd,E=new o.pointGeometry(qh.anchorX,qh.anchorY),B=al(E,_e,us).point,Y={},vt=xh(qh,u,!1,as,g,_e,Ft,he.glyphOffsetArray,Bh,Rh,B,E,Y,ed,cs,us);Ed=vt.useVertical,(vt.notEnoughRoom||Ed||vt.needsFlipping&&xh(qh,u,!0,as,g,_e,Ft,he.glyphOffsetArray,Bh,Rh,B,E,Y,ed,cs,us).notEnoughRoom)&&Zh(qh.numGlyphs,Rh)}X?he.text.dynamicLayoutVertexBuffer.updateData(Rh):he.icon.dynamicLayoutVertexBuffer.updateData(Rh)}function ol(he,g,A,X,_e,Ft,Xr,as,cs,us,th,eh,ph){const Rh=as.glyphStartIndex+as.numGlyphs,Bh=as.lineStartIndex,Ch=as.lineStartIndex+as.lineLength,ed=g.getoffsetX(as.glyphStartIndex),Ed=g.getoffsetX(Rh-1),_d=Uh(he*ed,A,X,_e,Ft,Xr,as.segment,Bh,Ch,cs,us,th,eh,ph);if(!_d)return null;const qh=Uh(he*Ed,A,X,_e,Ft,Xr,as.segment,Bh,Ch,cs,us,th,eh,ph);return qh?{first:_d,last:qh}:null}function sh(he,g,A,X){return he===o.WritingMode.horizontal&&Math.abs(A.y-g.y)>Math.abs(A.x-g.x)*X?{useVertical:!0}:(he===o.WritingMode.vertical?g.y<A.y:g.x>A.x)?{needsFlipping:!0}:null}function xh(he,g,A,X,_e,Ft,Xr,as,cs,us,th,eh,ph,Rh,Bh,Ch){const ed=g/24,Ed=he.lineOffsetX*ed,_d=he.lineOffsetY*ed;let qh;if(he.numGlyphs>1){const Md=he.glyphStartIndex+he.numGlyphs,Nd=he.lineStartIndex,L=he.lineStartIndex+he.lineLength,u=ol(ed,as,Ed,_d,A,th,eh,he,cs,Ft,ph,Bh,Ch);if(!u)return{notEnoughRoom:!0};const E=al(u.first.point,Xr,Ch).point,B=al(u.last.point,Xr,Ch).point;if(X&&!A){const Y=sh(he.writingMode,E,B,Rh);if(Y)return Y}qh=[u.first];for(let Y=he.glyphStartIndex+1;Y<Md-1;Y++)qh.push(Uh(ed*as.getoffsetX(Y),Ed,_d,A,th,eh,he.segment,Nd,L,cs,Ft,ph,Bh,Ch));qh.push(u.last)}else{if(X&&!A){const Nd=al(eh,_e,Ch).point,L=he.lineStartIndex+he.segment+1,u=new o.pointGeometry(cs.getx(L),cs.gety(L)),E=al(u,_e,Ch),B=E.signedDistanceFromCamera>0?E.point:Mh(eh,u,Nd,1,_e,Ch),Y=sh(he.writingMode,Nd,B,Rh);if(Y)return Y}const Md=Uh(ed*as.getoffsetX(he.glyphStartIndex),Ed,_d,A,th,eh,he.segment,he.lineStartIndex,he.lineStartIndex+he.lineLength,cs,Ft,ph,Bh,Ch);if(!Md)return{notEnoughRoom:!0};qh=[Md]}for(const Md of qh)o.addDynamicAttributes(us,Md.point,Md.angle);return{}}function Mh(he,g,A,X,_e,Ft){const Xr=al(he.add(he.sub(g)._unit()),_e,Ft).point,as=A.sub(Xr);return A.add(as._mult(X/as.mag()))}function Uh(he,g,A,X,_e,Ft,Xr,as,cs,us,th,eh,ph,Rh){const Bh=X?he-g:he+g;let Ch=Bh>0?1:-1,ed=0;X&&(Ch*=-1,ed=Math.PI),Ch<0&&(ed+=Math.PI);let Ed=Ch>0?as+Xr:as+Xr+1,_d=_e,qh=_e,Md=0,Nd=0;const L=Math.abs(Bh),u=[];for(;Md+Nd<=L;){if(Ed+=Ch,Ed<as||Ed>=cs)return null;if(qh=_d,u.push(_d),_d=eh[Ed],_d===void 0){const mr=new o.pointGeometry(us.getx(Ed),us.gety(Ed)),Ur=al(mr,th,Rh);if(Ur.signedDistanceFromCamera>0)_d=eh[Ed]=Ur.point;else{const Gn=Ed-Ch;_d=Mh(Md===0?Ft:new o.pointGeometry(us.getx(Gn),us.gety(Gn)),mr,qh,L-Md+1,th,Rh)}}Md+=Nd,Nd=qh.dist(_d)}const E=(L-Md)/Nd,B=_d.sub(qh),Y=B.mult(E)._add(qh);Y._add(B._unit()._perp()._mult(A*Ch));const vt=ed+Math.atan2(_d.y-qh.y,_d.x-qh.x);return u.push(Y),{point:Y,angle:ph?vt:0,path:u}}const Nh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Zh(he,g){for(let A=0;A<he;A++){const X=g.length;g.resize(X+4),g.float32.set(Nh,3*X)}}function td(he,g,A){const X=g[0],_e=g[1];return he[0]=A[0]*X+A[4]*_e+A[12],he[1]=A[1]*X+A[5]*_e+A[13],he[3]=A[3]*X+A[7]*_e+A[15],he}const Ad=100;class Zd{constructor(g,A=new Qh(g.width+200,g.height+200,25),X=new Qh(g.width+200,g.height+200,25)){this.transform=g,this.grid=A,this.ignoredGrid=X,this.pitchfactor=Math.cos(g._pitch)*g.cameraToCenterDistance,this.screenRightBoundary=g.width+Ad,this.screenBottomBoundary=g.height+Ad,this.gridRightBoundary=g.width+200,this.gridBottomBoundary=g.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(g,A,X,_e,Ft,Xr){const as=this.projectAndGetPerspectiveRatio(_e,g.anchorPointX,g.anchorPointY,Xr),cs=X*as.perspectiveRatio,us=g.x1*cs+as.point.x,th=g.y1*cs+as.point.y,eh=g.x2*cs+as.point.x,ph=g.y2*cs+as.point.y;return!this.isInsideGrid(us,th,eh,ph)||A!=="always"&&this.grid.hitTest(us,th,eh,ph,A,Ft)||as.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[us,th,eh,ph],offscreen:this.isOffscreen(us,th,eh,ph)}}placeCollisionCircles(g,A,X,_e,Ft,Xr,as,cs,us,th,eh,ph,Rh,Bh){const Ch=[],ed=new o.pointGeometry(A.anchorX,A.anchorY),Ed=al(ed,Xr,Bh),_d=fh(this.transform.cameraToCenterDistance,Ed.signedDistanceFromCamera),qh=(th?Ft/_d:Ft*_d)/o.ONE_EM,Md=al(ed,as,Bh).point,Nd=ol(qh,_e,A.lineOffsetX*qh,A.lineOffsetY*qh,!1,Md,ed,A,X,as,{},!1,Bh);let L=!1,u=!1,E=!0;if(Nd){const B=.5*ph*_d+Rh,Y=new o.pointGeometry(-100,-100),vt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),mr=new Ah,Ur=Nd.first,Gn=Nd.last;let $s=[];for(let dh=Ur.path.length-1;dh>=1;dh--)$s.push(Ur.path[dh]);for(let dh=1;dh<Gn.path.length;dh++)$s.push(Gn.path[dh]);const el=2.5*B;if(cs){const dh=$s.map(gh=>al(gh,cs,Bh));$s=dh.some(gh=>gh.signedDistanceFromCamera<=0)?[]:dh.map(gh=>gh.point)}let Wu=[];if($s.length>0){const dh=$s[0].clone(),gh=$s[0].clone();for(let Eh=1;Eh<$s.length;Eh++)dh.x=Math.min(dh.x,$s[Eh].x),dh.y=Math.min(dh.y,$s[Eh].y),gh.x=Math.max(gh.x,$s[Eh].x),gh.y=Math.max(gh.y,$s[Eh].y);Wu=dh.x>=Y.x&&gh.x<=vt.x&&dh.y>=Y.y&&gh.y<=vt.y?[$s]:gh.x<Y.x||dh.x>vt.x||gh.y<Y.y||dh.y>vt.y?[]:o.clipLine([$s],Y.x,Y.y,vt.x,vt.y)}for(const dh of Wu){mr.reset(dh,.25*B);let gh=0;gh=mr.length<=.5*B?1:Math.ceil(mr.paddedLength/el)+1;for(let Eh=0;Eh<gh;Eh++){const yh=Eh/Math.max(gh-1,1),Ih=mr.lerp(yh),Qu=Ih.x+Ad,bh=Ih.y+Ad;Ch.push(Qu,bh,B,0);const kh=Qu-B,Oh=bh-B,rd=Qu+B,sd=bh+B;if(E=E&&this.isOffscreen(kh,Oh,rd,sd),u=u||this.isInsideGrid(kh,Oh,rd,sd),g!=="always"&&this.grid.hitTestCircle(Qu,bh,B,g,eh)&&(L=!0,!us))return{circles:[],offscreen:!1,collisionDetected:L}}}}return{circles:!us&&L||!u||_d<this.perspectiveRatioCutoff?[]:Ch,offscreen:E,collisionDetected:L}}queryRenderedSymbols(g){if(g.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const A=[];let X=1/0,_e=1/0,Ft=-1/0,Xr=-1/0;for(const th of g){const eh=new o.pointGeometry(th.x+Ad,th.y+Ad);X=Math.min(X,eh.x),_e=Math.min(_e,eh.y),Ft=Math.max(Ft,eh.x),Xr=Math.max(Xr,eh.y),A.push(eh)}const as=this.grid.query(X,_e,Ft,Xr).concat(this.ignoredGrid.query(X,_e,Ft,Xr)),cs={},us={};for(const th of as){const eh=th.key;if(cs[eh.bucketInstanceId]===void 0&&(cs[eh.bucketInstanceId]={}),cs[eh.bucketInstanceId][eh.featureIndex])continue;const ph=[new o.pointGeometry(th.x1,th.y1),new o.pointGeometry(th.x2,th.y1),new o.pointGeometry(th.x2,th.y2),new o.pointGeometry(th.x1,th.y2)];o.polygonIntersectsPolygon(A,ph)&&(cs[eh.bucketInstanceId][eh.featureIndex]=!0,us[eh.bucketInstanceId]===void 0&&(us[eh.bucketInstanceId]=[]),us[eh.bucketInstanceId].push(eh.featureIndex))}return us}insertCollisionBox(g,A,X,_e,Ft,Xr){(X?this.ignoredGrid:this.grid).insert({bucketInstanceId:_e,featureIndex:Ft,collisionGroupID:Xr,overlapMode:A},g[0],g[1],g[2],g[3])}insertCollisionCircles(g,A,X,_e,Ft,Xr){const as=X?this.ignoredGrid:this.grid,cs={bucketInstanceId:_e,featureIndex:Ft,collisionGroupID:Xr,overlapMode:A};for(let us=0;us<g.length;us+=4)as.insertCircle(cs,g[us],g[us+1],g[us+2])}projectAndGetPerspectiveRatio(g,A,X,_e){let Ft;return _e?(Ft=[A,X,_e(A,X),1],o.transformMat4(Ft,Ft,g)):(Ft=[A,X,0,1],td(Ft,Ft,g)),{point:new o.pointGeometry((Ft[0]/Ft[3]+1)/2*this.transform.width+Ad,(-Ft[1]/Ft[3]+1)/2*this.transform.height+Ad),perspectiveRatio:.5+this.transform.cameraToCenterDistance/Ft[3]*.5}}isOffscreen(g,A,X,_e){return X<Ad||g>=this.screenRightBoundary||_e<Ad||A>this.screenBottomBoundary}isInsideGrid(g,A,X,_e){return X>=0&&g<this.gridRightBoundary&&_e>=0&&A<this.gridBottomBoundary}getViewportMatrix(){const g=o.identity([]);return o.translate(g,g,[-100,-100,0]),g}}function Fd(he,g,A){return g*(o.EXTENT/(he.tileSize*Math.pow(2,A-he.tileID.overscaledZ)))}class Kf{constructor(g,A,X,_e){this.opacity=g?Math.max(0,Math.min(1,g.opacity+(g.placed?A:-A))):_e&&X?1:0,this.placed=X}isHidden(){return this.opacity===0&&!this.placed}}class up{constructor(g,A,X,_e,Ft){this.text=new Kf(g?g.text:null,A,X,Ft),this.icon=new Kf(g?g.icon:null,A,_e,Ft)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ap{constructor(g,A,X){this.text=g,this.icon=A,this.skipFade=X}}class wp{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Hp{constructor(g,A,X,_e,Ft){this.bucketInstanceId=g,this.featureIndex=A,this.sourceLayerIndex=X,this.bucketIndex=_e,this.tileID=Ft}}class Ip{constructor(g){this.crossSourceCollisions=g,this.maxGroupID=0,this.collisionGroups={}}get(g){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[g]){const A=++this.maxGroupID;this.collisionGroups[g]={ID:A,predicate:X=>X.collisionGroupID===A}}return this.collisionGroups[g]}}function Gh(he,g,A,X,_e){const{horizontalAlign:Ft,verticalAlign:Xr}=o.getAnchorAlignment(he),as=-(Ft-.5)*g,cs=-(Xr-.5)*A,us=o.evaluateVariableOffset(he,X);return new o.pointGeometry(as+us[0]*_e,cs+us[1]*_e)}function Nf(he,g,A,X,_e,Ft){const{x1:Xr,x2:as,y1:cs,y2:us,anchorPointX:th,anchorPointY:eh}=he,ph=new o.pointGeometry(g,A);return X&&ph._rotate(_e?Ft:-Ft),{x1:Xr+ph.x,y1:cs+ph.y,x2:as+ph.x,y2:us+ph.y,anchorPointX:th,anchorPointY:eh}}class Hf{constructor(g,A,X,_e,Ft){this.transform=g.clone(),this.terrain=A,this.collisionIndex=new Zd(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=X,this.retainedQueryData={},this.collisionGroups=new Ip(_e),this.collisionCircleArrays={},this.prevPlacement=Ft,Ft&&(Ft.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(g,A,X,_e){const Ft=X.getBucket(A),Xr=X.latestFeatureIndex;if(!Ft||!Xr||A.id!==Ft.layerIds[0])return;const as=X.collisionBoxArray,cs=Ft.layers[0].layout,us=Math.pow(2,this.transform.zoom-X.tileID.overscaledZ),th=X.tileSize/o.EXTENT,eh=this.transform.calculatePosMatrix(X.tileID.toUnwrapped()),ph=cs.get("text-pitch-alignment")==="map",Rh=cs.get("text-rotation-alignment")==="map",Bh=Fd(X,1,this.transform.zoom),Ch=Th(eh,ph,Rh,this.transform,Bh);let ed=null;if(ph){const _d=Fh(eh,ph,Rh,this.transform,Bh);ed=o.multiply([],this.transform.labelPlaneMatrix,_d)}this.retainedQueryData[Ft.bucketInstanceId]=new Hp(Ft.bucketInstanceId,Xr,Ft.sourceLayerIndex,Ft.index,X.tileID);const Ed={bucket:Ft,layout:cs,posMatrix:eh,textLabelPlaneMatrix:Ch,labelToScreenMatrix:ed,scale:us,textPixelRatio:th,holdingForFade:X.holdingForFade(),collisionBoxArray:as,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(Ft.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(Ft.sourceID)};if(_e)for(const _d of Ft.sortKeyRanges){const{sortKey:qh,symbolInstanceStart:Md,symbolInstanceEnd:Nd}=_d;g.push({sortKey:qh,symbolInstanceStart:Md,symbolInstanceEnd:Nd,parameters:Ed})}else g.push({symbolInstanceStart:0,symbolInstanceEnd:Ft.symbolInstances.length,parameters:Ed})}attemptAnchorPlacement(g,A,X,_e,Ft,Xr,as,cs,us,th,eh,ph,Rh,Bh,Ch,ed){const Ed=[ph.textOffset0,ph.textOffset1],_d=Gh(g,X,_e,Ed,Ft),qh=this.collisionIndex.placeCollisionBox(Nf(A,_d.x,_d.y,Xr,as,this.transform.angle),eh,cs,us,th.predicate,ed);if((!Ch||this.collisionIndex.placeCollisionBox(Nf(Ch,_d.x,_d.y,Xr,as,this.transform.angle),eh,cs,us,th.predicate,ed).box.length!==0)&&qh.box.length>0){let Md;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID].text&&(Md=this.prevPlacement.variableOffsets[ph.crossTileID].anchor),ph.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ph.crossTileID]={textOffset:Ed,width:X,height:_e,anchor:g,textBoxScale:Ft,prevAnchor:Md},this.markUsedJustification(Rh,g,ph,Bh),Rh.allowVerticalPlacement&&(this.markUsedOrientation(Rh,Bh,ph),this.placedOrientations[ph.crossTileID]=Bh),{shift:_d,placedGlyphBoxes:qh}}}placeLayerBucketPart(g,A,X){const{bucket:_e,layout:Ft,posMatrix:Xr,textLabelPlaneMatrix:as,labelToScreenMatrix:cs,textPixelRatio:us,holdingForFade:th,collisionBoxArray:eh,partiallyEvaluatedTextSize:ph,collisionGroup:Rh}=g.parameters,Bh=Ft.get("text-optional"),Ch=Ft.get("icon-optional"),ed=o.getOverlapMode(Ft,"text-overlap","text-allow-overlap"),Ed=ed==="always",_d=o.getOverlapMode(Ft,"icon-overlap","icon-allow-overlap"),qh=_d==="always",Md=Ft.get("text-rotation-alignment")==="map",Nd=Ft.get("text-pitch-alignment")==="map",L=Ft.get("icon-text-fit")!=="none",u=Ft.get("symbol-z-order")==="viewport-y",E=Ed&&(qh||!_e.hasIconData()||Ch),B=qh&&(Ed||!_e.hasTextData()||Bh);!_e.collisionArrays&&eh&&_e.deserializeCollisionBoxes(eh);const Y=(vt,mr)=>{if(A[vt.crossTileID])return;if(th)return void(this.placements[vt.crossTileID]=new ap(!1,!1,!1));let Ur=!1,Gn=!1,$s=!0,el=null,Wu={box:null,offscreen:null},dh={box:null,offscreen:null},gh=null,Eh=null,yh=null,Ih=0,Qu=0,bh=0;mr.textFeatureIndex?Ih=mr.textFeatureIndex:vt.useRuntimeCollisionCircles&&(Ih=vt.featureIndex),mr.verticalTextFeatureIndex&&(Qu=mr.verticalTextFeatureIndex);const kh=this.retainedQueryData[_e.bucketInstanceId].tileID,Oh=this.terrain?(dd,ud)=>this.terrain.getElevation(kh,dd,ud):null;for(const dd of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const ud=mr[dd];ud&&(ud.elevation=Oh?Oh(ud.anchorPointX,ud.anchorPointY):0)}const rd=mr.textBox;if(rd){const dd=md=>{let Af=o.WritingMode.horizontal;if(_e.allowVerticalPlacement&&!md&&this.prevPlacement){const Td=this.prevPlacement.placedOrientations[vt.crossTileID];Td&&(this.placedOrientations[vt.crossTileID]=Td,Af=Td,this.markUsedOrientation(_e,Af,vt))}return Af},ud=(md,Af)=>{if(_e.allowVerticalPlacement&&vt.numVerticalGlyphVertices>0&&mr.verticalTextBox){for(const Td of _e.writingModes)if(Td===o.WritingMode.vertical?(Wu=Af(),dh=Wu):Wu=md(),Wu&&Wu.box&&Wu.box.length)break}else Wu=md()};if(Ft.get("text-variable-anchor")){let md=Ft.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[vt.crossTileID]){const Gd=this.prevPlacement.variableOffsets[vt.crossTileID];md.indexOf(Gd.anchor)>0&&(md=md.filter(Od=>Od!==Gd.anchor),md.unshift(Gd.anchor))}const Af=(Gd,Od,Lf)=>{const Dd=Gd.x2-Gd.x1,yf=Gd.y2-Gd.y1,zf=vt.textBoxScale,Pf=L&&_d==="never"?Od:null;let Vf={box:[],offscreen:!1};const Lp=ed!=="never"?2*md.length:md.length;for(let Mp=0;Mp<Lp;++Mp){const fp=this.attemptAnchorPlacement(md[Mp%md.length],Gd,Dd,yf,zf,Md,Nd,us,Xr,Rh,Mp>=md.length?ed:"never",vt,_e,Lf,Pf,Oh);if(fp&&(Vf=fp.placedGlyphBoxes,Vf&&Vf.box&&Vf.box.length)){Ur=!0,el=fp.shift;break}}return Vf};ud(()=>Af(rd,mr.iconBox,o.WritingMode.horizontal),()=>{const Gd=mr.verticalTextBox;return _e.allowVerticalPlacement&&!(Wu&&Wu.box&&Wu.box.length)&&vt.numVerticalGlyphVertices>0&&Gd?Af(Gd,mr.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Wu&&(Ur=Wu.box,$s=Wu.offscreen);const Td=dd(Wu&&Wu.box);if(!Ur&&this.prevPlacement){const Gd=this.prevPlacement.variableOffsets[vt.crossTileID];Gd&&(this.variableOffsets[vt.crossTileID]=Gd,this.markUsedJustification(_e,Gd.anchor,vt,Td))}}else{const md=(Af,Td)=>{const Gd=this.collisionIndex.placeCollisionBox(Af,ed,us,Xr,Rh.predicate,Oh);return Gd&&Gd.box&&Gd.box.length&&(this.markUsedOrientation(_e,Td,vt),this.placedOrientations[vt.crossTileID]=Td),Gd};ud(()=>md(rd,o.WritingMode.horizontal),()=>{const Af=mr.verticalTextBox;return _e.allowVerticalPlacement&&vt.numVerticalGlyphVertices>0&&Af?md(Af,o.WritingMode.vertical):{box:null,offscreen:null}}),dd(Wu&&Wu.box&&Wu.box.length)}}if(gh=Wu,Ur=gh&&gh.box&&gh.box.length>0,$s=gh&&gh.offscreen,vt.useRuntimeCollisionCircles){const dd=_e.text.placedSymbolArray.get(vt.centerJustifiedTextSymbolIndex),ud=o.evaluateSizeForFeature(_e.textSizeData,ph,dd),md=Ft.get("text-padding");Eh=this.collisionIndex.placeCollisionCircles(ed,dd,_e.lineVertexArray,_e.glyphOffsetArray,ud,Xr,as,cs,X,Nd,Rh.predicate,vt.collisionCircleDiameter,md,Oh),Eh.circles.length&&Eh.collisionDetected&&!X&&o.warnOnce("Collisions detected, but collision boxes are not shown"),Ur=Ed||Eh.circles.length>0&&!Eh.collisionDetected,$s=$s&&Eh.offscreen}if(mr.iconFeatureIndex&&(bh=mr.iconFeatureIndex),mr.iconBox){const dd=ud=>{const md=L&&el?Nf(ud,el.x,el.y,Md,Nd,this.transform.angle):ud;return this.collisionIndex.placeCollisionBox(md,_d,us,Xr,Rh.predicate,Oh)};dh&&dh.box&&dh.box.length&&mr.verticalIconBox?(yh=dd(mr.verticalIconBox),Gn=yh.box.length>0):(yh=dd(mr.iconBox),Gn=yh.box.length>0),$s=$s&&yh.offscreen}const sd=Bh||vt.numHorizontalGlyphVertices===0&&vt.numVerticalGlyphVertices===0,ld=Ch||vt.numIconVertices===0;if(sd||ld?ld?sd||(Gn=Gn&&Ur):Ur=Gn&&Ur:Gn=Ur=Gn&&Ur,Ur&&gh&&gh.box&&this.collisionIndex.insertCollisionBox(gh.box,ed,Ft.get("text-ignore-placement"),_e.bucketInstanceId,dh&&dh.box&&Qu?Qu:Ih,Rh.ID),Gn&&yh&&this.collisionIndex.insertCollisionBox(yh.box,_d,Ft.get("icon-ignore-placement"),_e.bucketInstanceId,bh,Rh.ID),Eh&&(Ur&&this.collisionIndex.insertCollisionCircles(Eh.circles,ed,Ft.get("text-ignore-placement"),_e.bucketInstanceId,Ih,Rh.ID),X)){const dd=_e.bucketInstanceId;let ud=this.collisionCircleArrays[dd];ud===void 0&&(ud=this.collisionCircleArrays[dd]=new wp);for(let md=0;md<Eh.circles.length;md+=4)ud.circles.push(Eh.circles[md+0]),ud.circles.push(Eh.circles[md+1]),ud.circles.push(Eh.circles[md+2]),ud.circles.push(Eh.collisionDetected?1:0)}if(vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_e.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[vt.crossTileID]=new ap(Ur||E,Gn||B,$s||_e.justReloaded),A[vt.crossTileID]=!0};if(u){if(g.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const vt=_e.getSortedSymbolIndexes(this.transform.angle);for(let mr=vt.length-1;mr>=0;--mr){const Ur=vt[mr];Y(_e.symbolInstances.get(Ur),_e.collisionArrays[Ur])}}else for(let vt=g.symbolInstanceStart;vt<g.symbolInstanceEnd;vt++)Y(_e.symbolInstances.get(vt),_e.collisionArrays[vt]);if(X&&_e.bucketInstanceId in this.collisionCircleArrays){const vt=this.collisionCircleArrays[_e.bucketInstanceId];o.invert(vt.invProjMatrix,Xr),vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_e.justReloaded=!1}markUsedJustification(g,A,X,_e){let Ft;Ft=_e===o.WritingMode.vertical?X.verticalPlacedTextSymbolIndex:{left:X.leftJustifiedTextSymbolIndex,center:X.centerJustifiedTextSymbolIndex,right:X.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(A)];const Xr=[X.leftJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.rightJustifiedTextSymbolIndex,X.verticalPlacedTextSymbolIndex];for(const as of Xr)as>=0&&(g.text.placedSymbolArray.get(as).crossTileID=Ft>=0&&as!==Ft?0:X.crossTileID)}markUsedOrientation(g,A,X){const _e=A===o.WritingMode.horizontal||A===o.WritingMode.horizontalOnly?A:0,Ft=A===o.WritingMode.vertical?A:0,Xr=[X.leftJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.rightJustifiedTextSymbolIndex];for(const as of Xr)g.text.placedSymbolArray.get(as).placedOrientation=_e;X.verticalPlacedTextSymbolIndex&&(g.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).placedOrientation=Ft)}commit(g){this.commitTime=g,this.zoomAtLastRecencyCheck=this.transform.zoom;const A=this.prevPlacement;let X=!1;this.prevZoomAdjustment=A?A.zoomAdjustment(this.transform.zoom):0;const _e=A?A.symbolFadeChange(g):1,Ft=A?A.opacities:{},Xr=A?A.variableOffsets:{},as=A?A.placedOrientations:{};for(const cs in this.placements){const us=this.placements[cs],th=Ft[cs];th?(this.opacities[cs]=new up(th,_e,us.text,us.icon),X=X||us.text!==th.text.placed||us.icon!==th.icon.placed):(this.opacities[cs]=new up(null,_e,us.text,us.icon,us.skipFade),X=X||us.text||us.icon)}for(const cs in Ft){const us=Ft[cs];if(!this.opacities[cs]){const th=new up(us,_e,!1,!1);th.isHidden()||(this.opacities[cs]=th,X=X||us.text.placed||us.icon.placed)}}for(const cs in Xr)this.variableOffsets[cs]||!this.opacities[cs]||this.opacities[cs].isHidden()||(this.variableOffsets[cs]=Xr[cs]);for(const cs in as)this.placedOrientations[cs]||!this.opacities[cs]||this.opacities[cs].isHidden()||(this.placedOrientations[cs]=as[cs]);if(A&&A.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");X?this.lastPlacementChangeTime=g:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=A?A.lastPlacementChangeTime:g)}updateLayerOpacities(g,A){const X={};for(const _e of A){const Ft=_e.getBucket(g);Ft&&_e.latestFeatureIndex&&g.id===Ft.layerIds[0]&&this.updateBucketOpacities(Ft,X,_e.collisionBoxArray)}}updateBucketOpacities(g,A,X){g.hasTextData()&&(g.text.opacityVertexArray.clear(),g.text.hasVisibleVertices=!1),g.hasIconData()&&(g.icon.opacityVertexArray.clear(),g.icon.hasVisibleVertices=!1),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexArray.clear(),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexArray.clear();const _e=g.layers[0].layout,Ft=new up(null,0,!1,!1,!0),Xr=_e.get("text-allow-overlap"),as=_e.get("icon-allow-overlap"),cs=_e.get("text-variable-anchor"),us=_e.get("text-rotation-alignment")==="map",th=_e.get("text-pitch-alignment")==="map",eh=_e.get("icon-text-fit")!=="none",ph=new up(null,0,Xr&&(as||!g.hasIconData()||_e.get("icon-optional")),as&&(Xr||!g.hasTextData()||_e.get("text-optional")),!0);!g.collisionArrays&&X&&(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData())&&g.deserializeCollisionBoxes(X);const Rh=(Bh,Ch,ed)=>{for(let Ed=0;Ed<Ch/4;Ed++)Bh.opacityVertexArray.emplaceBack(ed);Bh.hasVisibleVertices=Bh.hasVisibleVertices||ed!==Mg};for(let Bh=0;Bh<g.symbolInstances.length;Bh++){const Ch=g.symbolInstances.get(Bh),{numHorizontalGlyphVertices:ed,numVerticalGlyphVertices:Ed,crossTileID:_d}=Ch;let qh=this.opacities[_d];A[_d]?qh=Ft:qh||(qh=ph,this.opacities[_d]=qh),A[_d]=!0;const Md=Ch.numIconVertices>0,Nd=this.placedOrientations[Ch.crossTileID],L=Nd===o.WritingMode.vertical,u=Nd===o.WritingMode.horizontal||Nd===o.WritingMode.horizontalOnly;if(ed>0||Ed>0){const E=Yd(qh.text);Rh(g.text,ed,L?Mg:E),Rh(g.text,Ed,u?Mg:E);const B=qh.text.isHidden();[Ch.rightJustifiedTextSymbolIndex,Ch.centerJustifiedTextSymbolIndex,Ch.leftJustifiedTextSymbolIndex].forEach(mr=>{mr>=0&&(g.text.placedSymbolArray.get(mr).hidden=B||L?1:0)}),Ch.verticalPlacedTextSymbolIndex>=0&&(g.text.placedSymbolArray.get(Ch.verticalPlacedTextSymbolIndex).hidden=B||u?1:0);const Y=this.variableOffsets[Ch.crossTileID];Y&&this.markUsedJustification(g,Y.anchor,Ch,Nd);const vt=this.placedOrientations[Ch.crossTileID];vt&&(this.markUsedJustification(g,"left",Ch,vt),this.markUsedOrientation(g,vt,Ch))}if(Md){const E=Yd(qh.icon),B=!(eh&&Ch.verticalPlacedIconSymbolIndex&&L);Ch.placedIconSymbolIndex>=0&&(Rh(g.icon,Ch.numIconVertices,B?E:Mg),g.icon.placedSymbolArray.get(Ch.placedIconSymbolIndex).hidden=qh.icon.isHidden()),Ch.verticalPlacedIconSymbolIndex>=0&&(Rh(g.icon,Ch.numVerticalIconVertices,B?Mg:E),g.icon.placedSymbolArray.get(Ch.verticalPlacedIconSymbolIndex).hidden=qh.icon.isHidden())}if(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData()){const E=g.collisionArrays[Bh];if(E){let B=new o.pointGeometry(0,0);if(E.textBox||E.verticalTextBox){let vt=!0;if(cs){const mr=this.variableOffsets[_d];mr?(B=Gh(mr.anchor,mr.width,mr.height,mr.textOffset,mr.textBoxScale),us&&B._rotate(th?this.transform.angle:-this.transform.angle)):vt=!1}E.textBox&&mp(g.textCollisionBox.collisionVertexArray,qh.text.placed,!vt||L,B.x,B.y),E.verticalTextBox&&mp(g.textCollisionBox.collisionVertexArray,qh.text.placed,!vt||u,B.x,B.y)}const Y=!!(!u&&E.verticalIconBox);E.iconBox&&mp(g.iconCollisionBox.collisionVertexArray,qh.icon.placed,Y,eh?B.x:0,eh?B.y:0),E.verticalIconBox&&mp(g.iconCollisionBox.collisionVertexArray,qh.icon.placed,!Y,eh?B.x:0,eh?B.y:0)}}}if(g.sortFeatures(this.transform.angle),this.retainedQueryData[g.bucketInstanceId]&&(this.retainedQueryData[g.bucketInstanceId].featureSortOrder=g.featureSortOrder),g.hasTextData()&&g.text.opacityVertexBuffer&&g.text.opacityVertexBuffer.updateData(g.text.opacityVertexArray),g.hasIconData()&&g.icon.opacityVertexBuffer&&g.icon.opacityVertexBuffer.updateData(g.icon.opacityVertexArray),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexBuffer&&g.iconCollisionBox.collisionVertexBuffer.updateData(g.iconCollisionBox.collisionVertexArray),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexBuffer&&g.textCollisionBox.collisionVertexBuffer.updateData(g.textCollisionBox.collisionVertexArray),g.text.opacityVertexArray.length!==g.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${g.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${g.text.layoutVertexArray.length}) / 4`);if(g.icon.opacityVertexArray.length!==g.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${g.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${g.icon.layoutVertexArray.length}) / 4`);if(g.bucketInstanceId in this.collisionCircleArrays){const Bh=this.collisionCircleArrays[g.bucketInstanceId];g.placementInvProjMatrix=Bh.invProjMatrix,g.placementViewportMatrix=Bh.viewportMatrix,g.collisionCircleArray=Bh.circles,delete this.collisionCircleArrays[g.bucketInstanceId]}}symbolFadeChange(g){return this.fadeDuration===0?1:(g-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(g){return Math.max(0,(this.transform.zoom-g)/1.5)}hasTransitions(g){return this.stale||g-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(g,A){const X=this.zoomAtLastRecencyCheck===A?1-this.zoomAdjustment(A):1;return this.zoomAtLastRecencyCheck=A,this.commitTime+this.fadeDuration*X>g}setStale(){this.stale=!0}}function mp(he,g,A,X,_e){he.emplaceBack(g?1:0,A?1:0,X||0,_e||0),he.emplaceBack(g?1:0,A?1:0,X||0,_e||0),he.emplaceBack(g?1:0,A?1:0,X||0,_e||0),he.emplaceBack(g?1:0,A?1:0,X||0,_e||0)}const Bp=Math.pow(2,25),zp=Math.pow(2,24),um=Math.pow(2,17),Nm=Math.pow(2,16),a_=Math.pow(2,9),Ug=Math.pow(2,8),by=Math.pow(2,1);function Yd(he){if(he.opacity===0&&!he.placed)return 0;if(he.opacity===1&&he.placed)return 4294967295;const g=he.placed?1:0,A=Math.floor(127*he.opacity);return A*Bp+g*zp+A*um+g*Nm+A*a_+g*Ug+A*by+g}const Mg=0;class km{constructor(g){this._sortAcrossTiles=g.layout.get("symbol-z-order")!=="viewport-y"&&!g.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(g,A,X,_e,Ft){const Xr=this._bucketParts;for(;this._currentTileIndex<g.length;)if(A.getBucketParts(Xr,_e,g[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,Ft())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Xr.sort((as,cs)=>as.sortKey-cs.sortKey));this._currentPartIndex<Xr.length;)if(A.placeLayerBucketPart(Xr[this._currentPartIndex],this._seenCrossTileIDs,X),this._currentPartIndex++,Ft())return!0;return!1}}class sg{constructor(g,A,X,_e,Ft,Xr,as,cs){this.placement=new Hf(g,A,Xr,as,cs),this._currentPlacementIndex=X.length-1,this._forceFullPlacement=_e,this._showCollisionBoxes=Ft,this._done=!1}isDone(){return this._done}continuePlacement(g,A,X){const _e=o.exported.now(),Ft=()=>{const Xr=o.exported.now()-_e;return!this._forceFullPlacement&&Xr>2};for(;this._currentPlacementIndex>=0;){const Xr=A[g[this._currentPlacementIndex]],as=this.placement.collisionIndex.transform.zoom;if(Xr.type==="symbol"&&(!Xr.minzoom||Xr.minzoom<=as)&&(!Xr.maxzoom||Xr.maxzoom>as)){if(this._inProgressLayer||(this._inProgressLayer=new km(Xr)),this._inProgressLayer.continuePlacement(X[Xr.source],this.placement,this._showCollisionBoxes,Xr,Ft))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(g){return this.placement.commit(g),this.placement}}const wy=512/o.EXTENT/2;class p_{constructor(g,A,X){this.tileID=g,this.bucketInstanceId=X,this._symbolsByKey={};const _e=new Map;for(let Ft=0;Ft<A.length;Ft++){const Xr=A.get(Ft),as=Xr.key,cs=_e.get(as);cs?cs.push(Xr):_e.set(as,[Xr])}for(const[Ft,Xr]of _e){const as={positions:Xr.map(cs=>({x:Math.floor(cs.anchorX*wy),y:Math.floor(cs.anchorY*wy)})),crossTileIDs:Xr.map(cs=>cs.crossTileID)};if(as.positions.length>128){const cs=new o.KDBush(as.positions,us=>us.x,us=>us.y,16,Uint16Array);delete cs.points,delete as.positions,as.index=cs}this._symbolsByKey[Ft]=as}}getScaledCoordinates(g,A){const{x:X,y:_e,z:Ft}=this.tileID.canonical,{x:Xr,y:as,z:cs}=A.canonical,us=wy/Math.pow(2,cs-Ft),th=(as*o.EXTENT+g.anchorY)*us,eh=_e*o.EXTENT*wy;return{x:Math.floor((Xr*o.EXTENT+g.anchorX)*us-X*o.EXTENT*wy),y:Math.floor(th-eh)}}findMatches(g,A,X){const _e=this.tileID.canonical.z<A.canonical.z?1:Math.pow(2,this.tileID.canonical.z-A.canonical.z);for(let Ft=0;Ft<g.length;Ft++){const Xr=g.get(Ft);if(Xr.crossTileID)continue;const as=this._symbolsByKey[Xr.key];if(!as)continue;const cs=this.getScaledCoordinates(Xr,A);if(as.index){const us=as.index.range(cs.x-_e,cs.y-_e,cs.x+_e,cs.y+_e).sort();for(const th of us){const eh=as.crossTileIDs[th];if(!X[eh]){X[eh]=!0,Xr.crossTileID=eh;break}}}else if(as.positions)for(let us=0;us<as.positions.length;us++){const th=as.positions[us],eh=as.crossTileIDs[us];if(Math.abs(th.x-cs.x)<=_e&&Math.abs(th.y-cs.y)<=_e&&!X[eh]){X[eh]=!0,Xr.crossTileID=eh;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:g})=>g)}}class a0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class s0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(g){const A=Math.round((g-this.lng)/360);if(A!==0)for(const X in this.indexes){const _e=this.indexes[X],Ft={};for(const Xr in _e){const as=_e[Xr];as.tileID=as.tileID.unwrapTo(as.tileID.wrap+A),Ft[as.tileID.key]=as}this.indexes[X]=Ft}this.lng=g}addBucket(g,A,X){if(this.indexes[g.overscaledZ]&&this.indexes[g.overscaledZ][g.key]){if(this.indexes[g.overscaledZ][g.key].bucketInstanceId===A.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(g.overscaledZ,this.indexes[g.overscaledZ][g.key])}for(let Ft=0;Ft<A.symbolInstances.length;Ft++)A.symbolInstances.get(Ft).crossTileID=0;this.usedCrossTileIDs[g.overscaledZ]||(this.usedCrossTileIDs[g.overscaledZ]={});const _e=this.usedCrossTileIDs[g.overscaledZ];for(const Ft in this.indexes){const Xr=this.indexes[Ft];if(Number(Ft)>g.overscaledZ)for(const as in Xr){const cs=Xr[as];cs.tileID.isChildOf(g)&&cs.findMatches(A.symbolInstances,g,_e)}else{const as=Xr[g.scaledTo(Number(Ft)).key];as&&as.findMatches(A.symbolInstances,g,_e)}}for(let Ft=0;Ft<A.symbolInstances.length;Ft++){const Xr=A.symbolInstances.get(Ft);Xr.crossTileID||(Xr.crossTileID=X.generate(),_e[Xr.crossTileID]=!0)}return this.indexes[g.overscaledZ]===void 0&&(this.indexes[g.overscaledZ]={}),this.indexes[g.overscaledZ][g.key]=new p_(g,A.symbolInstances,A.bucketInstanceId),!0}removeBucketCrossTileIDs(g,A){for(const X of A.getCrossTileIDsLists())for(const _e of X)delete this.usedCrossTileIDs[g][_e]}removeStaleBuckets(g){let A=!1;for(const X in this.indexes){const _e=this.indexes[X];for(const Ft in _e)g[_e[Ft].bucketInstanceId]||(this.removeBucketCrossTileIDs(X,_e[Ft]),delete _e[Ft],A=!0)}return A}}class mm{constructor(){this.layerIndexes={},this.crossTileIDs=new a0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(g,A,X){let _e=this.layerIndexes[g.id];_e===void 0&&(_e=this.layerIndexes[g.id]=new s0);let Ft=!1;const Xr={};_e.handleWrapJump(X);for(const as of A){const cs=as.getBucket(g);cs&&g.id===cs.layerIds[0]&&(cs.bucketInstanceId||(cs.bucketInstanceId=++this.maxBucketInstanceId),_e.addBucket(as.tileID,cs,this.crossTileIDs)&&(Ft=!0),Xr[cs.bucketInstanceId]=!0)}return _e.removeStaleBuckets(Xr)&&(Ft=!0),Ft}pruneUnusedLayers(g){const A={};g.forEach(X=>{A[X]=!0});for(const X in this.layerIndexes)A[X]||delete this.layerIndexes[X]}}const yr=(he,g)=>o.emitValidationErrors(he,g&&g.filter(A=>A.identifier!=="source.canvas")),Js=o.pick(Zf,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),uh=o.pick(Zf,["setCenter","setZoom","setBearing","setPitch"]),Vh=function(){const he={},g=o.spec.$version;for(const A in o.spec.$root){const X=o.spec.$root[A];if(X.required){let _e=null;_e=A==="version"?g:X.type==="array"?[]:{},_e!=null&&(he[A]=_e)}}return he}();class od extends o.Evented{constructor(g,A={}){super(),this.map=g,this.dispatcher=new zd(Ap(),this,g._getMapId()),this.imageManager=new vd,this.imageManager.setEventedParent(this),this.glyphManager=new Sd(g._requestManager,A.localIdeographFontFamily),this.lineAtlas=new Pd(256,512),this.crossTileSymbolIndex=new mm,this._spritesImagesIds={},this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const X=this;this._rtlTextPluginCallback=od.registerForPluginStateChange(_e=>{X.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_e.pluginStatus,pluginURL:_e.pluginURL},(Ft,Xr)=>{if(o.triggerPluginCompletionEvent(Ft),Xr&&Xr.every(as=>as))for(const as in X.sourceCaches)X.sourceCaches[as].reload()})}),this.on("data",_e=>{if(_e.dataType!=="source"||_e.sourceDataType!=="metadata")return;const Ft=this.sourceCaches[_e.sourceId];if(!Ft)return;const Xr=Ft.getSource();if(Xr&&Xr.vectorLayerIds)for(const as in this._layers){const cs=this._layers[as];cs.source===Xr.id&&this._validateLayer(cs)}})}loadURL(g,A={},X){this.fire(new o.Event("dataloading",{dataType:"style"})),A.validate=typeof A.validate!="boolean"||A.validate;const _e=this.map._requestManager.transformRequest(g,rl.Style);this._request=o.getJSON(_e,(Ft,Xr)=>{this._request=null,Ft?this.fire(new o.ErrorEvent(Ft)):Xr&&this._load(Xr,A,X)})}loadJSON(g,A={},X){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,A.validate=A.validate!==!1,this._load(g,A,X)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Vh,{validate:!1})}_load(g,A,X){const _e=A.transformStyle?A.transformStyle(X,g):g;if(A.validate&&yr(this,o.validateStyle(_e)))return;this._loaded=!0,this.stylesheet=_e;for(const Xr in _e.sources)this.addSource(Xr,_e.sources[Xr],{validate:!1});_e.sprite?this._loadSprite(_e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_e.glyphs);const Ft=Tp(this.stylesheet.layers);this._order=Ft.map(Xr=>Xr.id),this._layers={},this._serializedLayers={};for(let Xr of Ft)Xr=o.createStyleLayer(Xr),Xr.setEventedParent(this,{layer:{id:Xr.id}}),this._layers[Xr.id]=Xr,this._serializedLayers[Xr.id]=Xr.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xd(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(g,A=!1,X){this.imageManager.setLoaded(!1),this._spriteRequest=function(_e,Ft,Xr,as){const cs=Sh(_e),us=Xr>1?"@2x":"";let th;const eh=[],ph=[],Rh={},Bh={};for(const{id:ed,url:Ed}of cs){const _d=eh.push(o.getJSON(Ft.transformRequest(Ft.normalizeSpriteURL(Ed,us,".json"),rl.SpriteJSON),(Md,Nd)=>{eh.splice(_d,1),th||(th=Md,Rh[ed]=Nd,Ch())})),qh=ph.push(ah.getImage(Ft.transformRequest(Ft.normalizeSpriteURL(Ed,us,".png"),rl.SpriteImage),(Md,Nd)=>{ph.splice(qh,1),th||(th=Md,Bh[ed]=Nd,Ch())}))}function Ch(){const ed=Object.values(Rh).length,Ed=Object.values(Bh).length;if(th)as(th);else if(cs.length===ed&&ed===Ed){const _d={};for(const qh in Rh){_d[qh]={};const Md=o.exported.getImageCanvasContext(Bh[qh]),Nd=Rh[qh];for(const L in Nd){const{width:u,height:E,x:B,y:Y,sdf:vt,pixelRatio:mr,stretchX:Ur,stretchY:Gn,content:$s}=Nd[L];_d[qh][L]={data:null,pixelRatio:mr,sdf:vt,stretchX:Ur,stretchY:Gn,content:$s,spriteData:{width:u,height:E,x:B,y:Y,context:Md}}}}as(null,_d)}}return{cancel(){if(eh.length)for(const ed of eh)ed.cancel(),eh.splice(eh.indexOf(ed),1);if(ph.length)for(const ed of ph)ed.cancel(),ph.splice(ph.indexOf(ed),1)}}}(g,this.map._requestManager,this.map.getPixelRatio(),(_e,Ft)=>{if(this._spriteRequest=null,_e)this.fire(new o.ErrorEvent(_e));else if(Ft)for(const Xr in Ft){this._spritesImagesIds[Xr]=[];const as=this._spritesImagesIds[Xr]?this._spritesImagesIds[Xr].filter(cs=>!(cs in Ft)):[];for(const cs of as)this.imageManager.removeImage(cs),this._changedImages[cs]=!0;for(const cs in Ft[Xr]){const us=Xr==="default"?cs:`${Xr}:${cs}`;this._spritesImagesIds[Xr].push(us),us in this.imageManager.images?this.imageManager.updateImage(us,Ft[Xr][cs],!1):this.imageManager.addImage(us,Ft[Xr][cs]),A&&(this._changedImages[us]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),A&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),X&&X(_e)})}_unloadSprite(){for(const g of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(g),this._changedImages[g]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(g){const A=this.sourceCaches[g.source];if(!A)return;const X=g.sourceLayer;if(!X)return;const _e=A.getSource();(_e.type==="geojson"||_e.vectorLayerIds&&_e.vectorLayerIds.indexOf(X)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${X}" does not exist on source "${_e.id}" as specified by style layer "${g.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(g){const A=[];for(const X of g){const _e=this._layers[X];_e.type!=="custom"&&A.push(_e.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(g){if(!this._loaded)return;const A=this._changed;if(this._changed){const _e=Object.keys(this._updatedLayers),Ft=Object.keys(this._removedLayers);(_e.length||Ft.length)&&this._updateWorkerLayers(_e,Ft);for(const Xr in this._updatedSources){const as=this._updatedSources[Xr];if(as==="reload")this._reloadSource(Xr);else{if(as!=="clear")throw new Error(`Invalid action ${as}`);this._clearSource(Xr)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Xr in this._updatedPaintProps)this._layers[Xr].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}const X={};for(const _e in this.sourceCaches){const Ft=this.sourceCaches[_e];X[_e]=Ft.used,Ft.used=!1}for(const _e of this._order){const Ft=this._layers[_e];Ft.recalculate(g,this._availableImages),!Ft.isHidden(g.zoom)&&Ft.source&&(this.sourceCaches[Ft.source].used=!0)}for(const _e in X){const Ft=this.sourceCaches[_e];X[_e]!==Ft.used&&Ft.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_e}))}this.light.recalculate(g),this.z=g.zoom,A&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const g=Object.keys(this._changedImages);if(g.length){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(g,A){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(g),removedIds:A})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(g,A={}){if(this._checkLoaded(),g=A.transformStyle?A.transformStyle(this.serialize(),g):g,yr(this,o.validateStyle(g)))return!1;(g=o.clone$1(g)).layers=Tp(g.layers);const X=function(Ft,Xr){if(!Ft)return[{command:Zf.setStyle,args:[Xr]}];let as=[];try{if(!nt(Ft.version,Xr.version))return[{command:Zf.setStyle,args:[Xr]}];nt(Ft.center,Xr.center)||as.push({command:Zf.setCenter,args:[Xr.center]}),nt(Ft.zoom,Xr.zoom)||as.push({command:Zf.setZoom,args:[Xr.zoom]}),nt(Ft.bearing,Xr.bearing)||as.push({command:Zf.setBearing,args:[Xr.bearing]}),nt(Ft.pitch,Xr.pitch)||as.push({command:Zf.setPitch,args:[Xr.pitch]}),nt(Ft.sprite,Xr.sprite)||as.push({command:Zf.setSprite,args:[Xr.sprite]}),nt(Ft.glyphs,Xr.glyphs)||as.push({command:Zf.setGlyphs,args:[Xr.glyphs]}),nt(Ft.transition,Xr.transition)||as.push({command:Zf.setTransition,args:[Xr.transition]}),nt(Ft.light,Xr.light)||as.push({command:Zf.setLight,args:[Xr.light]});const cs={},us=[];(function(eh,ph,Rh,Bh){let Ch;for(Ch in ph=ph||{},eh=eh||{})Object.prototype.hasOwnProperty.call(eh,Ch)&&(Object.prototype.hasOwnProperty.call(ph,Ch)||sm(Ch,Rh,Bh));for(Ch in ph)Object.prototype.hasOwnProperty.call(ph,Ch)&&(Object.prototype.hasOwnProperty.call(eh,Ch)?nt(eh[Ch],ph[Ch])||(eh[Ch].type==="geojson"&&ph[Ch].type==="geojson"&&$p(eh,ph,Ch)?Rh.push({command:Zf.setGeoJSONSourceData,args:[Ch,ph[Ch].data]}):Wd(Ch,ph,Rh,Bh)):qp(Ch,ph,Rh))})(Ft.sources,Xr.sources,us,cs);const th=[];Ft.layers&&Ft.layers.forEach(eh=>{cs[eh.source]?as.push({command:Zf.removeLayer,args:[eh.id]}):th.push(eh)}),as=as.concat(us),function(eh,ph,Rh){ph=ph||[];const Bh=(eh=eh||[]).map(lh),Ch=ph.map(lh),ed=eh.reduce(ih,{}),Ed=ph.reduce(ih,{}),_d=Bh.slice(),qh=Object.create(null);let Md,Nd,L,u,E,B,Y;for(Md=0,Nd=0;Md<Bh.length;Md++)L=Bh[Md],Object.prototype.hasOwnProperty.call(Ed,L)?Nd++:(Rh.push({command:Zf.removeLayer,args:[L]}),_d.splice(_d.indexOf(L,Nd),1));for(Md=0,Nd=0;Md<Ch.length;Md++)L=Ch[Ch.length-1-Md],_d[_d.length-1-Md]!==L&&(Object.prototype.hasOwnProperty.call(ed,L)?(Rh.push({command:Zf.removeLayer,args:[L]}),_d.splice(_d.lastIndexOf(L,_d.length-Nd),1)):Nd++,B=_d[_d.length-Md],Rh.push({command:Zf.addLayer,args:[Ed[L],B]}),_d.splice(_d.length-Md,0,L),qh[L]=!0);for(Md=0;Md<Ch.length;Md++)if(L=Ch[Md],u=ed[L],E=Ed[L],!qh[L]&&!nt(u,E))if(nt(u.source,E.source)&&nt(u["source-layer"],E["source-layer"])&&nt(u.type,E.type)){for(Y in Lh(u.layout,E.layout,Rh,L,null,Zf.setLayoutProperty),Lh(u.paint,E.paint,Rh,L,null,Zf.setPaintProperty),nt(u.filter,E.filter)||Rh.push({command:Zf.setFilter,args:[L,E.filter]}),nt(u.minzoom,E.minzoom)&&nt(u.maxzoom,E.maxzoom)||Rh.push({command:Zf.setLayerZoomRange,args:[L,E.minzoom,E.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?Lh(u[Y],E[Y],Rh,L,Y.slice(6),Zf.setPaintProperty):nt(u[Y],E[Y])||Rh.push({command:Zf.setLayerProperty,args:[L,Y,E[Y]]}));for(Y in E)Object.prototype.hasOwnProperty.call(E,Y)&&!Object.prototype.hasOwnProperty.call(u,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?Lh(u[Y],E[Y],Rh,L,Y.slice(6),Zf.setPaintProperty):nt(u[Y],E[Y])||Rh.push({command:Zf.setLayerProperty,args:[L,Y,E[Y]]}))}else Rh.push({command:Zf.removeLayer,args:[L]}),B=_d[_d.lastIndexOf(L)+1],Rh.push({command:Zf.addLayer,args:[E,B]})}(th,Xr.layers,as)}catch(cs){console.warn("Unable to compute style diff:",cs),as=[{command:Zf.setStyle,args:[Xr]}]}return as}(this.serialize(),g).filter(Ft=>!(Ft.command in uh));if(X.length===0)return!1;const _e=X.filter(Ft=>!(Ft.command in Js));if(_e.length>0)throw new Error(`Unimplemented: ${_e.map(Ft=>Ft.command).join(", ")}.`);return X.forEach(Ft=>{Ft.command!=="setTransition"&&this[Ft.command].apply(this,Ft.args)}),this.stylesheet=g,!0}addImage(g,A){if(this.getImage(g))return this.fire(new o.ErrorEvent(new Error(`An image named "${g}" already exists.`)));this.imageManager.addImage(g,A),this._afterImageUpdated(g)}updateImage(g,A){this.imageManager.updateImage(g,A)}getImage(g){return this.imageManager.getImage(g)}removeImage(g){if(!this.getImage(g))return this.fire(new o.ErrorEvent(new Error(`An image named "${g}" does not exist.`)));this.imageManager.removeImage(g),this._afterImageUpdated(g)}_afterImageUpdated(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(g,A,X={}){if(this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error(`Source "${g}" already exists.`);if(!A.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(A).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(A.type)>=0&&this._validate(o.validateStyle.source,`sources.${g}`,A,null,X))return;this.map&&this.map._collectResourceTiming&&(A.collectResourceTiming=!0);const _e=this.sourceCaches[g]=new $d(g,A,this.dispatcher);_e.style=this,_e.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_e.serialize(),sourceId:g})),_e.onAdd(this.map),this._changed=!0}removeSource(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(const X in this._layers)if(this._layers[X].source===g)return this.fire(new o.ErrorEvent(new Error(`Source "${g}" cannot be removed while layer "${X}" is using it.`)));const A=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],A.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),A.setEventedParent(null),A.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(g,A){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error(`There is no source with this ID=${g}`);const X=this.sourceCaches[g].getSource();if(X.type!=="geojson")throw new Error(`geojsonSource.type is ${X.type}, which is !== 'geojson`);X.setData(A),this._changed=!0}getSource(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()}addLayer(g,A,X={}){this._checkLoaded();const _e=g.id;if(this.getLayer(_e))return void this.fire(new o.ErrorEvent(new Error(`Layer "${_e}" already exists on this map.`)));let Ft;if(g.type==="custom"){if(yr(this,o.validateCustomStyleLayer(g)))return;Ft=o.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(_e,g.source),g=o.clone$1(g),g=o.extend(g,{source:_e})),this._validate(o.validateStyle.layer,`layers.${_e}`,g,{arrayIndex:-1},X))return;Ft=o.createStyleLayer(g),this._validateLayer(Ft),Ft.setEventedParent(this,{layer:{id:_e}}),this._serializedLayers[Ft.id]=Ft.serialize()}const Xr=A?this._order.indexOf(A):this._order.length;if(A&&Xr===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${_e}" before non-existing layer "${A}".`)));else{if(this._order.splice(Xr,0,_e),this._layerOrderChanged=!0,this._layers[_e]=Ft,this._removedLayers[_e]&&Ft.source&&Ft.type!=="custom"){const as=this._removedLayers[_e];delete this._removedLayers[_e],as.type!==Ft.type?this._updatedSources[Ft.source]="clear":(this._updatedSources[Ft.source]="reload",this.sourceCaches[Ft.source].pause())}this._updateLayer(Ft),Ft.onAdd&&Ft.onAdd(this.map)}}moveLayer(g,A){if(this._checkLoaded(),this._changed=!0,!this._layers[g])return void this.fire(new o.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be moved.`)));if(g===A)return;const X=this._order.indexOf(g);this._order.splice(X,1);const _e=A?this._order.indexOf(A):this._order.length;A&&_e===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${g}" before non-existing layer "${A}".`))):(this._order.splice(_e,0,g),this._layerOrderChanged=!0)}removeLayer(g){this._checkLoaded();const A=this._layers[g];if(!A)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${g}".`)));A.setEventedParent(null);const X=this._order.indexOf(g);this._order.splice(X,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=A,delete this._layers[g],delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],A.onRemove&&A.onRemove(this.map)}getLayer(g){return this._layers[g]}hasLayer(g){return g in this._layers}setLayerZoomRange(g,A,X){this._checkLoaded();const _e=this.getLayer(g);_e?_e.minzoom===A&&_e.maxzoom===X||(A!=null&&(_e.minzoom=A),X!=null&&(_e.maxzoom=X),this._updateLayer(_e)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${g}".`)))}setFilter(g,A,X={}){this._checkLoaded();const _e=this.getLayer(g);if(_e){if(!nt(_e.filter,A))return A==null?(_e.filter=void 0,void this._updateLayer(_e)):void(this._validate(o.validateStyle.filter,`layers.${_e.id}.filter`,A,null,X)||(_e.filter=o.clone$1(A),this._updateLayer(_e)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${g}".`)))}getFilter(g){return o.clone$1(this.getLayer(g).filter)}setLayoutProperty(g,A,X,_e={}){this._checkLoaded();const Ft=this.getLayer(g);Ft?nt(Ft.getLayoutProperty(A),X)||(Ft.setLayoutProperty(A,X,_e),this._updateLayer(Ft)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getLayoutProperty(g,A){const X=this.getLayer(g);if(X)return X.getLayoutProperty(A);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${g}".`)))}setPaintProperty(g,A,X,_e={}){this._checkLoaded();const Ft=this.getLayer(g);Ft?nt(Ft.getPaintProperty(A),X)||(Ft.setPaintProperty(A,X,_e)&&this._updateLayer(Ft),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getPaintProperty(g,A){return this.getLayer(g).getPaintProperty(A)}setFeatureState(g,A){this._checkLoaded();const X=g.source,_e=g.sourceLayer,Ft=this.sourceCaches[X];if(Ft===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${X}' does not exist in the map's style.`)));const Xr=Ft.getSource().type;Xr==="geojson"&&_e?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Xr!=="vector"||_e?(g.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),Ft.setFeatureState(_e,g.id,A)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(g,A){this._checkLoaded();const X=g.source,_e=this.sourceCaches[X];if(_e===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${X}' does not exist in the map's style.`)));const Ft=_e.getSource().type,Xr=Ft==="vector"?g.sourceLayer:void 0;Ft!=="vector"||Xr?A&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_e.removeFeatureState(Xr,g.id,A):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(g){this._checkLoaded();const A=g.source,X=g.sourceLayer,_e=this.sourceCaches[A];if(_e!==void 0)return _e.getSource().type!=="vector"||X?(g.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),_e.getFeatureState(X,g.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${A}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,g=>g.serialize()),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(g){const A=Xr=>this._layers[Xr].type==="fill-extrusion",X={},_e=[];for(let Xr=this._order.length-1;Xr>=0;Xr--){const as=this._order[Xr];if(A(as)){X[as]=Xr;for(const cs of g){const us=cs[as];if(us)for(const th of us)_e.push(th)}}}_e.sort((Xr,as)=>as.intersectionZ-Xr.intersectionZ);const Ft=[];for(let Xr=this._order.length-1;Xr>=0;Xr--){const as=this._order[Xr];if(A(as))for(let cs=_e.length-1;cs>=0;cs--){const us=_e[cs].feature;if(X[us.layer.id]<Xr)break;Ft.push(us),_e.pop()}else for(const cs of g){const us=cs[as];if(us)for(const th of us)Ft.push(th.feature)}}return Ft}queryRenderedFeatures(g,A,X){A&&A.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",A.filter,null,A);const _e={};if(A&&A.layers){if(!Array.isArray(A.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Xr of A.layers){const as=this._layers[Xr];if(!as)return this.fire(new o.ErrorEvent(new Error(`The layer '${Xr}' does not exist in the map's style and cannot be queried for features.`))),[];_e[as.source]=!0}}const Ft=[];A.availableImages=this._availableImages;for(const Xr in this.sourceCaches)A.layers&&!_e[Xr]||Ft.push(Kh(this.sourceCaches[Xr],this._layers,this._serializedLayers,g,A,X));return this.placement&&Ft.push(function(Xr,as,cs,us,th,eh,ph){const Rh={},Bh=eh.queryRenderedSymbols(us),Ch=[];for(const ed of Object.keys(Bh).map(Number))Ch.push(ph[ed]);Ch.sort(Qd);for(const ed of Ch){const Ed=ed.featureIndex.lookupSymbolFeatures(Bh[ed.bucketInstanceId],as,ed.bucketIndex,ed.sourceLayerIndex,th.filter,th.layers,th.availableImages,Xr);for(const _d in Ed){const qh=Rh[_d]=Rh[_d]||[],Md=Ed[_d];Md.sort((Nd,L)=>{const u=ed.featureSortOrder;if(u){const E=u.indexOf(Nd.featureIndex);return u.indexOf(L.featureIndex)-E}return L.featureIndex-Nd.featureIndex});for(const Nd of Md)qh.push(Nd)}}for(const ed in Rh)Rh[ed].forEach(Ed=>{const _d=Ed.feature,qh=cs[Xr[ed].source].getFeatureState(_d.layer["source-layer"],_d.id);_d.source=_d.layer.source,_d.layer["source-layer"]&&(_d.sourceLayer=_d.layer["source-layer"]),_d.state=qh});return Rh}(this._layers,this._serializedLayers,this.sourceCaches,g,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ft)}querySourceFeatures(g,A){A&&A.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",A.filter,null,A);const X=this.sourceCaches[g];return X?function(_e,Ft){const Xr=_e.getRenderableIds().map(us=>_e.getTileByID(us)),as=[],cs={};for(let us=0;us<Xr.length;us++){const th=Xr[us],eh=th.tileID.canonical.key;cs[eh]||(cs[eh]=!0,th.querySourceFeatures(as,Ft))}return as}(X,A):[]}addSourceType(g,A,X){return od.getSourceType(g)?X(new Error(`A source type called "${g}" already exists.`)):(od.setSourceType(g,A),A.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:A.workerSourceURL},X):X(null,null))}getLight(){return this.light.getLight()}setLight(g,A={}){this._checkLoaded();const X=this.light.getLight();let _e=!1;for(const Xr in g)if(!nt(g[Xr],X[Xr])){_e=!0;break}if(!_e)return;const Ft={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,A),this.light.updateTransitions(Ft)}_validate(g,A,X,_e,Ft={}){return(!Ft||Ft.validate!==!1)&&yr(this,g.call(o.validateStyle,o.extend({key:A,style:this.serialize(),value:X,styleSpec:o.spec},_e)))}_remove(g=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const A in this._layers)this._layers[A].setEventedParent(null);for(const A in this.sourceCaches){const X=this.sourceCaches[A];X.setEventedParent(null),X.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(g)}_clearSource(g){this.sourceCaches[g].clearTiles()}_reloadSource(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()}_updateSources(g){for(const A in this.sourceCaches)this.sourceCaches[A].update(g,this.map.terrain)}_generateCollisionBoxes(){for(const g in this.sourceCaches)this._reloadSource(g)}_updatePlacement(g,A,X,_e,Ft=!1){let Xr=!1,as=!1;const cs={};for(const us of this._order){const th=this._layers[us];if(th.type!=="symbol")continue;if(!cs[th.source]){const ph=this.sourceCaches[th.source];cs[th.source]=ph.getRenderableIds(!0).map(Rh=>ph.getTileByID(Rh)).sort((Rh,Bh)=>Bh.tileID.overscaledZ-Rh.tileID.overscaledZ||(Rh.tileID.isLessThan(Bh.tileID)?-1:1))}const eh=this.crossTileSymbolIndex.addLayer(th,cs[th.source],g.center.lng);Xr=Xr||eh}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((Ft=Ft||this._layerOrderChanged||X===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),g.zoom))&&(this.pauseablePlacement=new sg(g,this.map.terrain,this._order,Ft,A,X,_e,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,cs),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),as=!0),Xr&&this.pauseablePlacement.placement.setStale()),as||Xr)for(const us of this._order){const th=this._layers[us];th.type==="symbol"&&this.placement.updateLayerOpacities(th,cs[th.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()}getImages(g,A,X){this.imageManager.getImages(A.icons,X),this._updateTilesForChangedImages();const _e=this.sourceCaches[A.source];_e&&_e.setDependencies(A.tileID.key,A.type,A.icons)}getGlyphs(g,A,X){this.glyphManager.getGlyphs(A.stacks,X);const _e=this.sourceCaches[A.source];_e&&_e.setDependencies(A.tileID.key,A.type,[""])}getResource(g,A,X){return o.makeRequest(A,X)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(g,A={}){this._checkLoaded(),g&&this._validate(o.validateStyle.glyphs,"glyphs",g,null,A)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=g,this.glyphManager.entries={},this.glyphManager.setURL(g))}addSprite(g,A,X={},_e){this._checkLoaded();const Ft=[{id:g,url:A}],Xr=[...Sh(this.stylesheet.sprite),...Ft];this._validate(o.validateStyle.sprite,"sprite",Xr,null,X)||(this.stylesheet.sprite=Xr,this._loadSprite(Ft,!0,_e))}removeSprite(g){this._checkLoaded();const A=Sh(this.stylesheet.sprite);if(A.find(X=>X.id===g)){if(this._spritesImagesIds[g])for(const X of this._spritesImagesIds[g])this.imageManager.removeImage(X),this._changedImages[X]=!0;A.splice(A.findIndex(X=>X.id===g),1),this.stylesheet.sprite=A.length>0?A:void 0,delete this._spritesImagesIds[g],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${g}" doesn't exists on this map.`)))}getSprite(){return Sh(this.stylesheet.sprite)}setSprite(g,A={},X){this._checkLoaded(),g&&this._validate(o.validateStyle.sprite,"sprite",g,null,A)||(this.stylesheet.sprite=g,g?this._loadSprite(g,!0,X):(this._unloadSprite(),X(null)))}}od.getSourceType=function(he){return _p[he]},od.setSourceType=function(he,g){_p[he]=g},od.registerForPluginStateChange=o.registerForPluginStateChange;var Wh=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),pd="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const $f={prelude:Tf(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Tf(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Tf(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Tf(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Tf("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tf(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Tf(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Tf("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Tf("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tf("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Tf(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Tf(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Tf(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Tf(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Tf(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Tf(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Tf(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tf(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Tf(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Tf(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Tf(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Tf(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Tf(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Tf(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Tf(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Tf(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Tf("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",pd),terrainDepth:Tf("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",pd),terrainCoords:Tf("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",pd)};function Tf(he,g){const A=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,X=g.match(/attribute ([\w]+) ([\w]+)/g),_e=he.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Ft=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Xr=Ft?Ft.concat(_e):_e,as={};return{fragmentSource:he=he.replace(A,(cs,us,th,eh,ph)=>(as[ph]=!0,us==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
varying ${th} ${eh} ${ph};
#else
uniform ${th} ${eh} u_${ph};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ph}
    ${th} ${eh} ${ph} = u_${ph};
#endif
`)),vertexSource:g=g.replace(A,(cs,us,th,eh,ph)=>{const Rh=eh==="float"?"vec2":"vec4",Bh=ph.match(/color/)?"color":Rh;return as[ph]?us==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${th} ${Rh} a_${ph};
varying ${th} ${eh} ${ph};
#else
uniform ${th} ${eh} u_${ph};
#endif
`:Bh==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = a_${ph};
#else
    ${th} ${eh} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = unpack_mix_${Bh}(a_${ph}, u_${ph}_t);
#else
    ${th} ${eh} ${ph} = u_${ph};
#endif
`:us==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${th} ${Rh} a_${ph};
#else
uniform ${th} ${eh} u_${ph};
#endif
`:Bh==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${th} ${eh} ${ph} = a_${ph};
#else
    ${th} ${eh} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${th} ${eh} ${ph} = unpack_mix_${Bh}(a_${ph}, u_${ph}_t);
#else
    ${th} ${eh} ${ph} = u_${ph};
#endif
`}),staticAttributes:X,staticUniforms:Xr}}class rp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(g,A,X,_e,Ft,Xr,as,cs,us){this.context=g;let th=this.boundPaintVertexBuffers.length!==_e.length;for(let eh=0;!th&&eh<_e.length;eh++)this.boundPaintVertexBuffers[eh]!==_e[eh]&&(th=!0);g.extVertexArrayObject&&this.vao&&this.boundProgram===A&&this.boundLayoutVertexBuffer===X&&!th&&this.boundIndexBuffer===Ft&&this.boundVertexOffset===Xr&&this.boundDynamicVertexBuffer===as&&this.boundDynamicVertexBuffer2===cs&&this.boundDynamicVertexBuffer3===us?(g.bindVertexArrayOES.set(this.vao),as&&as.bind(),Ft&&Ft.dynamicDraw&&Ft.bind(),cs&&cs.bind(),us&&us.bind()):this.freshBind(A,X,_e,Ft,Xr,as,cs,us)}freshBind(g,A,X,_e,Ft,Xr,as,cs){let us;const th=g.numAttributes,eh=this.context,ph=eh.gl;if(eh.extVertexArrayObject)this.vao&&this.destroy(),this.vao=eh.extVertexArrayObject.createVertexArrayOES(),eh.bindVertexArrayOES.set(this.vao),us=0,this.boundProgram=g,this.boundLayoutVertexBuffer=A,this.boundPaintVertexBuffers=X,this.boundIndexBuffer=_e,this.boundVertexOffset=Ft,this.boundDynamicVertexBuffer=Xr,this.boundDynamicVertexBuffer2=as,this.boundDynamicVertexBuffer3=cs;else{us=eh.currentNumAttributes||0;for(let Rh=th;Rh<us;Rh++)ph.disableVertexAttribArray(Rh)}A.enableAttributes(ph,g);for(const Rh of X)Rh.enableAttributes(ph,g);Xr&&Xr.enableAttributes(ph,g),as&&as.enableAttributes(ph,g),cs&&cs.enableAttributes(ph,g),A.bind(),A.setVertexAttribPointers(ph,g,Ft);for(const Rh of X)Rh.bind(),Rh.setVertexAttribPointers(ph,g,Ft);Xr&&(Xr.bind(),Xr.setVertexAttribPointers(ph,g,Ft)),_e&&_e.bind(),as&&(as.bind(),as.setVertexAttribPointers(ph,g,Ft)),cs&&(cs.bind(),cs.setVertexAttribPointers(ph,g,Ft)),eh.currentNumAttributes=th}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Gf(he){const g=[];for(let A=0;A<he.length;A++){if(he[A]===null)continue;const X=he[A].split(" ");g.push(X.pop())}return g}class op{constructor(g,A,X,_e,Ft,Xr,as){const cs=g.gl;this.program=cs.createProgram();const us=Gf(X.staticAttributes),th=_e?_e.getBinderAttributes():[],eh=us.concat(th),ph=$f.prelude.staticUniforms?Gf($f.prelude.staticUniforms):[],Rh=X.staticUniforms?Gf(X.staticUniforms):[],Bh=_e?_e.getBinderUniforms():[],Ch=ph.concat(Rh).concat(Bh),ed=[];for(const u of Ch)ed.indexOf(u)<0&&ed.push(u);const Ed=_e?_e.defines():[];Xr&&Ed.push("#define OVERDRAW_INSPECTOR;"),as&&Ed.push("#define TERRAIN3D;");const _d=Ed.concat($f.prelude.fragmentSource,X.fragmentSource).join(`
`),qh=Ed.concat($f.prelude.vertexSource,X.vertexSource).join(`
`),Md=cs.createShader(cs.FRAGMENT_SHADER);if(cs.isContextLost())return void(this.failedToCreate=!0);cs.shaderSource(Md,_d),cs.compileShader(Md),cs.attachShader(this.program,Md);const Nd=cs.createShader(cs.VERTEX_SHADER);if(cs.isContextLost())return void(this.failedToCreate=!0);cs.shaderSource(Nd,qh),cs.compileShader(Nd),cs.attachShader(this.program,Nd),this.attributes={};const L={};this.numAttributes=eh.length;for(let u=0;u<this.numAttributes;u++)eh[u]&&(cs.bindAttribLocation(this.program,u,eh[u]),this.attributes[eh[u]]=u);cs.linkProgram(this.program),cs.deleteShader(Nd),cs.deleteShader(Md);for(let u=0;u<ed.length;u++){const E=ed[u];if(E&&!L[E]){const B=cs.getUniformLocation(this.program,E);B&&(L[E]=B)}}this.fixedUniforms=Ft(g,L),this.terrainUniforms=((u,E)=>({u_depth:new o.Uniform1i(u,E.u_depth),u_terrain:new o.Uniform1i(u,E.u_terrain),u_terrain_dim:new o.Uniform1f(u,E.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(u,E.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(u,E.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(u,E.u_terrain_exaggeration)}))(g,L),this.binderUniforms=_e?_e.getUniforms(g,L):[]}draw(g,A,X,_e,Ft,Xr,as,cs,us,th,eh,ph,Rh,Bh,Ch,ed,Ed,_d){const qh=g.gl;if(this.failedToCreate)return;if(g.program.set(this.program),g.setDepthMode(X),g.setStencilMode(_e),g.setColorMode(Ft),g.setCullFace(Xr),cs){g.activeTexture.set(qh.TEXTURE2),qh.bindTexture(qh.TEXTURE_2D,cs.depthTexture),g.activeTexture.set(qh.TEXTURE3),qh.bindTexture(qh.TEXTURE_2D,cs.texture);for(const Nd in this.terrainUniforms)this.terrainUniforms[Nd].set(cs[Nd])}for(const Nd in this.fixedUniforms)this.fixedUniforms[Nd].set(as[Nd]);Ch&&Ch.setUniforms(g,this.binderUniforms,Rh,{zoom:Bh});let Md=0;switch(A){case qh.LINES:Md=2;break;case qh.TRIANGLES:Md=3;break;case qh.LINE_STRIP:Md=1}for(const Nd of ph.get()){const L=Nd.vaos||(Nd.vaos={});(L[us]||(L[us]=new rp)).bind(g,this,th,Ch?Ch.getPaintVertexBuffers():[],eh,Nd.vertexOffset,ed,Ed,_d),qh.drawElements(A,Nd.primitiveLength*Md,qh.UNSIGNED_SHORT,Nd.primitiveOffset*Md*2)}}}function Vp(he,g,A){const X=1/Fd(A,1,g.transform.tileZoom),_e=Math.pow(2,A.tileID.overscaledZ),Ft=A.tileSize*Math.pow(2,g.transform.tileZoom)/_e,Xr=Ft*(A.tileID.canonical.x+A.tileID.wrap*_e),as=Ft*A.tileID.canonical.y;return{u_image:0,u_texsize:A.imageAtlasTexture.size,u_scale:[X,he.fromScale,he.toScale],u_fade:he.t,u_pixel_coord_upper:[Xr>>16,as>>16],u_pixel_coord_lower:[65535&Xr,65535&as]}}const Sm=(he,g,A,X)=>{const _e=g.style.light,Ft=_e.properties.get("position"),Xr=[Ft.x,Ft.y,Ft.z],as=function(){var us=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(us[1]=0,us[2]=0,us[3]=0,us[5]=0,us[6]=0,us[7]=0),us[0]=1,us[4]=1,us[8]=1,us}();_e.properties.get("anchor")==="viewport"&&function(us,th){var eh=Math.sin(th),ph=Math.cos(th);us[0]=ph,us[1]=eh,us[2]=0,us[3]=-eh,us[4]=ph,us[5]=0,us[6]=0,us[7]=0,us[8]=1}(as,-g.transform.angle),function(us,th,eh){var ph=th[0],Rh=th[1],Bh=th[2];us[0]=ph*eh[0]+Rh*eh[3]+Bh*eh[6],us[1]=ph*eh[1]+Rh*eh[4]+Bh*eh[7],us[2]=ph*eh[2]+Rh*eh[5]+Bh*eh[8]}(Xr,Xr,as);const cs=_e.properties.get("color");return{u_matrix:he,u_lightpos:Xr,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[cs.r,cs.g,cs.b],u_vertical_gradient:+A,u_opacity:X}},Xp=(he,g,A,X,_e,Ft,Xr)=>o.extend(Sm(he,g,A,X),Vp(Ft,g,Xr),{u_height_factor:-Math.pow(2,_e.overscaledZ)/Xr.tileSize/8}),Dm=he=>({u_matrix:he}),Mf=(he,g,A,X)=>o.extend(Dm(he),Vp(A,g,X)),Cp=(he,g)=>({u_matrix:he,u_world:g}),Kp=(he,g,A,X,_e)=>o.extend(Mf(he,g,A,X),{u_world:_e}),Ym=(he,g,A,X)=>{const _e=he.transform;let Ft,Xr;if(X.paint.get("circle-pitch-alignment")==="map"){const as=Fd(A,1,_e.zoom);Ft=!0,Xr=[as,as]}else Ft=!1,Xr=_e.pixelsToGLUnits;return{u_camera_to_center_distance:_e.cameraToCenterDistance,u_scale_with_map:+(X.paint.get("circle-pitch-scale")==="map"),u_matrix:he.translatePosMatrix(g.posMatrix,A,X.paint.get("circle-translate"),X.paint.get("circle-translate-anchor")),u_pitch_with_map:+Ft,u_device_pixel_ratio:he.pixelRatio,u_extrude_scale:Xr}},Mm=(he,g,A)=>{const X=Fd(A,1,g.zoom),_e=Math.pow(2,g.zoom-A.tileID.overscaledZ),Ft=A.tileID.overscaleFactor();return{u_matrix:he,u_camera_to_center_distance:g.cameraToCenterDistance,u_pixels_to_tile_units:X,u_extrude_scale:[g.pixelsToGLUnits[0]/(X*_e),g.pixelsToGLUnits[1]/(X*_e)],u_overscale_factor:Ft}},lg=(he,g,A=1)=>({u_matrix:he,u_color:g,u_overlay:0,u_overlay_scale:A}),jm=he=>({u_matrix:he}),Tm=(he,g,A,X)=>({u_matrix:he,u_extrude_scale:Fd(g,1,A),u_intensity:X});function Uy(he,g){const A=Math.pow(2,g.canonical.z),X=g.canonical.y;return[new o.MercatorCoordinate(0,X/A).toLngLat().lat,new o.MercatorCoordinate(0,(X+1)/A).toLngLat().lat]}const vg=(he,g,A,X)=>{const _e=he.transform;return{u_matrix:s_(he,g,A,X),u_ratio:1/Fd(g,1,_e.zoom),u_device_pixel_ratio:he.pixelRatio,u_units_to_pixels:[1/_e.pixelsToGLUnits[0],1/_e.pixelsToGLUnits[1]]}},ng=(he,g,A,X,_e)=>o.extend(vg(he,g,A,_e),{u_image:0,u_image_height:X}),l0=(he,g,A,X,_e)=>{const Ft=he.transform,Xr=zm(g,Ft);return{u_matrix:s_(he,g,A,_e),u_texsize:g.imageAtlasTexture.size,u_ratio:1/Fd(g,1,Ft.zoom),u_device_pixel_ratio:he.pixelRatio,u_image:0,u_scale:[Xr,X.fromScale,X.toScale],u_fade:X.t,u_units_to_pixels:[1/Ft.pixelsToGLUnits[0],1/Ft.pixelsToGLUnits[1]]}},Vy=(he,g,A,X,_e,Ft)=>{const Xr=he.lineAtlas,as=zm(g,he.transform),cs=A.layout.get("line-cap")==="round",us=Xr.getDash(X.from,cs),th=Xr.getDash(X.to,cs),eh=us.width*_e.fromScale,ph=th.width*_e.toScale;return o.extend(vg(he,g,A,Ft),{u_patternscale_a:[as/eh,-us.height/2],u_patternscale_b:[as/ph,-th.height/2],u_sdfgamma:Xr.width/(256*Math.min(eh,ph)*he.pixelRatio)/2,u_image:0,u_tex_y_a:us.y,u_tex_y_b:th.y,u_mix:_e.t})};function zm(he,g){return 1/Fd(he,1,g.tileZoom)}function s_(he,g,A,X){return he.translatePosMatrix(X?X.posMatrix:g.tileID.posMatrix,g,A.paint.get("line-translate"),A.paint.get("line-translate-anchor"))}const j0=(he,g,A,X,_e)=>{return{u_matrix:he,u_tl_parent:g,u_scale_parent:A,u_buffer_scale:1,u_fade_t:X.mix,u_opacity:X.opacity*_e.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_e.paint.get("raster-brightness-min"),u_brightness_high:_e.paint.get("raster-brightness-max"),u_saturation_factor:(Xr=_e.paint.get("raster-saturation"),Xr>0?1-1/(1.001-Xr):-Xr),u_contrast_factor:(Ft=_e.paint.get("raster-contrast"),Ft>0?1/(1-Ft):1+Ft),u_spin_weights:Ey(_e.paint.get("raster-hue-rotate"))};var Ft,Xr};function Ey(he){he*=Math.PI/180;const g=Math.sin(he),A=Math.cos(he);return[(2*A+1)/3,(-Math.sqrt(3)*g-A+1)/3,(Math.sqrt(3)*g-A+1)/3]}const xg=(he,g,A,X,_e,Ft,Xr,as,cs,us)=>{const th=_e.transform;return{u_is_size_zoom_constant:+(he==="constant"||he==="source"),u_is_size_feature_constant:+(he==="constant"||he==="camera"),u_size_t:g?g.uSizeT:0,u_size:g?g.uSize:0,u_camera_to_center_distance:th.cameraToCenterDistance,u_pitch:th.pitch/360*2*Math.PI,u_rotate_symbol:+A,u_aspect_ratio:th.width/th.height,u_fade_change:_e.options.fadeDuration?_e.symbolFadeChange:1,u_matrix:Ft,u_label_plane_matrix:Xr,u_coord_matrix:as,u_is_text:+cs,u_pitch_with_map:+X,u_texsize:us,u_texture:0}},q0=(he,g,A,X,_e,Ft,Xr,as,cs,us,th)=>{const eh=_e.transform;return o.extend(xg(he,g,A,X,_e,Ft,Xr,as,cs,us),{u_gamma_scale:X?Math.cos(eh._pitch)*eh.cameraToCenterDistance:1,u_device_pixel_ratio:_e.pixelRatio,u_is_halo:+th})},fv=(he,g,A,X,_e,Ft,Xr,as,cs,us)=>o.extend(q0(he,g,A,X,_e,Ft,Xr,as,!0,cs,!0),{u_texsize_icon:us,u_texture_icon:1}),G_=(he,g,A)=>({u_matrix:he,u_opacity:g,u_color:A}),P_=(he,g,A,X,_e,Ft)=>o.extend(function(Xr,as,cs,us){const th=cs.imageManager.getPattern(Xr.from.toString()),eh=cs.imageManager.getPattern(Xr.to.toString()),{width:ph,height:Rh}=cs.imageManager.getPixelSize(),Bh=Math.pow(2,us.tileID.overscaledZ),Ch=us.tileSize*Math.pow(2,cs.transform.tileZoom)/Bh,ed=Ch*(us.tileID.canonical.x+us.tileID.wrap*Bh),Ed=Ch*us.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:th.tl,u_pattern_br_a:th.br,u_pattern_tl_b:eh.tl,u_pattern_br_b:eh.br,u_texsize:[ph,Rh],u_mix:as.t,u_pattern_size_a:th.displaySize,u_pattern_size_b:eh.displaySize,u_scale_a:as.fromScale,u_scale_b:as.toScale,u_tile_units_to_pixels:1/Fd(us,1,cs.transform.tileZoom),u_pixel_coord_upper:[ed>>16,Ed>>16],u_pixel_coord_lower:[65535&ed,65535&Ed]}}(X,Ft,A,_e),{u_matrix:he,u_opacity:g}),Sy={fillExtrusion:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_lightpos:new o.Uniform3f(he,g.u_lightpos),u_lightintensity:new o.Uniform1f(he,g.u_lightintensity),u_lightcolor:new o.Uniform3f(he,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(he,g.u_vertical_gradient),u_opacity:new o.Uniform1f(he,g.u_opacity)}),fillExtrusionPattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_lightpos:new o.Uniform3f(he,g.u_lightpos),u_lightintensity:new o.Uniform1f(he,g.u_lightintensity),u_lightcolor:new o.Uniform3f(he,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(he,g.u_vertical_gradient),u_height_factor:new o.Uniform1f(he,g.u_height_factor),u_image:new o.Uniform1i(he,g.u_image),u_texsize:new o.Uniform2f(he,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade),u_opacity:new o.Uniform1f(he,g.u_opacity)}),fill:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),fillPattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_image:new o.Uniform1i(he,g.u_image),u_texsize:new o.Uniform2f(he,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade)}),fillOutline:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_world:new o.Uniform2f(he,g.u_world)}),fillOutlinePattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_world:new o.Uniform2f(he,g.u_world),u_image:new o.Uniform1i(he,g.u_image),u_texsize:new o.Uniform2f(he,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade)}),circle:(he,g)=>({u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(he,g.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(he,g.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),collisionBox:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(he,g.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(he,g.u_extrude_scale),u_overscale_factor:new o.Uniform1f(he,g.u_overscale_factor)}),collisionCircle:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_inv_matrix:new o.UniformMatrix4f(he,g.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(he,g.u_viewport_size)}),debug:(he,g)=>({u_color:new o.UniformColor(he,g.u_color),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_overlay:new o.Uniform1i(he,g.u_overlay),u_overlay_scale:new o.Uniform1f(he,g.u_overlay_scale)}),clippingMask:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),heatmap:(he,g)=>({u_extrude_scale:new o.Uniform1f(he,g.u_extrude_scale),u_intensity:new o.Uniform1f(he,g.u_intensity),u_matrix:new o.UniformMatrix4f(he,g.u_matrix)}),heatmapTexture:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_world:new o.Uniform2f(he,g.u_world),u_image:new o.Uniform1i(he,g.u_image),u_color_ramp:new o.Uniform1i(he,g.u_color_ramp),u_opacity:new o.Uniform1f(he,g.u_opacity)}),hillshade:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_image:new o.Uniform1i(he,g.u_image),u_latrange:new o.Uniform2f(he,g.u_latrange),u_light:new o.Uniform2f(he,g.u_light),u_shadow:new o.UniformColor(he,g.u_shadow),u_highlight:new o.UniformColor(he,g.u_highlight),u_accent:new o.UniformColor(he,g.u_accent)}),hillshadePrepare:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_image:new o.Uniform1i(he,g.u_image),u_dimension:new o.Uniform2f(he,g.u_dimension),u_zoom:new o.Uniform1f(he,g.u_zoom),u_unpack:new o.Uniform4f(he,g.u_unpack)}),line:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels)}),lineGradient:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels),u_image:new o.Uniform1i(he,g.u_image),u_image_height:new o.Uniform1f(he,g.u_image_height)}),linePattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_texsize:new o.Uniform2f(he,g.u_texsize),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_image:new o.Uniform1i(he,g.u_image),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels),u_scale:new o.Uniform3f(he,g.u_scale),u_fade:new o.Uniform1f(he,g.u_fade)}),lineSDF:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ratio:new o.Uniform1f(he,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(he,g.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(he,g.u_patternscale_a),u_patternscale_b:new o.Uniform2f(he,g.u_patternscale_b),u_sdfgamma:new o.Uniform1f(he,g.u_sdfgamma),u_image:new o.Uniform1i(he,g.u_image),u_tex_y_a:new o.Uniform1f(he,g.u_tex_y_a),u_tex_y_b:new o.Uniform1f(he,g.u_tex_y_b),u_mix:new o.Uniform1f(he,g.u_mix)}),raster:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_tl_parent:new o.Uniform2f(he,g.u_tl_parent),u_scale_parent:new o.Uniform1f(he,g.u_scale_parent),u_buffer_scale:new o.Uniform1f(he,g.u_buffer_scale),u_fade_t:new o.Uniform1f(he,g.u_fade_t),u_opacity:new o.Uniform1f(he,g.u_opacity),u_image0:new o.Uniform1i(he,g.u_image0),u_image1:new o.Uniform1i(he,g.u_image1),u_brightness_low:new o.Uniform1f(he,g.u_brightness_low),u_brightness_high:new o.Uniform1f(he,g.u_brightness_high),u_saturation_factor:new o.Uniform1f(he,g.u_saturation_factor),u_contrast_factor:new o.Uniform1f(he,g.u_contrast_factor),u_spin_weights:new o.Uniform3f(he,g.u_spin_weights)}),symbolIcon:(he,g)=>({u_is_size_zoom_constant:new o.Uniform1i(he,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(he,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(he,g.u_size_t),u_size:new o.Uniform1f(he,g.u_size),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(he,g.u_pitch),u_rotate_symbol:new o.Uniform1i(he,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(he,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(he,g.u_fade_change),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(he,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(he,g.u_coord_matrix),u_is_text:new o.Uniform1i(he,g.u_is_text),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_texsize:new o.Uniform2f(he,g.u_texsize),u_texture:new o.Uniform1i(he,g.u_texture)}),symbolSDF:(he,g)=>({u_is_size_zoom_constant:new o.Uniform1i(he,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(he,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(he,g.u_size_t),u_size:new o.Uniform1f(he,g.u_size),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(he,g.u_pitch),u_rotate_symbol:new o.Uniform1i(he,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(he,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(he,g.u_fade_change),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(he,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(he,g.u_coord_matrix),u_is_text:new o.Uniform1i(he,g.u_is_text),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_texsize:new o.Uniform2f(he,g.u_texsize),u_texture:new o.Uniform1i(he,g.u_texture),u_gamma_scale:new o.Uniform1f(he,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(he,g.u_is_halo)}),symbolTextAndIcon:(he,g)=>({u_is_size_zoom_constant:new o.Uniform1i(he,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(he,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(he,g.u_size_t),u_size:new o.Uniform1f(he,g.u_size),u_camera_to_center_distance:new o.Uniform1f(he,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(he,g.u_pitch),u_rotate_symbol:new o.Uniform1i(he,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(he,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(he,g.u_fade_change),u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(he,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(he,g.u_coord_matrix),u_is_text:new o.Uniform1i(he,g.u_is_text),u_pitch_with_map:new o.Uniform1i(he,g.u_pitch_with_map),u_texsize:new o.Uniform2f(he,g.u_texsize),u_texsize_icon:new o.Uniform2f(he,g.u_texsize_icon),u_texture:new o.Uniform1i(he,g.u_texture),u_texture_icon:new o.Uniform1i(he,g.u_texture_icon),u_gamma_scale:new o.Uniform1f(he,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(he,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(he,g.u_is_halo)}),background:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_opacity:new o.Uniform1f(he,g.u_opacity),u_color:new o.UniformColor(he,g.u_color)}),backgroundPattern:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_opacity:new o.Uniform1f(he,g.u_opacity),u_image:new o.Uniform1i(he,g.u_image),u_pattern_tl_a:new o.Uniform2f(he,g.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(he,g.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(he,g.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(he,g.u_pattern_br_b),u_texsize:new o.Uniform2f(he,g.u_texsize),u_mix:new o.Uniform1f(he,g.u_mix),u_pattern_size_a:new o.Uniform2f(he,g.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(he,g.u_pattern_size_b),u_scale_a:new o.Uniform1f(he,g.u_scale_a),u_scale_b:new o.Uniform1f(he,g.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(he,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(he,g.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(he,g.u_tile_units_to_pixels)}),terrain:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_texture:new o.Uniform1i(he,g.u_texture),u_ele_delta:new o.Uniform1f(he,g.u_ele_delta)}),terrainDepth:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_ele_delta:new o.Uniform1f(he,g.u_ele_delta)}),terrainCoords:(he,g)=>({u_matrix:new o.UniformMatrix4f(he,g.u_matrix),u_texture:new o.Uniform1i(he,g.u_texture),u_terrain_coords_id:new o.Uniform1f(he,g.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(he,g.u_ele_delta)})};class pv{constructor(g,A,X){this.context=g;const _e=g.gl;this.buffer=_e.createBuffer(),this.dynamicDraw=!!X,this.context.unbindVAO(),g.bindElementBuffer.set(this.buffer),_e.bufferData(_e.ELEMENT_ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?_e.DYNAMIC_DRAW:_e.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(g){const A=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),A.bufferSubData(A.ELEMENT_ARRAY_BUFFER,0,g.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const S0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jg{constructor(g,A,X,_e){this.length=A.length,this.attributes=X,this.itemSize=A.bytesPerElement,this.dynamicDraw=_e,this.context=g;const Ft=g.gl;this.buffer=Ft.createBuffer(),g.bindVertexBuffer.set(this.buffer),Ft.bufferData(Ft.ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?Ft.DYNAMIC_DRAW:Ft.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(g){if(g.length!==this.length)throw new Error(`Length of new data is ${g.length}, which doesn't match current length of ${this.length}`);const A=this.context.gl;this.bind(),A.bufferSubData(A.ARRAY_BUFFER,0,g.arrayBuffer)}enableAttributes(g,A){for(let X=0;X<this.attributes.length;X++){const _e=A.attributes[this.attributes[X].name];_e!==void 0&&g.enableVertexAttribArray(_e)}}setVertexAttribPointers(g,A,X){for(let _e=0;_e<this.attributes.length;_e++){const Ft=this.attributes[_e],Xr=A.attributes[Ft.name];Xr!==void 0&&g.vertexAttribPointer(Xr,Ft.components,g[S0[Ft.type]],!1,this.itemSize,Ft.offset+this.itemSize*(X||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wp{constructor(g){this.gl=g.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(g){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class T0 extends Wp{getDefault(){return o.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class bg extends Wp{getDefault(){return 1}set(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)}}class Rg extends Wp{getDefault(){return 0}set(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)}}class jy extends Wp{getDefault(){return[!0,!0,!0,!0]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class Qg extends Wp{getDefault(){return!0}set(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)}}class j_ extends Wp{getDefault(){return 255}set(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)}}class q_ extends Wp{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(g){const A=this.current;(g.func!==A.func||g.ref!==A.ref||g.mask!==A.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)}}class Ty extends Wp{getDefault(){const g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)}}class gm extends Wp{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST),this.current=g,this.dirty=!1}}class qy extends Wp{getDefault(){return[0,1]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)}}class cy extends Wp{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST),this.current=g,this.dirty=!1}}class I0 extends Wp{getDefault(){return this.gl.LESS}set(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)}}class Z_ extends Wp{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.BLEND):A.disable(A.BLEND),this.current=g,this.dirty=!1}}class fm extends Wp{getDefault(){const g=this.gl;return[g.ONE,g.ZERO]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)}}class mv extends Wp{getDefault(){return o.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class Iy extends Wp{getDefault(){return this.gl.FUNC_ADD}set(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)}}class Z0 extends Wp{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE),this.current=g,this.dirty=!1}}class Zy extends Wp{getDefault(){return this.gl.BACK}set(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)}}class Hy extends Wp{getDefault(){return this.gl.CCW}set(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)}}class H_ extends Wp{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}}class Cy extends Wp{getDefault(){return this.gl.TEXTURE0}set(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)}}class c0 extends Wp{getDefault(){const g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class Xy extends Wp{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindFramebuffer(A.FRAMEBUFFER,g),this.current=g,this.dirty=!1}}class m_ extends Wp{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindRenderbuffer(A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class X_ extends Wp{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindTexture(A.TEXTURE_2D,g),this.current=g,this.dirty=!1}}class Og extends Wp{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindBuffer(A.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class C0 extends Wp{getDefault(){return null}set(g){const A=this.gl;A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class l_ extends Wp{constructor(g){super(g),this.vao=g.extVertexArrayObject}getDefault(){return null}set(g){this.vao&&(g!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(g),this.current=g,this.dirty=!1)}}class g_ extends Wp{getDefault(){return 4}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}}class e_ extends Wp{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}}class K_ extends Wp{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}}class t_ extends Wp{constructor(g,A){super(g),this.context=g,this.parent=A}getDefault(){return null}}class gv extends t_{setDirty(){this.dirty=!0}set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}}class im extends t_{set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class uy{constructor(g,A,X,_e){this.context=g,this.width=A,this.height=X;const Ft=g.gl,Xr=this.framebuffer=Ft.createFramebuffer();if(this.colorAttachment=new gv(g,Xr),_e&&(this.depthAttachment=new im(g,Xr)),Ft.checkFramebufferStatus(Ft.FRAMEBUFFER)!==Ft.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const g=this.context.gl,A=this.colorAttachment.get();if(A&&g.deleteTexture(A),this.depthAttachment){const X=this.depthAttachment.get();X&&g.deleteRenderbuffer(X)}g.deleteFramebuffer(this.framebuffer)}}class Hm{constructor(g,A,X){this.blendFunction=g,this.blendColor=A,this.mask=X}}Hm.Replace=[1,0],Hm.disabled=new Hm(Hm.Replace,o.Color.transparent,[!1,!1,!1,!1]),Hm.unblended=new Hm(Hm.Replace,o.Color.transparent,[!0,!0,!0,!0]),Hm.alphaBlended=new Hm([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Ky{constructor(g){this.gl=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new T0(this),this.clearDepth=new bg(this),this.clearStencil=new Rg(this),this.colorMask=new jy(this),this.depthMask=new Qg(this),this.stencilMask=new j_(this),this.stencilFunc=new q_(this),this.stencilOp=new Ty(this),this.stencilTest=new gm(this),this.depthRange=new qy(this),this.depthTest=new cy(this),this.depthFunc=new I0(this),this.blend=new Z_(this),this.blendFunc=new fm(this),this.blendColor=new mv(this),this.blendEquation=new Iy(this),this.cullFace=new Z0(this),this.cullFaceSide=new Zy(this),this.frontFace=new Hy(this),this.program=new H_(this),this.activeTexture=new Cy(this),this.viewport=new c0(this),this.bindFramebuffer=new Xy(this),this.bindRenderbuffer=new m_(this),this.bindTexture=new X_(this),this.bindVertexBuffer=new Og(this),this.bindElementBuffer=new C0(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new l_(this),this.pixelStoreUnpack=new g_(this),this.pixelStoreUnpackPremultiplyAlpha=new e_(this),this.pixelStoreUnpackFlipY=new K_(this),this.extTextureFilterAnisotropic=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=g.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=g.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(g.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=g.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=g.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=g.getParameter(g.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(g,A){return new pv(this,g,A)}createVertexBuffer(g,A,X){return new Jg(this,g,A,X)}createRenderbuffer(g,A,X){const _e=this.gl,Ft=_e.createRenderbuffer();return this.bindRenderbuffer.set(Ft),_e.renderbufferStorage(_e.RENDERBUFFER,g,A,X),this.bindRenderbuffer.set(null),Ft}createFramebuffer(g,A,X){return new uy(this,g,A,X)}clear({color:g,depth:A}){const X=this.gl;let _e=0;g&&(_e|=X.COLOR_BUFFER_BIT,this.clearColor.set(g),this.colorMask.set([!0,!0,!0,!0])),A!==void 0&&(_e|=X.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(A),this.depthMask.set(!0)),X.clear(_e)}setCullFace(g){g.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(g.mode),this.frontFace.set(g.frontFace))}setDepthMode(g){g.func!==this.gl.ALWAYS||g.mask?(this.depthTest.set(!0),this.depthFunc.set(g.func),this.depthMask.set(g.mask),this.depthRange.set(g.range)):this.depthTest.set(!1)}setStencilMode(g){g.test.func!==this.gl.ALWAYS||g.mask?(this.stencilTest.set(!0),this.stencilMask.set(g.mask),this.stencilOp.set([g.fail,g.depthFail,g.pass]),this.stencilFunc.set({func:g.test.func,ref:g.ref,mask:g.test.mask})):this.stencilTest.set(!1)}setColorMode(g){nt(g.blendFunction,Hm.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(g.blendFunction),this.blendColor.set(g.blendColor)),this.colorMask.set(g.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class lm{constructor(g,A,X){this.func=g,this.mask=A,this.range=X}}lm.ReadOnly=!1,lm.ReadWrite=!0,lm.disabled=new lm(519,lm.ReadOnly,[0,1]);const W_=7680;class Am{constructor(g,A,X,_e,Ft,Xr){this.test=g,this.ref=A,this.mask=X,this.fail=_e,this.depthFail=Ft,this.pass=Xr}}Am.disabled=new Am({func:519,mask:0},0,0,W_,W_,W_);class Im{constructor(g,A,X){this.enable=g,this.mode=A,this.frontFace=X}}let hy;function My(he,g,A,X,_e,Ft,Xr){const as=he.context,cs=as.gl,us=he.useProgram("collisionBox"),th=[];let eh=0,ph=0;for(let qh=0;qh<X.length;qh++){const Md=X[qh],Nd=g.getTile(Md),L=Nd.getBucket(A);if(!L)continue;let u=Md.posMatrix;_e[0]===0&&_e[1]===0||(u=he.translatePosMatrix(Md.posMatrix,Nd,_e,Ft));const E=Xr?L.textCollisionBox:L.iconCollisionBox,B=L.collisionCircleArray;if(B.length>0){const Y=o.create(),vt=u;o.mul(Y,L.placementInvProjMatrix,he.transform.glCoordMatrix),o.mul(Y,Y,L.placementViewportMatrix),th.push({circleArray:B,circleOffset:ph,transform:vt,invTransform:Y,coord:Md}),eh+=B.length/4,ph=eh}E&&us.draw(as,cs.LINES,lm.disabled,Am.disabled,he.colorModeForRenderPass(),Im.disabled,Mm(u,he.transform,Nd),he.style.map.terrain&&he.style.map.terrain.getTerrainData(Md),A.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,null,he.transform.zoom,null,null,E.collisionVertexBuffer)}if(!Xr||!th.length)return;const Rh=he.useProgram("collisionCircle"),Bh=new o.CollisionCircleLayoutArray;Bh.resize(4*eh),Bh._trim();let Ch=0;for(const qh of th)for(let Md=0;Md<qh.circleArray.length/4;Md++){const Nd=4*Md,L=qh.circleArray[Nd+0],u=qh.circleArray[Nd+1],E=qh.circleArray[Nd+2],B=qh.circleArray[Nd+3];Bh.emplace(Ch++,L,u,E,B,0),Bh.emplace(Ch++,L,u,E,B,1),Bh.emplace(Ch++,L,u,E,B,2),Bh.emplace(Ch++,L,u,E,B,3)}(!hy||hy.length<2*eh)&&(hy=function(qh){const Md=2*qh,Nd=new o.QuadTriangleArray;Nd.resize(Md),Nd._trim();for(let L=0;L<Md;L++){const u=6*L;Nd.uint16[u+0]=4*L+0,Nd.uint16[u+1]=4*L+1,Nd.uint16[u+2]=4*L+2,Nd.uint16[u+3]=4*L+2,Nd.uint16[u+4]=4*L+3,Nd.uint16[u+5]=4*L+0}return Nd}(eh));const ed=as.createIndexBuffer(hy,!0),Ed=as.createVertexBuffer(Bh,o.collisionCircleLayout.members,!0);for(const qh of th){const Md={u_matrix:qh.transform,u_inv_matrix:qh.invTransform,u_camera_to_center_distance:(_d=he.transform).cameraToCenterDistance,u_viewport_size:[_d.width,_d.height]};Rh.draw(as,cs.TRIANGLES,lm.disabled,Am.disabled,he.colorModeForRenderPass(),Im.disabled,Md,he.style.map.terrain&&he.style.map.terrain.getTerrainData(qh.coord),A.id,Ed,ed,o.SegmentVector.simpleSegment(0,2*qh.circleOffset,qh.circleArray.length,qh.circleArray.length/2),null,he.transform.zoom,null,null,null)}var _d;Ed.destroy(),ed.destroy()}Im.disabled=new Im(!1,1029,2305),Im.backCCW=new Im(!0,1029,2305);const H0=o.identity(new Float32Array(16));function k_(he,g,A,X,_e,Ft){const{horizontalAlign:Xr,verticalAlign:as}=o.getAnchorAlignment(he),cs=-(Xr-.5)*g,us=-(as-.5)*A,th=o.evaluateVariableOffset(he,X);return new o.pointGeometry((cs/_e+th[0])*Ft,(us/_e+th[1])*Ft)}function X0(he,g,A,X,_e,Ft,Xr,as,cs,us,th){const eh=he.text.placedSymbolArray,ph=he.text.dynamicLayoutVertexArray,Rh=he.icon.dynamicLayoutVertexArray,Bh={};ph.clear();for(let Ch=0;Ch<eh.length;Ch++){const ed=eh.get(Ch),Ed=ed.hidden||!ed.crossTileID||he.allowVerticalPlacement&&!ed.placedOrientation?null:X[ed.crossTileID];if(Ed){const _d=new o.pointGeometry(ed.anchorX,ed.anchorY),qh=al(_d,A?Xr:Ft,th),Md=fh(_e.cameraToCenterDistance,qh.signedDistanceFromCamera);let Nd=o.evaluateSizeForFeature(he.textSizeData,cs,ed)*Md/o.ONE_EM;A&&(Nd*=he.tilePixelRatio/as);const{width:L,height:u,anchor:E,textOffset:B,textBoxScale:Y}=Ed,vt=k_(E,L,u,B,Y,Nd),mr=A?al(_d.add(vt),Ft,th).point:qh.point.add(g?vt.rotate(-_e.angle):vt),Ur=he.allowVerticalPlacement&&ed.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Gn=0;Gn<ed.numGlyphs;Gn++)o.addDynamicAttributes(ph,mr,Ur);us&&ed.associatedIconIndex>=0&&(Bh[ed.associatedIconIndex]={shiftedAnchor:mr,angle:Ur})}else Zh(ed.numGlyphs,ph)}if(us){Rh.clear();const Ch=he.icon.placedSymbolArray;for(let ed=0;ed<Ch.length;ed++){const Ed=Ch.get(ed);if(Ed.hidden)Zh(Ed.numGlyphs,Rh);else{const _d=Bh[ed];if(_d)for(let qh=0;qh<Ed.numGlyphs;qh++)o.addDynamicAttributes(Rh,_d.shiftedAnchor,_d.angle);else Zh(Ed.numGlyphs,Rh)}}he.icon.dynamicLayoutVertexBuffer.updateData(Rh)}he.text.dynamicLayoutVertexBuffer.updateData(ph)}function D_(he,g,A){return A.iconsInText&&g?"symbolTextAndIcon":he?"symbolSDF":"symbolIcon"}function Y_(he,g,A,X,_e,Ft,Xr,as,cs,us,th,eh){const ph=he.context,Rh=ph.gl,Bh=he.transform,Ch=as==="map",ed=cs==="map",Ed=as!=="viewport"&&A.layout.get("symbol-placement")!=="point",_d=Ch&&!ed&&!Ed,qh=!A.layout.get("symbol-sort-key").isConstant();let Md=!1;const Nd=he.depthModeForSublayer(0,lm.ReadOnly),L=A.layout.get("text-variable-anchor"),u=[];for(const E of X){const B=g.getTile(E),Y=B.getBucket(A);if(!Y)continue;const vt=_e?Y.text:Y.icon;if(!vt||!vt.segments.get().length||!vt.hasVisibleVertices)continue;const mr=vt.programConfigurations.get(A.id),Ur=_e||Y.sdfIcons,Gn=_e?Y.textSizeData:Y.iconSizeData,$s=ed||Bh.pitch!==0,el=he.useProgram(D_(Ur,_e,Y),mr),Wu=o.evaluateSizeForZoom(Gn,Bh.zoom),dh=he.style.map.terrain&&he.style.map.terrain.getTerrainData(E);let gh,Eh,yh,Ih,Qu=[0,0],bh=null;if(_e)Eh=B.glyphAtlasTexture,yh=Rh.LINEAR,gh=B.glyphAtlasTexture.size,Y.iconsInText&&(Qu=B.imageAtlasTexture.size,bh=B.imageAtlasTexture,Ih=$s||he.options.rotating||he.options.zooming||Gn.kind==="composite"||Gn.kind==="camera"?Rh.LINEAR:Rh.NEAREST);else{const Od=A.layout.get("icon-size").constantOr(0)!==1||Y.iconsNeedLinear;Eh=B.imageAtlasTexture,yh=Ur||he.options.rotating||he.options.zooming||Od||$s?Rh.LINEAR:Rh.NEAREST,gh=B.imageAtlasTexture.size}const kh=Fd(B,1,he.transform.zoom),Oh=Th(E.posMatrix,ed,Ch,he.transform,kh),rd=Fh(E.posMatrix,ed,Ch,he.transform,kh),sd=L&&Y.hasTextData(),ld=A.layout.get("icon-text-fit")!=="none"&&sd&&Y.hasIconData();if(Ed){const Od=he.style.map.terrain?(Dd,yf)=>he.style.map.terrain.getElevation(E,Dd,yf):null,Lf=A.layout.get("text-rotation-alignment")==="map";Zs(Y,E.posMatrix,he,_e,Oh,rd,ed,us,Lf,Od)}const dd=he.translatePosMatrix(E.posMatrix,B,Ft,Xr),ud=Ed||_e&&L||ld?H0:Oh,md=he.translatePosMatrix(rd,B,Ft,Xr,!0),Af=Ur&&A.paint.get(_e?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Td;Td=Ur?Y.iconsInText?fv(Gn.kind,Wu,_d,ed,he,dd,ud,md,gh,Qu):q0(Gn.kind,Wu,_d,ed,he,dd,ud,md,_e,gh,!0):xg(Gn.kind,Wu,_d,ed,he,dd,ud,md,_e,gh);const Gd={program:el,buffers:vt,uniformValues:Td,atlasTexture:Eh,atlasTextureIcon:bh,atlasInterpolation:yh,atlasInterpolationIcon:Ih,isSDF:Ur,hasHalo:Af};if(qh&&Y.canOverlap){Md=!0;const Od=vt.segments.get();for(const Lf of Od)u.push({segments:new o.SegmentVector([Lf]),sortKey:Lf.sortKey,state:Gd,terrainData:dh})}else u.push({segments:vt.segments,sortKey:0,state:Gd,terrainData:dh})}Md&&u.sort((E,B)=>E.sortKey-B.sortKey);for(const E of u){const B=E.state;if(ph.activeTexture.set(Rh.TEXTURE0),B.atlasTexture.bind(B.atlasInterpolation,Rh.CLAMP_TO_EDGE),B.atlasTextureIcon&&(ph.activeTexture.set(Rh.TEXTURE1),B.atlasTextureIcon&&B.atlasTextureIcon.bind(B.atlasInterpolationIcon,Rh.CLAMP_TO_EDGE)),B.isSDF){const Y=B.uniformValues;B.hasHalo&&(Y.u_is_halo=1,K0(B.buffers,E.segments,A,he,B.program,Nd,th,eh,Y,E.terrainData)),Y.u_is_halo=0}K0(B.buffers,E.segments,A,he,B.program,Nd,th,eh,B.uniformValues,E.terrainData)}}function K0(he,g,A,X,_e,Ft,Xr,as,cs,us){const th=X.context;_e.draw(th,th.gl.TRIANGLES,Ft,Xr,as,Im.disabled,cs,us,A.id,he.layoutVertexBuffer,he.indexBuffer,g,A.paint,X.transform.zoom,he.programConfigurations.get(A.id),he.dynamicLayoutVertexBuffer,he.opacityVertexBuffer)}function u0(he,g,A,X,_e){if(!A||!X||!X.imageAtlas)return;const Ft=X.imageAtlas.patternPositions;let Xr=Ft[A.to.toString()],as=Ft[A.from.toString()];if(!Xr||!as){const cs=_e.getPaintProperty(g);Xr=Ft[cs],as=Ft[cs]}Xr&&as&&he.setConstantPatternPositions(Xr,as)}function dy(he,g,A,X,_e,Ft,Xr){const as=he.context.gl,cs="fill-pattern",us=A.paint.get(cs),th=us&&us.constantOr(1),eh=A.getCrossfadeParameters();let ph,Rh,Bh,Ch,ed;Xr?(Rh=th&&!A.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ph=as.LINES):(Rh=th?"fillPattern":"fill",ph=as.TRIANGLES);const Ed=us.constantOr(null);for(const _d of X){const qh=g.getTile(_d);if(th&&!qh.patternsLoaded())continue;const Md=qh.getBucket(A);if(!Md)continue;const Nd=Md.programConfigurations.get(A.id),L=he.useProgram(Rh,Nd),u=he.style.map.terrain&&he.style.map.terrain.getTerrainData(_d);th&&(he.context.activeTexture.set(as.TEXTURE0),qh.imageAtlasTexture.bind(as.LINEAR,as.CLAMP_TO_EDGE),Nd.updatePaintBuffers(eh)),u0(Nd,cs,Ed,qh,A);const E=u?_d:null,B=he.translatePosMatrix(E?E.posMatrix:_d.posMatrix,qh,A.paint.get("fill-translate"),A.paint.get("fill-translate-anchor"));if(Xr){Ch=Md.indexBuffer2,ed=Md.segments2;const Y=[as.drawingBufferWidth,as.drawingBufferHeight];Bh=Rh==="fillOutlinePattern"&&th?Kp(B,he,eh,qh,Y):Cp(B,Y)}else Ch=Md.indexBuffer,ed=Md.segments,Bh=th?Mf(B,he,eh,qh):Dm(B);L.draw(he.context,ph,_e,he.stencilModeForClipping(_d),Ft,Im.disabled,Bh,u,A.id,Md.layoutVertexBuffer,Ch,ed,A.paint,he.transform.zoom,Nd)}}function J_(he,g,A,X,_e,Ft,Xr){const as=he.context,cs=as.gl,us="fill-extrusion-pattern",th=A.paint.get(us),eh=th.constantOr(1),ph=A.getCrossfadeParameters(),Rh=A.paint.get("fill-extrusion-opacity"),Bh=th.constantOr(null);for(const Ch of X){const ed=g.getTile(Ch),Ed=ed.getBucket(A);if(!Ed)continue;const _d=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Ch),qh=Ed.programConfigurations.get(A.id),Md=he.useProgram(eh?"fillExtrusionPattern":"fillExtrusion",qh);eh&&(he.context.activeTexture.set(cs.TEXTURE0),ed.imageAtlasTexture.bind(cs.LINEAR,cs.CLAMP_TO_EDGE),qh.updatePaintBuffers(ph)),u0(qh,us,Bh,ed,A);const Nd=he.translatePosMatrix(Ch.posMatrix,ed,A.paint.get("fill-extrusion-translate"),A.paint.get("fill-extrusion-translate-anchor")),L=A.paint.get("fill-extrusion-vertical-gradient"),u=eh?Xp(Nd,he,L,Rh,Ch,ph,ed):Sm(Nd,he,L,Rh);Md.draw(as,as.gl.TRIANGLES,_e,Ft,Xr,Im.backCCW,u,_d,A.id,Ed.layoutVertexBuffer,Ed.indexBuffer,Ed.segments,A.paint,he.transform.zoom,qh,he.style.map.terrain&&Ed.centroidVertexBuffer)}}function M0(he,g,A,X,_e,Ft,Xr){const as=he.context,cs=as.gl,us=A.fbo;if(!us)return;const th=he.useProgram("hillshade"),eh=he.style.map.terrain&&he.style.map.terrain.getTerrainData(g);as.activeTexture.set(cs.TEXTURE0),cs.bindTexture(cs.TEXTURE_2D,us.colorAttachment.get()),th.draw(as,cs.TRIANGLES,_e,Ft,Xr,Im.disabled,((ph,Rh,Bh,Ch)=>{const ed=Bh.paint.get("hillshade-shadow-color"),Ed=Bh.paint.get("hillshade-highlight-color"),_d=Bh.paint.get("hillshade-accent-color");let qh=Bh.paint.get("hillshade-illumination-direction")*(Math.PI/180);Bh.paint.get("hillshade-illumination-anchor")==="viewport"&&(qh-=ph.transform.angle);const Md=!ph.options.moving;return{u_matrix:Ch?Ch.posMatrix:ph.transform.calculatePosMatrix(Rh.tileID.toUnwrapped(),Md),u_image:0,u_latrange:Uy(0,Rh.tileID),u_light:[Bh.paint.get("hillshade-exaggeration"),qh],u_shadow:ed,u_highlight:Ed,u_accent:_d}})(he,A,X,eh?g:null),eh,X.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments)}function Wy(he,g,A,X,_e,Ft){const Xr=he.context,as=Xr.gl,cs=g.dem;if(cs&&cs.data){const us=cs.dim,th=cs.stride,eh=cs.getPixels();if(Xr.activeTexture.set(as.TEXTURE1),Xr.pixelStoreUnpackPremultiplyAlpha.set(!1),g.demTexture=g.demTexture||he.getTileTexture(th),g.demTexture){const Rh=g.demTexture;Rh.update(eh,{premultiply:!1}),Rh.bind(as.NEAREST,as.CLAMP_TO_EDGE)}else g.demTexture=new $h(Xr,eh,as.RGBA,{premultiply:!1}),g.demTexture.bind(as.NEAREST,as.CLAMP_TO_EDGE);Xr.activeTexture.set(as.TEXTURE0);let ph=g.fbo;if(!ph){const Rh=new $h(Xr,{width:us,height:us,data:null},as.RGBA);Rh.bind(as.LINEAR,as.CLAMP_TO_EDGE),ph=g.fbo=Xr.createFramebuffer(us,us,!0),ph.colorAttachment.set(Rh.texture)}Xr.bindFramebuffer.set(ph.framebuffer),Xr.viewport.set([0,0,us,us]),he.useProgram("hillshadePrepare").draw(Xr,as.TRIANGLES,X,_e,Ft,Im.disabled,((Rh,Bh)=>{const Ch=Bh.stride,ed=o.create();return o.ortho(ed,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(ed,ed,[0,-o.EXTENT,0]),{u_matrix:ed,u_image:1,u_dimension:[Ch,Ch],u_zoom:Rh.overscaledZ,u_unpack:Bh.getUnpackVector()}})(g.tileID,cs),null,A.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments),g.needsHillshadePrepare=!1}}function L_(he,g,A,X,_e,Ft){const Xr=X.paint.get("raster-fade-duration");if(!Ft&&Xr>0){const as=o.exported.now(),cs=(as-he.timeAdded)/Xr,us=g?(as-g.timeAdded)/Xr:-1,th=A.getSource(),eh=_e.coveringZoomLevel({tileSize:th.tileSize,roundZoom:th.roundZoom}),ph=!g||Math.abs(g.tileID.overscaledZ-eh)>Math.abs(he.tileID.overscaledZ-eh),Rh=ph&&he.refreshedUponExpiration?1:o.clamp(ph?cs:1-us,0,1);return he.refreshedUponExpiration&&cs>=1&&(he.refreshedUponExpiration=!1),g?{opacity:1,mix:1-Rh}:{opacity:Rh,mix:0}}return{opacity:1,mix:0}}const __=new o.Color(1,0,0,1),c_=new o.Color(0,1,0,1),bd=new o.Color(0,0,1,1),mf=new o.Color(1,0,1,1),np=new o.Color(0,1,1,1);function Dp(he,g,A,X){om(he,0,g+A/2,he.transform.width,A,X)}function Fm(he,g,A,X){om(he,g-A/2,0,A,he.transform.height,X)}function om(he,g,A,X,_e,Ft){const Xr=he.context,as=Xr.gl;as.enable(as.SCISSOR_TEST),as.scissor(g*he.pixelRatio,A*he.pixelRatio,X*he.pixelRatio,_e*he.pixelRatio),Xr.clear({color:Ft}),as.disable(as.SCISSOR_TEST)}function qm(he,g,A){const X=he.context,_e=X.gl,Ft=A.posMatrix,Xr=he.useProgram("debug"),as=lm.disabled,cs=Am.disabled,us=he.colorModeForRenderPass(),th="$debug",eh=he.style.map.terrain&&he.style.map.terrain.getTerrainData(A);X.activeTexture.set(_e.TEXTURE0),he.emptyTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const ph=g.getTileByID(A.key).latestRawTileData,Rh=Math.floor((ph&&ph.byteLength||0)/1024),Bh=g.getTile(A).tileSize,Ch=512/Math.min(Bh,512)*(A.overscaledZ/he.transform.zoom)*.5;let ed=A.canonical.toString();A.overscaledZ!==A.canonical.z&&(ed+=` => ${A.overscaledZ}`),function(Ed,_d){Ed.initDebugOverlayCanvas();const qh=Ed.debugOverlayCanvas,Md=Ed.context.gl,Nd=Ed.debugOverlayCanvas.getContext("2d");Nd.clearRect(0,0,qh.width,qh.height),Nd.shadowColor="white",Nd.shadowBlur=2,Nd.lineWidth=1.5,Nd.strokeStyle="white",Nd.textBaseline="top",Nd.font="bold 36px Open Sans, sans-serif",Nd.fillText(_d,5,5),Nd.strokeText(_d,5,5),Ed.debugOverlayTexture.update(qh),Ed.debugOverlayTexture.bind(Md.LINEAR,Md.CLAMP_TO_EDGE)}(he,`${ed} ${Rh}kB`),Xr.draw(X,_e.TRIANGLES,as,cs,Hm.alphaBlended,Im.disabled,lg(Ft,o.Color.transparent,Ch),null,th,he.debugBuffer,he.quadTriangleIndexBuffer,he.debugSegments),Xr.draw(X,_e.LINE_STRIP,as,cs,us,Im.disabled,lg(Ft,o.Color.red),eh,th,he.debugBuffer,he.tileBorderIndexBuffer,he.debugSegments)}function Um(he,g,A){const X=he.context,_e=X.gl,Ft=he.colorModeForRenderPass(),Xr=new lm(_e.LEQUAL,lm.ReadWrite,he.depthRangeFor3D),as=he.useProgram("terrain"),cs=g.getTerrainMesh();X.bindFramebuffer.set(null),X.viewport.set([0,0,he.width,he.height]);for(const us of A){const th=he.renderToTexture.getTexture(us),eh=g.getTerrainData(us.tileID);X.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,th.texture);const ph={u_matrix:he.transform.calculatePosMatrix(us.tileID.toUnwrapped()),u_texture:0,u_ele_delta:g.getMeshFrameDelta(he.transform.zoom)};as.draw(X,_e.TRIANGLES,Xr,Am.disabled,Ft,Im.backCCW,ph,eh,"terrain",cs.vertexBuffer,cs.indexBuffer,cs.segments)}}const Ag={symbol:function(he,g,A,X,_e){if(he.renderPass!=="translucent")return;const Ft=Am.disabled,Xr=he.colorModeForRenderPass();A.layout.get("text-variable-anchor")&&function(as,cs,us,th,eh,ph,Rh){const Bh=cs.transform,Ch=eh==="map",ed=ph==="map";for(const Ed of as){const _d=th.getTile(Ed),qh=_d.getBucket(us);if(!qh||!qh.text||!qh.text.segments.get().length)continue;const Md=o.evaluateSizeForZoom(qh.textSizeData,Bh.zoom),Nd=Fd(_d,1,cs.transform.zoom),L=Th(Ed.posMatrix,ed,Ch,cs.transform,Nd),u=us.layout.get("icon-text-fit")!=="none"&&qh.hasIconData();if(Md){const E=Math.pow(2,Bh.zoom-_d.tileID.overscaledZ);X0(qh,Ch,ed,Rh,Bh,L,Ed.posMatrix,E,Md,u,cs.style.map.terrain?(B,Y)=>cs.style.map.terrain.getElevation(Ed,B,Y):null)}}}(X,he,A,g,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),_e),A.paint.get("icon-opacity").constantOr(1)!==0&&Y_(he,g,A,X,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),Ft,Xr),A.paint.get("text-opacity").constantOr(1)!==0&&Y_(he,g,A,X,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),Ft,Xr),g.map.showCollisionBoxes&&(My(he,g,A,X,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),My(he,g,A,X,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))},circle:function(he,g,A,X){if(he.renderPass!=="translucent")return;const _e=A.paint.get("circle-opacity"),Ft=A.paint.get("circle-stroke-width"),Xr=A.paint.get("circle-stroke-opacity"),as=!A.layout.get("circle-sort-key").isConstant();if(_e.constantOr(1)===0&&(Ft.constantOr(1)===0||Xr.constantOr(1)===0))return;const cs=he.context,us=cs.gl,th=he.depthModeForSublayer(0,lm.ReadOnly),eh=Am.disabled,ph=he.colorModeForRenderPass(),Rh=[];for(let Bh=0;Bh<X.length;Bh++){const Ch=X[Bh],ed=g.getTile(Ch),Ed=ed.getBucket(A);if(!Ed)continue;const _d=Ed.programConfigurations.get(A.id),qh=he.useProgram("circle",_d),Md=Ed.layoutVertexBuffer,Nd=Ed.indexBuffer,L=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Ch),u={programConfiguration:_d,program:qh,layoutVertexBuffer:Md,indexBuffer:Nd,uniformValues:Ym(he,Ch,ed,A),terrainData:L};if(as){const E=Ed.segments.get();for(const B of E)Rh.push({segments:new o.SegmentVector([B]),sortKey:B.sortKey,state:u})}else Rh.push({segments:Ed.segments,sortKey:0,state:u})}as&&Rh.sort((Bh,Ch)=>Bh.sortKey-Ch.sortKey);for(const Bh of Rh){const{programConfiguration:Ch,program:ed,layoutVertexBuffer:Ed,indexBuffer:_d,uniformValues:qh,terrainData:Md}=Bh.state;ed.draw(cs,us.TRIANGLES,th,eh,ph,Im.disabled,qh,Md,A.id,Ed,_d,Bh.segments,A.paint,he.transform.zoom,Ch)}},heatmap:function(he,g,A,X){if(A.paint.get("heatmap-opacity")!==0)if(he.renderPass==="offscreen"){const _e=he.context,Ft=_e.gl,Xr=Am.disabled,as=new Hm([Ft.ONE,Ft.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(cs,us,th){const eh=cs.gl;cs.activeTexture.set(eh.TEXTURE1),cs.viewport.set([0,0,us.width/4,us.height/4]);let ph=th.heatmapFbo;if(ph)eh.bindTexture(eh.TEXTURE_2D,ph.colorAttachment.get()),cs.bindFramebuffer.set(ph.framebuffer);else{const Rh=eh.createTexture();eh.bindTexture(eh.TEXTURE_2D,Rh),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_WRAP_S,eh.CLAMP_TO_EDGE),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_WRAP_T,eh.CLAMP_TO_EDGE),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_MIN_FILTER,eh.LINEAR),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_MAG_FILTER,eh.LINEAR),ph=th.heatmapFbo=cs.createFramebuffer(us.width/4,us.height/4,!1),function(Bh,Ch,ed,Ed){const _d=Bh.gl;_d.texImage2D(_d.TEXTURE_2D,0,_d.RGBA,Ch.width/4,Ch.height/4,0,_d.RGBA,Bh.extRenderToTextureHalfFloat?Bh.extTextureHalfFloat.HALF_FLOAT_OES:_d.UNSIGNED_BYTE,null),Ed.colorAttachment.set(ed)}(cs,us,Rh,ph)}})(_e,he,A),_e.clear({color:o.Color.transparent});for(let cs=0;cs<X.length;cs++){const us=X[cs];if(g.hasRenderableParent(us))continue;const th=g.getTile(us),eh=th.getBucket(A);if(!eh)continue;const ph=eh.programConfigurations.get(A.id),Rh=he.useProgram("heatmap",ph),{zoom:Bh}=he.transform;Rh.draw(_e,Ft.TRIANGLES,lm.disabled,Xr,as,Im.disabled,Tm(us.posMatrix,th,Bh,A.paint.get("heatmap-intensity")),null,A.id,eh.layoutVertexBuffer,eh.indexBuffer,eh.segments,A.paint,he.transform.zoom,ph)}_e.viewport.set([0,0,he.width,he.height])}else he.renderPass==="translucent"&&(he.context.setColorMode(he.colorModeForRenderPass()),function(_e,Ft){const Xr=_e.context,as=Xr.gl,cs=Ft.heatmapFbo;if(!cs)return;Xr.activeTexture.set(as.TEXTURE0),as.bindTexture(as.TEXTURE_2D,cs.colorAttachment.get()),Xr.activeTexture.set(as.TEXTURE1);let us=Ft.colorRampTexture;us||(us=Ft.colorRampTexture=new $h(Xr,Ft.colorRamp,as.RGBA)),us.bind(as.LINEAR,as.CLAMP_TO_EDGE),_e.useProgram("heatmapTexture").draw(Xr,as.TRIANGLES,lm.disabled,Am.disabled,_e.colorModeForRenderPass(),Im.disabled,((th,eh,ph,Rh)=>{const Bh=o.create();o.ortho(Bh,0,th.width,th.height,0,0,1);const Ch=th.context.gl;return{u_matrix:Bh,u_world:[Ch.drawingBufferWidth,Ch.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:eh.paint.get("heatmap-opacity")}})(_e,Ft),null,Ft.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments,Ft.paint,_e.transform.zoom)}(he,A))},line:function(he,g,A,X){if(he.renderPass!=="translucent")return;const _e=A.paint.get("line-opacity"),Ft=A.paint.get("line-width");if(_e.constantOr(1)===0||Ft.constantOr(1)===0)return;const Xr=he.depthModeForSublayer(0,lm.ReadOnly),as=he.colorModeForRenderPass(),cs=A.paint.get("line-dasharray"),us=A.paint.get("line-pattern"),th=us.constantOr(1),eh=A.paint.get("line-gradient"),ph=A.getCrossfadeParameters(),Rh=th?"linePattern":cs?"lineSDF":eh?"lineGradient":"line",Bh=he.context,Ch=Bh.gl;let ed=!0;for(const Ed of X){const _d=g.getTile(Ed);if(th&&!_d.patternsLoaded())continue;const qh=_d.getBucket(A);if(!qh)continue;const Md=qh.programConfigurations.get(A.id),Nd=he.context.program.get(),L=he.useProgram(Rh,Md),u=ed||L.program!==Nd,E=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Ed),B=us.constantOr(null);if(B&&_d.imageAtlas){const mr=_d.imageAtlas,Ur=mr.patternPositions[B.to.toString()],Gn=mr.patternPositions[B.from.toString()];Ur&&Gn&&Md.setConstantPatternPositions(Ur,Gn)}const Y=E?Ed:null,vt=th?l0(he,_d,A,ph,Y):cs?Vy(he,_d,A,cs,ph,Y):eh?ng(he,_d,A,qh.lineClipsArray.length,Y):vg(he,_d,A,Y);if(th)Bh.activeTexture.set(Ch.TEXTURE0),_d.imageAtlasTexture.bind(Ch.LINEAR,Ch.CLAMP_TO_EDGE),Md.updatePaintBuffers(ph);else if(cs&&(u||he.lineAtlas.dirty))Bh.activeTexture.set(Ch.TEXTURE0),he.lineAtlas.bind(Bh);else if(eh){const mr=qh.gradients[A.id];let Ur=mr.texture;if(A.gradientVersion!==mr.version){let Gn=256;if(A.stepInterpolant){const $s=g.getSource().maxzoom,el=Ed.canonical.z===$s?Math.ceil(1<<he.transform.maxZoom-Ed.canonical.z):1;Gn=o.clamp(o.nextPowerOfTwo(qh.maxLineLength/o.EXTENT*1024*el),256,Bh.maxTextureSize)}mr.gradient=o.renderColorRamp({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:Gn,image:mr.gradient||void 0,clips:qh.lineClipsArray}),mr.texture?mr.texture.update(mr.gradient):mr.texture=new $h(Bh,mr.gradient,Ch.RGBA),mr.version=A.gradientVersion,Ur=mr.texture}Bh.activeTexture.set(Ch.TEXTURE0),Ur.bind(A.stepInterpolant?Ch.NEAREST:Ch.LINEAR,Ch.CLAMP_TO_EDGE)}L.draw(Bh,Ch.TRIANGLES,Xr,he.stencilModeForClipping(Ed),as,Im.disabled,vt,E,A.id,qh.layoutVertexBuffer,qh.indexBuffer,qh.segments,A.paint,he.transform.zoom,Md,qh.layoutVertexBuffer2),ed=!1}},fill:function(he,g,A,X){const _e=A.paint.get("fill-color"),Ft=A.paint.get("fill-opacity");if(Ft.constantOr(1)===0)return;const Xr=he.colorModeForRenderPass(),as=A.paint.get("fill-pattern"),cs=he.opaquePassEnabledForLayer()&&!as.constantOr(1)&&_e.constantOr(o.Color.transparent).a===1&&Ft.constantOr(0)===1?"opaque":"translucent";if(he.renderPass===cs){const us=he.depthModeForSublayer(1,he.renderPass==="opaque"?lm.ReadWrite:lm.ReadOnly);dy(he,g,A,X,us,Xr,!1)}if(he.renderPass==="translucent"&&A.paint.get("fill-antialias")){const us=he.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,lm.ReadOnly);dy(he,g,A,X,us,Xr,!0)}},"fill-extrusion":function(he,g,A,X){const _e=A.paint.get("fill-extrusion-opacity");if(_e!==0&&he.renderPass==="translucent"){const Ft=new lm(he.context.gl.LEQUAL,lm.ReadWrite,he.depthRangeFor3D);if(_e!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))J_(he,g,A,X,Ft,Am.disabled,Hm.disabled),J_(he,g,A,X,Ft,he.stencilModeFor3D(),he.colorModeForRenderPass());else{const Xr=he.colorModeForRenderPass();J_(he,g,A,X,Ft,Am.disabled,Xr)}}},hillshade:function(he,g,A,X){if(he.renderPass!=="offscreen"&&he.renderPass!=="translucent")return;const _e=he.context,Ft=he.depthModeForSublayer(0,lm.ReadOnly),Xr=he.colorModeForRenderPass(),[as,cs]=he.renderPass==="translucent"?he.stencilConfigForOverlap(X):[{},X];for(const us of cs){const th=g.getTile(us);th.needsHillshadePrepare!==void 0&&th.needsHillshadePrepare&&he.renderPass==="offscreen"?Wy(he,th,A,Ft,Am.disabled,Xr):he.renderPass==="translucent"&&M0(he,us,th,A,Ft,as[us.overscaledZ],Xr)}_e.viewport.set([0,0,he.width,he.height])},raster:function(he,g,A,X){if(he.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!X.length)return;const _e=he.context,Ft=_e.gl,Xr=g.getSource(),as=he.useProgram("raster"),cs=he.colorModeForRenderPass(),[us,th]=Xr instanceof qd?[{},X]:he.stencilConfigForOverlap(X),eh=th[th.length-1].overscaledZ,ph=!he.options.moving;for(const Rh of th){const Bh=he.depthModeForSublayer(Rh.overscaledZ-eh,A.paint.get("raster-opacity")===1?lm.ReadWrite:lm.ReadOnly,Ft.LESS),Ch=g.getTile(Rh);Ch.registerFadeDuration(A.paint.get("raster-fade-duration"));const ed=g.findLoadedParent(Rh,0),Ed=L_(Ch,ed,g,A,he.transform,he.style.map.terrain);let _d,qh;const Md=A.paint.get("raster-resampling")==="nearest"?Ft.NEAREST:Ft.LINEAR;_e.activeTexture.set(Ft.TEXTURE0),Ch.texture.bind(Md,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST),_e.activeTexture.set(Ft.TEXTURE1),ed?(ed.texture.bind(Md,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST),_d=Math.pow(2,ed.tileID.overscaledZ-Ch.tileID.overscaledZ),qh=[Ch.tileID.canonical.x*_d%1,Ch.tileID.canonical.y*_d%1]):Ch.texture.bind(Md,Ft.CLAMP_TO_EDGE,Ft.LINEAR_MIPMAP_NEAREST);const Nd=he.style.map.terrain&&he.style.map.terrain.getTerrainData(Rh),L=Nd?Rh:null,u=L?L.posMatrix:he.transform.calculatePosMatrix(Rh.toUnwrapped(),ph),E=j0(u,qh||[0,0],_d||1,Ed,A);Xr instanceof qd?as.draw(_e,Ft.TRIANGLES,Bh,Am.disabled,cs,Im.disabled,E,Nd,A.id,Xr.boundsBuffer,he.quadTriangleIndexBuffer,Xr.boundsSegments):as.draw(_e,Ft.TRIANGLES,Bh,us[Rh.overscaledZ],cs,Im.disabled,E,Nd,A.id,he.rasterBoundsBuffer,he.quadTriangleIndexBuffer,he.rasterBoundsSegments)}},background:function(he,g,A,X){const _e=A.paint.get("background-color"),Ft=A.paint.get("background-opacity");if(Ft===0)return;const Xr=he.context,as=Xr.gl,cs=he.transform,us=cs.tileSize,th=A.paint.get("background-pattern");if(he.isPatternMissing(th))return;const eh=!th&&_e.a===1&&Ft===1&&he.opaquePassEnabledForLayer()?"opaque":"translucent";if(he.renderPass!==eh)return;const ph=Am.disabled,Rh=he.depthModeForSublayer(0,eh==="opaque"?lm.ReadWrite:lm.ReadOnly),Bh=he.colorModeForRenderPass(),Ch=he.useProgram(th?"backgroundPattern":"background"),ed=X||cs.coveringTiles({tileSize:us,terrain:he.style.map.terrain});th&&(Xr.activeTexture.set(as.TEXTURE0),he.imageManager.bind(he.context));const Ed=A.getCrossfadeParameters();for(const _d of ed){const qh=X?_d.posMatrix:he.transform.calculatePosMatrix(_d.toUnwrapped()),Md=th?P_(qh,Ft,he,th,{tileID:_d,tileSize:us},Ed):G_(qh,Ft,_e),Nd=he.style.map.terrain&&he.style.map.terrain.getTerrainData(_d);Ch.draw(Xr,as.TRIANGLES,Rh,ph,Bh,Im.disabled,Md,Nd,A.id,he.tileExtentBuffer,he.quadTriangleIndexBuffer,he.tileExtentSegments)}},debug:function(he,g,A){for(let X=0;X<A.length;X++)qm(he,g,A[X])},custom:function(he,g,A){const X=he.context,_e=A.implementation;if(he.renderPass==="offscreen"){const Ft=_e.prerender;Ft&&(he.setCustomLayerDefaults(),X.setColorMode(he.colorModeForRenderPass()),Ft.call(_e,X.gl,he.transform.customLayerMatrix()),X.setDirty(),he.setBaseState())}else if(he.renderPass==="translucent"){he.setCustomLayerDefaults(),X.setColorMode(he.colorModeForRenderPass()),X.setStencilMode(Am.disabled);const Ft=_e.renderingMode==="3d"?new lm(he.context.gl.LEQUAL,lm.ReadWrite,he.depthRangeFor3D):he.depthModeForSublayer(0,lm.ReadOnly);X.setDepthMode(Ft),_e.render(X.gl,he.transform.customLayerMatrix()),X.setDirty(),he.setBaseState(),X.bindFramebuffer.set(null)}}};class Pm{constructor(g,A){this.context=new Ky(g),this.transform=A,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=$d.maxUnderzooming+$d.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new mm,this.gpuTimers={}}resize(g,A,X){if(this.width=g*X,this.height=A*X,this.pixelRatio=X,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _e of this.style._order)this.style._layers[_e].resize()}setup(){const g=this.context,A=new o.PosArray;A.emplaceBack(0,0),A.emplaceBack(o.EXTENT,0),A.emplaceBack(0,o.EXTENT),A.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=g.createVertexBuffer(A,Wh.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const X=new o.PosArray;X.emplaceBack(0,0),X.emplaceBack(o.EXTENT,0),X.emplaceBack(0,o.EXTENT),X.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=g.createVertexBuffer(X,Wh.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _e=new o.RasterBoundsArray;_e.emplaceBack(0,0,0,0),_e.emplaceBack(o.EXTENT,0,o.EXTENT,0),_e.emplaceBack(0,o.EXTENT,0,o.EXTENT),_e.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=g.createVertexBuffer(_e,Uf.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const Ft=new o.PosArray;Ft.emplaceBack(0,0),Ft.emplaceBack(1,0),Ft.emplaceBack(0,1),Ft.emplaceBack(1,1),this.viewportBuffer=g.createVertexBuffer(Ft,Wh.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const Xr=new o.LineStripIndexArray;Xr.emplaceBack(0),Xr.emplaceBack(1),Xr.emplaceBack(3),Xr.emplaceBack(2),Xr.emplaceBack(0),this.tileBorderIndexBuffer=g.createIndexBuffer(Xr);const as=new o.TriangleIndexArray;as.emplaceBack(0,1,2),as.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=g.createIndexBuffer(as),this.emptyTexture=new $h(g,{width:1,height:1,data:new Uint8Array([0,0,0,0])},g.gl.RGBA);const cs=this.context.gl;this.stencilClearMode=new Am({func:cs.ALWAYS,mask:0},0,255,cs.ZERO,cs.ZERO,cs.ZERO)}clearStencil(){const g=this.context,A=g.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const X=o.create();o.ortho(X,0,this.width,this.height,0,0,1),o.scale(X,X,[A.drawingBufferWidth,A.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(g,A.TRIANGLES,lm.disabled,this.stencilClearMode,Hm.disabled,Im.disabled,jm(X),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(g,A){if(this.currentStencilSource===g.source||!g.isTileClipped()||!A||!A.length)return;this.currentStencilSource=g.source;const X=this.context,_e=X.gl;this.nextStencilID+A.length>256&&this.clearStencil(),X.setColorMode(Hm.disabled),X.setDepthMode(lm.disabled);const Ft=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Xr of A){const as=this._tileClippingMaskIDs[Xr.key]=this.nextStencilID++,cs=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Xr);Ft.draw(X,_e.TRIANGLES,lm.disabled,new Am({func:_e.ALWAYS,mask:0},as,255,_e.KEEP,_e.KEEP,_e.REPLACE),Hm.disabled,Im.disabled,jm(Xr.posMatrix),cs,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const g=this.nextStencilID++,A=this.context.gl;return new Am({func:A.NOTEQUAL,mask:255},g,255,A.KEEP,A.KEEP,A.REPLACE)}stencilModeForClipping(g){const A=this.context.gl;return new Am({func:A.EQUAL,mask:255},this._tileClippingMaskIDs[g.key],0,A.KEEP,A.KEEP,A.REPLACE)}stencilConfigForOverlap(g){const A=this.context.gl,X=g.sort((Xr,as)=>as.overscaledZ-Xr.overscaledZ),_e=X[X.length-1].overscaledZ,Ft=X[0].overscaledZ-_e+1;if(Ft>1){this.currentStencilSource=void 0,this.nextStencilID+Ft>256&&this.clearStencil();const Xr={};for(let as=0;as<Ft;as++)Xr[as+_e]=new Am({func:A.GEQUAL,mask:255},as+this.nextStencilID,255,A.KEEP,A.KEEP,A.REPLACE);return this.nextStencilID+=Ft,[Xr,X]}return[{[_e]:Am.disabled},X]}colorModeForRenderPass(){const g=this.context.gl;return this._showOverdrawInspector?new Hm([g.CONSTANT_COLOR,g.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hm.unblended:Hm.alphaBlended}depthModeForSublayer(g,A,X){if(!this.opaquePassEnabledForLayer())return lm.disabled;const _e=1-((1+this.currentLayer)*this.numSublayers+g)*this.depthEpsilon;return new lm(X||this.context.gl.LEQUAL,A,[_e,_e])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(g,A){this.style=g,this.options=A,this.lineAtlas=g.lineAtlas,this.imageManager=g.imageManager,this.glyphManager=g.glyphManager,this.symbolFadeChange=g.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const X=this.style._order,_e=this.style.sourceCaches,Ft={},Xr={},as={};for(const cs in _e){const us=_e[cs];us.used&&us.prepare(this.context),Ft[cs]=us.getVisibleCoordinates(),Xr[cs]=Ft[cs].slice().reverse(),as[cs]=us.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let cs=0;cs<X.length;cs++)if(this.style._layers[X[cs]].is3D()){this.opaquePassCutoff=cs;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const cs=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||cs.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(us,th){const eh=us.context,ph=eh.gl,Rh=Hm.unblended,Bh=new lm(ph.LEQUAL,lm.ReadWrite,[0,1]),Ch=th.getTerrainMesh(),ed=th.sourceCache.getRenderableTiles(),Ed=us.useProgram("terrainDepth");eh.bindFramebuffer.set(th.getFramebuffer("depth").framebuffer),eh.viewport.set([0,0,us.width/devicePixelRatio,us.height/devicePixelRatio]),eh.clear({color:o.Color.transparent,depth:1});for(const _d of ed){const qh=th.getTerrainData(_d.tileID),Md={u_matrix:us.transform.calculatePosMatrix(_d.tileID.toUnwrapped()),u_ele_delta:th.getMeshFrameDelta(us.transform.zoom)};Ed.draw(eh,ph.TRIANGLES,Bh,Am.disabled,Rh,Im.backCCW,Md,qh,"terrain",Ch.vertexBuffer,Ch.indexBuffer,Ch.segments)}eh.bindFramebuffer.set(null),eh.viewport.set([0,0,us.width,us.height])}(this,this.style.map.terrain),function(us,th){const eh=us.context,ph=eh.gl,Rh=Hm.unblended,Bh=new lm(ph.LEQUAL,lm.ReadWrite,[0,1]),Ch=th.getTerrainMesh(),ed=th.getCoordsTexture(),Ed=th.sourceCache.getRenderableTiles(),_d=us.useProgram("terrainCoords");eh.bindFramebuffer.set(th.getFramebuffer("coords").framebuffer),eh.viewport.set([0,0,us.width/devicePixelRatio,us.height/devicePixelRatio]),eh.clear({color:o.Color.transparent,depth:1}),th.coordsIndex=[];for(const qh of Ed){const Md=th.getTerrainData(qh.tileID);eh.activeTexture.set(ph.TEXTURE0),ph.bindTexture(ph.TEXTURE_2D,ed.texture);const Nd={u_matrix:us.transform.calculatePosMatrix(qh.tileID.toUnwrapped()),u_terrain_coords_id:(255-th.coordsIndex.length)/255,u_texture:0,u_ele_delta:th.getMeshFrameDelta(us.transform.zoom)};_d.draw(eh,ph.TRIANGLES,Bh,Am.disabled,Rh,Im.backCCW,Nd,Md,"terrain",Ch.vertexBuffer,Ch.indexBuffer,Ch.segments),th.coordsIndex.push(qh.tileID.key)}eh.bindFramebuffer.set(null),eh.viewport.set([0,0,us.width,us.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const cs of X){const us=this.style._layers[cs];if(!us.hasOffscreenPass()||us.isHidden(this.transform.zoom))continue;const th=Xr[us.source];(us.type==="custom"||th.length)&&this.renderLayer(this,_e[us.source],us,th)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:A.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=A.showOverdrawInspector,this.depthRangeFor3D=[0,1-(g._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=X.length-1;this.currentLayer>=0;this.currentLayer--){const cs=this.style._layers[X[this.currentLayer]],us=_e[cs.source],th=Ft[cs.source];this._renderTileClippingMasks(cs,th),this.renderLayer(this,us,cs,th)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const cs=this.style._layers[X[this.currentLayer]],us=_e[cs.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(cs))continue;const th=(cs.type==="symbol"?as:Xr)[cs.source];this._renderTileClippingMasks(cs,Ft[cs.source]),this.renderLayer(this,us,cs,th)}if(this.options.showTileBoundaries){const cs=function(us,th){let eh=null;const ph=Object.values(us._layers).flatMap(ed=>ed.source&&!ed.isHidden(th)?[us.sourceCaches[ed.source]]:[]),Rh=ph.filter(ed=>ed.getSource().type==="vector"),Bh=ph.filter(ed=>ed.getSource().type!=="vector"),Ch=ed=>{(!eh||eh.getSource().maxzoom<ed.getSource().maxzoom)&&(eh=ed)};return Rh.forEach(ed=>Ch(ed)),eh||Bh.forEach(ed=>Ch(ed)),eh}(this.style,this.transform.zoom);cs&&Ag.debug(this,cs,cs.getVisibleCoordinates())}this.options.showPadding&&function(cs){const us=cs.transform.padding;Dp(cs,cs.transform.height-(us.top||0),3,__),Dp(cs,us.bottom||0,3,c_),Fm(cs,us.left||0,3,bd),Fm(cs,cs.transform.width-(us.right||0),3,mf);const th=cs.transform.centerPoint;(function(eh,ph,Rh,Bh){om(eh,ph-1,Rh-10,2,20,Bh),om(eh,ph-10,Rh-1,20,2,Bh)})(cs,th.x,cs.transform.height-th.y,np)}(this),this.context.setDefault()}renderLayer(g,A,X,_e){X.isHidden(this.transform.zoom)||(X.type==="background"||X.type==="custom"||(_e||[]).length)&&(this.id=X.id,this.gpuTimingStart(X),Ag[X.type](g,A,X,_e,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(g){if(!this.options.gpuTiming)return;const A=this.context.extTimerQuery;let X=this.gpuTimers[g.id];X||(X=this.gpuTimers[g.id]={calls:0,cpuTime:0,query:A.createQueryEXT()}),X.calls++,A.beginQueryEXT(A.TIME_ELAPSED_EXT,X.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;g.endQueryEXT(g.TIME_ELAPSED_EXT)}collectGpuTimers(){const g=this.gpuTimers;return this.gpuTimers={},g}queryGpuTimers(g){const A={};for(const X in g){const _e=g[X],Ft=this.context.extTimerQuery,Xr=Ft.getQueryObjectEXT(_e.query,Ft.QUERY_RESULT_EXT)/1e6;Ft.deleteQueryEXT(_e.query),A[X]=Xr}return A}translatePosMatrix(g,A,X,_e,Ft){if(!X[0]&&!X[1])return g;const Xr=Ft?_e==="map"?this.transform.angle:0:_e==="viewport"?-this.transform.angle:0;if(Xr){const us=Math.sin(Xr),th=Math.cos(Xr);X=[X[0]*th-X[1]*us,X[0]*us+X[1]*th]}const as=[Ft?X[0]:Fd(A,X[0],this.transform.zoom),Ft?X[1]:Fd(A,X[1],this.transform.zoom),0],cs=new Float32Array(16);return o.translate(cs,g,as),cs}saveTileTexture(g){const A=this._tileTextures[g.size[0]];A?A.push(g):this._tileTextures[g.size[0]]=[g]}getTileTexture(g){const A=this._tileTextures[g];return A&&A.length>0?A.pop():null}isPatternMissing(g){if(!g)return!1;if(!g.from||!g.to)return!0;const A=this.imageManager.getPattern(g.from.toString()),X=this.imageManager.getPattern(g.to.toString());return!A||!X}useProgram(g,A){this.cache=this.cache||{};const X=g+(A?A.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[X]||(this.cache[X]=new op(this.context,g,$f[g],A,Sy[g],this._showOverdrawInspector,this.style.map.terrain)),this.cache[X]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const g=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(g.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new $h(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class tp{constructor(g,A){this.points=g,this.planes=A}static fromInvProjectionMatrix(g,A,X){const _e=Math.pow(2,X),Ft=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(as=>{const cs=1/(as=o.transformMat4([],as,g))[3]/A*_e;return o.mul$1(as,as,[cs,cs,1/as[3],cs])}),Xr=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(as=>{const cs=function(ph,Rh){var Bh=Rh[0],Ch=Rh[1],ed=Rh[2],Ed=Bh*Bh+Ch*Ch+ed*ed;return Ed>0&&(Ed=1/Math.sqrt(Ed)),ph[0]=Rh[0]*Ed,ph[1]=Rh[1]*Ed,ph[2]=Rh[2]*Ed,ph}([],function(ph,Rh,Bh){var Ch=Rh[0],ed=Rh[1],Ed=Rh[2],_d=Bh[0],qh=Bh[1],Md=Bh[2];return ph[0]=ed*Md-Ed*qh,ph[1]=Ed*_d-Ch*Md,ph[2]=Ch*qh-ed*_d,ph}([],oh([],Ft[as[0]],Ft[as[1]]),oh([],Ft[as[2]],Ft[as[1]]))),us=-((th=cs)[0]*(eh=Ft[as[1]])[0]+th[1]*eh[1]+th[2]*eh[2]);var th,eh;return cs.concat(us)});return new tp(Ft,Xr)}}class $g{constructor(g,A){this.min=g,this.max=A,this.center=function(X,_e,Ft){return X[0]=.5*_e[0],X[1]=.5*_e[1],X[2]=.5*_e[2],X}([],function(X,_e,Ft){return X[0]=_e[0]+Ft[0],X[1]=_e[1]+Ft[1],X[2]=_e[2]+Ft[2],X}([],this.min,this.max))}quadrant(g){const A=[g%2==0,g<2],X=Zu(this.min),_e=Zu(this.max);for(let Ft=0;Ft<A.length;Ft++)X[Ft]=A[Ft]?this.min[Ft]:this.center[Ft],_e[Ft]=A[Ft]?this.center[Ft]:this.max[Ft];return _e[2]=this.max[2],new $g(X,_e)}distanceX(g){return Math.max(Math.min(this.max[0],g[0]),this.min[0])-g[0]}distanceY(g){return Math.max(Math.min(this.max[1],g[1]),this.min[1])-g[1]}intersects(g){const A=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let X=!0;for(let _e=0;_e<g.planes.length;_e++){const Ft=g.planes[_e];let Xr=0;for(let as=0;as<A.length;as++)o.dot(Ft,A[as])>=0&&Xr++;if(Xr===0)return 0;Xr!==A.length&&(X=!1)}if(X)return 2;for(let _e=0;_e<3;_e++){let Ft=Number.MAX_VALUE,Xr=-Number.MAX_VALUE;for(let as=0;as<g.points.length;as++){const cs=g.points[as][_e]-this.min[_e];Ft=Math.min(Ft,cs),Xr=Math.max(Xr,cs)}if(Xr<0||Ft>this.max[_e]-this.min[_e])return 0}return 1}}class Bg{constructor(g=0,A=0,X=0,_e=0){if(isNaN(g)||g<0||isNaN(A)||A<0||isNaN(X)||X<0||isNaN(_e)||_e<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=g,this.bottom=A,this.left=X,this.right=_e}interpolate(g,A,X){return A.top!=null&&g.top!=null&&(this.top=o.number(g.top,A.top,X)),A.bottom!=null&&g.bottom!=null&&(this.bottom=o.number(g.bottom,A.bottom,X)),A.left!=null&&g.left!=null&&(this.left=o.number(g.left,A.left,X)),A.right!=null&&g.right!=null&&(this.right=o.number(g.right,A.right,X)),this}getCenter(g,A){const X=o.clamp((this.left+g-this.right)/2,0,g),_e=o.clamp((this.top+A-this.bottom)/2,0,A);return new o.pointGeometry(X,_e)}equals(g){return this.top===g.top&&this.bottom===g.bottom&&this.left===g.left&&this.right===g.right}clone(){return new Bg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Zm{constructor(g,A,X,_e,Ft){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=Ft===void 0||!!Ft,this._minZoom=g||0,this._maxZoom=A||22,this._minPitch=X??0,this._maxPitch=_e??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Bg,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const g=new Zm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return g.tileSize=this.tileSize,g.latRange=this.latRange,g.width=this.width,g.height=this.height,g._center=this._center,g._elevation=this._elevation,g.zoom=this.zoom,g.angle=this.angle,g._fov=this._fov,g._pitch=this._pitch,g._unmodified=this._unmodified,g._edgeInsets=this._edgeInsets.clone(),g._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(g){this._minZoom!==g&&(this._minZoom=g,this.zoom=Math.max(this.zoom,g))}get maxZoom(){return this._maxZoom}set maxZoom(g){this._maxZoom!==g&&(this._maxZoom=g,this.zoom=Math.min(this.zoom,g))}get minPitch(){return this._minPitch}set minPitch(g){this._minPitch!==g&&(this._minPitch=g,this.pitch=Math.max(this.pitch,g))}get maxPitch(){return this._maxPitch}set maxPitch(g){this._maxPitch!==g&&(this._maxPitch=g,this.pitch=Math.min(this.pitch,g))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(g){g===void 0?g=!0:g===null&&(g=!1),this._renderWorldCopies=g}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(g){const A=-o.wrap(g,-180,180)*Math.PI/180;this.angle!==A&&(this._unmodified=!1,this.angle=A,this._calcMatrices(),this.rotationMatrix=function(){var X=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(X[1]=0,X[2]=0),X[0]=1,X[3]=1,X}(),function(X,_e,Ft){var Xr=_e[0],as=_e[1],cs=_e[2],us=_e[3],th=Math.sin(Ft),eh=Math.cos(Ft);X[0]=Xr*eh+cs*th,X[1]=as*eh+us*th,X[2]=Xr*-th+cs*eh,X[3]=as*-th+us*eh}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(g){const A=o.clamp(g,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==A&&(this._unmodified=!1,this._pitch=A,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(g){g=Math.max(.01,Math.min(60,g)),this._fov!==g&&(this._unmodified=!1,this._fov=g/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(g){const A=Math.min(Math.max(g,this.minZoom),this.maxZoom);this._zoom!==A&&(this._unmodified=!1,this._zoom=A,this.tileZoom=Math.max(0,Math.floor(A)),this.scale=this.zoomScale(A),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(g){g.lat===this._center.lat&&g.lng===this._center.lng||(this._unmodified=!1,this._center=g,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(g){g!==this._elevation&&(this._elevation=g,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(g){this._edgeInsets.equals(g)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,g,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(g){return this._edgeInsets.equals(g)}interpolatePadding(g,A,X){this._unmodified=!1,this._edgeInsets.interpolate(g,A,X),this._constrain(),this._calcMatrices()}coveringZoomLevel(g){const A=(g.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/g.tileSize));return Math.max(0,A)}getVisibleUnwrappedCoordinates(g){const A=[new o.UnwrappedTileID(0,g)];if(this._renderWorldCopies){const X=this.pointCoordinate(new o.pointGeometry(0,0)),_e=this.pointCoordinate(new o.pointGeometry(this.width,0)),Ft=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),Xr=this.pointCoordinate(new o.pointGeometry(0,this.height)),as=Math.floor(Math.min(X.x,_e.x,Ft.x,Xr.x)),cs=Math.floor(Math.max(X.x,_e.x,Ft.x,Xr.x)),us=1;for(let th=as-us;th<=cs+us;th++)th!==0&&A.push(new o.UnwrappedTileID(th,g))}return A}coveringTiles(g){var A,X;let _e=this.coveringZoomLevel(g);const Ft=_e;if(g.minzoom!==void 0&&_e<g.minzoom)return[];g.maxzoom!==void 0&&_e>g.maxzoom&&(_e=g.maxzoom);const Xr=this.pointCoordinate(this.getCameraPoint()),as=o.MercatorCoordinate.fromLngLat(this.center),cs=Math.pow(2,_e),us=[cs*Xr.x,cs*Xr.y,0],th=[cs*as.x,cs*as.y,0],eh=tp.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_e);let ph=g.minzoom||0;!g.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ph=_e);const Rh=g.terrain?2/Math.min(this.tileSize,g.tileSize)*this.tileSize:3,Bh=qh=>({aabb:new $g([qh*cs,0,0],[(qh+1)*cs,cs,0]),zoom:0,x:0,y:0,wrap:qh,fullyVisible:!1}),Ch=[],ed=[],Ed=_e,_d=g.reparseOverscaled?Ft:_e;if(this._renderWorldCopies)for(let qh=1;qh<=3;qh++)Ch.push(Bh(-qh)),Ch.push(Bh(qh));for(Ch.push(Bh(0));Ch.length>0;){const qh=Ch.pop(),Md=qh.x,Nd=qh.y;let L=qh.fullyVisible;if(!L){const vt=qh.aabb.intersects(eh);if(vt===0)continue;L=vt===2}const u=g.terrain?us:th,E=qh.aabb.distanceX(u),B=qh.aabb.distanceY(u),Y=Math.max(Math.abs(E),Math.abs(B));if(qh.zoom===Ed||Y>Rh+(1<<Ed-qh.zoom)-2&&qh.zoom>=ph){const vt=Ed-qh.zoom,mr=us[0]-.5-(Md<<vt),Ur=us[1]-.5-(Nd<<vt);ed.push({tileID:new o.OverscaledTileID(qh.zoom===Ed?_d:qh.zoom,qh.wrap,qh.zoom,Md,Nd),distanceSq:hh([th[0]-.5-Md,th[1]-.5-Nd]),tileDistanceToCamera:Math.sqrt(mr*mr+Ur*Ur)})}else for(let vt=0;vt<4;vt++){const mr=(Md<<1)+vt%2,Ur=(Nd<<1)+(vt>>1),Gn=qh.zoom+1;let $s=qh.aabb.quadrant(vt);if(g.terrain){const el=new o.OverscaledTileID(Gn,qh.wrap,Gn,mr,Ur),Wu=g.terrain.getMinMaxElevation(el),dh=(A=Wu.minElevation)!==null&&A!==void 0?A:this.elevation,gh=(X=Wu.maxElevation)!==null&&X!==void 0?X:this.elevation;$s=new $g([$s.min[0],$s.min[1],dh],[$s.max[0],$s.max[1],gh])}Ch.push({aabb:$s,zoom:Gn,x:mr,y:Ur,wrap:qh.wrap,fullyVisible:L})}}return ed.sort((qh,Md)=>qh.distanceSq-Md.distanceSq).map(qh=>qh.tileID)}resize(g,A){this.width=g,this.height=A,this.pixelsToGLUnits=[2/g,-2/A],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(g){return Math.pow(2,g)}scaleZoom(g){return Math.log(g)/Math.LN2}project(g){const A=o.clamp(g.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(g.lng)*this.worldSize,o.mercatorYfromLat(A)*this.worldSize)}unproject(g){return new o.MercatorCoordinate(g.x/this.worldSize,g.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(g){this.freezeElevation||(this.elevation=g?this.getElevation(this._center,g):0)}getElevation(g,A){const X=o.MercatorCoordinate.fromLngLat(g),_e=(1<<this.tileZoom)*o.EXTENT,Ft=X.x*_e,Xr=X.y*_e,as=Math.floor(Ft/o.EXTENT),cs=Math.floor(Xr/o.EXTENT),us=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,as,cs);return A.getElevation(us,Ft%o.EXTENT,Xr%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(g){const A=this.pointLocation(this.centerPoint,g),X=this.getElevation(A,g);if(!(this.elevation-X))return;const _e=this.getCameraPosition(),Ft=o.MercatorCoordinate.fromLngLat(_e.lngLat,_e.altitude),Xr=o.MercatorCoordinate.fromLngLat(A,X),as=Ft.x-Xr.x,cs=Ft.y-Xr.y,us=Ft.z-Xr.z,th=Math.sqrt(as*as+cs*cs+us*us),eh=this.scaleZoom(this.cameraToCenterDistance/th/this.tileSize);this._elevation=X,this._center=A,this.zoom=eh}setLocationAtPoint(g,A){const X=this.pointCoordinate(A),_e=this.pointCoordinate(this.centerPoint),Ft=this.locationCoordinate(g),Xr=new o.MercatorCoordinate(Ft.x-(X.x-_e.x),Ft.y-(X.y-_e.y));this.center=this.coordinateLocation(Xr),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(g,A){return A?this.coordinatePoint(this.locationCoordinate(g),this.getElevation(g,A),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(g))}pointLocation(g,A){return this.coordinateLocation(this.pointCoordinate(g,A))}locationCoordinate(g){return o.MercatorCoordinate.fromLngLat(g)}coordinateLocation(g){return g&&g.toLngLat()}pointCoordinate(g,A){if(A){const ph=A.pointCoordinate(g);if(ph!=null)return ph}const X=[g.x,g.y,0,1],_e=[g.x,g.y,1,1];o.transformMat4(X,X,this.pixelMatrixInverse),o.transformMat4(_e,_e,this.pixelMatrixInverse);const Ft=X[3],Xr=_e[3],as=X[1]/Ft,cs=_e[1]/Xr,us=X[2]/Ft,th=_e[2]/Xr,eh=us===th?0:(0-us)/(th-us);return new o.MercatorCoordinate(o.number(X[0]/Ft,_e[0]/Xr,eh)/this.worldSize,o.number(as,cs,eh)/this.worldSize)}coordinatePoint(g,A=0,X=this.pixelMatrix){const _e=[g.x*this.worldSize,g.y*this.worldSize,A,1];return o.transformMat4(_e,_e,X),new o.pointGeometry(_e[0]/_e[3],_e[1]/_e[3])}getBounds(){const g=Math.max(0,this.height/2-this.getHorizon());return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,g))).extend(this.pointLocation(new o.pointGeometry(this.width,g))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(g){g?(this.lngRange=[g.getWest(),g.getEast()],this.latRange=[g.getSouth(),g.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(g,A=!1){const X=g.key,_e=A?this._alignedPosMatrixCache:this._posMatrixCache;if(_e[X])return _e[X];const Ft=g.canonical,Xr=this.worldSize/this.zoomScale(Ft.z),as=Ft.x+Math.pow(2,Ft.z)*g.wrap,cs=o.identity(new Float64Array(16));return o.translate(cs,cs,[as*Xr,Ft.y*Xr,0]),o.scale(cs,cs,[Xr/o.EXTENT,Xr/o.EXTENT,1]),o.multiply(cs,A?this.alignedProjMatrix:this.projMatrix,cs),_e[X]=new Float32Array(cs),_e[X]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let g,A,X,_e,Ft=-90,Xr=90,as=-180,cs=180;const us=this.size,th=this._unmodified;if(this.latRange){const Rh=this.latRange;Ft=o.mercatorYfromLat(Rh[1])*this.worldSize,Xr=o.mercatorYfromLat(Rh[0])*this.worldSize,g=Xr-Ft<us.y?us.y/(Xr-Ft):0}if(this.lngRange){const Rh=this.lngRange;as=o.wrap(o.mercatorXfromLng(Rh[0])*this.worldSize,0,this.worldSize),cs=o.wrap(o.mercatorXfromLng(Rh[1])*this.worldSize,0,this.worldSize),cs<as&&(cs+=this.worldSize),A=cs-as<us.x?us.x/(cs-as):0}const eh=this.point,ph=Math.max(A||0,g||0);if(ph)return this.center=this.unproject(new o.pointGeometry(A?(cs+as)/2:eh.x,g?(Xr+Ft)/2:eh.y)),this.zoom+=this.scaleZoom(ph),this._unmodified=th,void(this._constraining=!1);if(this.latRange){const Rh=eh.y,Bh=us.y/2;Rh-Bh<Ft&&(_e=Ft+Bh),Rh+Bh>Xr&&(_e=Xr-Bh)}if(this.lngRange){const Rh=(as+cs)/2,Bh=o.wrap(eh.x,Rh-this.worldSize/2,Rh+this.worldSize/2),Ch=us.x/2;Bh-Ch<as&&(X=as+Ch),Bh+Ch>cs&&(X=cs-Ch)}X===void 0&&_e===void 0||(this.center=this.unproject(new o.pointGeometry(X!==void 0?X:eh.x,_e!==void 0?_e:eh.y)).wrap()),this._unmodified=th,this._constraining=!1}_calcMatrices(){if(!this.height)return;const g=this.centerOffset,A=this.point.x,X=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _e=o.identity(new Float64Array(16));o.scale(_e,_e,[this.width/2,-this.height/2,1]),o.translate(_e,_e,[1,-1,0]),this.labelPlaneMatrix=_e,_e=o.identity(new Float64Array(16)),o.scale(_e,_e,[1,-1,1]),o.translate(_e,_e,[-1,-1,0]),o.scale(_e,_e,[2/this.width,2/this.height,1]),this.glCoordMatrix=_e,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const Ft=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,Xr=Math.PI/2+this._pitch,as=this._fov*(.5+g.y/this.height),cs=Math.sin(as)*Ft/Math.sin(o.clamp(Math.PI-Xr-as,.01,Math.PI-.01)),us=this.getHorizon(),th=2*Math.atan(us/this.cameraToCenterDistance)*(.5+g.y/(2*us)),eh=Math.sin(th)*Ft/Math.sin(o.clamp(Math.PI-Xr-th,.01,Math.PI-.01)),ph=Math.min(cs,eh),Rh=1.01*(Math.cos(Math.PI/2-this._pitch)*ph+Ft),Bh=this.height/50;_e=new Float64Array(16),o.perspective(_e,this._fov,this.width/this.height,Bh,Rh),_e[8]=2*-g.x/this.width,_e[9]=2*g.y/this.height,o.scale(_e,_e,[1,-1,1]),o.translate(_e,_e,[0,0,-this.cameraToCenterDistance]),o.rotateX(_e,_e,this._pitch),o.rotateZ(_e,_e,this.angle),o.translate(_e,_e,[-A,-X,0]),this.mercatorMatrix=o.scale([],_e,[this.worldSize,this.worldSize,this.worldSize]),o.scale(_e,_e,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,_e),o.translate(_e,_e,[0,0,-this.elevation]),this.projMatrix=_e,this.invProjMatrix=o.invert([],_e),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,_e);const Ch=this.width%2/2,ed=this.height%2/2,Ed=Math.cos(this.angle),_d=Math.sin(this.angle),qh=A-Math.round(A)+Ed*Ch+_d*ed,Md=X-Math.round(X)+Ed*ed+_d*Ch,Nd=new Float64Array(_e);if(o.translate(Nd,Nd,[qh>.5?qh-1:qh,Md>.5?Md-1:Md,0]),this.alignedProjMatrix=Nd,_e=o.invert(new Float64Array(16),this.pixelMatrix),!_e)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_e,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const g=this.pointCoordinate(new o.pointGeometry(0,0)),A=[g.x*this.worldSize,g.y*this.worldSize,0,1];return o.transformMat4(A,A,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const g=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,g))}getCameraQueryGeometry(g){const A=this.getCameraPoint();if(g.length===1)return[g[0],A];{let X=A.x,_e=A.y,Ft=A.x,Xr=A.y;for(const as of g)X=Math.min(X,as.x),_e=Math.min(_e,as.y),Ft=Math.max(Ft,as.x),Xr=Math.max(Xr,as.y);return[new o.pointGeometry(X,_e),new o.pointGeometry(Ft,_e),new o.pointGeometry(Ft,Xr),new o.pointGeometry(X,Xr),new o.pointGeometry(X,_e)]}}}class R_{constructor(g){this._hashName=g&&encodeURIComponent(g),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(A,X){let _e=!1,Ft=null;const Xr=()=>{Ft=null,_e&&(A(),Ft=setTimeout(Xr,300),_e=!1)};return()=>(_e=!0,Ft||Xr(),Ft)}(this._updateHashUnthrottled.bind(this))}addTo(g){return this._map=g,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(g){const A=this._map.getCenter(),X=Math.round(100*this._map.getZoom())/100,_e=Math.ceil((X*Math.LN2+Math.log(512/360/.5))/Math.LN10),Ft=Math.pow(10,_e),Xr=Math.round(A.lng*Ft)/Ft,as=Math.round(A.lat*Ft)/Ft,cs=this._map.getBearing(),us=this._map.getPitch();let th="";if(th+=g?`/${Xr}/${as}/${X}`:`${X}/${as}/${Xr}`,(cs||us)&&(th+="/"+Math.round(10*cs)/10),us&&(th+=`/${Math.round(us)}`),this._hashName){const eh=this._hashName;let ph=!1;const Rh=window.location.hash.slice(1).split("&").map(Bh=>{const Ch=Bh.split("=")[0];return Ch===eh?(ph=!0,`${Ch}=${th}`):Bh}).filter(Bh=>Bh);return ph||Rh.push(`${eh}=${th}`),`#${Rh.join("&")}`}return`#${th}`}_getCurrentHash(){const g=window.location.hash.replace("#","");if(this._hashName){let A;return g.split("&").map(X=>X.split("=")).forEach(X=>{X[0]===this._hashName&&(A=X)}),(A&&A[1]||"").split("/")}return g.split("/")}_onHashChange(){const g=this._getCurrentHash();if(g.length>=3&&!g.some(A=>isNaN(A))){const A=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:A,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const g=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,g)}catch{}}}const ip={linearity:.3,easing:o.bezier(0,0,.3,1)},Yy=o.extend({deceleration:2500,maxSpeed:1400},ip),O_=o.extend({deceleration:20,maxSpeed:1400},ip),A0=o.extend({deceleration:1e3,maxSpeed:360},ip),W0=o.extend({deceleration:1e3,maxSpeed:90},ip);class zv{constructor(g){this._map=g,this.clear()}clear(){this._inertiaBuffer=[]}record(g){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:g})}_drainInertiaBuffer(){const g=this._inertiaBuffer,A=o.exported.now();for(;g.length>0&&A-g[0].time>160;)g.shift()}_onMoveEnd(g){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const A={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:Ft}of this._inertiaBuffer)A.zoom+=Ft.zoomDelta||0,A.bearing+=Ft.bearingDelta||0,A.pitch+=Ft.pitchDelta||0,Ft.panDelta&&A.pan._add(Ft.panDelta),Ft.around&&(A.around=Ft.around),Ft.pinchAround&&(A.pinchAround=Ft.pinchAround);const X=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_e={};if(A.pan.mag()){const Ft=xm(A.pan.mag(),X,o.extend({},Yy,g||{}));_e.offset=A.pan.mult(Ft.amount/A.pan.mag()),_e.center=this._map.transform.center,P0(_e,Ft)}if(A.zoom){const Ft=xm(A.zoom,X,O_);_e.zoom=this._map.transform.zoom+Ft.amount,P0(_e,Ft)}if(A.bearing){const Ft=xm(A.bearing,X,A0);_e.bearing=this._map.transform.bearing+o.clamp(Ft.amount,-179,179),P0(_e,Ft)}if(A.pitch){const Ft=xm(A.pitch,X,W0);_e.pitch=this._map.transform.pitch+Ft.amount,P0(_e,Ft)}if(_e.zoom||_e.bearing){const Ft=A.pinchAround===void 0?A.around:A.pinchAround;_e.around=Ft?this._map.unproject(Ft):this._map.getCenter()}return this.clear(),o.extend(_e,{noMoveStart:!0})}}function P0(he,g){(!he.duration||he.duration<g.duration)&&(he.duration=g.duration,he.easing=g.easing)}function xm(he,g,A){const{maxSpeed:X,linearity:_e,deceleration:Ft}=A,Xr=o.clamp(he*_e/(g/1e3),-X,X),as=Math.abs(Xr)/(Ft*_e);return{easing:A.easing,duration:1e3*as,amount:Xr*(as/2)}}class am extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,X,_e={}){const Ft=ze.mousePos(A.getCanvasContainer(),X),Xr=A.unproject(Ft);super(g,o.extend({point:Ft,lngLat:Xr,originalEvent:X},_e)),this._defaultPrevented=!1,this.target=A}}class y_ extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,X){const _e=g==="touchend"?X.changedTouches:X.touches,Ft=ze.touchPos(A.getCanvasContainer(),_e),Xr=Ft.map(cs=>A.unproject(cs)),as=Ft.reduce((cs,us,th,eh)=>cs.add(us.div(eh.length)),new o.pointGeometry(0,0));super(g,{points:Ft,point:as,lngLats:Xr,lngLat:A.unproject(as),originalEvent:X}),this._defaultPrevented=!1}}class Vg extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,X){super(g,{originalEvent:X}),this._defaultPrevented=!1}}class h0{constructor(g,A){this._map=g,this._clickTolerance=A.clickTolerance}reset(){delete this._mousedownPos}wheel(g){return this._firePreventable(new Vg(g.type,this._map,g))}mousedown(g,A){return this._mousedownPos=A,this._firePreventable(new am(g.type,this._map,g))}mouseup(g){this._map.fire(new am(g.type,this._map,g))}click(g,A){this._mousedownPos&&this._mousedownPos.dist(A)>=this._clickTolerance||this._map.fire(new am(g.type,this._map,g))}dblclick(g){return this._firePreventable(new am(g.type,this._map,g))}mouseover(g){this._map.fire(new am(g.type,this._map,g))}mouseout(g){this._map.fire(new am(g.type,this._map,g))}touchstart(g){return this._firePreventable(new y_(g.type,this._map,g))}touchmove(g){this._map.fire(new y_(g.type,this._map,g))}touchend(g){this._map.fire(new y_(g.type,this._map,g))}touchcancel(g){this._map.fire(new y_(g.type,this._map,g))}_firePreventable(g){if(this._map.fire(g),g.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gg{constructor(g){this._map=g}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(g){this._map.fire(new am(g.type,this._map,g))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new am("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(g){this._delayContextMenu?this._contextMenuEvent=g:this._ignoreContextMenu||this._map.fire(new am(g.type,this._map,g)),this._map.listens("contextmenu")&&g.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bm{constructor(g,A){this._map=g,this._el=g.getCanvasContainer(),this._container=g.getContainer(),this._clickTolerance=A.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(g,A){this.isEnabled()&&g.shiftKey&&g.button===0&&(ze.disableDrag(),this._startPos=this._lastPos=A,this._active=!0)}mousemoveWindow(g,A){if(!this._active)return;const X=A;if(this._lastPos.equals(X)||!this._box&&X.dist(this._startPos)<this._clickTolerance)return;const _e=this._startPos;this._lastPos=X,this._box||(this._box=ze.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",g));const Ft=Math.min(_e.x,X.x),Xr=Math.max(_e.x,X.x),as=Math.min(_e.y,X.y),cs=Math.max(_e.y,X.y);ze.setTransform(this._box,`translate(${Ft}px,${as}px)`),this._box.style.width=Xr-Ft+"px",this._box.style.height=cs-as+"px"}mouseupWindow(g,A){if(!this._active||g.button!==0)return;const X=this._startPos,_e=A;if(this.reset(),ze.suppressClick(),X.x!==_e.x||X.y!==_e.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:g})),{cameraAnimation:Ft=>Ft.fitScreenCoordinates(X,_e,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",g)}keydown(g){this._active&&g.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",g))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ze.remove(this._box),this._box=null),ze.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(g,A){return this._map.fire(new o.Event(g,{originalEvent:A}))}}function cg(he,g){if(he.length!==g.length)throw new Error(`The number of touches and points are not equal - touches ${he.length}, points ${g.length}`);const A={};for(let X=0;X<he.length;X++)A[he[X].identifier]=g[X];return A}class Pg{constructor(g){this.reset(),this.numTouches=g.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(g,A,X){(this.centroid||X.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=g.timeStamp),X.length===this.numTouches&&(this.centroid=function(_e){const Ft=new o.pointGeometry(0,0);for(const Xr of _e)Ft._add(Xr);return Ft.div(_e.length)}(A),this.touches=cg(X,A)))}touchmove(g,A,X){if(this.aborted||!this.centroid)return;const _e=cg(X,A);for(const Ft in this.touches){const Xr=_e[Ft];(!Xr||Xr.dist(this.touches[Ft])>30)&&(this.aborted=!0)}}touchend(g,A,X){if((!this.centroid||g.timeStamp-this.startTime>500)&&(this.aborted=!0),X.length===0){const _e=!this.aborted&&this.centroid;if(this.reset(),_e)return _e}}}class v_{constructor(g){this.singleTap=new Pg(g),this.numTaps=g.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(g,A,X){this.singleTap.touchstart(g,A,X)}touchmove(g,A,X){this.singleTap.touchmove(g,A,X)}touchend(g,A,X){const _e=this.singleTap.touchend(g,A,X);if(_e){const Ft=g.timeStamp-this.lastTime<500,Xr=!this.lastTap||this.lastTap.dist(_e)<30;if(Ft&&Xr||this.reset(),this.count++,this.lastTime=g.timeStamp,this.lastTap=_e,this.count===this.numTaps)return this.reset(),_e}}}class fy{constructor(){this._zoomIn=new v_({numTouches:1,numTaps:2}),this._zoomOut=new v_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(g,A,X){this._zoomIn.touchstart(g,A,X),this._zoomOut.touchstart(g,A,X)}touchmove(g,A,X){this._zoomIn.touchmove(g,A,X),this._zoomOut.touchmove(g,A,X)}touchend(g,A,X){const _e=this._zoomIn.touchend(g,A,X),Ft=this._zoomOut.touchend(g,A,X);return _e?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Xr=>Xr.easeTo({duration:300,zoom:Xr.getZoom()+1,around:Xr.unproject(_e)},{originalEvent:g})}):Ft?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Xr=>Xr.easeTo({duration:300,zoom:Xr.getZoom()-1,around:Xr.unproject(Ft)},{originalEvent:g})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fg{constructor(g){this._enabled=!!g.enable,this._moveStateManager=g.moveStateManager,this._clickTolerance=g.clickTolerance||1,this._moveFunction=g.move,this._activateOnStart=!!g.activateOnStart,g.assignEvents(this),this.reset()}reset(g){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(g)}_move(...g){const A=this._moveFunction(...g);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(g,A){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(g)&&(this._moveStateManager.startMove(g),this._lastPoint=A.length?A[0]:A,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(g,A){if(!this.isEnabled())return;const X=this._lastPoint;if(!X)return;if(g.preventDefault(),!this._moveStateManager.isValidMoveEvent(g))return void this.reset(g);const _e=A.length?A[0]:A;return!this._moved&&_e.dist(X)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_e,this._move(X,_e))}dragEnd(g){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(g)&&(this._moved&&ze.suppressClick(),this.reset(g))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ay={0:1,2:2};class ug{constructor(g){this._correctEvent=g.checkCorrectEvent}startMove(g){const A=ze.mouseButton(g);this._eventButton=A}endMove(g){delete this._eventButton}isValidStartEvent(g){return this._correctEvent(g)}isValidMoveEvent(g){return!function(A,X){const _e=Ay[X];return A.buttons===void 0||(A.buttons&_e)!==_e}(g,this._eventButton)}isValidEndEvent(g){return ze.mouseButton(g)===this._eventButton}}class ym{constructor(){this._firstTouch=void 0}_isOneFingerTouch(g){return g.targetTouches.length===1}_isSameTouchEvent(g){return g.targetTouches[0].identifier===this._firstTouch}startMove(g){this._firstTouch=g.targetTouches[0].identifier}endMove(g){delete this._firstTouch}isValidStartEvent(g){return this._isOneFingerTouch(g)}isValidMoveEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}isValidEndEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}}const Yp=he=>{he.mousedown=he.dragStart,he.mousemoveWindow=he.dragMove,he.mouseup=he.dragEnd,he.contextmenu=function(g){g.preventDefault()}},$_=({enable:he,clickTolerance:g,bearingDegreesPerPixelMoved:A=.8})=>{const X=new ug({checkCorrectEvent:_e=>ze.mouseButton(_e)===0&&_e.ctrlKey||ze.mouseButton(_e)===2});return new fg({clickTolerance:g,move:(_e,Ft)=>({bearingDelta:(Ft.x-_e.x)*A}),moveStateManager:X,enable:he,assignEvents:Yp})},k0=({enable:he,clickTolerance:g,pitchDegreesPerPixelMoved:A=-.5})=>{const X=new ug({checkCorrectEvent:_e=>ze.mouseButton(_e)===0&&_e.ctrlKey||ze.mouseButton(_e)===2});return new fg({clickTolerance:g,move:(_e,Ft)=>({pitchDelta:(Ft.y-_e.y)*A}),moveStateManager:X,enable:he,assignEvents:Yp})};class Py{constructor(g,A){this._minTouches=g.cooperativeGestures?2:1,this._clickTolerance=g.clickTolerance||1,this._map=A,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(g,A,X){return this._calculateTransform(g,A,X)}touchmove(g,A,X){if(this._map._cooperativeGestures&&(this._minTouches===2&&X.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(g,!1,X.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(X.length<this._minTouches))return g.preventDefault(),this._calculateTransform(g,A,X)}touchend(g,A,X){this._calculateTransform(g,A,X),this._active&&X.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(g,A,X){X.length>0&&(this._active=!0);const _e=cg(X,A),Ft=new o.pointGeometry(0,0),Xr=new o.pointGeometry(0,0);let as=0;for(const us in _e){const th=_e[us],eh=this._touches[us];eh&&(Ft._add(th),Xr._add(th.sub(eh)),as++,_e[us]=th)}if(this._touches=_e,as<this._minTouches||!Xr.mag())return;const cs=Xr.div(as);return this._sum._add(cs),this._sum.mag()<this._clickTolerance?void 0:{around:Ft.div(as),panDelta:cs}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class x_{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(g){}_move(g,A,X){return{}}touchstart(g,A,X){this._firstTwoTouches||X.length<2||(this._firstTwoTouches=[X[0].identifier,X[1].identifier],this._start([A[0],A[1]]))}touchmove(g,A,X){if(!this._firstTwoTouches)return;g.preventDefault();const[_e,Ft]=this._firstTwoTouches,Xr=_v(X,A,_e),as=_v(X,A,Ft);if(!Xr||!as)return;const cs=this._aroundCenter?null:Xr.add(as).div(2);return this._move([Xr,as],cs,g)}touchend(g,A,X){if(!this._firstTwoTouches)return;const[_e,Ft]=this._firstTwoTouches,Xr=_v(X,A,_e),as=_v(X,A,Ft);Xr&&as||(this._active&&ze.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(g){this._enabled=!0,this._aroundCenter=!!g&&g.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _v(he,g,A){for(let X=0;X<he.length;X++)if(he[X].identifier===A)return g[X]}function b_(he,g){return Math.log(he/g)/Math.LN2}class Q_ extends x_{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(g){this._startDistance=this._distance=g[0].dist(g[1])}_move(g,A){const X=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(b_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:b_(this._distance,X),pinchAround:A}}}function Pp(he,g){return 180*he.angleWith(g)/Math.PI}class jp extends x_{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])}_move(g,A){const X=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pp(this._vector,X),pinchAround:A}}_isBelowThreshold(g){this._minDiameter=Math.min(this._minDiameter,g.mag());const A=25/(Math.PI*this._minDiameter)*360,X=Pp(g,this._startVector);return Math.abs(X)<A}}function py(he){return Math.abs(he.y)>Math.abs(he.x)}class d0 extends x_{constructor(g){super(),this._map=g}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(g,A,X){super.touchstart(g,A,X),this._currentTouchCount=X.length}_start(g){this._lastPoints=g,py(g[0].sub(g[1]))&&(this._valid=!1)}_move(g,A,X){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _e=g[0].sub(this._lastPoints[0]),Ft=g[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_e,Ft,X.timeStamp),this._valid?(this._lastPoints=g,this._active=!0,{pitchDelta:(_e.y+Ft.y)/2*-.5}):void 0}gestureBeginsVertically(g,A,X){if(this._valid!==void 0)return this._valid;const _e=g.mag()>=2,Ft=A.mag()>=2;if(!_e&&!Ft)return;if(!_e||!Ft)return this._firstMove===void 0&&(this._firstMove=X),X-this._firstMove<100&&void 0;const Xr=g.y>0==A.y>0;return py(g)&&py(A)&&Xr}}const yv={panStep:100,bearingStep:15,pitchStep:10};class Ng{constructor(){const g=yv;this._panStep=g.panStep,this._bearingStep=g.bearingStep,this._pitchStep=g.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(g){if(g.altKey||g.ctrlKey||g.metaKey)return;let A=0,X=0,_e=0,Ft=0,Xr=0;switch(g.keyCode){case 61:case 107:case 171:case 187:A=1;break;case 189:case 109:case 173:A=-1;break;case 37:g.shiftKey?X=-1:(g.preventDefault(),Ft=-1);break;case 39:g.shiftKey?X=1:(g.preventDefault(),Ft=1);break;case 38:g.shiftKey?_e=1:(g.preventDefault(),Xr=-1);break;case 40:g.shiftKey?_e=-1:(g.preventDefault(),Xr=1);break;default:return}return this._rotationDisabled&&(X=0,_e=0),{cameraAnimation:as=>{const cs=as.getZoom();as.easeTo({duration:300,easeId:"keyboardHandler",easing:f0,zoom:A?Math.round(cs)+A*(g.shiftKey?2:1):cs,bearing:as.getBearing()+X*this._bearingStep,pitch:as.getPitch()+_e*this._pitchStep,offset:[-Ft*this._panStep,-Xr*this._panStep],center:as.getCenter()},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function f0(he){return he*(2-he)}const w_=4.000244140625;class Fv{constructor(g,A){this._map=g,this._el=g.getCanvasContainer(),this._handler=A,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(g){this._defaultZoomRate=g}setWheelZoomRate(g){this._wheelZoomRate=g}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(g){this.isEnabled()||(this._enabled=!0,this._aroundCenter=g&&g.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(g){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;g.preventDefault()}let A=g.deltaMode===WheelEvent.DOM_DELTA_LINE?40*g.deltaY:g.deltaY;const X=o.exported.now(),_e=X-(this._lastWheelEventTime||0);this._lastWheelEventTime=X,A!==0&&A%w_==0?this._type="wheel":A!==0&&Math.abs(A)<4?this._type="trackpad":_e>400?(this._type=null,this._lastValue=A,this._timeout=setTimeout(this._onTimeout,40,g)):this._type||(this._type=Math.abs(_e*A)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,A+=this._lastValue)),g.shiftKey&&A&&(A/=4),this._type&&(this._lastWheelEvent=g,this._delta-=A,this._active||this._start(g)),g.preventDefault()}_onTimeout(g){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)}_start(g){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const A=ze.mousePos(this._el,g);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(A)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const g=this._map.transform;if(this._delta!==0){const as=this._type==="wheel"&&Math.abs(this._delta)>w_?this._wheelZoomRate:this._defaultZoomRate;let cs=2/(1+Math.exp(-Math.abs(this._delta*as)));this._delta<0&&cs!==0&&(cs=1/cs);const us=typeof this._targetZoom=="number"?g.zoomScale(this._targetZoom):g.scale;this._targetZoom=Math.min(g.maxZoom,Math.max(g.minZoom,g.scaleZoom(us*cs))),this._type==="wheel"&&(this._startZoom=g.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const A=typeof this._targetZoom=="number"?this._targetZoom:g.zoom,X=this._startZoom,_e=this._easing;let Ft,Xr=!1;if(this._type==="wheel"&&X&&_e){const as=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),cs=_e(as);Ft=o.number(X,A,cs),as<1?this._frameId||(this._frameId=!0):Xr=!0}else Ft=A,Xr=!0;return this._active=!0,Xr&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Xr,zoomDelta:Ft-g.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(g){let A=o.ease;if(this._prevEase){const X=this._prevEase,_e=(o.exported.now()-X.start)/X.duration,Ft=X.easing(_e+.01)-X.easing(_e),Xr=.27/Math.sqrt(Ft*Ft+1e-4)*.01,as=Math.sqrt(.0729-Xr*Xr);A=o.bezier(Xr,as,.25,1)}return this._prevEase={start:o.exported.now(),duration:g,easing:A},A}reset(){this._active=!1}}class hp{constructor(g,A){this._clickZoom=g,this._tapZoom=A}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wm{constructor(){this.reset()}reset(){this._active=!1}dblclick(g,A){return g.preventDefault(),{cameraAnimation:X=>{X.easeTo({duration:300,zoom:X.getZoom()+(g.shiftKey?-1:1),around:X.unproject(A)},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pg{constructor(){this._tap=new v_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(g,A,X){this._swipePoint||(this._tapTime&&g.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?X.length>0&&(this._swipePoint=A[0],this._swipeTouch=X[0].identifier):this._tap.touchstart(g,A,X))}touchmove(g,A,X){if(this._tapTime){if(this._swipePoint){if(X[0].identifier!==this._swipeTouch)return;const _e=A[0],Ft=_e.y-this._swipePoint.y;return this._swipePoint=_e,g.preventDefault(),this._active=!0,{zoomDelta:Ft/128}}}else this._tap.touchmove(g,A,X)}touchend(g,A,X){this._tapTime?this._swipePoint&&X.length===0&&this.reset():this._tap.touchend(g,A,X)&&(this._tapTime=g.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Y0{constructor(g,A,X){this._el=g,this._mousePan=A,this._touchPan=X}enable(g){this._inertiaOptions=g||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Jy{constructor(g,A,X){this._pitchWithRotate=g.pitchWithRotate,this._mouseRotate=A,this._mousePitch=X}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mg{constructor(g,A,X,_e){this._el=g,this._touchZoom=A,this._touchRotate=X,this._tapDragZoom=_e,this._rotationDisabled=!1,this._enabled=!0}enable(g){this._touchZoom.enable(g),this._rotationDisabled||this._touchRotate.enable(g),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ky=he=>he.zoom||he.drag||he.pitch||he.rotate;class J0 extends o.Event{}function D0(he){return he.panDelta&&he.panDelta.mag()||he.zoomDelta||he.bearingDelta||he.pitchDelta}class p0{constructor(g,A){this._map=g,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zv(g),this._bearingSnap=A.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(A),o.bindAll(["handleEvent","handleWindowEvent"],this);const X=this._el;this._listeners=[[X,"touchstart",{passive:!0}],[X,"touchmove",{passive:!1}],[X,"touchend",void 0],[X,"touchcancel",void 0],[X,"mousedown",void 0],[X,"mousemove",void 0],[X,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[X,"mouseover",void 0],[X,"mouseout",void 0],[X,"dblclick",void 0],[X,"click",void 0],[X,"keydown",{capture:!1}],[X,"keyup",void 0],[X,"wheel",{passive:!1}],[X,"contextmenu",void 0],[window,"blur",void 0]];for(const[_e,Ft,Xr]of this._listeners)ze.addEventListener(_e,Ft,_e===document?this.handleWindowEvent:this.handleEvent,Xr)}destroy(){for(const[g,A,X]of this._listeners)ze.removeEventListener(g,A,g===document?this.handleWindowEvent:this.handleEvent,X)}_addDefaultHandlers(g){const A=this._map,X=A.getCanvasContainer();this._add("mapEvent",new h0(A,g));const _e=A.boxZoom=new bm(A,g);this._add("boxZoom",_e);const Ft=new fy,Xr=new wm;A.doubleClickZoom=new hp(Xr,Ft),this._add("tapZoom",Ft),this._add("clickZoom",Xr);const as=new pg;this._add("tapDragZoom",as);const cs=A.touchPitch=new d0(A);this._add("touchPitch",cs);const us=$_(g),th=k0(g);A.dragRotate=new Jy(g,us,th),this._add("mouseRotate",us,["mousePitch"]),this._add("mousePitch",th,["mouseRotate"]);const eh=(({enable:Ed,clickTolerance:_d})=>{const qh=new ug({checkCorrectEvent:Md=>ze.mouseButton(Md)===0&&!Md.ctrlKey});return new fg({clickTolerance:_d,move:(Md,Nd)=>({around:Nd,panDelta:Nd.sub(Md)}),activateOnStart:!0,moveStateManager:qh,enable:Ed,assignEvents:Yp})})(g),ph=new Py(g,A);A.dragPan=new Y0(X,eh,ph),this._add("mousePan",eh),this._add("touchPan",ph,["touchZoom","touchRotate"]);const Rh=new jp,Bh=new Q_;A.touchZoomRotate=new mg(X,Bh,Rh,as),this._add("touchRotate",Rh,["touchPan","touchZoom"]),this._add("touchZoom",Bh,["touchPan","touchRotate"]);const Ch=A.scrollZoom=new Fv(A,this);this._add("scrollZoom",Ch,["mousePan"]);const ed=A.keyboard=new Ng;this._add("keyboard",ed),this._add("blockableMapEvent",new Gg(A));for(const Ed of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])g.interactive&&g[Ed]&&A[Ed].enable(g[Ed])}_add(g,A,X){this._handlers.push({handlerName:g,handler:A,allowed:X}),this._handlersById[g]=A}stop(g){if(!this._updatingCamera){for(const{handler:A}of this._handlers)A.reset();this._inertia.clear(),this._fireEvents({},{},g),this._changes=[]}}isActive(){for(const{handler:g}of this._handlers)if(g.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ky(this._eventsInProgress)||this.isZooming()}_blockedByActive(g,A,X){for(const _e in g)if(_e!==X&&(!A||A.indexOf(_e)<0))return!0;return!1}handleWindowEvent(g){this.handleEvent(g,`${g.type}Window`)}_getMapTouches(g){const A=[];for(const X of g)this._el.contains(X.target)&&A.push(X);return A}handleEvent(g,A){if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const X=g.type==="renderFrame"?void 0:g,_e={needsRenderFrame:!1},Ft={},Xr={},as=g.touches,cs=as?this._getMapTouches(as):void 0,us=cs?ze.touchPos(this._el,cs):ze.mousePos(this._el,g);for(const{handlerName:ph,handler:Rh,allowed:Bh}of this._handlers){if(!Rh.isEnabled())continue;let Ch;this._blockedByActive(Xr,Bh,ph)?Rh.reset():Rh[A||g.type]&&(Ch=Rh[A||g.type](g,us,cs),this.mergeHandlerResult(_e,Ft,Ch,ph,X),Ch&&Ch.needsRenderFrame&&this._triggerRenderFrame()),(Ch||Rh.isActive())&&(Xr[ph]=Rh)}const th={};for(const ph in this._previousActiveHandlers)Xr[ph]||(th[ph]=X);this._previousActiveHandlers=Xr,(Object.keys(th).length||D0(_e))&&(this._changes.push([_e,Ft,th]),this._triggerRenderFrame()),(Object.keys(Xr).length||D0(_e))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:eh}=_e;eh&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],eh(this._map))}mergeHandlerResult(g,A,X,_e,Ft){if(!X)return;o.extend(g,X);const Xr={handlerName:_e,originalEvent:X.originalEvent||Ft};X.zoomDelta!==void 0&&(A.zoom=Xr),X.panDelta!==void 0&&(A.drag=Xr),X.pitchDelta!==void 0&&(A.pitch=Xr),X.bearingDelta!==void 0&&(A.rotate=Xr)}_applyChanges(){const g={},A={},X={};for(const[_e,Ft,Xr]of this._changes)_e.panDelta&&(g.panDelta=(g.panDelta||new o.pointGeometry(0,0))._add(_e.panDelta)),_e.zoomDelta&&(g.zoomDelta=(g.zoomDelta||0)+_e.zoomDelta),_e.bearingDelta&&(g.bearingDelta=(g.bearingDelta||0)+_e.bearingDelta),_e.pitchDelta&&(g.pitchDelta=(g.pitchDelta||0)+_e.pitchDelta),_e.around!==void 0&&(g.around=_e.around),_e.pinchAround!==void 0&&(g.pinchAround=_e.pinchAround),_e.noInertia&&(g.noInertia=_e.noInertia),o.extend(A,Ft),o.extend(X,Xr);this._updateMapTransform(g,A,X),this._changes=[]}_updateMapTransform(g,A,X){const _e=this._map,Ft=_e.transform,Xr=_e.terrain;if(!(D0(g)||Xr&&this._terrainMovement))return this._fireEvents(A,X,!0);let{panDelta:as,zoomDelta:cs,bearingDelta:us,pitchDelta:th,around:eh,pinchAround:ph}=g;ph!==void 0&&(eh=ph),_e._stop(!0),eh=eh||_e.transform.centerPoint;const Rh=Ft.pointLocation(as?eh.sub(as):eh);us&&(Ft.bearing+=us),th&&(Ft.pitch+=th),cs&&(Ft.zoom+=cs),Xr?this._terrainMovement||!A.drag&&!A.zoom?A.drag&&this._terrainMovement?Ft.center=Ft.pointLocation(Ft.centerPoint.sub(as)):Ft.setLocationAtPoint(Rh,eh):(this._terrainMovement=!0,Ft.freezeElevation=!0,Ft.setLocationAtPoint(Rh,eh),this._map.once("moveend",()=>{Ft.freezeElevation=!1,this._terrainMovement=!1,Ft.recalculateZoom(_e.terrain)})):Ft.setLocationAtPoint(Rh,eh),this._map._update(),g.noInertia||this._inertia.record(g),this._fireEvents(A,X,!0)}_fireEvents(g,A,X){const _e=ky(this._eventsInProgress),Ft=ky(g),Xr={};for(const th in g){const{originalEvent:eh}=g[th];this._eventsInProgress[th]||(Xr[`${th}start`]=eh),this._eventsInProgress[th]=g[th]}!_e&&Ft&&this._fireEvent("movestart",Ft.originalEvent);for(const th in Xr)this._fireEvent(th,Xr[th]);Ft&&this._fireEvent("move",Ft.originalEvent);for(const th in g){const{originalEvent:eh}=g[th];this._fireEvent(th,eh)}const as={};let cs;for(const th in this._eventsInProgress){const{handlerName:eh,originalEvent:ph}=this._eventsInProgress[th];this._handlersById[eh].isActive()||(delete this._eventsInProgress[th],cs=A[eh]||ph,as[`${th}end`]=cs)}for(const th in as)this._fireEvent(th,as[th]);const us=ky(this._eventsInProgress);if(X&&(_e||Ft)&&!us){this._updatingCamera=!0;const th=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),eh=ph=>ph!==0&&-this._bearingSnap<ph&&ph<this._bearingSnap;th?(eh(th.bearing||this._map.getBearing())&&(th.bearing=0),th.freezeElevation=!0,this._map.easeTo(th,{originalEvent:cs})):(this._map.fire(new o.Event("moveend",{originalEvent:cs})),eh(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(g,A){this._map.fire(new o.Event(g,A?{originalEvent:A}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(g=>{delete this._frameId,this.handleEvent(new J0("renderFrame",{timeStamp:g})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Uv={extend:(he,...g)=>o.extend(he,...g),run(he){he()},logToElement(he,g=!1,A="log"){const X=window.document.getElementById(A);X&&(g&&(X.innerHTML=""),X.innerHTML+=`<br>${he}`)}};class Q0 extends o.Evented{constructor(g,A){super(),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=A.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(g,A){return this.jumpTo({center:g},A)}panBy(g,A,X){return g=o.pointGeometry.convert(g).mult(-1),this.panTo(this.transform.center,o.extend({offset:g},A),X)}panTo(g,A,X){return this.easeTo(o.extend({center:g},A),X)}getZoom(){return this.transform.zoom}setZoom(g,A){return this.jumpTo({zoom:g},A),this}zoomTo(g,A,X){return this.easeTo(o.extend({zoom:g},A),X)}zoomIn(g,A){return this.zoomTo(this.getZoom()+1,g,A),this}zoomOut(g,A){return this.zoomTo(this.getZoom()-1,g,A),this}getBearing(){return this.transform.bearing}setBearing(g,A){return this.jumpTo({bearing:g},A),this}getPadding(){return this.transform.padding}setPadding(g,A){return this.jumpTo({padding:g},A),this}rotateTo(g,A,X){return this.easeTo(o.extend({bearing:g},A),X)}resetNorth(g,A){return this.rotateTo(0,o.extend({duration:1e3},g),A),this}resetNorthPitch(g,A){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},g),A),this}snapToNorth(g,A){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,A):this}getPitch(){return this.transform.pitch}setPitch(g,A){return this.jumpTo({pitch:g},A),this}cameraForBounds(g,A){g=o.LngLatBounds.convert(g);const X=A&&A.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),X,A)}_cameraForBoxAndBearing(g,A,X,_e){const Ft={top:0,bottom:0,right:0,left:0};if(typeof(_e=o.extend({padding:Ft,offset:[0,0],maxZoom:this.transform.maxZoom},_e)).padding=="number"){const Nd=_e.padding;_e.padding={top:Nd,bottom:Nd,right:Nd,left:Nd}}_e.padding=o.extend(Ft,_e.padding);const Xr=this.transform,as=Xr.padding,cs=Xr.project(o.LngLat.convert(g)),us=Xr.project(o.LngLat.convert(A)),th=cs.rotate(-X*Math.PI/180),eh=us.rotate(-X*Math.PI/180),ph=new o.pointGeometry(Math.max(th.x,eh.x),Math.max(th.y,eh.y)),Rh=new o.pointGeometry(Math.min(th.x,eh.x),Math.min(th.y,eh.y)),Bh=ph.sub(Rh),Ch=(Xr.width-(as.left+as.right+_e.padding.left+_e.padding.right))/Bh.x,ed=(Xr.height-(as.top+as.bottom+_e.padding.top+_e.padding.bottom))/Bh.y;if(ed<0||Ch<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ed=Math.min(Xr.scaleZoom(Xr.scale*Math.min(Ch,ed)),_e.maxZoom),_d=o.pointGeometry.convert(_e.offset),qh=new o.pointGeometry((_e.padding.left-_e.padding.right)/2,(_e.padding.top-_e.padding.bottom)/2).rotate(X*Math.PI/180),Md=_d.add(qh).mult(Xr.scale/Xr.zoomScale(Ed));return{center:Xr.unproject(cs.add(us).div(2).sub(Md)),zoom:Ed,bearing:X}}fitBounds(g,A,X){return this._fitInternal(this.cameraForBounds(g,A),A,X)}fitScreenCoordinates(g,A,X,_e,Ft){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(g)),this.transform.pointLocation(o.pointGeometry.convert(A)),X,_e),_e,Ft)}_fitInternal(g,A,X){return g?(delete(A=o.extend(g,A)).padding,A.linear?this.easeTo(A,X):this.flyTo(A,X)):this}jumpTo(g,A){this.stop();const X=this.transform;let _e=!1,Ft=!1,Xr=!1;return"zoom"in g&&X.zoom!==+g.zoom&&(_e=!0,X.zoom=+g.zoom),g.center!==void 0&&(X.center=o.LngLat.convert(g.center)),"bearing"in g&&X.bearing!==+g.bearing&&(Ft=!0,X.bearing=+g.bearing),"pitch"in g&&X.pitch!==+g.pitch&&(Xr=!0,X.pitch=+g.pitch),g.padding==null||X.isPaddingEqual(g.padding)||(X.padding=g.padding),this.fire(new o.Event("movestart",A)).fire(new o.Event("move",A)),_e&&this.fire(new o.Event("zoomstart",A)).fire(new o.Event("zoom",A)).fire(new o.Event("zoomend",A)),Ft&&this.fire(new o.Event("rotatestart",A)).fire(new o.Event("rotate",A)).fire(new o.Event("rotateend",A)),Xr&&this.fire(new o.Event("pitchstart",A)).fire(new o.Event("pitch",A)).fire(new o.Event("pitchend",A)),this.fire(new o.Event("moveend",A))}calculateCameraOptionsFromTo(g,A,X,_e=0){const Ft=o.MercatorCoordinate.fromLngLat(g,A),Xr=o.MercatorCoordinate.fromLngLat(X,_e),as=Xr.x-Ft.x,cs=Xr.y-Ft.y,us=Xr.z-Ft.z,th=Math.hypot(as,cs,us);if(th===0)throw new Error("Can't calculate camera options with same From and To");const eh=Math.hypot(as,cs),ph=this.transform.scaleZoom(this.transform.cameraToCenterDistance/th/this.transform.tileSize),Rh=180*Math.atan2(as,-cs)/Math.PI;let Bh=180*Math.acos(eh/th)/Math.PI;return Bh=us<0?90-Bh:90+Bh,{center:Xr.toLngLat(),zoom:ph,pitch:Bh,bearing:Rh}}easeTo(g,A){this._stop(!1,g.easeId),((g=o.extend({offset:[0,0],duration:500,easing:o.ease},g)).animate===!1||!g.essential&&o.exported.prefersReducedMotion)&&(g.duration=0);const X=this.transform,_e=this.getZoom(),Ft=this.getBearing(),Xr=this.getPitch(),as=this.getPadding(),cs="zoom"in g?+g.zoom:_e,us="bearing"in g?this._normalizeBearing(g.bearing,Ft):Ft,th="pitch"in g?+g.pitch:Xr,eh="padding"in g?g.padding:X.padding,ph=o.pointGeometry.convert(g.offset);let Rh=X.centerPoint.add(ph);const Bh=X.pointLocation(Rh),Ch=o.LngLat.convert(g.center||Bh);this._normalizeCenter(Ch);const ed=X.project(Bh),Ed=X.project(Ch).sub(ed),_d=X.zoomScale(cs-_e);let qh,Md;g.around&&(qh=o.LngLat.convert(g.around),Md=X.locationPoint(qh));const Nd={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||cs!==_e,this._rotating=this._rotating||Ft!==us,this._pitching=this._pitching||th!==Xr,this._padding=!X.isPaddingEqual(eh),this._easeId=g.easeId,this._prepareEase(A,g.noMoveStart,Nd),this.terrain&&this._prepareElevation(Ch),this._ease(L=>{if(this._zooming&&(X.zoom=o.number(_e,cs,L)),this._rotating&&(X.bearing=o.number(Ft,us,L)),this._pitching&&(X.pitch=o.number(Xr,th,L)),this._padding&&(X.interpolatePadding(as,eh,L),Rh=X.centerPoint.add(ph)),this.terrain&&!g.freezeElevation&&this._updateElevation(L),qh)X.setLocationAtPoint(qh,Md);else{const u=X.zoomScale(X.zoom-_e),E=cs>_e?Math.min(2,_d):Math.max(.5,_d),B=Math.pow(E,1-L),Y=X.unproject(ed.add(Ed.mult(L*B)).mult(u));X.setLocationAtPoint(X.renderWorldCopies?Y.wrap():Y,Rh)}this._fireMoveEvents(A)},L=>{this.terrain&&this._finalizeElevation(),this._afterEase(A,L)},g),this}_prepareEase(g,A,X={}){this._moving=!0,A||X.moving||this.fire(new o.Event("movestart",g)),this._zooming&&!X.zooming&&this.fire(new o.Event("zoomstart",g)),this._rotating&&!X.rotating&&this.fire(new o.Event("rotatestart",g)),this._pitching&&!X.pitching&&this.fire(new o.Event("pitchstart",g))}_prepareElevation(g){this._elevationCenter=g,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(g,this.terrain),this.transform.freezeElevation=!0}_updateElevation(g){const A=this.transform.getElevation(this._elevationCenter,this.terrain);if(g<1&&A!==this._elevationTarget){const X=this._elevationTarget-this._elevationStart;this._elevationStart+=g*(X-(A-(X*g+this._elevationStart))/(1-g)),this._elevationTarget=A}this.transform.elevation=o.number(this._elevationStart,this._elevationTarget,g)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_fireMoveEvents(g){this.fire(new o.Event("move",g)),this._zooming&&this.fire(new o.Event("zoom",g)),this._rotating&&this.fire(new o.Event("rotate",g)),this._pitching&&this.fire(new o.Event("pitch",g))}_afterEase(g,A){if(this._easeId&&A&&this._easeId===A)return;delete this._easeId;const X=this._zooming,_e=this._rotating,Ft=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,X&&this.fire(new o.Event("zoomend",g)),_e&&this.fire(new o.Event("rotateend",g)),Ft&&this.fire(new o.Event("pitchend",g)),this.fire(new o.Event("moveend",g))}flyTo(g,A){if(!g.essential&&o.exported.prefersReducedMotion){const $s=o.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo($s,A)}this.stop(),g=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},g);const X=this.transform,_e=this.getZoom(),Ft=this.getBearing(),Xr=this.getPitch(),as=this.getPadding(),cs="zoom"in g?o.clamp(+g.zoom,X.minZoom,X.maxZoom):_e,us="bearing"in g?this._normalizeBearing(g.bearing,Ft):Ft,th="pitch"in g?+g.pitch:Xr,eh="padding"in g?g.padding:X.padding,ph=X.zoomScale(cs-_e),Rh=o.pointGeometry.convert(g.offset);let Bh=X.centerPoint.add(Rh);const Ch=X.pointLocation(Bh),ed=o.LngLat.convert(g.center||Ch);this._normalizeCenter(ed);const Ed=X.project(Ch),_d=X.project(ed).sub(Ed);let qh=g.curve;const Md=Math.max(X.width,X.height),Nd=Md/ph,L=_d.mag();if("minZoom"in g){const $s=o.clamp(Math.min(g.minZoom,_e,cs),X.minZoom,X.maxZoom),el=Md/X.zoomScale($s-_e);qh=Math.sqrt(el/L*2)}const u=qh*qh;function E($s){const el=(Nd*Nd-Md*Md+($s?-1:1)*u*u*L*L)/(2*($s?Nd:Md)*u*L);return Math.log(Math.sqrt(el*el+1)-el)}function B($s){return(Math.exp($s)-Math.exp(-$s))/2}function Y($s){return(Math.exp($s)+Math.exp(-$s))/2}const vt=E(0);let mr=function($s){return Y(vt)/Y(vt+qh*$s)},Ur=function($s){return Md*((Y(vt)*(B(el=vt+qh*$s)/Y(el))-B(vt))/u)/L;var el},Gn=(E(1)-vt)/qh;if(Math.abs(L)<1e-6||!isFinite(Gn)){if(Math.abs(Md-Nd)<1e-6)return this.easeTo(g,A);const $s=Nd<Md?-1:1;Gn=Math.abs(Math.log(Nd/Md))/qh,Ur=function(){return 0},mr=function(el){return Math.exp($s*qh*el)}}return g.duration="duration"in g?+g.duration:1e3*Gn/("screenSpeed"in g?+g.screenSpeed/qh:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=Ft!==us,this._pitching=th!==Xr,this._padding=!X.isPaddingEqual(eh),this._prepareEase(A,!1),this.terrain&&this._prepareElevation(ed),this._ease($s=>{const el=$s*Gn,Wu=1/mr(el);X.zoom=$s===1?cs:_e+X.scaleZoom(Wu),this._rotating&&(X.bearing=o.number(Ft,us,$s)),this._pitching&&(X.pitch=o.number(Xr,th,$s)),this._padding&&(X.interpolatePadding(as,eh,$s),Bh=X.centerPoint.add(Rh)),this.terrain&&!g.freezeElevation&&this._updateElevation($s);const dh=$s===1?ed:X.unproject(Ed.add(_d.mult(Ur(el))).mult(Wu));X.setLocationAtPoint(X.renderWorldCopies?dh.wrap():dh,Bh),this._fireMoveEvents(A)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(A)},g),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(g,A){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const X=this._onEaseEnd;delete this._onEaseEnd,X.call(this,A)}if(!g){const X=this.handlers;X&&X.stop(!1)}return this}_ease(g,A,X){X.animate===!1||X.duration===0?(g(1),A()):(this._easeStart=o.exported.now(),this._easeOptions=X,this._onEaseFrame=g,this._onEaseEnd=A,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const g=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(g,A){g=o.wrap(g,-180,180);const X=Math.abs(g-A);return Math.abs(g-360-A)<X&&(g-=360),Math.abs(g+360-A)<X&&(g+=360),g}_normalizeCenter(g){const A=this.transform;if(!A.renderWorldCopies||A.lngRange)return;const X=g.lng-A.center.lng;g.lng+=X>180?-360:X<-180?360:0}}class Qy{constructor(g={}){this.options=g,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(g){return this._map=g,this._compact=this.options&&this.options.compact,this._container=ze.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ze.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ze.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ze.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(g,A){const X=this._map._getUIString(`AttributionControl.${A}`);g.title=X,g.setAttribute("aria-label",X)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(g){!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let g=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?g=g.concat(this.options.customAttribution.map(_e=>typeof _e!="string"?"":_e)):typeof this.options.customAttribution=="string"&&g.push(this.options.customAttribution)),this._map.style.stylesheet){const _e=this._map.style.stylesheet;this.styleOwner=_e.owner,this.styleId=_e.id}const A=this._map.style.sourceCaches;for(const _e in A){const Ft=A[_e];if(Ft.used||Ft.usedForTerrain){const Xr=Ft.getSource();Xr.attribution&&g.indexOf(Xr.attribution)<0&&g.push(Xr.attribution)}}g=g.filter(_e=>String(_e).trim()),g.sort((_e,Ft)=>_e.length-Ft.length),g=g.filter((_e,Ft)=>{for(let Xr=Ft+1;Xr<g.length;Xr++)if(g[Xr].indexOf(_e)>=0)return!1;return!0});const X=g.join(" | ");X!==this._attribHTML&&(this._attribHTML=X,g.length?(this._innerContainer.innerHTML=X,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class ev{constructor(g={}){this.options=g,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(g){this._map=g,this._compact=this.options&&this.options.compact,this._container=ze.create("div","maplibregl-ctrl");const A=ze.create("a","maplibregl-ctrl-logo");return A.target="_blank",A.rel="noopener nofollow",A.href="https://maplibre.org/",A.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),A.setAttribute("rel","noopener nofollow"),this._container.appendChild(A),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ze.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const g=this._container.children;if(g.length){const A=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&A.classList.add("maplibregl-compact"):A.classList.remove("maplibregl-compact")}}}class n1{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(g){const A=++this._id;return this._queue.push({callback:g,id:A,cancelled:!1}),A}remove(g){const A=this._currentlyRunning,X=A?this._queue.concat(A):this._queue;for(const _e of X)if(_e.id===g)return void(_e.cancelled=!0)}run(g=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const A=this._currentlyRunning=this._queue;this._queue=[];for(const X of A)if(!X.cancelled&&(X.callback(g),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Vv={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var m0=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class vv extends o.Evented{constructor(g){super(),this.sourceCache=g,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,g.usedForTerrain=!0,g.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(g,A){this.sourceCache.update(g,A),this._renderableTilesKeys=[];const X={};for(const _e of g.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:A}))X[_e.key]=!0,this._renderableTilesKeys.push(_e.key),this._tiles[_e.key]||(_e.posMatrix=new Float64Array(16),o.ortho(_e.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[_e.key]=new fd(_e,this.tileSize));for(const _e in this._tiles)X[_e]||delete this._tiles[_e]}freeRtt(g){for(const A in this._tiles){const X=this._tiles[A];(!g||X.tileID.equals(g)||X.tileID.isChildOf(g)||g.isChildOf(X.tileID))&&(X.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(g=>this.getTileByID(g))}getTileByID(g){return this._tiles[g]}getTerrainCoords(g){const A={};for(const X of this._renderableTilesKeys){const _e=this._tiles[X].tileID;if(_e.canonical.equals(g.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16),o.ortho(Ft.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),A[X]=Ft}else if(_e.canonical.isChildOf(g.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16);const Xr=_e.canonical.z-g.canonical.z,as=_e.canonical.x-(_e.canonical.x>>Xr<<Xr),cs=_e.canonical.y-(_e.canonical.y>>Xr<<Xr),us=o.EXTENT>>Xr;o.ortho(Ft.posMatrix,0,us,0,us,0,1),o.translate(Ft.posMatrix,Ft.posMatrix,[-as*us,-cs*us,0]),A[X]=Ft}else if(g.canonical.isChildOf(_e.canonical)){const Ft=g.clone();Ft.posMatrix=new Float64Array(16);const Xr=g.canonical.z-_e.canonical.z,as=g.canonical.x-(g.canonical.x>>Xr<<Xr),cs=g.canonical.y-(g.canonical.y>>Xr<<Xr),us=o.EXTENT>>Xr;o.ortho(Ft.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(Ft.posMatrix,Ft.posMatrix,[as*us,cs*us,0]),o.scale(Ft.posMatrix,Ft.posMatrix,[1/2**Xr,1/2**Xr,0]),A[X]=Ft}}return A}getSourceTile(g,A){const X=this.sourceCache._source;let _e=g.overscaledZ-this.deltaZoom;if(_e>X.maxzoom&&(_e=X.maxzoom),_e<X.minzoom)return null;this._sourceTileCache[g.key]||(this._sourceTileCache[g.key]=g.scaledTo(_e).key);let Ft=this.sourceCache.getTileByID(this._sourceTileCache[g.key]);if((!Ft||!Ft.dem)&&A)for(;_e>=X.minzoom&&(!Ft||!Ft.dem);)Ft=this.sourceCache.getTileByID(g.scaledTo(_e--).key);return Ft}tilesAfterTime(g=Date.now()){return Object.values(this._tiles).filter(A=>A.timeAdded>=g)}}class tv{constructor(g,A,X){this.painter=g,this.sourceCache=new vv(A),this.options=X,this.exaggeration=typeof X.exaggeration=="number"?X.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(g,A,X,_e=o.EXTENT){if(!(A>=0&&A<_e&&X>=0&&X<_e))return 0;let Ft=0;const Xr=this.getTerrainData(g);if(Xr.tile&&Xr.tile.dem){const as=function(Bh,Ch,ed){var Ed=Ch[0],_d=Ch[1];return Bh[0]=ed[0]*Ed+ed[4]*_d+ed[12],Bh[1]=ed[1]*Ed+ed[5]*_d+ed[13],Bh}([],[A/_e*o.EXTENT,X/_e*o.EXTENT],Xr.u_terrain_matrix),cs=[as[0]*Xr.tile.dem.dim,as[1]*Xr.tile.dem.dim],us=[Math.floor(cs[0]),Math.floor(cs[1])],th=Xr.tile.dem.get(us[0],us[1]),eh=Xr.tile.dem.get(us[0],us[1]+1),ph=Xr.tile.dem.get(us[0]+1,us[1]),Rh=Xr.tile.dem.get(us[0]+1,us[1]+1);Ft=o.number(o.number(th,eh,cs[0]-us[0]),o.number(ph,Rh,cs[0]-us[0]),cs[1]-us[1])}return Ft}getElevation(g,A,X,_e=o.EXTENT){return this.getDEMElevation(g,A,X,_e)*this.exaggeration}getTerrainData(g){if(!this._emptyDemTexture){const _e=this.painter.context,Ft=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new $h(_e,Ft,_e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new $h(_e,new o.RGBAImage({width:1,height:1}),_e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_e.gl.NEAREST,_e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const A=this.sourceCache.getSourceTile(g,!0);if(A&&A.dem&&(!A.demTexture||A.needsTerrainPrepare)){const _e=this.painter.context;A.demTexture=this.painter.getTileTexture(A.dem.stride),A.demTexture?A.demTexture.update(A.dem.getPixels(),{premultiply:!1}):A.demTexture=new $h(_e,A.dem.getPixels(),_e.gl.RGBA,{premultiply:!1}),A.demTexture.bind(_e.gl.NEAREST,_e.gl.CLAMP_TO_EDGE),A.needsTerrainPrepare=!1}const X=A&&A+A.tileID.key+g.key;if(X&&!this._demMatrixCache[X]){const _e=this.sourceCache.sourceCache._source.maxzoom;let Ft=g.canonical.z-A.tileID.canonical.z;g.overscaledZ>g.canonical.z&&(g.canonical.z>=_e?Ft=g.canonical.z-_e:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Xr=g.canonical.x-(g.canonical.x>>Ft<<Ft),as=g.canonical.y-(g.canonical.y>>Ft<<Ft),cs=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<Ft),1/(o.EXTENT<<Ft),0]);o.translate(cs,cs,[Xr*o.EXTENT,as*o.EXTENT,0]),this._demMatrixCache[g.key]={matrix:cs,coord:g}}return{u_depth:2,u_terrain:3,u_terrain_dim:A&&A.dem&&A.dem.dim||1,u_terrain_matrix:X?this._demMatrixCache[g.key].matrix:this._emptyDemMatrix,u_terrain_unpack:A&&A.dem&&A.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(A&&A.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:A}}getFramebuffer(g){const A=this.painter,X=A.width/devicePixelRatio,_e=A.height/devicePixelRatio;return!this._fbo||this._fbo.width===X&&this._fbo.height===_e||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new $h(A.context,{width:X,height:_e,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new $h(A.context,{width:X,height:_e,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=A.context.createFramebuffer(X,_e,!0),this._fbo.depthAttachment.set(A.context.createRenderbuffer(A.context.gl.DEPTH_COMPONENT16,X,_e))),this._fbo.colorAttachment.set(g==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const g=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const A=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let Ft=0,Xr=0;Ft<this._coordsTextureSize;Ft++)for(let as=0;as<this._coordsTextureSize;as++,Xr+=4)A[Xr+0]=255&as,A[Xr+1]=255&Ft,A[Xr+2]=as>>8<<4|Ft>>8,A[Xr+3]=0;const X=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(A.buffer)),_e=new $h(g,X,g.gl.RGBA,{premultiply:!1});return _e.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._coordsTexture=_e,_e}pointCoordinate(g){const A=new Uint8Array(4),X=this.painter.context,_e=X.gl;X.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_e.readPixels(g.x,this.painter.height/devicePixelRatio-g.y-1,1,1,_e.RGBA,_e.UNSIGNED_BYTE,A),X.bindFramebuffer.set(null);const Ft=A[0]+(A[2]>>4<<8),Xr=A[1]+((15&A[2])<<8),as=this.coordsIndex[255-A[3]],cs=as&&this.sourceCache.getTileByID(as);if(!cs)return null;const us=this._coordsTextureSize,th=(1<<cs.tileID.canonical.z)*us;return new o.MercatorCoordinate((cs.tileID.canonical.x*us+Ft)/th,(cs.tileID.canonical.y*us+Xr)/th,this.getElevation(cs.tileID,Ft,Xr,us))}getTerrainMesh(){if(this._mesh)return this._mesh;const g=this.painter.context,A=new o.Pos3dArray,X=new o.TriangleIndexArray,_e=this.meshSize,Ft=o.EXTENT/_e,Xr=_e*_e;for(let eh=0;eh<=_e;eh++)for(let ph=0;ph<=_e;ph++)A.emplaceBack(ph*Ft,eh*Ft,0);for(let eh=0;eh<Xr;eh+=_e+1)for(let ph=0;ph<_e;ph++)X.emplaceBack(ph+eh,_e+ph+eh+1,_e+ph+eh+2),X.emplaceBack(ph+eh,_e+ph+eh+2,ph+eh+1);const as=A.length,cs=as+2*(_e+1);for(const eh of[0,1])for(let ph=0;ph<=_e;ph++)for(const Rh of[0,1])A.emplaceBack(ph*Ft,eh*o.EXTENT,Rh);for(let eh=0;eh<2*_e;eh+=2)X.emplaceBack(cs+eh,cs+eh+1,cs+eh+3),X.emplaceBack(cs+eh,cs+eh+3,cs+eh+2),X.emplaceBack(as+eh,as+eh+3,as+eh+1),X.emplaceBack(as+eh,as+eh+2,as+eh+3);const us=A.length,th=us+2*(_e+1);for(const eh of[0,1])for(let ph=0;ph<=_e;ph++)for(const Rh of[0,1])A.emplaceBack(eh*o.EXTENT,ph*Ft,Rh);for(let eh=0;eh<2*_e;eh+=2)X.emplaceBack(us+eh,us+eh+1,us+eh+3),X.emplaceBack(us+eh,us+eh+3,us+eh+2),X.emplaceBack(th+eh,th+eh+3,th+eh+1),X.emplaceBack(th+eh,th+eh+2,th+eh+3);return this._mesh={indexBuffer:g.createIndexBuffer(X),vertexBuffer:g.createVertexBuffer(A,m0.members),segments:o.SegmentVector.simpleSegment(0,0,A.length,X.length)},this._mesh}getMeshFrameDelta(g){return 2*Math.PI*o.earthRadius/Math.pow(2,g)/5}getMinMaxElevation(g){const A=this.getTerrainData(g).tile,X={minElevation:null,maxElevation:null};return A&&A.dem&&(X.minElevation=A.dem.min*this.exaggeration,X.maxElevation=A.dem.max*this.exaggeration),X}}class xv{constructor(g,A,X){this._context=g,this._size=A,this._tileSize=X,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const g of this._objects)g.texture.destroy(),g.fbo.destroy()}_createObject(g){const A=this._context.createFramebuffer(this._tileSize,this._tileSize,!0),X=new $h(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return X.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),A.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_COMPONENT16,this._tileSize,this._tileSize)),A.colorAttachment.set(X.texture),{id:g,fbo:A,texture:X,stamp:-1,inUse:!1}}getObjectForId(g){return this._objects[g]}useObject(g){g.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(A=>g.id!==A),this._recentlyUsed.push(g.id)}stampObject(g){g.stamp=++this._stamp}getOrCreateFreeObject(){for(const A of this._recentlyUsed)if(!this._objects[A].inUse)return this._objects[A];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const g=this._createObject(this._objects.length);return this._objects.push(g),g}freeObject(g){g.inUse=!1}freeAllObjects(){for(const g of this._objects)this.freeObject(g)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(g=>!g.inUse)===!1}}const my={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class g0{constructor(g,A){this.painter=g,this.terrain=A,this.pool=new xv(g.context,30,A.sourceCache.tileSize*A.qualityFactor)}destruct(){this.pool.destruct()}getTexture(g){return this.pool.getObjectForId(g.rtt[this._stacks.length-1].id).texture}prepareForRender(g,A){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=g._order.filter(X=>!g._layers[X].isHidden(A)),this._coordsDescendingInv={};for(const X in g.sourceCaches){this._coordsDescendingInv[X]={};const _e=g.sourceCaches[X].getVisibleCoordinates();for(const Ft of _e){const Xr=this.terrain.sourceCache.getTerrainCoords(Ft);for(const as in Xr)this._coordsDescendingInv[X][as]||(this._coordsDescendingInv[X][as]=[]),this._coordsDescendingInv[X][as].push(Xr[as])}}this._coordsDescendingInvStr={};for(const X of g._order){const _e=g._layers[X],Ft=_e.source;if(my[_e.type]&&!this._coordsDescendingInvStr[Ft]){this._coordsDescendingInvStr[Ft]={};for(const Xr in this._coordsDescendingInv[Ft])this._coordsDescendingInvStr[Ft][Xr]=this._coordsDescendingInv[Ft][Xr].map(as=>as.key).sort().join()}}for(const X of this._renderableTiles)for(const _e in this._coordsDescendingInvStr){const Ft=this._coordsDescendingInvStr[_e][X.tileID.key];Ft&&Ft!==X.rttCoords[_e]&&(X.rtt=[])}}renderLayer(g){if(g.isHidden(this.painter.transform.zoom))return!1;const A=g.type,X=this.painter,_e=this._renderableLayerIds[this._renderableLayerIds.length-1]===g.id;if(my[A]&&(this._prevType&&my[this._prevType]||this._stacks.push([]),this._prevType=A,this._stacks[this._stacks.length-1].push(g.id),!_e))return!0;if(my[this._prevType]||my[A]&&_e){this._prevType=A;const Ft=this._stacks.length-1,Xr=this._stacks[Ft]||[];for(const as of this._renderableTiles){if(this.pool.isFull()&&(Um(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(as),as.rtt[Ft]){const us=this.pool.getObjectForId(as.rtt[Ft].id);if(us.stamp===as.rtt[Ft].stamp){this.pool.useObject(us);continue}}const cs=this.pool.getOrCreateFreeObject();this.pool.useObject(cs),this.pool.stampObject(cs),as.rtt[Ft]={id:cs.id,stamp:cs.stamp},X.context.bindFramebuffer.set(cs.fbo.framebuffer),X.context.clear({color:o.Color.transparent});for(let us=0;us<Xr.length;us++){const th=X.style._layers[Xr[us]],eh=th.source?this._coordsDescendingInv[th.source][as.tileID.key]:[as.tileID];X.context.viewport.set([0,0,cs.fbo.width,cs.fbo.height]),X._renderTileClippingMasks(th,eh),X.renderLayer(X,X.style.sourceCaches[th.source],th,eh),th.source&&(as.rttCoords[th.source]=this._coordsDescendingInvStr[th.source][as.tileID.key])}}return Um(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),my[A]}return!1}}const L0=ge,bv={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},wv=he=>{he.touchstart=he.dragStart,he.touchmoveWindow=he.dragMove,he.touchend=he.dragEnd},Ev={showCompass:!0,showZoom:!0,visualizePitch:!1};class o1{constructor(g,A,X=!1){this._clickTolerance=10;const _e=g.dragRotate._mouseRotate.getClickTolerance(),Ft=g.dragRotate._mousePitch.getClickTolerance();this.element=A,this.mouseRotate=$_({clickTolerance:_e,enable:!0}),this.touchRotate=(({enable:Xr,clickTolerance:as,bearingDegreesPerPixelMoved:cs=.8})=>{const us=new ym;return new fg({clickTolerance:as,move:(th,eh)=>({bearingDelta:(eh.x-th.x)*cs}),moveStateManager:us,enable:Xr,assignEvents:wv})})({clickTolerance:_e,enable:!0}),this.map=g,X&&(this.mousePitch=k0({clickTolerance:Ft,enable:!0}),this.touchPitch=(({enable:Xr,clickTolerance:as,pitchDegreesPerPixelMoved:cs=-.5})=>{const us=new ym;return new fg({clickTolerance:as,move:(th,eh)=>({pitchDelta:(eh.y-th.y)*cs}),moveStateManager:us,enable:Xr,assignEvents:wv})})({clickTolerance:Ft,enable:!0})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ze.addEventListener(A,"mousedown",this.mousedown),ze.addEventListener(A,"touchstart",this.touchstart,{passive:!1}),ze.addEventListener(A,"touchcancel",this.reset)}startMouse(g,A){this.mouseRotate.dragStart(g,A),this.mousePitch&&this.mousePitch.dragStart(g,A),ze.disableDrag()}startTouch(g,A){this.touchRotate.dragStart(g,A),this.touchPitch&&this.touchPitch.dragStart(g,A),ze.disableDrag()}moveMouse(g,A){const X=this.map,{bearingDelta:_e}=this.mouseRotate.dragMove(g,A)||{};if(_e&&X.setBearing(X.getBearing()+_e),this.mousePitch){const{pitchDelta:Ft}=this.mousePitch.dragMove(g,A)||{};Ft&&X.setPitch(X.getPitch()+Ft)}}moveTouch(g,A){const X=this.map,{bearingDelta:_e}=this.touchRotate.dragMove(g,A)||{};if(_e&&X.setBearing(X.getBearing()+_e),this.touchPitch){const{pitchDelta:Ft}=this.touchPitch.dragMove(g,A)||{};Ft&&X.setPitch(X.getPitch()+Ft)}}off(){const g=this.element;ze.removeEventListener(g,"mousedown",this.mousedown),ze.removeEventListener(g,"touchstart",this.touchstart,{passive:!1}),ze.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ze.removeEventListener(window,"touchend",this.touchend),ze.removeEventListener(g,"touchcancel",this.reset),this.offTemp()}offTemp(){ze.enableDrag(),ze.removeEventListener(window,"mousemove",this.mousemove),ze.removeEventListener(window,"mouseup",this.mouseup),ze.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ze.removeEventListener(window,"touchend",this.touchend)}mousedown(g){this.startMouse(o.extend({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),ze.mousePos(this.element,g)),ze.addEventListener(window,"mousemove",this.mousemove),ze.addEventListener(window,"mouseup",this.mouseup)}mousemove(g){this.moveMouse(g,ze.mousePos(this.element,g))}mouseup(g){this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()}touchstart(g){g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ze.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),ze.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ze.addEventListener(window,"touchend",this.touchend))}touchmove(g){g.targetTouches.length!==1?this.reset():(this._lastPos=ze.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))}touchend(g){g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Dy(he,g,A){if(he=new o.LngLat(he.lng,he.lat),g){const X=new o.LngLat(he.lng-360,he.lat),_e=new o.LngLat(he.lng+360,he.lat),Ft=A.locationPoint(he).distSqr(g);A.locationPoint(X).distSqr(g)<Ft?he=X:A.locationPoint(_e).distSqr(g)<Ft&&(he=_e)}for(;Math.abs(he.lng-A.center.lng)>180;){const X=A.locationPoint(he);if(X.x>=0&&X.y>=0&&X.x<=A.width&&X.y<=A.height)break;he.lng>A.center.lng?he.lng-=360:he.lng+=360}return he}const Sv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gv(he,g,A){const X=he.classList;for(const _e in Sv)X.remove(`maplibregl-${A}-anchor-${_e}`);X.add(`maplibregl-${A}-anchor-${g}`)}class jv extends o.Evented{constructor(g,A){if(super(),(g instanceof HTMLElement||A)&&(g=o.extend({element:g},A)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=o.pointGeometry.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=ze.create("div"),this._element.setAttribute("aria-label","Map marker");const X=ze.createNS("http://www.w3.org/2000/svg","svg"),_e=41,Ft=27;X.setAttributeNS(null,"display","block"),X.setAttributeNS(null,"height",`${_e}px`),X.setAttributeNS(null,"width",`${Ft}px`),X.setAttributeNS(null,"viewBox",`0 0 ${Ft} ${_e}`);const Xr=ze.createNS("http://www.w3.org/2000/svg","g");Xr.setAttributeNS(null,"stroke","none"),Xr.setAttributeNS(null,"stroke-width","1"),Xr.setAttributeNS(null,"fill","none"),Xr.setAttributeNS(null,"fill-rule","evenodd");const as=ze.createNS("http://www.w3.org/2000/svg","g");as.setAttributeNS(null,"fill-rule","nonzero");const cs=ze.createNS("http://www.w3.org/2000/svg","g");cs.setAttributeNS(null,"transform","translate(3.0, 29.0)"),cs.setAttributeNS(null,"fill","#000000");const us=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _d of us){const qh=ze.createNS("http://www.w3.org/2000/svg","ellipse");qh.setAttributeNS(null,"opacity","0.04"),qh.setAttributeNS(null,"cx","10.5"),qh.setAttributeNS(null,"cy","5.80029008"),qh.setAttributeNS(null,"rx",_d.rx),qh.setAttributeNS(null,"ry",_d.ry),cs.appendChild(qh)}const th=ze.createNS("http://www.w3.org/2000/svg","g");th.setAttributeNS(null,"fill",this._color);const eh=ze.createNS("http://www.w3.org/2000/svg","path");eh.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),th.appendChild(eh);const ph=ze.createNS("http://www.w3.org/2000/svg","g");ph.setAttributeNS(null,"opacity","0.25"),ph.setAttributeNS(null,"fill","#000000");const Rh=ze.createNS("http://www.w3.org/2000/svg","path");Rh.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ph.appendChild(Rh);const Bh=ze.createNS("http://www.w3.org/2000/svg","g");Bh.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Bh.setAttributeNS(null,"fill","#FFFFFF");const Ch=ze.createNS("http://www.w3.org/2000/svg","g");Ch.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ed=ze.createNS("http://www.w3.org/2000/svg","circle");ed.setAttributeNS(null,"fill","#000000"),ed.setAttributeNS(null,"opacity","0.25"),ed.setAttributeNS(null,"cx","5.5"),ed.setAttributeNS(null,"cy","5.5"),ed.setAttributeNS(null,"r","5.4999962");const Ed=ze.createNS("http://www.w3.org/2000/svg","circle");Ed.setAttributeNS(null,"fill","#FFFFFF"),Ed.setAttributeNS(null,"cx","5.5"),Ed.setAttributeNS(null,"cy","5.5"),Ed.setAttributeNS(null,"r","5.4999962"),Ch.appendChild(ed),Ch.appendChild(Ed),as.appendChild(cs),as.appendChild(th),as.appendChild(ph),as.appendChild(Bh),as.appendChild(Ch),X.appendChild(as),X.setAttributeNS(null,"height",_e*this._scale+"px"),X.setAttributeNS(null,"width",Ft*this._scale+"px"),this._element.appendChild(X),this._offset=o.pointGeometry.convert(g&&g.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",X=>{X.preventDefault()}),this._element.addEventListener("mousedown",X=>{X.preventDefault()}),Gv(this._element,this._anchor,"marker"),this._popup=null}addTo(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ze.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){const _e=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_e,-1*(38.1-13.5+_e)],"bottom-right":[-_e,-1*(38.1-13.5+_e)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(g){const A=g.code,X=g.charCode||g.keyCode;A!=="Space"&&A!=="Enter"&&X!==32&&X!==13||this.togglePopup()}_onMapClick(g){const A=g.originalEvent.target,X=this._element;this._popup&&(A===X||X.contains(A))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this}_update(g){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Dy(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let X="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?X="rotateX(0deg)":this._pitchAlignment==="map"&&(X=`rotateX(${this._map.getPitch()}deg)`),g&&g.type!=="moveend"||(this._pos=this._pos.round()),ze.setTransform(this._element,`${Sv[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${X} ${A}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _e=this._map.unproject(this._pos),Ft=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_e.distanceTo(this._lngLat)>20*Ft?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(g){return this._offset=o.pointGeometry.convert(g),this._update(),this}_onMove(g){if(!this._isDragging){const A=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=A}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(g){return this._rotation=g||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(g){return this._rotationAlignment=g||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const a1={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let e0,iv=0,R0=!1;const jg={maxWidth:100,unit:"metric"};function s1(he,g,A){const X=A&&A.maxWidth||100,_e=he._container.clientHeight/2,Ft=he.unproject([0,_e]),Xr=he.unproject([X,_e]),as=Ft.distanceTo(Xr);if(A&&A.unit==="imperial"){const cs=3.2808*as;cs>5280?rv(g,X,cs/5280,he._getUIString("ScaleControl.Miles")):rv(g,X,cs,he._getUIString("ScaleControl.Feet"))}else A&&A.unit==="nautical"?rv(g,X,as/1852,he._getUIString("ScaleControl.NauticalMiles")):as>=1e3?rv(g,X,as/1e3,he._getUIString("ScaleControl.Kilometers")):rv(g,X,as,he._getUIString("ScaleControl.Meters"))}function rv(he,g,A,X){const _e=function(Ft){const Xr=Math.pow(10,`${Math.floor(Ft)}`.length-1);let as=Ft/Xr;return as=as>=10?10:as>=5?5:as>=3?3:as>=2?2:as>=1?1:function(cs){const us=Math.pow(10,Math.ceil(-Math.log(cs)/Math.LN10));return Math.round(cs*us)/us}(as),Xr*as}(A);he.style.width=g*(_e/A)+"px",he.innerHTML=`${_e}&nbsp;${X}`}const Q1={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ex=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function B_(he){if(he){if(typeof he=="number"){const g=Math.round(Math.sqrt(.5*Math.pow(he,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,he),"top-left":new o.pointGeometry(g,g),"top-right":new o.pointGeometry(-g,g),bottom:new o.pointGeometry(0,-he),"bottom-left":new o.pointGeometry(g,-g),"bottom-right":new o.pointGeometry(-g,-g),left:new o.pointGeometry(he,0),right:new o.pointGeometry(-he,0)}}if(he instanceof o.pointGeometry||Array.isArray(he)){const g=o.pointGeometry.convert(he);return{center:g,top:g,"top-left":g,"top-right":g,bottom:g,"bottom-left":g,"bottom-right":g,left:g,right:g}}return{center:o.pointGeometry.convert(he.center||[0,0]),top:o.pointGeometry.convert(he.top||[0,0]),"top-left":o.pointGeometry.convert(he["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(he["top-right"]||[0,0]),bottom:o.pointGeometry.convert(he.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(he["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(he["bottom-right"]||[0,0]),left:o.pointGeometry.convert(he.left||[0,0]),right:o.pointGeometry.convert(he.right||[0,0])}}return B_(new o.pointGeometry(0,0))}const T1=ge,_0={supported:x,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Q0{constructor(he){var g;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(he=o.extend({},bv,he)).minZoom!=null&&he.maxZoom!=null&&he.minZoom>he.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(he.minPitch!=null&&he.maxPitch!=null&&he.minPitch>he.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(he.minPitch!=null&&he.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(he.maxPitch!=null&&he.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Zm(he.minZoom,he.maxZoom,he.minPitch,he.maxPitch,he.renderWorldCopies),{bearingSnap:he.bearingSnap}),this._interactive=he.interactive,this._cooperativeGestures=he.cooperativeGestures,this._maxTileCacheSize=he.maxTileCacheSize,this._failIfMajorPerformanceCaveat=he.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=he.preserveDrawingBuffer,this._antialias=he.antialias,this._trackResize=he.trackResize,this._bearingSnap=he.bearingSnap,this._refreshExpiredTiles=he.refreshExpiredTiles,this._fadeDuration=he.fadeDuration,this._crossSourceCollisions=he.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=he.collectResourceTiming,this._renderTaskQueue=new n1,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Vv,he.locale),this._clickTolerance=he.clickTolerance,this._pixelRatio=(g=he.pixelRatio)!==null&&g!==void 0?g:devicePixelRatio,this._imageQueueHandle=ah.addThrottleControl(()=>this.isMoving()),this._requestManager=new ch(he.transformRequest),typeof he.container=="string"){if(this._container=document.getElementById(he.container),!this._container)throw new Error(`Container '${he.container}' not found.`)}else{if(!(he.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=he.container}he.maxBounds&&this.setMaxBounds(he.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new p0(this,he),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=he.hash&&new R_(typeof he.hash=="string"&&he.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:he.center,zoom:he.zoom,bearing:he.bearing,pitch:he.pitch}),he.bounds&&(this.resize(),this.fitBounds(he.bounds,o.extend({},he.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=he.localIdeographFontFamily,he.style&&this.setStyle(he.style,{localIdeographFontFamily:he.localIdeographFontFamily}),he.attributionControl&&this.addControl(new Qy({customAttribution:he.customAttribution})),he.maplibreLogo&&this.addControl(new ev,he.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new o.Event(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new o.Event(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new o.Event("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(he,g){if(g===void 0&&(g=he.getDefaultPosition?he.getDefaultPosition():"top-right"),!he||!he.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const A=he.onAdd(this);this._controls.push(he);const X=this._controlPositions[g];return g.indexOf("bottom")!==-1?X.insertBefore(A,X.firstChild):X.appendChild(A),this}removeControl(he){if(!he||!he.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const g=this._controls.indexOf(he);return g>-1&&this._controls.splice(g,1),he.onRemove(this),this}hasControl(he){return this._controls.indexOf(he)>-1}calculateCameraOptionsFromTo(he,g,A,X){return X==null&&this.terrain&&(X=this.transform.getElevation(A,this.terrain)),super.calculateCameraOptionsFromTo(he,g,A,X)}resize(he){const g=this._containerDimensions(),A=g[0],X=g[1];this._resizeCanvas(A,X,this.getPixelRatio()),this.transform.resize(A,X),this.painter.resize(A,X,this.getPixelRatio());const _e=!this._moving;return _e&&(this.stop(),this.fire(new o.Event("movestart",he)).fire(new o.Event("move",he))),this.fire(new o.Event("resize",he)),_e&&this.fire(new o.Event("moveend",he)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(he){const[g,A]=this._containerDimensions();this._pixelRatio=he,this._resizeCanvas(g,A,he),this.painter.resize(g,A,he)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(he){return this.transform.setMaxBounds(o.LngLatBounds.convert(he)),this._update()}setMinZoom(he){if((he=he??-2)>=-2&&he<=this.transform.maxZoom)return this.transform.minZoom=he,this._update(),this.getZoom()<he&&this.setZoom(he),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(he){if((he=he??22)>=this.transform.minZoom)return this.transform.maxZoom=he,this._update(),this.getZoom()>he&&this.setZoom(he),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(he){if((he=he??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(he>=0&&he<=this.transform.maxPitch)return this.transform.minPitch=he,this._update(),this.getPitch()<he&&this.setPitch(he),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(he){if((he=he??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(he>=this.transform.minPitch)return this.transform.maxPitch=he,this._update(),this.getPitch()>he&&this.setPitch(he),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(he){return this.transform.renderWorldCopies=he,this._update()}project(he){return this.transform.locationPoint(o.LngLat.convert(he),this.style&&this.terrain)}unproject(he){return this.transform.pointLocation(o.pointGeometry.convert(he),this.terrain)}isMoving(){var he;return this._moving||((he=this.handlers)===null||he===void 0?void 0:he.isMoving())}isZooming(){var he;return this._zooming||((he=this.handlers)===null||he===void 0?void 0:he.isZooming())}isRotating(){var he;return this._rotating||((he=this.handlers)===null||he===void 0?void 0:he.isRotating())}_createDelegatedListener(he,g,A){if(he==="mouseenter"||he==="mouseover"){let X=!1;return{layer:g,listener:A,delegates:{mousemove:Ft=>{const Xr=this.getLayer(g)?this.queryRenderedFeatures(Ft.point,{layers:[g]}):[];Xr.length?X||(X=!0,A.call(this,new am(he,this,Ft.originalEvent,{features:Xr}))):X=!1},mouseout:()=>{X=!1}}}}if(he==="mouseleave"||he==="mouseout"){let X=!1;return{layer:g,listener:A,delegates:{mousemove:Xr=>{(this.getLayer(g)?this.queryRenderedFeatures(Xr.point,{layers:[g]}):[]).length?X=!0:X&&(X=!1,A.call(this,new am(he,this,Xr.originalEvent)))},mouseout:Xr=>{X&&(X=!1,A.call(this,new am(he,this,Xr.originalEvent)))}}}}{const X=_e=>{const Ft=this.getLayer(g)?this.queryRenderedFeatures(_e.point,{layers:[g]}):[];Ft.length&&(_e.features=Ft,A.call(this,_e),delete _e.features)};return{layer:g,listener:A,delegates:{[he]:X}}}}on(he,g,A){if(A===void 0)return super.on(he,g);const X=this._createDelegatedListener(he,g,A);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[he]=this._delegatedListeners[he]||[],this._delegatedListeners[he].push(X);for(const _e in X.delegates)this.on(_e,X.delegates[_e]);return this}once(he,g,A){if(A===void 0)return super.once(he,g);const X=this._createDelegatedListener(he,g,A);for(const _e in X.delegates)this.once(_e,X.delegates[_e]);return this}off(he,g,A){return A===void 0?super.off(he,g):(this._delegatedListeners&&this._delegatedListeners[he]&&(X=>{const _e=this._delegatedListeners[he];for(let Ft=0;Ft<_e.length;Ft++){const Xr=_e[Ft];if(Xr.layer===g&&Xr.listener===A){for(const as in Xr.delegates)this.off(as,Xr.delegates[as]);return _e.splice(Ft,1),this}}})(),this)}queryRenderedFeatures(he,g){if(!this.style)return[];let A;const X=he instanceof o.pointGeometry||Array.isArray(he),_e=X?he:[[0,0],[this.transform.width,this.transform.height]];if(g=g||(X?{}:he)||{},_e instanceof o.pointGeometry||typeof _e[0]=="number")A=[o.pointGeometry.convert(_e)];else{const Ft=o.pointGeometry.convert(_e[0]),Xr=o.pointGeometry.convert(_e[1]);A=[Ft,new o.pointGeometry(Xr.x,Ft.y),Xr,new o.pointGeometry(Ft.x,Xr.y),Ft]}return this.style.queryRenderedFeatures(A,g,this.transform)}querySourceFeatures(he,g){return this.style.querySourceFeatures(he,g)}setStyle(he,g){return(g=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&he?(this._diffStyle(he,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(he,g))}setTransformRequest(he){return this._requestManager.setTransformRequest(he),this}_getUIString(he){const g=this._locale[he];if(g==null)throw new Error(`Missing UI string '${he}'`);return g}_updateStyle(he,g){if(g.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(he,g));const A=this.style&&g.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!he)),he?(this.style=new od(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof he=="string"?this.style.loadURL(he,g,A):this.style.loadJSON(he,g,A),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new od(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(he,g){if(typeof he=="string"){const A=this._requestManager.transformRequest(he,rl.Style);o.getJSON(A,(X,_e)=>{X?this.fire(new o.ErrorEvent(X)):_e&&this._updateDiff(_e,g)})}else typeof he=="object"&&this._updateDiff(he,g)}_updateDiff(he,g){try{this.style.setState(he,g)&&this._update(!0)}catch(A){o.warnOnce(`Unable to perform style diff: ${A.message||A.error||A}.  Rebuilding the style from scratch.`),this._updateStyle(he,g)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(he,g){return this._lazyInitEmptyStyle(),this.style.addSource(he,g),this._update(!0)}isSourceLoaded(he){const g=this.style&&this.style.sourceCaches[he];if(g!==void 0)return g.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${he}'`)))}setTerrain(he){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),he){const g=this.style.sourceCaches[he.source];if(!g)throw new Error(`cannot load terrain, because there exists no source with ID: ${he.source}`);this.terrain=new tv(this.painter,g,he),this.painter.renderToTexture=new g0(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=A=>{A.dataType==="style"?this.terrain.sourceCache.freeRtt():A.dataType==="source"&&A.tile&&(A.sourceId===he.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(A.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new o.Event("terrain",{terrain:he})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const he=this.style&&this.style.sourceCaches;for(const g in he){const A=he[g]._tiles;for(const X in A){const _e=A[X];if(_e.state!=="loaded"&&_e.state!=="errored")return!1}}return!0}addSourceType(he,g,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(he,g,A)}removeSource(he){return this.style.removeSource(he),this._update(!0)}getSource(he){return this.style.getSource(he)}addImage(he,g,{pixelRatio:A=1,sdf:X=!1,stretchX:_e,stretchY:Ft,content:Xr}={}){if(this._lazyInitEmptyStyle(),g instanceof HTMLImageElement||o.isImageBitmap(g)){const{width:as,height:cs,data:us}=o.exported.getImageData(g);this.style.addImage(he,{data:new o.RGBAImage({width:as,height:cs},us),pixelRatio:A,stretchX:_e,stretchY:Ft,content:Xr,sdf:X,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:as,height:cs,data:us}=g,th=g;this.style.addImage(he,{data:new o.RGBAImage({width:as,height:cs},new Uint8Array(us)),pixelRatio:A,stretchX:_e,stretchY:Ft,content:Xr,sdf:X,version:0,userImage:th}),th.onAdd&&th.onAdd(this,he)}}}updateImage(he,g){const A=this.style.getImage(he);if(!A)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const X=g instanceof HTMLImageElement||o.isImageBitmap(g)?o.exported.getImageData(g):g,{width:_e,height:Ft,data:Xr}=X;if(_e===void 0||Ft===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_e!==A.data.width||Ft!==A.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const as=!(g instanceof HTMLImageElement||o.isImageBitmap(g));A.data.replace(Xr,as),this.style.updateImage(he,A)}hasImage(he){return he?!!this.style.getImage(he):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(he){this.style.removeImage(he)}loadImage(he,g){ah.getImage(this._requestManager.transformRequest(he,rl.Image),g)}listImages(){return this.style.listImages()}addLayer(he,g){return this._lazyInitEmptyStyle(),this.style.addLayer(he,g),this._update(!0)}moveLayer(he,g){return this.style.moveLayer(he,g),this._update(!0)}removeLayer(he){return this.style.removeLayer(he),this._update(!0)}getLayer(he){return this.style.getLayer(he)}setLayerZoomRange(he,g,A){return this.style.setLayerZoomRange(he,g,A),this._update(!0)}setFilter(he,g,A={}){return this.style.setFilter(he,g,A),this._update(!0)}getFilter(he){return this.style.getFilter(he)}setPaintProperty(he,g,A,X={}){return this.style.setPaintProperty(he,g,A,X),this._update(!0)}getPaintProperty(he,g){return this.style.getPaintProperty(he,g)}setLayoutProperty(he,g,A,X={}){return this.style.setLayoutProperty(he,g,A,X),this._update(!0)}getLayoutProperty(he,g){return this.style.getLayoutProperty(he,g)}setGlyphs(he,g={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(he,g),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(he,g,A={}){return this._lazyInitEmptyStyle(),this.style.addSprite(he,g,A,X=>{X||this._update(!0)}),this}removeSprite(he){return this._lazyInitEmptyStyle(),this.style.removeSprite(he),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(he,g={}){return this._lazyInitEmptyStyle(),this.style.setSprite(he,g,A=>{A||this._update(!0)}),this}setLight(he,g={}){return this._lazyInitEmptyStyle(),this.style.setLight(he,g),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(he,g){return this.style.setFeatureState(he,g),this._update()}removeFeatureState(he,g){return this.style.removeFeatureState(he,g),this._update()}getFeatureState(he){return this.style.getFeatureState(he)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let he=0,g=0;return this._container&&(he=this._container.clientWidth||400,g=this._container.clientHeight||300),[he,g]}_setupContainer(){const he=this._container;he.classList.add("maplibregl-map");const g=this._canvasContainer=ze.create("div","maplibregl-canvas-container",he);this._interactive&&g.classList.add("maplibregl-interactive"),this._canvas=ze.create("canvas","maplibregl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const A=this._containerDimensions();this._resizeCanvas(A[0],A[1],this.getPixelRatio());const X=this._controlContainer=ze.create("div","maplibregl-control-container",he),_e=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Ft=>{_e[Ft]=ze.create("div",`maplibregl-ctrl-${Ft} `,X)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const he=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=ze.create("div","maplibregl-cooperative-gesture-screen",he);let g="Control",A=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(A=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",g="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${A}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",X=>{X.key===g&&(this._metaPress=!0)}),document.addEventListener("keyup",X=>{X.key===g&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",X=>{this._onCooperativeGesture(X,this._metaPress,1)},!1),this._canvasContainer.classList.remove("maplibregl-touch-drag-pan")}_resizeCanvas(he,g,A){this._canvas.width=A*he,this._canvas.height=A*g,this._canvas.style.width=`${he}px`,this._canvas.style.height=`${g}px`}_setupPainter(){const he=o.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1});let g=null;this._canvas.addEventListener("webglcontextcreationerror",X=>{g={requestedAttributes:he},X&&(g.statusMessage=X.statusMessage,g.type=X.type)},{once:!0});const A=this._canvas.getContext("webgl",he)||this._canvas.getContext("experimental-webgl",he);if(!A){const X="Failed to initialize WebGL";throw g?(g.message=X,new Error(JSON.stringify(g))):new Error(X)}this.painter=new Pm(A,this.transform),Bt.testSupport(A)}_contextLost(he){he.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:he}))}_contextRestored(he){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:he}))}_onMapScroll(he){if(he.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(he,g,A){return!g&&A<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(he){return this.style?(this._styleDirty=this._styleDirty||he,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(he){return this._update(),this._renderTaskQueue.add(he)}_cancelRenderFrame(he){this._renderTaskQueue.remove(he)}_render(he){let g,A=0;const X=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=X.createQueryEXT(),X.beginQueryEXT(X.TIME_ELAPSED_EXT,g),A=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(he),this._removed)return;let _e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Xr=this.transform.zoom,as=o.exported.now();this.style.zoomHistory.update(Xr,as);const cs=new o.EvaluationParameters(Xr,{now:as,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),us=cs.crossFadingFactor();us===1&&us===this._crossFadingFactor||(_e=!0,this._crossFadingFactor=us),this.style.update(cs)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._imageQueueDirty=ah.processQueue()>0,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||_e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const Xr=o.exported.now()-A;X.endQueryEXT(X.TIME_ELAPSED_EXT,g),setTimeout(()=>{const as=X.getQueryObjectEXT(g,X.QUERY_RESULT_EXT)/1e6;X.deleteQueryEXT(g),this.fire(new o.Event("gpu-timing-frame",{cpuTime:Xr,gpuTime:as}))},50)}if(this.listens("gpu-timing-layer")){const Xr=this.painter.collectGpuTimers();setTimeout(()=>{const as=this.painter.queryGpuTimers(Xr);this.fire(new o.Event("gpu-timing-layer",{layerTimes:as}))},50)}const Ft=this._sourcesDirty||this._styleDirty||this._placementDirty||this._imageQueueDirty;return Ft||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Ft||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const g of this._controls)g.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1)),ah.removeThrottleControl(this._imageQueueHandle);const he=this.painter.context.gl.getExtension("WEBGL_lose_context");he&&he.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ze.remove(this._canvasContainer),ze.remove(this._controlContainer),this._cooperativeGestures&&ze.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(he=>{o.PerformanceUtils.frame(he),this._frame=null,this._render(he)}))}_onWindowOnline(){this._update()}_onWindowResize(he){this._trackResize&&this.resize({originalEvent:he})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(he){this._showTileBoundaries!==he&&(this._showTileBoundaries=he,this._update())}get showPadding(){return!!this._showPadding}set showPadding(he){this._showPadding!==he&&(this._showPadding=he,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(he){this._showCollisionBoxes!==he&&(this._showCollisionBoxes=he,he?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(he){this._showOverdrawInspector!==he&&(this._showOverdrawInspector=he,this._update())}get repaint(){return!!this._repaint}set repaint(he){this._repaint!==he&&(this._repaint=he,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(he){this._vertices=he,this._update()}get version(){return L0}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(he){this.options=o.extend({},Ev,he),this._container=ze.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",g=>g.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",g=>this._map.zoomIn({},{originalEvent:g})),ze.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",g=>this._map.zoomOut({},{originalEvent:g})),ze.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",g=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:g}):this._map.resetNorth({},{originalEvent:g})}),this._compassIcon=ze.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const he=this._map.getZoom(),g=he===this._map.getMaxZoom(),A=he===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=A,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",A.toString())}_rotateCompassArrow(){const he=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=he}onAdd(he){return this._map=he,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new o1(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ze.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(he,g){const A=ze.create("button",he,this._container);return A.type="button",A.addEventListener("click",g),A}_setButtonTitle(he,g){const A=this._map._getUIString(`NavigationControl.${g}`);he.title=A,he.setAttribute("aria-label",A)}},GeolocateControl:class extends o.Evented{constructor(he){super(),this.options=o.extend({},a1,he),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(he){var g;return this._map=he,this._container=ze.create("div","maplibregl-ctrl maplibregl-ctrl-group"),g=this._setupUI,e0!==void 0?g(e0):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(A=>{e0=A.state!=="denied",g(e0)}):(e0=!!window.navigator.geolocation,g(e0)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ze.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,iv=0,R0=!1}_isOutOfMapMaxBounds(he){const g=this._map.getMaxBounds(),A=he.coords;return g&&(A.longitude<g.getWest()||A.longitude>g.getEast()||A.latitude<g.getSouth()||A.latitude>g.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(he){if(this._map){if(this._isOutOfMapMaxBounds(he))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",he)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=he,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(he),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(he),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",he)),this._finish()}}_updateCamera(he){const g=new o.LngLat(he.coords.longitude,he.coords.latitude),A=he.coords.accuracy,X=this._map.getBearing(),_e=o.extend({bearing:X},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(A),_e,{geolocateSource:!0})}_updateMarker(he){if(he){const g=new o.LngLat(he.coords.longitude,he.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=he.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const he=this._map._container.clientHeight/2,g=this._map.unproject([0,he]),A=this._map.unproject([1,he]),X=g.distanceTo(A),_e=Math.ceil(2*this._accuracy/X);this._circleElement.style.width=`${_e}px`,this._circleElement.style.height=`${_e}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(he){if(this._map){if(this.options.trackUserLocation)if(he.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(he.code===3&&R0)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",he)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(he){if(this._container.addEventListener("contextmenu",g=>g.preventDefault()),this._geolocateButton=ze.create("button","maplibregl-ctrl-geolocate",this._container),ze.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",he===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ze.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jv(this._dotElement),this._circleElement=ze.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jv({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",g=>{g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g.originalEvent&&g.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":iv--,R0=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let he;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),iv++,iv>1?(he={maximumAge:6e5,timeout:0},R0=!0):(he=this.options.positionOptions,R0=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,he)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qy,LogoControl:ev,ScaleControl:class{constructor(he){this.options=o.extend({},jg,he),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){s1(this._map,this._container,this.options)}onAdd(he){return this._map=he,this._container=ze.create("div","maplibregl-ctrl maplibregl-ctrl-scale",he.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ze.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(he){this.options.unit=he,s1(this._map,this._container,this.options)}},FullscreenControl:class extends o.Evented{constructor(he={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,he&&he.container&&(he.container instanceof HTMLElement?this._container=he.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(he){return this._map=he,this._container||(this._container=this._map.getContainer()),this._controlContainer=ze.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ze.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const he=this._fullscreenButton=ze.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ze.create("span","maplibregl-ctrl-icon",he).setAttribute("aria-hidden","true"),he.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const he=this._getTitle();this._fullscreenButton.setAttribute("aria-label",he),this._fullscreenButton.title=he}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this.fire(new o.Event(this._fullscreen?"fullscreenstart":"fullscreenend"))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(he){this.options=he,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(he){return this._map=he,this._container=ze.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ze.create("button","maplibregl-ctrl-terrain",this._container),ze.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ze.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(he){super(),this.options=o.extend(Object.create(Q1),he),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(he){return this._map&&this.remove(),this._map=he,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ze.remove(this._content),this._container&&(ze.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(he){return this._lngLat=o.LngLat.convert(he),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(he){return this.setDOMContent(document.createTextNode(he))}setHTML(he){const g=document.createDocumentFragment(),A=document.createElement("body");let X;for(A.innerHTML=he;X=A.firstChild,X;)g.appendChild(X);return this.setDOMContent(g)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(he){return this.options.maxWidth=he,this._update(),this}setDOMContent(he){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ze.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(he),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(he){this._container&&this._container.classList.add(he)}removeClassName(he){this._container&&this._container.classList.remove(he)}setOffset(he){return this.options.offset=he,this._update(),this}toggleClassName(he){if(this._container)return this._container.classList.toggle(he)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ze.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(he){this._update(he.point)}_onMouseMove(he){this._update(he.point)}_onDrag(he){this._update(he.point)}_update(he){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=ze.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ze.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(Ft=>this._container.classList.add(Ft)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Dy(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!he))return;const g=this._pos=this._trackPointer&&he?he:this._map.project(this._lngLat);let A=this.options.anchor;const X=B_(this.options.offset);if(!A){const Ft=this._container.offsetWidth,Xr=this._container.offsetHeight;let as;as=g.y+X.bottom.y<Xr?["top"]:g.y>this._map.transform.height-Xr?["bottom"]:[],g.x<Ft/2?as.push("left"):g.x>this._map.transform.width-Ft/2&&as.push("right"),A=as.length===0?"bottom":as.join("-")}const _e=g.add(X[A]).round();ze.setTransform(this._container,`${Sv[A]} translate(${_e.x}px,${_e.y}px)`),Gv(this._container,A,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const he=this._container.querySelector(ex);he&&he.focus()}_onClose(){this.remove()}},Marker:jv,Style:od,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:ep,GeoJSONSource:bp,ImageSource:qd,RasterDEMTileSource:gd,RasterTileSource:kd,VectorTileSource:wf,VideoSource:Vd,prewarm:function(){Ap().acquire(If)},clearPrewarmedResources:function(){const he=jf;he&&(he.isPreloaded()&&he.numActive()===1?(he.release(If),jf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return T1},get workerCount(){return Xf.workerCount},set workerCount(he){Xf.workerCount=he},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(he){o.config.MAX_PARALLEL_IMAGE_REQUESTS=he},workerUrl:"",addProtocol(he,g){o.config.REGISTERED_PROTOCOLS[he]=g},removeProtocol(he){delete o.config.REGISTERED_PROTOCOLS[he]}};return Uv.extend(_0,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),_0});var f=a;return f})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl__default=getDefaultExportFromCjs(maplibreGlExports),version$2="3.7.5",VERSION=version$2,_hasatob=typeof atob=="function",_hasbtoa=typeof btoa=="function",_hasBuffer=typeof Buffer=="function",_TD=typeof TextDecoder=="function"?new TextDecoder:void 0,_TE=typeof TextEncoder=="function"?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_mkUriSafe=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),_tidyB64=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=e=>{let t,r,n,a,s="";const f=e.length%3;for(let o=0;o<e.length;){if((r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(a=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|a,s+=b64chs[t>>18&63]+b64chs[t>>12&63]+b64chs[t>>6&63]+b64chs[t&63]}return f?s.slice(0,f-3)+"===".substring(f):s},_btoa=_hasbtoa?e=>btoa(e):_hasBuffer?e=>Buffer.from(e,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,a=e.length;n<a;n+=4096)r.push(_fromCC.apply(null,e.subarray(n,n+4096)));return _btoa(r.join(""))},fromUint8Array=(e,t=!1)=>t?_mkUriSafe(_fromUint8Array(e)):_fromUint8Array(e),cb_utob=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?_fromCC(192|t>>>6)+_fromCC(128|t&63):_fromCC(224|t>>>12&15)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return _fromCC(240|t>>>18&7)+_fromCC(128|t>>>12&63)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=e=>e.replace(re_utob,cb_utob),_encode=_hasBuffer?e=>Buffer.from(e,"utf8").toString("base64"):_TE?e=>_fromUint8Array(_TE.encode(e)):e=>_btoa(utob(e)),encode=(e,t=!1)=>t?_mkUriSafe(_encode(e)):_encode(e),encodeURI=e=>encode(e,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return _fromCC((r>>>10)+55296)+_fromCC((r&1023)+56320);case 3:return _fromCC((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return _fromCC((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=e=>e.replace(re_btou,cb_btou),atobPolyfill=e=>{if(e=e.replace(/\s+/g,""),!b64re.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,a;for(let s=0;s<e.length;)t=b64tab[e.charAt(s++)]<<18|b64tab[e.charAt(s++)]<<12|(n=b64tab[e.charAt(s++)])<<6|(a=b64tab[e.charAt(s++)]),r+=n===64?_fromCC(t>>16&255):a===64?_fromCC(t>>16&255,t>>8&255):_fromCC(t>>16&255,t>>8&255,t&255);return r},_atob=_hasatob?e=>atob(_tidyB64(e)):_hasBuffer?e=>Buffer.from(e,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?e=>_U8Afrom(Buffer.from(e,"base64")):e=>_U8Afrom(_atob(e).split("").map(t=>t.charCodeAt(0))),toUint8Array=e=>_toUint8Array(_unURI(e)),_decode=_hasBuffer?e=>Buffer.from(e,"base64").toString("utf8"):_TD?e=>_TD.decode(_toUint8Array(e)):e=>btou(_atob(e)),_unURI=e=>_tidyB64(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),decode=e=>_decode(_unURI(e)),isValid=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},_noEnum=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){const e=(t,r)=>Object.defineProperty(String.prototype,t,_noEnum(r));e("fromBase64",function(){return decode(this)}),e("toBase64",function(t){return encode(this,t)}),e("toBase64URI",function(){return encode(this,!0)}),e("toBase64URL",function(){return encode(this,!0)}),e("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){const e=(t,r)=>Object.defineProperty(Uint8Array.prototype,t,_noEnum(r));e("toBase64",function(t){return fromUint8Array(this,t)}),e("toBase64URI",function(){return fromUint8Array(this,!0)}),e("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version$2,VERSION,atob:_atob,atobPolyfill,btoa:_btoa,btoaPolyfill,fromBase64:decode,toBase64:encode,encode,encodeURI,encodeURL:encodeURI,utob,btou,decode,isValid,fromUint8Array,toUint8Array,extendString,extendUint8Array,extendBuiltins};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(e,t,r){if(native.randomUUID&&!t&&!e)return native.randomUUID();e=e||{};const n=e.random||(e.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let a=0;a<16;++a)t[r+a]=n[a];return t}return unsafeStringify(n)}function tryGettingFetch(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class ClientConfig{constructor(){this._apiKey="",this._fetch=tryGettingFetch()}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}}const config$1=new ClientConfig,LanguageGeocoding={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languageCodeSet$1=new Set(Object.values(LanguageGeocoding));function getAutoLanguageGeocoding(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const e=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet$1.has(t));return e.length?e[0]:LanguageGeocoding.ENGLISH}var __async$4=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});function callFetch(e){return __async$4(this,arguments,function*(t,r={}){if(config$1.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(t).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return config$1.fetch(t,r)})}const defaults$1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(defaults$1);class ServiceError extends Error{constructor(t,r=""){super(`Call to enpoint ${t.url} failed with the status code ${t.status}. ${r}`),this.res=t}}var __async$3=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages$3={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function addLanguageGeocodingOptions(e,t){if(t.language==null)return;const r=Array.from(new Set((Array.isArray(t.language)?t.language:[t.language]).map(n=>n===LanguageGeocoding.AUTO?getAutoLanguageGeocoding():n))).join(",");e.set("language",r)}function addCommonForwardAndReverseGeocodingOptions(e,t){var r;e.set("key",(r=t.apiKey)!=null?r:config$1.apiKey),t.limit!=null&&e.set("limit",String(t.limit)),t.types!=null&&e.set("types",t.types.join(",")),addLanguageGeocodingOptions(e,t)}function addForwardGeocodingOptions(e,t){addCommonForwardAndReverseGeocodingOptions(e,t),t.bbox!=null&&e.set("bbox",t.bbox.join(",")),t.proximity!=null&&e.set("proximity",t.proximity.join(",")),t.country!=null&&e.set("country",t.country.join(",")),t.fuzzyMatch!=null&&e.set("fuzzyMatch",t.fuzzyMatch?"true":"false"),t.autocomplete!=null&&e.set("autocomplete",t.autocomplete?"true":"false")}function forward(e){return __async$3(this,arguments,function*(t,r={}){var n;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const a=new URL(`geocoding/${encodeURIComponent(t)}.json`,defaults$1.maptilerApiURL),{searchParams:s}=a;addForwardGeocodingOptions(s,r);const f=a.toString(),o=yield callFetch(f);if(!o.ok)throw new ServiceError(o,(n=customMessages$3[o.status])!=null?n:"");return yield o.json()})}function reverse(e){return __async$3(this,arguments,function*(t,r={}){var n;if(!Array.isArray(t)||t.length<2)throw new Error("The position must be an array of form [lng, lat].");const a=new URL(`geocoding/${t[0]},${t[1]}.json`,defaults$1.maptilerApiURL);addCommonForwardAndReverseGeocodingOptions(a.searchParams,r);const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,(n=customMessages$3[f.status])!=null?n:"");return yield f.json()})}function byId(e){return __async$3(this,arguments,function*(t,r={}){var n;const a=new URL(`geocoding/${t}.json`,defaults$1.maptilerApiURL);addLanguageGeocodingOptions(a.searchParams,r);const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,(n=customMessages$3[f.status])!=null?n:"");return yield f.json()})}function batch(e){return __async$3(this,arguments,function*(t,r={}){var n;if(!t.length)return[];const a=t.map(P=>encodeURIComponent(P)).join(";"),s=new URL(`geocoding/${a}.json`,defaults$1.maptilerApiURL),{searchParams:f}=s;addForwardGeocodingOptions(f,r);const o=s.toString(),x=yield callFetch(o);if(!x.ok)throw new ServiceError(x,(n=customMessages$3[x.status])!=null?n:"");const C=yield x.json();return t.length===1?[C]:C})}const geocoding={forward,reverse,byId,batch,language:LanguageGeocoding};var __async$2=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages$2={403:"Key is missing, invalid or restricted"};function info(){return __async$2(this,arguments,function*(e={}){var t;const r=new URL("geolocation/ip.json",defaults$1.maptilerApiURL);r.searchParams.set("key",(t=e.apiKey)!=null?t:config$1.apiKey);const n=r.toString(),a=yield callFetch(n);if(!a.ok)throw new ServiceError(a,a.status in customMessages$2?customMessages$2[a.status]:"");return yield a.json()})}const geolocation={info};var __async$1=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages$1={403:"Key is missing, invalid or restricted"};function search(e){return __async$1(this,arguments,function*(t,r={}){var n;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const a=new URL(`coordinates/search/${t}.json`,defaults$1.maptilerApiURL);a.searchParams.set("key",(n=r.apiKey)!=null?n:config$1.apiKey),"limit"in r&&a.searchParams.set("limit",r.limit.toString()),"transformations"in r&&a.searchParams.set("transformations",r.transformations.toString()),"exports"in r&&a.searchParams.set("exports",r.exports.toString());const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,f.status in customMessages$1?customMessages$1[f.status]:"");return yield f.json()})}function transform(e){return __async$1(this,arguments,function*(t,r={}){var n;const a=(Array.isArray(t[0])?t:[t]).map(C=>`${C[0]},${C[1]}`).join(";"),s=new URL(`coordinates/transform/${a}.json`,defaults$1.maptilerApiURL);s.searchParams.set("key",(n=r.apiKey)!=null?n:config$1.apiKey),"sourceCrs"in r&&s.searchParams.set("s_srs",r.sourceCrs.toString()),"targetCrs"in r&&s.searchParams.set("t_srs",r.targetCrs.toString()),"operations"in r&&s.searchParams.set("ops",(Array.isArray(r.operations)?r.operations:[r.operations]).join("|"));const f=s.toString(),o=yield callFetch(f);if(!o.ok)throw new ServiceError(o,o.status in customMessages$1?customMessages$1[o.status]:"");return yield o.json()})}const coordinates={search,transform};var __async$5=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const customMessages={403:"Key is missing, invalid or restricted"};function get(e){return __async$5(this,arguments,function*(t,r={}){var n;if(typeof t!="string"||t.trim().length===0)throw new Error("The data ID must be a non-empty string");const a=new URL(`data/${encodeURIComponent(t)}/features.json`,defaults$1.maptilerApiURL);a.searchParams.set("key",(n=r.apiKey)!=null?n:config$1.apiKey);const s=a.toString(),f=yield callFetch(s);if(!f.ok)throw new ServiceError(f,f.status in customMessages?customMessages[f.status]:"");return yield f.json()})}const data={get};function expandMapStyle(e){const t=/^maptiler:\/\/(.*)/;let r;const n=e.trim();let a;return n.startsWith("http://")||n.startsWith("https://")?a=n:(r=t.exec(n))!==null?a=`https://api.maptiler.com/maps/${r[1]}/style.json`:a=`https://api.maptiler.com/maps/${n}/style.json`,a}class MapStyleVariant{constructor(t,r,n,a,s,f){this.name=t,this.variantType=r,this.id=n,this.referenceStyle=a,this.description=s,this.imageURL=f}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){return this.referenceStyle.getVariant(t)}getVariants(){return this.referenceStyle.getVariants().filter(t=>t!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return expandMapStyle(this.getId())}}class ReferenceMapStyle{constructor(t,r){this.name=t,this.id=r,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const mapStylePresetList=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function makeReferenceStyleProxy(e){return new Proxy(e,{get(t,r,n){return t.hasVariant(r)?t.getVariant(r):r.toString().toUpperCase()===r?e.getDefaultVariant():Reflect.get(t,r,n)}})}function buildMapStyles(){const e={};for(let t=0;t<mapStylePresetList.length;t+=1){const r=mapStylePresetList[t],n=makeReferenceStyleProxy(new ReferenceMapStyle(r.name,r.referenceStyleID));for(let a=0;a<r.variants.length;a+=1){const s=r.variants[a],f=new MapStyleVariant(s.name,s.variantType,s.id,n,s.description,s.imageURL);n.addVariant(f)}e[r.referenceStyleID]=n}return e}function styleToStyle$1(e){if(!e)return MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getId();if(typeof e=="string"||e instanceof String)return e.trim().toLowerCase();if(e instanceof MapStyleVariant)return e.getId();if(e instanceof ReferenceMapStyle)return e.getDefaultVariant().getId()}const MapStyle=buildMapStyles();function getSqSegDist(e,t,r){let n=t[0],a=t[1],s=r[0]-n,f=r[1]-a;if(s!==0||f!==0){const o=((e[0]-n)*s+(e[1]-a)*f)/(s*s+f*f);o>1?(n=r[0],a=r[1]):o>0&&(n+=s*o,a+=f*o)}return s=e[0]-n,f=e[1]-a,s*s+f*f}function simplifyDPStep(e,t,r,n,a){let s=n,f;for(let o=t+1;o<r;o++){const x=getSqSegDist(e[o],e[t],e[r]);x>s&&(f=o,s=x)}s>n&&(f-t>1&&simplifyDPStep(e,t,f,n,a),a.push(e[f]),r-f>1&&simplifyDPStep(e,f,r,n,a))}function simplifyDouglasPeucker(e,t){const r=e.length-1,n=[e[0]];return simplifyDPStep(e,0,r,t,n),n.push(e[r]),n}function simplify(e,t){if(e.length<=2)return e;const r=t!==void 0?t*t:1;return simplifyDouglasPeucker(e,r)}function staticMapMarkerToString(e,t=!0){let r=`${e[0]},${e[1]}`;return e.length===3&&t&&(r+=`,${e[2]}`),r}function simplifyAndStringify(e,t=3e3){let r=e.map(s=>s.join(",")).join("|"),n=5e-6;const a=1e-5;for(;r.length>t;)r=simplify(e,n).map(f=>`${f[0]},${f[1]}`).join("|"),n+=a;return r}function centered(e,t,r={}){var n,a,s,f,o;const x=styleToStyle$1(r.style),C=r.hiDPI?"@2x":"",P=(n=r.format)!=null?n:"png";let ge=~~((a=r.width)!=null?a:1024),nt=~~((s=r.height)!=null?s:1024);r.hiDPI&&(ge=~~(ge/2),nt=~~(nt/2));const ze=new URL(`maps/${encodeURIComponent(x)}/static/${e[0]},${e[1]},${t}/${ge}x${nt}${C}.${P}`,defaults$1.maptilerApiURL);if("attribution"in r&&ze.searchParams.set("attribution",r.attribution.toString()),"markers"in r){let Bt="";const qr="markerIcon"in r;qr&&(Bt+=`icon:${r.markerIcon}|`),qr&&"markerAnchor"in r&&(Bt+=`anchor:${r.markerAnchor}|`),qr&&r.hiDPI&&(Bt+="scale:2|");const _n=Array.isArray(r.markers[0])?r.markers:[r.markers];Bt+=_n.map(Fn=>staticMapMarkerToString(Fn,!qr)).join("|"),ze.searchParams.set("markers",Bt)}if("path"in r){let Bt="";if(Bt+=`fill:${(f=r.pathFillColor)!=null?f:"none"}|`,"pathStrokeColor"in r&&(Bt+=`stroke:${r.pathStrokeColor}|`),"pathWidth"in r){const qr=r.pathWidth/(r.hiDPI?2:1);Bt+=`width:${qr.toString()}|`}Bt+=simplifyAndStringify(r.path),ze.searchParams.set("path",Bt)}return ze.searchParams.set("key",(o=r.apiKey)!=null?o:config$1.apiKey),ze.toString()}function bounded(e,t={}){var r,n,a,s,f;const o=styleToStyle$1(t.style),x=t.hiDPI?"@2x":"",C=(r=t.format)!=null?r:"png";let P=~~((n=t.width)!=null?n:1024),ge=~~((a=t.height)!=null?a:1024);t.hiDPI&&(P=~~(P/2),ge=~~(ge/2));const nt=new URL(`maps/${encodeURIComponent(o)}/static/${e[0]},${e[1]},${e[2]},${e[3]}/${P}x${ge}${x}.${C}`,defaults$1.maptilerApiURL);if("attribution"in t&&nt.searchParams.set("attribution",t.attribution.toString()),"padding"in t&&nt.searchParams.set("padding",t.padding.toString()),"markers"in t){let ze="";const Bt="markerIcon"in t;Bt&&(ze+=`icon:${t.markerIcon}|`),Bt&&"markerAnchor"in t&&(ze+=`anchor:${t.markerAnchor}|`),Bt&&t.hiDPI&&(ze+="scale:2|");const qr=Array.isArray(t.markers[0])?t.markers:[t.markers];ze+=qr.map(_n=>staticMapMarkerToString(_n,!Bt)).join("|"),nt.searchParams.set("markers",ze)}if("path"in t){let ze="";if(ze+=`fill:${(s=t.pathFillColor)!=null?s:"none"}|`,"pathStrokeColor"in t&&(ze+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){const Bt=t.pathWidth/(t.hiDPI?2:1);ze+=`width:${Bt.toString()}|`}ze+=simplifyAndStringify(t.path),nt.searchParams.set("path",ze)}return nt.searchParams.set("key",(f=t.apiKey)!=null?f:config$1.apiKey),nt.toString()}function automatic(e={}){var t,r,n,a,s;if(!("markers"in e)&&!("path"in e))throw new Error("Automatic static maps require markers and/or path to be created.");const f=styleToStyle$1(e.style),o=e.hiDPI?"@2x":"",x=(t=e.format)!=null?t:"png";let C=~~((r=e.width)!=null?r:1024),P=~~((n=e.height)!=null?n:1024);e.hiDPI&&(C=~~(C/2),P=~~(P/2));const ge=new URL(`maps/${encodeURIComponent(f)}/static/auto/${C}x${P}${o}.${x}`,defaults$1.maptilerApiURL);if("attribution"in e&&ge.searchParams.set("attribution",e.attribution.toString()),"padding"in e&&ge.searchParams.set("padding",e.padding.toString()),"markers"in e){let nt="";const ze="markerIcon"in e;ze&&(nt+=`icon:${e.markerIcon}|`),ze&&"markerAnchor"in e&&(nt+=`anchor:${e.markerAnchor}|`),ze&&e.hiDPI&&(nt+="scale:2|");const Bt=Array.isArray(e.markers[0])?e.markers:[e.markers];nt+=Bt.map(qr=>staticMapMarkerToString(qr,!ze)).join("|"),ge.searchParams.set("markers",nt)}if("path"in e){let nt="";if(nt+=`fill:${(a=e.pathFillColor)!=null?a:"none"}|`,"pathStrokeColor"in e&&(nt+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){const ze=e.pathWidth/(e.hiDPI?2:1);nt+=`width:${ze.toString()}|`}nt+=simplifyAndStringify(e.path),ge.searchParams.set("path",nt)}return ge.searchParams.set("key",(s=e.apiKey)!=null?s:config$1.apiKey),ge.toString()}const staticMaps={centered,bounded,automatic},Language={AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"latin",NON_LATIN:"nonlatin",LOCAL:"",ALBANIAN:"sq",AMHARIC:"am",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BASQUE:"eu",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CORSICAN:"co",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",JAPANESE_HIRAGANA:"ja-Hira",JAPANESE_KANA:"ja_kana",JAPANESE_LATIN:"ja_rm",JAPANESE_2018:"ja-Latn",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",KOREAN_LATIN:"ko-Latn",KURDISH:"ku",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALAYALAM:"ml",MALTESE:"mt",NORWEGIAN:"no",OCCITAN:"oc",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SERBIAN_LATIN:"sr-Latn",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languagesIsoSet=new Set(Object.values(Language));function isLanguageSupported(e){return languagesIsoSet.has(e)}const languageCodeSet=new Set(Object.values(Language));function getBrowserLanguage(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const e=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet.has(t));return e.length?e[0]:Language.LATIN}class SdkConfig extends EventEmitter$4{constructor(){super(),this.primaryLanguage=Language.AUTO,this.secondaryLanguage=null,this.session=!0,this._unit="metric",this._apiKey=""}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,config$1.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){config$1.fetch=t}get fetch(){return config$1.fetch}}const config=new SdkConfig,defaults={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Language.AUTO,secondaryLanguage:Language.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(defaults);class LogoControl extends maplibregl__default.LogoControl{onAdd(t){return super.onAdd(t)}}class MaptilerLogoControl extends LogoControl{constructor(t={}){var r,n;super(t),this.logoURL="",this.linkURL="",this.logoURL=(r=t.logoURL)!=null?r:defaults.maptilerLogoURL,this.linkURL=(n=t.linkURL)!=null?n:defaults.maptilerURL}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const r=window.document.createElement("a");return r.style.backgroundRepeat="no-repeat",r.style.cursor="pointer",r.style.display="block",r.style.height="23px",r.style.margin="0 0 -4px -4px",r.style.overflow="hidden",r.style.width="88px",r.style.backgroundImage=`url(${this.logoURL})`,r.style.backgroundSize="100px 30px",r.style.width="100px",r.style.height="30px",r.target="_blank",r.rel="noopener nofollow",r.href=this.linkURL,r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}function enableRTL(){maplibregl__default.getRTLTextPluginStatus()==="unavailable"&&maplibregl__default.setRTLTextPlugin(defaults.rtlPluginURL,null,!0)}function bindAll(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function DOMcreate(e,t,r){const n=window.document.createElement(e);return t!==void 0&&(n.className=t),r&&r.appendChild(n),n}function DOMremove(e){e.parentNode&&e.parentNode.removeChild(e)}function styleToStyle(e){return e?typeof e=="string"||e instanceof String?!e.startsWith("http")&&e.toLowerCase().includes(".json")?e:expandMapStyle(e):e instanceof MapStyleVariant?e.getExpandedStyleURL():e instanceof ReferenceMapStyle?e.getDefaultVariant().getExpandedStyleURL():e:MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class MaptilerTerrainControl{constructor(){bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=DOMcreate("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=DOMcreate("button","maplibregl-ctrl-terrain",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){DOMremove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class NavigationControl extends maplibregl__default.NavigationControl{onAdd(t){return super.onAdd(t)}}class MaptilerNavigationControl extends NavigationControl{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})}_createButton(t,r){const n=super._createButton(t,r);return n.clickFunction=r,n}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t}}class GeolocateControl extends maplibregl__default.GeolocateControl{onAdd(t){return super.onAdd(t)}}var __defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(e,t,r)=>t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues$1=(e,t)=>{for(var r in t||(t={}))__hasOwnProp$1.call(t,r)&&__defNormalProp$1(e,r,t[r]);if(__getOwnPropSymbols$1)for(var r of __getOwnPropSymbols$1(t))__propIsEnum$1.call(t,r)&&__defNormalProp$1(e,r,t[r]);return e},__spreadProps$1=(e,t)=>__defProps$1(e,__getOwnPropDescs$1(t));const Marker$1=maplibregl__default.Marker,LngLat$1=maplibregl__default.LngLat;class MaptilerGeolocateControl extends GeolocateControl{constructor(){super(...arguments),this.lastUpdatedCenter=new LngLat$1(0,0)}_updateCamera(t){const r=new LngLat$1(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,a=this._map.getBearing(),s=__spreadProps$1(__spreadValues$1({bearing:a},this.options.fitBoundsOptions),{linear:!0}),f=this._map.getZoom();f>this.options.fitBoundsOptions.maxZoom&&(s.zoom=f),this._map.fitBounds(r.toBounds(n),s,{geolocateSource:!0});let o=!1;const x=()=>{o=!0};this._map.once("click",x),this._map.once("dblclick",x),this._map.once("dragstart",x),this._map.once("mousedown",x),this._map.once("touchstart",x),this._map.once("wheel",x),this._map.once("moveend",()=>{this._map.off("click",x),this._map.off("dblclick",x),this._map.off("dragstart",x),this._map.off("mousedown",x),this._map.off("touchstart",x),this._map.off("wheel",x),!o&&(this.lastUpdatedCenter=this._map.getCenter())})}_setupUI(t){if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=DOMcreate("button","maplibregl-ctrl-geolocate",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOMcreate("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Marker$1(this._dotElement),this._circleElement=DOMcreate("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Marker$1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",r=>{const n=r.originalEvent&&r.originalEvent.type==="resize",a=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!r.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!n&&a>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],r=this._map.project(t),n=this._map.unproject([r.x,r.y]),a=this._map.unproject([r.x+20,r.y]),s=n.distanceTo(a)/20,f=Math.ceil(2*this._accuracy/s);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}}class AttributionControl extends maplibregl__default.AttributionControl{onAdd(t){return super.onAdd(t)}}class ScaleControl extends maplibregl__default.ScaleControl{onAdd(t){return super.onAdd(t)}}class FullscreenControl extends maplibregl__default.FullscreenControl{onAdd(t){return super.onAdd(t)}}var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,r)=>new Promise((n,a)=>{var s=x=>{try{o(r.next(x))}catch(C){a(C)}},f=x=>{try{o(r.throw(x))}catch(C){a(C)}},o=x=>x.done?n(x.value):Promise.resolve(x.value).then(s,f);o((r=r.apply(e,t)).next())});const MAPTILER_SESSION_ID=v4(),GeolocationType={POINT:"POINT",COUNTRY:"COUNTRY"};let Map$1=class extends maplibregl__default.Map{constructor(t){var r,n,a;t.apiKey&&(config.apiKey=t.apiKey);const s=styleToStyle(t.style),f=location.hash;config.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(__spreadProps(__spreadValues({},t),{style:s,maplibreLogo:!1,transformRequest:ge=>{let nt=null;try{nt=new URL(ge)}catch{return{url:ge,headers:{}}}return nt.host===defaults.maptilerApiHost&&(nt.searchParams.has("key")||nt.searchParams.append("key",config.apiKey),config.session&&nt.searchParams.append("mtsid",MAPTILER_SESSION_ID)),{url:nt.href,headers:{}}}})),this.isTerrainEnabled=!1,this.terrainExaggeration=1,this.primaryLanguage=null,this.secondaryLanguage=null,this.terrainGrowing=!1,this.terrainFlattening=!1,this.primaryLanguage=(r=t.language)!=null?r:config.primaryLanguage,this.secondaryLanguage=config.secondaryLanguage,this.terrainExaggeration=(n=t.terrainExaggeration)!=null?n:this.terrainExaggeration,this.once("styledata",()=>__async(this,null,function*(){if(!t.geolocate||t.center||t.hash&&f)return;try{if(t.geolocate===GeolocationType.COUNTRY){yield this.fitToIpBounds();return}}catch(ze){console.warn(ze.message)}let ge=null;try{yield this.centerOnIpPoint(t.zoom),ge=this.getCameraHash()}catch(ze){console.warn(ze.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(ze=>{ge===this.getCameraHash()&&(this.terrain?this.easeTo({center:[ze.coords.longitude,ze.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[ze.coords.longitude,ze.coords.latitude],zoom:t.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage),this.setSecondaryLanguage(this.secondaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>__async(this,null,function*(){enableRTL()})),this.once("load",()=>__async(this,null,function*(){let ge={logo:null};try{const nt=Object.keys(this.style.sourceCaches).map(qr=>this.getSource(qr)).filter(qr=>typeof qr.url=="string"&&qr.url.includes("tiles.json")),ze=new URL(nt[0].url);ze.searchParams.has("key")||ze.searchParams.append("key",config.apiKey),ge=yield(yield fetch(ze.href)).json()}catch{}if("logo"in ge&&ge.logo){const nt=ge.logo;this.addControl(new MaptilerLogoControl({logoURL:nt}),t.logoPosition),t.attributionControl===!1&&this.addControl(new AttributionControl(t))}else t.maptilerLogo&&this.addControl(new MaptilerLogoControl,t.logoPosition);if(t.scaleControl){const nt=t.scaleControl===!0||t.scaleControl===void 0?"bottom-right":t.scaleControl,ze=new ScaleControl({unit:config.unit});this.addControl(ze,nt),config.on("unit",Bt=>{ze.setUnit(Bt)})}if(t.navigationControl!==!1){const nt=t.navigationControl===!0||t.navigationControl===void 0?"top-right":t.navigationControl;this.addControl(new MaptilerNavigationControl,nt)}if(t.geolocateControl!==!1){const nt=t.geolocateControl===!0||t.geolocateControl===void 0?"top-right":t.geolocateControl;this.addControl(new MaptilerGeolocateControl({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),nt)}if(t.terrainControl){const nt=t.terrainControl===!0||t.terrainControl===void 0?"top-right":t.terrainControl;this.addControl(new MaptilerTerrainControl,nt)}if(t.fullscreenControl){const nt=t.fullscreenControl===!0||t.fullscreenControl===void 0?"top-right":t.fullscreenControl;this.addControl(new FullscreenControl({}),nt)}}));let o=!1,x=!1,C=null;this.once("load",ge=>{o=!0,x&&this.fire("loadWithTerrain",C)});const P=ge=>{ge.terrain&&(x=!0,C={type:"loadWithTerrain",target:this,terrain:ge.terrain},this.off("terrain",P),o&&this.fire("loadWithTerrain",C))};this.on("terrain",P),t.terrain&&this.enableTerrain((a=t.terrainExaggeration)!=null?a:this.terrainExaggeration)}onLoadAsync(){return __async(this,null,function*(){return new Promise((t,r)=>{if(this.loaded())return t(this);this.once("load",n=>{t(this)})})})}onLoadWithTerrainAsync(){return __async(this,null,function*(){return new Promise((t,r)=>{if(this.loaded()&&this.terrain)return t(this);this.once("loadWithTerrain",n=>{t(this)})})})}setStyle(t,r){return super.setStyle(styleToStyle(t),r)}setLanguage(t=defaults.primaryLanguage){if(t===Language.AUTO)return this.setLanguage(getBrowserLanguage());this.setPrimaryLanguage(t)}setPrimaryLanguage(t=defaults.primaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.primaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setPrimaryLanguage(getBrowserLanguage());const r=this.getStyle().layers,n=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,a=/^\s*name\s*(:\s*(\S*))?\s*$/,s=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/,f=/^(.*)({\s*name\s*(:\s*(\S*))?\s*})(.*)$/,o=t?`name:${t}`:"name",x=["case",["has",o],["get",o],["get","name"]];for(let C=0;C<r.length;C+=1){const P=r[C],ge=P.layout;if(!ge||!ge["text-field"])continue;const nt=this.getLayoutProperty(P.id,"text-field");let ze;if(Array.isArray(nt)&&nt.length>=2&&nt[0].trim().toLowerCase()==="concat"){const Bt=nt.slice();for(let qr=0;qr<nt.length;qr+=1){const _n=nt[qr];if((typeof _n=="string"||_n instanceof String)&&n.exec(_n.toString())){Bt[qr]=x;break}else if(Array.isArray(_n)&&_n.length>=2&&_n[0].trim().toLowerCase()==="get"&&a.exec(_n[1].toString())){Bt[qr]=x;break}else if(Array.isArray(_n)&&_n.length===4&&_n[0].trim().toLowerCase()==="case"){Bt[qr]=x;break}}this.setLayoutProperty(P.id,"text-field",Bt)}else if(Array.isArray(nt)&&nt.length>=2&&nt[0].trim().toLowerCase()==="get"&&a.exec(nt[1].toString())){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof nt=="string"||nt instanceof String)&&n.exec(nt.toString())){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if(Array.isArray(nt)&&nt.length===4&&nt[0].trim().toLowerCase()==="case"){const Bt=x;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof nt=="string"||nt instanceof String)&&(ze=s.exec(nt.toString()))!==null){const Bt=`{${o}}${ze[3]}{name${ze[4]||""}}`;this.setLayoutProperty(P.id,"text-field",Bt)}else if((typeof nt=="string"||nt instanceof String)&&(ze=f.exec(nt.toString()))!==null){const Bt=`${ze[1]}{${o}}${ze[5]}`;this.setLayoutProperty(P.id,"text-field",Bt)}}}))}setSecondaryLanguage(t=defaults.secondaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.secondaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setSecondaryLanguage(getBrowserLanguage());const r=this.getStyle().layers,n=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,a=/^\s*name\s*(:\s*(\S*))?\s*$/,s=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/;let f;for(let o=0;o<r.length;o+=1){const x=r[o],C=x.layout;if(!C||!C["text-field"])continue;const P=this.getLayoutProperty(x.id,"text-field");let ge;if(Array.isArray(P)&&P.length>=2&&P[0].trim().toLowerCase()==="concat"){ge=P.slice();let nt=0;for(let ze=0;ze<P.length;ze+=1){const Bt=P[ze];if((typeof Bt=="string"||Bt instanceof String)&&n.exec(Bt.toString())){if(nt===1){ge[ze]=`{name:${t}}`;break}nt+=1}else if(Array.isArray(Bt)&&Bt.length>=2&&Bt[0].trim().toLowerCase()==="get"&&a.exec(Bt[1].toString())){if(nt===1){ge[ze][1]=`name:${t}`;break}nt+=1}else if(Array.isArray(Bt)&&Bt.length===4&&Bt[0].trim().toLowerCase()==="case"){if(nt===1){ge[ze]=["get",`name:${t}`];break}nt+=1}}this.setLayoutProperty(x.id,"text-field",ge)}else if((typeof P=="string"||P instanceof String)&&(f=s.exec(P.toString()))!==null){const nt=t?`name:${t}`:"name";ge=`{name${f[1]||""}}${f[3]}{${nt}}`,this.setLayoutProperty(x.id,"text-field",ge)}}}))}getPrimaryLanguage(){return this.primaryLanguage}getSecondaryLanguage(){return this.secondaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t,r=1e3){if(!this.terrain)return;const n=performance.now(),a=this.terrain.exaggeration,s=t-a,f=()=>{if(!this.terrain||this.terrainFlattening)return;const o=(performance.now()-n)/r;if(o<.99){const x=1-Math.pow(1-o,4),C=a+x*s;this.terrain.exaggeration=C,requestAnimationFrame(f)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(f)}enableTerrain(t=this.terrainExaggeration){if(t<0){console.warn("Terrain exaggeration cannot be negative.");return}const r=a=>__async(this,null,function*(){!this.terrain||a.type!=="data"||a.dataType!=="source"||!("source"in a)||a.sourceId!=="maptiler-terrain"||a.source.type!=="raster-dem"||a.isSourceLoaded&&(this.off("data",r),this.growTerrain(t))}),n=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",r),this.addSource(defaults.terrainSourceId,{type:"raster-dem",url:defaults.terrainSourceURL}),this.setTerrain({source:defaults.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(t);return}this.loaded()||this.isTerrainEnabled?n():this.once("load",()=>{this.getTerrain()&&this.getSource(defaults.terrainSourceId)||n()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=1*1e3,r=performance.now(),n=this.terrain.exaggeration,a=()=>{if(!this.terrain||this.terrainGrowing)return;const s=(performance.now()-r)/t;if(s<.99){const f=Math.pow(1-s,4),o=n*f;this.terrain.exaggeration=o,requestAnimationFrame(a)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(null),this.getSource(defaults.terrainSourceId)&&this.removeSource(defaults.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(a)}setTerrainExaggeration(t,r=!0){!r&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",()=>{t()})}fitToIpBounds(){return __async(this,null,function*(){const t=yield geolocation.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(t){return __async(this,null,function*(){const r=yield geolocation.info();this.jumpTo({center:[r.longitude,r.latitude],zoom:t||11})})}getCameraHash(){const t=new Float32Array(5),r=this.getCenter();return t[0]=r.lng,t[1]=r.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),gBase64.fromUint8Array(new Uint8Array(t.buffer))}getSdkConfig(){return config}getMaptilerSessionId(){return MAPTILER_SESSION_ID}};class Marker extends maplibregl__default.Marker{addTo(t){return super.addTo(t)}}class Popup extends maplibregl__default.Popup{addTo(t){return super.addTo(t)}}class Style extends maplibregl__default.Style{constructor(t,r={}){super(t,r)}}class CanvasSource extends maplibregl__default.CanvasSource{onAdd(t){super.onAdd(t)}}class GeoJSONSource extends maplibregl__default.GeoJSONSource{onAdd(t){super.onAdd(t)}}class ImageSource extends maplibregl__default.ImageSource{onAdd(t){super.onAdd(t)}}class RasterTileSource extends maplibregl__default.RasterTileSource{onAdd(t){super.onAdd(t)}}class RasterDEMTileSource extends maplibregl__default.RasterDEMTileSource{onAdd(t){super.onAdd(t)}}class VectorTileSource extends maplibregl__default.VectorTileSource{onAdd(t){super.onAdd(t)}}class VideoSource extends maplibregl__default.VideoSource{onAdd(t){super.onAdd(t)}}class TerrainControl extends maplibregl__default.TerrainControl{onAdd(t){return super.onAdd(t)}}class Point{constructor(t,r){this.x=t,this.y=r}_matMult(t){const r=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=r,this.y=n,this}_add(t){return this.x+=t.x,this.y+=t.y,this}_sub(t){return this.x-=t.x,this.y-=t.y,this}_mult(t){return this.x*=t,this.y*=t,this}_div(t){return this.x/=t,this.y/=t,this}_multByPoint(t){return this.x*=t.x,this.y*=t.y,this}_divByPoint(t){return this.x/=t.x,this.y/=t.y,this}_unit(){return this._div(this.mag()),this}_perp(){const t=this.y;return this.y=this.x,this.x=-t,this}_rotate(t){const r=Math.cos(t),n=Math.sin(t),a=r*this.x-n*this.y,s=n*this.x+r*this.y;return this.x=a,this.y=s,this}_rotateAround(t,r){const n=Math.cos(t),a=Math.sin(t),s=r.x+n*(this.x-r.x)-a*(this.y-r.y),f=r.y+a*(this.x-r.x)+n*(this.y-r.y);return this.x=s,this.y=f,this}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clone(){return new Point(this.x,this.y)}add(t){return this.clone()._add(t)}sub(t){return this.clone()._sub(t)}multByPoint(t){return this.clone()._multByPoint(t)}divByPoint(t){return this.clone()._divByPoint(t)}mult(t){return this.clone()._mult(t)}div(t){return this.clone()._div(t)}rotate(t){return this.clone()._rotate(t)}rotateAround(t,r){return this.clone()._rotateAround(t,r)}matMult(t){return this.clone()._matMult(t)}unit(){return this.clone()._unit()}perp(){return this.clone()._perp()}round(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(t){return this.x===t.x&&this.y===t.y}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){const r=t.x-this.x,n=t.y-this.y;return r*r+n*n}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleWith(t){return this.angleWithSep(t.x,t.y)}angleWithSep(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)}static convert(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t}}const{supported,setRTLTextPlugin,getRTLTextPluginStatus,LngLat,LngLatBounds,MercatorCoordinate,Evented,AJAXError,prewarm,clearPrewarmedResources,version:version$1,workerCount,maxParallelImageRequests,workerUrl,addProtocol,removeProtocol}=maplibregl__default,MapMLGL=maplibregl__default.Map,MarkerMLGL=maplibregl__default.Marker,PopupMLGL=maplibregl__default.Popup,StyleMLGL=maplibregl__default.Style,CanvasSourceMLGL=maplibregl__default.CanvasSource,GeoJSONSourceMLGL=maplibregl__default.GeoJSONSource,ImageSourceMLGL=maplibregl__default.ImageSource,RasterTileSourceMLGL=maplibregl__default.RasterTileSource,RasterDEMTileSourceMLGL=maplibregl__default.RasterDEMTileSource,VectorTileSourceMLGL=maplibregl__default.VectorTileSource,VideoSourceMLGL=maplibregl__default.VideoSource;maplibregl__default.NavigationControl;maplibregl__default.GeolocateControl;maplibregl__default.AttributionControl;maplibregl__default.LogoControl;maplibregl__default.ScaleControl;maplibregl__default.FullscreenControl;maplibregl__default.TerrainControl;const ll=_mergeNamespaces({__proto__:null,AJAXError,AttributionControl,CanvasSource,CanvasSourceMLGL,Evented,FullscreenControl,GeoJSONSource,GeoJSONSourceMLGL,GeolocateControl,GeolocationType,ImageSource,ImageSourceMLGL,Language,LanguageGeocoding,LngLat,LngLatBounds,LogoControl,Map:Map$1,MapMLGL,MapStyle,MapStyleVariant,MaptilerGeolocateControl,MaptilerLogoControl,MaptilerNavigationControl,MaptilerTerrainControl,Marker,MarkerMLGL,MercatorCoordinate,NavigationControl,Point,Popup,PopupMLGL,RasterDEMTileSource,RasterDEMTileSourceMLGL,RasterTileSource,RasterTileSourceMLGL,ReferenceMapStyle,ScaleControl,SdkConfig,ServiceError,Style,StyleMLGL,TerrainControl,VectorTileSource,VectorTileSourceMLGL,VideoSource,VideoSourceMLGL,addProtocol,clearPrewarmedResources,config,coordinates,data,geocoding,geolocation,getRTLTextPluginStatus,maxParallelImageRequests,prewarm,removeProtocol,setRTLTextPlugin,staticMaps,supported,version:version$1,workerCount,workerUrl},[maplibreGlExports]);var ta=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},zn=(e,t,r)=>(ta(e,t,"read from private field"),r?r.call(e):t.get(e)),fs=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},No=(e,t,r,n)=>(ta(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);function _t(){}function cl(e,t){for(const r in t)e[r]=t[r];return e}function Wa(e){return e()}function ea(){return Object.create(null)}function Fr(e){e.forEach(Wa)}function ja(e){return typeof e=="function"}function Br(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function fl(e){return Object.keys(e).length===0}function hl(e,t,r,n){if(e){const a=Ka(e,t,r,n);return e[0](a)}}function Ka(e,t,r,n){return e[1]&&n?cl(r.ctx.slice(),e[1](n(t))):r.ctx}function gl(e,t,r,n){if(e[2]&&n){const a=e[2](n(r));if(t.dirty===void 0)return a;if(typeof a=="object"){const s=[],f=Math.max(t.dirty.length,a.length);for(let o=0;o<f;o+=1)s[o]=t.dirty[o]|a[o];return s}return t.dirty|a}return t.dirty}function pl(e,t,r,n,a,s){if(a){const f=Ka(t,r,n,s);e.p(f,a)}}function dl(e){if(e.ctx.length>32){const t=[],r=e.ctx.length/32;for(let n=0;n<r;n++)t[n]=-1;return t}return-1}function na(e){return e??""}function rt(e,t){e.appendChild(t)}function Be(e,t,r){e.insertBefore(t,r||null)}function Pe(e){e.parentNode&&e.parentNode.removeChild(e)}function vl(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}function Gt(e){return document.createElement(e)}function jn(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Wr(e){return document.createTextNode(e)}function In(){return Wr(" ")}function Re(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}function yl(e){return function(t){return t.preventDefault(),e.call(this,t)}}function D(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function ml(e){return Array.from(e.childNodes)}function Ki(e,t){t=""+t,e.data!==t&&(e.data=t)}function ra(e,t){e.value=t??""}function nn(e,t,r){e.classList[r?"add":"remove"](t)}function _l(e,t,{bubbles:r=!1,cancelable:n=!1}={}){const a=document.createEvent("CustomEvent");return a.initCustomEvent(e,r,n,t),a}let Qi;function Wi(e){Qi=e}function Qa(){if(!Qi)throw new Error("Function called outside component initialization");return Qi}function El(e){Qa().$$.on_destroy.push(e)}function Il(){const e=Qa();return(t,r,{cancelable:n=!1}={})=>{const a=e.$$.callbacks[t];if(a){const s=_l(t,r,{cancelable:n});return a.slice().forEach(f=>{f.call(e,s)}),!s.defaultPrevented}return!0}}function ia(e,t){const r=e.$$.callbacks[t.type];r&&r.slice().forEach(n=>n.call(this,t))}const gi=[],ys=[];let di=[];const oa=[],Cl=Promise.resolve();let ms=!1;function Nl(){ms||(ms=!0,Cl.then(Ja))}function _s(e){di.push(e)}const hs=new Set;let hi=0;function Ja(){if(hi!==0)return;const e=Qi;do{try{for(;hi<gi.length;){const t=gi[hi];hi++,Wi(t),xl(t.$$)}}catch(t){throw gi.length=0,hi=0,t}for(Wi(null),gi.length=0,hi=0;ys.length;)ys.pop()();for(let t=0;t<di.length;t+=1){const r=di[t];hs.has(r)||(hs.add(r),r())}di.length=0}while(gi.length);for(;oa.length;)oa.pop()();ms=!1,hs.clear(),Wi(e)}function xl(e){if(e.fragment!==null){e.update(),Fr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_s)}}function Sl(e){const t=[],r=[];di.forEach(n=>e.indexOf(n)===-1?t.push(n):r.push(n)),r.forEach(n=>n()),di=t}const Po=new Set;let Yr;function Ro(){Yr={r:0,c:[],p:Yr}}function Oo(){Yr.r||Fr(Yr.c),Yr=Yr.p}function Dt(e,t){e&&e.i&&(Po.delete(e),e.i(t))}function ae(e,t,r,n){if(e&&e.o){if(Po.has(e))return;Po.add(e),Yr.c.push(()=>{Po.delete(e),n&&(r&&e.d(1),n())}),e.o(t)}else n&&n()}function Sr(e){e&&e.c()}function sr(e,t,r,n){const{fragment:a,after_update:s}=e.$$;a&&a.m(t,r),n||_s(()=>{const f=e.$$.on_mount.map(Wa).filter(ja);e.$$.on_destroy?e.$$.on_destroy.push(...f):Fr(f),e.$$.on_mount=[]}),s.forEach(_s)}function ar(e,t){const r=e.$$;r.fragment!==null&&(Sl(r.after_update),Fr(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function wl(e,t){e.$$.dirty[0]===-1&&(gi.push(e),Nl(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function kr(e,t,r,n,a,s,f,o=[-1]){const x=Qi;Wi(e);const C=e.$$={fragment:null,ctx:[],props:s,update:_t,not_equal:a,bound:ea(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(x?x.$$.context:[])),callbacks:ea(),dirty:o,skip_bound:!1,root:t.target||x.$$.root};f&&f(C.root);let P=!1;if(C.ctx=r?r(e,t.props||{},(ge,nt,...ze)=>{const Bt=ze.length?ze[0]:nt;return C.ctx&&a(C.ctx[ge],C.ctx[ge]=Bt)&&(!C.skip_bound&&C.bound[ge]&&C.bound[ge](Bt),P&&wl(e,ge)),nt}):[],C.update(),P=!0,Fr(C.before_update),C.fragment=n?n(C.ctx):!1,t.target){if(t.hydrate){const ge=ml(t.target);C.fragment&&C.fragment.l(ge),ge.forEach(Pe)}else C.fragment&&C.fragment.c();t.intro&&Dt(e.$$.fragment),sr(e,t.target,t.anchor,t.customElement),Ja()}Wi(x)}class Gr{$destroy(){ar(this,1),this.$destroy=_t}$on(t,r){if(!ja(r))return _t;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(r),()=>{const a=n.indexOf(r);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!fl(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Ll(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),D(t,"viewBox","0 0 14 14"),D(t,"width","13"),D(t,"height","13"),D(t,"class","svelte-en2qvf")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Za extends Gr{constructor(t){super(),kr(this,t,null,Ll,Br,{})}}function bl(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),D(t,"viewBox","0 0 30 30"),D(t,"fill","none"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"class","svelte-d2loi5")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class $a extends Gr{constructor(t){super(),kr(this,t,null,bl,Br,{})}}function sa(e){var t,r;let n,a=(((r=(t=e[0].properties)==null?void 0:t.place_type_name)==null?void 0:r[0])??e[0].place_type[0])+"",s;return{c(){n=Gt("span"),s=Wr(a),D(n,"class","line2 svelte-ewziy4")},m(f,o){Be(f,n,o),rt(n,s)},p(f,o){var x,C;o&1&&a!==(a=(((C=(x=f[0].properties)==null?void 0:x.place_type_name)==null?void 0:C[0])??f[0].place_type[0])+"")&&Ki(s,a)},d(f){f&&Pe(n)}}}function Pl(e){let t,r,n,a,s=e[0].place_name.replace(/,.*/,"")+"",f,o,x,C=e[0].place_name.replace(/[^,]*,?\s*/,"")+"",P,ge,nt,ze,Bt=e[2]&&sa(e);return{c(){t=Gt("li"),r=Gt("span"),n=Gt("span"),a=Gt("span"),f=Wr(s),o=In(),x=Gt("span"),P=Wr(C),ge=In(),Bt&&Bt.c(),D(a,"class","primary svelte-ewziy4"),D(x,"class","secondary svelte-ewziy4"),D(n,"class","svelte-ewziy4"),D(r,"class","texts svelte-ewziy4"),D(t,"tabindex","0"),D(t,"data-selected",e[1]),D(t,"class","svelte-ewziy4"),nn(t,"selected",e[1])},m(qr,_n){Be(qr,t,_n),rt(t,r),rt(r,n),rt(n,a),rt(a,f),rt(n,o),rt(n,x),rt(x,P),rt(r,ge),Bt&&Bt.m(r,null),nt||(ze=[Re(t,"mouseenter",e[3]),Re(t,"focus",e[4])],nt=!0)},p(qr,[_n]){_n&1&&s!==(s=qr[0].place_name.replace(/,.*/,"")+"")&&Ki(f,s),_n&1&&C!==(C=qr[0].place_name.replace(/[^,]*,?\s*/,"")+"")&&Ki(P,C),qr[2]?Bt?Bt.p(qr,_n):(Bt=sa(qr),Bt.c(),Bt.m(r,null)):Bt&&(Bt.d(1),Bt=null),_n&2&&D(t,"data-selected",qr[1]),_n&2&&nn(t,"selected",qr[1])},i:_t,o:_t,d(qr){qr&&Pe(t),Bt&&Bt.d(),nt=!1,Fr(ze)}}}function Rl(e,t,r){let{feature:n}=t,{selected:a=!1}=t,{showPlaceType:s=!1}=t;function f(x){ia.call(this,e,x)}function o(x){ia.call(this,e,x)}return e.$$set=x=>{"feature"in x&&r(0,n=x.feature),"selected"in x&&r(1,a=x.selected),"showPlaceType"in x&&r(2,s=x.showPlaceType)},[n,a,s,f,o]}class Ol extends Gr{constructor(t){super(),kr(this,t,Rl,Pl,Br,{feature:0,selected:1,showPlaceType:2})}}function Dl(e){let t;return{c(){t=Gt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',D(t,"class","svelte-7cmwmc")},m(r,n){Be(r,t,n)},p:_t,i:_t,o:_t,d(r){r&&Pe(t)}}}class Tl extends Gr{constructor(t){super(),kr(this,t,null,Dl,Br,{})}}function Ml(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),D(t,"viewBox","0 0 60.006 21.412"),D(t,"width","14"),D(t,"height","20"),D(t,"class","svelte-en2qvf")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Al extends Gr{constructor(t){super(),kr(this,t,null,Ml,Br,{})}}function Fl(e){let t,r;return{c(){t=jn("svg"),r=jn("path"),D(r,"d","M13.101 14.261 8.74 9.899a4.797 4.797 0 0 1-1.425.748 5.165 5.165 0 0 1-1.603.248c-1.446 0-2.677-.5-3.693-1.503S.495 7.164.495 5.717c0-1.446.508-2.678 1.524-3.693C3.035 1.008 4.266.5 5.712.5c1.448 0 2.672.508 3.675 1.524 1.002 1.015 1.503 2.247 1.503 3.693 0 .558-.08 1.092-.239 1.603-.159.512-.411.98-.757 1.405l4.382 4.4a.74.74 0 0 1 .229.568.81.81 0 0 1-.249.568.787.787 0 0 1-.577.239.787.787 0 0 1-.578-.239ZM5.712 9.223c.97 0 1.796-.342 2.48-1.026a3.378 3.378 0 0 0 1.026-2.48c0-.982-.34-1.818-1.016-2.509-.677-.69-1.507-1.035-2.49-1.035a3.42 3.42 0 0 0-2.509 1.035 3.42 3.42 0 0 0-1.035 2.51c0 .982.345 1.812 1.035 2.488.691.678 1.527 1.017 2.51 1.017Z"),D(t,"width","14"),D(t,"height","14"),D(t,"viewBox","0 0 15 15"),D(t,"class","svelte-en2qvf")},m(n,a){Be(n,t,a),rt(t,r)},p:_t,i:_t,o:_t,d(n){n&&Pe(t)}}}class Bl extends Gr{constructor(t){super(),kr(this,t,null,Fl,Br,{})}}function aa(e,t,r){const n=e.slice();return n[70]=t[r],n[72]=r,n}function ua(e){let t,r;return t=new Tl({}),{c(){Sr(t.$$.fragment)},m(n,a){sr(t,n,a),r=!0},i(n){r||(Dt(t.$$.fragment,n),r=!0)},o(n){ae(t.$$.fragment,n),r=!1},d(n){ar(t,n)}}}function la(e){let t,r,n,a,s;return r=new Al({}),{c(){t=Gt("button"),Sr(r.$$.fragment),D(t,"type","button"),D(t,"title",e[9]),D(t,"class","svelte-1r7dvt7"),nn(t,"active",e[0])},m(f,o){Be(f,t,o),sr(r,t,null),n=!0,a||(s=Re(t,"click",e[56]),a=!0)},p(f,o){(!n||o[0]&512)&&D(t,"title",f[9]),(!n||o[0]&1)&&nn(t,"active",f[0])},i(f){n||(Dt(r.$$.fragment,f),n=!0)},o(f){ae(r.$$.fragment,f),n=!1},d(f){f&&Pe(t),ar(r),a=!1,s()}}}function kl(e){let t,r,n,a,s=e[12],f=[];for(let x=0;x<s.length;x+=1)f[x]=ca(aa(e,s,x));const o=x=>ae(f[x],1,1,()=>{f[x]=null});return{c(){t=Gt("ul");for(let x=0;x<f.length;x+=1)f[x].c();D(t,"class","svelte-1r7dvt7")},m(x,C){Be(x,t,C);for(let P=0;P<f.length;P+=1)f[P]&&f[P].m(t,null);r=!0,n||(a=[Re(t,"mouseleave",e[60]),Re(t,"blur",e[61])],n=!0)},p(x,C){if(C[0]&2110464){s=x[12];let P;for(P=0;P<s.length;P+=1){const ge=aa(x,s,P);f[P]?(f[P].p(ge,C),Dt(f[P],1)):(f[P]=ca(ge),f[P].c(),Dt(f[P],1),f[P].m(t,null))}for(Ro(),P=s.length;P<f.length;P+=1)o(P);Oo()}},i(x){if(!r){for(let C=0;C<s.length;C+=1)Dt(f[C]);r=!0}},o(x){f=f.filter(Boolean);for(let C=0;C<f.length;C+=1)ae(f[C]);r=!1},d(x){x&&Pe(t),vl(f,x),n=!1,Fr(a)}}}function Gl(e){let t,r,n,a,s,f;return r=new $a({}),{c(){t=Gt("div"),Sr(r.$$.fragment),n=In(),a=Gt("div"),s=Wr(e[7]),D(a,"class","svelte-1r7dvt7"),D(t,"class","no-results svelte-1r7dvt7")},m(o,x){Be(o,t,x),sr(r,t,null),rt(t,n),rt(t,a),rt(a,s),f=!0},p(o,x){(!f||x[0]&128)&&Ki(s,o[7])},i(o){f||(Dt(r.$$.fragment,o),f=!0)},o(o){ae(r.$$.fragment,o),f=!1},d(o){o&&Pe(t),ar(r)}}}function zl(e){let t="",r;return{c(){r=Wr(t)},m(n,a){Be(n,r,a)},p:_t,i:_t,o:_t,d(n){n&&Pe(r)}}}function Vl(e){let t,r,n,a,s,f,o,x,C,P,ge;return r=new $a({}),x=new Za({}),{c(){t=Gt("div"),Sr(r.$$.fragment),n=In(),a=Gt("div"),s=Wr(e[6]),f=In(),o=Gt("button"),Sr(x.$$.fragment),D(a,"class","svelte-1r7dvt7"),D(o,"class","svelte-1r7dvt7"),D(t,"class","error svelte-1r7dvt7")},m(nt,ze){Be(nt,t,ze),sr(r,t,null),rt(t,n),rt(t,a),rt(a,s),rt(t,f),rt(t,o),sr(x,o,null),C=!0,P||(ge=Re(o,"click",e[57]),P=!0)},p(nt,ze){(!C||ze[0]&64)&&Ki(s,nt[6])},i(nt){C||(Dt(r.$$.fragment,nt),Dt(x.$$.fragment,nt),C=!0)},o(nt){ae(r.$$.fragment,nt),ae(x.$$.fragment,nt),C=!1},d(nt){nt&&Pe(t),ar(r),ar(x),P=!1,ge()}}}function ca(e){let t,r;function n(){return e[58](e[72])}function a(){return e[59](e[70])}return t=new Ol({props:{feature:e[70],showPlaceType:e[10],selected:e[13]===e[72]}}),t.$on("mouseenter",n),t.$on("focus",a),{c(){Sr(t.$$.fragment)},m(s,f){sr(t,s,f),r=!0},p(s,f){e=s;const o={};f[0]&4096&&(o.feature=e[70]),f[0]&1024&&(o.showPlaceType=e[10]),f[0]&8192&&(o.selected=e[13]===e[72]),t.$set(o)},i(s){r||(Dt(t.$$.fragment,s),r=!0)},o(s){ae(t.$$.fragment,s),r=!1},d(s){ar(t,s)}}}function Ul(e){let t,r,n,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n,Fn,tl,Io,Co;a=new Bl({}),P=new Za({});let rl=e[17]&&ua(),ah=e[5]===!0&&la(e);const ch=e[48].default,ju=hl(ch,e,e[47],null),Zu=[Vl,zl,Gl,kl],sl=[];function oh(hh,Sh){var $h,hd;return hh[16]?0:hh[14]?(($h=hh[12])==null?void 0:$h.length)===0?2:hh[14]&&(hd=hh[12])!=null&&hd.length?3:-1:1}return~(qr=oh(e))&&(_n=sl[qr]=Zu[qr](e)),{c(){t=Gt("form"),r=Gt("div"),n=Gt("button"),Sr(a.$$.fragment),s=In(),f=Gt("input"),o=In(),x=Gt("div"),C=Gt("button"),Sr(P.$$.fragment),ge=In(),rl&&rl.c(),nt=In(),ah&&ah.c(),ze=In(),ju&&ju.c(),Bt=In(),_n&&_n.c(),D(n,"class","search-button svelte-1r7dvt7"),D(n,"type","button"),D(f,"placeholder",e[8]),D(f,"aria-label",e[8]),D(f,"class","svelte-1r7dvt7"),D(C,"type","button"),D(C,"title",e[3]),D(C,"class","svelte-1r7dvt7"),D(x,"class","clear-button-container svelte-1r7dvt7"),nn(x,"displayable",e[1]!==""),D(r,"class","input-group svelte-1r7dvt7"),D(t,"tabindex","0"),D(t,"class",Fn=na(e[2])+" svelte-1r7dvt7"),nn(t,"can-collapse",e[4]&&e[1]==="")},m(hh,Sh){Be(hh,t,Sh),rt(t,r),rt(r,n),sr(a,n,null),rt(r,s),rt(r,f),e[50](f),ra(f,e[1]),rt(r,o),rt(r,x),rt(x,C),sr(P,C,null),rt(x,ge),rl&&rl.m(x,null),rt(r,nt),ah&&ah.m(r,null),rt(r,ze),ju&&ju.m(r,null),rt(t,Bt),~qr&&sl[qr].m(t,null),tl=!0,Io||(Co=[Re(n,"click",e[49]),Re(f,"input",e[51]),Re(f,"focus",e[52]),Re(f,"blur",e[53]),Re(f,"keydown",e[19]),Re(f,"input",e[54]),Re(C,"click",e[55]),Re(t,"submit",yl(e[18]))],Io=!0)},p(hh,Sh){(!tl||Sh[0]&256)&&D(f,"placeholder",hh[8]),(!tl||Sh[0]&256)&&D(f,"aria-label",hh[8]),Sh[0]&2&&f.value!==hh[1]&&ra(f,hh[1]),(!tl||Sh[0]&8)&&D(C,"title",hh[3]),hh[17]?rl?Sh[0]&131072&&Dt(rl,1):(rl=ua(),rl.c(),Dt(rl,1),rl.m(x,null)):rl&&(Ro(),ae(rl,1,1,()=>{rl=null}),Oo()),(!tl||Sh[0]&2)&&nn(x,"displayable",hh[1]!==""),hh[5]===!0?ah?(ah.p(hh,Sh),Sh[0]&32&&Dt(ah,1)):(ah=la(hh),ah.c(),Dt(ah,1),ah.m(r,ze)):ah&&(Ro(),ae(ah,1,1,()=>{ah=null}),Oo()),ju&&ju.p&&(!tl||Sh[1]&65536)&&pl(ju,ch,hh,hh[47],tl?gl(ch,hh[47],Sh,null):dl(hh[47]),null);let $h=qr;qr=oh(hh),qr===$h?~qr&&sl[qr].p(hh,Sh):(_n&&(Ro(),ae(sl[$h],1,1,()=>{sl[$h]=null}),Oo()),~qr?(_n=sl[qr],_n?_n.p(hh,Sh):(_n=sl[qr]=Zu[qr](hh),_n.c()),Dt(_n,1),_n.m(t,null)):_n=null),(!tl||Sh[0]&4&&Fn!==(Fn=na(hh[2])+" svelte-1r7dvt7"))&&D(t,"class",Fn),(!tl||Sh[0]&22)&&nn(t,"can-collapse",hh[4]&&hh[1]==="")},i(hh){tl||(Dt(a.$$.fragment,hh),Dt(P.$$.fragment,hh),Dt(rl),Dt(ah),Dt(ju,hh),Dt(_n),tl=!0)},o(hh){ae(a.$$.fragment,hh),ae(P.$$.fragment,hh),ae(rl),ae(ah),ae(ju,hh),ae(_n),tl=!1},d(hh){hh&&Pe(t),ar(a),e[50](null),ar(P),rl&&rl.d(),ah&&ah.d(),ju&&ju.d(hh),~qr&&sl[qr].d(),Io=!1,Fr(Co)}}}function ql(e,t,r){const n=t[1],a=t[0],s=n-a;return e===n&&r?e:((e-a)%s+s)%s+a}function fa(e){let t=[...e];return t[2]<t[0]&&(t[2]+=360),t}function Xl(e,t,r){let n,{$$slots:a={},$$scope:s}=t,{class:f=void 0}=t,{apiKey:o}=t,{bbox:x=void 0}=t,{clearButtonTitle:C="clear"}=t,{clearOnBlur:P=!1}=t,{collapsed:ge=!1}=t,{country:nt=void 0}=t,{debounceSearch:ze=200}=t,{enableReverse:Bt=!1}=t,{errorMessage:qr="Something went wrong…"}=t,{filter:_n=()=>!0}=t,{flyTo:Fn=!0}=t,{fuzzyMatch:tl=!0}=t,{language:Io=void 0}=t,{limit:Co=void 0}=t,{mapController:rl=void 0}=t,{minLength:ah=2}=t,{noResultsMessage:ch="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:ju="Search"}=t,{proximity:Zu=void 0}=t,{reverseActive:sl=Bt==="always"}=t,{reverseButtonTitle:oh="toggle reverse geocoding"}=t,{searchValue:hh=""}=t,{showFullGeometry:Sh=!0}=t,{showPlaceType:$h=!1}=t,{showResultsWhileTyping:hd=!0}=t,{trackProximity:vd=!0}=t,{types:Ef=void 0}=t,{zoom:Cd=16}=t,{fetchParameters:Cf={}}=t;function Sd(){wf.focus()}function yd(){wf.blur()}function Hd(Wd,$p=!0){r(1,hh=Wd),$p?(r(13,kd=-1),ep()):(Jd(),setTimeout(()=>{wf.focus(),wf.select()}))}let xd=!1,Pd,zd,Ld,Kd="",wf,kd=-1,cd,gd=[],bp,Uf,qd;const Vd=Il();El(()=>{rl&&(rl.setEventHandler(void 0),rl.indicateReverse(!1),rl.setSelectedMarker(-1),rl.setMarkers(void 0,void 0))});function ep(Wd){if(Uf&&(clearTimeout(Uf),Uf=void 0),kd>-1&&Pd)r(45,Ld=Pd[kd]),r(1,hh=Ld.place_name.replace(/,.*/,"")),r(16,cd=void 0),r(44,zd=void 0),r(13,kd=-1);else if(hh){const $p=Wd||!_p();lp(hh,{exact:!0}).then(()=>{r(44,zd=Pd),r(45,Ld=void 0),$p&&Kh()}).catch(Lh=>r(16,cd=Lh))}}function _p(){return/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(hh)}async function lp(Wd,{byId:$p=!1,exact:Lh=!1}={}){r(16,cd=void 0);const lh=_p(),ih=new URLSearchParams;Io!=null&&ih.set("language",Array.isArray(Io)?Io.join(","):Io),Ef&&ih.set("types",Ef.join(",")),lh||(x&&ih.set("bbox",x.map(Fh=>Fh.toFixed(6)).join(",")),nt&&ih.set("country",Array.isArray(nt)?nt.join(","):nt)),$p||(Zu&&ih.set("proximity",Zu.map(Fh=>Fh.toFixed(6)).join(",")),(Lh||!hd)&&ih.set("autocomplete","false"),ih.set("fuzzyMatch",String(tl))),Co!==void 0&&ih.set("limit",String(Co)),ih.set("key",o);const Ah="https://api.maptiler.com/geocoding/"+encodeURIComponent(Wd)+".json?"+ih.toString();if(Ah===Kd){$p?(r(12,Pd=void 0),r(45,Ld=gd[0])):r(12,Pd=gd);return}Kd=Ah,bp?.abort();const zh=new AbortController;r(17,bp=zh);let Qh;try{Qh=await fetch(Ah,{signal:zh.signal,...Cf}).finally(()=>{zh===bp&&r(17,bp=void 0)})}catch(Fh){if(Fh&&typeof Fh=="object"&&"name"in Fh&&Fh.name==="AbortError")return;throw new Error}if(!Qh.ok)throw new Error;const Th=await Qh.json();Vd("response",{url:Ah,featureCollection:Th}),$p?(r(12,Pd=void 0),r(45,Ld=Th.features[0]),gd=[Ld]):(r(12,Pd=Th.features.filter(_n)),gd=Pd,lh&&wf.focus())}function Kh(){var Wd,$p,Lh,lh;if(!(zd!=null&&zd.length)||!Fn)return;const ih=[180,90,-180,-90],Ah=!zd.some(zh=>!zh.matching_text);for(const zh of zd)(Ah||!zh.matching_text)&&(ih[0]=Math.min(ih[0],((Wd=zh.bbox)==null?void 0:Wd[0])??zh.center[0]),ih[1]=Math.min(ih[1],(($p=zh.bbox)==null?void 0:$p[1])??zh.center[1]),ih[2]=Math.max(ih[2],((Lh=zh.bbox)==null?void 0:Lh[2])??zh.center[0]),ih[3]=Math.max(ih[3],((lh=zh.bbox)==null?void 0:lh[3])??zh.center[1]));rl&&zd.length>0&&(Ld&&ih[0]===ih[2]&&ih[1]===ih[3]?rl.flyTo(Ld.center,Cd):rl.fitBounds(fa(ih),50))}function Qd(Wd){r(0,sl=Bt==="always"),Hd(ql(Wd[0],[-180,180],!0).toFixed(6)+","+Wd[1].toFixed(6))}function fd(Wd){if(!Pd)return;let $p=Wd.key==="ArrowDown"?1:Wd.key==="ArrowUp"?-1:0;$p?(kd===-1&&$p===-1&&r(13,kd=Pd.length),r(13,kd+=$p),kd>=Pd.length&&r(13,kd=-1),Wd.preventDefault()):["ArrowLeft","ArrowRight","Home","End"].includes(Wd.key)&&r(13,kd=-1)}function Jd(Wd=!0){if(r(16,cd=void 0),hd){if(Uf&&clearTimeout(Uf),hh.length<=ah)return;const $p=hh;Uf=window.setTimeout(()=>{lp($p).catch(Lh=>r(16,cd=Lh))},Wd?ze:0)}else r(12,Pd=void 0),r(16,cd=void 0)}function Yh(Wd){r(45,Ld=Wd),r(1,hh=Wd.place_name),r(13,kd=-1)}const $d=()=>wf.focus();function Jf(Wd){ys[Wd?"unshift":"push"](()=>{wf=Wd,r(15,wf)})}function Sf(){hh=this.value,r(1,hh),r(11,xd),r(25,P)}const If=()=>r(11,xd=!0),Xf=()=>r(11,xd=!1),Of=()=>Jd(),jf=()=>{r(1,hh=""),wf.focus()},Ap=()=>r(0,sl=!sl),vp=()=>r(16,cd=void 0),Tp=Wd=>r(13,kd=Wd),Zf=Wd=>Yh(Wd),qp=()=>r(13,kd=-1),sm=()=>{};return e.$$set=Wd=>{"class"in Wd&&r(2,f=Wd.class),"apiKey"in Wd&&r(23,o=Wd.apiKey),"bbox"in Wd&&r(24,x=Wd.bbox),"clearButtonTitle"in Wd&&r(3,C=Wd.clearButtonTitle),"clearOnBlur"in Wd&&r(25,P=Wd.clearOnBlur),"collapsed"in Wd&&r(4,ge=Wd.collapsed),"country"in Wd&&r(26,nt=Wd.country),"debounceSearch"in Wd&&r(27,ze=Wd.debounceSearch),"enableReverse"in Wd&&r(5,Bt=Wd.enableReverse),"errorMessage"in Wd&&r(6,qr=Wd.errorMessage),"filter"in Wd&&r(28,_n=Wd.filter),"flyTo"in Wd&&r(29,Fn=Wd.flyTo),"fuzzyMatch"in Wd&&r(30,tl=Wd.fuzzyMatch),"language"in Wd&&r(31,Io=Wd.language),"limit"in Wd&&r(32,Co=Wd.limit),"mapController"in Wd&&r(33,rl=Wd.mapController),"minLength"in Wd&&r(34,ah=Wd.minLength),"noResultsMessage"in Wd&&r(7,ch=Wd.noResultsMessage),"placeholder"in Wd&&r(8,ju=Wd.placeholder),"proximity"in Wd&&r(22,Zu=Wd.proximity),"reverseActive"in Wd&&r(0,sl=Wd.reverseActive),"reverseButtonTitle"in Wd&&r(9,oh=Wd.reverseButtonTitle),"searchValue"in Wd&&r(1,hh=Wd.searchValue),"showFullGeometry"in Wd&&r(35,Sh=Wd.showFullGeometry),"showPlaceType"in Wd&&r(10,$h=Wd.showPlaceType),"showResultsWhileTyping"in Wd&&r(36,hd=Wd.showResultsWhileTyping),"trackProximity"in Wd&&r(37,vd=Wd.trackProximity),"types"in Wd&&r(38,Ef=Wd.types),"zoom"in Wd&&r(39,Cd=Wd.zoom),"fetchParameters"in Wd&&r(40,Cf=Wd.fetchParameters),"$$scope"in Wd&&r(47,s=Wd.$$scope)},e.$$.update=()=>{if(e.$$.dirty[1]&64&&(vd||r(22,Zu=void 0)),e.$$.dirty[0]&33556480&&setTimeout(()=>{r(14,qd=xd),P&&!xd&&r(1,hh="")}),e.$$.dirty[0]&4098&&(hh||(r(45,Ld=void 0),r(12,Pd=void 0),r(16,cd=void 0),r(44,zd=Pd))),e.$$.dirty[1]&16400&&Sh&&Ld&&!Ld.address&&Ld.geometry.type==="Point"&&lp(Ld.id,{byId:!0}).catch(Wd=>r(16,cd=Wd)),e.$$.dirty[0]&536870912|e.$$.dirty[1]&16644&&rl&&Ld&&Fn&&(!Ld.bbox||Ld.bbox[0]===Ld.bbox[2]&&Ld.bbox[1]===Ld.bbox[3]?rl.flyTo(Ld.center,Cd):rl.fitBounds(fa(Ld.bbox),50),r(12,Pd=void 0),r(44,zd=void 0),r(13,kd=-1)),e.$$.dirty[0]&4096|e.$$.dirty[1]&8192&&zd!==Pd&&r(44,zd=void 0),e.$$.dirty[1]&24580&&rl&&rl.setMarkers(zd,Ld),e.$$.dirty[0]&2&&r(13,kd=-1),e.$$.dirty[0]&20481|e.$$.dirty[1]&68&&rl&&rl.setEventHandler(Wd=>{switch(Wd.type){case"mapClick":sl&&Qd(Wd.coordinates);break;case"proximityChange":r(22,Zu=vd?Wd.proximity:void 0);break;case"markerClick":{const $p=Pd?.find(Lh=>Lh.id===Wd.id);$p&&Yh($p)}break;case"markerMouseEnter":r(13,kd=qd?Pd?.findIndex($p=>$p.id===Wd.id)??-1:-1);break;case"markerMouseLeave":r(13,kd=-1);break}}),e.$$.dirty[0]&8192|e.$$.dirty[1]&4&&rl?.setSelectedMarker(kd),e.$$.dirty[0]&12288&&r(46,n=Pd?.[kd]),e.$$.dirty[0]&2|e.$$.dirty[1]&4){const Wd=/^(-?\d+(?:\.\d*)?),(-?\d+(?:\.\d*)?)$/.exec(hh);rl?.setReverseMarker(Wd?[Number(Wd[1]),Number(Wd[2])]:void 0)}e.$$.dirty[1]&32768&&Vd("select",n),e.$$.dirty[1]&16384&&Vd("pick",Ld),e.$$.dirty[0]&20480&&Vd("optionsVisibilityChange",qd&&!!Pd),e.$$.dirty[0]&4096&&Vd("featuresListed",Pd),e.$$.dirty[1]&8192&&Vd("featuresMarked",zd),e.$$.dirty[0]&1&&Vd("reverseToggle",sl),e.$$.dirty[0]&2&&Vd("queryChange",hh),e.$$.dirty[0]&1|e.$$.dirty[1]&4&&rl&&rl.indicateReverse(sl)},[sl,hh,f,C,ge,Bt,qr,ch,ju,oh,$h,xd,Pd,kd,qd,wf,cd,bp,ep,fd,Jd,Yh,Zu,o,x,P,nt,ze,_n,Fn,tl,Io,Co,rl,ah,Sh,hd,vd,Ef,Cd,Cf,Sd,yd,Hd,zd,Ld,n,s,a,$d,Jf,Sf,If,Xf,Of,jf,Ap,vp,Tp,Zf,qp,sm]}let Yl=class extends Gr{constructor(e){super(),kr(this,e,Xl,Ul,Br,{class:2,apiKey:23,bbox:24,clearButtonTitle:3,clearOnBlur:25,collapsed:4,country:26,debounceSearch:27,enableReverse:5,errorMessage:6,filter:28,flyTo:29,fuzzyMatch:30,language:31,limit:32,mapController:33,minLength:34,noResultsMessage:7,placeholder:8,proximity:22,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:35,showPlaceType:10,showResultsWhileTyping:36,trackProximity:37,types:38,zoom:39,fetchParameters:40,focus:41,blur:42,setQuery:43},null,[-1,-1,-1])}get focus(){return this.$$.ctx[41]}get blur(){return this.$$.ctx[42]}get setQuery(){return this.$$.ctx[43]}};/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Hl(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function o(C){return function(P){return x([C,P])}}function x(C){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=C[0]&2?a.return:C[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,C[1])).done)return s;switch(a=0,s&&(C=[C[0]&2,s.value]),C[0]){case 0:case 1:s=C;break;case 4:return r.label++,{value:C[1],done:!1};case 5:r.label++,a=C[1],C=[0];continue;case 7:C=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(C[0]===6||C[0]===2)){r=0;continue}if(C[0]===3&&(!s||C[1]>s[0]&&C[1]<s[3])){r.label=C[1];break}if(C[0]===6&&r.label<s[1]){r.label=s[1],s=C;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(C);break}s[2]&&r.ops.pop(),r.trys.pop();continue}C=t.call(e,r)}catch(P){C=[6,P],a=0}finally{n=s=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var wr=function(){function e(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return e}();function Wl(e,t){return e>t?1:e<t?-1:0}function Ir(e,t,r){for(var n=new wr(null,null),a=n,s=n;;){var f=r(e,t.key);if(f<0){if(t.left===null)break;if(r(e,t.left.key)<0){var o=t.left;if(t.left=o.right,o.right=t,t=o,t.left===null)break}s.left=t,s=t,t=t.left}else if(f>0){if(t.right===null)break;if(r(e,t.right.key)>0){var o=t.right;if(t.right=o.left,o.left=t,t=o,t.right===null)break}a.right=t,a=t,t=t.right}else break}return a.right=t.left,s.left=t.right,t.left=n.right,t.right=n.left,t}function gs(e,t,r,n){var a=new wr(e,t);if(r===null)return a.left=a.right=null,a;r=Ir(e,r,n);var s=n(e,r.key);return s<0?(a.left=r.left,a.right=r,r.left=null):s>=0&&(a.right=r.right,a.left=r,r.right=null),a}function ha(e,t,r){var n=null,a=null;if(t){t=Ir(e,t,r);var s=r(t.key,e);s===0?(n=t.left,a=t.right):s<0?(a=t.right,t.right=null,n=t):(n=t.left,t.left=null,a=t)}return{left:n,right:a}}function jl(e,t,r){return t===null?e:(e===null||(t=Ir(e.key,t,r),t.left=e),t)}function Es(e,t,r,n,a){if(e){n(""+t+(r?"└── ":"├── ")+a(e)+`
`);var s=t+(r?"    ":"│   ");e.left&&Es(e.left,s,!1,n,a),e.right&&Es(e.right,s,!0,n,a)}}var Ms=function(){function e(t){t===void 0&&(t=Wl),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,r){return this._size++,this._root=gs(t,r,this._root,this._comparator)},e.prototype.add=function(t,r){var n=new wr(t,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var a=this._comparator,s=Ir(t,this._root,a),f=a(t,s.key);return f===0?this._root=s:(f<0?(n.left=s.left,n.right=s,s.left=null):f>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,r,n){var a;if(r===null)return null;r=Ir(t,r,n);var s=n(t,r.key);return s===0?(r.left===null?a=r.right:(a=Ir(t,r.left,n),a.right=r.right),this._size--,a):r},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Ir(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var r=this._root,n=this._comparator;r;){var a=n(t,r.key);if(a===0)return r;a<0?r=r.left:r=r.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Ir(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var r=this._root,n=this._comparator;r;){var a=n(t,r.key);if(a===0)return!0;a<0?r=r.left:r=r.right}return!1},e.prototype.forEach=function(t,r){for(var n=this._root,a=[],s=!1;!s;)n!==null?(a.push(n),n=n.left):a.length!==0?(n=a.pop(),t.call(r,n),n=n.right):s=!0;return this},e.prototype.range=function(t,r,n,a){for(var s=[],f=this._comparator,o=this._root,x;s.length!==0||o;)if(o)s.push(o),o=o.left;else{if(o=s.pop(),x=f(o.key,r),x>0)break;if(f(o.key,t)>=0&&n.call(a,o))return this;o=o.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(r){var n=r.key;return t.push(n)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(r){var n=r.data;return t.push(n)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var r=this._root,n=!1,a=0,s=[];!n;)if(r)s.push(r),r=r.left;else if(s.length>0){if(r=s.pop(),a===t)return r;a++,r=r.right}else n=!0;return null},e.prototype.next=function(t){var r=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var a=this._comparator;r;){var s=a(t.key,r.key);if(s===0)break;s<0?(n=r,r=r.left):r=r.right}return n},e.prototype.prev=function(t){var r=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var a=this._comparator;r;){var s=a(t.key,r.key);if(s===0)break;s<0?r=r.left:(n=r,r=r.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return Ql(this._root)},e.prototype.load=function(t,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var a=t.length,s=this._comparator;if(n&&Ns(t,r,0,a-1,s),this._root===null)this._root=Is(t,r,0,a),this._size=a;else{var f=Jl(this.toList(),Kl(t,r),s);a=this._size+a,this._root=Cs({head:f},0,a)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var r=[];return Es(this._root,"",!0,function(n){return r.push(n)},t),r.join("")},e.prototype.update=function(t,r,n){var a=this._comparator,s=ha(t,this._root,a),f=s.left,o=s.right;a(t,r)<0?o=gs(r,n,o,a):f=gs(r,n,f,a),this._root=jl(f,o,a)},e.prototype.split=function(t){return ha(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t;return Hl(this,function(r){switch(r.label){case 0:t=this.minNode(),r.label=1;case 1:return t?[4,t]:[3,3];case 2:return r.sent(),t=this.next(t),[3,1];case 3:return[2]}})},e}();function Is(e,t,r,n){var a=n-r;if(a>0){var s=r+Math.floor(a/2),f=e[s],o=t[s],x=new wr(f,o);return x.left=Is(e,t,r,s),x.right=Is(e,t,s+1,n),x}return null}function Kl(e,t){for(var r=new wr(null,null),n=r,a=0;a<e.length;a++)n=n.next=new wr(e[a],t[a]);return n.next=null,r.next}function Ql(e){for(var t=e,r=[],n=!1,a=new wr(null,null),s=a;!n;)t?(r.push(t),t=t.left):r.length>0?(t=s=s.next=r.pop(),t=t.right):n=!0;return s.next=null,a.next}function Cs(e,t,r){var n=r-t;if(n>0){var a=t+Math.floor(n/2),s=Cs(e,t,a),f=e.head;return f.left=s,e.head=e.head.next,f.right=Cs(e,a+1,r),f}return null}function Jl(e,t,r){for(var n=new wr(null,null),a=n,s=e,f=t;s!==null&&f!==null;)r(s.key,f.key)<0?(a.next=s,s=s.next):(a.next=f,f=f.next),a=a.next;return s!==null?a.next=s:f!==null&&(a.next=f),n.next}function Ns(e,t,r,n,a){if(!(r>=n)){for(var s=e[r+n>>1],f=r-1,o=n+1;;){do f++;while(a(e[f],s)<0);do o--;while(a(e[o],s)>0);if(f>=o)break;var x=e[f];e[f]=e[o],e[o]=x,x=t[f],t[f]=t[o],t[o]=x}Ns(e,t,r,o,a),Ns(e,t,o+1,n,a)}}function vn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ga(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ne(e,t,r){return t&&ga(e.prototype,t),r&&ga(e,r),e}var qi=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},xs=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x,a=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:a},ur:{x:n,y:s}}},Cr=Number.EPSILON;Cr===void 0&&(Cr=Math.pow(2,-52));var Zl=Cr*Cr,Ss=function(e,t){if(-Cr<e&&e<Cr&&-Cr<t&&t<Cr)return 0;var r=e-t;return r*r<Zl*e*t?0:e<t?-1:1},$l=function(){function e(){vn(this,e),this.reset()}return Ne(e,[{key:"reset",value:function(){this.xRounder=new pa,this.yRounder=new pa}},{key:"round",value:function(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}]),e}(),pa=function(){function e(){vn(this,e),this.tree=new Ms,this.round(0)}return Ne(e,[{key:"round",value:function(t){var r=this.tree.add(t),n=this.tree.prev(r);if(n!==null&&Ss(r.key,n.key)===0)return this.tree.remove(t),n.key;var a=this.tree.next(r);return a!==null&&Ss(r.key,a.key)===0?(this.tree.remove(t),a.key):t}}]),e}(),Ji=new $l,ji=function(e,t){return e.x*t.y-e.y*t.x},tu=function(e,t){return e.x*t.x+e.y*t.y},da=function(e,t,r){var n={x:t.x-e.x,y:t.y-e.y},a={x:r.x-e.x,y:r.y-e.y},s=ji(n,a);return Ss(s,0)},Mo=function(e){return Math.sqrt(tu(e,e))},tc=function(e,t,r){var n={x:t.x-e.x,y:t.y-e.y},a={x:r.x-e.x,y:r.y-e.y};return ji(a,n)/Mo(a)/Mo(n)},ec=function(e,t,r){var n={x:t.x-e.x,y:t.y-e.y},a={x:r.x-e.x,y:r.y-e.y};return tu(a,n)/Mo(a)/Mo(n)},va=function(e,t,r){return t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r}},ya=function(e,t,r){return t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)}},nc=function(e,t,r,n){if(t.x===0)return ya(r,n,e.x);if(n.x===0)return ya(e,t,r.x);if(t.y===0)return va(r,n,e.y);if(n.y===0)return va(e,t,r.y);var a=ji(t,n);if(a==0)return null;var s={x:r.x-e.x,y:r.y-e.y},f=ji(s,t)/a,o=ji(s,n)/a,x=e.x+o*t.x,C=r.x+f*n.x,P=e.y+o*t.y,ge=r.y+f*n.y,nt=(x+C)/2,ze=(P+ge)/2;return{x:nt,y:ze}},Xn=function(){Ne(e,null,[{key:"compare",value:function(t,r){var n=e.comparePoints(t.point,r.point);return n!==0?n:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Ao.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}}]);function e(t,r){vn(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}return Ne(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var r=t.point.events,n=0,a=r.length;n<a;n++){var s=r[n];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,r=0;r<t;r++){var n=this.point.events[r];if(n.segment.consumedBy===void 0)for(var a=r+1;a<t;a++){var s=this.point.events[a];s.consumedBy===void 0&&n.otherSE.point.events===s.otherSE.point.events&&n.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],r=0,n=this.point.events.length;r<n;r++){var a=this.point.events[r];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}},{key:"getLeftmostComparator",value:function(t){var r=this,n=new Map,a=function(s){var f=s.otherSE;n.set(s,{sine:tc(r.point,t.point,f.point),cosine:ec(r.point,t.point,f.point)})};return function(s,f){n.has(s)||a(s),n.has(f)||a(f);var o=n.get(s),x=o.sine,C=o.cosine,P=n.get(f),ge=P.sine,nt=P.cosine;return x>=0&&ge>=0?C<nt?1:C>nt?-1:0:x<0&&ge<0?C<nt?-1:C>nt?1:0:ge<x?-1:ge>x?1:0}}}]),e}(),rc=0,Ao=function(){Ne(e,null,[{key:"compare",value:function(t,r){var n=t.leftSE.point.x,a=r.leftSE.point.x,s=t.rightSE.point.x,f=r.rightSE.point.x;if(f<n)return 1;if(s<a)return-1;var o=t.leftSE.point.y,x=r.leftSE.point.y,C=t.rightSE.point.y,P=r.rightSE.point.y;if(n<a){if(x<o&&x<C)return 1;if(x>o&&x>C)return-1;var ge=t.comparePoint(r.leftSE.point);if(ge<0)return 1;if(ge>0)return-1;var nt=r.comparePoint(t.rightSE.point);return nt!==0?nt:-1}if(n>a){if(o<x&&o<P)return-1;if(o>x&&o>P)return 1;var ze=r.comparePoint(t.leftSE.point);if(ze!==0)return ze;var Bt=t.comparePoint(r.rightSE.point);return Bt<0?1:Bt>0?-1:1}if(o<x)return-1;if(o>x)return 1;if(s<f){var qr=r.comparePoint(t.rightSE.point);if(qr!==0)return qr}if(s>f){var _n=t.comparePoint(r.rightSE.point);if(_n<0)return 1;if(_n>0)return-1}if(s!==f){var Fn=C-o,tl=s-n,Io=P-x,Co=f-a;if(Fn>tl&&Io<Co)return 1;if(Fn<tl&&Io>Co)return-1}return s>f?1:s<f||C<P?-1:C>P?1:t.id<r.id?-1:t.id>r.id?1:0}}]);function e(t,r,n,a){vn(this,e),this.id=++rc,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=n,this.windings=a}return Ne(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var r=this.leftSE.point,n=this.rightSE.point,a=this.vector();if(r.x===n.x)return t.x===r.x?0:t.x<r.x?1:-1;var s=(t.y-r.y)/a.y,f=r.x+s*a.x;if(t.x===f)return 0;var o=(t.x-r.x)/a.x,x=r.y+o*a.y;return t.y===x?0:t.y<x?-1:1}},{key:"getIntersection",value:function(t){var r=this.bbox(),n=t.bbox(),a=xs(r,n);if(a===null)return null;var s=this.leftSE.point,f=this.rightSE.point,o=t.leftSE.point,x=t.rightSE.point,C=qi(r,o)&&this.comparePoint(o)===0,P=qi(n,s)&&t.comparePoint(s)===0,ge=qi(r,x)&&this.comparePoint(x)===0,nt=qi(n,f)&&t.comparePoint(f)===0;if(P&&C)return nt&&!ge?f:!nt&&ge?x:null;if(P)return ge&&s.x===x.x&&s.y===x.y?null:s;if(C)return nt&&f.x===o.x&&f.y===o.y?null:o;if(nt&&ge)return null;if(nt)return f;if(ge)return x;var ze=nc(s,this.vector(),o,t.vector());return ze===null||!qi(a,ze)?null:Ji.round(ze.x,ze.y)}},{key:"split",value:function(t){var r=[],n=t.events!==void 0,a=new Xn(t,!0),s=new Xn(t,!1),f=this.rightSE;this.replaceRightSE(s),r.push(s),r.push(a);var o=new e(a,f,this.rings.slice(),this.windings.slice());return Xn.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Xn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(a.checkForConsuming(),s.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}},{key:"consume",value:function(t){for(var r=this,n=t;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var a=e.compare(r,n);if(a!==0){if(a>0){var s=r;r=n,n=s}if(r.prev===n){var f=r;r=n,n=f}for(var o=0,x=n.rings.length;o<x;o++){var C=n.rings[o],P=n.windings[o],ge=r.rings.indexOf(C);ge===-1?(r.rings.push(C),r.windings.push(P)):r.windings[ge]+=P}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,n=this._afterState.windings,a=this._afterState.multiPolys,s=0,f=this.rings.length;s<f;s++){var o=this.rings[s],x=this.windings[s],C=r.indexOf(o);C===-1?(r.push(o),n.push(x)):n[C]+=x}for(var P=[],ge=[],nt=0,ze=r.length;nt<ze;nt++)if(n[nt]!==0){var Bt=r[nt],qr=Bt.poly;if(ge.indexOf(qr)===-1)if(Bt.isExterior)P.push(qr);else{ge.indexOf(qr)===-1&&ge.push(qr);var _n=P.indexOf(Bt.poly);_n!==-1&&P.splice(_n,1)}}for(var Fn=0,tl=P.length;Fn<tl;Fn++){var Io=P[Fn].multiPoly;a.indexOf(Io)===-1&&a.push(Io)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Nn.type){case"union":{var n=t.length===0,a=r.length===0;this._isInResult=n!==a;break}case"intersection":{var s,f;t.length<r.length?(s=t.length,f=r.length):(s=r.length,f=t.length),this._isInResult=f===Nn.numMultiPolys&&s<f;break}case"xor":{var o=Math.abs(t.length-r.length);this._isInResult=o%2===1;break}case"difference":{var x=function(C){return C.length===1&&C[0].isSubject};this._isInResult=x(t)!==x(r);break}default:throw new Error("Unrecognized operation type found ".concat(Nn.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,n){var a,s,f,o=Xn.comparePoints(t,r);if(o<0)a=t,s=r,f=1;else if(o>0)a=r,s=t,f=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var x=new Xn(a,!0),C=new Xn(s,!1);return new e(x,C,[n],[f])}}]),e}(),ma=function(){function e(t,r,n){if(vn(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=Ji.round(t[0][0],t[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};for(var s=a,f=1,o=t.length;f<o;f++){if(typeof t[f][0]!="number"||typeof t[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var x=Ji.round(t[f][0],t[f][1]);x.x===s.x&&x.y===s.y||(this.segments.push(Ao.fromRing(s,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),s=x)}(a.x!==s.x||a.y!==s.y)&&this.segments.push(Ao.fromRing(s,a,this))}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,n=this.segments.length;r<n;r++){var a=this.segments[r];t.push(a.leftSE),t.push(a.rightSE)}return t}}]),e}(),ic=function(){function e(t,r){if(vn(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ma(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,a=t.length;n<a;n++){var s=new ma(t[n],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=r}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),r=0,n=this.interiorRings.length;r<n;r++)for(var a=this.interiorRings[r].getSweepEvents(),s=0,f=a.length;s<f;s++)t.push(a[s]);return t}}]),e}(),_a=function(){function e(t,r){if(vn(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,a=t.length;n<a;n++){var s=new ic(t[n],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=r}return Ne(e,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,n=this.polys.length;r<n;r++)for(var a=this.polys[r].getSweepEvents(),s=0,f=a.length;s<f;s++)t.push(a[s]);return t}}]),e}(),oc=function(){Ne(e,null,[{key:"factory",value:function(t){for(var r=[],n=0,a=t.length;n<a;n++){var s=t[n];if(!(!s.isInResult()||s.ringOut)){for(var f=null,o=s.leftSE,x=s.rightSE,C=[o],P=o.point,ge=[];f=o,o=x,C.push(o),o.point!==P;)for(;;){var nt=o.getAvailableLinkedEvents();if(nt.length===0){var ze=C[0].point,Bt=C[C.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(ze.x,",")+" ".concat(ze.y,"]. Last matching segment found ends at")+" [".concat(Bt.x,", ").concat(Bt.y,"]."))}if(nt.length===1){x=nt[0].otherSE;break}for(var qr=null,_n=0,Fn=ge.length;_n<Fn;_n++)if(ge[_n].point===o.point){qr=_n;break}if(qr!==null){var tl=ge.splice(qr)[0],Io=C.splice(tl.index);Io.unshift(Io[0].otherSE),r.push(new e(Io.reverse()));continue}ge.push({index:C.length,point:o.point});var Co=o.getLeftmostComparator(f);x=nt.sort(Co)[0].otherSE;break}r.push(new e(C))}}return r}}]);function e(t){vn(this,e),this.events=t;for(var r=0,n=t.length;r<n;r++)t[r].segment.ringOut=this;this.poly=null}return Ne(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,r=[t],n=1,a=this.events.length-1;n<a;n++){var s=this.events[n].point,f=this.events[n+1].point;da(s,t,f)!==0&&(r.push(s),t=s)}if(r.length===1)return null;var o=r[0],x=r[1];da(o,t,x)===0&&r.shift(),r.push(r[0]);for(var C=this.isExteriorRing()?1:-1,P=this.isExteriorRing()?0:r.length-1,ge=this.isExteriorRing()?r.length:-1,nt=[],ze=P;ze!=ge;ze+=C)nt.push([r[ze].x,r[ze].y]);return nt}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],r=1,n=this.events.length;r<n;r++){var a=this.events[r];Xn.compare(t,a)>0&&(t=a)}for(var s=t.segment.prevInResult(),f=s?s.prevInResult():null;;){if(!s)return null;if(!f)return s.ringOut;if(f.ringOut!==s.ringOut)return f.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=f.prevInResult(),f=s?s.prevInResult():null}}}]),e}(),Ea=function(){function e(t){vn(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Ne(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var r=0,n=this.interiorRings.length;r<n;r++){var a=this.interiorRings[r].getGeom();a!==null&&t.push(a)}return t}}]),e}(),sc=function(){function e(t){vn(this,e),this.rings=t,this.polys=this._composePolys(t)}return Ne(e,[{key:"getGeom",value:function(){for(var t=[],r=0,n=this.polys.length;r<n;r++){var a=this.polys[r].getGeom();a!==null&&t.push(a)}return t}},{key:"_composePolys",value:function(t){for(var r=[],n=0,a=t.length;n<a;n++){var s=t[n];if(!s.poly)if(s.isExteriorRing())r.push(new Ea(s));else{var f=s.enclosingRing();f.poly||r.push(new Ea(f)),f.poly.addInterior(s)}}return r}}]),e}(),ac=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ao.compare;vn(this,e),this.queue=t,this.tree=new Ms(r),this.segments=[]}return Ne(e,[{key:"process",value:function(t){var r=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),n;var a=t.isLeft?this.tree.insert(r):this.tree.find(r);if(!a)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=a,f=a,o=void 0,x=void 0;o===void 0;)s=this.tree.prev(s),s===null?o=null:s.key.consumedBy===void 0&&(o=s.key);for(;x===void 0;)f=this.tree.next(f),f===null?x=null:f.key.consumedBy===void 0&&(x=f.key);if(t.isLeft){var C=null;if(o){var P=o.getIntersection(r);if(P!==null&&(r.isAnEndpoint(P)||(C=P),!o.isAnEndpoint(P)))for(var ge=this._splitSafely(o,P),nt=0,ze=ge.length;nt<ze;nt++)n.push(ge[nt])}var Bt=null;if(x){var qr=x.getIntersection(r);if(qr!==null&&(r.isAnEndpoint(qr)||(Bt=qr),!x.isAnEndpoint(qr)))for(var _n=this._splitSafely(x,qr),Fn=0,tl=_n.length;Fn<tl;Fn++)n.push(_n[Fn])}if(C!==null||Bt!==null){var Io=null;if(C===null)Io=Bt;else if(Bt===null)Io=C;else{var Co=Xn.comparePoints(C,Bt);Io=Co<=0?C:Bt}this.queue.remove(r.rightSE),n.push(r.rightSE);for(var rl=r.split(Io),ah=0,ch=rl.length;ah<ch;ah++)n.push(rl[ah])}n.length>0?(this.tree.remove(r),n.push(t)):(this.segments.push(r),r.prev=o)}else{if(o&&x){var ju=o.getIntersection(x);if(ju!==null){if(!o.isAnEndpoint(ju))for(var Zu=this._splitSafely(o,ju),sl=0,oh=Zu.length;sl<oh;sl++)n.push(Zu[sl]);if(!x.isAnEndpoint(ju))for(var hh=this._splitSafely(x,ju),Sh=0,$h=hh.length;Sh<$h;Sh++)n.push(hh[Sh])}}this.tree.remove(r)}return n}},{key:"_splitSafely",value:function(t,r){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var a=t.split(r);return a.push(n),t.consumedBy===void 0&&this.tree.insert(t),a}}]),e}(),Ia=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,uc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,lc=function(){function e(){vn(this,e)}return Ne(e,[{key:"run",value:function(t,r,n){Nn.type=t,Ji.reset();for(var a=[new _a(r,!0)],s=0,f=n.length;s<f;s++)a.push(new _a(n[s],!1));if(Nn.numMultiPolys=a.length,Nn.type==="difference")for(var o=a[0],x=1;x<a.length;)xs(a[x].bbox,o.bbox)!==null?x++:a.splice(x,1);if(Nn.type==="intersection"){for(var C=0,P=a.length;C<P;C++)for(var ge=a[C],nt=C+1,ze=a.length;nt<ze;nt++)if(xs(ge.bbox,a[nt].bbox)===null)return[]}for(var Bt=new Ms(Xn.compare),qr=0,_n=a.length;qr<_n;qr++)for(var Fn=a[qr].getSweepEvents(),tl=0,Io=Fn.length;tl<Io;tl++)if(Bt.insert(Fn[tl]),Bt.size>Ia)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Co=new ac(Bt),rl=Bt.size,ah=Bt.pop();ah;){var ch=ah.key;if(Bt.size===rl){var ju=ch.segment;throw new Error("Unable to pop() ".concat(ch.isLeft?"left":"right"," SweepEvent ")+"[".concat(ch.point.x,", ").concat(ch.point.y,"] from segment #").concat(ju.id," ")+"[".concat(ju.leftSE.point.x,", ").concat(ju.leftSE.point.y,"] -> ")+"[".concat(ju.rightSE.point.x,", ").concat(ju.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Bt.size>Ia)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Co.segments.length>uc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Zu=Co.process(ch),sl=0,oh=Zu.length;sl<oh;sl++){var hh=Zu[sl];hh.consumedBy===void 0&&Bt.insert(hh)}rl=Bt.size,ah=Bt.pop()}Ji.reset();var Sh=oc.factory(Co.segments),$h=new sc(Sh);return $h.getGeom()}}]),e}(),Nn=new lc,cc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("union",e,r)},fc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("intersection",e,r)},hc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("xor",e,r)},gc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Nn.run("difference",e,r)},eu={union:cc,intersection:fc,xor:hc,difference:gc},Ee=63710088e-1,nu={centimeters:Ee*100,centimetres:Ee*100,degrees:Ee/111325,feet:Ee*3.28084,inches:Ee*39.37,kilometers:Ee/1e3,kilometres:Ee/1e3,meters:Ee,metres:Ee,miles:Ee/1609.344,millimeters:Ee*1e3,millimetres:Ee*1e3,nauticalmiles:Ee/1852,radians:1,yards:Ee*1.0936};function Wo(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function pc(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ca(e[0])||!Ca(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Wo(n,t,r)}function ru(e,t,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:e};return Wo(o,t,r)}function ws(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function iu(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Wo(n,t,r)}function dc(e,t){t===void 0&&(t="kilometers");var r=nu[t];if(!r)throw new Error(t+" units is invalid");return e*r}function vc(e,t){t===void 0&&(t="kilometers");var r=nu[t];if(!r)throw new Error(t+" units is invalid");return e/r}function Ca(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Fo(e){return e.type==="Feature"?e.geometry:e}function yc(e,t,r){r===void 0&&(r={});var n=Fo(e),a=Fo(t),s=eu.union(n.coordinates,a.coordinates);return s.length===0?null:s.length===1?ru(s[0],r.properties):iu(s,r.properties)}function mc(e){let t,r,n;return{c(){t=jn("svg"),r=jn("path"),D(r,"stroke-width","4"),D(r,"fill-rule","evenodd"),D(r,"clip-rule","evenodd"),D(r,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),D(r,"class","svelte-1k1cmht"),D(t,"width",n=e[0]!=="list"?void 0:"20"),D(t,"viewBox","0 0 70 85"),D(t,"fill","none"),D(t,"class","svelte-1k1cmht"),nn(t,"in-map",e[0]!=="list"),nn(t,"list-icon",e[0]==="list")},m(a,s){Be(a,t,s),rt(t,r)},p(a,[s]){s&1&&n!==(n=a[0]!=="list"?void 0:"20")&&D(t,"width",n),s&1&&nn(t,"in-map",a[0]!=="list"),s&1&&nn(t,"list-icon",a[0]==="list")},i:_t,o:_t,d(a){a&&Pe(t)}}}function _c(e,t,r){let{displayIn:n}=t;return e.$$set=a=>{"displayIn"in a&&r(0,n=a.displayIn)},[n]}class Ec extends Gr{constructor(t){super(),kr(this,t,_c,mc,Br,{displayIn:0})}}function ou(e,t,r){if(e!==null)for(var n,a,s,f,o,x,C,P=0,ge=0,nt,ze=e.type,Bt=ze==="FeatureCollection",qr=ze==="Feature",_n=Bt?e.features.length:1,Fn=0;Fn<_n;Fn++){C=Bt?e.features[Fn].geometry:qr?e.geometry:e,nt=C?C.type==="GeometryCollection":!1,o=nt?C.geometries.length:1;for(var tl=0;tl<o;tl++){var Io=0,Co=0;if(f=nt?C.geometries[tl]:C,f!==null){x=f.coordinates;var rl=f.type;switch(P=r&&(rl==="Polygon"||rl==="MultiPolygon")?1:0,rl){case null:break;case"Point":if(t(x,ge,Fn,Io,Co)===!1)return!1;ge++,Io++;break;case"LineString":case"MultiPoint":for(n=0;n<x.length;n++){if(t(x[n],ge,Fn,Io,Co)===!1)return!1;ge++,rl==="MultiPoint"&&Io++}rl==="LineString"&&Io++;break;case"Polygon":case"MultiLineString":for(n=0;n<x.length;n++){for(a=0;a<x[n].length-P;a++){if(t(x[n][a],ge,Fn,Io,Co)===!1)return!1;ge++}rl==="MultiLineString"&&Io++,rl==="Polygon"&&Co++}rl==="Polygon"&&Io++;break;case"MultiPolygon":for(n=0;n<x.length;n++){for(Co=0,a=0;a<x[n].length;a++){for(s=0;s<x[n][a].length-P;s++){if(t(x[n][a][s],ge,Fn,Io,Co)===!1)return!1;ge++}Co++}Io++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(ou(f.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Na(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function su(e,t){var r,n,a,s,f,o,x,C,P,ge,nt=0,ze=e.type==="FeatureCollection",Bt=e.type==="Feature",qr=ze?e.features.length:1;for(r=0;r<qr;r++){for(o=ze?e.features[r].geometry:Bt?e.geometry:e,C=ze?e.features[r].properties:Bt?e.properties:{},P=ze?e.features[r].bbox:Bt?e.bbox:void 0,ge=ze?e.features[r].id:Bt?e.id:void 0,x=o?o.type==="GeometryCollection":!1,f=x?o.geometries.length:1,a=0;a<f;a++){if(s=x?o.geometries[a]:o,s===null){if(t(null,nt,C,P,ge)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,nt,C,P,ge)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(t(s.geometries[n],nt,C,P,ge)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}nt++}}function Ls(e){var t=[1/0,1/0,-1/0,-1/0];return ou(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Ls.default=Ls;function Ic(e,t){t===void 0&&(t={});var r=Ls(e),n=(r[0]+r[2])/2,a=(r[1]+r[3])/2;return pc([n,a],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),r=Math.max(Math.min(t.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(r+n,0):Math.min(n,r);var a=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:r;for(a=a<0?Math.max(r+arguments[2],0):Math.min(a,r);n<a;)t[n]=e,++n;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var jr=function(){};jr.prototype.interfaces_=function(){return[]};jr.prototype.getClass=function(){return jr};jr.prototype.equalsWithTolerance=function(e,t,r){return Math.abs(e-t)<=r};var ct=function(e){function t(r){e.call(this,r),this.name="IllegalArgumentException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),z=function(){},au={MAX_VALUE:{configurable:!0}};z.isNaN=function(e){return Number.isNaN(e)};z.doubleToLongBits=function(e){return e};z.longBitsToDouble=function(e){return e};z.isInfinite=function(e){return!Number.isFinite(e)};au.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(z,au);var ke=function(){},jo=function(){},vi=function(){};function Ge(){}var v=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},si={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};v.prototype.setOrdinate=function(e,t){switch(e){case v.X:this.x=t;break;case v.Y:this.y=t;break;case v.Z:this.z=t;break;default:throw new ct("Invalid ordinate index: "+e)}};v.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return!(!jr.equalsWithTolerance(this.x,t.x,r)||!jr.equalsWithTolerance(this.y,t.y,r))}};v.prototype.getOrdinate=function(e){switch(e){case v.X:return this.x;case v.Y:return this.y;case v.Z:return this.z}throw new ct("Invalid ordinate index: "+e)};v.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||z.isNaN(this.z))&&z.isNaN(e.z)};v.prototype.equals=function(e){return e instanceof v?this.equals2D(e):!1};v.prototype.equalInZ=function(e,t){return jr.equalsWithTolerance(this.z,e.z,t)};v.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};v.prototype.clone=function(){};v.prototype.copy=function(){return new v(this)};v.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};v.prototype.distance3D=function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return Math.sqrt(t*t+r*r+n*n)};v.prototype.distance=function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)};v.prototype.hashCode=function(){var e=17;return e=37*e+v.hashCode(this.x),e=37*e+v.hashCode(this.y),e};v.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};v.prototype.interfaces_=function(){return[ke,jo,Ge]};v.prototype.getClass=function(){return v};v.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=z.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};si.DimensionalComparator.get=function(){return rr};si.serialVersionUID.get=function(){return 6683108902428367e3};si.NULL_ORDINATE.get=function(){return z.NaN};si.X.get=function(){return 0};si.Y.get=function(){return 1};si.Z.get=function(){return 2};Object.defineProperties(v,si);var rr=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new ct("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};rr.prototype.compare=function(e,t){var r=e,n=t,a=rr.compare(r.x,n.x);if(a!==0)return a;var s=rr.compare(r.y,n.y);if(s!==0)return s;if(this._dimensionsToTest<=2)return 0;var f=rr.compare(r.z,n.z);return f};rr.prototype.interfaces_=function(){return[vi]};rr.prototype.getClass=function(){return rr};rr.compare=function(e,t){return e<t?-1:e>t?1:z.isNaN(e)?z.isNaN(t)?0:-1:z.isNaN(t)?1:0};var yi=function(){};yi.prototype.create=function(){};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};var m=function(){},ho={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};m.prototype.interfaces_=function(){return[]};m.prototype.getClass=function(){return m};m.toLocationSymbol=function(e){switch(e){case m.EXTERIOR:return"e";case m.BOUNDARY:return"b";case m.INTERIOR:return"i";case m.NONE:return"-"}throw new ct("Unknown location value: "+e)};ho.INTERIOR.get=function(){return 0};ho.BOUNDARY.get=function(){return 1};ho.EXTERIOR.get=function(){return 2};ho.NONE.get=function(){return-1};Object.defineProperties(m,ho);var G=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},xe=function(){},uu={LOG_10:{configurable:!0}};xe.prototype.interfaces_=function(){return[]};xe.prototype.getClass=function(){return xe};xe.log10=function(e){var t=Math.log(e);return z.isInfinite(t)||z.isNaN(t)?t:t/xe.LOG_10};xe.min=function(e,t,r,n){var a=e;return t<a&&(a=t),r<a&&(a=r),n<a&&(a=n),a};xe.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],r=arguments[2];return e<t?t:e>r?r:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],a=arguments[1],s=arguments[2];return n<a?a:n>s?s:n}};xe.wrap=function(e,t){return e<0?t- -e%t:e%t};xe.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],r=arguments[2],n=e;return t>n&&(n=t),r>n&&(n=r),n}else if(arguments.length===4){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3],x=a;return s>x&&(x=s),f>x&&(x=f),o>x&&(x=o),x}};xe.average=function(e,t){return(e+t)/2};uu.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(xe,uu);var yn=function(e){this.str=e};yn.prototype.append=function(e){this.str+=e};yn.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};yn.prototype.toString=function(e){return this.str};var sn=function(e){this.value=e};sn.prototype.intValue=function(){return this.value};sn.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};sn.isNaN=function(e){return Number.isNaN(e)};var Zi=function(){};Zi.isWhitespace=function(e){return e<=32&&e>=0||e===127};Zi.toUpperCase=function(e){return e.toUpperCase()};var I=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}else if(typeof arguments[0]=="string"){var n=arguments[0];e.call(this,e.parse(n))}}else if(arguments.length===2){var a=arguments[0],s=arguments[1];this.init(a,s)}},Qe={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};I.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};I.prototype.extractSignificantDigits=function(e,t){var r=this.abs(),n=I.magnitude(r._hi),a=I.TEN.pow(n);r=r.divide(a),r.gt(I.TEN)?(r=r.divide(I.TEN),n+=1):r.lt(I.ONE)&&(r=r.multiply(I.TEN),n-=1);for(var s=n+1,f=new yn,o=I.MAX_PRINT_DIGITS-1,x=0;x<=o;x++){e&&x===s&&f.append(".");var C=Math.trunc(r._hi);if(C<0)break;var P=!1,ge=0;C>9?(P=!0,ge="9"):ge="0"+C,f.append(ge),r=r.subtract(I.valueOf(C)).multiply(I.TEN),P&&r.selfAdd(I.TEN);var nt=!0,ze=I.magnitude(r._hi);if(ze<0&&Math.abs(ze)>=o-x&&(nt=!1),!nt)break}return t[0]=n,f.toString()};I.prototype.sqr=function(){return this.multiply(this)};I.prototype.doubleValue=function(){return this._hi+this._lo};I.prototype.subtract=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};I.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};I.prototype.isZero=function(){return this._hi===0&&this._lo===0};I.prototype.selfSubtract=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};I.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};I.prototype.min=function(e){return this.le(e)?this:e};I.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=null,s=null,f=null,o=null,x=null,C=null,P=null,ge=null;return x=this._hi/r,C=I.SPLIT*x,a=C-x,ge=I.SPLIT*r,a=C-a,s=x-a,f=ge-r,P=x*r,f=ge-f,o=r-f,ge=a*f-P+a*o+s*f+s*o,C=(this._hi-P-ge+this._lo-x*n)/r,ge=x+C,this._hi=ge,this._lo=x-ge+C,this}};I.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};I.prototype.divide=function(){if(arguments[0]instanceof I){var e=arguments[0],t=null,r=null,n=null,a=null,s=null,f=null,o=null,x=null;s=this._hi/e._hi,f=I.SPLIT*s,t=f-s,x=I.SPLIT*e._hi,t=f-t,r=s-t,n=x-e._hi,o=s*e._hi,n=x-n,a=e._hi-n,x=t*n-o+t*a+r*n+r*a,f=(this._hi-o-x+this._lo-s*e._lo)/e._hi,x=s+f;var C=x,P=s-x+f;return new I(C,P)}else if(typeof arguments[0]=="number"){var ge=arguments[0];return z.isNaN(ge)?I.createNaN():I.copy(this).selfDivide(ge,0)}};I.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};I.prototype.pow=function(e){if(e===0)return I.valueOf(1);var t=new I(this),r=I.valueOf(1),n=Math.abs(e);if(n>1)for(;n>0;)n%2===1&&r.selfMultiply(t),n/=2,n>0&&(t=t.sqr());else r=t;return e<0?r.reciprocal():r};I.prototype.ceil=function(){if(this.isNaN())return I.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new I(e,t)};I.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};I.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};I.prototype.setValue=function(){if(arguments[0]instanceof I){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};I.prototype.max=function(e){return this.ge(e)?this:e};I.prototype.sqrt=function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,r=I.valueOf(t),n=this.subtract(r.sqr()),a=n._hi*(e*.5);return r.add(a)};I.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],r=null,n=null,a=null,s=null,f=null,o=null;return a=this._hi+t,f=a-this._hi,s=a-f,s=t-f+(this._hi-s),o=s+this._lo,r=a+o,n=o+(a-r),this._hi=r+n,this._lo=n+(r-this._hi),this}}else if(arguments.length===2){var x=arguments[0],C=arguments[1],P=null,ge=null,nt=null,ze=null,Bt=null,qr=null,_n=null,Fn=null;Bt=this._hi+x,nt=this._lo+C,_n=Bt-this._hi,Fn=nt-this._lo,qr=Bt-_n,ze=nt-Fn,qr=x-_n+(this._hi-qr),ze=C-Fn+(this._lo-ze),_n=qr+nt,P=Bt+_n,ge=_n+(Bt-P),_n=ze+ge;var tl=P+_n,Io=_n+(P-tl);return this._hi=tl,this._lo=Io,this}};I.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof I){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=null,s=null,f=null,o=null,x=null,C=null;x=I.SPLIT*this._hi,a=x-this._hi,C=I.SPLIT*r,a=x-a,s=this._hi-a,f=C-r,x=this._hi*r,f=C-f,o=r-f,C=a*f-x+a*o+s*f+s*o+(this._hi*n+this._lo*r);var P=x+C;a=x-P;var ge=C+a;return this._hi=P,this._lo=ge,this}};I.prototype.selfSqr=function(){return this.selfMultiply(this)};I.prototype.floor=function(){if(this.isNaN())return I.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new I(e,t)};I.prototype.negate=function(){return this.isNaN()?this:new I(-this._hi,-this._lo)};I.prototype.clone=function(){};I.prototype.multiply=function(){if(arguments[0]instanceof I){var e=arguments[0];return e.isNaN()?I.createNaN():I.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return z.isNaN(t)?I.createNaN():I.copy(this).selfMultiply(t,0)}};I.prototype.isNaN=function(){return z.isNaN(this._hi)};I.prototype.intValue=function(){return Math.trunc(this._hi)};I.prototype.toString=function(){var e=I.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};I.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),r=this.extractSignificantDigits(!0,t),n=t[0]+1,a=r;if(r.charAt(0)===".")a="0"+r;else if(n<0)a="0."+I.stringOfChar("0",-n)+r;else if(r.indexOf(".")===-1){var s=n-r.length,f=I.stringOfChar("0",s);a=r+f+".0"}return this.isNegative()?"-"+a:a};I.prototype.reciprocal=function(){var e=null,t=null,r=null,n=null,a=null,s=null,f=null,o=null;a=1/this._hi,s=I.SPLIT*a,e=s-a,o=I.SPLIT*this._hi,e=s-e,t=a-e,r=o-this._hi,f=a*this._hi,r=o-r,n=this._hi-r,o=e*r-f+e*n+t*r+t*n,s=(1-f-o-a*this._lo)/this._hi;var x=a+s,C=a-x+s;return new I(x,C)};I.prototype.toSciNotation=function(){if(this.isZero())return I.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),r=this.extractSignificantDigits(!1,t),n=I.SCI_NOT_EXPONENT_CHAR+t[0];if(r.charAt(0)==="0")throw new Error("Found leading zero: "+r);var a="";r.length>1&&(a=r.substring(1));var s=r.charAt(0)+"."+a;return this.isNegative()?"-"+s+n:s+n};I.prototype.abs=function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)};I.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};I.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};I.prototype.add=function(){if(arguments[0]instanceof I){var e=arguments[0];return I.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return I.copy(this).selfAdd(t)}};I.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof I){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._hi=r,this._lo=n}};I.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};I.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};I.prototype.trunc=function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()};I.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};I.prototype.interfaces_=function(){return[Ge,ke,jo]};I.prototype.getClass=function(){return I};I.sqr=function(e){return I.valueOf(e).selfMultiply(e)};I.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return I.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new I(t)}};I.sqrt=function(e){return I.valueOf(e).sqrt()};I.parse=function(e){for(var t=0,r=e.length;Zi.isWhitespace(e.charAt(t));)t++;var n=!1;if(t<r){var a=e.charAt(t);(a==="-"||a==="+")&&(t++,a==="-"&&(n=!0))}for(var s=new I,f=0,o=0,x=0;!(t>=r);){var C=e.charAt(t);if(t++,Zi.isDigit(C)){var P=C-"0";s.selfMultiply(I.TEN),s.selfAdd(P),f++;continue}if(C==="."){o=f;continue}if(C==="e"||C==="E"){var ge=e.substring(t);try{x=sn.parseInt(ge)}catch(_n){throw _n instanceof Error?new Error("Invalid exponent "+ge+" in string "+e):_n}finally{}break}throw new Error("Unexpected character '"+C+"' at position "+t+" in string "+e)}var nt=s,ze=f-o-x;if(ze===0)nt=s;else if(ze>0){var Bt=I.TEN.pow(ze);nt=s.divide(Bt)}else if(ze<0){var qr=I.TEN.pow(-ze);nt=s.multiply(qr)}return n?nt.negate():nt};I.createNaN=function(){return new I(z.NaN,z.NaN)};I.copy=function(e){return new I(e)};I.magnitude=function(e){var t=Math.abs(e),r=Math.log(t)/Math.log(10),n=Math.trunc(Math.floor(r)),a=Math.pow(10,n);return a*10<=t&&(n+=1),n};I.stringOfChar=function(e,t){for(var r=new yn,n=0;n<t;n++)r.append(e);return r.toString()};Qe.PI.get=function(){return new I(3.141592653589793,12246467991473532e-32)};Qe.TWO_PI.get=function(){return new I(6.283185307179586,24492935982947064e-32)};Qe.PI_2.get=function(){return new I(1.5707963267948966,6123233995736766e-32)};Qe.E.get=function(){return new I(2.718281828459045,14456468917292502e-32)};Qe.NaN.get=function(){return new I(z.NaN,z.NaN)};Qe.EPS.get=function(){return 123259516440783e-46};Qe.SPLIT.get=function(){return 134217729};Qe.MAX_PRINT_DIGITS.get=function(){return 32};Qe.TEN.get=function(){return I.valueOf(10)};Qe.ONE.get=function(){return I.valueOf(1)};Qe.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Qe.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(I,Qe);var ue=function(){},lu={DP_SAFE_EPSILON:{configurable:!0}};ue.prototype.interfaces_=function(){return[]};ue.prototype.getClass=function(){return ue};ue.orientationIndex=function(e,t,r){var n=ue.orientationIndexFilter(e,t,r);if(n<=1)return n;var a=I.valueOf(t.x).selfAdd(-e.x),s=I.valueOf(t.y).selfAdd(-e.y),f=I.valueOf(r.x).selfAdd(-t.x),o=I.valueOf(r.y).selfAdd(-t.y);return a.selfMultiply(o).selfSubtract(s.selfMultiply(f)).signum()};ue.signOfDet2x2=function(e,t,r,n){var a=e.multiply(n).selfSubtract(t.multiply(r));return a.signum()};ue.intersection=function(e,t,r,n){var a=I.valueOf(n.y).selfSubtract(r.y).selfMultiply(I.valueOf(t.x).selfSubtract(e.x)),s=I.valueOf(n.x).selfSubtract(r.x).selfMultiply(I.valueOf(t.y).selfSubtract(e.y)),f=a.subtract(s),o=I.valueOf(n.x).selfSubtract(r.x).selfMultiply(I.valueOf(e.y).selfSubtract(r.y)),x=I.valueOf(n.y).selfSubtract(r.y).selfMultiply(I.valueOf(e.x).selfSubtract(r.x)),C=o.subtract(x),P=C.selfDivide(f).doubleValue(),ge=I.valueOf(e.x).selfAdd(I.valueOf(t.x).selfSubtract(e.x).selfMultiply(P)).doubleValue(),nt=I.valueOf(t.x).selfSubtract(e.x).selfMultiply(I.valueOf(e.y).selfSubtract(r.y)),ze=I.valueOf(t.y).selfSubtract(e.y).selfMultiply(I.valueOf(e.x).selfSubtract(r.x)),Bt=nt.subtract(ze),qr=Bt.selfDivide(f).doubleValue(),_n=I.valueOf(r.y).selfAdd(I.valueOf(n.y).selfSubtract(r.y).selfMultiply(qr)).doubleValue();return new v(ge,_n)};ue.orientationIndexFilter=function(e,t,r){var n=null,a=(e.x-r.x)*(t.y-r.y),s=(e.y-r.y)*(t.x-r.x),f=a-s;if(a>0){if(s<=0)return ue.signum(f);n=a+s}else if(a<0){if(s>=0)return ue.signum(f);n=-a-s}else return ue.signum(f);var o=ue.DP_SAFE_EPSILON*n;return f>=o||-f>=o?ue.signum(f):2};ue.signum=function(e){return e>0?1:e<0?-1:0};lu.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(ue,lu);var Q=function(){},go={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};go.X.get=function(){return 0};go.Y.get=function(){return 1};go.Z.get=function(){return 2};go.M.get=function(){return 3};Q.prototype.setOrdinate=function(e,t,r){};Q.prototype.size=function(){};Q.prototype.getOrdinate=function(e,t){};Q.prototype.getCoordinate=function(){};Q.prototype.getCoordinateCopy=function(e){};Q.prototype.getDimension=function(){};Q.prototype.getX=function(e){};Q.prototype.clone=function(){};Q.prototype.expandEnvelope=function(e){};Q.prototype.copy=function(){};Q.prototype.getY=function(e){};Q.prototype.toCoordinateArray=function(){};Q.prototype.interfaces_=function(){return[jo]};Q.prototype.getClass=function(){return Q};Object.defineProperties(Q,go);var cu=function(){},ki=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(cu),Ut=function(){};Ut.arraycopy=function(e,t,r,n,a){for(var s=0,f=t;f<t+a;f++)r[n+s]=e[f],s++};Ut.getProperty=function(e){return{"line.separator":`
`}[e]};var Ve=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var a=arguments[0],s=arguments[1];this.x=a.y*s.w-s.y*a.w,this.y=s.x*a.w-a.x*s.w,this.w=a.x*s.y-s.x*a.y}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var f=arguments[0],o=arguments[1];this.x=f.y-o.y,this.y=o.x-f.x,this.w=f.x*o.y-o.x*f.y}}else if(arguments.length===3){var x=arguments[0],C=arguments[1],P=arguments[2];this.x=x,this.y=C,this.w=P}else if(arguments.length===4){var ge=arguments[0],nt=arguments[1],ze=arguments[2],Bt=arguments[3],qr=ge.y-nt.y,_n=nt.x-ge.x,Fn=ge.x*nt.y-nt.x*ge.y,tl=ze.y-Bt.y,Io=Bt.x-ze.x,Co=ze.x*Bt.y-Bt.x*ze.y;this.x=_n*Co-Io*Fn,this.y=tl*Fn-qr*Co,this.w=qr*Io-tl*_n}};Ve.prototype.getY=function(){var e=this.y/this.w;if(z.isNaN(e)||z.isInfinite(e))throw new ki;return e};Ve.prototype.getX=function(){var e=this.x/this.w;if(z.isNaN(e)||z.isInfinite(e))throw new ki;return e};Ve.prototype.getCoordinate=function(){var e=new v;return e.x=this.getX(),e.y=this.getY(),e};Ve.prototype.interfaces_=function(){return[]};Ve.prototype.getClass=function(){return Ve};Ve.intersection=function(e,t,r,n){var a=e.y-t.y,s=t.x-e.x,f=e.x*t.y-t.x*e.y,o=r.y-n.y,x=n.x-r.x,C=r.x*n.y-n.x*r.y,P=s*C-x*f,ge=o*f-a*C,nt=a*x-o*s,ze=P/nt,Bt=ge/nt;if(z.isNaN(ze)||z.isInfinite(ze)||z.isNaN(Bt)||z.isInfinite(Bt))throw new ki;return new v(ze,Bt)};var T=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof v){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}}else if(arguments.length===2){var n=arguments[0],a=arguments[1];this.init(n.x,a.x,n.y,a.y)}else if(arguments.length===4){var s=arguments[0],f=arguments[1],o=arguments[2],x=arguments[3];this.init(s,f,o,x)}},fu={serialVersionUID:{configurable:!0}};T.prototype.getArea=function(){return this.getWidth()*this.getHeight()};T.prototype.equals=function(e){if(!(e instanceof T))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};T.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new T;var t=this._minx>e._minx?this._minx:e._minx,r=this._miny>e._miny?this._miny:e._miny,n=this._maxx<e._maxx?this._maxx:e._maxx,a=this._maxy<e._maxy?this._maxy:e._maxy;return new T(t,n,r,a)};T.prototype.isNull=function(){return this._maxx<this._minx};T.prototype.getMaxX=function(){return this._maxx};T.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&n>=this._miny&&n<=this._maxy}};T.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof T){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof v){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.isNull()?!1:!(r>this._maxx||r<this._minx||n>this._maxy||n<this._miny)}};T.prototype.getMinY=function(){return this._miny};T.prototype.getMinX=function(){return this._minx};T.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=n,this._maxy=n):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}};T.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};T.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};T.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};T.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};T.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};T.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};T.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};T.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};T.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};T.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof T){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof v){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.covers(r,n)}};T.prototype.centre=function(){return this.isNull()?null:new v((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};T.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof T){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(arguments.length===4){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3];a<s?(this._minx=a,this._maxx=s):(this._minx=s,this._maxx=a),f<o?(this._miny=f,this._maxy=o):(this._miny=o,this._maxy=f)}};T.prototype.getMaxY=function(){return this._maxy};T.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var r=0;return this._maxy<e._miny?r=e._miny-this._maxy:this._miny>e._maxy&&(r=this._miny-e._maxy),t===0?r:r===0?t:Math.sqrt(t*t+r*r)};T.prototype.hashCode=function(){var e=17;return e=37*e+v.hashCode(this._minx),e=37*e+v.hashCode(this._maxx),e=37*e+v.hashCode(this._miny),e=37*e+v.hashCode(this._maxy),e};T.prototype.interfaces_=function(){return[ke,Ge]};T.prototype.getClass=function(){return T};T.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],r=arguments[2];return r.x>=(e.x<t.x?e.x:t.x)&&r.x<=(e.x>t.x?e.x:t.x)&&r.y>=(e.y<t.y?e.y:t.y)&&r.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var n=arguments[0],a=arguments[1],s=arguments[2],f=arguments[3],o=Math.min(s.x,f.x),x=Math.max(s.x,f.x),C=Math.min(n.x,a.x),P=Math.max(n.x,a.x);return!(C>x||P<o||(o=Math.min(s.y,f.y),x=Math.max(s.y,f.y),C=Math.min(n.y,a.y),P=Math.max(n.y,a.y),C>x)||P<o)}};fu.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(T,fu);var Ze={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Ko=function(e){this.geometryFactory=e||new H};Ko.prototype.read=function(e){var t,r,n;e=e.replace(/[\n\r]/g," ");var a=Ze.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(a=Ze.emptyTypeStr.exec(e),a[2]=void 0),a&&(r=a[1].toLowerCase(),n=a[2],pi[r]&&(t=pi[r].apply(this,[n]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};Ko.prototype.write=function(e){return this.extractGeometry(e)};Ko.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Un[t])return null;var r=t.toUpperCase(),n;return e.isEmpty()?n=r+" EMPTY":n=r+"("+Un[t].apply(this,[e])+")",n};var Un={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Un.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push("("+Un.point.apply(t,[e._geometries[n]])+")");return r.join(",")},linestring:function(e){for(var t=this,r=[],n=0,a=e._points._coordinates.length;n<a;++n)r.push(Un.coordinate.apply(t,[e._points._coordinates[n]]));return r.join(",")},linearring:function(e){for(var t=this,r=[],n=0,a=e._points._coordinates.length;n<a;++n)r.push(Un.coordinate.apply(t,[e._points._coordinates[n]]));return r.join(",")},multilinestring:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push("("+Un.linestring.apply(t,[e._geometries[n]])+")");return r.join(",")},polygon:function(e){var t=this,r=[];r.push("("+Un.linestring.apply(this,[e._shell])+")");for(var n=0,a=e._holes.length;n<a;++n)r.push("("+Un.linestring.apply(t,[e._holes[n]])+")");return r.join(",")},multipolygon:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push("("+Un.polygon.apply(t,[e._geometries[n]])+")");return r.join(",")},geometrycollection:function(e){for(var t=this,r=[],n=0,a=e._geometries.length;n<a;++n)r.push(t.extractGeometry(e._geometries[n]));return r.join(",")}},pi={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Ze.spaces);return this.geometryFactory.createPoint(new v(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var r,n=e.trim().split(","),a=[],s=0,f=n.length;s<f;++s)r=n[s].replace(Ze.trimParens,"$1"),a.push(pi.point.apply(t,[r]));return this.geometryFactory.createMultiPoint(a)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),r=[],n,a=0,s=t.length;a<s;++a)n=t[a].trim().split(Ze.spaces),r.push(new v(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),r=[],n,a=0,s=t.length;a<s;++a)n=t[a].trim().split(Ze.spaces),r.push(new v(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var r,n=e.trim().split(Ze.parenComma),a=[],s=0,f=n.length;s<f;++s)r=n[s].replace(Ze.trimParens,"$1"),a.push(pi.linestring.apply(t,[r]));return this.geometryFactory.createMultiLineString(a)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var r,n,a,s=e.trim().split(Ze.parenComma),f,o=[],x=0,C=s.length;x<C;++x)r=s[x].replace(Ze.trimParens,"$1"),n=pi.linestring.apply(t,[r]),a=t.geometryFactory.createLinearRing(n._points),x===0?f=a:o.push(a);return this.geometryFactory.createPolygon(f,o)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var r,n=e.trim().split(Ze.doubleParenComma),a=[],s=0,f=n.length;s<f;++s)r=n[s].replace(Ze.trimParens,"$1"),a.push(pi.polygon.apply(t,[r]));return this.geometryFactory.createMultiPolygon(a)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=e.trim().split("|"),n=[],a=0,s=r.length;a<s;++a)n.push(t.read(r[a]));return this.geometryFactory.createGeometryCollection(n)}},qe=function(e){this.parser=new Ko(e)};qe.prototype.write=function(e){return this.parser.write(e)};qe.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Kn=function(e){function t(r){e.call(this,r),this.name="RuntimeException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Bo=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var r=arguments[0];e.call(this,r)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Kn),U=function(){};U.prototype.interfaces_=function(){return[]};U.prototype.getClass=function(){return U};U.shouldNeverReachHere=function(){if(arguments.length===0)U.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Bo("Should never reach here"+(e!==null?": "+e:""))}};U.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],U.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new Bo:new Bo(t)};U.equals=function(){var e,t,r;if(arguments.length===2)e=arguments[0],t=arguments[1],U.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],r=arguments[2],!t.equals(e)))throw new Bo("Expected "+e+" but encountered "+t+(r!==null?": "+r:""))};var ft=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new v,this._intPt[1]=new v,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ai={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ft.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};ft.prototype.getTopologySummary=function(){var e=new yn;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};ft.prototype.computeIntersection=function(e,t,r,n){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=r,this._inputLines[1][1]=n,this._result=this.computeIntersect(e,t,r,n)};ft.prototype.getIntersectionNum=function(){return this._result};ft.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),r=this.getEdgeDistance(e,1);t>r?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};ft.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};ft.prototype.setPrecisionModel=function(e){this._precisionModel=e};ft.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],r=0;r<this._result;r++)if(!(e._intPt[r].equals2D(e._inputLines[t][0])||e._intPt[r].equals2D(e._inputLines[t][1])))return!0;return!1}};ft.prototype.getIntersection=function(e){return this._intPt[e]};ft.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};ft.prototype.hasIntersection=function(){return this._result!==ft.NO_INTERSECTION};ft.prototype.getEdgeDistance=function(e,t){var r=ft.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return r};ft.prototype.isCollinear=function(){return this._result===ft.COLLINEAR_INTERSECTION};ft.prototype.toString=function(){return qe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+qe.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};ft.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};ft.prototype.isIntersection=function(e){for(var t=this,r=0;r<this._result;r++)if(t._intPt[r].equals2D(e))return!0;return!1};ft.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};ft.prototype.interfaces_=function(){return[]};ft.prototype.getClass=function(){return ft};ft.computeEdgeDistance=function(e,t,r){var n=Math.abs(r.x-t.x),a=Math.abs(r.y-t.y),s=-1;if(e.equals(t))s=0;else if(e.equals(r))n>a?s=n:s=a;else{var f=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);n>a?s=f:s=o,s===0&&!e.equals(t)&&(s=Math.max(f,o))}return U.isTrue(!(s===0&&!e.equals(t)),"Bad distance calculation"),s};ft.nonRobustComputeEdgeDistance=function(e,t,r){var n=e.x-t.x,a=e.y-t.y,s=Math.sqrt(n*n+a*a);return U.isTrue(!(s===0&&!e.equals(t)),"Invalid distance calculation"),s};ai.DONT_INTERSECT.get=function(){return 0};ai.DO_INTERSECT.get=function(){return 1};ai.COLLINEAR.get=function(){return 2};ai.NO_INTERSECTION.get=function(){return 0};ai.POINT_INTERSECTION.get=function(){return 1};ai.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(ft,ai);var zr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(r){var n=new T(this._inputLines[0][0],this._inputLines[0][1]),a=new T(this._inputLines[1][0],this._inputLines[1][1]);return n.contains(r)&&a.contains(r)},t.prototype.computeIntersection=function(){if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];if(this._isProper=!1,T.intersects(n,a,r)&&O.orientationIndex(n,a,r)===0&&O.orientationIndex(a,n,r)===0)return this._isProper=!0,(r.equals(n)||r.equals(a))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(r,n,a,s,f){f.x=this.smallestInAbsValue(r.x,n.x,a.x,s.x),f.y=this.smallestInAbsValue(r.y,n.y,a.y,s.y),r.x-=f.x,r.y-=f.y,n.x-=f.x,n.y-=f.y,a.x-=f.x,a.y-=f.y,s.x-=f.x,s.y-=f.y},t.prototype.safeHCoordinateIntersection=function(r,n,a,s){var f=null;try{f=Ve.intersection(r,n,a,s)}catch(o){if(o instanceof ki)f=t.nearestEndpoint(r,n,a,s);else throw o}finally{}return f},t.prototype.intersection=function(r,n,a,s){var f=this.intersectionWithNormalization(r,n,a,s);return this.isInSegmentEnvelopes(f)||(f=new v(t.nearestEndpoint(r,n,a,s))),this._precisionModel!==null&&this._precisionModel.makePrecise(f),f},t.prototype.smallestInAbsValue=function(r,n,a,s){var f=r,o=Math.abs(f);return Math.abs(n)<o&&(f=n,o=Math.abs(n)),Math.abs(a)<o&&(f=a,o=Math.abs(a)),Math.abs(s)<o&&(f=s),f},t.prototype.checkDD=function(r,n,a,s,f){var o=ue.intersection(r,n,a,s),x=this.isInSegmentEnvelopes(o);Ut.out.println("DD in env = "+x+"  --------------------- "+o),f.distance(o)>1e-4&&Ut.out.println("Distance = "+f.distance(o))},t.prototype.intersectionWithNormalization=function(r,n,a,s){var f=new v(r),o=new v(n),x=new v(a),C=new v(s),P=new v;this.normalizeToEnvCentre(f,o,x,C,P);var ge=this.safeHCoordinateIntersection(f,o,x,C);return ge.x+=P.x,ge.y+=P.y,ge},t.prototype.computeCollinearIntersection=function(r,n,a,s){var f=T.intersects(r,n,a),o=T.intersects(r,n,s),x=T.intersects(a,s,r),C=T.intersects(a,s,n);return f&&o?(this._intPt[0]=a,this._intPt[1]=s,e.COLLINEAR_INTERSECTION):x&&C?(this._intPt[0]=r,this._intPt[1]=n,e.COLLINEAR_INTERSECTION):f&&x?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!o&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):f&&C?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!o&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&x?(this._intPt[0]=s,this._intPt[1]=r,s.equals(r)&&!f&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&C?(this._intPt[0]=s,this._intPt[1]=n,s.equals(n)&&!f&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(r,n,a,s,f){var o=r.x<n.x?r.x:n.x,x=r.y<n.y?r.y:n.y,C=r.x>n.x?r.x:n.x,P=r.y>n.y?r.y:n.y,ge=a.x<s.x?a.x:s.x,nt=a.y<s.y?a.y:s.y,ze=a.x>s.x?a.x:s.x,Bt=a.y>s.y?a.y:s.y,qr=o>ge?o:ge,_n=C<ze?C:ze,Fn=x>nt?x:nt,tl=P<Bt?P:Bt,Io=(qr+_n)/2,Co=(Fn+tl)/2;f.x=Io,f.y=Co,r.x-=f.x,r.y-=f.y,n.x-=f.x,n.y-=f.y,a.x-=f.x,a.y-=f.y,s.x-=f.x,s.y-=f.y},t.prototype.computeIntersect=function(r,n,a,s){if(this._isProper=!1,!T.intersects(r,n,a,s))return e.NO_INTERSECTION;var f=O.orientationIndex(r,n,a),o=O.orientationIndex(r,n,s);if(f>0&&o>0||f<0&&o<0)return e.NO_INTERSECTION;var x=O.orientationIndex(a,s,r),C=O.orientationIndex(a,s,n);if(x>0&&C>0||x<0&&C<0)return e.NO_INTERSECTION;var P=f===0&&o===0&&x===0&&C===0;return P?this.computeCollinearIntersection(r,n,a,s):(f===0||o===0||x===0||C===0?(this._isProper=!1,r.equals2D(a)||r.equals2D(s)?this._intPt[0]=r:n.equals2D(a)||n.equals2D(s)?this._intPt[0]=n:f===0?this._intPt[0]=new v(a):o===0?this._intPt[0]=new v(s):x===0?this._intPt[0]=new v(r):C===0&&(this._intPt[0]=new v(n))):(this._isProper=!0,this._intPt[0]=this.intersection(r,n,a,s)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(r,n,a,s){var f=r,o=O.distancePointLine(r,a,s),x=O.distancePointLine(n,a,s);return x<o&&(o=x,f=n),x=O.distancePointLine(a,r,n),x<o&&(o=x,f=a),x=O.distancePointLine(s,r,n),x<o&&(o=x,f=s),f},t}(ft),Kr=function(){};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};Kr.orientationIndex=function(e,t,r){var n=t.x-e.x,a=t.y-e.y,s=r.x-t.x,f=r.y-t.y;return Kr.signOfDet2x2(n,a,s,f)};Kr.signOfDet2x2=function(e,t,r,n){var a=null,s=null,f=null;if(a=1,e===0||n===0)return t===0||r===0?0:t>0?r>0?-a:a:r>0?a:-a;if(t===0||r===0)return n>0?e>0?a:-a:e>0?-a:a;if(t>0?n>0?t<=n||(a=-a,s=e,e=r,r=s,s=t,t=n,n=s):t<=-n?(a=-a,r=-r,n=-n):(s=e,e=-r,r=s,s=t,t=-n,n=s):n>0?-t<=n?(a=-a,e=-e,t=-t):(s=-e,e=r,r=s,s=-t,t=n,n=s):t>=n?(e=-e,t=-t,r=-r,n=-n):(a=-a,s=-e,e=-r,r=s,s=-t,t=-n,n=s),e>0)if(r>0){if(!(e<=r))return a}else return a;else{if(r>0)return-a;if(e>=r)a=-a,e=-e,r=-r;else return-a}for(;;){if(f=Math.floor(r/e),r=r-f*e,n=n-f*t,n<0)return-a;if(n>t)return a;if(e>r+r){if(t<n+n)return a}else{if(t>n+n)return-a;r=e-r,n=t-n,a=-a}if(n===0)return r===0?0:-a;if(r===0||(f=Math.floor(e/r),e=e-f*r,t=t-f*n,t<0))return a;if(t>n)return-a;if(r>e+e){if(n<t+t)return-a}else{if(n>t+t)return a;e=r-e,t=n-t,a=-a}if(t===0)return e===0?0:a;if(e===0)return-a}};var rn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};rn.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var r=e.x,n=t.x;return r>n&&(r=t.x,n=e.x),this._p.x>=r&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var a=e.x-this._p.x,s=e.y-this._p.y,f=t.x-this._p.x,o=t.y-this._p.y,x=Kr.signOfDet2x2(a,s,f,o);if(x===0)return this._isPointOnSegment=!0,null;o<s&&(x=-x),x>0&&this._crossingCount++}};rn.prototype.isPointInPolygon=function(){return this.getLocation()!==m.EXTERIOR};rn.prototype.getLocation=function(){return this._isPointOnSegment?m.BOUNDARY:this._crossingCount%2===1?m.INTERIOR:m.EXTERIOR};rn.prototype.isOnSegment=function(){return this._isPointOnSegment};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.locatePointInRing=function(){if(arguments[0]instanceof v&&G(arguments[1],Q)){for(var e=arguments[0],t=arguments[1],r=new rn(e),n=new v,a=new v,s=1;s<t.size();s++)if(t.getCoordinate(s,n),t.getCoordinate(s-1,a),r.countSegment(n,a),r.isOnSegment())return r.getLocation();return r.getLocation()}else if(arguments[0]instanceof v&&arguments[1]instanceof Array){for(var f=arguments[0],o=arguments[1],x=new rn(f),C=1;C<o.length;C++){var P=o[C],ge=o[C-1];if(x.countSegment(P,ge),x.isOnSegment())return x.getLocation()}return x.getLocation()}};var O=function(){},ui={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};O.prototype.interfaces_=function(){return[]};O.prototype.getClass=function(){return O};O.orientationIndex=function(e,t,r){return ue.orientationIndex(e,t,r)};O.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,r=e[0].x,n=1;n<e.length-1;n++){var a=e[n].x-r,s=e[n+1].y,f=e[n-1].y;t+=a*(f-s)}return t/2}else if(G(arguments[0],Q)){var o=arguments[0],x=o.size();if(x<3)return 0;var C=new v,P=new v,ge=new v;o.getCoordinate(0,P),o.getCoordinate(1,ge);var nt=P.x;ge.x-=nt;for(var ze=0,Bt=1;Bt<x-1;Bt++)C.y=P.y,P.x=ge.x,P.y=ge.y,o.getCoordinate(Bt+1,ge),ge.x-=nt,ze+=P.x*(C.y-ge.y);return ze/2}};O.distanceLineLine=function(e,t,r,n){if(e.equals(t))return O.distancePointLine(e,r,n);if(r.equals(n))return O.distancePointLine(n,e,t);var a=!1;if(!T.intersects(e,t,r,n))a=!0;else{var s=(t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x);if(s===0)a=!0;else{var f=(e.y-r.y)*(n.x-r.x)-(e.x-r.x)*(n.y-r.y),o=(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y),x=o/s,C=f/s;(C<0||C>1||x<0||x>1)&&(a=!0)}}return a?xe.min(O.distancePointLine(e,r,n),O.distancePointLine(t,r,n),O.distancePointLine(r,e,t),O.distancePointLine(n,e,t)):0};O.isPointInRing=function(e,t){return O.locatePointInRing(e,t)!==m.EXTERIOR};O.computeLength=function(e){var t=e.size();if(t<=1)return 0;var r=0,n=new v;e.getCoordinate(0,n);for(var a=n.x,s=n.y,f=1;f<t;f++){e.getCoordinate(f,n);var o=n.x,x=n.y,C=o-a,P=x-s;r+=Math.sqrt(C*C+P*P),a=o,s=x}return r};O.isCCW=function(e){var t=e.length-1;if(t<3)throw new ct("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=e[0],n=0,a=1;a<=t;a++){var s=e[a];s.y>r.y&&(r=s,n=a)}var f=n;do f=f-1,f<0&&(f=t);while(e[f].equals2D(r)&&f!==n);var o=n;do o=(o+1)%t;while(e[o].equals2D(r)&&o!==n);var x=e[f],C=e[o];if(x.equals2D(r)||C.equals2D(r)||x.equals2D(C))return!1;var P=O.computeOrientation(x,r,C),ge=!1;return P===0?ge=x.x>C.x:ge=P>0,ge};O.locatePointInRing=function(e,t){return rn.locatePointInRing(e,t)};O.distancePointLinePerpendicular=function(e,t,r){var n=(r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y),a=((t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y))/n;return Math.abs(a)*Math.sqrt(n)};O.computeOrientation=function(e,t,r){return O.orientationIndex(e,t,r)};O.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new ct("Line array must contain at least one vertex");for(var r=e.distance(t[0]),n=0;n<t.length-1;n++){var a=O.distancePointLine(e,t[n],t[n+1]);a<r&&(r=a)}return r}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];if(f.x===o.x&&f.y===o.y)return s.distance(f);var x=(o.x-f.x)*(o.x-f.x)+(o.y-f.y)*(o.y-f.y),C=((s.x-f.x)*(o.x-f.x)+(s.y-f.y)*(o.y-f.y))/x;if(C<=0)return s.distance(f);if(C>=1)return s.distance(o);var P=((f.y-s.y)*(o.x-f.x)-(f.x-s.x)*(o.y-f.y))/x;return Math.abs(P)*Math.sqrt(x)}};O.isOnLine=function(e,t){for(var r=new zr,n=1;n<t.length;n++){var a=t[n-1],s=t[n];if(r.computeIntersection(e,a,s),r.hasIntersection())return!0}return!1};ui.CLOCKWISE.get=function(){return-1};ui.RIGHT.get=function(){return O.CLOCKWISE};ui.COUNTERCLOCKWISE.get=function(){return 1};ui.LEFT.get=function(){return O.COUNTERCLOCKWISE};ui.COLLINEAR.get=function(){return 0};ui.STRAIGHT.get=function(){return O.COLLINEAR};Object.defineProperties(O,ui);var Qn=function(){};Qn.prototype.filter=function(e){};Qn.prototype.interfaces_=function(){return[]};Qn.prototype.getClass=function(){return Qn};var k=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},An={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};k.prototype.isGeometryCollection=function(){return this.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION};k.prototype.getFactory=function(){return this._factory};k.prototype.getGeometryN=function(e){return this};k.prototype.getArea=function(){return 0};k.prototype.isRectangle=function(){return!1};k.prototype.equals=function(){if(arguments[0]instanceof k){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof k))return!1;var r=t;return this.equalsExact(r)}};k.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};k.prototype.geometryChanged=function(){this.apply(k.geometryChangedFilter)};k.prototype.geometryChangedAction=function(){this._envelope=null};k.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};k.prototype.getLength=function(){return 0};k.prototype.getNumGeometries=function(){return 1};k.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}};k.prototype.getUserData=function(){return this._userData};k.prototype.getSRID=function(){return this._SRID};k.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};k.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION)throw new ct("This method does not support GeometryCollection arguments")};k.prototype.equal=function(e,t,r){return r===0?e.equals(t):e.distance(t)<=r};k.prototype.norm=function(){var e=this.copy();return e.normalize(),e};k.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};k.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new T(this._envelope)};k.prototype.setSRID=function(e){this._SRID=e};k.prototype.setUserData=function(e){this._userData=e};k.prototype.compare=function(e,t){for(var r=e.iterator(),n=t.iterator();r.hasNext()&&n.hasNext();){var a=r.next(),s=n.next(),f=a.compareTo(s);if(f!==0)return f}return r.hasNext()?1:n.hasNext()?-1:0};k.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};k.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===k.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===k.SORTINDEX_MULTIPOINT||this.getSortIndex()===k.SORTINDEX_MULTILINESTRING||this.getSortIndex()===k.SORTINDEX_MULTIPOLYGON};k.prototype.interfaces_=function(){return[jo,ke,Ge]};k.prototype.getClass=function(){return k};k.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};k.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};An.serialVersionUID.get=function(){return 8763622679187377e3};An.SORTINDEX_POINT.get=function(){return 0};An.SORTINDEX_MULTIPOINT.get=function(){return 1};An.SORTINDEX_LINESTRING.get=function(){return 2};An.SORTINDEX_LINEARRING.get=function(){return 3};An.SORTINDEX_MULTILINESTRING.get=function(){return 4};An.SORTINDEX_POLYGON.get=function(){return 5};An.SORTINDEX_MULTIPOLYGON.get=function(){return 6};An.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};An.geometryChangedFilter.get=function(){return As};Object.defineProperties(k,An);var As=function(){};As.interfaces_=function(){return[Qn]};As.filter=function(e){e.geometryChangedAction()};var wn=function(){};wn.prototype.filter=function(e){};wn.prototype.interfaces_=function(){return[]};wn.prototype.getClass=function(){return wn};var Me=function(){},er={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Me.prototype.isInBoundary=function(e){};Me.prototype.interfaces_=function(){return[]};Me.prototype.getClass=function(){return Me};er.Mod2BoundaryNodeRule.get=function(){return mi};er.EndPointBoundaryNodeRule.get=function(){return _i};er.MultiValentEndPointBoundaryNodeRule.get=function(){return Ei};er.MonoValentEndPointBoundaryNodeRule.get=function(){return Ii};er.MOD2_BOUNDARY_RULE.get=function(){return new mi};er.ENDPOINT_BOUNDARY_RULE.get=function(){return new _i};er.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ei};er.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ii};er.OGC_SFS_BOUNDARY_RULE.get=function(){return Me.MOD2_BOUNDARY_RULE};Object.defineProperties(Me,er);var mi=function(){};mi.prototype.isInBoundary=function(e){return e%2===1};mi.prototype.interfaces_=function(){return[Me]};mi.prototype.getClass=function(){return mi};var _i=function(){};_i.prototype.isInBoundary=function(e){return e>0};_i.prototype.interfaces_=function(){return[Me]};_i.prototype.getClass=function(){return _i};var Ei=function(){};Ei.prototype.isInBoundary=function(e){return e>1};Ei.prototype.interfaces_=function(){return[Me]};Ei.prototype.getClass=function(){return Ei};var Ii=function(){};Ii.prototype.isInBoundary=function(e){return e===1};Ii.prototype.interfaces_=function(){return[Me]};Ii.prototype.getClass=function(){return Ii};var wt=function(){};wt.prototype.add=function(){};wt.prototype.addAll=function(){};wt.prototype.isEmpty=function(){};wt.prototype.iterator=function(){};wt.prototype.size=function(){};wt.prototype.toArray=function(){};wt.prototype.remove=function(){};function Fs(e){this.message=e||""}Fs.prototype=new Error;Fs.prototype.name="IndexOutOfBoundsException";var Gi=function(){};Gi.prototype.hasNext=function(){};Gi.prototype.next=function(){};Gi.prototype.remove=function(){};var Ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(wt);function zi(e){this.message=e||""}zi.prototype=new Error;zi.prototype.name="NoSuchElementException";var b=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,wt]},t.prototype.add=function(r){return arguments.length===1?this.array_.push(r):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(r){for(var n=this,a=r.iterator();a.hasNext();)n.add(a.next());return!0},t.prototype.set=function(r,n){var a=this.array_[r];return this.array_[r]=n,a},t.prototype.iterator=function(){return new Cc(this)},t.prototype.get=function(r){if(r<0||r>=this.size())throw new Fs;return this.array_[r]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var r=this,n=[],a=0,s=this.array_.length;a<s;a++)n.push(r.array_[a]);return n},t.prototype.remove=function(r){for(var n=this,a=!1,s=0,f=this.array_.length;s<f;s++)if(n.array_[s]===r){n.array_.splice(s,1),a=!0;break}return a},t}(Ue),Cc=function(e){function t(r){e.call(this),this.arrayList_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new zi;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(r){return this.arrayList_.set(this.position_-1,r)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Gi),po=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(arguments.length===2){var a=arguments[0],s=arguments[1];this.ensureCapacity(a.length),this.add(a,s)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(n){return this.get(n)},t.prototype.addAll=function(){var n=this;if(arguments.length===2){for(var a=arguments[0],s=arguments[1],f=!1,o=a.iterator();o.hasNext();)n.add(o.next(),s),f=!0;return f}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var n=this,a=e.prototype.clone.call(this),s=0;s<this.size();s++)a.add(s,n.get(s).copy());return a},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var n=this;if(arguments.length===1){var a=arguments[0];e.prototype.add.call(this,a)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var s=arguments[0],f=arguments[1];return this.add(s,f,!0),!0}else if(arguments[0]instanceof v&&typeof arguments[1]=="boolean"){var o=arguments[0],x=arguments[1];if(!x&&this.size()>=1){var C=this.get(this.size()-1);if(C.equals2D(o))return null}e.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var P=arguments[0],ge=arguments[1];return this.add(P,ge),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var nt=arguments[0],ze=arguments[1],Bt=arguments[2];if(Bt)for(var qr=0;qr<nt.length;qr++)n.add(nt[qr],ze);else for(var _n=nt.length-1;_n>=0;_n--)n.add(nt[_n],ze);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof v){var Fn=arguments[0],tl=arguments[1],Io=arguments[2];if(!Io){var Co=this.size();if(Co>0){if(Fn>0){var rl=this.get(Fn-1);if(rl.equals2D(tl))return null}if(Fn<Co){var ah=this.get(Fn);if(ah.equals2D(tl))return null}}}e.prototype.add.call(this,Fn,tl)}}else if(arguments.length===4){var ch=arguments[0],ju=arguments[1],Zu=arguments[2],sl=arguments[3],oh=1;Zu>sl&&(oh=-1);for(var hh=Zu;hh!==sl;hh+=oh)n.add(ch[hh],ju);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new v(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,r),t}(b),W=function(){},Qo={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Qo.ForwardComparator.get=function(){return $i};Qo.BidirectionalComparator.get=function(){return Ci};Qo.coordArrayType.get=function(){return new Array(0).fill(null)};W.prototype.interfaces_=function(){return[]};W.prototype.getClass=function(){return W};W.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};W.ptNotInList=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(W.indexOf(n,t)<0)return n}return null};W.scroll=function(e,t){var r=W.indexOf(t,e);if(r<0)return null;var n=new Array(e.length).fill(null);Ut.arraycopy(e,r,n,0,e.length-r),Ut.arraycopy(e,0,n,e.length-r,r),Ut.arraycopy(n,0,e,0,e.length)};W.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].equals(t[r]))return!1;return!0}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];if(n===a)return!0;if(n===null||a===null||n.length!==a.length)return!1;for(var f=0;f<n.length;f++)if(s.compare(n[f],a[f])!==0)return!1;return!0}};W.intersection=function(e,t){for(var r=new po,n=0;n<e.length;n++)t.intersects(e[n])&&r.add(e[n],!0);return r.toCoordinateArray()};W.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};W.removeRepeatedPoints=function(e){if(!W.hasRepeatedPoints(e))return e;var t=new po(e,!1);return t.toCoordinateArray()};W.reverse=function(e){for(var t=e.length-1,r=Math.trunc(t/2),n=0;n<=r;n++){var a=e[n];e[n]=e[t-n],e[t-n]=a}};W.removeNull=function(e){for(var t=0,r=0;r<e.length;r++)e[r]!==null&&t++;var n=new Array(t).fill(null);if(t===0)return n;for(var a=0,s=0;s<e.length;s++)e[s]!==null&&(n[a++]=e[s]);return n};W.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),r=0;r<e.length;r++)t[r]=new v(e[r]);return t}else if(arguments.length===5)for(var n=arguments[0],a=arguments[1],s=arguments[2],f=arguments[3],o=arguments[4],x=0;x<o;x++)s[f+x]=new v(n[a+x])};W.isEqualReversed=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],a=t[e.length-r-1];if(n.compareTo(a)!==0)return!1}return!0};W.envelope=function(e){for(var t=new T,r=0;r<e.length;r++)t.expandToInclude(e[r]);return t};W.toCoordinateArray=function(e){return e.toArray(W.coordArrayType)};W.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};W.indexOf=function(e,t){for(var r=0;r<t.length;r++)if(e.equals(t[r]))return r;return-1};W.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var r=e.length-1-t,n=e[t].compareTo(e[r]);if(n!==0)return n}return 1};W.compare=function(e,t){for(var r=0;r<e.length&&r<t.length;){var n=e[r].compareTo(t[r]);if(n!==0)return n;r++}return r<t.length?-1:r<e.length?1:0};W.minCoordinate=function(e){for(var t=null,r=0;r<e.length;r++)(t===null||t.compareTo(e[r])>0)&&(t=e[r]);return t};W.extract=function(e,t,r){t=xe.clamp(t,0,e.length),r=xe.clamp(r,-1,e.length);var n=r-t+1;r<0&&(n=0),t>=e.length&&(n=0),r<t&&(n=0);var a=new Array(n).fill(null);if(n===0)return a;for(var s=0,f=t;f<=r;f++)a[s++]=e[f];return a};Object.defineProperties(W,Qo);var $i=function(){};$i.prototype.compare=function(e,t){var r=e,n=t;return W.compare(r,n)};$i.prototype.interfaces_=function(){return[vi]};$i.prototype.getClass=function(){return $i};var Ci=function(){};Ci.prototype.compare=function(e,t){var r=e,n=t;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(r.length===0)return 0;var a=W.compare(r,n),s=W.isEqualReversed(r,n);return s?0:a};Ci.prototype.OLDcompare=function(e,t){var r=e,n=t;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(r.length===0)return 0;for(var a=W.increasingDirection(r),s=W.increasingDirection(n),f=a>0?0:r.length-1,o=s>0?0:r.length-1,x=0;x<r.length;x++){var C=r[f].compareTo(n[o]);if(C!==0)return C;f+=a,o+=s}return 0};Ci.prototype.interfaces_=function(){return[vi]};Ci.prototype.getClass=function(){return Ci};var li=function(){};li.prototype.get=function(){};li.prototype.put=function(){};li.prototype.size=function(){};li.prototype.values=function(){};li.prototype.entrySet=function(){};var Nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(li);function vo(e){this.message=e||""}vo.prototype=new Error;vo.prototype.name="OperationNotSupported";function Jo(){}Jo.prototype=new wt;Jo.prototype.contains=function(){};var Bs=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(r){for(var n=this,a=0,s=this.array_.length;a<s;a++){var f=n.array_[a];if(f===r)return!0}return!1},t.prototype.add=function(r){return this.contains(r)?!1:(this.array_.push(r),!0)},t.prototype.addAll=function(r){for(var n=this,a=r.iterator();a.hasNext();)n.add(a.next());return!0},t.prototype.remove=function(r){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var r=this,n=[],a=0,s=this.array_.length;a<s;a++)n.push(r.array_[a]);return n},t.prototype.iterator=function(){return new xc(this)},t}(Jo),xc=function(e){function t(r){e.call(this),this.hashSet_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new zi;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new vo},t}(Gi),Yn=0,_r=1;function xa(e){return e===null?Yn:e.color}function st(e){return e===null?null:e.parent}function Vn(e,t){e!==null&&(e.color=t)}function ps(e){return e===null?null:e.left}function Sa(e){return e===null?null:e.right}function jt(){this.root_=null,this.size_=0}jt.prototype=new Nc;jt.prototype.get=function(e){for(var t=this.root_;t!==null;){var r=e.compareTo(t.key);if(r<0)t=t.left;else if(r>0)t=t.right;else return t.value}return null};jt.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:Yn,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r=this.root_,n,a;do if(n=r,a=e.compareTo(r.key),a<0)r=r.left;else if(a>0)r=r.right;else{var s=r.value;return r.value=t,s}while(r!==null);var f={key:e,left:null,right:null,value:t,parent:n,color:Yn,getValue:function(){return this.value},getKey:function(){return this.key}};return a<0?n.left=f:n.right=f,this.fixAfterInsertion(f),this.size_++,null};jt.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=_r;e!=null&&e!==this.root_&&e.parent.color===_r;)if(st(e)===ps(st(st(e)))){var r=Sa(st(st(e)));xa(r)===_r?(Vn(st(e),Yn),Vn(r,Yn),Vn(st(st(e)),_r),e=st(st(e))):(e===Sa(st(e))&&(e=st(e),t.rotateLeft(e)),Vn(st(e),Yn),Vn(st(st(e)),_r),t.rotateRight(st(st(e))))}else{var n=ps(st(st(e)));xa(n)===_r?(Vn(st(e),Yn),Vn(n,Yn),Vn(st(st(e)),_r),e=st(st(e))):(e===ps(st(e))&&(e=st(e),t.rotateRight(e)),Vn(st(e),Yn),Vn(st(st(e)),_r),t.rotateLeft(st(st(e))))}this.root_.color=Yn};jt.prototype.values=function(){var e=new b,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=jt.successor(t))!==null;)e.add(t.value);return e};jt.prototype.entrySet=function(){var e=new Bs,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=jt.successor(t))!==null;)e.add(t);return e};jt.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};jt.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};jt.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};jt.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var r=e.parent,n=e;r!==null&&n===r.right;)n=r,r=r.parent;return r}};jt.prototype.size=function(){return this.size_};var to=function(){};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};function hu(){}hu.prototype=new Jo;function an(){this.array_=[],arguments[0]instanceof wt&&this.addAll(arguments[0])}an.prototype=new hu;an.prototype.contains=function(e){for(var t=this,r=0,n=this.array_.length;r<n;r++){var a=t.array_[r];if(a.compareTo(e)===0)return!0}return!1};an.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var r=0,n=this.array_.length;r<n;r++){var a=t.array_[r];if(a.compareTo(e)===1)return t.array_.splice(r,0,e),!0}return this.array_.push(e),!0};an.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next());return!0};an.prototype.remove=function(e){throw new vo};an.prototype.size=function(){return this.array_.length};an.prototype.isEmpty=function(){return this.array_.length===0};an.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};an.prototype.iterator=function(){return new Zo(this)};var Zo=function(e){this.treeSet_=e,this.position_=0};Zo.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new zi;return this.treeSet_.array_[this.position_++]};Zo.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Zo.prototype.remove=function(){throw new vo};var Nr=function(){};Nr.sort=function(){var e=arguments[0],t,r,n,a;if(arguments.length===1)a=function(f,o){return f.compareTo(o)},e.sort(a);else if(arguments.length===2)n=arguments[1],a=function(f,o){return n.compare(f,o)},e.sort(a);else if(arguments.length===3){r=e.slice(arguments[1],arguments[2]),r.sort();var s=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<s.length;t++)e.push(s[t])}else if(arguments.length===4)for(r=e.slice(arguments[1],arguments[2]),n=arguments[3],a=function(f,o){return n.compare(f,o)},r.sort(a),s=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<s.length;t++)e.push(s[t])};Nr.asList=function(e){for(var t=new b,r=0,n=e.length;r<n;r++)t.add(e[r]);return t};var J=function(){},Je={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Je.P.get=function(){return 0};Je.L.get=function(){return 1};Je.A.get=function(){return 2};Je.FALSE.get=function(){return-1};Je.TRUE.get=function(){return-2};Je.DONTCARE.get=function(){return-3};Je.SYM_FALSE.get=function(){return"F"};Je.SYM_TRUE.get=function(){return"T"};Je.SYM_DONTCARE.get=function(){return"*"};Je.SYM_P.get=function(){return"0"};Je.SYM_L.get=function(){return"1"};Je.SYM_A.get=function(){return"2"};J.prototype.interfaces_=function(){return[]};J.prototype.getClass=function(){return J};J.toDimensionSymbol=function(e){switch(e){case J.FALSE:return J.SYM_FALSE;case J.TRUE:return J.SYM_TRUE;case J.DONTCARE:return J.SYM_DONTCARE;case J.P:return J.SYM_P;case J.L:return J.SYM_L;case J.A:return J.SYM_A}throw new ct("Unknown dimension value: "+e)};J.toDimensionValue=function(e){switch(Zi.toUpperCase(e)){case J.SYM_FALSE:return J.FALSE;case J.SYM_TRUE:return J.TRUE;case J.SYM_DONTCARE:return J.DONTCARE;case J.SYM_P:return J.P;case J.SYM_L:return J.L;case J.SYM_A:return J.A}throw new ct("Unknown dimension symbol: "+e)};Object.defineProperties(J,Je);var un=function(){};un.prototype.filter=function(e){};un.prototype.interfaces_=function(){return[]};un.prototype.getClass=function(){return un};var Xe=function(){};Xe.prototype.filter=function(e,t){};Xe.prototype.isDone=function(){};Xe.prototype.isGeometryChanged=function(){};Xe.prototype.interfaces_=function(){return[]};Xe.prototype.getClass=function(){return Xe};var ne=function(e){function t(n,a){if(e.call(this,a),this._geometries=n||[],e.hasNullElements(this._geometries))throw new ct("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var n=this,a=new T,s=0;s<this._geometries.length;s++)a.expandToInclude(n._geometries[s].getEnvelopeInternal());return a},t.prototype.getGeometryN=function(n){return this._geometries[n]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var n=this,a=new Array(this.getNumPoints()).fill(null),s=-1,f=0;f<this._geometries.length;f++)for(var o=n._geometries[f].getCoordinates(),x=0;x<o.length;x++)s++,a[s]=o[x];return a},t.prototype.getArea=function(){for(var n=this,a=0,s=0;s<this._geometries.length;s++)a+=n._geometries[s].getArea();return a},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var a=arguments[0],s=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a;if(this._geometries.length!==f._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!n._geometries[o].equalsExact(f._geometries[o],s))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var n=this,a=0;a<this._geometries.length;a++)n._geometries[a].normalize();Nr.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var n=this,a=J.FALSE,s=0;s<this._geometries.length;s++)a=Math.max(a,n._geometries[s].getBoundaryDimension());return a},t.prototype.getDimension=function(){for(var n=this,a=J.FALSE,s=0;s<this._geometries.length;s++)a=Math.max(a,n._geometries[s].getDimension());return a},t.prototype.getLength=function(){for(var n=this,a=0,s=0;s<this._geometries.length;s++)a+=n._geometries[s].getLength();return a},t.prototype.getNumPoints=function(){for(var n=this,a=0,s=0;s<this._geometries.length;s++)a+=n._geometries[s].getNumPoints();return a},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var n=this,a=this._geometries.length,s=new Array(a).fill(null),f=0;f<this._geometries.length;f++)s[f]=n._geometries[f].reverse();return this.getFactory().createGeometryCollection(s)},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var a=arguments[0],s=new an(Nr.asList(this._geometries)),f=new an(Nr.asList(a._geometries));return this.compare(s,f)}else if(arguments.length===2){for(var o=arguments[0],x=arguments[1],C=o,P=this.getNumGeometries(),ge=C.getNumGeometries(),nt=0;nt<P&&nt<ge;){var ze=n.getGeometryN(nt),Bt=C.getGeometryN(nt),qr=ze.compareToSameClass(Bt,x);if(qr!==0)return qr;nt++}return nt<P?1:nt<ge?-1:0}},t.prototype.apply=function(){var n=this;if(G(arguments[0],wn))for(var a=arguments[0],s=0;s<this._geometries.length;s++)n._geometries[s].apply(a);else if(G(arguments[0],Xe)){var f=arguments[0];if(this._geometries.length===0)return null;for(var o=0;o<this._geometries.length&&(n._geometries[o].apply(f),!f.isDone());o++);f.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var x=arguments[0];x.filter(this);for(var C=0;C<this._geometries.length;C++)n._geometries[C].apply(x)}else if(G(arguments[0],Qn)){var P=arguments[0];P.filter(this);for(var ge=0;ge<this._geometries.length;ge++)n._geometries[ge].apply(P)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),U.shouldNeverReachHere(),null},t.prototype.clone=function(){var n=this,a=e.prototype.clone.call(this);a._geometries=new Array(this._geometries.length).fill(null);for(var s=0;s<this._geometries.length;s++)a._geometries[s]=n._geometries[s].clone();return a},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.isEmpty=function(){for(var n=this,a=0;a<this._geometries.length;a++)if(!n._geometries[a].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,r),t}(k),Lr=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?J.FALSE:0},t.prototype.isClosed=function(){var n=this;if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!n._geometries[a].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var n=this,a=this._geometries.length,s=new Array(a).fill(null),f=0;f<this._geometries.length;f++)s[a-1-f]=n._geometries[f].reverse();return this.getFactory().createMultiLineString(s)},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,r),t}(ne),Oe=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=Me.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=n}};Oe.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};Oe.prototype.getBoundary=function(){return this._geom instanceof pt?this.boundaryLineString(this._geom):this._geom instanceof Lr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Oe.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};Oe.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Oe.prototype.computeBoundaryCoordinates=function(e){var t=this,r=new b;this._endpointMap=new jt;for(var n=0;n<e.getNumGeometries();n++){var a=e.getGeometryN(n);a.getNumPoints()!==0&&(t.addEndpoint(a.getCoordinateN(0)),t.addEndpoint(a.getCoordinateN(a.getNumPoints()-1)))}for(var s=this._endpointMap.entrySet().iterator();s.hasNext();){var f=s.next(),o=f.getValue(),x=o.count;t._bnRule.isInBoundary(x)&&r.add(f.getKey())}return W.toCoordinateArray(r)};Oe.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new ko,this._endpointMap.put(e,t)),t.count++};Oe.prototype.interfaces_=function(){return[]};Oe.prototype.getClass=function(){return Oe};Oe.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new Oe(e);return t.getBoundary()}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=new Oe(r,n);return a.getBoundary()}};var ko=function(){this.count=null};ko.prototype.interfaces_=function(){return[]};ko.prototype.getClass=function(){return ko};function Sc(){}function wc(){}var Lc=function(){};function bc(){}function Pc(){}function Rc(){}var De=function(){},ks={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};De.prototype.interfaces_=function(){return[]};De.prototype.getClass=function(){return De};De.chars=function(e,t){for(var r=new Array(t).fill(null),n=0;n<t;n++)r[n]=e;return String(r)};De.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new bc,r=new Sc;return e.printStackTrace(r),t.toString()}else if(arguments.length===2){var n=arguments[0],a=arguments[1],s="";new wc(De.getStackTrace(n));for(var f=new Rc,o=0;o<a;o++)try{s+=f.readLine()+De.NEWLINE}catch(x){if(x instanceof Pc)U.shouldNeverReachHere();else throw x}finally{}return s}};De.split=function(e,t){for(var r=t.length,n=new b,a=""+e,s=a.indexOf(t);s>=0;){var f=a.substring(0,s);n.add(f),a=a.substring(s+r),s=a.indexOf(t)}a.length>0&&n.add(a);for(var o=new Array(n.size()).fill(null),x=0;x<o.length;x++)o[x]=n.get(x);return o};De.toString=function(){if(arguments.length===1){var e=arguments[0];return De.SIMPLE_ORDINATE_FORMAT.format(e)}};De.spaces=function(e){return De.chars(" ",e)};ks.NEWLINE.get=function(){return Ut.getProperty("line.separator")};ks.SIMPLE_ORDINATE_FORMAT.get=function(){return new Lc};Object.defineProperties(De,ks);var Et=function(){};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.copyCoord=function(e,t,r,n){for(var a=Math.min(e.getDimension(),r.getDimension()),s=0;s<a;s++)r.setOrdinate(n,s,e.getOrdinate(t,s))};Et.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Q.X)===e.getOrdinate(t-1,Q.X)&&e.getOrdinate(0,Q.Y)===e.getOrdinate(t-1,Q.Y)};Et.isEqual=function(e,t){var r=e.size(),n=t.size();if(r!==n)return!1;for(var a=Math.min(e.getDimension(),t.getDimension()),s=0;s<r;s++)for(var f=0;f<a;f++){var o=e.getOrdinate(s,f),x=t.getOrdinate(s,f);if(e.getOrdinate(s,f)!==t.getOrdinate(s,f)&&!(z.isNaN(o)&&z.isNaN(x)))return!1}return!0};Et.extend=function(e,t,r){var n=e.create(r,t.getDimension()),a=t.size();if(Et.copy(t,0,n,0,a),a>0)for(var s=a;s<r;s++)Et.copy(t,a-1,n,s,1);return n};Et.reverse=function(e){for(var t=e.size()-1,r=Math.trunc(t/2),n=0;n<=r;n++)Et.swap(e,n,t-n)};Et.swap=function(e,t,r){if(t===r)return null;for(var n=0;n<e.getDimension();n++){var a=e.getOrdinate(t,n);e.setOrdinate(t,n,e.getOrdinate(r,n)),e.setOrdinate(r,n,a)}};Et.copy=function(e,t,r,n,a){for(var s=0;s<a;s++)Et.copyCoord(e,t+s,r,n+s)};Et.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var r=e.getDimension(),n=new yn;n.append("(");for(var a=0;a<t;a++){a>0&&n.append(" ");for(var s=0;s<r;s++)s>0&&n.append(","),n.append(De.toString(e.getOrdinate(a,s)))}return n.append(")"),n.toString()}};Et.ensureValidRing=function(e,t){var r=t.size();if(r===0)return t;if(r<=3)return Et.createClosedRing(e,t,4);var n=t.getOrdinate(0,Q.X)===t.getOrdinate(r-1,Q.X)&&t.getOrdinate(0,Q.Y)===t.getOrdinate(r-1,Q.Y);return n?t:Et.createClosedRing(e,t,r+1)};Et.createClosedRing=function(e,t,r){var n=e.create(r,t.getDimension()),a=t.size();Et.copy(t,0,n,0,a);for(var s=a;s<r;s++)Et.copy(t,0,n,s,1);return n};var pt=function(e){function t(n,a){e.call(this,a),this._points=null,this.init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new T:this._points.expandEnvelope(new T)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var a=arguments[0],s=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a;if(this._points.size()!==f._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!n.equal(n._points.getCoordinate(o),f._points.getCoordinate(o),s))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var n=this,a=0;a<Math.trunc(this._points.size()/2);a++){var s=n._points.size()-1-a;if(!n._points.getCoordinate(a).equals(n._points.getCoordinate(s)))return n._points.getCoordinate(a).compareTo(n._points.getCoordinate(s))>0&&Et.reverse(n._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?J.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return O.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var n=this._points.copy();Et.reverse(n);var a=this.getFactory().createLineString(n);return a},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){for(var a=arguments[0],s=a,f=0,o=0;f<this._points.size()&&o<s._points.size();){var x=n._points.getCoordinate(f).compareTo(s._points.getCoordinate(o));if(x!==0)return x;f++,o++}return f<this._points.size()?1:o<s._points.size()?-1:0}else if(arguments.length===2){var C=arguments[0],P=arguments[1],ge=C;return P.compare(this._points,ge._points)}},t.prototype.apply=function(){var n=this;if(G(arguments[0],wn))for(var a=arguments[0],s=0;s<this._points.size();s++)a.filter(n._points.getCoordinate(s));else if(G(arguments[0],Xe)){var f=arguments[0];if(this._points.size()===0)return null;for(var o=0;o<this._points.size()&&(f.filter(n._points,o),!f.isDone());o++);f.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var x=arguments[0];x.filter(this)}else if(G(arguments[0],Qn)){var C=arguments[0];C.filter(this)}},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.isEquivalentClass=function(n){return n instanceof t},t.prototype.clone=function(){var n=e.prototype.clone.call(this);return n._points=this._points.clone(),n},t.prototype.getCoordinateN=function(n){return this._points.getCoordinate(n)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(n){if(n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),n.size()===1)throw new ct("Invalid number of points in LineString (found "+n.size()+" - must be 0 or >= 2)");this._points=n},t.prototype.isCoordinate=function(n){for(var a=this,s=0;s<this._points.size();s++)if(a._points.getCoordinate(s).equals(n))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(n){return this.getFactory().createPoint(this._points.getCoordinate(n))},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,r),t}(k),eo=function(){};eo.prototype.interfaces_=function(){return[]};eo.prototype.getClass=function(){return eo};var de=function(e){function t(n,a){e.call(this,a),this._coordinates=n||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new T;var n=new T;return n.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),n},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?this.isEmpty()&&n.isEmpty()?!0:this.isEmpty()!==n.isEmpty()?!1:this.equal(n.getCoordinate(),this.getCoordinate(),a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var n=arguments[0],a=n;return this.getCoordinate().compareTo(a.getCoordinate())}else if(arguments.length===2){var s=arguments[0],f=arguments[1],o=s;return f.compare(this._coordinates,o._coordinates)}},t.prototype.apply=function(){if(G(arguments[0],wn)){var n=arguments[0];if(this.isEmpty())return null;n.filter(this.getCoordinate())}else if(G(arguments[0],Xe)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else if(G(arguments[0],un)){var s=arguments[0];s.filter(this)}else if(G(arguments[0],Qn)){var f=arguments[0];f.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var n=e.prototype.clone.call(this);return n._coordinates=this._coordinates.clone(),n},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(n){n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),U.isTrue(n.size()<=1),this._coordinates=n},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[eo]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,r),t}(k),ur=function(){};ur.prototype.interfaces_=function(){return[]};ur.prototype.getClass=function(){return ur};var Rt=function(e){function t(n,a,s){if(e.call(this,s),this._shell=null,this._holes=null,n===null&&(n=this.getFactory().createLinearRing()),a===null&&(a=[]),e.hasNullElements(a))throw new ct("holes must not contain null elements");if(n.isEmpty()&&e.hasNonEmptyElements(a))throw new ct("shell is empty but holes are not");this._shell=n,this._holes=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var n=this;if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),s=-1,f=this._shell.getCoordinates(),o=0;o<f.length;o++)s++,a[s]=f[o];for(var x=0;x<this._holes.length;x++)for(var C=n._holes[x].getCoordinates(),P=0;P<C.length;P++)s++,a[s]=C[P];return a},t.prototype.getArea=function(){var n=this,a=0;a+=Math.abs(O.signedArea(this._shell.getCoordinateSequence()));for(var s=0;s<this._holes.length;s++)a-=Math.abs(O.signedArea(n._holes[s].getCoordinateSequence()));return a},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var n=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),s=0;s<5;s++){var f=n.getX(s);if(!(f===a.getMinX()||f===a.getMaxX()))return!1;var o=n.getY(s);if(!(o===a.getMinY()||o===a.getMaxY()))return!1}for(var x=n.getX(0),C=n.getY(0),P=1;P<=4;P++){var ge=n.getX(P),nt=n.getY(P),ze=ge!==x,Bt=nt!==C;if(ze===Bt)return!1;x=ge,C=nt}return!0},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var a=arguments[0],s=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a,o=this._shell,x=f._shell;if(!o.equalsExact(x,s)||this._holes.length!==f._holes.length)return!1;for(var C=0;C<this._holes.length;C++)if(!n._holes[C].equalsExact(f._holes[C],s))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var n=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var a=0;a<this._holes.length;a++)n.normalize(n._holes[a],!1);Nr.sort(this._holes)}else if(arguments.length===2){var s=arguments[0],f=arguments[1];if(s.isEmpty())return null;var o=new Array(s.getCoordinates().length-1).fill(null);Ut.arraycopy(s.getCoordinates(),0,o,0,o.length);var x=W.minCoordinate(s.getCoordinates());W.scroll(o,x),Ut.arraycopy(o,0,s.getCoordinates(),0,o.length),s.getCoordinates()[o.length]=o[0],O.isCCW(s.getCoordinates())===f&&W.reverse(s.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var n=this,a=0;a+=this._shell.getLength();for(var s=0;s<this._holes.length;s++)a+=n._holes[s].getLength();return a},t.prototype.getNumPoints=function(){for(var n=this,a=this._shell.getNumPoints(),s=0;s<this._holes.length;s++)a+=n._holes[s].getNumPoints();return a},t.prototype.reverse=function(){var n=this,a=this.copy();a._shell=this._shell.copy().reverse(),a._holes=new Array(this._holes.length).fill(null);for(var s=0;s<this._holes.length;s++)a._holes[s]=n._holes[s].copy().reverse();return a},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var a=arguments[0],s=this._shell,f=a._shell;return s.compareToSameClass(f)}else if(arguments.length===2){var o=arguments[0],x=arguments[1],C=o,P=this._shell,ge=C._shell,nt=P.compareToSameClass(ge,x);if(nt!==0)return nt;for(var ze=this.getNumInteriorRing(),Bt=C.getNumInteriorRing(),qr=0;qr<ze&&qr<Bt;){var _n=n.getInteriorRingN(qr),Fn=C.getInteriorRingN(qr),tl=_n.compareToSameClass(Fn,x);if(tl!==0)return tl;qr++}return qr<ze?1:qr<Bt?-1:0}},t.prototype.apply=function(n){var a=this;if(G(n,wn)){this._shell.apply(n);for(var s=0;s<this._holes.length;s++)a._holes[s].apply(n)}else if(G(n,Xe)){if(this._shell.apply(n),!n.isDone())for(var f=0;f<this._holes.length&&(a._holes[f].apply(n),!n.isDone());f++);n.isGeometryChanged()&&this.geometryChanged()}else if(G(n,un))n.filter(this);else if(G(n,Qn)){n.filter(this),this._shell.apply(n);for(var o=0;o<this._holes.length;o++)a._holes[o].apply(n)}},t.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var s=0;s<this._holes.length;s++)a[s+1]=n._holes[s];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)},t.prototype.clone=function(){var n=this,a=e.prototype.clone.call(this);a._shell=this._shell.clone(),a._holes=new Array(this._holes.length).fill(null);for(var s=0;s<this._holes.length;s++)a._holes[s]=n._holes[s].clone();return a},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var n=this,a=this._shell.copy(),s=new Array(this._holes.length).fill(null),f=0;f<s.length;f++)s[f]=n._holes[f].copy();return new t(a,s,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(n){return this._holes[n]},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,r),t}(k),Ni=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._geometries[n].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[eo]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,r),t}(ne),Ln=function(e){function t(n,a){n instanceof v&&a instanceof H&&(n=a.getCoordinateSequenceFactory().create(n)),e.call(this,n,a),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return J.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var n=this._points.copy();Et.reverse(n);var a=this.getFactory().createLinearRing(n);return a},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new ct("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new ct("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,r),t}(pt),xn=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return k.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var n=this,a=this._geometries.length,s=new Array(a).fill(null),f=0;f<this._geometries.length;f++)s[f]=n._geometries[f].reverse();return this.getFactory().createMultiPolygon(s)},t.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new b,s=0;s<this._geometries.length;s++)for(var f=n._geometries[s],o=f.getBoundary(),x=0;x<o.getNumGeometries();x++)a.add(o.getGeometryN(x));var C=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(C))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var n=this,a=new Array(this._geometries.length).fill(null),s=0;s<a.length;s++)a[s]=n._geometries[s].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,r),t}(ne),Ae=function(e){this._factory=e||null,this._isUserDataCopied=!1},$o={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Ae.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Ae.prototype.edit=function(e,t){if(e===null)return null;var r=this.editInternal(e,t);return this._isUserDataCopied&&r.setUserData(e.getUserData()),r};Ae.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof ne?this.editGeometryCollection(e,t):e instanceof Rt?this.editPolygon(e,t):e instanceof de?t.edit(e,this._factory):e instanceof pt?t.edit(e,this._factory):(U.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Ae.prototype.editGeometryCollection=function(e,t){for(var r=this,n=t.edit(e,this._factory),a=new b,s=0;s<n.getNumGeometries();s++){var f=r.edit(n.getGeometryN(s),t);f===null||f.isEmpty()||a.add(f)}return n.getClass()===Ni?this._factory.createMultiPoint(a.toArray([])):n.getClass()===Lr?this._factory.createMultiLineString(a.toArray([])):n.getClass()===xn?this._factory.createMultiPolygon(a.toArray([])):this._factory.createGeometryCollection(a.toArray([]))};Ae.prototype.editPolygon=function(e,t){var r=this,n=t.edit(e,this._factory);if(n===null&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var a=this.edit(n.getExteriorRing(),t);if(a===null||a.isEmpty())return this._factory.createPolygon();for(var s=new b,f=0;f<n.getNumInteriorRing();f++){var o=r.edit(n.getInteriorRingN(f),t);o===null||o.isEmpty()||s.add(o)}return this._factory.createPolygon(a,s.toArray([]))};Ae.prototype.interfaces_=function(){return[]};Ae.prototype.getClass=function(){return Ae};Ae.GeometryEditorOperation=function(){};$o.NoOpGeometryOperation.get=function(){return no};$o.CoordinateOperation.get=function(){return ro};$o.CoordinateSequenceOperation.get=function(){return io};Object.defineProperties(Ae,$o);var no=function(){};no.prototype.edit=function(e,t){return e};no.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};no.prototype.getClass=function(){return no};var ro=function(){};ro.prototype.edit=function(e,t){var r=this.editCoordinates(e.getCoordinates(),e);return r===null?e:e instanceof Ln?t.createLinearRing(r):e instanceof pt?t.createLineString(r):e instanceof de?r.length>0?t.createPoint(r[0]):t.createPoint():e};ro.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};ro.prototype.getClass=function(){return ro};var io=function(){};io.prototype.edit=function(e,t){return e instanceof Ln?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof pt?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof de?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};io.prototype.interfaces_=function(){return[Ae.GeometryEditorOperation]};io.prototype.getClass=function(){return io};var yt=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var r=0;r<t;r++)e._coordinates[r]=new v}else if(G(arguments[0],Q)){var n=arguments[0];if(n===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var a=0;a<this._coordinates.length;a++)e._coordinates[a]=n.getCoordinateCopy(a)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var s=arguments[0],f=arguments[1];this._coordinates=s,this._dimension=f,s===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],x=arguments[1];this._coordinates=new Array(o).fill(null),this._dimension=x;for(var C=0;C<o;C++)e._coordinates[C]=new v}}},gu={serialVersionUID:{configurable:!0}};yt.prototype.setOrdinate=function(e,t,r){switch(t){case Q.X:this._coordinates[e].x=r;break;case Q.Y:this._coordinates[e].y=r;break;case Q.Z:this._coordinates[e].z=r;break;default:throw new ct("invalid ordinateIndex")}};yt.prototype.size=function(){return this._coordinates.length};yt.prototype.getOrdinate=function(e,t){switch(t){case Q.X:return this._coordinates[e].x;case Q.Y:return this._coordinates[e].y;case Q.Z:return this._coordinates[e].z}return z.NaN};yt.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],r=arguments[1];r.x=this._coordinates[t].x,r.y=this._coordinates[t].y,r.z=this._coordinates[t].z}};yt.prototype.getCoordinateCopy=function(e){return new v(this._coordinates[e])};yt.prototype.getDimension=function(){return this._dimension};yt.prototype.getX=function(e){return this._coordinates[e].x};yt.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)t[r]=e._coordinates[r].clone();return new yt(t,this._dimension)};yt.prototype.expandEnvelope=function(e){for(var t=this,r=0;r<this._coordinates.length;r++)e.expandToInclude(t._coordinates[r]);return e};yt.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)t[r]=e._coordinates[r].copy();return new yt(t,this._dimension)};yt.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new yn(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)t.append(", "),t.append(e._coordinates[r]);return t.append(")"),t.toString()}else return"()"};yt.prototype.getY=function(e){return this._coordinates[e].y};yt.prototype.toCoordinateArray=function(){return this._coordinates};yt.prototype.interfaces_=function(){return[Q,Ge]};yt.prototype.getClass=function(){return yt};gu.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(yt,gu);var bn=function(){},Gs={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};bn.prototype.readResolve=function(){return bn.instance()};bn.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new yt(e)}else if(G(arguments[0],Q)){var t=arguments[0];return new yt(t)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new yt(r):new yt(r,n)}};bn.prototype.interfaces_=function(){return[yi,Ge]};bn.prototype.getClass=function(){return bn};bn.instance=function(){return bn.instanceObject};Gs.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Gs.instanceObject.get=function(){return new bn};Object.defineProperties(bn,Gs);var pu=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(r){return this.map_.get(r)||null},t.prototype.put=function(r,n){return this.map_.set(r,n),n},t.prototype.values=function(){for(var r=new b,n=this.map_.values(),a=n.next();!a.done;)r.add(a.value),a=n.next();return r},t.prototype.entrySet=function(){var r=new Bs;return this.map_.entries().forEach(function(n){return r.add(n)}),r},t.prototype.size=function(){return this.map_.size()},t}(li),$=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ln){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var r=arguments[0];this._modelType=e.FIXED,this.setScale(r)}else if(arguments[0]instanceof e){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}},zs={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};$.prototype.equals=function(e){if(!(e instanceof $))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};$.prototype.compareTo=function(e){var t=e,r=this.getMaximumSignificantDigits(),n=t.getMaximumSignificantDigits();return new sn(r).compareTo(new sn(n))};$.prototype.getScale=function(){return this._scale};$.prototype.isFloating=function(){return this._modelType===$.FLOATING||this._modelType===$.FLOATING_SINGLE};$.prototype.getType=function(){return this._modelType};$.prototype.toString=function(){var e="UNKNOWN";return this._modelType===$.FLOATING?e="Floating":this._modelType===$.FLOATING_SINGLE?e="Floating-Single":this._modelType===$.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};$.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(z.isNaN(e))return e;if(this._modelType===$.FLOATING_SINGLE){var t=e;return t}return this._modelType===$.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof v){var r=arguments[0];if(this._modelType===$.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}};$.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===$.FLOATING?e=16:this._modelType===$.FLOATING_SINGLE?e=6:this._modelType===$.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};$.prototype.setScale=function(e){this._scale=Math.abs(e)};$.prototype.interfaces_=function(){return[Ge,ke]};$.prototype.getClass=function(){return $};$.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};zs.serialVersionUID.get=function(){return 7777263578777804e3};zs.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties($,zs);var ln=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Vs={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};ln.prototype.readResolve=function(){return ln.nameToTypeMap.get(this._name)};ln.prototype.toString=function(){return this._name};ln.prototype.interfaces_=function(){return[Ge]};ln.prototype.getClass=function(){return ln};Vs.serialVersionUID.get=function(){return-552860263173159e4};Vs.nameToTypeMap.get=function(){return new pu};Object.defineProperties(ln,Vs);$.Type=ln;$.FIXED=new ln("FIXED");$.FLOATING=new ln("FLOATING");$.FLOATING_SINGLE=new ln("FLOATING SINGLE");var H=function e(){this._precisionModel=new $,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?G(arguments[0],yi)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof $&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},du={serialVersionUID:{configurable:!0}};H.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new v(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new v(e.getMinX(),e.getMinY()),new v(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new v(e.getMinX(),e.getMinY()),new v(e.getMinX(),e.getMaxY()),new v(e.getMaxX(),e.getMaxY()),new v(e.getMaxX(),e.getMinY()),new v(e.getMinX(),e.getMinY())]),null)};H.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new pt(this.getCoordinateSequenceFactory().create(e),this);if(G(e,Q))return new pt(e,this)}else return new pt(this.getCoordinateSequenceFactory().create([]),this)};H.prototype.createMultiLineString=function(){if(arguments.length===0)return new Lr(null,this);if(arguments.length===1){var e=arguments[0];return new Lr(e,this)}};H.prototype.buildGeometry=function(e){for(var t=null,r=!1,n=!1,a=e.iterator();a.hasNext();){var s=a.next(),f=s.getClass();t===null&&(t=f),f!==t&&(r=!0),s.isGeometryCollectionOrDerived()&&(n=!0)}if(t===null)return this.createGeometryCollection();if(r||n)return this.createGeometryCollection(H.toGeometryArray(e));var o=e.iterator().next(),x=e.size()>1;if(x){if(o instanceof Rt)return this.createMultiPolygon(H.toPolygonArray(e));if(o instanceof pt)return this.createMultiLineString(H.toLineStringArray(e));if(o instanceof de)return this.createMultiPoint(H.toPointArray(e));U.shouldNeverReachHere("Unhandled class: "+o.getClass().getName())}return o};H.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};H.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof v){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(G(arguments[0],Q)){var t=arguments[0];return new de(t,this)}}};H.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};H.prototype.createPolygon=function(){if(arguments.length===0)return new Rt(null,null,this);if(arguments.length===1){if(G(arguments[0],Q)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Ln){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var n=arguments[0],a=arguments[1];return new Rt(n,a,this)}};H.prototype.getSRID=function(){return this._SRID};H.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ne(null,this);if(arguments.length===1){var e=arguments[0];return new ne(e,this)}};H.prototype.createGeometry=function(e){var t=new Ae(this);return t.edit(e,{edit:function(){if(arguments.length===2){var r=arguments[0];return this._coordinateSequenceFactory.create(r)}}})};H.prototype.getPrecisionModel=function(){return this._precisionModel};H.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(G(arguments[0],Q)){var t=arguments[0];return new Ln(t,this)}}};H.prototype.createMultiPolygon=function(){if(arguments.length===0)return new xn(null,this);if(arguments.length===1){var e=arguments[0];return new xn(e,this)}};H.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Ni(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Ni(t,this)}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(G(arguments[0],Q)){var n=arguments[0];if(n===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(n.size()).fill(null),s=0;s<n.size();s++){var f=e.getCoordinateSequenceFactory().create(1,n.getDimension());Et.copy(n,s,f,0,1),a[s]=e.createPoint(f)}return this.createMultiPoint(a)}}};H.prototype.interfaces_=function(){return[Ge]};H.prototype.getClass=function(){return H};H.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};H.getDefaultCoordinateSequenceFactory=function(){return bn.instance()};H.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};H.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};du.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(H,du);var Oc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ts=function(e){this.geometryFactory=e||new H};ts.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var r=t.type;if(!tn[r])throw new Error("Unknown GeoJSON type: "+t.type);return Oc.indexOf(r)!==-1?tn[r].apply(this,[t.coordinates]):r==="GeometryCollection"?tn[r].apply(this,[t.geometries]):tn[r].apply(this,[t])};ts.prototype.write=function(e){var t=e.getGeometryType();if(!qn[t])throw new Error("Geometry is not supported");return qn[t].apply(this,[e])};var tn={Feature:function(e){var t={};for(var r in e)t[r]=e[r];if(e.geometry){var n=e.geometry.type;if(!tn[n])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=tn.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,r={};if(e.features){r.features=[];for(var n=0;n<e.features.length;++n)r.features.push(t.read(e.features[n]))}return e.bbox&&(r.bbox=this.parse.bbox.apply(this,[e.bbox])),r},coordinates:function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];t.push(new v(n[0],n[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new v(e[0],e[1]),new v(e[2],e[1]),new v(e[2],e[3]),new v(e[0],e[3]),new v(e[0],e[1])])},Point:function(e){var t=new v(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(tn.Point.apply(t,[e[n]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(e){var t=tn.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(tn.LineString.apply(t,[e[n]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(e){for(var t=this,r=tn.coordinates.apply(this,[e[0]]),n=this.geometryFactory.createLinearRing(r),a=[],s=1;s<e.length;++s){var f=e[s],o=tn.coordinates.apply(t,[f]),x=t.geometryFactory.createLinearRing(o);a.push(x)}return this.geometryFactory.createPolygon(n,a)},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var a=e[n];r.push(tn.Polygon.apply(t,[a]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var a=e[n];r.push(t.read(a))}return this.geometryFactory.createGeometryCollection(r)}},qn={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=qn.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=qn.Point.apply(t,[a]);r.push(s.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(e){for(var t=this,r=[],n=e.getCoordinates(),a=0;a<n.length;++a){var s=n[a];r.push(qn.coordinate.apply(t,[s]))}return{type:"LineString",coordinates:r}},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=qn.LineString.apply(t,[a]);r.push(s.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(e){var t=this,r=[],n=qn.LineString.apply(this,[e._shell]);r.push(n.coordinates);for(var a=0;a<e._holes.length;++a){var s=e._holes[a],f=qn.LineString.apply(t,[s]);r.push(f.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=qn.Polygon.apply(t,[a]);r.push(s.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var a=e._geometries[n],s=a.getGeometryType();r.push(qn[s].apply(t,[a]))}return{type:"GeometryCollection",geometries:r}}},Us=function(e){this.geometryFactory=e||new H,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ts(this.geometryFactory)};Us.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===$.FIXED&&this.reducePrecision(t),t};Us.prototype.reducePrecision=function(e){var t=this,r,n;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(r=0,n=e.points.length;r<n;r++)t.precisionModel.makePrecise(e.points[r]);else if(e.geometries)for(r=0,n=e.geometries.length;r<n;r++)t.reducePrecision(e.geometries[r])};var vu=function(){this.parser=new ts(this.geometryFactory)};vu.prototype.write=function(e){return this.parser.write(e)};var w=function(){},es={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};w.prototype.interfaces_=function(){return[]};w.prototype.getClass=function(){return w};w.opposite=function(e){return e===w.LEFT?w.RIGHT:e===w.RIGHT?w.LEFT:e};es.ON.get=function(){return 0};es.LEFT.get=function(){return 1};es.RIGHT.get=function(){return 2};Object.defineProperties(w,es);function ns(e){this.message=e||""}ns.prototype=new Error;ns.prototype.name="EmptyStackException";function mn(){this.array_=[]}mn.prototype=new Ue;mn.prototype.add=function(e){return this.array_.push(e),!0};mn.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};mn.prototype.push=function(e){return this.array_.push(e),e};mn.prototype.pop=function(e){if(this.array_.length===0)throw new ns;return this.array_.pop()};mn.prototype.peek=function(){if(this.array_.length===0)throw new ns;return this.array_[this.array_.length-1]};mn.prototype.empty=function(){return this.array_.length===0};mn.prototype.isEmpty=function(){return this.empty()};mn.prototype.search=function(e){return this.array_.indexOf(e)};mn.prototype.size=function(){return this.array_.length};mn.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};var cn=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};cn.prototype.getCoordinate=function(){return this._minCoord};cn.prototype.getRightmostSide=function(e,t){var r=this.getRightmostSideOfSegment(e,t);return r<0&&(r=this.getRightmostSideOfSegment(e,t-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),r};cn.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();U.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],r=e[this._minIndex+1],n=O.computeOrientation(this._minCoord,r,t),a=!1;(t.y<this._minCoord.y&&r.y<this._minCoord.y&&n===O.COUNTERCLOCKWISE||t.y>this._minCoord.y&&r.y>this._minCoord.y&&n===O.CLOCKWISE)&&(a=!0),a&&(this._minIndex=this._minIndex-1)};cn.prototype.getRightmostSideOfSegment=function(e,t){var r=e.getEdge(),n=r.getCoordinates();if(t<0||t+1>=n.length||n[t].y===n[t+1].y)return-1;var a=w.LEFT;return n[t].y<n[t+1].y&&(a=w.RIGHT),a};cn.prototype.getEdge=function(){return this._orientedDe};cn.prototype.checkForRightmostCoordinate=function(e){for(var t=this,r=e.getEdge().getCoordinates(),n=0;n<r.length-1;n++)(t._minCoord===null||r[n].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=n,t._minCoord=r[n])};cn.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};cn.prototype.findEdge=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next();n.isForward()&&t.checkForRightmostCoordinate(n)}U.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var a=this.getRightmostSide(this._minDe,this._minIndex);a===w.LEFT&&(this._orientedDe=this._minDe.getSym())};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};var Jn=function(e){function t(r,n){e.call(this,t.msgWithCoord(r,n)),this.pt=n?new v(n):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(r,n){return n?r:r+" [ "+n+" ]"},t}(Kn),rs=function(){this.array_=[]};rs.prototype.addLast=function(e){this.array_.push(e)};rs.prototype.removeFirst=function(){return this.array_.shift()};rs.prototype.isEmpty=function(){return this.array_.length===0};var re=function(){this._finder=null,this._dirEdgeList=new b,this._nodes=new b,this._rightMostCoord=null,this._env=null,this._finder=new cn};re.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};re.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};re.prototype.computeNodeDepth=function(e){for(var t=this,r=null,n=e.getEdges().iterator();n.hasNext();){var a=n.next();if(a.isVisited()||a.getSym().isVisited()){r=a;break}}if(r===null)throw new Jn("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(r);for(var s=e.getEdges().iterator();s.hasNext();){var f=s.next();f.setVisited(!0),t.copySymDepths(f)}};re.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(w.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};re.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};re.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(w.RIGHT)>=1&&t.getDepth(w.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};re.prototype.computeDepths=function(e){var t=this,r=new Bs,n=new rs,a=e.getNode();for(n.addLast(a),r.add(a),e.setVisited(!0);!n.isEmpty();){var s=n.removeFirst();r.add(s),t.computeNodeDepth(s);for(var f=s.getEdges().iterator();f.hasNext();){var o=f.next(),x=o.getSym();if(!x.isVisited()){var C=x.getNode();r.contains(C)||(n.addLast(C),r.add(C))}}}};re.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};re.prototype.getEnvelope=function(){if(this._env===null){for(var e=new T,t=this._dirEdgeList.iterator();t.hasNext();)for(var r=t.next(),n=r.getEdge().getCoordinates(),a=0;a<n.length-1;a++)e.expandToInclude(n[a]);this._env=e}return this._env};re.prototype.addReachable=function(e){var t=this,r=new mn;for(r.add(e);!r.empty();){var n=r.pop();t.add(n,r)}};re.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(w.LEFT,e.getDepth(w.RIGHT)),t.setDepth(w.RIGHT,e.getDepth(w.LEFT))};re.prototype.add=function(e,t){var r=this;e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var a=n.next();r._dirEdgeList.add(a);var s=a.getSym(),f=s.getNode();f.isVisited()||t.push(f)}};re.prototype.getNodes=function(){return this._nodes};re.prototype.getDirectedEdges=function(){return this._dirEdgeList};re.prototype.interfaces_=function(){return[ke]};re.prototype.getClass=function(){return re};var at=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[w.ON]=n}else if(arguments[0]instanceof e){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var s=0;s<this.location.length;s++)t.location[s]=a.location[s]}}else if(arguments.length===3){var f=arguments[0],o=arguments[1],x=arguments[2];this.init(3),this.location[w.ON]=f,this.location[w.LEFT]=o,this.location[w.RIGHT]=x}};at.prototype.setAllLocations=function(e){for(var t=this,r=0;r<this.location.length;r++)t.location[r]=e};at.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==m.NONE)return!1;return!0};at.prototype.setAllLocationsIfNull=function(e){for(var t=this,r=0;r<this.location.length;r++)t.location[r]===m.NONE&&(t.location[r]=e)};at.prototype.isLine=function(){return this.location.length===1};at.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var r=new Array(3).fill(null);r[w.ON]=this.location[w.ON],r[w.LEFT]=m.NONE,r[w.RIGHT]=m.NONE,this.location=r}for(var n=0;n<this.location.length;n++)t.location[n]===m.NONE&&n<e.location.length&&(t.location[n]=e.location[n])};at.prototype.getLocations=function(){return this.location};at.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[w.LEFT];this.location[w.LEFT]=this.location[w.RIGHT],this.location[w.RIGHT]=e};at.prototype.toString=function(){var e=new yn;return this.location.length>1&&e.append(m.toLocationSymbol(this.location[w.LEFT])),e.append(m.toLocationSymbol(this.location[w.ON])),this.location.length>1&&e.append(m.toLocationSymbol(this.location[w.RIGHT])),e.toString()};at.prototype.setLocations=function(e,t,r){this.location[w.ON]=e,this.location[w.LEFT]=t,this.location[w.RIGHT]=r};at.prototype.get=function(e){return e<this.location.length?this.location[e]:m.NONE};at.prototype.isArea=function(){return this.location.length>1};at.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===m.NONE)return!0;return!1};at.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(w.ON,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.location[t]=r}};at.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(m.NONE)};at.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};at.prototype.allPositionsEqual=function(e){for(var t=this,r=0;r<this.location.length;r++)if(t.location[r]!==e)return!1;return!0};at.prototype.interfaces_=function(){return[]};at.prototype.getClass=function(){return at};var et=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new at(t),this.elt[1]=new at(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.elt[0]=new at(r.elt[0]),this.elt[1]=new at(r.elt[1])}}else if(arguments.length===2){var n=arguments[0],a=arguments[1];this.elt[0]=new at(m.NONE),this.elt[1]=new at(m.NONE),this.elt[n].setLocation(a)}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];this.elt[0]=new at(s,f,o),this.elt[1]=new at(s,f,o)}else if(arguments.length===4){var x=arguments[0],C=arguments[1],P=arguments[2],ge=arguments[3];this.elt[0]=new at(m.NONE,m.NONE,m.NONE),this.elt[1]=new at(m.NONE,m.NONE,m.NONE),this.elt[x].setLocations(C,P,ge)}};et.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};et.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};et.prototype.isNull=function(e){return this.elt[e].isNull()};et.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.elt[t].setAllLocationsIfNull(r)}};et.prototype.isLine=function(e){return this.elt[e].isLine()};et.prototype.merge=function(e){for(var t=this,r=0;r<2;r++)t.elt[r]===null&&e.elt[r]!==null?t.elt[r]=new at(e.elt[r]):t.elt[r].merge(e.elt[r])};et.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};et.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(w.ON)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return this.elt[t].get(r)}};et.prototype.toString=function(){var e=new yn;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};et.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};et.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};et.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(w.ON,t)}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this.elt[r].setLocation(n,a)}};et.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};et.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};et.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new at(this.elt[e].location[0]))};et.prototype.interfaces_=function(){return[]};et.prototype.getClass=function(){return et};et.toLineLabel=function(e){for(var t=new et(m.NONE),r=0;r<2;r++)t.setLocation(r,e.getLocation(r));return t};var xt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new b,this._pts=new b,this._label=new et(m.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new b,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};xt.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)t[r]=e._pts.get(r);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=O.isCCW(this._ring.getCoordinates())};xt.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};xt.prototype.computePoints=function(e){var t=this;this._startDe=e;var r=e,n=!0;do{if(r===null)throw new Jn("Found null DirectedEdge");if(r.getEdgeRing()===t)throw new Jn("Directed Edge visited twice during ring-building at "+r.getCoordinate());t._edges.add(r);var a=r.getLabel();U.isTrue(a.isArea()),t.mergeLabel(a),t.addPoints(r.getEdge(),r.isForward(),n),n=!1,t.setEdgeRing(r,t),r=t.getNext(r)}while(r!==this._startDe)};xt.prototype.getLinearRing=function(){return this._ring};xt.prototype.getCoordinate=function(e){return this._pts.get(e)};xt.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var r=t.getNode(),n=r.getEdges().getOutgoingDegree(e);n>e._maxNodeDegree&&(e._maxNodeDegree=n),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};xt.prototype.addPoints=function(e,t,r){var n=this,a=e.getCoordinates();if(t){var s=1;r&&(s=0);for(var f=s;f<a.length;f++)n._pts.add(a[f])}else{var o=a.length-2;r&&(o=a.length-1);for(var x=o;x>=0;x--)n._pts.add(a[x])}};xt.prototype.isHole=function(){return this._isHole};xt.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};xt.prototype.containsPoint=function(e){var t=this.getLinearRing(),r=t.getEnvelopeInternal();if(!r.contains(e)||!O.isPointInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){var a=n.next();if(a.containsPoint(e))return!1}return!0};xt.prototype.addHole=function(e){this._holes.add(e)};xt.prototype.isShell=function(){return this._shell===null};xt.prototype.getLabel=function(){return this._label};xt.prototype.getEdges=function(){return this._edges};xt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};xt.prototype.getShell=function(){return this._shell};xt.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=t.getLocation(r,w.RIGHT);if(n===m.NONE)return null;if(this._label.getLocation(r)===m.NONE)return this._label.setLocation(r,n),null}};xt.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};xt.prototype.toPolygon=function(e){for(var t=this,r=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)r[n]=t._holes.get(n).getLinearRing();var a=e.createPolygon(this.getLinearRing(),r);return a};xt.prototype.interfaces_=function(){return[]};xt.prototype.getClass=function(){return xt};var Dc=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(r,n){r.setMinEdgeRing(n)},t.prototype.getNext=function(r){return r.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xt),Tc=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var r=this,n=new b,a=this._startDe;do{if(a.getMinEdgeRing()===null){var s=new Dc(a,r._geometryFactory);n.add(s)}a=a.getNext()}while(a!==this._startDe);return n},t.prototype.setEdgeRing=function(r,n){r.setEdgeRing(n)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=this,n=this._startDe;do{var a=n.getNode();a.getEdges().linkMinimalDirectedEdges(r),n=n.getNext()}while(n!==this._startDe)},t.prototype.getNext=function(r){return r.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xt),Se=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Se.prototype.setVisited=function(e){this._isVisited=e};Se.prototype.setInResult=function(e){this._isInResult=e};Se.prototype.isCovered=function(){return this._isCovered};Se.prototype.isCoveredSet=function(){return this._isCoveredSet};Se.prototype.setLabel=function(e){this._label=e};Se.prototype.getLabel=function(){return this._label};Se.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Se.prototype.updateIM=function(e){U.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Se.prototype.isInResult=function(){return this._isInResult};Se.prototype.isVisited=function(){return this._isVisited};Se.prototype.interfaces_=function(){return[]};Se.prototype.getClass=function(){return Se};var is=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var r=arguments[0],n=arguments[1];this._coord=r,this._edges=n,this._label=new et(0,m.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();){var n=r.next();if(n.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(r){},t.prototype.computeMergedLocation=function(r,n){var a=m.NONE;if(a=this._label.getLocation(n),!r.isNull(n)){var s=r.getLocation(n);a!==m.BOUNDARY&&(a=s)}return a},t.prototype.setLabel=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];this._label===null?this._label=new et(r,n):this._label.setLocation(r,n)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var r=this;if(arguments[0]instanceof t){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof et)for(var a=arguments[0],s=0;s<2;s++){var f=r.computeMergedLocation(a,s),o=r._label.getLocation(s);o===m.NONE&&r._label.setLocation(s,f)}},t.prototype.add=function(r){this._edges.insert(r),r.setNode(this)},t.prototype.setLabelBoundary=function(r){if(this._label===null)return null;var n=m.NONE;this._label!==null&&(n=this._label.getLocation(r));var a=null;switch(n){case m.BOUNDARY:a=m.INTERIOR;break;case m.INTERIOR:a=m.BOUNDARY;break;default:a=m.BOUNDARY;break}this._label.setLocation(r,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Se),fn=function(){this.nodeMap=new jt,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};fn.prototype.find=function(e){return this.nodeMap.get(e)};fn.prototype.addNode=function(){if(arguments[0]instanceof v){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof is){var r=arguments[0],n=this.nodeMap.get(r.getCoordinate());return n===null?(this.nodeMap.put(r.getCoordinate(),r),r):(n.mergeLabel(r),n)}};fn.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};fn.prototype.iterator=function(){return this.nodeMap.values().iterator()};fn.prototype.values=function(){return this.nodeMap.values()};fn.prototype.getBoundaryNodes=function(e){for(var t=new b,r=this.iterator();r.hasNext();){var n=r.next();n.getLabel().getLocation(e)===m.BOUNDARY&&t.add(n)}return t};fn.prototype.add=function(e){var t=e.getCoordinate(),r=this.addNode(t);r.add(e)};fn.prototype.interfaces_=function(){return[]};fn.prototype.getClass=function(){return fn};var it=function(){},yo={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};it.prototype.interfaces_=function(){return[]};it.prototype.getClass=function(){return it};it.isNorthern=function(e){return e===it.NE||e===it.NW};it.isOpposite=function(e,t){if(e===t)return!1;var r=(e-t+4)%4;return r===2};it.commonHalfPlane=function(e,t){if(e===t)return e;var r=(e-t+4)%4;if(r===2)return-1;var n=e<t?e:t,a=e>t?e:t;return n===0&&a===3?3:n};it.isInHalfPlane=function(e,t){return t===it.SE?e===it.SE||e===it.SW:e===t||e===t+1};it.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new ct("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?it.NE:it.SE:t>=0?it.NW:it.SW}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var r=arguments[0],n=arguments[1];if(n.x===r.x&&n.y===r.y)throw new ct("Cannot compute the quadrant for two identical points "+r);return n.x>=r.x?n.y>=r.y?it.NE:it.SE:n.y>=r.y?it.NW:it.SW}};yo.NE.get=function(){return 0};yo.NW.get=function(){return 1};yo.SW.get=function(){return 2};yo.SE.get=function(){return 3};Object.defineProperties(it,yo);var Kt=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],a=null;this._edge=t,this.init(r,n),this._label=a}else if(arguments.length===4){var s=arguments[0],f=arguments[1],o=arguments[2],x=arguments[3];this._edge=s,this.init(f,o),this._label=x}};Kt.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:O.computeOrientation(e._p0,e._p1,this._p1)};Kt.prototype.getDy=function(){return this._dy};Kt.prototype.getCoordinate=function(){return this._p0};Kt.prototype.setNode=function(e){this._node=e};Kt.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),a=r.substring(n+1);e.print("  "+a+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Kt.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};Kt.prototype.getDirectedCoordinate=function(){return this._p1};Kt.prototype.getDx=function(){return this._dx};Kt.prototype.getLabel=function(){return this._label};Kt.prototype.getEdge=function(){return this._edge};Kt.prototype.getQuadrant=function(){return this._quadrant};Kt.prototype.getNode=function(){return this._node};Kt.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),r=t.lastIndexOf("."),n=t.substring(r+1);return"  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};Kt.prototype.computeLabel=function(e){};Kt.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=it.quadrant(this._dx,this._dy),U.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Kt.prototype.interfaces_=function(){return[ke]};Kt.prototype.getClass=function(){return Kt};var bs=function(e){function t(){var r=arguments[0],n=arguments[1];if(e.call(this,r),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var a=r.getNumPoints()-1;this.init(r.getCoordinate(a),r.getCoordinate(a-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(r){return this._depth[r]},t.prototype.setVisited=function(r){this._isVisited=r},t.prototype.computeDirectedLabel=function(){this._label=new et(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(r,n){if(this._depth[r]!==-999&&this._depth[r]!==n)throw new Jn("assigned depths do not match",this.getCoordinate());this._depth[r]=n},t.prototype.isInteriorAreaEdge=function(){for(var r=this,n=!0,a=0;a<2;a++)r._label.isArea(a)&&r._label.getLocation(a,w.LEFT)===m.INTERIOR&&r._label.getLocation(a,w.RIGHT)===m.INTERIOR||(n=!1);return n},t.prototype.setNextMin=function(r){this._nextMin=r},t.prototype.print=function(r){e.prototype.print.call(this,r),r.print(" "+this._depth[w.LEFT]+"/"+this._depth[w.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},t.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},t.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),n=!this._label.isArea(0)||this._label.allPositionsEqual(0,m.EXTERIOR),a=!this._label.isArea(1)||this._label.allPositionsEqual(1,m.EXTERIOR);return r&&n&&a},t.prototype.setEdgeRing=function(r){this._edgeRing=r},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},t.prototype.setInResult=function(r){this._isInResult=r},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)},t.prototype.setSym=function(r){this._sym=r},t.prototype.setVisitedEdge=function(r){this.setVisited(r),this._sym.setVisited(r)},t.prototype.setEdgeDepths=function(r,n){var a=this.getEdge().getDepthDelta();this._isForward||(a=-a);var s=1;r===w.LEFT&&(s=-1);var f=w.opposite(r),o=a*s,x=n+o;this.setDepth(r,n),this.setDepth(f,x)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(r){this._next=r},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(r,n){return r===m.EXTERIOR&&n===m.INTERIOR?1:r===m.INTERIOR&&n===m.EXTERIOR?-1:0},t}(Kt),xi=function(){};xi.prototype.createNode=function(e){return new is(e,null)};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};var ht=function(){if(this._edges=new b,this._nodes=null,this._edgeEndList=new b,arguments.length===0)this._nodes=new fn(new xi);else if(arguments.length===1){var e=arguments[0];this._nodes=new fn(e)}};ht.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var r=0;r<this._edges.size();r++){e.println("edge "+r+":");var n=t._edges.get(r);n.print(e),n.eiList.print(e)}};ht.prototype.find=function(e){return this._nodes.find(e)};ht.prototype.addNode=function(){if(arguments[0]instanceof is){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof v){var t=arguments[0];return this._nodes.addNode(t)}};ht.prototype.getNodeIterator=function(){return this._nodes.iterator()};ht.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};ht.prototype.debugPrintln=function(e){Ut.out.println(e)};ht.prototype.isBoundaryNode=function(e,t){var r=this._nodes.find(t);if(r===null)return!1;var n=r.getLabel();return n!==null&&n.getLocation(e)===m.BOUNDARY};ht.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};ht.prototype.matchInSameDirection=function(e,t,r,n){return e.equals(r)?O.computeOrientation(e,t,n)===O.COLLINEAR&&it.quadrant(e,t)===it.quadrant(r,n):!1};ht.prototype.getEdgeEnds=function(){return this._edgeEndList};ht.prototype.debugPrint=function(e){Ut.out.print(e)};ht.prototype.getEdgeIterator=function(){return this._edges.iterator()};ht.prototype.findEdgeInSameDirection=function(e,t){for(var r=this,n=0;n<this._edges.size();n++){var a=r._edges.get(n),s=a.getCoordinates();if(r.matchInSameDirection(e,t,s[0],s[1])||r.matchInSameDirection(e,t,s[s.length-1],s[s.length-2]))return a}return null};ht.prototype.insertEdge=function(e){this._edges.add(e)};ht.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var r=t.next();if(r.getEdge()===e)return r}return null};ht.prototype.addEdges=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next();t._edges.add(n);var a=new bs(n,!0),s=new bs(n,!1);a.setSym(s),s.setSym(a),t.add(a),t.add(s)}};ht.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};ht.prototype.getNodes=function(){return this._nodes.values()};ht.prototype.findEdge=function(e,t){for(var r=this,n=0;n<this._edges.size();n++){var a=r._edges.get(n),s=a.getCoordinates();if(e.equals(s[0])&&t.equals(s[1]))return a}return null};ht.prototype.interfaces_=function(){return[]};ht.prototype.getClass=function(){return ht};ht.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var r=t.next();r.getEdges().linkResultDirectedEdges()}};var ve=function(){this._geometryFactory=null,this._shellList=new b;var e=arguments[0];this._geometryFactory=e};ve.prototype.sortShellsAndHoles=function(e,t,r){for(var n=e.iterator();n.hasNext();){var a=n.next();a.isHole()?r.add(a):t.add(a)}};ve.prototype.computePolygons=function(e){for(var t=this,r=new b,n=e.iterator();n.hasNext();){var a=n.next(),s=a.toPolygon(t._geometryFactory);r.add(s)}return r};ve.prototype.placeFreeHoles=function(e,t){for(var r=this,n=t.iterator();n.hasNext();){var a=n.next();if(a.getShell()===null){var s=r.findEdgeRingContaining(a,e);if(s===null)throw new Jn("unable to assign hole to a shell",a.getCoordinate(0));a.setShell(s)}}};ve.prototype.buildMinimalEdgeRings=function(e,t,r){for(var n=this,a=new b,s=e.iterator();s.hasNext();){var f=s.next();if(f.getMaxNodeDegree()>2){f.linkDirectedEdgesForMinimalEdgeRings();var o=f.buildMinimalRings(),x=n.findShell(o);x!==null?(n.placePolygonHoles(x,o),t.add(x)):r.addAll(o)}else a.add(f)}return a};ve.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var r=t.next();if(r.containsPoint(e))return!0}return!1};ve.prototype.buildMaximalEdgeRings=function(e){for(var t=this,r=new b,n=e.iterator();n.hasNext();){var a=n.next();if(a.isInResult()&&a.getLabel().isArea()&&a.getEdgeRing()===null){var s=new Tc(a,t._geometryFactory);r.add(s),s.setInResult()}}return r};ve.prototype.placePolygonHoles=function(e,t){for(var r=t.iterator();r.hasNext();){var n=r.next();n.isHole()&&n.setShell(e)}};ve.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};ve.prototype.findEdgeRingContaining=function(e,t){for(var r=e.getLinearRing(),n=r.getEnvelopeInternal(),a=r.getCoordinateN(0),s=null,f=null,o=t.iterator();o.hasNext();){var x=o.next(),C=x.getLinearRing(),P=C.getEnvelopeInternal();s!==null&&(f=s.getLinearRing().getEnvelopeInternal());var ge=!1;P.contains(n)&&O.isPointInRing(a,C.getCoordinates())&&(ge=!0),ge&&(s===null||f.contains(P))&&(s=x)}return s};ve.prototype.findShell=function(e){for(var t=0,r=null,n=e.iterator();n.hasNext();){var a=n.next();a.isHole()||(r=a,t++)}return U.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),r};ve.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],r=arguments[1];ht.linkResultDirectedEdges(r);var n=this.buildMaximalEdgeRings(t),a=new b,s=this.buildMinimalEdgeRings(n,this._shellList,a);this.sortShellsAndHoles(s,this._shellList,a),this.placeFreeHoles(this._shellList,a)}};ve.prototype.interfaces_=function(){return[]};ve.prototype.getClass=function(){return ve};var Si=function(){};Si.prototype.getBounds=function(){};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};var Ye=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};Ye.prototype.getItem=function(){return this._item};Ye.prototype.getBounds=function(){return this._bounds};Ye.prototype.interfaces_=function(){return[Si,Ge]};Ye.prototype.getClass=function(){return Ye};var Zn=function(){this._size=null,this._items=null,this._size=0,this._items=new b,this._items.add(null)};Zn.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Zn.prototype.size=function(){return this._size};Zn.prototype.reorder=function(e){for(var t=this,r=null,n=this._items.get(e);e*2<=this._size&&(r=e*2,r!==t._size&&t._items.get(r+1).compareTo(t._items.get(r))<0&&r++,t._items.get(r).compareTo(n)<0);e=r)t._items.set(e,t._items.get(r));this._items.set(e,n)};Zn.prototype.clear=function(){this._size=0,this._items.clear()};Zn.prototype.isEmpty=function(){return this._size===0};Zn.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(r/2)))<0;r/=2)t._items.set(r,t._items.get(Math.trunc(r/2)));this._items.set(r,e)};Zn.prototype.interfaces_=function(){return[]};Zn.prototype.getClass=function(){return Zn};var lr=function(){};lr.prototype.visitItem=function(e){};lr.prototype.interfaces_=function(){return[]};lr.prototype.getClass=function(){return lr};var Qr=function(){};Qr.prototype.insert=function(e,t){};Qr.prototype.remove=function(e,t){};Qr.prototype.query=function(){};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};var Pt=function(){if(this._childBoundables=new b,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},yu={serialVersionUID:{configurable:!0}};Pt.prototype.getLevel=function(){return this._level};Pt.prototype.size=function(){return this._childBoundables.size()};Pt.prototype.getChildBoundables=function(){return this._childBoundables};Pt.prototype.addChildBoundable=function(e){U.isTrue(this._bounds===null),this._childBoundables.add(e)};Pt.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Pt.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Pt.prototype.interfaces_=function(){return[Si,Ge]};Pt.prototype.getClass=function(){return Pt};yu.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Pt,yu);var He=function(){};He.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};He.min=function(e){return He.sort(e),e.get(0)};He.sort=function(e,t){var r=e.toArray();t?Nr.sort(r,t):Nr.sort(r);for(var n=e.iterator(),a=0,s=r.length;a<s;a++)n.next(),n.set(r[a])};He.singletonList=function(e){var t=new b;return t.add(e),t};var Ct=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],r=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=r,this._distance=this.distance()};Ct.prototype.expandToQueue=function(e,t){var r=Ct.isComposite(this._boundable1),n=Ct.isComposite(this._boundable2);if(r&&n)return Ct.area(this._boundable1)>Ct.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(r)return this.expand(this._boundable1,this._boundable2,e,t),null;if(n)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new ct("neither boundable is composite")};Ct.prototype.isLeaves=function(){return!(Ct.isComposite(this._boundable1)||Ct.isComposite(this._boundable2))};Ct.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};Ct.prototype.expand=function(e,t,r,n){for(var a=this,s=e.getChildBoundables(),f=s.iterator();f.hasNext();){var o=f.next(),x=new Ct(o,t,a._itemDistance);x.getDistance()<n&&r.add(x)}};Ct.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Ct.prototype.getDistance=function(){return this._distance};Ct.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Ct.prototype.interfaces_=function(){return[ke]};Ct.prototype.getClass=function(){return Ct};Ct.area=function(e){return e.getBounds().getArea()};Ct.isComposite=function(e){return e instanceof Pt};var Tt=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new b,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var r=arguments[0];U.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},os={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Tt.prototype.getNodeCapacity=function(){return this._nodeCapacity};Tt.prototype.lastNode=function(e){return e.get(e.size()-1)};Tt.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],r=0,n=t.getChildBoundables().iterator();n.hasNext();){var a=n.next();a instanceof Pt?r+=e.size(a):a instanceof Ye&&(r+=1)}return r}};Tt.prototype.removeItem=function(e,t){for(var r=null,n=e.getChildBoundables().iterator();n.hasNext();){var a=n.next();a instanceof Ye&&a.getItem()===t&&(r=a)}return r!==null?(e.getChildBoundables().remove(r),!0):!1};Tt.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new b:t}else if(arguments.length===1){for(var r=arguments[0],n=new b,a=r.getChildBoundables().iterator();a.hasNext();){var s=a.next();if(s instanceof Pt){var f=e.itemsTree(s);f!==null&&n.add(f)}else s instanceof Ye?n.add(s.getItem()):U.shouldNeverReachHere()}return n.size()<=0?null:n}};Tt.prototype.insert=function(e,t){U.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ye(e,t))};Tt.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],r=new b;return this.boundablesAtLevel(t,this._root,r),r}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];if(U.isTrue(n>-2),a.getLevel()===n)return s.add(a),null;for(var f=a.getChildBoundables().iterator();f.hasNext();){var o=f.next();o instanceof Pt?e.boundablesAtLevel(n,o,s):(U.isTrue(o instanceof Ye),n===-1&&s.add(o))}return null}};Tt.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var r=new b;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,r),r}else if(arguments.length===2){var n=arguments[0],a=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,a)}else if(arguments.length===3){if(G(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt)for(var s=arguments[0],f=arguments[1],o=arguments[2],x=f.getChildBoundables(),C=0;C<x.size();C++){var P=x.get(C);e.getIntersectsOp().intersects(P.getBounds(),s)&&(P instanceof Pt?e.query(s,P,o):P instanceof Ye?o.visitItem(P.getItem()):U.shouldNeverReachHere())}else if(G(arguments[2],Ue)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt)for(var ge=arguments[0],nt=arguments[1],ze=arguments[2],Bt=nt.getChildBoundables(),qr=0;qr<Bt.size();qr++){var _n=Bt.get(qr);e.getIntersectsOp().intersects(_n.getBounds(),ge)&&(_n instanceof Pt?e.query(ge,_n,ze):_n instanceof Ye?ze.add(_n.getItem()):U.shouldNeverReachHere())}}};Tt.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Tt.prototype.getRoot=function(){return this.build(),this._root};Tt.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,r):!1}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2],f=this.removeItem(a,s);if(f)return!0;for(var o=null,x=a.getChildBoundables().iterator();x.hasNext();){var C=x.next();if(e.getIntersectsOp().intersects(C.getBounds(),n)&&C instanceof Pt&&(f=e.remove(n,C,s),f)){o=C;break}}return o!==null&&o.getChildBoundables().isEmpty()&&a.getChildBoundables().remove(o),f}};Tt.prototype.createHigherLevels=function(e,t){U.isTrue(!e.isEmpty());var r=this.createParentBoundables(e,t+1);return r.size()===1?r.get(0):this.createHigherLevels(r,t+1)};Tt.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],r=0,n=t.getChildBoundables().iterator();n.hasNext();){var a=n.next();if(a instanceof Pt){var s=e.depth(a);s>r&&(r=s)}}return r+1}};Tt.prototype.createParentBoundables=function(e,t){var r=this;U.isTrue(!e.isEmpty());var n=new b;n.add(this.createNode(t));var a=new b(e);He.sort(a,this.getComparator());for(var s=a.iterator();s.hasNext();){var f=s.next();r.lastNode(n).getChildBoundables().size()===r.getNodeCapacity()&&n.add(r.createNode(t)),r.lastNode(n).addChildBoundable(f)}return n};Tt.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Tt.prototype.interfaces_=function(){return[Ge]};Tt.prototype.getClass=function(){return Tt};Tt.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};os.IntersectsOp.get=function(){return Mc};os.serialVersionUID.get=function(){return-3886435814360241e3};os.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Tt,os);var Mc=function(){},wi=function(){};wi.prototype.distance=function(e,t){};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};var mu=function(e){function t(n){n=n||t.DEFAULT_NODE_CAPACITY,e.call(this,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(n,a){var s=this;U.isTrue(n.length>0);for(var f=new b,o=0;o<n.length;o++)f.addAll(s.createParentBoundablesFromVerticalSlice(n[o],a));return f},t.prototype.createNode=function(n){return new wa(n)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];if(n.isNull())return null;e.prototype.insert.call(this,n,a)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(n,a){for(var s=Math.trunc(Math.ceil(n.size()/a)),f=new Array(a).fill(null),o=n.iterator(),x=0;x<a;x++){f[x]=new b;for(var C=0;o.hasNext()&&C<s;){var P=o.next();f[x].add(P),C++}}return f},t.prototype.query=function(){if(arguments.length===1){var n=arguments[0];return e.prototype.query.call(this,n)}else if(arguments.length===2){var a=arguments[0],s=arguments[1];e.prototype.query.call(this,a,s)}else if(arguments.length===3){if(G(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt){var f=arguments[0],o=arguments[1],x=arguments[2];e.prototype.query.call(this,f,o,x)}else if(G(arguments[2],Ue)&&arguments[0]instanceof Object&&arguments[1]instanceof Pt){var C=arguments[0],P=arguments[1],ge=arguments[2];e.prototype.query.call(this,C,P,ge)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(n,a){return e.prototype.createParentBoundables.call(this,n,a)},t.prototype.remove=function(){if(arguments.length===2){var n=arguments[0],a=arguments[1];return e.prototype.remove.call(this,n,a)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(n,a){U.isTrue(!n.isEmpty());var s=Math.trunc(Math.ceil(n.size()/this.getNodeCapacity())),f=new b(n);He.sort(f,t.xComparator);var o=this.verticalSlices(f,Math.trunc(Math.ceil(Math.sqrt(s))));return this.createParentBoundablesFromVerticalSlices(o,a)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(G(arguments[0],wi)){var n=arguments[0],a=new Ct(this.getRoot(),this.getRoot(),n);return this.nearestNeighbour(a)}else if(arguments[0]instanceof Ct){var s=arguments[0];return this.nearestNeighbour(s,z.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&G(arguments[1],wi)){var f=arguments[0],o=arguments[1],x=new Ct(this.getRoot(),f.getRoot(),o);return this.nearestNeighbour(x)}else if(arguments[0]instanceof Ct&&typeof arguments[1]=="number"){var C=arguments[0],P=arguments[1],ge=P,nt=null,ze=new Zn;for(ze.add(C);!ze.isEmpty()&&ge>0;){var Bt=ze.poll(),qr=Bt.getDistance();if(qr>=ge)break;Bt.isLeaves()?(ge=qr,nt=Bt):Bt.expandToQueue(ze,ge)}return[nt.getBoundable(0).getItem(),nt.getBoundable(1).getItem()]}}else if(arguments.length===3){var _n=arguments[0],Fn=arguments[1],tl=arguments[2],Io=new Ye(_n,Fn),Co=new Ct(this.getRoot(),Io,tl);return this.nearestNeighbour(Co)[0]}},t.prototype.interfaces_=function(){return[Qr,Ge]},t.prototype.getClass=function(){return t},t.centreX=function(n){return t.avg(n.getMinX(),n.getMaxX())},t.avg=function(n,a){return(n+a)/2},t.centreY=function(n){return t.avg(n.getMinY(),n.getMaxY())},r.STRtreeNode.get=function(){return wa},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[vi]},compare:function(n,a){return e.compareDoubles(t.centreX(n.getBounds()),t.centreX(a.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[vi]},compare:function(n,a){return e.compareDoubles(t.centreY(n.getBounds()),t.centreY(a.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(n,a){return n.intersects(a)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,r),t}(Tt),wa=function(e){function t(){var r=arguments[0];e.call(this,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var r=null,n=this.getChildBoundables().iterator();n.hasNext();){var a=n.next();r===null?r=new T(a.getBounds()):r.expandToInclude(a.getBounds())}return r},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Pt),se=function(){};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};se.relativeSign=function(e,t){return e<t?-1:e>t?1:0};se.compare=function(e,t,r){if(t.equals2D(r))return 0;var n=se.relativeSign(t.x,r.x),a=se.relativeSign(t.y,r.y);switch(e){case 0:return se.compareValue(n,a);case 1:return se.compareValue(a,n);case 2:return se.compareValue(a,-n);case 3:return se.compareValue(-n,a);case 4:return se.compareValue(-n,-a);case 5:return se.compareValue(-a,-n);case 6:return se.compareValue(-a,n);case 7:return se.compareValue(n,-a)}return U.shouldNeverReachHere("invalid octant value"),0};se.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var cr=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this._segString=e,this.coord=new v(t),this.segmentIndex=r,this._segmentOctant=n,this._isInterior=!t.equals2D(e.getCoordinate(r))};cr.prototype.getCoordinate=function(){return this.coord};cr.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};cr.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:se.compare(this._segmentOctant,this.coord,t.coord)};cr.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};cr.prototype.isInterior=function(){return this._isInterior};cr.prototype.interfaces_=function(){return[ke]};cr.prototype.getClass=function(){return cr};var ie=function(){this._nodeMap=new jt,this._edge=null;var e=arguments[0];this._edge=e};ie.prototype.getSplitCoordinates=function(){var e=this,t=new po;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var a=r.next();e.addEdgeCoordinates(n,a,t),n=a}return t.toCoordinateArray()};ie.prototype.addCollapsedNodes=function(){var e=this,t=new b;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var r=t.iterator();r.hasNext();){var n=r.next().intValue();e.add(e._edge.getCoordinate(n),n)}};ie.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};ie.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,r=0;r<this._edge.size()-2;r++){var n=t._edge.getCoordinate(r),a=t._edge.getCoordinate(r+2);n.equals2D(a)&&e.add(new sn(r+1))}};ie.prototype.addEdgeCoordinates=function(e,t,r){var n=this,a=this._edge.getCoordinate(t.segmentIndex),s=t.isInterior()||!t.coord.equals2D(a);r.add(new v(e.coord),!1);for(var f=e.segmentIndex+1;f<=t.segmentIndex;f++)r.add(n._edge.getCoordinate(f));s&&r.add(new v(t.coord))};ie.prototype.iterator=function(){return this._nodeMap.values().iterator()};ie.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),n=r.next();r.hasNext();){var a=r.next(),s=t.createSplitEdge(n,a);e.add(s),n=a}};ie.prototype.findCollapseIndex=function(e,t,r){if(!e.coord.equals2D(t.coord))return!1;var n=t.segmentIndex-e.segmentIndex;return t.isInterior()||n--,n===1?(r[0]=e.segmentIndex+1,!0):!1};ie.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,r=new Array(1).fill(null),n=this.iterator(),a=n.next();n.hasNext();){var s=n.next(),f=t.findCollapseIndex(a,s,r);f&&e.add(new sn(r[0])),a=s}};ie.prototype.getEdge=function(){return this._edge};ie.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};ie.prototype.createSplitEdge=function(e,t){var r=this,n=t.segmentIndex-e.segmentIndex+2,a=this._edge.getCoordinate(t.segmentIndex),s=t.isInterior()||!t.coord.equals2D(a);s||n--;var f=new Array(n).fill(null),o=0;f[o++]=new v(e.coord);for(var x=e.segmentIndex+1;x<=t.segmentIndex;x++)f[o++]=r._edge.getCoordinate(x);return s&&(f[o]=new v(t.coord)),new It(f,this._edge.getData())};ie.prototype.add=function(e,t){var r=new cr(this._edge,e,t,this._edge.getSegmentOctant(t)),n=this._nodeMap.get(r);return n!==null?(U.isTrue(n.coord.equals2D(e),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(r,r),r)};ie.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),r=e.get(0),n=r.getCoordinate(0);if(!n.equals2D(t[0]))throw new Kn("bad split edge start point at "+n);var a=e.get(e.size()-1),s=a.getCoordinates(),f=s[s.length-1];if(!f.equals2D(t[t.length-1]))throw new Kn("bad split edge end point at "+f)};ie.prototype.interfaces_=function(){return[]};ie.prototype.getClass=function(){return ie};var Jr=function(){};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Jr.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new ct("Cannot compute the octant for point ( "+e+", "+t+" )");var r=Math.abs(e),n=Math.abs(t);return e>=0?t>=0?r>=n?0:1:r>=n?7:6:t>=0?r>=n?3:2:r>=n?4:5}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var a=arguments[0],s=arguments[1],f=s.x-a.x,o=s.y-a.y;if(f===0&&o===0)throw new ct("Cannot compute the octant for two identical points "+a);return Jr.octant(f,o)}};var Pn=function(){};Pn.prototype.getCoordinates=function(){};Pn.prototype.size=function(){};Pn.prototype.getCoordinate=function(e){};Pn.prototype.isClosed=function(){};Pn.prototype.setData=function(e){};Pn.prototype.getData=function(){};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};var oo=function(){};oo.prototype.addIntersection=function(e,t){};oo.prototype.interfaces_=function(){return[Pn]};oo.prototype.getClass=function(){return oo};var It=function(){this._nodeList=new ie(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};It.prototype.getCoordinates=function(){return this._pts};It.prototype.size=function(){return this._pts.length};It.prototype.getCoordinate=function(e){return this._pts[e]};It.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};It.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};It.prototype.setData=function(e){this._data=e};It.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Jr.octant(e,t)};It.prototype.getData=function(){return this._data};It.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var r=arguments[0],n=arguments[1],a=arguments[3],s=new v(r.getIntersection(a));this.addIntersection(s,n)}};It.prototype.toString=function(){return qe.toLineString(new yt(this._pts))};It.prototype.getNodeList=function(){return this._nodeList};It.prototype.addIntersectionNode=function(e,t){var r=t,n=r+1;if(n<this._pts.length){var a=this._pts[n];e.equals2D(a)&&(r=n)}var s=this._nodeList.add(e,r);return s};It.prototype.addIntersections=function(e,t,r){for(var n=this,a=0;a<e.getIntersectionNum();a++)n.addIntersection(e,t,r,a)};It.prototype.interfaces_=function(){return[oo]};It.prototype.getClass=function(){return It};It.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new b;return It.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var r=arguments[0],n=arguments[1],a=r.iterator();a.hasNext();){var s=a.next();s.getNodeList().addSplitEdges(n)}};var F=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new v,this.p1=new v;else if(arguments.length===1){var e=arguments[0];this.p0=new v(e.p0),this.p1=new v(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],r=arguments[1],n=arguments[2],a=arguments[3];this.p0=new v(t,r),this.p1=new v(n,a)}},_u={serialVersionUID:{configurable:!0}};F.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};F.prototype.orientationIndex=function(){if(arguments[0]instanceof F){var e=arguments[0],t=O.orientationIndex(this.p0,this.p1,e.p0),r=O.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&r>=0||t<=0&&r<=0?Math.max(t,r):0}else if(arguments[0]instanceof v){var n=arguments[0];return O.orientationIndex(this.p0,this.p1,n)}};F.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};F.prototype.isVertical=function(){return this.p0.x===this.p1.x};F.prototype.equals=function(e){if(!(e instanceof F))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};F.prototype.intersection=function(e){var t=new zr;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};F.prototype.project=function(){if(arguments[0]instanceof v){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new v(e);var t=this.projectionFactor(e),r=new v;return r.x=this.p0.x+t*(this.p1.x-this.p0.x),r.y=this.p0.y+t*(this.p1.y-this.p0.y),r}else if(arguments[0]instanceof F){var n=arguments[0],a=this.projectionFactor(n.p0),s=this.projectionFactor(n.p1);if(a>=1&&s>=1||a<=0&&s<=0)return null;var f=this.project(n.p0);a<0&&(f=this.p0),a>1&&(f=this.p1);var o=this.project(n.p1);return s<0&&(o=this.p0),s>1&&(o=this.p1),new F(f,o)}};F.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};F.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};F.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};F.prototype.distancePerpendicular=function(e){return O.distancePointLinePerpendicular(e,this.p0,this.p1)};F.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};F.prototype.midPoint=function(){return F.midPoint(this.p0,this.p1)};F.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,n=t*t+r*r;if(n<=0)return z.NaN;var a=((e.x-this.p0.x)*t+(e.y-this.p0.y)*r)/n;return a};F.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var r=new Array(2).fill(null),n=z.MAX_VALUE,a=null,s=this.closestPoint(e.p0);n=s.distance(e.p0),r[0]=s,r[1]=e.p0;var f=this.closestPoint(e.p1);a=f.distance(e.p1),a<n&&(n=a,r[0]=f,r[1]=e.p1);var o=e.closestPoint(this.p0);a=o.distance(this.p0),a<n&&(n=a,r[0]=this.p0,r[1]=o);var x=e.closestPoint(this.p1);return a=x.distance(this.p1),a<n&&(n=a,r[0]=this.p1,r[1]=x),r};F.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var r=this.p0.distance(e),n=this.p1.distance(e);return r<n?this.p0:this.p1};F.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};F.prototype.getLength=function(){return this.p0.distance(this.p1)};F.prototype.compareTo=function(e){var t=e,r=this.p0.compareTo(t.p0);return r!==0?r:this.p1.compareTo(t.p1)};F.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};F.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};F.prototype.lineIntersection=function(e){try{var t=Ve.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(r){if(!(r instanceof ki))throw r}finally{}return null};F.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};F.prototype.pointAlongOffset=function(e,t){var r=this.p0.x+e*(this.p1.x-this.p0.x),n=this.p0.y+e*(this.p1.y-this.p0.y),a=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,f=Math.sqrt(a*a+s*s),o=0,x=0;if(t!==0){if(f<=0)throw new Error("Cannot compute offset from zero-length line segment");o=t*a/f,x=t*s/f}var C=r-x,P=n+o,ge=new v(C,P);return ge};F.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=r.x,this.p1.y=r.y}};F.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||z.isNaN(t))&&(t=1),t};F.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};F.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};F.prototype.distance=function(){if(arguments[0]instanceof F){var e=arguments[0];return O.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof v){var t=arguments[0];return O.distancePointLine(t,this.p0,this.p1)}};F.prototype.pointAlong=function(e){var t=new v;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};F.prototype.hashCode=function(){var e=z.doubleToLongBits(this.p0.x);e^=z.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),r=z.doubleToLongBits(this.p1.x);r^=z.doubleToLongBits(this.p1.y)*31;var n=Math.trunc(r)^Math.trunc(r>>32);return t^n};F.prototype.interfaces_=function(){return[ke,Ge]};F.prototype.getClass=function(){return F};F.midPoint=function(e,t){return new v((e.x+t.x)/2,(e.y+t.y)/2)};_u.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(F,_u);var so=function(){this.tempEnv1=new T,this.tempEnv2=new T,this._overlapSeg1=new F,this._overlapSeg2=new F};so.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];e.getLineSegment(t,this._overlapSeg1),r.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var ye=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this._pts=e,this._start=t,this._end=r,this._context=n};ye.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};ye.prototype.computeSelect=function(e,t,r,n){var a=this._pts[t],s=this._pts[r];if(n.tempEnv1.init(a,s),r-t===1)return n.select(this,t),null;if(!e.intersects(n.tempEnv1))return null;var f=Math.trunc((t+r)/2);t<f&&this.computeSelect(e,t,f,n),f<r&&this.computeSelect(e,f,r,n)};ye.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),r=0,n=this._start;n<=this._end;n++)t[r++]=e._pts[n];return t};ye.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};ye.prototype.setId=function(e){this._id=e};ye.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};ye.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new T(e,t)}return this._env};ye.prototype.getEndIndex=function(){return this._end};ye.prototype.getStartIndex=function(){return this._start};ye.prototype.getContext=function(){return this._context};ye.prototype.getId=function(){return this._id};ye.prototype.computeOverlapsInternal=function(e,t,r,n,a,s){var f=this._pts[e],o=this._pts[t],x=r._pts[n],C=r._pts[a];if(t-e===1&&a-n===1)return s.overlap(this,e,r,n),null;if(s.tempEnv1.init(f,o),s.tempEnv2.init(x,C),!s.tempEnv1.intersects(s.tempEnv2))return null;var P=Math.trunc((e+t)/2),ge=Math.trunc((n+a)/2);e<P&&(n<ge&&this.computeOverlapsInternal(e,P,r,n,ge,s),ge<a&&this.computeOverlapsInternal(e,P,r,ge,a,s)),P<t&&(n<ge&&this.computeOverlapsInternal(P,t,r,n,ge,s),ge<a&&this.computeOverlapsInternal(P,t,r,ge,a,s))};ye.prototype.interfaces_=function(){return[]};ye.prototype.getClass=function(){return ye};var on=function(){};on.prototype.interfaces_=function(){return[]};on.prototype.getClass=function(){return on};on.getChainStartIndices=function(e){var t=0,r=new b;r.add(new sn(t));do{var n=on.findChainEnd(e,t);r.add(new sn(n)),t=n}while(t<e.length-1);var a=on.toIntArray(r);return a};on.findChainEnd=function(e,t){for(var r=t;r<e.length-1&&e[r].equals2D(e[r+1]);)r++;if(r>=e.length-1)return e.length-1;for(var n=it.quadrant(e[r],e[r+1]),a=t+1;a<e.length;){if(!e[a-1].equals2D(e[a])){var s=it.quadrant(e[a-1],e[a]);if(s!==n)break}a++}return a-1};on.getChains=function(){if(arguments.length===1){var e=arguments[0];return on.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],r=arguments[1],n=new b,a=on.getChainStartIndices(t),s=0;s<a.length-1;s++){var f=new ye(t,a[s],a[s+1],r);n.add(f)}return n}};on.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),r=0;r<t.length;r++)t[r]=e.get(r).intValue();return t};var br=function(){};br.prototype.computeNodes=function(e){};br.prototype.getNodedSubstrings=function(){};br.prototype.interfaces_=function(){return[]};br.prototype.getClass=function(){return br};var ao=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};ao.prototype.setSegmentIntersector=function(e){this._segInt=e};ao.prototype.interfaces_=function(){return[br]};ao.prototype.getClass=function(){return ao};var qs=function(e){function t(n){n?e.call(this,n):e.call(this),this._monoChains=new b,this._index=new mu,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return It.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(n){for(var a=this,s=on.getChains(n.getCoordinates(),n),f=s.iterator();f.hasNext();){var o=f.next();o.setId(a._idCounter++),a._index.insert(o.getEnvelope(),o),a._monoChains.add(o)}},t.prototype.computeNodes=function(n){var a=this;this._nodedSegStrings=n;for(var s=n.iterator();s.hasNext();)a.add(s.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var n=this,a=new La(this._segInt),s=this._monoChains.iterator();s.hasNext();)for(var f=s.next(),o=n._index.query(f.getEnvelope()),x=o.iterator();x.hasNext();){var C=x.next();if(C.getId()>f.getId()&&(f.computeOverlaps(C,a),n._nOverlaps++),n._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.SegmentOverlapAction.get=function(){return La},Object.defineProperties(t,r),t}(ao),La=function(e){function t(){e.call(this),this._si=null;var r=arguments[0];this._si=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var r=arguments[0],n=arguments[1],a=arguments[2],s=arguments[3],f=r.getContext(),o=a.getContext();this._si.processIntersections(f,n,o,s)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(so),Z=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(arguments.length===4){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3];this.setQuadrantSegments(a),this.setEndCapStyle(s),this.setJoinStyle(f),this.setMitreLimit(o)}}},nr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Z.prototype.getEndCapStyle=function(){return this._endCapStyle};Z.prototype.isSingleSided=function(){return this._isSingleSided};Z.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Z.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Z.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Z.JOIN_ROUND&&(this._quadrantSegments=Z.DEFAULT_QUADRANT_SEGMENTS)};Z.prototype.getJoinStyle=function(){return this._joinStyle};Z.prototype.setJoinStyle=function(e){this._joinStyle=e};Z.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Z.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Z.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Z.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Z.prototype.getMitreLimit=function(){return this._mitreLimit};Z.prototype.setMitreLimit=function(e){this._mitreLimit=e};Z.prototype.setSingleSided=function(e){this._isSingleSided=e};Z.prototype.interfaces_=function(){return[]};Z.prototype.getClass=function(){return Z};Z.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};nr.CAP_ROUND.get=function(){return 1};nr.CAP_FLAT.get=function(){return 2};nr.CAP_SQUARE.get=function(){return 3};nr.JOIN_ROUND.get=function(){return 1};nr.JOIN_MITRE.get=function(){return 2};nr.JOIN_BEVEL.get=function(){return 3};nr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};nr.DEFAULT_MITRE_LIMIT.get=function(){return 5};nr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Z,nr);var dt=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=O.COUNTERCLOCKWISE,this._inputLine=e||null},mo={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};dt.prototype.isDeletable=function(e,t,r,n){var a=this._inputLine[e],s=this._inputLine[t],f=this._inputLine[r];return!this.isConcave(a,s,f)||!this.isShallow(a,s,f,n)?!1:this.isShallowSampled(a,s,e,r,n)};dt.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,r=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(r),a=!1;n<this._inputLine.length;){var s=!1;e.isDeletable(t,r,n,e._distanceTol)&&(e._isDeleted[r]=dt.DELETE,s=!0,a=!0),s?t=n:t=r,r=e.findNextNonDeletedIndex(t),n=e.findNextNonDeletedIndex(r)}return a};dt.prototype.isShallowConcavity=function(e,t,r,n){var a=O.computeOrientation(e,t,r),s=a===this._angleOrientation;if(!s)return!1;var f=O.distancePointLine(t,e,r);return f<n};dt.prototype.isShallowSampled=function(e,t,r,n,a){var s=this,f=Math.trunc((n-r)/dt.NUM_PTS_TO_CHECK);f<=0&&(f=1);for(var o=r;o<n;o+=f)if(!s.isShallow(e,t,s._inputLine[o],a))return!1;return!0};dt.prototype.isConcave=function(e,t,r){var n=O.computeOrientation(e,t,r),a=n===this._angleOrientation;return a};dt.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=O.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var r=!1;do r=t.deleteShallowConcavities();while(r);return this.collapseLine()};dt.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===dt.DELETE;)t++;return t};dt.prototype.isShallow=function(e,t,r,n){var a=O.distancePointLine(t,e,r);return a<n};dt.prototype.collapseLine=function(){for(var e=this,t=new po,r=0;r<this._inputLine.length;r++)e._isDeleted[r]!==dt.DELETE&&t.add(e._inputLine[r]);return t.toCoordinateArray()};dt.prototype.interfaces_=function(){return[]};dt.prototype.getClass=function(){return dt};dt.simplify=function(e,t){var r=new dt(e);return r.simplify(t)};mo.INIT.get=function(){return 0};mo.DELETE.get=function(){return 1};mo.KEEP.get=function(){return 1};mo.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(dt,mo);var we=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new b},Eu={COORDINATE_ARRAY_TYPE:{configurable:!0}};we.prototype.getCoordinates=function(){var e=this._ptList.toArray(we.COORDINATE_ARRAY_TYPE);return e};we.prototype.setPrecisionModel=function(e){this._precisionModel=e};we.prototype.addPt=function(e){var t=new v(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};we.prototype.revere=function(){};we.prototype.addPts=function(e,t){var r=this;if(t)for(var n=0;n<e.length;n++)r.addPt(e[n]);else for(var a=e.length-1;a>=0;a--)r.addPt(e[a])};we.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),r=e.distance(t);return r<this._minimimVertexDistance};we.prototype.toString=function(){var e=new H,t=e.createLineString(this.getCoordinates());return t.toString()};we.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new v(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};we.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};Eu.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(we,Eu);var K=function(){},ci={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};K.prototype.interfaces_=function(){return[]};K.prototype.getClass=function(){return K};K.toDegrees=function(e){return e*180/Math.PI};K.normalize=function(e){for(;e>Math.PI;)e-=K.PI_TIMES_2;for(;e<=-Math.PI;)e+=K.PI_TIMES_2;return e};K.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=r.x-t.x,a=r.y-t.y;return Math.atan2(a,n)}};K.isAcute=function(e,t,r){var n=e.x-t.x,a=e.y-t.y,s=r.x-t.x,f=r.y-t.y,o=n*s+a*f;return o>0};K.isObtuse=function(e,t,r){var n=e.x-t.x,a=e.y-t.y,s=r.x-t.x,f=r.y-t.y,o=n*s+a*f;return o<0};K.interiorAngle=function(e,t,r){var n=K.angle(t,e),a=K.angle(t,r);return Math.abs(a-n)};K.normalizePositive=function(e){if(e<0){for(;e<0;)e+=K.PI_TIMES_2;e>=K.PI_TIMES_2&&(e=0)}else{for(;e>=K.PI_TIMES_2;)e-=K.PI_TIMES_2;e<0&&(e=0)}return e};K.angleBetween=function(e,t,r){var n=K.angle(t,e),a=K.angle(t,r);return K.diff(n,a)};K.diff=function(e,t){var r=null;return e<t?r=t-e:r=e-t,r>Math.PI&&(r=2*Math.PI-r),r};K.toRadians=function(e){return e*Math.PI/180};K.getTurn=function(e,t){var r=Math.sin(t-e);return r>0?K.COUNTERCLOCKWISE:r<0?K.CLOCKWISE:K.NONE};K.angleBetweenOriented=function(e,t,r){var n=K.angle(t,e),a=K.angle(t,r),s=a-n;return s<=-Math.PI?s+K.PI_TIMES_2:s>Math.PI?s-K.PI_TIMES_2:s};ci.PI_TIMES_2.get=function(){return 2*Math.PI};ci.PI_OVER_2.get=function(){return Math.PI/2};ci.PI_OVER_4.get=function(){return Math.PI/4};ci.COUNTERCLOCKWISE.get=function(){return O.COUNTERCLOCKWISE};ci.CLOCKWISE.get=function(){return O.CLOCKWISE};ci.NONE.get=function(){return O.COLLINEAR};Object.defineProperties(K,ci);var lt=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new F,this._seg1=new F,this._offset0=new F,this._offset1=new F,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=t,this._bufParams=r,this._li=new zr,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===Z.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},_o={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};lt.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=O.computeOrientation(this._s0,this._s1,this._s2),n=r===O.CLOCKWISE&&this._side===w.LEFT||r===O.COUNTERCLOCKWISE&&this._side===w.RIGHT;r===0?this.addCollinear(t):n?this.addOutsideTurn(r,t):this.addInsideTurn(r,t)};lt.prototype.addLineEndCap=function(e,t){var r=new F(e,t),n=new F;this.computeOffsetSegment(r,w.LEFT,this._distance,n);var a=new F;this.computeOffsetSegment(r,w.RIGHT,this._distance,a);var s=t.x-e.x,f=t.y-e.y,o=Math.atan2(f,s);switch(this._bufParams.getEndCapStyle()){case Z.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(t,o+Math.PI/2,o-Math.PI/2,O.CLOCKWISE,this._distance),this._segList.addPt(a.p1);break;case Z.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(a.p1);break;case Z.CAP_SQUARE:var x=new v;x.x=Math.abs(this._distance)*Math.cos(o),x.y=Math.abs(this._distance)*Math.sin(o);var C=new v(n.p1.x+x.x,n.p1.y+x.y),P=new v(a.p1.x+x.x,a.p1.y+x.y);this._segList.addPt(C),this._segList.addPt(P);break}};lt.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};lt.prototype.addMitreJoin=function(e,t,r,n){var a=!0,s=null;try{s=Ve.intersection(t.p0,t.p1,r.p0,r.p1);var f=n<=0?1:s.distance(e)/Math.abs(n);f>this._bufParams.getMitreLimit()&&(a=!1)}catch(o){if(o instanceof ki)s=new v(0,0),a=!1;else throw o}finally{}a?this._segList.addPt(s):this.addLimitedMitreJoin(t,r,n,this._bufParams.getMitreLimit())};lt.prototype.addFilletCorner=function(e,t,r,n,a){var s=t.x-e.x,f=t.y-e.y,o=Math.atan2(f,s),x=r.x-e.x,C=r.y-e.y,P=Math.atan2(C,x);n===O.CLOCKWISE?o<=P&&(o+=2*Math.PI):o>=P&&(o-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,o,P,n,a),this._segList.addPt(r)};lt.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Z.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Z.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};lt.prototype.createSquare=function(e){this._segList.addPt(new v(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new v(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new v(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new v(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};lt.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};lt.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};lt.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};lt.prototype.initSideSegments=function(e,t,r){this._s1=e,this._s2=t,this._side=r,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)};lt.prototype.addLimitedMitreJoin=function(e,t,r,n){var a=this._seg0.p1,s=K.angle(a,this._seg0.p0),f=K.angleBetweenOriented(this._seg0.p0,a,this._seg1.p1),o=f/2,x=K.normalize(s+o),C=K.normalize(x+Math.PI),P=n*r,ge=P*Math.abs(Math.sin(o)),nt=r-ge,ze=a.x+P*Math.cos(C),Bt=a.y+P*Math.sin(C),qr=new v(ze,Bt),_n=new F(a,qr),Fn=_n.pointAlongOffset(1,nt),tl=_n.pointAlongOffset(1,-nt);this._side===w.LEFT?(this._segList.addPt(Fn),this._segList.addPt(tl)):(this._segList.addPt(tl),this._segList.addPt(Fn))};lt.prototype.computeOffsetSegment=function(e,t,r,n){var a=t===w.LEFT?1:-1,s=e.p1.x-e.p0.x,f=e.p1.y-e.p0.y,o=Math.sqrt(s*s+f*f),x=a*r*s/o,C=a*r*f/o;n.p0.x=e.p0.x-C,n.p0.y=e.p0.y+x,n.p1.x=e.p1.x-C,n.p1.y=e.p1.y+x};lt.prototype.addFilletArc=function(e,t,r,n,a){var s=this,f=n===O.CLOCKWISE?-1:1,o=Math.abs(t-r),x=Math.trunc(o/this._filletAngleQuantum+.5);if(x<1)return null;for(var C=0,P=o/x,ge=C,nt=new v;ge<o;){var ze=t+f*ge;nt.x=e.x+a*Math.cos(ze),nt.y=e.y+a*Math.sin(ze),s._segList.addPt(nt),ge+=P}};lt.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new v((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var n=new v((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};lt.prototype.createCircle=function(e){var t=new v(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};lt.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};lt.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new we,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*lt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};lt.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Z.JOIN_BEVEL||this._bufParams.getJoinStyle()===Z.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,O.CLOCKWISE,this._distance))};lt.prototype.closeRing=function(){this._segList.closeRing()};lt.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};lt.prototype.interfaces_=function(){return[]};lt.prototype.getClass=function(){return lt};_o.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};_o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};_o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};_o.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(lt,_o);var le=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};le.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var r=t<0,n=Math.abs(t),a=this.getSegGen(n);e.length<=1?this.computePointCurve(e[0],a):this.computeOffsetCurve(e,r,a);var s=a.getCoordinates();return r&&W.reverse(s),s};le.prototype.computeSingleSidedBufferCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);if(t){r.addSegments(e,!0);var a=dt.simplify(e,-n),s=a.length-1;r.initSideSegments(a[s],a[s-1],w.LEFT),r.addFirstSegment();for(var f=s-2;f>=0;f--)r.addNextSegment(a[f],!0)}else{r.addSegments(e,!1);var o=dt.simplify(e,n),x=o.length-1;r.initSideSegments(o[0],o[1],w.LEFT),r.addFirstSegment();for(var C=2;C<=x;C++)r.addNextSegment(o[C],!0)}r.addLastSegment(),r.closeRing()};le.prototype.computeRingBufferCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);t===w.RIGHT&&(n=-n);var a=dt.simplify(e,n),s=a.length-1;r.initSideSegments(a[s-1],a[0],t);for(var f=1;f<=s;f++){var o=f!==1;r.addNextSegment(a[f],o)}r.closeRing()};le.prototype.computeLineBufferCurve=function(e,t){var r=this.simplifyTolerance(this._distance),n=dt.simplify(e,r),a=n.length-1;t.initSideSegments(n[0],n[1],w.LEFT);for(var s=2;s<=a;s++)t.addNextSegment(n[s],!0);t.addLastSegment(),t.addLineEndCap(n[a-1],n[a]);var f=dt.simplify(e,-r),o=f.length-1;t.initSideSegments(f[o],f[o-1],w.LEFT);for(var x=o-2;x>=0;x--)t.addNextSegment(f[x],!0);t.addLastSegment(),t.addLineEndCap(f[1],f[0]),t.closeRing()};le.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Z.CAP_ROUND:t.createCircle(e);break;case Z.CAP_SQUARE:t.createSquare(e);break}};le.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var r=Math.abs(t),n=this.getSegGen(r);if(e.length<=1)this.computePointCurve(e[0],n);else if(this._bufParams.isSingleSided()){var a=t<0;this.computeSingleSidedBufferCurve(e,a,n)}else this.computeLineBufferCurve(e,n);var s=n.getCoordinates();return s};le.prototype.getBufferParameters=function(){return this._bufParams};le.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};le.prototype.getRingCurve=function(e,t,r){if(this._distance=r,e.length<=2)return this.getLineCurve(e,r);if(r===0)return le.copyCoordinates(e);var n=this.getSegGen(r);return this.computeRingBufferCurve(e,t,n),n.getCoordinates()};le.prototype.computeOffsetCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);if(t){var a=dt.simplify(e,-n),s=a.length-1;r.initSideSegments(a[s],a[s-1],w.LEFT),r.addFirstSegment();for(var f=s-2;f>=0;f--)r.addNextSegment(a[f],!0)}else{var o=dt.simplify(e,n),x=o.length-1;r.initSideSegments(o[0],o[1],w.LEFT),r.addFirstSegment();for(var C=2;C<=x;C++)r.addNextSegment(o[C],!0)}r.addLastSegment()};le.prototype.getSegGen=function(e){return new lt(this._precisionModel,this._bufParams,e)};le.prototype.interfaces_=function(){return[]};le.prototype.getClass=function(){return le};le.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),r=0;r<t.length;r++)t[r]=new v(e[r]);return t};var Zr=function(){this._subgraphs=null,this._seg=new F,this._cga=new O;var e=arguments[0];this._subgraphs=e},Iu={DepthSegment:{configurable:!0}};Zr.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],r=new b,n=this._subgraphs.iterator();n.hasNext();){var a=n.next(),s=a.getEnvelope();t.y<s.getMinY()||t.y>s.getMaxY()||e.findStabbedSegments(t,a.getDirectedEdges(),r)}return r}else if(arguments.length===3){if(G(arguments[2],Ue)&&arguments[0]instanceof v&&arguments[1]instanceof bs)for(var f=arguments[0],o=arguments[1],x=arguments[2],C=o.getEdge().getCoordinates(),P=0;P<C.length-1;P++){e._seg.p0=C[P],e._seg.p1=C[P+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var ge=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(ge<f.x)&&!e._seg.isHorizontal()&&!(f.y<e._seg.p0.y||f.y>e._seg.p1.y)&&O.computeOrientation(e._seg.p0,e._seg.p1,f)!==O.RIGHT){var nt=o.getDepth(w.LEFT);e._seg.p0.equals(C[P])||(nt=o.getDepth(w.RIGHT));var ze=new Pr(e._seg,nt);x.add(ze)}}else if(G(arguments[2],Ue)&&arguments[0]instanceof v&&G(arguments[1],Ue))for(var Bt=arguments[0],qr=arguments[1],_n=arguments[2],Fn=qr.iterator();Fn.hasNext();){var tl=Fn.next();tl.isForward()&&e.findStabbedSegments(Bt,tl,_n)}}};Zr.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var r=He.min(t);return r._leftDepth};Zr.prototype.interfaces_=function(){return[]};Zr.prototype.getClass=function(){return Zr};Iu.DepthSegment.get=function(){return Pr};Object.defineProperties(Zr,Iu);var Pr=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new F(e),this._leftDepth=t};Pr.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(t._upwardSeg);return r!==0||(r=-1*t._upwardSeg.orientationIndex(this._upwardSeg),r!==0)?r:this._upwardSeg.compareTo(t._upwardSeg)};Pr.prototype.compareX=function(e,t){var r=e.p0.compareTo(t.p0);return r!==0?r:e.p1.compareTo(t.p1)};Pr.prototype.toString=function(){return this._upwardSeg.toString()};Pr.prototype.interfaces_=function(){return[ke]};Pr.prototype.getClass=function(){return Pr};var tt=function(e,t,r){this.p0=e||null,this.p1=t||null,this.p2=r||null};tt.prototype.area=function(){return tt.area(this.p0,this.p1,this.p2)};tt.prototype.signedArea=function(){return tt.signedArea(this.p0,this.p1,this.p2)};tt.prototype.interpolateZ=function(e){if(e===null)throw new ct("Supplied point is null.");return tt.interpolateZ(e,this.p0,this.p1,this.p2)};tt.prototype.longestSideLength=function(){return tt.longestSideLength(this.p0,this.p1,this.p2)};tt.prototype.isAcute=function(){return tt.isAcute(this.p0,this.p1,this.p2)};tt.prototype.circumcentre=function(){return tt.circumcentre(this.p0,this.p1,this.p2)};tt.prototype.area3D=function(){return tt.area3D(this.p0,this.p1,this.p2)};tt.prototype.centroid=function(){return tt.centroid(this.p0,this.p1,this.p2)};tt.prototype.inCentre=function(){return tt.inCentre(this.p0,this.p1,this.p2)};tt.prototype.interfaces_=function(){return[]};tt.prototype.getClass=function(){return tt};tt.area=function(e,t,r){return Math.abs(((r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y))/2)};tt.signedArea=function(e,t,r){return((r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y))/2};tt.det=function(e,t,r,n){return e*n-t*r};tt.interpolateZ=function(e,t,r,n){var a=t.x,s=t.y,f=r.x-a,o=n.x-a,x=r.y-s,C=n.y-s,P=f*C-o*x,ge=e.x-a,nt=e.y-s,ze=(C*ge-o*nt)/P,Bt=(-x*ge+f*nt)/P,qr=t.z+ze*(r.z-t.z)+Bt*(n.z-t.z);return qr};tt.longestSideLength=function(e,t,r){var n=e.distance(t),a=t.distance(r),s=r.distance(e),f=n;return a>f&&(f=a),s>f&&(f=s),f};tt.isAcute=function(e,t,r){return!(!K.isAcute(e,t,r)||!K.isAcute(t,r,e)||!K.isAcute(r,e,t))};tt.circumcentre=function(e,t,r){var n=r.x,a=r.y,s=e.x-n,f=e.y-a,o=t.x-n,x=t.y-a,C=2*tt.det(s,f,o,x),P=tt.det(f,s*s+f*f,x,o*o+x*x),ge=tt.det(s,s*s+f*f,o,o*o+x*x),nt=n-P/C,ze=a+ge/C;return new v(nt,ze)};tt.perpendicularBisector=function(e,t){var r=t.x-e.x,n=t.y-e.y,a=new Ve(e.x+r/2,e.y+n/2,1),s=new Ve(e.x-n+r/2,e.y+r+n/2,1);return new Ve(a,s)};tt.angleBisector=function(e,t,r){var n=t.distance(e),a=t.distance(r),s=n/(n+a),f=r.x-e.x,o=r.y-e.y,x=new v(e.x+s*f,e.y+s*o);return x};tt.area3D=function(e,t,r){var n=t.x-e.x,a=t.y-e.y,s=t.z-e.z,f=r.x-e.x,o=r.y-e.y,x=r.z-e.z,C=a*x-s*o,P=s*f-n*x,ge=n*o-a*f,nt=C*C+P*P+ge*ge,ze=Math.sqrt(nt)/2;return ze};tt.centroid=function(e,t,r){var n=(e.x+t.x+r.x)/3,a=(e.y+t.y+r.y)/3;return new v(n,a)};tt.inCentre=function(e,t,r){var n=t.distance(r),a=e.distance(r),s=e.distance(t),f=n+a+s,o=(n*e.x+a*t.x+s*r.x)/f,x=(n*e.y+a*t.y+s*r.y)/f;return new v(o,x)};var Fe=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new b;var e=arguments[0],t=arguments[1],r=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=r};Fe.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),r=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(r,m.EXTERIOR,m.INTERIOR)};Fe.prototype.addPolygon=function(e){var t=this,r=this._distance,n=w.LEFT;this._distance<0&&(r=-this._distance,n=w.RIGHT);var a=e.getExteriorRing(),s=W.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&s.length<3)return null;this.addPolygonRing(s,r,n,m.EXTERIOR,m.INTERIOR);for(var f=0;f<e.getNumInteriorRing();f++){var o=e.getInteriorRingN(f),x=W.removeRepeatedPoints(o.getCoordinates());t._distance>0&&t.isErodedCompletely(o,-t._distance)||t.addPolygonRing(x,r,w.opposite(n),m.INTERIOR,m.EXTERIOR)}};Fe.prototype.isTriangleErodedCompletely=function(e,t){var r=new tt(e[0],e[1],e[2]),n=r.inCentre(),a=O.distancePointLine(n,r.p0,r.p1);return a<Math.abs(t)};Fe.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=W.removeRepeatedPoints(e.getCoordinates()),r=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(r,m.EXTERIOR,m.INTERIOR)};Fe.prototype.addCurve=function(e,t,r){if(e===null||e.length<2)return null;var n=new It(e,new et(0,m.BOUNDARY,t,r));this._curveList.add(n)};Fe.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Fe.prototype.addPolygonRing=function(e,t,r,n,a){if(t===0&&e.length<Ln.MINIMUM_VALID_SIZE)return null;var s=n,f=a;e.length>=Ln.MINIMUM_VALID_SIZE&&O.isCCW(e)&&(s=a,f=n,r=w.opposite(r));var o=this._curveBuilder.getRingCurve(e,r,t);this.addCurve(o,s,f)};Fe.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Rt?this.addPolygon(e):e instanceof pt?this.addLineString(e):e instanceof de?this.addPoint(e):e instanceof Ni?this.addCollection(e):e instanceof Lr?this.addCollection(e):e instanceof xn?this.addCollection(e):e instanceof ne&&this.addCollection(e)};Fe.prototype.isErodedCompletely=function(e,t){var r=e.getCoordinates();if(r.length<4)return t<0;if(r.length===4)return this.isTriangleErodedCompletely(r,t);var n=e.getEnvelopeInternal(),a=Math.min(n.getHeight(),n.getWidth());return t<0&&2*Math.abs(t)>a};Fe.prototype.addCollection=function(e){for(var t=this,r=0;r<e.getNumGeometries();r++){var n=e.getGeometryN(r);t.add(n)}};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};var Li=function(){};Li.prototype.locate=function(e){};Li.prototype.interfaces_=function(){return[]};Li.prototype.getClass=function(){return Li};var Sn=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};Sn.prototype.next=function(){if(this._atStart)return this._atStart=!1,Sn.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new zi;var e=this._parent.getGeometryN(this._index++);return e instanceof ne?(this._subcollectionIterator=new Sn(e),this._subcollectionIterator.next()):e};Sn.prototype.remove=function(){throw new Error(this.getClass().getName())};Sn.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Sn.prototype.interfaces_=function(){return[Gi]};Sn.prototype.getClass=function(){return Sn};Sn.isAtomic=function(e){return!(e instanceof ne)};var Ce=function(){this._geom=null;var e=arguments[0];this._geom=e};Ce.prototype.locate=function(e){return Ce.locate(e,this._geom)};Ce.prototype.interfaces_=function(){return[Li]};Ce.prototype.getClass=function(){return Ce};Ce.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?O.isPointInRing(e,t.getCoordinates()):!1};Ce.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var r=t.getExteriorRing();if(!Ce.isPointInRing(e,r))return!1;for(var n=0;n<t.getNumInteriorRing();n++){var a=t.getInteriorRingN(n);if(Ce.isPointInRing(e,a))return!1}return!0};Ce.containsPoint=function(e,t){if(t instanceof Rt)return Ce.containsPointInPolygon(e,t);if(t instanceof ne)for(var r=new Sn(t);r.hasNext();){var n=r.next();if(n!==t&&Ce.containsPoint(e,n))return!0}return!1};Ce.locate=function(e,t){return t.isEmpty()?m.EXTERIOR:Ce.containsPoint(e,t)?m.INTERIOR:m.EXTERIOR};var Qt=function(){this._edgeMap=new jt,this._edgeList=null,this._ptInAreaLocation=[m.NONE,m.NONE]};Qt.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),r=t-1;return t===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)};Qt.prototype.propagateSideLabels=function(e){for(var t=m.NONE,r=this.iterator();r.hasNext();){var n=r.next(),a=n.getLabel();a.isArea(e)&&a.getLocation(e,w.LEFT)!==m.NONE&&(t=a.getLocation(e,w.LEFT))}if(t===m.NONE)return null;for(var s=t,f=this.iterator();f.hasNext();){var o=f.next(),x=o.getLabel();if(x.getLocation(e,w.ON)===m.NONE&&x.setLocation(e,w.ON,s),x.isArea(e)){var C=x.getLocation(e,w.LEFT),P=x.getLocation(e,w.RIGHT);if(P!==m.NONE){if(P!==s)throw new Jn("side location conflict",o.getCoordinate());C===m.NONE&&U.shouldNeverReachHere("found single null side (at "+o.getCoordinate()+")"),s=C}else U.isTrue(x.getLocation(e,w.LEFT)===m.NONE,"found single null side"),x.setLocation(e,w.RIGHT,s),x.setLocation(e,w.LEFT,s)}}};Qt.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};Qt.prototype.print=function(e){Ut.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};Qt.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Qt.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var r=t.size()-1,n=t.get(r).getLabel(),a=n.getLocation(e,w.LEFT);U.isTrue(a!==m.NONE,"Found unlabelled area edge");for(var s=a,f=this.iterator();f.hasNext();){var o=f.next(),x=o.getLabel();U.isTrue(x.isArea(e),"Found non-area edge");var C=x.getLocation(e,w.LEFT),P=x.getLocation(e,w.RIGHT);if(C===P||P!==s)return!1;s=C}return!0};Qt.prototype.findIndex=function(e){var t=this;this.iterator();for(var r=0;r<this._edgeList.size();r++){var n=t._edgeList.get(r);if(n===e)return r}return-1};Qt.prototype.iterator=function(){return this.getEdges().iterator()};Qt.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new b(this._edgeMap.values())),this._edgeList};Qt.prototype.getLocation=function(e,t,r){return this._ptInAreaLocation[e]===m.NONE&&(this._ptInAreaLocation[e]=Ce.locate(t,r[e].getGeometry())),this._ptInAreaLocation[e]};Qt.prototype.toString=function(){var e=new yn;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var r=t.next();e.append(r),e.append(`
`)}return e.toString()};Qt.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();r.computeLabel(e)}};Qt.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],n=this.iterator();n.hasNext();)for(var a=n.next(),s=a.getLabel(),f=0;f<2;f++)s.isLine(f)&&s.getLocation(f)===m.BOUNDARY&&(r[f]=!0);for(var o=this.iterator();o.hasNext();)for(var x=o.next(),C=x.getLabel(),P=0;P<2;P++)if(C.isAnyNull(P)){var ge=m.NONE;if(r[P])ge=m.EXTERIOR;else{var nt=x.getCoordinate();ge=t.getLocation(P,nt,e)}C.setAllLocationsIfNull(P,ge)}};Qt.prototype.getDegree=function(){return this._edgeMap.size()};Qt.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};Qt.prototype.interfaces_=function(){return[]};Qt.prototype.getClass=function(){return Qt};var Ac=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var r=this;this.getResultAreaEdges();for(var n=null,a=null,s=this._SCANNING_FOR_INCOMING,f=0;f<this._resultAreaEdgeList.size();f++){var o=r._resultAreaEdgeList.get(f),x=o.getSym();if(o.getLabel().isArea())switch(n===null&&o.isInResult()&&(n=o),s){case r._SCANNING_FOR_INCOMING:if(!x.isInResult())continue;a=x,s=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(!o.isInResult())continue;a.setNext(o),s=r._SCANNING_FOR_INCOMING;break}}if(s===this._LINKING_TO_OUTGOING){if(n===null)throw new Jn("no outgoing dirEdge found",this.getCoordinate());U.isTrue(n.isInResult(),"unable to link last incoming dirEdge"),a.setNext(n)}},t.prototype.insert=function(r){var n=r;this.insertEdgeEnd(n,n)},t.prototype.getRightmostEdge=function(){var r=this.getEdges(),n=r.size();if(n<1)return null;var a=r.get(0);if(n===1)return a;var s=r.get(n-1),f=a.getQuadrant(),o=s.getQuadrant();return it.isNorthern(f)&&it.isNorthern(o)?a:!it.isNorthern(f)&&!it.isNorthern(o)?s:a.getDy()!==0?a:s.getDy()!==0?s:(U.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(r){Ut.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var a=n.next();r.print("out "),a.print(r),r.println(),r.print("in "),a.getSym().print(r),r.println()}},t.prototype.getResultAreaEdges=function(){var r=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new b;for(var n=this.iterator();n.hasNext();){var a=n.next();(a.isInResult()||a.getSym().isInResult())&&r._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(r){for(var n=this.iterator();n.hasNext();){var a=n.next(),s=a.getLabel();s.setAllLocationsIfNull(0,r.getLocation(0)),s.setAllLocationsIfNull(1,r.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var r=this;this.getEdges();for(var n=null,a=null,s=this._edgeList.size()-1;s>=0;s--){var f=r._edgeList.get(s),o=f.getSym();a===null&&(a=o),n!==null&&o.setNext(n),n=f}a.setNext(n)},t.prototype.computeDepths=function(){var r=this;if(arguments.length===1){var n=arguments[0],a=this.findIndex(n),s=n.getDepth(w.LEFT),f=n.getDepth(w.RIGHT),o=this.computeDepths(a+1,this._edgeList.size(),s),x=this.computeDepths(0,a,o);if(x!==f)throw new Jn("depth mismatch at "+n.getCoordinate())}else if(arguments.length===3){for(var C=arguments[0],P=arguments[1],ge=arguments[2],nt=ge,ze=C;ze<P;ze++){var Bt=r._edgeList.get(ze);Bt.setEdgeDepths(w.RIGHT,nt),nt=Bt.getDepth(w.LEFT)}return nt}},t.prototype.mergeSymLabels=function(){for(var r=this.iterator();r.hasNext();){var n=r.next(),a=n.getLabel();a.merge(n.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(r){for(var n=this,a=null,s=null,f=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var x=n._resultAreaEdgeList.get(o),C=x.getSym();switch(a===null&&x.getEdgeRing()===r&&(a=x),f){case n._SCANNING_FOR_INCOMING:if(C.getEdgeRing()!==r)continue;s=C,f=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(x.getEdgeRing()!==r)continue;s.setNextMin(x),f=n._SCANNING_FOR_INCOMING;break}}f===this._LINKING_TO_OUTGOING&&(U.isTrue(a!==null,"found null for first outgoing dirEdge"),U.isTrue(a.getEdgeRing()===r,"unable to link last incoming dirEdge"),s.setNextMin(a))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var r=0,n=this.iterator();n.hasNext();){var a=n.next();a.isInResult()&&r++}return r}else if(arguments.length===1){for(var s=arguments[0],f=0,o=this.iterator();o.hasNext();){var x=o.next();x.getEdgeRing()===s&&f++}return f}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var r=m.NONE,n=this.iterator();n.hasNext();){var a=n.next(),s=a.getSym();if(!a.isLineEdge()){if(a.isInResult()){r=m.INTERIOR;break}if(s.isInResult()){r=m.EXTERIOR;break}}}if(r===m.NONE)return null;for(var f=r,o=this.iterator();o.hasNext();){var x=o.next(),C=x.getSym();x.isLineEdge()?x.getEdge().setCovered(f===m.INTERIOR):(x.isInResult()&&(f=m.EXTERIOR),C.isInResult()&&(f=m.INTERIOR))}},t.prototype.computeLabelling=function(r){var n=this;e.prototype.computeLabelling.call(this,r),this._label=new et(m.NONE);for(var a=this.iterator();a.hasNext();)for(var s=a.next(),f=s.getEdge(),o=f.getLabel(),x=0;x<2;x++){var C=o.getLocation(x);(C===m.INTERIOR||C===m.BOUNDARY)&&n._label.setLocation(x,m.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qt),Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(r){return new is(r,new Ac)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xi),fr=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};fr.prototype.compareTo=function(e){var t=e,r=fr.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return r};fr.prototype.interfaces_=function(){return[ke]};fr.prototype.getClass=function(){return fr};fr.orientation=function(e){return W.increasingDirection(e)===1};fr.compareOriented=function(e,t,r,n){for(var a=t?1:-1,s=n?1:-1,f=t?e.length:-1,o=n?r.length:-1,x=t?0:e.length-1,C=n?0:r.length-1;;){var P=e[x].compareTo(r[C]);if(P!==0)return P;x+=a,C+=s;var ge=x===f,nt=C===o;if(ge&&!nt)return-1;if(!ge&&nt)return 1;if(ge&&nt)return 0}};var We=function(){this._edges=new b,this._ocaMap=new jt};We.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var n=t._edges.get(r);r>0&&e.print(","),e.print("(");for(var a=n.getCoordinates(),s=0;s<a.length;s++)s>0&&e.print(","),e.print(a[s].x+" "+a[s].y);e.println(")")}e.print(")  ")};We.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next())};We.prototype.findEdgeIndex=function(e){for(var t=this,r=0;r<this._edges.size();r++)if(t._edges.get(r).equals(e))return r;return-1};We.prototype.iterator=function(){return this._edges.iterator()};We.prototype.getEdges=function(){return this._edges};We.prototype.get=function(e){return this._edges.get(e)};We.prototype.findEqualEdge=function(e){var t=new fr(e.getCoordinates()),r=this._ocaMap.get(t);return r};We.prototype.add=function(e){this._edges.add(e);var t=new fr(e.getCoordinates());this._ocaMap.put(t,e)};We.prototype.interfaces_=function(){return[]};We.prototype.getClass=function(){return We};var Rr=function(){};Rr.prototype.processIntersections=function(e,t,r,n){};Rr.prototype.isDone=function(){};Rr.prototype.interfaces_=function(){return[]};Rr.prototype.getClass=function(){return Rr};var Le=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Le.prototype.isTrivialIntersection=function(e,t,r,n){if(e===r&&this._li.getIntersectionNum()===1){if(Le.isAdjacentSegments(t,n))return!0;if(e.isClosed()){var a=e.size()-1;if(t===0&&n===a||n===0&&t===a)return!0}}return!1};Le.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Le.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Le.prototype.getLineIntersector=function(){return this._li};Le.prototype.hasProperIntersection=function(){return this._hasProper};Le.prototype.processIntersections=function(e,t,r,n){if(e===r&&t===n)return null;this.numTests++;var a=e.getCoordinates()[t],s=e.getCoordinates()[t+1],f=r.getCoordinates()[n],o=r.getCoordinates()[n+1];this._li.computeIntersection(a,s,f,o),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,r,n)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Le.prototype.hasIntersection=function(){return this._hasIntersection};Le.prototype.isDone=function(){return!1};Le.prototype.hasInteriorIntersection=function(){return this._hasInterior};Le.prototype.interfaces_=function(){return[Rr]};Le.prototype.getClass=function(){return Le};Le.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var hn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],r=arguments[2];this.coord=new v(e),this.segmentIndex=t,this.dist=r};hn.prototype.getSegmentIndex=function(){return this.segmentIndex};hn.prototype.getCoordinate=function(){return this.coord};hn.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};hn.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};hn.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};hn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};hn.prototype.getDistance=function(){return this.dist};hn.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};hn.prototype.interfaces_=function(){return[ke]};hn.prototype.getClass=function(){return hn};var Rn=function(){this._nodeMap=new jt,this.edge=null;var e=arguments[0];this.edge=e};Rn.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};Rn.prototype.iterator=function(){return this._nodeMap.values().iterator()};Rn.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var a=r.next(),s=t.createSplitEdge(n,a);e.add(s),n=a}};Rn.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};Rn.prototype.createSplitEdge=function(e,t){var r=this,n=t.segmentIndex-e.segmentIndex+2,a=this.edge.pts[t.segmentIndex],s=t.dist>0||!t.coord.equals2D(a);s||n--;var f=new Array(n).fill(null),o=0;f[o++]=new v(e.coord);for(var x=e.segmentIndex+1;x<=t.segmentIndex;x++)f[o++]=r.edge.pts[x];return s&&(f[o]=t.coord),new Go(f,new et(this.edge._label))};Rn.prototype.add=function(e,t,r){var n=new hn(e,t,r),a=this._nodeMap.get(n);return a!==null?a:(this._nodeMap.put(n,n),n)};Rn.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();if(r.coord.equals(e))return!0}return!1};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};var Or=function(){};Or.prototype.getChainStartIndices=function(e){var t=this,r=0,n=new b;n.add(new sn(r));do{var a=t.findChainEnd(e,r);n.add(new sn(a)),r=a}while(r<e.length-1);var s=Or.toIntArray(n);return s};Or.prototype.findChainEnd=function(e,t){for(var r=it.quadrant(e[t],e[t+1]),n=t+1;n<e.length;){var a=it.quadrant(e[n-1],e[n]);if(a!==r)break;n++}return n-1};Or.prototype.interfaces_=function(){return[]};Or.prototype.getClass=function(){return Or};Or.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),r=0;r<t.length;r++)t[r]=e.get(r).intValue();return t};var $n=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new T,this.env2=new T;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Or;this.startIndex=t.getChainStartIndices(this.pts)};$n.prototype.getCoordinates=function(){return this.pts};$n.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return t>r?t:r};$n.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return t<r?t:r};$n.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[r],t.startIndex[r+1],n)}else if(arguments.length===6){var a=arguments[0],s=arguments[1],f=arguments[2],o=arguments[3],x=arguments[4],C=arguments[5],P=this.pts[a],ge=this.pts[s],nt=f.pts[o],ze=f.pts[x];if(s-a===1&&x-o===1)return C.addIntersections(this.e,a,f.e,o),null;if(this.env1.init(P,ge),this.env2.init(nt,ze),!this.env1.intersects(this.env2))return null;var Bt=Math.trunc((a+s)/2),qr=Math.trunc((o+x)/2);a<Bt&&(o<qr&&this.computeIntersectsForChain(a,Bt,f,o,qr,C),qr<x&&this.computeIntersectsForChain(a,Bt,f,qr,x,C)),Bt<s&&(o<qr&&this.computeIntersectsForChain(Bt,s,f,o,qr,C),qr<x&&this.computeIntersectsForChain(Bt,s,f,qr,x,C))}};$n.prototype.getStartIndexes=function(){return this.startIndex};$n.prototype.computeIntersects=function(e,t){for(var r=this,n=0;n<this.startIndex.length-1;n++)for(var a=0;a<e.startIndex.length-1;a++)r.computeIntersectsForChain(n,e,a,t)};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var Vt=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var r=0;r<2;r++)for(var n=0;n<3;n++)t._depth[r][n]=e.NULL_VALUE},Nu={NULL_VALUE:{configurable:!0}};Vt.prototype.getDepth=function(e,t){return this._depth[e][t]};Vt.prototype.setDepth=function(e,t,r){this._depth[e][t]=r};Vt.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var r=0;r<3;r++)if(e._depth[t][r]!==Vt.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var n=arguments[0];return this._depth[n][1]===Vt.NULL_VALUE}else if(arguments.length===2){var a=arguments[0],s=arguments[1];return this._depth[a][s]===Vt.NULL_VALUE}};Vt.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var r=e._depth[t][1];e._depth[t][2]<r&&(r=e._depth[t][2]),r<0&&(r=0);for(var n=1;n<3;n++){var a=0;e._depth[t][n]>r&&(a=1),e._depth[t][n]=a}}};Vt.prototype.getDelta=function(e){return this._depth[e][w.RIGHT]-this._depth[e][w.LEFT]};Vt.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?m.EXTERIOR:m.INTERIOR};Vt.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Vt.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],r=0;r<2;r++)for(var n=1;n<3;n++){var a=t.getLocation(r,n);(a===m.EXTERIOR||a===m.INTERIOR)&&(e.isNull(r,n)?e._depth[r][n]=Vt.depthAtLocation(a):e._depth[r][n]+=Vt.depthAtLocation(a))}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];o===m.INTERIOR&&this._depth[s][f]++}};Vt.prototype.interfaces_=function(){return[]};Vt.prototype.getClass=function(){return Vt};Vt.depthAtLocation=function(e){return e===m.EXTERIOR?0:e===m.INTERIOR?1:Vt.NULL_VALUE};Nu.NULL_VALUE.get=function(){return-1};Object.defineProperties(Vt,Nu);var Go=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new Rn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Vt,this._depthDelta=0,arguments.length===1){var r=arguments[0];t.call(this,r,null)}else if(arguments.length===2){var n=arguments[0],a=arguments[1];this.pts=n,this._label=a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var r=new Array(2).fill(null);r[0]=this.pts[0],r[1]=this.pts[1];var n=new t(r,et.toLineLabel(this._label));return n},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(r){this._isIsolated=r},t.prototype.setName=function(r){this._name=r},t.prototype.equals=function(r){var n=this;if(!(r instanceof t))return!1;var a=r;if(this.pts.length!==a.pts.length)return!1;for(var s=!0,f=!0,o=this.pts.length,x=0;x<this.pts.length;x++)if(n.pts[x].equals2D(a.pts[x])||(s=!1),n.pts[x].equals2D(a.pts[--o])||(f=!1),!s&&!f)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}},t.prototype.print=function(r){var n=this;r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&r.print(","),r.print(n.pts[a].x+" "+n.pts[a].y);r.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(r){t.updateIM(this._label,r)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(r){var n=this;r.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)r.print(n.pts[a]+" ");r.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new $n(this)),this._mce},t.prototype.getEnvelope=function(){var r=this;if(this._env===null){this._env=new T;for(var n=0;n<this.pts.length;n++)r._env.expandToInclude(r.pts[n])}return this._env},t.prototype.addIntersection=function(r,n,a,s){var f=new v(r.getIntersection(s)),o=n,x=r.getEdgeDistance(a,s),C=o+1;if(C<this.pts.length){var P=this.pts[C];f.equals2D(P)&&(o=C,x=0)}this.eiList.add(f,o,x)},t.prototype.toString=function(){var r=this,n=new yn;n.append("edge "+this._name+": "),n.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&n.append(","),n.append(r.pts[a].x+" "+r.pts[a].y);return n.append(")  "+this._label+" "+this._depthDelta),n.toString()},t.prototype.isPointwiseEqual=function(r){var n=this;if(this.pts.length!==r.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!n.pts[a].equals2D(r.pts[a]))return!1;return!0},t.prototype.setDepthDelta=function(r){this._depthDelta=r},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(r,n,a){for(var s=this,f=0;f<r.getIntersectionNum();f++)s.addIntersection(r,n,a,f)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];n.setAtLeastIfValid(r.getLocation(0,w.ON),r.getLocation(1,w.ON),1),r.isArea()&&(n.setAtLeastIfValid(r.getLocation(0,w.LEFT),r.getLocation(1,w.LEFT),2),n.setAtLeastIfValid(r.getLocation(0,w.RIGHT),r.getLocation(1,w.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Se),ee=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new We,this._bufParams=e||null};ee.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};ee.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var r=t.getLabel(),n=e.getLabel();t.isPointwiseEqual(e)||(n=new et(e.getLabel()),n.flip()),r.merge(n);var a=ee.depthDelta(n),s=t.getDepthDelta(),f=s+a;t.setDepthDelta(f)}else this._edgeList.add(e),e.setDepthDelta(ee.depthDelta(e.getLabel()))};ee.prototype.buildSubgraphs=function(e,t){for(var r=new b,n=e.iterator();n.hasNext();){var a=n.next(),s=a.getRightmostCoordinate(),f=new Zr(r),o=f.getDepth(s);a.computeDepth(o),a.findResultEdges(),r.add(a),t.add(a.getDirectedEdges(),a.getNodes())}};ee.prototype.createSubgraphs=function(e){for(var t=new b,r=e.getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isVisited()){var a=new re;a.create(n),t.add(a)}}return He.sort(t,He.reverseOrder()),t};ee.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};ee.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new qs,r=new zr;return r.setPrecisionModel(e),t.setSegmentIntersector(new Le(r)),t};ee.prototype.buffer=function(e,t){var r=this._workingPrecisionModel;r===null&&(r=e.getPrecisionModel()),this._geomFact=e.getFactory();var n=new le(r,this._bufParams),a=new Fe(e,t,n),s=a.getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,r),this._graph=new ht(new Cu),this._graph.addEdges(this._edgeList.getEdges());var f=this.createSubgraphs(this._graph),o=new ve(this._geomFact);this.buildSubgraphs(f,o);var x=o.getPolygons();if(x.size()<=0)return this.createEmptyResultGeometry();var C=this._geomFact.buildGeometry(x);return C};ee.prototype.computeNodedEdges=function(e,t){var r=this,n=this.getNoder(t);n.computeNodes(e);for(var a=n.getNodedSubstrings(),s=a.iterator();s.hasNext();){var f=s.next(),o=f.getCoordinates();if(!(o.length===2&&o[0].equals2D(o[1]))){var x=f.getData(),C=new Go(f.getCoordinates(),new et(x));r.insertUniqueEdge(C)}}};ee.prototype.setNoder=function(e){this._workingNoder=e};ee.prototype.interfaces_=function(){return[]};ee.prototype.getClass=function(){return ee};ee.depthDelta=function(e){var t=e.getLocation(0,w.LEFT),r=e.getLocation(0,w.RIGHT);return t===m.INTERIOR&&r===m.EXTERIOR?1:t===m.EXTERIOR&&r===m.INTERIOR?-1:0};ee.convertSegStrings=function(e){for(var t=new H,r=new b;e.hasNext();){var n=e.next(),a=t.createLineString(n.getCoordinates());r.add(a)}return t.buildGeometry(r)};var hr=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var r=arguments[0],n=arguments[1],a=arguments[2],s=arguments[3];this._noder=r,this._scaleFactor=n,this._offsetX=a,this._offsetY=s,this._isScaled=!this.isIntegerPrecision()}};hr.prototype.rescale=function(){var e=this;if(G(arguments[0],wt))for(var t=arguments[0],r=t.iterator();r.hasNext();){var n=r.next();e.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],s=0;s<a.length;s++)a[s].x=a[s].x/e._scaleFactor+e._offsetX,a[s].y=a[s].y/e._scaleFactor+e._offsetY;a.length===2&&a[0].equals2D(a[1])&&Ut.out.println(a)}};hr.prototype.scale=function(){var e=this;if(G(arguments[0],wt)){for(var t=arguments[0],r=new b,n=t.iterator();n.hasNext();){var a=n.next();r.add(new It(e.scale(a.getCoordinates()),a.getData()))}return r}else if(arguments[0]instanceof Array){for(var s=arguments[0],f=new Array(s.length).fill(null),o=0;o<s.length;o++)f[o]=new v(Math.round((s[o].x-e._offsetX)*e._scaleFactor),Math.round((s[o].y-e._offsetY)*e._scaleFactor),s[o].z);var x=W.removeRepeatedPoints(f);return x}};hr.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};hr.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};hr.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};hr.prototype.interfaces_=function(){return[br]};hr.prototype.getClass=function(){return hr};var gn=function(){this._li=new zr,this._segStrings=null;var e=arguments[0];this._segStrings=e},xu={fact:{configurable:!0}};gn.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var r=t.next(),n=r.getCoordinates();e.checkEndPtVertexIntersections(n[0],e._segStrings),e.checkEndPtVertexIntersections(n[n.length-1],e._segStrings)}else if(arguments.length===2){for(var a=arguments[0],s=arguments[1],f=s.iterator();f.hasNext();)for(var o=f.next(),x=o.getCoordinates(),C=1;C<x.length-1;C++)if(x[C].equals(a))throw new Kn("found endpt/interior pt intersection at index "+C+" :pt "+a)}};gn.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var r=t.next(),n=this._segStrings.iterator();n.hasNext();){var a=n.next();e.checkInteriorIntersections(r,a)}else if(arguments.length===2)for(var s=arguments[0],f=arguments[1],o=s.getCoordinates(),x=f.getCoordinates(),C=0;C<o.length-1;C++)for(var P=0;P<x.length-1;P++)e.checkInteriorIntersections(s,C,f,P);else if(arguments.length===4){var ge=arguments[0],nt=arguments[1],ze=arguments[2],Bt=arguments[3];if(ge===ze&&nt===Bt)return null;var qr=ge.getCoordinates()[nt],_n=ge.getCoordinates()[nt+1],Fn=ze.getCoordinates()[Bt],tl=ze.getCoordinates()[Bt+1];if(this._li.computeIntersection(qr,_n,Fn,tl),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,qr,_n)||this.hasInteriorIntersection(this._li,Fn,tl)))throw new Kn("found non-noded intersection at "+qr+"-"+_n+" and "+Fn+"-"+tl)}};gn.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};gn.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var r=t.next();e.checkCollapses(r)}else if(arguments.length===1)for(var n=arguments[0],a=n.getCoordinates(),s=0;s<a.length-2;s++)e.checkCollapse(a[s],a[s+1],a[s+2])};gn.prototype.hasInteriorIntersection=function(e,t,r){for(var n=0;n<e.getIntersectionNum();n++){var a=e.getIntersection(n);if(!(a.equals(t)||a.equals(r)))return!0}return!1};gn.prototype.checkCollapse=function(e,t,r){if(e.equals(r))throw new Kn("found non-noded collapse at "+gn.fact.createLineString([e,t,r]))};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};xu.fact.get=function(){return new H};Object.defineProperties(gn,xu);var ce=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],r=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=r,t<=0)throw new ct("Scale factor must be non-zero");t!==1&&(this._pt=new v(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new v,this._p1Scaled=new v),this.initCorners(this._pt)},Su={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ce.prototype.intersectsScaled=function(e,t){var r=Math.min(e.x,t.x),n=Math.max(e.x,t.x),a=Math.min(e.y,t.y),s=Math.max(e.y,t.y),f=this._maxx<r||this._minx>n||this._maxy<a||this._miny>s;if(f)return!1;var o=this.intersectsToleranceSquare(e,t);return U.isTrue(!(f&&o),"Found bad envelope test"),o};ce.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new v(this._maxx,this._maxy),this._corner[1]=new v(this._minx,this._maxy),this._corner[2]=new v(this._minx,this._miny),this._corner[3]=new v(this._maxx,this._miny)};ce.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};ce.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};ce.prototype.getCoordinate=function(){return this._originalPt};ce.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};ce.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=ce.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new T(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};ce.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};ce.prototype.intersectsToleranceSquare=function(e,t){var r=!1,n=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||r&&n||e.equals(this._pt)||t.equals(this._pt))};ce.prototype.addSnappedNode=function(e,t){var r=e.getCoordinate(t),n=e.getCoordinate(t+1);return this.intersects(r,n)?(e.addIntersection(this.getCoordinate(),t),!0):!1};ce.prototype.interfaces_=function(){return[]};ce.prototype.getClass=function(){return ce};Su.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(ce,Su);var uo=function(){this.tempEnv1=new T,this.selectedSegment=new F};uo.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};var bi=function(){this._index=null;var e=arguments[0];this._index=e},wu={HotPixelSnapAction:{configurable:!0}};bi.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],a=t.getSafeEnvelope(),s=new Lu(t,r,n);return this._index.query(a,{interfaces_:function(){return[lr]},visitItem:function(f){var o=f;o.select(a,s)}}),s.isNodeAdded()}};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};wu.HotPixelSnapAction.get=function(){return Lu};Object.defineProperties(bi,wu);var Lu=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],n=arguments[1],a=arguments[2];this._hotPixel=r,this._parentEdge=n,this._hotPixelVertexIndex=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1],a=r.getContext();if(this._parentEdge!==null&&a===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(a,n)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(uo),$r=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new b};$r.prototype.processIntersections=function(e,t,r,n){var a=this;if(e===r&&t===n)return null;var s=e.getCoordinates()[t],f=e.getCoordinates()[t+1],o=r.getCoordinates()[n],x=r.getCoordinates()[n+1];if(this._li.computeIntersection(s,f,o,x),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var C=0;C<this._li.getIntersectionNum();C++)a._interiorIntersections.add(a._li.getIntersection(C));e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1)}};$r.prototype.isDone=function(){return!1};$r.prototype.getInteriorIntersections=function(){return this._interiorIntersections};$r.prototype.interfaces_=function(){return[Rr]};$r.prototype.getClass=function(){return $r};var On=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new zr,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};On.prototype.checkCorrectness=function(e){var t=It.getNodedSubstrings(e),r=new gn(t);try{r.checkValid()}catch(n){if(n instanceof cu)n.printStackTrace();else throw n}finally{}};On.prototype.getNodedSubstrings=function(){return It.getNodedSubstrings(this._nodedSegStrings)};On.prototype.snapRound=function(e,t){var r=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(r),this.computeVertexSnaps(e)};On.prototype.findInteriorIntersections=function(e,t){var r=new $r(t);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(e),r.getInteriorIntersections()};On.prototype.computeVertexSnaps=function(){var e=this;if(G(arguments[0],wt))for(var t=arguments[0],r=t.iterator();r.hasNext();){var n=r.next();e.computeVertexSnaps(n)}else if(arguments[0]instanceof It)for(var a=arguments[0],s=a.getCoordinates(),f=0;f<s.length;f++){var o=new ce(s[f],e._scaleFactor,e._li),x=e._pointSnapper.snap(o,a,f);x&&a.addIntersection(s[f],f)}};On.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new qs,this._pointSnapper=new bi(this._noder.getIndex()),this.snapRound(e,this._li)};On.prototype.computeIntersectionSnaps=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next(),a=new ce(n,t._scaleFactor,t._li);t._pointSnapper.snap(a)}};On.prototype.interfaces_=function(){return[br]};On.prototype.getClass=function(){return On};var zt=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Z,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._argGeom=t,this._bufParams=r}},Vi={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};zt.prototype.bufferFixedPrecision=function(e){var t=new hr(new On(new $(1)),e.getScale()),r=new ee(this._bufParams);r.setWorkingPrecisionModel(e),r.setNoder(t),this._resultGeometry=r.buffer(this._argGeom,this._distance)};zt.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=zt.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(s){if(s instanceof Jn)e._saveException=s;else throw s}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var r=arguments[0],n=zt.precisionScaleFactor(this._argGeom,this._distance,r),a=new $(n);this.bufferFixedPrecision(a)}};zt.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===$.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};zt.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};zt.prototype.bufferOriginalPrecision=function(){try{var e=new ee(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Kn)this._saveException=t;else throw t}finally{}};zt.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};zt.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new zt(e),n=r.getResultGeometry(t);return n}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof k&&typeof arguments[1]=="number"){var a=arguments[0],s=arguments[1],f=arguments[2],o=new zt(a);o.setQuadrantSegments(f);var x=o.getResultGeometry(s);return x}else if(arguments[2]instanceof Z&&arguments[0]instanceof k&&typeof arguments[1]=="number"){var C=arguments[0],P=arguments[1],ge=arguments[2],nt=new zt(C,ge),ze=nt.getResultGeometry(P);return ze}}else if(arguments.length===4){var Bt=arguments[0],qr=arguments[1],_n=arguments[2],Fn=arguments[3],tl=new zt(Bt);tl.setQuadrantSegments(_n),tl.setEndCapStyle(Fn);var Io=tl.getResultGeometry(qr);return Io}};zt.precisionScaleFactor=function(e,t,r){var n=e.getEnvelopeInternal(),a=xe.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY())),s=t>0?t:0,f=a+2*s,o=Math.trunc(Math.log(f)/Math.log(10)+1),x=r-o,C=Math.pow(10,x);return C};Vi.CAP_ROUND.get=function(){return Z.CAP_ROUND};Vi.CAP_BUTT.get=function(){return Z.CAP_FLAT};Vi.CAP_FLAT.get=function(){return Z.CAP_FLAT};Vi.CAP_SQUARE.get=function(){return Z.CAP_SQUARE};Vi.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(zt,Vi);var Zt=function(){this._pt=[new v,new v],this._distance=z.NaN,this._isNull=!0};Zt.prototype.getCoordinates=function(){return this._pt};Zt.prototype.getCoordinate=function(e){return this._pt[e]};Zt.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n<this._distance&&this.initialize(t,r,n)}};Zt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=a,this._isNull=!1}};Zt.prototype.getDistance=function(){return this._distance};Zt.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n>this._distance&&this.initialize(t,r,n)}};Zt.prototype.interfaces_=function(){return[]};Zt.prototype.getClass=function(){return Zt};var Cn=function(){};Cn.prototype.interfaces_=function(){return[]};Cn.prototype.getClass=function(){return Cn};Cn.computeDistance=function(){if(arguments[2]instanceof Zt&&arguments[0]instanceof pt&&arguments[1]instanceof v)for(var e=arguments[0],t=arguments[1],r=arguments[2],n=e.getCoordinates(),a=new F,s=0;s<n.length-1;s++){a.setCoordinates(n[s],n[s+1]);var f=a.closestPoint(t);r.setMinimum(f,t)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof Rt&&arguments[1]instanceof v){var o=arguments[0],x=arguments[1],C=arguments[2];Cn.computeDistance(o.getExteriorRing(),x,C);for(var P=0;P<o.getNumInteriorRing();P++)Cn.computeDistance(o.getInteriorRingN(P),x,C)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof k&&arguments[1]instanceof v){var ge=arguments[0],nt=arguments[1],ze=arguments[2];if(ge instanceof pt)Cn.computeDistance(ge,nt,ze);else if(ge instanceof Rt)Cn.computeDistance(ge,nt,ze);else if(ge instanceof ne)for(var Bt=ge,qr=0;qr<Bt.getNumGeometries();qr++){var _n=Bt.getGeometryN(qr);Cn.computeDistance(_n,nt,ze)}else ze.setMinimum(ge.getCoordinate(),nt)}else if(arguments[2]instanceof Zt&&arguments[0]instanceof F&&arguments[1]instanceof v){var Fn=arguments[0],tl=arguments[1],Io=arguments[2],Co=Fn.closestPoint(tl);Io.setMinimum(Co,tl)}};var Dr=function(e){this._maxPtDist=new Zt,this._inputGeom=e||null},Xs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Dr.prototype.computeMaxMidpointDistance=function(e){var t=new gr(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Dr.prototype.computeMaxVertexDistance=function(e){var t=new ti(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Dr.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Dr.prototype.getDistancePoints=function(){return this._maxPtDist};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};Xs.MaxPointDistanceFilter.get=function(){return ti};Xs.MaxMidpointDistanceFilter.get=function(){return gr};Object.defineProperties(Dr,Xs);var ti=function(e){this._maxPtDist=new Zt,this._minPtDist=new Zt,this._geom=e||null};ti.prototype.filter=function(e){this._minPtDist.initialize(),Cn.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ti.prototype.getMaxPointDistance=function(){return this._maxPtDist};ti.prototype.interfaces_=function(){return[wn]};ti.prototype.getClass=function(){return ti};var gr=function(e){this._maxPtDist=new Zt,this._minPtDist=new Zt,this._geom=e||null};gr.prototype.filter=function(e,t){if(t===0)return null;var r=e.getCoordinate(t-1),n=e.getCoordinate(t),a=new v((r.x+n.x)/2,(r.y+n.y)/2);this._minPtDist.initialize(),Cn.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};gr.prototype.isDone=function(){return!1};gr.prototype.isGeometryChanged=function(){return!1};gr.prototype.getMaxPointDistance=function(){return this._maxPtDist};gr.prototype.interfaces_=function(){return[Xe]};gr.prototype.getClass=function(){return gr};var Wn=function(e){this._comps=e||null};Wn.prototype.filter=function(e){e instanceof Rt&&this._comps.add(e)};Wn.prototype.interfaces_=function(){return[un]};Wn.prototype.getClass=function(){return Wn};Wn.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Wn.getPolygons(e,new b)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t instanceof Rt?r.add(t):t instanceof ne&&t.apply(new Wn(r)),r}};var kt=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._lines=t,this._isForcedToLineString=r}};kt.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Ln){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof pt&&this._lines.add(e)};kt.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};kt.prototype.interfaces_=function(){return[Qn]};kt.prototype.getClass=function(){return kt};kt.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(kt.getLines(e))}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t.getFactory().buildGeometry(kt.getLines(t,r))}};kt.getLines=function(){if(arguments.length===1){var e=arguments[0];return kt.getLines(e,!1)}else if(arguments.length===2){if(G(arguments[0],wt)&&G(arguments[1],wt)){for(var t=arguments[0],r=arguments[1],n=t.iterator();n.hasNext();){var a=n.next();kt.getLines(a,r)}return r}else if(arguments[0]instanceof k&&typeof arguments[1]=="boolean"){var s=arguments[0],f=arguments[1],o=new b;return s.apply(new kt(o,f)),o}else if(arguments[0]instanceof k&&G(arguments[1],wt)){var x=arguments[0],C=arguments[1];return x instanceof pt?C.add(x):x.apply(new kt(C)),C}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&G(arguments[0],wt)&&G(arguments[1],wt)){for(var P=arguments[0],ge=arguments[1],nt=arguments[2],ze=P.iterator();ze.hasNext();){var Bt=ze.next();kt.getLines(Bt,ge,nt)}return ge}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof k&&G(arguments[1],wt)){var qr=arguments[0],_n=arguments[1],Fn=arguments[2];return qr.apply(new kt(_n,Fn)),_n}}};var je=function(){if(this._boundaryRule=Me.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new ct("Rule must be non-null");this._boundaryRule=e}};je.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof v&&arguments[1]instanceof Rt){var t=arguments[0],r=arguments[1];if(r.isEmpty())return m.EXTERIOR;var n=r.getExteriorRing(),a=this.locateInPolygonRing(t,n);if(a===m.EXTERIOR)return m.EXTERIOR;if(a===m.BOUNDARY)return m.BOUNDARY;for(var s=0;s<r.getNumInteriorRing();s++){var f=r.getInteriorRingN(s),o=e.locateInPolygonRing(t,f);if(o===m.INTERIOR)return m.EXTERIOR;if(o===m.BOUNDARY)return m.BOUNDARY}return m.INTERIOR}else if(arguments[0]instanceof v&&arguments[1]instanceof pt){var x=arguments[0],C=arguments[1];if(!C.getEnvelopeInternal().intersects(x))return m.EXTERIOR;var P=C.getCoordinates();return!C.isClosed()&&(x.equals(P[0])||x.equals(P[P.length-1]))?m.BOUNDARY:O.isOnLine(x,P)?m.INTERIOR:m.EXTERIOR}else if(arguments[0]instanceof v&&arguments[1]instanceof de){var ge=arguments[0],nt=arguments[1],ze=nt.getCoordinate();return ze.equals2D(ge)?m.INTERIOR:m.EXTERIOR}};je.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?O.locatePointInRing(e,t.getCoordinates()):m.EXTERIOR};je.prototype.intersects=function(e,t){return this.locate(e,t)!==m.EXTERIOR};je.prototype.updateLocationInfo=function(e){e===m.INTERIOR&&(this._isIn=!0),e===m.BOUNDARY&&this._numBoundaries++};je.prototype.computeLocation=function(e,t){var r=this;if(t instanceof de&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof pt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Rt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Lr)for(var n=t,a=0;a<n.getNumGeometries();a++){var s=n.getGeometryN(a);r.updateLocationInfo(r.locateInternal(e,s))}else if(t instanceof xn)for(var f=t,o=0;o<f.getNumGeometries();o++){var x=f.getGeometryN(o);r.updateLocationInfo(r.locateInternal(e,x))}else if(t instanceof ne)for(var C=new Sn(t);C.hasNext();){var P=C.next();P!==t&&r.computeLocation(e,P)}};je.prototype.locate=function(e,t){return t.isEmpty()?m.EXTERIOR:t instanceof pt?this.locateInternal(e,t):t instanceof Rt?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?m.BOUNDARY:this._numBoundaries>0||this._isIn?m.INTERIOR:m.EXTERIOR)};je.prototype.interfaces_=function(){return[]};je.prototype.getClass=function(){return je};var $t=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],r=arguments[1];e.call(this,t,e.INSIDE_AREA,r)}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];this._component=n,this._segIndex=a,this._pt=s}},bu={INSIDE_AREA:{configurable:!0}};$t.prototype.isInsideArea=function(){return this._segIndex===$t.INSIDE_AREA};$t.prototype.getCoordinate=function(){return this._pt};$t.prototype.getGeometryComponent=function(){return this._component};$t.prototype.getSegmentIndex=function(){return this._segIndex};$t.prototype.interfaces_=function(){return[]};$t.prototype.getClass=function(){return $t};bu.INSIDE_AREA.get=function(){return-1};Object.defineProperties($t,bu);var ir=function(e){this._pts=e||null};ir.prototype.filter=function(e){e instanceof de&&this._pts.add(e)};ir.prototype.interfaces_=function(){return[un]};ir.prototype.getClass=function(){return ir};ir.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof de?He.singletonList(e):ir.getPoints(e,new b)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t instanceof de?r.add(t):t instanceof ne&&t.apply(new ir(r)),r}};var ei=function(){this._locations=null;var e=arguments[0];this._locations=e};ei.prototype.filter=function(e){(e instanceof de||e instanceof pt||e instanceof Rt)&&this._locations.add(new $t(e,0,e.getCoordinate()))};ei.prototype.interfaces_=function(){return[un]};ei.prototype.getClass=function(){return ei};ei.getLocations=function(e){var t=new b;return e.apply(new ei(t)),t};var qt=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new je,this._minDistanceLocation=null,this._minDistance=z.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=n,this._terminateDistance=a}};qt.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=1-r,s=Wn.getPolygons(this._geom[r]);if(s.size()>0){var f=ei.getLocations(this._geom[a]);if(this.computeContainmentDistance(f,s,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[a]=n[0],this._minDistanceLocation[r]=n[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&G(arguments[0],Ue)&&G(arguments[1],Ue)){for(var o=arguments[0],x=arguments[1],C=arguments[2],P=0;P<o.size();P++)for(var ge=o.get(P),nt=0;nt<x.size();nt++)if(e.computeContainmentDistance(ge,x.get(nt),C),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof $t&&arguments[1]instanceof Rt){var ze=arguments[0],Bt=arguments[1],qr=arguments[2],_n=ze.getCoordinate();if(m.EXTERIOR!==this._ptLocator.locate(_n,Bt))return this._minDistance=0,qr[0]=ze,qr[1]=new $t(Bt,_n),null}}};qt.prototype.computeMinDistanceLinesPoints=function(e,t,r){for(var n=this,a=0;a<e.size();a++)for(var s=e.get(a),f=0;f<t.size();f++){var o=t.get(f);if(n.computeMinDistance(s,o,r),n._minDistance<=n._terminateDistance)return null}};qt.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=kt.getLines(this._geom[0]),r=kt.getLines(this._geom[1]),n=ir.getPoints(this._geom[0]),a=ir.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,a,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(r,n,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(n,a,e),this.updateMinDistance(e,!1)};qt.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};qt.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};qt.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};qt.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof pt&&arguments[1]instanceof de){var t=arguments[0],r=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var a=t.getCoordinates(),s=r.getCoordinate(),f=0;f<a.length-1;f++){var o=O.distancePointLine(s,a[f],a[f+1]);if(o<e._minDistance){e._minDistance=o;var x=new F(a[f],a[f+1]),C=x.closestPoint(s);n[0]=new $t(t,f,C),n[1]=new $t(r,0,s)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof pt&&arguments[1]instanceof pt){var P=arguments[0],ge=arguments[1],nt=arguments[2];if(P.getEnvelopeInternal().distance(ge.getEnvelopeInternal())>this._minDistance)return null;for(var ze=P.getCoordinates(),Bt=ge.getCoordinates(),qr=0;qr<ze.length-1;qr++)for(var _n=0;_n<Bt.length-1;_n++){var Fn=O.distanceLineLine(ze[qr],ze[qr+1],Bt[_n],Bt[_n+1]);if(Fn<e._minDistance){e._minDistance=Fn;var tl=new F(ze[qr],ze[qr+1]),Io=new F(Bt[_n],Bt[_n+1]),Co=tl.closestPoints(Io);nt[0]=new $t(P,qr,Co[0]),nt[1]=new $t(ge,_n,Co[1])}if(e._minDistance<=e._terminateDistance)return null}}}};qt.prototype.computeMinDistancePoints=function(e,t,r){for(var n=this,a=0;a<e.size();a++)for(var s=e.get(a),f=0;f<t.size();f++){var o=t.get(f),x=s.getCoordinate().distance(o.getCoordinate());if(x<n._minDistance&&(n._minDistance=x,r[0]=new $t(s,0,s.getCoordinate()),r[1]=new $t(o,0,o.getCoordinate())),n._minDistance<=n._terminateDistance)return null}};qt.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new ct("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};qt.prototype.computeMinDistanceLines=function(e,t,r){for(var n=this,a=0;a<e.size();a++)for(var s=e.get(a),f=0;f<t.size();f++){var o=t.get(f);if(n.computeMinDistance(s,o,r),n._minDistance<=n._terminateDistance)return null}};qt.prototype.interfaces_=function(){return[]};qt.prototype.getClass=function(){return qt};qt.distance=function(e,t){var r=new qt(e,t);return r.distance()};qt.isWithinDistance=function(e,t,r){var n=new qt(e,t,r);return n.distance()<=r};qt.nearestPoints=function(e,t){var r=new qt(e,t);return r.nearestPoints()};var Wt=function(){this._pt=[new v,new v],this._distance=z.NaN,this._isNull=!0};Wt.prototype.getCoordinates=function(){return this._pt};Wt.prototype.getCoordinate=function(e){return this._pt[e]};Wt.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n<this._distance&&this.initialize(t,r,n)}};Wt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],n=arguments[1],a=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=a,this._isNull=!1}};Wt.prototype.toString=function(){return qe.toLineString(this._pt[0],this._pt[1])};Wt.prototype.getDistance=function(){return this._distance};Wt.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n>this._distance&&this.initialize(t,r,n)}};Wt.prototype.interfaces_=function(){return[]};Wt.prototype.getClass=function(){return Wt};var en=function(){};en.prototype.interfaces_=function(){return[]};en.prototype.getClass=function(){return en};en.computeDistance=function(){if(arguments[2]instanceof Wt&&arguments[0]instanceof pt&&arguments[1]instanceof v)for(var e=arguments[0],t=arguments[1],r=arguments[2],n=new F,a=e.getCoordinates(),s=0;s<a.length-1;s++){n.setCoordinates(a[s],a[s+1]);var f=n.closestPoint(t);r.setMinimum(f,t)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof Rt&&arguments[1]instanceof v){var o=arguments[0],x=arguments[1],C=arguments[2];en.computeDistance(o.getExteriorRing(),x,C);for(var P=0;P<o.getNumInteriorRing();P++)en.computeDistance(o.getInteriorRingN(P),x,C)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof k&&arguments[1]instanceof v){var ge=arguments[0],nt=arguments[1],ze=arguments[2];if(ge instanceof pt)en.computeDistance(ge,nt,ze);else if(ge instanceof Rt)en.computeDistance(ge,nt,ze);else if(ge instanceof ne)for(var Bt=ge,qr=0;qr<Bt.getNumGeometries();qr++){var _n=Bt.getGeometryN(qr);en.computeDistance(_n,nt,ze)}else ze.setMinimum(ge.getCoordinate(),nt)}else if(arguments[2]instanceof Wt&&arguments[0]instanceof F&&arguments[1]instanceof v){var Fn=arguments[0],tl=arguments[1],Io=arguments[2],Co=Fn.closestPoint(tl);Io.setMinimum(Co,tl)}};var Te=function(){this._g0=null,this._g1=null,this._ptDist=new Wt,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},Ys={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Te.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Te.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new ct("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};Te.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};Te.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Te.prototype.computeOrientedDistance=function(e,t,r){var n=new ni(t);if(e.apply(n),r.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var a=new pr(t,this._densifyFrac);e.apply(a),r.setMaximum(a.getMaxPointDistance())}};Te.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Te.prototype.interfaces_=function(){return[]};Te.prototype.getClass=function(){return Te};Te.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new Te(e,t);return r.distance()}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2],f=new Te(n,a);return f.setDensifyFraction(s),f.distance()}};Ys.MaxPointDistanceFilter.get=function(){return ni};Ys.MaxDensifiedByFractionDistanceFilter.get=function(){return pr};Object.defineProperties(Te,Ys);var ni=function(){this._maxPtDist=new Wt,this._minPtDist=new Wt,this._euclideanDist=new en,this._geom=null;var e=arguments[0];this._geom=e};ni.prototype.filter=function(e){this._minPtDist.initialize(),en.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ni.prototype.getMaxPointDistance=function(){return this._maxPtDist};ni.prototype.interfaces_=function(){return[wn]};ni.prototype.getClass=function(){return ni};var pr=function(){this._maxPtDist=new Wt,this._minPtDist=new Wt,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};pr.prototype.filter=function(e,t){var r=this;if(t===0)return null;for(var n=e.getCoordinate(t-1),a=e.getCoordinate(t),s=(a.x-n.x)/this._numSubSegs,f=(a.y-n.y)/this._numSubSegs,o=0;o<this._numSubSegs;o++){var x=n.x+o*s,C=n.y+o*f,P=new v(x,C);r._minPtDist.initialize(),en.computeDistance(r._geom,P,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}};pr.prototype.isDone=function(){return!1};pr.prototype.isGeometryChanged=function(){return!1};pr.prototype.getMaxPointDistance=function(){return this._maxPtDist};pr.prototype.interfaces_=function(){return[Xe]};pr.prototype.getClass=function(){return pr};var pe=function(e,t,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=r||null},Hs={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};pe.prototype.checkMaximumDistance=function(e,t,r){var n=new Te(t,e);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var a=n.getCoordinates();this._errorLocation=a[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+qe.toLineString(a[0],a[1])+")"}};pe.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=pe.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),pe.VERBOSE&&Ut.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};pe.prototype.checkNegativeValid=function(){if(!(this._input instanceof Rt||this._input instanceof xn||this._input instanceof ne))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};pe.prototype.getErrorIndicator=function(){return this._errorIndicator};pe.prototype.checkMinimumDistance=function(e,t,r){var n=new qt(e,t,r);if(this._minDistanceFound=n.distance(),this._minDistanceFound<r){this._isValid=!1;var a=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+qe.toLineString(a[0],a[1])+" )"}};pe.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};pe.prototype.getErrorLocation=function(){return this._errorLocation};pe.prototype.getPolygonLines=function(e){for(var t=new b,r=new kt(t),n=Wn.getPolygons(e),a=n.iterator();a.hasNext();){var s=a.next();s.apply(r)}return e.getFactory().buildGeometry(t)};pe.prototype.getErrorMessage=function(){return this._errMsg};pe.prototype.interfaces_=function(){return[]};pe.prototype.getClass=function(){return pe};Hs.VERBOSE.get=function(){return!1};Hs.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(pe,Hs);var Xt=function(e,t,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=r||null},Ws={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Xt.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Xt.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Xt.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new T(this._input.getEnvelopeInternal());t.expandBy(this._distance);var r=new T(this._result.getEnvelopeInternal());r.expandBy(e),r.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")};Xt.prototype.checkDistance=function(){var e=new pe(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};Xt.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Xt.prototype.checkPolygonal=function(){this._result instanceof Rt||this._result instanceof xn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Xt.prototype.getErrorIndicator=function(){return this._errorIndicator};Xt.prototype.getErrorLocation=function(){return this._errorLocation};Xt.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Xt.prototype.report=function(e){if(!Xt.VERBOSE)return null;Ut.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};Xt.prototype.getErrorMessage=function(){return this._errorMsg};Xt.prototype.interfaces_=function(){return[]};Xt.prototype.getClass=function(){return Xt};Xt.isValidMsg=function(e,t,r){var n=new Xt(e,t,r);return n.isValid()?null:n.getErrorMessage()};Xt.isValid=function(e,t,r){var n=new Xt(e,t,r);return!!n.isValid()};Ws.VERBOSE.get=function(){return!1};Ws.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Xt,Ws);var pn=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};pn.prototype.getCoordinates=function(){return this._pts};pn.prototype.size=function(){return this._pts.length};pn.prototype.getCoordinate=function(e){return this._pts[e]};pn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};pn.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Jr.octant(this.getCoordinate(e),this.getCoordinate(e+1))};pn.prototype.setData=function(e){this._data=e};pn.prototype.getData=function(){return this._data};pn.prototype.toString=function(){return qe.toLineString(new yt(this._pts))};pn.prototype.interfaces_=function(){return[Pn]};pn.prototype.getClass=function(){return pn};var Mt=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new b,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Mt.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Mt.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Mt.prototype.getIntersectionSegments=function(){return this._intSegments};Mt.prototype.count=function(){return this._intersectionCount};Mt.prototype.getIntersections=function(){return this._intersections};Mt.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Mt.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Mt.prototype.processIntersections=function(e,t,r,n){if(!this._findAllIntersections&&this.hasIntersection()||e===r&&t===n)return null;if(this._isCheckEndSegmentsOnly){var a=this.isEndSegment(e,t)||this.isEndSegment(r,n);if(!a)return null}var s=e.getCoordinates()[t],f=e.getCoordinates()[t+1],o=r.getCoordinates()[n],x=r.getCoordinates()[n+1];this._li.computeIntersection(s,f,o,x),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=s,this._intSegments[1]=f,this._intSegments[2]=o,this._intSegments[3]=x,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Mt.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};Mt.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Mt.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Mt.prototype.interfaces_=function(){return[Rr]};Mt.prototype.getClass=function(){return Mt};Mt.createAllIntersectionsFinder=function(e){var t=new Mt(e);return t.setFindAllIntersections(!0),t};Mt.createAnyIntersectionFinder=function(e){return new Mt(e)};Mt.createIntersectionCounter=function(e){var t=new Mt(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Ke=function(){this._li=new zr,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Ke.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ke.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ke.prototype.isValid=function(){return this.execute(),this._isValid};Ke.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Ke.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Mt(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new qs;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ke.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Jn(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ke.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+qe.toLineString(e[0],e[1])+" and "+qe.toLineString(e[2],e[3])};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};Ke.computeIntersections=function(e){var t=new Ke(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Tr=function e(){this._nv=null;var t=arguments[0];this._nv=new Ke(e.toSegmentStrings(t))};Tr.prototype.checkValid=function(){this._nv.checkValid()};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.toSegmentStrings=function(e){for(var t=new b,r=e.iterator();r.hasNext();){var n=r.next();t.add(new pn(n.getCoordinates(),n))}return t};Tr.checkValid=function(e){var t=new Tr(e);t.checkValid()};var ri=function(e){this._mapOp=e};ri.prototype.map=function(e){for(var t=this,r=new b,n=0;n<e.getNumGeometries();n++){var a=t._mapOp.map(e.getGeometryN(n));a.isEmpty()||r.add(a)}return e.getFactory().createGeometryCollection(H.toGeometryArray(r))};ri.prototype.interfaces_=function(){return[]};ri.prototype.getClass=function(){return ri};ri.map=function(e,t){var r=new ri(t);return r.map(e)};var dn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new b,this._resultLineList=new b;var e=arguments[0],t=arguments[1],r=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=r};dn.prototype.collectLines=function(e){for(var t=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var n=r.next();t.collectLineEdge(n,e,t._lineEdgesList),t.collectBoundaryTouchEdge(n,e,t._lineEdgesList)}};dn.prototype.labelIsolatedLine=function(e,t){var r=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,r)};dn.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};dn.prototype.collectLineEdge=function(e,t,r){var n=e.getLabel(),a=e.getEdge();e.isLineEdge()&&!e.isVisited()&&V.isResultOfOp(n,t)&&!a.isCovered()&&(r.add(a),e.setVisitedEdge(!0))};dn.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var r=t.next();r.getEdges().findCoveredLineEdges()}for(var n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var a=n.next(),s=a.getEdge();if(a.isLineEdge()&&!s.isCoveredSet()){var f=e._op.isCoveredByA(a.getCoordinate());s.setCovered(f)}}};dn.prototype.labelIsolatedLines=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next(),a=n.getLabel();n.isIsolated()&&(a.isNull(0)?t.labelIsolatedLine(n,0):t.labelIsolatedLine(n,1))}};dn.prototype.buildLines=function(e){for(var t=this,r=this._lineEdgesList.iterator();r.hasNext();){var n=r.next(),a=t._geometryFactory.createLineString(n.getCoordinates());t._resultLineList.add(a),n.setInResult(!0)}};dn.prototype.collectBoundaryTouchEdge=function(e,t,r){var n=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;U.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),V.isResultOfOp(n,t)&&t===V.INTERSECTION&&(r.add(e.getEdge()),e.setVisitedEdge(!0))};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};var ii=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new b;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};ii.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var r=this._geometryFactory.createPoint(t);this._resultPointList.add(r)}};ii.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(n.getEdges().getDegree()===0||e===V.INTERSECTION)){var a=n.getLabel();V.isResultOfOp(a,e)&&t.filterCoveredNodeToPoint(n)}}};ii.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};var fe=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};fe.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};fe.prototype.transformPolygon=function(e,t){var r=this,n=!0,a=this.transformLinearRing(e.getExteriorRing(),e);(a===null||!(a instanceof Ln)||a.isEmpty())&&(n=!1);for(var s=new b,f=0;f<e.getNumInteriorRing();f++){var o=r.transformLinearRing(e.getInteriorRingN(f),e);o===null||o.isEmpty()||(o instanceof Ln||(n=!1),s.add(o))}if(n)return this._factory.createPolygon(a,s.toArray([]));var x=new b;return a!==null&&x.add(a),x.addAll(s),this._factory.buildGeometry(x)};fe.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};fe.prototype.getInputGeometry=function(){return this._inputGeom};fe.prototype.transformMultiLineString=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transformLineString(e.getGeometryN(a),e);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)};fe.prototype.transformCoordinates=function(e,t){return this.copy(e)};fe.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};fe.prototype.transformMultiPoint=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transformPoint(e.getGeometryN(a),e);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)};fe.prototype.transformMultiPolygon=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transformPolygon(e.getGeometryN(a),e);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)};fe.prototype.copy=function(e){return e.copy()};fe.prototype.transformGeometryCollection=function(e,t){for(var r=this,n=new b,a=0;a<e.getNumGeometries();a++){var s=r.transform(e.getGeometryN(a));s!==null&&(r._pruneEmptyGeometry&&s.isEmpty()||n.add(s))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(H.toGeometryArray(n)):this._factory.buildGeometry(n)};fe.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof de)return this.transformPoint(e,null);if(e instanceof Ni)return this.transformMultiPoint(e,null);if(e instanceof Ln)return this.transformLinearRing(e,null);if(e instanceof pt)return this.transformLineString(e,null);if(e instanceof Lr)return this.transformMultiLineString(e,null);if(e instanceof Rt)return this.transformPolygon(e,null);if(e instanceof xn)return this.transformMultiPolygon(e,null);if(e instanceof ne)return this.transformGeometryCollection(e,null);throw new ct("Unknown Geometry subtype: "+e.getClass().getName())};fe.prototype.transformLinearRing=function(e,t){var r=this.transformCoordinates(e.getCoordinateSequence(),e);if(r===null)return this._factory.createLinearRing(null);var n=r.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};var Dn=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new F,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof pt&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1];e.call(this,t.getCoordinates(),r)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var n=arguments[0],a=arguments[1];this._srcPts=n,this._isClosed=e.isClosed(n),this._snapTolerance=a}};Dn.prototype.snapVertices=function(e,t){for(var r=this,n=this._isClosed?e.size()-1:e.size(),a=0;a<n;a++){var s=e.get(a),f=r.findSnapForVertex(s,t);f!==null&&(e.set(a,new v(f)),a===0&&r._isClosed&&e.set(e.size()-1,new v(f)))}};Dn.prototype.findSnapForVertex=function(e,t){for(var r=this,n=0;n<t.length;n++){if(e.equals2D(t[n]))return null;if(e.distance(t[n])<r._snapTolerance)return t[n]}return null};Dn.prototype.snapTo=function(e){var t=new po(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var r=t.toCoordinateArray();return r};Dn.prototype.snapSegments=function(e,t){var r=this;if(t.length===0)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var a=0;a<n;a++){var s=t[a],f=r.findSegmentIndexToSnap(s,e);f>=0&&e.add(f+1,new v(s),!1)}};Dn.prototype.findSegmentIndexToSnap=function(e,t){for(var r=this,n=z.MAX_VALUE,a=-1,s=0;s<t.size()-1;s++){if(r._seg.p0=t.get(s),r._seg.p1=t.get(s+1),r._seg.p0.equals2D(e)||r._seg.p1.equals2D(e)){if(r._allowSnappingToSourceVertices)continue;return-1}var f=r._seg.distance(e);f<r._snapTolerance&&f<n&&(n=f,a=s)}return a};Dn.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var mt=function(e){this._srcGeom=e||null},Pu={SNAP_PRECISION_FACTOR:{configurable:!0}};mt.prototype.snapTo=function(e,t){var r=this.extractTargetCoordinates(e),n=new Ru(t,r);return n.transform(this._srcGeom)};mt.prototype.snapToSelf=function(e,t){var r=this.extractTargetCoordinates(this._srcGeom),n=new Ru(e,r,!0),a=n.transform(this._srcGeom),s=a;return t&&G(s,ur)&&(s=a.buffer(0)),s};mt.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),r=t/10;return r};mt.prototype.extractTargetCoordinates=function(e){for(var t=new an,r=e.getCoordinates(),n=0;n<r.length;n++)t.add(r[n]);return t.toArray(new Array(0).fill(null))};mt.prototype.computeMinimumSegmentLength=function(e){for(var t=z.MAX_VALUE,r=0;r<e.length-1;r++){var n=e[r].distance(e[r+1]);n<t&&(t=n)}return t};mt.prototype.interfaces_=function(){return[]};mt.prototype.getClass=function(){return mt};mt.snap=function(e,t,r){var n=new Array(2).fill(null),a=new mt(e);n[0]=a.snapTo(t,r);var s=new mt(t);return n[1]=s.snapTo(n[0],r),n};mt.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=mt.computeSizeBasedSnapTolerance(e),r=e.getPrecisionModel();if(r.getType()===$.FIXED){var n=1/r.getScale()*2/1.415;n>t&&(t=n)}return t}else if(arguments.length===2){var a=arguments[0],s=arguments[1];return Math.min(mt.computeOverlaySnapTolerance(a),mt.computeOverlaySnapTolerance(s))}};mt.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),r=Math.min(t.getHeight(),t.getWidth()),n=r*mt.SNAP_PRECISION_FACTOR;return n};mt.snapToSelf=function(e,t,r){var n=new mt(e);return n.snapToSelf(t,r)};Pu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(mt,Pu);var Ru=function(e){function t(r,n,a){e.call(this),this._snapTolerance=r||null,this._snapPts=n||null,this._isSelfSnap=a!==void 0?a:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(r,n){var a=new Dn(r,this._snapTolerance);return a.setAllowSnappingToSourceVertices(this._isSelfSnap),a.snapTo(n)},t.prototype.transformCoordinates=function(r,n){var a=r.toCoordinateArray(),s=this.snapLine(a,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fe),Jt=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Jt.prototype.getCommon=function(){return z.longBitsToDouble(this._commonBits)};Jt.prototype.add=function(e){var t=z.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=Jt.signExpBits(this._commonBits),this._isFirst=!1,null;var r=Jt.signExpBits(t);if(r!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Jt.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=Jt.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Jt.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=z.longBitsToDouble(e),r=z.toBinaryString(e),n="0000000000000000000000000000000000000000000000000000000000000000"+r,a=n.substring(n.length-64),s=a.substring(0,1)+"  "+a.substring(1,12)+"(exp) "+a.substring(12)+" [ "+t+" ]";return s}};Jt.prototype.interfaces_=function(){return[]};Jt.prototype.getClass=function(){return Jt};Jt.getBit=function(e,t){var r=1<<t;return e&r?1:0};Jt.signExpBits=function(e){return e>>52};Jt.zeroLowerBits=function(e,t){var r=(1<<t)-1,n=~r,a=e&n;return a};Jt.numCommonMostSigMantissaBits=function(e,t){for(var r=0,n=52;n>=0;n--){if(Jt.getBit(e,n)!==Jt.getBit(t,n))return r;r++}return 52};var dr=function(){this._commonCoord=null,this._ccFilter=new oi},js={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};dr.prototype.addCommonBits=function(e){var t=new vr(this._commonCoord);e.apply(t),e.geometryChanged()};dr.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new v(this._commonCoord);t.x=-t.x,t.y=-t.y;var r=new vr(t);return e.apply(r),e.geometryChanged(),e};dr.prototype.getCommonCoordinate=function(){return this._commonCoord};dr.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};js.CommonCoordinateFilter.get=function(){return oi};js.Translater.get=function(){return vr};Object.defineProperties(dr,js);var oi=function(){this._commonBitsX=new Jt,this._commonBitsY=new Jt};oi.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};oi.prototype.getCommonCoordinate=function(){return new v(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};oi.prototype.interfaces_=function(){return[wn]};oi.prototype.getClass=function(){return oi};var vr=function(){this.trans=null;var e=arguments[0];this.trans=e};vr.prototype.filter=function(e,t){var r=e.getOrdinate(t,0)+this.trans.x,n=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,r),e.setOrdinate(t,1,n)};vr.prototype.isDone=function(){return!1};vr.prototype.isGeometryChanged=function(){return!0};vr.prototype.interfaces_=function(){return[Xe]};vr.prototype.getClass=function(){return vr};var At=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};At.prototype.selfSnap=function(e){var t=new mt(e),r=t.snapTo(e,this._snapTolerance);return r};At.prototype.removeCommonBits=function(e){this._cbr=new dr,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};At.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};At.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),r=V.overlayOp(t[0],t[1],e);return this.prepareResult(r)};At.prototype.checkValid=function(e){e.isValid()||Ut.out.println("Snapped geometry is invalid")};At.prototype.computeSnapTolerance=function(){this._snapTolerance=mt.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};At.prototype.snap=function(e){var t=this.removeCommonBits(e),r=mt.snap(t[0],t[1],this._snapTolerance);return r};At.prototype.interfaces_=function(){return[]};At.prototype.getClass=function(){return At};At.overlayOp=function(e,t,r){var n=new At(e,t);return n.getResultGeometry(r)};At.union=function(e,t){return At.overlayOp(e,t,V.UNION)};At.intersection=function(e,t){return At.overlayOp(e,t,V.INTERSECTION)};At.symDifference=function(e,t){return At.overlayOp(e,t,V.SYMDIFFERENCE)};At.difference=function(e,t){return At.overlayOp(e,t,V.DIFFERENCE)};var oe=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};oe.prototype.getResultGeometry=function(e){var t=null,r=!1,n=null;try{t=V.overlayOp(this._geom[0],this._geom[1],e);var a=!0;a&&(r=!0)}catch(s){if(s instanceof Kn)n=s;else throw s}finally{}if(!r)try{t=At.overlayOp(this._geom[0],this._geom[1],e)}catch(s){throw s instanceof Kn?n:s}finally{}return t};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.overlayOp=function(e,t,r){var n=new oe(e,t);return n.getResultGeometry(r)};oe.union=function(e,t){return oe.overlayOp(e,t,V.UNION)};oe.intersection=function(e,t){return oe.overlayOp(e,t,V.INTERSECTION)};oe.symDifference=function(e,t){return oe.overlayOp(e,t,V.SYMDIFFERENCE)};oe.difference=function(e,t){return oe.overlayOp(e,t,V.DIFFERENCE)};var lo=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};lo.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};lo.prototype.interfaces_=function(){return[]};lo.prototype.getClass=function(){return lo};var me=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],r=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=r}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];this._eventType=e.INSERT,this._label=n,this._xValue=a,this._obj=s}},Ks={INSERT:{configurable:!0},DELETE:{configurable:!0}};me.prototype.isDelete=function(){return this._eventType===me.DELETE};me.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};me.prototype.getObject=function(){return this._obj};me.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};me.prototype.getInsertEvent=function(){return this._insertEvent};me.prototype.isInsert=function(){return this._eventType===me.INSERT};me.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};me.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};me.prototype.interfaces_=function(){return[ke]};me.prototype.getClass=function(){return me};Ks.INSERT.get=function(){return 1};Ks.DELETE.get=function(){return 2};Object.defineProperties(me,Ks);var zo=function(){};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};var Yt=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],r=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=r};Yt.prototype.isTrivialIntersection=function(e,t,r,n){if(e===r&&this._li.getIntersectionNum()===1){if(Yt.isAdjacentSegments(t,n))return!0;if(e.isClosed()){var a=e.getNumPoints()-1;if(t===0&&n===a||n===0&&t===a)return!0}}return!1};Yt.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Yt.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Yt.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Yt.prototype.isBoundaryPointInternal=function(e,t){for(var r=t.iterator();r.hasNext();){var n=r.next(),a=n.getCoordinate();if(e.isIntersection(a))return!0}return!1};Yt.prototype.hasProperIntersection=function(){return this._hasProper};Yt.prototype.hasIntersection=function(){return this._hasIntersection};Yt.prototype.isDone=function(){return this._isDone};Yt.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};Yt.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};Yt.prototype.addIntersections=function(e,t,r,n){if(e===r&&t===n)return null;this.numTests++;var a=e.getCoordinates()[t],s=e.getCoordinates()[t+1],f=r.getCoordinates()[n],o=r.getCoordinates()[n+1];this._li.computeIntersection(a,s,f,o),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,r,n)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Yt.prototype.interfaces_=function(){return[]};Yt.prototype.getClass=function(){return Yt};Yt.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var Fc=function(e){function t(){e.call(this),this.events=new b,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var r=this;He.sort(this.events);for(var n=0;n<this.events.size();n++){var a=r.events.get(n);a.isDelete()&&a.getInsertEvent().setDeleteEventIndex(n)}},t.prototype.computeIntersections=function(){var r=this;if(arguments.length===1){var n=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var a=0;a<this.events.size();a++){var s=r.events.get(a);if(s.isInsert()&&r.processOverlaps(a,s.getDeleteEventIndex(),s,n),n.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Yt&&G(arguments[0],Ue)&&G(arguments[1],Ue)){var f=arguments[0],o=arguments[1],x=arguments[2];this.addEdges(f,f),this.addEdges(o,o),this.computeIntersections(x)}else if(typeof arguments[2]=="boolean"&&G(arguments[0],Ue)&&arguments[1]instanceof Yt){var C=arguments[0],P=arguments[1],ge=arguments[2];ge?this.addEdges(C,null):this.addEdges(C),this.computeIntersections(P)}}},t.prototype.addEdge=function(r,n){for(var a=this,s=r.getMonotoneChainEdge(),f=s.getStartIndexes(),o=0;o<f.length-1;o++){var x=new lo(s,o),C=new me(n,s.getMinX(o),x);a.events.add(C),a.events.add(new me(s.getMaxX(o),C))}},t.prototype.processOverlaps=function(r,n,a,s){for(var f=this,o=a.getObject(),x=r;x<n;x++){var C=f.events.get(x);if(C.isInsert()){var P=C.getObject();a.isSameLabel(C)||(o.computeIntersections(P,s),f.nOverlaps++)}}},t.prototype.addEdges=function(){var r=this;if(arguments.length===1)for(var n=arguments[0],a=n.iterator();a.hasNext();){var s=a.next();r.addEdge(s,s)}else if(arguments.length===2)for(var f=arguments[0],o=arguments[1],x=f.iterator();x.hasNext();){var C=x.next();r.addEdge(C,o)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(zo),Tn=function(){this._min=z.POSITIVE_INFINITY,this._max=z.NEGATIVE_INFINITY},Ou={NodeComparator:{configurable:!0}};Tn.prototype.getMin=function(){return this._min};Tn.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};Tn.prototype.getMax=function(){return this._max};Tn.prototype.toString=function(){return qe.toLineString(new v(this._min,0),new v(this._max,0))};Tn.prototype.interfaces_=function(){return[]};Tn.prototype.getClass=function(){return Tn};Ou.NodeComparator.get=function(){return co};Object.defineProperties(Tn,Ou);var co=function(){};co.prototype.compare=function(e,t){var r=e,n=t,a=(r._min+r._max)/2,s=(n._min+n._max)/2;return a<s?-1:a>s?1:0};co.prototype.interfaces_=function(){return[vi]};co.prototype.getClass=function(){return co};var Bc=function(e){function t(){e.call(this),this._item=null;var r=arguments[0],n=arguments[1],a=arguments[2];this._min=r,this._max=n,this._item=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(r,n,a){if(!this.intersects(r,n))return null;a.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tn),kc=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var r=arguments[0],n=arguments[1];this._node1=r,this._node2=n,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(r,n){this._min=Math.min(r._min,n._min),this._max=Math.max(r._max,n._max)},t.prototype.query=function(r,n,a){if(!this.intersects(r,n))return null;this._node1!==null&&this._node1.query(r,n,a),this._node2!==null&&this._node2.query(r,n,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tn),Mn=function(){this._leaves=new b,this._root=null,this._level=0};Mn.prototype.buildTree=function(){var e=this;He.sort(this._leaves,new Tn.NodeComparator);for(var t=this._leaves,r=null,n=new b;;){if(e.buildLevel(t,n),n.size()===1)return n.get(0);r=t,t=n,n=r}};Mn.prototype.insert=function(e,t,r){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Bc(e,t,r))};Mn.prototype.query=function(e,t,r){this.init(),this._root.query(e,t,r)};Mn.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Mn.prototype.printNode=function(e){Ut.out.println(qe.toLineString(new v(e._min,this._level),new v(e._max,this._level)))};Mn.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Mn.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var r=0;r<e.size();r+=2){var n=e.get(r),a=r+1<e.size()?e.get(r):null;if(a===null)t.add(n);else{var s=new kc(e.get(r),e.get(r+1));t.add(s)}}};Mn.prototype.interfaces_=function(){return[]};Mn.prototype.getClass=function(){return Mn};var Pi=function(){this._items=new b};Pi.prototype.visitItem=function(e){this._items.add(e)};Pi.prototype.getItems=function(){return this._items};Pi.prototype.interfaces_=function(){return[lr]};Pi.prototype.getClass=function(){return Pi};var Ri=function(){this._index=null;var e=arguments[0];if(!G(e,ur))throw new ct("Argument must be Polygonal");this._index=new Mr(e)},Qs={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Ri.prototype.locate=function(e){var t=new rn(e),r=new Oi(t);return this._index.query(e.y,e.y,r),t.getLocation()};Ri.prototype.interfaces_=function(){return[Li]};Ri.prototype.getClass=function(){return Ri};Qs.SegmentVisitor.get=function(){return Oi};Qs.IntervalIndexedGeometry.get=function(){return Mr};Object.defineProperties(Ri,Qs);var Oi=function(){this._counter=null;var e=arguments[0];this._counter=e};Oi.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Oi.prototype.interfaces_=function(){return[lr]};Oi.prototype.getClass=function(){return Oi};var Mr=function(){this._index=new Mn;var e=arguments[0];this.init(e)};Mr.prototype.init=function(e){for(var t=this,r=kt.getLines(e),n=r.iterator();n.hasNext();){var a=n.next(),s=a.getCoordinates();t.addLine(s)}};Mr.prototype.addLine=function(e){for(var t=this,r=1;r<e.length;r++){var n=new F(e[r-1],e[r]),a=Math.min(n.p0.y,n.p1.y),s=Math.max(n.p0.y,n.p1.y);t._index.insert(a,s,n)}};Mr.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new Pi;return this._index.query(e,t,r),r.getItems()}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2];this._index.query(n,a,s)}};Mr.prototype.interfaces_=function(){return[]};Mr.prototype.getClass=function(){return Mr};var Xi=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new pu,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new je,arguments.length===2){var r=arguments[0],n=arguments[1],a=Me.OGC_SFS_BOUNDARY_RULE;this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=a,n!==null&&this.add(n)}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2];this._argIndex=s,this._parentGeom=f,this._boundaryNodeRule=o,f!==null&&this.add(f)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(r,n){var a=this._nodes.addNode(n),s=a.getLabel(),f=1,o=m.NONE;o=s.getLocation(r,w.ON),o===m.BOUNDARY&&f++;var x=t.determineBoundary(this._boundaryNodeRule,f);s.setLocation(r,x)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.computeSelfNodes(r,n,!1)}else if(arguments.length===3){var a=arguments[0],s=arguments[1],f=arguments[2],o=new Yt(a,!0,!1);o.setIsDoneIfProperInt(f);var x=this.createEdgeSetIntersector(),C=this._parentGeom instanceof Ln||this._parentGeom instanceof Rt||this._parentGeom instanceof xn,P=s||!C;return x.computeIntersections(this._edges,o,P),this.addSelfIntersectionNodes(this._argIndex),o}},t.prototype.computeSplitEdges=function(r){for(var n=this._edges.iterator();n.hasNext();){var a=n.next();a.eiList.addSplitEdges(r)}},t.prototype.computeEdgeIntersections=function(r,n,a){var s=new Yt(n,a,!0);s.setBoundaryNodes(this.getBoundaryNodes(),r.getBoundaryNodes());var f=this.createEdgeSetIntersector();return f.computeIntersections(this._edges,r._edges,s),s},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof de){var r=arguments[0],n=r.getCoordinate();this.insertPoint(this._argIndex,n,m.INTERIOR)}else if(arguments[0]instanceof v){var a=arguments[0];this.insertPoint(this._argIndex,a,m.INTERIOR)}},t.prototype.addPolygon=function(r){var n=this;this.addPolygonRing(r.getExteriorRing(),m.EXTERIOR,m.INTERIOR);for(var a=0;a<r.getNumInteriorRing();a++){var s=r.getInteriorRingN(a);n.addPolygonRing(s,m.INTERIOR,m.EXTERIOR)}},t.prototype.addEdge=function(r){this.insertEdge(r);var n=r.getCoordinates();this.insertPoint(this._argIndex,n[0],m.BOUNDARY),this.insertPoint(this._argIndex,n[n.length-1],m.BOUNDARY)},t.prototype.addLineString=function(r){var n=W.removeRepeatedPoints(r.getCoordinates());if(n.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var a=new Go(n,new et(this._argIndex,m.INTERIOR));this._lineEdgeMap.put(r,a),this.insertEdge(a),U.isTrue(n.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,n[0]),this.insertBoundaryPoint(this._argIndex,n[n.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var r=this.getBoundaryNodes(),n=new Array(r.size()).fill(null),a=0,s=r.iterator();s.hasNext();){var f=s.next();n[a++]=f.getCoordinate().copy()}return n},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(r,n,a){if(this.isBoundaryNode(r,n))return null;a===m.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(r,n):this.insertPoint(r,n,a)},t.prototype.addPolygonRing=function(r,n,a){if(r.isEmpty())return null;var s=W.removeRepeatedPoints(r.getCoordinates());if(s.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=s[0],null;var f=n,o=a;O.isCCW(s)&&(f=a,o=n);var x=new Go(s,new et(this._argIndex,m.BOUNDARY,f,o));this._lineEdgeMap.put(r,x),this.insertEdge(x),this.insertPoint(this._argIndex,s[0],m.BOUNDARY)},t.prototype.insertPoint=function(r,n,a){var s=this._nodes.addNode(n),f=s.getLabel();f===null?s._label=new et(r,a):f.setLocation(r,a)},t.prototype.createEdgeSetIntersector=function(){return new Fc},t.prototype.addSelfIntersectionNodes=function(r){for(var n=this,a=this._edges.iterator();a.hasNext();)for(var s=a.next(),f=s.getLabel().getLocation(r),o=s.eiList.iterator();o.hasNext();){var x=o.next();n.addSelfIntersectionNode(r,x.coord,f)}},t.prototype.add=function(){if(arguments.length===1){var r=arguments[0];if(r.isEmpty())return null;if(r instanceof xn&&(this._useBoundaryDeterminationRule=!1),r instanceof Rt)this.addPolygon(r);else if(r instanceof pt)this.addLineString(r);else if(r instanceof de)this.addPoint(r);else if(r instanceof Ni)this.addCollection(r);else if(r instanceof Lr)this.addCollection(r);else if(r instanceof xn)this.addCollection(r);else if(r instanceof ne)this.addCollection(r);else throw new Error(r.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(r){for(var n=this,a=0;a<r.getNumGeometries();a++){var s=r.getGeometryN(a);n.add(s)}},t.prototype.locate=function(r){return G(this._parentGeom,ur)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Ri(this._parentGeom)),this._areaPtLocator.locate(r)):this._ptLocator.locate(r,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var r=arguments[0];return this._lineEdgeMap.get(r)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(r,n){return r.isInBoundary(n)?m.BOUNDARY:m.INTERIOR},t}(ht),Di=function(){if(this._li=new zr,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Xi(0,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=Me.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Xi(0,t,n),this._arg[1]=new Xi(1,r,n)}else if(arguments.length===3){var a=arguments[0],s=arguments[1],f=arguments[2];a.getPrecisionModel().compareTo(s.getPrecisionModel())>=0?this.setComputationPrecision(a.getPrecisionModel()):this.setComputationPrecision(s.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Xi(0,a,f),this._arg[1]=new Xi(1,s,f)}};Di.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Di.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};var xr=function(){};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.map=function(){if(arguments[0]instanceof k&&G(arguments[1],xr.MapOp)){for(var e=arguments[0],t=arguments[1],r=new b,n=0;n<e.getNumGeometries();n++){var a=t.map(e.getGeometryN(n));a!==null&&r.add(a)}return e.getFactory().buildGeometry(r)}else if(G(arguments[0],wt)&&G(arguments[1],xr.MapOp)){for(var s=arguments[0],f=arguments[1],o=new b,x=s.iterator();x.hasNext();){var C=x.next(),P=f.map(C);P!==null&&o.add(P)}return o}};xr.MapOp=function(){};var V=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n),this._ptLocator=new je,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new We,this._resultPolyList=new b,this._resultLineList=new b,this._resultPointList=new b,this._graph=new ht(new Cu),this._geomFact=r.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(r){var n=this._edgeList.findEqualEdge(r);if(n!==null){var a=n.getLabel(),s=r.getLabel();n.isPointwiseEqual(r)||(s=new et(r.getLabel()),s.flip());var f=n.getDepth();f.isNull()&&f.add(a),f.add(s),a.merge(s)}else this._edgeList.add(r)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var n=r.next(),a=n.getSym();n.isInResult()&&a.isInResult()&&(n.setInResult(!1),a.setInResult(!1))}},t.prototype.isCoveredByLA=function(r){return!!(this.isCovered(r,this._resultLineList)||this.isCovered(r,this._resultPolyList))},t.prototype.computeGeometry=function(r,n,a,s){var f=new b;return f.addAll(r),f.addAll(n),f.addAll(a),f.isEmpty()?t.createEmptyResult(s,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(f)},t.prototype.mergeSymLabels=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var n=r.next();n.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(r,n){for(var a=this,s=n.iterator();s.hasNext();){var f=s.next(),o=a._ptLocator.locate(r,f);if(o!==m.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var r=new b,n=this._edgeList.iterator();n.hasNext();){var a=n.next();a.isCollapsed()&&(n.remove(),r.add(a.getCollapsedEdge()))}this._edgeList.addAll(r)},t.prototype.updateNodeLabelling=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var n=r.next(),a=n.getEdges().getLabel();n.getLabel().merge(a)}},t.prototype.getResultGeometry=function(r){return this.computeOverlay(r),this._resultGeom},t.prototype.insertUniqueEdges=function(r){for(var n=this,a=r.iterator();a.hasNext();){var s=a.next();n.insertUniqueEdge(s)}},t.prototype.computeOverlay=function(r){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var n=new b;this._arg[0].computeSplitEdges(n),this._arg[1].computeSplitEdges(n),this.insertUniqueEdges(n),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Tr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(r),this.cancelDuplicateResultEdges();var a=new ve(this._geomFact);a.add(this._graph),this._resultPolyList=a.getPolygons();var s=new dn(this,this._geomFact,this._ptLocator);this._resultLineList=s.build(r);var f=new ii(this,this._geomFact,this._ptLocator);this._resultPointList=f.build(r),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,r)},t.prototype.labelIncompleteNode=function(r,n){var a=this._ptLocator.locate(r.getCoordinate(),this._arg[n].getGeometry());r.getLabel().setLocation(n,a)},t.prototype.copyPoints=function(r){for(var n=this,a=this._arg[r].getNodeIterator();a.hasNext();){var s=a.next(),f=n._graph.addNode(s.getCoordinate());f.setLabel(r,s.getLabel().getLocation(r))}},t.prototype.findResultAreaEdges=function(r){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var a=n.next(),s=a.getLabel();s.isArea()&&!a.isInteriorAreaEdge()&&t.isResultOfOp(s.getLocation(0,w.RIGHT),s.getLocation(1,w.RIGHT),r)&&a.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var r=this._edgeList.iterator();r.hasNext();){var n=r.next(),a=n.getLabel(),s=n.getDepth();if(!s.isNull()){s.normalize();for(var f=0;f<2;f++)!a.isNull(f)&&a.isArea()&&!s.isNull(f)&&(s.getDelta(f)===0?a.toLine(f):(U.isTrue(!s.isNull(f,w.LEFT),"depth of LEFT side has not been initialized"),a.setLocation(f,w.LEFT,s.getLocation(f,w.LEFT)),U.isTrue(!s.isNull(f,w.RIGHT),"depth of RIGHT side has not been initialized"),a.setLocation(f,w.RIGHT,s.getLocation(f,w.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var r=this,n=this._graph.getNodes().iterator();n.hasNext();){var a=n.next();a.getEdges().computeLabelling(r._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var r=this,n=this._graph.getNodes().iterator();n.hasNext();){var a=n.next(),s=a.getLabel();a.isIsolated()&&(s.isNull(0)?r.labelIncompleteNode(a,0):r.labelIncompleteNode(a,1)),a.getEdges().updateLabelling(s)}},t.prototype.isCoveredByA=function(r){return!!this.isCovered(r,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Di);V.overlayOp=function(e,t,r){var n=new V(e,t),a=n.getResultGeometry(r);return a};V.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return V.createEmptyResult(V.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var r=t;return ri.map(e,{interfaces_:function(){return[xr.MapOp]},map:function(n){return n.intersection(r)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.INTERSECTION)};V.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return V.createEmptyResult(V.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.SYMDIFFERENCE)};V.resultDimension=function(e,t,r){var n=t.getDimension(),a=r.getDimension(),s=-1;switch(e){case V.INTERSECTION:s=Math.min(n,a);break;case V.UNION:s=Math.max(n,a);break;case V.DIFFERENCE:s=n;break;case V.SYMDIFFERENCE:s=Math.max(n,a);break}return s};V.createEmptyResult=function(e,t,r,n){var a=null;switch(V.resultDimension(e,t,r)){case-1:a=n.createGeometryCollection(new Array(0).fill(null));break;case 0:a=n.createPoint();break;case 1:a=n.createLineString();break;case 2:a=n.createPolygon();break}return a};V.difference=function(e,t){return e.isEmpty()?V.createEmptyResult(V.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.DIFFERENCE))};V.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=e.getLocation(0),n=e.getLocation(1);return V.isResultOfOp(r,n,t)}else if(arguments.length===3){var a=arguments[0],s=arguments[1],f=arguments[2];switch(a===m.BOUNDARY&&(a=m.INTERIOR),s===m.BOUNDARY&&(s=m.INTERIOR),f){case V.INTERSECTION:return a===m.INTERIOR&&s===m.INTERIOR;case V.UNION:return a===m.INTERIOR||s===m.INTERIOR;case V.DIFFERENCE:return a===m.INTERIOR&&s!==m.INTERIOR;case V.SYMDIFFERENCE:return a===m.INTERIOR&&s!==m.INTERIOR||a!==m.INTERIOR&&s===m.INTERIOR}return!1}};V.INTERSECTION=1;V.UNION=2;V.DIFFERENCE=3;V.SYMDIFFERENCE=4;var or=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new je,this._seg=new F;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};or.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,r=0;r<this._linework.getNumGeometries();r++)for(var n=t._linework.getGeometryN(r),a=n.getCoordinateSequence(),s=0;s<a.size()-1;s++){a.getCoordinate(s,t._seg.p0),a.getCoordinate(s+1,t._seg.p1);var f=t._seg.distance(e);if(f<=t._boundaryDistanceTolerance)return!0}return!1};or.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?m.BOUNDARY:this._ptLocator.locate(e,this._g)};or.prototype.extractLinework=function(e){var t=new Ti;e.apply(t);var r=t.getLinework(),n=H.toLineStringArray(r);return e.getFactory().createMultiLineString(n)};or.prototype.interfaces_=function(){return[]};or.prototype.getClass=function(){return or};var Ti=function(){this._linework=null,this._linework=new b};Ti.prototype.getLinework=function(){return this._linework};Ti.prototype.filter=function(e){var t=this;if(e instanceof Rt){var r=e;this._linework.add(r.getExteriorRing());for(var n=0;n<r.getNumInteriorRing();n++)t._linework.add(r.getInteriorRingN(n))}};Ti.prototype.interfaces_=function(){return[un]};Ti.prototype.getClass=function(){return Ti};var Ar=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};Ar.prototype.extractPoints=function(e,t,r){for(var n=this,a=e.getCoordinates(),s=0;s<a.length-1;s++)n.computeOffsetPoints(a[s],a[s+1],t,r)};Ar.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};Ar.prototype.getPoints=function(e){for(var t=this,r=new b,n=kt.getLines(this._g),a=n.iterator();a.hasNext();){var s=a.next();t.extractPoints(s,e,r)}return r};Ar.prototype.computeOffsetPoints=function(e,t,r,n){var a=t.x-e.x,s=t.y-e.y,f=Math.sqrt(a*a+s*s),o=r*a/f,x=r*s/f,C=(t.x+e.x)/2,P=(t.y+e.y)/2;if(this._doLeft){var ge=new v(C-x,P+o);n.add(ge)}if(this._doRight){var nt=new v(C+x,P-o);n.add(nt)}};Ar.prototype.interfaces_=function(){return[]};Ar.prototype.getClass=function(){return Ar};var be=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new b;var t=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,r),this._geom=[t,r,n],this._locFinder=[new or(this._geom[0],this._boundaryDistanceTolerance),new or(this._geom[1],this._boundaryDistanceTolerance),new or(this._geom[2],this._boundaryDistanceTolerance)]},Du={TOLERANCE:{configurable:!0}};be.prototype.reportResult=function(e,t,r){Ut.out.println("Overlay result invalid - A:"+m.toLocationSymbol(t[0])+" B:"+m.toLocationSymbol(t[1])+" expected:"+(r?"i":"e")+" actual:"+m.toLocationSymbol(t[2]))};be.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};be.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],r=0;r<this._testCoords.size();r++){var n=e._testCoords.get(r);if(!e.checkValid(t,n))return e._invalidLocation=n,!1}return!0}else if(arguments.length===2){var a=arguments[0],s=arguments[1];return this._location[0]=this._locFinder[0].getLocation(s),this._location[1]=this._locFinder[1].getLocation(s),this._location[2]=this._locFinder[2].getLocation(s),be.hasLocation(this._location,m.BOUNDARY)?!0:this.isValidResult(a,this._location)}};be.prototype.addTestPts=function(e){var t=new Ar(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};be.prototype.isValidResult=function(e,t){var r=V.isResultOfOp(t[0],t[1],e),n=t[2]===m.INTERIOR,a=!(r^n);return a||this.reportResult(e,t,r),a};be.prototype.getInvalidLocation=function(){return this._invalidLocation};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};be.hasLocation=function(e,t){for(var r=0;r<3;r++)if(e[r]===t)return!0;return!1};be.computeBoundaryDistanceTolerance=function(e,t){return Math.min(mt.computeSizeBasedSnapTolerance(e),mt.computeSizeBasedSnapTolerance(t))};be.isValid=function(e,t,r,n){var a=new be(e,t,n);return a.isValid(r)};Du.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(be,Du);var Ie=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Ie.prototype.extractElements=function(e,t){var r=this;if(e===null)return null;for(var n=0;n<e.getNumGeometries();n++){var a=e.getGeometryN(n);r._skipEmpty&&a.isEmpty()||t.add(a)}};Ie.prototype.combine=function(){for(var e=this,t=new b,r=this._inputGeoms.iterator();r.hasNext();){var n=r.next();e.extractElements(n,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Ie.prototype.interfaces_=function(){return[]};Ie.prototype.getClass=function(){return Ie};Ie.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Ie(e);return t.combine()}else if(arguments.length===2){var r=arguments[0],n=arguments[1],a=new Ie(Ie.createList(r,n));return a.combine()}else if(arguments.length===3){var s=arguments[0],f=arguments[1],o=arguments[2],x=new Ie(Ie.createList(s,f,o));return x.combine()}};Ie.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Ie.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new b;return r.add(e),r.add(t),r}else if(arguments.length===3){var n=arguments[0],a=arguments[1],s=arguments[2],f=new b;return f.add(n),f.add(a),f.add(s),f}};var Nt=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new b)},Tu={STRTREE_NODE_CAPACITY:{configurable:!0}};Nt.prototype.reduceToGeometries=function(e){for(var t=this,r=new b,n=e.iterator();n.hasNext();){var a=n.next(),s=null;G(a,Ue)?s=t.unionTree(a):a instanceof k&&(s=a),r.add(s)}return r};Nt.prototype.extractByEnvelope=function(e,t,r){for(var n=new b,a=0;a<t.getNumGeometries();a++){var s=t.getGeometryN(a);s.getEnvelopeInternal().intersects(e)?n.add(s):r.add(s)}return this._geomFactory.buildGeometry(n)};Nt.prototype.unionOptimized=function(e,t){var r=e.getEnvelopeInternal(),n=t.getEnvelopeInternal();if(!r.intersects(n)){var a=Ie.combine(e,t);return a}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var s=r.intersection(n);return this.unionUsingEnvelopeIntersection(e,t,s)};Nt.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new mu(Nt.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var r=t.next();e.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var n=e.itemsTree(),a=this.unionTree(n);return a};Nt.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2];if(n-r<=1){var a=Nt.getGeometry(t,r);return this.unionSafe(a,null)}else{if(n-r===2)return this.unionSafe(Nt.getGeometry(t,r),Nt.getGeometry(t,r+1));var s=Math.trunc((n+r)/2),f=this.binaryUnion(t,r,s),o=this.binaryUnion(t,s,n);return this.unionSafe(f,o)}}};Nt.prototype.repeatedUnion=function(e){for(var t=null,r=e.iterator();r.hasNext();){var n=r.next();t===null?t=n.copy():t=t.union(n)}return t};Nt.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};Nt.prototype.unionActual=function(e,t){return Nt.restrictToPolygons(e.union(t))};Nt.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),r=this.binaryUnion(t);return r};Nt.prototype.unionUsingEnvelopeIntersection=function(e,t,r){var n=new b,a=this.extractByEnvelope(r,e,n),s=this.extractByEnvelope(r,t,n),f=this.unionActual(a,s);n.add(f);var o=Ie.combine(n);return o};Nt.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),r=t.buildGeometry(e),n=r.buffer(0);return n}else if(arguments.length===2){var a=arguments[0],s=arguments[1],f=a.getFactory(),o=f.createGeometryCollection([a,s]),x=o.buffer(0);return x}};Nt.prototype.interfaces_=function(){return[]};Nt.prototype.getClass=function(){return Nt};Nt.restrictToPolygons=function(e){if(G(e,ur))return e;var t=Wn.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(H.toPolygonArray(t))};Nt.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};Nt.union=function(e){var t=new Nt(e);return t.union()};Tu.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Nt,Tu);var Vo=function(){};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};Vo.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return V.createEmptyResult(V.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oe.overlayOp(e,t,V.UNION)};function Vr(){return new Uo}function Uo(){this.reset()}Uo.prototype={constructor:Uo,reset:function(){this.s=this.t=0},add:function(e){ba(xo,e,this.t),ba(this,xo.s,this.s),this.s?this.t+=xo.t:this.s=xo.t},valueOf:function(){return this.s}};var xo=new Uo;function ba(e,t,r){var n=e.s=t+r,a=n-t,s=n-a;e.t=t-s+(r-a)}var gt=1e-6,ot=Math.PI,Hn=ot/2,Pa=ot/4,tr=ot*2,Er=180/ot,$e=ot/180,te=Math.abs,Gc=Math.atan,Mi=Math.atan2,Lt=Math.cos,bt=Math.sin,Eo=Math.sqrt;function Mu(e){return e>1?0:e<-1?ot:Math.acos(e)}function Ai(e){return e>1?Hn:e<-1?-Hn:Math.asin(e)}function Yi(){}function qo(e,t){e&&Oa.hasOwnProperty(e.type)&&Oa[e.type](e,t)}var Ra={Feature:function(e,t){qo(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,a=r.length;++n<a;)qo(r[n].geometry,t)}},Oa={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,a=r.length;++n<a;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ps(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,a=r.length;++n<a;)Ps(r[n],t,0)},Polygon:function(e,t){Da(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,a=r.length;++n<a;)Da(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,a=r.length;++n<a;)qo(r[n],t)}};function Ps(e,t,r){var n=-1,a=e.length-r,s;for(t.lineStart();++n<a;)s=e[n],t.point(s[0],s[1],s[2]);t.lineEnd()}function Da(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)Ps(e[r],t,1);t.polygonEnd()}function zc(e,t){e&&Ra.hasOwnProperty(e.type)?Ra[e.type](e,t):qo(e,t)}Vr();Vr();function Rs(e){return[Mi(e[1],e[0]),Ai(e[2])]}function Fi(e){var t=e[0],r=e[1],n=Lt(r);return[n*Lt(t),n*bt(t),bt(r)]}function So(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xo(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function ds(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function wo(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Os(e){var t=Eo(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}Vr();function Au(e,t){function r(n,a){return n=e(n,a),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,a){return n=t.invert(n,a),n&&e.invert(n[0],n[1])}),r}function Ds(e,t){return[e>ot?e-tr:e<-ot?e+tr:e,t]}Ds.invert=Ds;function Vc(e,t,r){return(e%=tr)?t||r?Au(Ma(e),Aa(t,r)):Ma(e):t||r?Aa(t,r):Ds}function Ta(e){return function(t,r){return t+=e,[t>ot?t-tr:t<-ot?t+tr:t,r]}}function Ma(e){var t=Ta(e);return t.invert=Ta(-e),t}function Aa(e,t){var r=Lt(e),n=bt(e),a=Lt(t),s=bt(t);function f(o,x){var C=Lt(x),P=Lt(o)*C,ge=bt(o)*C,nt=bt(x),ze=nt*r+P*n;return[Mi(ge*a-ze*s,P*r-nt*n),Ai(ze*a+ge*s)]}return f.invert=function(o,x){var C=Lt(x),P=Lt(o)*C,ge=bt(o)*C,nt=bt(x),ze=nt*a-ge*s;return[Mi(ge*a+nt*s,P*r+ze*n),Ai(ze*r-P*n)]},f}function Uc(e,t,r,n,a,s){if(r){var f=Lt(t),o=bt(t),x=n*r;a==null?(a=t+n*tr,s=t-x/2):(a=Fa(f,a),s=Fa(f,s),(n>0?a<s:a>s)&&(a+=n*tr));for(var C,P=a;n>0?P>s:P<s;P-=x)C=Rs([f,-o*Lt(P),-o*bt(P)]),e.point(C[0],C[1])}}function Fa(e,t){t=Fi(t),t[0]-=e,Os(t);var r=Mu(-t[1]);return((-t[2]<0?-r:r)+tr-gt)%tr}function Fu(){var e=[],t;return{point:function(r,n){t.push([r,n])},lineStart:function(){e.push(t=[])},lineEnd:Yi,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function qc(e,t,r,n,a,s){var f=e[0],o=e[1],x=t[0],C=t[1],P=0,ge=1,nt=x-f,ze=C-o,Bt;if(Bt=r-f,!(!nt&&Bt>0)){if(Bt/=nt,nt<0){if(Bt<P)return;Bt<ge&&(ge=Bt)}else if(nt>0){if(Bt>ge)return;Bt>P&&(P=Bt)}if(Bt=a-f,!(!nt&&Bt<0)){if(Bt/=nt,nt<0){if(Bt>ge)return;Bt>P&&(P=Bt)}else if(nt>0){if(Bt<P)return;Bt<ge&&(ge=Bt)}if(Bt=n-o,!(!ze&&Bt>0)){if(Bt/=ze,ze<0){if(Bt<P)return;Bt<ge&&(ge=Bt)}else if(ze>0){if(Bt>ge)return;Bt>P&&(P=Bt)}if(Bt=s-o,!(!ze&&Bt<0)){if(Bt/=ze,ze<0){if(Bt>ge)return;Bt>P&&(P=Bt)}else if(ze>0){if(Bt<P)return;Bt<ge&&(ge=Bt)}return P>0&&(e[0]=f+P*nt,e[1]=o+P*ze),ge<1&&(t[0]=f+ge*nt,t[1]=o+ge*ze),!0}}}}}function Do(e,t){return te(e[0]-t[0])<gt&&te(e[1]-t[1])<gt}function Lo(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Bu(e,t,r,n,a){var s=[],f=[],o,x;if(e.forEach(function(Bt){if(!((qr=Bt.length-1)<=0)){var qr,_n=Bt[0],Fn=Bt[qr],tl;if(Do(_n,Fn)){for(a.lineStart(),o=0;o<qr;++o)a.point((_n=Bt[o])[0],_n[1]);a.lineEnd();return}s.push(tl=new Lo(_n,Bt,null,!0)),f.push(tl.o=new Lo(_n,null,tl,!1)),s.push(tl=new Lo(Fn,Bt,null,!1)),f.push(tl.o=new Lo(Fn,null,tl,!0))}}),!!s.length){for(f.sort(t),Ba(s),Ba(f),o=0,x=f.length;o<x;++o)f[o].e=r=!r;for(var C=s[0],P,ge;;){for(var nt=C,ze=!0;nt.v;)if((nt=nt.n)===C)return;P=nt.z,a.lineStart();do{if(nt.v=nt.o.v=!0,nt.e){if(ze)for(o=0,x=P.length;o<x;++o)a.point((ge=P[o])[0],ge[1]);else n(nt.x,nt.n.x,1,a);nt=nt.n}else{if(ze)for(P=nt.p.z,o=P.length-1;o>=0;--o)a.point((ge=P[o])[0],ge[1]);else n(nt.x,nt.p.x,-1,a);nt=nt.p}nt=nt.o,P=nt.z,ze=!ze}while(!nt.v);a.lineEnd()}}}function Ba(e){if(t=e.length){for(var t,r=0,n=e[0],a;++r<t;)n.n=a=e[r],a.p=n,n=a;n.n=a=e[0],a.p=n}}function ku(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Xc(e){return e.length===1&&(e=Yc(e)),{left:function(t,r,n,a){for(n==null&&(n=0),a==null&&(a=t.length);n<a;){var s=n+a>>>1;e(t[s],r)<0?n=s+1:a=s}return n},right:function(t,r,n,a){for(n==null&&(n=0),a==null&&(a=t.length);n<a;){var s=n+a>>>1;e(t[s],r)>0?a=s:n=s+1}return n}}}function Yc(e){return function(t,r){return ku(e(t),r)}}Xc(ku);function Gu(e){for(var t=e.length,r,n=-1,a=0,s,f;++n<t;)a+=e[n].length;for(s=new Array(a);--t>=0;)for(f=e[t],r=f.length;--r>=0;)s[--a]=f[r];return s}var Hi=1e9,bo=-Hi;function Hc(e,t,r,n){function a(C,P){return e<=C&&C<=r&&t<=P&&P<=n}function s(C,P,ge,nt){var ze=0,Bt=0;if(C==null||(ze=f(C,ge))!==(Bt=f(P,ge))||x(C,P)<0^ge>0)do nt.point(ze===0||ze===3?e:r,ze>1?n:t);while((ze=(ze+ge+4)%4)!==Bt);else nt.point(P[0],P[1])}function f(C,P){return te(C[0]-e)<gt?P>0?0:3:te(C[0]-r)<gt?P>0?2:1:te(C[1]-t)<gt?P>0?1:0:P>0?3:2}function o(C,P){return x(C.x,P.x)}function x(C,P){var ge=f(C,1),nt=f(P,1);return ge!==nt?ge-nt:ge===0?P[1]-C[1]:ge===1?C[0]-P[0]:ge===2?C[1]-P[1]:P[0]-C[0]}return function(C){var P=C,ge=Fu(),nt,ze,Bt,qr,_n,Fn,tl,Io,Co,rl,ah,ch={point:ju,lineStart:hh,lineEnd:Sh,polygonStart:sl,polygonEnd:oh};function ju(hd,vd){a(hd,vd)&&P.point(hd,vd)}function Zu(){for(var hd=0,vd=0,Ef=ze.length;vd<Ef;++vd)for(var Cd=ze[vd],Cf=1,Sd=Cd.length,yd=Cd[0],Hd,xd,Pd=yd[0],zd=yd[1];Cf<Sd;++Cf)Hd=Pd,xd=zd,yd=Cd[Cf],Pd=yd[0],zd=yd[1],xd<=n?zd>n&&(Pd-Hd)*(n-xd)>(zd-xd)*(e-Hd)&&++hd:zd<=n&&(Pd-Hd)*(n-xd)<(zd-xd)*(e-Hd)&&--hd;return hd}function sl(){P=ge,nt=[],ze=[],ah=!0}function oh(){var hd=Zu(),vd=ah&&hd,Ef=(nt=Gu(nt)).length;(vd||Ef)&&(C.polygonStart(),vd&&(C.lineStart(),s(null,null,1,C),C.lineEnd()),Ef&&Bu(nt,o,hd,s,C),C.polygonEnd()),P=C,nt=ze=Bt=null}function hh(){ch.point=$h,ze&&ze.push(Bt=[]),rl=!0,Co=!1,tl=Io=NaN}function Sh(){nt&&($h(qr,_n),Fn&&Co&&ge.rejoin(),nt.push(ge.result())),ch.point=ju,Co&&P.lineEnd()}function $h(hd,vd){var Ef=a(hd,vd);if(ze&&Bt.push([hd,vd]),rl)qr=hd,_n=vd,Fn=Ef,rl=!1,Ef&&(P.lineStart(),P.point(hd,vd));else if(Ef&&Co)P.point(hd,vd);else{var Cd=[tl=Math.max(bo,Math.min(Hi,tl)),Io=Math.max(bo,Math.min(Hi,Io))],Cf=[hd=Math.max(bo,Math.min(Hi,hd)),vd=Math.max(bo,Math.min(Hi,vd))];qc(Cd,Cf,e,t,r,n)?(Co||(P.lineStart(),P.point(Cd[0],Cd[1])),P.point(Cf[0],Cf[1]),Ef||P.lineEnd(),ah=!1):Ef&&(P.lineStart(),P.point(hd,vd),ah=!1)}tl=hd,Io=vd,Co=Ef}return ch}}var vs=Vr();function Wc(e,t){var r=t[0],n=t[1],a=[bt(r),-Lt(r),0],s=0,f=0;vs.reset();for(var o=0,x=e.length;o<x;++o)if(P=(C=e[o]).length)for(var C,P,ge=C[P-1],nt=ge[0],ze=ge[1]/2+Pa,Bt=bt(ze),qr=Lt(ze),_n=0;_n<P;++_n,nt=tl,Bt=Co,qr=rl,ge=Fn){var Fn=C[_n],tl=Fn[0],Io=Fn[1]/2+Pa,Co=bt(Io),rl=Lt(Io),ah=tl-nt,ch=ah>=0?1:-1,ju=ch*ah,Zu=ju>ot,sl=Bt*Co;if(vs.add(Mi(sl*ch*bt(ju),qr*rl+sl*Lt(ju))),s+=Zu?ah+ch*tr:ah,Zu^nt>=r^tl>=r){var oh=Xo(Fi(ge),Fi(Fn));Os(oh);var hh=Xo(a,oh);Os(hh);var Sh=(Zu^ah>=0?-1:1)*Ai(hh[2]);(n>Sh||n===Sh&&(oh[0]||oh[1]))&&(f+=Zu^ah>=0?1:-1)}}return(s<-gt||s<gt&&vs<-gt)^f&1}Vr();function ka(e){return e}Vr();Vr();var Bi=1/0,Yo=Bi,fo=-Bi,Ho=fo,Ga={point:jc,lineStart:Yi,lineEnd:Yi,polygonStart:Yi,polygonEnd:Yi,result:function(){var e=[[Bi,Yo],[fo,Ho]];return fo=Ho=-(Yo=Bi=1/0),e}};function jc(e,t){e<Bi&&(Bi=e),e>fo&&(fo=e),t<Yo&&(Yo=t),t>Ho&&(Ho=t)}Vr();function zu(e,t,r,n){return function(a,s){var f=t(s),o=a.invert(n[0],n[1]),x=Fu(),C=t(x),P=!1,ge,nt,ze,Bt={point:qr,lineStart:Fn,lineEnd:tl,polygonStart:function(){Bt.point=Io,Bt.lineStart=Co,Bt.lineEnd=rl,nt=[],ge=[]},polygonEnd:function(){Bt.point=qr,Bt.lineStart=Fn,Bt.lineEnd=tl,nt=Gu(nt);var ah=Wc(ge,o);nt.length?(P||(s.polygonStart(),P=!0),Bu(nt,Qc,ah,r,s)):ah&&(P||(s.polygonStart(),P=!0),s.lineStart(),r(null,null,1,s),s.lineEnd()),P&&(s.polygonEnd(),P=!1),nt=ge=null},sphere:function(){s.polygonStart(),s.lineStart(),r(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function qr(ah,ch){var ju=a(ah,ch);e(ah=ju[0],ch=ju[1])&&s.point(ah,ch)}function _n(ah,ch){var ju=a(ah,ch);f.point(ju[0],ju[1])}function Fn(){Bt.point=_n,f.lineStart()}function tl(){Bt.point=qr,f.lineEnd()}function Io(ah,ch){ze.push([ah,ch]);var ju=a(ah,ch);C.point(ju[0],ju[1])}function Co(){C.lineStart(),ze=[]}function rl(){Io(ze[0][0],ze[0][1]),C.lineEnd();var ah=C.clean(),ch=x.result(),ju,Zu=ch.length,sl,oh,hh;if(ze.pop(),ge.push(ze),ze=null,!!Zu){if(ah&1){if(oh=ch[0],(sl=oh.length-1)>0){for(P||(s.polygonStart(),P=!0),s.lineStart(),ju=0;ju<sl;++ju)s.point((hh=oh[ju])[0],hh[1]);s.lineEnd()}return}Zu>1&&ah&2&&ch.push(ch.pop().concat(ch.shift())),nt.push(ch.filter(Kc))}}return Bt}}function Kc(e){return e.length>1}function Qc(e,t){return((e=e.x)[0]<0?e[1]-Hn-gt:Hn-e[1])-((t=t.x)[0]<0?t[1]-Hn-gt:Hn-t[1])}const za=zu(function(){return!0},Jc,$c,[-ot,-Hn]);function Jc(e){var t=NaN,r=NaN,n=NaN,a;return{lineStart:function(){e.lineStart(),a=1},point:function(s,f){var o=s>0?ot:-ot,x=te(s-t);te(x-ot)<gt?(e.point(t,r=(r+f)/2>0?Hn:-Hn),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(o,r),e.point(s,r),a=0):n!==o&&x>=ot&&(te(t-n)<gt&&(t-=n*gt),te(s-o)<gt&&(s-=o*gt),r=Zc(t,r,s,f),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(o,r),a=0),e.point(t=s,r=f),n=o},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-a}}}function Zc(e,t,r,n){var a,s,f=bt(e-r);return te(f)>gt?Gc((bt(t)*(s=Lt(n))*bt(r)-bt(n)*(a=Lt(t))*bt(e))/(a*s*f)):(t+n)/2}function $c(e,t,r,n){var a;if(e==null)a=r*Hn,n.point(-ot,a),n.point(0,a),n.point(ot,a),n.point(ot,0),n.point(ot,-a),n.point(0,-a),n.point(-ot,-a),n.point(-ot,0),n.point(-ot,a);else if(te(e[0]-t[0])>gt){var s=e[0]<t[0]?ot:-ot;a=r*s/2,n.point(-s,a),n.point(0,a),n.point(s,a)}else n.point(t[0],t[1])}function tf(e,t){var r=Lt(e),n=r>0,a=te(r)>gt;function s(P,ge,nt,ze){Uc(ze,e,t,nt,P,ge)}function f(P,ge){return Lt(P)*Lt(ge)>r}function o(P){var ge,nt,ze,Bt,qr;return{lineStart:function(){Bt=ze=!1,qr=1},point:function(_n,Fn){var tl=[_n,Fn],Io,Co=f(_n,Fn),rl=n?Co?0:C(_n,Fn):Co?C(_n+(_n<0?ot:-ot),Fn):0;if(!ge&&(Bt=ze=Co)&&P.lineStart(),Co!==ze&&(Io=x(ge,tl),(!Io||Do(ge,Io)||Do(tl,Io))&&(tl[0]+=gt,tl[1]+=gt,Co=f(tl[0],tl[1]))),Co!==ze)qr=0,Co?(P.lineStart(),Io=x(tl,ge),P.point(Io[0],Io[1])):(Io=x(ge,tl),P.point(Io[0],Io[1]),P.lineEnd()),ge=Io;else if(a&&ge&&n^Co){var ah;!(rl&nt)&&(ah=x(tl,ge,!0))&&(qr=0,n?(P.lineStart(),P.point(ah[0][0],ah[0][1]),P.point(ah[1][0],ah[1][1]),P.lineEnd()):(P.point(ah[1][0],ah[1][1]),P.lineEnd(),P.lineStart(),P.point(ah[0][0],ah[0][1])))}Co&&(!ge||!Do(ge,tl))&&P.point(tl[0],tl[1]),ge=tl,ze=Co,nt=rl},lineEnd:function(){ze&&P.lineEnd(),ge=null},clean:function(){return qr|(Bt&&ze)<<1}}}function x(P,ge,nt){var ze=Fi(P),Bt=Fi(ge),qr=[1,0,0],_n=Xo(ze,Bt),Fn=So(_n,_n),tl=_n[0],Io=Fn-tl*tl;if(!Io)return!nt&&P;var Co=r*Fn/Io,rl=-r*tl/Io,ah=Xo(qr,_n),ch=wo(qr,Co),ju=wo(_n,rl);ds(ch,ju);var Zu=ah,sl=So(ch,Zu),oh=So(Zu,Zu),hh=sl*sl-oh*(So(ch,ch)-1);if(!(hh<0)){var Sh=Eo(hh),$h=wo(Zu,(-sl-Sh)/oh);if(ds($h,ch),$h=Rs($h),!nt)return $h;var hd=P[0],vd=ge[0],Ef=P[1],Cd=ge[1],Cf;vd<hd&&(Cf=hd,hd=vd,vd=Cf);var Sd=vd-hd,yd=te(Sd-ot)<gt,Hd=yd||Sd<gt;if(!yd&&Cd<Ef&&(Cf=Ef,Ef=Cd,Cd=Cf),Hd?yd?Ef+Cd>0^$h[1]<(te($h[0]-hd)<gt?Ef:Cd):Ef<=$h[1]&&$h[1]<=Cd:Sd>ot^(hd<=$h[0]&&$h[0]<=vd)){var xd=wo(Zu,(-sl+Sh)/oh);return ds(xd,ch),[$h,Rs(xd)]}}}function C(P,ge){var nt=n?e:ot-e,ze=0;return P<-nt?ze|=1:P>nt&&(ze|=2),ge<-nt?ze|=4:ge>nt&&(ze|=8),ze}return zu(f,o,s,n?[0,-e]:[-ot,e-ot])}function Vu(e){return function(t){var r=new Ts;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Ts(){}Ts.prototype={constructor:Ts,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Uu(e,t,r){var n=t[1][0]-t[0][0],a=t[1][1]-t[0][1],s=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),s!=null&&e.clipExtent(null),zc(r,e.stream(Ga));var f=Ga.result(),o=Math.min(n/(f[1][0]-f[0][0]),a/(f[1][1]-f[0][1])),x=+t[0][0]+(n-o*(f[1][0]+f[0][0]))/2,C=+t[0][1]+(a-o*(f[1][1]+f[0][1]))/2;return s!=null&&e.clipExtent(s),e.scale(o*150).translate([x,C])}function ef(e,t,r){return Uu(e,[[0,0],t],r)}var Va=16,nf=Lt(30*$e);function Ua(e,t){return+t?of(e,t):rf(e)}function rf(e){return Vu({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function of(e,t){function r(n,a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n){var Fn=C-n,tl=P-a,Io=Fn*Fn+tl*tl;if(Io>4*t&&qr--){var Co=f+nt,rl=o+ze,ah=x+Bt,ch=Eo(Co*Co+rl*rl+ah*ah),ju=Ai(ah/=ch),Zu=te(te(ah)-1)<gt||te(s-ge)<gt?(s+ge)/2:Mi(rl,Co),sl=e(Zu,ju),oh=sl[0],hh=sl[1],Sh=oh-n,$h=hh-a,hd=tl*Sh-Fn*$h;(hd*hd/Io>t||te((Fn*Sh+tl*$h)/Io-.5)>.3||f*nt+o*ze+x*Bt<nf)&&(r(n,a,s,f,o,x,oh,hh,Zu,Co/=ch,rl/=ch,ah,qr,_n),_n.point(oh,hh),r(oh,hh,Zu,Co,rl,ah,C,P,ge,nt,ze,Bt,qr,_n))}}return function(n){var a,s,f,o,x,C,P,ge,nt,ze,Bt,qr,_n={point:Fn,lineStart:tl,lineEnd:Co,polygonStart:function(){n.polygonStart(),_n.lineStart=rl},polygonEnd:function(){n.polygonEnd(),_n.lineStart=tl}};function Fn(ju,Zu){ju=e(ju,Zu),n.point(ju[0],ju[1])}function tl(){ge=NaN,_n.point=Io,n.lineStart()}function Io(ju,Zu){var sl=Fi([ju,Zu]),oh=e(ju,Zu);r(ge,nt,P,ze,Bt,qr,ge=oh[0],nt=oh[1],P=ju,ze=sl[0],Bt=sl[1],qr=sl[2],Va,n),n.point(ge,nt)}function Co(){_n.point=Fn,n.lineEnd()}function rl(){tl(),_n.point=ah,_n.lineEnd=ch}function ah(ju,Zu){Io(a=ju,Zu),s=ge,f=nt,o=ze,x=Bt,C=qr,_n.point=Io}function ch(){r(ge,nt,P,ze,Bt,qr,s,f,a,o,x,C,Va,n),_n.lineEnd=Co,Co()}return _n}}var sf=Vu({point:function(e,t){this.stream.point(e*$e,t*$e)}});function af(e){return uf(function(){return e})()}function uf(e){var t,r=150,n=480,a=250,s,f,o=0,x=0,C=0,P=0,ge=0,nt,ze,Bt=null,qr=za,_n=null,Fn,tl,Io,Co=ka,rl=.5,ah=Ua(oh,rl),ch,ju;function Zu($h){return $h=ze($h[0]*$e,$h[1]*$e),[$h[0]*r+s,f-$h[1]*r]}function sl($h){return $h=ze.invert(($h[0]-s)/r,(f-$h[1])/r),$h&&[$h[0]*Er,$h[1]*Er]}function oh($h,hd){return $h=t($h,hd),[$h[0]*r+s,f-$h[1]*r]}Zu.stream=function($h){return ch&&ju===$h?ch:ch=sf(qr(nt,ah(Co(ju=$h))))},Zu.clipAngle=function($h){return arguments.length?(qr=+$h?tf(Bt=$h*$e,6*$e):(Bt=null,za),Sh()):Bt*Er},Zu.clipExtent=function($h){return arguments.length?(Co=$h==null?(_n=Fn=tl=Io=null,ka):Hc(_n=+$h[0][0],Fn=+$h[0][1],tl=+$h[1][0],Io=+$h[1][1]),Sh()):_n==null?null:[[_n,Fn],[tl,Io]]},Zu.scale=function($h){return arguments.length?(r=+$h,hh()):r},Zu.translate=function($h){return arguments.length?(n=+$h[0],a=+$h[1],hh()):[n,a]},Zu.center=function($h){return arguments.length?(o=$h[0]%360*$e,x=$h[1]%360*$e,hh()):[o*Er,x*Er]},Zu.rotate=function($h){return arguments.length?(C=$h[0]%360*$e,P=$h[1]%360*$e,ge=$h.length>2?$h[2]%360*$e:0,hh()):[C*Er,P*Er,ge*Er]},Zu.precision=function($h){return arguments.length?(ah=Ua(oh,rl=$h*$h),Sh()):Eo(rl)},Zu.fitExtent=function($h,hd){return Uu(Zu,$h,hd)},Zu.fitSize=function($h,hd){return ef(Zu,$h,hd)};function hh(){ze=Au(nt=Vc(C,P,ge),t);var $h=t(o,x);return s=n-$h[0]*r,f=a+$h[1]*r,Sh()}function Sh(){return ch=ju=null,Zu}return function(){return t=e.apply(this,arguments),Zu.invert=t.invert&&sl,hh()}}function lf(e){return function(t,r){var n=Lt(t),a=Lt(r),s=e(n*a);return[s*a*bt(t),s*bt(r)]}}function cf(e){return function(t,r){var n=Eo(t*t+r*r),a=e(n),s=bt(a),f=Lt(a);return[Mi(t*s,n*f),Ai(n&&r*s/n)]}}var qu=lf(function(e){return(e=Mu(e))&&e/bt(e)});qu.invert=cf(function(e){return e});function ff(){return af(qu).scale(79.4188).clipAngle(180-.001)}function qa(e,t){return[e,t]}qa.invert=qa;function hf(e,t,r){r=r||{};var n=r.units||"kilometers",a=r.steps||8;if(!e)throw new Error("geojson is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var s=[];switch(e.type){case"GeometryCollection":return su(e,function(f){var o=To(f,t,n,a);o&&s.push(o)}),ws(s);case"FeatureCollection":return Na(e,function(f){var o=To(f,t,n,a);o&&Na(o,function(x){x&&s.push(x)})}),ws(s)}return To(e,t,n,a)}function To(e,t,r,n){var a=e.properties||{},s=e.type==="Feature"?e.geometry:e;if(s.type==="GeometryCollection"){var f=[];return su(e,function(qr){var _n=To(qr,t,r,n);_n&&f.push(_n)}),ws(f)}var o=gf(s),x={type:s.type,coordinates:Yu(s.coordinates,o)},C=new Us,P=C.read(x),ge=dc(vc(t,r),"meters"),nt=zt.bufferOp(P,ge,n),ze=new vu;if(nt=ze.write(nt),!Xu(nt.coordinates)){var Bt={type:nt.type,coordinates:Hu(nt.coordinates,o)};return Wo(Bt,a)}}function Xu(e){return Array.isArray(e[0])?Xu(e[0]):isNaN(e[0])}function Yu(e,t){return typeof e[0]!="object"?t(e):e.map(function(r){return Yu(r,t)})}function Hu(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(r){return Hu(r,t)})}function gf(e){var t=Ic(e).geometry.coordinates,r=[-t[0],-t[1]];return ff().rotate(r).scale(Ee)}function pf(e,t){var r=Fo(e),n=Fo(t),a=e.properties||{},s=eu.difference(r.coordinates,n.coordinates);return s.length===0?null:s.length===1?ru(s[0],a):iu(s,a)}function Xa(e){let t;for(const r of e)t&&r[0]-t[0]>=180?r[0]-=360:t&&r[0]-t[0]<-180&&(r[0]+=360),t=r}function Ya(e,t){const r=pf({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},e);if(!r)return;r.properties={isMask:"y"};const n=hf(e,0);if(n.geometry.type==="Polygon")for(const a of n.geometry.coordinates)Xa(a);else for(const a of n.geometry.coordinates)for(const s of a)Xa(s);t({type:"FeatureCollection",features:[n,r]})}let Ha={type:"FeatureCollection",features:[]};function df(e,t,r=!0,n=!0,a={},s={},f={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let o,x,C=[],P,ge;function nt(){(f!=null&&f.fill||f!=null&&f.line)&&e.addSource("full-geom",{type:"geojson",data:Ha}),f!=null&&f.fill&&e.addLayer({...f?.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),f!=null&&f.line&&e.addLayer({...f?.line,id:"full-geom-line",type:"line",source:"full-geom"})}e.loaded()?nt():e.once("load",()=>{nt()});const ze=_n=>{o?.({type:"mapClick",coordinates:[_n.lngLat.lng,_n.lngLat.lat]})},Bt=()=>{let _n;const Fn=e.getZoom()>9?[(_n=e.getCenter().wrap()).lng,_n.lat]:void 0;x!==Fn&&(x=Fn,o?.({type:"proximityChange",proximity:Fn}))};function qr(_n=!1){if(!t)throw new Error;const Fn=document.createElement("div");return _n&&Fn.classList.add("marker-interactive"),new Ec({props:{displayIn:"maplibre"},target:Fn}),new t.Marker({element:Fn,offset:[1,-13]})}return{setEventHandler(_n){_n?(o=_n,e.on("moveend",Bt),Bt(),e.on("click",ze)):(e.off("moveend",Bt),o?.({type:"proximityChange",proximity:void 0}),o=void 0,e.off("click",ze))},flyTo(_n,Fn){e.flyTo({center:_n,zoom:Fn,...a})},fitBounds(_n,Fn){e.fitBounds([[_n[0],_n[1]],[_n[2],_n[3]]],{padding:Fn,...s})},indicateReverse(_n){e.getCanvasContainer().style.cursor=_n?"crosshair":""},setReverseMarker(_n){!t||!r||(ge?_n?ge.setLngLat(_n):(ge.remove(),ge=void 0):_n&&(ge=(typeof r=="object"?new t.Marker(r):qr()).setLngLat(_n).addTo(e),ge.getElement().classList.add("marker-reverse")))},setMarkers(_n,Fn){if(!r)return;function tl(Io){var Co;(Co=e.getSource("full-geom"))==null||Co.setData(Io)}for(const Io of C)Io.remove();if(C.length=0,tl(Ha),!!t){if(Fn){let Io=!1;if(Fn.geometry.type==="GeometryCollection"){const Co=Fn.geometry.geometries.filter(rl=>rl.type==="Polygon"||rl.type==="MultiPolygon");if(Co.length>0){let rl=Co.pop();for(const ah of Co)rl=yc(rl,ah);Ya({...Fn,geometry:rl},tl),Io=!0}else{const rl=Fn.geometry.geometries.filter(ah=>ah.type==="LineString"||ah.type==="MultiLineString");rl.length>0&&(tl({...Fn,geometry:{type:"GeometryCollection",geometries:rl}}),Io=!0)}}if(!Io){if(Fn.geometry.type==="Polygon"||Fn.geometry.type==="MultiPolygon")Ya(Fn,tl);else if(Fn.geometry.type==="LineString"||Fn.geometry.type==="MultiLineString"){tl(Fn);return}}r&&C.push((typeof r=="object"?new t.Marker(r):qr()).setLngLat(Fn.center).addTo(e))}if(n)for(const Io of _n??[]){if(Io===Fn)continue;const Co=(typeof n=="object"?new t.Marker(n):qr(!0)).setLngLat(Io.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Io.place_name.replace(/,.*/,""))).addTo(e),rl=Co.getElement();rl.addEventListener("click",ah=>{ah.stopPropagation(),o?.({type:"markerClick",id:Io.id})}),rl.addEventListener("mouseenter",()=>{o?.({type:"markerMouseEnter",id:Io.id}),Co.togglePopup()}),rl.addEventListener("mouseleave",()=>{o?.({type:"markerMouseLeave",id:Io.id}),Co.togglePopup()}),rl.classList.toggle("marker-fuzzy",!!Io.matching_text),C.push(Co)}}},setSelectedMarker(_n){P&&P.getElement().classList.toggle("marker-selected",!1),P=_n>-1?C[_n]:void 0,P?.getElement().classList.toggle("marker-selected",!0)}}}var En,Hr;class vf extends EventTarget{constructor(t){super(),fs(this,En,void 0),fs(this,Hr,void 0),No(this,Hr,t)}onAdd(t){const r=document.createElement("div");r.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:n,showResultMarkers:a,flyTo:s,fullGeometryStyle:f,...o}=zn(this,Hr),x=typeof s=="boolean"?{}:s,C=this.getExtraProps(t,r),P={mapController:df(t,this.getMapLibreGl(),n,a,x,x,f),flyTo:s===void 0?!0:!!s,apiKey:"",...C,...o};if(!P.apiKey)throw new Error("no apiKey provided");No(this,En,new Yl({target:r,props:P}));for(const ge of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])zn(this,En).$on(ge,nt=>this.dispatchEvent(nt));return r}setOptions(t){var r;No(this,Hr,t);const{marker:n,showResultMarkers:a,flyTo:s,fullGeometryStyle:f,...o}=zn(this,Hr);(r=zn(this,En))==null||r.$set(o)}setQuery(t,r=!0){var n;(n=zn(this,En))==null||n.setQuery(t,r)}setReverseMode(t){var r;(r=zn(this,En))==null||r.$set({reverseActive:t})}focus(){var t;(t=zn(this,En))==null||t.focus()}blur(){var t;(t=zn(this,En))==null||t.blur()}onRemove(){var t;(t=zn(this,En))==null||t.$destroy()}}En=new WeakMap,Hr=new WeakMap;class _f extends vf{getMapLibreGl(){return ll}getExtraProps(t,r){const n={};if(!("getSdkConfig"in t&&typeof t.getSdkConfig=="function"))throw new Error("MapTiler SDK not detected");const{primaryLanguage:a,apiKey:s}=t.getSdkConfig();n.apiKey=s;const f=/^([a-z]{2})($|_|-)/.exec(a);return f&&(n.language=f[1]),r.className+=" maptiler-ctrl",n}}const style="",doubleClickZoom={enable:e=>{setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},DrawAssistedRectangle={onSetup:function(e){const t=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:t,currentVertexPosition:0}},onTap:function(e,t){this.onClick(e,t)},onClick:function(e,t){if(e.currentVertexPosition===2){const r=this.calculatepXY3(e,t,!1);return r&&e.rectangle.updateCoordinate(`0.${e.currentVertexPosition+1}`,r[0],r[1]),this.updateUIClasses({mouse:"pointer"}),this.changeMode("simple_select",{featuresId:e.rectangle.id})}else e.rectangle.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.rectangle.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},onMouseMove:function(e,t){if(e.rectangle.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition&&e.currentVertexPosition>0&&this.calculateOrientedAnglePolygon(e),e.currentVertexPosition===2){const r=this.calculatepXY3(e,t,!0);r&&e.rectangle.updateCoordinate("0."+(e.currentVertexPosition+1),r[0],r[1])}},deegrees2meters(e){const t=e[0]*2003750834e-2/180;let r=Math.log(Math.tan((90+e[1])*Math.PI/360))/(Math.PI/180);return r=r*2003750834e-2/180,[t,r]},meters2degress(e){const t=e[0]*180/2003750834e-2,r=Math.atan(Math.exp(e[1]*Math.PI/2003750834e-2))*360/Math.PI-90;return[t,r]},calculateOrientedAnglePolygon:function(e){const t=e.rectangle.getCoordinate("0.0"),r=this.deegrees2meters(t),n=e.rectangle.getCoordinate("0.1"),a=this.deegrees2meters(n);let f=-1*(Math.atan2(a[1]-r[1],a[0]-r[0])*180/Math.PI+90);const o=f<0?f+360:f;e.angle=parseFloat(o.toFixed(2))},calculatepXY3:function(e,t,r){const n=e.rectangle.getCoordinate("0.0"),a=this.deegrees2meters(n),s=e.rectangle.getCoordinate("0.1"),f=this.deegrees2meters(s);let o=this.deegrees2meters([t.lngLat.lng,t.lngLat.lat]);const x=this.deegrees2meters([t.lngLat.lng,t.lngLat.lat]);if(a[0]===f[0])o=[x[0],f[1]];else if(a[1]===f[1])o=[f[0],x[1]];else{const Bt=-1/((f[1]-a[1])/(f[0]-a[0]));Math.abs(Bt)<1?o[1]=Bt*(x[0]-f[0])+f[1]:o[0]=f[0]+(o[1]-f[1])/Bt}const C=[f[0]-a[0],f[1]-a[1]],P=[o[0]-C[0],o[1]-C[1]],ge=this.meters2degress(o),nt=this.meters2degress(P);return e.rectangle.updateCoordinate("0.2",ge[0],ge[1]),e.rectangle.updateCoordinate("0.3",nt[0],nt[1]),nt},onKeyUp:function(e,t){if(t.keyCode===27)return this.changeMode("simple_select")},onStop:function(e){doubleClickZoom.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.getFeature(e.rectangle.id)!==void 0&&(e.rectangle.removeCoordinate("0.4"),e.rectangle.isValid()?this.map.fire("draw.create",{features:[e.rectangle.toGeoJSON()]}):(this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(e,t,r){const n=t.properties.id===e.rectangle.id;if(t.properties.active=n?"true":"false",t.properties.angle=e.angle,t.angle=e.angle,!n)return r(t);const a=t.geometry.coordinates[0].length;if(a<3){const s=t.geometry.coordinates[0][0],f={type:"Feature",properties:t.properties,angle:e.angle,geometry:{coordinates:t.geometry.coordinates[0][0],type:"Point"}};s&&r(f);return}if(a>=3&&a<=4){const s=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:"Feature",properties:t.properties,angle:e.angle,geometry:{coordinates:s,type:"LineString"}}),a===3)return}return r(t)},onTrash:function(e){this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select")}};class MapTilerGLButtonControl{constructor({className:t="",title:r="",eventHandler:n=evtHndlr}){this._className=t,this._title=r,this._eventHandler=n}onAdd(t){return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon "+this._className,this._btn.type="button",this._btn.title=this._title,this._btn.onclick=this._eventHandler,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl-group maplibregl-ctrl",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const maptilerMapViewer_vue_vue_type_style_index_0_scoped_cfeeea1a_lang="";let draw;const STYLES_DRAW=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#FF0000","fill-outline-color":"#D20C0C","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF0000","line-width":3}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#ee0508","fill-opacity":.8}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c40b0b","line-width":2}}],_sfc_main$4={name:"maptiler-map-viewer",setup(){const e=useQuasar();return{alert:ref(!1),alertMsg:ref(""),tileInfoString:ref(""),dirHandle:ref(""),qt:e,map:ref(null),maptiler_style_url:ref(""),maptiler_access_token:ref(""),maptiler_rgb_image_url:ref(""),maptiler_raster_png_dem:ref(""),maptiler_api_url:ref(""),satellite_endpoint:ref(""),satellite_image_url:ref(""),rasterFromStyle:ref(!1),zoom:ref(""),lng:ref(""),lat:ref(""),drawmode:ref("simple_select"),layers:ref(["hillshading","bounding_box"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Satellite",value:"satellite"}]}},mounted(){},methods:{async changeLayers(e){for(const t of this.layer_type)e.includes(t.value)?this.map.setLayoutProperty(t.value,"visibility","visible"):this.map.setLayoutProperty(t.value,"visibility","none")},async loadMapSourcesLayers(e){e.addSource("maptiler_terrain_dem",{type:"raster-dem",url:this.maptiler_raster_png_dem+"tiles.json"}),e.addLayer({id:"hillshading",source:"maptiler_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),e.addSource("satellite",{type:"raster",url:this.maptiler_api_url+"/tiles/satellite/tiles.json",tileSize:512}),e.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}})},changeDrawMode(e){let t=document.getElementsByClassName("mapbox-gl-draw_polygon")[0],r=document.getElementsByClassName("mapbox-gl-draw_line")[0],n=e.target;n.title==="Select single tile"?(r.style.backgroundColor="white",t.style.backgroundColor="green",draw.deleteAll(),draw.changeMode("simple_select"),this.drawmode="simple_select"):n.title==="Draw Rectangle to select multiple tiles"&&(r.style.backgroundColor="green",t.style.backgroundColor="white",draw.deleteAll(),draw.changeMode("draw_assisted_rectangle"),this.drawmode="draw_assisted_rectangle",this.map.setPaintProperty("bounding_box","fill-opacity",0)),idbKeyval.set("drawmode",this.drawmode),console.log(this.drawmode)},resizeMap(){this.map.resize()},updateBBox(e){let t=e.features[0].geometry.coordinates[0],r,n,a,s;r=t[3][0],n=t[3][1],a=t[1][0],s=t[1][1];let f=[r,n,a,s],o=mapUtils.getTileInfo(0,0,!0,0,0,0,f);idbKeyval.set("tile_info",o)},async setBoundingBox(e){let t=mapUtils.getTileInfo(this.lng,this.lat,!1,0,0,this.zoom);this.tileInfoString="Slippy Tile Info String: "+t.x+","+t.y+","+t.z+" Bounding Box sides in KM: "+t.distance,e.getSource("bounding_box_source").setData(t.polygon_bb),e.setPaintProperty("bounding_box","fill-opacity",.45),e.fitBounds(t.bbox,{linear:!0}),idbKeyval.set("tile_info",t)},async loadMapTilerMap(){this.maptiler_access_token=await idbKeyval.get("maptiler_access_token"),this.dirHandle=await idbKeyval.get("dirHandle"),this.maptiler_style_url=await idbKeyval.get("maptiler_style_url"),this.maptiler_api_url=await idbKeyval.get("maptiler_api_url"),this.maptiler_raster_png_dem=await idbKeyval.get("maptiler_raster_png_dem"),this.dirHandle=await idbKeyval.get("dirHandle"),config.apiKey=this.maptiler_access_token;let e=this,t=new Map$1({container:"map",trackResize:!0,antialias:!0,style:this.maptiler_style_url,center:[-121.7598,46.876],zoom:9,maxZoom:12,doubleClickZoom:!1,terrainControl:!0,fullscreenControl:!0,failIfMajorPerformance:!0});this.map=t,this.map.doubleClickZoom.disable();const r=new _f({apiKey:config.apiKey,class:"geocoder",showResultsWhileTyping:!0,placeholder:"Try: Lng , Lat or Name"});t.addControl(r,"top-right"),draw=new MapboxDraw({modes:{...MapboxDraw.modes,draw_assisted_rectangle:DrawAssistedRectangle},displayControlsDefault:!1,controls:{},userProperties:!0,styles:STYLES_DRAW}),t.addControl(draw);const n=new MapTilerGLButtonControl({className:"mapbox-gl-draw_polygon",title:"Select single tile",eventHandler:e.changeDrawMode});t.addControl(n);const a=new MapTilerGLButtonControl({className:"mapbox-gl-draw_line",title:"Draw Rectangle to select multiple tiles",eventHandler:e.changeDrawMode});t.addControl(a),t.on("load",function(){e.loadMapSourcesLayers(t);let s=document.getElementsByClassName("mapbox-gl-draw_polygon")[0];s.style.backgroundColor="green",draw.changeMode("simple_select"),this.drawmode="simple_select"}),t.on("click",async function(s){e.drawmode==="simple_select"&&(e.lng=s.lngLat.lng,e.lat=s.lngLat.lat,e.zoom=Math.floor(t.getZoom()),await e.setBoundingBox(t,e.zoom))}),t.on("zoomend",async function(){e.zoom=Math.floor(t.getZoom())}),t.on("error",s=>{console.error(s)}),t.on("draw.create",function(s){console.log("draw mode create "+s.type),e.updateBBox(s)}),t.on("draw.update",function(s){console.log("draw mode update "+s.type),e.updateBBox(s)}),t.on("draw.selectionchange",function(s){console.log("draw mode selectionchange "+s.type)}),t.on("draw.delete",function(s){console.log("draw mode delete "+s.type)}),t.on("draw.modechange",s=>{console.log("draw mode CHANGE "+s.mode)}),t.on("dblclick",async function(s){let f=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(f,!0)===!1){console.error(`User did not grant permission to '${f.name}'`);return}let o=await idbKeyval.get("tile_info"),x={},C=!0;e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance;let P=await idbKeyval.get("exportType");if(e.drawmode==="simple_select"){if(e.qt.loading.show(),P.label==="Image of map only"){C=!1;let nt=e.maptiler_style_url.replace("style.json","")+`${o.z}/${o.x}/${o.y}.png?key=`+e.maptiler_access_token,ze=await mapUtils.getMapboxTerrainRgb(nt),Bt=await ze.toBuffer();idbKeyval.set("map_image_buffer",Bt),await fileUtils.writeFileToDisk(f,o.mapFileName,Bt),x.image=ze}else{e.maptiler_rgb_image_url=e.maptiler_raster_png_dem+`${o.z}/${o.x}/${o.y}.webp?key=`+e.maptiler_access_token;let ge=await mapUtils.getMapboxTerrainRgb(e.maptiler_rgb_image_url),nt=await ge.toBuffer();if(await idbKeyval.set("rgb_image_buffer",nt),await fileUtils.writeFileToDisk(f,o.rgbFileName,nt),x=mapUtils.createHeightMapImage(ge,32,"GREY"),await fileUtils.fileExists(f,o.thirtyTwoFileName)===!1){let Bt=await x.image.toBuffer();await fileUtils.writeFileToDisk(f,o.thirtyTwoFileName,Bt)}}emitter.emit("updatePreviewImage",{dir_handle:f,tile_info:o,preview_image_info:x,map:t,updateStats:C}),e.qt.loading.hide()}else if(e.drawmode==="draw_assisted_rectangle"){e.qt.loading.show(),o.z=Math.floor(t.getZoom()),idbKeyval.set("tile_info",o);let ge=await idbKeyval.get("exportOptionsModel"),nt=await idbKeyval.get("saveStitchingFiles"),ze=Math.floor(t.getZoom()),Bt={left:o.bbox[0],bottom:o.bbox[1],right:o.bbox[2],top:o.bbox[3]},qr=tilesInBbox.tilesInBbox(Bt,ze),_n=[],Fn=[];try{if(P.label!=="Image of map only"){for(let ju of qr){let Zu={};o=mapUtils.getTileInfo(0,0,!0,ju.x,ju.y,ju.z,o.bbox),e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance,e.maptiler_rgb_image_url=e.maptiler_raster_png_dem+`${o.z}/${o.x}/${o.y}.webp?key=`+e.maptiler_access_token;let oh=await(await mapUtils.getMapboxTerrainRgb(e.maptiler_rgb_image_url)).toBuffer();if(nt===!0&&await fileUtils.writeFileToDisk(f,o.rgbFileName,oh),Zu.x=o.x,Zu.y=o.y,Zu.buffer=oh,_n.push(Zu),ge.includes("satellite")){e.satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint"),e.satellite_image_url=e.satellite_endpoint+`/${o.z}/${o.x}/${o.y}.jpg?key=`+e.maptiler_access_token;let Sh=await(await mapUtils.getMapboxTerrainRgb(e.satellite_image_url)).toBuffer();Zu={},Zu.x=o.x,Zu.y=o.y,Zu.buffer=Sh,Fn.push(Zu)}}idbKeyval.set("tile_info",o);const tl=512;let Io=await combineTilesJimp(_n,tl,tl);if(await idbKeyval.set("rgb_image_buffer",Io),await fileUtils.writeFileToDisk(f,o.rgbFileName,Io),ge.includes("satellite")){let ju=await combineTilesJimp(Fn,tl,tl);idbKeyval.set("sat_image_buffer",ju),await fileUtils.writeFileToDisk(f,o.satelliteFileName,ju)}let Co=await idbKeyval.get("rgb_image_buffer"),rl=await mapUtils.loadImageFromArray(Co),ah=mapUtils.createHeightMapImage(rl,32,"GREY");if(await fileUtils.fileExists(f,o.thirtyTwoFileName)===!1){let ju=await ah.image.toBuffer();await fileUtils.writeFileToDisk(f,o.thirtyTwoFileName,ju)}emitter.emit("updatePreviewImage",{dir_handle:f,tile_info:o,preview_image_info:ah,map:t,updateStats:C}),e.qt.loading.hide()}else{let tl;for(let ch of qr){let ju={};o=mapUtils.getTileInfo(0,0,!0,ch.x,ch.y,ch.z,o.bbox),e.tileInfoString="Slippy Tile Info String: "+o.x+","+o.y+","+o.z+" Bounding Box sides in KM: "+o.distance;let sl=e.maptiler_style_url.replace("style.json","")+`${o.z}/${o.x}/${o.y}.png?key=`+e.maptiler_access_token;tl=await(await mapUtils.getMapboxTerrainRgb(sl)).toBuffer(),nt===!0&&await fileUtils.writeFileToDisk(f,o.mapFileName,tl),ju.x=o.x,ju.y=o.y,ju.buffer=tl,_n.push(ju)}let Io=!1;idbKeyval.set("tile_info",o);const Co=512;let rl=await combineTilesJimp(_n,Co,Co);await idbKeyval.set("map_image_buffer",rl),await fileUtils.writeFileToDisk(f,o.mapFileName,rl);let ah=await mapUtils.loadImageFromArray(rl);x.image=ah,emitter.emit("updatePreviewImage",{dir_handle:f,tile_info:o,preview_image_info:x,map:t,updateStats:Io}),e.qt.loading.hide()}}catch(tl){console.log(tl),e.alertMsg=tl,e.alert=!0,e.qt.loading.hide()}e.qt.loading.hide()}})}}},_withScopeId=e=>(pushScopeId("data-v-cfeeea1a"),e=e(),popScopeId(),e),_hoisted_1$4={id:"map"},_hoisted_2$3=_withScopeId(()=>createBaseVNode("pre",{id:"features"},null,-1)),_hoisted_3$3={class:"row no-wrap q-pa-md"},_hoisted_4$3={class:"column"},_hoisted_5$3=_withScopeId(()=>createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1)),_hoisted_6$3=_withScopeId(()=>createBaseVNode("div",{class:"text-h6"},"Alert",-1));function _sfc_render$4(e,t,r,n,a,s){return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$4,[_hoisted_2$3,createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("div",_hoisted_4$3,[_hoisted_5$3,createVNode(QOptionGroup,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:n.layer_type,type:"toggle",modelValue:n.layers,"onUpdate:modelValue":[t[0]||(t[0]=f=>n.layers=f),s.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),createTextVNode("   "+toDisplayString(" Zoom: "+this.zoom+" "+this.tileInfoString),1)]),_:1})]),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[1]||(t[1]=f=>n.alert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_6$3]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const MaptilerMapViewer=_export_sfc(_sfc_main$4,[["render",_sfc_render$4],["__scopeId","data-v-cfeeea1a"]]),wieghtmapViewer_vue_vue_type_style_index_0_scoped_9bc22cba_lang="";let mapweight=null;const _sfc_main$3={name:"weightmap-viewer",setup(){return{qt:useQuasar(),access_token:ref("")}},methods:{async loadMapboxWeightMap(){let e=await idbKeyval.get("tile_info");if(e.hasOwnProperty("bbox")){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken;let r="mapbox://styles/"+(await idbKeyval.get("mapbox_raster_style_url")||"");mapweight===null&&(mapweight=new mapboxgl.Map({container:"mapweight",style:r})),mapweight.on("load",()=>{this.loadMapSourcesLayers(mapweight),mapweight.getSource("bounding_box_source").setData(e.polygon_bb),mapweight.setPaintProperty("bounding_box","fill-opacity",.45),mapweight.fitBounds(e.bbox)}),mapweight.getSource("bounding_box_source").setData(e.polygon_bb),mapweight.setPaintProperty("bounding_box","fill-opacity",.45),mapweight.fitBounds(e.bbox)}},loadMapSourcesLayers(e){mapweight.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),mapweight.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}})}}},_hoisted_1$3={id:"mapweight"};function _sfc_render$3(e,t,r,n,a,s){return openBlock(),createElementBlock("div",_hoisted_1$3)}const WeightmapViewer=_export_sfc(_sfc_main$3,[["render",_sfc_render$3],["__scopeId","data-v-9bc22cba"]]),useRatioProps={ratio:[String,Number]};function useRatio(e,t){return computed(()=>{const r=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(r)!==!0&&r>0?{paddingBottom:`${100/r}%`}:null})}const defaultRatio=16/9,QImg=createComponent({name:"QImg",props:{...useRatioProps,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:defaultRatio},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:r}){const n=ref(e.initialRatio),a=useRatio(e,n);let s=null,f=!1;const o=[ref(null),ref(_n())],x=ref(0),C=ref(!1),P=ref(!1),ge=computed(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),nt=computed(()=>({width:e.width,height:e.height})),ze=computed(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),Bt=computed(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));watch(()=>qr(),Fn);function qr(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function _n(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function Fn(ju){s!==null&&(clearTimeout(s),s=null),P.value=!1,ju===null?(C.value=!1,o[x.value^1].value=_n()):C.value=!0,o[x.value].value=ju}function tl({target:ju}){f!==!0&&(s!==null&&(clearTimeout(s),s=null),n.value=ju.naturalHeight===0?.5:ju.naturalWidth/ju.naturalHeight,Io(ju,1))}function Io(ju,Zu){f===!0||Zu===1e3||(ju.complete===!0?Co(ju):s=setTimeout(()=>{s=null,Io(ju,Zu+1)},50))}function Co(ju){f!==!0&&(x.value=x.value^1,o[x.value].value=null,C.value=!1,P.value=!1,r("load",ju.currentSrc||ju.src))}function rl(ju){s!==null&&(clearTimeout(s),s=null),C.value=!1,P.value=!0,o[x.value].value=null,o[x.value^1].value=_n(),r("error",ju)}function ah(ju){const Zu=o[ju].value,sl={key:"img_"+ju,class:ze.value,style:Bt.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...Zu};return x.value===ju?(sl.class+=" q-img__image--waiting",Object.assign(sl,{onLoad:tl,onError:rl})):sl.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+ju},h("img",sl))}function ch(){return C.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},hSlot(t[P.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[h(QSpinner,{color:e.spinnerColor,size:e.spinnerSize})])}return Fn(qr()),onBeforeUnmount(()=>{f=!0,s!==null&&(clearTimeout(s),s=null)}),()=>{const ju=[];return a.value!==null&&ju.push(h("div",{key:"filler",style:a.value})),P.value!==!0&&(o[0].value!==null&&ju.push(ah(0)),o[1].value!==null&&ju.push(ah(1))),ju.push(h(Transition,{name:"q-transition--fade"},ch)),h("div",{class:ge.value,style:nt.value,role:"img","aria-label":e.alt},ju)}}});let Gdal,ZrangeSeaLevel=32767;const _sfc_main$2={name:"SideNav",setup(){const e=useQuasar();return{alert:ref(!1),isAlphaBrush:ref(!1),blurRadius:ref(0),blurRadiusWeightmap:ref(10),gridSize:ref(2),access_token:ref(""),isDisabled:ref(!1),isDownload:ref(!0),isWorldPartition:ref(!1),isLandscape:ref(!0),isExportOptions:ref(!0),isBlurRadius:ref(!0),isSendToUnreal:ref(!0),unrealLandscape:ref({label:505,value:505}),landscapeSize:[{label:"8129x8129",value:8129},{label:"6097x6097",value:6097},{label:"4033x4033",value:4033},{label:"3025x3025",value:3025},{label:"2017x2017",value:2017},{label:"1513x1513",value:1513},{label:"1009x1009",value:1009},{label:"512x512 -- Native Resolution",value:512},{label:"505x505",value:505}],url:ref(""),tile_info:ref(""),satellite_endpoint:ref(""),satellite_image_url:ref(""),mapserver:ref(""),raster_style_endpoint:ref(""),raster_style_url:ref(""),weightmap_url:ref(""),save_fileName:ref(""),dirHandle:ref(""),preview_image_info:ref(""),rgb_image:ref(""),img_min:ref(""),img_max:ref(""),map:null,data:null,bbinfoalert:ref(!1),exportType:ref({label:"Unreal Heightmap",value:"Unreal Heightmap"}),landscapeName:ref(""),alphaBrushName:ref(""),alphaBrushHeight:ref(505),alphaBrushWidth:ref(505),unrealMapPath:ref(""),qt:e,exportOptionsModel:ref(["zrange","combine_features"]),alertMsg:ref(""),exportOptions:[],computed:{exportOptions:function(){this.forceRefresh()}},exportTypeOptions:[{label:"Unreal Heightmap",value:"Unreal Heightmap"},{label:"Unreal Terrain Magic Plugin -- EarthLandscape Clip",value:"Unreal Terrain Magic Plugin -- EarthLandscape Clip"},{label:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip",value:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"},{label:"Unreal Stamp Brush Plugin",value:"Unreal Stamp Brush Plugin"},{label:"Unreal Landmass Effect Brush Plugin",value:"Unreal Landmass Effect Brush Plugin",cannotSelect:!1},{label:"None",value:"none"},{label:"Geojson Only",value:"geojson_only"},{label:"Image of map only",value:"map-image"}]}},async mounted(){this.exportType={label:"Unreal Heightmap",value:"Unreal Heightmap"},idbKeyval.set("exportType",toRaw(this.exportType)),Gdal=await initGdalJs({path:"https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package",useWorker:!1}),emitter.on("updatePreviewImage",e=>{this.data=e,this.updatePreviewImage()})},methods:{async forceRefresh(){this.mapserver=await idbKeyval.get("mapserver"),this.mapserver==="Maptiler"?this.exportOptions=[{label:"Zrange-sea level=0",value:"zrange"},{label:"Flip X",value:"flipx"},{label:"Flip y",value:"flipy"},{label:"Download Satellite",value:"satellite"},{label:"Download Geojson Features",value:"features"},{label:"Combine Unique Features",value:"combine_features"}]:this.exportOptions=[{label:"Zrange-sea level=0",value:"zrange"},{label:"Flip X",value:"flipx"},{label:"Flip y",value:"flipy"},{label:"Download Satellite",value:"satellite"},{label:"Download Geojson Features",value:"features"},{label:"Combine Unique Features",value:"combine_features"},{label:"Create Weightmap (Splatmap) Files",value:"raster_style"}],this.$forceUpdate()},showNotify(e,t,r,n,a){this.qt.notify({message:e,color:t,position:r,icon:n,textColor:a})},copyTileInfoString(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Tile info string copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},copyExtents(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.bboxW+","+this.tile_info.bboxS+","+this.tile_info.bboxE+","+this.tile_info.bboxN;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Bounding box coordinates copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},landscapeSizeChange(){this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale()},adjustedZscale(){let e=this.getUnrealZScale(this.preview_image_info.maxElevation,this.preview_image_info.minElevation),t=this.getUnrealXYScale();return this.tile_info.xyscale=t.toFixed(3),this.exportOptionsModel.includes("zrange")?(this.tile_info.startZRange=ZrangeSeaLevel,this.tile_info.zscale=e.toFixed(3)):(this.tile_info.startZRange=0,this.tile_info.zscale=e.toFixed(3)),this.tile_info.zscale},exportOptionsModelChange(e){this.exportOptionsModel=e,this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale();let t=toRaw(this.exportOptionsModel);idbKeyval.set("exportOptionsModel",t)},exportType_Change(e){idbKeyval.set("exportType",toRaw(this.exportType)),this.exportType.label==="Unreal Heightmap"||this.exportType.label==="None"||this.exportType.label==="Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"?(this.isDownload=!0,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!0,this.isExportOptions=!0,this.isBlurRadius=!0):this.exportType.label==="Unreal Stamp Brush Plugin"||this.exportType.label==="Unreal Landmass Effect Brush Plugin"?(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!0,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!0):this.exportType.label==="Geojson Only"?(this.isDownload=!0,this.isSendToUnreal=!1,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1):this.exportType.label==="Image of map only"?(this.isDownload=!0,this.isSendToUnreal=!1,this.isAlphaBrush=!1,this.isLandscape=!0,this.isExportOptions=!1,this.isBlurRadius=!1):this.exportType.label==="Unreal Terrain Magic Plugin -- EarthLandscape Clip"&&(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1)},showBBInfo(){this.tile_info?this.bbinfoalert=!0:(this.bbinfoalert=!1,this.alertMsg="Please double click on your chosen selection first.",this.alert=!0)},updateStats(){this.preview_image_info.maxElevation!==""?(this.tile_info.MaxElevation=this.preview_image_info.maxElevation,this.tile_info.MinElevation=this.preview_image_info.minElevation,this.tile_info.minmax=this.tile_info.MinElevation.toFixed(3)+" / "+this.tile_info.MaxElevation.toFixed(3),this.tile_info.elevation_range=(this.tile_info.MaxElevation-this.tile_info.MinElevation).toFixed(3),this.tile_info.zscale=this.adjustedZscale()):this.tile_info.minmax=""},getUnrealZScale(e,t){let r,n;return this.exportOptionsModel.includes("zrange")?r=e*100:(t<0&&(t=0),r=(e-t)*100),n=r*.001953125,n},getUnrealXYScale(){return this.tile_info.distance*1e3/this.unrealLandscape.value*100},async updatePreviewImage(){this.preview_image_info=await this.data.preview_image_info,this.tile_info=this.data.tile_info,this.map=this.data.map;let e=await this.preview_image_info.image.toBlob();const t=URL.createObjectURL(e);this.url=t,this.data.updateStats===!0&&this.updateStats(this.tile_info)},async saveImage(e,t,r){let n=await idbKeyval.get("dirHandle"),a=new Blob([e],{type:"image/"+r});await fileUtils.writeFileToDisk(n,t,a)},async processGdal(e,t,r,n,a){let s;this.exportType.label==="Image of map only"?(console.log("test"),s=new Blob([e],{type:"image/"+n})):s=new Blob([new Uint8Array(e)],{type:"image/"+n});const f=new File([s],t),x=(await Gdal.open(f)).datasets[0],C=await Gdal.gdal_translate(x,r),P=await Gdal.getFileBytes(C);a==="createHeightmap"&&await this.saveImage(P,t,n),Gdal.close(x)},async sendToUnreal(){let e="http://localhost:30010/",t="remote/object/call",r={},n,a,s,f="Mapbox_BP",o,x,C,P;if(this.tile_info)if(r={objectPath:"/Script/UnrealEd.Default__EditorActorSubsystem",functionName:"GetAllLevelActors"},n=await mapUtils.unrealRemoteControl(r,e+t),n.error)n.error.message==="Failed to fetch"?this.alertMsg="Cannot connect to Unreal server. Please make sure your project is open and Mapbox_BP is in the scene.  Also make sure you launched the Map using the Select Map button as this starts the Unreal Web Server":this.alertMsg=n.error.message,this.alert=!0;else{let ge=await n.response.json();for(let nt of ge.ReturnValue)if(a=nt.includes(f),a===!0){s=nt;break}else s=null;if(s){this.exportType.label!=="Unreal Terrain Magic Plugin -- EarthLandscape Clip"?await this.createSixteenHeightMap():this.tile_info.resolution="505",this.exportType.label==="Unreal Stamp Brush Plugin"&&(o="/Game/Brushes/CustomBrushes/",x="/Game/Brushes/PEAKS/Peak_10_brush.Peak_10_brush",C="Textures/",P="HeightMap"),this.exportType.label==="Unreal Landmass Effect Brush Plugin"&&(o="/Game/Editor/Landscape/LandmassEffectBrush/CustomBrushes/",x="/Game/Editor/Landscape/LandmassEffectBrush/Effects/Variants/Map/HeightMapEffect.HeightMapEffect",C="Textures/",P="Heightmap (Greyscale / White is High)"),this.unrealMapPath=await idbKeyval.get("mappath"),this.tile_info.landscapeName=this.landscapeName;let nt=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z,ze;this.isWorldPartition===!0?ze=this.gridSize:ze=0,r={objectPath:s,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:this.tile_info.landscapeName,LandscapeSize:this.tile_info.resolution.toString(),TileHeightmapFileName:this.tile_info.sixteenFileName,TileGeojsonFileName:this.tile_info.geoJsonFileName,TileInfoFileName:this.tile_info.tileInfoFileName,MapMiddleLngX:this.tile_info.center.lng,MapMiddleLatY:this.tile_info.center.lat,MapBtmRLng:this.tile_info.bottomRight.lng,MapBtmLLng:this.tile_info.bottomLeft.lng,MapTopLLat:this.tile_info.topLeft.lat,MapBtmLLat:this.tile_info.bottomLeft.lat,RunFunction:this.exportType.label,SlippyMapTileString:nt.trim(),HeightMapTexturesPath:"/Game/ImportedHeightMaps/",AlphaBrushName:this.tile_info.alphaBrushFileName,AlphaBrushDestinationPath:o,AlphaBrushTemplatePath:x,AlphaBrushTexturesPath:C,HeightmapProperty:P,WorldPartitionGridSize:ze.toString()}},n=await mapUtils.unrealRemoteControl(r,e+t),n.error?(console.log(n.error),this.alertMsg=n.error.message,this.alert=!0):console.log(await n.response.json())}else this.alertMsg="Could not find Mapbox_BP in scene",this.alert=!0}else this.alertMsg="Please double click on your chosen selection first",this.alert=!0;this.qt.loading.hide()},async unrealTileFeatures(e){let t=mapUtils.getFeaturesFromBB(this.map,this.tile_info,e),r=JSON.stringify(t),n=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.geoJsonFileName,r),await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.tileInfoFileName,n)},async createSixteenHeightMap(){if(this.qt.loading.show(),this.mapserver=await idbKeyval.get("mapserver"),this.mapserver==="Mapbox"?(this.access_token=await idbKeyval.get("mapbox_access_token"),this.satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint"),this.satellite_image_url=this.satellite_endpoint+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token,this.raster_style_endpoint=await idbKeyval.get("mapbox_raster_style_endpoint"),this.raster_style_url=await idbKeyval.get("mapbox_raster_style_url"),this.weightmap_url=this.raster_style_endpoint+"/"+this.raster_style_url+`/tiles/512/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token):this.mapserver==="Maptiler"&&(this.access_token=await idbKeyval.get("maptiler_access_token"),this.satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint"),this.satellite_image_url=this.satellite_endpoint+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}.jpg?key=`+this.access_token,this.raster_style_endpoint=await idbKeyval.get("maptiler_raster_style_endpoint"),this.raster_style_url=await idbKeyval.get("maptiler_raster_style_url"),this.weightmap_url=this.raster_style_endpoint+"/"+this.raster_style_url+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}.png?key=`+this.access_token),this.tile_info){if(this.tile_info.resizeMethod="lanczos",this.exportType.label==="Image of map only"){let e=await idbKeyval.get("map_image_buffer"),t=["-of","PNG","-outsize",this.unrealLandscape.value.toString(),this.unrealLandscape.value.toString()];await this.processGdal(e,"map_image_"+this.tile_info.mapboxTileName+"_"+this.unrealLandscape.value.toString()+".png",t,"png","createHeightmap"),this.qt.loading.hide()}else{let e,t;if(this.tile_info.resolution=this.unrealLandscape.value,this.tile_info.geoJsonFileName="geojson-"+this.tile_info.mapboxTileName+".json",this.tile_info.tileInfoFileName="tile-info-"+this.tile_info.mapboxTileName+".json",this.tile_info.sixteenFileName="sixteen-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".png",this.tile_info.satelliteFileName="satellite-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".jpg",this.qt.loading.show(),this.dirHandle=await idbKeyval.get("dirHandle"),await fileUtils.verifyPermission(this.dirHandle,!0)===!1){console.error(`User did not grant permission to '${this.dirHandle.name}'`);return}if(fileUtils.fileExists(this.dirHandle,this.tile_info.thirtytwoFile)){let n=await idbKeyval.get("rgb_image_buffer"),a=await mapUtils.loadImageFromArray(n),s=mapUtils.createHeightMapImage(a,16,"GREY"),f=s.image;if(this.exportOptionsModel.includes("flipy")&&(f=await f.flipY()),this.exportOptionsModel.includes("flipx")&&(f=await f.flipX()),this.blurRadius>=1&&(f=f.blurFilter({radius:this.blurRadius})),t=await f.toBuffer(),this.img_min=parseInt(s.minElevation).toString(),this.img_max=parseInt(s.maxElevation).toString(),this.tile_info.resampleSize=this.unrealLandscape.value.toString(),this.tile_info.exportTypeLabel=this.exportType.label,this.tile_info.alphaBrushFileName="alphabrush-"+this.tile_info.mapboxTileName+"-height-"+this.alphaBrushHeight+"-width-"+this.alphaBrushWidth,this.exportOptionsModel.includes("features")){let o=!1;this.exportOptionsModel.includes("combine_features")&&(o=!0),await this.unrealTileFeatures(o)}switch(this.tile_info.exportTypeLabel){case"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip":if(e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")){e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod];let o;await fileUtils.fileExists(this.dirHandle,this.tile_info.satFileName)===!0?o=await idbKeyval.get("sat_image_buffer"):o=await mapUtils.downloadTerrainRgb(this.satellite_image_url),await this.processGdal(o,this.tile_info.satelliteFileName,e,"jpg","createHeightmap")}this.qt.loading.hide();break;case"Unreal Heightmap":if(this.tile_info.resampleSize!==512)e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")&&(e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod],await fileUtils.fileExists(this.dirHandle,this.tile_info.satFileName)===!0?t=await idbKeyval.get("sat_image_buffer"):t=await mapUtils.downloadTerrainRgb(this.satellite_image_url),await this.processGdal(t,this.tile_info.satelliteFileName,e,"jpg","createHeightmap"));else if(await this.saveImage(t,this.tile_info.sixteenFileName,"png"),this.exportOptionsModel.includes("satellite")){let o=await mapUtils.downloadTerrainRgb(this.satellite_image_url);await this.saveImage(o,this.tile_info.satelliteFileName,"jpg")}this.qt.loading.hide();break;case"Geojson Only":await this.unrealTileFeatures(!0),this.qt.loading.hide();break;case"Unreal Stamp Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"Unreal Landmass Effect Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"None":await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.sixteenFileName,f.toBuffer()),this.qt.loading.hide();break}}else this.alertMsg="Please double click on your chosen selection first.",this.alert=!0}this.qt.loading.hide()}else this.alertMsg="Please double click on your chosen selection first.",this.alert=!0,this.qt.loading.hide()}}},_hoisted_1$2=createBaseVNode("div",{id:"previewTitle",class:"text-h6 bg-primary text-white"},"Preview Image",-1),_hoisted_2$2={class:"row justify-start q-pa-none q-mb-md"},_hoisted_3$2={style:{width:"100%"}},_hoisted_4$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_5$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_6$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Type:")],-1),_hoisted_7$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Options:")],-1),_hoisted_8$2=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Coordinates for Unreal LandscapeGen Plugin")],-1),_hoisted_9$2=createBaseVNode("div",{class:"text-h6"},"Zoom:",-1),_hoisted_10$2=createBaseVNode("div",{class:"text-h6"},"Mouse Point Lat/Lng:",-1),_hoisted_11$2=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Bounding Box Corners Lat/Lng:")],-1),_hoisted_12$2=createBaseVNode("div",{class:"text-h6"},"Top Left:",-1),_hoisted_13$2=createBaseVNode("div",{class:"text-h6"},"Bottom Left:",-1),_hoisted_14=createBaseVNode("div",{class:"text-h6"},"Top Right:",-1),_hoisted_15=createBaseVNode("div",{class:"text-h6"},"Bottom Right:",-1),_hoisted_16=createBaseVNode("div",{class:"text-h6"},"Lng/Lat Max/Min:",-1),_hoisted_17=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$2(e,t,r,n,a,s){return openBlock(),createElementBlock(Fragment,null,[_hoisted_1$2,createVNode(QImg,{src:n.url,height:"250px"},null,8,["src"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(QField,{dense:"",class:"text-weight-bolder q-pt-none q-mt-xs",label:"Min/Max Elevation","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_4$2,toDisplayString(this.tile_info.minmax),1)]),_:1}),createVNode(QField,{class:"q-pt-none q-mt-xs",dense:"",label:"Unreal X,Y and Z-Scale",hint:"Input into Unreal Landscape Z scale","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_5$2,toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.zscale),1)]),_:1}),createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_6$2]),_:1}),createVNode(QSelect,{class:"q-mt-none q-pt-none","bg-color":"blue-2",outlined:"",filled:"",dense:"",modelValue:n.exportType,"onUpdate:modelValue":[t[0]||(t[0]=f=>n.exportType=f),s.exportType_Change],options:n.exportTypeOptions,"option-disable":"cannotSelect"},null,8,["modelValue","options","option-disable","onUpdate:modelValue"]),withDirectives(createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_7$2]),_:1},512),[[vShow,n.isExportOptions]]),withDirectives(createVNode(QOptionGroup,{class:"q-mt-none q-pt-none",dense:"",inline:"",options:n.exportOptions,"onUpdate:modelValue":[s.exportOptionsModelChange,t[1]||(t[1]=f=>n.exportOptionsModel=f)],type:"checkbox",modelValue:n.exportOptionsModel},null,8,["options","onUpdate:modelValue","modelValue"]),[[vShow,n.isExportOptions]]),withDirectives(createVNode(QSelect,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Size","transition-show":"scale","transition-hide":"scale",hint:"Unreal Recommended Sizes",outlined:"",modelValue:n.unrealLandscape,"onUpdate:modelValue":[t[2]||(t[2]=f=>n.unrealLandscape=f),s.landscapeSizeChange],options:n.landscapeSize},null,8,["modelValue","options","onUpdate:modelValue"]),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[createVNode(QCheckbox,{modelValue:n.isWorldPartition,"onUpdate:modelValue":t[3]||(t[3]=f=>n.isWorldPartition=f),label:"Enable World Partition"},null,8,["modelValue"])]),_:1},512),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"World Partition Grid Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:n.gridSize,"onUpdate:modelValue":t[4]||(t[4]=f=>n.gridSize=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Brush Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:n.alphaBrushHeight,"onUpdate:modelValue":t[5]||(t[5]=f=>n.alphaBrushHeight=f),label:"Height"},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:n.alphaBrushWidth,"onUpdate:modelValue":t[6]||(t[6]=f=>n.alphaBrushWidth=f),label:"Width"},null,8,["modelValue"]),createVNode(QInput,{ref:"alphaBrushNameRef",dense:"",modelValue:n.alphaBrushName,"onUpdate:modelValue":t[7]||(t[7]=f=>n.alphaBrushName=f),label:"Brush Name"},null,8,["modelValue"])]),_:1},512),[[vShow,n.isAlphaBrush]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Name (Optional)",hint:"Enter Unique Landscape Name"},{default:withCtx(()=>[createVNode(QInput,{dense:"",modelValue:n.landscapeName,"onUpdate:modelValue":t[8]||(t[8]=f=>n.landscapeName=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:n.blurRadius,"onUpdate:modelValue":t[9]||(t[9]=f=>n.blurRadius=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isBlurRadius]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Weightmap Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:n.blurRadiusWeightmap,"onUpdate:modelValue":t[10]||(t[10]=f=>n.blurRadiusWeightmap=f)},null,8,["modelValue"])]),_:1},512),[[vShow,n.isBlurRadius]])])]),withDirectives(createVNode(QBtn,{onClick:s.createSixteenHeightMap,ref:"btnDownload",dense:"",color:"primary","no-caps":"",label:"Download HeightMap"},null,8,["onClick"]),[[vShow,n.isDownload]]),withDirectives(createVNode(QBtn,{onClick:s.sendToUnreal,disabled:n.isDisabled,dense:"",color:"green",class:"q-ml-xs","no-caps":"",label:"Send To Unreal"},null,8,["onClick","disabled"]),[[vShow,n.isSendToUnreal]]),createVNode(QBtn,{onClick:s.copyExtents,disabled:n.isDisabled,dense:"",color:"purple",class:"q-ml-xs","no-caps":"",label:"Copy Bounds for Blender Osm"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:s.copyTileInfoString,disabled:n.isDisabled,dense:"",color:"cyan",class:"q-ml-xs","no-caps":"",label:"Copy Slippy Tile Info String"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:s.showBBInfo,dense:"",color:"orange","no-caps":"",label:"Show Bounding Box Info"},null,8,["onClick"]),createVNode(QDialog,{modelValue:n.bbinfoalert,"onUpdate:modelValue":t[11]||(t[11]=f=>n.bbinfoalert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_8$2]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[_hoisted_9$2,createTextVNode(" "+toDisplayString(n.tile_info.z)+" ",1),_hoisted_10$2,createTextVNode(" Lat: "+toDisplayString(n.tile_info.pointLat)+" Lng: "+toDisplayString(n.tile_info.pointLng)+" ",1),_hoisted_11$2,_hoisted_12$2,createTextVNode(" Lat: "+toDisplayString(n.tile_info.topLeft.lat)+" Lng: "+toDisplayString(n.tile_info.topLeft.lng)+" ",1),_hoisted_13$2,createTextVNode(" Lat: "+toDisplayString(n.tile_info.bottomLeft.lat)+" Lng: "+toDisplayString(n.tile_info.bottomLeft.lng)+" ",1),_hoisted_14,createTextVNode(" Lat: "+toDisplayString(n.tile_info.topRight.lat)+" Lng: "+toDisplayString(n.tile_info.topRight.lng)+" ",1),_hoisted_15,createTextVNode(" Lat: "+toDisplayString(n.tile_info.bottomRight.lat)+" Lng: "+toDisplayString(n.tile_info.bottomRight.lng)+" ",1),_hoisted_16,createTextVNode(" Lng/Lat-Min: "+toDisplayString(n.tile_info.bboxW)+" , "+toDisplayString(n.tile_info.bboxS)+" Lng/Lat-Max: "+toDisplayString(n.tile_info.bboxE)+" , "+toDisplayString(n.tile_info.bboxN),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[12]||(t[12]=f=>n.alert=f)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_17]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const SideNav=_export_sfc(_sfc_main$2,[["render",_sfc_render$2]]),version="2.8.0",_sfc_main$1={setup(){return{appVersion:ref(version)}},emits:["ok","hide"],methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){this.$emit("ok"),this.hide()},onCancelClick(){this.hide()}}},_hoisted_1$1=createBaseVNode("div",null,[createBaseVNode("b",null,"Help")],-1),_hoisted_2$1=createBaseVNode("br",null,null,-1),_hoisted_3$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Settings Page:")],-1),_hoisted_4$1=createBaseVNode("ol",null,[createBaseVNode("li",null,[createTextVNode(" You need to create a free Mapbox account and enter your mapbox access token. Goto "),createBaseVNode("a",{href:"https://www.mapbox.com",target:"_blank"},"Mapbox"),createTextVNode(" then goto your account page. There you can copy your access token. ")]),createBaseVNode("li",null," Select a download folder. This is a folder on your local pc where your heightmap files will be saved. ")],-1),_hoisted_5$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Map Page:")],-1),_hoisted_6$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Map Settings"),createTextVNode(" -- Enable different layers for viewing. This does not affect downloaded data ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Search Bar"),createTextVNode(" -- Enter the name of a location or Longitude Latitude seperated by a comma. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Top Bar"),createTextVNode(" -- Area in KM show the area of the blue bounding box in Kilometers. Slippy Tile Info String is a standard format identification for downloading map tiles. Format is X,Y,Z Z = zoom level. ")])],-1),_hoisted_7$1=createBaseVNode("div",{class:""},[createBaseVNode("b",null,"Map Navigation:")],-1),_hoisted_8$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Select a Draw mode"),createTextVNode(" -- Select a draw mode from the control on the right of the map. "),createBaseVNode("br"),createBaseVNode("u",null,[createBaseVNode("img",{src:"/single_tile.png",alt:"Single select"}),createTextVNode(" Single tile select")]),createTextVNode(" -- Select a single tile (default mode) "),createBaseVNode("br"),createBaseVNode("u",null,[createBaseVNode("img",{src:"/multiple_tile.png",alt:"Multiple select"}),createTextVNode(" Draw rectangle to select multiple tiles")]),createTextVNode(" See Tile stitching video at the bottom for use. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Click"),createTextVNode(" -- Selects a location on the map indicated by a blue bounding box. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Double Left Mouse Click"),createTextVNode(" -- Download the tile preview and tile information. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Right Mouse Hold"),createTextVNode(" -- Tilt and Rotate the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Scroll Wheel"),createTextVNode(" -- Zoom in and out. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Arrow Keys"),createTextVNode(" -- Move around the map. ")])],-1),_hoisted_9$1=createBaseVNode("div",{class:"q-mb-md"},[createBaseVNode("b",null,"Left Side Bar:")],-1),_hoisted_10$1=createBaseVNode("div",{class:"q-ml-md"},[createBaseVNode("div",null,[createBaseVNode("u",null,"Export Type:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Heightmap"),createTextVNode(" -- Generates a 16-bit png heightmap file. Can be used in other applications besides Unreal. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- EarthLandscape Clip"),createTextVNode(" -- Sends tile info string x,y and zoom to Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added it to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"),createTextVNode(" -- Downloads heightmap from this app and loads it into Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Stamp Brush Plugin"),createTextVNode(" -- You need to install paid plugin "),createBaseVNode("a",{href:"https://www.unrealengine.com/marketplace/en-US/product/landscape-stamping-tool-100-custom-brushes?sessionInvalidated=true"},"Landscape Stamping Tool - 100+ Custom Brushes"),createTextVNode(". This automates the creation of new stamps from selected map location. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Landmass Effect Brush Plugin"),createTextVNode(" -- Open source plugin for creating non-destructive landmass stamps and other features. Download the source from here "),createBaseVNode("a",{href:"https://github.com/AWeinb/SimplerLandmassBlueprints"},"SimplerLandmassBlueprints"),createTextVNode(". From the Content folder copy the whole Editor folder to your Content directory. Each time you click Send To Unreal it will import the texture to a sub folder CustomBrushes > Textures. For now it only imports the texture you have to manually add the texture to the brush according to the github instructions. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"None"),createTextVNode(" -- Generate 16-bit png heightmap but do not do any other transformations to the image. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Geojson Only"),createTextVNode(" -- Do not download a heightmap png file. Just download a Geojson file. ")])])]),createBaseVNode("div",null,[createBaseVNode("u",null,"Export Options:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Zrange-sea level="),createTextVNode(" -- By checking this the imported heightmap will keep the landscape height near 100 Unreal Units. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"FlipX/FlipY"),createTextVNode(" -- Flips the sides of the heightmap image in the X or Y direction. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Satellite"),createTextVNode(" -- Downloads a Satellite Image of the selected area. This can be used as on overlay in UE. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Geojson Features"),createTextVNode(" -- Downloads the features of the selected area in geojson format. Search Mapbox for geosjon. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Combine Unique Features"),createTextVNode(" -- Removes overlapping features when downloading geojson ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Create Weightmap (Splatmap) Files"),createTextVNode(" -- You can now create weightmap files for use in Unreal for texturing your landscape. Setup and Use instructions https://www.youtube.com/watch?v=j_4pZ5EneVc&t=6s ")])])])],-1),_hoisted_11$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Landscape:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Size"),createTextVNode(" -- Resamples the size of the image to recommended Unreal Landscape sizes. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Enable World Partition"),createTextVNode(" -- If you have a World Partition project and want a World Partition landscape with proxies, enable this.. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"World Partition Grid Size"),createTextVNode(" -- Grid size setting. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Name"),createTextVNode(" -- Name of the landscape to be imported. (Optional ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Blur Radius"),createTextVNode(" -- Adds a gaussian blur to the heightmap png. This can help smooth out your imported landscape if it has some sharp edges. The greater the number the greater the blur. 0 = no blur. ")])])],-1),_hoisted_12$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Buttons:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Download Heightmap"),createTextVNode(" -- Downloads the heightmap png to the folder location on the settings page. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Send To Unreal"),createTextVNode(" -- Automatically imports heightmap or stamp into your Unreal project. Required -- Mapbox_BP has to be installed in to your unreal project and configured. You can download the free plugin here "),createBaseVNode("a",{href:"https://github.com/delebash/UnrealMapboxBridgePlugin"},"Unreal Mapbox Bridge Plugin"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Bounds for Blender OSM"),createTextVNode(" -- A plugin for blend that downloads real world map info into blender. It has it's own map but you can use this one as well since it has a search by name feature. Download "),createBaseVNode("a",{href:"https://github.com/vvoovv/blender-osm"},"Blender OSM"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Slippy Tile Info String"),createTextVNode(" -- This format is used in many other GIS applications to download map tile information. This is just a convenience function. This is also the same string Terrain Magic expects. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Show Bounding Box Info"),createTextVNode(" -- General info such as Long/Lat info for bounding box. ")])])],-1),_hoisted_13$1=createBaseVNode("div",null,[createBaseVNode("u",null,"Videos:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("a",{href:"https://www.youtube.com/playlist?list=PLFCVXzupw1r_7ExUSGDxHGHU-gPRxOGeZ"},"Unreal Mapbox Bridge Tutorial Playlist")])])],-1);function _sfc_render$1(e,t,r,n,a,s){return openBlock(),createBlock(QDialog,{class:"dialog-plugin",ref:"dialog",onHide:s.onDialogHide},{default:withCtx(()=>[createVNode(QCard,{style:{width:"900px","max-width":"80vw",height:"700px"}},{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_1$1,_hoisted_2$1,createVNode(QSeparator),_hoisted_3$1,_hoisted_4$1,_hoisted_5$1,_hoisted_6$1,_hoisted_7$1,_hoisted_8$1,_hoisted_9$1,_hoisted_10$1,_hoisted_11$1,_hoisted_12$1,_hoisted_13$1,createVNode(QCardActions,{class:"absolute-top",align:"right"},{default:withCtx(()=>[createTextVNode(" App Version "+toDisplayString(n.appVersion)+"  ",1),createVNode(QBtn,{color:"primary",label:"Close",onClick:s.onOKClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"])}const Help=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),columns=[{name:"name",align:"left",label:"Name",field:"name",sortable:!0},{name:"color",align:"left",label:"Color",field:"color",sortable:!0}];let rows=[{name:"Forest",color:"201, 28, 19"},{name:"Water",color:"78, 143, 207"},{name:"Scrub",color:"143, 253, 139"},{name:"Trees",color:"34, 106, 32"},{name:"Rock",color:"101, 100, 93"},{name:"Sand",color:"243, 234, 129"},{name:"Grass",color:"33, 225, 29"},{name:"Glacier",color:"255, 255, 255"},{name:"Landcover",color:"0, 0, 0"},{name:"Hillshade",color:"242, 110, 220"}];const _sfc_main={setup(){const e=useQuasar(),t=ref([]),r=ref(!1);return{mapserver:ref("Mapbox"),servertype:["Maptiler","Mapbox"],selected:t,columns,rows:ref(rows),loading:r,pagination:ref({rowsPerPage:0}),getSelectedString(){return t.value.length===0?"":`${t.value.length} record${t.value.length>1?"s":""} selected of ${rows.length}`},showDialog(){e.dialog({component:Help,componentProps:{text:""}}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},data_path:"",selectedTab:ref("map"),alert:ref(!1),alertMsg:ref(""),saveStitchingFiles:ref(!1),dirHandle:ref(""),dirName:ref(""),maptiler_style_url:ref(""),maptiler_access_token:ref(""),maptiler_api_url:ref(""),maptiler_raster_png_dem:ref(""),maptiler_satellite_endpoint:ref(""),maptiler_raster_style_url:ref(""),maptiler_raster_style_endpoint:ref(""),mapbox_style_url:ref(""),mapbox_access_token:ref(""),mapbox_api_url:ref(""),mapbox_raster_style_endpoint:ref(""),mapbox_raster_style_url:ref(""),mapbox_raster_png_dem:ref(""),mapbox_satellite_endpoint:ref(""),isPwd:ref(!0),drawerLeft:ref(!1),createFolder:ref(!1)}},mounted:async function(){this.checkFileApiSupport(),await this.loadUserData(),this.isRequiredSettings()===!0&&await this.loadMap()},methods:{async mapserverChange(e){this.mapserver=e,idbKeyval.set("mapserver",this.mapserver),await this.loadUserData()},addRow(){let e={name:"Color",color:"0, 0, 0"};this.rows.push(e)},removeRow(){if(this.selected.length>0){let e=this.rows.filter(t=>!this.selected.includes(t));this.rows=JSON.parse(JSON.stringify(e)),this.saveRow()}else this.alertMsg="Select row(s) to delete.",this.alert=!0},saveRow(){if(isProxy(this.rows)){let e=toRaw(this.rows);idbKeyval.set("weightmap_data",e)}else idbKeyval.set("weightmap_data",this.rows)},checkFileApiSupport(){fileUtils.checkFileApiSupport()===!1&&(this.alertMsg="This browser does not support File System Access API.  Try Edge or Chrome.",this.alert=!0)},resizeMap(){this.mapserver==="Mapbox"?this.$refs.mapBoxViewer.resizeMap():this.mapserver==="Maptiler"&&this.$refs.mapTilerViewer.resizeMap()},changeDrawer(){this.drawerLeft=!this.drawerLeft},async loadMap(){this.selectedTab="map",await this.$nextTick(()=>{this.mapserver==="Mapbox"?this.$refs.mapBoxViewer.loadMapboxMap():this.mapserver==="Maptiler"&&this.$refs.mapTilerViewer.loadMapTilerMap(),this.$refs.sideNavRef.forceRefresh()})},async loadWeightMap(){await this.$nextTick(()=>{this.mapserver==="Mapbox"&&this.$refs.weightmapViewerRef.loadMapboxWeightMap()})},isRequiredSettings(){if(this.mapserver==="Mapbox")return this.mapbox_access_token&&this.mapbox_style_url&&this.dirName?!0:(this.redirectToSettings(),!1);if(this.mapserver==="Maptiler")return!0},redirectToSettings(){this.selectedTab="settings",Notify.create({color:"negative",textColor:"white",icon:"report_problem",message:"Please fill out the required fields!",position:"top"})},async openDirectory(){let e;try{e=await fileUtils.getDirHandle()}catch(t){if(t.name==="AbortError")return;console.error("An error occured trying to open the file.",t)}e&&(idbKeyval.set("dirHandle",e),this.dirName=e.name)},saveUserSettings(){if(idbKeyval.set("mapserver",this.mapserver),this.mapserver==="Maptiler"?(idbKeyval.set("maptiler_access_token",this.maptiler_access_token),idbKeyval.set("maptiler_style_url",this.maptiler_style_url),idbKeyval.set("maptiler_api_url",this.maptiler_api_url),idbKeyval.set("maptiler_raster_png_dem",this.maptiler_raster_png_dem),idbKeyval.set("maptiler_satellite_endpoint",this.maptiler_satellite_endpoint),idbKeyval.set("maptiler_raster_style_endpoint",this.maptiler_raster_style_endpoint),idbKeyval.set("maptiler_raster_style_url",this.maptiler_raster_style_url)):this.mapserver==="Mapbox"&&(idbKeyval.set("mapbox_access_token",this.mapbox_access_token),idbKeyval.set("mapbox_style_url",this.mapbox_style_url),idbKeyval.set("mapbox_api_url",this.mapbox_api_url),idbKeyval.set("mapbox_satellite_endpoint",this.mapbox_satellite_endpoint),idbKeyval.set("mapbox_raster_png_dem",this.mapbox_raster_png_dem),idbKeyval.set("mapbox_raster_style_endpoint",this.mapbox_raster_style_endpoint),idbKeyval.set("mapbox_raster_style_url",this.mapbox_raster_style_url)),idbKeyval.set("mapserver",this.mapserver),idbKeyval.set("create_folder",this.createFolder),idbKeyval.set("saveStitchingFiles",this.saveStitchingFiles),isProxy(this.rows)){let e=toRaw(this.rows);idbKeyval.set("weightmap_data",e)}else idbKeyval.set("weightmap_data",this.rows);this.isRequiredSettings()===!0&&this.loadMap()},async loadUserData(){this.mapserver=await idbKeyval.get("mapserver")||"Mapbox",this.mapserver==="Maptiler"?(this.maptiler_access_token=await idbKeyval.get("maptiler_access_token")||"",this.maptiler_style_url=await idbKeyval.get("maptiler_style_url")||"https://api.maptiler.com/maps/streets/style.json",this.maptiler_raster_png_dem=await idbKeyval.get("maptiler_raster_png_dem")||"https://api.maptiler.com/tiles/terrain-rgb-v2/",this.maptiler_api_url=await idbKeyval.get("maptiler_api_url")||"https://api.maptiler.com",this.maptiler_satellite_endpoint=await idbKeyval.get("maptiler_satellite_endpoint")||"https://api.maptiler.com/tiles/satellite-v2",this.maptiler_raster_style_endpoint=await idbKeyval.get("maptiler_raster_style_endpoint")||"https://api.maptiler.com/maps",this.maptiler_raster_style_url=await idbKeyval.get("maptiler_raster_style_url")||""):this.mapserver==="Mapbox"&&(this.mapbox_access_token=await idbKeyval.get("mapbox_access_token")||"",this.mapbox_style_url=await idbKeyval.get("mapbox_style_url")||"mapbox://styles/mapbox/streets-v11",this.mapbox_api_url=await idbKeyval.get("mapbox_api_url")||"https://api.mapbox.com/v4/",this.mapbox_satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint")||"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles",this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem")||"mapbox.mapbox-terrain-dem-v1",this.mapbox_raster_style_endpoint=await idbKeyval.get("mapbox_raster_style_endpoint")||"https://api.mapbox.com/styles/v1",this.mapbox_raster_style_url=await idbKeyval.get("mapbox_raster_style_url")||"");let e=await idbKeyval.get("dirHandle")||"";this.createFolder=await idbKeyval.get("create_folder")||"",this.saveStitchingFiles=await idbKeyval.get("saveStitchingFiles")||!1;let t=await idbKeyval.get("weightmap_data")||[];t.length===0?(idbKeyval.set("weightmap_data",rows),this.rows=rows):this.rows=t,this.dirHandle=e,this.dirName=e.name}},components:{MapboxMapViewer,MaptilerMapViewer,WeightmapViewer,SideNav,Help}},_hoisted_1={class:"row q-pa-xs full-height"},_hoisted_2={key:0},_hoisted_3=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Maptiler Settings")],-1),_hoisted_4={key:1},_hoisted_5=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Mapbox Settings")],-1),_hoisted_6=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/access-token/",target:"_blank"},"Mapbox access token docs",-1),_hoisted_7=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/style-url/",target:"_blank"},"Mapbox style url docs",-1),_hoisted_8=createBaseVNode("a",{href:"https://api.mapbox.com/styles/v1/delebash/clfzz7dot000001qilz330eyt.html?title=copy&access_token=pk.eyJ1IjoiZGVsZWJhc2giLCJhIjoiY2t1YWxkODF0MGh2NjJxcXA4czBpdXlmdyJ9.D_ngzR7j4vU1CILtpNLg4Q&zoomwheel=true&fresh=true#9.64/47.0529/-122.3211/0/7"},"Copy Mapbox Weightmap Style",-1),_hoisted_9={class:"q-pa-none row items-start"},_hoisted_10={class:"col q-pa-none"},_hoisted_11=createBaseVNode("br",null,null,-1),_hoisted_12={key:2,class:"q-pa-md"},_hoisted_13=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render(e,t,r,n,a,s){const f=resolveComponent("side-nav"),o=resolveComponent("mapbox-map-viewer"),x=resolveComponent("maptiler-map-viewer"),C=resolveComponent("weightmap-viewer");return openBlock(),createBlock(QLayout,{view:"lHr lpr lfr"},{default:withCtx(()=>[createVNode(QHeader,{dense:"",elevated:"",class:"bg-primary text-white","height-hint":"98"}),createVNode(QDrawer,{dense:"","show-if-above":"",modelValue:n.drawerLeft,"onUpdate:modelValue":t[0]||(t[0]=P=>n.drawerLeft=P),side:"left",onHide:s.resizeMap,class:"no-margin no-padding"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(QCard,{class:"col q-pl-xs"},{default:withCtx(()=>[createVNode(f,{ref:"sideNavRef"},null,512)]),_:1})])]),_:1},8,["modelValue","onHide"]),createVNode(QPageContainer,null,{default:withCtx(()=>[createVNode(QPage,{class:"row no-margin q-pa-sm"},{default:withCtx(()=>[createVNode(QCard,{class:"col"},{default:withCtx(()=>[createVNode(QTabs,{dense:"",modelValue:n.selectedTab,"onUpdate:modelValue":t[3]||(t[3]=P=>n.selectedTab=P),class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:withCtx(()=>[createVNode(QBtn,{dense:"",flat:"",onClick:s.changeDrawer,round:"",icon:"menu"},null,8,["onClick"]),createVNode(QTab,{dense:"",name:"map",label:"Map"}),n.mapserver=="Mapbox"?(openBlock(),createBlock(QTab,{key:0,dense:"",name:"weightmap",onClick:t[1]||(t[1]=P=>s.loadWeightMap()),label:"Weight Map"})):createCommentVNode("",!0),createVNode(QTab,{dense:"",name:"settings",label:"Settings"}),createVNode(QBtn,{style:{background:"#FF0080",color:"white"},label:"Help",class:"q-mr-lg",onClick:n.showDialog},null,8,["onClick"]),createVNode(QBtn,{dense:"",flat:"",round:"",onClick:t[2]||(t[2]=P=>e.$q.dark.toggle()),icon:e.$q.dark.isActive?"nights_stay":"wb_sunny"},null,8,["icon"])]),_:1},8,["modelValue"]),createVNode(QSeparator),createVNode(QTabPanels,{class:"q-pa-none q-ma-none","keep-alive":"",modelValue:n.selectedTab,"onUpdate:modelValue":t[26]||(t[26]=P=>n.selectedTab=P),animated:""},{default:withCtx(()=>[createVNode(QTabPanel,{name:"map",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[n.mapserver=="Mapbox"?(openBlock(),createBlock(o,{key:0,class:"col",ref:"mapBoxViewer"},null,512)):createCommentVNode("",!0),n.mapserver=="Maptiler"?(openBlock(),createBlock(x,{key:1,class:"col",ref:"mapTilerViewer"},null,512)):createCommentVNode("",!0)]),_:1}),createVNode(QTabPanel,{name:"weightmap",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[createVNode(C,{class:"col",ref:"weightmapViewerRef"},null,512)]),_:1}),createVNode(QTabPanel,{lass:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",name:"settings"},{default:withCtx(()=>[createVNode(QSelect,{"onUpdate:modelValue":[t[4]||(t[4]=P=>s.mapserverChange(P)),t[5]||(t[5]=P=>n.mapserver=P)],modelValue:n.mapserver,options:n.servertype,label:"Server Type"},null,8,["modelValue","options"]),n.mapserver=="Maptiler"?(openBlock(),createElementBlock("div",_hoisted_2,[_hoisted_3,createVNode(QInput,{dense:"",modelValue:n.maptiler_access_token,"onUpdate:modelValue":t[7]||(t[7]=P=>n.maptiler_access_token=P),label:"Maptiler Access Token *",filled:"",type:n.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Maptiler accounts page. The Maptiler free plan is a great choice.",rules:[P=>P&&P.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:n.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[6]||(t[6]=P=>n.isPwd=!n.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_style_url,"onUpdate:modelValue":t[8]||(t[8]=P=>n.maptiler_style_url=P),label:"Enter your Maptiler style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Maptiler Studio.",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_api_url,"onUpdate:modelValue":t[9]||(t[9]=P=>n.maptiler_api_url=P),label:"Maptiler base api url *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_raster_png_dem,"onUpdate:modelValue":t[10]||(t[10]=P=>n.maptiler_raster_png_dem=P),label:"Maptiler Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.maptiler_satellite_endpoint,"onUpdate:modelValue":t[11]||(t[11]=P=>n.maptiler_satellite_endpoint=P),label:"Maptiler Satellite Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"])])):createCommentVNode("",!0),n.mapserver=="Mapbox"?(openBlock(),createElementBlock("div",_hoisted_4,[_hoisted_5,createTextVNode(" See: "),_hoisted_6,createVNode(QInput,{dense:"",modelValue:n.mapbox_access_token,"onUpdate:modelValue":t[13]||(t[13]=P=>n.mapbox_access_token=P),label:"Mapbox Access Token *",filled:"",type:n.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Mapbox accounts page. The Mapbox free plan is a great choice.",rules:[P=>P&&P.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:n.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[12]||(t[12]=P=>n.isPwd=!n.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createTextVNode(" See: "),_hoisted_7,createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_style_url,"onUpdate:modelValue":t[14]||(t[14]=P=>n.mapbox_style_url=P),label:"Enter your Mapbox style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Mapbox Studio.",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_api_url,"onUpdate:modelValue":t[15]||(t[15]=P=>n.mapbox_api_url=P),label:"Mapbox base api url *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_raster_png_dem,"onUpdate:modelValue":t[16]||(t[16]=P=>n.mapbox_raster_png_dem=P),label:"Mapbox Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_satellite_endpoint,"onUpdate:modelValue":t[17]||(t[17]=P=>n.mapbox_satellite_endpoint=P),label:"Mapbox Satellite Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createTextVNode(" Click "),_hoisted_8,createTextVNode(" to copy this style to your mapbox account and then paste your new style address in text box below in the format name/style id example: delebash/clfzz7dot000001qilz330eyt "),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_raster_style_url,"onUpdate:modelValue":t[18]||(t[18]=P=>n.mapbox_raster_style_url=P),label:"Mapbox Weight Map Style",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:n.mapbox_raster_style_endpoint,"onUpdate:modelValue":t[19]||(t[19]=P=>n.mapbox_raster_style_endpoint=P),label:"Mapbox Raster From Style Endpoint",filled:"","lazy-rules":"",hint:""},null,8,["modelValue"])])):createCommentVNode("",!0),createVNode(QCheckbox,{modelValue:n.saveStitchingFiles,"onUpdate:modelValue":t[20]||(t[20]=P=>n.saveStitchingFiles=P),label:"Save Temp Stitching files to disk"},null,8,["modelValue"]),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createVNode(QInput,{dense:"",class:"q-pb-none",modelValue:n.dirName,"onUpdate:modelValue":t[21]||(t[21]=P=>n.dirName=P),label:"Enter download directory path *",filled:"","lazy-rules":"",rules:[P=>P&&P.length>0||"Please type something"],type:n.isPwd?"":"text"},null,8,["modelValue","rules","type"])]),createVNode(QBtn,{class:"q-pb-none",dense:"",onClick:t[22]||(t[22]=P=>s.openDirectory()),color:"secondary",label:"Select download folder"})]),_hoisted_11,n.mapserver=="Mapbox"?(openBlock(),createElementBlock("div",_hoisted_12,[createVNode(QTable,{flat:"",bordered:"",title:"Weightmap colors",rows:n.rows,columns:n.columns,"row-key":"name","selected-rows-label":n.getSelectedString,selection:"multiple",selected:n.selected,"onUpdate:selected":t[23]||(t[23]=P=>n.selected=P),"virtual-scroll":"",pagination:n.pagination,"onUpdate:pagination":t[24]||(t[24]=P=>n.pagination=P),"rows-per-page-options":[0],loading:n.loading},{top:withCtx(()=>[createVNode(QBtn,{color:"primary",disable:n.loading,label:"Add new color",onClick:s.addRow},null,8,["disable","onClick"]),createVNode(QBtn,{class:"q-ml-sm",color:"primary",disable:n.loading,label:"Delete selected rows",onClick:s.removeRow},null,8,["disable","onClick"])]),body:withCtx(P=>[createVNode(QTr,{props:P},{default:withCtx(()=>[createVNode(QTd,null,{default:withCtx(()=>[createVNode(QCheckbox,{dense:"",modelValue:P.selected,"onUpdate:modelValue":ge=>P.selected=ge},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),createVNode(QTd,{key:"name",props:P},{default:withCtx(()=>[createTextVNode(toDisplayString(P.row.name)+" ",1),createVNode(QPopupEdit,{modelValue:P.row.name,"onUpdate:modelValue":ge=>P.row.name=ge,title:"Name",onSave:s.saveRow},{default:withCtx(ge=>[createVNode(QInput,{modelValue:ge.value,"onUpdate:modelValue":nt=>ge.value=nt,dense:"",autofocus:"",counter:"",onKeyup:withKeys(ge.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),createVNode(QTd,{key:"color",props:P},{default:withCtx(()=>[createTextVNode(toDisplayString(P.row.color)+" ",1),createVNode(QPopupEdit,{modelValue:P.row.color,"onUpdate:modelValue":ge=>P.row.color=ge,title:"r,g,b",onSave:s.saveRow},{default:withCtx(ge=>[createVNode(QInput,{modelValue:ge.value,"onUpdate:modelValue":nt=>ge.value=nt,dense:"",autofocus:"",counter:"",onKeyup:withKeys(ge.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected-rows-label","selected","pagination","loading"])])):createCommentVNode("",!0),createVNode(QBtn,{class:"q-pt-none",dense:"",onClick:t[25]||(t[25]=P=>s.saveUserSettings()),color:"secondary",label:"Save settings"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),createVNode(QDialog,{modelValue:n.alert,"onUpdate:modelValue":t[27]||(t[27]=P=>n.alert=P)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_13]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(n.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const MainLayout=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{MainLayout as default};
