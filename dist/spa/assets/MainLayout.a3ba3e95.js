import{r as ref,i as isRuntimeSsrPreHydration,o as onMounted,c as createComponent,a as onBeforeUnmount,n as noop,b as nextTick,h,g as getCurrentInstance,l as listenOpts,d as inject,e as emptyRenderFn,f as computed,w as watch,j as hUniqueSlot,k as layoutKey,P as Platform,m as createDirective,p as client$1,q as leftClick,s as addEvt,t as preventDraggable,u as prevent,v as stop,x as position,y as cleanEvt,z as stopAndPrevent,A as useModelToggleProps,B as useDarkProps,C as useModelToggleEmits,D as useDark,E as useTimeout,F as useModelToggle,G as useHistory,H as withDirectives,I as hDir,J as hSlot,K as usePreventScroll,L as tabsKey,R as Ripple,M as isKeyCode,N as shouldIgnoreKey,Q as QIcon,O as hMergeSlot,S as isDeepEqual,T as uid$1,U as useTick,V as provide,W as onDeactivated,X as onActivated,Y as Transition,Z as getNormalizedVNodes,_ as KeepAlive,$ as pageContainerKey,a0 as getScrollTarget,a1 as getVerticalScrollPosition,a2 as getHorizontalScrollPosition,a3 as getScrollbarWidth,a4 as reactive,a5 as onUnmounted,a6 as getPortalProxy,a7 as closePortals,a8 as portalProxyList,a9 as useTransitionProps,aa as useTransition,ab as usePortal,ac as addFocusout,ad as removeFocusout,ae as removeEscapeKey,af as closePortalMenus,ag as addEscapeKey,ah as addFocusFn,ai as childHasFocus,aj as _export_sfc,ak as openBlock,al as createElementBlock,am as createVNode,an as withCtx,ao as QBtn,ap as createBaseVNode,aq as QOptionGroup,ar as createTextVNode,as as toDisplayString,at as QSpinner,au as useFieldProps,av as useFieldEmits,aw as useField,ax as useFieldState,ay as useSizeProps,az as useSize,aA as hMergeSlotSafely,aB as useRouterLinkProps,aC as useRouterLink,aD as debounce$2,aE as onBeforeMount,aF as useFormProps,aG as useFormInputNameAttr,aH as fieldValueIsFilled,aI as onBeforeUpdate,aJ as onUpdated,aK as useKeyComposition,aL as QDialog,aM as quasarKey,aN as vShow,aO as QCheckbox,aP as QInput,aQ as QCard,aR as QCardSection,aS as QCardActions,aT as Fragment,aU as createBlock,aV as QSeparator,aW as Notify,aX as resolveComponent}from"./index.91e693a3.js";import{Q as QPage}from"./QPage.9e0d7ae0.js";function useCanRender(){const e=ref(!isRuntimeSsrPreHydration.value);return e.value===!1&&onMounted(()=>{e.value=!0}),e}const hasObserver=typeof ResizeObserver<"u",resizeProps=hasObserver===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"};var QResizeObserver=createComponent({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:t}){let n=null,o,u={width:-1,height:-1};function f(b){b===!0||e.debounce===0||e.debounce==="0"?g():n===null&&(n=setTimeout(g,e.debounce))}function g(){if(n!==null&&(clearTimeout(n),n=null),o){const{offsetWidth:b,offsetHeight:T}=o;(b!==u.width||T!==u.height)&&(u={width:b,height:T},t("resize",u))}}const{proxy:a}=getCurrentInstance();if(hasObserver===!0){let b;const T=C=>{o=a.$el.parentNode,o?(b=new ResizeObserver(f),b.observe(o),g()):C!==!0&&nextTick(()=>{T(!0)})};return onMounted(()=>{T()}),onBeforeUnmount(()=>{n!==null&&clearTimeout(n),b!==void 0&&(b.disconnect!==void 0?b.disconnect():o&&b.unobserve(o))}),noop}else{let C=function(){n!==null&&(clearTimeout(n),n=null),T!==void 0&&(T.removeEventListener!==void 0&&T.removeEventListener("resize",f,listenOpts.passive),T=void 0)},L=function(){C(),o&&o.contentDocument&&(T=o.contentDocument.defaultView,T.addEventListener("resize",f,listenOpts.passive),g())};const b=useCanRender();let T;return onMounted(()=>{nextTick(()=>{o=a.$el,o&&L()})}),onBeforeUnmount(C),a.trigger=f,()=>{if(b.value===!0)return h("object",{style:resizeProps.style,tabindex:-1,type:"text/html",data:resizeProps.url,"aria-hidden":"true",onLoad:L})}}}}),QHeader=createComponent({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:t,emit:n}){const{proxy:{$q:o}}=getCurrentInstance(),u=inject(layoutKey,emptyRenderFn);if(u===emptyRenderFn)return console.error("QHeader needs to be child of QLayout"),emptyRenderFn;const f=ref(parseInt(e.heightHint,10)),g=ref(!0),a=computed(()=>e.reveal===!0||u.view.value.indexOf("H")>-1||o.platform.is.ios&&u.isContainer.value===!0),b=computed(()=>{if(e.modelValue!==!0)return 0;if(a.value===!0)return g.value===!0?f.value:0;const ye=f.value-u.scroll.value.position;return ye>0?ye:0}),T=computed(()=>e.modelValue!==!0||a.value===!0&&g.value!==!0),C=computed(()=>e.modelValue===!0&&T.value===!0&&e.reveal===!0),L=computed(()=>"q-header q-layout__section--marginal "+(a.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(T.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),N=computed(()=>{const ye=u.rows.value.top,oe={};return ye[0]==="l"&&u.left.space===!0&&(oe[o.lang.rtl===!0?"right":"left"]=`${u.left.size}px`),ye[2]==="r"&&u.right.space===!0&&(oe[o.lang.rtl===!0?"left":"right"]=`${u.right.size}px`),oe});function F(ye,oe){u.update("header",ye,oe)}function H(ye,oe){ye.value!==oe&&(ye.value=oe)}function se({height:ye}){H(f,ye),F("size",ye)}function ce(ye){C.value===!0&&H(g,!0),n("focusin",ye)}watch(()=>e.modelValue,ye=>{F("space",ye),H(g,!0),u.animate()}),watch(b,ye=>{F("offset",ye)}),watch(()=>e.reveal,ye=>{ye===!1&&H(g,e.modelValue)}),watch(g,ye=>{u.animate(),n("reveal",ye)}),watch(u.scroll,ye=>{e.reveal===!0&&H(g,ye.direction==="up"||ye.position<=e.revealOffset||ye.position-ye.inflectionPoint<100)});const X={};return u.instances.header=X,e.modelValue===!0&&F("size",f.value),F("space",e.modelValue),F("offset",b.value),onBeforeUnmount(()=>{u.instances.header===X&&(u.instances.header=void 0,F("size",0),F("offset",0),F("space",!1))}),()=>{const ye=hUniqueSlot(t.default,[]);return e.elevated===!0&&ye.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),ye.push(h(QResizeObserver,{debounce:0,onResize:se})),h("header",{class:L.value,style:N.value,onFocusin:ce},ye)}}});const modifiersAll={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},directionList=Object.keys(modifiersAll);modifiersAll.all=!0;function getModifierDirections(e){const t={};for(const n of directionList)e[n]===!0&&(t[n]=!0);return Object.keys(t).length===0?modifiersAll:(t.horizontal===!0?t.left=t.right=!0:t.left===!0&&t.right===!0&&(t.horizontal=!0),t.vertical===!0?t.up=t.down=!0:t.up===!0&&t.down===!0&&(t.vertical=!0),t.horizontal===!0&&t.vertical===!0&&(t.all=!0),t)}function shouldStart(e,t){return t.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof t.handler=="function"&&e.target.nodeName.toUpperCase()!=="INPUT"&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(t.uid)===-1)}function clearSelection(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),Platform.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}function getChanges(e,t,n){const o=position(e);let u,f=o.left-t.event.x,g=o.top-t.event.y,a=Math.abs(f),b=Math.abs(g);const T=t.direction;T.horizontal===!0&&T.vertical!==!0?u=f<0?"left":"right":T.horizontal!==!0&&T.vertical===!0?u=g<0?"up":"down":T.up===!0&&g<0?(u="up",a>b&&(T.left===!0&&f<0?u="left":T.right===!0&&f>0&&(u="right"))):T.down===!0&&g>0?(u="down",a>b&&(T.left===!0&&f<0?u="left":T.right===!0&&f>0&&(u="right"))):T.left===!0&&f<0?(u="left",a<b&&(T.up===!0&&g<0?u="up":T.down===!0&&g>0&&(u="down"))):T.right===!0&&f>0&&(u="right",a<b&&(T.up===!0&&g<0?u="up":T.down===!0&&g>0&&(u="down")));let C=!1;if(u===void 0&&n===!1){if(t.event.isFirst===!0||t.event.lastDir===void 0)return{};u=t.event.lastDir,C=!0,u==="left"||u==="right"?(o.left-=f,a=0,f=0):(o.top-=g,b=0,g=0)}return{synthetic:C,payload:{evt:e,touch:t.event.mouse!==!0,mouse:t.event.mouse===!0,position:o,direction:u,isFirst:t.event.isFirst,isFinal:n===!0,duration:Date.now()-t.event.time,distance:{x:a,y:b},offset:{x:f,y:g},delta:{x:o.left-t.event.lastX,y:o.top-t.event.lastY}}}}let uid=0;var TouchPan=createDirective({name:"touch-pan",beforeMount(e,{value:t,modifiers:n}){if(n.mouse!==!0&&client$1.has.touch!==!0)return;function o(f,g){n.mouse===!0&&g===!0?stopAndPrevent(f):(n.stop===!0&&stop(f),n.prevent===!0&&prevent(f))}const u={uid:"qvtp_"+uid++,handler:t,modifiers:n,direction:getModifierDirections(n),noop,mouseStart(f){shouldStart(f,u)&&leftClick(f)&&(addEvt(u,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),u.start(f,!0))},touchStart(f){if(shouldStart(f,u)){const g=f.target;addEvt(u,"temp",[[g,"touchmove","move","notPassiveCapture"],[g,"touchcancel","end","passiveCapture"],[g,"touchend","end","passiveCapture"]]),u.start(f)}},start(f,g){if(client$1.is.firefox===!0&&preventDraggable(e,!0),u.lastEvt=f,g===!0||n.stop===!0){if(u.direction.all!==!0&&(g!==!0||u.modifiers.mouseAllDir!==!0&&u.modifiers.mousealldir!==!0)){const T=f.type.indexOf("mouse")>-1?new MouseEvent(f.type,f):new TouchEvent(f.type,f);f.defaultPrevented===!0&&prevent(T),f.cancelBubble===!0&&stop(T),Object.assign(T,{qKeyEvent:f.qKeyEvent,qClickOutside:f.qClickOutside,qAnchorHandled:f.qAnchorHandled,qClonedBy:f.qClonedBy===void 0?[u.uid]:f.qClonedBy.concat(u.uid)}),u.initialEvent={target:f.target,event:T}}stop(f)}const{left:a,top:b}=position(f);u.event={x:a,y:b,time:Date.now(),mouse:g===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:a,lastY:b}},move(f){if(u.event===void 0)return;const g=position(f),a=g.left-u.event.x,b=g.top-u.event.y;if(a===0&&b===0)return;u.lastEvt=f;const T=u.event.mouse===!0,C=()=>{o(f,T);let F;n.preserveCursor!==!0&&n.preservecursor!==!0&&(F=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),T===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),u.styleCleanup=H=>{if(u.styleCleanup=void 0,F!==void 0&&(document.documentElement.style.cursor=F),document.body.classList.remove("non-selectable"),T===!0){const se=()=>{document.body.classList.remove("no-pointer-events--children")};H!==void 0?setTimeout(()=>{se(),H()},50):se()}else H!==void 0&&H()}};if(u.event.detected===!0){u.event.isFirst!==!0&&o(f,u.event.mouse);const{payload:F,synthetic:H}=getChanges(f,u,!1);F!==void 0&&(u.handler(F)===!1?u.end(f):(u.styleCleanup===void 0&&u.event.isFirst===!0&&C(),u.event.lastX=F.position.left,u.event.lastY=F.position.top,u.event.lastDir=H===!0?void 0:F.direction,u.event.isFirst=!1));return}if(u.direction.all===!0||T===!0&&(u.modifiers.mouseAllDir===!0||u.modifiers.mousealldir===!0)){C(),u.event.detected=!0,u.move(f);return}const L=Math.abs(a),N=Math.abs(b);L!==N&&(u.direction.horizontal===!0&&L>N||u.direction.vertical===!0&&L<N||u.direction.up===!0&&L<N&&b<0||u.direction.down===!0&&L<N&&b>0||u.direction.left===!0&&L>N&&a<0||u.direction.right===!0&&L>N&&a>0?(u.event.detected=!0,u.move(f)):u.end(f,!0))},end(f,g){if(u.event!==void 0){if(cleanEvt(u,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),g===!0)u.styleCleanup!==void 0&&u.styleCleanup(),u.event.detected!==!0&&u.initialEvent!==void 0&&u.initialEvent.target.dispatchEvent(u.initialEvent.event);else if(u.event.detected===!0){u.event.isFirst===!0&&u.handler(getChanges(f===void 0?u.lastEvt:f,u).payload);const{payload:a}=getChanges(f===void 0?u.lastEvt:f,u,!0),b=()=>{u.handler(a)};u.styleCleanup!==void 0?u.styleCleanup(b):b()}u.event=void 0,u.initialEvent=void 0,u.lastEvt=void 0}}};if(e.__qtouchpan=u,n.mouse===!0){const f=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";addEvt(u,"main",[[e,"mousedown","mouseStart",`passive${f}`]])}client$1.has.touch===!0&&addEvt(u,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const n=e.__qtouchpan;n!==void 0&&(t.oldValue!==t.value&&(typeof value!="function"&&n.end(),n.handler=t.value),n.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchpan;t!==void 0&&(t.event!==void 0&&t.end(),cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchpan)}});function between(e,t,n){return n<=t?t:Math.min(n,Math.max(t,e))}function normalizeToInterval(e,t,n){if(n<=t)return t;const o=n-t+1;let u=t+(e-t)%o;return u<t&&(u=o+u),u===0?0:u}const duration=150;var QDrawer=createComponent({name:"QDrawer",inheritAttrs:!1,props:{...useModelToggleProps,...useDarkProps,side:{type:String,default:"left",validator:e=>["left","right"].includes(e)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:e=>["default","desktop","mobile"].includes(e),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...useModelToggleEmits,"onLayout","miniState"],setup(e,{slots:t,emit:n,attrs:o}){const u=getCurrentInstance(),{proxy:{$q:f}}=u,g=useDark(e,f),{preventBodyScroll:a}=usePreventScroll(),{registerTimeout:b,removeTimeout:T}=useTimeout(),C=inject(layoutKey,emptyRenderFn);if(C===emptyRenderFn)return console.error("QDrawer needs to be child of QLayout"),emptyRenderFn;let L,N=null,F;const H=ref(e.behavior==="mobile"||e.behavior!=="desktop"&&C.totalWidth.value<=e.breakpoint),se=computed(()=>e.mini===!0&&H.value!==!0),ce=computed(()=>se.value===!0?e.miniWidth:e.width),X=ref(e.showIfAbove===!0&&H.value===!1?!0:e.modelValue===!0),ye=computed(()=>e.persistent!==!0&&(H.value===!0||_t.value===!0));function oe(st,Pr){if(ze(),st!==!1&&C.animate(),Xr(0),H.value===!0){const ht=C.instances[Lr.value];ht!==void 0&&ht.belowBreakpoint===!0&&ht.hide(!1),cr(1),C.isContainer.value!==!0&&a(!0)}else cr(0),st!==!1&&ur(!1);b(()=>{st!==!1&&ur(!0),Pr!==!0&&n("show",st)},duration)}function le(st,Pr){ve(),st!==!1&&C.animate(),cr(0),Xr(Te.value*ce.value),qt(),Pr!==!0?b(()=>{n("hide",st)},duration):T()}const{show:ue,hide:Re}=useModelToggle({showing:X,hideOnRouteChange:ye,handleShow:oe,handleHide:le}),{addToHistory:ze,removeFromHistory:ve}=useHistory(X,Re,ye),be={belowBreakpoint:H,hide:Re},de=computed(()=>e.side==="right"),Te=computed(()=>(f.lang.rtl===!0?-1:1)*(de.value===!0?1:-1)),Ge=ref(0),Ke=ref(!1),St=ref(!1),xt=ref(ce.value*Te.value),Lr=computed(()=>de.value===!0?"left":"right"),Nr=computed(()=>X.value===!0&&H.value===!1&&e.overlay===!1?e.miniToOverlay===!0?e.miniWidth:ce.value:0),Sr=computed(()=>e.overlay===!0||e.miniToOverlay===!0||C.view.value.indexOf(de.value?"R":"L")>-1||f.platform.is.ios===!0&&C.isContainer.value===!0),Gr=computed(()=>e.overlay===!1&&X.value===!0&&H.value===!1),_t=computed(()=>e.overlay===!0&&X.value===!0&&H.value===!1),Kt=computed(()=>"fullscreen q-drawer__backdrop"+(X.value===!1&&Ke.value===!1?" hidden":"")),mr=computed(()=>({backgroundColor:`rgba(0,0,0,${Ge.value*.4})`})),Yt=computed(()=>de.value===!0?C.rows.value.top[2]==="r":C.rows.value.top[0]==="l"),er=computed(()=>de.value===!0?C.rows.value.bottom[2]==="r":C.rows.value.bottom[0]==="l"),lr=computed(()=>{const st={};return C.header.space===!0&&Yt.value===!1&&(Sr.value===!0?st.top=`${C.header.offset}px`:C.header.space===!0&&(st.top=`${C.header.size}px`)),C.footer.space===!0&&er.value===!1&&(Sr.value===!0?st.bottom=`${C.footer.offset}px`:C.footer.space===!0&&(st.bottom=`${C.footer.size}px`)),st}),ar=computed(()=>{const st={width:`${ce.value}px`,transform:`translateX(${xt.value}px)`};return H.value===!0?st:Object.assign(st,lr.value)}),dr=computed(()=>"q-drawer__content fit "+(C.isContainer.value!==!0?"scroll":"overflow-auto")),ii=computed(()=>`q-drawer q-drawer--${e.side}`+(St.value===!0?" q-drawer--mini-animate":"")+(e.bordered===!0?" q-drawer--bordered":"")+(g.value===!0?" q-drawer--dark q-dark":"")+(Ke.value===!0?" no-transition":X.value===!0?"":" q-layout--prevent-focus")+(H.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${se.value===!0?"mini":"standard"}`+(Sr.value===!0||Gr.value!==!0?" fixed":"")+(e.overlay===!0||e.miniToOverlay===!0?" q-drawer--on-top":"")+(Yt.value===!0?" q-drawer--top-padding":""))),nr=computed(()=>{const st=f.lang.rtl===!0?e.side:Lr.value;return[[TouchPan,Or,void 0,{[st]:!0,mouse:!0}]]}),at=computed(()=>{const st=f.lang.rtl===!0?Lr.value:e.side;return[[TouchPan,mi,void 0,{[st]:!0,mouse:!0}]]}),bi=computed(()=>{const st=f.lang.rtl===!0?Lr.value:e.side;return[[TouchPan,mi,void 0,{[st]:!0,mouse:!0,mouseAllDir:!0}]]});function Br(){Gt(H,e.behavior==="mobile"||e.behavior!=="desktop"&&C.totalWidth.value<=e.breakpoint)}watch(H,st=>{st===!0?(L=X.value,X.value===!0&&Re(!1)):e.overlay===!1&&e.behavior!=="mobile"&&L!==!1&&(X.value===!0?(Xr(0),cr(0),qt()):ue(!1))}),watch(()=>e.side,(st,Pr)=>{C.instances[Pr]===be&&(C.instances[Pr]=void 0,C[Pr].space=!1,C[Pr].offset=0),C.instances[st]=be,C[st].size=ce.value,C[st].space=Gr.value,C[st].offset=Nr.value}),watch(C.totalWidth,()=>{(C.isContainer.value===!0||document.qScrollPrevented!==!0)&&Br()}),watch(()=>e.behavior+e.breakpoint,Br),watch(C.isContainer,st=>{X.value===!0&&a(st!==!0),st===!0&&Br()}),watch(C.scrollbarWidth,()=>{Xr(X.value===!0?0:void 0)}),watch(Nr,st=>{Er("offset",st)}),watch(Gr,st=>{n("onLayout",st),Er("space",st)}),watch(de,()=>{Xr()}),watch(ce,st=>{Xr(),Jt(e.miniToOverlay,st)}),watch(()=>e.miniToOverlay,st=>{Jt(st,ce.value)}),watch(()=>f.lang.rtl,()=>{Xr()}),watch(()=>e.mini,()=>{e.modelValue===!0&&(yi(),C.animate())}),watch(se,st=>{n("miniState",st)});function Xr(st){st===void 0?nextTick(()=>{st=X.value===!0?0:ce.value,Xr(Te.value*st)}):(C.isContainer.value===!0&&de.value===!0&&(H.value===!0||Math.abs(st)===ce.value)&&(st+=Te.value*C.scrollbarWidth.value),xt.value=st)}function cr(st){Ge.value=st}function ur(st){const Pr=st===!0?"remove":C.isContainer.value!==!0?"add":"";Pr!==""&&document.body.classList[Pr]("q-body--drawer-toggle")}function yi(){N!==null&&clearTimeout(N),u.proxy&&u.proxy.$el&&u.proxy.$el.classList.add("q-drawer--mini-animate"),St.value=!0,N=setTimeout(()=>{N=null,St.value=!1,u&&u.proxy&&u.proxy.$el&&u.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function Or(st){if(X.value!==!1)return;const Pr=ce.value,ht=between(st.distance.x,0,Pr);if(st.isFinal===!0){ht>=Math.min(75,Pr)===!0?ue():(C.animate(),cr(0),Xr(Te.value*Pr)),Ke.value=!1;return}Xr((f.lang.rtl===!0?de.value!==!0:de.value)?Math.max(Pr-ht,0):Math.min(0,ht-Pr)),cr(between(ht/Pr,0,1)),st.isFirst===!0&&(Ke.value=!0)}function mi(st){if(X.value!==!0)return;const Pr=ce.value,ht=st.direction===e.side,Nt=(f.lang.rtl===!0?ht!==!0:ht)?between(st.distance.x,0,Pr):0;if(st.isFinal===!0){Math.abs(Nt)<Math.min(75,Pr)===!0?(C.animate(),cr(1),Xr(0)):Re(),Ke.value=!1;return}Xr(Te.value*Nt),cr(between(1-Nt/Pr,0,1)),st.isFirst===!0&&(Ke.value=!0)}function qt(){a(!1),ur(!0)}function Er(st,Pr){C.update(e.side,st,Pr)}function Gt(st,Pr){st.value!==Pr&&(st.value=Pr)}function Jt(st,Pr){Er("size",st===!0?e.miniWidth:Pr)}return C.instances[e.side]=be,Jt(e.miniToOverlay,ce.value),Er("space",Gr.value),Er("offset",Nr.value),e.showIfAbove===!0&&e.modelValue!==!0&&X.value===!0&&e["onUpdate:modelValue"]!==void 0&&n("update:modelValue",!0),onMounted(()=>{n("onLayout",Gr.value),n("miniState",se.value),L=e.showIfAbove===!0;const st=()=>{(X.value===!0?oe:le)(!1,!0)};if(C.totalWidth.value!==0){nextTick(st);return}F=watch(C.totalWidth,()=>{F(),F=void 0,X.value===!1&&e.showIfAbove===!0&&H.value===!1?ue(!1):st()})}),onBeforeUnmount(()=>{F!==void 0&&F(),N!==null&&(clearTimeout(N),N=null),X.value===!0&&qt(),C.instances[e.side]===be&&(C.instances[e.side]=void 0,Er("size",0),Er("offset",0),Er("space",!1))}),()=>{const st=[];H.value===!0&&(e.noSwipeOpen===!1&&st.push(withDirectives(h("div",{key:"open",class:`q-drawer__opener fixed-${e.side}`,"aria-hidden":"true"}),nr.value)),st.push(hDir("div",{ref:"backdrop",class:Kt.value,style:mr.value,"aria-hidden":"true",onClick:Re},void 0,"backdrop",e.noSwipeBackdrop!==!0&&X.value===!0,()=>bi.value)));const Pr=se.value===!0&&t.mini!==void 0,ht=[h("div",{...o,key:""+Pr,class:[dr.value,o.class]},Pr===!0?t.mini():hSlot(t.default))];return e.elevated===!0&&X.value===!0&&ht.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),st.push(hDir("aside",{ref:"content",class:ii.value,style:ar.value},ht,"contentclose",e.noSwipeClose!==!0&&H.value===!0,()=>at.value)),h("div",{class:"q-drawer-container"},st)}}});let id=0;const useTabEmits=["click","keydown"],useTabProps={icon:String,label:[Number,String],alert:[Boolean,String],alertIcon:String,name:{type:[Number,String],default:()=>`t_${id++}`},noCaps:Boolean,tabindex:[String,Number],disable:Boolean,contentClass:String,ripple:{type:[Boolean,Object],default:!0}};function useTab(e,t,n,o){const u=inject(tabsKey,emptyRenderFn);if(u===emptyRenderFn)return console.error("QTab/QRouteTab component needs to be child of QTabs"),emptyRenderFn;const{proxy:f}=getCurrentInstance(),g=ref(null),a=ref(null),b=ref(null),T=computed(()=>e.disable===!0||e.ripple===!1?!1:Object.assign({keyCodes:[13,32],early:!0},e.ripple===!0?{}:e.ripple)),C=computed(()=>u.currentModel.value===e.name),L=computed(()=>"q-tab relative-position self-stretch flex flex-center text-center"+(C.value===!0?" q-tab--active"+(u.tabProps.value.activeClass?" "+u.tabProps.value.activeClass:"")+(u.tabProps.value.activeColor?` text-${u.tabProps.value.activeColor}`:"")+(u.tabProps.value.activeBgColor?` bg-${u.tabProps.value.activeBgColor}`:""):" q-tab--inactive")+(e.icon&&e.label&&u.tabProps.value.inlineLabel===!1?" q-tab--full":"")+(e.noCaps===!0||u.tabProps.value.noCaps===!0?" q-tab--no-caps":"")+(e.disable===!0?" disabled":" q-focusable q-hoverable cursor-pointer")+(o!==void 0?o.linkClass.value:"")),N=computed(()=>"q-tab__content self-stretch flex-center relative-position q-anchor--skip non-selectable "+(u.tabProps.value.inlineLabel===!0?"row no-wrap q-tab__content--inline":"column")+(e.contentClass!==void 0?` ${e.contentClass}`:"")),F=computed(()=>e.disable===!0||u.hasFocus.value===!0||C.value===!1&&u.hasActiveTab.value===!0?-1:e.tabindex||0);function H(oe,le){if(le!==!0&&g.value!==null&&g.value.focus(),e.disable===!0){o!==void 0&&o.hasRouterLink.value===!0&&stopAndPrevent(oe);return}if(o===void 0){u.updateModel({name:e.name}),n("click",oe);return}if(o.hasRouterLink.value===!0){const ue=(Re={})=>{let ze;const ve=Re.to===void 0||isDeepEqual(Re.to,e.to)===!0?u.avoidRouteWatcher=uid$1():null;return o.navigateToRouterLink(oe,{...Re,returnRouterError:!0}).catch(be=>{ze=be}).then(be=>{if(ve===u.avoidRouteWatcher&&(u.avoidRouteWatcher=!1,ze===void 0&&(be===void 0||be.message.startsWith("Avoided redundant navigation")===!0)&&u.updateModel({name:e.name})),Re.returnRouterError===!0)return ze!==void 0?Promise.reject(ze):be})};n("click",oe,ue),oe.defaultPrevented!==!0&&ue();return}n("click",oe)}function se(oe){isKeyCode(oe,[13,32])?H(oe,!0):shouldIgnoreKey(oe)!==!0&&oe.keyCode>=35&&oe.keyCode<=40&&oe.altKey!==!0&&oe.metaKey!==!0&&u.onKbdNavigate(oe.keyCode,f.$el)===!0&&stopAndPrevent(oe),n("keydown",oe)}function ce(){const oe=u.tabProps.value.narrowIndicator,le=[],ue=h("div",{ref:b,class:["q-tab__indicator",u.tabProps.value.indicatorClass]});e.icon!==void 0&&le.push(h(QIcon,{class:"q-tab__icon",name:e.icon})),e.label!==void 0&&le.push(h("div",{class:"q-tab__label"},e.label)),e.alert!==!1&&le.push(e.alertIcon!==void 0?h(QIcon,{class:"q-tab__alert-icon",color:e.alert!==!0?e.alert:void 0,name:e.alertIcon}):h("div",{class:"q-tab__alert"+(e.alert!==!0?` text-${e.alert}`:"")})),oe===!0&&le.push(ue);const Re=[h("div",{class:"q-focus-helper",tabindex:-1,ref:g}),h("div",{class:N.value},hMergeSlot(t.default,le))];return oe===!1&&Re.push(ue),Re}const X={name:computed(()=>e.name),rootRef:a,tabIndicatorRef:b,routeData:o};onBeforeUnmount(()=>{u.unregisterTab(X)}),onMounted(()=>{u.registerTab(X)});function ye(oe,le){const ue={ref:a,class:L.value,tabindex:F.value,role:"tab","aria-selected":C.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:H,onKeydown:se,...le};return withDirectives(h(oe,ue,ce()),[[Ripple,T.value]])}return{renderTab:ye,$tabs:u}}var QTab=createComponent({name:"QTab",props:useTabProps,emits:useTabEmits,setup(e,{slots:t,emit:n}){const{renderTab:o}=useTab(e,t,n);return()=>o("div")}});let rtlHasScrollBug=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const t=document.createElement("div");Object.assign(t.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(t),e.scrollLeft=-1e3,rtlHasScrollBug=e.scrollLeft>=0,e.remove()}function getIndicatorClass(e,t,n){const o=n===!0?["left","right"]:["top","bottom"];return`absolute-${t===!0?o[0]:o[1]}${e?` text-${e}`:""}`}const alignValues=["left","center","right","justify"];var QTabs=createComponent({name:"QTabs",props:{modelValue:[Number,String],align:{type:String,default:"center",validator:e=>alignValues.includes(e)},breakpoint:{type:[String,Number],default:600},vertical:Boolean,shrink:Boolean,stretch:Boolean,activeClass:String,activeColor:String,activeBgColor:String,indicatorColor:String,leftIcon:String,rightIcon:String,outsideArrows:Boolean,mobileArrows:Boolean,switchIndicator:Boolean,narrowIndicator:Boolean,inlineLabel:Boolean,noCaps:Boolean,dense:Boolean,contentClass:String,"onUpdate:modelValue":[Function,Array]},setup(e,{slots:t,emit:n}){const{proxy:o}=getCurrentInstance(),{$q:u}=o,{registerTick:f}=useTick(),{registerTick:g}=useTick(),{registerTick:a}=useTick(),{registerTimeout:b,removeTimeout:T}=useTimeout(),{registerTimeout:C,removeTimeout:L}=useTimeout(),N=ref(null),F=ref(null),H=ref(e.modelValue),se=ref(!1),ce=ref(!0),X=ref(!1),ye=ref(!1),oe=[],le=ref(0),ue=ref(!1);let Re=null,ze=null,ve;const be=computed(()=>({activeClass:e.activeClass,activeColor:e.activeColor,activeBgColor:e.activeBgColor,indicatorClass:getIndicatorClass(e.indicatorColor,e.switchIndicator,e.vertical),narrowIndicator:e.narrowIndicator,inlineLabel:e.inlineLabel,noCaps:e.noCaps})),de=computed(()=>{const Gt=le.value,Jt=H.value;for(let st=0;st<Gt;st++)if(oe[st].name.value===Jt)return!0;return!1}),Te=computed(()=>`q-tabs__content--align-${se.value===!0?"left":ye.value===!0?"justify":e.align}`),Ge=computed(()=>`q-tabs row no-wrap items-center q-tabs--${se.value===!0?"":"not-"}scrollable q-tabs--${e.vertical===!0?"vertical":"horizontal"} q-tabs__arrows--${e.outsideArrows===!0?"outside":"inside"} q-tabs--mobile-with${e.mobileArrows===!0?"":"out"}-arrows`+(e.dense===!0?" q-tabs--dense":"")+(e.shrink===!0?" col-shrink":"")+(e.stretch===!0?" self-stretch":"")),Ke=computed(()=>"q-tabs__content scroll--mobile row no-wrap items-center self-stretch hide-scrollbar relative-position "+Te.value+(e.contentClass!==void 0?` ${e.contentClass}`:"")),St=computed(()=>e.vertical===!0?{container:"height",content:"offsetHeight",scroll:"scrollHeight"}:{container:"width",content:"offsetWidth",scroll:"scrollWidth"}),xt=computed(()=>e.vertical!==!0&&u.lang.rtl===!0),Lr=computed(()=>rtlHasScrollBug===!1&&xt.value===!0);watch(xt,mr),watch(()=>e.modelValue,Gt=>{Nr({name:Gt,setCurrent:!0,skipEmit:!0})}),watch(()=>e.outsideArrows,Sr);function Nr({name:Gt,setCurrent:Jt,skipEmit:st}){H.value!==Gt&&(st!==!0&&e["onUpdate:modelValue"]!==void 0&&n("update:modelValue",Gt),(Jt===!0||e["onUpdate:modelValue"]===void 0)&&(_t(H.value,Gt),H.value=Gt))}function Sr(){f(()=>{Gr({width:N.value.offsetWidth,height:N.value.offsetHeight})})}function Gr(Gt){if(St.value===void 0||F.value===null)return;const Jt=Gt[St.value.container],st=Math.min(F.value[St.value.scroll],Array.prototype.reduce.call(F.value.children,(ht,Nt)=>ht+(Nt[St.value.content]||0),0)),Pr=Jt>0&&st>Jt;se.value=Pr,Pr===!0&&g(mr),ye.value=Jt<parseInt(e.breakpoint,10)}function _t(Gt,Jt){const st=Gt!=null&&Gt!==""?oe.find(ht=>ht.name.value===Gt):null,Pr=Jt!=null&&Jt!==""?oe.find(ht=>ht.name.value===Jt):null;if(st&&Pr){const ht=st.tabIndicatorRef.value,Nt=Pr.tabIndicatorRef.value;Re!==null&&(clearTimeout(Re),Re=null),ht.style.transition="none",ht.style.transform="none",Nt.style.transition="none",Nt.style.transform="none";const xr=ht.getBoundingClientRect(),Qr=Nt.getBoundingClientRect();Nt.style.transform=e.vertical===!0?`translate3d(0,${xr.top-Qr.top}px,0) scale3d(1,${Qr.height?xr.height/Qr.height:1},1)`:`translate3d(${xr.left-Qr.left}px,0,0) scale3d(${Qr.width?xr.width/Qr.width:1},1,1)`,a(()=>{Re=setTimeout(()=>{Re=null,Nt.style.transition="transform .25s cubic-bezier(.4, 0, .2, 1)",Nt.style.transform="none"},70)})}Pr&&se.value===!0&&Kt(Pr.rootRef.value)}function Kt(Gt){const{left:Jt,width:st,top:Pr,height:ht}=F.value.getBoundingClientRect(),Nt=Gt.getBoundingClientRect();let xr=e.vertical===!0?Nt.top-Pr:Nt.left-Jt;if(xr<0){F.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.floor(xr),mr();return}xr+=e.vertical===!0?Nt.height-ht:Nt.width-st,xr>0&&(F.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.ceil(xr),mr())}function mr(){const Gt=F.value;if(Gt===null)return;const Jt=Gt.getBoundingClientRect(),st=e.vertical===!0?Gt.scrollTop:Math.abs(Gt.scrollLeft);xt.value===!0?(ce.value=Math.ceil(st+Jt.width)<Gt.scrollWidth-1,X.value=st>0):(ce.value=st>0,X.value=e.vertical===!0?Math.ceil(st+Jt.height)<Gt.scrollHeight:Math.ceil(st+Jt.width)<Gt.scrollWidth)}function Yt(Gt){ze!==null&&clearInterval(ze),ze=setInterval(()=>{nr(Gt)===!0&&ar()},5)}function er(){Yt(Lr.value===!0?Number.MAX_SAFE_INTEGER:0)}function lr(){Yt(Lr.value===!0?0:Number.MAX_SAFE_INTEGER)}function ar(){ze!==null&&(clearInterval(ze),ze=null)}function dr(Gt,Jt){const st=Array.prototype.filter.call(F.value.children,Qr=>Qr===Jt||Qr.matches&&Qr.matches(".q-tab.q-focusable")===!0),Pr=st.length;if(Pr===0)return;if(Gt===36)return Kt(st[0]),st[0].focus(),!0;if(Gt===35)return Kt(st[Pr-1]),st[Pr-1].focus(),!0;const ht=Gt===(e.vertical===!0?38:37),Nt=Gt===(e.vertical===!0?40:39),xr=ht===!0?-1:Nt===!0?1:void 0;if(xr!==void 0){const Qr=xt.value===!0?-1:1,zr=st.indexOf(Jt)+xr*Qr;return zr>=0&&zr<Pr&&(Kt(st[zr]),st[zr].focus({preventScroll:!0})),!0}}const ii=computed(()=>Lr.value===!0?{get:Gt=>Math.abs(Gt.scrollLeft),set:(Gt,Jt)=>{Gt.scrollLeft=-Jt}}:e.vertical===!0?{get:Gt=>Gt.scrollTop,set:(Gt,Jt)=>{Gt.scrollTop=Jt}}:{get:Gt=>Gt.scrollLeft,set:(Gt,Jt)=>{Gt.scrollLeft=Jt}});function nr(Gt){const Jt=F.value,{get:st,set:Pr}=ii.value;let ht=!1,Nt=st(Jt);const xr=Gt<Nt?-1:1;return Nt+=xr*5,Nt<0?(ht=!0,Nt=0):(xr===-1&&Nt<=Gt||xr===1&&Nt>=Gt)&&(ht=!0,Nt=Gt),Pr(Jt,Nt),mr(),ht}function at(Gt,Jt){for(const st in Gt)if(Gt[st]!==Jt[st])return!1;return!0}function bi(){let Gt=null,Jt={matchedLen:0,queryDiff:9999,hrefLen:0};const st=oe.filter(xr=>xr.routeData!==void 0&&xr.routeData.hasRouterLink.value===!0),{hash:Pr,query:ht}=o.$route,Nt=Object.keys(ht).length;for(const xr of st){const Qr=xr.routeData.exact.value===!0;if(xr.routeData[Qr===!0?"linkIsExactActive":"linkIsActive"].value!==!0)continue;const{hash:zr,query:br,matched:xi,href:ui}=xr.routeData.resolvedLink.value,di=Object.keys(br).length;if(Qr===!0){if(zr!==Pr||di!==Nt||at(ht,br)===!1)continue;Gt=xr.name.value;break}if(zr!==""&&zr!==Pr||di!==0&&at(br,ht)===!1)continue;const Ti={matchedLen:xi.length,queryDiff:Nt-di,hrefLen:ui.length-zr.length};if(Ti.matchedLen>Jt.matchedLen){Gt=xr.name.value,Jt=Ti;continue}else if(Ti.matchedLen!==Jt.matchedLen)continue;if(Ti.queryDiff<Jt.queryDiff)Gt=xr.name.value,Jt=Ti;else if(Ti.queryDiff!==Jt.queryDiff)continue;Ti.hrefLen>Jt.hrefLen&&(Gt=xr.name.value,Jt=Ti)}Gt===null&&oe.some(xr=>xr.routeData===void 0&&xr.name.value===H.value)===!0||Nr({name:Gt,setCurrent:!0})}function Br(Gt){if(T(),ue.value!==!0&&N.value!==null&&Gt.target&&typeof Gt.target.closest=="function"){const Jt=Gt.target.closest(".q-tab");Jt&&N.value.contains(Jt)===!0&&(ue.value=!0,se.value===!0&&Kt(Jt))}}function Xr(){b(()=>{ue.value=!1},30)}function cr(){mi.avoidRouteWatcher===!1?C(bi):L()}function ur(){if(ve===void 0){const Gt=watch(()=>o.$route.fullPath,cr);ve=()=>{Gt(),ve=void 0}}}function yi(Gt){oe.push(Gt),le.value++,Sr(),Gt.routeData===void 0||o.$route===void 0?C(()=>{if(se.value===!0){const Jt=H.value,st=Jt!=null&&Jt!==""?oe.find(Pr=>Pr.name.value===Jt):null;st&&Kt(st.rootRef.value)}}):(ur(),Gt.routeData.hasRouterLink.value===!0&&cr())}function Or(Gt){oe.splice(oe.indexOf(Gt),1),le.value--,Sr(),ve!==void 0&&Gt.routeData!==void 0&&(oe.every(Jt=>Jt.routeData===void 0)===!0&&ve(),cr())}const mi={currentModel:H,tabProps:be,hasFocus:ue,hasActiveTab:de,registerTab:yi,unregisterTab:Or,verifyRouteModel:cr,updateModel:Nr,onKbdNavigate:dr,avoidRouteWatcher:!1};provide(tabsKey,mi);function qt(){Re!==null&&clearTimeout(Re),ar(),ve!==void 0&&ve()}let Er;return onBeforeUnmount(qt),onDeactivated(()=>{Er=ve!==void 0,qt()}),onActivated(()=>{Er===!0&&ur(),Sr()}),()=>h("div",{ref:N,class:Ge.value,role:"tablist",onFocusin:Br,onFocusout:Xr},[h(QResizeObserver,{onResize:Gr}),h("div",{ref:F,class:Ke.value,onScroll:mr},hSlot(t.default)),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--left absolute q-tab__icon"+(ce.value===!0?"":" q-tabs__arrow--faded"),name:e.leftIcon||u.iconSet.tabs[e.vertical===!0?"up":"left"],onMousedownPassive:er,onTouchstartPassive:er,onMouseupPassive:ar,onMouseleavePassive:ar,onTouchendPassive:ar}),h(QIcon,{class:"q-tabs__arrow q-tabs__arrow--right absolute q-tab__icon"+(X.value===!0?"":" q-tabs__arrow--faded"),name:e.rightIcon||u.iconSet.tabs[e.vertical===!0?"down":"right"],onMousedownPassive:lr,onTouchstartPassive:lr,onMouseupPassive:ar,onMouseleavePassive:ar,onTouchendPassive:ar})])}});function parseArg(e){const t=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((n,o)=>{const u=parseFloat(n);u&&(t[o]=u)}),t}var TouchSwipe=createDirective({name:"touch-swipe",beforeMount(e,{value:t,arg:n,modifiers:o}){if(o.mouse!==!0&&client$1.has.touch!==!0)return;const u=o.mouseCapture===!0?"Capture":"",f={handler:t,sensitivity:parseArg(n),direction:getModifierDirections(o),noop,mouseStart(g){shouldStart(g,f)&&leftClick(g)&&(addEvt(f,"temp",[[document,"mousemove","move",`notPassive${u}`],[document,"mouseup","end","notPassiveCapture"]]),f.start(g,!0))},touchStart(g){if(shouldStart(g,f)){const a=g.target;addEvt(f,"temp",[[a,"touchmove","move","notPassiveCapture"],[a,"touchcancel","end","notPassiveCapture"],[a,"touchend","end","notPassiveCapture"]]),f.start(g)}},start(g,a){client$1.is.firefox===!0&&preventDraggable(e,!0);const b=position(g);f.event={x:b.left,y:b.top,time:Date.now(),mouse:a===!0,dir:!1}},move(g){if(f.event===void 0)return;if(f.event.dir!==!1){stopAndPrevent(g);return}const a=Date.now()-f.event.time;if(a===0)return;const b=position(g),T=b.left-f.event.x,C=Math.abs(T),L=b.top-f.event.y,N=Math.abs(L);if(f.event.mouse!==!0){if(C<f.sensitivity[1]&&N<f.sensitivity[1]){f.end(g);return}}else if(C<f.sensitivity[2]&&N<f.sensitivity[2])return;const F=C/a,H=N/a;f.direction.vertical===!0&&C<N&&C<100&&H>f.sensitivity[0]&&(f.event.dir=L<0?"up":"down"),f.direction.horizontal===!0&&C>N&&N<100&&F>f.sensitivity[0]&&(f.event.dir=T<0?"left":"right"),f.direction.up===!0&&C<N&&L<0&&C<100&&H>f.sensitivity[0]&&(f.event.dir="up"),f.direction.down===!0&&C<N&&L>0&&C<100&&H>f.sensitivity[0]&&(f.event.dir="down"),f.direction.left===!0&&C>N&&T<0&&N<100&&F>f.sensitivity[0]&&(f.event.dir="left"),f.direction.right===!0&&C>N&&T>0&&N<100&&F>f.sensitivity[0]&&(f.event.dir="right"),f.event.dir!==!1?(stopAndPrevent(g),f.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),clearSelection(),f.styleCleanup=se=>{f.styleCleanup=void 0,document.body.classList.remove("non-selectable");const ce=()=>{document.body.classList.remove("no-pointer-events--children")};se===!0?setTimeout(ce,50):ce()}),f.handler({evt:g,touch:f.event.mouse!==!0,mouse:f.event.mouse,direction:f.event.dir,duration:a,distance:{x:C,y:N}})):f.end(g)},end(g){f.event!==void 0&&(cleanEvt(f,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),f.styleCleanup!==void 0&&f.styleCleanup(!0),g!==void 0&&f.event.dir!==!1&&stopAndPrevent(g),f.event=void 0)}};if(e.__qtouchswipe=f,o.mouse===!0){const g=o.mouseCapture===!0||o.mousecapture===!0?"Capture":"";addEvt(f,"main",[[e,"mousedown","mouseStart",`passive${g}`]])}client$1.has.touch===!0&&addEvt(f,"main",[[e,"touchstart","touchStart",`passive${o.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const n=e.__qtouchswipe;n!==void 0&&(t.oldValue!==t.value&&(typeof t.value!="function"&&n.end(),n.handler=t.value),n.direction=getModifierDirections(t.modifiers))},beforeUnmount(e){const t=e.__qtouchswipe;t!==void 0&&(cleanEvt(t,"main"),cleanEvt(t,"temp"),client$1.is.firefox===!0&&preventDraggable(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchswipe)}});function useCache(){const e=new Map;return{getCache:function(t,n){return e[t]===void 0?e[t]=n:e[t]},getCacheWithFn:function(t,n){return e[t]===void 0?e[t]=n():e[t]}}}const usePanelChildProps={name:{required:!0},disable:Boolean},PanelWrapper={setup(e,{slots:t}){return()=>h("div",{class:"q-panel scroll",role:"tabpanel"},hSlot(t.default))}},usePanelProps={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},usePanelEmits=["update:modelValue","beforeTransition","transition"];function usePanel(){const{props:e,emit:t,proxy:n}=getCurrentInstance(),{getCacheWithFn:o}=useCache();let u,f;const g=ref(null),a=ref(null);function b(Ke){const St=e.vertical===!0?"up":"left";ze((n.$q.lang.rtl===!0?-1:1)*(Ke.direction===St?1:-1))}const T=computed(()=>[[TouchSwipe,b,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),C=computed(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),L=computed(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),N=computed(()=>`--q-transition-duration: ${e.transitionDuration}ms`),F=computed(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),H=computed(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),se=computed(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);watch(()=>e.modelValue,(Ke,St)=>{const xt=oe(Ke)===!0?le(Ke):-1;f!==!0&&Re(xt===-1?0:xt<le(St)?-1:1),g.value!==xt&&(g.value=xt,t("beforeTransition",Ke,St),nextTick(()=>{t("transition",Ke,St)}))});function ce(){ze(1)}function X(){ze(-1)}function ye(Ke){t("update:modelValue",Ke)}function oe(Ke){return Ke!=null&&Ke!==""}function le(Ke){return u.findIndex(St=>St.props.name===Ke&&St.props.disable!==""&&St.props.disable!==!0)}function ue(){return u.filter(Ke=>Ke.props.disable!==""&&Ke.props.disable!==!0)}function Re(Ke){const St=Ke!==0&&e.animated===!0&&g.value!==-1?"q-transition--"+(Ke===-1?C.value:L.value):null;a.value!==St&&(a.value=St)}function ze(Ke,St=g.value){let xt=St+Ke;for(;xt>-1&&xt<u.length;){const Lr=u[xt];if(Lr!==void 0&&Lr.props.disable!==""&&Lr.props.disable!==!0){Re(Ke),f=!0,t("update:modelValue",Lr.props.name),setTimeout(()=>{f=!1});return}xt+=Ke}e.infinite===!0&&u.length>0&&St!==-1&&St!==u.length&&ze(Ke,Ke===-1?u.length:-1)}function ve(){const Ke=le(e.modelValue);return g.value!==Ke&&(g.value=Ke),!0}function be(){const Ke=oe(e.modelValue)===!0&&ve()&&u[g.value];return e.keepAlive===!0?[h(KeepAlive,H.value,[h(se.value===!0?o(F.value,()=>({...PanelWrapper,name:F.value})):PanelWrapper,{key:F.value,style:N.value},()=>Ke)])]:[h("div",{class:"q-panel scroll",style:N.value,key:F.value,role:"tabpanel"},[Ke])]}function de(){if(u.length!==0)return e.animated===!0?[h(Transition,{name:a.value},be)]:be()}function Te(Ke){return u=getNormalizedVNodes(hSlot(Ke.default,[])).filter(St=>St.props!==null&&St.props.slot===void 0&&oe(St.props.name)===!0),u.length}function Ge(){return u}return Object.assign(n,{next:ce,previous:X,goTo:ye}),{panelIndex:g,panelDirectives:T,updatePanelsList:Te,updatePanelIndex:ve,getPanelContent:de,getEnabledPanels:ue,getPanels:Ge,isValidPanelName:oe,keepAliveProps:H,needsUniqueKeepAliveWrapper:se,goToPanelByOffset:ze,goToPanel:ye,nextPanel:ce,previousPanel:X}}var QTabPanel=createComponent({name:"QTabPanel",props:usePanelChildProps,setup(e,{slots:t}){return()=>h("div",{class:"q-tab-panel",role:"tabpanel"},hSlot(t.default))}}),QTabPanels=createComponent({name:"QTabPanels",props:{...usePanelProps,...useDarkProps},emits:usePanelEmits,setup(e,{slots:t}){const n=getCurrentInstance(),o=useDark(e,n.proxy.$q),{updatePanelsList:u,getPanelContent:f,panelDirectives:g}=usePanel(),a=computed(()=>"q-tab-panels q-panel-parent"+(o.value===!0?" q-tab-panels--dark q-dark":""));return()=>(u(t),hDir("div",{class:a.value},f(),"pan",e.swipeable,()=>g.value))}}),QPageContainer=createComponent({name:"QPageContainer",setup(e,{slots:t}){const{proxy:{$q:n}}=getCurrentInstance(),o=inject(layoutKey,emptyRenderFn);if(o===emptyRenderFn)return console.error("QPageContainer needs to be child of QLayout"),emptyRenderFn;provide(pageContainerKey,!0);const u=computed(()=>{const f={};return o.header.space===!0&&(f.paddingTop=`${o.header.size}px`),o.right.space===!0&&(f[`padding${n.lang.rtl===!0?"Left":"Right"}`]=`${o.right.size}px`),o.footer.space===!0&&(f.paddingBottom=`${o.footer.size}px`),o.left.space===!0&&(f[`padding${n.lang.rtl===!0?"Right":"Left"}`]=`${o.left.size}px`),f});return()=>h("div",{class:"q-page-container",style:u.value},hSlot(t.default))}});const{passive}=listenOpts,axisValues=["both","horizontal","vertical"];var QScrollObserver=createComponent({name:"QScrollObserver",props:{axis:{type:String,validator:e=>axisValues.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(e,{emit:t}){const n={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let o=null,u,f;watch(()=>e.scrollTarget,()=>{b(),a()});function g(){o!==null&&o();const L=Math.max(0,getVerticalScrollPosition(u)),N=getHorizontalScrollPosition(u),F={top:L-n.position.top,left:N-n.position.left};if(e.axis==="vertical"&&F.top===0||e.axis==="horizontal"&&F.left===0)return;const H=Math.abs(F.top)>=Math.abs(F.left)?F.top<0?"up":"down":F.left<0?"left":"right";n.position={top:L,left:N},n.directionChanged=n.direction!==H,n.delta=F,n.directionChanged===!0&&(n.direction=H,n.inflectionPoint=n.position),t("scroll",{...n})}function a(){u=getScrollTarget(f,e.scrollTarget),u.addEventListener("scroll",T,passive),T(!0)}function b(){u!==void 0&&(u.removeEventListener("scroll",T,passive),u=void 0)}function T(L){if(L===!0||e.debounce===0||e.debounce==="0")g();else if(o===null){const[N,F]=e.debounce?[setTimeout(g,e.debounce),clearTimeout]:[requestAnimationFrame(g),cancelAnimationFrame];o=()=>{F(N),o=null}}}const{proxy:C}=getCurrentInstance();return watch(()=>C.$q.lang.rtl,g),onMounted(()=>{f=C.$el.parentNode,a()}),onBeforeUnmount(()=>{o!==null&&o(),b()}),Object.assign(C,{trigger:T,getPosition:()=>n}),noop}}),QLayout=createComponent({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:t,emit:n}){const{proxy:{$q:o}}=getCurrentInstance(),u=ref(null),f=ref(o.screen.height),g=ref(e.container===!0?0:o.screen.width),a=ref({position:0,direction:"down",inflectionPoint:0}),b=ref(0),T=ref(isRuntimeSsrPreHydration.value===!0?0:getScrollbarWidth()),C=computed(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),L=computed(()=>e.container===!1?{minHeight:o.screen.height+"px"}:null),N=computed(()=>T.value!==0?{[o.lang.rtl===!0?"left":"right"]:`${T.value}px`}:null),F=computed(()=>T.value!==0?{[o.lang.rtl===!0?"right":"left"]:0,[o.lang.rtl===!0?"left":"right"]:`-${T.value}px`,width:`calc(100% + ${T.value}px)`}:null);function H(le){if(e.container===!0||document.qScrollPrevented!==!0){const ue={position:le.position.top,direction:le.direction,directionChanged:le.directionChanged,inflectionPoint:le.inflectionPoint.top,delta:le.delta.top};a.value=ue,e.onScroll!==void 0&&n("scroll",ue)}}function se(le){const{height:ue,width:Re}=le;let ze=!1;f.value!==ue&&(ze=!0,f.value=ue,e.onScrollHeight!==void 0&&n("scrollHeight",ue),X()),g.value!==Re&&(ze=!0,g.value=Re),ze===!0&&e.onResize!==void 0&&n("resize",le)}function ce({height:le}){b.value!==le&&(b.value=le,X())}function X(){if(e.container===!0){const le=f.value>b.value?getScrollbarWidth():0;T.value!==le&&(T.value=le)}}let ye=null;const oe={instances:{},view:computed(()=>e.view),isContainer:computed(()=>e.container),rootRef:u,height:f,containerHeight:b,scrollbarWidth:T,totalWidth:computed(()=>g.value+T.value),rows:computed(()=>{const le=e.view.toLowerCase().split(" ");return{top:le[0].split(""),middle:le[1].split(""),bottom:le[2].split("")}}),header:reactive({size:0,offset:0,space:!1}),right:reactive({size:300,offset:0,space:!1}),footer:reactive({size:0,offset:0,space:!1}),left:reactive({size:300,offset:0,space:!1}),scroll:a,animate(){ye!==null?clearTimeout(ye):document.body.classList.add("q-body--layout-animate"),ye=setTimeout(()=>{ye=null,document.body.classList.remove("q-body--layout-animate")},155)},update(le,ue,Re){oe[le][ue]=Re}};if(provide(layoutKey,oe),getScrollbarWidth()>0){let Re=function(){le=null,ue.classList.remove("hide-scrollbar")},ze=function(){if(le===null){if(ue.scrollHeight>o.screen.height)return;ue.classList.add("hide-scrollbar")}else clearTimeout(le);le=setTimeout(Re,300)},ve=function(be){le!==null&&be==="remove"&&(clearTimeout(le),Re()),window[`${be}EventListener`]("resize",ze)},le=null;const ue=document.body;watch(()=>e.container!==!0?"add":"remove",ve),e.container!==!0&&ve("add"),onUnmounted(()=>{ve("remove")})}return()=>{const le=hMergeSlot(t.default,[h(QScrollObserver,{onScroll:H}),h(QResizeObserver,{onResize:se})]),ue=h("div",{class:C.value,style:L.value,ref:e.container===!0?void 0:u,tabindex:-1},le);return e.container===!0?h("div",{class:"q-layout-container overflow-hidden",ref:u},[h(QResizeObserver,{onResize:ce}),h("div",{class:"absolute-full",style:N.value},[h("div",{class:"scroll",style:F.value},[ue])])]):ue}}});function getDepth$1(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var ClosePopup=createDirective({name:"close-popup",beforeMount(e,{value:t}){const n={depth:getDepth$1(t),handler(o){n.depth!==0&&setTimeout(()=>{const u=getPortalProxy(e);u!==void 0&&closePortals(u,o,n.depth)})},handlerKey(o){isKeyCode(o,13)===!0&&n.handler(o)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:t,oldValue:n}){t!==n&&(e.__qclosepopup.depth=getDepth$1(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});const useAnchorProps={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function useAnchor({showing:e,avoidEmit:t,configureAnchorEl:n}){const{props:o,proxy:u,emit:f}=getCurrentInstance(),g=ref(null);let a=null;function b(F){return g.value===null?!1:F===void 0||F.touches===void 0||F.touches.length<=1}const T={};n===void 0&&(Object.assign(T,{hide(F){u.hide(F)},toggle(F){u.toggle(F),F.qAnchorHandled=!0},toggleKey(F){isKeyCode(F,13)===!0&&T.toggle(F)},contextClick(F){u.hide(F),prevent(F),nextTick(()=>{u.show(F),F.qAnchorHandled=!0})},prevent,mobileTouch(F){if(T.mobileCleanup(F),b(F)!==!0)return;u.hide(F),g.value.classList.add("non-selectable");const H=F.target;addEvt(T,"anchor",[[H,"touchmove","mobileCleanup","passive"],[H,"touchend","mobileCleanup","passive"],[H,"touchcancel","mobileCleanup","passive"],[g.value,"contextmenu","prevent","notPassive"]]),a=setTimeout(()=>{a=null,u.show(F),F.qAnchorHandled=!0},300)},mobileCleanup(F){g.value.classList.remove("non-selectable"),a!==null&&(clearTimeout(a),a=null),e.value===!0&&F!==void 0&&clearSelection()}}),n=function(F=o.contextMenu){if(o.noParentEvent===!0||g.value===null)return;let H;F===!0?u.$q.platform.is.mobile===!0?H=[[g.value,"touchstart","mobileTouch","passive"]]:H=[[g.value,"mousedown","hide","passive"],[g.value,"contextmenu","contextClick","notPassive"]]:H=[[g.value,"click","toggle","passive"],[g.value,"keyup","toggleKey","passive"]],addEvt(T,"anchor",H)});function C(){cleanEvt(T,"anchor")}function L(F){for(g.value=F;g.value.classList.contains("q-anchor--skip");)g.value=g.value.parentNode;n()}function N(){if(o.target===!1||o.target===""||u.$el.parentNode===null)g.value=null;else if(o.target===!0)L(u.$el.parentNode);else{let F=o.target;if(typeof o.target=="string")try{F=document.querySelector(o.target)}catch{F=void 0}F!=null?(g.value=F.$el||F,n()):(g.value=null,console.error(`Anchor: target "${o.target}" not found`))}}return watch(()=>o.contextMenu,F=>{g.value!==null&&(C(),n(F))}),watch(()=>o.target,()=>{g.value!==null&&C(),N()}),watch(()=>o.noParentEvent,F=>{g.value!==null&&(F===!0?C():n())}),onMounted(()=>{N(),t!==!0&&o.modelValue===!0&&g.value===null&&f("update:modelValue",!1)}),onBeforeUnmount(()=>{a!==null&&clearTimeout(a),C()}),{anchorEl:g,canShow:b,anchorEvents:T}}function useScrollTarget(e,t){const n=ref(null);let o;function u(a,b){const T=`${b!==void 0?"add":"remove"}EventListener`,C=b!==void 0?b:o;a!==window&&a[T]("scroll",C,listenOpts.passive),window[T]("scroll",C,listenOpts.passive),o=b}function f(){n.value!==null&&(u(n.value),n.value=null)}const g=watch(()=>e.noParentEvent,()=>{n.value!==null&&(f(),t())});return onBeforeUnmount(g),{localScrollTarget:n,unconfigureScrollTarget:f,changeScrollEvent:u}}const{notPassiveCapture}=listenOpts,registeredList=[];function globalHandler(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let n=portalProxyList.length-1;for(;n>=0;){const o=portalProxyList[n].$;if(o.type.name!=="QDialog")break;if(o.props.seamless!==!0)return;n--}for(let o=registeredList.length-1;o>=0;o--){const u=registeredList[o];if((u.anchorEl.value===null||u.anchorEl.value.contains(t)===!1)&&(t===document.body||u.innerRef.value!==null&&u.innerRef.value.contains(t)===!1))e.qClickOutside=!0,u.onClickOutside(e);else return}}function addClickOutside(e){registeredList.push(e),registeredList.length===1&&(document.addEventListener("mousedown",globalHandler,notPassiveCapture),document.addEventListener("touchstart",globalHandler,notPassiveCapture))}function removeClickOutside(e){const t=registeredList.findIndex(n=>n===e);t>-1&&(registeredList.splice(t,1),registeredList.length===0&&(document.removeEventListener("mousedown",globalHandler,notPassiveCapture),document.removeEventListener("touchstart",globalHandler,notPassiveCapture)))}let vpLeft,vpTop;function validatePosition(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function validateOffset(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const horizontalPos={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{horizontalPos[`${e}#ltr`]=e,horizontalPos[`${e}#rtl`]=e});function parsePosition(e,t){const n=e.split(" ");return{vertical:n[0],horizontal:horizontalPos[`${n[1]}#${t===!0?"rtl":"ltr"}`]}}function getAnchorProps(e,t){let{top:n,left:o,right:u,bottom:f,width:g,height:a}=e.getBoundingClientRect();return t!==void 0&&(n-=t[1],o-=t[0],f+=t[1],u+=t[0],g+=t[0],a+=t[1]),{top:n,bottom:f,height:a,left:o,right:u,width:g,middle:o+(u-o)/2,center:n+(f-n)/2}}function getAbsoluteAnchorProps(e,t,n){let{top:o,left:u}=e.getBoundingClientRect();return o+=t.top,u+=t.left,n!==void 0&&(o+=n[1],u+=n[0]),{top:o,bottom:o+1,height:1,left:u,right:u+1,width:1,middle:u,center:o}}function getTargetProps(e){return{top:0,center:e.offsetHeight/2,bottom:e.offsetHeight,left:0,middle:e.offsetWidth/2,right:e.offsetWidth}}function getTopLeftProps(e,t,n){return{top:e[n.anchorOrigin.vertical]-t[n.selfOrigin.vertical],left:e[n.anchorOrigin.horizontal]-t[n.selfOrigin.horizontal]}}function setPosition(e){if(client$1.is.ios===!0&&window.visualViewport!==void 0){const a=document.body.style,{offsetLeft:b,offsetTop:T}=window.visualViewport;b!==vpLeft&&(a.setProperty("--q-pe-left",b+"px"),vpLeft=b),T!==vpTop&&(a.setProperty("--q-pe-top",T+"px"),vpTop=T)}const{scrollLeft:t,scrollTop:n}=e.el,o=e.absoluteOffset===void 0?getAnchorProps(e.anchorEl,e.cover===!0?[0,0]:e.offset):getAbsoluteAnchorProps(e.anchorEl,e.absoluteOffset,e.offset);let u={maxHeight:e.maxHeight,maxWidth:e.maxWidth,visibility:"visible"};(e.fit===!0||e.cover===!0)&&(u.minWidth=o.width+"px",e.cover===!0&&(u.minHeight=o.height+"px")),Object.assign(e.el.style,u);const f=getTargetProps(e.el);let g=getTopLeftProps(o,f,e);if(e.absoluteOffset===void 0||e.offset===void 0)applyBoundaries(g,o,f,e.anchorOrigin,e.selfOrigin);else{const{top:a,left:b}=g;applyBoundaries(g,o,f,e.anchorOrigin,e.selfOrigin);let T=!1;if(g.top!==a){T=!0;const C=2*e.offset[1];o.center=o.top-=C,o.bottom-=C+2}if(g.left!==b){T=!0;const C=2*e.offset[0];o.middle=o.left-=C,o.right-=C+2}T===!0&&(g=getTopLeftProps(o,f,e),applyBoundaries(g,o,f,e.anchorOrigin,e.selfOrigin))}u={top:g.top+"px",left:g.left+"px"},g.maxHeight!==void 0&&(u.maxHeight=g.maxHeight+"px",o.height>g.maxHeight&&(u.minHeight=u.maxHeight)),g.maxWidth!==void 0&&(u.maxWidth=g.maxWidth+"px",o.width>g.maxWidth&&(u.minWidth=u.maxWidth)),Object.assign(e.el.style,u),e.el.scrollTop!==n&&(e.el.scrollTop=n),e.el.scrollLeft!==t&&(e.el.scrollLeft=t)}function applyBoundaries(e,t,n,o,u){const f=n.bottom,g=n.right,a=getScrollbarWidth(),b=window.innerHeight-a,T=document.body.clientWidth;if(e.top<0||e.top+f>b)if(u.vertical==="center")e.top=t[o.vertical]>b/2?Math.max(0,b-f):0,e.maxHeight=Math.min(f,b);else if(t[o.vertical]>b/2){const C=Math.min(b,o.vertical==="center"?t.center:o.vertical===u.vertical?t.bottom:t.top);e.maxHeight=Math.min(f,C),e.top=Math.max(0,C-f)}else e.top=Math.max(0,o.vertical==="center"?t.center:o.vertical===u.vertical?t.top:t.bottom),e.maxHeight=Math.min(f,b-e.top);if(e.left<0||e.left+g>T)if(e.maxWidth=Math.min(g,T),u.horizontal==="middle")e.left=t[o.horizontal]>T/2?Math.max(0,T-g):0;else if(t[o.horizontal]>T/2){const C=Math.min(T,o.horizontal==="middle"?t.middle:o.horizontal===u.horizontal?t.right:t.left);e.maxWidth=Math.min(g,C),e.left=Math.max(0,C-e.maxWidth)}else e.left=Math.max(0,o.horizontal==="middle"?t.middle:o.horizontal===u.horizontal?t.left:t.right),e.maxWidth=Math.min(g,T-e.left)}var QMenu=createComponent({name:"QMenu",inheritAttrs:!1,props:{...useAnchorProps,...useModelToggleProps,...useDarkProps,...useTransitionProps,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:validatePosition},self:{type:String,validator:validatePosition},offset:{type:Array,validator:validateOffset},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...useModelToggleEmits,"click","escapeKey"],setup(e,{slots:t,emit:n,attrs:o}){let u=null,f,g,a;const b=getCurrentInstance(),{proxy:T}=b,{$q:C}=T,L=ref(null),N=ref(!1),F=computed(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),H=useDark(e,C),{registerTick:se,removeTick:ce}=useTick(),{registerTimeout:X}=useTimeout(),{transitionProps:ye,transitionStyle:oe}=useTransition(e),{localScrollTarget:le,changeScrollEvent:ue,unconfigureScrollTarget:Re}=useScrollTarget(e,Yt),{anchorEl:ze,canShow:ve}=useAnchor({showing:N}),{hide:be}=useModelToggle({showing:N,canShow:ve,handleShow:_t,handleHide:Kt,hideOnRouteChange:F,processOnMount:!0}),{showPortal:de,hidePortal:Te,renderPortal:Ge}=usePortal(b,L,ii,"menu"),Ke={anchorEl:ze,innerRef:L,onClickOutside(nr){if(e.persistent!==!0&&N.value===!0)return be(nr),(nr.type==="touchstart"||nr.target.classList.contains("q-dialog__backdrop"))&&stopAndPrevent(nr),!0}},St=computed(()=>parsePosition(e.anchor||(e.cover===!0?"center middle":"bottom start"),C.lang.rtl)),xt=computed(()=>e.cover===!0?St.value:parsePosition(e.self||"top start",C.lang.rtl)),Lr=computed(()=>(e.square===!0?" q-menu--square":"")+(H.value===!0?" q-menu--dark q-dark":"")),Nr=computed(()=>e.autoClose===!0?{onClick:er}:{}),Sr=computed(()=>N.value===!0&&e.persistent!==!0);watch(Sr,nr=>{nr===!0?(addEscapeKey(ar),addClickOutside(Ke)):(removeEscapeKey(ar),removeClickOutside(Ke))});function Gr(){addFocusFn(()=>{let nr=L.value;nr&&nr.contains(document.activeElement)!==!0&&(nr=nr.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||nr.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||nr.querySelector("[autofocus], [data-autofocus]")||nr,nr.focus({preventScroll:!0}))})}function _t(nr){if(u=e.noRefocus===!1?document.activeElement:null,addFocusout(lr),de(),Yt(),f=void 0,nr!==void 0&&(e.touchPosition||e.contextMenu)){const at=position(nr);if(at.left!==void 0){const{top:bi,left:Br}=ze.value.getBoundingClientRect();f={left:at.left-Br,top:at.top-bi}}}g===void 0&&(g=watch(()=>C.screen.width+"|"+C.screen.height+"|"+e.self+"|"+e.anchor+"|"+C.lang.rtl,dr)),e.noFocus!==!0&&document.activeElement.blur(),se(()=>{dr(),e.noFocus!==!0&&Gr()}),X(()=>{C.platform.is.ios===!0&&(a=e.autoClose,L.value.click()),dr(),de(!0),n("show",nr)},e.transitionDuration)}function Kt(nr){ce(),Te(),mr(!0),u!==null&&(nr===void 0||nr.qClickOutside!==!0)&&(((nr&&nr.type.indexOf("key")===0?u.closest('[tabindex]:not([tabindex^="-"])'):void 0)||u).focus(),u=null),X(()=>{Te(!0),n("hide",nr)},e.transitionDuration)}function mr(nr){f=void 0,g!==void 0&&(g(),g=void 0),(nr===!0||N.value===!0)&&(removeFocusout(lr),Re(),removeClickOutside(Ke),removeEscapeKey(ar)),nr!==!0&&(u=null)}function Yt(){(ze.value!==null||e.scrollTarget!==void 0)&&(le.value=getScrollTarget(ze.value,e.scrollTarget),ue(le.value,dr))}function er(nr){a!==!0?(closePortalMenus(T,nr),n("click",nr)):a=!1}function lr(nr){Sr.value===!0&&e.noFocus!==!0&&childHasFocus(L.value,nr.target)!==!0&&Gr()}function ar(nr){n("escapeKey"),be(nr)}function dr(){const nr=L.value;nr===null||ze.value===null||setPosition({el:nr,offset:e.offset,anchorEl:ze.value,anchorOrigin:St.value,selfOrigin:xt.value,absoluteOffset:f,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function ii(){return h(Transition,ye.value,()=>N.value===!0?h("div",{role:"menu",...o,ref:L,tabindex:-1,class:["q-menu q-position-engine scroll"+Lr.value,o.class],style:[o.style,oe.value],...Nr.value},hSlot(t.default)):null)}return onBeforeUnmount(mr),Object.assign(T,{focus:Gr,updatePosition:dr}),Ge}}),QToolbar=createComponent({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:t}){const n=computed(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>h("div",{class:n.value,role:"toolbar"},hSlot(t.default))}});class Store{constructor(t="unreal-mapbox",n="keyval"){this.storeName=n,this._dbp=new Promise((o,u)=>{const f=indexedDB.open(t,3);f.onerror=()=>u(f.error),f.onsuccess=()=>o(f.result),f.onupgradeneeded=()=>{try{f.result.deleteObjectStore(n)}catch{}f.result.createObjectStore(n)}})}_withIDBStore(t,n){return this._dbp.then(o=>new Promise((u,f)=>{const g=o.transaction(this.storeName,t);g.oncomplete=()=>u(),g.onabort=g.onerror=()=>f(g.error),n(g.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get(e,t=getDefaultStore()){let n;return t._withIDBStore("readonly",o=>{n=o.get(e)}).then(()=>n.result)}function set(e,t,n=getDefaultStore()){return n._withIDBStore("readwrite",o=>{o.put(t,e)})}function del(e,t=getDefaultStore()){return t._withIDBStore("readwrite",n=>{n.delete(e)})}function clear(e=getDefaultStore()){return e._withIDBStore("readwrite",t=>{t.clear()})}function keys(e=getDefaultStore()){const t=[];return e._withIDBStore("readonly",n=>{(n.openKeyCursor||n.openCursor).call(n).onsuccess=function(){!this.result||(t.push(this.result.key),this.result.continue())}}).then(()=>t)}var idbKeyval={keys,clear,del,set,get};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(e=>e[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(e=>e)}async function verifyPermission(e,t){const n={};return t&&(n.writable=!0,n.mode="readwrite"),await e.queryPermission(n)==="granted"||await e.requestPermission(n)==="granted"}async function writeFileToDisk(e,t,n){let u=await(await e.getFileHandle(t,{create:!0})).createWritable();await u.write(n),await u.close()}async function fileExists(e,t){try{return await e.getFileHandle(t),!0}catch(n){if(n.name==="NotFoundError")return!1;if(n.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(e,t){return await(await(await e.getFileHandle(t)).getFile()).arrayBuffer()}function checkFileApiSupport(){let e;return"showDirectoryPicker"in window?e=!0:e=!1,e}var fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport},commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),t}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mapboxGl={exports:{}};(function(e,t){(function(n,o){e.exports=o()})(commonjsGlobal,function(){var n,o,u;function f(a,b){if(!n)n=b;else if(!o)o=b;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",C={};n(C),u=b(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}f(["exports"],function(a){var b=typeof self<"u"?self:{},T="2.12.0";let C;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):s}catch{C=s}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},N={supported:!1,testSupport:function(s){!se&&H&&(ce?X(s):F=s)}};let F,H,se=!1,ce=!1;function X(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,H),s.isContextLost())return;N.supported=!0}catch{}s.deleteTexture(r),se=!0}b.document&&(H=b.document.createElement("img"),H.onload=function(){F&&X(F),F=null,ce=!0},H.onerror=function(){se=!0,F=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ye="01";var oe=le;function le(s,r,l,d){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=l,this.p2y=d}le.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,d=0;d<8;d++){var m=this.sampleCurveX(l)-s;if(Math.abs(m)<r)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=m/y}var w=0,A=1;for(l=s,d=0;d<20&&(m=this.sampleCurveX(l),!(Math.abs(m-s)<r));d++)s>m?w=l:A=l,l=.5*(A-w)+w;return l},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var ue=Re;function Re(s,r){this.x=s,this.y=r}Re.prototype={clone:function(){return new Re(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,l=s.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),l=Math.sin(s),d=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=d,this},_rotateAround:function(s,r){var l=Math.cos(s),d=Math.sin(s),m=r.y+d*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-d*(this.y-r.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Re.convert=function(s){return s instanceof Re?s:Array.isArray(s)?new Re(s[0],s[1]):s};const ze=Math.PI/180,ve=180/Math.PI;function be(s){return s*ze}function de(s){return s*ve}const Te=[[0,0],[1,0],[1,1],[0,1]];function Ge(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,l=r*s;return 4*(s<.5?l:3*(s-r)+l-.75)}function Ke(s,r,l,d){const m=new oe(s,r,l,d);return function(y){return m.solve(y)}}const St=Ke(.25,.1,.25,1);function xt(s,r,l){return Math.min(l,Math.max(r,s))}function Lr(s,r,l){return(l=xt((l-s)/(r-s),0,1))*l*(3-2*l)}function Nr(s,r,l){const d=l-r,m=((s-r)%d+d)%d+r;return m===r?l:m}function Sr(s,r,l){if(!s.length)return l(null,[]);let d=s.length;const m=new Array(s.length);let y=null;s.forEach((w,A)=>{r(w,(k,P)=>{k&&(y=k),m[A]=P,--d==0&&l(y,m)})})}function Gr(s){const r=[];for(const l in s)r.push(s[l]);return r}function _t(s,...r){for(const l of r)for(const d in l)s[d]=l[d];return s}let Kt=1;function mr(){return Kt++}function Yt(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function er(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function lr(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function ar(s,r){s.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function dr(s,r){return s.indexOf(r,s.length-r.length)!==-1}function ii(s,r,l){const d={};for(const m in s)d[m]=r.call(l||this,s[m],m,s);return d}function nr(s,r,l){const d={};for(const m in s)r.call(l||this,s[m],m,s)&&(d[m]=s[m]);return d}function at(s){return Array.isArray(s)?s.map(at):typeof s=="object"&&s?ii(s,at):s}const bi={};function Br(s){bi[s]||(typeof console<"u"&&console.warn(s),bi[s]=!0)}function Xr(s,r,l){return(l.y-s.y)*(r.x-s.x)>(r.y-s.y)*(l.x-s.x)}function cr(s){let r=0;for(let l,d,m=0,y=s.length,w=y-1;m<y;w=m++)l=s[m],d=s[w],r+=(d.x-l.x)*(l.y+d.y);return r}function ur(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yi(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,m,y)=>{const w=m||y;return r[d]=!w||w.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let Or=null;function mi(s){if(Or==null){const r=s.navigator?s.navigator.userAgent:null;Or=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Or}function qt(s){try{const r=b[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Er(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const Gt="mapbox-tiles";let Jt,st,Pr=500,ht=50;function Nt(){try{return b.caches}catch{}}function xr(){Nt()&&!Jt&&(Jt=b.caches.open(Gt))}function Qr(s){const r=s.indexOf("?");if(r<0)return s;const l=function(m){const y=m.indexOf("?");return y>0?m.slice(y+1).split("&"):[]}(s),d=l.filter(m=>{const y=m.split("=");return y[0]==="language"||y[0]==="worldview"});return d.length?`${s.slice(0,r)}?${d.join("&")}`:s.slice(0,r)}let zr=1/0;const br={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(br);class xi extends Error{constructor(r,l,d){l===401&&oo(d)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ui=ur()?()=>self.worker&&self.worker.referrer:()=>(b.location.protocol==="blob:"?b.parent:b).location.href,di=function(s,r){if(!(/^file:/.test(l=s.url)||/^file:/.test(ui())&&!/^\w+:/.test(l))){if(b.fetch&&b.Request&&b.AbortController&&b.Request.prototype.hasOwnProperty("signal"))return function(d,m){const y=new b.AbortController,w=new b.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:ui(),signal:y.signal});let A=!1,k=!1;const P=(V=w.url).indexOf("sku=")>0&&oo(V);var V;d.type==="json"&&w.headers.set("Accept","application/json");const W=(ne,he,ge)=>{if(k)return;if(ne&&ne.message!=="SecurityError"&&Br(ne),he&&ge)return Q(he);const Ae=Date.now();b.fetch(w).then(je=>{if(je.ok){const Qe=P?je.clone():null;return Q(je,Qe,Ae)}return m(new xi(je.statusText,je.status,d.url))}).catch(je=>{je.code!==20&&m(new Error(je.message))})},Q=(ne,he,ge)=>{(d.type==="arrayBuffer"?ne.arrayBuffer():d.type==="json"?ne.json():ne.text()).then(Ae=>{k||(he&&ge&&function(je,Qe,$e){if(xr(),!Jt)return;const Xe={status:Qe.status,statusText:Qe.statusText,headers:new b.Headers};Qe.headers.forEach((Ot,Rt)=>Xe.headers.set(Rt,Ot));const nt=yi(Qe.headers.get("Cache-Control")||"");if(nt["no-store"])return;nt["max-age"]&&Xe.headers.set("Expires",new Date($e+1e3*nt["max-age"]).toUTCString());const rt=Xe.headers.get("Expires");rt&&(new Date(rt).getTime()-$e<42e4||function(Ot,Rt){if(st===void 0)try{new Response(new ReadableStream),st=!0}catch{st=!1}st?Rt(Ot.body):Ot.blob().then(Rt)}(Qe,Ot=>{const Rt=new b.Response(Ot,Xe);xr(),Jt&&Jt.then(rr=>rr.put(Qr(je.url),Rt)).catch(rr=>Br(rr.message))}))}(w,he,ge),A=!0,m(null,Ae,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(Ae=>{k||m(new Error(Ae.message))})};return P?function(ne,he){if(xr(),!Jt)return he(null);const ge=Qr(ne.url);Jt.then(Ae=>{Ae.match(ge).then(je=>{const Qe=function($e){if(!$e)return!1;const Xe=new Date($e.headers.get("Expires")||0),nt=yi($e.headers.get("Cache-Control")||"");return Xe>Date.now()&&!nt["no-cache"]}(je);Ae.delete(ge),Qe&&Ae.put(ge,je.clone()),he(null,je,Qe)}).catch(he)}).catch(he)}(w,W):W(null,null),{cancel:()=>{k=!0,A||y.abort()}}}(s,r);if(ur()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var l;return function(d,m){const y=new b.XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const w in d.headers)y.setRequestHeader(w,d.headers[w]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{m(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let w=y.response;if(d.type==="json")try{w=JSON.parse(y.response)}catch(A){return m(A)}m(null,w,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else m(new xi(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(s,r)},Ti=function(s,r){return di(_t(s,{type:"arrayBuffer"}),r)};function Yi(s){const r=b.document.createElement("a");return r.href=s,r.protocol===b.document.location.protocol&&r.host===b.document.location.host}const Zi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let oi,En;oi=[],En=0;const fo=function(s,r){if(N.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),En>=L.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return oi.push(y),y}En++;let l=!1;const d=()=>{if(!l)for(l=!0,En--;oi.length&&En<L.MAX_PARALLEL_IMAGE_REQUESTS;){const y=oi.shift(),{requestParameters:w,callback:A,cancelled:k}=y;k||(y.cancel=fo(w,A).cancel)}},m=Ti(s,(y,w,A,k)=>{d(),y?r(y):w&&(b.createImageBitmap?function(P,V){const W=new b.Blob([new Uint8Array(P)],{type:"image/png"});b.createImageBitmap(W).then(Q=>{V(null,Q)}).catch(Q=>{V(new Error(`Could not load image because of ${Q.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,(P,V)=>r(P,V,A,k)):function(P,V){const W=new b.Image,Q=b.URL;W.onload=()=>{V(null,W),Q.revokeObjectURL(W.src),W.onload=null,b.requestAnimationFrame(()=>{W.src=Zi})},W.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ne=new b.Blob([new Uint8Array(P)],{type:"image/png"});W.src=P.byteLength?Q.createObjectURL(ne):Zi}(w,(P,V)=>r(P,V,A,k)))});return{cancel:()=>{m.cancel(),d()}}},po="NO_ACCESS_TOKEN";function bn(s){return s.indexOf("mapbox:")===0}function oo(s){return L.API_URL_REGEX.test(s)}function Vi(s){return L.API_CDN_URL_REGEX.test(s)}function Xn(s){return L.API_STYLE_REGEX.test(s)&&!Pn(s)}function Pn(s){return L.API_SPRITE_REGEX.test(s)}const hn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ie(s){const r=s.match(hn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function ut(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}function Bt(s){if(!s)return null;const r=s.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(b.atob(r[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class _e{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Bt(L.ACCESS_TOKEN);let d="";return d=l&&l.u?b.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(m,y)=>String.fromCharCode(Number("0x"+y)))):L.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${d}`:`mapbox.eventData:${d}`}fetchEventData(){const r=qt("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(r)try{const m=b.localStorage.getItem(l);m&&(this.eventData=JSON.parse(m));const y=b.localStorage.getItem(d);y&&(this.anonId=y)}catch{Br("Unable to read from LocalStorage")}}saveEventData(){const r=qt("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(r)try{b.localStorage.setItem(d,this.anonId),Object.keys(this.eventData).length>=1&&b.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Br("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,d,m){if(!L.EVENTS_URL)return;const y=Ie(L.EVENTS_URL);y.params.push(`access_token=${m||L.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},A=l?_t(w,l):w,k={url:ut(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=function(P,V){return di(_t(P,{method:"POST"}),V)}(k,P=>{this.pendingRequest=null,d(P),this.saveEventData(),this.processRequests(m)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const ae=new class extends _e{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(s)&&s.some(l=>bn(l)||oo(l))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Bt(L.ACCESS_TOKEN),l=r?r.u:L.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;lr(this.anonId)||(this.anonId=Yt(),d=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),w=new Date(m),A=(m-this.eventData.lastSuccess)/864e5;d=d||A>=1||A<-1||y.getDate()!==w.getDate()}else d=!0;d?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:ye,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=l)},s):this.processRequests()}},fe=ae.postTurnstileEvent.bind(ae),ke=new class extends _e{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,l,d){this.skuToken=r,this.errorCb=d,L.EVENTS_URL&&(l||L.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(po)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),lr(this.anonId)||(this.anonId=Yt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:ye,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):r&&(this.success[r]=!0)},s))}},Fe=ke.postMapLoadEvent.bind(ke),Ye=new class extends _e{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){L.EVENTS_URL&&(s||L.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),d=function(m){const y=b.performance.getEntriesByType("resource"),w=b.performance.getEntriesByType("mark"),A=function(Q){const ne={};if(Q){for(const he in Q)if(he!=="other")for(const ge of Q[he]){const Ae=`${he}ResolveRangeMin`,je=`${he}ResolveRangeMax`,Qe=`${he}RequestCount`,$e=`${he}RequestCachedCount`;ne[Ae]=Math.min(ne[Ae]||1/0,ge.startTime),ne[je]=Math.max(ne[je]||-1/0,ge.responseEnd);const Xe=nt=>{ne[nt]===void 0&&(ne[nt]=0),++ne[nt]};ge.transferSize!==void 0&&ge.transferSize===0&&Xe($e),Xe(Qe)}}return ne}(function(Q,ne){const he={};if(Q)for(const ge of Q){const Ae=ne(ge);he[Ae]===void 0&&(he[Ae]=[]),he[Ae].push(ge)}return he}(y,Qt)),k=b.devicePixelRatio,P=b.navigator.connection||b.navigator.mozConnection||b.navigator.webkitConnection,V={counters:[],metadata:[],attributes:[]},W=(Q,ne,he)=>{he!=null&&Q.push({name:ne,value:he.toString()})};for(const Q in A)W(V.counters,Q,A[Q]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(W(V.counters,"interactionRangeMin",m.interactionRange[0]),W(V.counters,"interactionRangeMax",m.interactionRange[1])),w)for(const Q of Object.keys($t)){const ne=$t[Q],he=w.find(ge=>ge.name===ne);he&&W(V.counters,ne,he.startTime)}return W(V.counters,"visibilityHidden",m.visibilityHidden),W(V.attributes,"style",function(Q){if(Q)for(const ne of Q){const he=ne.name.split("?")[0];if(Xn(he)){const ge=he.split("/").slice(-2);if(ge.length===2)return`mapbox://styles/${ge[0]}/${ge[1]}`}}}(y)),W(V.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),W(V.attributes,"fogEnabled",m.fogEnabled?"true":"false"),W(V.attributes,"projection",m.projection),W(V.attributes,"zoom",m.zoom),W(V.metadata,"devicePixelRatio",k),W(V.metadata,"connectionEffectiveType",P?P.effectiveType:void 0),W(V.metadata,"navigatorUserAgent",b.navigator.userAgent),W(V.metadata,"screenWidth",b.screen.width),W(V.metadata,"screenHeight",b.screen.height),W(V.metadata,"windowWidth",b.innerWidth),W(V.metadata,"windowHeight",b.innerHeight),W(V.metadata,"mapWidth",m.width/k),W(V.metadata,"mapHeight",m.height/k),W(V.metadata,"webglRenderer",m.renderer),W(V.metadata,"webglVendor",m.vendor),W(V.metadata,"sdkVersion",T),W(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(l);for(const m of d.metadata);for(const m of d.counters);for(const m of d.attributes);this.postEvent(r,d,()=>{},s)}},mt=Ye.postPerformanceEvent.bind(Ye),yt=new class extends _e{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,l,d){if(!L.API_URL||!L.SESSION_PATH)return;const m=Ie(L.API_URL+L.SESSION_PATH);m.params.push(`sku=${r||""}`),m.params.push(`access_token=${d||L.ACCESS_TOKEN||""}`);const y={url:ut(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(w,A){return di(_t(w,{method:"GET"}),A)}(y,w=>{this.pendingRequest=null,l(w),this.saveEventData(),this.processRequests(d)})}getSessionAPI(s,r,l,d){this.skuToken=r,this.errorCb=d,L.SESSION_PATH&&L.API_URL&&(l||L.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(po)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):r&&(this.success[r]=!0)},s)}},Je=yt.getSessionAPI.bind(yt),vt=new Set,$t={create:"create",load:"load",fullLoad:"fullLoad"},Ar={mark(s){b.performance.mark(s)},measure(s,r,l){b.performance.measure(s,r,l)}};function Qt(s){const r=s.name.split("?")[0];return Vi(r)&&r.includes("mapbox-gl.js")?"javascript":Vi(r)&&r.includes("mapbox-gl.css")?"css":function(l){return L.API_FONTS_REGEX.test(l)}(r)?"fontRange":Pn(r)?"sprite":Xn(r)?"style":function(l){return L.API_TILEJSON_REGEX.test(l)}(r)?"tilejson":"other"}const Kr=b.performance;function ri(s){const r=s?s.url.toString():void 0;return Kr.getEntriesByName(r)}let Wr,ni,Bi,et;const tr={now:()=>Bi!==void 0?Bi:b.performance.now(),setNow(s){Bi=s},restoreNow(){Bi=void 0},frame(s){const r=b.requestAnimationFrame(s);return{cancel:()=>b.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:l,height:d}=s;et||(et=b.document.createElement("canvas"));const m=et.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>et.width||d>et.height)&&(et.width=l,et.height=d),m.clearRect(-r,-r,l+2*r,d+2*r),m.drawImage(s,0,0,l,d),m.getImageData(-r,-r,l+2*r,d+2*r)},resolveURL:s=>(Wr||(Wr=b.document.createElement("a")),Wr.href=s,Wr.href),get devicePixelRatio(){return b.devicePixelRatio},get prefersReducedMotion(){return!!b.matchMedia&&(ni==null&&(ni=b.matchMedia("(prefers-reduced-motion: reduce)")),ni.matches)}};function gr(s,r,l){l[s]&&l[s].indexOf(r)!==-1||(l[s]=l[s]||[],l[s].push(r))}function Jr(s,r,l){if(l&&l[s]){const d=l[s].indexOf(r);d!==-1&&l[s].splice(d,1)}}class Ji{constructor(r,l={}){_t(this,l),this.type=r}}class Gi extends Ji{constructor(r,l={}){super("error",_t({error:r},l))}}class Xi{on(r,l){return this._listeners=this._listeners||{},gr(r,l,this._listeners),this}off(r,l){return Jr(r,l,this._listeners),Jr(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},gr(r,l,this._oneTimeListeners),this):new Promise(d=>this.once(r,d))}fire(r,l){typeof r=="string"&&(r=new Ji(r,l||{}));const d=r.type;if(this.listens(d)){r.target=this;const m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const A of m)A.call(this,r);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const A of y)Jr(d,A,this._oneTimeListeners),A.call(this,r);const w=this._eventedParent;w&&(_t(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(r))}else r instanceof Gi&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var Ft=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ao(s,...r){for(const l of r)for(const d in l)s[d]=l[d];return s}function Ki(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function J(s){if(Array.isArray(s))return s.map(J);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const l in s)r[l]=J(s[l]);return r}return Ki(s)}class Y extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var Me=Y;class ct{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[d,m]of l)this.bindings[d]=m}concat(r){return new ct(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Pt=ct;const Ve={kind:"null"},pt={kind:"number"},dt={kind:"string"},ft={kind:"boolean"},Rr={kind:"color"},gi={kind:"object"},q={kind:"value"},fi={kind:"collator"},$i={kind:"formatted"},ji={kind:"resolvedImage"};function Hi(s,r){return{kind:"array",itemType:s,N:r}}function Ai(s){if(s.kind==="array"){const r=Ai(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const z=[Ve,pt,dt,ft,Rr,$i,gi,Hi(q),ji];function ee(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ee(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const l of z)if(!ee(l,r))return null}}return`Expected ${Ai(s)} but found ${Ai(r)} instead.`}function xe(s,r){return r.some(l=>l.kind===s.kind)}function lt(s,r){return r.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}var kt,Et={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function At(s){return(s=Math.round(s))<0?0:s>255?255:s}function Tr(s){return At(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function _r(s){return(r=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function Ur(s,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(r-s)*l*6:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}try{kt={}.parseCSSColor=function(s){var r,l=s.replace(/ /g,"").toLowerCase();if(l in Et)return Et[l].slice();if(l[0]==="#")return l.length===4?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:l.length===7&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var d=l.indexOf("("),m=l.indexOf(")");if(d!==-1&&m+1===l.length){var y=l.substr(0,d),w=l.substr(d+1,m-(d+1)).split(","),A=1;switch(y){case"rgba":if(w.length!==4)return null;A=_r(w.pop());case"rgb":return w.length!==3?null:[Tr(w[0]),Tr(w[1]),Tr(w[2]),A];case"hsla":if(w.length!==4)return null;A=_r(w.pop());case"hsl":if(w.length!==3)return null;var k=(parseFloat(w[0])%360+360)%360/360,P=_r(w[1]),V=_r(w[2]),W=V<=.5?V*(P+1):V+P-V*P,Q=2*V-W;return[At(255*Ur(Q,W,k+1/3)),At(255*Ur(Q,W,k)),At(255*Ur(Q,W,k-1/3)),A];default:return null}}return null}}catch{}class It{constructor(r,l,d,m=1){this.r=r,this.g=l,this.b=d,this.a=m}static parse(r){if(!r)return;if(r instanceof It)return r;if(typeof r!="string")return;const l=kt(r);return l?new It(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,d,m]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(d)},${m})`}toArray(){const{r,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[255*r/m,255*l/m,255*d/m,m]}toArray01(){const{r,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[r/m,l/m,d/m,m]}toArray01PremultipliedAlpha(){const{r,g:l,b:d,a:m}=this;return[r,l,d,m]}}It.black=new It(0,0,0,1),It.white=new It(1,1,1,1),It.transparent=new It(0,0,0,0),It.red=new It(1,0,0,1),It.blue=new It(0,0,1,1);var Ir=It;class Yr{constructor(r,l,d){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hi{constructor(r,l,d,m,y){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=d,this.fontStack=m,this.textColor=y}}class pi{constructor(r){this.sections=r}static fromString(r){return new pi([new hi(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof pi?r:pi.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(d)}return r}}class pn{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new pn({name:r,available:!1}):null}serialize(){return["image",this.name]}}function pr(s,r,l,d){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[s,r,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[s,r,l,d]:[s,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ei(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Ir||s instanceof Yr||s instanceof pi||s instanceof pn)return!0;if(Array.isArray(s)){for(const r of s)if(!ei(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!ei(s[r]))return!1;return!0}return!1}function Oi(s){if(s===null)return Ve;if(typeof s=="string")return dt;if(typeof s=="boolean")return ft;if(typeof s=="number")return pt;if(s instanceof Ir)return Rr;if(s instanceof Yr)return fi;if(s instanceof pi)return $i;if(s instanceof pn)return ji;if(Array.isArray(s)){const r=s.length;let l;for(const d of s){const m=Oi(d);if(l){if(l===m)continue;l=q;break}l=m}return Hi(l||q,r)}return gi}function Ci(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof Ir||s instanceof pi||s instanceof pn?s.toString():JSON.stringify(s)}class vn{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ei(r[1]))return l.error("invalid value");const d=r[1];let m=Oi(d);const y=l.expectedType;return m.kind!=="array"||m.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(m=y),new vn(m,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ir?["rgba"].concat(this.value.toArray()):this.value instanceof pi?this.value.serialize():this.value}}var _i=vn,yr=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const dn={string:dt,number:pt,boolean:ft,object:gi};class an{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let d,m=1;const y=r[0];if(y==="array"){let A,k;if(r.length>2){const P=r[1];if(typeof P!="string"||!(P in dn)||P==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=dn[P],m++}else A=q;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);k=r[2],m++}d=Hi(A,k)}else d=dn[y];const w=[];for(;m<r.length;m++){const A=l.parse(r[m],m,q);if(!A)return null;w.push(A)}return new an(d,w)}evaluate(r){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(r);if(!ee(this.type,Oi(d)))return d;if(l===this.args.length-1)throw new yr(`Expected value to be of type ${Ai(this.type)}, but found ${Ai(Oi(d))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const d=r.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){l.push(d.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(d=>d.serialize()))}}var Zn=an;class Nn{constructor(r){this.type=$i,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const d=r[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const m=[];let y=!1;for(let w=1;w<=r.length-1;++w){const A=r[w];if(y&&typeof A=="object"&&!Array.isArray(A)){y=!1;let k=null;if(A["font-scale"]&&(k=l.parse(A["font-scale"],1,pt),!k))return null;let P=null;if(A["text-font"]&&(P=l.parse(A["text-font"],1,Hi(dt)),!P))return null;let V=null;if(A["text-color"]&&(V=l.parse(A["text-color"],1,Rr),!V))return null;const W=m[m.length-1];W.scale=k,W.font=P,W.textColor=V}else{const k=l.parse(r[w],1,q);if(!k)return null;const P=k.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:k,scale:null,font:null,textColor:null})}}return new Nn(m)}evaluate(r){return new pi(this.sections.map(l=>{const d=l.content.evaluate(r);return Oi(d)===ji?new hi("",d,null,null,null):new hi(Ci(d),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),r.push(d)}return r}}class Da{constructor(r){this.type=ji,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const d=l.parse(r[1],1,dt);return d?new Da(d):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),d=pn.fromString(l);return d&&r.availableImages&&(d.available=r.availableImages.indexOf(l)>-1),d}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ka={"to-boolean":ft,"to-color":Rr,"to-number":pt,"to-string":dt};class eo{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const d=r[0];if((d==="to-boolean"||d==="to-string")&&r.length!==2)return l.error("Expected one argument.");const m=ka[d],y=[];for(let w=1;w<r.length;w++){const A=l.parse(r[w],w,q);if(!A)return null;y.push(A)}return new eo(m,y)}evaluate(r){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(r));if(this.type.kind==="color"){let l,d;for(const m of this.args){if(l=m.evaluate(r),d=null,l instanceof Ir)return l;if(typeof l=="string"){const y=r.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:pr(l[0],l[1],l[2],l[3]),!d))return new Ir(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new yr(d||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const d of this.args){if(l=d.evaluate(r),l===null)return 0;const m=Number(l);if(!isNaN(m))return m}throw new yr(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?pi.fromString(Ci(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?pn.fromString(Ci(this.args[0].evaluate(r))):Ci(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Da(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}var Go=eo;const pa=["Unknown","Point","LineString","Polygon"];var Pa=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-s[0])+this.featureDistanceData.bearing[1]*(d*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Ir.parse(s)),r}};class xa{constructor(r,l,d,m){this.name=r,this.type=l,this._evaluate=d,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const d=r[0],m=xa.definitions[d];if(!m)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,A=w.filter(([P])=>!Array.isArray(P)||P.length===r.length-1);let k=null;for(const[P,V]of A){k=new Ui(l.registry,l.path,null,l.scope);const W=[];let Q=!1;for(let ne=1;ne<r.length;ne++){const he=r[ne],ge=Array.isArray(P)?P[ne-1]:P.type,Ae=k.parse(he,1+W.length,ge);if(!Ae){Q=!0;break}W.push(Ae)}if(!Q)if(Array.isArray(P)&&P.length!==W.length)k.error(`Expected ${P.length} arguments, but found ${W.length} instead.`);else{for(let ne=0;ne<W.length;ne++){const he=Array.isArray(P)?P[ne]:P.type,ge=W[ne];k.concat(ne+1).checkSubtype(he,ge.type)}if(k.errors.length===0)return new xa(d,y,V,W)}}if(A.length===1)l.errors.push(...k.errors);else{const P=(A.length?A:w).map(([W])=>{return Q=W,Array.isArray(Q)?`(${Q.map(Ai).join(", ")})`:`(${Ai(Q.type)}...)`;var Q}).join(" | "),V=[];for(let W=1;W<r.length;W++){const Q=l.parse(r[W],1+V.length);if(!Q)return null;V.push(Ai(Q.type))}l.error(`Expected arguments of type ${P}, but found (${V.join(", ")}) instead.`)}return null}static register(r,l){xa.definitions=l;for(const d in l)r[d]=xa}}var Ro=xa;class Ga{constructor(r,l,d){this.type=fi,this.locale=d,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const d=r[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const m=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,ft);if(!m)return null;const y=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,ft);if(!y)return null;let w=null;return d.locale&&(w=l.parse(d.locale,1,dt),!w)?null:new Ga(m,y,w)}evaluate(r){return new Yr(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Qn=8192;function Cs(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function qo(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function xo(s,r){const l=(180+s[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(l*m*Qn),Math.round(d*m*Qn)]}function sn(s,r,l){const d=s[0]-r[0],m=s[1]-r[1],y=s[0]-l[0],w=s[1]-l[1];return d*w-y*m==0&&d*y<=0&&m*w<=0}function Hn(s,r){let l=!1;for(let w=0,A=r.length;w<A;w++){const k=r[w];for(let P=0,V=k.length;P<V-1;P++){if(sn(s,k[P],k[P+1]))return!1;(m=k[P])[1]>(d=s)[1]!=(y=k[P+1])[1]>d[1]&&d[0]<(y[0]-m[0])*(d[1]-m[1])/(y[1]-m[1])+m[0]&&(l=!l)}}var d,m,y;return l}function ta(s,r){for(let l=0;l<r.length;l++)if(Hn(s,r[l]))return!0;return!1}function Bo(s,r,l,d){const m=d[0]-l[0],y=d[1]-l[1],w=(s[0]-l[0])*y-m*(s[1]-l[1]),A=(r[0]-l[0])*y-m*(r[1]-l[1]);return w>0&&A<0||w<0&&A>0}function ra(s,r,l){for(const P of l)for(let V=0;V<P.length-1;++V)if((A=[(w=P[V+1])[0]-(y=P[V])[0],w[1]-y[1]])[0]*(k=[(m=r)[0]-(d=s)[0],m[1]-d[1]])[1]-A[1]*k[0]!=0&&Bo(d,m,y,w)&&Bo(y,w,d,m))return!0;var d,m,y,w,A,k;return!1}function ma(s,r){for(let l=0;l<s.length;++l)if(!Hn(s[l],r))return!1;for(let l=0;l<s.length-1;++l)if(ra(s[l],s[l+1],r))return!1;return!0}function so(s,r){for(let l=0;l<r.length;l++)if(ma(s,r[l]))return!0;return!1}function ia(s,r,l){const d=[];for(let m=0;m<s.length;m++){const y=[];for(let w=0;w<s[m].length;w++){const A=xo(s[m][w],l);Cs(r,A),y.push(A)}d.push(y)}return d}function Is(s,r,l){const d=[];for(let m=0;m<s.length;m++){const y=ia(s[m],r,l);d.push(y)}return d}function ba(s,r,l,d){if(s[0]<l[0]||s[0]>l[2]){const m=.5*d;let y=s[0]-l[0]>m?-d:l[0]-s[0]>m?d:0;y===0&&(y=s[0]-l[2]>m?-d:l[2]-s[0]>m?d:0),s[0]+=y}Cs(r,s)}function cn(s,r,l,d){const m=Math.pow(2,d.z)*Qn,y=[d.x*Qn,d.y*Qn],w=[];if(!s)return w;for(const A of s)for(const k of A){const P=[k.x+y[0],k.y+y[1]];ba(P,r,l,m),w.push(P)}return w}function Ds(s,r,l,d){const m=Math.pow(2,d.z)*Qn,y=[d.x*Qn,d.y*Qn],w=[];if(!s)return w;for(const k of s){const P=[];for(const V of k){const W=[V.x+y[0],V.y+y[1]];Cs(r,W),P.push(W)}w.push(P)}if(r[2]-r[0]<=m/2){(A=r)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const k of w)for(const P of k)ba(P,r,l,m)}var A;return w}class qa{constructor(r,l){this.type=ft,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ei(r[1])){const d=r[1];if(d.type==="FeatureCollection")for(let m=0;m<d.features.length;++m){const y=d.features[m].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new qa(d,d.features[m].geometry)}else if(d.type==="Feature"){const m=d.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new qa(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new qa(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(l,d){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(d.type==="Polygon"){const A=ia(d.coordinates,y,w),k=cn(l.geometry(),m,y,w);if(!qo(m,y))return!1;for(const P of k)if(!Hn(P,A))return!1}if(d.type==="MultiPolygon"){const A=Is(d.coordinates,y,w),k=cn(l.geometry(),m,y,w);if(!qo(m,y))return!1;for(const P of k)if(!ta(P,A))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(l,d){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(d.type==="Polygon"){const A=ia(d.coordinates,y,w),k=Ds(l.geometry(),m,y,w);if(!qo(m,y))return!1;for(const P of k)if(!ma(P,A))return!1}if(d.type==="MultiPolygon"){const A=Is(d.coordinates,y,w),k=Ds(l.geometry(),m,y,w);if(!qo(m,y))return!1;for(const P of k)if(!so(P,A))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var wa=qa;function Ct(s){if(s instanceof Ro&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof wa)return!1;let r=!0;return s.eachChild(l=>{r&&!Ct(l)&&(r=!1)}),r}function Mo(s){if(s instanceof Ro&&s.name==="feature-state")return!1;let r=!0;return s.eachChild(l=>{r&&!Mo(l)&&(r=!1)}),r}function mo(s,r){if(s instanceof Ro&&r.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(d=>{l&&!mo(d,r)&&(l=!1)}),l}class lo{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=r[1];return l.scope.has(d)?new lo(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xo=lo;class Oo{constructor(r,l=[],d,m=new Pt,y=[]){this.registry=r,this.path=l,this.key=l.map(w=>`[${w}]`).join(""),this.scope=m,this.errors=y,this.expectedType=d}parse(r,l,d,m,y={}){return l?this.concat(l,d,m)._parse(r,y):this._parse(r,y)}_parse(r,l){function d(m,y,w){return w==="assert"?new Zn(y,[m]):w==="coerce"?new Go(y,[m]):m}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[m];if(y){let w=y.parse(r,this);if(!w)return null;if(this.expectedType){const A=this.expectedType,k=w.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||k.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(A,k))return null}else w=d(w,A,l.typeAnnotation||"coerce");else w=d(w,A,l.typeAnnotation||"assert")}if(!(w instanceof _i)&&w.type.kind!=="resolvedImage"&&na(w)){const A=new Pa;try{w=new _i(w.type,w.evaluate(A))}catch(k){return this.error(k.message),null}}return w}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,d){const m=typeof r=="number"?this.path.concat(r):this.path,y=d?this.scope.concat(d):this.scope;return new Oo(this.registry,m,l||null,y,this.errors)}error(r,...l){const d=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new Me(d,r))}checkSubtype(r,l){const d=ee(r,l);return d&&this.error(d),d}}var Ui=Oo;function na(s){if(s instanceof Xo)return na(s.boundExpression);if(s instanceof Ro&&s.name==="error"||s instanceof Ga||s instanceof wa)return!1;const r=s instanceof Go||s instanceof Zn;let l=!0;return s.eachChild(d=>{l=r?l&&na(d):l&&d instanceof _i}),!!l&&Ct(s)&&mo(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function go(s,r){const l=s.length-1;let d,m,y=0,w=l,A=0;for(;y<=w;)if(A=Math.floor((y+w)/2),d=s[A],m=s[A+1],d<=r){if(A===l||r<m)return A;y=A+1}else{if(!(d>r))throw new yr("Input is not a number.");w=A-1}return 0}class ga{constructor(r,l,d){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[m,y]of d)this.labels.push(m),this.outputs.push(y)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(r[1],1,pt);if(!d)return null;const m=[];let y=null;l.expectedType&&l.expectedType.kind!=="value"&&(y=l.expectedType);for(let w=1;w<r.length;w+=2){const A=w===1?-1/0:r[w],k=r[w+1],P=w,V=w+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const W=l.parse(k,V,y);if(!W)return null;y=y||W.type,m.push([A,W])}return new ga(y,d,m)}evaluate(r){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(r);const m=this.input.evaluate(r);if(m<=l[0])return d[0].evaluate(r);const y=l.length;return m>=l[y-1]?d[y-1].evaluate(r):d[go(l,m)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var Zo=ga;function en(s,r,l){return s*(1-l)+r*l}var Ni=Object.freeze({__proto__:null,number:en,color:function(s,r,l){return new Ir(en(s.r,r.r,l),en(s.g,r.g,l),en(s.b,r.b,l),en(s.a,r.a,l))},array:function(s,r,l){return s.map((d,m)=>en(d,r[m],l))}});const cs=.95047,Fi=1.08883,Ln=4/29,ie=6/29,Ri=3*ie*ie,Fo=Math.PI/180,Vn=180/Math.PI;function Ho(s){return s>.008856451679035631?Math.pow(s,1/3):s/Ri+Ln}function Xa(s){return s>ie?s*s*s:Ri*(s-Ln)}function us(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function La(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ra(s){const r=La(s.r),l=La(s.g),d=La(s.b),m=Ho((.4124564*r+.3575761*l+.1804375*d)/cs),y=Ho((.2126729*r+.7151522*l+.072175*d)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-Ho((.0193339*r+.119192*l+.9503041*d)/Fi)),alpha:s.a}}function Za(s){let r=(s.l+16)/116,l=isNaN(s.a)?r:r+s.a/500,d=isNaN(s.b)?r:r-s.b/200;return r=1*Xa(r),l=cs*Xa(l),d=Fi*Xa(d),new Ir(us(3.2404542*l-1.5371385*r-.4985314*d),us(-.969266*l+1.8760108*r+.041556*d),us(.0556434*l-.2040259*r+1.0572252*d),s.alpha)}function Ha(s,r,l){const d=r-s;return s+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const Wa={forward:Ra,reverse:Za,interpolate:function(s,r,l){return{l:en(s.l,r.l,l),a:en(s.a,r.a,l),b:en(s.b,r.b,l),alpha:en(s.alpha,r.alpha,l)}}},Ao={forward:function(s){const{l:r,a:l,b:d}=Ra(s),m=Math.atan2(d,l)*Vn;return{h:m<0?m+360:m,c:Math.sqrt(l*l+d*d),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Fo,l=s.c;return Za({l:s.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:s.alpha})},interpolate:function(s,r,l){return{h:Ha(s.h,r.h,l),c:en(s.c,r.c,l),l:en(s.l,r.l,l),alpha:en(s.alpha,r.alpha,l)}}};var Ya=Object.freeze({__proto__:null,lab:Wa,hcl:Ao});class hs{constructor(r,l,d,m,y){this.type=r,this.operator=l,this.interpolation=d,this.input=m,this.labels=[],this.outputs=[];for(const[w,A]of y)this.labels.push(w),this.outputs.push(A)}static interpolationFactor(r,l,d,m){let y=0;if(r.name==="exponential")y=Tt(l,r.base,d,m);else if(r.name==="linear")y=Tt(l,1,d,m);else if(r.name==="cubic-bezier"){const w=r.controlPoints;y=new oe(w[0],w[1],w[2],w[3]).solve(Tt(l,1,d,m))}return y}static parse(r,l){let[d,m,y,...w]=r;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const P=m[1];if(typeof P!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(P.length!==4||P.some(V=>typeof V!="number"||V<0||V>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,pt),!y)return null;const A=[];let k=null;d==="interpolate-hcl"||d==="interpolate-lab"?k=Rr:l.expectedType&&l.expectedType.kind!=="value"&&(k=l.expectedType);for(let P=0;P<w.length;P+=2){const V=w[P],W=w[P+1],Q=P+3,ne=P+4;if(typeof V!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(A.length&&A[A.length-1][0]>=V)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Q);const he=l.parse(W,ne,k);if(!he)return null;k=k||he.type,A.push([V,he])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new hs(k,d,m,y,A):l.error(`Type ${Ai(k)} is not interpolatable.`)}evaluate(r){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(r);const m=this.input.evaluate(r);if(m<=l[0])return d[0].evaluate(r);const y=l.length;if(m>=l[y-1])return d[y-1].evaluate(r);const w=go(l,m),A=hs.interpolationFactor(this.interpolation,m,l[w],l[w+1]),k=d[w].evaluate(r),P=d[w+1].evaluate(r);return this.operator==="interpolate"?Ni[this.type.kind.toLowerCase()](k,P,A):this.operator==="interpolate-hcl"?Ao.reverse(Ao.interpolate(Ao.forward(k),Ao.forward(P),A)):Wa.reverse(Wa.interpolate(Wa.forward(k),Wa.forward(P),A))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function Tt(s,r,l,d){const m=d-l,y=s-l;return m===0?0:r===1?y/m:(Math.pow(r,y)-1)/(Math.pow(r,m)-1)}var Wt=hs;class qr{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let d=null;const m=l.expectedType;m&&m.kind!=="value"&&(d=m);const y=[];for(const A of r.slice(1)){const k=l.parse(A,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!k)return null;d=d||k.type,y.push(k)}const w=m&&y.some(A=>ee(m,A.type));return new qr(w?q:d,y)}evaluate(r){let l,d=null,m=0;for(const y of this.args){if(m++,d=y.evaluate(r),d&&d instanceof pn&&!d.available&&(l||(l=d),d=null,m===this.args.length))return l;if(d!==null)break}return d}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}var Si=qr;class fn{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const d=[];for(let y=1;y<r.length-1;y+=2){const w=r[y];if(typeof w!="string")return l.error(`Expected string, but found ${typeof w} instead.`,y);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);const A=l.parse(r[y+1],y+1);if(!A)return null;d.push([w,A])}const m=l.parse(r[r.length-1],r.length-1,l.expectedType,d);return m?new fn(d,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,d]of this.bindings)r.push(l,d.serialize());return r.push(this.result.serialize()),r}}var tn=fn;class Rn{constructor(r,l,d){this.type=r,this.index=l,this.input=d}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,pt),m=l.parse(r[2],2,Hi(l.expectedType||q));return d&&m?new Rn(m.type.itemType,d,m):null}evaluate(r){const l=this.index.evaluate(r),d=this.input.evaluate(r);if(l<0)throw new yr(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new yr(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new yr(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var qn=Rn;class bo{constructor(r,l){this.type=ft,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,q),m=l.parse(r[2],2,q);return d&&m?xe(d.type,[ft,dt,pt,Ve,q])?new bo(d,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(d.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(d==null)return!1;if(!lt(l,["boolean","string","number","null"]))throw new yr(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(Oi(l))} instead.`);if(!lt(d,["string","array"]))throw new yr(`Expected second argument to be of type array or string, but found ${Ai(Oi(d))} instead.`);return d.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Wn=bo;class Bn{constructor(r,l,d){this.type=pt,this.needle=r,this.haystack=l,this.fromIndex=d}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,q),m=l.parse(r[2],2,q);if(!d||!m)return null;if(!xe(d.type,[ft,dt,pt,Ve,q]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(d.type)} instead`);if(r.length===4){const y=l.parse(r[3],3,pt);return y?new Bn(d,m,y):null}return new Bn(d,m)}evaluate(r){const l=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!lt(l,["boolean","string","number","null"]))throw new yr(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(Oi(l))} instead.`);if(!lt(d,["string","array"]))throw new yr(`Expected second argument to be of type array or string, but found ${Ai(Oi(d))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return d.indexOf(l,m)}return d.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var oa=Bn;class zo{constructor(r,l,d,m,y,w){this.inputType=r,this.type=l,this.input=d,this.cases=m,this.outputs=y,this.otherwise=w}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let d,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);const y={},w=[];for(let P=2;P<r.length-1;P+=2){let V=r[P];const W=r[P+1];Array.isArray(V)||(V=[V]);const Q=l.concat(P);if(V.length===0)return Q.error("Expected at least one branch label.");for(const he of V){if(typeof he!="number"&&typeof he!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return Q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof he=="number"&&Math.floor(he)!==he)return Q.error("Numeric branch labels must be integer values.");if(d){if(Q.checkSubtype(d,Oi(he)))return null}else d=Oi(he);if(y[String(he)]!==void 0)return Q.error("Branch labels must be unique.");y[String(he)]=w.length}const ne=l.parse(W,P,m);if(!ne)return null;m=m||ne.type,w.push(ne)}const A=l.parse(r[1],1,q);if(!A)return null;const k=l.parse(r[r.length-1],r.length-1,m);return k?A.type.kind!=="value"&&l.concat(1).checkSubtype(d,A.type)?null:new zo(d,m,A,y,w,k):null}evaluate(r){const l=this.input.evaluate(r);return(Oi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],m={};for(const w of l){const A=m[this.cases[w]];A===void 0?(m[this.cases[w]]=d.length,d.push([this.cases[w],[w]])):d[A][1].push(w)}const y=w=>this.inputType.kind==="number"?Number(w):w;for(const[w,A]of d)r.push(A.length===1?y(A[0]):A.map(y)),r.push(this.outputs[w].serialize());return r.push(this.otherwise.serialize()),r}}var co=zo;class wo{constructor(r,l,d){this.type=r,this.branches=l,this.otherwise=d}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const m=[];for(let w=1;w<r.length-1;w+=2){const A=l.parse(r[w],w,ft);if(!A)return null;const k=l.parse(r[w+1],w+1,d);if(!k)return null;m.push([A,k]),d=d||k.type}const y=l.parse(r[r.length-1],r.length-1,d);return y?new wo(d,m,y):null}evaluate(r){for(const[l,d]of this.branches)if(l.evaluate(r))return d.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,d]of this.branches)r(l),r(d);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}var Ea=wo;class Ze{constructor(r,l,d,m){this.type=r,this.input=l,this.beginIndex=d,this.endIndex=m}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,q),m=l.parse(r[2],2,pt);if(!d||!m)return null;if(!xe(d.type,[Hi(q),dt,q]))return l.error(`Expected first argument to be of type array or string, but found ${Ai(d.type)} instead`);if(r.length===4){const y=l.parse(r[3],3,pt);return y?new Ze(d.type,d,m,y):null}return new Ze(d.type,d,m)}evaluate(r){const l=this.input.evaluate(r),d=this.beginIndex.evaluate(r);if(!lt(l,["string","array"]))throw new yr(`Expected first argument to be of type array or string, but found ${Ai(Oi(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return l.slice(d,m)}return l.slice(d)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var He=Ze;function We(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function ds(s,r,l,d){return d.compare(r,l)===0}function aa(s,r,l){const d=s!=="=="&&s!=="!=";return class Fp{constructor(y,w,A){this.type=ft,this.lhs=y,this.rhs=w,this.collator=A,this.hasUntypedArgument=y.type.kind==="value"||w.type.kind==="value"}static parse(y,w){if(y.length!==3&&y.length!==4)return w.error("Expected two or three arguments.");const A=y[0];let k=w.parse(y[1],1,q);if(!k)return null;if(!We(A,k.type))return w.concat(1).error(`"${A}" comparisons are not supported for type '${Ai(k.type)}'.`);let P=w.parse(y[2],2,q);if(!P)return null;if(!We(A,P.type))return w.concat(2).error(`"${A}" comparisons are not supported for type '${Ai(P.type)}'.`);if(k.type.kind!==P.type.kind&&k.type.kind!=="value"&&P.type.kind!=="value")return w.error(`Cannot compare types '${Ai(k.type)}' and '${Ai(P.type)}'.`);d&&(k.type.kind==="value"&&P.type.kind!=="value"?k=new Zn(P.type,[k]):k.type.kind!=="value"&&P.type.kind==="value"&&(P=new Zn(k.type,[P])));let V=null;if(y.length===4){if(k.type.kind!=="string"&&P.type.kind!=="string"&&k.type.kind!=="value"&&P.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(V=w.parse(y[3],3,fi),!V)return null}return new Fp(k,P,V)}evaluate(y){const w=this.lhs.evaluate(y),A=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const k=Oi(w),P=Oi(A);if(k.kind!==P.kind||k.kind!=="string"&&k.kind!=="number")throw new yr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${k.kind}, ${P.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const k=Oi(w),P=Oi(A);if(k.kind!=="string"||P.kind!=="string")return r(y,w,A)}return this.collator?l(y,w,A,this.collator.evaluate(y)):r(y,w,A)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[s];return this.eachChild(w=>{y.push(w.serialize())}),y}}}const Xs=aa("==",function(s,r,l){return r===l},ds),wn=aa("!=",function(s,r,l){return r!==l},function(s,r,l,d){return!ds(0,r,l,d)}),gn=aa("<",function(s,r,l){return r<l},function(s,r,l,d){return d.compare(r,l)<0}),fs=aa(">",function(s,r,l){return r>l},function(s,r,l,d){return d.compare(r,l)>0}),_a=aa("<=",function(s,r,l){return r<=l},function(s,r,l,d){return d.compare(r,l)<=0}),ks=aa(">=",function(s,r,l){return r>=l},function(s,r,l,d){return d.compare(r,l)>=0});class Eo{constructor(r,l,d,m,y,w){this.type=dt,this.number=r,this.locale=l,this.currency=d,this.unit=m,this.minFractionDigits=y,this.maxFractionDigits=w}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const d=l.parse(r[1],1,pt);if(!d)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=l.parse(m.locale,1,dt),!y))return null;let w=null;if(m.currency&&(w=l.parse(m.currency,1,dt),!w))return null;let A=null;if(m.unit&&(A=l.parse(m.unit,1,dt),!A))return null;let k=null;if(m["min-fraction-digits"]&&(k=l.parse(m["min-fraction-digits"],1,pt),!k))return null;let P=null;return m["max-fraction-digits"]&&(P=l.parse(m["max-fraction-digits"],1,pt),!P)?null:new Eo(d,y,w,A,k,P)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class No{constructor(r){this.type=pt,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const d=l.parse(r[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Ai(d.type)} instead.`):new No(d):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new yr(`Expected value to be of type string or array, but found ${Ai(Oi(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const sa={"==":Xs,"!=":wn,">":fs,"<":gn,">=":ks,"<=":_a,array:Zn,at:qn,boolean:Zn,case:Ea,coalesce:Si,collator:Ga,format:Nn,image:Da,in:Wn,"index-of":oa,interpolate:Wt,"interpolate-hcl":Wt,"interpolate-lab":Wt,length:No,let:tn,literal:_i,match:co,number:Zn,"number-format":Eo,object:Zn,slice:He,step:Zo,string:Zn,"to-boolean":Go,"to-color":Go,"to-number":Go,"to-string":Go,var:Xo,within:wa};function Ba(s,[r,l,d,m]){r=r.evaluate(s),l=l.evaluate(s),d=d.evaluate(s);const y=m?m.evaluate(s):1,w=pr(r,l,d,y);if(w)throw new yr(w);return new Ir(r/255*y,l/255*y,d/255*y,y)}function Oa(s,r){return s in r}function la(s,r){const l=r[s];return l===void 0?null:l}function to(s){return{type:s}}Ro.register(sa,{error:[{kind:"error"},[dt],(s,[r])=>{throw new yr(r.evaluate(s))}],typeof:[dt,[q],(s,[r])=>Ai(Oi(r.evaluate(s)))],"to-rgba":[Hi(pt,4),[Rr],(s,[r])=>r.evaluate(s).toArray()],rgb:[Rr,[pt,pt,pt],Ba],rgba:[Rr,[pt,pt,pt,pt],Ba],has:{type:ft,overloads:[[[dt],(s,[r])=>Oa(r.evaluate(s),s.properties())],[[dt,gi],(s,[r,l])=>Oa(r.evaluate(s),l.evaluate(s))]]},get:{type:q,overloads:[[[dt],(s,[r])=>la(r.evaluate(s),s.properties())],[[dt,gi],(s,[r,l])=>la(r.evaluate(s),l.evaluate(s))]]},"feature-state":[q,[dt],(s,[r])=>la(r.evaluate(s),s.featureState||{})],properties:[gi,[],s=>s.properties()],"geometry-type":[dt,[],s=>s.geometryType()],id:[q,[],s=>s.id()],zoom:[pt,[],s=>s.globals.zoom],pitch:[pt,[],s=>s.globals.pitch||0],"distance-from-center":[pt,[],s=>s.distanceFromCenter()],"heatmap-density":[pt,[],s=>s.globals.heatmapDensity||0],"line-progress":[pt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[pt,[],s=>s.globals.skyRadialProgress||0],accumulated:[q,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[pt,to(pt),(s,r)=>{let l=0;for(const d of r)l+=d.evaluate(s);return l}],"*":[pt,to(pt),(s,r)=>{let l=1;for(const d of r)l*=d.evaluate(s);return l}],"-":{type:pt,overloads:[[[pt,pt],(s,[r,l])=>r.evaluate(s)-l.evaluate(s)],[[pt],(s,[r])=>-r.evaluate(s)]]},"/":[pt,[pt,pt],(s,[r,l])=>r.evaluate(s)/l.evaluate(s)],"%":[pt,[pt,pt],(s,[r,l])=>r.evaluate(s)%l.evaluate(s)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(s,[r,l])=>Math.pow(r.evaluate(s),l.evaluate(s))],sqrt:[pt,[pt],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[pt,[pt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[pt,[pt],(s,[r])=>Math.log(r.evaluate(s))],log2:[pt,[pt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[pt,[pt],(s,[r])=>Math.sin(r.evaluate(s))],cos:[pt,[pt],(s,[r])=>Math.cos(r.evaluate(s))],tan:[pt,[pt],(s,[r])=>Math.tan(r.evaluate(s))],asin:[pt,[pt],(s,[r])=>Math.asin(r.evaluate(s))],acos:[pt,[pt],(s,[r])=>Math.acos(r.evaluate(s))],atan:[pt,[pt],(s,[r])=>Math.atan(r.evaluate(s))],min:[pt,to(pt),(s,r)=>Math.min(...r.map(l=>l.evaluate(s)))],max:[pt,to(pt),(s,r)=>Math.max(...r.map(l=>l.evaluate(s)))],abs:[pt,[pt],(s,[r])=>Math.abs(r.evaluate(s))],round:[pt,[pt],(s,[r])=>{const l=r.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[pt,[pt],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[pt,[pt],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[ft,[dt,q],(s,[r,l])=>s.properties()[r.value]===l.value],"filter-id-==":[ft,[q],(s,[r])=>s.id()===r.value],"filter-type-==":[ft,[dt],(s,[r])=>s.geometryType()===r.value],"filter-<":[ft,[dt,q],(s,[r,l])=>{const d=s.properties()[r.value],m=l.value;return typeof d==typeof m&&d<m}],"filter-id-<":[ft,[q],(s,[r])=>{const l=s.id(),d=r.value;return typeof l==typeof d&&l<d}],"filter->":[ft,[dt,q],(s,[r,l])=>{const d=s.properties()[r.value],m=l.value;return typeof d==typeof m&&d>m}],"filter-id->":[ft,[q],(s,[r])=>{const l=s.id(),d=r.value;return typeof l==typeof d&&l>d}],"filter-<=":[ft,[dt,q],(s,[r,l])=>{const d=s.properties()[r.value],m=l.value;return typeof d==typeof m&&d<=m}],"filter-id-<=":[ft,[q],(s,[r])=>{const l=s.id(),d=r.value;return typeof l==typeof d&&l<=d}],"filter->=":[ft,[dt,q],(s,[r,l])=>{const d=s.properties()[r.value],m=l.value;return typeof d==typeof m&&d>=m}],"filter-id->=":[ft,[q],(s,[r])=>{const l=s.id(),d=r.value;return typeof l==typeof d&&l>=d}],"filter-has":[ft,[q],(s,[r])=>r.value in s.properties()],"filter-has-id":[ft,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ft,[Hi(dt)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[ft,[Hi(q)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[ft,[dt,Hi(q)],(s,[r,l])=>l.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[ft,[dt,Hi(q)],(s,[r,l])=>function(d,m,y,w){for(;y<=w;){const A=y+w>>1;if(m[A]===d)return!0;m[A]>d?w=A-1:y=A+1}return!1}(s.properties()[r.value],l.value,0,l.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(s,[r,l])=>r.evaluate(s)&&l.evaluate(s)],[to(ft),(s,r)=>{for(const l of r)if(!l.evaluate(s))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(s,[r,l])=>r.evaluate(s)||l.evaluate(s)],[to(ft),(s,r)=>{for(const l of r)if(l.evaluate(s))return!0;return!1}]]},"!":[ft,[ft],(s,[r])=>!r.evaluate(s)],"is-supported-script":[ft,[dt],(s,[r])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(r.evaluate(s))}],upcase:[dt,[dt],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[dt,[dt],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[dt,to(q),(s,r)=>r.map(l=>Ci(l.evaluate(s))).join("")],"resolved-locale":[dt,[fi],(s,[r])=>r.evaluate(s).resolvedLocale()]});var Fa=sa;function Ka(s){return{result:"success",value:s}}function _o(s){return{result:"error",value:s}}function Wo(s){return s["property-type"]==="data-driven"}function Yo(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ps(s){return!!s.expression&&s.expression.interpolated}function rn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function ya(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function oc(s){return s}function Zs(s,r){const l=r.type==="color",d=s.stops&&typeof s.stops[0][0]=="object",m=d||!(d||s.property!==void 0),y=s.type||(ps(r)?"exponential":"interval");if(l&&((s=ao({},s)).stops&&(s.stops=s.stops.map(P=>[P[0],Ir.parse(P[1])])),s.default=Ir.parse(s.default?s.default:r.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!Ya[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let w,A,k;if(y==="exponential")w=hl;else if(y==="interval")w=kl;else if(y==="categorical"){w=ul,A=Object.create(null);for(const P of s.stops)A[P[0]]=P[1];k=typeof s.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);w=dl}if(d){const P={},V=[];for(let ne=0;ne<s.stops.length;ne++){const he=s.stops[ne],ge=he[0].zoom;P[ge]===void 0&&(P[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},V.push(ge)),P[ge].stops.push([he[0].value,he[1]])}const W=[];for(const ne of V)W.push([P[ne].zoom,Zs(P[ne],r)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:Wt.interpolationFactor.bind(void 0,Q),zoomStops:W.map(ne=>ne[0]),evaluate:({zoom:ne},he)=>hl({stops:W,base:s.base},r,ne).evaluate(ne,he)}}if(m){const P=y==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Wt.interpolationFactor.bind(void 0,P),zoomStops:s.stops.map(V=>V[0]),evaluate:({zoom:V})=>w(s,r,V,A,k)}}return{kind:"source",evaluate(P,V){const W=V&&V.properties?V.properties[s.property]:void 0;return W===void 0?ms(s.default,r.default):w(s,r,W,A,k)}}}function ms(s,r,l){return s!==void 0?s:r!==void 0?r:l!==void 0?l:void 0}function ul(s,r,l,d,m){return ms(typeof l===m?d[l]:void 0,s.default,r.default)}function kl(s,r,l){if(rn(l)!=="number")return ms(s.default,r.default);const d=s.stops.length;if(d===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[d-1][0])return s.stops[d-1][1];const m=go(s.stops.map(y=>y[0]),l);return s.stops[m][1]}function hl(s,r,l){const d=s.base!==void 0?s.base:1;if(rn(l)!=="number")return ms(s.default,r.default);const m=s.stops.length;if(m===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[m-1][0])return s.stops[m-1][1];const y=go(s.stops.map(V=>V[0]),l),w=function(V,W,Q,ne){const he=ne-Q,ge=V-Q;return he===0?0:W===1?ge/he:(Math.pow(W,ge)-1)/(Math.pow(W,he)-1)}(l,d,s.stops[y][0],s.stops[y+1][0]),A=s.stops[y][1],k=s.stops[y+1][1];let P=Ni[r.type]||oc;if(s.colorSpace&&s.colorSpace!=="rgb"){const V=Ya[s.colorSpace];P=(W,Q)=>V.reverse(V.interpolate(V.forward(W),V.forward(Q),w))}return typeof A.evaluate=="function"?{evaluate(...V){const W=A.evaluate.apply(void 0,V),Q=k.evaluate.apply(void 0,V);if(W!==void 0&&Q!==void 0)return P(W,Q,w)}}:P(A,k,w)}function dl(s,r,l){return r.type==="color"?l=Ir.parse(l):r.type==="formatted"?l=pi.fromString(l.toString()):r.type==="resolvedImage"?l=pn.fromString(l.toString()):rn(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),ms(l,s.default,r.default)}class Hs{constructor(r,l){this.expression=r,this._warningHistory={},this._evaluator=new Pa,this._defaultValue=l?function(d){return d.type==="color"&&(ya(d.default)||Array.isArray(d.default))?new Ir(0,0,0,0):d.type==="color"?Ir.parse(d.default)||null:d.default===void 0?null:d.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,d,m,y,w,A,k){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=k||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,d,m,y,w,A,k){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=k||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new yr(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function Ps(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Fa}function za(s,r){const l=new Ui(Fa,[],r?function(m){const y={color:Rr,string:dt,number:pt,enum:dt,boolean:ft,formatted:$i,resolvedImage:ji};return m.type==="array"?Hi(y[m.value]||q,m.length):y[m.type]}(r):void 0),d=l.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Ka(new Hs(d,r)):_o(l.errors)}class Na{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!Mo(l.expression)}evaluateWithoutErrorHandling(r,l,d,m,y,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,d,m,y,w)}evaluate(r,l,d,m,y,w){return this._styleExpression.evaluate(r,l,d,m,y,w)}}class Ws{constructor(r,l,d,m){this.kind=r,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!Mo(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,l,d,m,y,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,d,m,y,w)}evaluate(r,l,d,m,y,w){return this._styleExpression.evaluate(r,l,d,m,y,w)}interpolationFactor(r,l,d){return this.interpolationType?Wt.interpolationFactor(this.interpolationType,r,l,d):0}}function fl(s,r){if((s=za(s,r)).result==="error")return s;const l=s.value.expression,d=Ct(l);if(!d&&!Wo(r))return _o([new Me("","data expressions not supported")]);const m=mo(l,["zoom","pitch","distance-from-center"]);if(!m&&!Yo(r))return _o([new Me("","zoom expressions not supported")]);const y=Ls(l);return y||m?y instanceof Me?_o([y]):y instanceof Wt&&!ps(r)?_o([new Me("",'"interpolate" expressions cannot be used with this property')]):Ka(y?new Ws(d?"camera":"composite",s.value,y.labels,y instanceof Wt?y.interpolation:void 0):new Na(d?"constant":"source",s.value)):_o([new Me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class gs{constructor(r,l){this._parameters=r,this._specification=l,ao(this,Zs(this._parameters,this._specification))}static deserialize(r){return new gs(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Ls(s){let r=null;if(s instanceof tn)r=Ls(s.result);else if(s instanceof Si){for(const l of s.args)if(r=Ls(l),r)break}else(s instanceof Zo||s instanceof Wt)&&s.input instanceof Ro&&s.input.name==="zoom"&&(r=s);return r instanceof Me||s.eachChild(l=>{const d=Ls(l);d instanceof Me?r=d:!r&&d?r=new Me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&d&&r!==d&&(r=new Me("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Hr{constructor(r,l,d,m){this.message=(r?`${r}: `:"")+d,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function Ko(s){const r=s.key,l=s.value,d=s.valueSpec||{},m=s.objectElementValidators||{},y=s.style,w=s.styleSpec;let A=[];const k=rn(l);if(k!=="object")return[new Hr(r,l,`object expected, ${k} found`)];for(const P in l){const V=P.split(".")[0],W=d[V]||d["*"];let Q;m[V]?Q=m[V]:d[V]?Q=To:m["*"]?Q=m["*"]:d["*"]&&(Q=To),Q?A=A.concat(Q({key:(r&&`${r}.`)+P,value:l[P],valueSpec:W,style:y,styleSpec:w,object:l,objectKey:P},l)):A.push(new Hr(r,l[P],`unknown property "${P}"`))}for(const P in d)m[P]||d[P].required&&d[P].default===void 0&&l[P]===void 0&&A.push(new Hr(r,l,`missing required property "${P}"`));return A}function Rs(s){const r=s.value,l=s.valueSpec,d=s.style,m=s.styleSpec,y=s.key,w=s.arrayElementValidator||To;if(rn(r)!=="array")return[new Hr(y,r,`array expected, ${rn(r)} found`)];if(l.length&&r.length!==l.length)return[new Hr(y,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new Hr(y,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};m.$version<7&&(A.function=l.function),rn(l.value)==="object"&&(A=l.value);let k=[];for(let P=0;P<r.length;P++)k=k.concat(w({array:r,arrayIndex:P,value:r[P],valueSpec:A,style:d,styleSpec:m,key:`${y}[${P}]`}));return k}function Pl(s){const r=s.key,l=s.value,d=s.valueSpec;let m=rn(l);if(m==="number"&&l!=l&&(m="NaN"),m!=="number")return[new Hr(r,l,`number expected, ${m} found`)];if("minimum"in d){let y=d.minimum;if(rn(d.minimum)==="array"&&(y=d.minimum[s.arrayIndex]),l<y)return[new Hr(r,l,`${l} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(rn(d.maximum)==="array"&&(y=d.maximum[s.arrayIndex]),l>y)return[new Hr(r,l,`${l} is greater than the maximum value ${y}`)]}return[]}function Ll(s){const r=s.valueSpec,l=Ki(s.value.type);let d,m,y,w={};const A=l!=="categorical"&&s.value.property===void 0,k=!A,P=rn(s.value.stops)==="array"&&rn(s.value.stops[0])==="array"&&rn(s.value.stops[0][0])==="object",V=Ko({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(ne){if(l==="identity")return[new Hr(ne.key,ne.value,'identity function may not have a "stops" property')];let he=[];const ge=ne.value;return he=he.concat(Rs({key:ne.key,value:ge,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:W})),rn(ge)==="array"&&ge.length===0&&he.push(new Hr(ne.key,ge,"array must have at least one stop")),he},default:function(ne){return To({key:ne.key,value:ne.value,valueSpec:r,style:ne.style,styleSpec:ne.styleSpec})}}});return l==="identity"&&A&&V.push(new Hr(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||V.push(new Hr(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!ps(s.valueSpec)&&V.push(new Hr(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(k&&!Wo(s.valueSpec)?V.push(new Hr(s.key,s.value,"property functions not supported")):A&&!Yo(s.valueSpec)&&V.push(new Hr(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!P||s.value.property!==void 0||V.push(new Hr(s.key,s.value,'"property" property is required')),V;function W(ne){let he=[];const ge=ne.value,Ae=ne.key;if(rn(ge)!=="array")return[new Hr(Ae,ge,`array expected, ${rn(ge)} found`)];if(ge.length!==2)return[new Hr(Ae,ge,`array length 2 expected, length ${ge.length} found`)];if(P){if(rn(ge[0])!=="object")return[new Hr(Ae,ge,`object expected, ${rn(ge[0])} found`)];if(ge[0].zoom===void 0)return[new Hr(Ae,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new Hr(Ae,ge,"object stop key must have value")];const je=Ki(ge[0].zoom);if(typeof je!="number")return[new Hr(Ae,ge[0].zoom,"stop zoom values must be numbers")];if(y&&y>je)return[new Hr(Ae,ge[0].zoom,"stop zoom values must appear in ascending order")];je!==y&&(y=je,m=void 0,w={}),he=he.concat(Ko({key:`${Ae}[0]`,value:ge[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:Pl,value:Q}}))}else he=he.concat(Q({key:`${Ae}[0]`,value:ge[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},ge));return Ps(J(ge[1]))?he.concat([new Hr(`${Ae}[1]`,ge[1],"expressions are not allowed in function stops.")]):he.concat(To({key:`${Ae}[1]`,value:ge[1],valueSpec:r,style:ne.style,styleSpec:ne.styleSpec}))}function Q(ne,he){const ge=rn(ne.value),Ae=Ki(ne.value),je=ne.value!==null?ne.value:he;if(d){if(ge!==d)return[new Hr(ne.key,je,`${ge} stop domain type must match previous stop domain type ${d}`)]}else d=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean"&&typeof Ae!="number"&&typeof Ae!="string"&&typeof Ae!="boolean")return[new Hr(ne.key,je,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&l!=="categorical"){let Qe=`number expected, ${ge} found`;return Wo(r)&&l===void 0&&(Qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Hr(ne.key,je,Qe)]}return l!=="categorical"||ge!=="number"||typeof Ae=="number"&&isFinite(Ae)&&Math.floor(Ae)===Ae?l!=="categorical"&&ge==="number"&&typeof Ae=="number"&&typeof m=="number"&&m!==void 0&&Ae<m?[new Hr(ne.key,je,"stop domain values must appear in ascending order")]:(m=Ae,l==="categorical"&&Ae in w?[new Hr(ne.key,je,"stop domain values must be unique")]:(w[Ae]=!0,[])):[new Hr(ne.key,je,`integer expected, found ${String(Ae)}`)]}}function _s(s){const r=(s.expressionContext==="property"?fl:za)(J(s.value),s.valueSpec);if(r.result==="error")return r.value.map(d=>new Hr(`${s.key}${d.key}`,s.value,d.message));const l=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new Hr(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Mo(l))return[new Hr(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Rl(l,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!mo(l,["zoom","feature-state"]))return[new Hr(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ct(l))return[new Hr(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Rl(s,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const m of r.valueSpec.expression.parameters)l.delete(m);if(l.size===0)return[];const d=[];return s instanceof Ro&&l.has(s.name)?[new Hr(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(m=>{d.push(...Rl(m,r))}),d)}function Ys(s){const r=s.key,l=s.value,d=s.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(Ki(l))===-1&&m.push(new Hr(r,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(Ki(l))===-1&&m.push(new Hr(r,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),m}function ys(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!ys(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Qa(s,r="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ys(s)||(s=xs(s));const l=s;let d=!0;try{d=function(P){if(!vs(P))return P;let V=J(P);return Bs(V),V=Co(V),V}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const m=Ft[`filter_${r}`],y=za(d,m);let w=null;if(y.result==="error")throw new Error(y.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,V,W)=>y.value.evaluate(P,V,{},W);let A=null,k=null;if(d!==l){const P=za(l,m);if(P.result==="error")throw new Error(P.value.map(V=>`${V.key}: ${V.message}`).join(", "));A=(V,W,Q,ne,he)=>P.value.evaluate(V,W,{},Q,void 0,void 0,ne,he),k=!Ct(P.value.expression)}return{filter:w,dynamicFilter:A||void 0,needGeometry:Bl(d),needFeature:!!k}}function Co(s){if(!Array.isArray(s))return s;const r=function(l){if(ac.has(l[0])){for(let d=1;d<l.length;d++)if(vs(l[d]))return!0}return l}(s);return r===!0?r:r.map(l=>Co(l))}function Bs(s){let r=!1;const l=[];if(s[0]==="case"){for(let d=1;d<s.length-1;d+=2)r=r||vs(s[d]),l.push(s[d+1]);l.push(s[s.length-1])}else if(s[0]==="match"){r=r||vs(s[1]);for(let d=2;d<s.length-1;d+=2)l.push(s[d+1]);l.push(s[s.length-1])}else if(s[0]==="step"){r=r||vs(s[1]);for(let d=1;d<s.length-1;d+=2)l.push(s[d+1])}r&&(s.length=0,s.push("any",...l));for(let d=1;d<s.length;d++)Bs(s[d])}function vs(s){if(!Array.isArray(s))return!1;if((r=s[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<s.length;l++)if(vs(s[l]))return!0;return!1}const ac=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function sc(s,r){return s<r?-1:s>r?1:0}function Bl(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let r=1;r<s.length;r++)if(Bl(s[r]))return!0;return!1}function xs(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?pl(s[1],s[2],"=="):r==="!="?Qs(pl(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?pl(s[1],s[2],r):r==="any"?(l=s.slice(1),["any"].concat(l.map(xs))):r==="all"?["all"].concat(s.slice(1).map(xs)):r==="none"?["all"].concat(s.slice(1).map(xs).map(Qs)):r==="in"?Ks(s[1],s.slice(2)):r==="!in"?Qs(Ks(s[1],s.slice(2))):r==="has"?Ol(s[1]):r==="!has"?Qs(Ol(s[1])):r!=="within"||s;var l}function pl(s,r,l){switch(s){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,s,r]}}function Ks(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",s,["literal",r.sort(sc)]]:["filter-in-small",s,["literal",r]]}}function Ol(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Qs(s){return["!",s]}function Os(s){return ys(J(s.value))?_s(ao({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Fl(s)}function Fl(s){const r=s.value,l=s.key;if(rn(r)!=="array")return[new Hr(l,r,`array expected, ${rn(r)} found`)];const d=s.styleSpec;let m,y=[];if(r.length<1)return[new Hr(l,r,"filter array must have at least 1 element")];switch(y=y.concat(Ys({key:`${l}[0]`,value:r[0],valueSpec:d.filter_operator,style:s.style,styleSpec:s.styleSpec})),Ki(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Ki(r[1])==="$type"&&y.push(new Hr(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&y.push(new Hr(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(m=rn(r[1]),m!=="string"&&y.push(new Hr(`${l}[1]`,r[1],`string expected, ${m} found`)));for(let w=2;w<r.length;w++)m=rn(r[w]),Ki(r[1])==="$type"?y=y.concat(Ys({key:`${l}[${w}]`,value:r[w],valueSpec:d.geometry_type,style:s.style,styleSpec:s.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&y.push(new Hr(`${l}[${w}]`,r[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)y=y.concat(Fl({key:`${l}[${w}]`,value:r[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=rn(r[1]),r.length!==2?y.push(new Hr(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):m!=="string"&&y.push(new Hr(`${l}[1]`,r[1],`string expected, ${m} found`));break;case"within":m=rn(r[1]),r.length!==2?y.push(new Hr(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):m!=="object"&&y.push(new Hr(`${l}[1]`,r[1],`object expected, ${m} found`))}return y}function ml(s,r){const l=s.key,d=s.style,m=s.styleSpec,y=s.value,w=s.objectKey,A=m[`${r}_${s.layerType}`];if(!A)return[];const k=w.match(/^(.*)-transition$/);if(r==="paint"&&k&&A[k[1]]&&A[k[1]].transition)return To({key:l,value:y,valueSpec:m.transition,style:d,styleSpec:m});const P=s.valueSpec||A[w];if(!P)return[new Hr(l,y,`unknown property "${w}"`)];let V;if(rn(y)==="string"&&Wo(P)&&!P.tokens&&(V=/^{([^}]+)}$/.exec(y)))return[new Hr(l,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const W=[];return s.layerType==="symbol"&&(w==="text-field"&&d&&!d.glyphs&&W.push(new Hr(l,y,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&ya(J(y))&&Ki(y.type)==="identity"&&W.push(new Hr(l,y,'"text-font" does not support identity functions'))),W.concat(To({key:s.key,value:y,valueSpec:P,style:d,styleSpec:m,expressionContext:"property",propertyType:r,propertyKey:w}))}function gl(s){return ml(s,"paint")}function zl(s){return ml(s,"layout")}function Js(s){let r=[];const l=s.value,d=s.key,m=s.style,y=s.styleSpec;l.type||l.ref||r.push(new Hr(d,l,'either "type" or "ref" is required'));let w=Ki(l.type);const A=Ki(l.ref);if(l.id){const k=Ki(l.id);for(let P=0;P<s.arrayIndex;P++){const V=m.layers[P];Ki(V.id)===k&&r.push(new Hr(d,l.id,`duplicate layer id "${l.id}", previously used at line ${V.id.__line__}`))}}if("ref"in l){let k;["type","source","source-layer","filter","layout"].forEach(P=>{P in l&&r.push(new Hr(d,l[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{Ki(P.id)===A&&(k=P)}),k?k.ref?r.push(new Hr(d,l.ref,"ref cannot reference another ref layer")):w=Ki(k.type):typeof A=="string"&&r.push(new Hr(d,l.ref,`ref layer "${A}" not found`))}else if(w!=="background"&&w!=="sky")if(l.source){const k=m.sources&&m.sources[l.source],P=k&&Ki(k.type);k?P==="vector"&&w==="raster"?r.push(new Hr(d,l.source,`layer "${l.id}" requires a raster source`)):P==="raster"&&w!=="raster"?r.push(new Hr(d,l.source,`layer "${l.id}" requires a vector source`)):P!=="vector"||l["source-layer"]?P==="raster-dem"&&w!=="hillshade"?r.push(new Hr(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||P==="geojson"&&k.lineMetrics||r.push(new Hr(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Hr(d,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new Hr(d,l.source,`source "${l.source}" not found`))}else r.push(new Hr(d,l,'missing required property "source"'));return r=r.concat(Ko({key:d,value:l,valueSpec:y.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>To({key:`${d}.type`,value:l.type,valueSpec:y.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:k=>Os(ao({layerType:w},k)),layout:k=>Ko({layer:l,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":P=>zl(ao({layerType:w},P))}}),paint:k=>Ko({layer:l,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":P=>gl(ao({layerType:w},P))}})}})),r}function Ta(s){const r=s.value,l=s.key,d=rn(r);return d!=="string"?[new Hr(l,r,`string expected, ${d} found`)]:[]}const _l={promoteId:function({key:s,value:r}){if(rn(r)==="string")return Ta({key:s,value:r});{const l=[];for(const d in r)l.push(...Ta({key:`${s}.${d}`,value:r[d]}));return l}}};function Nl(s){const r=s.value,l=s.key,d=s.styleSpec,m=s.style;if(!r.type)return[new Hr(l,r,'"type" is required')];const y=Ki(r.type);let w;switch(y){case"vector":case"raster":case"raster-dem":return w=Ko({key:l,value:r,valueSpec:d[`source_${y.replace("-","_")}`],style:s.style,styleSpec:d,objectElementValidators:_l}),w;case"geojson":if(w=Ko({key:l,value:r,valueSpec:d.source_geojson,style:m,styleSpec:d,objectElementValidators:_l}),r.cluster)for(const A in r.clusterProperties){const[k,P]=r.clusterProperties[A],V=typeof k=="string"?[k,["accumulated"],["get",A]]:k;w.push(..._s({key:`${l}.${A}.map`,value:P,expressionContext:"cluster-map"})),w.push(..._s({key:`${l}.${A}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return w;case"video":return Ko({key:l,value:r,valueSpec:d.source_video,style:m,styleSpec:d});case"image":return Ko({key:l,value:r,valueSpec:d.source_image,style:m,styleSpec:d});case"canvas":return[new Hr(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ys({key:`${l}.type`,value:r.type,valueSpec:{values:Ul(d)},style:m,styleSpec:d})}}function Ul(s){return s.source.reduce((r,l)=>{const d=s[l];return d.type.type==="enum"&&(r=r.concat(Object.keys(d.type.values))),r},[])}function $l(s){const r=s.value,l=s.styleSpec,d=l.light,m=s.style;let y=[];const w=rn(r);if(r===void 0)return y;if(w!=="object")return y=y.concat([new Hr("light",r,`object expected, ${w} found`)]),y;for(const A in r){const k=A.match(/^(.*)-transition$/);y=y.concat(k&&d[k[1]]&&d[k[1]].transition?To({key:A,value:r[A],valueSpec:l.transition,style:m,styleSpec:l}):d[A]?To({key:A,value:r[A],valueSpec:d[A],style:m,styleSpec:l}):[new Hr(A,r[A],`unknown property "${A}"`)])}return y}function el(s){const r=s.value,l=s.key,d=s.style,m=s.styleSpec,y=m.terrain;let w=[];const A=rn(r);if(r===void 0)return w;if(A!=="object")return w=w.concat([new Hr("terrain",r,`object expected, ${A} found`)]),w;for(const k in r){const P=k.match(/^(.*)-transition$/);w=w.concat(P&&y[P[1]]&&y[P[1]].transition?To({key:k,value:r[k],valueSpec:m.transition,style:d,styleSpec:m}):y[k]?To({key:k,value:r[k],valueSpec:y[k],style:d,styleSpec:m}):[new Hr(k,r[k],`unknown property "${k}"`)])}if(r.source){const k=d.sources&&d.sources[r.source],P=k&&Ki(k.type);k?P!=="raster-dem"&&w.push(new Hr(l,r.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):w.push(new Hr(l,r.source,`source "${r.source}" not found`))}else w.push(new Hr(l,r,'terrain is missing required property "source"'));return w}function jl(s){const r=s.value,l=s.style,d=s.styleSpec,m=d.fog;let y=[];const w=rn(r);if(r===void 0)return y;if(w!=="object")return y=y.concat([new Hr("fog",r,`object expected, ${w} found`)]),y;for(const A in r){const k=A.match(/^(.*)-transition$/);y=y.concat(k&&m[k[1]]&&m[k[1]].transition?To({key:A,value:r[A],valueSpec:d.transition,style:l,styleSpec:d}):m[A]?To({key:A,value:r[A],valueSpec:m[A],style:l,styleSpec:d}):[new Hr(A,r[A],`unknown property "${A}"`)])}return y}const Vl={"*":()=>[],array:Rs,boolean:function(s){const r=s.value,l=s.key,d=rn(r);return d!=="boolean"?[new Hr(l,r,`boolean expected, ${d} found`)]:[]},number:Pl,color:function(s){const r=s.key,l=s.value,d=rn(l);return d!=="string"?[new Hr(r,l,`color expected, ${d} found`)]:kt(l)===null?[new Hr(r,l,`color expected, "${l}" found`)]:[]},enum:Ys,filter:Os,function:Ll,layer:Js,object:Ko,source:Nl,light:$l,terrain:el,fog:jl,string:Ta,formatted:function(s){return Ta(s).length===0?[]:_s(s)},resolvedImage:function(s){return Ta(s).length===0?[]:_s(s)},projection:function(s){const r=s.value,l=s.styleSpec,d=l.projection,m=s.style;let y=[];const w=rn(r);if(w==="object")for(const A in r)y=y.concat(To({key:A,value:r[A],valueSpec:d[A],style:m,styleSpec:l}));else w!=="string"&&(y=y.concat([new Hr("projection",r,`object or string expected, ${w} found`)]));return y}};function To(s){const r=s.value,l=s.valueSpec,d=s.styleSpec;return l.expression&&ya(Ki(r))?Ll(s):l.expression&&Ps(J(r))?_s(s):l.type&&Vl[l.type]?Vl[l.type](s):Ko(ao({},s,{valueSpec:l.type?d[l.type]:l}))}function lc(s){const r=s.value,l=s.key,d=Ta(s);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new Hr(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new Hr(l,r,'"glyphs" url must include a "{range}" token'))),d}function yl(s,r=Ft){return E(To({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:lc,"*":()=>[]}}))}const cc=s=>E(gl(s)),uc=s=>E(zl(s));function E(s){return s.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function M(s,r){let l=!1;if(r&&r.length)for(const d of r)s.fire(new Gi(new Error(d.message))),l=!0;return l}var D=B;function B(s,r,l){var d=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(r=m[1])+2*(l=m[2]);for(var y=0;y<this.d*this.d;y++){var w=m[3+y],A=m[3+y+1];d.push(w===A?null:m.subarray(w,A))}var k=m[3+d.length+1];this.keys=m.subarray(m[3+d.length],k),this.bboxes=m.subarray(k),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var P=0;P<this.d*this.d;P++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=l,this.scale=r/s,this.uid=0;var V=l/r*s;this.min=-V,this.max=s+V}B.prototype.insert=function(s,r,l,d,m){this._forEachCell(r,l,d,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(m)},B.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},B.prototype._insertCell=function(s,r,l,d,m,y){this.cells[m].push(y)},B.prototype.query=function(s,r,l,d,m){var y=this.min,w=this.max;if(s<=y&&r<=y&&w<=l&&w<=d&&!m)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,r,l,d,this._queryCell,A,{},m),A},B.prototype._queryCell=function(s,r,l,d,m,y,w,A){var k=this.cells[m];if(k!==null)for(var P=this.keys,V=this.bboxes,W=0;W<k.length;W++){var Q=k[W];if(w[Q]===void 0){var ne=4*Q;(A?A(V[ne+0],V[ne+1],V[ne+2],V[ne+3]):s<=V[ne+2]&&r<=V[ne+3]&&l>=V[ne+0]&&d>=V[ne+1])?(w[Q]=!0,y.push(P[Q])):w[Q]=!1}}},B.prototype._forEachCell=function(s,r,l,d,m,y,w,A){for(var k=this._convertToCellCoord(s),P=this._convertToCellCoord(r),V=this._convertToCellCoord(l),W=this._convertToCellCoord(d),Q=k;Q<=V;Q++)for(var ne=P;ne<=W;ne++){var he=this.d*ne+Q;if((!A||A(this._convertFromCellCoord(Q),this._convertFromCellCoord(ne),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(ne+1)))&&m.call(this,s,r,l,d,he,y,w,A))return}},B.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},B.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},B.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=3+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var m=new Int32Array(r+l+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=r,w=0;w<s.length;w++){var A=s[w];m[3+w]=y,m.set(A,y),y+=A.length}return m[3+s.length]=y,m.set(this.keys,y),m[3+s.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer};const $={};function U(s,r,l={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),$[r]={klass:s,omit:l.omit||[]}}U(Object,"Object"),D.serialize=function(s,r){const l=s.toArrayBuffer();return r&&r.push(l),{buffer:l}},D.deserialize=function(s){return new D(s.buffer)},Object.defineProperty(D,"name",{value:"Grid"}),U(D,"Grid"),U(Ir,"Color"),U(Error,"Error"),U(xi,"AJAXError"),U(pn,"ResolvedImage"),U(gs,"StylePropertyFunction"),U(Hs,"StyleExpression",{omit:["_evaluator"]}),U(Ws,"ZoomDependentExpression"),U(Na,"ZoomConstantExpression"),U(Ro,"CompoundExpression",{omit:["_evaluate"]});for(const s in Fa)$[Fa[s]._classRegistryKey]||U(Fa[s],`Expression${s}`);function Z(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function K(s){return b.ImageBitmap&&s instanceof b.ImageBitmap}function me(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Z(s)||K(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return r&&r.push(l.buffer),l}if(s instanceof b.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const d of s)l.push(me(d,r));return l}if(typeof s=="object"){const l=s.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const m=l.serialize?l.serialize(s,r):{};if(!l.serialize){for(const y in s)s.hasOwnProperty(y)&&($[d].omit.indexOf(y)>=0||(m[y]=me(s[y],r)));s instanceof Error&&(m.message=s.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(m.$name=d),m}throw new Error("can't serialize object of type "+typeof s)}function we(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Z(s)||K(s)||ArrayBuffer.isView(s)||s instanceof b.ImageData)return s;if(Array.isArray(s))return s.map(we);if(typeof s=="object"){const r=s.$name||"Object",{klass:l}=$[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(s);const d=Object.create(l.prototype);for(const m of Object.keys(s))m!=="$name"&&(d[m]=we(s[m]));return d}throw new Error("can't deserialize object of type "+typeof s)}const Se=s=>s>=1536&&s<=1791,Ue=s=>s>=1872&&s<=1919,tt=s=>s>=2208&&s<=2303,bt=s=>s>=11904&&s<=12031,or=s=>s>=12032&&s<=12255,$r=s=>s>=12272&&s<=12287,Fr=s=>s>=12288&&s<=12351,Ht=s=>s>=12352&&s<=12447,vi=s=>s>=12448&&s<=12543,Ii=s=>s>=12544&&s<=12591,ln=s=>s>=12704&&s<=12735,un=s=>s>=12736&&s<=12783,Io=s=>s>=12784&&s<=12799,Kn=s=>s>=12800&&s<=13055,Ja=s=>s>=13056&&s<=13311,Ua=s=>s>=13312&&s<=19903,bs=s=>s>=19968&&s<=40959,vl=s=>s>=40960&&s<=42127,pu=s=>s>=42128&&s<=42191,Pc=s=>s>=44032&&s<=55215,Gl=s=>s>=63744&&s<=64255,_=s=>s>=64336&&s<=65023,c=s=>s>=65040&&s<=65055,p=s=>s>=65072&&s<=65103,x=s=>s>=65104&&s<=65135,S=s=>s>=65136&&s<=65279,I=s=>s>=65280&&s<=65519;function O(s){for(const r of s)if(re(r.charCodeAt(0)))return!0;return!1}function j(s){for(const r of s)if(!G(r.charCodeAt(0)))return!1;return!0}function G(s){return!(Se(s)||Ue(s)||tt(s)||_(s)||S(s))}function re(s){return!(s!==746&&s!==747&&(s<4352||!(ln(s)||Ii(s)||p(s)&&!(s>=65097&&s<=65103)||Gl(s)||Ja(s)||bt(s)||un(s)||!(!Fr(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ua(s)||bs(s)||Kn(s)||(r=>r>=12592&&r<=12687)(s)||(r=>r>=43360&&r<=43391)(s)||(r=>r>=55216&&r<=55295)(s)||(r=>r>=4352&&r<=4607)(s)||Pc(s)||Ht(s)||$r(s)||(r=>r>=12688&&r<=12703)(s)||or(s)||Io(s)||vi(s)&&s!==12540||!(!I(s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!x(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(r=>r>=5120&&r<=5759)(s)||(r=>r>=6320&&r<=6399)(s)||c(s)||(r=>r>=19904&&r<=19967)(s)||vl(s)||pu(s))))}function te(s){return!(re(s)||function(r){return!!((l=>l>=128&&l<=255)(r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||(l=>l>=8192&&l<=8303)(r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||(l=>l>=8448&&l<=8527)(r)||(l=>l>=8528&&l<=8591)(r)||(l=>l>=8960&&l<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||(l=>l>=9216&&l<=9279)(r)&&r!==9251||(l=>l>=9280&&l<=9311)(r)||(l=>l>=9312&&l<=9471)(r)||(l=>l>=9632&&l<=9727)(r)||(l=>l>=9728&&l<=9983)(r)&&!(r>=9754&&r<=9759)||(l=>l>=11008&&l<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Fr(r)||vi(r)||(l=>l>=57344&&l<=63743)(r)||p(r)||x(r)||I(r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(s))}function pe(s){return s>=1424&&s<=2303||_(s)||S(s)}function Ee(s,r){return!(!r&&pe(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(l=>l>=6016&&l<=6143)(s))}function Le(s){for(const r of s)if(pe(r.charCodeAt(0)))return!0;return!1}const Pe="deferred",Be="loading",Ce="loaded";let De=null,Ne="unavailable",Oe=null;const qe=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Ne="error"),De&&De(s)};function ot(){it.fire(new Ji("pluginStateChange",{pluginStatus:Ne,pluginURL:Oe}))}const it=new Xi,gt=function(){return Ne},zt=function(){if(Ne!==Pe||!Oe)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ne=Be,ot(),Oe&&Ti({url:Oe},s=>{s?qe(s):(Ne=Ce,ot())})},Lt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ne===Ce||Lt.applyArabicShaping!=null,isLoading:()=>Ne===Be,setState(s){Ne=s.pluginStatus,Oe=s.pluginURL},isParsed:()=>Lt.applyArabicShaping!=null&&Lt.processBidirectionalText!=null&&Lt.processStyledBidirectionalText!=null,getPluginURL:()=>Oe};class wt{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(l,d){for(const m of l)if(!Ee(m.charCodeAt(0),d))return!1;return!0}(r,Lt.isLoaded())}}class Dr{constructor(r,l){this.property=r,this.value=l,this.expression=function(d,m){if(ya(d))return new gs(d,m);if(Ps(d)){const y=fl(d,m);if(y.result==="error")throw new Error(y.value.map(w=>`${w.key}: ${w.message}`).join(", "));return y.value}{let y=d;return typeof d=="string"&&m.type==="color"&&(y=Ir.parse(d)),{kind:"constant",evaluate:()=>y}}}(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,d){return this.property.possiblyEvaluate(this,r,l,d)}}class Dt{constructor(r){this.property=r,this.value=new Dr(r,void 0)}transitioned(r,l){return new jt(this.property,this.value,l,_t({},r.transition,this.transition),r.now)}untransitioned(){return new jt(this.property,this.value,null,{},0)}}class ir{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return at(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Dt(this._values[r].property)),this._values[r].value=new Dr(this._values[r].property,l===null?void 0:at(l))}getTransition(r){return at(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Dt(this._values[r].property)),this._values[r].transition=at(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(r[l]=d);const m=this.getTransition(l);m!==void 0&&(r[`${l}-transition`]=m)}return r}transitioned(r,l){const d=new wr(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].transitioned(r,l._values[m]);return d}untransitioned(){const r=new wr(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class jt{constructor(r,l,d,m,y){const w=m.delay||0,A=m.duration||0;y=y||0,this.property=r,this.value=l,this.begin=y+w,this.end=this.begin+A,r.specification.transition&&(m.delay||m.duration)&&(this.prior=d)}possiblyEvaluate(r,l,d){const m=r.now||0,y=this.value.possiblyEvaluate(r,l,d),w=this.prior;if(w){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return w.possiblyEvaluate(r,l,d);{const A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(r,l,d),y,Ge(A))}}return y}}class wr{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,d){const m=new kr(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(r,l,d);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Zt{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return at(this._values[r].value)}setValue(r,l){this._values[r]=new Dr(this._values[r].property,l===null?void 0:at(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(r[l]=d)}return r}possiblyEvaluate(r,l,d){const m=new kr(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(r,l,d);return m}}class fr{constructor(r,l,d){this.property=r,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,d,m){return this.property.evaluate(this.value,this.parameters,r,l,d,m)}}class kr{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Mt{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,d){const m=Ni[this.specification.type];return m?m(r,l,d):r}}class Ut{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,d,m){return new fr(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},d,m)}:r.expression,l)}interpolate(r,l,d){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new fr(this,{kind:"constant",value:void 0},r.parameters);const m=Ni[this.specification.type];return m?new fr(this,{kind:"constant",value:m(r.value.value,l.value.value,d)},r.parameters):r}evaluate(r,l,d,m,y,w){return r.kind==="constant"?r.value:r.evaluate(l,d,m,y,w)}}class ai{constructor(r){this.specification=r}possiblyEvaluate(r,l,d,m){return!!r.expression.evaluate(l,null,{},d,m)}interpolate(){return!1}}class wi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new wt(0,{});for(const d in r){const m=r[d];m.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new Dr(m,void 0),w=this.defaultTransitionablePropertyValues[d]=new Dt(m);this.defaultTransitioningPropertyValues[d]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(l)}}}function si(s,r){return 256*(s=xt(Math.floor(s),0,255))+xt(Math.floor(r),0,255)}U(Ut,"DataDrivenProperty"),U(Mt,"DataConstantProperty"),U(ai,"ColorRampProperty");const ki={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qi{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ei{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ti(s,r=1){let l=0,d=0;return{members:s.map(m=>{const y=ki[m.type].BYTES_PER_ELEMENT,w=l=Tn(l,Math.max(r,y)),A=m.components||1;return d=Math.max(d,y),l+=y*A,{name:m.name,type:m.type,components:A,offset:w}}),size:Tn(l,Math.max(d,r)),alignment:r}}function Tn(s,r){return Math.ceil(s/r)*r}class xn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const d=this.length;return this.resize(d+1),this.emplace(d,r,l)}emplace(r,l,d){const m=2*r;return this.int16[m+0]=l,this.int16[m+1]=d,r}}xn.prototype.bytesPerElement=4,U(xn,"StructArrayLayout2i4");class Dn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,d)}emplace(r,l,d,m){const y=3*r;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=m,r}}Dn.prototype.bytesPerElement=6,U(Dn,"StructArrayLayout3i6");class An extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,d,m)}emplace(r,l,d,m,y){const w=4*r;return this.int16[w+0]=l,this.int16[w+1]=d,this.int16[w+2]=m,this.int16[w+3]=y,r}}An.prototype.bytesPerElement=8,U(An,"StructArrayLayout4i8");class ca extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w,A){const k=this.length;return this.resize(k+1),this.emplace(k,r,l,d,m,y,w,A)}emplace(r,l,d,m,y,w,A,k){const P=6*r,V=12*r,W=3*r;return this.int16[P+0]=l,this.int16[P+1]=d,this.uint8[V+4]=m,this.uint8[V+5]=y,this.uint8[V+6]=w,this.uint8[V+7]=A,this.float32[W+2]=k,r}}ca.prototype.bytesPerElement=12,U(ca,"StructArrayLayout2i4ub1f12");class va extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,d,m)}emplace(r,l,d,m,y){const w=4*r;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=m,this.float32[w+3]=y,r}}va.prototype.bytesPerElement=16,U(va,"StructArrayLayout4f16");class Qo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,d,m,y)}emplace(r,l,d,m,y,w){const A=6*r,k=3*r;return this.uint16[A+0]=l,this.uint16[A+1]=d,this.uint16[A+2]=m,this.uint16[A+3]=y,this.float32[k+2]=w,r}}Qo.prototype.bytesPerElement=12,U(Qo,"StructArrayLayout4ui1f12");class es extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,d,m)}emplace(r,l,d,m,y){const w=4*r;return this.uint16[w+0]=l,this.uint16[w+1]=d,this.uint16[w+2]=m,this.uint16[w+3]=y,r}}es.prototype.bytesPerElement=8,U(es,"StructArrayLayout4ui8");class Un extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,d,m,y,w)}emplace(r,l,d,m,y,w,A){const k=6*r;return this.int16[k+0]=l,this.int16[k+1]=d,this.int16[k+2]=m,this.int16[k+3]=y,this.int16[k+4]=w,this.int16[k+5]=A,r}}Un.prototype.bytesPerElement=12,U(Un,"StructArrayLayout6i12");class kn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w,A,k,P,V,W,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,r,l,d,m,y,w,A,k,P,V,W,Q)}emplace(r,l,d,m,y,w,A,k,P,V,W,Q,ne){const he=12*r;return this.int16[he+0]=l,this.int16[he+1]=d,this.int16[he+2]=m,this.int16[he+3]=y,this.uint16[he+4]=w,this.uint16[he+5]=A,this.uint16[he+6]=k,this.uint16[he+7]=P,this.int16[he+8]=V,this.int16[he+9]=W,this.int16[he+10]=Q,this.int16[he+11]=ne,r}}kn.prototype.bytesPerElement=24,U(kn,"StructArrayLayout4i4ui4i24");class _n extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,d,m,y,w)}emplace(r,l,d,m,y,w,A){const k=10*r,P=5*r;return this.int16[k+0]=l,this.int16[k+1]=d,this.int16[k+2]=m,this.float32[P+2]=y,this.float32[P+3]=w,this.float32[P+4]=A,r}}_n.prototype.bytesPerElement=20,U(_n,"StructArrayLayout3i3f20");class ro extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}ro.prototype.bytesPerElement=4,U(ro,"StructArrayLayout1ul4");class Uo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w,A,k,P,V,W,Q,ne){const he=this.length;return this.resize(he+1),this.emplace(he,r,l,d,m,y,w,A,k,P,V,W,Q,ne)}emplace(r,l,d,m,y,w,A,k,P,V,W,Q,ne,he){const ge=20*r,Ae=10*r;return this.int16[ge+0]=l,this.int16[ge+1]=d,this.int16[ge+2]=m,this.int16[ge+3]=y,this.int16[ge+4]=w,this.float32[Ae+3]=A,this.float32[Ae+4]=k,this.float32[Ae+5]=P,this.float32[Ae+6]=V,this.int16[ge+14]=W,this.uint32[Ae+8]=Q,this.uint16[ge+18]=ne,this.uint16[ge+19]=he,r}}Uo.prototype.bytesPerElement=40,U(Uo,"StructArrayLayout5i4f1i1ul2ui40");class On extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w,A){const k=this.length;return this.resize(k+1),this.emplace(k,r,l,d,m,y,w,A)}emplace(r,l,d,m,y,w,A,k){const P=8*r;return this.int16[P+0]=l,this.int16[P+1]=d,this.int16[P+2]=m,this.int16[P+4]=y,this.int16[P+5]=w,this.int16[P+6]=A,this.int16[P+7]=k,r}}On.prototype.bytesPerElement=16,U(On,"StructArrayLayout3i2i2i16");class Jo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,d,m,y)}emplace(r,l,d,m,y,w){const A=4*r,k=8*r;return this.float32[A+0]=l,this.float32[A+1]=d,this.float32[A+2]=m,this.int16[k+6]=y,this.int16[k+7]=w,r}}Jo.prototype.bytesPerElement=16,U(Jo,"StructArrayLayout2f1f2i16");class ql extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,d,m)}emplace(r,l,d,m,y){const w=12*r,A=3*r;return this.uint8[w+0]=l,this.uint8[w+1]=d,this.float32[A+1]=m,this.float32[A+2]=y,r}}ql.prototype.bytesPerElement=12,U(ql,"StructArrayLayout2ub2f12");class ws extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,d)}emplace(r,l,d,m){const y=3*r;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=m,r}}ws.prototype.bytesPerElement=12,U(ws,"StructArrayLayout3f12");class $o extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,d)}emplace(r,l,d,m){const y=3*r;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=m,r}}$o.prototype.bytesPerElement=6,U($o,"StructArrayLayout3ui6");class Sa extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae,je,Qe,$e,Xe,nt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae,je,Qe,$e,Xe,nt)}emplace(r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae,je,Qe,$e,Xe,nt,rt){const Ot=30*r,Rt=15*r,rr=60*r;return this.int16[Ot+0]=l,this.int16[Ot+1]=d,this.int16[Ot+2]=m,this.float32[Rt+2]=y,this.float32[Rt+3]=w,this.uint16[Ot+8]=A,this.uint16[Ot+9]=k,this.uint32[Rt+5]=P,this.uint32[Rt+6]=V,this.uint32[Rt+7]=W,this.uint16[Ot+16]=Q,this.uint16[Ot+17]=ne,this.uint16[Ot+18]=he,this.float32[Rt+10]=ge,this.float32[Rt+11]=Ae,this.uint8[rr+48]=je,this.uint8[rr+49]=Qe,this.uint8[rr+50]=$e,this.uint32[Rt+13]=Xe,this.int16[Ot+28]=nt,this.uint8[rr+58]=rt,r}}Sa.prototype.bytesPerElement=60,U(Sa,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ts extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae,je,Qe,$e,Xe,nt,rt,Ot,Rt,rr,Mr,Vt,sr,hr,vr){const Cr=this.length;return this.resize(Cr+1),this.emplace(Cr,r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae,je,Qe,$e,Xe,nt,rt,Ot,Rt,rr,Mr,Vt,sr,hr,vr)}emplace(r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae,je,Qe,$e,Xe,nt,rt,Ot,Rt,rr,Mr,Vt,sr,hr,vr,Cr){const Xt=38*r,jr=19*r;return this.int16[Xt+0]=l,this.int16[Xt+1]=d,this.int16[Xt+2]=m,this.float32[jr+2]=y,this.float32[jr+3]=w,this.int16[Xt+8]=A,this.int16[Xt+9]=k,this.int16[Xt+10]=P,this.int16[Xt+11]=V,this.int16[Xt+12]=W,this.int16[Xt+13]=Q,this.uint16[Xt+14]=ne,this.uint16[Xt+15]=he,this.uint16[Xt+16]=ge,this.uint16[Xt+17]=Ae,this.uint16[Xt+18]=je,this.uint16[Xt+19]=Qe,this.uint16[Xt+20]=$e,this.uint16[Xt+21]=Xe,this.uint16[Xt+22]=nt,this.uint16[Xt+23]=rt,this.uint16[Xt+24]=Ot,this.uint16[Xt+25]=Rt,this.uint16[Xt+26]=rr,this.uint16[Xt+27]=Mr,this.uint16[Xt+28]=Vt,this.uint32[jr+15]=sr,this.float32[jr+16]=hr,this.float32[jr+17]=vr,this.float32[jr+18]=Cr,r}}ts.prototype.bytesPerElement=76,U(ts,"StructArrayLayout3i2f6i15ui1ul3f76");class rs extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}rs.prototype.bytesPerElement=4,U(rs,"StructArrayLayout1f4");class Xl extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,d,m,y)}emplace(r,l,d,m,y,w){const A=5*r;return this.float32[A+0]=l,this.float32[A+1]=d,this.float32[A+2]=m,this.float32[A+3]=y,this.float32[A+4]=w,r}}Xl.prototype.bytesPerElement=20,U(Xl,"StructArrayLayout5f20");class xl extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,d,m)}emplace(r,l,d,m,y){const w=6*r;return this.uint32[3*r+0]=l,this.uint16[w+2]=d,this.uint16[w+3]=m,this.uint16[w+4]=y,r}}xl.prototype.bytesPerElement=12,U(xl,"StructArrayLayout1ul3ui12");class is extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const d=this.length;return this.resize(d+1),this.emplace(d,r,l)}emplace(r,l,d){const m=2*r;return this.uint16[m+0]=l,this.uint16[m+1]=d,r}}is.prototype.bytesPerElement=4,U(is,"StructArrayLayout2ui4");class Lc extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}Lc.prototype.bytesPerElement=2,U(Lc,"StructArrayLayout1ui2");class mu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const d=this.length;return this.resize(d+1),this.emplace(d,r,l)}emplace(r,l,d){const m=2*r;return this.float32[m+0]=l,this.float32[m+1]=d,r}}mu.prototype.bytesPerElement=8,U(mu,"StructArrayLayout2f8");class od extends qi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}od.prototype.size=40;class eh extends Uo{get(r){return new od(this,r)}}U(eh,"CollisionBoxArray");class ad extends qi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}ad.prototype.size=60;class sd extends Sa{get(r){return new ad(this,r)}}U(sd,"PlacedSymbolArray");class ld extends qi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ld.prototype.size=76;class cd extends ts{get(r){return new ld(this,r)}}U(cd,"SymbolInstanceArray");class ud extends rs{getoffsetX(r){return this.float32[1*r+0]}}U(ud,"GlyphOffsetArray");class hd extends xn{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}U(hd,"SymbolLineVertexArray");class dd extends qi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}dd.prototype.size=12;class fd extends xl{get(r){return new dd(this,r)}}U(fd,"FeatureIndexArray");class pd extends is{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}U(pd,"FillExtrusionCentroidArray");const zp=ti([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Np=ti([{name:"a_dash",components:4,type:"Uint16"}]);var hc={exports:{}},md={exports:{}};md.exports=function(s,r){var l,d,m,y,w,A,k,P;for(d=s.length-(l=3&s.length),m=r,w=3432918353,A=461845907,P=0;P<d;)k=255&s.charCodeAt(P)|(255&s.charCodeAt(++P))<<8|(255&s.charCodeAt(++P))<<16|(255&s.charCodeAt(++P))<<24,++P,m=27492+(65535&(y=5*(65535&(m=(m^=k=(65535&(k=(k=(65535&k)*w+(((k>>>16)*w&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(k=0,l){case 3:k^=(255&s.charCodeAt(P+2))<<16;case 2:k^=(255&s.charCodeAt(P+1))<<8;case 1:m^=k=(65535&(k=(k=(65535&(k^=255&s.charCodeAt(P)))*w+(((k>>>16)*w&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var gd={exports:{}};gd.exports=function(s,r){for(var l,d=s.length,m=r^d,y=0;d>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(y)|(255&s.charCodeAt(++y))<<8|(255&s.charCodeAt(++y))<<16|(255&s.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:m^=(255&s.charCodeAt(y+2))<<16;case 2:m^=(255&s.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var _d=md.exports,Up=gd.exports;hc.exports=_d,hc.exports.murmur3=_d,hc.exports.murmur2=Up;class gu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,d,m){this.ids.push(yd(r)),this.positions.push(l,d,m)}getPositions(r){const l=yd(r);let d=0,m=this.ids.length-1;for(;d<m;){const w=d+m>>1;this.ids[w]>=l?m=w:d=w+1}const y=[];for(;this.ids[d]===l;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(r,l){const d=new Float64Array(r.ids),m=new Uint32Array(r.positions);return th(d,m,0,d.length-1),l&&l.push(d.buffer,m.buffer),{ids:d,positions:m}}static deserialize(r){const l=new gu;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function yd(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:hc.exports(String(s))}function th(s,r,l,d){for(;l<d;){const m=s[l+d>>1];let y=l-1,w=d+1;for(;;){do y++;while(s[y]<m);do w--;while(s[w]>m);if(y>=w)break;_u(s,y,w),_u(r,3*y,3*w),_u(r,3*y+1,3*w+1),_u(r,3*y+2,3*w+2)}w-l<d-w?(th(s,r,l,w),l=w+1):(th(s,r,w+1,d),d=w)}}function _u(s,r,l){const d=s[r];s[r]=s[l],s[l]=d}U(gu,"FeaturePositionMap");class tl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class yu extends tl{constructor(r){super(r),this.current=0}set(r,l,d){this.fetchUniformLocation(r,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class vd extends tl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,d){this.fetchUniformLocation(r,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class xd extends tl{constructor(r){super(r),this.current=Ir.transparent}set(r,l,d){this.fetchUniformLocation(r,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const $p=new Float32Array(16),jp=new Float32Array(9),Vp=new Float32Array(4);function rh(s){return[si(255*s.r,255*s.g),si(255*s.b,255*s.a)]}class Rc{constructor(r,l,d){this.value=r,this.uniformNames=l.map(m=>`u_${m}`),this.type=d}setUniform(r,l,d,m,y){l.set(r,y,m.constantOr(this.value))}getBinding(r,l){return this.type==="color"?new xd(r):new yu(r)}}class dc{constructor(r,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,d,m,y){const w=y==="u_pattern"||y==="u_dash"?this.pattern:y==="u_pixel_ratio"?this.pixelRatio:null;w&&l.set(r,y,w)}getBinding(r,l){return l==="u_pattern"||l==="u_dash"?new vd(r):new yu(r)}}class rl{constructor(r,l,d,m){this.expression=r,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,l,d,m,y,w){const A=this.paintVertexArray.length,k=this.expression.evaluate(new wt(0),l,{},y,m,w);this.paintVertexArray.resize(r),this._setPaintValue(A,r,k)}updatePaintArray(r,l,d,m,y){const w=this.expression.evaluate({zoom:0},d,m,void 0,y);this._setPaintValue(r,l,w)}_setPaintValue(r,l,d){if(this.type==="color"){const m=rh(d);for(let y=r;y<l;y++)this.paintVertexArray.emplace(y,m[0],m[1])}else{for(let m=r;m<l;m++)this.paintVertexArray.emplace(m,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Es{constructor(r,l,d,m,y,w){this.expression=r,this.uniformNames=l.map(A=>`u_${A}_t`),this.type=d,this.useIntegerZoom=m,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=l.map(A=>({name:`a_${A}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(r,l,d,m,y,w){const A=this.expression.evaluate(new wt(this.zoom),l,{},y,m,w),k=this.expression.evaluate(new wt(this.zoom+1),l,{},y,m,w),P=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(P,r,A,k)}updatePaintArray(r,l,d,m,y){const w=this.expression.evaluate({zoom:this.zoom},d,m,void 0,y),A=this.expression.evaluate({zoom:this.zoom+1},d,m,void 0,y);this._setPaintValue(r,l,w,A)}_setPaintValue(r,l,d,m){if(this.type==="color"){const y=rh(d),w=rh(m);for(let A=r;A<l;A++)this.paintVertexArray.emplace(A,y[0],y[1],w[0],w[1])}else{for(let y=r;y<l;y++)this.paintVertexArray.emplace(y,d,m);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,d,m,y){const w=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,A=xt(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);l.set(r,y,A)}getBinding(r,l){return new yu(r)}}class bl{constructor(r,l,d,m,y){this.expression=r,this.layerId=y,this.paintVertexAttributes=(d==="array"?Np:zp).members;for(let w=0;w<l.length;++w);this.paintVertexArray=new m}populatePaintArray(r,l,d){const m=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(m,r,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(r,l,d,m,y,w){this._setPaintValues(r,l,d.patterns&&d.patterns[this.layerId],w)}_setPaintValues(r,l,d,m){if(!m||!d)return;const y=m[d];if(!y)return;const{tl:w,br:A,pixelRatio:k}=y;for(let P=r;P<l;P++)this.paintVertexArray.emplace(P,w[0],w[1],A[0],A[1],k)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wl{constructor(r,l,d=()=>!0){this.binders={},this._buffers=[];const m=[];for(const y in r.paint._values){if(!d(y))continue;const w=r.paint.get(y);if(!(w instanceof fr&&Wo(w.property.specification)))continue;const A=qp(y,r.type),k=w.value,P=w.property.specification.type,V=w.property.useIntegerZoom,W=y==="line-dasharray"||y.endsWith("pattern"),Q=y==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(k.kind!=="constant"||Q)if(k.kind==="source"||Q||W){const ne=bd(y,P,"source");this.binders[y]=W?new bl(k,A,P,ne,r.id):new rl(k,A,P,ne),m.push(`/a_${y}`)}else{const ne=bd(y,P,"composite");this.binders[y]=new Es(k,A,P,V,l,ne),m.push(`/z_${y}`)}else this.binders[y]=W?new dc(k.value,A):new Rc(k.value,A,P),m.push(`/u_${y}`)}this.cacheKey=m.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof rl||l instanceof Es?l.maxValue:0}populatePaintArrays(r,l,d,m,y,w){for(const A in this.binders){const k=this.binders[A];(k instanceof rl||k instanceof Es||k instanceof bl)&&k.populatePaintArray(r,l,d,m,y,w)}}setConstantPatternPositions(r){for(const l in this.binders){const d=this.binders[l];d instanceof dc&&d.setConstantPatternPositions(r)}}updatePaintArrays(r,l,d,m,y,w){let A=!1;for(const k in r){const P=l.getPositions(k);for(const V of P){const W=d.feature(V.index);for(const Q in this.binders){const ne=this.binders[Q];if((ne instanceof rl||ne instanceof Es||ne instanceof bl)&&ne.expression.isStateDependent===!0){const he=m.paint.get(Q);ne.expression=he.value,ne.updatePaintArray(V.start,V.end,W,r[k],y,w),A=!0}}}}return A}defines(){const r=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Rc||d instanceof dc)&&r.push(...d.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof rl||d instanceof Es||d instanceof bl)for(let m=0;m<d.paintVertexAttributes.length;m++)r.push(d.paintVertexAttributes[m].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Rc||d instanceof dc||d instanceof Es)for(const m of d.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof Rc||m instanceof dc||m instanceof Es)for(const y of m.uniformNames)l.push({name:y,property:d,binding:m.getBinding(r,y)})}return l}setUniforms(r,l,d,m,y){for(const{name:w,property:A,binding:k}of d)this.binders[A].setUniform(r,k,y,m.get(A),w)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof rl||l instanceof Es||l instanceof bl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const d=this.binders[l];(d instanceof rl||d instanceof Es||d instanceof bl)&&d.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof rl||l instanceof Es||l instanceof bl)&&l.destroy()}}}class Zl{constructor(r,l,d=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new wl(m,l,d);this.needsUpload=!1,this._featureMap=new gu,this._bufferOffset=0}populatePaintArrays(r,l,d,m,y,w,A){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(r,l,m,y,w,A);l.id!==void 0&&this._featureMap.add(l.id,d,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,d,m,y){for(const w of d)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(r,this._featureMap,l,w,m,y)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Gp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function qp(s,r){return Gp[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const Xp={"line-pattern":{source:Qo,composite:Qo},"fill-pattern":{source:Qo,composite:Qo},"fill-extrusion-pattern":{source:Qo,composite:Qo},"line-dasharray":{source:es,composite:es}},Zp={color:{source:mu,composite:va},number:{source:rs,composite:mu}};function bd(s,r,l){const d=Xp[s];return d&&d[l]||Zp[r][l]}U(Rc,"ConstantBinder"),U(dc,"PatternConstantBinder"),U(rl,"SourceExpressionBinder"),U(bl,"PatternCompositeBinder"),U(Es,"CompositeExpressionBinder"),U(wl,"ProgramConfiguration",{omit:["_buffers"]}),U(Zl,"ProgramConfigurationSet");const vu="-transition";class Ts extends Xi{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new Zt(l.layout)),l.paint)){this._transitionablePaint=new ir(l.paint);for(const d in r.paint)this.setPaintProperty(d,r.paint[d],{validate:!1});for(const d in r.layout)this.setLayoutProperty(d,r.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kr(l.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,d={}){l!=null&&this._validate(uc,`layers.${this.id}.layout.${r}`,r,l,d)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return dr(r,vu)?this._transitionablePaint.getTransition(r.slice(0,-vu.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,d={}){if(l!=null&&this._validate(cc,`layers.${this.id}.paint.${r}`,r,l,d))return!1;if(dr(r,vu))return this._transitionablePaint.setTransition(r.slice(0,-vu.length),l||void 0),!1;{const m=this._transitionablePaint._values[r],y=m.value.isDataDriven(),w=m.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value,k=A.isDataDriven(),P=dr(r,"pattern")||r==="line-dasharray";return k||y||P||this._handleOverridablePaintPropertyUpdate(r,w,A)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,d){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),nr(r,(l,d)=>!(l===void 0||d==="layout"&&!Object.keys(l).length||d==="paint"&&!Object.keys(l).length))}_validate(r,l,d,m,y={}){return(!y||y.validate!==!1)&&M(this,r.call(yl,{key:l,layerType:this.type,objectKey:d,value:m,styleSpec:Ft,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof fr&&Wo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Qa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Hp=ti([{name:"a_pos",components:2,type:"Int16"}],4),Wp=ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yo{constructor(r=[]){this.segments=r}prepareSegment(r,l,d,m){let y=this.segments[this.segments.length-1];return r>yo.MAX_VERTEX_ARRAY_LENGTH&&Br(`Max vertices per segment is ${yo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!y||y.vertexLength+r>yo.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m)&&(y={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},m!==void 0&&(y.sortKey=m),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,d,m){return new yo([{vertexOffset:r,primitiveOffset:l,vertexLength:d,primitiveLength:m,vaos:{},sortKey:0}])}}yo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,U(yo,"SegmentVector");var Li=8192;class El{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof mn?new mn(r.lng,r.lat):mn.convert(r),this}setSouthWest(r){return this._sw=r instanceof mn?new mn(r.lng,r.lat):mn.convert(r),this}extend(r){const l=this._sw,d=this._ne;let m,y;if(r instanceof mn)m=r,y=r;else{if(!(r instanceof El))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(El.convert(r)):this.extend(mn.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&r.hasOwnProperty("lon")?this.extend(mn.convert(r)):this;if(m=r._sw,y=r._ne,!m||!y)return this}return l||d?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new mn(m.lng,m.lat),this._ne=new mn(y.lng,y.lat)),this}getCenter(){return new mn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mn(this.getWest(),this.getNorth())}getSouthEast(){return new mn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:d}=mn.convert(r);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(r){return!r||r instanceof El?r:new El(r)}}const xu=63710088e-1;class mn{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mn(Nr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,d=this.lat*l,m=r.lat*l,y=Math.sin(d)*Math.sin(m)+Math.cos(d)*Math.cos(m)*Math.cos((r.lng-this.lng)*l);return xu*Math.acos(Math.min(y,1))}toBounds(r=0){const l=360*r/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new El(new mn(this.lng-d,this.lat-l),new mn(this.lng+d,this.lat+l))}static convert(r){if(r instanceof mn)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new mn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new mn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wd=2*Math.PI*xu;function ih(s){return wd*Math.cos(s*Math.PI/180)}function Fs(s){return(180+s)/360}function zs(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function ns(s,r){return s/ih(r)}function $a(s){return 360*s-180}function jo(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Ed(s,r){return s*ih(jo(r))}const Ns=85.051129;function Td(s){return 1/Math.cos(s*Math.PI/180)}class fc{constructor(r,l,d=0){this.x=+r,this.y=+l,this.z=+d}static fromLngLat(r,l=0){const d=mn.convert(r);return new fc(Fs(d.lng),zs(d.lat),ns(l,d.lat))}toLngLat(){return new mn($a(this.x),jo(this.y))}toAltitude(){return Ed(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wd*Td(jo(this.y))}}function nh(s,r,l,d,m,y,w,A,k){const P=(r+d)/2,V=(l+m)/2,W=new ue(P,V);A(W),function(Q,ne,he,ge,Ae,je){const Qe=he-Ae,$e=ge-je;return Math.abs((ge-ne)*Qe-(he-Q)*$e)/Math.hypot(Qe,$e)}(W.x,W.y,y.x,y.y,w.x,w.y)>=k?(nh(s,r,l,P,V,y,W,A,k),nh(s,P,V,d,m,W,w,A,k)):s.push(w)}function Sd(s,r,l){let d=s[0],m=d.x,y=d.y;r(d);const w=[d];for(let A=1;A<s.length;A++){const k=s[A],{x:P,y:V}=k;r(k),nh(w,m,y,P,V,d,k,r,l),m=P,y=V,d=k}return w}function oh(s,r,l,d){if(d(r,l)){const m=r.add(l)._mult(.5);oh(s,r,m,d),oh(s,m,l,d)}else s.push(l)}function Yp(s,r){let l=s[0];const d=[l];for(let m=1;m<s.length;m++){const y=s[m];oh(d,l,y,r),l=y}return d}const ah=Math.pow(2,14)-1,Md=-ah-1;function Kp(s,r){const l=Math.round(s.x*r),d=Math.round(s.y*r);return s.x=xt(l,Md,ah),s.y=xt(d,Md,ah),(l<s.x||l>s.x+1||d<s.y||d>s.y+1)&&Br("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function il(s,r,l){const d=s.loadGeometry(),m=s.extent,y=Li/m;if(r&&l&&l.projection.isReprojectedInTileSpace){const w=1<<r.z,{scale:A,x:k,y:P,projection:V}=l,W=Q=>{const ne=$a((r.x+Q.x/m)/w),he=jo((r.y+Q.y/m)/w),ge=V.project(ne,he);Q.x=(ge.x*A-k)*m,Q.y=(ge.y*A-P)*m};for(let Q=0;Q<d.length;Q++)if(s.type!==1)d[Q]=Sd(d[Q],W,1);else{const ne=[];for(const he of d[Q])he.x<0||he.x>=m||he.y<0||he.y>=m||(W(he),ne.push(he));d[Q]=ne}}for(const w of d)for(const A of w)Kp(A,y);return d}function Hl(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?il(s):[]}}function bu(s,r,l,d,m){s.emplaceBack(2*r+(d+1)/2,2*l+(m+1)/2)}function wu(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class sh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new xn,this.indexArray=new $o,this.segments=new yo,this.programConfigurations=new Zl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,d,m){const y=this.layers[0],w=[];let A=null;y.type==="circle"&&(A=y.layout.get("circle-sort-key"));for(const{feature:P,id:V,index:W,sourceLayerIndex:Q}of r){const ne=this.layers[0]._featureFilter.needGeometry,he=Hl(P,ne);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),he,d))continue;const ge=A?A.evaluate(he,{},d):void 0,Ae={id:V,properties:P.properties,type:P.type,sourceLayerIndex:Q,index:W,geometry:ne?he.geometry:il(P,d,m),patterns:{},sortKey:ge};w.push(Ae)}A&&w.sort((P,V)=>P.sortKey-V.sortKey);let k=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Un,k=m.projection);for(const P of w){const{geometry:V,index:W,sourceLayerIndex:Q}=P,ne=r[W].feature;this.addFeature(P,V,W,l.availableImages,d,k),l.featureIndex.insert(ne,V,W,Q,this.index)}}update(r,l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Hp.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Wp.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,d,m,y,w){for(const A of l)for(const k of A){const P=k.x,V=k.y;if(P<0||P>=Li||V<0||V>=Li)continue;if(w){const ne=w.projectTilePoint(P,V,y),he=w.upVector(y,P,V),ge=this.globeExtVertexArray;wu(ge,ne,he),wu(ge,ne,he),wu(ge,ne,he),wu(ge,ne,he)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),Q=W.vertexLength;bu(this.layoutVertexArray,P,V,-1,-1),bu(this.layoutVertexArray,P,V,1,-1),bu(this.layoutVertexArray,P,V,1,1),bu(this.layoutVertexArray,P,V,-1,1),this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+2,Q+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,{},m,y)}}function Ad(s,r){for(let l=0;l<s.length;l++)if(Wl(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Wl(s,r[l]))return!0;return!!lh(s,r)}function Qp(s,r,l){return!!Wl(s,r)||!!ch(r,s,l)}function Cd(s,r){if(s.length===1)return Dd(r,s[0]);for(let l=0;l<r.length;l++){const d=r[l];for(let m=0;m<d.length;m++)if(Wl(s,d[m]))return!0}for(let l=0;l<s.length;l++)if(Dd(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(lh(s,r[l]))return!0;return!1}function Jp(s,r,l){if(s.length>1){if(lh(s,r))return!0;for(let d=0;d<r.length;d++)if(ch(r[d],s,l))return!0}for(let d=0;d<s.length;d++)if(ch(s[d],r,l))return!0;return!1}function lh(s,r){if(s.length===0||r.length===0)return!1;for(let l=0;l<s.length-1;l++){const d=s[l],m=s[l+1];for(let y=0;y<r.length-1;y++)if(em(d,m,r[y],r[y+1]))return!0}return!1}function em(s,r,l,d){return Xr(s,l,d)!==Xr(r,l,d)&&Xr(s,r,l)!==Xr(s,r,d)}function ch(s,r,l){const d=l*l;if(r.length===1)return s.distSqr(r[0])<d;for(let m=1;m<r.length;m++)if(Id(s,r[m-1],r[m])<d)return!0;return!1}function Id(s,r,l){const d=r.distSqr(l);if(d===0)return s.distSqr(r);const m=((s.x-r.x)*(l.x-r.x)+(s.y-r.y)*(l.y-r.y))/d;return s.distSqr(m<0?r:m>1?l:l.sub(r)._mult(m)._add(r))}function Dd(s,r){let l,d,m,y=!1;for(let w=0;w<s.length;w++){l=s[w];for(let A=0,k=l.length-1;A<l.length;k=A++)d=l[A],m=l[k],d.y>r.y!=m.y>r.y&&r.x<(m.x-d.x)*(r.y-d.y)/(m.y-d.y)+d.x&&(y=!y)}return y}function Wl(s,r){let l=!1;for(let d=0,m=s.length-1;d<s.length;m=d++){const y=s[d],w=s[m];y.y>r.y!=w.y>r.y&&r.x<(w.x-y.x)*(r.y-y.y)/(w.y-y.y)+y.x&&(l=!l)}return l}function kd(s,r,l,d,m){for(const w of s)if(r<=w.x&&l<=w.y&&d>=w.x&&m>=w.y)return!0;const y=[new ue(r,l),new ue(r,m),new ue(d,m),new ue(d,l)];if(s.length>2){for(const w of y)if(Wl(s,w))return!0}for(let w=0;w<s.length-1;w++)if(tm(s[w],s[w+1],y))return!0;return!1}function tm(s,r,l){const d=l[0],m=l[2];if(s.x<d.x&&r.x<d.x||s.x>m.x&&r.x>m.x||s.y<d.y&&r.y<d.y||s.y>m.y&&r.y>m.y)return!1;const y=Xr(s,r,l[0]);return y!==Xr(s,r,l[1])||y!==Xr(s,r,l[2])||y!==Xr(s,r,l[3])}function pc(s,r,l){const d=r.paint.get(s).value;return d.kind==="constant"?d.value:l.programConfigurations.get(r.id).getMaxValue(s)}function Eu(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Pd(s,r,l,d,m){if(!r[0]&&!r[1])return s;const y=ue.convert(r)._mult(m);l==="viewport"&&y._rotate(-d);const w=[];for(let A=0;A<s.length;A++)w.push(s[A].sub(y));return w}function Ld(s,r,l,d){const m=ue.convert(s)._mult(d);return r==="viewport"&&m._rotate(-l),m}U(sh,"CircleBucket",{omit:["layers"]});const rm=new wi({"circle-sort-key":new Ut(Ft.layout_circle["circle-sort-key"])});var im={paint:new wi({"circle-radius":new Ut(Ft.paint_circle["circle-radius"]),"circle-color":new Ut(Ft.paint_circle["circle-color"]),"circle-blur":new Ut(Ft.paint_circle["circle-blur"]),"circle-opacity":new Ut(Ft.paint_circle["circle-opacity"]),"circle-translate":new Mt(Ft.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt(Ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt(Ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt(Ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ut(Ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ut(Ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ut(Ft.paint_circle["circle-stroke-opacity"])}),layout:rm},Tu=1e-6,Ma=typeof Float32Array<"u"?Float32Array:Array;function Rd(){var s=new Ma(9);return Ma!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Bd(s,r,l){var d=r[0],m=r[1],y=r[2],w=r[3],A=r[4],k=r[5],P=r[6],V=r[7],W=r[8],Q=l[0],ne=l[1],he=l[2],ge=l[3],Ae=l[4],je=l[5],Qe=l[6],$e=l[7],Xe=l[8];return s[0]=Q*d+ne*w+he*P,s[1]=Q*m+ne*A+he*V,s[2]=Q*y+ne*k+he*W,s[3]=ge*d+Ae*w+je*P,s[4]=ge*m+Ae*A+je*V,s[5]=ge*y+Ae*k+je*W,s[6]=Qe*d+$e*w+Xe*P,s[7]=Qe*m+$e*A+Xe*V,s[8]=Qe*y+$e*k+Xe*W,s}function Ss(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function uh(s,r){var l=r[0],d=r[1],m=r[2],y=r[3],w=r[4],A=r[5],k=r[6],P=r[7],V=r[8],W=r[9],Q=r[10],ne=r[11],he=r[12],ge=r[13],Ae=r[14],je=r[15],Qe=l*A-d*w,$e=l*k-m*w,Xe=l*P-y*w,nt=d*k-m*A,rt=d*P-y*A,Ot=m*P-y*k,Rt=V*ge-W*he,rr=V*Ae-Q*he,Mr=V*je-ne*he,Vt=W*Ae-Q*ge,sr=W*je-ne*ge,hr=Q*je-ne*Ae,vr=Qe*hr-$e*sr+Xe*Vt+nt*Mr-rt*rr+Ot*Rt;return vr?(s[0]=(A*hr-k*sr+P*Vt)*(vr=1/vr),s[1]=(m*sr-d*hr-y*Vt)*vr,s[2]=(ge*Ot-Ae*rt+je*nt)*vr,s[3]=(Q*rt-W*Ot-ne*nt)*vr,s[4]=(k*Mr-w*hr-P*rr)*vr,s[5]=(l*hr-m*Mr+y*rr)*vr,s[6]=(Ae*Xe-he*Ot-je*$e)*vr,s[7]=(V*Ot-Q*Xe+ne*$e)*vr,s[8]=(w*sr-A*Mr+P*Rt)*vr,s[9]=(d*Mr-l*sr-y*Rt)*vr,s[10]=(he*rt-ge*Xe+je*Qe)*vr,s[11]=(W*Xe-V*rt-ne*Qe)*vr,s[12]=(A*rr-w*Vt-k*Rt)*vr,s[13]=(l*Vt-d*rr+m*Rt)*vr,s[14]=(ge*$e-he*nt-Ae*Qe)*vr,s[15]=(V*nt-W*$e+Q*Qe)*vr,s):null}function Yl(s,r,l){var d=r[0],m=r[1],y=r[2],w=r[3],A=r[4],k=r[5],P=r[6],V=r[7],W=r[8],Q=r[9],ne=r[10],he=r[11],ge=r[12],Ae=r[13],je=r[14],Qe=r[15],$e=l[0],Xe=l[1],nt=l[2],rt=l[3];return s[0]=$e*d+Xe*A+nt*W+rt*ge,s[1]=$e*m+Xe*k+nt*Q+rt*Ae,s[2]=$e*y+Xe*P+nt*ne+rt*je,s[3]=$e*w+Xe*V+nt*he+rt*Qe,s[4]=($e=l[4])*d+(Xe=l[5])*A+(nt=l[6])*W+(rt=l[7])*ge,s[5]=$e*m+Xe*k+nt*Q+rt*Ae,s[6]=$e*y+Xe*P+nt*ne+rt*je,s[7]=$e*w+Xe*V+nt*he+rt*Qe,s[8]=($e=l[8])*d+(Xe=l[9])*A+(nt=l[10])*W+(rt=l[11])*ge,s[9]=$e*m+Xe*k+nt*Q+rt*Ae,s[10]=$e*y+Xe*P+nt*ne+rt*je,s[11]=$e*w+Xe*V+nt*he+rt*Qe,s[12]=($e=l[12])*d+(Xe=l[13])*A+(nt=l[14])*W+(rt=l[15])*ge,s[13]=$e*m+Xe*k+nt*Q+rt*Ae,s[14]=$e*y+Xe*P+nt*ne+rt*je,s[15]=$e*w+Xe*V+nt*he+rt*Qe,s}function Bc(s,r,l){var d,m,y,w,A,k,P,V,W,Q,ne,he,ge=l[0],Ae=l[1],je=l[2];return r===s?(s[12]=r[0]*ge+r[4]*Ae+r[8]*je+r[12],s[13]=r[1]*ge+r[5]*Ae+r[9]*je+r[13],s[14]=r[2]*ge+r[6]*Ae+r[10]*je+r[14],s[15]=r[3]*ge+r[7]*Ae+r[11]*je+r[15]):(m=r[1],y=r[2],w=r[3],A=r[4],k=r[5],P=r[6],V=r[7],W=r[8],Q=r[9],ne=r[10],he=r[11],s[0]=d=r[0],s[1]=m,s[2]=y,s[3]=w,s[4]=A,s[5]=k,s[6]=P,s[7]=V,s[8]=W,s[9]=Q,s[10]=ne,s[11]=he,s[12]=d*ge+A*Ae+W*je+r[12],s[13]=m*ge+k*Ae+Q*je+r[13],s[14]=y*ge+P*Ae+ne*je+r[14],s[15]=w*ge+V*Ae+he*je+r[15]),s}function Kl(s,r,l){var d=l[0],m=l[1],y=l[2];return s[0]=r[0]*d,s[1]=r[1]*d,s[2]=r[2]*d,s[3]=r[3]*d,s[4]=r[4]*m,s[5]=r[5]*m,s[6]=r[6]*m,s[7]=r[7]*m,s[8]=r[8]*y,s[9]=r[9]*y,s[10]=r[10]*y,s[11]=r[11]*y,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function hh(s,r,l){var d=Math.sin(l),m=Math.cos(l),y=r[4],w=r[5],A=r[6],k=r[7],P=r[8],V=r[9],W=r[10],Q=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=y*m+P*d,s[5]=w*m+V*d,s[6]=A*m+W*d,s[7]=k*m+Q*d,s[8]=P*m-y*d,s[9]=V*m-w*d,s[10]=W*m-A*d,s[11]=Q*m-k*d,s}function Su(s,r,l){var d=Math.sin(l),m=Math.cos(l),y=r[0],w=r[1],A=r[2],k=r[3],P=r[8],V=r[9],W=r[10],Q=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=y*m-P*d,s[1]=w*m-V*d,s[2]=A*m-W*d,s[3]=k*m-Q*d,s[8]=y*d+P*m,s[9]=w*d+V*m,s[10]=A*d+W*m,s[11]=k*d+Q*m,s}function Od(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Fd(s,r,l){var d,m,y,w=l[0],A=l[1],k=l[2],P=Math.hypot(w,A,k);return P<Tu?null:(w*=P=1/P,A*=P,k*=P,d=Math.sin(r),m=Math.cos(r),s[0]=w*w*(y=1-m)+m,s[1]=A*w*y+k*d,s[2]=k*w*y-A*d,s[3]=0,s[4]=w*A*y-k*d,s[5]=A*A*y+m,s[6]=k*A*y+w*d,s[7]=0,s[8]=w*k*y+A*d,s[9]=A*k*y-w*d,s[10]=k*k*y+m,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var nm=Yl;function dh(){var s=new Ma(3);return Ma!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function zd(s){var r=new Ma(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function Oc(s){return Math.hypot(s[0],s[1],s[2])}function mc(s,r,l){var d=new Ma(3);return d[0]=s,d[1]=r,d[2]=l,d}function nl(s,r,l){return s[0]=r[0]+l[0],s[1]=r[1]+l[1],s[2]=r[2]+l[2],s}function fh(s,r,l){return s[0]=r[0]-l[0],s[1]=r[1]-l[1],s[2]=r[2]-l[2],s}function Nd(s,r,l){return s[0]=r[0]*l[0],s[1]=r[1]*l[1],s[2]=r[2]*l[2],s}function Fc(s,r,l){return s[0]=Math.min(r[0],l[0]),s[1]=Math.min(r[1],l[1]),s[2]=Math.min(r[2],l[2]),s}function zc(s,r,l){return s[0]=Math.max(r[0],l[0]),s[1]=Math.max(r[1],l[1]),s[2]=Math.max(r[2],l[2]),s}function ja(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s}function Nc(s,r,l,d){return s[0]=r[0]+l[0]*d,s[1]=r[1]+l[1]*d,s[2]=r[2]+l[2]*d,s}function ua(s,r){var l=r[0],d=r[1],m=r[2],y=l*l+d*d+m*m;return y>0&&(y=1/Math.sqrt(y)),s[0]=r[0]*y,s[1]=r[1]*y,s[2]=r[2]*y,s}function os(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function ph(s,r,l){var d=r[0],m=r[1],y=r[2],w=l[0],A=l[1],k=l[2];return s[0]=m*k-y*A,s[1]=y*w-d*k,s[2]=d*A-m*w,s}function io(s,r,l){var d=r[0],m=r[1],y=r[2],w=l[3]*d+l[7]*m+l[11]*y+l[15];return s[0]=(l[0]*d+l[4]*m+l[8]*y+l[12])/(w=w||1),s[1]=(l[1]*d+l[5]*m+l[9]*y+l[13])/w,s[2]=(l[2]*d+l[6]*m+l[10]*y+l[14])/w,s}function Ud(s,r,l){var d=l[0],m=l[1],y=l[2],w=r[0],A=r[1],k=r[2],P=m*k-y*A,V=y*w-d*k,W=d*A-m*w,Q=m*W-y*V,ne=y*P-d*W,he=d*V-m*P,ge=2*l[3];return V*=ge,W*=ge,ne*=2,he*=2,s[0]=w+(P*=ge)+(Q*=2),s[1]=A+V+ne,s[2]=k+W+he,s}var Uc,Ms=fh,om=Nd,am=Oc;function $d(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s[3]=r[3]*l,s}function jd(s,r){var l=r[0],d=r[1],m=r[2],y=r[3],w=l*l+d*d+m*m+y*y;return w>0&&(w=1/Math.sqrt(w)),s[0]=l*w,s[1]=d*w,s[2]=m*w,s[3]=y*w,s}function Ql(s,r,l){var d=r[0],m=r[1],y=r[2],w=r[3];return s[0]=l[0]*d+l[4]*m+l[8]*y+l[12]*w,s[1]=l[1]*d+l[5]*m+l[9]*y+l[13]*w,s[2]=l[2]*d+l[6]*m+l[10]*y+l[14]*w,s[3]=l[3]*d+l[7]*m+l[11]*y+l[15]*w,s}function Vd(){var s=new Ma(4);return Ma!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Gd(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function qd(s,r,l){l*=.5;var d=r[0],m=r[1],y=r[2],w=r[3],A=Math.sin(l),k=Math.cos(l);return s[0]=d*k+w*A,s[1]=m*k+y*A,s[2]=y*k-m*A,s[3]=w*k-d*A,s}function Xd(s,r,l){l*=.5;var d=r[0],m=r[1],y=r[2],w=r[3],A=Math.sin(l),k=Math.cos(l);return s[0]=d*k-y*A,s[1]=m*k+w*A,s[2]=y*k+d*A,s[3]=w*k-m*A,s}dh(),Uc=new Ma(4),Ma!=Float32Array&&(Uc[0]=0,Uc[1]=0,Uc[2]=0,Uc[3]=0);var sm=jd;dh(),mc(1,0,0),mc(0,1,0),Vd(),Vd(),Rd();class mh{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,d){const m=os(l,this.dir);if(Math.abs(m)<1e-6)return!1;const y=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/m;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(r,l,d){if(function(ne,he){var ge=ne[0],Ae=ne[1],je=ne[2],Qe=he[0],$e=he[1],Xe=he[2];return Math.abs(ge-Qe)<=Tu*Math.max(1,Math.abs(ge),Math.abs(Qe))&&Math.abs(Ae-$e)<=Tu*Math.max(1,Math.abs(Ae),Math.abs($e))&&Math.abs(je-Xe)<=Tu*Math.max(1,Math.abs(je),Math.abs(Xe))}(this.pos,r)||l===0)return d[0]=d[1]=d[2]=0,!1;const[m,y,w]=this.dir,A=this.pos[0]-r[0],k=this.pos[1]-r[1],P=this.pos[2]-r[2],V=m*m+y*y+w*w,W=2*(A*m+k*y+P*w),Q=W*W-4*V*(A*A+k*k+P*P-l*l);if(Q<0){const ne=Math.max(-W/2,0),he=A+m*ne,ge=k+y*ne,Ae=P+w*ne,je=Math.hypot(he,ge,Ae);return d[0]=he*l/je,d[1]=ge*l/je,d[2]=Ae*l/je,!1}{const ne=(-W-Math.sqrt(Q))/(2*V);if(ne<0){const he=Math.hypot(A,k,P);return d[0]=A*l/he,d[1]=k*l/he,d[2]=P*l/he,!1}return d[0]=A+m*ne,d[1]=k+y*ne,d[2]=P+w*ne,!0}}}class gh{constructor(r,l,d,m,y){this.TL=r,this.TR=l,this.BR=d,this.BL=m,this.horizon=y}static fromInvProjectionMatrix(r,l,d){const m=[-1,1,1],y=[1,1,1],w=[1,-1,1],A=[-1,-1,1],k=io(m,m,r),P=io(y,y,r),V=io(w,w,r),W=io(A,A,r);return new gh(k,P,V,W,l/d)}}class _h{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,d,m){const y=Math.pow(2,d),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const P=Ql([],k,r),V=1/P[3]/l*y;return function(W,Q,ne){return W[0]=Q[0]*ne[0],W[1]=Q[1]*ne[1],W[2]=Q[2]*ne[2],W[3]=Q[3]*ne[3],W}(P,P,[V,V,m?1/P[3]:V,V])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const P=ua([],ph([],Ms([],w[k[0]],w[k[1]]),Ms([],w[k[2]],w[k[1]]))),V=-os(P,w[k[1]]);return P.concat(V)});return new _h(w,A)}}class ha{static fromPoints(r){const l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const m of r)Fc(l,l,m),zc(d,d,m);return new ha(l,d)}static applyTransform(r,l){const d=r.getCorners();for(let m=0;m<d.length;++m)io(d[m],d[m],l);return ha.fromPoints(d)}constructor(r,l){this.min=r,this.max=l,this.center=ja([],nl([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],d=zd(this.min),m=zd(this.max);for(let y=0;y<l.length;y++)d[y]=l[y]?this.min[y]:this.center[y],m[y]=l[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new ha(d,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let d=!0;for(let m=0;m<r.planes.length;m++){const y=r.planes[m];let w=0;for(let A=0;A<l.length;A++)w+=os(y,l[A])+y[3]>=0;if(w===0)return 0;w!==l.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const k=r.points[A][m]-this.min[m];y=Math.min(y,k),w=Math.max(w,k)}if(w<0||y>this.max[m]-this.min[m])return 0}return 1}}function Zd(s,r,l,d,m,y,w,A,k){if(y&&s.queryGeometry.isAboveHorizon)return!1;y&&(k*=s.pixelToTileUnitsFactor);const P=s.tileID.canonical,V=l.projection.upVectorScale(P,l.center.lat,l.worldSize).metersToTile;for(const W of r)for(const Q of W){const ne=Q.add(A),he=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(ne.x,ne.y,!0):0,ge=l.projection.projectTilePoint(ne.x,ne.y,P);if(he>0){const $e=l.projection.upVector(P,ne.x,ne.y);ge.x+=$e[0]*V*he,ge.y+=$e[1]*V*he,ge.z+=$e[2]*V*he}const Ae=y?ne:lm(ge.x,ge.y,ge.z,d),je=y?s.tilespaceRays.map($e=>um($e,he)):s.queryGeometry.screenGeometry,Qe=Ql([],[ge.x,ge.y,ge.z,1],d);if(!w&&y?k*=Qe[3]/l.cameraToCenterDistance:w&&!y&&(k*=l.cameraToCenterDistance/Qe[3]),y){const $e=jo((Q.y/Li+P.y)/(1<<P.z));k/=l.projection.pixelsPerMeter($e,1)/ns(1,$e)}if(Qp(je,Ae,k))return!0}return!1}function lm(s,r,l,d){const m=Ql([],[s,r,l,1],d);return new ue(m[0]/m[3],m[1]/m[3])}const Hd=mc(0,0,0),cm=mc(0,0,1);function um(s,r){const l=dh();return Hd[2]=r,s.intersectsPlane(Hd,cm,l),new ue(l[0],l[1])}class Wd extends sh{}function Yd(s,{width:r,height:l},d,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*l*d)throw new RangeError("mismatched image size")}else m=new Uint8Array(r*l*d);return s.width=r,s.height=l,s.data=m,s}function Kd(s,r,l){const{width:d,height:m}=r;d===s.width&&m===s.height||(yh(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,d),height:Math.min(s.height,m)},l),s.width=d,s.height=m,s.data=r.data)}function yh(s,r,l,d,m,y){if(m.width===0||m.height===0)return r;if(m.width>s.width||m.height>s.height||l.x>s.width-m.width||l.y>s.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||d.x>r.width-m.width||d.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,A=r.data;for(let k=0;k<m.height;k++){const P=((l.y+k)*s.width+l.x)*y,V=((d.y+k)*r.width+d.x)*y;for(let W=0;W<m.width*y;W++)A[V+W]=w[P+W]}return r}U(Wd,"HeatmapBucket",{omit:["layers"]});class ol{constructor(r,l){Yd(this,r,1,l)}resize(r){Kd(this,new ol(r),1)}clone(){return new ol({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,d,m,y){yh(r,l,d,m,y,1)}}class Aa{constructor(r,l){Yd(this,r,4,l)}resize(r){Kd(this,new Aa(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,d,m,y){yh(r,l,d,m,y,4)}}U(ol,"AlphaImage"),U(Aa,"RGBAImage");var hm={paint:new wi({"heatmap-radius":new Ut(Ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ut(Ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt(Ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ai(Ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt(Ft.paint_heatmap["heatmap-opacity"])})};function vh(s){const r={},l=s.resolution||256,d=s.clips?s.clips.length:1,m=s.image||new Aa({width:l,height:d}),y=(w,A,k)=>{r[s.evaluationKey]=k;const P=s.expression.evaluate(r);m.data[w+A+0]=Math.floor(255*P.r/P.a),m.data[w+A+1]=Math.floor(255*P.g/P.a),m.data[w+A+2]=Math.floor(255*P.b/P.a),m.data[w+A+3]=Math.floor(255*P.a)};if(s.clips)for(let w=0,A=0;w<d;++w,A+=4*l)for(let k=0,P=0;k<l;k++,P+=4){const V=k/(l-1),{start:W,end:Q}=s.clips[w];y(A,P,W*(1-V)+Q*V)}else for(let w=0,A=0;w<l;w++,A+=4)y(0,A,w/(l-1));return m}var dm={paint:new wi({"hillshade-illumination-direction":new Mt(Ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mt(Ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt(Ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt(Ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt(Ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt(Ft.paint_hillshade["hillshade-accent-color"])})};const fm=ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:pm}=fm;var $c={exports:{}};function Mu(s,r,l){l=l||2;var d,m,y,w,A,k,P,V=r&&r.length,W=V?r[0]*l:s.length,Q=Qd(s,0,W,l,!0),ne=[];if(!Q||Q.next===Q.prev)return ne;if(V&&(Q=function(ge,Ae,je,Qe){var $e,Xe,nt,rt=[];for($e=0,Xe=Ae.length;$e<Xe;$e++)(nt=Qd(ge,Ae[$e]*Qe,$e<Xe-1?Ae[$e+1]*Qe:ge.length,Qe,!1))===nt.next&&(nt.steiner=!0),rt.push(wm(nt));for(rt.sort(vm),$e=0;$e<rt.length;$e++)je=xm(rt[$e],je);return je}(s,r,Q,l)),s.length>80*l){d=y=s[0],m=w=s[1];for(var he=l;he<W;he+=l)(A=s[he])<d&&(d=A),(k=s[he+1])<m&&(m=k),A>y&&(y=A),k>w&&(w=k);P=(P=Math.max(y-d,w-m))!==0?32767/P:0}return jc(Q,ne,l,d,m,P,0),ne}function Qd(s,r,l,d,m){var y,w;if(m===wh(s,r,l,d)>0)for(y=r;y<l;y+=d)w=tf(y,s[y],s[y+1],w);else for(y=l-d;y>=r;y-=d)w=tf(y,s[y],s[y+1],w);return w&&Au(w,w.next)&&(Gc(w),w=w.next),w}function Jl(s,r){if(!s)return s;r||(r=s);var l,d=s;do if(l=!1,d.steiner||!Au(d,d.next)&&uo(d.prev,d,d.next)!==0)d=d.next;else{if(Gc(d),(d=r=d.prev)===d.next)break;l=!0}while(l||d!==r);return r}function jc(s,r,l,d,m,y,w){if(s){!w&&y&&function(V,W,Q,ne){var he=V;do he.z===0&&(he.z=xh(he.x,he.y,W,Q,ne)),he.prevZ=he.prev,he.nextZ=he.next,he=he.next;while(he!==V);he.prevZ.nextZ=null,he.prevZ=null,function(ge){var Ae,je,Qe,$e,Xe,nt,rt,Ot,Rt=1;do{for(je=ge,ge=null,Xe=null,nt=0;je;){for(nt++,Qe=je,rt=0,Ae=0;Ae<Rt&&(rt++,Qe=Qe.nextZ);Ae++);for(Ot=Rt;rt>0||Ot>0&&Qe;)rt!==0&&(Ot===0||!Qe||je.z<=Qe.z)?($e=je,je=je.nextZ,rt--):($e=Qe,Qe=Qe.nextZ,Ot--),Xe?Xe.nextZ=$e:ge=$e,$e.prevZ=Xe,Xe=$e;je=Qe}Xe.nextZ=null,Rt*=2}while(nt>1)}(he)}(s,d,m,y);for(var A,k,P=s;s.prev!==s.next;)if(A=s.prev,k=s.next,y?gm(s,d,m,y):mm(s))r.push(A.i/l|0),r.push(s.i/l|0),r.push(k.i/l|0),Gc(s),s=k.next,P=k.next;else if((s=k)===P){w?w===1?jc(s=_m(Jl(s),r,l),r,l,d,m,y,2):w===2&&ym(s,r,l,d,m,y):jc(Jl(s),r,l,d,m,y,1);break}}}function mm(s){var r=s.prev,l=s,d=s.next;if(uo(r,l,d)>=0)return!1;for(var m=r.x,y=l.x,w=d.x,A=r.y,k=l.y,P=d.y,V=m<y?m<w?m:w:y<w?y:w,W=A<k?A<P?A:P:k<P?k:P,Q=m>y?m>w?m:w:y>w?y:w,ne=A>k?A>P?A:P:k>P?k:P,he=d.next;he!==r;){if(he.x>=V&&he.x<=Q&&he.y>=W&&he.y<=ne&&gc(m,A,y,k,w,P,he.x,he.y)&&uo(he.prev,he,he.next)>=0)return!1;he=he.next}return!0}function gm(s,r,l,d){var m=s.prev,y=s,w=s.next;if(uo(m,y,w)>=0)return!1;for(var A=m.x,k=y.x,P=w.x,V=m.y,W=y.y,Q=w.y,ne=A<k?A<P?A:P:k<P?k:P,he=V<W?V<Q?V:Q:W<Q?W:Q,ge=A>k?A>P?A:P:k>P?k:P,Ae=V>W?V>Q?V:Q:W>Q?W:Q,je=xh(ne,he,r,l,d),Qe=xh(ge,Ae,r,l,d),$e=s.prevZ,Xe=s.nextZ;$e&&$e.z>=je&&Xe&&Xe.z<=Qe;){if($e.x>=ne&&$e.x<=ge&&$e.y>=he&&$e.y<=Ae&&$e!==m&&$e!==w&&gc(A,V,k,W,P,Q,$e.x,$e.y)&&uo($e.prev,$e,$e.next)>=0||($e=$e.prevZ,Xe.x>=ne&&Xe.x<=ge&&Xe.y>=he&&Xe.y<=Ae&&Xe!==m&&Xe!==w&&gc(A,V,k,W,P,Q,Xe.x,Xe.y)&&uo(Xe.prev,Xe,Xe.next)>=0))return!1;Xe=Xe.nextZ}for(;$e&&$e.z>=je;){if($e.x>=ne&&$e.x<=ge&&$e.y>=he&&$e.y<=Ae&&$e!==m&&$e!==w&&gc(A,V,k,W,P,Q,$e.x,$e.y)&&uo($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;Xe&&Xe.z<=Qe;){if(Xe.x>=ne&&Xe.x<=ge&&Xe.y>=he&&Xe.y<=Ae&&Xe!==m&&Xe!==w&&gc(A,V,k,W,P,Q,Xe.x,Xe.y)&&uo(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.nextZ}return!0}function _m(s,r,l){var d=s;do{var m=d.prev,y=d.next.next;!Au(m,y)&&Jd(m,d,d.next,y)&&Vc(m,y)&&Vc(y,m)&&(r.push(m.i/l|0),r.push(d.i/l|0),r.push(y.i/l|0),Gc(d),Gc(d.next),d=s=y),d=d.next}while(d!==s);return Jl(d)}function ym(s,r,l,d,m,y){var w=s;do{for(var A=w.next.next;A!==w.prev;){if(w.i!==A.i&&Em(w,A)){var k=ef(w,A);return w=Jl(w,w.next),k=Jl(k,k.next),jc(w,r,l,d,m,y,0),void jc(k,r,l,d,m,y,0)}A=A.next}w=w.next}while(w!==s)}function vm(s,r){return s.x-r.x}function xm(s,r){var l=function(m,y){var w,A=y,k=m.x,P=m.y,V=-1/0;do{if(P<=A.y&&P>=A.next.y&&A.next.y!==A.y){var W=A.x+(P-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(W<=k&&W>V&&(V=W,w=A.x<A.next.x?A:A.next,W===k))return w}A=A.next}while(A!==y);if(!w)return null;var Q,ne=w,he=w.x,ge=w.y,Ae=1/0;A=w;do k>=A.x&&A.x>=he&&k!==A.x&&gc(P<ge?k:V,P,he,ge,P<ge?V:k,P,A.x,A.y)&&(Q=Math.abs(P-A.y)/(k-A.x),Vc(A,m)&&(Q<Ae||Q===Ae&&(A.x>w.x||A.x===w.x&&bm(w,A)))&&(w=A,Ae=Q)),A=A.next;while(A!==ne);return w}(s,r);if(!l)return r;var d=ef(l,s);return Jl(d,d.next),Jl(l,l.next)}function bm(s,r){return uo(s.prev,s,r.prev)<0&&uo(r.next,s,s.next)<0}function xh(s,r,l,d,m){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-d)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function wm(s){var r=s,l=s;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==s);return l}function gc(s,r,l,d,m,y,w,A){return(m-w)*(r-A)>=(s-w)*(y-A)&&(s-w)*(d-A)>=(l-w)*(r-A)&&(l-w)*(y-A)>=(m-w)*(d-A)}function Em(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(l,d){var m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==d.i&&m.next.i!==d.i&&Jd(m,m.next,l,d))return!0;m=m.next}while(m!==l);return!1}(s,r)&&(Vc(s,r)&&Vc(r,s)&&function(l,d){var m=l,y=!1,w=(l.x+d.x)/2,A=(l.y+d.y)/2;do m.y>A!=m.next.y>A&&m.next.y!==m.y&&w<(m.next.x-m.x)*(A-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next;while(m!==l);return y}(s,r)&&(uo(s.prev,s,r.prev)||uo(s,r.prev,r))||Au(s,r)&&uo(s.prev,s,s.next)>0&&uo(r.prev,r,r.next)>0)}function uo(s,r,l){return(r.y-s.y)*(l.x-r.x)-(r.x-s.x)*(l.y-r.y)}function Au(s,r){return s.x===r.x&&s.y===r.y}function Jd(s,r,l,d){var m=Iu(uo(s,r,l)),y=Iu(uo(s,r,d)),w=Iu(uo(l,d,s)),A=Iu(uo(l,d,r));return m!==y&&w!==A||!(m!==0||!Cu(s,l,r))||!(y!==0||!Cu(s,d,r))||!(w!==0||!Cu(l,s,d))||!(A!==0||!Cu(l,r,d))}function Cu(s,r,l){return r.x<=Math.max(s.x,l.x)&&r.x>=Math.min(s.x,l.x)&&r.y<=Math.max(s.y,l.y)&&r.y>=Math.min(s.y,l.y)}function Iu(s){return s>0?1:s<0?-1:0}function Vc(s,r){return uo(s.prev,s,s.next)<0?uo(s,r,s.next)>=0&&uo(s,s.prev,r)>=0:uo(s,r,s.prev)<0||uo(s,s.next,r)<0}function ef(s,r){var l=new bh(s.i,s.x,s.y),d=new bh(r.i,r.x,r.y),m=s.next,y=r.prev;return s.next=r,r.prev=s,l.next=m,m.prev=l,d.next=l,l.prev=d,y.next=d,d.prev=y,d}function tf(s,r,l,d){var m=new bh(s,r,l);return d?(m.next=d.next,m.prev=d,d.next.prev=m,d.next=m):(m.prev=m,m.next=m),m}function Gc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function bh(s,r,l){this.i=s,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wh(s,r,l,d){for(var m=0,y=r,w=l-d;y<l;y+=d)m+=(s[w]-s[y])*(s[y+1]+s[w+1]),w=y;return m}function Tm(s,r,l,d,m){rf(s,r,l||0,d||s.length-1,m||Sm)}function rf(s,r,l,d,m){for(;d>l;){if(d-l>600){var y=d-l+1,w=r-l+1,A=Math.log(y),k=.5*Math.exp(2*A/3),P=.5*Math.sqrt(A*k*(y-k)/y)*(w-y/2<0?-1:1);rf(s,r,Math.max(l,Math.floor(r-w*k/y+P)),Math.min(d,Math.floor(r+(y-w)*k/y+P)),m)}var V=s[r],W=l,Q=d;for(qc(s,l,r),m(s[d],V)>0&&qc(s,l,d);W<Q;){for(qc(s,W,Q),W++,Q--;m(s[W],V)<0;)W++;for(;m(s[Q],V)>0;)Q--}m(s[l],V)===0?qc(s,l,Q):qc(s,++Q,d),Q<=r&&(l=Q+1),r<=Q&&(d=Q-1)}}function qc(s,r,l){var d=s[r];s[r]=s[l],s[l]=d}function Sm(s,r){return s<r?-1:s>r?1:0}function Eh(s,r){const l=s.length;if(l<=1)return[s];const d=[];let m,y;for(let w=0;w<l;w++){const A=cr(s[w]);A!==0&&(s[w].area=Math.abs(A),y===void 0&&(y=A<0),y===A<0?(m&&d.push(m),m=[s[w]]):m.push(s[w]))}if(m&&d.push(m),r>1)for(let w=0;w<d.length;w++)d[w].length<=r||(Tm(d[w],r,1,d[w].length-1,Mm),d[w]=d[w].slice(0,r));return d}function Mm(s,r){return r.area-s.area}function Th(s,r,l){const d=l.patternDependencies;let m=!1;for(const y of r){const w=y.paint.get(`${s}-pattern`);w.isConstant()||(m=!0);const A=w.constantOr(null);A&&(m=!0,d[A]=!0)}return m}function Sh(s,r,l,d,m){const y=m.patternDependencies;for(const w of r){const A=w.paint.get(`${s}-pattern`).value;if(A.kind!=="constant"){let k=A.evaluate({zoom:d},l,{},m.availableImages);k=k&&k.name?k.name:k,y[k]=!0,l.patterns[w.id]=k}}return l}$c.exports=Mu,$c.exports.default=Mu,Mu.deviation=function(s,r,l,d){var m=r&&r.length,y=Math.abs(wh(s,0,m?r[0]*l:s.length,l));if(m)for(var w=0,A=r.length;w<A;w++)y-=Math.abs(wh(s,r[w]*l,w<A-1?r[w+1]*l:s.length,l));var k=0;for(w=0;w<d.length;w+=3){var P=d[w]*l,V=d[w+1]*l,W=d[w+2]*l;k+=Math.abs((s[P]-s[W])*(s[V+1]-s[P+1])-(s[P]-s[V])*(s[W+1]-s[P+1]))}return y===0&&k===0?0:Math.abs((k-y)/y)},Mu.flatten=function(s){for(var r=s[0][0].length,l={vertices:[],holes:[],dimensions:r},d=0,m=0;m<s.length;m++){for(var y=0;y<s[m].length;y++)for(var w=0;w<r;w++)l.vertices.push(s[m][y][w]);m>0&&l.holes.push(d+=s[m-1].length)}return l};class Du{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xn,this.indexArray=new $o,this.indexArray2=new is,this.programConfigurations=new Zl(r.layers,r.zoom),this.segments=new yo,this.segments2=new yo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=r.projection}populate(r,l,d,m){this.hasPattern=Th("fill",this.layers,l);const y=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:A,id:k,index:P,sourceLayerIndex:V}of r){const W=this.layers[0]._featureFilter.needGeometry,Q=Hl(A,W);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),Q,d))continue;const ne=y?y.evaluate(Q,{},d,l.availableImages):void 0,he={id:k,properties:A.properties,type:A.type,sourceLayerIndex:V,index:P,geometry:W?Q.geometry:il(A,d,m),patterns:{},sortKey:ne};w.push(he)}y&&w.sort((A,k)=>A.sortKey-k.sortKey);for(const A of w){const{geometry:k,index:P,sourceLayerIndex:V}=A;if(this.hasPattern){const W=Sh("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(W)}else this.addFeature(A,k,P,d,{},l.availableImages);l.featureIndex.insert(r[P].feature,k,P,V,this.index)}}update(r,l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d,m)}addFeatures(r,l,d,m,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,pm),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,d,m,y,w=[]){for(const A of Eh(l,500)){let k=0;for(const he of A)k+=he.length;const P=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),V=P.vertexLength,W=[],Q=[];for(const he of A){if(he.length===0)continue;he!==A[0]&&Q.push(W.length/2);const ge=this.segments2.prepareSegment(he.length,this.layoutVertexArray,this.indexArray2),Ae=ge.vertexLength;this.layoutVertexArray.emplaceBack(he[0].x,he[0].y),this.indexArray2.emplaceBack(Ae+he.length-1,Ae),W.push(he[0].x),W.push(he[0].y);for(let je=1;je<he.length;je++)this.layoutVertexArray.emplaceBack(he[je].x,he[je].y),this.indexArray2.emplaceBack(Ae+je-1,Ae+je),W.push(he[je].x),W.push(he[je].y);ge.vertexLength+=he.length,ge.primitiveLength+=he.length}const ne=$c.exports(W,Q);for(let he=0;he<ne.length;he+=3)this.indexArray.emplaceBack(V+ne[he],V+ne[he+1],V+ne[he+2]);P.vertexLength+=k,P.primitiveLength+=ne.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,w,m)}}U(Du,"FillBucket",{omit:["layers","patternFeatures"]});const Am=new wi({"fill-sort-key":new Ut(Ft.layout_fill["fill-sort-key"])});var Cm={paint:new wi({"fill-antialias":new Mt(Ft.paint_fill["fill-antialias"]),"fill-opacity":new Ut(Ft.paint_fill["fill-opacity"]),"fill-color":new Ut(Ft.paint_fill["fill-color"]),"fill-outline-color":new Ut(Ft.paint_fill["fill-outline-color"]),"fill-translate":new Mt(Ft.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt(Ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ut(Ft.paint_fill["fill-pattern"])}),layout:Am};const Im=ti([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dm=ti([{name:"a_centroid_pos",components:2,type:"Uint16"}]),km=ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Pm}=Im;var ku={},Lm=ue,nf=_c;function _c(s,r,l,d,m){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=d,this._values=m,s.readFields(Rm,this,r)}function Rm(s,r,l){s==1?r.id=l.readVarint():s==2?function(d,m){for(var y=d.readVarint()+d.pos;d.pos<y;){var w=m._keys[d.readVarint()],A=m._values[d.readVarint()];m.properties[w]=A}}(l,r):s==3?r.type=l.readVarint():s==4&&(r._geometry=l.pos)}function Bm(s){for(var r,l,d=0,m=0,y=s.length,w=y-1;m<y;w=m++)d+=((l=s[w]).x-(r=s[m]).x)*(r.y+l.y);return d}_c.types=["Unknown","Point","LineString","Polygon"],_c.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,l=s.readVarint()+s.pos,d=1,m=0,y=0,w=0,A=[];s.pos<l;){if(m<=0){var k=s.readVarint();d=7&k,m=k>>3}if(m--,d===1||d===2)y+=s.readSVarint(),w+=s.readSVarint(),d===1&&(r&&A.push(r),r=[]),r.push(new Lm(y,w));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&A.push(r),A},_c.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,l=1,d=0,m=0,y=0,w=1/0,A=-1/0,k=1/0,P=-1/0;s.pos<r;){if(d<=0){var V=s.readVarint();l=7&V,d=V>>3}if(d--,l===1||l===2)(m+=s.readSVarint())<w&&(w=m),m>A&&(A=m),(y+=s.readSVarint())<k&&(k=y),y>P&&(P=y);else if(l!==7)throw new Error("unknown command "+l)}return[w,k,A,P]},_c.prototype.toGeoJSON=function(s,r,l){var d,m,y=this.extent*Math.pow(2,l),w=this.extent*s,A=this.extent*r,k=this.loadGeometry(),P=_c.types[this.type];function V(ne){for(var he=0;he<ne.length;he++){var ge=ne[he];ne[he]=[360*(ge.x+w)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+A)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(d=0;d<k.length;d++)W[d]=k[d][0];V(k=W);break;case 2:for(d=0;d<k.length;d++)V(k[d]);break;case 3:for(k=function(ne){var he=ne.length;if(he<=1)return[ne];for(var ge,Ae,je=[],Qe=0;Qe<he;Qe++){var $e=Bm(ne[Qe]);$e!==0&&(Ae===void 0&&(Ae=$e<0),Ae===$e<0?(ge&&je.push(ge),ge=[ne[Qe]]):ge.push(ne[Qe]))}return ge&&je.push(ge),je}(k),d=0;d<k.length;d++)for(m=0;m<k[d].length;m++)V(k[d][m])}k.length===1?k=k[0]:P="Multi"+P;var Q={type:"Feature",geometry:{type:P,coordinates:k},properties:this.properties};return"id"in this&&(Q.id=this.id),Q};var Om=nf,of=af;function af(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Fm,this,r),this.length=this._features.length}function Fm(s,r,l){s===15?r.version=l.readVarint():s===1?r.name=l.readString():s===5?r.extent=l.readVarint():s===2?r._features.push(l.pos):s===3?r._keys.push(l.readString()):s===4&&r._values.push(function(d){for(var m=null,y=d.readVarint()+d.pos;d.pos<y;){var w=d.readVarint()>>3;m=w===1?d.readString():w===2?d.readFloat():w===3?d.readDouble():w===4?d.readVarint64():w===5?d.readVarint():w===6?d.readSVarint():w===7?d.readBoolean():null}return m}(l))}af.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Om(this._pbf,r,this.extent,this._keys,this._values)};var zm=of;function Nm(s,r,l){if(s===3){var d=new zm(l,l.readVarint()+l.pos);d.length&&(r[d.name]=d)}}var Mh=ku.VectorTile=function(s,r){this.layers=s.readFields(Nm,{},r)},Pu=ku.VectorTileFeature=nf;function Lu(s,r,l,d){const m=[],y=d===0?(w,A,k,P,V,W)=>{w.push(new ue(W,k+(W-A)/(P-A)*(V-k)))}:(w,A,k,P,V,W)=>{w.push(new ue(A+(W-k)/(V-k)*(P-A),W))};for(const w of s){const A=[];for(const k of w){if(k.length<=2)continue;const P=[];for(let Q=0;Q<k.length-1;Q++){const ne=k[Q].x,he=k[Q].y,ge=k[Q+1].x,Ae=k[Q+1].y,je=d===0?ne:he,Qe=d===0?ge:Ae;je<r?Qe>r&&y(P,ne,he,ge,Ae,r):je>l?Qe<l&&y(P,ne,he,ge,Ae,l):P.push(k[Q]),Qe<r&&je>=r&&y(P,ne,he,ge,Ae,r),Qe>l&&je<=l&&y(P,ne,he,ge,Ae,l)}let V=k[k.length-1];const W=d===0?V.x:V.y;W>=r&&W<=l&&P.push(V),P.length&&(V=P[P.length-1],P[0].x===V.x&&P[0].y===V.y||P.push(P[0]),A.push(P))}A.length&&m.push(A)}return m}ku.VectorTileLayer=of;const Um=Pu.types,$m=Math.pow(2,13);function Xc(s,r,l,d,m,y,w,A){s.emplaceBack((r<<1)+w,(l<<1)+y,(Math.floor(d*$m)<<1)+m,Math.round(A))}function Zc(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class sf{constructor(){this.acc=new ue(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ue(r.x,r.y),this.max=new ue(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const d=this.min,m=this.max;r.x<d.x?d.x=r.x:r.x>m.x&&(m.x=r.x),r.y<d.y?d.y=r.y:r.y>m.y&&(m.y=r.y),((r.x===0||r.x===Li)&&r.x===l.x)!=((r.y===0||r.y===Li)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,en(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Li!=r.x>Li&&this.addBorderIntersection(1,en(l.y,r.y,(Li-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,en(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Li!=r.y>Li&&this.addBorderIntersection(3,en(l.x,r.x,(Li-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[r];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const d=r.x===0?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,r.y)}else{const d=r.y===0?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,r.x)}}centroid(){const r=this.polyCount.reduce((l,d)=>l+d.edges,0);return r!==0?this.acc.div(r)._round():new ue(0,0)}span(){return new ue(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0)}}class Hc{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new An,this.centroidVertexArray=new pd,this.indexArray=new $o,this.programConfigurations=new Zl(r.layers,r.zoom),this.segments=new yo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=r.enableTerrain}populate(r,l,d,m){this.features=[],this.hasPattern=Th("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const w=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*w/(w*w+1)/Li/(1<<y.z)}(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:w,index:A,sourceLayerIndex:k}of r){const P=this.layers[0]._featureFilter.needGeometry,V=Hl(y,P);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),V,d))continue;const W={id:w,sourceLayerIndex:k,index:A,geometry:P?V.geometry:il(y,d,m),properties:y.properties,type:y.type,patterns:{}},Q=this.layoutVertexArray.length;this.hasPattern?this.features.push(Sh("fill-extrusion",this.layers,W,this.zoom,l)):this.addFeature(W,W.geometry,A,d,{},l.availableImages,m),l.featureIndex.insert(y,W.geometry,A,k,this.index,Q)}this.sortBorders()}addFeatures(r,l,d,m,y){for(const w of this.features){const{geometry:A}=w;this.addFeature(w,A,w.index,l,d,m,y)}this.sortBorders()}update(r,l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Pm),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,km.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Dm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,d,m,y,w,A){const k=[new ue(0,0),new ue(Li,Li)],P=A.projection,V=P.name==="globe",W=this.enableTerrain&&!V?new sf:null,Q=Um[r.type]==="Polygon";V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Un);const ne=Eh(l,500);for(let je=ne.length-1;je>=0;je--){const Qe=ne[je];(Qe.length===0||(he=Qe[0]).every($e=>$e.x<=0)||he.every($e=>$e.x>=Li)||he.every($e=>$e.y<=0)||he.every($e=>$e.y>=Li))&&ne.splice(je,1)}var he;let ge;if(V)ge=pf(ne,k,m);else{ge=[];for(const je of ne)ge.push({polygon:je,bounds:k})}const Ae=Q?this.edgeRadius:0;for(const{polygon:je,bounds:Qe}of ge){let $e=0,Xe=0;for(const rt of je)Q&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),Xe+=Q?rt.length-1:rt.length;const nt=this.segments.prepareSegment((Q?5:4)*Xe,this.layoutVertexArray,this.indexArray);if(Q){const rt=[],Ot=[];$e=nt.vertexLength;for(const rr of je){let Mr,Vt;rr.length&&rr!==je[0]&&Ot.push(rt.length/2),Mr=rr[1].sub(rr[0])._perp()._unit();for(let sr=1;sr<rr.length;sr++){const hr=rr[sr],vr=rr[sr===rr.length-1?1:sr+1];let{x:Cr,y:Xt}=hr;if(Ae){Vt=vr.sub(hr)._perp()._unit();const jr=Mr.add(Vt)._unit(),Mi=Ae*Math.min(4,1/(Mr.x*jr.x+Mr.y*jr.y));Cr+=Mi*jr.x,Xt+=Mi*jr.y,Mr=Vt}Xc(this.layoutVertexArray,Cr,Xt,0,0,1,1,0),nt.vertexLength++,rt.push(hr.x,hr.y),V&&Zc(this.layoutVertexExtArray,P.projectTilePoint(Cr,Xt,m),P.upVector(m,Cr,Xt))}}const Rt=$c.exports(rt,Ot);for(let rr=0;rr<Rt.length;rr+=3)this.indexArray.emplaceBack($e+Rt[rr],$e+Rt[rr+2],$e+Rt[rr+1]),nt.primitiveLength++}for(const rt of je){W&&rt.length&&W.startRing(rt[0]);let Ot,Rt,rr,Mr=rt.length>4&&hf(rt[rt.length-2],rt[0],rt[1]),Vt=Ae?jm(rt[rt.length-2],rt[0],rt[1],Ae):0;Rt=rt[1].sub(rt[0])._perp()._unit();let sr=!0;for(let hr=1,vr=0;hr<rt.length;hr++){let Cr=rt[hr-1],Xt=rt[hr];const jr=rt[hr===rt.length-1?1:hr+1];if(W&&Q&&W.currentPolyCount.top++,uf(Xt,Cr,Qe)){Ae&&(Rt=jr.sub(Xt)._perp()._unit(),sr=!sr);continue}W&&W.append(Xt,Cr);const Mi=Xt.sub(Cr)._perp(),Zr=Mi.x/(Math.abs(Mi.x)+Math.abs(Mi.y)),ci=Mi.y>0?1:0,Vr=Cr.dist(Xt);if(vr+Vr>32768&&(vr=0),Ae){rr=jr.sub(Xt)._perp()._unit();let Wi=cf(Cr,Xt,jr,lf(Rt,rr),Ae);isNaN(Wi)&&(Wi=0);const Pi=Xt.sub(Cr)._unit();Cr=Cr.add(Pi.mult(Vt))._round(),Xt=Xt.add(Pi.mult(-Wi))._round(),Vt=Wi,Rt=rr}const Di=nt.vertexLength,nn=rt.length>4&&hf(Cr,Xt,jr);let Qi=df(vr,Mr,sr);if(Xc(this.layoutVertexArray,Cr.x,Cr.y,Zr,ci,0,0,Qi),Xc(this.layoutVertexArray,Cr.x,Cr.y,Zr,ci,0,1,Qi),vr+=Vr,Qi=df(vr,nn,!sr),Mr=nn,Xc(this.layoutVertexArray,Xt.x,Xt.y,Zr,ci,0,0,Qi),Xc(this.layoutVertexArray,Xt.x,Xt.y,Zr,ci,0,1,Qi),nt.vertexLength+=4,this.indexArray.emplaceBack(Di+0,Di+1,Di+2),this.indexArray.emplaceBack(Di+1,Di+3,Di+2),nt.primitiveLength+=2,Ae){const Wi=$e+(hr===1?rt.length-2:hr-2),Pi=hr===1?$e:Wi+1;if(this.indexArray.emplaceBack(Di+1,Wi,Di+3),this.indexArray.emplaceBack(Wi,Pi,Di+3),nt.primitiveLength+=2,Ot===void 0&&(Ot=Di),!uf(jr,rt[hr],Qe)){const Sn=hr===rt.length-1?Ot:nt.vertexLength;this.indexArray.emplaceBack(Di+2,Di+3,Sn),this.indexArray.emplaceBack(Di+3,Sn+1,Sn),this.indexArray.emplaceBack(Di+3,Pi,Sn+1),nt.primitiveLength+=3}sr=!sr}if(V){const Wi=this.layoutVertexExtArray,Pi=P.projectTilePoint(Cr.x,Cr.y,m),Sn=P.projectTilePoint(Xt.x,Xt.y,m),zi=P.upVector(m,Cr.x,Cr.y),on=P.upVector(m,Xt.x,Xt.y);Zc(Wi,Pi,zi),Zc(Wi,Pi,zi),Zc(Wi,Sn,on),Zc(Wi,Sn,on)}}Q&&($e+=rt.length-1)}}if(W&&W.polyCount.length>0){if(W.borders){W.vertexArrayOffset=this.centroidVertexArray.length;const je=W.borders,Qe=this.featuresOnBorder.push(W)-1;for(let $e=0;$e<4;$e++)je[$e][0]!==Number.MAX_VALUE&&this.borders[$e].push(Qe)}this.encodeCentroid(W.borders?void 0:W.centroid(),W)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,w,m)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((l,d)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[d].borders[r][0])}encodeCentroid(r,l,d=!0){let m,y;if(r)if(r.y!==0){const A=l.span()._mult(this.tileToMeter);m=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(A.x/10)),y=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else m=Math.ceil(7*(r.x+450)),y=0;else m=0,y=+d;let w=d?this.centroidVertexArray.length:l.vertexArrayOffset;for(const A of l.polyCount){d&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let k=0;k<A.top;k++)this.centroidVertexArray.emplace(w++,m,y);for(let k=0;k<2*A.edges;k++)this.centroidVertexArray.emplace(w++,0,y),this.centroidVertexArray.emplace(w++,m,y)}}}function lf(s,r){const l=s.add(r)._unit();return s.x*l.x+s.y*l.y}function jm(s,r,l,d){const m=r.sub(s)._perp()._unit(),y=l.sub(r)._perp()._unit();return cf(s,r,l,lf(m,y),d)}function cf(s,r,l,d,m){const y=Math.sqrt(1-d*d);return Math.min(s.dist(r)/3,r.dist(l)/3,m*y/d)}function uf(s,r,l){return s.x<l[0].x&&r.x<l[0].x||s.x>l[1].x&&r.x>l[1].x||s.y<l[0].y&&r.y<l[0].y||s.y>l[1].y&&r.y>l[1].y}function hf(s,r,l){if(s.x<0||s.x>=Li||r.x<0||r.x>=Li||l.x<0||l.x>=Li)return!1;const d=l.sub(r),m=d.perp(),y=s.sub(r);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&m.x*y.x+m.y*y.y<0}function df(s,r,l){const d=r?2|s:-3&s;return l?1|d:-2&d}function ff(){const s=Math.PI/32,r=Math.tan(s),l=xu;return l*Math.sqrt(1+2*r*r)-l}function pf(s,r,l){const d=1<<l.z,m=$a(l.x/d),y=$a((l.x+1)/d),w=jo(l.y/d),A=jo((l.y+1)/d);return function(k,P,V,W,Q=0,ne){const he=[];if(!k.length||!V||!W)return he;const ge=(rt,Ot)=>{for(const Rt of rt)he.push({polygon:Rt,bounds:Ot})},Ae=Math.ceil(Math.log2(V)),je=Math.ceil(Math.log2(W)),Qe=Ae-je,$e=[];for(let rt=0;rt<Math.abs(Qe);rt++)$e.push(Qe>0?0:1);for(let rt=0;rt<Math.min(Ae,je);rt++)$e.push(0),$e.push(1);let Xe=k;if(Xe=Lu(Xe,P[0].y-Q,P[1].y+Q,1),Xe=Lu(Xe,P[0].x-Q,P[1].x+Q,0),!Xe.length)return he;const nt=[];for($e.length?nt.push({polygons:Xe,bounds:P,depth:0}):ge(Xe,P);nt.length;){const rt=nt.pop(),Ot=rt.depth,Rt=$e[Ot],rr=rt.bounds[0],Mr=rt.bounds[1],Vt=Rt===0?rr.x:rr.y,sr=Rt===0?Mr.x:Mr.y,hr=ne?ne(Rt,Vt,sr):.5*(Vt+sr),vr=Lu(rt.polygons,Vt-Q,hr+Q,Rt),Cr=Lu(rt.polygons,hr-Q,sr+Q,Rt);if(vr.length){const Xt=[rr,new ue(Rt===0?hr:Mr.x,Rt===1?hr:Mr.y)];$e.length>Ot+1?nt.push({polygons:vr,bounds:Xt,depth:Ot+1}):ge(vr,Xt)}if(Cr.length){const Xt=[new ue(Rt===0?hr:rr.x,Rt===1?hr:rr.y),Mr];$e.length>Ot+1?nt.push({polygons:Cr,bounds:Xt,depth:Ot+1}):ge(Cr,Xt)}}return he}(s,r,Math.ceil((y-m)/11.25),Math.ceil((w-A)/11.25),1,(k,P,V)=>{if(k===0)return .5*(P+V);{const W=jo((l.y+P/Li)/d);return(zs(.5*(jo((l.y+V/Li)/d)+W))*d-l.y)*Li}})}U(Hc,"FillExtrusionBucket",{omit:["layers","features"]}),U(sf,"PartMetadata");const Vm=new wi({"fill-extrusion-edge-radius":new Mt(Ft["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Gm={paint:new wi({"fill-extrusion-opacity":new Mt(Ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ut(Ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt(Ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt(Ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ut(Ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ut(Ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ut(Ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mt(Ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mt(Ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mt(Ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Vm};function mf(s,r,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[s*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}class Ru{constructor(r,l,d){this.z=r,this.x=l,this.y=d,this.key=Wc(0,r,r,l,d)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const d=function(y,w,A){var k=mf(256*y,256*(w=Math.pow(2,A)-w-1),A),P=mf(256*(y+1),256*(w+1),A);return k[0]+","+k[1]+","+P[0]+","+P[1]}(this.x,this.y,this.z),m=function(y,w,A){let k,P="";for(let V=y;V>0;V--)k=1<<V-1,P+=(w&k?1:0)+(A&k?2:0);return P}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gf{constructor(r,l){this.wrap=r,this.canonical=l,this.key=Wc(r,l.z,l.z,l.x,l.y)}}class da{constructor(r,l,d,m,y){this.overscaledZ=r,this.wrap=l,this.canonical=new Ru(d,+m,+y),this.key=l===0&&r===d?this.canonical.key:Wc(l,r,d,m,y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new da(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new da(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return Wc(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-r;return Wc(this.wrap*+l,r,r,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new da(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y;return[new da(l,this.wrap,l,d,m),new da(l,this.wrap,l,d+1,m),new da(l,this.wrap,l,d,m+1),new da(l,this.wrap,l,d+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new da(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new da(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wc(s,r,l,d,m){const y=1<<Math.min(l,22);let w=y*(m%y)+d%y;return s&&l<22&&(w+=y*y*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*w+l)+(r-l)}U(Ru,"CanonicalTileID"),U(da,"OverscaledTileID",{omit:["projMatrix"]});class yc extends ue{constructor(r,l,d){super(r,l),this.z=d}}function Yc(s,r){return s.x*r.x+s.y*r.y}function _f(s,r){if(s.length===1){let l=0;const d=r[l++];let m;for(;!m||d.equals(m);)if(m=r[l++],!m)return 1/0;for(;l<r.length;l++){const y=r[l],w=s[0],A=m.sub(d),k=y.sub(d),P=w.sub(d),V=Yc(A,A),W=Yc(A,k),Q=Yc(k,k),ne=Yc(P,A),he=Yc(P,k),ge=V*Q-W*W,Ae=(Q*ne-W*he)/ge,je=(V*he-W*ne)/ge,Qe=d.z*(1-Ae-je)+m.z*Ae+y.z*je;if(isFinite(Qe))return Qe}return 1/0}{let l=1/0;for(const d of r)l=Math.min(l,d.z);return l}}function yf(s,r,l,d,m,y,w,A){const k=w*m.getElevationAt(s,r,!0,!0),P=y[0]!==0,V=P?y[1]===0?w*(y[0]/7-450):w*function(W,Q,ne){const he=Math.floor(Q[0]/8),ge=Math.floor(Q[1]/8),Ae=10*(Q[0]-8*he),je=10*(Q[1]-8*ge),Qe=W.getElevationAt(he,ge,!0,!0),$e=W.getMeterToDEM(ne),Xe=Math.floor(.5*(Ae*$e-1)),nt=Math.floor(.5*(je*$e-1)),rt=W.tileCoordToPixel(he,ge),Ot=2*Xe+1,Rt=2*nt+1,rr=function(Cr,Xt,jr,Mi,Zr){return[Cr.getElevationAtPixel(Xt,jr,!0),Cr.getElevationAtPixel(Xt+Zr,jr,!0),Cr.getElevationAtPixel(Xt,jr+Zr,!0),Cr.getElevationAtPixel(Xt+Mi,jr+Zr,!0)]}(W,rt.x-Xe,rt.y-nt,Ot,Rt),Mr=Math.abs(rr[0]-rr[1]),Vt=Math.abs(rr[2]-rr[3]),sr=Math.abs(rr[0]-rr[2])+Math.abs(rr[1]-rr[3]),hr=Math.min(.25,.5*$e*(Mr+Vt)/Ot),vr=Math.min(.25,.5*$e*sr/Rt);return Qe+Math.max(hr*Ae,vr*je)}(m,y,A):k;return{base:k+(l===0)?-1:l,top:P?Math.max(V+d,k+l+2):k+d}}const qm=ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Xm}=qm,Zm=ti([{name:"a_packed",components:4,type:"Float32"}]),{members:Hm}=Zm,Wm=Pu.types,Ym=Math.cos(Math.PI/180*37.5);class Bu{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new ca,this.layoutVertexArray2=new va,this.indexArray=new $o,this.programConfigurations=new Zl(r.layers,r.zoom),this.segments=new yo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,d,m){this.hasPattern=Th("line",this.layers,l);const y=this.layers[0].layout.get("line-sort-key"),w=[];for(const{feature:V,id:W,index:Q,sourceLayerIndex:ne}of r){const he=this.layers[0]._featureFilter.needGeometry,ge=Hl(V,he);if(!this.layers[0]._featureFilter.filter(new wt(this.zoom),ge,d))continue;const Ae=y?y.evaluate(ge,{},d):void 0,je={id:W,properties:V.properties,type:V.type,sourceLayerIndex:ne,index:Q,geometry:he?ge.geometry:il(V,d,m),patterns:{},sortKey:Ae};w.push(je)}y&&w.sort((V,W)=>V.sortKey-W.sortKey);const{lineAtlas:A,featureIndex:k}=l,P=this.addConstantDashes(A);for(const V of w){const{geometry:W,index:Q,sourceLayerIndex:ne}=V;if(P&&this.addFeatureDashes(V,A),this.hasPattern){const he=Sh("line",this.layers,V,this.zoom,l);this.patternFeatures.push(he)}else this.addFeature(V,W,Q,d,A.positions,l.availableImages);k.insert(r[Q].feature,W,Q,ne,this.index)}}addConstantDashes(r){let l=!1;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(m.kind!=="constant"||y.kind!=="constant")l=!0;else{const w=y.value,A=m.value;if(!A)continue;r.addDash(A,w)}}return l}addFeatureDashes(r,l){const d=this.zoom;for(const m of this.layers){const y=m.paint.get("line-dasharray").value,w=m.layout.get("line-cap").value;if(y.kind==="constant"&&w.kind==="constant")continue;let A,k;if(y.kind==="constant"){if(A=y.value,!A)continue}else A=y.evaluate({zoom:d},r);k=w.kind==="constant"?w.value:w.evaluate({zoom:d},r),l.addDash(A,k),r.patterns[m.id]=l.getKey(A,k)}}update(r,l,d,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d,m)}addFeatures(r,l,d,m,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,d,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Hm)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Xm),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,d,m,y,w){const A=this.layers[0].layout,k=A.get("line-join").evaluate(r,{}),P=A.get("line-cap").evaluate(r,{}),V=A.get("line-miter-limit"),W=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const Q of l)this.addLine(Q,r,k,P,V,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,w,m)}addLine(r,l,d,m,y,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let je=0;je<r.length-1;je++)this.totalDistance+=r[je].dist(r[je+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=Wm[l.type]==="Polygon";let k=r.length;for(;k>=2&&r[k-1].equals(r[k-2]);)k--;let P=0;for(;P<k-1&&r[P].equals(r[P+1]);)P++;if(k<(A?3:2))return;d==="bevel"&&(y=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let Q,ne,he,ge,Ae;this.e1=this.e2=-1,A&&(Q=r[k-2],Ae=r[P].sub(Q)._unit()._perp());for(let je=P;je<k;je++){if(he=je===k-1?A?r[P+1]:void 0:r[je+1],he&&r[je].equals(he))continue;Ae&&(ge=Ae),Q&&(ne=Q),Q=r[je],Ae=he?he.sub(Q)._unit()._perp():ge,ge=ge||Ae;let Qe=ge.add(Ae);Qe.x===0&&Qe.y===0||Qe._unit();const $e=ge.x*Ae.x+ge.y*Ae.y,Xe=Qe.x*Ae.x+Qe.y*Ae.y,nt=Xe!==0?1/Xe:1/0,rt=2*Math.sqrt(2-2*Xe),Ot=Xe<Ym&&ne&&he,Rt=ge.x*Ae.y-ge.y*Ae.x>0;if(Ot&&je>P){const Vt=Q.dist(ne);if(Vt>2*V){const sr=Q.sub(Q.sub(ne)._mult(V/Vt)._round());this.updateDistance(ne,sr),this.addCurrentVertex(sr,ge,0,0,W),ne=sr}}const rr=ne&&he;let Mr=rr?d:A?"butt":m;if(rr&&Mr==="round"&&(nt<w?Mr="miter":nt<=2&&(Mr="fakeround")),Mr==="miter"&&nt>y&&(Mr="bevel"),Mr==="bevel"&&(nt>2&&(Mr="flipbevel"),nt<y&&(Mr="miter")),ne&&this.updateDistance(ne,Q),Mr==="miter")Qe._mult(nt),this.addCurrentVertex(Q,Qe,0,0,W);else if(Mr==="flipbevel"){if(nt>100)Qe=Ae.mult(-1);else{const Vt=nt*ge.add(Ae).mag()/ge.sub(Ae).mag();Qe._perp()._mult(Vt*(Rt?-1:1))}this.addCurrentVertex(Q,Qe,0,0,W),this.addCurrentVertex(Q,Qe.mult(-1),0,0,W)}else if(Mr==="bevel"||Mr==="fakeround"){const Vt=-Math.sqrt(nt*nt-1),sr=Rt?Vt:0,hr=Rt?0:Vt;if(ne&&this.addCurrentVertex(Q,ge,sr,hr,W),Mr==="fakeround"){const vr=Math.round(180*rt/Math.PI/20);for(let Cr=1;Cr<vr;Cr++){let Xt=Cr/vr;if(Xt!==.5){const Mi=Xt-.5;Xt+=Xt*Mi*(Xt-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*Mi*Mi+(.848013+$e*(.215638*$e-1.06021)))}const jr=Ae.sub(ge)._mult(Xt)._add(ge)._unit()._mult(Rt?-1:1);this.addHalfVertex(Q,jr.x,jr.y,!1,Rt,0,W)}}he&&this.addCurrentVertex(Q,Ae,-sr,-hr,W)}else if(Mr==="butt")this.addCurrentVertex(Q,Qe,0,0,W);else if(Mr==="square"){const Vt=ne?1:-1;ne||this.addCurrentVertex(Q,Qe,Vt,Vt,W),this.addCurrentVertex(Q,Qe,0,0,W),ne&&this.addCurrentVertex(Q,Qe,Vt,Vt,W)}else Mr==="round"&&(ne&&(this.addCurrentVertex(Q,ge,0,0,W),this.addCurrentVertex(Q,ge,1,1,W,!0)),he&&(this.addCurrentVertex(Q,Ae,-1,-1,W,!0),this.addCurrentVertex(Q,Ae,0,0,W)));if(Ot&&je<k-1){const Vt=Q.dist(he);if(Vt>2*V){const sr=Q.add(he.sub(Q)._mult(V/Vt)._round());this.updateDistance(Q,sr),this.addCurrentVertex(sr,Ae,0,0,W),Q=sr}}}}addCurrentVertex(r,l,d,m,y,w=!1){const A=l.y*m-l.x,k=-l.y-l.x*m;this.addHalfVertex(r,l.x+l.y*d,l.y-l.x*d,w,!1,d,y),this.addHalfVertex(r,A,k,w,!0,-m,y)}addHalfVertex({x:r,y:l},d,m,y,w,A,k){this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(l<<1)+(w?1:0),Math.round(63*d)+128,Math.round(63*m)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const P=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),k.primitiveLength++),w?this.e2=P:this.e1=P}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}U(Bu,"LineBucket",{omit:["layers","patternFeatures"]});const Km=new wi({"line-cap":new Ut(Ft.layout_line["line-cap"]),"line-join":new Ut(Ft.layout_line["line-join"]),"line-miter-limit":new Mt(Ft.layout_line["line-miter-limit"]),"line-round-limit":new Mt(Ft.layout_line["line-round-limit"]),"line-sort-key":new Ut(Ft.layout_line["line-sort-key"])});var vf={paint:new wi({"line-opacity":new Ut(Ft.paint_line["line-opacity"]),"line-color":new Ut(Ft.paint_line["line-color"]),"line-translate":new Mt(Ft.paint_line["line-translate"]),"line-translate-anchor":new Mt(Ft.paint_line["line-translate-anchor"]),"line-width":new Ut(Ft.paint_line["line-width"]),"line-gap-width":new Ut(Ft.paint_line["line-gap-width"]),"line-offset":new Ut(Ft.paint_line["line-offset"]),"line-blur":new Ut(Ft.paint_line["line-blur"]),"line-dasharray":new Ut(Ft.paint_line["line-dasharray"]),"line-pattern":new Ut(Ft.paint_line["line-pattern"]),"line-gradient":new ai(Ft.paint_line["line-gradient"]),"line-trim-offset":new Mt(Ft.paint_line["line-trim-offset"])}),layout:Km};const xf=new class extends Ut{possiblyEvaluate(s,r){return r=new wt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,l,d){return r=_t({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,l,d)}}(vf.paint.properties["line-width"].specification);function bf(s,r){return r>0?r+2*s:s}xf.useIntegerZoom=!0;const Qm=ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jm=ti([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),eg=ti([{name:"a_projected_pos",components:4,type:"Float32"}],4);ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tg=ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),rg=ti([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wf=ti([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ig=ti([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ti([{name:"triangle",components:3,type:"Uint16"}]),ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ti([{type:"Float32",name:"offsetX"}]),ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Vo=24;const Us=128;function Ah(s,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new wt(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:m}=l;let y=0;for(;y<d.length&&d[y]<=s;)y++;y=Math.max(0,y-1);let w=y;for(;w<d.length&&d[w]<s+1;)w++;w=Math.min(d.length-1,w);const A=d[y],k=d[w];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:k,interpolationType:m}:{kind:"camera",minZoom:A,maxZoom:k,minSize:l.evaluate(new wt(A)),maxSize:l.evaluate(new wt(k)),interpolationType:m}}}function Ou(s,{uSize:r,uSizeT:l},{lowerSize:d,upperSize:m}){return s.kind==="source"?d/Us:s.kind==="composite"?en(d/Us,m/Us,l):r}function vc(s,r){let l=0,d=0;if(s.kind==="constant")d=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:m,minZoom:y,maxZoom:w}=s,A=m?xt(Wt.interpolationFactor(m,r,y,w),0,1):0;s.kind==="camera"?d=en(s.minSize,s.maxSize,A):l=A}return{uSizeT:l,uSize:d}}var ng=Object.freeze({__proto__:null,getSizeData:Ah,evaluateSizeForFeature:Ou,evaluateSizeForZoom:vc,SIZE_PACK_FACTOR:Us});function og(s,r,l){return s.sections.forEach(d=>{d.text=function(m,y,w){const A=y.layout.get("text-transform").evaluate(w,{});return A==="uppercase"?m=m.toLocaleUpperCase():A==="lowercase"&&(m=m.toLocaleLowerCase()),Lt.applyArabicShaping&&(m=Lt.applyArabicShaping(m)),m}(d.text,r,l)}),s}const Kc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function ag(s){return s==="\uFE36"||s==="\uFE48"||s==="\uFE38"||s==="\uFE44"||s==="\uFE42"||s==="\uFE3E"||s==="\uFE3C"||s==="\uFE3A"||s==="\uFE18"||s==="\uFE40"||s==="\uFE10"||s==="\uFE13"||s==="\uFE14"||s==="\uFF40"||s==="\uFFE3"||s==="\uFE11"||s==="\uFE12"}function sg(s){return s==="\uFE35"||s==="\uFE47"||s==="\uFE37"||s==="\uFE43"||s==="\uFE41"||s==="\uFE3D"||s==="\uFE3B"||s==="\uFE39"||s==="\uFE17"||s==="\uFE3F"}var Qc=Fn,Ef=function(s,r,l,d,m){var y,w,A=8*m-d-1,k=(1<<A)-1,P=k>>1,V=-7,W=l?m-1:0,Q=l?-1:1,ne=s[r+W];for(W+=Q,y=ne&(1<<-V)-1,ne>>=-V,V+=A;V>0;y=256*y+s[r+W],W+=Q,V-=8);for(w=y&(1<<-V)-1,y>>=-V,V+=d;V>0;w=256*w+s[r+W],W+=Q,V-=8);if(y===0)y=1-P;else{if(y===k)return w?NaN:1/0*(ne?-1:1);w+=Math.pow(2,d),y-=P}return(ne?-1:1)*w*Math.pow(2,y-d)},Tf=function(s,r,l,d,m,y){var w,A,k,P=8*y-m-1,V=(1<<P)-1,W=V>>1,Q=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=d?0:y-1,he=d?1:-1,ge=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(A=isNaN(r)?1:0,w=V):(w=Math.floor(Math.log(r)/Math.LN2),r*(k=Math.pow(2,-w))<1&&(w--,k*=2),(r+=w+W>=1?Q/k:Q*Math.pow(2,1-W))*k>=2&&(w++,k/=2),w+W>=V?(A=0,w=V):w+W>=1?(A=(r*k-1)*Math.pow(2,m),w+=W):(A=r*Math.pow(2,W-1)*Math.pow(2,m),w=0));m>=8;s[l+ne]=255&A,ne+=he,A/=256,m-=8);for(w=w<<m|A,P+=m;P>0;s[l+ne]=255&w,ne+=he,w/=256,P-=8);s[l+ne-he]|=128*ge};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Fn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Fn.Varint=0,Fn.Fixed64=1,Fn.Bytes=2,Fn.Fixed32=5;var Ch=4294967296,Sf=1/Ch,Mf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function al(s){return s.type===Fn.Bytes?s.readVarint()+s.pos:s.pos+1}function xc(s,r,l){return l?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function Af(s,r,l){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(d);for(var m=l.pos-1;m>=s;m--)l.buf[m+d]=l.buf[m]}function lg(s,r){for(var l=0;l<s.length;l++)r.writeVarint(s[l])}function cg(s,r){for(var l=0;l<s.length;l++)r.writeSVarint(s[l])}function ug(s,r){for(var l=0;l<s.length;l++)r.writeFloat(s[l])}function hg(s,r){for(var l=0;l<s.length;l++)r.writeDouble(s[l])}function dg(s,r){for(var l=0;l<s.length;l++)r.writeBoolean(s[l])}function fg(s,r){for(var l=0;l<s.length;l++)r.writeFixed32(s[l])}function pg(s,r){for(var l=0;l<s.length;l++)r.writeSFixed32(s[l])}function mg(s,r){for(var l=0;l<s.length;l++)r.writeFixed64(s[l])}function gg(s,r){for(var l=0;l<s.length;l++)r.writeSFixed64(s[l])}function Fu(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function bc(s,r,l){s[l]=r,s[l+1]=r>>>8,s[l+2]=r>>>16,s[l+3]=r>>>24}function Cf(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}function _g(s,r,l){r.glyphs=[],s===1&&l.readMessage(yg,r)}function yg(s,r,l){if(s===3){const{id:d,bitmap:m,width:y,height:w,left:A,top:k,advance:P}=l.readMessage(vg,{});r.glyphs.push({id:d,bitmap:new ol({width:y+6,height:w+6},m),metrics:{width:y,height:w,left:A,top:k,advance:P}})}else s===4?r.ascender=l.readSVarint():s===5&&(r.descender=l.readSVarint())}function vg(s,r,l){s===1?r.id=l.readVarint():s===2?r.bitmap=l.readBytes():s===3?r.width=l.readVarint():s===4?r.height=l.readVarint():s===5?r.left=l.readSVarint():s===6?r.top=l.readSVarint():s===7&&(r.advance=l.readVarint())}function Ih(s){let r=0,l=0;for(const w of s)r+=w.w*w.h,l=Math.max(l,w.w);s.sort((w,A)=>A.h-w.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let m=0,y=0;for(const w of s)for(let A=d.length-1;A>=0;A--){const k=d[A];if(!(w.w>k.w||w.h>k.h)){if(w.x=k.x,w.y=k.y,y=Math.max(y,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===k.w&&w.h===k.h){const P=d.pop();A<d.length&&(d[A]=P)}else w.h===k.h?(k.x+=w.w,k.w-=w.w):w.w===k.w?(k.y+=w.h,k.h-=w.h):(d.push({x:k.x+w.w,y:k.y,w:k.w-w.w,h:w.h}),k.y+=w.h,k.h-=w.h);break}}return{w:m,h:y,fill:r/(m*y)||0}}Fn.prototype={destroy:function(){this.buf=null},readFields:function(s,r,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),m=d>>3,y=this.pos;this.type=7&d,s(m,r,this),this.pos===y&&this.skip(d)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=Fu(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Cf(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Fu(this.buf,this.pos)+Fu(this.buf,this.pos+4)*Ch;return this.pos+=8,s},readSFixed64:function(){var s=Fu(this.buf,this.pos)+Cf(this.buf,this.pos+4)*Ch;return this.pos+=8,s},readFloat:function(){var s=Ef(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Ef(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,l,d=this.buf;return r=127&(l=d[this.pos++]),l<128?r:(r|=(127&(l=d[this.pos++]))<<7,l<128?r:(r|=(127&(l=d[this.pos++]))<<14,l<128?r:(r|=(127&(l=d[this.pos++]))<<21,l<128?r:function(m,y,w){var A,k,P=w.buf;if(A=(112&(k=P[w.pos++]))>>4,k<128||(A|=(127&(k=P[w.pos++]))<<3,k<128)||(A|=(127&(k=P[w.pos++]))<<10,k<128)||(A|=(127&(k=P[w.pos++]))<<17,k<128)||(A|=(127&(k=P[w.pos++]))<<24,k<128)||(A|=(1&(k=P[w.pos++]))<<31,k<128))return xc(m,A,y);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=d[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&Mf?function(l,d,m){return Mf.decode(l.subarray(d,m))}(this.buf,r,s):function(l,d,m){for(var y="",w=d;w<m;){var A,k,P,V=l[w],W=null,Q=V>239?4:V>223?3:V>191?2:1;if(w+Q>m)break;Q===1?V<128&&(W=V):Q===2?(192&(A=l[w+1]))==128&&(W=(31&V)<<6|63&A)<=127&&(W=null):Q===3?(k=l[w+2],(192&(A=l[w+1]))==128&&(192&k)==128&&((W=(15&V)<<12|(63&A)<<6|63&k)<=2047||W>=55296&&W<=57343)&&(W=null)):Q===4&&(k=l[w+2],P=l[w+3],(192&(A=l[w+1]))==128&&(192&k)==128&&(192&P)==128&&((W=(15&V)<<18|(63&A)<<12|(63&k)<<6|63&P)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,Q=1):W>65535&&(W-=65536,y+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),y+=String.fromCharCode(W),w+=Q}return y}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Fn.Bytes)return s.push(this.readVarint(r));var l=al(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Fn.Bytes)return s.push(this.readSVarint());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Fn.Bytes)return s.push(this.readBoolean());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Fn.Bytes)return s.push(this.readFloat());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Fn.Bytes)return s.push(this.readDouble());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Fn.Bytes)return s.push(this.readFixed32());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Fn.Bytes)return s.push(this.readSFixed32());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Fn.Bytes)return s.push(this.readFixed64());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Fn.Bytes)return s.push(this.readSFixed64());var r=al(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Fn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Fn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Fn.Fixed32)this.pos+=4;else{if(r!==Fn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),bc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),bc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),bc(this.buf,-1&s,this.pos),bc(this.buf,Math.floor(s*Sf),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),bc(this.buf,-1&s,this.pos),bc(this.buf,Math.floor(s*Sf),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,l){var d,m;if(r>=0?(d=r%4294967296|0,m=r/4294967296|0):(m=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,m=m+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(y,w,A){A.buf[A.pos++]=127&y|128,y>>>=7,A.buf[A.pos++]=127&y|128,y>>>=7,A.buf[A.pos++]=127&y|128,y>>>=7,A.buf[A.pos++]=127&y|128,A.buf[A.pos]=127&(y>>>=7)}(d,0,l),function(y,w){var A=(7&y)<<4;w.buf[w.pos++]|=A|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))}(m,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(d,m,y){for(var w,A,k=0;k<m.length;k++){if((w=m.charCodeAt(k))>55295&&w<57344){if(!A){w>56319||k+1===m.length?(d[y++]=239,d[y++]=191,d[y++]=189):A=w;continue}if(w<56320){d[y++]=239,d[y++]=191,d[y++]=189,A=w;continue}w=A-55296<<10|w-56320|65536,A=null}else A&&(d[y++]=239,d[y++]=191,d[y++]=189,A=null);w<128?d[y++]=w:(w<2048?d[y++]=w>>6|192:(w<65536?d[y++]=w>>12|224:(d[y++]=w>>18|240,d[y++]=w>>12&63|128),d[y++]=w>>6&63|128),d[y++]=63&w|128)}return y}(this.buf,s,this.pos);var l=this.pos-r;l>=128&&Af(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),Tf(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Tf(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,r){this.pos++;var l=this.pos;s(r,this);var d=this.pos-l;d>=128&&Af(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(s,r,l){this.writeTag(s,Fn.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,lg,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,cg,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,dg,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,ug,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,hg,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,fg,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,pg,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,mg,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,gg,r)},writeBytesField:function(s,r){this.writeTag(s,Fn.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Fn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Fn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Fn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Fn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Fn.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Fn.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Fn.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Fn.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Fn.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};class Dh{constructor(r,{pixelRatio:l,version:d,stretchX:m,stretchY:y,content:w}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=m,this.stretchY=y,this.content=w,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class If{constructor(r,l){const d={},m={};this.haveRenderCallbacks=[];const y=[];this.addImages(r,d,y),this.addImages(l,m,y);const{w,h:A}=Ih(y),k=new Aa({width:w||1,height:A||1});for(const P in r){const V=r[P],W=d[P].paddedRect;Aa.copy(V.data,k,{x:0,y:0},{x:W.x+1,y:W.y+1},V.data)}for(const P in l){const V=l[P],W=m[P].paddedRect,Q=W.x+1,ne=W.y+1,he=V.data.width,ge=V.data.height;Aa.copy(V.data,k,{x:0,y:0},{x:Q,y:ne},V.data),Aa.copy(V.data,k,{x:0,y:ge-1},{x:Q,y:ne-1},{width:he,height:1}),Aa.copy(V.data,k,{x:0,y:0},{x:Q,y:ne+ge},{width:he,height:1}),Aa.copy(V.data,k,{x:he-1,y:0},{x:Q-1,y:ne},{width:1,height:ge}),Aa.copy(V.data,k,{x:0,y:0},{x:Q+he,y:ne},{width:1,height:ge})}this.image=k,this.iconPositions=d,this.patternPositions=m}addImages(r,l,d){for(const m in r){const y=r[m],w={x:0,y:0,w:y.data.width+2,h:y.data.height+2};d.push(w),l[m]=new Dh(w,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>r.hasImage(d)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in r.updatedImages)this.patchUpdatedImage(this.iconPositions[d],r.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],r.getImage(d),l)}patchUpdatedImage(r,l,d){if(!r||!l||r.version===l.version)return;r.version=l.version;const[m,y]=r.tl;d.update(l.data,void 0,{x:m,y})}}U(Dh,"ImagePosition"),U(If,"ImageAtlas");const Va={horizontal:1,vertical:2,horizontalOnly:3};class Jc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const d=new Jc;return d.scale=r||1,d.fontStack=l,d}static forImage(r){const l=new Jc;return l.imageName=r,l}}class wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const d=new wc;for(let m=0;m<r.sections.length;m++){const y=r.sections[m];y.image?d.addImageSection(y):d.addTextSection(y,l)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(l,d){let m="";for(let y=0;y<l.length;y++){const w=l.charCodeAt(y+1)||null,A=l.charCodeAt(y-1)||null;m+=!d&&(w&&te(w)&&!Kc[l[y+1]]||A&&te(A)&&!Kc[l[y-1]])||!Kc[l[y]]?l[y]:Kc[l[y]]}return m}(this.text,r)}trim(){let r=0;for(let d=0;d<this.text.length&&zu[this.text.charCodeAt(d)];d++)r++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=r&&zu[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const d=new wc;return d.text=this.text.substring(r,l),d.sectionIndex=this.sectionIndex.slice(r,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(Jc.forText(r.scale,r.fontStack||l));const d=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(d)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void Br("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Jc.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Br("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kh(s,r,l,d,m,y,w,A,k,P,V,W,Q,ne,he){const ge=wc.fromFeature(s,m);W===Va.vertical&&ge.verticalizePunctuation(Q);let Ae=[];const je=function(rt,Ot,Rt,rr,Mr,Vt){if(!rt)return[];const sr=[],hr=function(jr,Mi,Zr,ci,Vr,Di){let nn=0;for(let Qi=0;Qi<jr.length();Qi++){const Wi=jr.getSection(Qi);nn+=Df(jr.getCharCode(Qi),Wi,ci,Vr,Mi,Di)}return nn/Math.max(1,Math.ceil(nn/Zr))}(rt,Ot,Rt,rr,Mr,Vt),vr=rt.text.indexOf("\u200B")>=0;let Cr=0;for(let jr=0;jr<rt.length();jr++){const Mi=rt.getSection(jr),Zr=rt.getCharCode(jr);if(zu[Zr]||(Cr+=Df(Zr,Mi,rr,Mr,Ot,Vt)),jr<rt.length()-1){const ci=!((Xt=Zr)<11904||!(ln(Xt)||Ii(Xt)||p(Xt)||Gl(Xt)||Ja(Xt)||bt(Xt)||un(Xt)||Fr(Xt)||Ua(Xt)||bs(Xt)||Kn(Xt)||I(Xt)||Ht(Xt)||$r(Xt)||or(Xt)||Io(Xt)||vi(Xt)||c(Xt)||pu(Xt)||vl(Xt)));(xg[Zr]||ci||Mi.imageName)&&sr.push(Pf(jr+1,Cr,hr,sr,bg(Zr,rt.getCharCode(jr+1),ci&&vr),!1))}}var Xt;return Lf(Pf(rt.length(),Cr,hr,sr,0,!0))}(ge,P,y,r,d,ne),{processBidirectionalText:Qe,processStyledBidirectionalText:$e}=Lt;if(Qe&&ge.sections.length===1){const rt=Qe(ge.toString(),je);for(const Ot of rt){const Rt=new wc;Rt.text=Ot,Rt.sections=ge.sections;for(let rr=0;rr<Ot.length;rr++)Rt.sectionIndex.push(0);Ae.push(Rt)}}else if($e){const rt=$e(ge.text,ge.sectionIndex,je);for(const Ot of rt){const Rt=new wc;Rt.text=Ot[0],Rt.sectionIndex=Ot[1],Rt.sections=ge.sections,Ae.push(Rt)}}else Ae=function(rt,Ot){const Rt=[],rr=rt.text;let Mr=0;for(const Vt of Ot)Rt.push(rt.substring(Mr,Vt)),Mr=Vt;return Mr<rr.length&&Rt.push(rt.substring(Mr,rr.length)),Rt}(ge,je);const Xe=[],nt={positionedLines:Xe,text:ge.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:W,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(rt,Ot,Rt,rr,Mr,Vt,sr,hr,vr,Cr,Xt,jr){let Mi=0,Zr=0,ci=0;const Vr=hr==="right"?1:hr==="left"?0:.5;let Di=!1;for(const zi of Mr){const on=zi.getSections();for(const Cn of on){if(Cn.imageName)continue;const $n=Ot[Cn.fontStack];if($n&&(Di=$n.ascender!==void 0&&$n.descender!==void 0,!Di))break}if(!Di)break}let nn=0;for(const zi of Mr){zi.trim();const on=zi.getMaxScale(),Cn=(on-1)*Vo,$n={positionedGlyphs:[],lineOffset:0};rt.positionedLines[nn]=$n;const zn=$n.positionedGlyphs;let jn=0;if(!zi.length()){Zr+=Vt,++nn;continue}let Gn=0,Jn=0;for(let Mn=0;Mn<zi.length();Mn++){const vo=zi.getSection(Mn),ho=zi.getSectionIndex(Mn),yn=zi.getCharCode(Mn);let Yn=vo.scale,So=null,In=null,no=null,ea=Vo,ko=0;const Po=!(vr===Va.horizontal||!Xt&&!re(yn)||Xt&&(zu[yn]||(Qi=yn,Se(Qi)||Ue(Qi)||tt(Qi)||_(Qi)||S(Qi))));if(vo.imageName){const fa=rr[vo.imageName];if(!fa)continue;no=vo.imageName,rt.iconsInText=rt.iconsInText||!0,In=fa.paddedRect;const Lo=fa.displaySize;Yn=Yn*Vo/jr,So={width:Lo[0],height:Lo[1],left:1,top:-3,advance:Po?Lo[1]:Lo[0],localGlyph:!1},ko=Di?-So.height*Yn:on*Vo-17-Lo[1]*Yn,ea=So.advance;const cl=(Po?Lo[0]:Lo[1])*Yn-Vo*on;cl>0&&cl>jn&&(jn=cl)}else{const fa=Rt[vo.fontStack];if(!fa)continue;fa[yn]&&(In=fa[yn]);const Lo=Ot[vo.fontStack];if(!Lo)continue;const cl=Lo.glyphs[yn];if(!cl)continue;if(So=cl.metrics,ea=yn!==8203?Vo:0,Di){const kc=Lo.ascender!==void 0?Math.abs(Lo.ascender):0,hu=Lo.descender!==void 0?Math.abs(Lo.descender):0,du=(kc+hu)*Yn;Gn<du&&(Gn=du,Jn=(kc-hu)/2*Yn),ko=-kc*Yn}else ko=(on-Yn)*Vo-17}Po?(rt.verticalizable=!0,zn.push({glyph:yn,imageName:no,x:Mi,y:Zr+ko,vertical:Po,scale:Yn,localGlyph:So.localGlyph,fontStack:vo.fontStack,sectionIndex:ho,metrics:So,rect:In}),Mi+=ea*Yn+Cr):(zn.push({glyph:yn,imageName:no,x:Mi,y:Zr+ko,vertical:Po,scale:Yn,localGlyph:So.localGlyph,fontStack:vo.fontStack,sectionIndex:ho,metrics:So,rect:In}),Mi+=So.advance*Yn+Cr)}zn.length!==0&&(ci=Math.max(Mi-Cr,ci),Di?Rf(zn,Vr,jn,Jn,Vt*on/2):Rf(zn,Vr,jn,0,Vt/2)),Mi=0;const Do=Vt*on+jn;$n.lineOffset=Math.max(jn,Cn),Zr+=Do,++nn}var Qi;const Wi=Zr,{horizontalAlign:Pi,verticalAlign:Sn}=Ph(sr);(function(zi,on,Cn,$n,zn,jn){const Gn=(on-Cn)*zn,Jn=-jn*$n;for(const Do of zi)for(const Mn of Do.positionedGlyphs)Mn.x+=Gn,Mn.y+=Jn})(rt.positionedLines,Vr,Pi,Sn,ci,Wi),rt.top+=-Sn*Wi,rt.bottom=rt.top+Wi,rt.left+=-Pi*ci,rt.right=rt.left+ci,rt.hasBaseline=Di}(nt,r,l,d,Ae,w,A,k,W,P,Q,he),!function(rt){for(const Ot of rt)if(Ot.positionedGlyphs.length!==0)return!1;return!0}(Xe)&&nt}const zu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Df(s,r,l,d,m,y){if(r.imageName){const w=d[r.imageName];return w?w.displaySize[0]*r.scale*Vo/y+m:0}{const w=l[r.fontStack],A=w&&w.glyphs[s];return A?A.metrics.advance*r.scale+m:0}}function kf(s,r,l,d){const m=Math.pow(s-r,2);return d?s<r?m/2:2*m:m+Math.abs(l)*l}function bg(s,r,l){let d=0;return s===10&&(d-=1e4),l&&(d+=150),s!==40&&s!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function Pf(s,r,l,d,m,y){let w=null,A=kf(r,l,m,y);for(const k of d){const P=kf(r-k.x,l,m,y)+k.badness;P<=A&&(w=k,A=P)}return{index:s,x:r,priorBreak:w,badness:A}}function Lf(s){return s?Lf(s.priorBreak).concat(s.index):[]}function Ph(s){let r=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function Rf(s,r,l,d,m){if(!(r||l||d||m))return;const y=s.length-1,w=s[y],A=(w.x+w.metrics.advance*w.scale)*r;for(let k=0;k<=y;k++)s[k].x-=A,s[k].y+=l+d+m}function wg(s,r,l){const{horizontalAlign:d,verticalAlign:m}=Ph(l),y=r[0]-s.displaySize[0]*d,w=r[1]-s.displaySize[1]*m;return{image:s,top:w,bottom:w+s.displaySize[1],left:y,right:y+s.displaySize[0]}}function Bf(s,r,l,d,m,y){const w=s.image;let A;if(w.content){const Ae=w.content,je=w.pixelRatio||1;A=[Ae[0]/je,Ae[1]/je,w.displaySize[0]-Ae[2]/je,w.displaySize[1]-Ae[3]/je]}const k=r.left*y,P=r.right*y;let V,W,Q,ne;l==="width"||l==="both"?(ne=m[0]+k-d[3],W=m[0]+P+d[1]):(ne=m[0]+(k+P-w.displaySize[0])/2,W=ne+w.displaySize[0]);const he=r.top*y,ge=r.bottom*y;return l==="height"||l==="both"?(V=m[1]+he-d[0],Q=m[1]+ge+d[2]):(V=m[1]+(he+ge-w.displaySize[1])/2,Q=V+w.displaySize[1]),{image:w,top:V,right:W,bottom:Q,left:ne,collisionPadding:A}}class sl extends ue{constructor(r,l,d,m,y){super(r,l),this.angle=m,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new sl(this.x,this.y,this.z,this.angle,this.segment)}}function Of(s,r,l,d,m){if(r.segment===void 0)return!0;let y=r,w=r.segment+1,A=0;for(;A>-l/2;){if(w--,w<0)return!1;A-=s[w].dist(y),y=s[w]}A+=s[w].dist(s[w+1]),w++;const k=[];let P=0;for(;A<l/2;){const V=s[w],W=s[w+1];if(!W)return!1;let Q=s[w-1].angleTo(V)-V.angleTo(W);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:A,angleDelta:Q}),P+=Q;A-k[0].distance>d;)P-=k.shift().angleDelta;if(P>m)return!1;w++,A+=V.dist(W)}return!0}function Ff(s){let r=0;for(let l=0;l<s.length-1;l++)r+=s[l].dist(s[l+1]);return r}function zf(s,r,l){return s?.6*r*l:0}function Nf(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function Eg(s,r,l,d,m,y){const w=zf(l,m,y),A=Nf(l,d)*y;let k=0;const P=Ff(s)/2;for(let V=0;V<s.length-1;V++){const W=s[V],Q=s[V+1],ne=W.dist(Q);if(k+ne>P){const he=(P-k)/ne,ge=en(W.x,Q.x,he),Ae=en(W.y,Q.y,he),je=new sl(ge,Ae,0,Q.angleTo(W),V);return!w||Of(s,je,A,w,r)?je:void 0}k+=ne}}function Tg(s,r,l,d,m,y,w,A,k){const P=zf(d,y,w),V=Nf(d,m),W=V*w,Q=s[0].x===0||s[0].x===k||s[0].y===0||s[0].y===k;return r-W<r/4&&(r=W+r/4),Uf(s,Q?r/2*A%r:(V/2+2*y)*w*A%r,r,P,l,W,Q,!1,k)}function Uf(s,r,l,d,m,y,w,A,k){const P=y/2,V=Ff(s);let W=0,Q=r-l,ne=[];for(let he=0;he<s.length-1;he++){const ge=s[he],Ae=s[he+1],je=ge.dist(Ae),Qe=Ae.angleTo(ge);for(;Q+l<W+je;){Q+=l;const $e=(Q-W)/je,Xe=en(ge.x,Ae.x,$e),nt=en(ge.y,Ae.y,$e);if(Xe>=0&&Xe<k&&nt>=0&&nt<k&&Q-P>=0&&Q+P<=V){const rt=new sl(Xe,nt,0,Qe,he);rt._round(),d&&!Of(s,rt,y,d,m)||ne.push(rt)}}W+=je}return A||ne.length||w||(ne=Uf(s,W/2,l,d,m,y,w,!0,k)),ne}function $f(s,r,l,d,m){const y=[];for(let w=0;w<s.length;w++){const A=s[w];let k;for(let P=0;P<A.length-1;P++){let V=A[P],W=A[P+1];V.x<r&&W.x<r||(V.x<r?V=new ue(r,V.y+(r-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x<r&&(W=new ue(r,V.y+(r-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y<l&&W.y<l||(V.y<l?V=new ue(V.x+(l-V.y)/(W.y-V.y)*(W.x-V.x),l)._round():W.y<l&&(W=new ue(V.x+(l-V.y)/(W.y-V.y)*(W.x-V.x),l)._round()),V.x>=d&&W.x>=d||(V.x>=d?V=new ue(d,V.y+(d-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x>=d&&(W=new ue(d,V.y+(d-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y>=m&&W.y>=m||(V.y>=m?V=new ue(V.x+(m-V.y)/(W.y-V.y)*(W.x-V.x),m)._round():W.y>=m&&(W=new ue(V.x+(m-V.y)/(W.y-V.y)*(W.x-V.x),m)._round()),k&&V.equals(k[k.length-1])||(k=[V],y.push(k)),k.push(W)))))}}return y}U(sl,"Anchor");const eu=1e20;function jf(s,r,l,d,m,y,w,A,k){for(let P=r;P<r+d;P++)Vf(s,l*y+P,y,m,w,A,k);for(let P=l;P<l+m;P++)Vf(s,P*y+r,1,d,w,A,k)}function Vf(s,r,l,d,m,y,w){y[0]=0,w[0]=-eu,w[1]=eu,m[0]=s[r];for(let A=1,k=0,P=0;A<d;A++){m[A]=s[r+A*l];const V=A*A;do{const W=y[k];P=(m[A]-m[W]+V-W*W)/(A-W)/2}while(P<=w[k]&&--k>-1);k++,y[k]=A,w[k]=P,w[k+1]=eu}for(let A=0,k=0;A<d;A++){for(;w[k+1]<A;)k++;const P=y[k],V=A-P;s[r+A*l]=m[P]+V*V}}const Lh={none:0,ideographs:1,all:2};class Ec{constructor(r,l,d){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=d,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const d=[];for(const m in r)for(const y of r[m])d.push({stack:m,id:y});Sr(d,({stack:m,id:y},w)=>{let A=this.entries[m];A||(A=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=A.glyphs[y];if(k!==void 0)return void w(null,{stack:m,id:y,glyph:k});if(k=this._tinySDF(A,m,y),k)return A.glyphs[y]=k,void w(null,{stack:m,id:y,glyph:k});const P=Math.floor(y/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(A.ranges[P])return void w(null,{stack:m,id:y,glyph:k});let V=A.requests[P];V||(V=A.requests[P]=[],Ec.loadGlyphRange(m,P,this.url,this.requestManager,(W,Q)=>{if(Q){A.ascender=Q.ascender,A.descender=Q.descender;for(const ne in Q.glyphs)this._doesCharSupportLocalGlyph(+ne)||(A.glyphs[+ne]=Q.glyphs[+ne]);A.ranges[P]=!0}for(const ne of V)ne(W,Q);delete A.requests[P]})),V.push((W,Q)=>{W?w(W):Q&&w(null,{stack:m,id:y,glyph:Q.glyphs[y]||null})})},(m,y)=>{if(m)l(m);else if(y){const w={};for(const{stack:A,id:k,glyph:P}of y)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[k]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;l(null,w)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Lh.none&&(this.localGlyphMode===Lh.all?!!this.localFontFamily:!!this.localFontFamily&&(bs(r)||Pc(r)||Ht(r)||vi(r)||Fr(r)))}_tinySDF(r,l,d){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let y=r.tinySDF;if(!y){let ge="400";/bold/i.test(l)?ge="900":/medium/i.test(l)?ge="500":/light/i.test(l)&&(ge="200"),y=r.tinySDF=new Ec.TinySDF({fontFamily:m,fontWeight:ge,fontSize:48,buffer:6,radius:16}),y.fontWeight=ge}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const w=String.fromCharCode(d),{data:A,width:k,height:P,glyphWidth:V,glyphHeight:W,glyphLeft:Q,glyphTop:ne,glyphAdvance:he}=y.draw(w);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new ol({width:k,height:P},A),metrics:{width:V/2,height:W/2,left:Q/2,top:ne/2-27,advance:he/2,localGlyph:!0}}}}function Gf(s,r,l,d){const m=[],y=s.image,w=y.pixelRatio,A=y.paddedRect.w-2,k=y.paddedRect.h-2,P=s.right-s.left,V=s.bottom-s.top,W=y.stretchX||[[0,A]],Q=y.stretchY||[[0,k]],ne=(Vt,sr)=>Vt+sr[1]-sr[0],he=W.reduce(ne,0),ge=Q.reduce(ne,0),Ae=A-he,je=k-ge;let Qe=0,$e=he,Xe=0,nt=ge,rt=0,Ot=Ae,Rt=0,rr=je;if(y.content&&d){const Vt=y.content;Qe=Nu(W,0,Vt[0]),Xe=Nu(Q,0,Vt[1]),$e=Nu(W,Vt[0],Vt[2]),nt=Nu(Q,Vt[1],Vt[3]),rt=Vt[0]-Qe,Rt=Vt[1]-Xe,Ot=Vt[2]-Vt[0]-$e,rr=Vt[3]-Vt[1]-nt}const Mr=(Vt,sr,hr,vr)=>{const Cr=Uu(Vt.stretch-Qe,$e,P,s.left),Xt=$u(Vt.fixed-rt,Ot,Vt.stretch,he),jr=Uu(sr.stretch-Xe,nt,V,s.top),Mi=$u(sr.fixed-Rt,rr,sr.stretch,ge),Zr=Uu(hr.stretch-Qe,$e,P,s.left),ci=$u(hr.fixed-rt,Ot,hr.stretch,he),Vr=Uu(vr.stretch-Xe,nt,V,s.top),Di=$u(vr.fixed-Rt,rr,vr.stretch,ge),nn=new ue(Cr,jr),Qi=new ue(Zr,jr),Wi=new ue(Zr,Vr),Pi=new ue(Cr,Vr),Sn=new ue(Xt/w,Mi/w),zi=new ue(ci/w,Di/w),on=r*Math.PI/180;if(on){const zn=Math.sin(on),jn=Math.cos(on),Gn=[jn,-zn,zn,jn];nn._matMult(Gn),Qi._matMult(Gn),Pi._matMult(Gn),Wi._matMult(Gn)}const Cn=Vt.stretch+Vt.fixed,$n=sr.stretch+sr.fixed;return{tl:nn,tr:Qi,bl:Pi,br:Wi,tex:{x:y.paddedRect.x+1+Cn,y:y.paddedRect.y+1+$n,w:hr.stretch+hr.fixed-Cn,h:vr.stretch+vr.fixed-$n},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sn,pixelOffsetBR:zi,minFontScaleX:Ot/w/P,minFontScaleY:rr/w/V,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){const Vt=qf(W,Ae,he),sr=qf(Q,je,ge);for(let hr=0;hr<Vt.length-1;hr++){const vr=Vt[hr],Cr=Vt[hr+1];for(let Xt=0;Xt<sr.length-1;Xt++)m.push(Mr(vr,sr[Xt],Cr,sr[Xt+1]))}}else m.push(Mr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:k+1}));return m}function Nu(s,r,l){let d=0;for(const m of s)d+=Math.max(r,Math.min(l,m[1]))-Math.max(r,Math.min(l,m[0]));return d}function qf(s,r,l){const d=[{fixed:-1,stretch:0}];for(const[m,y]of s){const w=d[d.length-1];d.push({fixed:m-w.stretch,stretch:w.stretch}),d.push({fixed:m-w.stretch,stretch:w.stretch+(y-m)})}return d.push({fixed:r+1,stretch:l}),d}function Uu(s,r,l,d){return s/r*l+d}function $u(s,r,l,d){return s-r*l/d}function Sg(s,r,l,d){const m=r+s.positionedLines[d].lineOffset;return d===0?l+m/2:l+(m+(r+s.positionedLines[d-1].lineOffset))/2}Ec.loadGlyphRange=function(s,r,l,d,m){const y=256*r,w=y+255,A=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${y}-${w}`),br.Glyphs);Ti(A,(k,P)=>{if(k)m(k);else if(P){const V={},W=function(Q){return new Qc(Q).readFields(_g,{})}(P);for(const Q of W.glyphs)V[Q.id]=Q;m(null,{glyphs:V,ascender:W.ascender,descender:W.descender})}})},Ec.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:l=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=r,this.cutoff=d,this.radius=l;const A=this.size=s+4*r,k=this._createCanvas(A),P=this.ctx=k.getContext("2d",{willReadFrequently:!0});P.font=`${w} ${y} ${s}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(s),w=Math.ceil(l),A=Math.min(this.size-this.buffer,Math.ceil(y-m)),k=Math.min(this.size-this.buffer,w+Math.ceil(d)),P=A+2*this.buffer,V=k+2*this.buffer,W=Math.max(P*V,0),Q=new Uint8ClampedArray(W),ne={data:Q,width:P,height:V,glyphWidth:A,glyphHeight:k,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(A===0||k===0)return ne;const{ctx:he,buffer:ge,gridInner:Ae,gridOuter:je}=this;he.clearRect(ge,ge,A,k),he.fillText(s,ge,ge+w);const Qe=he.getImageData(ge,ge,A,k);je.fill(eu,0,W),Ae.fill(0,0,W);for(let $e=0;$e<k;$e++)for(let Xe=0;Xe<A;Xe++){const nt=Qe.data[4*($e*A+Xe)+3]/255;if(nt===0)continue;const rt=($e+ge)*P+Xe+ge;if(nt===1)je[rt]=0,Ae[rt]=eu;else{const Ot=.5-nt;je[rt]=Ot>0?Ot*Ot:0,Ae[rt]=Ot<0?Ot*Ot:0}}jf(je,0,0,P,V,P,this.f,this.v,this.z),jf(Ae,ge,ge,A,k,P,this.f,this.v,this.z);for(let $e=0;$e<W;$e++){const Xe=Math.sqrt(je[$e])-Math.sqrt(Ae[$e]);Q[$e]=Math.round(255-255*(Xe/this.radius+this.cutoff))}return ne}};class Mg{constructor(r=[],l=Ag){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:d}=this,m=l[r];for(;r>0;){const y=r-1>>1,w=l[y];if(d(m,w)>=0)break;l[r]=w,r=y}l[r]=m}_down(r){const{data:l,compare:d}=this,m=this.length>>1,y=l[r];for(;r<m;){let w=1+(r<<1),A=l[w];const k=w+1;if(k<this.length&&d(l[k],A)<0&&(w=k,A=l[k]),d(A,y)>=0)break;l[r]=A,r=w}l[r]=y}}function Ag(s,r){return s<r?-1:s>r?1:0}function Cg(s,r=1,l=!1){let d=1/0,m=1/0,y=-1/0,w=-1/0;const A=s[0];for(let ne=0;ne<A.length;ne++){const he=A[ne];(!ne||he.x<d)&&(d=he.x),(!ne||he.y<m)&&(m=he.y),(!ne||he.x>y)&&(y=he.x),(!ne||he.y>w)&&(w=he.y)}const k=Math.min(y-d,w-m);let P=k/2;const V=new Mg([],Ig);if(k===0)return new ue(d,m);for(let ne=d;ne<y;ne+=k)for(let he=m;he<w;he+=k)V.push(new Tc(ne+P,he+P,P,s));let W=function(ne){let he=0,ge=0,Ae=0;const je=ne[0];for(let Qe=0,$e=je.length,Xe=$e-1;Qe<$e;Xe=Qe++){const nt=je[Qe],rt=je[Xe],Ot=nt.x*rt.y-rt.x*nt.y;ge+=(nt.x+rt.x)*Ot,Ae+=(nt.y+rt.y)*Ot,he+=3*Ot}return new Tc(ge/he,Ae/he,0,ne)}(s),Q=V.length;for(;V.length;){const ne=V.pop();(ne.d>W.d||!W.d)&&(W=ne,l&&console.log("found best %d after %d probes",Math.round(1e4*ne.d)/1e4,Q)),ne.max-W.d<=r||(P=ne.h/2,V.push(new Tc(ne.p.x-P,ne.p.y-P,P,s)),V.push(new Tc(ne.p.x+P,ne.p.y-P,P,s)),V.push(new Tc(ne.p.x-P,ne.p.y+P,P,s)),V.push(new Tc(ne.p.x+P,ne.p.y+P,P,s)),Q+=4)}return l&&(console.log(`num probes: ${Q}`),console.log(`best distance: ${W.d}`)),W.p}function Ig(s,r){return r.max-s.max}function Tc(s,r,l,d){this.p=new ue(s,r),this.h=l,this.d=function(m,y){let w=!1,A=1/0;for(let k=0;k<y.length;k++){const P=y[k];for(let V=0,W=P.length,Q=W-1;V<W;Q=V++){const ne=P[V],he=P[Q];ne.y>m.y!=he.y>m.y&&m.x<(he.x-ne.x)*(m.y-ne.y)/(he.y-ne.y)+ne.x&&(w=!w),A=Math.min(A,Id(m,ne,he))}}return(w?1:-1)*Math.sqrt(A)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const Rh=Number.POSITIVE_INFINITY,Dg=Math.sqrt(2);function Xf(s,[r,l]){let d=0,m=0;if(l===Rh){r<0&&(r=0);const y=r/Dg;switch(s){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-r;break;case"top":m=r-7}switch(s){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=r;break;case"right":d=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),s){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(s){case"top-right":case"bottom-right":case"right":d=-r;break;case"top-left":case"bottom-left":case"left":d=r}}return[d,m]}function kg(s,r,l,d,m,y,w,A,k,P){s.createArrays(),s.tilePixelRatio=Li/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const V=s.layers[0].layout,W=s.layers[0]._unevaluatedLayout._values,Q={};if(s.textSizeData.kind==="composite"){const{minZoom:ge,maxZoom:Ae}=s.textSizeData;Q.compositeTextSizes=[W["text-size"].possiblyEvaluate(new wt(ge),A),W["text-size"].possiblyEvaluate(new wt(Ae),A)]}if(s.iconSizeData.kind==="composite"){const{minZoom:ge,maxZoom:Ae}=s.iconSizeData;Q.compositeIconSizes=[W["icon-size"].possiblyEvaluate(new wt(ge),A),W["icon-size"].possiblyEvaluate(new wt(Ae),A)]}Q.layoutTextSize=W["text-size"].possiblyEvaluate(new wt(k+1),A),Q.layoutIconSize=W["icon-size"].possiblyEvaluate(new wt(k+1),A),Q.textMaxSize=W["text-size"].possiblyEvaluate(new wt(18),A);const ne=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",he=V.get("text-size");for(const ge of s.features){const Ae=V.get("text-font").evaluate(ge,{},A).join(","),je=he.evaluate(ge,{},A),Qe=Q.layoutTextSize.evaluate(ge,{},A),$e=(Q.layoutIconSize.evaluate(ge,{},A),{horizontal:{},vertical:void 0}),Xe=ge.text;let nt,rt=[0,0];if(Xe){const rr=Xe.toString(),Mr=V.get("text-letter-spacing").evaluate(ge,{},A)*Vo,Vt=V.get("text-line-height").evaluate(ge,{},A)*Vo,sr=j(rr)?Mr:0,hr=V.get("text-anchor").evaluate(ge,{},A),vr=V.get("text-variable-anchor");if(!vr){const Zr=V.get("text-radial-offset").evaluate(ge,{},A);rt=Zr?Xf(hr,[Zr*Vo,Rh]):V.get("text-offset").evaluate(ge,{},A).map(ci=>ci*Vo)}let Cr=ne?"center":V.get("text-justify").evaluate(ge,{},A);const Xt=V.get("symbol-placement")==="point",jr=Xt?V.get("text-max-width").evaluate(ge,{},A)*Vo:1/0,Mi=Zr=>{s.allowVerticalPlacement&&O(rr)&&($e.vertical=kh(Xe,r,l,m,Ae,jr,Vt,hr,Zr,sr,rt,Va.vertical,!0,Qe,je))};if(!ne&&vr){const Zr=Cr==="auto"?vr.map(Vr=>Bh(Vr)):[Cr];let ci=!1;for(let Vr=0;Vr<Zr.length;Vr++){const Di=Zr[Vr];if(!$e.horizontal[Di])if(ci)$e.horizontal[Di]=$e.horizontal[0];else{const nn=kh(Xe,r,l,m,Ae,jr,Vt,"center",Di,sr,rt,Va.horizontal,!1,Qe,je);nn&&($e.horizontal[Di]=nn,ci=nn.positionedLines.length===1)}}Mi("left")}else{if(Cr==="auto"&&(Cr=Bh(hr)),Xt||V.get("text-writing-mode").indexOf("horizontal")>=0||!O(rr)){const Zr=kh(Xe,r,l,m,Ae,jr,Vt,hr,Cr,sr,rt,Va.horizontal,!1,Qe,je);Zr&&($e.horizontal[Cr]=Zr)}Mi(Xt?"left":Cr)}}let Ot=!1;if(ge.icon&&ge.icon.name){const rr=d[ge.icon.name];rr&&(nt=wg(m[ge.icon.name],V.get("icon-offset").evaluate(ge,{},A),V.get("icon-anchor").evaluate(ge,{},A)),Ot=rr.sdf,s.sdfIcons===void 0?s.sdfIcons=rr.sdf:s.sdfIcons!==rr.sdf&&Br("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rr.pixelRatio!==s.pixelRatio||V.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Rt=Hf($e.horizontal)||$e.vertical;s.iconsInText||(s.iconsInText=!!Rt&&Rt.iconsInText),(Rt||nt)&&Pg(s,ge,$e,nt,d,Q,Qe,0,rt,Ot,w,A,P)}y&&s.generateCollisionDebugBuffers(k,s.collisionBoxArray)}function Bh(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pg(s,r,l,d,m,y,w,A,k,P,V,W,Q){let ne=y.textMaxSize.evaluate(r,{},W);ne===void 0&&(ne=w);const he=s.layers[0].layout,ge=he.get("icon-offset").evaluate(r,{},W),Ae=Hf(l.horizontal)||l.vertical,je=Q.name==="globe",Qe=w/24,$e=s.tilePixelRatio*ne/24,Xe=(sr=s.overscaling,s.zoom>18&&sr>2&&(sr>>=1),Math.max(Li/(512*sr),1)*he.get("symbol-spacing")),nt=he.get("text-padding")*s.tilePixelRatio,rt=he.get("icon-padding")*s.tilePixelRatio,Ot=be(he.get("text-max-angle")),Rt=he.get("text-rotation-alignment")==="map"&&he.get("symbol-placement")!=="point",rr=he.get("icon-rotation-alignment")==="map"&&he.get("symbol-placement")!=="point",Mr=he.get("symbol-placement"),Vt=Xe/2;var sr;const hr=he.get("icon-text-fit");let vr;d&&hr!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(vr=Bf(d,l.vertical,hr,he.get("icon-text-fit-padding"),ge,Qe)),Ae&&(d=Bf(d,Ae,hr,he.get("icon-text-fit-padding"),ge,Qe)));const Cr=(Xt,jr,Mi)=>{if(jr.x<0||jr.x>=Li||jr.y<0||jr.y>=Li)return;let Zr=null;if(je){const{x:ci,y:Vr,z:Di}=Q.projectTilePoint(jr.x,jr.y,Mi);Zr={anchor:new sl(ci,Vr,Di,0,void 0),up:Q.upVector(Mi,jr.x,jr.y)}}(function(ci,Vr,Di,nn,Qi,Wi,Pi,Sn,zi,on,Cn,$n,zn,jn,Gn,Jn,Do,Mn,vo,ho,yn,Yn,So,In,no){const ea=ci.addToLineVertexArray(Vr,nn);let ko,Po,fa,Lo,cl,kc,hu,du=0,Pp=0,Lp=0,Rp=0,Qh=-1,Jh=-1;const qs={};let Bp=hc.exports("");const ic=Di?Di.anchor:Vr;let ed=0,td=0;if(zi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ed,td]=zi.layout.get("text-offset").evaluate(yn,{},no).map(Ca=>Ca*Vo):(ed=zi.layout.get("text-radial-offset").evaluate(yn,{},no)*Vo,td=Rh),ci.allowVerticalPlacement&&Qi.vertical){const Ca=Qi.vertical;if(Gn)kc=Oh(Ca),Sn&&(hu=Oh(Sn));else{const Ia=zi.layout.get("text-rotate").evaluate(yn,{},no)+90;fa=ju(on,ic,Vr,Cn,$n,zn,Ca,jn,Ia,Jn),Sn&&(Lo=ju(on,ic,Vr,Cn,$n,zn,Sn,Mn,Ia))}}if(Wi){const Ca=zi.layout.get("icon-rotate").evaluate(yn,{},no),Ia=zi.layout.get("icon-text-fit")!=="none",fu=Gf(Wi,Ca,So,Ia),nd=Sn?Gf(Sn,Ca,So,Ia):void 0;Po=ju(on,ic,Vr,Cn,$n,zn,Wi,Mn,Ca),du=4*fu.length;const Op=ci.iconSizeData;let nc=null;Op.kind==="source"?(nc=[Us*zi.layout.get("icon-size").evaluate(yn,{},no)],nc[0]>Tl&&Br(`${ci.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Op.kind==="composite"&&(nc=[Us*Yn.compositeIconSizes[0].evaluate(yn,{},no),Us*Yn.compositeIconSizes[1].evaluate(yn,{},no)],(nc[0]>Tl||nc[1]>Tl)&&Br(`${ci.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ci.addSymbols(ci.icon,fu,nc,ho,vo,yn,!1,Di,Vr,ea.lineStartIndex,ea.lineLength,-1,In,no),Qh=ci.icon.placedSymbolArray.length-1,nd&&(Pp=4*nd.length,ci.addSymbols(ci.icon,nd,nc,ho,vo,yn,Va.vertical,Di,Vr,ea.lineStartIndex,ea.lineLength,-1,In,no),Jh=ci.icon.placedSymbolArray.length-1)}for(const Ca in Qi.horizontal){const Ia=Qi.horizontal[Ca];ko||(Bp=hc.exports(Ia.text),Gn?cl=Oh(Ia):ko=ju(on,ic,Vr,Cn,$n,zn,Ia,jn,zi.layout.get("text-rotate").evaluate(yn,{},no),Jn));const fu=Ia.positionedLines.length===1;if(Lp+=Zf(ci,Di,Vr,Ia,Pi,zi,Gn,yn,Jn,ea,Qi.vertical?Va.horizontal:Va.horizontalOnly,fu?Object.keys(Qi.horizontal):[Ca],qs,Qh,Yn,In,no),fu)break}Qi.vertical&&(Rp+=Zf(ci,Di,Vr,Qi.vertical,Pi,zi,Gn,yn,Jn,ea,Va.vertical,["vertical"],qs,Jh,Yn,In,no));let Dl=-1;const rd=(Ca,Ia)=>Ca?Math.max(Ca,Ia):Ia;Dl=rd(cl,Dl),Dl=rd(kc,Dl),Dl=rd(hu,Dl);const u0=Dl>-1?1:0;ci.glyphOffsetArray.length>=Ml.MAX_GLYPHS&&Br("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yn.sortKey!==void 0&&ci.addToSortKeyRanges(ci.symbolInstances.length,yn.sortKey),ci.symbolInstances.emplaceBack(ic.x,ic.y,ic.z,Vr.x,Vr.y,qs.right>=0?qs.right:-1,qs.center>=0?qs.center:-1,qs.left>=0?qs.left:-1,qs.vertical>=0?qs.vertical:-1,Qh,Jh,Bp,ko!==void 0?ko:ci.collisionBoxArray.length,ko!==void 0?ko+1:ci.collisionBoxArray.length,fa!==void 0?fa:ci.collisionBoxArray.length,fa!==void 0?fa+1:ci.collisionBoxArray.length,Po!==void 0?Po:ci.collisionBoxArray.length,Po!==void 0?Po+1:ci.collisionBoxArray.length,Lo||ci.collisionBoxArray.length,Lo?Lo+1:ci.collisionBoxArray.length,Cn,Lp,Rp,du,Pp,u0,0,ed,td,Dl)})(s,jr,Zr,Xt,l,d,m,vr,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,nt,Rt,k,0,rt,rr,ge,r,y,P,V,W)};if(Mr==="line")for(const Xt of $f(r.geometry,0,0,Li,Li)){const jr=Tg(Xt,Xe,Ot,l.vertical||Ae,d,24,$e,s.overscaling,Li);for(const Mi of jr){const Zr=Ae;Zr&&Lg(s,Zr.text,Vt,Mi)||Cr(Xt,Mi,W)}}else if(Mr==="line-center"){for(const Xt of r.geometry)if(Xt.length>1){const jr=Eg(Xt,Ot,l.vertical||Ae,d,24,$e);jr&&Cr(Xt,jr,W)}}else if(r.type==="Polygon")for(const Xt of Eh(r.geometry,0)){const jr=Cg(Xt,16);Cr(Xt[0],new sl(jr.x,jr.y,0,0,void 0),W)}else if(r.type==="LineString")for(const Xt of r.geometry)Cr(Xt,new sl(Xt[0].x,Xt[0].y,0,0,void 0),W);else if(r.type==="Point")for(const Xt of r.geometry)for(const jr of Xt)Cr([jr],new sl(jr.x,jr.y,0,0,void 0),W)}const Tl=32640;function Zf(s,r,l,d,m,y,w,A,k,P,V,W,Q,ne,he,ge,Ae){const je=function(Xe,nt,rt,Ot,Rt,rr,Mr,Vt){const sr=[];if(nt.positionedLines.length===0)return sr;const hr=Ot.layout.get("text-rotate").evaluate(rr,{})*Math.PI/180,vr=function(Zr){const ci=Zr[0],Vr=Zr[1],Di=ci*Vr;return Di>0?[ci,-Vr]:Di<0?[-ci,Vr]:ci===0?[Vr,ci]:[Vr,-ci]}(rt);let Cr=Math.abs(nt.top-nt.bottom);for(const Zr of nt.positionedLines)Cr-=Zr.lineOffset;const Xt=nt.positionedLines.length,jr=Cr/Xt;let Mi=nt.top-rt[1];for(let Zr=0;Zr<Xt;++Zr){const ci=nt.positionedLines[Zr];Mi=Sg(nt,jr,Mi,Zr);for(const Vr of ci.positionedGlyphs){if(!Vr.rect)continue;const Di=Vr.rect||{};let nn=4,Qi=!0,Wi=1,Pi=0;if(Vr.imageName){const In=Mr[Vr.imageName];if(!In)continue;if(In.sdf){Br("SDF images are not supported in formatted text and will be ignored.");continue}Qi=!1,Wi=In.pixelRatio,nn=1/Wi}const Sn=(Rt||Vt)&&Vr.vertical,zi=Vr.metrics.advance*Vr.scale/2,on=Vr.metrics,Cn=Vr.rect;if(Cn===null)continue;Vt&&nt.verticalizable&&(Pi=Vr.imageName?zi-Vr.metrics.width*Vr.scale/2:0);const $n=Rt?[Vr.x+zi,Vr.y]:[0,0];let zn=[0,0],jn=[0,0],Gn=!1;Rt||(Sn?(jn=[Vr.x+zi+vr[0],Vr.y+vr[1]-Pi],Gn=!0):zn=[Vr.x+zi+rt[0],Vr.y+rt[1]-Pi]);const Jn=Cn.w*Vr.scale/(Wi*(Vr.localGlyph?2:1)),Do=Cn.h*Vr.scale/(Wi*(Vr.localGlyph?2:1));let Mn,vo,ho,yn;if(Sn){const In=Vr.y-Mi,no=new ue(-zi,zi-In),ea=-Math.PI/2,ko=new ue(...jn);Mn=new ue(-zi+zn[0],zn[1]),Mn._rotateAround(ea,no)._add(ko),Mn.x+=-In+zi,Mn.y-=(on.left-nn)*Vr.scale;const Po=Vr.imageName?on.advance*Vr.scale:Vo*Vr.scale,fa=String.fromCharCode(Vr.glyph);ag(fa)?Mn.x+=(1-nn)*Vr.scale:sg(fa)?Mn.x+=Po-on.height*Vr.scale+(-nn-1)*Vr.scale:Mn.x+=Vr.imageName||on.width+2*nn===Cn.w&&on.height+2*nn===Cn.h?(Po-Do)/2:(Po-(on.height+2*nn)*Vr.scale)/2,vo=new ue(Mn.x,Mn.y-Jn),ho=new ue(Mn.x+Do,Mn.y),yn=new ue(Mn.x+Do,Mn.y-Jn)}else{const In=(on.left-nn)*Vr.scale-zi+zn[0],no=(-on.top-nn)*Vr.scale+zn[1],ea=In+Jn,ko=no+Do;Mn=new ue(In,no),vo=new ue(ea,no),ho=new ue(In,ko),yn=new ue(ea,ko)}if(hr){let In;In=Rt?new ue(0,0):Gn?new ue(vr[0],vr[1]):new ue(rt[0],rt[1]),Mn._rotateAround(hr,In),vo._rotateAround(hr,In),ho._rotateAround(hr,In),yn._rotateAround(hr,In)}const Yn=new ue(0,0),So=new ue(0,0);sr.push({tl:Mn,tr:vo,bl:ho,br:yn,tex:Di,writingMode:nt.writingMode,glyphOffset:$n,sectionIndex:Vr.sectionIndex,isSDF:Qi,pixelOffsetTL:Yn,pixelOffsetBR:So,minFontScaleX:0,minFontScaleY:0})}}return sr}(0,d,k,y,w,A,m,s.allowVerticalPlacement),Qe=s.textSizeData;let $e=null;Qe.kind==="source"?($e=[Us*y.layout.get("text-size").evaluate(A,{},Ae)],$e[0]>Tl&&Br(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Qe.kind==="composite"&&($e=[Us*he.compositeTextSizes[0].evaluate(A,{},Ae),Us*he.compositeTextSizes[1].evaluate(A,{},Ae)],($e[0]>Tl||$e[1]>Tl)&&Br(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,je,$e,k,w,A,V,r,l,P.lineStartIndex,P.lineLength,ne,ge,Ae);for(const Xe of W)Q[Xe]=s.text.placedSymbolArray.length-1;return 4*je.length}function Hf(s){for(const r in s)return s[r];return null}function ju(s,r,l,d,m,y,w,A,k,P){let V=w.top,W=w.bottom,Q=w.left,ne=w.right;const he=w.collisionPadding;if(he&&(Q-=he[0],V-=he[1],ne+=he[2],W+=he[3]),k){const ge=new ue(Q,V),Ae=new ue(ne,V),je=new ue(Q,W),Qe=new ue(ne,W),$e=be(k);let Xe=new ue(0,0);P&&(Xe=new ue(P[0],P[1])),ge._rotateAround($e,Xe),Ae._rotateAround($e,Xe),je._rotateAround($e,Xe),Qe._rotateAround($e,Xe),Q=Math.min(ge.x,Ae.x,je.x,Qe.x),ne=Math.max(ge.x,Ae.x,je.x,Qe.x),V=Math.min(ge.y,Ae.y,je.y,Qe.y),W=Math.max(ge.y,Ae.y,je.y,Qe.y)}return s.emplaceBack(r.x,r.y,r.z,l.x,l.y,Q,V,ne,W,A,d,m,y),s.length-1}function Oh(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function Lg(s,r,l,d){const m=s.compareText;if(r in m){const y=m[r];for(let w=y.length-1;w>=0;w--)if(d.dist(y[w])<l)return!0}else m[r]=[];return m[r].push(d),!1}const Rg=ti([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Wf}=Rg,Yf=ti([{name:"a_pos_3",components:3,type:"Int16"}]);var tu=ti([{name:"a_pos",type:"Int16",components:2}]);const ll=Li/Math.PI/2,Fh=2*ns(1,0)*ll*Math.PI,Sc=64,Mc=[Sc,32,16],as=-ll,ss=ll,Bg=[new ha([as,as,as],[ss,ss,ss]),new ha([as,as,as],[0,0,ss]),new ha([0,as,as],[ss,0,ss]),new ha([as,0,as],[0,ss,ss]),new ha([0,0,as],[ss,ss,ss])];function Kf(s,r,l,d=!0){const m=ja([],s._camera.position,s.worldSize),y=[r,l,1,1];Ql(y,y,s.pixelMatrixInverse),$d(y,y,1/y[3]);const w=ua([],Ms([],y,m)),A=s.globeMatrix,k=[A[12],A[13],A[14]],P=Ms([],k,m),V=Oc(P),W=ua([],P),Q=s.worldSize/(2*Math.PI),ne=os(W,w),he=Math.asin(Q/V);if(he<Math.acos(ne)){if(!d)return null;const Mr=[],Vt=[];ja(Mr,w,V/ne),ua(Vt,Ms(Vt,Mr,P)),ua(w,nl(w,P,ja(w,Vt,Math.tan(he)*V)))}const ge=[];new mh(m,w).closestPointOnSphere(k,Q,ge);const Ae=ua([],Er(A,0)),je=ua([],Er(A,1)),Qe=ua([],Er(A,2)),$e=os(Ae,ge),Xe=os(je,ge),nt=os(Qe,ge),rt=de(Math.asin(-Xe/Q));let Ot=de(Math.atan2($e,nt));Ot=s.center.lng+function(Mr,Vt){const sr=(Vt-Mr+180)%360-180;return sr<-180?sr+360:sr}(s.center.lng,Ot);const Rt=Fs(Ot),rr=xt(zs(rt),0,1);return new fc(Rt,rr)}class Og{constructor(r,l,d){this.a=Ms([],r,d),this.b=Ms([],l,d),this.center=d;const m=ua([],this.a),y=ua([],this.b);this.angle=Math.acos(os(m,y))}}function zh(s,r){if(s.angle===0)return null;let l;return l=s.a[r]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:function(d,m,y,w){const A=Math.sin(y);return d*(Math.sin((1-w)*y)/A)+m*(Math.sin(w*y)/A)}(s.a[r],s.b[r],s.angle,xt(l,0,1))+s.center[r]}function $s(s){if(s.z<=1)return Bg[s.z+2*s.y+s.x];const r=Nh(Vu(s));return ha.fromPoints(r)}function ec(s,r,l){return ja(s,s,1-l),Nc(s,s,r,l)}function Qf(s,r){const l=Cc(r.zoom);if(l===0)return $s(s);const d=Vu(s),m=Nh(d),y=Fs(d.getWest())*r.worldSize,w=Fs(d.getEast())*r.worldSize,A=zs(d.getNorth())*r.worldSize,k=zs(d.getSouth())*r.worldSize,P=[y,A,0],V=[w,A,0],W=[y,k,0],Q=[w,k,0],ne=uh([],r.globeMatrix);return io(P,P,ne),io(V,V,ne),io(W,W,ne),io(Q,Q,ne),m[0]=ec(m[0],W,l),m[1]=ec(m[1],Q,l),m[2]=ec(m[2],V,l),m[3]=ec(m[3],P,l),ha.fromPoints(m)}function Jf(s,r,l){for(const d of s)io(d,d,r),ja(d,d,l)}function Fg(s,r,l){const d=r/s.worldSize,m=s.globeMatrix;if(l.z<=1){const Rt=$s(l).getCorners();return Jf(Rt,m,d),ha.fromPoints(Rt)}const y=Vu(l),w=Nh(y);Jf(w,m,d);const A=Number.MAX_VALUE,k=[-A,-A,-A],P=[A,A,A];if(y.contains(s.center)){for(const Mr of w)Fc(P,P,Mr),zc(k,k,Mr);k[2]=0;const Rt=s.point,rr=[Rt.x*d,Rt.y*d,0];return Fc(P,P,rr),zc(k,k,rr),new ha(P,k)}const V=[m[12]*d,m[13]*d,m[14]*d],W=y.getCenter(),Q=xt(s.center.lat,-85.051129,Ns),ne=xt(W.lat,-85.051129,Ns),he=Fs(s.center.lng),ge=zs(Q);let Ae=he-Fs(W.lng);const je=ge-zs(ne);Ae>.5?Ae-=1:Ae<-.5&&(Ae+=1);let Qe=0;Math.abs(Ae)>Math.abs(je)?Qe=Ae>=0?1:3:(Qe=je>=0?0:2,Nc(V,V,[m[4]*d,m[5]*d,m[6]*d],-Math.sin(be(je>=0?y.getSouth():y.getNorth()))*ll));const $e=w[Qe],Xe=w[(Qe+1)%4],nt=new Og($e,Xe,V),rt=[zh(nt,0)||$e[0],zh(nt,1)||$e[1],zh(nt,2)||$e[2]],Ot=Cc(s.zoom);if(Ot>0){const Rt=function({x:Mr,y:Vt,z:sr},hr,vr,Cr,Xt){const jr=1/(1<<sr);let Mi=Mr*jr,Zr=Mi+jr,ci=Vt*jr,Vr=ci+jr,Di=0;const nn=(Mi+Zr)/2-Cr;return nn>.5?Di=-1:nn<-.5&&(Di=1),Mi=((Mi+Di)*hr-(Cr*=hr))*vr+Cr,Zr=((Zr+Di)*hr-Cr)*vr+Cr,ci=(ci*hr-(Xt*=hr))*vr+Xt,Vr=(Vr*hr-Xt)*vr+Xt,[[Mi,Vr,0],[Zr,Vr,0],[Zr,ci,0],[Mi,ci,0]]}(l,r,s._pixelsPerMercatorPixel,he,ge);for(let Mr=0;Mr<w.length;Mr++)ec(w[Mr],Rt[Mr],Ot);const rr=nl([],Rt[Qe],Rt[(Qe+1)%4]);ja(rr,rr,.5),ec(rt,rr,Ot)}for(const Rt of w)Fc(P,P,Rt),zc(k,k,Rt);return P[2]=Math.min($e[2],Xe[2]),Fc(P,P,rt),zc(k,k,rt),new ha(P,k)}function Vu({x:s,y:r,z:l}){const d=1/(1<<l),m=new mn($a(s*d),jo((r+1)*d)),y=new mn($a((s+1)*d),jo(r*d));return new El(m,y)}function Nh(s){const r=be(s.getNorth()),l=be(s.getSouth()),d=Math.cos(r),m=Math.cos(l),y=Math.sin(r),w=Math.sin(l),A=s.getWest(),k=s.getEast();return[Ac(m,w,A),Ac(m,w,k),Ac(d,y,k),Ac(d,y,A)]}function Ac(s,r,l,d=ll){return l=be(l),[s*Math.sin(l)*d,-r*d,s*Math.cos(l)*d]}function ru(s,r,l){return Ac(Math.cos(be(s)),Math.sin(be(s)),r,l)}function iu(s,r,l,d){const m=1<<l.z,y=(s/Li+l.x)/m;return ru(jo((r/Li+l.y)/m),$a(y),d)}function Gu({min:s,max:r}){return 16383/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const ep=new Float64Array(16);function nu(s){const r=Gu(s),l=Od(ep,[r,r,r]);return Bc(l,l,((d=[])[0]=-(m=s.min)[0],d[1]=-m[1],d[2]=-m[2],d));var d,m}function Uh(s){const r=(d=s.min,(l=ep)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l);var l,d;const m=1/Gu(s);return Kl(r,r,[m,m,m])}function tp(s,r,l,d,m){const y=function(k){const P=Li/(2*Math.PI);return k/(2*Math.PI)/P}(l),w=[s,r,-l/(2*Math.PI)],A=Ss(new Float64Array(16));return Bc(A,A,w),Kl(A,A,[y,y,y]),hh(A,A,be(-m)),Su(A,A,be(-d)),A}function Cc(s){return Lr(5,6,s)}function rp(s,r){const l=ru(r.lat,r.lng),d=function(he){const ge=ru(he._center.lat,he._center.lng);let Ae=ph([],mc(0,1,0),ge);const je=Fd([],-he.angle,ge);Ae=io(Ae,Ae,je),Fd(je,-he._pitch,Ae);const Qe=ua([],ge);return ja(Qe,Qe,he.cameraToCenterDistance/he.pixelsPerMeter*Fh),io(Qe,Qe,je),nl([],ge,Qe)}(s);return w=(m=fh([],d,l))[0],A=m[1],k=m[2],P=(y=l)[0],V=y[1],W=y[2],ne=(Q=Math.sqrt(w*w+A*A+k*k)*Math.sqrt(P*P+V*V+W*W))&&os(m,y)/Q,Math.acos(Math.min(Math.max(ne,-1),1));var m,y,w,A,k,P,V,W,Q,ne}function $h(s,r){return rp(s,r)>Math.PI/2*1.01}const ip=be(85),zg=Math.cos(ip),Ng=Math.sin(ip);function np(s,r){const l=s.fovAboveCenter,d=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,m=(s._camera.position[2]*s.worldSize-d)/Math.cos(s._pitch),y=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),w=Math.sin(s._pitch)*y+m;return Math.min(1.01*w,m*(1/s._horizonShift))}function tc(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const l=Math.pow(2,-s.z),d=s.x*l,m=(s.x+1)*l,y=s.y*l,w=(s.y+1)*l,A=$a(d),k=$a(m),P=jo(y),V=jo(w),W=r.project(A,P),Q=r.project(k,P),ne=r.project(k,V),he=r.project(A,V);let ge=Math.min(W.x,Q.x,ne.x,he.x),Ae=Math.min(W.y,Q.y,ne.y,he.y),je=Math.max(W.x,Q.x,ne.x,he.x),Qe=Math.max(W.y,Q.y,ne.y,he.y);const $e=l/16;function Xe(rt,Ot,Rt,rr,Mr,Vt){const sr=(Rt+Mr)/2,hr=(rr+Vt)/2,vr=r.project($a(sr),jo(hr)),Cr=Math.max(0,ge-vr.x,Ae-vr.y,vr.x-je,vr.y-Qe);ge=Math.min(ge,vr.x),je=Math.max(je,vr.x),Ae=Math.min(Ae,vr.y),Qe=Math.max(Qe,vr.y),Cr>$e&&(Xe(rt,vr,Rt,rr,sr,hr),Xe(vr,Ot,sr,hr,Mr,Vt))}Xe(W,Q,d,y,m,y),Xe(Q,ne,m,y,m,w),Xe(ne,he,m,w,d,w),Xe(he,W,d,w,d,y),ge-=$e,Ae-=$e,je+=$e,Qe+=$e;const nt=1/Math.max(je-ge,Qe-Ae);return{scale:nt,x:ge*nt,y:Ae*nt,x2:je*nt,y2:Qe*nt,projection:r}}const Ug=Ss(new Float32Array(16));class Sl{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new mn(0,0)}projectTilePoint(r,l,d){return{x:r,y:l,z:0}}locationPoint(r,l,d=!0){return r._coordinatePoint(r.locationCoordinate(l),d)}pixelsPerMeter(r,l){return ns(1,r)*l}pixelSpaceConversion(r,l,d){return 1}farthestPixelDistance(r){return np(r,r.pixelsPerMeter)}pointCoordinate(r,l,d,m){const y=r.horizonLineFromTop(!1),w=new ue(l,Math.max(y,d));return r.rayIntersectionCoordinate(r.pointRayIntersection(w,m))}pointCoordinate3D(r,l,d){const m=new ue(l,d);if(r.elevation)return r.elevation.pointCoordinate(m);{const y=this.pointCoordinate(r,m.x,m.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const d=r.horizonLineFromTop();return l.y<d}createInversionMatrix(r,l){return Ug}createTileMatrix(r,l,d){let m,y,w;const A=d.canonical,k=Ss(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=tc(A,this);m=1,y=P.x+d.wrap*P.scale,w=P.y,Kl(k,k,[m/P.scale,m/P.scale,r.pixelsPerMeter/l])}else m=l/r.zoomScale(A.z),y=(A.x+Math.pow(2,A.z)*d.wrap)*m,w=A.y*m;return Bc(k,k,[y,w,0]),Kl(k,k,[m/Li,m/Li,1]),k}upVector(r,l,d){return[0,0,1]}upVectorScale(r,l,d){return{metersToTile:1}}}class $g extends Sl{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,d]=this.parallels=r.parallels||[29.5,45.5],m=Math.sin(be(l));this.n=(m+Math.sin(be(d)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:d,c:m,r0:y}=this,w=be(r-this.center[0]),A=be(l),k=Math.sqrt(m-2*d*Math.sin(A))/d;return{x:k*Math.sin(w*d),y:k*Math.cos(w*d)-y,z:0}}unproject(r,l){const{n:d,c:m,r0:y}=this,w=y+l;let A=Math.atan2(r,Math.abs(w))*Math.sign(w);w*d<0&&(A-=Math.PI*Math.sign(r)*Math.sign(w));const k=be(this.center[0])*d;A=Nr(A,-Math.PI-k,Math.PI-k);const P=xt(de(A/d)+this.center[0],-180,180),V=Math.asin(xt((m-(r*r+w*w)*d*d)/(2*d),-1,1)),W=xt(de(V),-85.051129,Ns);return new mn(P,W)}}const ou=1.340264,au=-.081106,su=893e-6,lu=.003796,qu=Math.sqrt(3)/2;class jg extends Sl{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const d=Math.asin(qu*Math.sin(l)),m=d*d,y=m*m*m;return{x:.5*(r*Math.cos(d)/(qu*(ou+3*au*m+y*(7*su+9*lu*m)))/Math.PI+.5),y:1-.5*(d*(ou+au*m+y*(su+lu*m))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,m=d*d,y=m*m*m;for(let V,W,Q,ne=0;ne<12&&(W=d*(ou+au*m+y*(su+lu*m))-l,Q=ou+3*au*m+y*(7*su+9*lu*m),V=W/Q,d=xt(d-V,-Math.PI/3,Math.PI/3),m=d*d,y=m*m*m,!(Math.abs(V)<1e-12));++ne);const w=qu*r*(ou+3*au*m+y*(7*su+9*lu*m))/Math.cos(d),A=Math.asin(Math.sin(d)/qu),k=xt(180*w/Math.PI,-180,180),P=xt(180*A/Math.PI,-85.051129,Ns);return new mn(k,P)}}class Vg extends Sl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const d=360*(r-.5),m=xt(360*(.5-l),-85.051129,Ns);return new mn(d,m)}}const Ic=Math.PI/2;function Xu(s){return Math.tan((Ic+s)/2)}class Gg extends Sl{constructor(r){super(r),this.center=r.center||[0,30];const[l,d]=this.parallels=r.parallels||[30,30];let m=be(l),y=be(d);this.southernCenter=m+y<0,this.southernCenter&&(m=-m,y=-y);const w=Math.cos(m),A=Xu(m);this.n=m===y?Math.sin(m):Math.log(w/Math.cos(y))/Math.log(Xu(y)/A),this.f=w*Math.pow(Xu(m),this.n)/this.n}project(r,l){l=be(l),this.southernCenter&&(l=-l),r=be(r-this.center[0]);const d=1e-6,{n:m,f:y}=this;y>0?l<-Ic+d&&(l=-Ic+d):l>Ic-d&&(l=Ic-d);const w=y/Math.pow(Xu(l),m);let A=w*Math.sin(m*r),k=y-w*Math.cos(m*r);return A=.5*(A/Math.PI+.5),k=.5*(k/Math.PI+.5),{x:A,y:this.southernCenter?k:1-k,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:d,f:m}=this,y=m-l,w=Math.sign(y),A=Math.sign(d)*Math.sqrt(r*r+y*y);let k=Math.atan2(r,Math.abs(y))*w;y*d<0&&(k-=Math.PI*Math.sign(r)*w);const P=xt(de(k/d)+this.center[0],-180,180),V=xt(de(2*Math.atan(Math.pow(m/A,1/d))-Ic),-85.051129,Ns);return new mn(P,this.southernCenter?-V:V)}}class op extends Sl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Fs(r),y:zs(l),z:0}}unproject(r,l){const d=$a(r),m=jo(l);return new mn(d,m)}}const ap=be(Ns);class qg extends Sl{project(r,l){const d=(l=be(l))*l,m=d*d;return{x:.5*((r=be(r))*(.8707-.131979*d+m*(m*(.003971*d-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+m*(.028874*d-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,m=25,y=0,w=d*d;do{w=d*d;const P=w*w;y=(d*(1.007226+w*(.015085+P*(.028874*w-.044475-.005916*P)))-l)/(1.007226+w*(.045255+P*(.259866*w-.311325-.005916*11*P))),d=xt(d-y,-ap,ap)}while(Math.abs(y)>1e-6&&--m>0);w=d*d;const A=xt(de(r/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),k=de(d);return new mn(A,k)}}const sp=be(Ns);class Xg extends Sl{project(r,l){l=be(l),r=be(r);const d=Math.cos(l),m=2/Math.PI,y=Math.acos(d*Math.cos(r/2)),w=Math.sin(y)/y,A=.5*(r*m+2*d*Math.sin(r/2)/w)||0,k=.5*(l+Math.sin(l)/w)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(k/Math.PI+1),z:0}}unproject(r,l){let d=r=(2*r-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,y=25;const w=1e-6;let A=0,k=0;do{const P=Math.cos(m),V=Math.sin(m),W=2*V*P,Q=V*V,ne=P*P,he=Math.cos(d/2),ge=Math.sin(d/2),Ae=2*he*ge,je=ge*ge,Qe=1-ne*he*he,$e=Qe?1/Qe:0,Xe=Qe?Math.acos(P*he)*Math.sqrt(1/Qe):0,nt=.5*(2*Xe*P*ge+2*d/Math.PI)-r,rt=.5*(Xe*V+m)-l,Ot=.5*$e*(ne*je+Xe*P*he*Q)+1/Math.PI,Rt=$e*(Ae*W/4-Xe*V*ge),rr=.125*$e*(W*ge-Xe*V*ne*Ae),Mr=.5*$e*(Q*he+Xe*je*P)+.5,Vt=Rt*rr-Mr*Ot;A=(rt*Rt-nt*Mr)/Vt,k=(nt*rr-rt*Ot)/Vt,d=xt(d-A,-Math.PI,Math.PI),m=xt(m-k,-sp,sp)}while((Math.abs(A)>w||Math.abs(k)>w)&&--y>0);return new mn(de(d),de(m))}}class lp extends Sl{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(be(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:d,cosPhi:m}=this;return{x:be(r)*m*d+.5,y:-Math.sin(be(l))/m*d+.5,z:0}}unproject(r,l){const{scale:d,cosPhi:m}=this,y=-(l-.5)/d,w=xt(de((r-.5)/d)/m,-180,180),A=Math.asin(xt(y*m,-1,1)),k=xt(de(A),-85.051129,Ns);return new mn(w,k)}}class Zg extends op{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(r,l,d){const m=iu(r,l,d);return io(m,m,nu($s(d))),{x:m[0],y:m[1],z:m[2]}}locationPoint(r,l){const d=ru(l.lat,l.lng),m=ua([],d),y=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;Nc(d,d,m,ns(1,0)*Li*y);const w=Ss(new Float64Array(16));return Yl(w,r.pixelMatrix,r.globeMatrix),io(d,d,w),new ue(d[0],d[1])}pixelsPerMeter(r,l){return ns(1,0)*l}pixelSpaceConversion(r,l,d){const m=ns(1,r)*l,y=en(ns(1,45)*l,m,d);return this.pixelsPerMeter(r,l)/y}createTileMatrix(r,l,d){const m=Uh($s(d.canonical));return Yl(new Float64Array(16),r.globeMatrix,m)}createInversionMatrix(r,l){const{center:d}=r,m=nu($s(l));return Su(m,m,be(d.lng)),hh(m,m,be(d.lat)),Kl(m,m,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(r,l,d,m){return Kf(r,l,d,!0)||new fc(0,0)}pointCoordinate3D(r,l,d){const m=this.pointCoordinate(r,l,d,0);return[m.x,m.y,m.z]}isPointAboveHorizon(r,l){return!Kf(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=function(m,y){const w=m.cameraToCenterDistance,A=m._centerAltitude*y,k=m._camera,P=m._camera.forward(),V=nl([],ja([],P,-w),[0,0,A]),W=m.worldSize/(2*Math.PI),Q=[0,0,-W],ne=m.width/m.height,he=Math.tan(m.fovAboveCenter),ge=ja([],k.up(),he),Ae=ja([],k.right(),he*ne),je=ua([],nl([],nl([],P,ge),Ae)),Qe=[];let $e;if(new mh(V,je).closestPointOnSphere(Q,W,Qe)){const Xe=nl([],Qe,Q),nt=Ms([],Xe,V);$e=Math.cos(m.fovAboveCenter)*Oc(nt)}else{const Xe=Ms([],V,Q),nt=Ms([],Q,V);ua(nt,nt);const rt=Oc(Xe)-W;$e=Math.sqrt(rt*(rt+2*W));const Ot=Math.acos($e/(W+rt))-Math.acos(os(P,nt));$e*=Math.cos(Ot)}return 1.01*$e}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),d=Cc(r.zoom);if(d>0){const m=np(r,ns(1,r.center.lat)*r.worldSize),y=r.worldSize/(2*Math.PI),w=Math.max(r.width,r.height)/r.worldSize*Math.PI;return en(l,m+y*(1-Math.cos(w)),Math.pow(d,10))}return l}upVector(r,l,d){return iu(l,d,r,1)}upVectorScale(r){return{metersToTile:Fh*Gu($s(r))}}}function cp(s){const r=s.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new op(s);case"equirectangular":return new Vg(s);case"naturalEarth":return new qg(s);case"equalEarth":return new jg(s);case"winkelTripel":return new Xg(s);case"albers":return l?new lp(s):new $g(s);case"lambertConformalConic":return l?new lp(s):new Gg(s);case"globe":return new Zg(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Hg=Pu.types,Wg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zu(s,r,l,d,m,y,w,A,k,P,V,W,Q){const ne=A?Math.min(Tl,Math.round(A[0])):0,he=A?Math.min(Tl,Math.round(A[1])):0;s.emplaceBack(r,l,Math.round(32*d),Math.round(32*m),y,w,(ne<<1)+(k?1:0),he,16*P,16*V,256*W,256*Q)}function Hu(s,r,l,d,m,y,w){s.emplaceBack(r,l,d,m,y,w)}function Wu(s,r,l,d,m){s.emplaceBack(r,l,d,m),s.emplaceBack(r,l,d,m),s.emplaceBack(r,l,d,m),s.emplaceBack(r,l,d,m)}function Yg(s){for(const r of s.sections)if(Le(r.text))return!0;return!1}class jh{constructor(r){this.layoutVertexArray=new kn,this.indexArray=new $o,this.programConfigurations=r,this.segments=new yo,this.dynamicLayoutVertexArray=new va,this.opacityVertexArray=new ro,this.placedSymbolArray=new sd,this.globeExtVertexArray=new _n}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,d,m){this.isEmpty()||(d&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Qm.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,eg.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Wg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Jm.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}U(jh,"SymbolBuffers");class Vh{constructor(r,l,d){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new d,this.segments=new yo,this.collisionVertexArray=new ql,this.collisionVertexArrayExt=new ws}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,tg.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,rg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}U(Vh,"CollisionBuffers");class Ml{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(w=>w.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ss([]),this.placementViewportMatrix=Ss([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ah(this.zoom,l["text-size"]),this.iconSizeData=Ah(this.zoom,l["icon-size"]);const d=this.layers[0].layout,m=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(w=>Va[w]),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new jh(new Zl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new jh(new Zl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new ud,this.lineVertexArray=new hd,this.symbolInstances=new cd}calculateGlyphDependencies(r,l,d,m,y){for(let w=0;w<r.length;w++)if(l[r.charCodeAt(w)]=!0,m&&y){const A=Kc[r.charAt(w)];A&&(l[A.charCodeAt(0)]=!0)}}populate(r,l,d,m){const y=this.layers[0],w=y.layout,A=this.projection.name==="globe",k=w.get("text-font"),P=w.get("text-field"),V=w.get("icon-image"),W=(P.value.kind!=="constant"||P.value.value instanceof pi&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),Q=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,ne=w.get("symbol-sort-key");if(this.features=[],!W&&!Q)return;const he=l.iconDependencies,ge=l.glyphDependencies,Ae=l.availableImages,je=new wt(this.zoom);for(const{feature:Qe,id:$e,index:Xe,sourceLayerIndex:nt}of r){const rt=y._featureFilter.needGeometry,Ot=Hl(Qe,rt);if(!y._featureFilter.filter(je,Ot,d))continue;if(rt||(Ot.geometry=il(Qe,d,m)),A&&Qe.type!==1&&d.z<=5){const Vt=Ot.geometry,sr=.98078528056,hr=(vr,Cr)=>os(iu(vr.x,vr.y,d,1),iu(Cr.x,Cr.y,d,1))<sr;for(let vr=0;vr<Vt.length;vr++)Vt[vr]=Yp(Vt[vr],hr)}let Rt,rr;if(W){const Vt=y.getValueAndResolveTokens("text-field",Ot,d,Ae),sr=pi.factory(Vt);Yg(sr)&&(this.hasRTLText=!0),(!this.hasRTLText||gt()==="unavailable"||this.hasRTLText&&Lt.isParsed())&&(Rt=og(sr,y,Ot))}if(Q){const Vt=y.getValueAndResolveTokens("icon-image",Ot,d,Ae);rr=Vt instanceof pn?Vt:pn.fromString(Vt)}if(!Rt&&!rr)continue;const Mr=this.sortFeaturesByKey?ne.evaluate(Ot,{},d):void 0;if(this.features.push({id:$e,text:Rt,icon:rr,index:Xe,sourceLayerIndex:nt,geometry:Ot.geometry,properties:Qe.properties,type:Hg[Qe.type],sortKey:Mr}),rr&&(he[rr.name]=!0),Rt){const Vt=k.evaluate(Ot,{},d).join(","),sr=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Va.vertical)>=0;for(const hr of Rt.sections)if(hr.image)he[hr.image.name]=!0;else{const vr=O(Rt.toString()),Cr=hr.fontStack||Vt,Xt=ge[Cr]=ge[Cr]||{};this.calculateGlyphDependencies(hr.text,Xt,sr,this.allowVerticalPlacement,vr)}}}w.get("symbol-placement")==="line"&&(this.features=function(Qe){const $e={},Xe={},nt=[];let rt=0;function Ot(Vt){nt.push(Qe[Vt]),rt++}function Rt(Vt,sr,hr){const vr=Xe[Vt];return delete Xe[Vt],Xe[sr]=vr,nt[vr].geometry[0].pop(),nt[vr].geometry[0]=nt[vr].geometry[0].concat(hr[0]),vr}function rr(Vt,sr,hr){const vr=$e[sr];return delete $e[sr],$e[Vt]=vr,nt[vr].geometry[0].shift(),nt[vr].geometry[0]=hr[0].concat(nt[vr].geometry[0]),vr}function Mr(Vt,sr,hr){const vr=hr?sr[0][sr[0].length-1]:sr[0][0];return`${Vt}:${vr.x}:${vr.y}`}for(let Vt=0;Vt<Qe.length;Vt++){const sr=Qe[Vt],hr=sr.geometry,vr=sr.text?sr.text.toString():null;if(!vr){Ot(Vt);continue}const Cr=Mr(vr,hr),Xt=Mr(vr,hr,!0);if(Cr in Xe&&Xt in $e&&Xe[Cr]!==$e[Xt]){const jr=rr(Cr,Xt,hr),Mi=Rt(Cr,Xt,nt[jr].geometry);delete $e[Cr],delete Xe[Xt],Xe[Mr(vr,nt[Mi].geometry,!0)]=Mi,nt[jr].geometry=null}else Cr in Xe?Rt(Cr,Xt,hr):Xt in $e?rr(Cr,Xt,hr):(Ot(Vt),$e[Cr]=rt-1,Xe[Xt]=rt-1)}return nt.filter(Vt=>Vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Qe,$e)=>Qe.sortKey-$e.sortKey)}update(r,l,d,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,d,m),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,d,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=cp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const d=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:m,y}of l)this.lineVertexArray.emplaceBack(m,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(r,l,d,m,y,w,A,k,P,V,W,Q,ne,he){const ge=r.indexArray,Ae=r.layoutVertexArray,je=r.globeExtVertexArray,Qe=r.segments.prepareSegment(4*l.length,Ae,ge,this.canOverlap?w.sortKey:void 0),$e=this.glyphOffsetArray.length,Xe=Qe.vertexLength,nt=this.allowVerticalPlacement&&A===Va.vertical?Math.PI/2:0,rt=w.text&&w.text.sections;for(let Rt=0;Rt<l.length;Rt++){const{tl:rr,tr:Mr,bl:Vt,br:sr,tex:hr,pixelOffsetTL:vr,pixelOffsetBR:Cr,minFontScaleX:Xt,minFontScaleY:jr,glyphOffset:Mi,isSDF:Zr,sectionIndex:ci}=l[Rt],Vr=Qe.vertexLength,Di=Mi[1];if(Zu(Ae,P.x,P.y,rr.x,Di+rr.y,hr.x,hr.y,d,Zr,vr.x,vr.y,Xt,jr),Zu(Ae,P.x,P.y,Mr.x,Di+Mr.y,hr.x+hr.w,hr.y,d,Zr,Cr.x,vr.y,Xt,jr),Zu(Ae,P.x,P.y,Vt.x,Di+Vt.y,hr.x,hr.y+hr.h,d,Zr,vr.x,Cr.y,Xt,jr),Zu(Ae,P.x,P.y,sr.x,Di+sr.y,hr.x+hr.w,hr.y+hr.h,d,Zr,Cr.x,Cr.y,Xt,jr),k){const{x:nn,y:Qi,z:Wi}=k.anchor,[Pi,Sn,zi]=k.up;Hu(je,nn,Qi,Wi,Pi,Sn,zi),Hu(je,nn,Qi,Wi,Pi,Sn,zi),Hu(je,nn,Qi,Wi,Pi,Sn,zi),Hu(je,nn,Qi,Wi,Pi,Sn,zi),Wu(r.dynamicLayoutVertexArray,nn,Qi,Wi,nt)}else Wu(r.dynamicLayoutVertexArray,P.x,P.y,P.z,nt);ge.emplaceBack(Vr,Vr+1,Vr+2),ge.emplaceBack(Vr+1,Vr+2,Vr+3),Qe.vertexLength+=4,Qe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mi[0]),Rt!==l.length-1&&ci===l[Rt+1].sectionIndex||r.programConfigurations.populatePaintArrays(Ae.length,w,w.index,{},ne,he,rt&&rt[ci])}const Ot=k?k.anchor:P;r.placedSymbolArray.emplaceBack(Ot.x,Ot.y,Ot.z,P.x,P.y,$e,this.glyphOffsetArray.length-$e,Xe,V,W,P.segment,d?d[0]:0,d?d[1]:0,m[0],m[1],A,0,!1,0,Q,0)}_commitLayoutVertex(r,l,d,m,y,w,A){r.emplaceBack(l,d,m,y,w,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(r,l,d,m,y,w,A){const k=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),P=k.vertexLength,V=A.tileAnchorX,W=A.tileAnchorY;for(let ne=0;ne<4;ne++)d.collisionVertexArray.emplaceBack(0,0,0,0);d.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),d.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),d.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),d.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(d.layoutVertexArray,m,y,w,V,W,new ue(r.x1,r.y1)),this._commitLayoutVertex(d.layoutVertexArray,m,y,w,V,W,new ue(r.x2,r.y1)),this._commitLayoutVertex(d.layoutVertexArray,m,y,w,V,W,new ue(r.x2,r.y2)),this._commitLayoutVertex(d.layoutVertexArray,m,y,w,V,W,new ue(r.x1,r.y2)),k.vertexLength+=4;const Q=d.indexArray;Q.emplaceBack(P,P+1),Q.emplaceBack(P+1,P+2),Q.emplaceBack(P+2,P+3),Q.emplaceBack(P+3,P),k.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,d,m,y,w){for(let A=m;A<y;A++){const k=d.get(A),P=this.getSymbolInstanceTextSize(r,w,l,A);this._addCollisionDebugVertices(k,P,this.textCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(r,l,d,m,y,w){for(let A=m;A<y;A++){const k=d.get(A),P=this.getSymbolInstanceIconSize(r,l,w.placedIconSymbolIndex);this._addCollisionDebugVertices(k,P,this.iconCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,w)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vh(On,wf.members,is),this.iconCollisionBox=new Vh(On,wf.members,is);const d=vc(this.iconSizeData,r),m=vc(this.textSizeData,r);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(m,r,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(m,r,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(d,r,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(d,r,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(r,l,d,m){const y=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),w=Ou(this.textSizeData,r,y)/Vo;return this.tilePixelRatio*w}getSymbolInstanceIconSize(r,l,d){const m=this.icon.placedSymbolArray.get(d),y=Ou(this.iconSizeData,r,m);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(r,l,d){r.emplaceBack(l,-d,-d),r.emplaceBack(l,d,-d),r.emplaceBack(l,d,d),r.emplaceBack(l,-d,d)}_updateTextDebugCollisionBoxes(r,l,d,m,y,w){for(let A=m;A<y;A++){const k=d.get(A),P=this.getSymbolInstanceTextSize(r,w,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,k.padding)}}_updateIconDebugCollisionBoxes(r,l,d,m,y,w){for(let A=m;A<y;A++){const k=d.get(A),P=this.getSymbolInstanceIconSize(r,l,w);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,k.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=vc(this.iconSizeData,r),m=vc(this.textSizeData,r);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(m,r,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._updateTextDebugCollisionBoxes(m,r,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._updateIconDebugCollisionBoxes(d,r,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(d,r,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,d,m,y,w,A,k,P){const V={};if(l<d){const{x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe,featureIndex:nt}=r.get(l);V.textBox={x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe},V.textFeatureIndex=nt}if(m<y){const{x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe,featureIndex:nt}=r.get(m);V.verticalTextBox={x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe},V.verticalTextFeatureIndex=nt}if(w<A){const{x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe,featureIndex:nt}=r.get(w);V.iconBox={x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe},V.iconFeatureIndex=nt}if(k<P){const{x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe,featureIndex:nt}=r.get(k);V.verticalIconBox={x1:W,y1:Q,x2:ne,y2:he,padding:ge,projectedAnchorX:Ae,projectedAnchorY:je,projectedAnchorZ:Qe,tileAnchorX:$e,tileAnchorY:Xe},V.verticalIconFeatureIndex=nt}return V}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const d=r.placedSymbolArray.get(l),m=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<m;y+=4)r.indexArray.emplaceBack(y,y+1,y+2),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),d=Math.cos(r),m=[],y=[],w=[];for(let A=0;A<this.symbolInstances.length;++A){w.push(A);const k=this.symbolInstances.get(A);m.push(0|Math.round(l*k.tileAnchorX+d*k.tileAnchorY)),y.push(k.featureIndex)}return w.sort((A,k)=>m[A]-m[k]||y[k]-y[A]),w}addToSortKeyRanges(r,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:P}=d;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&w!==y&&w!==m&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}U(Ml,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ml.MAX_GLYPHS=65535,Ml.addDynamicAttributes=Wu;const Kg=new wi({"symbol-placement":new Mt(Ft.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt(Ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt(Ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ut(Ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt(Ft.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mt(Ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mt(Ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt(Ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt(Ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ut(Ft.layout_symbol["icon-size"]),"icon-text-fit":new Mt(Ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mt(Ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ut(Ft.layout_symbol["icon-image"]),"icon-rotate":new Ut(Ft.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Ft.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt(Ft.layout_symbol["icon-keep-upright"]),"icon-offset":new Ut(Ft.layout_symbol["icon-offset"]),"icon-anchor":new Ut(Ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt(Ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt(Ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt(Ft.layout_symbol["text-rotation-alignment"]),"text-field":new Ut(Ft.layout_symbol["text-field"]),"text-font":new Ut(Ft.layout_symbol["text-font"]),"text-size":new Ut(Ft.layout_symbol["text-size"]),"text-max-width":new Ut(Ft.layout_symbol["text-max-width"]),"text-line-height":new Ut(Ft.layout_symbol["text-line-height"]),"text-letter-spacing":new Ut(Ft.layout_symbol["text-letter-spacing"]),"text-justify":new Ut(Ft.layout_symbol["text-justify"]),"text-radial-offset":new Ut(Ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt(Ft.layout_symbol["text-variable-anchor"]),"text-anchor":new Ut(Ft.layout_symbol["text-anchor"]),"text-max-angle":new Mt(Ft.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt(Ft.layout_symbol["text-writing-mode"]),"text-rotate":new Ut(Ft.layout_symbol["text-rotate"]),"text-padding":new Mt(Ft.layout_symbol["text-padding"]),"text-keep-upright":new Mt(Ft.layout_symbol["text-keep-upright"]),"text-transform":new Ut(Ft.layout_symbol["text-transform"]),"text-offset":new Ut(Ft.layout_symbol["text-offset"]),"text-allow-overlap":new Mt(Ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mt(Ft.layout_symbol["text-ignore-placement"]),"text-optional":new Mt(Ft.layout_symbol["text-optional"])});var Gh={paint:new wi({"icon-opacity":new Ut(Ft.paint_symbol["icon-opacity"]),"icon-color":new Ut(Ft.paint_symbol["icon-color"]),"icon-halo-color":new Ut(Ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ut(Ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ut(Ft.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt(Ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt(Ft.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ut(Ft.paint_symbol["text-opacity"]),"text-color":new Ut(Ft.paint_symbol["text-color"],{runtimeType:Rr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ut(Ft.paint_symbol["text-halo-color"]),"text-halo-width":new Ut(Ft.paint_symbol["text-halo-width"]),"text-halo-blur":new Ut(Ft.paint_symbol["text-halo-blur"]),"text-translate":new Mt(Ft.paint_symbol["text-translate"]),"text-translate-anchor":new Mt(Ft.paint_symbol["text-translate-anchor"])}),layout:Kg};class up{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ve,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}U(up,"FormatSectionOverride",{omit:["defaultValue"]});class Yu extends Ts{constructor(r){super(r,Gh)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const m=[];for(const y of d)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,d,m){const y=this.layout.get(r).evaluate(l,{},d,m),w=this._unevaluatedLayout._values[r];return w.isDataDriven()||Ps(w.value)||!y?y:function(A,k){return k.replace(/{([^{}]+)}/g,(P,V)=>V in A?String(A[V]):"")}(l.properties,y)}createBucket(r){return new Ml(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Gh.paint.overridableProperties){if(!Yu.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),d=new up(l),m=new Hs(d,l.property.specification);let y=null;y=l.value.kind==="constant"||l.value.kind==="source"?new Na("source",m):new Ws("composite",m,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new fr(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&Yu.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const d=r.get("text-field"),m=Gh.paint.properties[l];let y=!1;const w=A=>{for(const k of A)if(m.overrides&&m.overrides.hasOverride(k))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof pi)w(d.value.value.sections);else if(d.value.kind==="source"){const A=P=>{y||(P instanceof _i&&Oi(P.value)===$i?w(P.value.sections):P instanceof Nn?w(P.sections):P.eachChild(A))},k=d.value;k._styleExpression&&A(k._styleExpression.expression)}return y}getProgramConfiguration(r){return new wl(this,r)}}var Qg={paint:new wi({"background-color":new Mt(Ft.paint_background["background-color"]),"background-pattern":new Mt(Ft.paint_background["background-pattern"]),"background-opacity":new Mt(Ft.paint_background["background-opacity"])})},Jg={paint:new wi({"raster-opacity":new Mt(Ft.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mt(Ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt(Ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt(Ft.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt(Ft.paint_raster["raster-saturation"]),"raster-contrast":new Mt(Ft.paint_raster["raster-contrast"]),"raster-resampling":new Mt(Ft.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt(Ft.paint_raster["raster-fade-duration"])})};class e0 extends Ts{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var t0={paint:new wi({"sky-type":new Mt(Ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mt(Ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mt(Ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mt(Ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mt(Ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new ai(Ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mt(Ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mt(Ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mt(Ft.paint_sky["sky-opacity"])})};function qh(s,r,l){const d=[0,0,1],m=Gd([]);return Xd(m,m,l?-be(s)+Math.PI:be(s)),qd(m,m,-be(r)),Ud(d,d,m),ua(d,d)}const r0={circle:class extends Ts{constructor(s){super(s,im)}createBucket(s){return new sh(s)}queryRadius(s){const r=s;return pc("circle-radius",this,r)+pc("circle-stroke-width",this,r)+Eu(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,l,d,m,y,w,A){const k=Ld(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,s.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return Zd(s,d,y,w,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",k,P)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new wl(this,s)}},heatmap:class extends Ts{createBucket(s){return new Wd(s)}constructor(s){super(s,hm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return pc("heatmap-radius",this,s)}queryIntersectsFeature(s,r,l,d,m,y,w,A){const k=this.paint.get("heatmap-radius").evaluate(r,l);return Zd(s,d,y,w,A,!0,!0,new ue(0,0),k)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new wl(this,s)}},hillshade:class extends Ts{constructor(s){super(s,dm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ts{constructor(s){super(s,Cm)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new wl(this,s)}recalculate(s,r){super.recalculate(s,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Du(s)}queryRadius(){return Eu(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,l,d,m,y){return!s.queryGeometry.isAboveHorizon&&Cd(Pd(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,s.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends Ts{constructor(s){super(s,Gm)}createBucket(s){return new Hc(s)}queryRadius(){return Eu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new wl(this,s)}queryIntersectsFeature(s,r,l,d,m,y,w,A,k){const P=Ld(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,s.pixelToTileUnitsFactor),V=this.paint.get("fill-extrusion-height").evaluate(r,l),W=this.paint.get("fill-extrusion-base").evaluate(r,l),Q=[0,0],ne=A&&y.elevation,he=y.elevation?y.elevation.exaggeration():1,ge=s.tile.getBucket(this);if(ne&&ge instanceof Hc){const Xe=ge.centroidVertexArray,nt=k+1;nt<Xe.length&&(Q[0]=Xe.geta_centroid_pos0(nt),Q[1]=Xe.geta_centroid_pos1(nt))}if(Q[0]===0&&Q[1]===1)return!1;y.projection.name==="globe"&&(d=pf([d],[new ue(0,0),new ue(Li,Li)],s.tileID.canonical).map(Xe=>Xe.polygon).flat());const Ae=ne?A:null,[je,Qe]=function(Xe,nt,rt,Ot,Rt,rr,Mr,Vt,sr,hr,vr){return Xe.projection.name==="globe"?function(Cr,Xt,jr,Mi,Zr,ci,Vr,Di,nn,Qi,Wi){const Pi=[],Sn=[],zi=Cr.projection.upVectorScale(Wi,Cr.center.lat,Cr.worldSize).metersToTile,on=[0,0,0,1],Cn=[0,0,0,1],$n=(jn,Gn,Jn,Do)=>{jn[0]=Gn,jn[1]=Jn,jn[2]=Do,jn[3]=1},zn=ff();jr>0&&(jr+=zn),Mi+=zn;for(const jn of Xt){const Gn=[],Jn=[];for(const Do of jn){const Mn=Do.x+Zr.x,vo=Do.y+Zr.y,ho=Cr.projection.projectTilePoint(Mn,vo,Wi),yn=Cr.projection.upVector(Wi,Do.x,Do.y);let Yn=jr,So=Mi;if(Vr){const In=yf(Mn,vo,jr,Mi,Vr,Di,nn,Qi);Yn+=In.base,So+=In.top}jr!==0?$n(on,ho.x+yn[0]*zi*Yn,ho.y+yn[1]*zi*Yn,ho.z+yn[2]*zi*Yn):$n(on,ho.x,ho.y,ho.z),$n(Cn,ho.x+yn[0]*zi*So,ho.y+yn[1]*zi*So,ho.z+yn[2]*zi*So),io(on,on,ci),io(Cn,Cn,ci),Gn.push(new yc(on[0],on[1],on[2])),Jn.push(new yc(Cn[0],Cn[1],Cn[2]))}Pi.push(Gn),Sn.push(Jn)}return[Pi,Sn]}(Xe,nt,rt,Ot,Rt,rr,Mr,Vt,sr,hr,vr):Mr?function(Cr,Xt,jr,Mi,Zr,ci,Vr,Di,nn){const Qi=[],Wi=[],Pi=[0,0,0,1];for(const Sn of Cr){const zi=[],on=[];for(const Cn of Sn){const $n=Cn.x+Mi.x,zn=Cn.y+Mi.y,jn=yf($n,zn,Xt,jr,ci,Vr,Di,nn);Pi[0]=$n,Pi[1]=zn,Pi[2]=jn.base,Pi[3]=1,Ql(Pi,Pi,Zr),Pi[3]=Math.max(Pi[3],1e-5);const Gn=new yc(Pi[0]/Pi[3],Pi[1]/Pi[3],Pi[2]/Pi[3]);Pi[0]=$n,Pi[1]=zn,Pi[2]=jn.top,Pi[3]=1,Ql(Pi,Pi,Zr),Pi[3]=Math.max(Pi[3],1e-5);const Jn=new yc(Pi[0]/Pi[3],Pi[1]/Pi[3],Pi[2]/Pi[3]);zi.push(Gn),on.push(Jn)}Qi.push(zi),Wi.push(on)}return[Qi,Wi]}(nt,rt,Ot,Rt,rr,Mr,Vt,sr,hr):function(Cr,Xt,jr,Mi,Zr){const ci=[],Vr=[],Di=Zr[8]*Xt,nn=Zr[9]*Xt,Qi=Zr[10]*Xt,Wi=Zr[11]*Xt,Pi=Zr[8]*jr,Sn=Zr[9]*jr,zi=Zr[10]*jr,on=Zr[11]*jr;for(const Cn of Cr){const $n=[],zn=[];for(const jn of Cn){const Gn=jn.x+Mi.x,Jn=jn.y+Mi.y,Do=Zr[0]*Gn+Zr[4]*Jn+Zr[12],Mn=Zr[1]*Gn+Zr[5]*Jn+Zr[13],vo=Zr[2]*Gn+Zr[6]*Jn+Zr[14],ho=Zr[3]*Gn+Zr[7]*Jn+Zr[15],yn=Do+Di,Yn=Mn+nn,So=vo+Qi,In=Math.max(ho+Wi,1e-5),no=Do+Pi,ea=Mn+Sn,ko=vo+zi,Po=Math.max(ho+on,1e-5);$n.push(new yc(yn/In,Yn/In,So/In)),zn.push(new yc(no/Po,ea/Po,ko/Po))}ci.push($n),Vr.push(zn)}return[ci,Vr]}(nt,rt,Ot,Rt,rr)}(y,d,W,V,P,w,Ae,Q,he,y.center.lat,s.tileID.canonical),$e=s.queryGeometry;return function(Xe,nt,rt){let Ot=1/0;Cd(rt,nt)&&(Ot=_f(rt,nt[0]));for(let Rt=0;Rt<nt.length;Rt++){const rr=nt[Rt],Mr=Xe[Rt];for(let Vt=0;Vt<rr.length-1;Vt++){const sr=rr[Vt],hr=[sr,rr[Vt+1],Mr[Vt+1],Mr[Vt],sr];Ad(rt,hr)&&(Ot=Math.min(Ot,_f(rt,hr)))}}return Ot!==1/0&&Ot}(je,Qe,$e.isPointQuery()?$e.screenBounds:$e.screenGeometry)}},line:class extends Ts{constructor(s){super(s,vf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Zo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=xf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Bu(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new wl(this,s)}queryRadius(s){const r=s,l=bf(pc("line-width",this,r),pc("line-gap-width",this,r)),d=pc("line-offset",this,r);return l/2+Math.abs(d)+Eu(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,l,d,m,y){if(s.queryGeometry.isAboveHorizon)return!1;const w=Pd(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,s.pixelToTileUnitsFactor),A=s.pixelToTileUnitsFactor/2*bf(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),k=this.paint.get("line-offset").evaluate(r,l);return k&&(d=function(P,V){const W=[],Q=new ue(0,0);for(let ne=0;ne<P.length;ne++){const he=P[ne],ge=[];for(let Ae=0;Ae<he.length;Ae++){const je=he[Ae-1],Qe=he[Ae],$e=he[Ae+1],Xe=Ae===0?Q:Qe.sub(je)._unit()._perp(),nt=Ae===he.length-1?Q:$e.sub(Qe)._unit()._perp(),rt=Xe._add(nt)._unit();rt._mult(1/(rt.x*nt.x+rt.y*nt.y)),ge.push(rt._mult(V)._add(Qe))}W.push(ge)}return W}(d,k*s.pixelToTileUnitsFactor)),function(P,V,W){for(let Q=0;Q<V.length;Q++){const ne=V[Q];if(P.length>=3){for(let he=0;he<ne.length;he++)if(Wl(P,ne[he]))return!0}if(Jp(P,ne,W))return!0}return!1}(w,d,A)}isTileClipped(){return!0}},symbol:Yu,background:class extends Ts{constructor(s){super(s,Qg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ts{constructor(s){super(s,Jg)}getProgramIds(){return["raster"]}},sky:class extends Ts{constructor(s){super(s,t0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),m=!d,y=s.style.light,w=y.properties.get("position");return m&&y.properties.get("anchor")==="viewport"&&Br("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?qh(w.azimuthal,90-w.polar,r):qh(d[0],90-d[1],r)}const l=this.paint.get("sky-gradient-center");return qh(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class cu{constructor(r,l,d,m){this.context=r,this.format=d,this.texture=r.gl.createTexture(),this.update(l,m)}update(r,l,d){const{width:m,height:y}=r,{context:w}=this,{gl:A}=w,{HTMLImageElement:k,HTMLCanvasElement:P,HTMLVideoElement:V,ImageData:W,ImageBitmap:Q}=b;if(A.bindTexture(A.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),d||this.size&&this.size[0]===m&&this.size[1]===y){const{x:ne,y:he}=d||{x:0,y:0};r instanceof k||r instanceof P||r instanceof V||r instanceof W||Q&&r instanceof Q?A.texSubImage2D(A.TEXTURE_2D,0,ne,he,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,ne,he,m,y,A.RGBA,A.UNSIGNED_BYTE,r.data)}else this.size=[m,y],r instanceof k||r instanceof P||r instanceof V||r instanceof W||Q&&r instanceof Q?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,m,y,0,this.format,A.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?r===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class i0{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class n0{constructor(){this.tasks={},this.taskQueue=[],ar(["process"],this),this.invoker=new i0(this.process),this.nextId=0}add(r,l){const d=this.nextId++,m=function({type:y,isSymbolTile:w,zoom:A}){return A=A||0,y==="message"?0:y!=="maybePrepare"||w?y!=="parseTile"||w?y==="parseTile"&&w?300-A:y==="maybePrepare"&&w?400-A:500:200-A:100-A}(l);if(m===0){ur();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[d]={fn:r,metadata:l,priority:m,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){ur();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const y=this.tasks[this.taskQueue[m]];y.priority<l&&(l=y.priority,r=m)}if(r===null)return null;const d=this.taskQueue[r];return this.taskQueue.splice(r,1),d}remove(){this.invoker.remove()}}class hp{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const d=r[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const o0=["tile","layer","source","sourceLayer","state"];class dp{constructor(r,l,d,m,y){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=d,this._y=m,this.properties=r.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const l of o0)this[l]!==void 0&&(r[l]=this[l]);return r}}const ls=32,js=33,Al=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,l=0,d=0,m=0,y=0,w=0,A=0;for(1&r?m=y=w=ls:l=d=A=ls;(r>>=1)>1;){const P=l+m>>1,V=d+y>>1;1&r?(m=l,y=d,l=w,d=A):(l=m,d=y,m=w,y=A),w=P,A=V}const k=4*s;Al[k+0]=l,Al[k+1]=d,Al[k+2]=m,Al[k+3]=y}const Vs=new Uint16Array(2178),Cl=new Uint8Array(1089),Ku=new Uint16Array(1089);function fp(s){return s===0?-.03125:s===32?.03125:0}var pp=ti([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const mp={type:2,extent:Li,loadGeometry:()=>[[new ue(0,0),new ue(8193,0),new ue(8193,8193),new ue(0,8193),new ue(0,0)]]};class Xh{constructor(r,l,d,m,y){this.tileID=r,this.uid=mr(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<tr.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=tc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,d){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(m,y){const w={};if(!y)return w;for(const A of m){const k=A.layerIds.map(P=>y.getLayer(P)).filter(Boolean);if(k.length!==0){A.layers=k,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(P=>k.filter(V=>V.id===P)[0]));for(const P of k)w[P.id]=A}}return w}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof Ml){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof Ml&&y.hasRTLText){this.hasRTLText=!0,Lt.isLoading()||Lt.isLoaded()||gt()!=="deferred"||zt();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(m).queryRadius(y))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new eh}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new cu(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new cu(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new cu(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,d,m,y,w,A,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:A,transform:w,params:y,tileTransform:this.tileTransform},r,l,d):{}}querySourceFeatures(r,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),y=l?l.sourceLayer:"",w=m._geojsonTileLayer||m[y];if(!w)return;const A=Qa(l&&l.filter),{z:k,x:P,y:V}=this.tileID.canonical,W={z:k,x:P,y:V};for(let Q=0;Q<w.length;Q++){const ne=w.feature(Q);if(A.needGeometry){const Ae=Hl(ne,!0);if(!A.filter(new wt(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!A.filter(new wt(this.tileID.overscaledZ),ne))continue;const he=d.getId(ne,y),ge=new dp(ne,k,P,V,he);ge.tile=W,r.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const d=yi(r.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(l)if(this.expirationTime<l)m=!0;else{const y=this.expirationTime-l;y?this.expirationTime=d+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!l)return;const d=this.latestFeatureIndex.loadVTLayers(),m=l.style.listImages();for(const y in this.buckets){if(!l.style.hasLayer(y))continue;const w=this.buckets[y],A=w.layers[0].sourceLayer||"_geojsonTileLayer",k=d[A],P=r[A];if(!k||!P||Object.keys(P).length===0)continue;if(w.update(P,k,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),w instanceof Bu||w instanceof Du){const W=l.style._getSourceCache(w.layers[0].source);l._terrain&&l._terrain.enabled&&W&&w.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(W.id,this.tileID)}const V=l&&l.style&&l.style.getLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=tr.now()+r}setTexture(r,l){const d=l.context,m=d.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new cu(d,r,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),d.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax))}setDependencies(r,l){const d={};for(const m of l)d[m]=!0;this.dependencies[r]=d}hasDependency(r,l){for(const d of r){const m=this.dependencies[d];if(m){for(const y of l)if(m[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const d=il(mp,this.tileID.canonical,this.tileTransform)[0],m=new xn,y=new Lc;for(let w=0;w<d.length;w++){const{x:A,y:k}=d[w];m.emplaceBack(A,k),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(y),this._tileDebugBuffer=r.createVertexBuffer(m,tu.members),this._tileDebugSegments=yo.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const d=il(mp,this.tileID.canonical,this.tileTransform)[0];let m,y;if(this.isRaster){const w=function(A,k){const P=tc(A,k),V=Math.pow(2,A.z);for(let Ae=0;Ae<js;Ae++)for(let je=0;je<js;je++){const Qe=$a((A.x+(je+fp(je))/ls)/V),$e=jo((A.y+(Ae+fp(Ae))/ls)/V),Xe=k.project(Qe,$e),nt=Ae*js+je;Vs[2*nt+0]=Math.round((Xe.x*P.scale-P.x)*Li),Vs[2*nt+1]=Math.round((Xe.y*P.scale-P.y)*Li)}Cl.fill(0),Ku.fill(0);for(let Ae=2045;Ae>=0;Ae--){const je=4*Ae,Qe=Al[je+0],$e=Al[je+1],Xe=Al[je+2],nt=Al[je+3],rt=Qe+Xe>>1,Ot=$e+nt>>1,Rt=rt+Ot-$e,rr=Ot+Qe-rt,Mr=$e*js+Qe,Vt=nt*js+Xe,sr=Ot*js+rt,hr=Math.hypot((Vs[2*Mr+0]+Vs[2*Vt+0])/2-Vs[2*sr+0],(Vs[2*Mr+1]+Vs[2*Vt+1])/2-Vs[2*sr+1])>=16;if(Cl[sr]=Cl[sr]||(hr?1:0),Ae<1022){const vr=($e+rr>>1)*js+(Qe+Rt>>1),Cr=(nt+rr>>1)*js+(Xe+Rt>>1);Cl[sr]=Cl[sr]||Cl[vr]||Cl[Cr]}}const W=new An,Q=new $o;let ne=0;function he(Ae,je){const Qe=je*js+Ae;return Ku[Qe]===0&&(W.emplaceBack(Vs[2*Qe+0],Vs[2*Qe+1],Ae*Li/ls,je*Li/ls),Ku[Qe]=++ne),Ku[Qe]-1}function ge(Ae,je,Qe,$e,Xe,nt){const rt=Ae+Qe>>1,Ot=je+$e>>1;if(Math.abs(Ae-Xe)+Math.abs(je-nt)>1&&Cl[Ot*js+rt])ge(Xe,nt,Ae,je,rt,Ot),ge(Qe,$e,Xe,nt,rt,Ot);else{const Rt=he(Ae,je),rr=he(Qe,$e),Mr=he(Xe,nt);Q.emplaceBack(Rt,rr,Mr)}}return ge(0,0,ls,ls,ls,0),ge(ls,ls,0,0,0,ls),{vertices:W,indices:Q}}(this.tileID.canonical,l);m=w.vertices,y=w.indices}else{m=new An,y=new $o;for(const{x:A,y:k}of d)m.emplaceBack(A,k,0,0);const w=$c.exports(m.int16,void 0,4);for(let A=0;A<w.length;A+=3)y.emplaceBack(w[A],w[A+1],w[A+2])}this._tileBoundsBuffer=r.createVertexBuffer(m,pp.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(y),this._tileBoundsSegments=yo.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(r,l){const d=l.projection;if(!d||d.name!=="globe"||l.freezeTileCoverage)return;const m=this.tileID.canonical,y=nu(Qf(m,l)),w=Cc(l.zoom);let A;w>0&&(A=uh(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,m,l,y,A,w),this._makeGlobeTileDebugTextBuffer(r,m,l,y,A,w)}_globePoint(r,l,d,m,y,w,A){let k=iu(r,l,d);if(w){const P=1<<d.z,V=Fs(m.center.lng),W=zs(m.center.lat),Q=(d.x+.5)/P-V;let ne=0;Q>.5?ne=-1:Q<-.5&&(ne=1);let he=(r/Li+d.x)/P+ne,ge=(l/Li+d.y)/P;he=(he-V)*m._pixelsPerMercatorPixel+V,ge=(ge-W)*m._pixelsPerMercatorPixel+W;const Ae=[he*m.worldSize,ge*m.worldSize,0];io(Ae,Ae,w),k=ec(k,Ae,A)}return io(k,k,y)}_makeGlobeTileDebugBorderBuffer(r,l,d,m,y,w){const A=new xn,k=new Lc,P=new Dn,V=(Q,ne,he,ge,Ae)=>{const je=(he-Q)/(Ae-1),Qe=(ge-ne)/(Ae-1),$e=A.length;for(let Xe=0;Xe<Ae;Xe++){const nt=Q+Xe*je,rt=ne+Xe*Qe;A.emplaceBack(nt,rt);const Ot=this._globePoint(nt,rt,l,d,m,y,w);P.emplaceBack(Ot[0],Ot[1],Ot[2]),k.emplaceBack($e+Xe)}},W=Li;V(0,0,W,0,16),V(W,0,W,W,16),V(W,W,0,W,16),V(0,W,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(k),this._tileDebugBuffer=r.createVertexBuffer(A,tu.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(P,Yf.members),this._tileDebugSegments=yo.simpleSegment(0,0,A.length,k.length)}_makeGlobeTileDebugTextBuffer(r,l,d,m,y,w){const A=new xn,k=new $o,P=new Dn,V=25;k.reserve(32),A.reserve(V),P.reserve(V);const W=(Q,ne)=>V*Q+ne;for(let Q=0;Q<V;Q++){const ne=2048*Q;for(let he=0;he<V;he++){const ge=2048*he;A.emplaceBack(ge,ne);const Ae=this._globePoint(ge,ne,l,d,m,y,w);P.emplaceBack(Ae[0],Ae[1],Ae[2])}}for(let Q=0;Q<4;Q++)for(let ne=0;ne<4;ne++){const he=W(Q,ne),ge=W(Q,ne+1),Ae=W(Q+1,ne),je=W(Q+1,ne+1);k.emplaceBack(he,ge,Ae),k.emplaceBack(Ae,ge,je)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(k),this._tileDebugTextBuffer=r.createVertexBuffer(A,tu.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(P,Yf.members),this._tileDebugTextSegments=yo.simpleSegment(0,0,V,32)}}class a0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,d){const m=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][m]=this.stateChanges[r][m]||{},_t(this.stateChanges[r][m],d),this.deletedStates[r]===null){this.deletedStates[r]={};for(const y in this.state[r])y!==m&&(this.deletedStates[r][y]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][m]===null){this.deletedStates[r][m]={};for(const y in this.state[r][m])d[y]||(this.deletedStates[r][m][y]=null)}else for(const y in d)this.deletedStates[r]&&this.deletedStates[r][m]&&this.deletedStates[r][m][y]===null&&delete this.deletedStates[r][m][y]}removeFeatureState(r,l,d){if(this.deletedStates[r]===null)return;const m=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},d&&l!==void 0)this.deletedStates[r][m]!==null&&(this.deletedStates[r][m]=this.deletedStates[r][m]||{},this.deletedStates[r][m][d]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][m])for(d in this.deletedStates[r][m]={},this.stateChanges[r][m])this.deletedStates[r][m][d]=null;else this.deletedStates[r][m]=null;else this.deletedStates[r]=null}getState(r,l){const d=String(l),m=_t({},(this.state[r]||{})[d],(this.stateChanges[r]||{})[d]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const y=this.deletedStates[r][l];if(y===null)return{};for(const w in y)delete m[w]}return m}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),_t(this.state[m][w],this.stateChanges[m][w]),y[w]=this.state[m][w];d[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const w in this.state[m])y[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else for(const A of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][A];y[w]=this.state[m][w]}d[m]=d[m]||{},_t(d[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in r)r[m].setFeatureState(d,l)}}class gp{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const d=this.toIdx(r,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function _p(s,r,l,d){let m=0,y=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(d[w])<1e-15){if(l[w]<s[w]||l[w]>r[w])return null}else{const A=1/d[w];let k=(s[w]-l[w])*A,P=(r[w]-l[w])*A;if(k>P){const V=k;k=P,P=V}if(k>m&&(m=k),P<y&&(y=P),m>y)return null}return m}function yp(s,r,l,d,m,y,w,A,k,P,V){const W=d-s,Q=m-r,ne=y-l,he=w-s,ge=A-r,Ae=k-l,je=V[1]*Ae-V[2]*ge,Qe=V[2]*he-V[0]*Ae,$e=V[0]*ge-V[1]*he,Xe=W*je+Q*Qe+ne*$e;if(Math.abs(Xe)<1e-15)return null;const nt=1/Xe,rt=P[0]-s,Ot=P[1]-r,Rt=P[2]-l,rr=(rt*je+Ot*Qe+Rt*$e)*nt;if(rr<0||rr>1)return null;const Mr=Ot*ne-Rt*Q,Vt=Rt*W-rt*ne,sr=rt*Q-Ot*W,hr=(V[0]*Mr+V[1]*Vt+V[2]*sr)*nt;return hr<0||rr+hr>1?null:(he*Mr+ge*Vt+Ae*sr)*nt}function vp(s,r,l){return(s-r)/(l-r)}function xp(s,r,l,d,m,y,w,A,k){const P=1<<l,V=y-d,W=w-m,Q=(s+1)/P*V+d,ne=(r+0)/P*W+m,he=(r+1)/P*W+m;A[0]=(s+0)/P*V+d,A[1]=ne,k[0]=Q,k[1]=he}class bp{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(y){const w=Math.ceil(Math.log2(y.dim/8)),A=[];let k=Math.ceil(Math.pow(2,w));const P=1/k,V=(ne,he,ge,Ae,je)=>{const Qe=Ae?1:0,$e=(ne+1)*ge-Qe,Xe=he*ge,nt=(he+1)*ge-Qe;je[0]=ne*ge,je[1]=Xe,je[2]=$e,je[3]=nt};let W=new gp(k);const Q=[];for(let ne=0;ne<k*k;ne++){V(ne%k,Math.floor(ne/k),P,!1,Q);const he=Il(Q[0],Q[1],y),ge=Il(Q[2],Q[1],y),Ae=Il(Q[2],Q[3],y),je=Il(Q[0],Q[3],y);W.minimums.push(Math.min(he,ge,Ae,je)),W.maximums.push(Math.max(he,ge,Ae,je)),W.leaves.push(1)}for(A.push(W),k/=2;k>=1;k/=2){const ne=A[A.length-1];W=new gp(k);for(let he=0;he<k*k;he++){V(he%k,Math.floor(he/k),2,!0,Q);const ge=ne.getElevation(Q[0],Q[1]),Ae=ne.getElevation(Q[2],Q[1]),je=ne.getElevation(Q[2],Q[3]),Qe=ne.getElevation(Q[0],Q[3]),$e=ne.isLeaf(Q[0],Q[1]),Xe=ne.isLeaf(Q[2],Q[1]),nt=ne.isLeaf(Q[2],Q[3]),rt=ne.isLeaf(Q[0],Q[3]),Ot=Math.min(ge.min,Ae.min,je.min,Qe.min),Rt=Math.max(ge.max,Ae.max,je.max,Qe.max),rr=$e&&Xe&&nt&&rt;W.maximums.push(Rt),W.minimums.push(Ot),W.leaves.push(Rt-Ot<=5&&rr?1:0)}A.push(W)}return A}(this.dem),d=l.length-1,m=l[d];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(r,l,d,m,y,w,A=1){return _p([r,l,-100],[d,m,this.maximums[0]*A],y,w)}raycast(r,l,d,m,y,w,A=1){if(!this.nodeCount)return null;const k=this.raycastRoot(r,l,d,m,y,w,A);if(k==null)return null;const P=[],V=[],W=[],Q=[],ne=[{idx:0,t:k,nodex:0,nodey:0,depth:0}];for(;ne.length>0;){const{idx:he,t:ge,nodex:Ae,nodey:je,depth:Qe}=ne.pop();if(this.leaves[he]){xp(Ae,je,Qe,r,l,d,m,W,Q);const Xe=1<<Qe,nt=(Ae+0)/Xe,rt=(Ae+1)/Xe,Ot=(je+0)/Xe,Rt=(je+1)/Xe,rr=Il(nt,Ot,this.dem)*A,Mr=Il(rt,Ot,this.dem)*A,Vt=Il(rt,Rt,this.dem)*A,sr=Il(nt,Rt,this.dem)*A,hr=yp(W[0],W[1],rr,Q[0],W[1],Mr,Q[0],Q[1],Vt,y,w),vr=yp(Q[0],Q[1],Vt,W[0],Q[1],sr,W[0],W[1],rr,y,w),Cr=Math.min(hr!==null?hr:Number.MAX_VALUE,vr!==null?vr:Number.MAX_VALUE);if(Cr!==Number.MAX_VALUE)return Cr;{const Xt=Nc([],y,w,ge);if(wp(rr,Mr,sr,Vt,vp(Xt[0],W[0],Q[0]),vp(Xt[1],W[1],Q[1]))>=Xt[2])return ge}continue}let $e=0;for(let Xe=0;Xe<this._siblingOffset.length;Xe++){xp((Ae<<1)+this._siblingOffset[Xe][0],(je<<1)+this._siblingOffset[Xe][1],Qe+1,r,l,d,m,W,Q),W[2]=-100,Q[2]=this.maximums[this.childOffsets[he]+Xe]*A;const nt=_p(W,Q,y,w);if(nt!=null){const rt=nt;P[Xe]=rt;let Ot=!1;for(let Rt=0;Rt<$e&&!Ot;Rt++)rt>=P[V[Rt]]&&(V.splice(Rt,0,Xe),Ot=!0);Ot||(V[$e]=Xe),$e++}}for(let Xe=0;Xe<$e;Xe++){const nt=V[Xe];ne.push({idx:this.childOffsets[he]+nt,t:P[nt],nodex:(Ae<<1)+this._siblingOffset[nt][0],nodey:(je<<1)+this._siblingOffset[nt][1],depth:Qe+1})}}return null}_addNode(r,l,d){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,d,m,y){if(r[m].isLeaf(l,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const w=m-1,A=r[w];let k=0,P=0;for(let V=0;V<this._siblingOffset.length;V++){const W=2*l+this._siblingOffset[V][0],Q=2*d+this._siblingOffset[V][1],ne=A.getElevation(W,Q),he=A.isLeaf(W,Q),ge=this._addNode(ne.min,ne.max,he);he&&(k|=1<<V),P||(P=ge)}for(let V=0;V<this._siblingOffset.length;V++)k&1<<V||this._construct(r,2*l+this._siblingOffset[V][0],2*d+this._siblingOffset[V][1],w,P+V)}}function wp(s,r,l,d,m,y){return en(en(s,l,y),en(r,d,y),m)}function Il(s,r,l){const d=l.dim,m=xt(s*d-.5,0,d-1),y=xt(r*d-.5,0,d-1),w=Math.floor(m),A=Math.floor(y),k=Math.min(w+1,d-1),P=Math.min(A+1,d-1);return wp(l.get(w,A),l.get(k,A),l.get(w,P),l.get(k,P),m-w,y-A)}const Ep={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Qu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,d,m=!1,y=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return Br(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const w=this.dim=l.height-2,A=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=d||"mapbox",this.borderReady=m,!m){for(let k=0;k<w;k++)A[this._idx(-1,k)]=A[this._idx(0,k)],A[this._idx(w,k)]=A[this._idx(w-1,k)],A[this._idx(k,-1)]=A[this._idx(k,0)],A[this._idx(k,w)]=A[this._idx(k,w-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(w,-1)]=A[this._idx(w-1,0)],A[this._idx(-1,w)]=A[this._idx(0,w-1)],A[this._idx(w,w)]=A[this._idx(w-1,w-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new bp(this)}get(r,l,d=!1){d&&(r=xt(r,-1,this.dim),l=xt(l,-1,this.dim));const m=4*this._idx(r,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(r){return Ep[r]}get unpackVector(){return Ep[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}_unpackMapbox(r,l,d){return(256*r*256+256*l+d)/10-1e4}_unpackTerrarium(r,l,d){return 256*r+l+d/256-32768}static pack(r,l){const d=[0,0,0,0],m=Qu.getUnpackVector(l);let y=Math.floor((r+m[3])/m[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new Aa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,d){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,y=l*this.dim+this.dim,w=d*this.dim,A=d*this.dim+this.dim;switch(l){case-1:m=y-1;break;case 1:y=m+1}switch(d){case-1:w=A-1;break;case 1:A=w+1}const k=-l*this.dim,P=-d*this.dim;for(let V=w;V<A;V++)for(let W=m;W<y;W++){const Q=4*this._idx(W,V),ne=4*this._idx(W+k,V+P);this.pixels[Q+0]=r.pixels[ne+0],this.pixels[Q+1]=r.pixels[ne+1],this.pixels[Q+2]=r.pixels[ne+2],this.pixels[Q+3]=r.pixels[ne+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}U(Qu,"DEMData"),U(bp,"DemMinMaxQuadTree",{omit:["dem"]});class s0{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,d){const m=r.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:l,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(r,y)},d)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const d=r.wrapped().key,m=l===void 0?0:this.data[d].indexOf(l),y=this.data[d][m];return this.data[d].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const d in this.data)for(const m of this.data[d])r(m.value)||l.push(m);for(const d of l)this.remove(d.value.tileID,d)}}class Dc{constructor(r,l,d){this.func=r,this.mask=l,this.range=d}}Dc.ReadOnly=!1,Dc.ReadWrite=!0,Dc.disabled=new Dc(519,Dc.ReadOnly,[0,1]);const Zh=7680;class Hh{constructor(r,l,d,m,y,w){this.test=r,this.ref=l,this.mask=d,this.fail=m,this.depthFail=y,this.pass=w}}Hh.disabled=new Hh({func:519,mask:0},0,0,Zh,Zh,Zh);class Gs{constructor(r,l,d){this.blendFunction=r,this.blendColor=l,this.mask=d}}Gs.Replace=[1,0],Gs.disabled=new Gs(Gs.Replace,Ir.transparent,[!1,!1,!1,!1]),Gs.unblended=new Gs(Gs.Replace,Ir.transparent,[!0,!0,!0,!0]),Gs.alphaBlended=new Gs([1,771],Ir.transparent,[!0,!0,!0,!0]);const Wh=1029,Yh=2305;class As{constructor(r,l,d){this.enable=r,this.mode=l,this.frontFace=d}}As.disabled=new As(!1,Wh,Yh),As.backCCW=new As(!0,Wh,Yh),As.backCW=new As(!0,Wh,2304),As.frontCW=new As(!0,1028,2304),As.frontCCW=new As(!0,1028,Yh);class rc extends Xi{constructor(r,l,d){super(),this.id=r,this._onlySymbols=d,l.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new s0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new a0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(r),d.prepare(this.map.style.imageManager)}}getIds(){return Gr(this._tiles).map(r=>r.tileID).sort(Tp).map(r=>r.key)}getRenderableIds(r){const l=[];for(const d in this._tiles)this._isIdRenderable(+d,r)&&l.push(this._tiles[d]);return r?l.sort((d,m)=>{const y=d.tileID,w=m.tileID,A=new ue(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),k=new ue(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||k.y-A.y||k.x-A.x}).map(d=>d.tileID.key):l.map(d=>d.tileID).sort(Tp).map(d=>d.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const d=this._tiles[r];d&&(d.state!=="loading"&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,r,l)))}_tileLoaded(r,l,d,m){if(m)if(r.state="errored",m.status!==404)this._source.fire(new Gi(m,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=tr.now(),d==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Ji("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let m=0;m<l.length;m++){const y=l[m];if(r.neighboringTiles&&r.neighboringTiles[y]){const w=this.getTileByID(y);d(r,w),d(w,r)}}function d(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-m.tileID.canonical.x;const A=y.tileID.canonical.y-m.tileID.canonical.y,k=Math.pow(2,m.tileID.canonical.z),P=y.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+k)===1?w+=k:Math.abs(w-k)===1&&(w-=k)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,w,A),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,d,m){for(const y in this._tiles){let w=this._tiles[y];if(m[y]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>d)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const P=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[P.key],w&&w.hasData()&&(A=P)}let k=A;for(;k.overscaledZ>l;)if(k=k.scaledTo(k.overscaledZ-1),r[k.key]){m[A.key]=A;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const d=this._loadedParentTiles[r.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=r.overscaledZ-1;d>=l;d--){const m=r.scaledTo(d),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const d=Math.ceil(r.width/l)+1,m=Math.ceil(r.height/l)+1,y=Math.floor(d*m*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const d={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),d[y.tileID.key]=y}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(r,l,d){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let m;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new da(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(m=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(A=>this._source.hasTile(A)))):m=[];const y=this._updateRetainedTiles(m);if(Sp(this._source.type)&&m.length!==0){const A={},k={},P=Object.keys(y);for(const W of P){const Q=y[W],ne=this._tiles[W];if(!ne||ne.fadeEndTime&&ne.fadeEndTime<=tr.now())continue;const he=this.findLoadedParent(Q,Math.max(Q.overscaledZ-rc.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),A[he.tileID.key]=he.tileID),k[W]=Q}const V=m[m.length-1].overscaledZ;for(const W in this._tiles){const Q=this._tiles[W];if(y[W]||!Q.hasData())continue;let ne=Q.tileID;for(;ne.overscaledZ>V;){ne=ne.scaledTo(ne.overscaledZ-1);const he=this._tiles[ne.key];if(he&&he.hasData()&&k[ne.key]){y[W]=Q.tileID;break}}}for(const W in A)y[W]||(this._coveredTiles[W]=!0,y[W]=A[W])}for(const A in y)this._tiles[A].clearFadeHold();const w=function(A,k){const P=[];for(const V in A)V in k||P.push(V);return P}(this._tiles,y);for(const A of w){const k=this._tiles[A];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const d={},m=r.reduce((P,V)=>Math.min(P,V.overscaledZ),1/0),y=r[0].overscaledZ,w=Math.max(y-rc.maxOverzooming,this._source.minzoom),A=Math.max(y+rc.maxUnderzooming,this._source.minzoom),k={};for(const P of r){const V=this._addTile(P);l[P.key]=P,V.hasData()||m<this._source.maxzoom&&(k[P.key]=P)}this._retainLoadedChildren(k,m,A,l);for(const P of r){let V=this._tiles[P.key];if(V.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const Q=P.children(this._source.maxzoom)[0],ne=this.getTile(Q);if(ne&&ne.hasData()){l[Q.key]=Q;continue}}else{const Q=P.children(this._source.maxzoom);if(l[Q[0].key]&&l[Q[1].key]&&l[Q[2].key]&&l[Q[3].key])continue}let W=V.wasRequested();for(let Q=P.overscaledZ-1;Q>=w;--Q){const ne=P.scaledTo(Q);if(d[ne.key]||(d[ne.key]=!0,V=this.getTile(ne),!V&&W&&(V=this._addTile(ne)),V&&(l[ne.key]=ne,W=V.wasRequested(),V.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let d,m=this._tiles[r].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}l.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;m=y}for(const y of l)this._loadedParentTiles[y]=d}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const d=Boolean(l);if(!d){const m=this.map?this.map.painter:null;l=new Xh(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,d||this._source.fire(new Ji("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const d=l.getExpiryTimeout();d&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},d))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,d){const m=[],y=this.transform;if(!y)return m;const w=y.projection.name==="globe",A=Fs(y.center.lng);for(const k in this._tiles){const P=this._tiles[k];if(d&&P.clearQueryDebugViz(),P.holdingForFade())continue;let V;if(w){const W=P.tileID.canonical;if(W.z===0){const Q=[Math.abs(xt(A,...uu(W,-1))-A),Math.abs(xt(A,...uu(W,1))-A)];V=[0,2*Q.indexOf(Math.min(...Q))-1]}else{const Q=[Math.abs(xt(A,...uu(W,-1))-A),Math.abs(xt(A,...uu(W,0))-A),Math.abs(xt(A,...uu(W,1))-A)];V=[Q.indexOf(Math.min(...Q))-1]}}else V=[0];for(const W of V){const Q=r.containsTile(P,y,l,W);Q&&m.push(Q)}}return m}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(d=>this._tiles[d].tileID);for(const d of l)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Sp(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=tr.now())return!0}return!1}setFeatureState(r,l,d){this._state.updateState(r=r||"_geojsonTileLayer",l,d)}removeFeatureState(r,l,d){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,d)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,d){const m=this._tiles[r];m&&m.setDependencies(l,d)}reloadTilesForDependencies(r,l){for(const d in this._tiles)this._tiles[d].hasDependency(r,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(r,l))}_preloadTiles(r,l){const d=new Map,m=Array.isArray(r)?r:[r],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const A of m){const k=A.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of k)d.set(P.key,P);this.usedForTerrain&&A.updateElevation(!1)}Sr(Array.from(d.values()),(A,k)=>{const P=new Xh(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,V=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),k(V,P)})},l)}}function Tp(s,r){const l=Math.abs(2*s.wrap)-+(s.wrap<0),d=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||d-l||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function Sp(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function uu(s,r){const l=1<<s.z;return[s.x/l+r,(s.x+1)/l+r]}rc.maxOverzooming=10,rc.maxUnderzooming=3;class Ju{constructor(r,l,d){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(r,l,d){const m=d||r.findDEMTileFor(l);if(!m||!m.dem)return;const y=m.dem,w=m.tileID,A=1<<l.canonical.z-w.canonical.z;return new Ju(m,m.tileSize/Li/A,[(l.canonical.x/A-w.canonical.x)*y.dim,(l.canonical.y/A-w.canonical.y)*y.dim])}tileCoordToPixel(r,l){const d=l*this._scale+this._offset[1],m=Math.floor(r*this._scale+this._offset[0]),y=Math.floor(d);return new ue(m,y)}getElevationAt(r,l,d,m){const y=r*this._scale+this._offset[0],w=l*this._scale+this._offset[1],A=Math.floor(y),k=Math.floor(w),P=this._dem;return m=!!m,d?en(en(P.get(A,k,m),P.get(A,k+1,m),w-k),en(P.get(A+1,k,m),P.get(A+1,k+1,m),w-k),y-A):P.get(A,k,m)}getElevationAtPixel(r,l,d){return this._dem.get(r,l,!!d)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*ns(1,r)*this._dem.stride}}class Mp{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new D(Li,16,0),this.featureIndexArray=new fd,this.promoteId=l}insert(r,l,d,m,y,w=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,m,y,w);const k=this.grid;for(let P=0;P<l.length;P++){const V=l[P],W=[1/0,1/0,-1/0,-1/0];for(let Q=0;Q<V.length;Q++){const ne=V[Q];W[0]=Math.min(W[0],ne.x),W[1]=Math.min(W[1],ne.y),W[2]=Math.max(W[2],ne.x),W[3]=Math.max(W[3],ne.y)}W[0]<Li&&W[1]<Li&&W[2]>=0&&W[3]>=0&&k.insert(A,W[0],W[1],W[2],W[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Mh(new Qc(this.rawTileData)).layers,this.sourceLayerCoder=new hp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,d,m){this.loadVTLayers();const y=r.params||{},w=Qa(y.filter),A=r.tileResult,k=r.transform,P=A.bufferedTilespaceBounds,V=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(he,ge,Ae,je)=>kd(A.bufferedTilespaceGeometry,he,ge,Ae,je));V.sort(l0);let W=null;k.elevation&&V.length>0&&(W=Ju.create(k.elevation,this.tileID));const Q={};let ne;for(let he=0;he<V.length;he++){const ge=V[he];if(ge===ne)continue;ne=ge;const Ae=this.featureIndexArray.get(ge);let je=null;this.loadMatchingFeature(Q,Ae,w,y.layers,y.availableImages,l,d,m,(Qe,$e,Xe,nt=0)=>(je||(je=il(Qe,this.tileID.canonical,r.tileTransform)),$e.queryIntersectsFeature(A,Qe,Xe,je,this.z,r.transform,r.pixelPosMatrix,W,nt)))}return Q}loadMatchingFeature(r,l,d,m,y,w,A,k,P){const{featureIndex:V,bucketIndex:W,sourceLayerIndex:Q,layoutVertexArrayOffset:ne}=l,he=this.bucketLayerIDs[W];if(m&&!function(Qe,$e){for(let Xe=0;Xe<Qe.length;Xe++)if($e.indexOf(Qe[Xe])>=0)return!0;return!1}(m,he))return;const ge=this.sourceLayerCoder.decode(Q),Ae=this.vtLayers[ge].feature(V);if(d.needGeometry){const Qe=Hl(Ae,!0);if(!d.filter(new wt(this.tileID.overscaledZ),Qe,this.tileID.canonical))return}else if(!d.filter(new wt(this.tileID.overscaledZ),Ae))return;const je=this.getId(Ae,ge);for(let Qe=0;Qe<he.length;Qe++){const $e=he[Qe];if(m&&m.indexOf($e)<0)continue;const Xe=w[$e];if(!Xe)continue;let nt={};je!==void 0&&k&&(nt=k.getState(Xe.sourceLayer||"_geojsonTileLayer",je));const rt=_t({},A[$e]);rt.paint=Ap(rt.paint,Xe.paint,Ae,nt,y),rt.layout=Ap(rt.layout,Xe.layout,Ae,nt,y);const Ot=!P||P(Ae,Xe,nt,ne);if(!Ot)continue;const Rt=new dp(Ae,this.z,this.x,this.y,je);Rt.layer=rt;let rr=r[$e];rr===void 0&&(rr=r[$e]=[]),rr.push({featureIndex:V,feature:Rt,intersectionZ:Ot})}}lookupSymbolFeatures(r,l,d,m,y,w,A,k){const P={};this.loadVTLayers();const V=Qa(y);for(const W of r)this.loadMatchingFeature(P,{bucketIndex:d,sourceLayerIndex:m,featureIndex:W,layoutVertexArrayOffset:0},V,w,A,k,l);return P}loadFeature(r){const{featureIndex:l,sourceLayerIndex:d}=r;this.loadVTLayers();const m=this.sourceLayerCoder.decode(d),y=this.vtFeatures[m];if(y[l])return y[l];const w=this.vtLayers[m].feature(l);return y[l]=w,w}hasLayer(r){for(const l of this.bucketLayerIDs)for(const d of l)if(r===d)return!0;return!1}getId(r,l){let d=r.id;if(this.promoteId){const m=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];m!=null&&(d=r.properties[m]),typeof d=="boolean"&&(d=Number(d))}return d}}function Ap(s,r,l,d,m){return ii(s,(y,w)=>{const A=r instanceof kr?r.get(w):null;return A&&A.evaluate?A.evaluate(l,d,m):A})}function l0(s,r){return r-s}U(Mp,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Cp{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new ol({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const d=this.getKey(r,l);return this.positions[d]}trim(){const r=this.width,l=this.height=er(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,d){const m=[];let y=r.length%2==1?-r[r.length-1]*d:0,w=r[0]*d,A=!0;m.push({left:y,right:w,isDash:A,zeroLength:r[0]===0});let k=r[0];for(let P=1;P<r.length;P++){A=!A;const V=r[P];y=k*d,k+=V,w=k*d,m.push({left:y,right:w,isDash:A,zeroLength:V===0})}return m}addRoundDash(r,l,d){const m=l/2;for(let y=-d;y<=d;y++){const w=this.width*(this.nextRow+d+y);let A=0,k=r[A];for(let P=0;P<this.width;P++){P/k.right>1&&(k=r[++A]);const V=Math.abs(P-k.left),W=Math.abs(P-k.right),Q=Math.min(V,W);let ne;const he=y/d*(m+1);if(k.isDash){const ge=m-Math.abs(he);ne=Math.sqrt(Q*Q+ge*ge)}else ne=m-Math.sqrt(Q*Q+he*he);this.image.data[w+P]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(r,l){for(let k=r.length-1;k>=0;--k){const P=r[k],V=r[k+1];P.zeroLength?r.splice(k,1):V&&V.isDash===P.isDash&&(V.left=P.left,r.splice(k,1))}const d=r[0],m=r[r.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const y=this.width*this.nextRow;let w=0,A=r[w];for(let k=0;k<this.width;k++){k/A.right>1&&(A=r[++w]);const P=Math.abs(k-A.left),V=Math.abs(k-A.right),W=Math.min(P,V);this.image.data[y+k]=Math.max(0,Math.min(255,(A.isDash?W:-W)+l+128))}}addDash(r,l){const d=this.getKey(r,l);if(this.positions[d])return this.positions[d];const m=l==="round",y=m?7:0,w=2*y+1;if(this.nextRow+w>this.height)return Br("LineAtlas out of space"),null;r.length===0&&r.push(1);let A=0;for(let V=0;V<r.length;V++)r[V]<0&&(Br("Negative value is found in line dasharray, replacing values with 0"),r[V]=0),A+=r[V];if(A!==0){const V=this.width/A,W=this.getDashRanges(r,this.width,V);m?this.addRoundDash(W,V,y):this.addRegularDash(W,l==="square"?.5*V:0)}const k=this.nextRow+y;this.nextRow+=w;const P={tl:[k,y],br:[A,0]};return this.positions[d]=P,P}}U(Cp,"LineAtlas");class Ip{constructor(r){const l={},d=[];for(const A in r){const k=r[A],P=l[A]={};for(const V in k.glyphs){const W=k.glyphs[+V];if(!W||W.bitmap.width===0||W.bitmap.height===0)continue;const Q=W.metrics.localGlyph?2:1,ne={x:0,y:0,w:W.bitmap.width+2*Q,h:W.bitmap.height+2*Q};d.push(ne),P[V]=ne}}const{w:m,h:y}=Ih(d),w=new ol({width:m||1,height:y||1});for(const A in r){const k=r[A];for(const P in k.glyphs){const V=k.glyphs[+P];if(!V||V.bitmap.width===0||V.bitmap.height===0)continue;const W=l[A][P],Q=V.metrics.localGlyph?2:1;ol.copy(V.bitmap,w,{x:0,y:0},{x:W.x+Q,y:W.y+Q},V.bitmap)}}this.image=w,this.positions=l}}U(Ip,"GlyphAtlas");class c0{constructor(r){this.tileID=new da(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=tc(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,d,m,y){this.status="parsing",this.data=r,this.collisionBoxArray=new eh;const w=new hp(Object.keys(r.layers).sort()),A=new Mp(this.tileID,this.promoteId);A.bucketLayerIDs=[];const k={},P=new Cp(256,256),V={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:P,availableImages:d},W=l.familiesBySource[this.source];for(const nt in W){const rt=r.layers[nt];if(!rt)continue;let Ot=!1,Rt=!1;for(const Vt of W[nt])Vt[0].type==="symbol"?Ot=!0:Rt=!0;if(this.isSymbolTile===!0&&!Ot||this.isSymbolTile===!1&&!Rt)continue;rt.version===1&&Br(`Vector tile source "${this.source}" layer "${nt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const rr=w.encode(nt),Mr=[];for(let Vt=0;Vt<rt.length;Vt++){const sr=rt.feature(Vt),hr=A.getId(sr,nt);Mr.push({feature:sr,id:hr,index:Vt,sourceLayerIndex:rr})}for(const Vt of W[nt]){const sr=Vt[0];this.isSymbolTile!==void 0&&sr.type==="symbol"!==this.isSymbolTile||sr.minzoom&&this.zoom<Math.floor(sr.minzoom)||sr.maxzoom&&this.zoom>=sr.maxzoom||sr.visibility!=="none"&&(Kh(Vt,this.zoom,d),(k[sr.id]=sr.createBucket({index:A.bucketLayerIDs.length,layers:Vt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:rr,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:d})).populate(Mr,V,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(Vt.map(hr=>hr.id)))}}let Q,ne,he,ge;P.trim();const Ae={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},je=ii(V.glyphDependencies,nt=>Object.keys(nt).map(Number));Object.keys(je).length?m.send("getGlyphs",{uid:this.uid,stacks:je},(nt,rt)=>{Q||(Q=nt,ne=rt,Xe.call(this))},void 0,!1,Ae):ne={};const Qe=Object.keys(V.iconDependencies);Qe.length?m.send("getImages",{icons:Qe,source:this.source,tileID:this.tileID,type:"icons"},(nt,rt)=>{Q||(Q=nt,he=rt,Xe.call(this))},void 0,!1,Ae):he={};const $e=Object.keys(V.patternDependencies);function Xe(){if(Q)return y(Q);if(ne&&he&&ge){const nt=new Ip(ne),rt=new If(he,ge);for(const Ot in k){const Rt=k[Ot];Rt instanceof Ml?(Kh(Rt.layers,this.zoom,d),kg(Rt,ne,nt.positions,he,rt.iconPositions,this.showCollisionBoxes,d,this.tileID.canonical,this.tileZoom,this.projection)):Rt.hasPattern&&(Rt instanceof Bu||Rt instanceof Du||Rt instanceof Hc)&&(Kh(Rt.layers,this.zoom,d),Rt.addFeatures(V,this.tileID.canonical,rt.patternPositions,d,this.tileTransform))}this.status="done",y(null,{buckets:Gr(k).filter(Ot=>!Ot.isEmpty()),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nt.image,lineAtlas:P,imageAtlas:rt,glyphMap:this.returnDependencies?ne:null,iconMap:this.returnDependencies?he:null,glyphPositions:this.returnDependencies?nt.positions:null})}}$e.length?m.send("getImages",{icons:$e,source:this.source,tileID:this.tileID,type:"patterns"},(nt,rt)=>{Q||(Q=nt,ge=rt,Xe.call(this))},void 0,!1,Ae):ge={},Xe.call(this)}}function Kh(s,r,l){const d=new wt(r);for(const m of s)m.recalculate(d,l)}class Dp{constructor(r){this.entries={},this.scheduler=r}request(r,l,d,m){const y=this.entries[r]=this.entries[r]||{callbacks:[]};if(y.result){const[w,A]=y.result;return this.scheduler?this.scheduler.add(()=>{m(w,A)},l):m(w,A),()=>{}}return y.callbacks.push(m),y.cancel||(y.cancel=d((w,A)=>{y.result=[w,A];for(const k of y.callbacks)this.scheduler?this.scheduler.add(()=>{k(w,A)},l):k(w,A);setTimeout(()=>delete this.entries[r],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(w=>w!==m),y.callbacks.length||(y.cancel(),delete this.entries[r]))}}}function kp(s,r,l){const d=JSON.stringify(s.request);return s.data&&(this.deduped.entries[d]={result:[null,s.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},m=>{const y=Ti(s.request,(w,A,k,P)=>{w?m(w):A&&m(null,{vectorTile:l?void 0:new Mh(new Qc(A)),rawData:A,cacheControl:k,expires:P})});return()=>{y.cancel(),m()}},r)}a.ARRAY_TYPE=Ma,a.AUTH_ERR_MSG=po,a.Aabb=ha,a.Actor=class{constructor(s,r,l){this.target=s,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},ar(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ur()?s:b,this.scheduler=new n0}send(s,r,l,d,m=!1,y){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=y,this.callbacks[w]=l);const A=mi(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:s,hasCallback:!!l,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:me(r,A)},A),{cancel:()=>{l&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(s){const r=s.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d.cancel()}else if(r.mustQueue||ur()){const d=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,r),d&&d.metadata||{type:"message"})}else this.processTask(l,r)}processTask(s,r){if(r.type==="<response>"){const l=this.callbacks[s];delete this.callbacks[s],l&&(r.error?l(we(r.error)):l(null,we(r.data)))}else{const l=mi(this.globalScope)?void 0:[],d=r.hasCallback?(y,w)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:y?me(y):null,data:me(w,l)},l)}:y=>{},m=we(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,m,d);else if(this.parent.getWorkerSource){const y=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,y[0],m.source)[y[1]](m,d)}else d(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Ru,a.Color=Ir,a.ColorMode=Gs,a.CullFaceMode=As,a.DEMData=Qu,a.DataConstantProperty=Mt,a.DedupedRequest=Dp,a.DepthMode=Dc,a.EXTENT=Li,a.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const l=r.getSource().maxzoom,d=1<<l,m=Math.floor(s.x),y=Math.floor((s.x-m)*d),w=Math.floor(s.y*d),A=this.findDEMTileFor(new da(l,m,l,y,w));return!(!A||!A.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const d=this._source();if(!d||s.y<0||s.y>1)return r;const m=d.getSource().maxzoom,y=1<<m,w=Math.floor(s.x),A=s.x-w,k=new da(m,w,m,Math.floor(A*y),Math.floor(s.y*y)),P=this.findDEMTileFor(k);if(!P||!P.dem)return r;const V=P.dem,W=1<<P.tileID.canonical.z,Q=(A*W-P.tileID.canonical.x)*V.dim,ne=(s.y*W-P.tileID.canonical.y)*V.dim,he=Math.floor(Q),ge=Math.floor(ne);return(l?this.exaggeration():1)*en(en(V.get(he,ge),V.get(he,ge+1),ne-ge),en(V.get(he+1,ge),V.get(he+1,ge+1),ne-ge),Q-he)}getAtTileOffset(s,r,l){const d=1<<s.canonical.z;return this.getAtPointOrZero(new fc(s.wrap+(s.canonical.x+r/Li)/d,(s.canonical.y+l/Li)/d))}getAtTileOffsetFunc(s,r,l,d){return m=>{const y=this.getAtTileOffset(s,m.x,m.y),w=d.upVector(s.canonical,m.x,m.y);return ja(w,w,y*d.upVectorScale(s.canonical,r,l).metersToTile),w}}getForTilePoints(s,r,l,d){if(this.isUsingMockSource())return!1;const m=Ju.create(this,s,d);return!!m&&(r.forEach(y=>{y[2]=this.exaggeration()*m.getElevationAt(y[0],y[1],l)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const l=r.dem.tree,d=r.tileID,m=1<<s.canonical.z-d.canonical.z;let y=s.canonical.x/m-d.canonical.x,w=s.canonical.y/m-d.canonical.y,A=0;for(let k=0;k<s.canonical.z-d.canonical.z&&!l.leaves[A];k++){y*=2,w*=2;const P=2*Math.floor(w)+Math.floor(y);A=l.childOffsets[A]+P,y%=1,w%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=Gi,a.EvaluationParameters=wt,a.Event=Ji,a.Evented=Xi,a.FillExtrusionBucket=Hc,a.Frustum=_h,a.FrustumCorners=gh,a.GLOBE_METERS_TO_ECEF=Fh,a.GLOBE_RADIUS=ll,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_createGrid(s){const r=new xn,l=new $o,d=65;for(let m=0;m<d;m++)for(let y=0;y<d;y++)r.emplaceBack(y,m);this._gridSegments=[];for(let m=0,y=0;m<Mc.length;m++){const w=Mc[m];for(let k=0;k<w;k++)for(let P=0;P<64;P++){const V=k*d+P;l.emplaceBack(V+1,V,V+d),l.emplaceBack(V+d,V+d+1,V+1)}const A=64*w*2;this._gridSegments.push(yo.simpleSegment(0,y,(w+1)*d,A)),y+=A}this._gridBuffer=s.createVertexBuffer(r,tu.members),this._gridIndexBuffer=s.createIndexBuffer(l,!0)}_createPoles(s){const r=new $o;for(let m=0;m<=Sc;m++)r.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const l=new Xl,d=new Xl;this._poleSegments=[];for(let m=0,y=0;m<5;m++){const w=360/(1<<m);l.emplaceBack(0,-ll,0,.5,0),d.emplaceBack(0,-ll,0,.5,1);for(let A=0;A<=Sc;A++){const k=A/Sc,P=en(0,w,k),[V,W,Q]=Ac(zg,Ng,P,ll);l.emplaceBack(V,W,Q,k,0),d.emplaceBack(V,W,Q,k,1)}this._poleSegments.push(yo.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,Wf,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(d,Wf,!1)}getGridBuffers(s){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[s]]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const l=new is,d=Sc,m=d+1;this._wireframeSegments=[];for(let y=0,w=0;y<Mc.length;y++){const A=Mc[y];for(let P=0;P<A;P++)for(let V=0;V<d;V++){const W=P*m+V;l.emplaceBack(W,W+1),l.emplaceBack(W,W+m),l.emplaceBack(W,W+m+1)}const k=A*d*3;this._wireframeSegments.push(yo.simpleSegment(0,w,(A+1)*m,k)),w+=k}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},a.GlyphManager=Ec,a.ImagePosition=Dh,a.LivePerformanceUtils=Ar,a.LngLat=mn,a.LngLatBounds=El,a.LocalGlyphMode=Lh,a.MAX_MERCATOR_LATITUDE=Ns,a.MercatorCoordinate=fc,a.ONE_EM=Vo,a.OverscaledTileID=da,a.PerformanceMarkers=$t,a.Properties=wi,a.RGBAImage=Aa,a.Ray=mh,a.RequestManager=class{constructor(s,r,l){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ye,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!bn(s))return s;const l=Ie(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!bn(s))return s;const l=Ie(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(s,r,l,d){if(!bn(s))return s;const m=Ie(s);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),l&&m.params.push(`language=${l}`),d&&m.params.push(`worldview=${d}`),this._makeAPIURL(m,this._customAccessToken||r)}normalizeSpriteURL(s,r,l,d){const m=Ie(s);return bn(s)?(m.path=`/styles/v1${m.path}/sprite${r}${l}`,this._makeAPIURL(m,this._customAccessToken||d)):(m.path+=`${r}${l}`,ut(m))}normalizeTileURL(s,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!bn(s))return s;const d=Ie(s);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&d.authority!=="raster"&&l===512?"@2x":""}${N.supported?".webp":"$1"}`),d.authority==="raster"?d.path=`/${L.RASTER_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${L.TILE_URL_VERSION}${d.path}`);const m=this._customAccessToken||function(y){for(const w of y){const A=w.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(d.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,m)}canonicalizeTileURL(s,r){const l=Ie(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let d="mapbox://";l.path.match(/^\/raster\/v1\//)?d+=`raster/${l.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:d+=`tiles/${l.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let m=l.params;return r&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(d+=`?${m.join("&")}`),d}canonicalizeTileset(s,r){const l=!!r&&bn(r),d=[];for(const m of s.tiles||[])oo(m)?d.push(this.canonicalizeTileURL(m,l)):d.push(m);return d}_makeAPIURL(s,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=Ie(L.API_URL);if(s.protocol=d.protocol,s.authority=d.authority,s.protocol==="http"){const m=s.params.indexOf("secure");m>=0&&s.params.splice(m,1)}if(d.path!=="/"&&(s.path=`${d.path}${s.path}`),!L.REQUIRE_ACCESS_TOKEN)return ut(s);if(r=r||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter(m=>m.indexOf("access_token")===-1),s.params.push(`access_token=${r||""}`),ut(s)}},a.ResourceType=br,a.SegmentVector=yo,a.SourceCache=rc,a.StencilMode=Hh,a.StructArrayLayout1ui2=Lc,a.StructArrayLayout2f1f2i16=Jo,a.StructArrayLayout2i4=xn,a.StructArrayLayout2ui4=is,a.StructArrayLayout3f12=ws,a.StructArrayLayout3ui6=$o,a.StructArrayLayout4i8=An,a.StructArrayLayout5f20=Xl,a.Texture=cu,a.Tile=Xh,a.Transitionable=ir,a.Uniform1f=yu,a.Uniform1i=class extends tl{constructor(s){super(s),this.current=0}set(s,r,l){this.fetchUniformLocation(s,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},a.Uniform2f=class extends tl{constructor(s){super(s),this.current=[0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},a.Uniform3f=class extends tl{constructor(s){super(s),this.current=[0,0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},a.Uniform4f=vd,a.UniformColor=xd,a.UniformMatrix2f=class extends tl{constructor(s){super(s),this.current=Vp}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let d=0;d<4;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},a.UniformMatrix3f=class extends tl{constructor(s){super(s),this.current=jp}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},a.UniformMatrix4f=class extends tl{constructor(s){super(s),this.current=$p}set(s,r,l){if(this.fetchUniformLocation(s,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},a.UnwrappedTileID=gf,a.ValidationError=Hr,a.VectorTileFeature=Pu,a.VectorTileWorkerSource=class extends Xi{constructor(s,r,l,d,m){super(),this.actor=s,this.layerIndex=r,this.availableImages=l,this.loadVectorData=m||kp,this.loading={},this.loaded={},this.deduped=new Dp(s.scheduler),this.isSpriteLoaded=d,this.scheduler=s.scheduler}loadTile(s,r){const l=s.uid,d=s&&s.request,m=d&&d.collectResourceTiming,y=this.loading[l]=new c0(s);y.abort=this.loadVectorData(s,(w,A)=>{const k=!this.loading[l];if(delete this.loading[l],k||w||!A)return y.status="done",k||(this.loaded[l]=y),r(w);const P=A.rawData,V={};A.expires&&(V.expires=A.expires),A.cacheControl&&(V.cacheControl=A.cacheControl),y.vectorTile=A.vectorTile||new Mh(new Qc(P));const W=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(Q,ne)=>{if(Q||!ne)return r(Q);const he={};if(m){const ge=ri(d);ge.length>0&&(he.resourceTiming=JSON.parse(JSON.stringify(ge)))}r(null,_t({rawTileData:P.slice(0)},ne,V,he))})};this.isSpriteLoaded?W():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(W,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):W()}),this.loaded=this.loaded||{},this.loaded[l]=y})}reloadTile(s,r){const l=this.loaded,d=s.uid,m=this;if(l&&l[d]){const y=l[d];y.showCollisionBoxes=s.showCollisionBoxes,y.enableTerrain=!!s.enableTerrain,y.projection=s.projection,y.tileTransform=tc(s.tileID.canonical,s.projection);const w=(A,k)=>{const P=y.reloadCallback;P&&(delete y.reloadCallback,y.parse(y.vectorTile,m.layerIndex,this.availableImages,m.actor,P)),r(A,k)};y.status==="parsing"?y.reloadCallback=w:y.status==="done"&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,w):w())}}abortTile(s,r){const l=s.uid,d=this.loading[l];d&&(d.abort&&d.abort(),delete this.loading[l]),r()}removeTile(s,r){const l=this.loaded,d=s.uid;l&&l[d]&&delete l[d],r()}},a.WritingMode=Va,a.add=nl,a.addDynamicAttributes=Wu,a.adjoint=function(s,r){var l=r[0],d=r[1],m=r[2],y=r[3],w=r[4],A=r[5],k=r[6],P=r[7],V=r[8];return s[0]=w*V-A*P,s[1]=m*P-d*V,s[2]=d*A-m*w,s[3]=A*k-y*V,s[4]=l*V-m*k,s[5]=m*y-l*A,s[6]=y*P-w*k,s[7]=d*k-l*P,s[8]=l*w-d*y,s},a.asyncAll=Sr,a.bezier=Ke,a.bindAll=ar,a.boundsAttributes=pp,a.bufferConvexPolygon=function(s,r){const l=[];for(let d=0;d<s.length;d++){const m=Nr(d-1,-1,s.length-1),y=Nr(d+1,-1,s.length-1),w=s[d],A=s[y],k=s[m].sub(w).unit(),P=A.sub(w).unit(),V=P.angleWithSep(k.x,k.y),W=k.add(P).unit().mult(-1*r/Math.sin(V/2));l.push(w.add(W))}return l},a.cacheEntryPossiblyAdded=function(s){zr++,zr>ht&&(s.getActor().send("enforceCacheSizeLimit",Pr),zr=0)},a.calculateGlobeLabelMatrix=function(s,r){const{x:l,y:d}=s.point,m=tp(l,d,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Yl(m,m,Uh($s(r)))},a.calculateGlobeMatrix=function(s){const{x:r,y:l}=s.point,{lng:d,lat:m}=s._center;return tp(r,l,s.worldSize,d,m)},a.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,l=r/ns(1,s.center.lat),d=Ss(new Float64Array(16));return Bc(d,d,[s.point.x,s.point.y,0]),Kl(d,d,[l,l,r]),Float32Array.from(d)},a.circumferenceAtLatitude=ih,a.clamp=xt,a.clearTileCache=function(s){if(!Nt())return;const r=b.caches.delete(Gt);s&&r.catch(s).then(()=>s())},a.clipLine=$f,a.clone=function(s){var r=new Ma(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},a.clone$1=at,a.collisionCircleLayout=ig,a.config=L,a.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},a.create=function(){var s=new Ma(16);return Ma!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},a.create$1=Rd,a.createExpression=za,a.createLayout=ti,a.createStyleLayer=function(s){return s.type==="custom"?new e0(s):new r0[s.type](s)},a.cross=ph,a.degToRad=be,a.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},a.div=function(s,r,l){return s[0]=r[0]/l[0],s[1]=r[1]/l[1],s[2]=r[2]/l[2],s},a.dot=os,a.earthRadius=xu,a.ease=St,a.easeCubicInOut=Ge,a.ecefToLatLng=function([s,r,l]){const d=Math.hypot(s,r,l),m=Math.atan2(s,l),y=.5*Math.PI-Math.acos(-r/d);return new mn(de(m),de(y))},a.emitValidationErrors=M,a.endsWith=dr,a.enforceCacheSizeLimit=function(s){xr(),Jt&&Jt.then(r=>{r.keys().then(l=>{for(let d=0;d<l.length-s;d++)r.delete(l[d])})})},a.evaluateSizeForFeature=Ou,a.evaluateSizeForZoom=vc,a.evaluateVariableOffset=Xf,a.evented=it,a.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},a.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},a.exported=tr,a.exported$1=N,a.extend=_t,a.extend$1=ao,a.fillExtrusionHeightLift=ff,a.filterObject=nr,a.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},a.fromQuat=function(s,r){var l=r[0],d=r[1],m=r[2],y=r[3],w=l+l,A=d+d,k=m+m,P=l*w,V=d*w,W=d*A,Q=m*w,ne=m*A,he=m*k,ge=y*w,Ae=y*A,je=y*k;return s[0]=1-W-he,s[1]=V+je,s[2]=Q-Ae,s[3]=0,s[4]=V-je,s[5]=1-P-he,s[6]=ne+ge,s[7]=0,s[8]=Q+Ae,s[9]=ne-ge,s[10]=1-P-W,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},a.fromRotation=function(s,r){var l=Math.sin(r),d=Math.cos(r);return s[0]=d,s[1]=l,s[2]=0,s[3]=-l,s[4]=d,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},a.fromScaling=Od,a.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Te[r]},a.getAABBPointSquareDist=function(s,r,l){let d=0;for(let m=0;m<2;++m){const y=l?l[m]:0;s[m]>y&&(d+=(s[m]-y)*(s[m]-y)),r[m]<y&&(d+=(y-r[m])*(y-r[m]))}return d},a.getAnchorAlignment=Ph,a.getAnchorJustification=Bh,a.getBounds=function(s){let r=1/0,l=1/0,d=-1/0,m=-1/0;for(const y of s)r=Math.min(r,y.x),l=Math.min(l,y.y),d=Math.max(d,y.x),m=Math.max(m,y.y);return{min:new ue(r,l),max:new ue(d,m)}},a.getColumn=Er,a.getGridMatrix=function(s,r,l,d){const m=r.getNorth(),y=r.getSouth(),w=r.getWest(),A=r.getEast(),k=1<<s.z,P=A-w,V=m-y,W=P/Sc,Q=-V/Mc[l],ne=[0,W,0,Q,0,0,m,w,0];if(s.z>0){const he=180/d;Bd(ne,ne,[he/P+1,0,0,0,he/V+1,0,-.5*he/W,.5*he/Q,1])}return ne[2]=k,ne[5]=s.x,ne[8]=s.y,ne},a.getImage=fo,a.getJSON=function(s,r){return di(_t(s,{type:"json"}),r)},a.getLatitudinalLod=function(s){const r=80.051129;s=xt(s,-80.051129,r)/r*90;const l=Math.pow(Math.abs(Math.sin(be(s))),3);return Math.round(l*(Mc.length-1))},a.getMapSessionAPI=Je,a.getPerformanceMeasurement=ri,a.getProjection=cp,a.getRTLTextPluginStatus=gt,a.getReferrer=ui,a.getTilePoint=function(s,{x:r,y:l},d=0){return new ue(((r-d)*s.scale-s.x)*Li,(l*s.scale-s.y)*Li)},a.getTileVec3=function(s,r,l=0){return mc(((r.x-l)*s.scale-s.x)*Li,(r.y*s.scale-s.y)*Li,Ed(r.z,r.y))},a.getVideo=function(s,r){const l=b.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let d=0;d<s.length;d++){const m=b.document.createElement("source");Yi(s[d])||(l.crossOrigin="Anonymous"),m.src=s[d],l.appendChild(m)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(s){const r=[0,0,0],l=Ss(new Float64Array(16));return Yl(l,s.pixelMatrix,s.globeMatrix),io(r,r,l),new ue(r[0],r[1])},a.globeDenormalizeECEF=Uh,a.globeECEFOrigin=function(s,r){const l=[0,0,0];return io(l,l,nu($s(r.canonical))),io(l,l,s),l},a.globeNormalizeECEF=nu,a.globePixelsToTileUnits=function(s,r){return Li/(512*Math.pow(2,s))*Gu($s(r))},a.globePoleMatrixForTile=function(s,r,l){const d=Ss(new Float64Array(16)),m=(r/(1<<s)-.5)*Math.PI*2;return Su(d,l.globeMatrix,m),Float32Array.from(d)},a.globeTileBounds=$s,a.globeTiltAtLngLat=rp,a.globeToMercatorTransition=Cc,a.globeUseCustomAntiAliasing=function(s,r,l){const d=Cc(l.zoom),m=s.style.map._antialias,y=!!r.extStandardDerivatives,w=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return d===0&&!m&&!w&&y},a.identity=Ss,a.identity$1=Gd,a.invert=uh,a.isFullscreen=function(){return!!b.document.fullscreenElement||!!b.document.webkitFullscreenElement},a.isLngLatBehindGlobe=$h,a.isMapAuthenticated=function(s){return vt.has(s)},a.isMapboxURL=bn,a.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!mi(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=jo,a.latLngToECEF=ru,a.len=am,a.length=Oc,a.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},a.lngFromMercatorX=$a,a.loadVectorTile=kp,a.makeRequest=di,a.mapValue=function(s,r,l,d,m){return xt((s-r)/(l-r)*(m-d)+d,d,m)},a.mercatorScale=Td,a.mercatorXfromLng=Fs,a.mercatorYfromLat=zs,a.mercatorZfromAltitude=ns,a.mul=nm,a.mul$1=om,a.multiply=Yl,a.multiply$1=Bd,a.multiply$2=Nd,a.nextPowerOfTwo=er,a.normalize=ua,a.normalize$1=sm,a.normalize$2=jd,a.number=en,a.ortho=function(s,r,l,d,m,y,w){var A=1/(r-l),k=1/(d-m),P=1/(y-w);return s[0]=-2*A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*k,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*P,s[11]=0,s[12]=(r+l)*A,s[13]=(m+d)*k,s[14]=(w+y)*P,s[15]=1,s},a.pbf=Qc,a.perspective=function(s,r,l,d,m){var y,w=1/Math.tan(r/2);return s[0]=w/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,m!=null&&m!==1/0?(s[10]=(m+d)*(y=1/(d-m)),s[14]=2*m*d*y):(s[10]=-1,s[14]=-2*d),s},a.pick=function(s,r){const l={};for(let d=0;d<r.length;d++){const m=r[d];m in s&&(l[m]=s[m])}return l},a.plugin=Lt,a.pointGeometry=ue,a.polesInViewport=function(s){const r=Ss(new Float64Array(16));Yl(r,s.pixelMatrix,s.globeMatrix);const l=[0,as,0],d=[0,ss,0];return io(l,l,r),io(d,d,r),[l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!$h(s,new mn(s.center.lat,90)),d[0]>0&&d[0]<=s.width&&d[1]>0&&d[1]<=s.height&&!$h(s,new mn(s.center.lat,-90))]},a.polygonContainsPoint=Wl,a.polygonIntersectsBox=kd,a.polygonIntersectsPolygon=Ad,a.polygonizeBounds=function(s,r,l=0,d=!0){const m=new ue(l,l),y=s.sub(m),w=r.add(m),A=[y,new ue(w.x,y.y),w,new ue(y.x,w.y)];return d&&A.push(y.clone()),A},a.posAttributes=tu,a.postMapLoadEvent=Fe,a.postPerformanceEvent=mt,a.postTurnstileEvent=fe,a.potpack=Ih,a.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},a.radToDeg=de,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(s){return s({pluginStatus:Ne,pluginURL:Oe}),it.on("pluginStateChange",s),s},a.removeAuthState=function(s){vt.delete(s)},a.renderColorRamp=vh,a.resample=Sd,a.rotateX=hh,a.rotateX$1=qd,a.rotateY=Su,a.rotateY$1=Xd,a.rotateZ=function(s,r,l){var d=Math.sin(l),m=Math.cos(l),y=r[0],w=r[1],A=r[2],k=r[3],P=r[4],V=r[5],W=r[6],Q=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=y*m+P*d,s[1]=w*m+V*d,s[2]=A*m+W*d,s[3]=k*m+Q*d,s[4]=P*m-y*d,s[5]=V*m-w*d,s[6]=W*m-A*d,s[7]=Q*m-k*d,s},a.rotateZ$1=function(s,r,l){l*=.5;var d=r[0],m=r[1],y=r[2],w=r[3],A=Math.sin(l),k=Math.cos(l);return s[0]=d*k+m*A,s[1]=m*k-d*A,s[2]=y*k+w*A,s[3]=w*k-y*A,s},a.scale=Kl,a.scale$1=$d,a.scale$2=ja,a.scaleAndAdd=Nc,a.set=function(s,r,l,d){return s[0]=r,s[1]=l,s[2]=d,s},a.setCacheLimits=function(s,r){Pr=s,ht=r},a.setColumn=function(s,r,l){s[4*r+0]=l[0],s[4*r+1]=l[1],s[4*r+2]=l[2],s[4*r+3]=l[3]},a.setRTLTextPlugin=function(s,r,l=!1){if(Ne===Pe||Ne===Be||Ne===Ce)throw new Error("setRTLTextPlugin cannot be called multiple times.");Oe=tr.resolveURL(s),Ne=Pe,De=r,ot(),l||zt()},a.smoothstep=Lr,a.spec=Ft,a.squaredLength=function(s){var r=s[0],l=s[1],d=s[2];return r*r+l*l+d*d},a.storeAuthState=function(s,r){r?vt.add(s):vt.delete(s)},a.sub=Ms,a.subtract=fh,a.symbolSize=ng,a.tileAABB=function(s,r,l,d,m,y,w,A,k){if(k.name==="globe")return Fg(s,r,new Ru(l,d,m));const P=tc({z:l,x:d,y:m},k);return new ha([(y+P.x/P.scale)*r,r*(P.y/P.scale),w],[(y+P.x2/P.scale)*r,r*(P.y2/P.scale),A])},a.tileCornersToBounds=Vu,a.tileTransform=tc,a.transformMat3=function(s,r,l){var d=r[0],m=r[1],y=r[2];return s[0]=d*l[0]+m*l[3]+y*l[6],s[1]=d*l[1]+m*l[4]+y*l[7],s[2]=d*l[2]+m*l[5]+y*l[8],s},a.transformMat4=io,a.transformMat4$1=Ql,a.transformQuat=Ud,a.transitionTileAABBinECEF=Qf,a.translate=Bc,a.transpose=function(s,r){if(s===r){var l=r[1],d=r[2],m=r[5];s[1]=r[3],s[2]=r[6],s[3]=l,s[5]=r[7],s[6]=d,s[7]=m}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},a.triggerPluginCompletionEvent=qe,a.uniqueId=mr,a.updateGlobeVertexNormal=function(s,r,l,d,m){const y=5*r+2;s.float32[y+0]=l,s.float32[y+1]=d,s.float32[y+2]=m},a.validateCustomStyleLayer=function(s){const r=[],l=s.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},a.validateFilter=s=>E(Os(s)),a.validateFog=s=>E(jl(s)),a.validateLayer=s=>E(Js(s)),a.validateLight=s=>E($l(s)),a.validateSource=s=>E(Nl(s)),a.validateStyle=yl,a.validateTerrain=s=>E(el(s)),a.values=Gr,a.vectorTile=ku,a.version=T,a.warnOnce=Br,a.window=b,a.wrap=Nr}),f(["./shared"],function(a){function b(_e){if(typeof _e=="number"||typeof _e=="boolean"||typeof _e=="string"||_e==null)return JSON.stringify(_e);if(Array.isArray(_e)){let fe="[";for(const ke of _e)fe+=`${b(ke)},`;return`${fe}]`}let ae="{";for(const fe of Object.keys(_e).sort())ae+=`${fe}:${b(_e[fe])},`;return`${ae}}`}function T(_e){let ae="";for(const fe of a.refProperties)ae+=`/${b(_e[fe])}`;return ae}class C{constructor(ae){this.keyCache={},ae&&this.replace(ae)}replace(ae){this._layerConfigs={},this._layers={},this.update(ae,[])}update(ae,fe){for(const Fe of ae)this._layerConfigs[Fe.id]=Fe,(this._layers[Fe.id]=a.createStyleLayer(Fe)).compileFilter(),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id];for(const Fe of fe)delete this.keyCache[Fe],delete this._layerConfigs[Fe],delete this._layers[Fe];this.familiesBySource={};const ke=function(Fe,Ye){const mt={};for(let Je=0;Je<Fe.length;Je++){const vt=Ye&&Ye[Fe[Je].id]||T(Fe[Je]);Ye&&(Ye[Fe[Je].id]=vt);let $t=mt[vt];$t||($t=mt[vt]=[]),$t.push(Fe[Je])}const yt=[];for(const Je in mt)yt.push(mt[Je]);return yt}(a.values(this._layerConfigs),this.keyCache);for(const Fe of ke){const Ye=Fe.map(Ar=>this._layers[Ar.id]),mt=Ye[0];if(mt.visibility==="none")continue;const yt=mt.source||"";let Je=this.familiesBySource[yt];Je||(Je=this.familiesBySource[yt]={});const vt=mt.sourceLayer||"_geojsonTileLayer";let $t=Je[vt];$t||($t=Je[vt]=[]),$t.push(Ye)}}}class L{loadTile(ae,fe){const{uid:ke,encoding:Fe,rawImageData:Ye,padding:mt,buildQuadTree:yt}=ae,Je=a.window.ImageBitmap&&Ye instanceof a.window.ImageBitmap?this.getImageData(Ye,mt):Ye;fe(null,new a.DEMData(ke,Je,Fe,mt<1,yt))}getImageData(ae,fe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ae.width,ae.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ae.width,this.offscreenCanvas.height=ae.height,this.offscreenCanvasContext.drawImage(ae,0,0,ae.width,ae.height);const ke=this.offscreenCanvasContext.getImageData(-fe,-fe,ae.width+2*fe,ae.height+2*fe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ke}}var N=function _e(ae,fe){var ke,Fe=ae&&ae.type;if(Fe==="FeatureCollection")for(ke=0;ke<ae.features.length;ke++)_e(ae.features[ke],fe);else if(Fe==="GeometryCollection")for(ke=0;ke<ae.geometries.length;ke++)_e(ae.geometries[ke],fe);else if(Fe==="Feature")_e(ae.geometry,fe);else if(Fe==="Polygon")F(ae.coordinates,fe);else if(Fe==="MultiPolygon")for(ke=0;ke<ae.coordinates.length;ke++)F(ae.coordinates[ke],fe);return ae};function F(_e,ae){if(_e.length!==0){H(_e[0],ae);for(var fe=1;fe<_e.length;fe++)H(_e[fe],!ae)}}function H(_e,ae){for(var fe=0,ke=0,Fe=0,Ye=_e.length,mt=Ye-1;Fe<Ye;mt=Fe++){var yt=(_e[Fe][0]-_e[mt][0])*(_e[mt][1]+_e[Fe][1]),Je=fe+yt;ke+=Math.abs(fe)>=Math.abs(yt)?fe-Je+yt:yt-Je+fe,fe=Je}fe+ke>=0!=!!ae&&_e.reverse()}const se=a.VectorTileFeature.prototype.toGeoJSON;class ce{constructor(ae){this._feature=ae,this.extent=a.EXTENT,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const fe of this._feature.geometry)ae.push([new a.pointGeometry(fe[0],fe[1])]);return ae}{const ae=[];for(const fe of this._feature.geometry){const ke=[];for(const Fe of fe)ke.push(new a.pointGeometry(Fe[0],Fe[1]));ae.push(ke)}return ae}}toGeoJSON(ae,fe,ke){return se.call(this,ae,fe,ke)}}class X{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=ae.length,this._features=ae}feature(ae){return new ce(this._features[ae])}}var ye={exports:{}},oe=a.pointGeometry,le=a.vectorTile.VectorTileFeature,ue=Re;function Re(_e,ae){this.options=ae||{},this.features=_e,this.length=_e.length}function ze(_e,ae){this.id=typeof _e.id=="number"?_e.id:void 0,this.type=_e.type,this.rawGeometry=_e.type===1?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=ae||4096}Re.prototype.feature=function(_e){return new ze(this.features[_e],this.options.extent)},ze.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var ae=0;ae<_e.length;ae++){for(var fe=_e[ae],ke=[],Fe=0;Fe<fe.length;Fe++)ke.push(new oe(fe[Fe][0],fe[Fe][1]));this.geometry.push(ke)}return this.geometry},ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,ae=1/0,fe=-1/0,ke=1/0,Fe=-1/0,Ye=0;Ye<_e.length;Ye++)for(var mt=_e[Ye],yt=0;yt<mt.length;yt++){var Je=mt[yt];ae=Math.min(ae,Je.x),fe=Math.max(fe,Je.x),ke=Math.min(ke,Je.y),Fe=Math.max(Fe,Je.y)}return[ae,ke,fe,Fe]},ze.prototype.toGeoJSON=le.prototype.toGeoJSON;var ve=a.pbf,be=ue;function de(_e){var ae=new ve;return function(fe,ke){for(var Fe in fe.layers)ke.writeMessage(3,Te,fe.layers[Fe])}(_e,ae),ae.finish()}function Te(_e,ae){var fe;ae.writeVarintField(15,_e.version||1),ae.writeStringField(1,_e.name||""),ae.writeVarintField(5,_e.extent||4096);var ke={keys:[],values:[],keycache:{},valuecache:{}};for(fe=0;fe<_e.length;fe++)ke.feature=_e.feature(fe),ae.writeMessage(2,Ge,ke);var Fe=ke.keys;for(fe=0;fe<Fe.length;fe++)ae.writeStringField(3,Fe[fe]);var Ye=ke.values;for(fe=0;fe<Ye.length;fe++)ae.writeMessage(4,Nr,Ye[fe])}function Ge(_e,ae){var fe=_e.feature;fe.id!==void 0&&ae.writeVarintField(1,fe.id),ae.writeMessage(2,Ke,_e),ae.writeVarintField(3,fe.type),ae.writeMessage(4,Lr,fe)}function Ke(_e,ae){var fe=_e.feature,ke=_e.keys,Fe=_e.values,Ye=_e.keycache,mt=_e.valuecache;for(var yt in fe.properties){var Je=fe.properties[yt],vt=Ye[yt];if(Je!==null){vt===void 0&&(ke.push(yt),Ye[yt]=vt=ke.length-1),ae.writeVarint(vt);var $t=typeof Je;$t!=="string"&&$t!=="boolean"&&$t!=="number"&&(Je=JSON.stringify(Je));var Ar=$t+":"+Je,Qt=mt[Ar];Qt===void 0&&(Fe.push(Je),mt[Ar]=Qt=Fe.length-1),ae.writeVarint(Qt)}}}function St(_e,ae){return(ae<<3)+(7&_e)}function xt(_e){return _e<<1^_e>>31}function Lr(_e,ae){for(var fe=_e.loadGeometry(),ke=_e.type,Fe=0,Ye=0,mt=fe.length,yt=0;yt<mt;yt++){var Je=fe[yt],vt=1;ke===1&&(vt=Je.length),ae.writeVarint(St(1,vt));for(var $t=ke===3?Je.length-1:Je.length,Ar=0;Ar<$t;Ar++){Ar===1&&ke!==1&&ae.writeVarint(St(2,$t-1));var Qt=Je[Ar].x-Fe,Kr=Je[Ar].y-Ye;ae.writeVarint(xt(Qt)),ae.writeVarint(xt(Kr)),Fe+=Qt,Ye+=Kr}ke===3&&ae.writeVarint(St(7,1))}}function Nr(_e,ae){var fe=typeof _e;fe==="string"?ae.writeStringField(1,_e):fe==="boolean"?ae.writeBooleanField(7,_e):fe==="number"&&(_e%1!=0?ae.writeDoubleField(3,_e):_e<0?ae.writeSVarintField(6,_e):ae.writeVarintField(5,_e))}function Sr(_e,ae,fe,ke,Fe,Ye){if(Fe-ke<=fe)return;const mt=ke+Fe>>1;Gr(_e,ae,mt,ke,Fe,Ye%2),Sr(_e,ae,fe,ke,mt-1,Ye+1),Sr(_e,ae,fe,mt+1,Fe,Ye+1)}function Gr(_e,ae,fe,ke,Fe,Ye){for(;Fe>ke;){if(Fe-ke>600){const vt=Fe-ke+1,$t=fe-ke+1,Ar=Math.log(vt),Qt=.5*Math.exp(2*Ar/3),Kr=.5*Math.sqrt(Ar*Qt*(vt-Qt)/vt)*($t-vt/2<0?-1:1);Gr(_e,ae,fe,Math.max(ke,Math.floor(fe-$t*Qt/vt+Kr)),Math.min(Fe,Math.floor(fe+(vt-$t)*Qt/vt+Kr)),Ye)}const mt=ae[2*fe+Ye];let yt=ke,Je=Fe;for(_t(_e,ae,ke,fe),ae[2*Fe+Ye]>mt&&_t(_e,ae,ke,Fe);yt<Je;){for(_t(_e,ae,yt,Je),yt++,Je--;ae[2*yt+Ye]<mt;)yt++;for(;ae[2*Je+Ye]>mt;)Je--}ae[2*ke+Ye]===mt?_t(_e,ae,ke,Je):(Je++,_t(_e,ae,Je,Fe)),Je<=fe&&(ke=Je+1),fe<=Je&&(Fe=Je-1)}}function _t(_e,ae,fe,ke){Kt(_e,fe,ke),Kt(ae,2*fe,2*ke),Kt(ae,2*fe+1,2*ke+1)}function Kt(_e,ae,fe){const ke=_e[ae];_e[ae]=_e[fe],_e[fe]=ke}function mr(_e,ae,fe,ke){const Fe=_e-fe,Ye=ae-ke;return Fe*Fe+Ye*Ye}ye.exports=de,ye.exports.fromVectorTileJs=de,ye.exports.fromGeojsonVt=function(_e,ae){ae=ae||{};var fe={};for(var ke in _e)fe[ke]=new be(_e[ke].features,ae),fe[ke].name=ke,fe[ke].version=ae.version,fe[ke].extent=ae.extent;return de({layers:fe})},ye.exports.GeoJSONWrapper=be;const Yt=_e=>_e[0],er=_e=>_e[1];class lr{constructor(ae,fe=Yt,ke=er,Fe=64,Ye=Float64Array){this.nodeSize=Fe,this.points=ae;const mt=ae.length<65536?Uint16Array:Uint32Array,yt=this.ids=new mt(ae.length),Je=this.coords=new Ye(2*ae.length);for(let vt=0;vt<ae.length;vt++)yt[vt]=vt,Je[2*vt]=fe(ae[vt]),Je[2*vt+1]=ke(ae[vt]);Sr(yt,Je,Fe,0,yt.length-1,0)}range(ae,fe,ke,Fe){return function(Ye,mt,yt,Je,vt,$t,Ar){const Qt=[0,Ye.length-1,0],Kr=[];let ri,Wr;for(;Qt.length;){const ni=Qt.pop(),Bi=Qt.pop(),et=Qt.pop();if(Bi-et<=Ar){for(let Jr=et;Jr<=Bi;Jr++)ri=mt[2*Jr],Wr=mt[2*Jr+1],ri>=yt&&ri<=vt&&Wr>=Je&&Wr<=$t&&Kr.push(Ye[Jr]);continue}const tr=Math.floor((et+Bi)/2);ri=mt[2*tr],Wr=mt[2*tr+1],ri>=yt&&ri<=vt&&Wr>=Je&&Wr<=$t&&Kr.push(Ye[tr]);const gr=(ni+1)%2;(ni===0?yt<=ri:Je<=Wr)&&(Qt.push(et),Qt.push(tr-1),Qt.push(gr)),(ni===0?vt>=ri:$t>=Wr)&&(Qt.push(tr+1),Qt.push(Bi),Qt.push(gr))}return Kr}(this.ids,this.coords,ae,fe,ke,Fe,this.nodeSize)}within(ae,fe,ke){return function(Fe,Ye,mt,yt,Je,vt){const $t=[0,Fe.length-1,0],Ar=[],Qt=Je*Je;for(;$t.length;){const Kr=$t.pop(),ri=$t.pop(),Wr=$t.pop();if(ri-Wr<=vt){for(let gr=Wr;gr<=ri;gr++)mr(Ye[2*gr],Ye[2*gr+1],mt,yt)<=Qt&&Ar.push(Fe[gr]);continue}const ni=Math.floor((Wr+ri)/2),Bi=Ye[2*ni],et=Ye[2*ni+1];mr(Bi,et,mt,yt)<=Qt&&Ar.push(Fe[ni]);const tr=(Kr+1)%2;(Kr===0?mt-Je<=Bi:yt-Je<=et)&&($t.push(Wr),$t.push(ni-1),$t.push(tr)),(Kr===0?mt+Je>=Bi:yt+Je>=et)&&($t.push(ni+1),$t.push(ri),$t.push(tr))}return Ar}(this.ids,this.coords,ae,fe,ke,this.nodeSize)}}const ar={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},dr=Math.fround||(ii=new Float32Array(1),_e=>(ii[0]=+_e,ii[0]));var ii;class nr{constructor(ae){this.options=Or(Object.create(ar),ae),this.trees=new Array(this.options.maxZoom+1)}load(ae){const{log:fe,minZoom:ke,maxZoom:Fe,nodeSize:Ye}=this.options;fe&&console.time("total time");const mt=`prepare ${ae.length} points`;fe&&console.time(mt),this.points=ae;let yt=[];for(let Je=0;Je<ae.length;Je++)ae[Je].geometry&&yt.push(bi(ae[Je],Je));this.trees[Fe+1]=new lr(yt,mi,qt,Ye,Float32Array),fe&&console.timeEnd(mt);for(let Je=Fe;Je>=ke;Je--){const vt=+Date.now();yt=this._cluster(yt,Je),this.trees[Je]=new lr(yt,mi,qt,Ye,Float32Array),fe&&console.log("z%d: %d clusters in %dms",Je,yt.length,+Date.now()-vt)}return fe&&console.timeEnd("total time"),this}getClusters(ae,fe){let ke=((ae[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ae[1]));let Ye=ae[2]===180?180:((ae[2]+180)%360+360)%360-180;const mt=Math.max(-90,Math.min(90,ae[3]));if(ae[2]-ae[0]>=360)ke=-180,Ye=180;else if(ke>Ye){const $t=this.getClusters([ke,Fe,180,mt],fe),Ar=this.getClusters([-180,Fe,Ye,mt],fe);return $t.concat(Ar)}const yt=this.trees[this._limitZoom(fe)],Je=yt.range(cr(ke),ur(mt),cr(Ye),ur(Fe)),vt=[];for(const $t of Je){const Ar=yt.points[$t];vt.push(Ar.numPoints?Br(Ar):this.points[Ar.index])}return vt}getChildren(ae){const fe=this._getOriginId(ae),ke=this._getOriginZoom(ae),Fe="No cluster with the specified id.",Ye=this.trees[ke];if(!Ye)throw new Error(Fe);const mt=Ye.points[fe];if(!mt)throw new Error(Fe);const yt=this.options.radius/(this.options.extent*Math.pow(2,ke-1)),Je=Ye.within(mt.x,mt.y,yt),vt=[];for(const $t of Je){const Ar=Ye.points[$t];Ar.parentId===ae&&vt.push(Ar.numPoints?Br(Ar):this.points[Ar.index])}if(vt.length===0)throw new Error(Fe);return vt}getLeaves(ae,fe,ke){const Fe=[];return this._appendLeaves(Fe,ae,fe=fe||10,ke=ke||0,0),Fe}getTile(ae,fe,ke){const Fe=this.trees[this._limitZoom(ae)],Ye=Math.pow(2,ae),{extent:mt,radius:yt}=this.options,Je=yt/mt,vt=(ke-Je)/Ye,$t=(ke+1+Je)/Ye,Ar={features:[]};return this._addTileFeatures(Fe.range((fe-Je)/Ye,vt,(fe+1+Je)/Ye,$t),Fe.points,fe,ke,Ye,Ar),fe===0&&this._addTileFeatures(Fe.range(1-Je/Ye,vt,1,$t),Fe.points,Ye,ke,Ye,Ar),fe===Ye-1&&this._addTileFeatures(Fe.range(0,vt,Je/Ye,$t),Fe.points,-1,ke,Ye,Ar),Ar.features.length?Ar:null}getClusterExpansionZoom(ae){let fe=this._getOriginZoom(ae)-1;for(;fe<=this.options.maxZoom;){const ke=this.getChildren(ae);if(fe++,ke.length!==1)break;ae=ke[0].properties.cluster_id}return fe}_appendLeaves(ae,fe,ke,Fe,Ye){const mt=this.getChildren(fe);for(const yt of mt){const Je=yt.properties;if(Je&&Je.cluster?Ye+Je.point_count<=Fe?Ye+=Je.point_count:Ye=this._appendLeaves(ae,Je.cluster_id,ke,Fe,Ye):Ye<Fe?Ye++:ae.push(yt),ae.length===ke)break}return Ye}_addTileFeatures(ae,fe,ke,Fe,Ye,mt){for(const yt of ae){const Je=fe[yt],vt=Je.numPoints;let $t,Ar,Qt;if(vt)$t=Xr(Je),Ar=Je.x,Qt=Je.y;else{const Wr=this.points[Je.index];$t=Wr.properties,Ar=cr(Wr.geometry.coordinates[0]),Qt=ur(Wr.geometry.coordinates[1])}const Kr={type:1,geometry:[[Math.round(this.options.extent*(Ar*Ye-ke)),Math.round(this.options.extent*(Qt*Ye-Fe))]],tags:$t};let ri;vt?ri=Je.id:this.options.generateId?ri=Je.index:this.points[Je.index].id&&(ri=this.points[Je.index].id),ri!==void 0&&(Kr.id=ri),mt.features.push(Kr)}}_limitZoom(ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+ae),this.options.maxZoom+1))}_cluster(ae,fe){const ke=[],{radius:Fe,extent:Ye,reduce:mt,minPoints:yt}=this.options,Je=Fe/(Ye*Math.pow(2,fe));for(let vt=0;vt<ae.length;vt++){const $t=ae[vt];if($t.zoom<=fe)continue;$t.zoom=fe;const Ar=this.trees[fe+1],Qt=Ar.within($t.x,$t.y,Je),Kr=$t.numPoints||1;let ri=Kr;for(const Wr of Qt){const ni=Ar.points[Wr];ni.zoom>fe&&(ri+=ni.numPoints||1)}if(ri>Kr&&ri>=yt){let Wr=$t.x*Kr,ni=$t.y*Kr,Bi=mt&&Kr>1?this._map($t,!0):null;const et=(vt<<5)+(fe+1)+this.points.length;for(const tr of Qt){const gr=Ar.points[tr];if(gr.zoom<=fe)continue;gr.zoom=fe;const Jr=gr.numPoints||1;Wr+=gr.x*Jr,ni+=gr.y*Jr,gr.parentId=et,mt&&(Bi||(Bi=this._map($t,!0)),mt(Bi,this._map(gr)))}$t.parentId=et,ke.push(at(Wr/ri,ni/ri,et,ri,Bi))}else if(ke.push($t),ri>1)for(const Wr of Qt){const ni=Ar.points[Wr];ni.zoom<=fe||(ni.zoom=fe,ke.push(ni))}}return ke}_getOriginId(ae){return ae-this.points.length>>5}_getOriginZoom(ae){return(ae-this.points.length)%32}_map(ae,fe){if(ae.numPoints)return fe?Or({},ae.properties):ae.properties;const ke=this.points[ae.index].properties,Fe=this.options.map(ke);return fe&&Fe===ke?Or({},Fe):Fe}}function at(_e,ae,fe,ke,Fe){return{x:dr(_e),y:dr(ae),zoom:1/0,id:fe,parentId:-1,numPoints:ke,properties:Fe}}function bi(_e,ae){const[fe,ke]=_e.geometry.coordinates;return{x:dr(cr(fe)),y:dr(ur(ke)),zoom:1/0,index:ae,parentId:-1}}function Br(_e){return{type:"Feature",id:_e.id,properties:Xr(_e),geometry:{type:"Point",coordinates:[(ae=_e.x,360*(ae-.5)),yi(_e.y)]}};var ae}function Xr(_e){const ae=_e.numPoints,fe=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae;return Or(Or({},_e.properties),{cluster:!0,cluster_id:_e.id,point_count:ae,point_count_abbreviated:fe})}function cr(_e){return _e/360+.5}function ur(_e){const ae=Math.sin(_e*Math.PI/180),fe=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return fe<0?0:fe>1?1:fe}function yi(_e){const ae=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(ae))/Math.PI-90}function Or(_e,ae){for(const fe in ae)_e[fe]=ae[fe];return _e}function mi(_e){return _e.x}function qt(_e){return _e.y}function Er(_e,ae,fe,ke){for(var Fe,Ye=ke,mt=fe-ae>>1,yt=fe-ae,Je=_e[ae],vt=_e[ae+1],$t=_e[fe],Ar=_e[fe+1],Qt=ae+3;Qt<fe;Qt+=3){var Kr=Gt(_e[Qt],_e[Qt+1],Je,vt,$t,Ar);if(Kr>Ye)Fe=Qt,Ye=Kr;else if(Kr===Ye){var ri=Math.abs(Qt-mt);ri<yt&&(Fe=Qt,yt=ri)}}Ye>ke&&(Fe-ae>3&&Er(_e,ae,Fe,ke),_e[Fe+2]=Ye,fe-Fe>3&&Er(_e,Fe,fe,ke))}function Gt(_e,ae,fe,ke,Fe,Ye){var mt=Fe-fe,yt=Ye-ke;if(mt!==0||yt!==0){var Je=((_e-fe)*mt+(ae-ke)*yt)/(mt*mt+yt*yt);Je>1?(fe=Fe,ke=Ye):Je>0&&(fe+=mt*Je,ke+=yt*Je)}return(mt=_e-fe)*mt+(yt=ae-ke)*yt}function Jt(_e,ae,fe,ke){var Fe={id:_e===void 0?null:_e,type:ae,geometry:fe,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ye){var mt=Ye.geometry,yt=Ye.type;if(yt==="Point"||yt==="MultiPoint"||yt==="LineString")st(Ye,mt);else if(yt==="Polygon"||yt==="MultiLineString")for(var Je=0;Je<mt.length;Je++)st(Ye,mt[Je]);else if(yt==="MultiPolygon")for(Je=0;Je<mt.length;Je++)for(var vt=0;vt<mt[Je].length;vt++)st(Ye,mt[Je][vt])}(Fe),Fe}function st(_e,ae){for(var fe=0;fe<ae.length;fe+=3)_e.minX=Math.min(_e.minX,ae[fe]),_e.minY=Math.min(_e.minY,ae[fe+1]),_e.maxX=Math.max(_e.maxX,ae[fe]),_e.maxY=Math.max(_e.maxY,ae[fe+1])}function Pr(_e,ae,fe,ke){if(ae.geometry){var Fe=ae.geometry.coordinates,Ye=ae.geometry.type,mt=Math.pow(fe.tolerance/((1<<fe.maxZoom)*fe.extent),2),yt=[],Je=ae.id;if(fe.promoteId?Je=ae.properties[fe.promoteId]:fe.generateId&&(Je=ke||0),Ye==="Point")ht(Fe,yt);else if(Ye==="MultiPoint")for(var vt=0;vt<Fe.length;vt++)ht(Fe[vt],yt);else if(Ye==="LineString")Nt(Fe,yt,mt,!1);else if(Ye==="MultiLineString"){if(fe.lineMetrics){for(vt=0;vt<Fe.length;vt++)Nt(Fe[vt],yt=[],mt,!1),_e.push(Jt(Je,"LineString",yt,ae.properties));return}xr(Fe,yt,mt,!1)}else if(Ye==="Polygon")xr(Fe,yt,mt,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(vt=0;vt<ae.geometry.geometries.length;vt++)Pr(_e,{id:Je,geometry:ae.geometry.geometries[vt],properties:ae.properties},fe,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(vt=0;vt<Fe.length;vt++){var $t=[];xr(Fe[vt],$t,mt,!0),yt.push($t)}}_e.push(Jt(Je,Ye,yt,ae.properties))}}function ht(_e,ae){ae.push(Qr(_e[0])),ae.push(zr(_e[1])),ae.push(0)}function Nt(_e,ae,fe,ke){for(var Fe,Ye,mt=0,yt=0;yt<_e.length;yt++){var Je=Qr(_e[yt][0]),vt=zr(_e[yt][1]);ae.push(Je),ae.push(vt),ae.push(0),yt>0&&(mt+=ke?(Fe*vt-Je*Ye)/2:Math.sqrt(Math.pow(Je-Fe,2)+Math.pow(vt-Ye,2))),Fe=Je,Ye=vt}var $t=ae.length-3;ae[2]=1,Er(ae,0,$t,fe),ae[$t+2]=1,ae.size=Math.abs(mt),ae.start=0,ae.end=ae.size}function xr(_e,ae,fe,ke){for(var Fe=0;Fe<_e.length;Fe++){var Ye=[];Nt(_e[Fe],Ye,fe,ke),ae.push(Ye)}}function Qr(_e){return _e/360+.5}function zr(_e){var ae=Math.sin(_e*Math.PI/180),fe=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return fe<0?0:fe>1?1:fe}function br(_e,ae,fe,ke,Fe,Ye,mt,yt){if(ke/=ae,Ye>=(fe/=ae)&&mt<ke)return _e;if(mt<fe||Ye>=ke)return null;for(var Je=[],vt=0;vt<_e.length;vt++){var $t=_e[vt],Ar=$t.geometry,Qt=$t.type,Kr=Fe===0?$t.minX:$t.minY,ri=Fe===0?$t.maxX:$t.maxY;if(Kr>=fe&&ri<ke)Je.push($t);else if(!(ri<fe||Kr>=ke)){var Wr=[];if(Qt==="Point"||Qt==="MultiPoint")xi(Ar,Wr,fe,ke,Fe);else if(Qt==="LineString")ui(Ar,Wr,fe,ke,Fe,!1,yt.lineMetrics);else if(Qt==="MultiLineString")Ti(Ar,Wr,fe,ke,Fe,!1);else if(Qt==="Polygon")Ti(Ar,Wr,fe,ke,Fe,!0);else if(Qt==="MultiPolygon")for(var ni=0;ni<Ar.length;ni++){var Bi=[];Ti(Ar[ni],Bi,fe,ke,Fe,!0),Bi.length&&Wr.push(Bi)}if(Wr.length){if(yt.lineMetrics&&Qt==="LineString"){for(ni=0;ni<Wr.length;ni++)Je.push(Jt($t.id,Qt,Wr[ni],$t.tags));continue}Qt!=="LineString"&&Qt!=="MultiLineString"||(Wr.length===1?(Qt="LineString",Wr=Wr[0]):Qt="MultiLineString"),Qt!=="Point"&&Qt!=="MultiPoint"||(Qt=Wr.length===3?"Point":"MultiPoint"),Je.push(Jt($t.id,Qt,Wr,$t.tags))}}}return Je.length?Je:null}function xi(_e,ae,fe,ke,Fe){for(var Ye=0;Ye<_e.length;Ye+=3){var mt=_e[Ye+Fe];mt>=fe&&mt<=ke&&(ae.push(_e[Ye]),ae.push(_e[Ye+1]),ae.push(_e[Ye+2]))}}function ui(_e,ae,fe,ke,Fe,Ye,mt){for(var yt,Je,vt=di(_e),$t=Fe===0?Zi:oi,Ar=_e.start,Qt=0;Qt<_e.length-3;Qt+=3){var Kr=_e[Qt],ri=_e[Qt+1],Wr=_e[Qt+2],ni=_e[Qt+3],Bi=_e[Qt+4],et=Fe===0?Kr:ri,tr=Fe===0?ni:Bi,gr=!1;mt&&(yt=Math.sqrt(Math.pow(Kr-ni,2)+Math.pow(ri-Bi,2))),et<fe?tr>fe&&(Je=$t(vt,Kr,ri,ni,Bi,fe),mt&&(vt.start=Ar+yt*Je)):et>ke?tr<ke&&(Je=$t(vt,Kr,ri,ni,Bi,ke),mt&&(vt.start=Ar+yt*Je)):Yi(vt,Kr,ri,Wr),tr<fe&&et>=fe&&(Je=$t(vt,Kr,ri,ni,Bi,fe),gr=!0),tr>ke&&et<=ke&&(Je=$t(vt,Kr,ri,ni,Bi,ke),gr=!0),!Ye&&gr&&(mt&&(vt.end=Ar+yt*Je),ae.push(vt),vt=di(_e)),mt&&(Ar+=yt)}var Jr=_e.length-3;Kr=_e[Jr],ri=_e[Jr+1],Wr=_e[Jr+2],(et=Fe===0?Kr:ri)>=fe&&et<=ke&&Yi(vt,Kr,ri,Wr),Jr=vt.length-3,Ye&&Jr>=3&&(vt[Jr]!==vt[0]||vt[Jr+1]!==vt[1])&&Yi(vt,vt[0],vt[1],vt[2]),vt.length&&ae.push(vt)}function di(_e){var ae=[];return ae.size=_e.size,ae.start=_e.start,ae.end=_e.end,ae}function Ti(_e,ae,fe,ke,Fe,Ye){for(var mt=0;mt<_e.length;mt++)ui(_e[mt],ae,fe,ke,Fe,Ye,!1)}function Yi(_e,ae,fe,ke){_e.push(ae),_e.push(fe),_e.push(ke)}function Zi(_e,ae,fe,ke,Fe,Ye){var mt=(Ye-ae)/(ke-ae);return _e.push(Ye),_e.push(fe+(Fe-fe)*mt),_e.push(1),mt}function oi(_e,ae,fe,ke,Fe,Ye){var mt=(Ye-fe)/(Fe-fe);return _e.push(ae+(ke-ae)*mt),_e.push(Ye),_e.push(1),mt}function En(_e,ae){for(var fe=[],ke=0;ke<_e.length;ke++){var Fe,Ye=_e[ke],mt=Ye.type;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")Fe=fo(Ye.geometry,ae);else if(mt==="MultiLineString"||mt==="Polygon"){Fe=[];for(var yt=0;yt<Ye.geometry.length;yt++)Fe.push(fo(Ye.geometry[yt],ae))}else if(mt==="MultiPolygon")for(Fe=[],yt=0;yt<Ye.geometry.length;yt++){for(var Je=[],vt=0;vt<Ye.geometry[yt].length;vt++)Je.push(fo(Ye.geometry[yt][vt],ae));Fe.push(Je)}fe.push(Jt(Ye.id,mt,Fe,Ye.tags))}return fe}function fo(_e,ae){var fe=[];fe.size=_e.size,_e.start!==void 0&&(fe.start=_e.start,fe.end=_e.end);for(var ke=0;ke<_e.length;ke+=3)fe.push(_e[ke]+ae,_e[ke+1],_e[ke+2]);return fe}function po(_e,ae){if(_e.transformed)return _e;var fe,ke,Fe,Ye=1<<_e.z,mt=_e.x,yt=_e.y;for(fe=0;fe<_e.features.length;fe++){var Je=_e.features[fe],vt=Je.geometry,$t=Je.type;if(Je.geometry=[],$t===1)for(ke=0;ke<vt.length;ke+=2)Je.geometry.push(bn(vt[ke],vt[ke+1],ae,Ye,mt,yt));else for(ke=0;ke<vt.length;ke++){var Ar=[];for(Fe=0;Fe<vt[ke].length;Fe+=2)Ar.push(bn(vt[ke][Fe],vt[ke][Fe+1],ae,Ye,mt,yt));Je.geometry.push(Ar)}}return _e.transformed=!0,_e}function bn(_e,ae,fe,ke,Fe,Ye){return[Math.round(fe*(_e*ke-Fe)),Math.round(fe*(ae*ke-Ye))]}function oo(_e,ae,fe,ke,Fe){for(var Ye=ae===Fe.maxZoom?0:Fe.tolerance/((1<<ae)*Fe.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:fe,y:ke,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},yt=0;yt<_e.length;yt++){mt.numFeatures++,Vi(mt,_e[yt],Ye,Fe);var Je=_e[yt].minX,vt=_e[yt].minY,$t=_e[yt].maxX,Ar=_e[yt].maxY;Je<mt.minX&&(mt.minX=Je),vt<mt.minY&&(mt.minY=vt),$t>mt.maxX&&(mt.maxX=$t),Ar>mt.maxY&&(mt.maxY=Ar)}return mt}function Vi(_e,ae,fe,ke){var Fe=ae.geometry,Ye=ae.type,mt=[];if(Ye==="Point"||Ye==="MultiPoint")for(var yt=0;yt<Fe.length;yt+=3)mt.push(Fe[yt]),mt.push(Fe[yt+1]),_e.numPoints++,_e.numSimplified++;else if(Ye==="LineString")Xn(mt,Fe,_e,fe,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(yt=0;yt<Fe.length;yt++)Xn(mt,Fe[yt],_e,fe,Ye==="Polygon",yt===0);else if(Ye==="MultiPolygon")for(var Je=0;Je<Fe.length;Je++){var vt=Fe[Je];for(yt=0;yt<vt.length;yt++)Xn(mt,vt[yt],_e,fe,!0,yt===0)}if(mt.length){var $t=ae.tags||null;if(Ye==="LineString"&&ke.lineMetrics){for(var Ar in $t={},ae.tags)$t[Ar]=ae.tags[Ar];$t.mapbox_clip_start=Fe.start/Fe.size,$t.mapbox_clip_end=Fe.end/Fe.size}var Qt={geometry:mt,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:$t};ae.id!==null&&(Qt.id=ae.id),_e.features.push(Qt)}}function Xn(_e,ae,fe,ke,Fe,Ye){var mt=ke*ke;if(ke>0&&ae.size<(Fe?mt:ke))fe.numPoints+=ae.length/3;else{for(var yt=[],Je=0;Je<ae.length;Je+=3)(ke===0||ae[Je+2]>mt)&&(fe.numSimplified++,yt.push(ae[Je]),yt.push(ae[Je+1])),fe.numPoints++;Fe&&function(vt,$t){for(var Ar=0,Qt=0,Kr=vt.length,ri=Kr-2;Qt<Kr;ri=Qt,Qt+=2)Ar+=(vt[Qt]-vt[ri])*(vt[Qt+1]+vt[ri+1]);if(Ar>0===$t)for(Qt=0,Kr=vt.length;Qt<Kr/2;Qt+=2){var Wr=vt[Qt],ni=vt[Qt+1];vt[Qt]=vt[Kr-2-Qt],vt[Qt+1]=vt[Kr-1-Qt],vt[Kr-2-Qt]=Wr,vt[Kr-1-Qt]=ni}}(yt,Ye),_e.push(yt)}}function Pn(_e,ae){var fe=(ae=this.options=function(Fe,Ye){for(var mt in Ye)Fe[mt]=Ye[mt];return Fe}(Object.create(this.options),ae)).debug;if(fe&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var ke=function(Fe,Ye){var mt=[];if(Fe.type==="FeatureCollection")for(var yt=0;yt<Fe.features.length;yt++)Pr(mt,Fe.features[yt],Ye,yt);else Pr(mt,Fe.type==="Feature"?Fe:{geometry:Fe},Ye);return mt}(_e,ae);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ke=function(Fe,Ye){var mt=Ye.buffer/Ye.extent,yt=Fe,Je=br(Fe,1,-1-mt,mt,0,-1,2,Ye),vt=br(Fe,1,1-mt,2+mt,0,-1,2,Ye);return(Je||vt)&&(yt=br(Fe,1,-mt,1+mt,0,-1,2,Ye)||[],Je&&(yt=En(Je,1).concat(yt)),vt&&(yt=yt.concat(En(vt,-1)))),yt}(ke,ae),ke.length&&this.splitTile(ke,0,0,0),fe&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hn(_e,ae,fe){return 32*((1<<_e)*fe+ae)+_e}function Ie(_e,ae){const fe=_e.tileID.canonical;if(!this._geoJSONIndex)return ae(null,null);const ke=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!ke)return ae(null,null);const Fe=new X(ke.features);let Ye=ye.exports(Fe);Ye.byteOffset===0&&Ye.byteLength===Ye.buffer.byteLength||(Ye=new Uint8Array(Ye)),ae(null,{vectorTile:Fe,rawData:Ye.buffer})}Pn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pn.prototype.splitTile=function(_e,ae,fe,ke,Fe,Ye,mt){for(var yt=[_e,ae,fe,ke],Je=this.options,vt=Je.debug;yt.length;){ke=yt.pop(),fe=yt.pop(),ae=yt.pop(),_e=yt.pop();var $t=1<<ae,Ar=hn(ae,fe,ke),Qt=this.tiles[Ar];if(!Qt&&(vt>1&&console.time("creation"),Qt=this.tiles[Ar]=oo(_e,ae,fe,ke,Je),this.tileCoords.push({z:ae,x:fe,y:ke}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,fe,ke,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));var Kr="z"+ae;this.stats[Kr]=(this.stats[Kr]||0)+1,this.total++}if(Qt.source=_e,Fe){if(ae===Je.maxZoom||ae===Fe)continue;var ri=1<<Fe-ae;if(fe!==Math.floor(Ye/ri)||ke!==Math.floor(mt/ri))continue}else if(ae===Je.indexMaxZoom||Qt.numPoints<=Je.indexMaxPoints)continue;if(Qt.source=null,_e.length!==0){vt>1&&console.time("clipping");var Wr,ni,Bi,et,tr,gr,Jr=.5*Je.buffer/Je.extent,Ji=.5-Jr,Gi=.5+Jr,Xi=1+Jr;Wr=ni=Bi=et=null,tr=br(_e,$t,fe-Jr,fe+Gi,0,Qt.minX,Qt.maxX,Je),gr=br(_e,$t,fe+Ji,fe+Xi,0,Qt.minX,Qt.maxX,Je),_e=null,tr&&(Wr=br(tr,$t,ke-Jr,ke+Gi,1,Qt.minY,Qt.maxY,Je),ni=br(tr,$t,ke+Ji,ke+Xi,1,Qt.minY,Qt.maxY,Je),tr=null),gr&&(Bi=br(gr,$t,ke-Jr,ke+Gi,1,Qt.minY,Qt.maxY,Je),et=br(gr,$t,ke+Ji,ke+Xi,1,Qt.minY,Qt.maxY,Je),gr=null),vt>1&&console.timeEnd("clipping"),yt.push(Wr||[],ae+1,2*fe,2*ke),yt.push(ni||[],ae+1,2*fe,2*ke+1),yt.push(Bi||[],ae+1,2*fe+1,2*ke),yt.push(et||[],ae+1,2*fe+1,2*ke+1)}}},Pn.prototype.getTile=function(_e,ae,fe){var ke=this.options,Fe=ke.extent,Ye=ke.debug;if(_e<0||_e>24)return null;var mt=1<<_e,yt=hn(_e,ae=(ae%mt+mt)%mt,fe);if(this.tiles[yt])return po(this.tiles[yt],Fe);Ye>1&&console.log("drilling down to z%d-%d-%d",_e,ae,fe);for(var Je,vt=_e,$t=ae,Ar=fe;!Je&&vt>0;)vt--,$t=Math.floor($t/2),Ar=Math.floor(Ar/2),Je=this.tiles[hn(vt,$t,Ar)];return Je&&Je.source?(Ye>1&&console.log("found parent tile z%d-%d-%d",vt,$t,Ar),Ye>1&&console.time("drilling down"),this.splitTile(Je.source,vt,$t,Ar,_e,ae,fe),Ye>1&&console.timeEnd("drilling down"),this.tiles[yt]?po(this.tiles[yt],Fe):null):null};class ut extends a.VectorTileWorkerSource{constructor(ae,fe,ke,Fe,Ye){super(ae,fe,ke,Fe,Ie),Ye&&(this.loadGeoJSON=Ye)}loadData(ae,fe){const ke=ae&&ae.request,Fe=ke&&ke.collectResourceTiming;this.loadGeoJSON(ae,(Ye,mt)=>{if(Ye||!mt)return fe(Ye);if(typeof mt!="object")return fe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));{N(mt,!0);try{if(ae.filter){const Je=a.createExpression(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Je.result==="error")throw new Error(Je.value.map($t=>`${$t.key}: ${$t.message}`).join(", "));const vt=mt.features.filter($t=>Je.value.evaluate({zoom:0},$t));mt={type:"FeatureCollection",features:vt}}this._geoJSONIndex=ae.cluster?new nr(function({superclusterOptions:Je,clusterProperties:vt}){if(!vt||!Je)return Je;const $t={},Ar={},Qt={accumulated:null,zoom:0},Kr={properties:null},ri=Object.keys(vt);for(const Wr of ri){const[ni,Bi]=vt[Wr],et=a.createExpression(Bi),tr=a.createExpression(typeof ni=="string"?[ni,["accumulated"],["get",Wr]]:ni);$t[Wr]=et.value,Ar[Wr]=tr.value}return Je.map=Wr=>{Kr.properties=Wr;const ni={};for(const Bi of ri)ni[Bi]=$t[Bi].evaluate(Qt,Kr);return ni},Je.reduce=(Wr,ni)=>{Kr.properties=ni;for(const Bi of ri)Qt.accumulated=Wr[Bi],Wr[Bi]=Ar[Bi].evaluate(Qt,Kr)},Je}(ae)).load(mt.features):function(Je,vt){return new Pn(Je,vt)}(mt,ae.geojsonVtOptions)}catch(Je){return fe(Je)}this.loaded={};const yt={};if(Fe){const Je=a.getPerformanceMeasurement(ke);Je&&(yt.resourceTiming={},yt.resourceTiming[ae.source]=JSON.parse(JSON.stringify(Je)))}fe(null,yt)}})}reloadTile(ae,fe){const ke=this.loaded;return ke&&ke[ae.uid]?super.reloadTile(ae,fe):this.loadTile(ae,fe)}loadGeoJSON(ae,fe){if(ae.request)a.getJSON(ae.request,fe);else{if(typeof ae.data!="string")return fe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));try{return fe(null,JSON.parse(ae.data))}catch{return fe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ae,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(ke){fe(ke)}}getClusterChildren(ae,fe){try{fe(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(ke){fe(ke)}}getClusterLeaves(ae,fe){try{fe(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(ke){fe(ke)}}}class Bt{constructor(ae){this.self=ae,this.actor=new a.Actor(ae,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:ut},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(fe,ke)=>{if(this.workerSourceTypes[fe])throw new Error(`Worker source with name "${fe}" already registered.`);this.workerSourceTypes[fe]=ke},this.self.registerRTLTextPlugin=fe=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=fe.applyArabicShaping,a.plugin.processBidirectionalText=fe.processBidirectionalText,a.plugin.processStyledBidirectionalText=fe.processStyledBidirectionalText}}clearCaches(ae,fe,ke){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.workerSources[ae],delete this.demWorkerSources[ae],ke()}checkIfReady(ae,fe,ke){ke()}setReferrer(ae,fe){this.referrer=fe}spriteLoaded(ae,fe){this.isSpriteLoaded[ae]=fe;for(const ke in this.workerSources[ae]){const Fe=this.workerSources[ae][ke];for(const Ye in Fe)Fe[Ye]instanceof a.VectorTileWorkerSource&&(Fe[Ye].isSpriteLoaded=fe,Fe[Ye].fire(new a.Event("isSpriteLoaded")))}}setImages(ae,fe,ke){this.availableImages[ae]=fe;for(const Fe in this.workerSources[ae]){const Ye=this.workerSources[ae][Fe];for(const mt in Ye)Ye[mt].availableImages=fe}ke()}enableTerrain(ae,fe,ke){this.terrain=fe,ke()}setProjection(ae,fe){this.projections[ae]=a.getProjection(fe)}setLayers(ae,fe,ke){this.getLayerIndex(ae).replace(fe),ke()}updateLayers(ae,fe,ke){this.getLayerIndex(ae).update(fe.layers,fe.removedIds),ke()}loadTile(ae,fe,ke){const Fe=this.enableTerrain?a.extend({enableTerrain:this.terrain},fe):fe;Fe.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,fe.type,fe.source).loadTile(Fe,ke)}loadDEMTile(ae,fe,ke){const Fe=this.enableTerrain?a.extend({buildQuadTree:this.terrain},fe):fe;this.getDEMWorkerSource(ae,fe.source).loadTile(Fe,ke)}reloadTile(ae,fe,ke){const Fe=this.enableTerrain?a.extend({enableTerrain:this.terrain},fe):fe;Fe.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,fe.type,fe.source).reloadTile(Fe,ke)}abortTile(ae,fe,ke){this.getWorkerSource(ae,fe.type,fe.source).abortTile(fe,ke)}removeTile(ae,fe,ke){this.getWorkerSource(ae,fe.type,fe.source).removeTile(fe,ke)}removeSource(ae,fe,ke){if(!this.workerSources[ae]||!this.workerSources[ae][fe.type]||!this.workerSources[ae][fe.type][fe.source])return;const Fe=this.workerSources[ae][fe.type][fe.source];delete this.workerSources[ae][fe.type][fe.source],Fe.removeSource!==void 0?Fe.removeSource(fe,ke):ke()}loadWorkerSource(ae,fe,ke){try{this.self.importScripts(fe.url),ke()}catch(Fe){ke(Fe.toString())}}syncRTLPluginState(ae,fe,ke){try{a.plugin.setState(fe);const Fe=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&Fe!=null){this.self.importScripts(Fe);const Ye=a.plugin.isParsed();ke(Ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Fe}`),Ye)}}catch(Fe){ke(Fe.toString())}}getAvailableImages(ae){let fe=this.availableImages[ae];return fe||(fe=[]),fe}getLayerIndex(ae){let fe=this.layerIndexes[ae];return fe||(fe=this.layerIndexes[ae]=new C),fe}getWorkerSource(ae,fe,ke){if(this.workerSources[ae]||(this.workerSources[ae]={}),this.workerSources[ae][fe]||(this.workerSources[ae][fe]={}),!this.workerSources[ae][fe][ke]){const Fe={send:(Ye,mt,yt,Je,vt,$t)=>{this.actor.send(Ye,mt,yt,ae,vt,$t)},scheduler:this.actor.scheduler};this.workerSources[ae][fe][ke]=new this.workerSourceTypes[fe](Fe,this.getLayerIndex(ae),this.getAvailableImages(ae),this.isSpriteLoaded[ae])}return this.workerSources[ae][fe][ke]}getDEMWorkerSource(ae,fe){return this.demWorkerSources[ae]||(this.demWorkerSources[ae]={}),this.demWorkerSources[ae][fe]||(this.demWorkerSources[ae][fe]=new L),this.demWorkerSources[ae][fe]}enforceCacheSizeLimit(ae,fe){a.enforceCacheSizeLimit(fe)}getWorkerPerformanceMetrics(ae,fe,ke){ke(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Bt(self)),Bt}),f(["./shared"],function(a){function b(_,c){if(Array.isArray(_)){if(!Array.isArray(c)||_.length!==c.length)return!1;for(let p=0;p<_.length;p++)if(!b(_[p],c[p]))return!1;return!0}if(typeof _=="object"&&_!==null&&c!==null){if(typeof c!="object"||Object.keys(_).length!==Object.keys(c).length)return!1;for(const p in _)if(!b(_[p],c[p]))return!1;return!0}return _===c}var T=C;function C(_){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,S,I=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(I);try{S=new Worker(O),x=!0}catch{x=!1}return S&&S.terminate(),URL.revokeObjectURL(O),x}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var x=document.createElement("canvas");x.width=x.height=1;var S=x.getContext("2d");if(!S)return!1;var I=S.getImageData(0,0,1,1);return I&&I.width===x.width}()?(L[p=c&&c.failIfMajorPerformanceCaveat]===void 0&&(L[p]=function(x){var S,I=function(O){var j=document.createElement("canvas"),G=Object.create(C.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=O,j.getContext("webgl",G)||j.getContext("experimental-webgl",G)}(x);if(!I)return!1;try{S=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!S||I.isContextLost())&&(I.shaderSource(S,"void main() {}"),I.compileShader(S),I.getShaderParameter(S,I.COMPILE_STATUS)===!0)}(p)),L[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var p}(_)}var L={};function N(_,c,p){const x=a.window.document.createElement(_);return c!==void 0&&(x.className=c),p&&p.appendChild(x),x}function F(_,c,p){const x=a.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const S of Object.keys(c))x.setAttributeNS(null,S,c[S]);return p&&p.appendChild(x),x}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const H=a.window.document&&a.window.document.documentElement.style,se=H&&H.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ce;function X(){H&&se&&(ce=H[se],H[se]="none")}function ye(){H&&se&&(H[se]=ce)}function oe(_){_.preventDefault(),_.stopPropagation(),a.window.removeEventListener("click",oe,!0)}function le(){a.window.addEventListener("click",oe,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",oe,!0)},0)}function ue(_,c){const p=_.getBoundingClientRect();return ve(_,p,c)}function Re(_,c){const p=_.getBoundingClientRect(),x=[];for(let S=0;S<c.length;S++)x.push(ve(_,p,c[S]));return x}function ze(_){return a.window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function ve(_,c,p){const x=_.offsetWidth===c.width?1:_.offsetWidth/c.width;return new a.pointGeometry((p.clientX-c.left)*x,(p.clientY-c.top)*x)}function be(_,c){var p=c[0],x=c[1],S=c[2],I=c[3],O=p*I-S*x;return O?(_[0]=I*(O=1/O),_[1]=-x*O,_[2]=-S*O,_[3]=p*O,_):null}function de(_){const{userImage:c}=_;return!!(c&&c.render&&c.render())&&(_.data.replace(new Uint8Array(c.data.buffer)),!0)}class Te extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,x);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,p){this._validate(c,p)&&(this.images[c]=p)}_validate(c,p){let x=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),x=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),x=!1),this._validateContent(p.content,p)||(this.fire(new a.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),x=!1),x}_validateStretch(c,p){if(!c)return!0;let x=0;for(const S of c){if(S[0]<x||S[1]<S[0]||p<S[1])return!1;x=S[1]}return!0}_validateContent(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0}removeImage(c){const p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,p){let x=!0;if(!this.isLoaded())for(const S of c)this.images[S]||(x=!1);this.isLoaded()||x?this._notify(c,p):this.requestors.push({ids:c,callback:p})}_notify(c,p){const x={};for(const S of c){this.images[S]||this.fire(new a.Event("styleimagemissing",{id:S}));const I=this.images[S];I?x[S]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:Boolean(I.userImage&&I.userImage.render)}:a.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,x)}getPixelSize(){const{width:c,height:p}=this.atlasImage;return{width:c,height:p}}getPattern(c){const p=this.patterns[c],x=this.getImage(c);if(!x)return null;if(p&&p.position.version===x.version)return p.position;if(p)p.position.version=x.version;else{const S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},I=new a.ImagePosition(S,x);this.patterns[c]={bin:S,position:I}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const I in this.patterns)c.push(this.patterns[I].bin);const{w:p,h:x}=a.potpack(c),S=this.atlasImage;S.resize({width:p||1,height:x||1});for(const I in this.patterns){const{bin:O}=this.patterns[I],j=O.x+1,G=O.y+1,re=this.images[I].data,te=re.width,pe=re.height;a.RGBAImage.copy(re,S,{x:0,y:0},{x:j,y:G},{width:te,height:pe}),a.RGBAImage.copy(re,S,{x:0,y:pe-1},{x:j,y:G-1},{width:te,height:1}),a.RGBAImage.copy(re,S,{x:0,y:0},{x:j,y:G+pe},{width:te,height:1}),a.RGBAImage.copy(re,S,{x:te-1,y:0},{x:j-1,y:G},{width:1,height:pe}),a.RGBAImage.copy(re,S,{x:0,y:0},{x:j+te,y:G},{width:1,height:pe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const p of c){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const x=this.images[p];de(x)&&this.updateImage(p,x)}}}const Ge=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(_,c){return function([p,x,S]){const I=a.degToRad(x+90),O=a.degToRad(S);return{x:p*Math.cos(I)*Math.sin(O),y:p*Math.sin(I)*Math.sin(O),z:p*Math.cos(O),azimuthal:x,polar:S}}(_.expression.evaluate(c))}interpolate(_,c,p){return{x:a.number(_.x,c.x,p),y:a.number(_.y,c.y,p),z:a.number(_.z,c.z,p),azimuthal:a.number(_.azimuthal,c.azimuthal,p),polar:a.number(_.polar,c.polar,p)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Ke="-transition";class St extends a.Evented{constructor(c){super(),this._transitionable=new a.Transitionable(Ge),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,p={}){if(!this._validate(a.validateLight,c,p))for(const x in c){const S=c[x];a.endsWith(x,Ke)?this._transitionable.setTransition(x.slice(0,-Ke.length),S):this._transitionable.setValue(x,S)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,x){return(!x||x.validate!==!1)&&a.emitValidationErrors(this,c.call(a.validateStyle,a.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const xt=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Lr="-transition";class Nr extends a.Evented{constructor(c,p){super(),this._transitionable=new a.Transitionable(xt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=p}get(){return this._transitionable.serialize()}set(c){for(const p in c){const x=c[p];a.endsWith(p,Lr)?this._transitionable.setTransition(p.slice(0,-Lr.length),x):this._transitionable.setValue(p,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}}function Sr(_,c,p,x){const S=a.smoothstep(45,65,p),[I,O]=Gr(_,x),j=a.length(c);let G=1-Math.min(1,Math.exp((j-I)/(O-I)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*S*_.alpha}function Gr(_,c){const p=.5/Math.tan(.5*c);return[_.range[0]+p,_.range[1]+p]}const _t=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),Kt="-transition";class mr extends a.Evented{constructor(c,p){super(),this._transitionable=new a.Transitionable(_t),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=p}get state(){const c=this._transform,p=c.projection.name==="globe",x=a.globeToMercatorTransition(c.zoom),S=this.properties.get("range"),I=[.5,3];return{range:p?[a.number(I[0],S[0],x),a.number(I[1],S[1],x)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,p={}){if(!this._validate(a.validateFog,c,p)){for(const x of Object.keys(a.spec.fog))c&&c[x]===void 0&&(c[x]=a.spec.fog[x].default);for(const x in c){const S=c[x];a.endsWith(x,Kt)?this._transitionable.setTransition(x.slice(0,-Kt.length),S):this._transitionable.setValue(x,S)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,c))*p.a}getOpacityAtLatLng(c,p){return this._transform.projection.supportsFog?function(x,S,I){const O=a.MercatorCoordinate.fromLngLat(S),j=I.elevation?I.elevation.getAtPointOrZero(O):0,G=[O.x,O.y,j];return a.transformMat4(G,G,I.mercatorFogMatrix),Sr(x,G,I.pitch,I._fov)}(this.state,c,p):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Gr(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,x){return(!x||x.validate!==!1)&&a.emitValidationErrors(this,c.call(a.validateStyle,a.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Yt{constructor(c,p){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const x=this.workerPool.acquire(this.id);for(let S=0;S<x.length;S++){const I=new Yt.Actor(x[S],p,this.id);I.name=`Worker ${S}`,this.actors.push(I)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,p,x){a.asyncAll(this.actors,(S,I)=>{S.send(c,p,I)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function er(_,c,p){return c*(a.EXTENT/(_.tileSize*Math.pow(2,p-_.tileID.overscaledZ)))}Yt.Actor=a.Actor;class lr{constructor(c,p,x,S){this.screenBounds=c,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(c,p){let x,S;if(c instanceof a.pointGeometry||typeof c[0]=="number"){const I=a.pointGeometry.convert(c);x=[I],S=p.isPointAboveHorizon(I)}else{const I=a.pointGeometry.convert(c[0]),O=a.pointGeometry.convert(c[1]);x=[I,O],S=a.polygonizeBounds(I,O).every(j=>p.isPointAboveHorizon(j))}return new lr(x,p.getCameraPoint(),S,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const p=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],S=a.polygonizeBounds(p,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<x.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?S[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(S[3]=this.cameraPoint)),a.bufferConvexPolygon(S,c)}bufferedCameraGeometryGlobe(c){const p=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],S=a.polygonizeBounds(p,x,c),I=this.cameraPoint.clone();switch(3*((I.y>p.y)+(I.y>x.y))+((I.x>p.x)+(I.x>x.x))){case 0:S[0]=I,S[4]=I.clone();break;case 1:S.splice(1,0,I);break;case 2:S[1]=I;break;case 3:S.splice(4,0,I);break;case 5:S.splice(2,0,I);break;case 6:S[3]=I;break;case 7:S.splice(3,0,I);break;case 8:S[2]=I}return S}containsTile(c,p,x,S=0){const I=c.queryPadding/p._pixelsPerMercatorPixel+1,O=x?this._bufferedCameraMercator(I,p):this._bufferedScreenMercator(I,p);let j=c.tileID.wrap+(O.unwrapped?S:0);const G=O.polygon.map(Ce=>a.getTilePoint(c.tileTransform,Ce,j));if(!a.polygonIntersectsBox(G,0,0,a.EXTENT,a.EXTENT))return;j=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const re=this.screenGeometryMercator.polygon.map(Ce=>a.getTileVec3(c.tileTransform,Ce,j)),te=re.map(Ce=>new a.pointGeometry(Ce[0],Ce[1])),pe=p.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),Ee=a.getTileVec3(c.tileTransform,pe,j),Le=re.map(Ce=>{const De=a.sub(Ce,Ce,Ee);return a.normalize(De,De),new a.Ray(Ee,De)}),Pe=er(c,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:te,tilespaceRays:Le,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(Be=a.getBounds(G),Be.min.x=a.clamp(Be.min.x,0,a.EXTENT),Be.min.y=a.clamp(Be.min.y,0,a.EXTENT),Be.max.x=a.clamp(Be.max.x,0,a.EXTENT),Be.max.y=a.clamp(Be.max.y,0,a.EXTENT),Be),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Pe};var Be}_bufferedScreenMercator(c,p){const x=ii(c);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{let S;return S=p.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),p):{polygon:this.bufferedScreenGeometry(c).map(I=>p.pointCoordinate3D(I)),unwrapped:!0},this._screenRaycastCache[x]=S,S}}_bufferedCameraMercator(c,p){const x=ii(c);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{let S;return S=p.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),p):{polygon:this.bufferedCameraGeometry(c).map(I=>p.pointCoordinate3D(I)),unwrapped:!0},this._cameraRaycastCache[x]=S,S}}_projectAndResample(c,p){const x=function(I,O){const j=a.multiply([],O.pixelMatrix,O.globeMatrix),G=[0,-a.GLOBE_RADIUS,0,1],re=[0,a.GLOBE_RADIUS,0,1],te=[0,0,0,1];a.transformMat4$1(G,G,j),a.transformMat4$1(re,re,j),a.transformMat4$1(te,te,j);const pe=new a.pointGeometry(G[0]/G[3],G[1]/G[3]),Ee=new a.pointGeometry(re[0]/re[3],re[1]/re[3]),Le=a.polygonContainsPoint(I,pe)&&G[3]<te[3],Pe=a.polygonContainsPoint(I,Ee)&&re[3]<te[3];if(!Le&&!Pe)return null;const Be=function(gt,zt,Lt){for(let wt=1;wt<gt.length;wt++){const Dr=dr(zt.pointCoordinate3D(gt[wt-1]).x),Dt=dr(zt.pointCoordinate3D(gt[wt]).x);if(Lt<0){if(Dr<Dt)return{idx:wt,t:-Dr/(Dt-1-Dr)}}else if(Dt<Dr)return{idx:wt,t:(1-Dr)/(Dt+1-Dr)}}return null}(I,O,Le?-1:1);if(!Be)return null;const{idx:Ce,t:De}=Be;let Ne=Ce>1?ar(I.slice(0,Ce),O):[],Oe=Ce<I.length?ar(I.slice(Ce),O):[];Ne=Ne.map(gt=>new a.pointGeometry(dr(gt.x),gt.y)),Oe=Oe.map(gt=>new a.pointGeometry(dr(gt.x),gt.y));const qe=[...Ne];qe.length===0&&qe.push(Oe[Oe.length-1]);const ot=a.number(qe[qe.length-1].y,(Oe.length===0?Ne[0]:Oe[0]).y,De);let it;return it=Le?[new a.pointGeometry(0,ot),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,ot)]:[new a.pointGeometry(1,ot),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,ot)],qe.push(...it),Oe.length===0?qe.push(Ne[0]):qe.push(...Oe),{polygon:qe.map(gt=>new a.MercatorCoordinate(gt.x,gt.y)),unwrapped:!1}}(c,p);if(x)return x;const S=function(I,O){let j=!1,G=-1/0,re=0;for(let pe=0;pe<I.length-1;pe++)I[pe].x>G&&(G=I[pe].x,re=pe);for(let pe=0;pe<I.length-1;pe++){const Ee=(re+pe)%(I.length-1),Le=I[Ee],Pe=I[Ee+1];Math.abs(Le.x-Pe.x)>.5&&(Le.x<Pe.x?(Le.x+=1,Ee===0&&(I[I.length-1].x+=1)):(Pe.x+=1,Ee+1===I.length-1&&(I[0].x+=1)),j=!0)}const te=a.mercatorXfromLng(O.center.lng);return j&&te<Math.abs(te-1)&&I.forEach(pe=>{pe.x-=1}),{polygon:I,unwrapped:j}}(ar(c,p).map(I=>new a.pointGeometry(dr(I.x),I.y)),p);return{polygon:S.polygon.map(I=>new a.MercatorCoordinate(I.x,I.y)),unwrapped:S.unwrapped}}}function ar(_,c){return a.resample(_,p=>{const x=c.pointCoordinate3D(p);p.x=x.x,p.y=x.y},1/256)}function dr(_){return _<0?1+_%1:_%1}function ii(_){return 100*_|0}function nr(_,c,p,x,S){const I=function(O,j){if(O)return S(O);if(j){_.url&&j.tiles&&_.tiles&&delete _.tiles;const G=a.pick(a.extend(j,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);j.vector_layers&&(G.vectorLayers=j.vector_layers,G.vectorLayerIds=G.vectorLayers.map(re=>re.id)),G.tiles=c.canonicalizeTileset(G,_.url),S(null,G)}};return _.url?a.getJSON(c.transformRequest(c.normalizeSourceURL(_.url,null,p,x),a.ResourceType.Source),I):a.exported.frame(()=>I(null,_))}class at{constructor(c,p,x){this.bounds=a.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=p||0,this.maxzoom=x||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const p=Math.pow(2,c.z),x=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*p),S=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*p),I=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*p),O=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*p);return c.x>=x&&c.x<I&&c.y>=S&&c.y<O}}class bi{constructor(c,p,x){this.context=c;const S=c.gl;this.buffer=S.createBuffer(),this.dynamicDraw=Boolean(x),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Br={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xr{constructor(c,p,x,S){this.length=p.length,this.attributes=x,this.itemSize=p.bytesPerElement,this.dynamicDraw=S,this.context=c;const I=c.gl;this.buffer=I.createBuffer(),c.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,p){for(let x=0;x<this.attributes.length;x++){const S=p.attributes[this.attributes[x].name];S!==void 0&&c.enableVertexAttribArray(S)}}setVertexAttribPointers(c,p,x){for(let S=0;S<this.attributes.length;S++){const I=this.attributes[S],O=p.attributes[I.name];O!==void 0&&c.vertexAttribPointer(O,I.components,c[Br[I.type]],!1,this.itemSize,I.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cr{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ur extends cr{getDefault(){return a.Color.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class yi extends cr{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Or extends cr{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class mi extends cr{getDefault(){return[!0,!0,!0,!0]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class qt extends cr{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Er extends cr{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Gt extends cr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Jt extends cr{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class st extends cr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}}class Pr extends cr{getDefault(){return[0,1]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ht extends cr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}}class Nt extends cr{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class xr extends cr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}}class Qr extends cr{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class zr extends cr{getDefault(){return a.Color.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class br extends cr{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class xi extends cr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}}class ui extends cr{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class di extends cr{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class Ti extends cr{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class Yi extends cr{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Zi extends cr{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class oi extends cr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class En extends cr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class fo extends cr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class po extends cr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class bn extends cr{getDefault(){return null}set(c){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class oo extends cr{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class Vi extends cr{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Xn extends cr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Pn extends cr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class hn extends cr{constructor(c,p){super(c),this.context=c,this.parent=p}getDefault(){return null}}class Ie extends hn{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class ut extends hn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Bt extends ut{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _e{constructor(c,p,x,S){this.context=c,this.width=p,this.height=x;const I=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Ie(c,I),S&&(this.depthAttachment=new ut(c,I))}destroy(){const c=this.context.gl,p=this.colorAttachment.get();if(p&&c.deleteTexture(p),this.depthAttachment){const x=this.depthAttachment.get();x&&c.deleteRenderbuffer(x)}c.deleteFramebuffer(this.framebuffer)}}class ae{constructor(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ur(this),this.clearDepth=new yi(this),this.clearStencil=new Or(this),this.colorMask=new mi(this),this.depthMask=new qt(this),this.stencilMask=new Er(this),this.stencilFunc=new Gt(this),this.stencilOp=new Jt(this),this.stencilTest=new st(this),this.depthRange=new Pr(this),this.depthTest=new ht(this),this.depthFunc=new Nt(this),this.blend=new xr(this),this.blendFunc=new Qr(this),this.blendColor=new zr(this),this.blendEquation=new br(this),this.cullFace=new xi(this),this.cullFaceSide=new ui(this),this.frontFace=new di(this),this.program=new Ti(this),this.activeTexture=new Yi(this),this.viewport=new Zi(this),this.bindFramebuffer=new oi(this),this.bindRenderbuffer=new En(this),this.bindTexture=new fo(this),this.bindVertexBuffer=new po(this),this.bindElementBuffer=new bn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oo(this),this.pixelStoreUnpack=new Vi(this),this.pixelStoreUnpackPremultiplyAlpha=new Xn(this),this.pixelStoreUnpackFlipY=new Pn(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,p){return new bi(this,c,p)}createVertexBuffer(c,p,x){return new Xr(this,c,p,x)}createRenderbuffer(c,p,x){const S=this.gl,I=S.createRenderbuffer();return this.bindRenderbuffer.set(I),S.renderbufferStorage(S.RENDERBUFFER,c,p,x),this.bindRenderbuffer.set(null),I}createFramebuffer(c,p,x){return new _e(this,c,p,x)}clear({color:c,depth:p,stencil:x}){const S=this.gl;let I=0;c&&(I|=S.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(I|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),x!==void 0&&(I|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),S.clear(I)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){b(c.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class fe extends a.Evented{constructor(c,p,x,S){super(),this.id=c,this.dispatcher=x,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},p),a.extend(this,a.pick(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=nr(this._options,this.map._requestManager,null,null,(c,p)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new a.ErrorEvent(c)):p&&(a.extend(this,p),p.bounds&&(this.tileBounds=new at(p.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(p.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,p){const x=a.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);c.request=a.getImage(this.map._requestManager.transformRequest(S,a.ResourceType.Tile),(I,O,j,G)=>(delete c.request,c.aborted?(c.state="unloaded",p(null)):I?(c.state="errored",p(I)):O?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:j,expires:G}),c.setTexture(O,this.map.painter),c.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void p(null)):p(null)))}static loadTileData(c,p,x){c.setTexture(p,x)}static unloadTileData(c,p){c.texture&&p.saveTileTexture(c.texture)}abortTile(c,p){c.request&&(c.request.cancel(),delete c.request),p()}unloadTile(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()}hasTransition(){return!1}}let ke;function Fe(_,c,p,x,S,I,O,j){const G=[_,p,S,c,x,I,1,1,1],re=[O,j,1],te=a.adjoint([],G),[pe,Ee,Le]=a.transformMat3(re,re,a.transpose(te,te));return a.multiply$1(G,[pe,0,0,0,Ee,0,0,0,Le],G)}class Ye extends a.Evented{constructor(c,p,x,S){super(),this.id=c,this.dispatcher=x,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=p,this._dirty=!1}load(c,p){this._loaded=p||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(x,S)=>{if(this._imageRequest=null,this._loaded=!0,x)this.fire(new a.ErrorEvent(x));else if(S){const{HTMLImageElement:I}=a.window;this.image=S instanceof I?a.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const p=c.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(x){let S=1/0,I=1/0,O=-1/0,j=-1/0;for(const pe of x)S=Math.min(S,pe.x),I=Math.min(I,pe.y),O=Math.max(O,pe.x),j=Math.max(j,pe.y);const G=Math.max(O-S,j-I),re=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),te=Math.pow(2,re);return new a.CanonicalTileID(re,Math.floor((S+O)/2*te),Math.floor((I+j)/2*te))}(p),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const G in this.tiles){const re=this.tiles[G];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture)}if(this._boundsArray)return;const p=a.tileTransform(this.tileID,this.map.transform.projection),[x,S,I,O]=this.coordinates.map(G=>{const re=p.projection.project(G[0],G[1]);return a.getTilePoint(p,re)._round()});this.perspectiveTransform=function(G,re,te,pe,Ee,Le,Pe,Be,Ce,De){const Ne=Fe(0,0,G,0,0,re,G,re),Oe=Fe(te,pe,Ee,Le,Pe,Be,Ce,De);return a.multiply$1(Oe,a.adjoint(Ne,Ne),Oe),[Oe[6]/Oe[8]*G/a.EXTENT,Oe[7]/Oe[8]*re/a.EXTENT]}(this.width,this.height,x.x,x.y,S.x,S.y,O.x,O.y,I.x,I.y);const j=this._boundsArray=new a.StructArrayLayout4i8;j.emplaceBack(x.x,x.y,0,0),j.emplaceBack(S.x,S.y,a.EXTENT,0),j.emplaceBack(O.x,O.y,0,a.EXTENT),j.emplaceBack(I.x,I.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(j,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,p=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const mt={vector:class extends a.Evented{constructor(_,c,p,x){if(super(),this.id=_,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(c,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(_){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=nr(this._options,this.map._requestManager,c,p,(x,S)=>{this._tileJSONRequest=null,this._loaded=!0,x?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new a.ErrorEvent(x))):S&&(a.extend(this,S),S.bounds&&(this.tileBounds=new at(S.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),_&&_(x)})}loaded(){return this._loaded}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}onAdd(_){this.map=_,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const _=this.map.style._getSourceCaches(this.id);for(const c of _)c.clearTiles()})}setSourceProperty(_){_(),this.reload()}setTiles(_){return this._options.tiles=_,this.reload(),this}setUrl(_){return this.url=_,this._options.url=_,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(_,c){const p=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(p,a.ResourceType.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:_.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,_.actor&&_.state!=="expired")_.state==="loading"?_.reloadCallback=c:_.request=_.actor.send("reloadTile",x,S.bind(this));else if(_.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)_.request=_.actor.send("loadTile",x,S.bind(this),void 0,!0);else{const I=a.loadVectorTile.call({deduped:this._deduped},x,(O,j)=>{O||!j?S.call(this,O):(x.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},_.actor&&_.actor.send("loadTile",x,S.bind(this),void 0,!0))},!0);_.request={cancel:I}}function S(I,O){return delete _.request,_.aborted?c(null):I&&I.status!==404?c(I):(O&&O.resourceTiming&&(_.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&_.setExpiryData(O),_.loadVectorData(O,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id})}unloadTile(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:fe,"raster-dem":class extends fe{constructor(_,c,p,x){super(_,c,p,x),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(_,c){const p=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(S,I){S&&(_.state="errored",c(S)),I&&(_.dem=I,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",c(null))}_.request=a.getImage(this.map._requestManager.transformRequest(p,a.ResourceType.Tile),function(S,I,O,j){if(delete _.request,_.aborted)_.state="unloaded",c(null);else if(S)_.state="errored",c(S);else if(I){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:O,expires:j});const G=a.window.ImageBitmap&&I instanceof a.window.ImageBitmap&&(ke==null&&(ke=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),ke),re=1-(I.width-a.prevPowerOfTwo(I.width))/2;re<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const te=G?I:a.exported.getImageData(I,re),pe={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:te,encoding:this.encoding,padding:re};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",pe,x.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const c=_.canonical,p=Math.pow(2,c.z),x=(c.x-1+p)%p,S=c.x===0?_.wrap-1:_.wrap,I=(c.x+1+p)%p,O=c.x+1===p?_.wrap+1:_.wrap,j={};return j[new a.OverscaledTileID(_.overscaledZ,S,c.z,x,c.y).key]={backfilled:!1},j[new a.OverscaledTileID(_.overscaledZ,O,c.z,I,c.y).key]={backfilled:!1},c.y>0&&(j[new a.OverscaledTileID(_.overscaledZ,S,c.z,x,c.y-1).key]={backfilled:!1},j[new a.OverscaledTileID(_.overscaledZ,_.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},j[new a.OverscaledTileID(_.overscaledZ,O,c.z,I,c.y-1).key]={backfilled:!1}),c.y+1<p&&(j[new a.OverscaledTileID(_.overscaledZ,S,c.z,x,c.y+1).key]={backfilled:!1},j[new a.OverscaledTileID(_.overscaledZ,_.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},j[new a.OverscaledTileID(_.overscaledZ,O,c.z,I,c.y+1).key]={backfilled:!1}),j}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends a.Evented{constructor(_,c,p,x){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(x),this._data=c.data,this._options=a.extend({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const S=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*S,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*S,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:a.EXTENT,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*S,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},c),this}getClusterChildren(_,c){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},c),this}getClusterLeaves(_,c,p,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:c,offset:p},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=a.extend({},this.workerOptions),c=this._data;typeof c=="string"?(_.request=this.map._requestManager.transformRequest(a.exported.resolveURL(c),a.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new a.ErrorEvent(p));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(S.resourceTiming=x.resourceTiming[this.id]),this.fire(new a.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,c){const p=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(p,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(x,S)=>(delete _.request,_.unloadVectorData(),_.aborted?c(null):x?c(x):(_.loadVectorData(S,this.map.painter,p==="reloadTile"),c(null))),void 0,p==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ye{constructor(_,c,p,x){super(_,c,p,x),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const c of _.urls)this.urls.push(this.map._requestManager.transformRequest(c,a.ResourceType.Source).url);a.getVideo(this.urls,(c,p)=>{this._loaded=!0,c?this.fire(new a.ErrorEvent(c)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const c=this.video.seekable;_<c.start(0)||_>c.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,c=_.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(_,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ye,canvas:class extends Ye{constructor(_,c,p,x){super(_,c,p,x),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(I=>typeof I!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends a.Evented{constructor(_,c,p,x){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=c,this.setEventedParent(x),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new at(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:c,y:p,z:x}=_.canonical;return this._implementation.hasTile({x:c,y:p,z:x})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,c){const{x:p,y:x,z:S}=_.tileID.canonical,I=new a.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:p,y:x,z:S},{signal:I.signal})).then(function(O){return delete _.request,_.aborted?(_.state="unloaded",c(null)):O===void 0?(_.state="errored",c(null)):O===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",c(null)):function(j){return j instanceof a.window.ImageData||j instanceof a.window.HTMLCanvasElement||j instanceof a.window.ImageBitmap||j instanceof a.window.HTMLImageElement}(O)?(this.loadTileData(_,O),_.state="loaded",void c(null)):(_.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(O=>{O.code!==20&&(_.state="errored",c(O))}),_.request.cancel=()=>I.abort()}loadTileData(_,c){fe.loadTileData(_,c,this._map.painter)}unloadTileData(_){fe.unloadTileData(_,this._map.painter)}unloadTile(_,c){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:p,y:x,z:S}=_.tileID.canonical;this._implementation.unloadTile({x:p,y:x,z:S})}c()}abortTile(_,c){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},yt=function(_,c,p,x){const S=new mt[c.type](_,c,p,x);if(S.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${S.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],S),S};function Je(_,c){const p=a.identity([]);return a.scale(p,p,[.5*_.width,.5*-_.height,1]),a.translate(p,p,[1,-1,0]),a.multiply(p,p,_.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(p)}function vt(_,c,p,x,S,I,O,j=!1){const G=_.tilesIn(x,O,j);G.sort(Ar);const re=[];for(const pe of G)re.push({wrappedTileID:pe.tile.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(c,p,_._state,pe,S,I,Je(_.transform,pe.tile.tileID),j)});const te=function(pe){const Ee={},Le={};for(const Pe of pe){const Be=Pe.queryResults,Ce=Pe.wrappedTileID,De=Le[Ce]=Le[Ce]||{};for(const Ne in Be){const Oe=Be[Ne],qe=De[Ne]=De[Ne]||{},ot=Ee[Ne]=Ee[Ne]||[];for(const it of Oe)qe[it.featureIndex]||(qe[it.featureIndex]=!0,ot.push(it))}}return Ee}(re);for(const pe in te)te[pe].forEach(Ee=>{const Le=Ee.feature,Pe=Le.layer;Pe&&Pe.type!=="background"&&Pe.type!=="sky"&&(Le.source=Pe.source,Pe["source-layer"]&&(Le.sourceLayer=Pe["source-layer"]),Le.state=Le.id!==void 0?_.getFeatureState(Pe["source-layer"],Le.id):{})});return te}function $t(_,c){const p=_.getRenderableIds().map(I=>_.getTileByID(I)),x=[],S={};for(let I=0;I<p.length;I++){const O=p[I],j=O.tileID.canonical.key;S[j]||(S[j]=!0,O.querySourceFeatures(x,c))}return x}function Ar(_,c){const p=_.tileID,x=c.tileID;return p.overscaledZ-x.overscaledZ||p.canonical.y-x.canonical.y||p.wrap-x.wrap||p.canonical.x-x.canonical.x}function Qt(){return Gl.workerClass!=null?new Gl.workerClass:new a.window.Worker(Gl.workerUrl)}const Kr="mapboxgl_preloaded_worker_pool";class ri{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<ri.workerCount;)this.workers.push(new Qt);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kr]}numActive(){return Object.keys(this.active).length}}let Wr;function ni(){return Wr||(Wr=new ri),Wr}function Bi(_,c){const p={};for(const x in _)x!=="ref"&&(p[x]=_[x]);return a.refProperties.forEach(x=>{x in c&&(p[x]=c[x])}),p}function et(_){_=_.slice();const c=Object.create(null);for(let p=0;p<_.length;p++)c[_[p].id]=_[p];for(let p=0;p<_.length;p++)"ref"in _[p]&&(_[p]=Bi(_[p],c[_[p].ref]));return _}ri.workerCount=2;const tr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function gr(_,c,p){p.push({command:tr.addSource,args:[_,c[_]]})}function Jr(_,c,p){c.push({command:tr.removeSource,args:[_]}),p[_]=!0}function Ji(_,c,p,x){Jr(_,p,x),gr(_,c,p)}function Gi(_,c,p){let x;for(x in _[p])if(_[p].hasOwnProperty(x)&&x!=="data"&&!b(_[p][x],c[p][x]))return!1;for(x in c[p])if(c[p].hasOwnProperty(x)&&x!=="data"&&!b(_[p][x],c[p][x]))return!1;return!0}function Xi(_,c,p,x,S,I){let O;for(O in c=c||{},_=_||{})_.hasOwnProperty(O)&&(b(_[O],c[O])||p.push({command:I,args:[x,O,c[O],S]}));for(O in c)c.hasOwnProperty(O)&&!_.hasOwnProperty(O)&&(b(_[O],c[O])||p.push({command:I,args:[x,O,c[O],S]}))}function Ft(_){return _.id}function ao(_,c){return _[c.id]=c,_}class Ki{constructor(c,p){this.reset(c,p)}reset(c,p){this.points=c||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=a.clamp(c,0,1);let p=1,x=this._distances[p];const S=c*this.paddedLength+this.padding;for(;x<S&&p<this._distances.length;)x=this._distances[++p];const I=p-1,O=this._distances[I],j=x-O,G=j>0?(S-O)/j:0;return this.points[I].mult(1-G).add(this.points[p].mult(G))}}class J{constructor(c,p,x){const S=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(c/x),this.yCellCount=Math.ceil(p/x);for(let O=0;O<this.xCellCount*this.yCellCount;O++)S.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,p,x,S,I){this._forEachCell(p,x,S,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(S),this.bboxes.push(I)}insertCircle(c,p,x,S){this._forEachCell(p-S,x-S,p+S,x+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(x),this.circles.push(S)}_insertBoxCell(c,p,x,S,I,O){this.boxCells[I].push(O)}_insertCircleCell(c,p,x,S,I,O){this.circleCells[I].push(O)}_query(c,p,x,S,I,O){if(x<0||c>this.width||S<0||p>this.height)return!I&&[];const j=[];if(c<=0&&p<=0&&this.width<=x&&this.height<=S){if(I)return!0;for(let G=0;G<this.boxKeys.length;G++)j.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const re=this.circles[3*G],te=this.circles[3*G+1],pe=this.circles[3*G+2];j.push({key:this.circleKeys[G],x1:re-pe,y1:te-pe,x2:re+pe,y2:te+pe})}return O?j.filter(O):j}return this._forEachCell(c,p,x,S,this._queryCell,j,{hitTest:I,seenUids:{box:{},circle:{}}},O),I?j.length>0:j}_queryCircle(c,p,x,S,I){const O=c-x,j=c+x,G=p-x,re=p+x;if(j<0||O>this.width||re<0||G>this.height)return!S&&[];const te=[];return this._forEachCell(O,G,j,re,this._queryCellCircle,te,{hitTest:S,circle:{x:c,y:p,radius:x},seenUids:{box:{},circle:{}}},I),S?te.length>0:te}query(c,p,x,S,I){return this._query(c,p,x,S,!1,I)}hitTest(c,p,x,S,I){return this._query(c,p,x,S,!0,I)}hitTestCircle(c,p,x,S){return this._queryCircle(c,p,x,!0,S)}_queryCell(c,p,x,S,I,O,j,G){const re=j.seenUids,te=this.boxCells[I];if(te!==null){const Ee=this.bboxes;for(const Le of te)if(!re.box[Le]){re.box[Le]=!0;const Pe=4*Le;if(c<=Ee[Pe+2]&&p<=Ee[Pe+3]&&x>=Ee[Pe+0]&&S>=Ee[Pe+1]&&(!G||G(this.boxKeys[Le]))){if(j.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[Le],x1:Ee[Pe],y1:Ee[Pe+1],x2:Ee[Pe+2],y2:Ee[Pe+3]})}}}const pe=this.circleCells[I];if(pe!==null){const Ee=this.circles;for(const Le of pe)if(!re.circle[Le]){re.circle[Le]=!0;const Pe=3*Le;if(this._circleAndRectCollide(Ee[Pe],Ee[Pe+1],Ee[Pe+2],c,p,x,S)&&(!G||G(this.circleKeys[Le]))){if(j.hitTest)return O.push(!0),!0;{const Be=Ee[Pe],Ce=Ee[Pe+1],De=Ee[Pe+2];O.push({key:this.circleKeys[Le],x1:Be-De,y1:Ce-De,x2:Be+De,y2:Ce+De})}}}}}_queryCellCircle(c,p,x,S,I,O,j,G){const re=j.circle,te=j.seenUids,pe=this.boxCells[I];if(pe!==null){const Le=this.bboxes;for(const Pe of pe)if(!te.box[Pe]){te.box[Pe]=!0;const Be=4*Pe;if(this._circleAndRectCollide(re.x,re.y,re.radius,Le[Be+0],Le[Be+1],Le[Be+2],Le[Be+3])&&(!G||G(this.boxKeys[Pe])))return O.push(!0),!0}}const Ee=this.circleCells[I];if(Ee!==null){const Le=this.circles;for(const Pe of Ee)if(!te.circle[Pe]){te.circle[Pe]=!0;const Be=3*Pe;if(this._circlesCollide(Le[Be],Le[Be+1],Le[Be+2],re.x,re.y,re.radius)&&(!G||G(this.circleKeys[Pe])))return O.push(!0),!0}}}_forEachCell(c,p,x,S,I,O,j,G){const re=this._convertToXCellCoord(c),te=this._convertToYCellCoord(p),pe=this._convertToXCellCoord(x),Ee=this._convertToYCellCoord(S);for(let Le=re;Le<=pe;Le++)for(let Pe=te;Pe<=Ee;Pe++)if(I.call(this,c,p,x,S,this.xCellCount*Pe+Le,O,j,G))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,p,x,S,I,O){const j=S-c,G=I-p,re=x+O;return re*re>j*j+G*G}_circleAndRectCollide(c,p,x,S,I,O,j){const G=(O-S)/2,re=Math.abs(c-(S+G));if(re>G+x)return!1;const te=(j-I)/2,pe=Math.abs(p-(I+te));if(pe>te+x)return!1;if(re<=G||pe<=te)return!0;const Ee=re-G,Le=pe-te;return Ee*Ee+Le*Le<=x*x}}const Y=Math.tan(85*Math.PI/180);function Me(_,c,p,x,S,I,O){const j=a.create();if(p)if(I.name==="globe"){const G=a.calculateGlobeLabelMatrix(S,c);a.multiply(j,j,G)}else{const G=be([],O);j[0]=G[0],j[1]=G[1],j[4]=G[2],j[5]=G[3],x||a.rotateZ(j,j,S.angle)}else a.multiply(j,S.labelPlaneMatrix,_);return j}function ct(_,c,p,x,S,I,O){const j=Me(_,c,p,x,S,I,O);return I.name==="globe"&&p||(j[2]=j[6]=j[10]=j[14]=0),j}function Pt(_,c,p,x,S,I,O){if(p){if(I.name==="globe"){const j=Me(_,c,p,x,S,I,O);return a.invert(j,j),a.multiply(j,_,j),j}{const j=a.clone(_),G=a.identity([]);return G[0]=O[0],G[1]=O[1],G[4]=O[2],G[5]=O[3],a.multiply(j,j,G),x||a.rotateZ(j,j,-S.angle),j}}return S.glCoordMatrix}function Ve(_,c,p,x){const S=[_,c,p,1];p?a.transformMat4$1(S,S,x):Ai(S,S,x);const I=S[3];return S[0]/=I,S[1]/=I,S[2]/=I,S}function pt(_,c){return Math.min(.5+_/c*.5,1.5)}function dt(_,c){const p=_[0]/_[3],x=_[1]/_[3];return p>=-c[0]&&p<=c[0]&&x>=-c[1]&&x<=c[1]}function ft(_,c,p,x,S,I,O,j,G,re){const te=p.transform,pe=x?_.textSizeData:_.iconSizeData,Ee=a.evaluateSizeForZoom(pe,p.transform.zoom),Le=te.projection.name==="globe",Pe=[256/p.width*2+1,256/p.height*2+1],Be=x?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;Be.clear();let Ce=null;Le&&(Ce=x?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const De=_.lineVertexArray,Ne=x?_.text.placedSymbolArray:_.icon.placedSymbolArray,Oe=p.transform.width/p.transform.height;let qe,ot=!1;for(let it=0;it<Ne.length;it++){const gt=Ne.get(it),{numGlyphs:zt,writingMode:Lt}=gt;if(Lt!==a.WritingMode.vertical||ot||qe===a.WritingMode.horizontal||(ot=!0),qe=Lt,(gt.hidden||Lt===a.WritingMode.vertical)&&!ot){Hi(zt,Be);continue}ot=!1;const wt=new a.pointGeometry(gt.tileAnchorX,gt.tileAnchorY);let{x:Dr,y:Dt,z:ir}=te.projection.projectTilePoint(wt.x,wt.y,re.canonical);if(G){const[wi,si,ki]=G(wt);Dr+=wi,Dt+=si,ir+=ki}const jt=[Dr,Dt,ir,1];if(a.transformMat4$1(jt,jt,c),!dt(jt,Pe)){Hi(zt,Be);continue}const wr=pt(p.transform.cameraToCenterDistance,jt[3]),Zt=a.evaluateSizeForFeature(pe,Ee,gt),fr=O?Zt/wr:Zt*wr,kr=Ve(Dr,Dt,ir,S);if(kr[3]<=0){Hi(zt,Be);continue}let Mt={};const Ut=O?null:G,ai=q(gt,fr,!1,j,c,S,I,_.glyphOffsetArray,De,Be,Ce,kr,wt,Mt,Oe,Ut,te.projection,re,O);ot=ai.useVertical,Ut&&ai.needsFlipping&&(Mt={}),(ai.notEnoughRoom||ot||ai.needsFlipping&&q(gt,fr,!0,j,c,S,I,_.glyphOffsetArray,De,Be,Ce,kr,wt,Mt,Oe,Ut,te.projection,re,O).notEnoughRoom)&&Hi(zt,Be)}x?(_.text.dynamicLayoutVertexBuffer.updateData(Be),Ce&&_.text.globeExtVertexBuffer.updateData(Ce)):(_.icon.dynamicLayoutVertexBuffer.updateData(Be),Ce&&_.icon.globeExtVertexBuffer.updateData(Ce))}function Rr(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be){const{lineStartIndex:Ce,glyphStartIndex:De,segment:Ne}=j,Oe=De+j.numGlyphs,qe=Ce+j.lineLength,ot=c.getoffsetX(De),it=c.getoffsetX(Oe-1),gt=ji(_*ot,p,x,S,I,O,Ne,Ce,qe,G,re,te,pe,Ee,!0,Le,Pe,Be);if(!gt)return null;const zt=ji(_*it,p,x,S,I,O,Ne,Ce,qe,G,re,te,pe,Ee,!0,Le,Pe,Be);return zt?{first:gt,last:zt}:null}function gi(_,c,p,x){return _===a.WritingMode.horizontal&&Math.abs(x)>Math.abs(p)?{useVertical:!0}:_===a.WritingMode.vertical?x>0?{needsFlipping:!0}:null:c!==0&&function(S,I){return S===0||Math.abs(I/S)>Y}(p,x)?c===1?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null}function q(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be,Ce,De,Ne){const Oe=c/24,qe=_.lineOffsetX*Oe,ot=_.lineOffsetY*Oe,{lineStartIndex:it,glyphStartIndex:gt,numGlyphs:zt,segment:Lt,writingMode:wt,flipState:Dr}=_,Dt=it+_.lineLength,ir=jt=>{if(te){const[kr,Mt,Ut]=jt.up,ai=re.length;a.updateGlobeVertexNormal(te,ai+0,kr,Mt,Ut),a.updateGlobeVertexNormal(te,ai+1,kr,Mt,Ut),a.updateGlobeVertexNormal(te,ai+2,kr,Mt,Ut),a.updateGlobeVertexNormal(te,ai+3,kr,Mt,Ut)}const[wr,Zt,fr]=jt.point;a.addDynamicAttributes(re,wr,Zt,fr,jt.angle)};if(zt>1){const jt=Rr(Oe,j,qe,ot,p,pe,Ee,_,G,I,Le,Be,!1,Ce,De,Ne);if(!jt)return{notEnoughRoom:!0};if(x&&!p){let[wr,Zt,fr]=jt.first.point,[kr,Mt,Ut]=jt.last.point;[wr,Zt]=Ve(wr,Zt,fr,O),[kr,Mt]=Ve(kr,Mt,Ut,O);const ai=gi(wt,Dr,(kr-wr)*Pe,Mt-Zt);if(_.flipState=ai&&ai.needsFlipping?1:2,ai)return ai}ir(jt.first);for(let wr=gt+1;wr<gt+zt-1;wr++){const Zt=ji(Oe*j.getoffsetX(wr),qe,ot,p,pe,Ee,Lt,it,Dt,G,I,Le,Be,!1,!1,Ce,De,Ne);if(!Zt)return re.length-=4*(wr-gt),{notEnoughRoom:!0};ir(Zt)}ir(jt.last)}else{if(x&&!p){const wr=Ve(Ee.x,Ee.y,0,S),Zt=it+Lt+1,fr=new a.pointGeometry(G.getx(Zt),G.gety(Zt)),kr=Ve(fr.x,fr.y,0,S),Mt=kr[3]>0?kr:$i(Ee,fr,wr,1,S,void 0,Ce,De.canonical),Ut=gi(wt,Dr,(Mt[0]-wr[0])*Pe,Mt[1]-wr[1]);if(_.flipState=Ut&&Ut.needsFlipping?1:2,Ut)return Ut}const jt=ji(Oe*j.getoffsetX(gt),qe,ot,p,pe,Ee,Lt,it,Dt,G,I,Le,Be,!1,!1,Ce,De,Ne);if(!jt)return{notEnoughRoom:!0};ir(jt)}return{}}function fi(_,c,p,x,S){const{x:I,y:O,z:j}=x.projectTilePoint(_.x,_.y,c);if(!S)return Ve(I,O,j,p);const[G,re,te]=S(_);return Ve(I+G,O+re,j+te,p)}function $i(_,c,p,x,S,I,O,j){const G=fi(_.sub(c)._unit()._add(_),j,S,O,I);return a.sub(G,p,G),a.normalize(G,G),a.scaleAndAdd(G,p,G,x)}function ji(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be,Ce,De){const Ne=x?_-c:_+c;let Oe=Ne>0?1:-1,qe=0;x&&(Oe*=-1,qe=Math.PI),Oe<0&&(qe+=Math.PI);let ot=j+O+(Oe>0?0:1)|0,it=S,gt=S,zt=0,Lt=0;const wt=Math.abs(Ne),Dr=[],Dt=[];let ir=I,jt=ir;const wr=()=>$i(jt,ir,gt,wt-zt+1,te,Ee,Be,Ce.canonical);for(;zt+Lt<=wt;){if(ot+=Oe,ot<j||ot>=G)return null;if(gt=it,jt=ir,Dr.push(gt),Le&&Dt.push(jt),ir=new a.pointGeometry(re.getx(ot),re.gety(ot)),it=pe[ot],!it){const ki=fi(ir,Ce.canonical,te,Be,Ee);it=ki[3]>0?pe[ot]=ki:wr()}zt+=Lt,Lt=a.distance(gt,it)}Pe&&Ee&&(pe[ot]&&(it=wr(),Lt=a.distance(gt,it)),pe[ot]=it);const Zt=(wt-zt)/Lt,fr=ir.sub(jt)._mult(Zt)._add(jt),kr=a.sub([],it,gt),Mt=a.scaleAndAdd([],gt,kr,Zt);let Ut=[0,0,1],ai=kr[0],wi=kr[1];if(De&&(Ut=Be.upVector(Ce.canonical,fr.x,fr.y),Ut[0]!==0||Ut[1]!==0||Ut[2]!==1)){const ki=[Ut[2],0,-Ut[0]],qi=a.cross([],Ut,ki);a.normalize(ki,ki),a.normalize(qi,qi),ai=a.dot(kr,ki),wi=a.dot(kr,qi)}if(p){const ki=a.cross([],Ut,kr);a.normalize(ki,ki),a.scaleAndAdd(Mt,Mt,ki,p*Oe)}const si=qe+Math.atan2(wi,ai);return Dr.push(Mt),Le&&Dt.push(fr),{point:Mt,angle:si,path:Dr,tilePath:Dt,up:Ut}}function Hi(_,c){const p=c.length,x=p+4*_;c.resize(x),c.float32.fill(-1/0,4*p,4*x)}function Ai(_,c,p){const x=c[0],S=c[1];return _[0]=p[0]*x+p[4]*S+p[12],_[1]=p[1]*x+p[5]*S+p[13],_[3]=p[3]*x+p[7]*S+p[15],_}const z=100;class ee{constructor(c,p,x=new J(c.width+200,c.height+200,25),S=new J(c.width+200,c.height+200,25)){this.transform=c,this.grid=x,this.ignoredGrid=S,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+z,this.screenBottomBoundary=c.height+z,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=p}placeCollisionBox(c,p,x,S,I,O,j,G){let re=x.projectedAnchorX,te=x.projectedAnchorY,pe=x.projectedAnchorZ;const Ee=x.elevation,Le=x.tileID,Pe=c.getProjection();if(Ee&&Le){const[it,gt,zt]=Pe.upVector(Le.canonical,x.tileAnchorX,x.tileAnchorY),Lt=Pe.upVectorScale(Le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;re+=it*Ee*Lt,te+=gt*Ee*Lt,pe+=zt*Ee*Lt}const Be=this.projectAndGetPerspectiveRatio(j,re,te,pe,x.tileID,Pe.name==="globe"||!!Ee||this.transform.pitch>0,Pe),Ce=O*Be.perspectiveRatio,De=(x.x1*p+S.x-x.padding)*Ce+Be.point.x,Ne=(x.y1*p+S.y-x.padding)*Ce+Be.point.y,Oe=(x.x2*p+S.x+x.padding)*Ce+Be.point.x,qe=(x.y2*p+S.y+x.padding)*Ce+Be.point.y,ot=Be.perspectiveRatio<=.55||Be.occluded;return!this.isInsideGrid(De,Ne,Oe,qe)||!I&&this.grid.hitTest(De,Ne,Oe,qe,G)||ot?{box:[],offscreen:!1,occluded:Be.occluded}:{box:[De,Ne,Oe,qe],offscreen:this.isOffscreen(De,Ne,Oe,qe),occluded:!1}}placeCollisionCircles(c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be){const Ce=[],De=this.transform.elevation,Ne=c.getProjection(),Oe=De?De.getAtTileOffsetFunc(Be,this.transform.center.lat,this.transform.worldSize,Ne):null,qe=new a.pointGeometry(x.tileAnchorX,x.tileAnchorY);let{x:ot,y:it,z:gt}=Ne.projectTilePoint(qe.x,qe.y,Be.canonical);if(Oe){const[fr,kr,Mt]=Oe(qe);ot+=fr,it+=kr,gt+=Mt}const zt=Ne.name==="globe",Lt=this.projectAndGetPerspectiveRatio(j,ot,it,gt,Be,zt||!!De||this.transform.pitch>0,Ne),{perspectiveRatio:wt}=Lt,Dr=(pe?O/wt:O*wt)/a.ONE_EM,Dt=Ve(ot,it,gt,G),ir=Lt.signedDistanceFromCamera>0?Rr(Dr,I,x.lineOffsetX*Dr,x.lineOffsetY*Dr,!1,Dt,qe,x,S,G,{},De&&!pe?Oe:null,pe&&!!De,Ne,Be,pe):null;let jt=!1,wr=!1,Zt=!0;if(ir&&!Lt.occluded){const fr=.5*Le*wt+Pe,kr=new a.pointGeometry(-100,-100),Mt=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ut=new Ki,{first:ai,last:wi}=ir,si=ai.path.length;let ki=[];for(let ti=si-1;ti>=1;ti--)ki.push(ai.path[ti]);for(let ti=1;ti<wi.path.length;ti++)ki.push(wi.path[ti]);const qi=2.5*fr;re&&(ki=ki.map(([ti,Tn,xn],Dn)=>(Oe&&!zt&&(xn=Oe(Dn<si-1?ai.tilePath[si-1-Dn]:wi.tilePath[Dn-si+2])[2]),Ve(ti,Tn,xn,re))),ki.some(ti=>ti[3]<=0)&&(ki=[]));let Ei=[];if(ki.length>0){let ti=1/0,Tn=-1/0,xn=1/0,Dn=-1/0;for(const An of ki)ti=Math.min(ti,An[0]),xn=Math.min(xn,An[1]),Tn=Math.max(Tn,An[0]),Dn=Math.max(Dn,An[1]);Tn>=kr.x&&ti<=Mt.x&&Dn>=kr.y&&xn<=Mt.y&&(Ei=[ki.map(An=>new a.pointGeometry(An[0],An[1]))],(ti<kr.x||Tn>Mt.x||xn<kr.y||Dn>Mt.y)&&(Ei=a.clipLine(Ei,kr.x,kr.y,Mt.x,Mt.y)))}for(const ti of Ei){Ut.reset(ti,.25*fr);let Tn=0;Tn=Ut.length<=.5*fr?1:Math.ceil(Ut.paddedLength/qi)+1;for(let xn=0;xn<Tn;xn++){const Dn=xn/Math.max(Tn-1,1),An=Ut.lerp(Dn),ca=An.x+z,va=An.y+z;Ce.push(ca,va,fr,0);const Qo=ca-fr,es=va-fr,Un=ca+fr,kn=va+fr;if(Zt=Zt&&this.isOffscreen(Qo,es,Un,kn),wr=wr||this.isInsideGrid(Qo,es,Un,kn),!p&&this.grid.hitTestCircle(ca,va,fr,Ee)&&(jt=!0,!te))return{circles:[],offscreen:!1,collisionDetected:jt,occluded:!1}}}}return{circles:!te&&jt||!wr?[]:Ce,offscreen:Zt,collisionDetected:jt,occluded:Lt.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let x=1/0,S=1/0,I=-1/0,O=-1/0;for(const te of c){const pe=new a.pointGeometry(te.x+z,te.y+z);x=Math.min(x,pe.x),S=Math.min(S,pe.y),I=Math.max(I,pe.x),O=Math.max(O,pe.y),p.push(pe)}const j=this.grid.query(x,S,I,O).concat(this.ignoredGrid.query(x,S,I,O)),G={},re={};for(const te of j){const pe=te.key;if(G[pe.bucketInstanceId]===void 0&&(G[pe.bucketInstanceId]={}),G[pe.bucketInstanceId][pe.featureIndex])continue;const Ee=[new a.pointGeometry(te.x1,te.y1),new a.pointGeometry(te.x2,te.y1),new a.pointGeometry(te.x2,te.y2),new a.pointGeometry(te.x1,te.y2)];a.polygonIntersectsPolygon(p,Ee)&&(G[pe.bucketInstanceId][pe.featureIndex]=!0,re[pe.bucketInstanceId]===void 0&&(re[pe.bucketInstanceId]=[]),re[pe.bucketInstanceId].push(pe.featureIndex))}return re}insertCollisionBox(c,p,x,S,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:S,collisionGroupID:I},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,p,x,S,I){const O=p?this.ignoredGrid:this.grid,j={bucketInstanceId:x,featureIndex:S,collisionGroupID:I};for(let G=0;G<c.length;G+=4)O.insertCircle(j,c[G],c[G+1],c[G+2])}projectAndGetPerspectiveRatio(c,p,x,S,I,O,j){const G=[p,x,S,1];let re=!1;if(S||this.transform.pitch>0){a.transformMat4$1(G,G,c);const pe=j.name==="globe";this.fogState&&I&&!pe&&(re=function(Le,Pe,Be,Ce,De,Ne){const Oe=Ne.calculateFogTileMatrix(De),qe=[Pe,Be,Ce];return a.transformMat4(qe,qe,Oe),Sr(Le,qe,Ne.pitch,Ne._fov)}(this.fogState,p,x,S,I.toUnwrapped(),this.transform)>.9)}else Ai(G,G,c);const te=G[3];return{point:new a.pointGeometry((G[0]/te+1)/2*this.transform.width+z,(-G[1]/te+1)/2*this.transform.height+z),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(j)/te*.5,1.5),signedDistanceFromCamera:te,occluded:O&&G[2]>te||re}}isOffscreen(c,p,x,S){return x<z||c>=this.screenRightBoundary||S<z||p>this.screenBottomBoundary}isInsideGrid(c,p,x,S){return x>=0&&c<this.gridRightBoundary&&S>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const c=a.identity([]);return a.translate(c,c,[-100,-100,0]),c}}function xe(_,c,p){const x=c.createTileMatrix(_,_.worldSize,p.toUnwrapped());return a.multiply(new Float32Array(16),_.projMatrix,x)}function lt(_,c,p){if(c.projection.name===p.projection.name)return _.projMatrix;const x=p.clone();return x.setProjection(c.projection),xe(x,c.getProjection(),_)}function kt(_,c,p){return c.name===p.projection.name?_.projMatrix:xe(p,c,_)}class Et{constructor(c,p,x,S){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):S&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class At{constructor(c,p,x,S,I,O=!1){this.text=new Et(c?c.text:null,p,x,I),this.icon=new Et(c?c.icon:null,p,S,I),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tr{constructor(c,p,x,S=!1){this.text=c,this.icon=p,this.skipFade=x,this.clipped=S}}class _r{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ur{constructor(c,p,x,S,I){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=x,this.bucketIndex=S,this.tileID=I}}class It{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:x=>x.collisionGroupID===p}}return this.collisionGroups[c]}}function Ir(_,c,p,x,S){const{horizontalAlign:I,verticalAlign:O}=a.getAnchorAlignment(_),j=-(I-.5)*c,G=-(O-.5)*p,re=a.evaluateVariableOffset(_,x);return new a.pointGeometry(j+re[0]*S,G+re[1]*S)}function Yr(_,c,p,x,S){const I=new a.pointGeometry(_,c);return p&&I._rotate(x?S:-S),I}class hi{constructor(c,p,x,S,I){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new ee(this.transform,I),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new It(x),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,p,x,S){const I=x.getBucket(p),O=x.latestFeatureIndex;if(!I||!O||p.id!==I.layerIds[0])return;const j=I.layers[0].layout,G=x.collisionBoxArray,re=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),te=x.tileSize/a.EXTENT,pe=x.tileID.toUnwrapped();this.transform.setProjection(I.projection);const Ee=(Le=x.tileID,Pe=I.getProjection(),Be=this.transform,Pe.name===this.projection?Be.calculateProjMatrix(Le.toUnwrapped()):xe(Be,Pe,Le));var Le,Pe,Be;const Ce=j.get("text-pitch-alignment")==="map",De=j.get("text-rotation-alignment")==="map";p.compileFilter();const Ne=p.dynamicFilter(),Oe=p.dynamicFilterNeedsFeature(),qe=this.transform.calculatePixelsToTileUnitsMatrix(x),ot=ct(Ee,x.tileID.canonical,Ce,De,this.transform,I.getProjection(),qe);let it=null;if(Ce){const Lt=Pt(Ee,x.tileID.canonical,Ce,De,this.transform,I.getProjection(),qe);it=a.multiply([],this.transform.labelPlaneMatrix,Lt)}let gt=null;Ne&&x.latestFeatureIndex&&(gt={unwrappedTileID:pe,dynamicFilter:Ne,dynamicFilterNeedsFeature:Oe,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[I.bucketInstanceId]=new Ur(I.bucketInstanceId,O,I.sourceLayerIndex,I.index,x.tileID);const zt={bucket:I,layout:j,posMatrix:Ee,textLabelPlaneMatrix:ot,labelToScreenMatrix:it,clippingData:gt,scale:re,textPixelRatio:te,holdingForFade:x.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(I.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(I.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(S)for(const Lt of I.sortKeyRanges){const{sortKey:wt,symbolInstanceStart:Dr,symbolInstanceEnd:Dt}=Lt;c.push({sortKey:wt,symbolInstanceStart:Dr,symbolInstanceEnd:Dt,parameters:zt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:zt})}attemptAnchorPlacement(c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be,Ce,De,Ne){const{textOffset0:Oe,textOffset1:qe,crossTileID:ot}=Ee,it=[Oe,qe],gt=Ir(c,x,S,it,I),zt=this.collisionIndex.placeCollisionBox(Pe,I,p,Yr(gt.x,gt.y,O,j,this.transform.angle),pe,G,re,te.predicate);if(Ce){const Lt=Pe.getSymbolInstanceIconSize(Ne,this.transform.zoom,Ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Pe,Lt,Ce,Yr(gt.x,gt.y,O,j,this.transform.angle),pe,G,re,te.predicate).box.length===0)return}if(zt.box.length>0){let Lt;return this.prevPlacement&&this.prevPlacement.variableOffsets[ot]&&this.prevPlacement.placements[ot]&&this.prevPlacement.placements[ot].text&&(Lt=this.prevPlacement.variableOffsets[ot].anchor),this.variableOffsets[ot]={textOffset:it,width:x,height:S,anchor:c,textScale:I,prevAnchor:Lt},this.markUsedJustification(Pe,c,Ee,Be),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,Be,Ee),this.placedOrientations[ot]=Be),{shift:gt,placedGlyphBoxes:zt}}}placeLayerBucketPart(c,p,x,S){const{bucket:I,layout:O,posMatrix:j,textLabelPlaneMatrix:G,labelToScreenMatrix:re,clippingData:te,textPixelRatio:pe,holdingForFade:Ee,collisionBoxArray:Le,partiallyEvaluatedTextSize:Pe,partiallyEvaluatedIconSize:Be,collisionGroup:Ce}=c.parameters,De=O.get("text-optional"),Ne=O.get("icon-optional"),Oe=O.get("text-allow-overlap"),qe=O.get("icon-allow-overlap"),ot=O.get("text-rotation-alignment")==="map",it=O.get("text-pitch-alignment")==="map",gt=O.get("icon-text-fit")!=="none",zt=O.get("symbol-z-order")==="viewport-y";this.transform.setProjection(I.projection);let Lt=Oe&&(qe||!I.hasIconData()||Ne),wt=qe&&(Oe||!I.hasTextData()||De);!I.collisionArrays&&Le&&I.deserializeCollisionBoxes(Le),x&&S&&I.updateCollisionDebugBuffers(this.transform.zoom,Le);const Dr=(Dt,ir,jt)=>{const{crossTileID:wr,numVerticalGlyphVertices:Zt}=Dt;if(te){const Un={zoom:this.transform.zoom,pitch:this.transform.pitch};let kn=null;if(te.dynamicFilterNeedsFeature){const _n=this.retainedQueryData[I.bucketInstanceId];kn=te.featureIndex.loadFeature({featureIndex:Dt.featureIndex,bucketIndex:_n.bucketIndex,sourceLayerIndex:_n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,te.dynamicFilter)(Un,kn,this.retainedQueryData[I.bucketInstanceId].tileID.canonical,new a.pointGeometry(Dt.tileAnchorX,Dt.tileAnchorY),this.transform.calculateDistanceTileData(te.unwrappedTileID)))return this.placements[wr]=new Tr(!1,!1,!1,!0),void(p[wr]=!0)}if(p[wr])return;if(Ee)return void(this.placements[wr]=new Tr(!1,!1,!1));let fr=!1,kr=!1,Mt=!0,Ut=!1,ai=!1,wi=null,si={box:null,offscreen:null,occluded:null},ki={box:null,offscreen:null,occluded:null},qi=null,Ei=null,ti=null,Tn=0,xn=0,Dn=0;jt.textFeatureIndex?Tn=jt.textFeatureIndex:Dt.useRuntimeCollisionCircles&&(Tn=Dt.featureIndex),jt.verticalTextFeatureIndex&&(xn=jt.verticalTextFeatureIndex);const An=Un=>{Un.tileID=this.retainedQueryData[I.bucketInstanceId].tileID;const kn=this.transform.elevation;(kn||Un.elevation)&&(Un.elevation=kn?kn.getAtTileOffset(Un.tileID,Un.tileAnchorX,Un.tileAnchorY):0)},ca=jt.textBox;if(ca){An(ca);const Un=_n=>{let ro=a.WritingMode.horizontal;if(I.allowVerticalPlacement&&!_n&&this.prevPlacement){const Uo=this.prevPlacement.placedOrientations[wr];Uo&&(this.placedOrientations[wr]=Uo,ro=Uo,this.markUsedOrientation(I,ro,Dt))}return ro},kn=(_n,ro)=>{if(I.allowVerticalPlacement&&Zt>0&&jt.verticalTextBox){for(const Uo of I.writingModes)if(Uo===a.WritingMode.vertical?(si=ro(),ki=si):si=_n(),si&&si.box&&si.box.length)break}else si=_n()};if(O.get("text-variable-anchor")){let _n=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[wr]){const On=this.prevPlacement.variableOffsets[wr];_n.indexOf(On.anchor)>0&&(_n=_n.filter(Jo=>Jo!==On.anchor),_n.unshift(On.anchor))}const ro=(On,Jo,ql)=>{const ws=I.getSymbolInstanceTextSize(Pe,Dt,this.transform.zoom,ir),$o=(On.x2-On.x1)*ws+2*On.padding,Sa=(On.y2-On.y1)*ws+2*On.padding,ts=gt&&!qe?Jo:null;ts&&An(ts);let rs={box:[],offscreen:!1,occluded:!1};const Xl=Oe?2*_n.length:_n.length;for(let xl=0;xl<Xl;++xl){const is=this.attemptAnchorPlacement(_n[xl%_n.length],On,$o,Sa,ws,ot,it,pe,j,Ce,xl>=_n.length,Dt,ir,I,ql,ts,Pe,Be);if(is&&(rs=is.placedGlyphBoxes,rs&&rs.box&&rs.box.length)){fr=!0,wi=is.shift;break}}return rs};kn(()=>ro(ca,jt.iconBox,a.WritingMode.horizontal),()=>{const On=jt.verticalTextBox;return On&&An(On),I.allowVerticalPlacement&&!(si&&si.box&&si.box.length)&&Zt>0&&On?ro(On,jt.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),si&&(fr=si.box,Mt=si.offscreen,Ut=si.occluded);const Uo=Un(si&&si.box);if(!fr&&this.prevPlacement){const On=this.prevPlacement.variableOffsets[wr];On&&(this.variableOffsets[wr]=On,this.markUsedJustification(I,On.anchor,Dt,Uo))}}else{const _n=(ro,Uo)=>{const On=I.getSymbolInstanceTextSize(Pe,Dt,this.transform.zoom,ir),Jo=this.collisionIndex.placeCollisionBox(I,On,ro,new a.pointGeometry(0,0),Oe,pe,j,Ce.predicate);return Jo&&Jo.box&&Jo.box.length&&(this.markUsedOrientation(I,Uo,Dt),this.placedOrientations[wr]=Uo),Jo};kn(()=>_n(ca,a.WritingMode.horizontal),()=>{const ro=jt.verticalTextBox;return I.allowVerticalPlacement&&Zt>0&&ro?(An(ro),_n(ro,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Un(si&&si.box&&si.box.length)}}if(qi=si,fr=qi&&qi.box&&qi.box.length>0,Mt=qi&&qi.offscreen,Ut=qi&&qi.occluded,Dt.useRuntimeCollisionCircles){const Un=I.text.placedSymbolArray.get(Dt.centerJustifiedTextSymbolIndex>=0?Dt.centerJustifiedTextSymbolIndex:Dt.verticalPlacedTextSymbolIndex),kn=a.evaluateSizeForFeature(I.textSizeData,Pe,Un),_n=O.get("text-padding");Ei=this.collisionIndex.placeCollisionCircles(I,Oe,Un,I.lineVertexArray,I.glyphOffsetArray,kn,j,G,re,x,it,Ce.predicate,Dt.collisionCircleDiameter*kn/a.ONE_EM,_n,this.retainedQueryData[I.bucketInstanceId].tileID),fr=Oe||Ei.circles.length>0&&!Ei.collisionDetected,Mt=Mt&&Ei.offscreen,Ut=Ei.occluded}if(jt.iconFeatureIndex&&(Dn=jt.iconFeatureIndex),jt.iconBox){const Un=kn=>{An(kn);const _n=gt&&wi?Yr(wi.x,wi.y,ot,it,this.transform.angle):new a.pointGeometry(0,0),ro=I.getSymbolInstanceIconSize(Be,this.transform.zoom,Dt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(I,ro,kn,_n,qe,pe,j,Ce.predicate)};ki&&ki.box&&ki.box.length&&jt.verticalIconBox?(ti=Un(jt.verticalIconBox),kr=ti.box.length>0):(ti=Un(jt.iconBox),kr=ti.box.length>0),Mt=Mt&&ti.offscreen,ai=ti.occluded}const va=De||Dt.numHorizontalGlyphVertices===0&&Zt===0,Qo=Ne||Dt.numIconVertices===0;if(va||Qo?Qo?va||(kr=kr&&fr):fr=kr&&fr:kr=fr=kr&&fr,fr&&qi&&qi.box&&this.collisionIndex.insertCollisionBox(qi.box,O.get("text-ignore-placement"),I.bucketInstanceId,ki&&ki.box&&xn?xn:Tn,Ce.ID),kr&&ti&&this.collisionIndex.insertCollisionBox(ti.box,O.get("icon-ignore-placement"),I.bucketInstanceId,Dn,Ce.ID),Ei&&(fr&&this.collisionIndex.insertCollisionCircles(Ei.circles,O.get("text-ignore-placement"),I.bucketInstanceId,Tn,Ce.ID),x)){const Un=I.bucketInstanceId;let kn=this.collisionCircleArrays[Un];kn===void 0&&(kn=this.collisionCircleArrays[Un]=new _r);for(let _n=0;_n<Ei.circles.length;_n+=4)kn.circles.push(Ei.circles[_n+0]),kn.circles.push(Ei.circles[_n+1]),kn.circles.push(Ei.circles[_n+2]),kn.circles.push(Ei.collisionDetected?1:0)}const es=I.projection.name!=="globe";Lt=Lt&&(es||!Ut),wt=wt&&(es||!ai),this.placements[wr]=new Tr(fr||Lt,kr||wt,Mt||I.justReloaded),p[wr]=!0};if(zt){const Dt=I.getSortedSymbolIndexes(this.transform.angle);for(let ir=Dt.length-1;ir>=0;--ir){const jt=Dt[ir];Dr(I.symbolInstances.get(jt),jt,I.collisionArrays[jt])}}else for(let Dt=c.symbolInstanceStart;Dt<c.symbolInstanceEnd;Dt++)Dr(I.symbolInstances.get(Dt),Dt,I.collisionArrays[Dt]);if(x&&I.bucketInstanceId in this.collisionCircleArrays){const Dt=this.collisionCircleArrays[I.bucketInstanceId];a.invert(Dt.invProjMatrix,j),Dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(c,p,x,S){const{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:G,crossTileID:re}=x,te=a.getAnchorJustification(p),pe=S===a.WritingMode.vertical?G:te==="left"?I:te==="center"?O:te==="right"?j:-1;I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=pe>=0&&I!==pe?0:re),O>=0&&(c.text.placedSymbolArray.get(O).crossTileID=pe>=0&&O!==pe?0:re),j>=0&&(c.text.placedSymbolArray.get(j).crossTileID=pe>=0&&j!==pe?0:re),G>=0&&(c.text.placedSymbolArray.get(G).crossTileID=pe>=0&&G!==pe?0:re)}markUsedOrientation(c,p,x){const S=p===a.WritingMode.horizontal||p===a.WritingMode.horizontalOnly?p:0,I=p===a.WritingMode.vertical?p:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:re}=x,te=c.text.placedSymbolArray;O>=0&&(te.get(O).placedOrientation=S),j>=0&&(te.get(j).placedOrientation=S),G>=0&&(te.get(G).placedOrientation=S),re>=0&&(te.get(re).placedOrientation=I)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let x=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const S=p?p.symbolFadeChange(c):1,I=p?p.opacities:{},O=p?p.variableOffsets:{},j=p?p.placedOrientations:{};for(const G in this.placements){const re=this.placements[G],te=I[G];te?(this.opacities[G]=new At(te,S,re.text,re.icon,null,re.clipped),x=x||re.text!==te.text.placed||re.icon!==te.icon.placed):(this.opacities[G]=new At(null,S,re.text,re.icon,re.skipFade,re.clipped),x=x||re.text||re.icon)}for(const G in I){const re=I[G];if(!this.opacities[G]){const te=new At(re,S,!1,!1);te.isHidden()||(this.opacities[G]=te,x=x||re.text.placed||re.icon.placed)}}for(const G in O)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=O[G]);for(const G in j)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=j[G]);x?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)}updateLayerOpacities(c,p){const x={};for(const S of p){const I=S.getBucket(c);I&&S.latestFeatureIndex&&c.id===I.layerIds[0]&&this.updateBucketOpacities(I,x,S.collisionBoxArray)}}updateBucketOpacities(c,p,x){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const S=c.layers[0].layout,I=!!c.layers[0].dynamicFilter(),O=new At(null,0,!1,!1,!0),j=S.get("text-allow-overlap"),G=S.get("icon-allow-overlap"),re=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",pe=S.get("text-pitch-alignment")==="map",Ee=S.get("icon-text-fit")!=="none",Le=new At(null,0,j&&(G||!c.hasIconData()||S.get("icon-optional")),G&&(j||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&x&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(x);const Pe=(Ce,De,Ne)=>{for(let Oe=0;Oe<De/4;Oe++)Ce.opacityVertexArray.emplaceBack(Ne)};let Be=0;for(let Ce=0;Ce<c.symbolInstances.length;Ce++){const De=c.symbolInstances.get(Ce),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:Oe,crossTileID:qe,numIconVertices:ot}=De;let it=this.opacities[qe];p[qe]?it=O:it||(it=Le,this.opacities[qe]=it),p[qe]=!0;const gt=Ne>0||Oe>0,zt=ot>0,Lt=this.placedOrientations[qe],wt=Lt===a.WritingMode.vertical,Dr=Lt===a.WritingMode.horizontal||Lt===a.WritingMode.horizontalOnly;if(!gt&&!zt||it.isHidden()||Be++,gt){const Dt=yr(it.text);Pe(c.text,Ne,wt?dn:Dt),Pe(c.text,Oe,Dr?dn:Dt);const ir=it.text.isHidden(),{leftJustifiedTextSymbolIndex:jt,centerJustifiedTextSymbolIndex:wr,rightJustifiedTextSymbolIndex:Zt,verticalPlacedTextSymbolIndex:fr}=De,kr=c.text.placedSymbolArray,Mt=ir||wt?1:0;jt>=0&&(kr.get(jt).hidden=Mt),wr>=0&&(kr.get(wr).hidden=Mt),Zt>=0&&(kr.get(Zt).hidden=Mt),fr>=0&&(kr.get(fr).hidden=ir||Dr?1:0);const Ut=this.variableOffsets[qe];Ut&&this.markUsedJustification(c,Ut.anchor,De,Lt);const ai=this.placedOrientations[qe];ai&&(this.markUsedJustification(c,"left",De,ai),this.markUsedOrientation(c,ai,De))}if(zt){const Dt=yr(it.icon),{placedIconSymbolIndex:ir,verticalPlacedIconSymbolIndex:jt}=De,wr=c.icon.placedSymbolArray,Zt=it.icon.isHidden()?1:0;ir>=0&&(Pe(c.icon,ot,wt?dn:Dt),wr.get(ir).hidden=Zt),jt>=0&&(Pe(c.icon,De.numVerticalIconVertices,Dr?dn:Dt),wr.get(jt).hidden=Zt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Dt=c.collisionArrays[Ce];if(Dt){let ir=new a.pointGeometry(0,0),jt=!0;if(Dt.textBox||Dt.verticalTextBox){if(re){const Zt=this.variableOffsets[qe];Zt?(ir=Ir(Zt.anchor,Zt.width,Zt.height,Zt.textOffset,Zt.textScale),te&&ir._rotate(pe?this.transform.angle:-this.transform.angle)):jt=!1}I&&(jt=!it.clipped),Dt.textBox&&pi(c.textCollisionBox.collisionVertexArray,it.text.placed,!jt||wt,ir.x,ir.y),Dt.verticalTextBox&&pi(c.textCollisionBox.collisionVertexArray,it.text.placed,!jt||Dr,ir.x,ir.y)}const wr=jt&&Boolean(!Dr&&Dt.verticalIconBox);Dt.iconBox&&pi(c.iconCollisionBox.collisionVertexArray,it.icon.placed,wr,Ee?ir.x:0,Ee?ir.y:0),Dt.verticalIconBox&&pi(c.iconCollisionBox.collisionVertexArray,it.icon.placed,!wr,Ee?ir.x:0,Ee?ir.y:0)}}}if(c.fullyClipped=Be===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Ce.invProjMatrix,c.placementViewportMatrix=Ce.viewportMatrix,c.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,p){const x=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*x>c}setStale(){this.stale=!0}}function pi(_,c,p,x,S){_.emplaceBack(c?1:0,p?1:0,x||0,S||0),_.emplaceBack(c?1:0,p?1:0,x||0,S||0),_.emplaceBack(c?1:0,p?1:0,x||0,S||0),_.emplaceBack(c?1:0,p?1:0,x||0,S||0)}const pn=Math.pow(2,25),pr=Math.pow(2,24),ei=Math.pow(2,17),Oi=Math.pow(2,16),Ci=Math.pow(2,9),vn=Math.pow(2,8),_i=Math.pow(2,1);function yr(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const c=_.placed?1:0,p=Math.floor(127*_.opacity);return p*pn+c*pr+p*ei+c*Oi+p*Ci+c*vn+p*_i+c}const dn=0;class an{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,p,x,S,I){const O=this._bucketParts;for(;this._currentTileIndex<c.length;)if(p.getBucketParts(O,S,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,I())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((j,G)=>j.sortKey-G.sortKey));this._currentPartIndex<O.length;){const j=O[this._currentPartIndex];if(p.placeLayerBucketPart(j,this._seenCrossTileIDs,x,j.symbolInstanceStart===0),this._currentPartIndex++,I())return!0}return!1}}class Zn{constructor(c,p,x,S,I,O,j,G){this.placement=new hi(c,I,O,j,G),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(c,p,x){const S=a.exported.now(),I=()=>{const O=a.exported.now()-S;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=p[c[this._currentPlacementIndex]],j=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=j)&&(!O.maxzoom||O.maxzoom>j)){if(this._inProgressLayer||(this._inProgressLayer=new an(O)),this._inProgressLayer.continuePlacement(x[O.source],this.placement,this._showCollisionBoxes,O,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Nn=512/a.EXTENT/2;class Da{constructor(c,p,x){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let S=0;S<p.length;S++){const I=p.get(S),O=I.key;this.indexedSymbolInstances[O]||(this.indexedSymbolInstances[O]=[]),this.indexedSymbolInstances[O].push({crossTileID:I.crossTileID,coord:this.getScaledCoordinates(I,c)})}}getScaledCoordinates(c,p){const x=Nn/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*a.EXTENT+c.tileAnchorX)*x),y:Math.floor((p.canonical.y*a.EXTENT+c.tileAnchorY)*x)}}findMatches(c,p,x){const S=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let I=0;I<c.length;I++){const O=c.get(I);if(O.crossTileID)continue;const j=this.indexedSymbolInstances[O.key];if(!j)continue;const G=this.getScaledCoordinates(O,p);for(const re of j)if(Math.abs(re.coord.x-G.x)<=S&&Math.abs(re.coord.y-G.y)<=S&&!x[re.crossTileID]){x[re.crossTileID]=!0,O.crossTileID=re.crossTileID;break}}}}class ka{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const p=Math.round((c-this.lng)/360);if(p!==0)for(const x in this.indexes){const S=this.indexes[x],I={};for(const O in S){const j=S[O];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+p),I[j.tileID.key]=j}this.indexes[x]=I}this.lng=c}addBucket(c,p,x){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let I=0;I<p.symbolInstances.length;I++)p.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const S=this.usedCrossTileIDs[c.overscaledZ];for(const I in this.indexes){const O=this.indexes[I];if(Number(I)>c.overscaledZ)for(const j in O){const G=O[j];G.tileID.isChildOf(c)&&G.findMatches(p.symbolInstances,c,S)}else{const j=O[c.scaledTo(Number(I)).key];j&&j.findMatches(p.symbolInstances,c,S)}}for(let I=0;I<p.symbolInstances.length;I++){const O=p.symbolInstances.get(I);O.crossTileID||(O.crossTileID=x.generate(),S[O.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Da(c,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(c,p){for(const x in p.indexedSymbolInstances)for(const S of p.indexedSymbolInstances[x])delete this.usedCrossTileIDs[c][S.crossTileID]}removeStaleBuckets(c){let p=!1;for(const x in this.indexes){const S=this.indexes[x];for(const I in S)c[S[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,S[I]),delete S[I],p=!0)}return p}}class Go{constructor(){this.layerIndexes={},this.crossTileIDs=new ka,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,p,x,S){let I=this.layerIndexes[c.id];I===void 0&&(I=this.layerIndexes[c.id]=new eo);let O=!1;const j={};S.name!=="globe"&&I.handleWrapJump(x);for(const G of p){const re=G.getBucket(c);re&&c.id===re.layerIds[0]&&(re.bucketInstanceId||(re.bucketInstanceId=++this.maxBucketInstanceId),I.addBucket(G.tileID,re,this.crossTileIDs)&&(O=!0),j[re.bucketInstanceId]=!0)}return I.removeStaleBuckets(j)&&(O=!0),O}pruneUnusedLayers(c){const p={};c.forEach(x=>{p[x]=!0});for(const x in this.layerIndexes)p[x]||delete this.layerIndexes[x]}}const pa=(_,c)=>a.emitValidationErrors(_,c&&c.filter(p=>p.identifier!=="source.canvas")),Pa=a.pick(tr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),xa=a.pick(tr,["setCenter","setZoom","setBearing","setPitch"]),Ro={version:8,layers:[],sources:{}},Ga={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Qn extends a.Evented{constructor(c,p={}){super(),this.map=c,this.dispatcher=new Yt(ni(),this),this.imageManager=new Te,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(c._requestManager,p.localFontFamily?a.LocalGlyphMode.all:p.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,p.localFontFamily||p.localIdeographFontFamily),this.crossTileSymbolIndex=new Go,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const x=this;this._rtlTextPluginCallback=Qn.registerForPluginStateChange(S=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},(I,O)=>{if(a.triggerPluginCompletionEvent(I),O&&O.every(j=>j))for(const j in x._sourceCaches){const G=x._sourceCaches[j],re=G.getSource().type;re!=="vector"&&re!=="geojson"||G.reload()}})}),this.on("data",S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const I=this.getSource(S.sourceId);if(I&&I.vectorLayerIds)for(const O in this._layers){const j=this._layers[O];j.source===I.id&&this._validateLayer(j)}})}loadURL(c,p={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const x=typeof p.validate=="boolean"?p.validate:!a.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);const S=this.map._requestManager.transformRequest(c,a.ResourceType.Style);this._request=a.getJSON(S,(I,O)=>{this._request=null,I?this.fire(new a.ErrorEvent(I)):O&&this._load(O,x)})}loadJSON(c,p={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(c,p.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Ro,!1)}_updateLayerCount(c,p){const x=p?1:-1;c.is3D()&&(this._num3DLayers+=x),c.type==="circle"&&(this._numCircleLayers+=x),c.type==="symbol"&&(this._numSymbolLayers+=x)}_load(c,p){if(p&&pa(this,a.validateStyle(c)))return;this._loaded=!0,this.stylesheet=a.clone$1(c),this._updateMapProjection();for(const S in c.sources)this.addSource(S,c.sources[S],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const x=et(this.stylesheet.layers);this._order=x.map(S=>S.id),this._layers={},this._serializedLayers={};for(let S of x)S=a.createStyleLayer(S),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new St(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(p,x,S){let I,O,j;const G=a.exported.devicePixelRatio>1?"@2x":"";let re=a.getJSON(x.transformRequest(x.normalizeSpriteURL(p,G,".json"),a.ResourceType.SpriteJSON),(Ee,Le)=>{re=null,j||(j=Ee,I=Le,pe())}),te=a.getImage(x.transformRequest(x.normalizeSpriteURL(p,G,".png"),a.ResourceType.SpriteImage),(Ee,Le)=>{te=null,j||(j=Ee,O=Le,pe())});function pe(){if(j)S(j);else if(I&&O){const Ee=a.exported.getImageData(O),Le={};for(const Pe in I){const{width:Be,height:Ce,x:De,y:Ne,sdf:Oe,pixelRatio:qe,stretchX:ot,stretchY:it,content:gt}=I[Pe],zt=new a.RGBAImage({width:Be,height:Ce});a.RGBAImage.copy(Ee,zt,{x:De,y:Ne},{x:0,y:0},{width:Be,height:Ce}),Le[Pe]={data:zt,pixelRatio:qe,sdf:Oe,stretchX:ot,stretchY:it,content:gt}}S(null,Le)}}return{cancel(){re&&(re.cancel(),re=null),te&&(te.cancel(),te=null)}}}(c,this.map._requestManager,(p,x)=>{if(this._spriteRequest=null,p)this.fire(new a.ErrorEvent(p));else if(x)for(const S in x)this.imageManager.addImage(S,x[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(c){const p=this.getSource(c.source);if(!p)return;const x=c.sourceLayer;x&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(x)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${p.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const p=[];for(const x of c){const S=this._layers[x];S.type!=="custom"&&p.push(S.serialize())}return p}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&Ga[c.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const p=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);(S.length||I.length)&&this._updateWorkerLayers(S,I);for(const O in this._updatedSources){const j=this._updatedSources[O];j==="reload"?this._reloadSource(O):j==="clear"&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const x={};for(const S in this._sourceCaches){const I=this._sourceCaches[S];x[S]=I.used,I.used=!1}for(const S of this._order){const I=this._layers[S];if(I.recalculate(c,this._availableImages),!I.isHidden(c.zoom)){const j=this._getLayerSourceCache(I);j&&(j.used=!0)}const O=this.map.painter;if(O){const j=I.getProgramIds();if(!j)continue;const G=I.getProgramConfiguration(c.zoom);for(const re of j)O.useProgram(re,G)}}for(const S in x){const I=this._sourceCaches[S];x[S]!==I.used&&I.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),pa(this,a.validateStyle(c)))return!1;(c=a.clone$1(c)).layers=et(c.layers);const p=function(S,I){if(!S)return[{command:tr.setStyle,args:[I]}];let O=[];try{if(!b(S.version,I.version))return[{command:tr.setStyle,args:[I]}];b(S.center,I.center)||O.push({command:tr.setCenter,args:[I.center]}),b(S.zoom,I.zoom)||O.push({command:tr.setZoom,args:[I.zoom]}),b(S.bearing,I.bearing)||O.push({command:tr.setBearing,args:[I.bearing]}),b(S.pitch,I.pitch)||O.push({command:tr.setPitch,args:[I.pitch]}),b(S.sprite,I.sprite)||O.push({command:tr.setSprite,args:[I.sprite]}),b(S.glyphs,I.glyphs)||O.push({command:tr.setGlyphs,args:[I.glyphs]}),b(S.transition,I.transition)||O.push({command:tr.setTransition,args:[I.transition]}),b(S.light,I.light)||O.push({command:tr.setLight,args:[I.light]}),b(S.fog,I.fog)||O.push({command:tr.setFog,args:[I.fog]}),b(S.projection,I.projection)||O.push({command:tr.setProjection,args:[I.projection]});const j={},G=[];(function(pe,Ee,Le,Pe){let Be;for(Be in Ee=Ee||{},pe=pe||{})pe.hasOwnProperty(Be)&&(Ee.hasOwnProperty(Be)||Jr(Be,Le,Pe));for(Be in Ee)Ee.hasOwnProperty(Be)&&(pe.hasOwnProperty(Be)?b(pe[Be],Ee[Be])||(pe[Be].type==="geojson"&&Ee[Be].type==="geojson"&&Gi(pe,Ee,Be)?Le.push({command:tr.setGeoJSONSourceData,args:[Be,Ee[Be].data]}):Ji(Be,Ee,Le,Pe)):gr(Be,Ee,Le))})(S.sources,I.sources,G,j);const re=[];S.layers&&S.layers.forEach(pe=>{pe.source&&j[pe.source]?O.push({command:tr.removeLayer,args:[pe.id]}):re.push(pe)});let te=S.terrain;te&&j[te.source]&&(O.push({command:tr.setTerrain,args:[void 0]}),te=void 0),O=O.concat(G),b(te,I.terrain)||O.push({command:tr.setTerrain,args:[I.terrain]}),function(pe,Ee,Le){Ee=Ee||[];const Pe=(pe=pe||[]).map(Ft),Be=Ee.map(Ft),Ce=pe.reduce(ao,{}),De=Ee.reduce(ao,{}),Ne=Pe.slice(),Oe=Object.create(null);let qe,ot,it,gt,zt,Lt,wt;for(qe=0,ot=0;qe<Pe.length;qe++)it=Pe[qe],De.hasOwnProperty(it)?ot++:(Le.push({command:tr.removeLayer,args:[it]}),Ne.splice(Ne.indexOf(it,ot),1));for(qe=0,ot=0;qe<Be.length;qe++)it=Be[Be.length-1-qe],Ne[Ne.length-1-qe]!==it&&(Ce.hasOwnProperty(it)?(Le.push({command:tr.removeLayer,args:[it]}),Ne.splice(Ne.lastIndexOf(it,Ne.length-ot),1)):ot++,Lt=Ne[Ne.length-qe],Le.push({command:tr.addLayer,args:[De[it],Lt]}),Ne.splice(Ne.length-qe,0,it),Oe[it]=!0);for(qe=0;qe<Be.length;qe++)if(it=Be[qe],gt=Ce[it],zt=De[it],!Oe[it]&&!b(gt,zt))if(b(gt.source,zt.source)&&b(gt["source-layer"],zt["source-layer"])&&b(gt.type,zt.type)){for(wt in Xi(gt.layout,zt.layout,Le,it,null,tr.setLayoutProperty),Xi(gt.paint,zt.paint,Le,it,null,tr.setPaintProperty),b(gt.filter,zt.filter)||Le.push({command:tr.setFilter,args:[it,zt.filter]}),b(gt.minzoom,zt.minzoom)&&b(gt.maxzoom,zt.maxzoom)||Le.push({command:tr.setLayerZoomRange,args:[it,zt.minzoom,zt.maxzoom]}),gt)gt.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Xi(gt[wt],zt[wt],Le,it,wt.slice(6),tr.setPaintProperty):b(gt[wt],zt[wt])||Le.push({command:tr.setLayerProperty,args:[it,wt,zt[wt]]}));for(wt in zt)zt.hasOwnProperty(wt)&&!gt.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Xi(gt[wt],zt[wt],Le,it,wt.slice(6),tr.setPaintProperty):b(gt[wt],zt[wt])||Le.push({command:tr.setLayerProperty,args:[it,wt,zt[wt]]}))}else Le.push({command:tr.removeLayer,args:[it]}),Lt=Ne[Ne.lastIndexOf(it)+1],Le.push({command:tr.addLayer,args:[zt,Lt]})}(re,I.layers,O)}catch(j){console.warn("Unable to compute style diff:",j),O=[{command:tr.setStyle,args:[I]}]}return O}(this.serialize(),c).filter(S=>!(S.command in xa));if(p.length===0)return!1;const x=p.filter(S=>!(S.command in Pa));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);return p.forEach(S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,p){return this.getImage(c)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,p),this._afterImageUpdated(c),this)}updateImage(c,p){this.imageManager.updateImage(c,p)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,p,x={}){if(this._checkLoaded(),this.getSource(c)!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(a.validateSource,`sources.${c}`,p,null,x))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const S=yt(c,p,this.dispatcher,this);S.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:S.serialize(),sourceId:c}));const I=O=>{const j=(O?"symbol:":"other:")+c,G=this._sourceCaches[j]=new a.SourceCache(j,S,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[c]=G,G.style=this,G.onAdd(this.map)};I(!1),p.type!=="vector"&&p.type!=="geojson"||I(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const p=this.getSource(c);if(!p)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===c)return this.fire(new a.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new a.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const x=this._getSourceCaches(c);for(const S of x)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,p){this._checkLoaded(),this.getSource(c).setData(p),this._changed=!0}getSource(c){const p=this._getSourceCache(c);return p&&p.getSource()}_getSources(){const c=[];for(const p in this._otherSourceCaches){const x=this._getSourceCache(p);x&&c.push(x.getSource())}return c}addLayer(c,p,x={}){this._checkLoaded();const S=c.id;if(this.getLayer(S))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let I;if(c.type==="custom"){if(pa(this,a.validateCustomStyleLayer(c)))return;I=a.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(S,c.source),c=a.clone$1(c),c=a.extend(c,{source:S})),this._validate(a.validateLayer,`layers.${S}`,c,{arrayIndex:-1},x))return;I=a.createStyleLayer(c),this._validateLayer(I),I.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[I.id]=I.serialize(),this._updateLayerCount(I,!0)}const O=p?this._order.indexOf(p):this._order.length;if(p&&O===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`)));this._order.splice(O,0,S),this._layerOrderChanged=!0,this._layers[S]=I;const j=this._getLayerSourceCache(I);if(this._removedLayers[S]&&I.source&&j&&I.type!=="custom"){const G=this._removedLayers[S];delete this._removedLayers[S],G.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",j.pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,p){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===p)return;const x=this._order.indexOf(c);this._order.splice(x,1);const S=p?this._order.indexOf(p):this._order.length;p&&S===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`))):(this._order.splice(S,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const p=this._layers[c];if(!p)return void this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));p.setEventedParent(null),this._updateLayerCount(p,!1);const x=this._order.indexOf(c);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const p in this._layers)if(this._layers[p].type===c)return!0;return!1}setLayerZoomRange(c,p,x){this._checkLoaded();const S=this.getLayer(c);S?S.minzoom===p&&S.maxzoom===x||(p!=null&&(S.minzoom=p),x!=null&&(S.maxzoom=x),this._updateLayer(S)):this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,p,x={}){this._checkLoaded();const S=this.getLayer(c);if(S){if(!b(S.filter,p))return p==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(a.validateFilter,`layers.${S.id}.filter`,p,{layerType:S.type},x)||(S.filter=a.clone$1(p),this._updateLayer(S)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const p=this.getLayer(c);return p&&a.clone$1(p.filter)}setLayoutProperty(c,p,x,S={}){this._checkLoaded();const I=this.getLayer(c);I?b(I.getLayoutProperty(p),x)||(I.setLayoutProperty(p,x,S),this._updateLayer(I)):this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,p){const x=this.getLayer(c);if(x)return x.getLayoutProperty(p);this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,p,x,S={}){this._checkLoaded();const I=this.getLayer(c);I?b(I.getPaintProperty(p),x)||(I.setPaintProperty(p,x,S)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,p){const x=this.getLayer(c);return x&&x.getPaintProperty(p)}setFeatureState(c,p){this._checkLoaded();const x=c.source,S=c.sourceLayer,I=this.getSource(x);if(!I)return void this.fire(new a.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const O=I.type;if(O==="geojson"&&S)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(O==="vector"&&!S)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const j=this._getSourceCaches(x);for(const G of j)G.setFeatureState(S,c.id,p)}removeFeatureState(c,p){this._checkLoaded();const x=c.source,S=this.getSource(x);if(!S)return void this.fire(new a.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const I=S.type,O=I==="vector"?c.sourceLayer:void 0;if(I==="vector"&&!O)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const j=this._getSourceCaches(x);for(const G of j)G.removeFeatureState(O,c.id,p)}getFeatureState(c){this._checkLoaded();const p=c.source,x=c.sourceLayer,S=this.getSource(p);if(S){if(S.type!=="vector"||x)return c.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(p)[0].getFeatureState(x,c.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const p in this._sourceCaches){const x=this._sourceCaches[p].getSource();c[x.id]||(c[x.id]=x.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0;const p=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&p&&p.getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",p.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const p=O=>this._layers[O].type==="fill-extrusion",x={},S=[];for(let O=this._order.length-1;O>=0;O--){const j=this._order[O];if(p(j)){x[j]=O;for(const G of c){const re=G[j];if(re)for(const te of re)S.push(te)}}}S.sort((O,j)=>j.intersectionZ-O.intersectionZ);const I=[];for(let O=this._order.length-1;O>=0;O--){const j=this._order[O];if(p(j))for(let G=S.length-1;G>=0;G--){const re=S[G].feature;if(x[re.layer.id]<O)break;I.push(re),S.pop()}else for(const G of c){const re=G[j];if(re)for(const te of re)I.push(te.feature)}}return I}queryRenderedFeatures(c,p,x){p&&p.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",p.filter,null,p);const S={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of p.layers){const re=this._layers[G];if(!re)return this.fire(new a.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];S[re.source]=!0}}const I=[];p.availableImages=this._availableImages;const O=p&&p.layers?p.layers.some(G=>{const re=this.getLayer(G);return re&&re.is3D()}):this.has3DLayers(),j=lr.createFromScreenPoints(c,x);for(const G in this._sourceCaches){const re=this._sourceCaches[G].getSource().id;p.layers&&!S[re]||I.push(vt(this._sourceCaches[G],this._layers,this._serializedLayers,j,p,x,O,!!this.map._showQueryGeometry))}return this.placement&&I.push(function(G,re,te,pe,Ee,Le,Pe){const Be={},Ce=Le.queryRenderedSymbols(pe),De=[];for(const Ne of Object.keys(Ce).map(Number))De.push(Pe[Ne]);De.sort(Ar);for(const Ne of De){const Oe=Ne.featureIndex.lookupSymbolFeatures(Ce[Ne.bucketInstanceId],re,Ne.bucketIndex,Ne.sourceLayerIndex,Ee.filter,Ee.layers,Ee.availableImages,G);for(const qe in Oe){const ot=Be[qe]=Be[qe]||[],it=Oe[qe];it.sort((gt,zt)=>{const Lt=Ne.featureSortOrder;if(Lt){const wt=Lt.indexOf(gt.featureIndex);return Lt.indexOf(zt.featureIndex)-wt}return zt.featureIndex-gt.featureIndex});for(const gt of it)ot.push(gt)}}for(const Ne in Be)Be[Ne].forEach(Oe=>{const qe=Oe.feature,ot=te(G[Ne]).getFeatureState(qe.layer["source-layer"],qe.id);qe.source=qe.layer.source,qe.layer["source-layer"]&&(qe.sourceLayer=qe.layer["source-layer"]),qe.state=ot});return Be}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),j.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(I)}querySourceFeatures(c,p){p&&p.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",p.filter,null,p);const x=this._getSourceCaches(c);let S=[];for(const I of x)S=S.concat($t(I,p));return S}addSourceType(c,p,x){return Qn.getSourceType(c)?x(new Error(`A source type called "${c}" already exists.`)):(Qn.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(c,p={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const O in c)if(!b(c[O],x[O])){S=!0;break}if(!S)return;const I=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,p),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,p=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(p===1){if(typeof c.source=="object"){const x="terrain-dem-src";this.addSource(x,c.source),c=a.clone$1(c),c=a.extend(c,{source:x})}if(this._validate(a.validateTerrain,"terrain",c))return}if(!this.terrain||this.terrain&&p!==this.terrain.drapeRenderMode)this._createTerrain(c,p);else{const x=this.terrain,S=x.get();for(const I of Object.keys(a.spec.terrain))!c.hasOwnProperty(I)&&a.spec.terrain[I].default&&(c[I]=a.spec.terrain[I].default);for(const I in c)if(!b(c[I],S[I])){x.set(c),this.stylesheet.terrain=c;const O=this._setTransitionParameters({duration:0});x.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const p=this.fog=new mr(c,this.map.transform);this.stylesheet.fog=c;const x=this._setTransitionParameters({duration:0});p.updateTransitions(x)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog,x=p.get();Object.keys(c).length===0&&p.set(c);for(const S in c)if(!b(c[S],x[S])){p.set(c),this.stylesheet.fog=c;const I=this._setTransitionParameters({duration:0});p.updateTransitions(I);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:a.exported.now(),transition:a.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(x=>this.isLayerDraped(this._layers[x])),p=this._order.filter(x=>!this.isLayerDraped(this._layers[x]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...p)}_createTerrain(c,p){const x=this.terrain=new Nr(c,p);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});x.updateTransitions(S)}_force3DLayerUpdate(){for(const c in this._layers){const p=this._layers[c];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const p=this._layers[c];p.type==="symbol"&&this._updateLayer(p)}}_validate(c,p,x,S,I={}){return(!I||I.validate!==!1)&&pa(this,c.call(a.validateStyle,a.extend({key:p,style:this.serialize(),value:x,styleSpec:a.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const p=this._getSourceCaches(c);for(const x of p)x.clearTiles()}_reloadSource(c){const p=this._getSourceCaches(c);for(const x of p)x.resume(),x.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const p in this._sourceCaches)this._sourceCaches[p].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const p=this._sourceCaches[c];p.resume(),p.reload()}}_updatePlacement(c,p,x,S,I=!1){let O=!1,j=!1;const G={};for(const re of this._order){const te=this._layers[re];if(te.type!=="symbol")continue;if(!G[te.source]){const Ee=this._getLayerSourceCache(te);if(!Ee)continue;G[te.source]=Ee.getRenderableIds(!0).map(Le=>Ee.getTileByID(Le)).sort((Le,Pe)=>Pe.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Pe.tileID)?-1:1))}const pe=this.crossTileSymbolIndex.addLayer(te,G[te.source],c.center.lng,c.projection);O=O||pe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),I=I||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),c.zoom))&&(this.pauseablePlacement=new Zn(c,this._order,I,p,x,S,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),j=!0),O&&this.pauseablePlacement.placement.setStale()),j||O)for(const re of this._order){const te=this._layers[re];te.type==="symbol"&&this.placement.updateLayerOpacities(te,G[te.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,p,x){this.imageManager.getImages(p.icons,x),this._updateTilesForChangedImages();const S=I=>{I&&I.setDependencies(p.tileID.key,p.type,p.icons)};S(this._otherSourceCaches[p.source]),S(this._symbolSourceCaches[p.source])}getGlyphs(c,p,x){this.glyphManager.getGlyphs(p.stacks,x)}getResource(c,p,x){return a.makeRequest(p,x)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const p=[];return this._otherSourceCaches[c]&&p.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&p.push(this._symbolSourceCaches[c]),p}_isSourceCacheLoaded(c){const p=this._getSourceCaches(c);return p.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):p.every(x=>x.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qn.getSourceType=function(_){return mt[_]},Qn.setSourceType=function(_,c){mt[_]=c},Qn.registerForPluginStateChange=a.registerForPluginStateChange;var Cs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,qo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,sn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ta={},Bo={};const ra=[];ba(Cs,ra),ba(xo,ra),ba(sn,ra),ba(Hn,ra),ta=cn("",xo),Bo=cn(Hn,sn);const ma=cn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),so=Cs,ia=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Is={background:cn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:cn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:cn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:cn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:cn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:cn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:cn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:cn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:cn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:cn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:cn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:cn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:cn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:cn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qo),skyboxGradient:cn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qo),skyboxCapture:cn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ba(_,c){const p=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let x of p)if(x=x.trim(),x[0]==="#"&&x.includes("if")&&!x.includes("endif")){x=x.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=x.split(" ");for(const I of S)c.includes(I)||c.push(I)}}function cn(_,c){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},I=[...ra];return ba(_,I),ba(c,I),{fragmentSource:_=_.replace(p,(O,j,G,re,te)=>(S[te]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${G} ${re} ${te};
#else
uniform ${G} ${re} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${G} ${re} ${te} = u_${te};
#endif
`)),vertexSource:c=c.replace(p,(O,j,G,re,te)=>{const pe=re==="float"?"vec2":"vec4",Ee=te.match(/color/)?"color":pe;return S[te]?j==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${G} ${pe} a_${te};
varying ${G} ${re} ${te};
#else
uniform ${G} ${re} u_${te};
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${G} ${re} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${Ee}(a_${te}, u_${te}_t);
#else
    ${G} ${re} ${te} = u_${te};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${G} ${pe} a_${te};
#else
uniform ${G} ${re} u_${te};
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${G} ${re} ${te} = a_${te};
#else
    ${G} ${re} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${G} ${re} ${te} = unpack_mix_${Ee}(a_${te}, u_${te}_t);
#else
    ${G} ${re} ${te} = u_${te};
#endif
`}),staticAttributes:x,usedDefines:I}}class Ds{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,p,x,S,I,O,j){this.context=c;let G=this.boundPaintVertexBuffers.length!==S.length;for(let te=0;!G&&te<S.length;te++)this.boundPaintVertexBuffers[te]!==S[te]&&(G=!0);let re=this.boundDynamicVertexBuffers.length!==j.length;for(let te=0;!re&&te<j.length;te++)this.boundDynamicVertexBuffers[te]!==j[te]&&(re=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==x||G||re||this.boundIndexBuffer!==I||this.boundVertexOffset!==O)this.freshBind(p,x,S,I,O,j);else{c.bindVertexArrayOES.set(this.vao);for(const te of j)te&&te.bind();I&&I.dynamicDraw&&I.bind()}}freshBind(c,p,x,S,I,O){let j;const G=c.numAttributes,re=this.context,te=re.gl;if(re.extVertexArrayObject)this.vao&&this.destroy(),this.vao=re.extVertexArrayObject.createVertexArrayOES(),re.bindVertexArrayOES.set(this.vao),j=0,this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=S,this.boundVertexOffset=I,this.boundDynamicVertexBuffers=O;else{j=re.currentNumAttributes||0;for(let pe=G;pe<j;pe++)te.disableVertexAttribArray(pe)}p.enableAttributes(te,c),p.bind(),p.setVertexAttribPointers(te,c,I);for(const pe of x)pe.enableAttributes(te,c),pe.bind(),pe.setVertexAttribPointers(te,c,I);for(const pe of O)pe&&(pe.enableAttributes(te,c),pe.bind(),pe.setVertexAttribPointers(te,c,I));S&&S.bind(),re.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function qa(_,c){const p=Math.pow(2,c.canonical.z),x=c.canonical.y;return[new a.MercatorCoordinate(0,x/p).toLngLat().lat,new a.MercatorCoordinate(0,(x+1)/p).toLngLat().lat]}function wa(_,c,p,x,S,I,O){const j=_.context,G=j.gl,re=p.fbo;if(!re)return;_.prepareDrawTile();const te=_.useProgram("hillshade");j.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,re.colorAttachment.get());const pe=((Be,Ce,De,Ne)=>{const Oe=De.paint.get("hillshade-shadow-color"),qe=De.paint.get("hillshade-highlight-color"),ot=De.paint.get("hillshade-accent-color");let it=De.paint.get("hillshade-illumination-direction")*(Math.PI/180);De.paint.get("hillshade-illumination-anchor")==="viewport"&&(it-=Be.transform.angle);const gt=!Be.options.moving;return{u_matrix:Ne||Be.transform.calculateProjMatrix(Ce.tileID.toUnwrapped(),gt),u_image:0,u_latrange:qa(0,Ce.tileID),u_light:[De.paint.get("hillshade-exaggeration"),it],u_shadow:Oe,u_highlight:qe,u_accent:ot}})(_,p,x,_.terrain?c.projMatrix:null);_.prepareDrawProgram(j,te,c.toUnwrapped());const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Le,tileBoundsSegments:Pe}=_.getTileBoundsBuffers(p);te.draw(j,G.TRIANGLES,S,I,O,a.CullFaceMode.disabled,pe,x.id,Ee,Le,Pe)}function Ct(_,c,p){if(!c.needsDEMTextureUpload)return;const x=_.context,S=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||_.getTileTexture(p.stride);const I=p.getPixels();c.demTexture?c.demTexture.update(I,{premultiply:!1}):c.demTexture=new a.Texture(x,I,S.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Mo(_,c,p,x,S,I){const O=_.context,j=O.gl;if(!c.dem)return;const G=c.dem;if(O.activeTexture.set(j.TEXTURE1),Ct(_,c,G),!c.demTexture)return;c.demTexture.bind(j.NEAREST,j.CLAMP_TO_EDGE);const re=G.dim;O.activeTexture.set(j.TEXTURE0);let te=c.fbo;if(!te){const Pe=new a.Texture(O,{width:re,height:re,data:null},j.RGBA);Pe.bind(j.LINEAR,j.CLAMP_TO_EDGE),te=c.fbo=O.createFramebuffer(re,re,!0),te.colorAttachment.set(Pe.texture)}O.bindFramebuffer.set(te.framebuffer),O.viewport.set([0,0,re,re]);const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:Ee,tileBoundsSegments:Le}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(O,j.TRIANGLES,x,S,I,a.CullFaceMode.disabled,((Pe,Be)=>{const Ce=Be.stride,De=a.create();return a.ortho(De,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(De,De,[0,-a.EXTENT,0]),{u_matrix:De,u_image:1,u_dimension:[Ce,Ce],u_zoom:Pe.overscaledZ,u_unpack:Be.unpackVector}})(c.tileID,G),p.id,pe,Ee,Le),c.needsHillshadePrepare=!1}const mo=_=>({u_matrix:new a.UniformMatrix4f(_),u_image0:new a.Uniform1i(_),u_skirt_height:new a.Uniform1f(_)}),lo=(_,c)=>({u_matrix:_,u_image0:0,u_skirt_height:c}),Xo=(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(x),u_merc_matrix:p,u_zoom_transition:S,u_merc_center:I,u_image0:0,u_frustum_tl:O,u_frustum_tr:j,u_frustum_br:G,u_frustum_bl:re,u_globe_pos:te,u_globe_radius:pe,u_viewport:Ee,u_grid_matrix:Le?Float32Array.from(Le):new Float32Array(9)});function Oo(_,c){return _!=null&&c!=null&&!(!_.hasData()||!c.hasData())&&_.demTexture!=null&&c.demTexture!=null&&_.tileID.key!==c.tileID.key}const Ui=new class{constructor(){this.operations={}}newMorphing(_,c,p,x,S){if(_ in this.operations){const I=this.operations[_];I.to.tileID.key!==p.tileID.key&&(I.queued=p)}else this.operations[_]={startTime:x,phase:0,duration:S,from:c,to:p,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const c=this.operations[_];return{from:c.from,to:c.to,phase:c.phase}}update(_){for(const c in this.operations){const p=this.operations[c];for(p.phase=(_-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,_)){delete this.operations[c];break}}}_nextOp(_,c){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=c,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},na={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function go(_,c){const p=1<<_.z;return!c&&(_.x===0||_.x===p-1)||_.y===0||_.y===p-1}const ga=_=>({u_matrix:_});function Zo(_,c,p,x,S){if(S>0){const I=a.exported.now(),O=(I-_.timeAdded)/S,j=c?(I-c.timeAdded)/S:-1,G=p.getSource(),re=x.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),te=!c||Math.abs(c.tileID.overscaledZ-re)>Math.abs(_.tileID.overscaledZ-re),pe=te&&_.refreshedUponExpiration?1:a.clamp(te?O:1-j,0,1);return _.refreshedUponExpiration&&O>=1&&(_.refreshedUponExpiration=!1),c?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}class en extends a.SourceCache{constructor(c){const p={type:"raster-dem",maxzoom:c.transform.maxZoom},x=new Yt(ni(),null),S=yt("mock-dem",p,x,c.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,p){c.state="loaded",p(null)}}class Ni extends a.SourceCache{constructor(c){const p=yt("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Yt(ni(),null),c.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,p,x){if(c.freezeTileCoverage)return;this.transform=c;const S=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((I,O)=>{if(I[O.key]="",!this._tiles[O.key]){const j=new a.Tile(O,this._source.tileSize*O.overscaleFactor(),c.tileZoom);j.state="loaded",this._tiles[O.key]=j}return I},{});for(const I in this._tiles)I in S||(this.freeFBO(I),this._tiles[I].unloadVectorData(),delete this._tiles[I])}freeFBO(c){const p=this.proxyCachedFBO[c];if(p!==void 0){const x=Object.values(p);this.renderCachePool.push(...x),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cs extends a.OverscaledTileID{constructor(c,p,x){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=p,this.projMatrix=x}}class Fi extends a.Elevation{constructor(c,p){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,S,I]=function(G){const re=new a.StructArrayLayout4i8,te=new a.StructArrayLayout3ui6,pe=131;re.reserve(17161),te.reserve(33800);const Ee=a.EXTENT/128,Le=a.EXTENT+Ee/2,Pe=Le+Ee;for(let Ce=-Ee;Ce<Pe;Ce+=Ee)for(let De=-Ee;De<Pe;De+=Ee){const Ne=De<0||De>Le||Ce<0||Ce>Le?24575:0,Oe=a.clamp(Math.round(De),0,a.EXTENT),qe=a.clamp(Math.round(Ce),0,a.EXTENT);re.emplaceBack(Oe+Ne,qe,Oe,qe)}const Be=(Ce,De)=>{const Ne=De*pe+Ce;te.emplaceBack(Ne+1,Ne,Ne+pe),te.emplaceBack(Ne+pe,Ne+pe+1,Ne+1)};for(let Ce=1;Ce<129;Ce++)for(let De=1;De<129;De++)Be(De,Ce);return[0,129].forEach(Ce=>{for(let De=0;De<130;De++)Be(De,Ce),Be(Ce,De)}),[re,te,32768]}(),O=c.context;this.gridBuffer=O.createVertexBuffer(x,a.boundsAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(S),this.gridSegments=a.SegmentVector.simpleSegment(0,0,x.length,S.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,x.length,I),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ni(p.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const j=O.gl;this._overlapStencilMode=new a.StencilMode({func:j.GEQUAL,mask:255},0,255,j.KEEP,j.KEEP,j.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new en(p.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency()}update(c,p,x){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const S=c.terrain.properties;this.sourceCache=c.terrain.drapeRenderMode===0?this._mockSourceCache:c._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const I=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(p,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),p.updateElevation(!0,x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||c.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=x._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(x.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=p.getIds().map(G=>{const re=p.getTileByID(G).tileID;return re.projMatrix=x.calculateProjMatrix(re.toUnwrapped()),re});(function(G,re){const te=re.transform.pointCoordinate(re.transform.getCameraPoint()),pe=new a.pointGeometry(te.x,te.y);G.sort((Ee,Le)=>{if(Le.overscaledZ-Ee.overscaledZ)return Le.overscaledZ-Ee.overscaledZ;const Pe=new a.pointGeometry(Ee.canonical.x+(1<<Ee.canonical.z)*Ee.wrap,Ee.canonical.y),Be=new a.pointGeometry(Le.canonical.x+(1<<Le.canonical.z)*Le.wrap,Le.canonical.y),Ce=pe.mult(1<<Ee.canonical.z);return Ce.x-=.5,Ce.y-=.5,Ce.distSqr(Pe)-Ce.distSqr(Be)})})(S,this.painter),this._previousZoom=x.zoom;const I=this.proxyToSource||{};this.proxyToSource={},S.forEach(G=>{this.proxyToSource[G.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const G in O){const re=O[G];if(!re.used||(re!==this.sourceCache&&this.resetTileLookupCache(re.id),this._setupProxiedCoordsForOrtho(re,c[G],I),re.usedForTerrain))continue;const te=c[G];re.getSource().reparseOverscaled&&this._assignTerrainTiles(te)}this.proxiedCoords[p.id]=S.map(G=>new cs(G,G.key,this.orthoMatrix)),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(I),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const j={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const re=this.terrainTileForTile[G.key];if(!re)continue;const te=re.tileID.key;te in j||(this._visibleDemTiles.push(re),j[te]=te)}}_assignTerrainTiles(c){this._initializing||c.forEach(p=>{if(this.terrainTileForTile[p.key])return;const x=this._findTileCoveringTileID(p,this.sourceCache);x&&(this.terrainTileForTile[p.key]=x)})}_prepareDEMTextures(){const c=this.painter.context,p=c.gl;for(const x in this.terrainTileForTile){const S=this.terrainTileForTile[x],I=S.dem;!I||S.demTexture&&!S.needsDEMTextureUpload||(c.activeTexture.set(p.TEXTURE1),Ct(this.painter,S,I))}}_prepareDemTileUniforms(c,p,x,S){if(!p||p.demTexture==null)return!1;const I=c.tileID.canonical,O=Math.pow(2,p.tileID.canonical.z-I.z),j=S||"";return x[`u_dem_tl${j}`]=[I.x*O%1,I.y*O%1],x[`u_dem_scale${j}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,p=c.gl;if(!this._emptyDepthBufferTexture){const x=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(c,x,p.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const p=this._visibleDemTiles.reduce((x,S)=>{if(!S.dem)return x;const I=S.dem.tree.minimums[0];return I>0&&c++,x+I},0);return c?p/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,p=c.gl;c.activeTexture.set(p.TEXTURE2);const x=this._getLoadedAreaMinimum(),S=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(x,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let I=this._emptyDEMTexture;return I?I.update(S,{premultiply:!1}):I=this._emptyDEMTexture=new a.Texture(c,S,p.RGBA,{premultiply:!1}),I}setupElevationDraw(c,p,x){const S=this.painter.context,I=S.gl,O=(j=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(j),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var j;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let G=null,re=null,te=1;if(x&&x.morphing&&this._useVertexMorphing){const pe=x.morphing.srcDemTile,Ee=x.morphing.dstDemTile;te=x.morphing.phase,pe&&Ee&&(this._prepareDemTileUniforms(c,pe,O,"_prev")&&(re=pe),this._prepareDemTileUniforms(c,Ee,O)&&(G=Ee))}if(re&&G?(S.activeTexture.set(I.TEXTURE2),G.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE,I.NEAREST),S.activeTexture.set(I.TEXTURE4),re.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE,I.NEAREST),O.u_dem_lerp=te):(G=this.terrainTileForTile[c.tileID.key],S.activeTexture.set(I.TEXTURE2),(this._prepareDemTileUniforms(c,G,O)?G.demTexture:this.emptyDEMTexture).bind(I.NEAREST,I.CLAMP_TO_EDGE)),S.activeTexture.set(I.TEXTURE3),x&&x.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),x&&x.useMeterToDem&&G){const pe=(1<<G.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=pe}if(x&&x.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),p.setTerrainUniformValues(S,O),this.painter.transform.projection.name==="globe"){const pe=this.globeUniformValues(this.painter.transform,c.tileID.canonical,x&&x.useDenormalizedUpVectorScale);p.setGlobeUniformValues(S,pe)}}globeUniformValues(c,p,x){const S=c.projection;return{u_tile_tl_up:S.upVector(p,0,0),u_tile_tr_up:S.upVector(p,a.EXTENT,0),u_tile_br_up:S.upVector(p,a.EXTENT,a.EXTENT),u_tile_bl_up:S.upVector(p,0,a.EXTENT),u_tile_up_scale:x?a.GLOBE_METERS_TO_ECEF:S.upVectorScale(p,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const p=this.painter,x=this.painter.context;c.length!==0&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(S,I,O,j,G){if(S.transform.projection.name==="globe")(function(re,te,pe,Ee,Le){const Pe=re.context,Be=Pe.gl;let Ce,De;const Ne=re.options.showTerrainWireframe?2:0,Oe=re.transform,qe=a.globeUseCustomAntiAliasing(re,Pe,Oe),ot=(wr,Zt)=>{if(De===wr)return;const fr=[na[wr],"PROJECTION_GLOBE_VIEW"];qe&&fr.push("CUSTOM_ANTIALIASING"),Zt&&fr.push(na[Ne]),Ce=re.useProgram("globeRaster",null,fr),De=wr},it=re.colorModeForRenderPass(),gt=new a.DepthMode(Be.LEQUAL,a.DepthMode.ReadWrite,re.depthRangeFor3D);Ui.update(Le);const zt=a.calculateGlobeMercatorMatrix(Oe),Lt=[a.mercatorXfromLng(Oe.center.lng),a.mercatorYfromLat(Oe.center.lat)],wt=Ne?[!1,!0]:[!1],Dr=re.globeSharedBuffers,Dt=[Oe.width*a.exported.devicePixelRatio,Oe.height*a.exported.devicePixelRatio],ir=Float32Array.from(Oe.globeMatrix),jt={useDenormalizedUpVectorScale:!0};if(wt.forEach(wr=>{De=-1;const Zt=wr?Be.LINES:Be.TRIANGLES;for(const fr of Ee){const kr=pe.getTile(fr),Mt=a.StencilMode.disabled,Ut=te.prevTerrainTileForTile[fr.key],ai=te.terrainTileForTile[fr.key];Oo(Ut,ai)&&Ui.newMorphing(fr.key,Ut,ai,Le,250),Pe.activeTexture.set(Be.TEXTURE0),kr.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE);const wi=Ui.getMorphValuesForProxy(fr.key),si=wi?1:0;wi&&a.extend$1(jt,{morphing:{srcDemTile:wi.from,dstDemTile:wi.to,phase:a.easeCubicInOut(wi.phase)}});const ki=a.tileCornersToBounds(fr.canonical),qi=a.getLatitudinalLod(ki.getCenter().lat),Ei=a.getGridMatrix(fr.canonical,ki,qi,Oe.worldSize/Oe._pixelsPerMercatorPixel),ti=a.globeNormalizeECEF(a.globeTileBounds(fr.canonical)),Tn=Xo(Oe.projMatrix,ir,zt,ti,a.globeToMercatorTransition(Oe.zoom),Lt,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,Dt,Ei);if(ot(si,wr),te.setupElevationDraw(kr,Ce,jt),re.prepareDrawProgram(Pe,Ce,fr.toUnwrapped()),Dr){const[xn,Dn,An]=wr?Dr.getWirefameBuffers(re.context,qi):Dr.getGridBuffers(qi);Ce.draw(Pe,Zt,gt,Mt,it,a.CullFaceMode.backCCW,Tn,"globe_raster",xn,Dn,An)}}}),Dr){const wr=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];qe&&wr.push("CUSTOM_ANTIALIASING"),Ce=re.useProgram("globeRaster",null,wr);for(const Zt of Ee){const{x:fr,y:kr,z:Mt}=Zt.canonical,Ut=kr===0,ai=kr===(1<<Mt)-1,[wi,si,ki,qi]=Dr.getPoleBuffers(Mt);if(qi&&(Ut||ai)){const Ei=pe.getTile(Zt);Pe.activeTexture.set(Be.TEXTURE0),Ei.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE);let ti=a.globePoleMatrixForTile(Mt,fr,Oe);const Tn=a.globeNormalizeECEF(a.globeTileBounds(Zt.canonical)),xn=(Dn,An)=>Dn.draw(Pe,Be.TRIANGLES,gt,a.StencilMode.disabled,it,a.CullFaceMode.disabled,Xo(Oe.projMatrix,ti,ti,Tn,0,Lt,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,Dt),"globe_pole_raster",An,ki,qi);te.setupElevationDraw(Ei,Ce,jt),re.prepareDrawProgram(Pe,Ce,Zt.toUnwrapped()),Ut&&xn(Ce,wi),ai&&(ti=a.scale(a.create(),ti,[1,-1,1]),xn(Ce,si))}}}})(S,I,O,j,G);else{const re=S.context,te=re.gl;let pe,Ee;const Le=S.options.showTerrainWireframe?2:0,Pe=(Oe,qe)=>{if(Ee===Oe)return;const ot=[na[Oe]];qe&&ot.push(na[Le]),pe=S.useProgram("terrainRaster",null,ot),Ee=Oe},Be=S.colorModeForRenderPass(),Ce=new a.DepthMode(te.LEQUAL,a.DepthMode.ReadWrite,S.depthRangeFor3D);Ui.update(G);const De=S.transform,Ne=6*Math.pow(1.5,22-De.zoom)*I.exaggeration();(Le?[!1,!0]:[!1]).forEach(Oe=>{Ee=-1;const qe=Oe?te.LINES:te.TRIANGLES,[ot,it]=Oe?I.getWirefameBuffer():[I.gridIndexBuffer,I.gridSegments];for(const gt of j){const zt=O.getTile(gt),Lt=a.StencilMode.disabled,wt=I.prevTerrainTileForTile[gt.key],Dr=I.terrainTileForTile[gt.key];Oo(wt,Dr)&&Ui.newMorphing(gt.key,wt,Dr,G,250),re.activeTexture.set(te.TEXTURE0),zt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST);const Dt=Ui.getMorphValuesForProxy(gt.key),ir=Dt?1:0;let jt;Dt&&(jt={morphing:{srcDemTile:Dt.from,dstDemTile:Dt.to,phase:a.easeCubicInOut(Dt.phase)}});const wr=lo(gt.projMatrix,go(gt.canonical,De.renderWorldCopies)?Ne/10:Ne);Pe(ir,Oe),I.setupElevationDraw(zt,pe,jt),S.prepareDrawProgram(re,pe,gt.toUnwrapped()),pe.draw(re,qe,Ce,Lt,Be,a.CullFaceMode.backCCW,wr,"terrain_raster",I.gridBuffer,ot,it)}})}}(p,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const p=this.painter,x=this.painter.context,S=this.proxySourceCache,I=this.proxiedCoords[S.id],O=this._drapedRenderBatches.shift(),j=[],G=p.style.order;let re=0;for(const te of I){const pe=S.getTileByID(te.proxyTileKey),Ee=S.proxyCachedFBO[te.key]?S.proxyCachedFBO[te.key][c]:void 0,Le=Ee!==void 0?S.renderCache[Ee]:this.pool[re++],Pe=Ee!==void 0;if(pe.texture=Le.tex,Pe&&!Le.dirty){j.push(pe.tileID);continue}let Be;x.bindFramebuffer.set(Le.fb.framebuffer),this.renderedToTile=!1,Le.dirty&&(x.clear({color:a.Color.transparent,stencil:0}),Le.dirty=!1);for(let Ce=O.start;Ce<=O.end;++Ce){const De=p.style._layers[G[Ce]];if(De.isHidden(p.transform.zoom))continue;const Ne=p.style._getLayerSourceCache(De),Oe=Ne?this.proxyToSource[te.key][Ne.id]:[te];if(!Oe)continue;const qe=Oe;x.viewport.set([0,0,Le.fb.width,Le.fb.height]),Be!==(Ne?Ne.id:null)&&(this._setupStencil(Le,Oe,De,Ne),Be=Ne?Ne.id:null),p.renderLayer(p,Ne,De,qe)}this.renderedToTile?(Le.dirty=!0,j.push(pe.tileID)):Pe||--re,re===5&&(re=0,this.renderToBackBuffer(j))}return this.renderToBackBuffer(j),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height]),O.end+1}postRender(){}renderCacheEfficiency(c){const p=c.order.length;if(p===0)return{efficiency:100};let x,S=0,I=0,O=!1;for(let j=0;j<p;++j){const G=c._layers[c.order[j]];this._style.isLayerDraped(G)?(O&&++S,++I):O||(O=!0,x=G.id)}return I===0?{efficiency:100}:{efficiency:100*(1-S/I),firstUndrapedLayer:x}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{c=Math.min(c,p.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,p,x){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter(I=>I.dem).map(I=>{const O=I.tileID,j=1<<O.overscaledZ,{x:G,y:re}=O.canonical,te=G/j,pe=(G+1)/j,Ee=re/j,Le=(re+1)/j;return{minx:te,miny:Ee,maxx:pe,maxy:Le,t:I.dem.tree.raycastRoot(te,Ee,pe,Le,c,p,x),tile:I}});S.sort((I,O)=>(I.t!==null?I.t:Number.MAX_VALUE)-(O.t!==null?O.t:Number.MAX_VALUE));for(const I of S){if(I.t==null)return null;const O=I.tile.dem.tree.raycast(I.minx,I.miny,I.maxx,I.maxy,c,p,x);if(O!=null)return O}return null}_createFBO(){const c=this.painter.context,p=c.gl,x=this.drapeBufferSize;c.activeTexture.set(p.TEXTURE0);const S=new a.Texture(c,{width:x[0],height:x[1],data:null},p.RGBA);S.bind(p.LINEAR,p.CLAMP_TO_EDGE);const I=c.createFramebuffer(x[0],x[1],!1);return I.colorAttachment.set(S.texture),I.depthAttachment=new Bt(c,I.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,I.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):I.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:I,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const p=this._style._layers[c],x=p.isHidden(this.painter.transform.zoom);return p.type!=="custom"&&!x&&p.hasTransition()})}_clearRasterFadeFromRenderCache(){let c=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof fe){c=!0;break}if(c)for(let p=0;p<this._style.order.length;++p){const x=this._style._layers[this._style.order[p]],S=x.isHidden(this.painter.transform.zoom),I=this._style._getLayerSourceCache(x);if(x.type!=="raster"||S||!I)continue;const O=x.paint.get("raster-fade-duration");for(const j of this.proxyCoords){const G=this.proxyToSource[j.key][I.id];if(G)for(const re of G){const te=Zo(I.getTile(re),I.findLoadedParent(re,0),I,this.painter.transform,O);(te.opacity!==1||te.mix!==0)&&this._clearRenderCacheForTile(I.id,re)}}}}_setupDrapedRenderBatches(){const c=this._style.order,p=c.length;if(p===0)return;const x=[];let S,I=0,O=this._style._layers[c[I]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++I<p;)O=this._style._layers[c[I]];for(;I<p;++I){const j=this._style._layers[c[I]];j.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(j)?S===void 0&&(S=I):S!==void 0&&(x.push({start:S,end:I-1}),S=void 0))}S!==void 0&&x.push({start:S,end:I-1}),this._drapedRenderBatches=x}_setupRenderCache(c){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const O=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let j=0;j<O.length;++j){const G=Object.values(O[j]);p.renderCachePool.push(...G)}}return}this._clearRasterFadeFromRenderCache();const x=this.proxyCoords,S=this._tilesDirty;for(let O=x.length-1;O>=0;O--){const j=x[O];if(p.getTileByID(j.key),p.proxyCachedFBO[j.key]!==void 0){const G=c[j.key],re=this.proxyToSource[j.key];let te=0;for(const pe in re){const Ee=re[pe],Le=G[pe];if(!Le||Le.length!==Ee.length||Ee.some((Pe,Be)=>Pe!==Le[Be]||S[pe]&&S[pe].hasOwnProperty(Pe.key))){te=-1;break}++te}for(const pe in p.proxyCachedFBO[j.key])p.renderCache[p.proxyCachedFBO[j.key][pe]].dirty=te<0||te!==Object.values(G).length}}const I=[...this._drapedRenderBatches];I.sort((O,j)=>j.end-j.start-(O.end-O.start));for(const O of I)for(const j of x){if(p.proxyCachedFBO[j.key])continue;let G=p.renderCachePool.pop();G===void 0&&p.renderCache.length<50&&(G=p.renderCache.length,p.renderCache.push(this._createFBO())),G!==void 0&&(p.proxyCachedFBO[j.key]={},p.proxyCachedFBO[j.key][O.start]=G,p.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(c,p,x,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const I=this.painter.context,O=I.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let j;if(x.isTileClipped())j=p.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);j=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+j>255&&(I.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=j,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(c,p){const x=this.painter,S=this.painter.context,I=S.gl;x._tileClippingMaskIDs={},S.setColorMode(a.ColorMode.disabled),S.setDepthMode(a.DepthMode.disabled);const O=x.useProgram("clippingMask");for(const j of c){const G=x._tileClippingMaskIDs[j.key]=--p;O.draw(S,I.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:I.ALWAYS,mask:0},G,255,I.KEEP,I.KEEP,I.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ga(j.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(c){const p=this.painter.transform;if(c.x<0||c.x>p.width||c.y<0||c.y>p.height)return null;const x=[c.x,c.y,1,1];a.transformMat4$1(x,x,p.pixelMatrixInverse),a.scale$1(x,x,1/x[3]),x[0]/=p.worldSize,x[1]/=p.worldSize;const S=p._camera.position,I=a.mercatorZfromAltitude(1,p.center.lat),O=[S[0],S[1],S[2]/I,0],j=a.subtract([],x.slice(0,3),O);a.normalize(j,j);const G=this.raycast(O,j,this._exaggeration);return G!==null&&G?(a.scaleAndAdd(O,O,j,G),O[3]=O[2],O[2]*=I,O):null}drawDepth(){const c=this.painter,p=c.context,x=this.proxySourceCache,S=Math.ceil(c.width),I=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===I||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=p.gl,j=p.createFramebuffer(S,I,!0);p.activeTexture.set(O.TEXTURE0);const G=new a.Texture(p,{width:S,height:I,data:null},O.RGBA);G.bind(O.NEAREST,O.CLAMP_TO_EDGE),j.colorAttachment.set(G.texture);const re=p.createRenderbuffer(p.gl.DEPTH_COMPONENT16,S,I);j.depthAttachment.set(re),this._depthFBO=j,this._depthTexture=G}p.bindFramebuffer.set(this._depthFBO.framebuffer),p.viewport.set([0,0,S,I]),function(O,j,G,re){if(O.transform.projection.name==="globe")return;const te=O.context,pe=te.gl;te.clear({depth:1});const Ee=O.useProgram("terrainDepth"),Le=new a.DepthMode(pe.LESS,a.DepthMode.ReadWrite,O.depthRangeFor3D);for(const Pe of re){const Be=G.getTile(Pe),Ce=lo(Pe.projMatrix,0);j.setupElevationDraw(Be,Ee),Ee.draw(te,pe.TRIANGLES,Le,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,Ce,"terrain_depth",j.gridBuffer,j.gridIndexBuffer,j.gridNoSkirtSegments)}}(c,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,p,x){if(c.getSource()instanceof Ye)return this._setupProxiedCoordsForImageSource(c,p,x);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const S=this.proxiedCoords[c.id]=[],I=this.proxyCoords;for(let j=0;j<I.length;j++){const G=I[j],re=this._findTileCoveringTileID(G,c);if(re){const te=this._createProxiedId(G,re,x[G.key]&&x[G.key][c.id]);S.push(te),this.proxyToSource[G.key][c.id]=[te]}}let O=!1;for(let j=0;j<p.length;j++){const G=c.getTile(p[j]);if(!G||!G.hasData())continue;const re=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(re&&re.tileID.canonical.z!==G.tileID.canonical.z){const te=this.proxyToSource[re.tileID.key][c.id],pe=this._createProxiedId(re.tileID,G,x[re.tileID.key]&&x[re.tileID.key][c.id]);te?te.splice(te.length-1,0,pe):this.proxyToSource[re.tileID.key][c.id]=[pe],S.push(pe),O=!0}}this._sourceTilesOverlap[c.id]=O}_setupProxiedCoordsForImageSource(c,p,x){if(!c.getSource().loaded())return;const S=this.proxiedCoords[c.id]=[],I=this.proxyCoords,O=c.getSource(),j=new a.pointGeometry(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),G=O.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((te,pe)=>(te.min.x=Math.min(te.min.x,pe.x-j.x),te.min.y=Math.min(te.min.y,pe.y-j.y),te.max.x=Math.max(te.max.x,pe.x-j.x),te.max.y=Math.max(te.max.y,pe.y-j.y),te),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),re=(te,pe)=>{const Ee=te.wrap+te.canonical.x/(1<<te.canonical.z),Le=te.canonical.y/(1<<te.canonical.z),Pe=a.EXTENT/(1<<te.canonical.z),Be=pe.wrap+pe.canonical.x/(1<<pe.canonical.z),Ce=pe.canonical.y/(1<<pe.canonical.z);return Ee+Pe<Be+G.min.x||Ee>Be+G.max.x||Le+Pe<Ce+G.min.y||Le>Ce+G.max.y};for(let te=0;te<I.length;te++){const pe=I[te];for(let Ee=0;Ee<p.length;Ee++){const Le=c.getTile(p[Ee]);if(!Le||!Le.hasData()||re(pe,Le.tileID))continue;const Pe=this._createProxiedId(pe,Le,x[pe.key]&&x[pe.key][c.id]),Be=this.proxyToSource[pe.key][c.id];Be?Be.push(Pe):this.proxyToSource[pe.key][c.id]=[Pe],S.push(Pe)}}}_createProxiedId(c,p,x){let S=this.orthoMatrix;if(x){const I=x.find(O=>O.key===p.tileID.key);if(I)return I}if(p.tileID.key!==c.key){const I=c.canonical.z-p.tileID.canonical.z;let O,j,G;S=a.create();const re=p.tileID.wrap-c.wrap<<c.overscaledZ;I>0?(O=a.EXTENT>>I,j=O*((p.tileID.canonical.x<<I)-c.canonical.x+re),G=O*((p.tileID.canonical.y<<I)-c.canonical.y)):(O=a.EXTENT<<-I,j=a.EXTENT*(p.tileID.canonical.x-(c.canonical.x+re<<-I)),G=a.EXTENT*(p.tileID.canonical.y-(c.canonical.y<<-I))),a.ortho(S,0,O,0,O,0,1),a.translate(S,S,[j,G,0])}return new cs(p.tileID,c.key,S)}_findTileCoveringTileID(c,p){let x=p.getTile(c);if(x&&x.hasData())return x;const S=this._findCoveringTileCache[p.id],I=S[c.key];if(x=I?p.getTileByID(I):null,x&&x.hasData()||I===null)return x;let O=x?x.tileID:c,j=O.overscaledZ;const G=p.getSource().minzoom,re=[];if(!I){const pe=p.getSource().maxzoom;if(c.canonical.z>=pe){const Ee=c.canonical.z-pe;p.getSource().reparseOverscaled?(j=Math.max(c.canonical.z+2,p.transform.tileZoom),O=new a.OverscaledTileID(j,c.wrap,pe,c.canonical.x>>Ee,c.canonical.y>>Ee)):Ee!==0&&(j=pe,O=new a.OverscaledTileID(j,c.wrap,pe,c.canonical.x>>Ee,c.canonical.y>>Ee))}O.key!==c.key&&(re.push(O.key),x=p.getTile(O))}const te=pe=>{re.forEach(Ee=>{S[Ee]=pe}),re.length=0};for(j-=1;j>=G&&(!x||!x.hasData());j--){x&&te(x.tileID.key);const pe=O.calculateScaledKey(j);if(x=p.getTileByID(pe),x&&x.hasData())break;const Ee=S[pe];if(Ee===null)break;Ee===void 0?re.push(pe):x=p.getTileByID(Ee)}return te(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,p){let x=this._tilesDirty[c];x||(x=this._tilesDirty[c]={}),x[p.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(p){let x=0;const S=new a.StructArrayLayout2ui4,I=131;for(let O=1;O<129;O++){for(let j=1;j<129;j++)x=O*I+j,S.emplaceBack(x,x+1),S.emplaceBack(x,x+I),S.emplaceBack(x+1,x+I),O===128&&S.emplaceBack(x+I,x+I+1);S.emplaceBack(x+1,x+1+I)}return S}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ln{static cacheKey(c,p,x,S){let I=`${p}${S?S.cacheKey:""}`;for(const O of x)c.usedDefines.includes(O)&&(I+=`/${O}`);return I}constructor(c,p,x,S,I,O){const j=c.gl;this.program=j.createProgram();const G=function(Ce){const De=[];for(let Ne=0;Ne<Ce.length;Ne++){if(Ce[Ne]===null)continue;const Oe=Ce[Ne].split(" ");De.push(Oe.pop())}return De}(x.staticAttributes),re=S?S.getBinderAttributes():[],te=G.concat(re);let pe=S?S.defines():[];pe=pe.concat(O.map(Ce=>`#define ${Ce}`));const Ee=pe.concat(c.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(ia):ia,ia,so,ma.fragmentSource,Bo.fragmentSource,x.fragmentSource).join(`
`),Le=pe.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,so,ma.vertexSource,Bo.vertexSource,ta.vertexSource,x.vertexSource).join(`
`),Pe=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);j.shaderSource(Pe,Ee),j.compileShader(Pe),j.attachShader(this.program,Pe);const Be=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())this.failedToCreate=!0;else{j.shaderSource(Be,Le),j.compileShader(Be),j.attachShader(this.program,Be),this.attributes={},this.numAttributes=te.length;for(let Ce=0;Ce<this.numAttributes;Ce++)te[Ce]&&(j.bindAttribLocation(this.program,Ce,te[Ce]),this.attributes[te[Ce]]=Ce);j.linkProgram(this.program),j.deleteShader(Be),j.deleteShader(Pe),this.fixedUniforms=I(c),this.binderUniforms=S?S.getUniforms(c):[],O.includes("TERRAIN")&&(this.terrainUniforms=(Ce=>({u_dem:new a.Uniform1i(Ce),u_dem_prev:new a.Uniform1i(Ce),u_dem_unpack:new a.Uniform4f(Ce),u_dem_tl:new a.Uniform2f(Ce),u_dem_scale:new a.Uniform1f(Ce),u_dem_tl_prev:new a.Uniform2f(Ce),u_dem_scale_prev:new a.Uniform1f(Ce),u_dem_size:new a.Uniform1f(Ce),u_dem_lerp:new a.Uniform1f(Ce),u_exaggeration:new a.Uniform1f(Ce),u_depth:new a.Uniform1i(Ce),u_depth_size_inv:new a.Uniform2f(Ce),u_meter_to_dem:new a.Uniform1f(Ce),u_label_plane_matrix_inv:new a.UniformMatrix4f(Ce)}))(c)),O.includes("GLOBE")&&(this.globeUniforms=(Ce=>({u_tile_tl_up:new a.Uniform3f(Ce),u_tile_tr_up:new a.Uniform3f(Ce),u_tile_br_up:new a.Uniform3f(Ce),u_tile_bl_up:new a.Uniform3f(Ce),u_tile_up_scale:new a.Uniform1f(Ce)}))(c)),O.includes("FOG")&&(this.fogUniforms=(Ce=>({u_fog_matrix:new a.UniformMatrix4f(Ce),u_fog_range:new a.Uniform2f(Ce),u_fog_color:new a.Uniform4f(Ce),u_fog_horizon_blend:new a.Uniform1f(Ce),u_fog_temporal_offset:new a.Uniform1f(Ce),u_frustum_tl:new a.Uniform3f(Ce),u_frustum_tr:new a.Uniform3f(Ce),u_frustum_br:new a.Uniform3f(Ce),u_frustum_bl:new a.Uniform3f(Ce),u_globe_pos:new a.Uniform3f(Ce),u_globe_radius:new a.Uniform1f(Ce),u_globe_transition:new a.Uniform1f(Ce),u_is_globe:new a.Uniform1i(Ce),u_viewport:new a.Uniform2f(Ce)}))(c))}}setTerrainUniformValues(c,p){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const S in p)x[S]&&x[S].set(this.program,S,p[S])}}setGlobeUniformValues(c,p){if(!this.globeUniforms)return;const x=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const S in p)x[S]&&x[S].set(this.program,S,p[S])}}setFogUniformValues(c,p){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const S in p)x[S].set(this.program,S,p[S])}}draw(c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be){const Ce=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(x),c.setStencilMode(S),c.setColorMode(I),c.setCullFace(O);for(const Ne of Object.keys(this.fixedUniforms))this.fixedUniforms[Ne].set(this.program,Ne,j[Ne]);Pe&&Pe.setUniforms(this.program,c,this.binderUniforms,Ee,{zoom:Le});const De={[Ce.LINES]:2,[Ce.TRIANGLES]:3,[Ce.LINE_STRIP]:1}[p];for(const Ne of pe.get()){const Oe=Ne.vaos||(Ne.vaos={});(Oe[G]||(Oe[G]=new Ds)).bind(c,this,re,Pe?Pe.getPaintVertexBuffers():[],te,Ne.vertexOffset,Be||[]),Ce.drawElements(p,Ne.primitiveLength*De,Ce.UNSIGNED_SHORT,Ne.primitiveOffset*De*2)}}}function ie(_,c){const p=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,_.transform.tileZoom)/p,S=x*(c.tileID.canonical.x+c.tileID.wrap*p),I=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/er(c,1,_.transform.tileZoom),u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}const Ri=a.create(),Fo=(_,c,p,x,S,I,O,j,G,re,te)=>{const pe=c.style.light,Ee=pe.properties.get("position"),Le=[Ee.x,Ee.y,Ee.z],Pe=a.create$1();pe.properties.get("anchor")==="viewport"&&(a.fromRotation(Pe,-c.transform.angle),a.transformMat3(Le,Le,Pe));const Be=pe.properties.get("color"),Ce=c.transform,De={u_matrix:_,u_lightpos:Le,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Be.r,Be.g,Be.b],u_vertical_gradient:+p,u_opacity:x,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ri,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:I};return Ce.projection.name==="globe"&&(De.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],De.u_zoom_transition=G,De.u_inv_rot_matrix=te,De.u_merc_center=re,De.u_up_dir=Ce.projection.upVector(new a.CanonicalTileID(0,0,0),re[0]*a.EXTENT,re[1]*a.EXTENT),De.u_height_lift=j),De},Vn=(_,c,p,x,S,I,O,j,G,re,te,pe)=>{const Ee=Fo(_,c,p,x,S,I,O,G,re,te,pe),Le={u_height_factor:-Math.pow(2,O.overscaledZ)/j.tileSize/8};return a.extend(Ee,ie(c,j),Le)},Ho=_=>({u_matrix:_}),Xa=(_,c,p)=>a.extend(Ho(_),ie(c,p)),us=(_,c)=>({u_matrix:_,u_world:c}),La=(_,c,p,x)=>a.extend(Xa(_,c,p),{u_world:x}),Ra=a.create(),Za=(_,c,p,x,S,I)=>{const O=_.transform,j=O.projection.name==="globe";let G;if(I.paint.get("circle-pitch-alignment")==="map")if(j){const te=a.globePixelsToTileUnits(O.zoom,c.canonical)*O._pixelsPerMercatorPixel;G=Float32Array.from([te,0,0,te])}else G=O.calculatePixelsToTileUnitsMatrix(p);else G=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const re={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:_.translatePosMatrix(c.projMatrix,p,I.paint.get("circle-translate"),I.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:Ra,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){re.u_inv_rot_matrix=x,re.u_merc_center=S,re.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],re.u_zoom_transition=a.globeToMercatorTransition(O.zoom);const te=S[0]*a.EXTENT,pe=S[1]*a.EXTENT;re.u_up_dir=O.projection.upVector(new a.CanonicalTileID(0,0,0),te,pe)}return re},Ha=_=>{const c=[];return _.paint.get("circle-pitch-alignment")==="map"&&c.push("PITCH_WITH_MAP"),_.paint.get("circle-pitch-scale")==="map"&&c.push("SCALE_WITH_MAP"),c},Wa=(_,c,p,x)=>{const S=a.EXTENT/p.tileSize;return{u_matrix:_,u_camera_to_center_distance:c.getCameraToCenterDistance(x),u_extrude_scale:[c.pixelsToGLUnits[0]/S,c.pixelsToGLUnits[1]/S]}},Ao=(_,c,p=1)=>({u_matrix:_,u_color:c,u_overlay:0,u_overlay_scale:p}),Ya=a.create(),hs=(_,c,p,x,S,I,O)=>{const j=_.transform,G=j.projection.name==="globe",re=G?a.globePixelsToTileUnits(j.zoom,c.canonical)*j._pixelsPerMercatorPixel:er(p,1,I),te={u_matrix:c.projMatrix,u_extrude_scale:re,u_intensity:O,u_inv_rot_matrix:Ya,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){te.u_inv_rot_matrix=x,te.u_merc_center=S,te.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],te.u_zoom_transition=a.globeToMercatorTransition(j.zoom);const pe=S[0]*a.EXTENT,Ee=S[1]*a.EXTENT;te.u_up_dir=j.projection.upVector(new a.CanonicalTileID(0,0,0),pe,Ee)}return te},Tt=(_,c,p,x,S,I,O)=>{const j=_.transform,G=j.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:Si(_,c,p,x),u_pixels_to_tile_units:G,u_device_pixel_ratio:I,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:fn(p)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qr(c,_.transform),u_alpha_discard_threshold:0,u_trim_offset:O}},Wt=(_,c,p,x,S)=>{const I=_.transform;return{u_matrix:Si(_,c,p,x),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:qr(c,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qr(_,c){return 1/er(_,1,c.tileZoom)}function Si(_,c,p,x){return _.translatePosMatrix(x||c.tileID.projMatrix,c,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}function fn(_){const c=_.paint.get("line-dasharray").value;return c.value||c.kind!=="constant"}const tn=(_,c,p,x,S,I)=>{return{u_matrix:_,u_tl_parent:c,u_scale_parent:p,u_fade_t:x.mix,u_opacity:x.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(j=S.paint.get("raster-saturation"),j>0?1-1/(1.001-j):-j),u_contrast_factor:(O=S.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:Rn(S.paint.get("raster-hue-rotate")),u_perspective_transform:I};var O,j};function Rn(_){_*=Math.PI/180;const c=Math.sin(_),p=Math.cos(_);return[(2*p+1)/3,(-Math.sqrt(3)*c-p+1)/3,(Math.sqrt(3)*c-p+1)/3]}const qn=a.create(),bo=(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be)=>{const Ce=S.transform,De={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_rotate_symbol:+p,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:O,u_coord_matrix:j,u_is_text:+G,u_pitch_with_map:+x,u_texsize:re,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:qn,u_up_vector:[0,-1,0]};return Be.name==="globe"&&(De.u_tile_id=[te.canonical.x,te.canonical.y,1<<te.canonical.z],De.u_zoom_transition=pe,De.u_inv_rot_matrix=Le,De.u_merc_center=Ee,De.u_camera_forward=Ce._camera.forward(),De.u_ecef_origin=a.globeECEFOrigin(Ce.globeMatrix,te.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Ce.globeMatrix),De.u_up_vector=Pe),De},Wn=(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be,Ce)=>a.extend(bo(_,c,p,x,S,I,O,j,G,re,pe,Ee,Le,Pe,Be,Ce),{u_gamma_scale:x?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+te}),Bn=(_,c,p,x,S,I,O,j,G,re,te,pe,Ee,Le,Pe,Be)=>a.extend(Wn(_,c,p,x,S,I,O,j,!0,G,!0,te,pe,Ee,Le,Pe,Be),{u_texsize_icon:re,u_texture_icon:1}),oa=(_,c,p)=>({u_matrix:_,u_opacity:c,u_color:p}),zo=(_,c,p,x,S)=>a.extend(function(I,O,j){const G=O.imageManager.getPattern(I.toString()),{width:re,height:te}=O.imageManager.getPixelSize(),pe=Math.pow(2,j.tileID.overscaledZ),Ee=j.tileSize*Math.pow(2,O.transform.tileZoom)/pe,Le=Ee*(j.tileID.canonical.x+j.tileID.wrap*pe),Pe=Ee*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[re,te],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/er(j,1,O.transform.tileZoom),u_pixel_coord_upper:[Le>>16,Pe>>16],u_pixel_coord_lower:[65535&Le,65535&Pe]}}(x,p,S),{u_matrix:_,u_opacity:c}),co={fillExtrusion:_=>({u_matrix:new a.UniformMatrix4f(_),u_lightpos:new a.Uniform3f(_),u_lightintensity:new a.Uniform1f(_),u_lightcolor:new a.Uniform3f(_),u_vertical_gradient:new a.Uniform1f(_),u_opacity:new a.Uniform1f(_),u_edge_radius:new a.Uniform1f(_),u_ao:new a.Uniform2f(_),u_tile_id:new a.Uniform3f(_),u_zoom_transition:new a.Uniform1f(_),u_inv_rot_matrix:new a.UniformMatrix4f(_),u_merc_center:new a.Uniform2f(_),u_up_dir:new a.Uniform3f(_),u_height_lift:new a.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new a.UniformMatrix4f(_),u_lightpos:new a.Uniform3f(_),u_lightintensity:new a.Uniform1f(_),u_lightcolor:new a.Uniform3f(_),u_vertical_gradient:new a.Uniform1f(_),u_height_factor:new a.Uniform1f(_),u_edge_radius:new a.Uniform1f(_),u_ao:new a.Uniform2f(_),u_tile_id:new a.Uniform3f(_),u_zoom_transition:new a.Uniform1f(_),u_inv_rot_matrix:new a.UniformMatrix4f(_),u_merc_center:new a.Uniform2f(_),u_up_dir:new a.Uniform3f(_),u_height_lift:new a.Uniform1f(_),u_image:new a.Uniform1i(_),u_texsize:new a.Uniform2f(_),u_pixel_coord_upper:new a.Uniform2f(_),u_pixel_coord_lower:new a.Uniform2f(_),u_tile_units_to_pixels:new a.Uniform1f(_),u_opacity:new a.Uniform1f(_)}),fill:_=>({u_matrix:new a.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new a.UniformMatrix4f(_),u_image:new a.Uniform1i(_),u_texsize:new a.Uniform2f(_),u_pixel_coord_upper:new a.Uniform2f(_),u_pixel_coord_lower:new a.Uniform2f(_),u_tile_units_to_pixels:new a.Uniform1f(_)}),fillOutline:_=>({u_matrix:new a.UniformMatrix4f(_),u_world:new a.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new a.UniformMatrix4f(_),u_world:new a.Uniform2f(_),u_image:new a.Uniform1i(_),u_texsize:new a.Uniform2f(_),u_pixel_coord_upper:new a.Uniform2f(_),u_pixel_coord_lower:new a.Uniform2f(_),u_tile_units_to_pixels:new a.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new a.Uniform1f(_),u_extrude_scale:new a.UniformMatrix2f(_),u_device_pixel_ratio:new a.Uniform1f(_),u_matrix:new a.UniformMatrix4f(_),u_inv_rot_matrix:new a.UniformMatrix4f(_),u_merc_center:new a.Uniform2f(_),u_tile_id:new a.Uniform3f(_),u_zoom_transition:new a.Uniform1f(_),u_up_dir:new a.Uniform3f(_)}),collisionBox:_=>({u_matrix:new a.UniformMatrix4f(_),u_camera_to_center_distance:new a.Uniform1f(_),u_extrude_scale:new a.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new a.UniformMatrix4f(_),u_inv_matrix:new a.UniformMatrix4f(_),u_camera_to_center_distance:new a.Uniform1f(_),u_viewport_size:new a.Uniform2f(_)}),debug:_=>({u_color:new a.UniformColor(_),u_matrix:new a.UniformMatrix4f(_),u_overlay:new a.Uniform1i(_),u_overlay_scale:new a.Uniform1f(_)}),clippingMask:_=>({u_matrix:new a.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new a.Uniform1f(_),u_intensity:new a.Uniform1f(_),u_matrix:new a.UniformMatrix4f(_),u_inv_rot_matrix:new a.UniformMatrix4f(_),u_merc_center:new a.Uniform2f(_),u_tile_id:new a.Uniform3f(_),u_zoom_transition:new a.Uniform1f(_),u_up_dir:new a.Uniform3f(_)}),heatmapTexture:_=>({u_image:new a.Uniform1i(_),u_color_ramp:new a.Uniform1i(_),u_opacity:new a.Uniform1f(_)}),hillshade:_=>({u_matrix:new a.UniformMatrix4f(_),u_image:new a.Uniform1i(_),u_latrange:new a.Uniform2f(_),u_light:new a.Uniform2f(_),u_shadow:new a.UniformColor(_),u_highlight:new a.UniformColor(_),u_accent:new a.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new a.UniformMatrix4f(_),u_image:new a.Uniform1i(_),u_dimension:new a.Uniform2f(_),u_zoom:new a.Uniform1f(_),u_unpack:new a.Uniform4f(_)}),line:_=>({u_matrix:new a.UniformMatrix4f(_),u_pixels_to_tile_units:new a.UniformMatrix2f(_),u_device_pixel_ratio:new a.Uniform1f(_),u_units_to_pixels:new a.Uniform2f(_),u_dash_image:new a.Uniform1i(_),u_gradient_image:new a.Uniform1i(_),u_image_height:new a.Uniform1f(_),u_texsize:new a.Uniform2f(_),u_tile_units_to_pixels:new a.Uniform1f(_),u_alpha_discard_threshold:new a.Uniform1f(_),u_trim_offset:new a.Uniform2f(_)}),linePattern:_=>({u_matrix:new a.UniformMatrix4f(_),u_texsize:new a.Uniform2f(_),u_pixels_to_tile_units:new a.UniformMatrix2f(_),u_device_pixel_ratio:new a.Uniform1f(_),u_image:new a.Uniform1i(_),u_units_to_pixels:new a.Uniform2f(_),u_tile_units_to_pixels:new a.Uniform1f(_),u_alpha_discard_threshold:new a.Uniform1f(_)}),raster:_=>({u_matrix:new a.UniformMatrix4f(_),u_tl_parent:new a.Uniform2f(_),u_scale_parent:new a.Uniform1f(_),u_fade_t:new a.Uniform1f(_),u_opacity:new a.Uniform1f(_),u_image0:new a.Uniform1i(_),u_image1:new a.Uniform1i(_),u_brightness_low:new a.Uniform1f(_),u_brightness_high:new a.Uniform1f(_),u_saturation_factor:new a.Uniform1f(_),u_contrast_factor:new a.Uniform1f(_),u_spin_weights:new a.Uniform3f(_),u_perspective_transform:new a.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new a.Uniform1i(_),u_is_size_feature_constant:new a.Uniform1i(_),u_size_t:new a.Uniform1f(_),u_size:new a.Uniform1f(_),u_camera_to_center_distance:new a.Uniform1f(_),u_rotate_symbol:new a.Uniform1i(_),u_aspect_ratio:new a.Uniform1f(_),u_fade_change:new a.Uniform1f(_),u_matrix:new a.UniformMatrix4f(_),u_label_plane_matrix:new a.UniformMatrix4f(_),u_coord_matrix:new a.UniformMatrix4f(_),u_is_text:new a.Uniform1i(_),u_pitch_with_map:new a.Uniform1i(_),u_texsize:new a.Uniform2f(_),u_tile_id:new a.Uniform3f(_),u_zoom_transition:new a.Uniform1f(_),u_inv_rot_matrix:new a.UniformMatrix4f(_),u_merc_center:new a.Uniform2f(_),u_camera_forward:new a.Uniform3f(_),u_tile_matrix:new a.UniformMatrix4f(_),u_up_vector:new a.Uniform3f(_),u_ecef_origin:new a.Uniform3f(_),u_texture:new a.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new a.Uniform1i(_),u_is_size_feature_constant:new a.Uniform1i(_),u_size_t:new a.Uniform1f(_),u_size:new a.Uniform1f(_),u_camera_to_center_distance:new a.Uniform1f(_),u_rotate_symbol:new a.Uniform1i(_),u_aspect_ratio:new a.Uniform1f(_),u_fade_change:new a.Uniform1f(_),u_matrix:new a.UniformMatrix4f(_),u_label_plane_matrix:new a.UniformMatrix4f(_),u_coord_matrix:new a.UniformMatrix4f(_),u_is_text:new a.Uniform1i(_),u_pitch_with_map:new a.Uniform1i(_),u_texsize:new a.Uniform2f(_),u_texture:new a.Uniform1i(_),u_gamma_scale:new a.Uniform1f(_),u_device_pixel_ratio:new a.Uniform1f(_),u_tile_id:new a.Uniform3f(_),u_zoom_transition:new a.Uniform1f(_),u_inv_rot_matrix:new a.UniformMatrix4f(_),u_merc_center:new a.Uniform2f(_),u_camera_forward:new a.Uniform3f(_),u_tile_matrix:new a.UniformMatrix4f(_),u_up_vector:new a.Uniform3f(_),u_ecef_origin:new a.Uniform3f(_),u_is_halo:new a.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new a.Uniform1i(_),u_is_size_feature_constant:new a.Uniform1i(_),u_size_t:new a.Uniform1f(_),u_size:new a.Uniform1f(_),u_camera_to_center_distance:new a.Uniform1f(_),u_rotate_symbol:new a.Uniform1i(_),u_aspect_ratio:new a.Uniform1f(_),u_fade_change:new a.Uniform1f(_),u_matrix:new a.UniformMatrix4f(_),u_label_plane_matrix:new a.UniformMatrix4f(_),u_coord_matrix:new a.UniformMatrix4f(_),u_is_text:new a.Uniform1i(_),u_pitch_with_map:new a.Uniform1i(_),u_texsize:new a.Uniform2f(_),u_texsize_icon:new a.Uniform2f(_),u_texture:new a.Uniform1i(_),u_texture_icon:new a.Uniform1i(_),u_gamma_scale:new a.Uniform1f(_),u_device_pixel_ratio:new a.Uniform1f(_),u_is_halo:new a.Uniform1i(_)}),background:_=>({u_matrix:new a.UniformMatrix4f(_),u_opacity:new a.Uniform1f(_),u_color:new a.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new a.UniformMatrix4f(_),u_opacity:new a.Uniform1f(_),u_image:new a.Uniform1i(_),u_pattern_tl:new a.Uniform2f(_),u_pattern_br:new a.Uniform2f(_),u_texsize:new a.Uniform2f(_),u_pattern_size:new a.Uniform2f(_),u_pixel_coord_upper:new a.Uniform2f(_),u_pixel_coord_lower:new a.Uniform2f(_),u_tile_units_to_pixels:new a.Uniform1f(_)}),terrainRaster:mo,terrainDepth:mo,skybox:_=>({u_matrix:new a.UniformMatrix4f(_),u_sun_direction:new a.Uniform3f(_),u_cubemap:new a.Uniform1i(_),u_opacity:new a.Uniform1f(_),u_temporal_offset:new a.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new a.UniformMatrix4f(_),u_color_ramp:new a.Uniform1i(_),u_center_direction:new a.Uniform3f(_),u_radius:new a.Uniform1f(_),u_opacity:new a.Uniform1f(_),u_temporal_offset:new a.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new a.UniformMatrix3f(_),u_sun_direction:new a.Uniform3f(_),u_sun_intensity:new a.Uniform1f(_),u_color_tint_r:new a.Uniform4f(_),u_color_tint_m:new a.Uniform4f(_),u_luminance:new a.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new a.UniformMatrix4f(_),u_globe_matrix:new a.UniformMatrix4f(_),u_normalize_matrix:new a.UniformMatrix4f(_),u_merc_matrix:new a.UniformMatrix4f(_),u_zoom_transition:new a.Uniform1f(_),u_merc_center:new a.Uniform2f(_),u_image0:new a.Uniform1i(_),u_grid_matrix:new a.UniformMatrix3f(_),u_frustum_tl:new a.Uniform3f(_),u_frustum_tr:new a.Uniform3f(_),u_frustum_br:new a.Uniform3f(_),u_frustum_bl:new a.Uniform3f(_),u_globe_pos:new a.Uniform3f(_),u_globe_radius:new a.Uniform1f(_),u_viewport:new a.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new a.Uniform3f(_),u_frustum_tr:new a.Uniform3f(_),u_frustum_br:new a.Uniform3f(_),u_frustum_bl:new a.Uniform3f(_),u_horizon:new a.Uniform1f(_),u_transition:new a.Uniform1f(_),u_fadeout_range:new a.Uniform1f(_),u_color:new a.Uniform4f(_),u_high_color:new a.Uniform4f(_),u_space_color:new a.Uniform4f(_),u_star_intensity:new a.Uniform1f(_),u_star_density:new a.Uniform1f(_),u_star_size:new a.Uniform1f(_),u_temporal_offset:new a.Uniform1f(_),u_horizon_angle:new a.Uniform1f(_),u_rotation_matrix:new a.UniformMatrix4f(_)})};let wo;function Ea(_,c,p,x,S,I,O){const j=_.context,G=j.gl,re=_.transform,te=_.useProgram("collisionBox"),pe=[];let Ee=0,Le=0;for(let qe=0;qe<x.length;qe++){const ot=x[qe],it=c.getTile(ot),gt=it.getBucket(p);if(!gt)continue;const zt=lt(ot,gt,re);let Lt=zt;S[0]===0&&S[1]===0||(Lt=_.translatePosMatrix(zt,it,S,I));const wt=O?gt.textCollisionBox:gt.iconCollisionBox,Dr=gt.collisionCircleArray;if(Dr.length>0){const Dt=a.create(),ir=Lt;a.mul(Dt,gt.placementInvProjMatrix,re.glCoordMatrix),a.mul(Dt,Dt,gt.placementViewportMatrix),pe.push({circleArray:Dr,circleOffset:Le,transform:ir,invTransform:Dt,projection:gt.getProjection()}),Ee+=Dr.length/4,Le=Ee}wt&&(_.terrain&&_.terrain.setupElevationDraw(it,te),te.draw(j,G.LINES,a.DepthMode.disabled,a.StencilMode.disabled,_.colorModeForRenderPass(),a.CullFaceMode.disabled,Wa(Lt,re,it,gt.getProjection()),p.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,null,re.zoom,null,[wt.collisionVertexBuffer,wt.collisionVertexBufferExt]))}if(!O||!pe.length)return;const Pe=_.useProgram("collisionCircle"),Be=new a.StructArrayLayout2f1f2i16;Be.resize(4*Ee),Be._trim();let Ce=0;for(const qe of pe)for(let ot=0;ot<qe.circleArray.length/4;ot++){const it=4*ot,gt=qe.circleArray[it+0],zt=qe.circleArray[it+1],Lt=qe.circleArray[it+2],wt=qe.circleArray[it+3];Be.emplace(Ce++,gt,zt,Lt,wt,0),Be.emplace(Ce++,gt,zt,Lt,wt,1),Be.emplace(Ce++,gt,zt,Lt,wt,2),Be.emplace(Ce++,gt,zt,Lt,wt,3)}(!wo||wo.length<2*Ee)&&(wo=function(qe){const ot=2*qe,it=new a.StructArrayLayout3ui6;it.resize(ot),it._trim();for(let gt=0;gt<ot;gt++){const zt=6*gt;it.uint16[zt+0]=4*gt+0,it.uint16[zt+1]=4*gt+1,it.uint16[zt+2]=4*gt+2,it.uint16[zt+3]=4*gt+2,it.uint16[zt+4]=4*gt+3,it.uint16[zt+5]=4*gt+0}return it}(Ee));const De=j.createIndexBuffer(wo,!0),Ne=j.createVertexBuffer(Be,a.collisionCircleLayout.members,!0);for(const qe of pe){const ot={u_matrix:qe.transform,u_inv_matrix:qe.invTransform,u_camera_to_center_distance:(Oe=re).getCameraToCenterDistance(qe.projection),u_viewport_size:[Oe.width,Oe.height]};Pe.draw(j,G.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,_.colorModeForRenderPass(),a.CullFaceMode.disabled,ot,p.id,Ne,De,a.SegmentVector.simpleSegment(0,2*qe.circleOffset,qe.circleArray.length,qe.circleArray.length/2),null,re.zoom)}var Oe;Ne.destroy(),De.destroy()}const Ze=a.create();function He({width:_,height:c,anchor:p,textOffset:x,textScale:S},I){const{horizontalAlign:O,verticalAlign:j}=a.getAnchorAlignment(p),G=-(O-.5)*_,re=-(j-.5)*c,te=a.evaluateVariableOffset(p,x);return new a.pointGeometry((G/S+te[0])*I,(re/S+te[1])*I)}function We(_,c,p,x,S,I,O,j,G,re,te){const pe=_.text.placedSymbolArray,Ee=_.text.dynamicLayoutVertexArray,Le=_.icon.dynamicLayoutVertexArray,Pe={},Be=_.getProjection(),Ce=kt(j,Be,I),De=I.elevation,Ne=Be.upVectorScale(j.canonical,I.center.lat,I.worldSize).metersToTile;Ee.clear();for(let Oe=0;Oe<pe.length;Oe++){const qe=pe.get(Oe),{tileAnchorX:ot,tileAnchorY:it,numGlyphs:gt}=qe,zt=_.allowVerticalPlacement&&!qe.placedOrientation,Lt=qe.hidden||!qe.crossTileID||zt?null:x[qe.crossTileID];if(Lt){let wt=0,Dr=0,Dt=0;if(De){const ai=De?De.getAtTileOffset(j,ot,it):0,[wi,si,ki]=Be.upVector(j.canonical,ot,it);wt=ai*wi*Ne,Dr=ai*si*Ne,Dt=ai*ki*Ne}let[ir,jt,wr,Zt]=Ve(qe.projectedAnchorX+wt,qe.projectedAnchorY+Dr,qe.projectedAnchorZ+Dt,p?Ce:O);const fr=pt(I.getCameraToCenterDistance(Be),Zt);let kr=S.evaluateSizeForFeature(_.textSizeData,re,qe)*fr/a.ONE_EM;p&&(kr*=_.tilePixelRatio/G);const Mt=He(Lt,kr);p?({x:ir,y:jt,z:wr}=Be.projectTilePoint(ot+Mt.x,it+Mt.y,j.canonical),[ir,jt,wr]=Ve(ir+wt,jt+Dr,wr+Dt,O)):(c&&Mt._rotate(-I.angle),ir+=Mt.x,jt+=Mt.y,wr=0);const Ut=_.allowVerticalPlacement&&qe.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let ai=0;ai<gt;ai++)a.addDynamicAttributes(Ee,ir,jt,wr,Ut);te&&qe.associatedIconIndex>=0&&(Pe[qe.associatedIconIndex]={x:ir,y:jt,z:wr,angle:Ut})}else Hi(gt,Ee)}if(te){Le.clear();const Oe=_.icon.placedSymbolArray;for(let qe=0;qe<Oe.length;qe++){const ot=Oe.get(qe),{numGlyphs:it}=ot,gt=Pe[qe];if(ot.hidden||!gt)Hi(it,Le);else{const{x:zt,y:Lt,z:wt,angle:Dr}=gt;for(let Dt=0;Dt<it;Dt++)a.addDynamicAttributes(Le,zt,Lt,wt,Dr)}}_.icon.dynamicLayoutVertexBuffer.updateData(Le)}_.text.dynamicLayoutVertexBuffer.updateData(Ee)}function ds(_,c,p){return p.iconsInText&&c?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function aa(_,c,p,x,S,I,O,j,G,re,te,pe){const Ee=_.context,Le=Ee.gl,Pe=_.transform,Be=j==="map",Ce=G==="map",De=Be&&p.layout.get("symbol-placement")!=="point",Ne=Be&&!Ce&&!De,Oe=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let qe=!1;const ot=_.depthModeForSublayer(0,a.DepthMode.ReadOnly),it=[a.mercatorXfromLng(Pe.center.lng),a.mercatorYfromLat(Pe.center.lat)],gt=p.layout.get("text-variable-anchor"),zt=Pe.projection.name==="globe",Lt=[],wt=[0,-1,0];let Dr=wt;!zt&&!Pe.mercatorFromTransition||Be||(Dr=function(Dt){const ir=Dt._camera.getWorldToCamera(Dt.worldSize,1),jt=a.multiply([],ir,Dt.globeMatrix);a.invert(jt,jt);const wr=[0,0,0],Zt=[0,1,0,0];return a.transformMat4$1(Zt,Zt,jt),wr[0]=Zt[0],wr[1]=Zt[1],wr[2]=Zt[2],a.normalize(wr,wr),wr}(Pe));for(const Dt of x){const ir=c.getTile(Dt),jt=ir.getBucket(p);if(!jt||jt.projection.name==="mercator"&&zt)continue;const wr=S?jt.text:jt.icon;if(!wr||jt.fullyClipped||!wr.segments.get().length)continue;const Zt=wr.programConfigurations.get(p.id),fr=S||jt.sdfIcons,kr=S?jt.textSizeData:jt.iconSizeData,Mt=Ce||Pe.pitch!==0,Ut=a.evaluateSizeForZoom(kr,Pe.zoom);let ai,wi,si,ki,qi=[0,0],Ei=null;if(S){if(wi=ir.glyphAtlasTexture,si=Le.LINEAR,ai=ir.glyphAtlasTexture.size,jt.iconsInText){qi=ir.imageAtlasTexture.size,Ei=ir.imageAtlasTexture;const Sa=kr.kind==="composite"||kr.kind==="camera";ki=Mt||_.options.rotating||_.options.zooming||Sa?Le.LINEAR:Le.NEAREST}}else{const Sa=p.layout.get("icon-size").constantOr(0)!==1||jt.iconsNeedLinear;wi=ir.imageAtlasTexture,si=fr||_.options.rotating||_.options.zooming||Sa||Mt?Le.LINEAR:Le.NEAREST,ai=ir.imageAtlasTexture.size}const ti=jt.projection.name==="globe",Tn=ti?Dr:wt,xn=ti?a.globeToMercatorTransition(Pe.zoom):0,Dn=kt(Dt,jt.getProjection(),Pe),An=Pe.calculatePixelsToTileUnitsMatrix(ir),ca=Me(Dn,ir.tileID.canonical,Ce,Be,Pe,jt.getProjection(),An),va=_.terrain&&Ce&&De?a.invert(a.create(),ca):Ze,Qo=Pt(Dn,ir.tileID.canonical,Ce,Be,Pe,jt.getProjection(),An),es=gt&&jt.hasTextData(),Un=p.layout.get("icon-text-fit")!=="none"&&es&&jt.hasIconData();if(De){const Sa=Pe.elevation,ts=Sa?Sa.getAtTileOffsetFunc(Dt,Pe.center.lat,Pe.worldSize,jt.getProjection()):null,rs=ct(Dn,ir.tileID.canonical,Ce,Be,Pe,jt.getProjection(),An);ft(jt,Dn,_,S,rs,Qo,Ce,re,ts,Dt)}const kn=De||S&&gt||Un,_n=_.translatePosMatrix(Dn,ir,I,O),ro=kn?Ze:ca,Uo=_.translatePosMatrix(Qo,ir,I,O,!0),On=jt.getProjection().createInversionMatrix(Pe,Dt.canonical),Jo=[];_.terrainRenderModeElevated()&&Ce&&Jo.push("PITCH_WITH_MAP_TERRAIN"),ti&&Jo.push("PROJECTION_GLOBE_VIEW"),kn&&Jo.push("PROJECTED_POS_ON_VIEWPORT");const ql=fr&&p.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ws;ws=fr?jt.iconsInText?Bn(kr.kind,Ut,Ne,Ce,_,_n,ro,Uo,ai,qi,Dt,xn,it,On,Tn,jt.getProjection()):Wn(kr.kind,Ut,Ne,Ce,_,_n,ro,Uo,S,ai,!0,Dt,xn,it,On,Tn,jt.getProjection()):bo(kr.kind,Ut,Ne,Ce,_,_n,ro,Uo,S,ai,Dt,xn,it,On,Tn,jt.getProjection());const $o={program:_.useProgram(ds(fr,S,jt),Zt,Jo),buffers:wr,uniformValues:ws,atlasTexture:wi,atlasTextureIcon:Ei,atlasInterpolation:si,atlasInterpolationIcon:ki,isSDF:fr,hasHalo:ql,tile:ir,labelPlaneMatrixInv:va};if(Oe&&jt.canOverlap){qe=!0;const Sa=wr.segments.get();for(const ts of Sa)Lt.push({segments:new a.SegmentVector([ts]),sortKey:ts.sortKey,state:$o})}else Lt.push({segments:wr.segments,sortKey:0,state:$o})}qe&&Lt.sort((Dt,ir)=>Dt.sortKey-ir.sortKey);for(const Dt of Lt){const ir=Dt.state;if(_.terrain&&_.terrain.setupElevationDraw(ir.tile,ir.program,{useDepthForOcclusion:!zt,labelPlaneMatrixInv:ir.labelPlaneMatrixInv}),Ee.activeTexture.set(Le.TEXTURE0),ir.atlasTexture.bind(ir.atlasInterpolation,Le.CLAMP_TO_EDGE),ir.atlasTextureIcon&&(Ee.activeTexture.set(Le.TEXTURE1),ir.atlasTextureIcon&&ir.atlasTextureIcon.bind(ir.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),ir.isSDF){const jt=ir.uniformValues;ir.hasHalo&&(jt.u_is_halo=1,Xs(ir.buffers,Dt.segments,p,_,ir.program,ot,te,pe,jt)),jt.u_is_halo=0}Xs(ir.buffers,Dt.segments,p,_,ir.program,ot,te,pe,ir.uniformValues)}}function Xs(_,c,p,x,S,I,O,j,G){const re=x.context,te=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];S.draw(re,re.gl.TRIANGLES,I,O,j,a.CullFaceMode.disabled,G,p.id,_.layoutVertexBuffer,_.indexBuffer,c,p.paint,x.transform.zoom,_.programConfigurations.get(p.id),te)}function wn(_,c,p,x,S,I,O){const j=_.context.gl,G=p.paint.get("fill-pattern"),re=G&&G.constantOr(1);let te,pe,Ee,Le,Pe;O?(pe=re&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=j.LINES):(pe=re?"fillPattern":"fill",te=j.TRIANGLES);for(const Be of x){const Ce=c.getTile(Be);if(re&&!Ce.patternsLoaded())continue;const De=Ce.getBucket(p);if(!De)continue;_.prepareDrawTile();const Ne=De.programConfigurations.get(p.id),Oe=_.useProgram(pe,Ne);re&&(_.context.activeTexture.set(j.TEXTURE0),Ce.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ne.updatePaintBuffers());const qe=G.constantOr(null);if(qe&&Ce.imageAtlas){const it=Ce.imageAtlas.patternPositions[qe.toString()];it&&Ne.setConstantPatternPositions(it)}const ot=_.translatePosMatrix(Be.projMatrix,Ce,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(O){Le=De.indexBuffer2,Pe=De.segments2;const it=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];Ee=pe==="fillOutlinePattern"&&re?La(ot,_,Ce,it):us(ot,it)}else Le=De.indexBuffer,Pe=De.segments,Ee=re?Xa(ot,_,Ce):Ho(ot);_.prepareDrawProgram(_.context,Oe,Be.toUnwrapped()),Oe.draw(_.context,te,S,_.stencilModeForClipping(Be),I,a.CullFaceMode.disabled,Ee,p.id,De.layoutVertexBuffer,Le,Pe,p.paint,_.transform.zoom,Ne)}}function gn(_,c,p,x,S,I,O){const j=_.context,G=j.gl,re=_.transform,te=p.paint.get("fill-extrusion-pattern"),pe=te.constantOr(1),Ee=p.paint.get("fill-extrusion-opacity"),Le=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),p.paint.get("fill-extrusion-ambient-occlusion-radius")],Pe=p.layout.get("fill-extrusion-edge-radius"),Be=re.projection.name==="globe"?a.fillExtrusionHeightLift():0,Ce=re.projection.name==="globe",De=Ce?a.globeToMercatorTransition(re.zoom):0,Ne=[a.mercatorXfromLng(re.center.lng),a.mercatorYfromLat(re.center.lat)],Oe=[];Ce&&(Oe.push("PROJECTION_GLOBE_VIEW"),_.style.terrainSetForDrapingOnly()&&Oe.push("TERRAIN")),Le[0]>0&&Oe.push("FAUX_AO");for(const qe of x){const ot=c.getTile(qe),it=ot.getBucket(p);if(!it||it.projection.name!==re.projection.name)continue;const gt=it.programConfigurations.get(p.id),zt=_.useProgram(pe?"fillExtrusionPattern":"fillExtrusion",gt,Oe);if(_.terrain){const wr=_.terrain;if(_.style.terrainSetForDrapingOnly())wr.setupElevationDraw(ot,zt,{useMeterToDem:!0});else{if(!it.enableTerrain)continue;if(wr.setupElevationDraw(ot,zt,{useMeterToDem:!0}),fs(j,c,qe,it,p,wr),!it.centroidVertexBuffer){const Zt=zt.attributes.a_centroid_pos;Zt!==void 0&&G.vertexAttrib2f(Zt,0,0)}}}pe&&(_.context.activeTexture.set(G.TEXTURE0),ot.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),gt.updatePaintBuffers());const Lt=te.constantOr(null);if(Lt&&ot.imageAtlas){const wr=ot.imageAtlas.patternPositions[Lt.toString()];wr&&gt.setConstantPatternPositions(wr)}const wt=_.translatePosMatrix(qe.projMatrix,ot,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Dr=re.projection.createInversionMatrix(re,qe.canonical),Dt=p.paint.get("fill-extrusion-vertical-gradient"),ir=pe?Vn(wt,_,Dt,Ee,Le,Pe,qe,ot,Be,De,Ne,Dr):Fo(wt,_,Dt,Ee,Le,Pe,qe,Be,De,Ne,Dr);_.prepareDrawProgram(j,zt,qe.toUnwrapped());const jt=[];_.terrain&&jt.push(it.centroidVertexBuffer),Ce&&jt.push(it.layoutVertexExtBuffer),zt.draw(j,j.gl.TRIANGLES,S,I,O,a.CullFaceMode.backCCW,ir,p.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,p.paint,_.transform.zoom,gt,jt)}}function fs(_,c,p,x,S,I){const O=[De=>{let Ne=De.canonical.x-1,Oe=De.wrap;return Ne<0&&(Ne=(1<<De.canonical.z)-1,Oe--),new a.OverscaledTileID(De.overscaledZ,Oe,De.canonical.z,Ne,De.canonical.y)},De=>{let Ne=De.canonical.x+1,Oe=De.wrap;return Ne===1<<De.canonical.z&&(Ne=0,Oe++),new a.OverscaledTileID(De.overscaledZ,Oe,De.canonical.z,Ne,De.canonical.y)},De=>new a.OverscaledTileID(De.overscaledZ,De.wrap,De.canonical.z,De.canonical.x,(De.canonical.y===0?1<<De.canonical.z:De.canonical.y)-1),De=>new a.OverscaledTileID(De.overscaledZ,De.wrap,De.canonical.z,De.canonical.x,De.canonical.y===(1<<De.canonical.z)-1?0:De.canonical.y+1)],j=De=>{const Ne=c.getSource().minzoom,Oe=ot=>{const it=c.getTileByID(ot);if(it&&it.hasData())return it.getBucket(S)},qe=[0,-1,1];for(const ot of qe){if(De.overscaledZ+ot<Ne)continue;const it=Oe(De.calculateScaledKey(De.overscaledZ+ot));if(it)return it}},G=[0,0,0],re=(De,Ne)=>(G[0]=Math.min(De.min.y,Ne.min.y),G[1]=Math.max(De.max.y,Ne.max.y),G[2]=a.EXTENT-Ne.min.x>De.max.x?Ne.min.x-a.EXTENT:De.max.x,G),te=(De,Ne)=>(G[0]=Math.min(De.min.x,Ne.min.x),G[1]=Math.max(De.max.x,Ne.max.x),G[2]=a.EXTENT-Ne.min.y>De.max.y?Ne.min.y-a.EXTENT:De.max.y,G),pe=[(De,Ne)=>re(De,Ne),(De,Ne)=>re(Ne,De),(De,Ne)=>te(De,Ne),(De,Ne)=>te(Ne,De)],Ee=new a.pointGeometry(0,0);let Le,Pe,Be;const Ce=(De,Ne,Oe,qe,ot)=>{const it=[[qe?Oe:De,qe?De:Oe,0],[qe?Oe:Ne,qe?Ne:Oe,0]],gt=ot<0?a.EXTENT+ot:ot,zt=[qe?gt:(De+Ne)/2,qe?(De+Ne)/2:gt,0];return Oe===0&&ot<0||Oe!==0&&ot>0?I.getForTilePoints(Be,[zt],!0,Pe):it.push(zt),I.getForTilePoints(p,it,!0,Le),Math.max(it[0][2],it[1][2],zt[2])/I.exaggeration()};for(let De=0;De<4;De++){const Ne=(De<2?1:5)-De,Oe=x.borders[De];if(Oe.length===0)continue;const qe=Be=O[De](p),ot=j(qe);if(!(ot&&ot instanceof a.FillExtrusionBucket&&ot.enableTerrain)||x.borderDoneWithNeighborZ[De]===ot.canonical.z&&ot.borderDoneWithNeighborZ[Ne]===x.canonical.z||(Pe=I.findDEMTileFor(qe),!Pe||!Pe.dem))continue;if(!Le){const Lt=I.findDEMTileFor(p);if(!Lt||!Lt.dem)return;Le=Lt}const it=ot.borders[Ne];let gt=0;const zt=ot.borderDoneWithNeighborZ[Ne]!==x.canonical.z;if(x.canonical.z===ot.canonical.z){for(let Lt=0;Lt<Oe.length;Lt++){const wt=x.featuresOnBorder[Oe[Lt]],Dr=wt.borders[De];let Dt;for(;gt<it.length&&(Dt=ot.featuresOnBorder[it[gt]],!(Dt.borders[Ne][1]>Dr[0]+3));)zt&&ot.encodeCentroid(void 0,Dt,!1),gt++;if(Dt&&gt<it.length){const ir=gt;let jt=0;for(;!(Dt.borders[Ne][0]>Dr[1]-3)&&(jt++,++gt!==it.length);)Dt=ot.featuresOnBorder[it[gt]];if(Dt=ot.featuresOnBorder[it[ir]],wt.intersectsCount()>1||Dt.intersectsCount()>1||jt!==1){jt!==1&&(gt=ir),x.encodeCentroid(void 0,wt,!1),zt&&ot.encodeCentroid(void 0,Dt,!1);continue}const wr=pe[De](wt,Dt),Zt=De%2?a.EXTENT-1:0;Ee.x=Ce(wr[0],Math.min(a.EXTENT-1,wr[1]),Zt,De<2,wr[2]),Ee.y=0,x.encodeCentroid(Ee,wt,!1),zt&&ot.encodeCentroid(Ee,Dt,!1)}else x.encodeCentroid(void 0,wt,!1)}x.borderDoneWithNeighborZ[De]=ot.canonical.z,x.needsCentroidUpdate=!0,zt&&(ot.borderDoneWithNeighborZ[Ne]=x.canonical.z,ot.needsCentroidUpdate=!0)}else{for(const Lt of Oe)x.encodeCentroid(void 0,x.featuresOnBorder[Lt],!1);if(zt){for(const Lt of it)ot.encodeCentroid(void 0,ot.featuresOnBorder[Lt],!1);ot.borderDoneWithNeighborZ[Ne]=x.canonical.z,ot.needsCentroidUpdate=!0}x.borderDoneWithNeighborZ[De]=ot.canonical.z,x.needsCentroidUpdate=!0}}(x.needsCentroidUpdate||!x.centroidVertexBuffer&&x.centroidVertexArray.length!==0)&&x.uploadCentroid(_)}const _a=new a.Color(1,0,0,1),ks=new a.Color(0,1,0,1),Eo=new a.Color(0,0,1,1),No=new a.Color(1,0,1,1),sa=new a.Color(0,1,1,1);function Ba(_,c,p){const x=_.context,S=_.transform,I=x.gl,O=S.projection.name==="globe",j=O?["PROJECTION_GLOBE_VIEW"]:null;let G=p.projMatrix;if(O&&a.globeToMercatorTransition(S.zoom)>0){const wt=a.transitionTileAABBinECEF(p.canonical,S),Dr=a.globeDenormalizeECEF(wt);G=a.multiply(new Float32Array(16),S.globeMatrix,Dr),a.multiply(G,S.projMatrix,G)}const re=_.useProgram("debug",null,j),te=c.getTileByID(p.key);_.terrain&&_.terrain.setupElevationDraw(te,re);const pe=a.DepthMode.disabled,Ee=a.StencilMode.disabled,Le=_.colorModeForRenderPass(),Pe="$debug";x.activeTexture.set(I.TEXTURE0),_.emptyTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),O?te._makeGlobeTileDebugBuffers(_.context,S):te._makeDebugTileBoundsBuffers(_.context,S.projection);const Be=te._tileDebugBuffer||_.debugBuffer,Ce=te._tileDebugIndexBuffer||_.debugIndexBuffer,De=te._tileDebugSegments||_.debugSegments;re.draw(x,I.LINE_STRIP,pe,Ee,Le,a.CullFaceMode.disabled,Ao(G,a.Color.red),Pe,Be,Ce,De,null,null,null,[te._globeTileDebugBorderBuffer]);const Ne=te.latestRawTileData,Oe=Math.floor((Ne&&Ne.byteLength||0)/1024),qe=c.getTile(p).tileSize,ot=512/Math.min(qe,512)*(p.overscaledZ/S.zoom)*.5;let it=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(it+=` => ${p.overscaledZ}`),it+=` ${Oe}kb`,function(wt,Dr){wt.initDebugOverlayCanvas();const Dt=wt.debugOverlayCanvas,ir=wt.context.gl,jt=wt.debugOverlayCanvas.getContext("2d");jt.clearRect(0,0,Dt.width,Dt.height),jt.shadowColor="white",jt.shadowBlur=2,jt.lineWidth=1.5,jt.strokeStyle="white",jt.textBaseline="top",jt.font="bold 36px Open Sans, sans-serif",jt.fillText(Dr,5,5),jt.strokeText(Dr,5,5),wt.debugOverlayTexture.update(Dt),wt.debugOverlayTexture.bind(ir.LINEAR,ir.CLAMP_TO_EDGE)}(_,it);const gt=te._tileDebugTextBuffer||_.debugBuffer,zt=te._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Lt=te._tileDebugTextSegments||_.debugSegments;re.draw(x,I.TRIANGLES,pe,Ee,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Ao(G,a.Color.transparent,ot),Pe,gt,zt,Lt,null,null,null,[te._globeTileDebugTextBuffer])}function Oa(_,c,p,x){to(_,0,c+p/2,_.transform.width,p,x)}function la(_,c,p,x){to(_,c-p/2,0,p,_.transform.height,x)}function to(_,c,p,x,S,I){const O=_.context,j=O.gl;j.enable(j.SCISSOR_TEST),j.scissor(c*a.exported.devicePixelRatio,p*a.exported.devicePixelRatio,x*a.exported.devicePixelRatio,S*a.exported.devicePixelRatio),O.clear({color:I}),j.disable(j.SCISSOR_TEST)}const Fa=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ka}=Fa;function _o(_,c,p,x){_.emplaceBack(c,p,x)}class Wo{constructor(c){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,_o(this.vertexArray,-1,-1,1),_o(this.vertexArray,1,-1,1),_o(this.vertexArray,-1,1,1),_o(this.vertexArray,1,1,1),_o(this.vertexArray,-1,-1,-1),_o(this.vertexArray,1,-1,-1),_o(this.vertexArray,-1,1,-1),_o(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Ka),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Yo(_,c,p,x,S,I){const O=_.gl,j=c.paint.get("sky-atmosphere-color"),G=c.paint.get("sky-atmosphere-halo-color"),re=c.paint.get("sky-atmosphere-sun-intensity"),te=((pe,Ee,Le,Pe,Be)=>({u_matrix_3f:pe,u_sun_direction:Ee,u_sun_intensity:Le,u_color_tint_r:[Pe.r,Pe.g,Pe.b,Pe.a],u_color_tint_m:[Be.r,Be.g,Be.b,Be.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),x),S,re,j,G);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+I,c.skyboxTexture,0),p.draw(_,O.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,te,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const ps=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rn{constructor(c){const p=new a.StructArrayLayout5f20;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const x=new a.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(p,ps.members),this.indexBuffer=c.createIndexBuffer(x),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ya={symbol:function(_,c,p,x,S){if(_.renderPass!=="translucent")return;const I=a.StencilMode.disabled,O=_.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(j,G,re,te,pe,Ee,Le){const Pe=G.transform,Be=pe==="map",Ce=Ee==="map";for(const De of j){const Ne=te.getTile(De),Oe=Ne.getBucket(re);if(!Oe||!Oe.text||!Oe.text.segments.get().length)continue;const qe=a.evaluateSizeForZoom(Oe.textSizeData,Pe.zoom),ot=kt(De,Oe.getProjection(),Pe),it=Pe.calculatePixelsToTileUnitsMatrix(Ne),gt=Me(ot,Ne.tileID.canonical,Ce,Be,Pe,Oe.getProjection(),it),zt=re.layout.get("icon-text-fit")!=="none"&&Oe.hasIconData();if(qe){const Lt=Math.pow(2,Pe.zoom-Ne.tileID.overscaledZ);We(Oe,Be,Ce,Le,a.symbolSize,Pe,gt,De,Lt,qe,zt)}}}(x,_,p,c,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),S),p.paint.get("icon-opacity").constantOr(1)!==0&&aa(_,c,p,x,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),I,O),p.paint.get("text-opacity").constantOr(1)!==0&&aa(_,c,p,x,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),I,O),c.map.showCollisionBoxes&&(Ea(_,c,p,x,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Ea(_,c,p,x,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(_,c,p,x){if(_.renderPass!=="translucent")return;const S=p.paint.get("circle-opacity"),I=p.paint.get("circle-stroke-width"),O=p.paint.get("circle-stroke-opacity"),j=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(I.constantOr(1)===0||O.constantOr(1)===0))return;const G=_.context,re=G.gl,te=_.transform,pe=_.depthModeForSublayer(0,a.DepthMode.ReadOnly),Ee=a.StencilMode.disabled,Le=_.colorModeForRenderPass(),Pe=te.projection.name==="globe",Be=[a.mercatorXfromLng(te.center.lng),a.mercatorYfromLat(te.center.lat)],Ce=[];for(let Ne=0;Ne<x.length;Ne++){const Oe=x[Ne],qe=c.getTile(Oe),ot=qe.getBucket(p);if(!ot||ot.projection.name!==te.projection.name)continue;const it=ot.programConfigurations.get(p.id),gt=Ha(p);Pe&&gt.push("PROJECTION_GLOBE_VIEW");const zt=_.useProgram("circle",it,gt),Lt=ot.layoutVertexBuffer,wt=ot.globeExtVertexBuffer,Dr=ot.indexBuffer,Dt=te.projection.createInversionMatrix(te,Oe.canonical),ir={programConfiguration:it,program:zt,layoutVertexBuffer:Lt,globeExtVertexBuffer:wt,indexBuffer:Dr,uniformValues:Za(_,Oe,qe,Dt,Be,p),tile:qe};if(j){const jt=ot.segments.get();for(const wr of jt)Ce.push({segments:new a.SegmentVector([wr]),sortKey:wr.sortKey,state:ir})}else Ce.push({segments:ot.segments,sortKey:0,state:ir})}j&&Ce.sort((Ne,Oe)=>Ne.sortKey-Oe.sortKey);const De={useDepthForOcclusion:!Pe};for(const Ne of Ce){const{programConfiguration:Oe,program:qe,layoutVertexBuffer:ot,globeExtVertexBuffer:it,indexBuffer:gt,uniformValues:zt,tile:Lt}=Ne.state,wt=Ne.segments;_.terrain&&_.terrain.setupElevationDraw(Lt,qe,De),_.prepareDrawProgram(G,qe,Lt.tileID.toUnwrapped()),qe.draw(G,re.TRIANGLES,pe,Ee,Le,a.CullFaceMode.disabled,zt,p.id,ot,gt,wt,p.paint,te.zoom,Oe,[it])}},heatmap:function(_,c,p,x){if(p.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const S=_.context,I=S.gl,O=a.StencilMode.disabled,j=new a.ColorMode([I.ONE,I.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Le,Pe,Be,Ce){const De=Le.gl,Ne=Pe.width*Ce,Oe=Pe.height*Ce;Le.activeTexture.set(De.TEXTURE1),Le.viewport.set([0,0,Ne,Oe]);let qe=Be.heatmapFbo;if(!qe||qe&&(qe.width!==Ne||qe.height!==Oe)){qe&&qe.destroy();const ot=De.createTexture();De.bindTexture(De.TEXTURE_2D,ot),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_WRAP_S,De.CLAMP_TO_EDGE),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_WRAP_T,De.CLAMP_TO_EDGE),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_MIN_FILTER,De.LINEAR),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_MAG_FILTER,De.LINEAR),qe=Be.heatmapFbo=Le.createFramebuffer(Ne,Oe,!1),function(it,gt,zt,Lt,wt,Dr){const Dt=it.gl;Dt.texImage2D(Dt.TEXTURE_2D,0,Dt.RGBA,wt,Dr,0,Dt.RGBA,it.extRenderToTextureHalfFloat?it.extTextureHalfFloat.HALF_FLOAT_OES:Dt.UNSIGNED_BYTE,null),Lt.colorAttachment.set(zt)}(Le,0,ot,qe,Ne,Oe)}else De.bindTexture(De.TEXTURE_2D,qe.colorAttachment.get()),Le.bindFramebuffer.set(qe.framebuffer)})(S,_,p,_.transform.projection.name==="globe"?.5:.25),S.clear({color:a.Color.transparent});const G=_.transform,re=G.projection.name==="globe",te=re?["PROJECTION_GLOBE_VIEW"]:null,pe=re?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,Ee=[a.mercatorXfromLng(G.center.lng),a.mercatorYfromLat(G.center.lat)];for(let Le=0;Le<x.length;Le++){const Pe=x[Le];if(c.hasRenderableParent(Pe))continue;const Be=c.getTile(Pe),Ce=Be.getBucket(p);if(!Ce||Ce.projection.name!==G.projection.name)continue;const De=Ce.programConfigurations.get(p.id),Ne=_.useProgram("heatmap",De,te),{zoom:Oe}=_.transform;_.terrain&&_.terrain.setupElevationDraw(Be,Ne),_.prepareDrawProgram(S,Ne,Pe.toUnwrapped());const qe=G.projection.createInversionMatrix(G,Pe.canonical);Ne.draw(S,I.TRIANGLES,a.DepthMode.disabled,O,j,pe,hs(_,Pe,Be,qe,Ee,Oe,p.paint.get("heatmap-intensity")),p.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,p.paint,_.transform.zoom,De,re?[Ce.globeExtVertexBuffer]:null)}S.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(S,I){const O=S.context,j=O.gl,G=I.heatmapFbo;if(!G)return;O.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,G.colorAttachment.get()),O.activeTexture.set(j.TEXTURE1);let re=I.colorRampTexture;re||(re=I.colorRampTexture=new a.Texture(O,I.colorRamp,j.RGBA)),re.bind(j.LINEAR,j.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(O,j.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,S.colorModeForRenderPass(),a.CullFaceMode.disabled,((te,pe,Ee,Le)=>({u_image:0,u_color_ramp:1,u_opacity:pe.paint.get("heatmap-opacity")}))(0,I),I.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,I.paint,S.transform.zoom)}(_,p))},line:function(_,c,p,x){if(_.renderPass!=="translucent")return;const S=p.paint.get("line-opacity"),I=p.paint.get("line-width");if(S.constantOr(1)===0||I.constantOr(1)===0)return;const O=_.depthModeForSublayer(0,a.DepthMode.ReadOnly),j=_.colorModeForRenderPass(),G=_.terrain&&_.terrain.renderingToTexture?1:a.exported.devicePixelRatio,re=p.paint.get("line-dasharray"),te=re.constantOr(1),pe=p.layout.get("line-cap"),Ee=p.paint.get("line-pattern"),Le=Ee.constantOr(1),Pe=p.paint.get("line-gradient"),Be=Le?"linePattern":"line",Ce=_.context,De=Ce.gl,Ne=(qe=>{const ot=[];fn(qe)&&ot.push("RENDER_LINE_DASH"),qe.paint.get("line-gradient")&&ot.push("RENDER_LINE_GRADIENT");const it=qe.paint.get("line-trim-offset");it[0]===0&&it[1]===0||ot.push("RENDER_LINE_TRIM_OFFSET");const gt=qe.paint.get("line-pattern").constantOr(1),zt=qe.paint.get("line-opacity").constantOr(1)!==1;return!gt&&zt&&ot.push("RENDER_LINE_ALPHA_DISCARD"),ot})(p);let Oe=Ne.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(Oe=!1);for(const qe of x){const ot=c.getTile(qe);if(Le&&!ot.patternsLoaded())continue;const it=ot.getBucket(p);if(!it)continue;_.prepareDrawTile();const gt=it.programConfigurations.get(p.id),zt=_.useProgram(Be,gt,Ne),Lt=Ee.constantOr(null);if(Lt&&ot.imageAtlas){const fr=ot.imageAtlas.patternPositions[Lt.toString()];fr&&gt.setConstantPatternPositions(fr)}const wt=re.constantOr(null),Dr=pe.constantOr(null);if(!Le&&wt&&Dr&&ot.lineAtlas){const fr=ot.lineAtlas.getDash(wt,Dr);fr&&gt.setConstantPatternPositions(fr)}let[Dt,ir]=p.paint.get("line-trim-offset");(Dr==="round"||Dr==="square")&&Dt!==ir&&(Dt===0&&(Dt-=1),ir===1&&(ir+=1));const jt=_.terrain?qe.projMatrix:null,wr=Le?Wt(_,ot,p,jt,G):Tt(_,ot,p,jt,it.lineClipsArray.length,G,[Dt,ir]);if(Pe){const fr=it.gradients[p.id];let kr=fr.texture;if(p.gradientVersion!==fr.version){let Mt=256;if(p.stepInterpolant){const Ut=c.getSource().maxzoom,ai=qe.canonical.z===Ut?Math.ceil(1<<_.transform.maxZoom-qe.canonical.z):1;Mt=a.clamp(a.nextPowerOfTwo(it.maxLineLength/a.EXTENT*1024*ai),256,Ce.maxTextureSize)}fr.gradient=a.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:fr.gradient||void 0,clips:it.lineClipsArray}),fr.texture?fr.texture.update(fr.gradient):fr.texture=new a.Texture(Ce,fr.gradient,De.RGBA),fr.version=p.gradientVersion,kr=fr.texture}Ce.activeTexture.set(De.TEXTURE1),kr.bind(p.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}te&&(Ce.activeTexture.set(De.TEXTURE0),ot.lineAtlasTexture.bind(De.LINEAR,De.REPEAT),gt.updatePaintBuffers()),Le&&(Ce.activeTexture.set(De.TEXTURE0),ot.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),gt.updatePaintBuffers()),_.prepareDrawProgram(Ce,zt,qe.toUnwrapped());const Zt=fr=>{zt.draw(Ce,De.TRIANGLES,O,fr,j,a.CullFaceMode.disabled,wr,p.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,p.paint,_.transform.zoom,gt,[it.layoutVertexBuffer2])};if(Oe){const fr=_.stencilModeForClipping(qe).ref;fr===0&&_.terrain&&Ce.clear({stencil:0});const kr={func:De.EQUAL,mask:255};wr.u_alpha_discard_threshold=.8,Zt(new a.StencilMode(kr,fr,255,De.KEEP,De.KEEP,De.INVERT)),wr.u_alpha_discard_threshold=0,Zt(new a.StencilMode(kr,fr,255,De.KEEP,De.KEEP,De.KEEP))}else Zt(_.stencilModeForClipping(qe))}Oe&&(_.resetStencilClippingMasks(),_.terrain&&Ce.clear({stencil:0}))},fill:function(_,c,p,x){const S=p.paint.get("fill-color"),I=p.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const O=_.colorModeForRenderPass(),j=p.paint.get("fill-pattern"),G=_.opaquePassEnabledForLayer()&&!j.constantOr(1)&&S.constantOr(a.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===G){const re=_.depthModeForSublayer(1,_.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);wn(_,c,p,x,re,O,!1)}if(_.renderPass==="translucent"&&p.paint.get("fill-antialias")){const re=_.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);wn(_,c,p,x,re,O,!0)}},"fill-extrusion":function(_,c,p,x){const S=p.paint.get("fill-extrusion-opacity");if(S!==0&&_.renderPass==="translucent"){const I=new a.DepthMode(_.context.gl.LEQUAL,a.DepthMode.ReadWrite,_.depthRangeFor3D);if(S!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))gn(_,c,p,x,I,a.StencilMode.disabled,a.ColorMode.disabled),gn(_,c,p,x,I,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const O=_.colorModeForRenderPass();gn(_,c,p,x,I,a.StencilMode.disabled,O)}}},hillshade:function(_,c,p,x){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const S=_.context,I=_.depthModeForSublayer(0,a.DepthMode.ReadOnly),O=_.colorModeForRenderPass(),j=_.terrain&&_.terrain.renderingToTexture,[G,re]=_.renderPass!=="translucent"||j?[{},x]:_.stencilConfigForOverlap(x);for(const te of re){const pe=c.getTile(te);if(pe.needsHillshadePrepare&&_.renderPass==="offscreen")Mo(_,pe,p,I,a.StencilMode.disabled,O);else if(_.renderPass==="translucent"){const Ee=j&&_.terrain?_.terrain.stencilModeForRTTOverlap(te):G[te.overscaledZ];wa(_,te,pe,p,I,Ee,O)}}S.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,c,p,x,S,I){if(_.renderPass!=="translucent"||p.paint.get("raster-opacity")===0||!x.length)return;const O=_.context,j=O.gl,G=c.getSource(),re=_.useProgram("raster"),te=_.colorModeForRenderPass(),pe=_.terrain&&_.terrain.renderingToTexture,[Ee,Le]=G instanceof Ye||pe?[{},x]:_.stencilConfigForOverlap(x),Pe=Le[Le.length-1].overscaledZ,Be=!_.options.moving;for(const Ce of Le){const De=pe?a.DepthMode.disabled:_.depthModeForSublayer(Ce.overscaledZ-Pe,p.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,j.LESS),Ne=Ce.toUnwrapped(),Oe=c.getTile(Ce);if(pe&&(!Oe||!Oe.hasData()))continue;const qe=pe?Ce.projMatrix:_.transform.calculateProjMatrix(Ne,Be),ot=_.terrain&&pe?_.terrain.stencilModeForRTTOverlap(Ce):Ee[Ce.overscaledZ],it=I?0:p.paint.get("raster-fade-duration");Oe.registerFadeDuration(it);const gt=c.findLoadedParent(Ce,0),zt=Zo(Oe,gt,c,_.transform,it);let Lt,wt;_.terrain&&_.terrain.prepareDrawTile();const Dr=p.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;O.activeTexture.set(j.TEXTURE0),Oe.texture.bind(Dr,j.CLAMP_TO_EDGE),O.activeTexture.set(j.TEXTURE1),gt?(gt.texture.bind(Dr,j.CLAMP_TO_EDGE),Lt=Math.pow(2,gt.tileID.overscaledZ-Oe.tileID.overscaledZ),wt=[Oe.tileID.canonical.x*Lt%1,Oe.tileID.canonical.y*Lt%1]):Oe.texture.bind(Dr,j.CLAMP_TO_EDGE);const Dt=tn(qe,wt||[0,0],Lt||1,zt,p,G instanceof Ye?G.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(O,re,Ne),G instanceof Ye)G.boundsBuffer&&G.boundsSegments&&re.draw(O,j.TRIANGLES,De,a.StencilMode.disabled,te,a.CullFaceMode.disabled,Dt,p.id,G.boundsBuffer,_.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:ir,tileBoundsIndexBuffer:jt,tileBoundsSegments:wr}=_.getTileBoundsBuffers(Oe);re.draw(O,j.TRIANGLES,De,ot,te,a.CullFaceMode.disabled,Dt,p.id,ir,jt,wr)}}_.resetStencilClippingMasks()},background:function(_,c,p,x){const S=p.paint.get("background-color"),I=p.paint.get("background-opacity");if(I===0)return;const O=_.context,j=O.gl,G=_.transform,re=G.tileSize,te=p.paint.get("background-pattern");if(_.isPatternMissing(te))return;const pe=!te&&S.a===1&&I===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==pe)return;const Ee=a.StencilMode.disabled,Le=_.depthModeForSublayer(0,pe==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),Pe=_.colorModeForRenderPass(),Be=_.useProgram(te?"backgroundPattern":"background");let Ce,De=x;De||(Ce=_.getBackgroundTiles(),De=Object.values(Ce).map(Ne=>Ne.tileID)),te&&(O.activeTexture.set(j.TEXTURE0),_.imageManager.bind(_.context));for(const Ne of De){const Oe=Ne.toUnwrapped(),qe=x?Ne.projMatrix:_.transform.calculateProjMatrix(Oe);_.prepareDrawTile();const ot=c?c.getTile(Ne):Ce?Ce[Ne.key]:new a.Tile(Ne,re,G.zoom,_),it=te?zo(qe,I,_,te,{tileID:Ne,tileSize:re}):oa(qe,I,S);_.prepareDrawProgram(O,Be,Oe);const{tileBoundsBuffer:gt,tileBoundsIndexBuffer:zt,tileBoundsSegments:Lt}=_.getTileBoundsBuffers(ot);Be.draw(O,j.TRIANGLES,Le,Ee,Pe,a.CullFaceMode.disabled,it,p.id,gt,zt,Lt)}},sky:function(_,c,p){const x=_.transform,S=x.projection.name==="mercator"||x.projection.name==="globe"?1:a.smoothstep(7,8,x.zoom),I=p.paint.get("sky-opacity")*S;if(I===0)return;const O=_.context,j=p.paint.get("sky-type"),G=new a.DepthMode(O.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),re=_.frameCounter/1e3%1;j==="atmosphere"?_.renderPass==="offscreen"?p.needsSkyboxCapture(_)&&(function(te,pe,Ee,Le){const Pe=te.context,Be=Pe.gl;let Ce=pe.skyboxFbo;if(!Ce){Ce=pe.skyboxFbo=Pe.createFramebuffer(32,32,!1),pe.skyboxGeometry=new Wo(Pe),pe.skyboxTexture=Pe.gl.createTexture(),Be.bindTexture(Be.TEXTURE_CUBE_MAP,pe.skyboxTexture),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_WRAP_S,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_WRAP_T,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_MIN_FILTER,Be.LINEAR),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_MAG_FILTER,Be.LINEAR);for(let qe=0;qe<6;++qe)Be.texImage2D(Be.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0,Be.RGBA,32,32,0,Be.RGBA,Be.UNSIGNED_BYTE,null)}Pe.bindFramebuffer.set(Ce.framebuffer),Pe.viewport.set([0,0,32,32]);const De=pe.getCenter(te,!0),Ne=te.useProgram("skyboxCapture"),Oe=new Float64Array(16);a.identity(Oe),a.rotateY(Oe,Oe,.5*-Math.PI),Yo(Pe,pe,Ne,Oe,De,0),a.identity(Oe),a.rotateY(Oe,Oe,.5*Math.PI),Yo(Pe,pe,Ne,Oe,De,1),a.identity(Oe),a.rotateX(Oe,Oe,.5*-Math.PI),Yo(Pe,pe,Ne,Oe,De,2),a.identity(Oe),a.rotateX(Oe,Oe,.5*Math.PI),Yo(Pe,pe,Ne,Oe,De,3),a.identity(Oe),Yo(Pe,pe,Ne,Oe,De,4),a.identity(Oe),a.rotateY(Oe,Oe,Math.PI),Yo(Pe,pe,Ne,Oe,De,5),Pe.viewport.set([0,0,te.width,te.height])}(_,p),p.markSkyboxValid(_)):_.renderPass==="sky"&&function(te,pe,Ee,Le,Pe){const Be=te.context,Ce=Be.gl,De=te.transform,Ne=te.useProgram("skybox");Be.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_CUBE_MAP,pe.skyboxTexture);const Oe=((qe,ot,it,gt,zt)=>({u_matrix:qe,u_sun_direction:ot,u_cubemap:0,u_opacity:gt,u_temporal_offset:zt}))(De.skyboxMatrix,pe.getCenter(te,!1),0,Le,Pe);te.prepareDrawProgram(Be,Ne),Ne.draw(Be,Ce.TRIANGLES,Ee,a.StencilMode.disabled,te.colorModeForRenderPass(),a.CullFaceMode.backCW,Oe,"skybox",pe.skyboxGeometry.vertexBuffer,pe.skyboxGeometry.indexBuffer,pe.skyboxGeometry.segment)}(_,p,G,I,re):j==="gradient"&&_.renderPass==="sky"&&function(te,pe,Ee,Le,Pe){const Be=te.context,Ce=Be.gl,De=te.transform,Ne=te.useProgram("skyboxGradient");pe.skyboxGeometry||(pe.skyboxGeometry=new Wo(Be)),Be.activeTexture.set(Ce.TEXTURE0);let Oe=pe.colorRampTexture;Oe||(Oe=pe.colorRampTexture=new a.Texture(Be,pe.colorRamp,Ce.RGBA)),Oe.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);const qe=((ot,it,gt,zt,Lt)=>({u_matrix:ot,u_color_ramp:0,u_center_direction:it,u_radius:a.degToRad(gt),u_opacity:zt,u_temporal_offset:Lt}))(De.skyboxMatrix,pe.getCenter(te,!1),pe.paint.get("sky-gradient-radius"),Le,Pe);te.prepareDrawProgram(Be,Ne),Ne.draw(Be,Ce.TRIANGLES,Ee,a.StencilMode.disabled,te.colorModeForRenderPass(),a.CullFaceMode.backCW,qe,"skyboxGradient",pe.skyboxGeometry.vertexBuffer,pe.skyboxGeometry.indexBuffer,pe.skyboxGeometry.segment)}(_,p,G,I,re)},debug:function(_,c,p){for(let x=0;x<p.length;x++)Ba(_,c,p[x])},custom:function(_,c,p){const x=_.context,S=p.implementation;if(_.transform.projection.unsupportedLayers&&_.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(_.renderPass==="offscreen"){const I=S.prerender;I&&(_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),I.call(S,x.gl,_.transform.customLayerMatrix()),x.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),x.setStencilMode(a.StencilMode.disabled);const I=S.renderingMode==="3d"?new a.DepthMode(_.context.gl.LEQUAL,a.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,a.DepthMode.ReadOnly);x.setDepthMode(I),S.render(x.gl,_.transform.customLayerMatrix()),x.setDirty(),_.setBaseState(),x.bindFramebuffer.set(null)}}};class oc{constructor(c,p){this.context=new ae(c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Go,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,p){const x=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fi(this,c));const S=this._terrain;this.transform.elevation=x?S:null,S.update(c,this.transform,p)}_updateFog(c){const p=c.fog;if(!p||this.transform.projection.name==="globe"||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,S]=p.getFovAdjustedRange(this.transform._fov);if(x>S)return void(this.transform.fogCullDistSq=null);const I=x+.78*(S-x);this.transform.fogCullDistSq=I*I}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,p){if(this.width=c*a.exported.devicePixelRatio,this.height=p*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._layers[x].resize()}setup(){const c=this.context,p=new a.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(a.EXTENT,0),p.emplaceBack(0,a.EXTENT),p.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(p,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const x=new a.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(a.EXTENT,0),x.emplaceBack(0,a.EXTENT),x.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=c.createVertexBuffer(x,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const S=new a.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const I=new a.StructArrayLayout4i8;I.emplaceBack(0,0,0,0),I.emplaceBack(a.EXTENT,0,a.EXTENT,0),I.emplaceBack(0,a.EXTENT,0,a.EXTENT),I.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(I,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const O=new a.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(O);const j=new a.StructArrayLayout1ui2;for(const re of[0,1,3,2,0])j.emplaceBack(re);this.debugIndexBuffer=c.createIndexBuffer(j),this.emptyTexture=new a.Texture(c,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=a.create();const G=this.context.gl;this.stencilClearMode=new a.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new rn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,p=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,p.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,ga(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,p,x){if(!p||this.currentStencilSource===p.id||!c.isTileClipped()||!x||x.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let j=!1;for(const G of x)if(this._tileClippingMaskIDs[G.key]===void 0){j=!0;break}if(!j)return}this.currentStencilSource=p.id;const S=this.context,I=S.gl;this.nextStencilID+x.length>256&&this.clearStencil(),S.setColorMode(a.ColorMode.disabled),S.setDepthMode(a.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of x){const G=p.getTile(j),re=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,{tileBoundsBuffer:te,tileBoundsIndexBuffer:pe,tileBoundsSegments:Ee}=this.getTileBoundsBuffers(G);O.draw(S,I.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:I.ALWAYS,mask:0},re,255,I.KEEP,I.KEEP,I.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ga(j.projMatrix),"$clipping",te,pe,Ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,p=this.context.gl;return new a.StencilMode({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const p=this.context.gl;return new a.StencilMode({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(c){const p=this.context.gl,x=c.sort((O,j)=>j.overscaledZ-O.overscaledZ),S=x[x.length-1].overscaledZ,I=x[0].overscaledZ-S+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();const O={};for(let j=0;j<I;j++)O[j+S]=new a.StencilMode({func:p.GEQUAL,mask:255},j+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=I,[O,x]}return[{[S]:a.StencilMode.disabled},x]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([c.CONSTANT_COLOR,c.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(c,p,x){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new a.DepthMode(x||this.context.gl.LEQUAL,p,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,p){this.style=c,this.options=p,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const x=this.style.order,S=this.style._sourceCaches;for(const G in S){const re=S[G];re.used&&re.prepare(this.context)}const I={},O={},j={};for(const G in S){const re=S[G];I[G]=re.getVisibleCoordinates(),O[G]=I[G].slice().reverse(),j[G]=re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<x.length;G++)if(this.style._layers[x[G]].is3D()){this.opaquePassCutoff=G;break}if(this.terrain&&(this.terrain.updateTileBinding(j),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const G of x){const re=this.style._layers[G],te=c._getLayerSourceCache(re);if(!re.hasOffscreenPass()||re.isHidden(this.transform.zoom))continue;const pe=te?O[te.id]:void 0;(re.type==="custom"||re.isSky()||pe&&pe.length)&&this.renderLayer(this,te,re,pe)}if(this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:p.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[x[this.currentLayer]],re=c._getLayerSourceCache(G);if(G.isSky())continue;const te=re?O[re.id]:void 0;this._renderTileClippingMasks(G,re,te),this.renderLayer(this,re,G,te)}if(this.style.fog&&this.transform.projection.supportsFog&&function(G,re){const te=G.context,pe=te.gl,Ee=G.transform,Le=new a.DepthMode(pe.LEQUAL,a.DepthMode.ReadOnly,[0,1]),Pe=G.useProgram("globeAtmosphere",null,Ee.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Be=a.globeToMercatorTransition(Ee.zoom),Ce=re.properties.get("color").toArray01(),De=re.properties.get("high-color").toArray01(),Ne=re.properties.get("space-color").toArray01PremultipliedAlpha(),Oe=a.identity$1([]);a.rotateY$1(Oe,Oe,-a.degToRad(Ee._center.lng)),a.rotateX$1(Oe,Oe,a.degToRad(Ee._center.lat)),a.rotateZ$1(Oe,Oe,Ee.angle),a.rotateX$1(Oe,Oe,-Ee._pitch);const qe=a.fromQuat(new Float32Array(16),Oe),ot=a.mapValue(re.properties.get("star-intensity"),0,1,0,.25),it=5e-4,gt=a.mapValue(re.properties.get("horizon-blend"),0,1,it,.25),zt=a.globeUseCustomAntiAliasing(G,te,Ee)&&gt===it?Ee.worldSize/(2*Math.PI*1.025)-1:Ee.globeRadius,Lt=G.frameCounter/1e3%1,wt=a.length(Ee.globeCenterInViewSpace),Dr=Math.sqrt(Math.pow(wt,2)-Math.pow(zt,2)),Dt=Math.acos(Dr/wt),ir=((wr,Zt,fr,kr,Mt,Ut,ai,wi,si,ki,qi,Ei,ti,Tn)=>({u_frustum_tl:wr,u_frustum_tr:Zt,u_frustum_br:fr,u_frustum_bl:kr,u_horizon:Mt,u_transition:Ut,u_fadeout_range:ai,u_color:wi,u_high_color:si,u_space_color:ki,u_star_intensity:qi,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ei,u_horizon_angle:ti,u_rotation_matrix:Tn}))(Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.frustumCorners.horizon,Be,gt,Ce,De,Ne,ot,Lt,Dt,qe);G.prepareDrawProgram(te,Pe);const jt=G.atmosphereBuffer;jt&&Pe.draw(te,pe.TRIANGLES,Le,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,ir,"skybox",jt.vertexBuffer,jt.indexBuffer,jt.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const G=this.style._layers[x[this.currentLayer]],re=c._getLayerSourceCache(G);G.isSky()&&this.renderLayer(this,re,G,re?O[re.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;){const G=this.style._layers[x[this.currentLayer]],re=c._getLayerSourceCache(G);if(G.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(G)){if(G.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const te=re?(G.type==="symbol"?j:O)[re.id]:void 0;this._renderTileClippingMasks(G,re,re?I[re.id]:void 0),this.renderLayer(this,re,G,te),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let G=null;a.values(this.style._layers).forEach(re=>{const te=c._getLayerSourceCache(re);te&&!re.isHidden(this.transform.zoom)&&(!G||G.getSource().maxzoom<te.getSource().maxzoom)&&(G=te)}),G&&this.options.showTileBoundaries&&ya.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const re=G.transform.padding;Oa(G,G.transform.height-(re.top||0),3,_a),Oa(G,re.bottom||0,3,ks),la(G,re.left||0,3,Eo),la(G,G.transform.width-(re.right||0),3,No);const te=G.transform.centerPoint;(function(pe,Ee,Le,Pe){to(pe,Ee-1,Le-10,2,20,Pe),to(pe,Ee-10,Le-1,20,2,Pe)})(G,te.x,G.transform.height-te.y,sa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(c,p,x,S){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="sky"||x.type==="custom"||S&&S.length)&&(this.id=x.id,this.gpuTimingStart(x),c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes(x.type)||ya[x.type](c,p,x,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;let x=this.gpuTimers[c.id];x||(x=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),x.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,p=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(p),c.beginQueryEXT(c.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const p={};for(const x in c){const S=c[x],I=this.context.extTimerQuery,O=I.getQueryObjectEXT(S.query,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(S.query),p[x]=O}return p}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery;let x=0;for(const S of c)x+=p.getQueryObjectEXT(S,p.QUERY_RESULT_EXT)/1e6,p.deleteQueryEXT(S);return x}translatePosMatrix(c,p,x,S,I){if(!x[0]&&!x[1])return c;const O=I?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(O){const re=Math.sin(O),te=Math.cos(O);x=[x[0]*te-x[1]*re,x[0]*re+x[1]*te]}const j=[I?x[0]:er(p,x[0],this.transform.zoom),I?x[1]:er(p,x[1],this.transform.zoom),0],G=new Float32Array(16);return a.translate(G,c,j),G}saveTileTexture(c){const p=this._tileTextures[c.size[0]];p?p.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const p=this._tileTextures[c];return p&&p.length>0?p.pop():null}isPatternMissing(c){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,p=this.terrain&&this.terrain.exaggeration()===0,x=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),p&&S.push("ZERO_EXAGGERATION"),x&&!c&&x.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),c&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(c,p,x){this.cache=this.cache||{};const S=x||[],I=this.currentGlobalDefines().concat(S),O=Ln.cacheKey(Is[c],c,I,p);return this.cache[O]||(this.cache[O]=new Ln(this.context,c,Is[c],p,co[c],I)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,p,x){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const I=S.getOpacity(this.transform.pitch),O=((j,G,re,te,pe,Ee,Le,Pe,Be,Ce,De)=>{const Ne=j.transform,Oe=G.properties.get("color").toArray01();Oe[3]=te;const qe=j.frameCounter/1e3%1;return{u_fog_matrix:re?Ne.calculateFogTileMatrix(re):j.identityMat,u_fog_range:G.getFovAdjustedRange(Ne._fov),u_fog_color:Oe,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:qe,u_frustum_tl:pe,u_frustum_tr:Ee,u_frustum_br:Le,u_frustum_bl:Pe,u_globe_pos:Be,u_globe_radius:Ce,u_viewport:De,u_globe_transition:a.globeToMercatorTransition(Ne.zoom),u_is_globe:+(Ne.projection.name==="globe")}})(this,S,x,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);p.setFogUniformValues(c,O)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const c=this.context.gl,p=c.createTexture();return c.bindTexture(c.TEXTURE_2D,p),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,p=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const S of x)p[S.key]=c[S.key]||new a.Tile(S,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}}class Zs{constructor(c=0,p=0,x=0,S=0){if(isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=x,this.right=S}interpolate(c,p,x){return p.top!=null&&c.top!=null&&(this.top=a.number(c.top,p.top,x)),p.bottom!=null&&c.bottom!=null&&(this.bottom=a.number(c.bottom,p.bottom,x)),p.left!=null&&c.left!=null&&(this.left=a.number(c.left,p.left,x)),p.right!=null&&c.right!=null&&(this.right=a.number(c.right,p.right,x)),this}getCenter(c,p){const x=a.clamp((this.left+c-this.right)/2,0,c),S=a.clamp((this.top+p-this.bottom)/2,0,p);return new a.pointGeometry(x,S)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ms(_,c){const p=a.getColumn(_,3);a.fromQuat(_,c),a.setColumn(_,3,p)}function ul(_,c){const p=a.identity$1([]);return a.rotateZ$1(p,p,-c),a.rotateX$1(p,p,-_),p}function kl(_,c){const p=[_[0],_[1],0],x=[c[0],c[1],0];if(a.length(p)>=1e-15){const O=a.normalize([],p);a.scale$2(x,O,a.dot(x,O)),c[0]=x[0],c[1]=x[1]}const S=a.cross([],c,_);if(a.len(S)<1e-15)return null;const I=Math.atan2(-S[1],S[0]);return ul(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),I)}class hl{constructor(c,p){this.position=c,this.orientation=p}get position(){return this._position}set position(c){if(c){const p=c instanceof a.MercatorCoordinate?c:new a.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(p.x=a.wrap(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(c,p){if(this.orientation=null,!this.position)return;const x=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(c)):0,S=this.position,I=a.MercatorCoordinate.fromLngLat(c,x),O=[I.x-S.x,I.y-S.y,I.z-S.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=kl(O,p)}setPitchBearing(c,p){this.orientation=ul(a.degToRad(c),a.degToRad(-p))}}class dl{constructor(c,p){this._transform=a.identity([]),this.orientation=p,this.position=c}get mercatorPosition(){const c=this.position;return new a.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=a.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var p;c&&a.setColumn(this._transform,3,[(p=c)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||a.identity$1([]),c&&ms(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,p){this._orientation=ul(c,p),ms(this._transform,this._orientation)}forward(){const c=a.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=a.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=a.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,p){const x=new Float64Array(16);return a.invert(x,this.getWorldToCamera(c,p)),x}getWorldToCameraPosition(c,p,x){const S=this.position;a.scale$2(S,S,-c);const I=new Float64Array(16);return a.fromScaling(I,[x,x,x]),a.translate(I,I,S),I[10]*=p,I}getWorldToCamera(c,p){const x=new Float64Array(16),S=new Float64Array(4),I=this.position;return a.conjugate(S,this._orientation),a.scale$2(I,I,-c),a.fromQuat(x,S),a.translate(x,x,I),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=p,x[9]*=p,x[10]*=p,x[11]*=p,x}getCameraToClipPerspective(c,p,x,S){const I=new Float64Array(16);return a.perspective(I,c,p,x,S),I}getDistanceToElevation(c,p=!1){const x=c===0?0:a.mercatorZfromAltitude(c,p?a.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(x-this.position[2])/S[2]}clone(){return new dl([...this.position],[...this.orientation])}}function Hs(_,c){const p=za(_.projection,_.zoom,_.width,_.height),x=function(I,O,j,G,re){const te=new a.LngLat(j.lng-180*Na,j.lat),pe=new a.LngLat(j.lng+180*Na,j.lat),Ee=I.project(te.lng,te.lat),Le=I.project(pe.lng,pe.lat),Pe=-Math.atan2(Le.y-Ee.y,Le.x-Ee.x),Be=a.MercatorCoordinate.fromLngLat(j);Be.y=a.clamp(Be.y,-.999975,.999975);const Ce=Be.toLngLat(),De=I.project(Ce.lng,Ce.lat),Ne=a.MercatorCoordinate.fromLngLat(Ce);Ne.x+=Na;const Oe=Ne.toLngLat(),qe=I.project(Oe.lng,Oe.lat),ot=fl(qe.x-De.x,qe.y-De.y,Pe),it=a.MercatorCoordinate.fromLngLat(Ce);it.y+=Na;const gt=it.toLngLat(),zt=I.project(gt.lng,gt.lat),Lt=fl(zt.x-De.x,zt.y-De.y,Pe),wt=Math.abs(ot.x)/Math.abs(Lt.y),Dr=a.identity([]);a.rotateZ(Dr,Dr,-Pe*(1-(re?0:G)));const Dt=a.identity([]);return a.scale(Dt,Dt,[1,1-(1-wt)*G,1]),Dt[4]=-Lt.x/Lt.y*G,a.rotateZ(Dt,Dt,Pe),a.multiply(Dt,Dr,Dt),Dt}(_.projection,0,_.center,p,c),S=Ps(_);return a.scale(x,x,[S,S,1]),x}function Ps(_){const c=_.projection,p=za(_.projection,_.zoom,_.width,_.height),x=Ws(c,_.center),S=Ws(c,a.LngLat.convert(c.center));return Math.pow(2,x*p+(1-p)*S)}function za(_,c,p,x,S=1/0){const I=_.range;if(!I)return 0;const O=Math.min(S,Math.max(p,x)),j=Math.log(O/1024)/Math.LN2;return a.smoothstep(I[0]+j,I[1]+j,c)}const Na=1/4e4;function Ws(_,c){const p=a.clamp(c.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),x=new a.LngLat(c.lng-180*Na,p),S=new a.LngLat(c.lng+180*Na,p),I=_.project(x.lng,p),O=_.project(S.lng,p),j=a.MercatorCoordinate.fromLngLat(x),G=a.MercatorCoordinate.fromLngLat(S),re=O.x-I.x,te=O.y-I.y,pe=G.x-j.x,Ee=G.y-j.y,Le=Math.sqrt((pe*pe+Ee*Ee)/(re*re+te*te));return Math.log(Le)/Math.LN2}function fl(_,c,p){const x=Math.cos(p),S=Math.sin(p);return{x:_*x-c*S,y:_*S+c*x}}class gs{constructor(c,p,x,S,I,O,j){this.tileSize=512,this._renderWorldCopies=I===void 0||I,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=x??0,this._maxPitch=S??60,this.setProjection(O),this.setMaxBounds(j),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new dl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new gs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,p=!1){const x=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||x)&&this._updateCameraOnTerrain(),(c||x)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const x=!b(p,this.getProjection());return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const p=c!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const p=-c*Math.PI/180;var x;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=(x=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x),function(S,I,O){var j=I[0],G=I[1],re=I[2],te=I[3],pe=Math.sin(O),Ee=Math.cos(O);S[0]=j*Ee+re*pe,S[1]=G*Ee+te*pe,S[2]=j*-pe+re*Ee,S[3]=G*-pe+te*Ee}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const p=a.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=a.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let S=0,I=0;for(let O=0;O<p.length;O++){const j=new a.pointGeometry(p[O][0]*this.width,x+p[O][1]*(this.height-x)),G=c.pointCoordinate(j);if(!G)continue;const re=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);S+=G[3]*re,I+=re}return I===0?NaN:S/I}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*p,S=this._mercatorZfromZoom(c),I=this._mercatorZfromZoom(this._maxZoom),O=Math.max(S-x,I);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let x;x=c.z<this._camera.position[2]?[p.x,p.y,p.z]:[c.x,c.y,c.z];const S=a.length(a.sub([],this._camera.position,x));return a.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let p=!1;if(c.orientation&&!a.exactEquals(c.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(c.orientation)),c.position){const x=[c.position.x,c.position.y,c.position.z];a.exactEquals$1(x,this._camera.position)||(this._setCameraPosition(x),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,p=new hl;return p.position=new a.MercatorCoordinate(c[0],c[1],c[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(c){if(!a.length$1(c))return!1;a.normalize$1(c,c);const p=a.transformQuat([],[0,0,-1],c),x=a.transformQuat([],[0,-1,0],c);if(x[2]<0)return!1;const S=kl(p,x);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(c){const p=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;c[2]=a.clamp(c[2],S/x,S/p),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,p,x){this._unmodified=!1,this._edgeInsets.interpolate(c,p,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(c){const p=[new a.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const x=this.pointCoordinate(new a.pointGeometry(0,0)),S=this.pointCoordinate(new a.pointGeometry(this.width,0)),I=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),O=this.pointCoordinate(new a.pointGeometry(0,this.height)),j=Math.floor(Math.min(x.x,S.x,I.x,O.x)),G=Math.floor(Math.max(x.x,S.x,I.x,O.x)),re=1;for(let te=j-re;te<=G+re;te++)te!==0&&p.push(new a.UnwrappedTileID(te,c))}return p}coveringTiles(c){let p=this.coveringZoomLevel(c);const x=p,S=this.elevation&&!c.isTerrainDEM,I=this.projection.name==="mercator";if(c.minzoom!==void 0&&p<c.minzoom)return[];c.maxzoom!==void 0&&p>c.maxzoom&&(p=c.maxzoom);const O=this.locationCoordinate(this.center),j=this.center.lat,G=1<<p,re=[G*O.x,G*O.y,0],te=this.projection.name==="globe",pe=!te,Ee=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,pe),Le=te?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Pe=G*a.mercatorZfromAltitude(1,this.center.lat),Be=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),Ce=[G*Le.x,G*Le.y,Be*(pe?1:Pe)],De=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),Ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?p:0,Oe=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,qe=c.isTerrainDEM?-Oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ot=this.projection.isReprojectedInTileSpace?Ps(this):1,it=Zt=>{const kr=new a.MercatorCoordinate(Zt.x+25e-6,Zt.y,Zt.z),Mt=new a.MercatorCoordinate(Zt.x,Zt.y+25e-6,Zt.z),Ut=Zt.toLngLat(),ai=kr.toLngLat(),wi=Mt.toLngLat(),si=this.locationCoordinate(Ut),ki=this.locationCoordinate(ai),qi=this.locationCoordinate(wi),Ei=Math.hypot(ki.x-si.x,ki.y-si.y),ti=Math.hypot(qi.x-si.x,qi.y-si.y);return Math.sqrt(Ei*ti)*ot/25e-6},gt=Zt=>{const fr=Oe,kr=qe;return{aabb:a.tileAABB(this,G,0,0,0,Zt,kr,fr,this.projection),zoom:0,x:0,y:0,minZ:kr,maxZ:fr,wrap:Zt,fullyVisible:!1}},zt=[];let Lt=[];const wt=p,Dr=c.reparseOverscaled?x:p,Dt=Zt=>Zt*Zt,ir=Dt((Be-this._centerAltitude)*Pe),jt=Zt=>{if(!this._elevation||!Zt.tileID||!I)return;const fr=this._elevation.getMinMaxForTile(Zt.tileID),kr=Zt.aabb;fr?(kr.min[2]=fr.min,kr.max[2]=fr.max,kr.center[2]=(kr.min[2]+kr.max[2])/2):(Zt.shouldSplit=wr(Zt),Zt.shouldSplit||(kr.min[2]=kr.max[2]=kr.center[2]=this._centerAltitude))},wr=Zt=>{if(Zt.zoom<Ne)return!0;if(Zt.zoom===wt)return!1;if(Zt.shouldSplit!=null)return Zt.shouldSplit;const fr=Zt.aabb.distanceX(Ce),kr=Zt.aabb.distanceY(Ce);let Mt=ir,Ut=1;if(te){Mt=Dt(Zt.aabb.distanceZ(Ce));const si=Math.pow(2,Zt.zoom),ki=a.latFromMercatorY((Zt.y+1)/si),qi=a.latFromMercatorY(Zt.y/si),Ei=Math.min(Math.max(j,ki),qi),ti=a.circumferenceAtLatitude(Ei)/a.circumferenceAtLatitude(j);if(Ut=Ei===j?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ti/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Zt.zoom===wt-1&&ti>=.9)return!0}else if(S&&(Mt=Dt(Zt.aabb.distanceZ(Ce)*Pe)),this.projection.isReprojectedInTileSpace&&x<=5){const si=Math.pow(2,Zt.zoom),ki=it(new a.MercatorCoordinate((Zt.x+.5)/si,(Zt.y+.5)/si));Ut=ki>.85?1:ki}const ai=fr*fr+kr*kr+Mt,wi=Dt((1<<wt-Zt.zoom)*De*Ut*((si,ki)=>{if(ki*Dt(.707)<si)return 1;const qi=Math.sqrt(ki/si);return qi/(1.4144271570014144+(Math.pow(1.1,qi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Mt,ir),ai));return ai<wi};if(this.renderWorldCopies)for(let Zt=1;Zt<=3;Zt++)zt.push(gt(-Zt)),zt.push(gt(Zt));for(zt.push(gt(0));zt.length>0;){const Zt=zt.pop(),fr=Zt.x,kr=Zt.y;let Mt=Zt.fullyVisible;if(!Mt){const Ut=Zt.aabb.intersects(Ee);if(Ut===0)continue;Mt=Ut===2}if(Zt.zoom!==wt&&wr(Zt))for(let Ut=0;Ut<4;Ut++){const ai=(fr<<1)+Ut%2,wi=(kr<<1)+(Ut>>1),si={aabb:I?Zt.aabb.quadrant(Ut):a.tileAABB(this,G,Zt.zoom+1,ai,wi,Zt.wrap,Zt.minZ,Zt.maxZ,this.projection),zoom:Zt.zoom+1,x:ai,y:wi,wrap:Zt.wrap,fullyVisible:Mt,tileID:void 0,shouldSplit:void 0,minZ:Zt.minZ,maxZ:Zt.maxZ};S&&!te&&(si.tileID=new a.OverscaledTileID(Zt.zoom+1===wt?Dr:Zt.zoom+1,Zt.wrap,Zt.zoom+1,ai,wi),jt(si)),zt.push(si)}else{const Ut=Zt.zoom===wt?Dr:Zt.zoom;if(c.minzoom&&c.minzoom>Ut)continue;const ai=re[0]-(.5+fr+(Zt.wrap<<Zt.zoom))*(1<<p-Zt.zoom),wi=re[1]-.5-kr,si=Zt.tileID?Zt.tileID:new a.OverscaledTileID(Ut,Zt.wrap,Zt.zoom,fr,kr);Lt.push({tileID:si,distanceSq:ai*ai+wi*wi})}}if(this.fogCullDistSq){const Zt=this.fogCullDistSq,fr=this.horizonLineFromTop();Lt=Lt.filter(kr=>{const Mt=[0,0,0,1],Ut=[a.EXTENT,a.EXTENT,0,1],ai=this.calculateFogTileMatrix(kr.tileID.toUnwrapped());a.transformMat4$1(Mt,Mt,ai),a.transformMat4$1(Ut,Ut,ai);const wi=a.getAABBPointSquareDist(Mt,Ut);if(wi===0)return!0;let si=!1;const ki=this._elevation;if(ki&&wi>Zt&&fr!==0){const qi=this.calculateProjMatrix(kr.tileID.toUnwrapped());let Ei;c.isTerrainDEM||(Ei=ki.getMinMaxForTile(kr.tileID)),Ei||(Ei={min:qe,max:Oe});const ti=a.furthestTileCorner(this.rotation),Tn=[ti[0]*a.EXTENT,ti[1]*a.EXTENT,Ei.max];a.transformMat4(Tn,Tn,qi),si=(1-Tn[1])*this.height*.5<fr}return wi<Zt||si})}return Lt.sort((Zt,fr)=>Zt.distanceSq-fr.distanceSq).map(Zt=>Zt.tileID)}resize(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const p=a.clamp(c.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),x=this.projection.project(c.lng,p);return new a.pointGeometry(x.x*this.worldSize,x.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(c,p){let x,S;const I=this.centerPoint;if(this.projection.name==="globe"){const j=this.worldSize;x=(p.x-I.x)/j,S=(p.y-I.y)/j}else{const j=this.pointCoordinate(p),G=this.pointCoordinate(I);x=j.x-G.x,S=j.y-G.y}const O=this.locationCoordinate(c);this.setLocation(new a.MercatorCoordinate(O.x-x,O.y-S))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,p){const x=p?a.mercatorZfromAltitude(p,c.lat):void 0,S=this.projection.project(c.lng,c.lat);return new a.MercatorCoordinate(S.x,S.y,x)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,p){const x=p??this._centerAltitude,S=[c.x,c.y,0,1],I=[c.x,c.y,1,1];a.transformMat4$1(S,S,this.pixelMatrixInverse),a.transformMat4$1(I,I,this.pixelMatrixInverse);const O=I[3];a.scale$1(S,S,1/S[3]),a.scale$1(I,I,1/O);const j=S[2],G=I[2];return{p0:S,p1:I,t:j===G?0:(x-j)/(G-j)}}screenPointToMercatorRay(c){const p=[c.x,c.y,0,1],x=[c.x,c.y,1,1];return a.transformMat4$1(p,p,this.pixelMatrixInverse),a.transformMat4$1(x,x,this.pixelMatrixInverse),a.scale$1(p,p,1/p[3]),a.scale$1(x,x,1/x[3]),p[2]=a.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,x[2]=a.mercatorZfromAltitude(x[2],this._center.lat)*this.worldSize,a.scale$1(p,p,1/this.worldSize),a.scale$1(x,x,1/this.worldSize),new a.Ray([p[0],p[1],p[2]],a.normalize([],a.sub([],x,p)))}rayIntersectionCoordinate(c){const{p0:p,p1:x,t:S}=c,I=a.mercatorZfromAltitude(p[2],this._center.lat),O=a.mercatorZfromAltitude(x[2],this._center.lat);return new a.MercatorCoordinate(a.number(p[0],x[0],S)/this.worldSize,a.number(p[1],x[1],S)/this.worldSize,a.number(I,O,S))}pointCoordinate(c,p=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,p)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let p=this.projection.pointCoordinate3D(this,c.x,c.y);if(p)return new a.MercatorCoordinate(p[0],p[1],p[2]);let x=0,S=this.horizonLineFromTop();if(c.y>S)return this.pointCoordinate(c);const I=.02*S,O=c.clone();for(let j=0;j<10&&S-x>I;j++){O.y=a.number(x,S,.66);const G=this.projection.pointCoordinate3D(this,O.x,O.y);G?(S=O.y,p=G):x=O.y}return p?new a.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}_coordinatePoint(c,p){const x=p&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,S=[c.x*this.worldSize,c.y*this.worldSize,x+c.toAltitude(),1];return a.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new a.pointGeometry(S[0]/S[3],S[1]/S[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:c,left:p}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,I=this.pointCoordinate3D(new a.pointGeometry(p,c)),O=this.pointCoordinate3D(new a.pointGeometry(S,c)),j=this.pointCoordinate3D(new a.pointGeometry(S,x)),G=this.pointCoordinate3D(new a.pointGeometry(p,x));let re=Math.min(I.x,G.x),te=Math.max(O.x,j.x),pe=Math.min(I.y,O.y),Ee=Math.max(G.y,j.y);const Le=Math.pow(2,-this.zoom)/16,Pe=(it,gt,zt,Lt)=>{const wt=(it+zt)/2,Dr=(gt+Lt)/2,Dt=new a.pointGeometry(wt,Dr),ir=this.pointCoordinate3D(Dt),jt=Math.max(0,re-ir.x,pe-ir.y,ir.x-te,ir.y-Ee);re=Math.min(re,ir.x),te=Math.max(te,ir.x),pe=Math.min(pe,ir.y),Ee=Math.max(Ee,ir.y),jt>Le&&(Pe(it,gt,wt,Dr),Pe(wt,Dr,zt,Lt))};Pe(p,c,S,c),Pe(S,c,S,x),Pe(S,x,p,x),Pe(p,x,p,c);const[Be,Ce]=a.polesInViewport(this),De=Be||Ce,Ne=Be?90:a.latFromMercatorY(pe),Oe=De?180:a.lngFromMercatorX(te),qe=Ce?-90:a.latFromMercatorY(Ee),ot=De?-180:a.lngFromMercatorX(re);return new a.LngLatBounds(new a.LngLat(ot,qe),new a.LngLat(Oe,Ne))}_getBounds(c,p){if(this.projection.name==="globe")return this._getGlobeBounds();const x=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),S=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),I=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),O=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let j=this.pointCoordinate(x,c),G=this.pointCoordinate(S,c);const re=this.pointCoordinate(I,p),te=this.pointCoordinate(O,p),pe=(Ee,Le)=>(Le.y-Ee.y)/(Le.x-Ee.x);return j.y>1&&G.y>=0?j=new a.MercatorCoordinate((1-te.y)/pe(te,j)+te.x,1):j.y<0&&G.y<=1&&(j=new a.MercatorCoordinate(-te.y/pe(te,j)+te.x,0)),G.y>1&&j.y>=0?G=new a.MercatorCoordinate((1-re.y)/pe(re,G)+re.x,1):G.y<0&&j.y<=1&&(G=new a.MercatorCoordinate(-re.y/pe(re,G)+re.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(re))}_getBounds3D(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBounds(0,0);const p=c.visibleDemTiles.reduce((x,S)=>{if(S.dem){const I=S.dem.tree;x.min=Math.min(x.min,I.minimums[0]),x.max=Math.max(x.max,I.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});return this._getBounds(p.min*c.exaggeration(),p.max*c.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(c=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,x=this.height/2-p*(1-this._horizonShift);return c?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,p){return this.projection.createTileMatrix(this,p,c)}calculateDistanceTileData(c){const p=c.key,x=this._distanceTileDataCache;if(x[p])return x[p];const S=c.canonical,I=1/this.height,O=this.cameraWorldSize,j=O/this.zoomScale(S.z),G=(S.x+Math.pow(2,S.z)*c.wrap)*j,re=S.y*j,te=this.point;te.x*=O/this.worldSize,te.y*=O/this.worldSize;const pe=this.angle,Ee=Math.sin(-pe),Le=-Math.cos(-pe);return x[p]={bearing:[Ee,Le],center:[(te.x-G)*I,(te.y-re)*I],scale:j/a.EXTENT*I},x[p]}calculateFogTileMatrix(c){const p=c.key,x=this._fogTileMatrixCache;if(x[p])return x[p];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return a.multiply(S,this.worldToFogMatrix,S),x[p]=new Float32Array(S),x[p]}calculateProjMatrix(c,p=!1){const x=c.key,S=p?this._alignedProjMatrixCache:this._projMatrixCache;if(S[x])return S[x];const I=this.calculatePosMatrix(c,this.worldSize);return a.multiply(I,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.alignedProjMatrix:this.projMatrix,I),S[x]=new Float32Array(I),S[x]}calculatePixelsToTileUnitsMatrix(c){const p=c.tileID.key,x=this._pixelsToTileUnitsCache;if(x[p])return x[p];const S=function(I,O){const{scale:j}=I.tileTransform,G=j*a.EXTENT/(I.tileSize*Math.pow(2,O.zoom-I.tileID.overscaledZ+I.tileID.canonical.z));return re=new Float32Array(4),Ee=(te=O.inverseAdjustmentMatrix)[1],Le=te[2],Pe=te[3],Ce=(pe=[G,G])[1],re[0]=te[0]*(Be=pe[0]),re[1]=Ee*Be,re[2]=Le*Ce,re[3]=Pe*Ce,re;var re,te,pe,Ee,Le,Pe,Be,Ce}(c,this);return x[p]=S,x[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const p=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),S=this._camera.forward(),I=a.mercatorZfromAltitude(1,this._center.lat);x[2]/=I,S[2]/=I,a.normalize(S,S);const O=c.raycast(x,S,c.exaggeration());if(O){const j=a.scaleAndAdd([],x,S,O),G=new a.MercatorCoordinate(j[0],j[1],a.mercatorZfromAltitude(j[2],a.latFromMercatorY(j[1]))),re=(G.z+a.length([G.x-x[0],G.y-x[1],G.z-x[2]*I]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(re),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const p=this._elevation,x=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(x),I=p.getAtPointOrZero(new a.MercatorCoordinate(...S)),O=this.pixelsPerMeter/this.worldSize*I,j=this._minimumHeightOverTerrain(),G=S[2]-O;if(G<=j)if(G<0||c){const re=this.locationCoordinate(this._center,this._centerAltitude),te=[S[0],S[1],re.z-S[2]],pe=a.length(te);te[2]-=(j-G)/this._pixelsPerMercatorPixel;const Ee=a.length(te);if(Ee===0)return;a.scale$2(te,te,pe/Ee*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],re.z*this._pixelsPerMercatorPixel-te[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const Ee=this.center;return Ee.lat=a.clamp(Ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(Ee.lng=a.clamp(Ee.lng,this.minLng,this.maxLng)),this.center=Ee,void(this._constraining=!1)}const p=this._unmodified,{x,y:S}=this.point;let I=0,O=x,j=S;const G=this.width/2,re=this.height/2,te=this.worldMinY*this.scale,pe=this.worldMaxY*this.scale;if(S-re<te&&(j=te+re),S+re>pe&&(j=pe-re),pe-te<this.height&&(I=Math.max(I,this.height/(pe-te)),j=(pe+te)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ee=this.worldMinX*this.scale,Le=this.worldMaxX*this.scale,Pe=this.worldSize/2-(Ee+Le)/2;O=(x+Pe+this.worldSize)%this.worldSize-Pe,O-G<Ee&&(O=Ee+G),O+G>Le&&(O=Le-G),Le-Ee<this.width&&(I=Math.max(I,this.width/(Le-Ee)),O=(Le+Ee)/2)}O===x&&j===S||(this.center=this.unproject(new a.pointGeometry(O,j))),I&&(this.zoom+=this.scaleZoom(I)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const x=za(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?p:1),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-c.x/this.width,I[9]=2*c.y/this.height;let O=a.mul([],I,S);if(this.projection.isReprojectedInTileSpace){const ot=this.locationCoordinate(this.center),it=a.identity([]);a.translate(it,it,[ot.x*this.worldSize,ot.y*this.worldSize,0]),a.multiply(it,it,Hs(this)),a.translate(it,it,[-ot.x*this.worldSize,-ot.y*this.worldSize,0]),a.multiply(O,O,it),this.inverseAdjustmentMatrix=function(gt){const zt=Hs(gt,!0);return be([],[zt[0],zt[1],zt[4],zt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],O,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=O,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const j=a.invert([],I);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height);const G=new Float32Array(16);a.identity(G),a.scale(G,G,[1,-1,1]),a.rotateX(G,G,this._pitch),a.rotateZ(G,G,this.angle);const re=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;re[8]=2*-c.x/this.width,re[9]=2*(c.y+te)/this.height,this.skyboxMatrix=a.multiply(G,re,G);const pe=this.point,Ee=pe.x,Le=pe.y,Pe=this.width%2/2,Be=this.height%2/2,Ce=Math.cos(this.angle),De=Math.sin(this.angle),Ne=Ee-Math.round(Ee)+Ce*Pe+De*Be,Oe=Le-Math.round(Le)+Ce*Be+De*Pe,qe=new Float64Array(O);if(a.translate(qe,qe,[Ne>.5?Ne-1:Ne,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=qe,O=a.create(),a.scale(O,O,[this.width/2,-this.height/2,1]),a.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=a.create(),a.scale(O,O,[1,-1,1]),a.translate(O,O,[-1,-1,0]),a.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=a.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ot=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ot,ot,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,x=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,I=[c,c,p];a.scale$2(I,I,S),a.scale$2(x,x,-1),a.multiply$2(x,x,I);const O=a.create();a.translate(O,O,x),a.scale(O,O,I),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,p,S)}_computeCameraPosition(c){const p=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),S=this.point,I=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-c/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-x[0]*I,S.y/this.worldSize-x[1]*I,c/this.worldSize*this._centerAltitude-x[2]*I]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=this._camera.position[2],S=c[2];let I=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(I=Math.min((p-x)/S,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,c,I),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,p=this._camera.forward(),{pitch:x,bearing:S}=this._camera.getPitchBearing(),I=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),j=Math.max((c[2]-I)/Math.cos(x),O),G=this._zoomFromMercatorZ(j);a.scaleAndAdd(c,c,p,j),this._pitch=a.clamp(x,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(S,-Math.PI,Math.PI),this._setZoom(a.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){const p=O=>{const j=this.getCameraToCenterDistance(this.projection,O);return this.scaleZoom(j/(c*this.tileSize))};let x,S=p(this.zoom),I=Math.abs(S-p(S));for(;x!==I;)S=p(S),x=I,I=Math.abs(S-p(S));return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,p){const x=Math.min(c.x,p.x),S=Math.max(c.x,p.x),I=Math.min(c.y,p.y),O=Math.max(c.y,p.y);if(I<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const j=[new a.pointGeometry(x,I),new a.pointGeometry(S,O),new a.pointGeometry(x,O),new a.pointGeometry(S,I)],G=this.renderWorldCopies?-3:0,re=this.renderWorldCopies?4:1;for(const te of j){const pe=this.pointRayIntersection(te);if(pe.t<0)return!0;const Ee=this.rayIntersectionCoordinate(pe);if(Ee.x<G||Ee.y<0||Ee.x>re||Ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(c,p){const x=a.length(a.sub([],this._camera.position,c)),S=this._zoomFromMercatorZ(x)+p;return x-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([p,x,S],I){const O=[p,x,S,1];a.transformMat4$1(O,O,I);const j=O[3]=Math.max(O[3],1e-6);return O[0]/=j,O[1]/=j,O[2]/=j,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,c))}}getCameraToCenterDistance(c,p=this.zoom){const x=za(c,p,this.width,this.height,1024),S=c.pixelSpaceConversion(this.center.lat,this.worldSize,x);return .5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(c,c,this.globeMatrix),c}}function Ls(_,c){let p=!1,x=null;const S=()=>{x=null,p&&(_(),x=setTimeout(S,c),p=!1)};return()=>(p=!0,x||S(),x)}class Hr{constructor(c){this._hashName=c&&encodeURIComponent(c),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ls(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,a.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const p=Ko(c);if(this._hashName){const x=this._hashName;let S=!1;const I=a.window.location.hash.slice(1).split("&").map(O=>{const j=O.split("=")[0];return j===x?(S=!0,`${j}=${p}`):O}).filter(O=>O);return S||I.push(`${x}=${p}`),`#${I.join("&")}`}return`#${p}`}_getCurrentHash(){const c=a.window.location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(p=x)}),(p&&p[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(x=>isNaN(x))){const x=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(p[3]||0):c.getBearing();return c.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:x,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,c)}}function Ko(_,c){const p=_.getCenter(),x=Math.round(100*_.getZoom())/100,S=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,S),O=Math.round(p.lng*I)/I,j=Math.round(p.lat*I)/I,G=_.getBearing(),re=_.getPitch();let te=c?`/${O}/${j}/${x}`:`${x}/${j}/${O}`;return(G||re)&&(te+="/"+Math.round(10*G)/10),re&&(te+=`/${Math.round(re)}`),te}const Rs={linearity:.3,easing:a.bezier(0,0,.3,1)},Pl=a.extend({deceleration:2500,maxSpeed:1400},Rs),Ll=a.extend({deceleration:20,maxSpeed:1400},Rs),_s=a.extend({deceleration:1e3,maxSpeed:360},Rs),Rl=a.extend({deceleration:1e3,maxSpeed:90},Rs);class Ys{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,p=a.exported.now();for(;c.length>0&&p-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:I}of this._inertiaBuffer)p.zoom+=I.zoomDelta||0,p.bearing+=I.bearingDelta||0,p.pitch+=I.pitchDelta||0,I.panDelta&&p.pan._add(I.panDelta),I.around&&(p.around=I.around),I.pinchAround&&(p.pinchAround=I.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(p.pan.mag()){const I=Qa(p.pan.mag(),x,a.extend({},Pl,c||{}));S.offset=p.pan.mult(I.amount/p.pan.mag()),S.center=this._map.transform.center,ys(S,I)}if(p.zoom){const I=Qa(p.zoom,x,Ll);S.zoom=this._map.transform.zoom+I.amount,ys(S,I)}if(p.bearing){const I=Qa(p.bearing,x,_s);S.bearing=this._map.transform.bearing+a.clamp(I.amount,-179,179),ys(S,I)}if(p.pitch){const I=Qa(p.pitch,x,Rl);S.pitch=this._map.transform.pitch+I.amount,ys(S,I)}if(S.zoom||S.bearing){const I=p.pinchAround===void 0?p.around:p.pinchAround;S.around=I?this._map.unproject(I):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function ys(_,c){(!_.duration||_.duration<c.duration)&&(_.duration=c.duration,_.easing=c.easing)}function Qa(_,c,p){const{maxSpeed:x,linearity:S,deceleration:I}=p,O=a.clamp(_*S/(c/1e3),-x,x),j=Math.abs(O)/(I*S);return{easing:p.easing,duration:1e3*j,amount:O*(j/2)}}class Co extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,x,S={}){const I=ue(p.getCanvasContainer(),x),O=p.unproject(I);super(c,a.extend({point:I,lngLat:O,originalEvent:x},S)),this._defaultPrevented=!1,this.target=p}}class Bs extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,x){const S=c==="touchend"?x.changedTouches:x.touches,I=Re(p.getCanvasContainer(),S),O=I.map(G=>p.unproject(G)),j=I.reduce((G,re,te,pe)=>G.add(re.div(pe.length)),new a.pointGeometry(0,0));super(c,{points:I,point:j,lngLats:O,lngLat:p.unproject(j),originalEvent:x}),this._defaultPrevented=!1}}class vs extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,x){super(c,{originalEvent:x}),this._defaultPrevented=!1}}class ac{constructor(c,p){this._map=c,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new vs(c.type,this._map,c))}mousedown(c,p){return this._mousedownPos=p,this._firePreventable(new Co(c.type,this._map,c))}mouseup(c){this._map.fire(new Co(c.type,this._map,c))}preclick(c){const p=a.extend({},c);p.type="preclick",this._map.fire(new Co(p.type,this._map,p))}click(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Co(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Co(c.type,this._map,c))}mouseover(c){this._map.fire(new Co(c.type,this._map,c))}mouseout(c){this._map.fire(new Co(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Bs(c.type,this._map,c))}touchmove(c){this._map.fire(new Bs(c.type,this._map,c))}touchend(c){this._map.fire(new Bs(c.type,this._map,c))}touchcancel(c){this._map.fire(new Bs(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sc{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Co(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Co("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Co(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bl{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,p){this.isEnabled()&&c.shiftKey&&c.button===0&&(X(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(c,p){if(!this._active)return;const x=p,S=this._startPos,I=this._lastPos;if(!S||!I||I.equals(x)||!this._box&&x.dist(S)<this._clickTolerance)return;this._lastPos=x,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const O=Math.min(S.x,x.x),j=Math.max(S.x,x.x),G=Math.min(S.y,x.y),re=Math.max(S.y,x.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${G}px)`,this._box.style.width=j-O+"px",this._box.style.height=re-G+"px")})}mouseupWindow(c,p){if(!this._active)return;const x=this._startPos,S=p;if(x&&c.button===0){if(this.reset(),le(),x.x!==S.x||x.y!==S.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:I=>I.fitScreenCoordinates(x,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ye(),delete this._startPos,delete this._lastPos}_fireEvent(c,p){return this._map.fire(new a.Event(c,{originalEvent:p}))}}function xs(_,c){const p={};for(let x=0;x<_.length;x++)p[_[x].identifier]=c[x];return p}class pl{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,p,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),x.length===this.numTouches&&(this.centroid=function(S){const I=new a.pointGeometry(0,0);for(const O of S)I._add(O);return I.div(S.length)}(p),this.touches=xs(x,p)))}touchmove(c,p,x){if(this.aborted||!this.centroid)return;const S=xs(x,p);for(const I in this.touches){const O=this.touches[I],j=S[I];(!j||j.dist(O)>30)&&(this.aborted=!0)}}touchend(c,p,x){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class Ks{constructor(c){this.singleTap=new pl(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,p,x){this.singleTap.touchstart(c,p,x)}touchmove(c,p,x){this.singleTap.touchmove(c,p,x)}touchend(c,p,x){const S=this.singleTap.touchend(c,p,x);if(S){const I=c.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(S)<30;if(I&&O||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Ol{constructor(){this._zoomIn=new Ks({numTouches:1,numTaps:2}),this._zoomOut=new Ks({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,p,x){this._zoomIn.touchstart(c,p,x),this._zoomOut.touchstart(c,p,x)}touchmove(c,p,x){this._zoomIn.touchmove(c,p,x),this._zoomOut.touchmove(c,p,x)}touchend(c,p,x){const S=this._zoomIn.touchend(c,p,x),I=this._zoomOut.touchend(c,p,x);return S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(S)},{originalEvent:c})}):I?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(I)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qs={0:1,2:2};class Os{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,p){return!1}_move(c,p){return{}}mousedown(c,p){if(this._lastPoint)return;const x=ze(c);this._correctButton(c,x)&&(this._lastPoint=p,this._eventButton=x)}mousemoveWindow(c,p){const x=this._lastPoint;if(x){if(c.preventDefault(),this._eventButton!=null&&function(S,I){const O=Qs[I];return S.buttons===void 0||(S.buttons&O)!==O}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(x,p)}}mouseupWindow(c){this._lastPoint&&ze(c)===this._eventButton&&(this._moved&&le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl extends Os{mousedown(c,p){super.mousedown(c,p),this._lastPoint&&(this._active=!0)}_correctButton(c,p){return p===0&&!c.ctrlKey}_move(c,p){return{around:p,panDelta:p.sub(c)}}}class ml extends Os{_correctButton(c,p){return p===0&&c.ctrlKey||p===2}_move(c,p){const x=.8*(p.x-c.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(c){c.preventDefault()}}class gl extends Os{_correctButton(c,p){return p===0&&c.ctrlKey||p===2}_move(c,p){const x=-.5*(p.y-c.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(c){c.preventDefault()}}class zl{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(c,p,x){return this._calculateTransform(c,p,x)}touchmove(c,p,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(x.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,p,x)}}touchend(c,p,x){this._calculateTransform(c,p,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,p,x){x.length>0&&(this._active=!0);const S=xs(x,p),I=new a.pointGeometry(0,0),O=new a.pointGeometry(0,0);let j=0;for(const re in S){const te=S[re],pe=this._touches[re];pe&&(I._add(te),O._add(te.sub(pe)),j++,S[re]=te)}if(this._touches=S,j<this._minTouches||!O.mag())return;const G=O.div(j);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:I.div(j),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Js{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,p,x){return{}}touchstart(c,p,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([p[0],p[1]]))}touchmove(c,p,x){const S=this._firstTwoTouches;if(!S)return;c.preventDefault();const[I,O]=S,j=Ta(x,p,I),G=Ta(x,p,O);if(!j||!G)return;const re=this._aroundCenter?null:j.add(G).div(2);return this._move([j,G],re,c)}touchend(c,p,x){if(!this._firstTwoTouches)return;const[S,I]=this._firstTwoTouches,O=Ta(x,p,S),j=Ta(x,p,I);O&&j||(this._active&&le(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ta(_,c,p){for(let x=0;x<_.length;x++)if(_[x].identifier===p)return c[x]}function _l(_,c){return Math.log(_/c)/Math.LN2}class Nl extends Js{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,p){const x=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(_l(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_l(this._distance,x),pinchAround:p}}}function Ul(_,c){return 180*_.angleWith(c)/Math.PI}class $l extends Js{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,p){const x=this._vector;if(this._vector=c[0].sub(c[1]),x&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ul(this._vector,x),pinchAround:p}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const p=25/(Math.PI*this._minDiameter)*360,x=this._startVector;if(!x)return!1;const S=Ul(c,x);return Math.abs(S)<p}}function el(_){return Math.abs(_.y)>Math.abs(_.x)}class jl extends Js{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,el(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,p,x){const S=this._lastPoints;if(!S)return;const I=c[0].sub(S[0]),O=c[1].sub(S[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&x.touches.length<3||(this._valid=this.gestureBeginsVertically(I,O,x.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(I.y+O.y)/2*-.5})}gestureBeginsVertically(c,p,x){if(this._valid!==void 0)return this._valid;const S=c.mag()>=2,I=p.mag()>=2;if(!S&&!I)return;if(!S||!I)return this._firstMove==null&&(this._firstMove=x),x-this._firstMove<100&&void 0;const O=c.y>0==p.y>0;return el(c)&&el(p)&&O}}const Vl={panStep:100,bearingStep:15,pitchStep:10};class To{constructor(){const c=Vl;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let p=0,x=0,S=0,I=0,O=0;switch(c.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:c.shiftKey?x=-1:(c.preventDefault(),I=-1);break;case 39:c.shiftKey?x=1:(c.preventDefault(),I=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),O=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(x=0,S=0),{cameraAnimation:j=>{const G=j.getZoom();j.easeTo({duration:300,easeId:"keyboardHandler",easing:lc,zoom:p?Math.round(G)+p*(c.shiftKey?2:1):G,bearing:j.getBearing()+x*this._bearingStep,pitch:j.getPitch()+S*this._pitchStep,offset:[-I*this._panStep,-O*this._panStep],center:j.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lc(_){return _*(2-_)}const yl=4.000244140625;class cc{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=c.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const x=a.exported.now(),S=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,p!==0&&p%yl==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(S*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=ue(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>yl?this._wheelZoomRate:this._defaultZoomRate;let re=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&re!==0&&(re=1/re);const te=p(),pe=Math.pow(2,te),Ee=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):pe;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(Ee*re))),this._type==="wheel"&&(this._startZoom=te,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:p(),S=this._startZoom,I=this._easing;let O,j=!1;if(this._type==="wheel"&&S&&I){const G=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),re=I(G);O=a.number(S,x,re),G<1?this._frameId||(this._frameId=!0):j=!0}else O=x,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:O-p(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let p=a.ease;if(this._prevEase){const x=this._prevEase,S=(a.exported.now()-x.start)/x.duration,I=x.easing(S+.01)-x.easing(S),O=.27/Math.sqrt(I*I+1e-4)*.01,j=Math.sqrt(.0729-O*O);p=a.bezier(O,j,.25,1)}return this._prevEase={start:a.exported.now(),duration:c,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class uc{constructor(c,p){this._clickZoom=c,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class E{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,p){return c.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(c.shiftKey?-1:1),around:x.unproject(p)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M{constructor(){this._tap=new Ks({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,p,x){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=p[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(c,p,x))}touchmove(c,p,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const S=p[0],I=S.y-this._swipePoint.y;return this._swipePoint=S,c.preventDefault(),this._active=!0,{zoomDelta:I/128}}}else this._tap.touchmove(c,p,x)}touchend(c,p,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(c,p,x)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class D{constructor(c,p,x){this._el=c,this._mousePan=p,this._touchPan=x}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class B{constructor(c,p,x){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ${constructor(c,p,x,S){this._el=c,this._touchZoom=p,this._touchRotate=x,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const U=_=>_.zoom||_.drag||_.pitch||_.rotate;class Z extends a.Event{}class K{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,p){const x=a.sub([],p,c);this.radius=a.length(x[2]<0?a.div([],x,this.constants):[x[0],x[1],0])}projectRay(c){a.div(c,c,this.constants),a.normalize(c,c),a.mul$1(c,c,this.constants);const p=a.scale$2([],c,this.radius);if(p[2]>0){const x=a.scale$2([],[0,0,1],a.dot(p,[0,0,1])),S=a.scale$2([],a.normalize([],[p[0],p[1],0]),this.radius),I=a.add([],p,a.scale$2([],a.sub([],a.add([],S,x),p),2));p[0]=I[0],p[1]=I[1]}return p}}function me(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class we{constructor(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ys(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new K,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),a.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[S,I,O]of this._listeners)S.addEventListener(I,S===a.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[c,p,x]of this._listeners)c.removeEventListener(p,c===a.window.document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(c){const p=this._map,x=p.getCanvasContainer();this._add("mapEvent",new ac(p,c));const S=p.boxZoom=new Bl(p,c);this._add("boxZoom",S);const I=new Ol,O=new E;p.doubleClickZoom=new uc(O,I),this._add("tapZoom",I),this._add("clickZoom",O);const j=new M;this._add("tapDragZoom",j);const G=p.touchPitch=new jl(p);this._add("touchPitch",G);const re=new ml(c),te=new gl(c);p.dragRotate=new B(c,re,te),this._add("mouseRotate",re,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);const pe=new Fl(c),Ee=new zl(p,c);p.dragPan=new D(x,pe,Ee),this._add("mousePan",pe),this._add("touchPan",Ee,["touchZoom","touchRotate"]);const Le=new $l,Pe=new Nl;p.touchZoomRotate=new $(x,Pe,Le,j),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",Pe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new sc(p));const Be=p.scrollZoom=new cc(p,this);this._add("scrollZoom",Be,["mousePan"]);const Ce=p.keyboard=new To;this._add("keyboard",Ce);for(const De of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[De]&&p[De].enable(c[De])}_add(c,p,x){this._handlers.push({handlerName:c,handler:p,allowed:x}),this._handlersById[c]=p}stop(c){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!U(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,p,x){for(const S in c)if(S!==x&&(!p||p.indexOf(S)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const p=[];for(const x of c)this._el.contains(x.target)&&p.push(x);return p}handleEvent(c,p){this._updatingCamera=!0;const x=c.type==="renderFrame",S=x?void 0:c,I={needsRenderFrame:!1},O={},j={},G=c.touches?this._getMapTouches(c.touches):void 0,re=G?Re(this._el,G):x?void 0:ue(this._el,c);for(const{handlerName:Ee,handler:Le,allowed:Pe}of this._handlers){if(!Le.isEnabled())continue;let Be;this._blockedByActive(j,Pe,Ee)?Le.reset():Le[p||c.type]&&(Be=Le[p||c.type](c,re,G),this.mergeHandlerResult(I,O,Be,Ee,S),Be&&Be.needsRenderFrame&&this._triggerRenderFrame()),(Be||Le.isActive())&&(j[Ee]=Le)}const te={};for(const Ee in this._previousActiveHandlers)j[Ee]||(te[Ee]=S);this._previousActiveHandlers=j,(Object.keys(te).length||me(I))&&(this._changes.push([I,O,te]),this._triggerRenderFrame()),(Object.keys(j).length||me(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:pe}=I;pe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],pe(this._map))}mergeHandlerResult(c,p,x,S,I){if(!x)return;a.extend(c,x);const O={handlerName:S,originalEvent:x.originalEvent||I};x.zoomDelta!==void 0&&(p.zoom=O),x.panDelta!==void 0&&(p.drag=O),x.pitchDelta!==void 0&&(p.pitch=O),x.bearingDelta!==void 0&&(p.rotate=O)}_applyChanges(){const c={},p={},x={};for(const[S,I,O]of this._changes)S.panDelta&&(c.panDelta=(c.panDelta||new a.pointGeometry(0,0))._add(S.panDelta)),S.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(c.around=S.around),S.aroundCoord!==void 0&&(c.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(c.pinchAround=S.pinchAround),S.noInertia&&(c.noInertia=S.noInertia),a.extend(p,I),a.extend(x,O);this._updateMapTransform(c,p,x),this._changes=[]}_updateMapTransform(c,p,x){const S=this._map,I=S.transform,O=Ne=>[Ne.x,Ne.y,Ne.z];if((Ne=>{const Oe=this._eventsInProgress.drag;return Oe&&!this._handlersById[Oe.handlerName].isActive()})()&&!me(c)){const Ne=I.zoom;I.cameraElevationReference="sea",I.recenterOnTerrain(),I.cameraElevationReference="ground",Ne!==I.zoom&&this._map._update(!0)}if(I._isCameraConstrained&&S._stop(!0),!me(c))return void this._fireEvents(p,x,!0);let{panDelta:j,zoomDelta:G,bearingDelta:re,pitchDelta:te,around:pe,aroundCoord:Ee,pinchAround:Le}=c;I._isCameraConstrained&&(G>0&&(G=0),I._isCameraConstrained=!1),Le!==void 0&&(pe=Le),(Ne=>p.drag&&!this._eventsInProgress.drag)()&&pe&&(this._dragOrigin=O(I.pointCoordinate3D(pe)),this._trackingEllipsoid.setup(I._camera.position,this._dragOrigin)),I.cameraElevationReference="sea",S._stop(!0),pe=pe||S.transform.centerPoint,re&&(I.bearing+=re),te&&(I.pitch+=te),I._updateCameraState();const Pe=[0,0,0];if(j)if(I.projection.name==="mercator"){const Ne=this._trackingEllipsoid.projectRay(I.screenPointToMercatorRay(pe).dir),Oe=this._trackingEllipsoid.projectRay(I.screenPointToMercatorRay(pe.sub(j)).dir);Pe[0]=Oe[0]-Ne[0],Pe[1]=Oe[1]-Ne[1]}else{const Ne=I.pointCoordinate(pe);if(I.projection.name==="globe"){j=j.rotate(-I.angle);const Oe=I._pixelsPerMercatorPixel/I.worldSize;Pe[0]=-j.x*a.mercatorScale(a.latFromMercatorY(Ne.y))*Oe,Pe[1]=-j.y*a.mercatorScale(I.center.lat)*Oe}else{const Oe=I.pointCoordinate(pe.sub(j));Ne&&Oe&&(Pe[0]=Oe.x-Ne.x,Pe[1]=Oe.y-Ne.y)}}const Be=I.zoom,Ce=[0,0,0];if(G){const Ne=O(Ee||I.pointCoordinate3D(pe)),Oe={dir:a.normalize([],a.sub([],Ne,I._camera.position))};if(Oe.dir[2]<0){const qe=I.zoomDeltaToMovement(Ne,G);a.scale$2(Ce,Oe.dir,qe)}}const De=a.add(Pe,Pe,Ce);I._translateCameraConstrained(De),G&&Math.abs(I.zoom-Be)>1e-4&&I.recenterOnTerrain(),I.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,x,!0)}_fireEvents(c,p,x){const S=U(this._eventsInProgress),I=U(c),O={};for(const te in c){const{originalEvent:pe}=c[te];this._eventsInProgress[te]||(O[`${te}start`]=pe),this._eventsInProgress[te]=c[te]}!S&&I&&this._fireEvent("movestart",I.originalEvent);for(const te in O)this._fireEvent(te,O[te]);I&&this._fireEvent("move",I.originalEvent);for(const te in c){const{originalEvent:pe}=c[te];this._fireEvent(te,pe)}const j={};let G;for(const te in this._eventsInProgress){const{handlerName:pe,originalEvent:Ee}=this._eventsInProgress[te];this._handlersById[pe].isActive()||(delete this._eventsInProgress[te],G=p[pe]||Ee,j[`${te}end`]=G)}for(const te in j)this._fireEvent(te,j[te]);const re=U(this._eventsInProgress);if(x&&(S||I)&&!re){this._updatingCamera=!0;const te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),pe=Ee=>Ee!==0&&-this._bearingSnap<Ee&&Ee<this._bearingSnap;te?(pe(te.bearing||this._map.getBearing())&&(te.bearing=0),this._map.easeTo(te,{originalEvent:G})):(this._map.fire(new a.Event("moveend",{originalEvent:G})),pe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,p){this._map.fire(new a.Event(c,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new Z("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Se="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ue extends a.Evented{constructor(c,p){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,p){return this.jumpTo({center:c},p)}panBy(c,p,x){return c=a.pointGeometry.convert(c).mult(-1),this.panTo(this.transform.center,a.extend({offset:c},p),x)}panTo(c,p,x){return this.easeTo(a.extend({center:c},p),x)}getZoom(){return this.transform.zoom}setZoom(c,p){return this.jumpTo({zoom:c},p),this}zoomTo(c,p,x){return this.easeTo(a.extend({zoom:c},p),x)}zoomIn(c,p){return this.zoomTo(this.getZoom()+1,c,p),this}zoomOut(c,p){return this.zoomTo(this.getZoom()-1,c,p),this}getBearing(){return this.transform.bearing}setBearing(c,p){return this.jumpTo({bearing:c},p),this}getPadding(){return this.transform.padding}setPadding(c,p){return this.jumpTo({padding:c},p),this}rotateTo(c,p,x){return this.easeTo(a.extend({bearing:c},p),x)}resetNorth(c,p){return this.rotateTo(0,a.extend({duration:1e3},c),p),this}resetNorthPitch(c,p){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},c),p),this}snapToNorth(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this}getPitch(){return this.transform.pitch}setPitch(c,p){return this.jumpTo({pitch:c},p),this}cameraForBounds(c,p){c=a.LngLatBounds.convert(c);const x=p&&p.bearing||0,S=p&&p.pitch||0,I=c.getNorthWest(),O=c.getSouthEast();return this._cameraForBounds(this.transform,I,O,x,S,p)}_extendCameraOptions(c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=a.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const x=c.padding;c.padding={top:x,bottom:x,right:x,left:x}}return c.padding=a.extend(p,c.padding),c}_minimumAABBFrustumDistance(c,p){const x=p.max[0]-p.min[0],S=p.max[1]-p.min[1];return x/S>c.aspect?x/(2*Math.tan(.5*c.fovX)*c.aspect):S/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,p,x,S,I,O){const j=c.clone(),G=this._extendCameraOptions(O);j.bearing=S,j.pitch=I;const re=a.LngLat.convert(p),te=a.LngLat.convert(x),pe=.5*(re.lat+te.lat),Ee=.5*(re.lng+te.lng),Le=a.latLngToECEF(pe,Ee),Pe=a.normalize([],Le),Be=a.normalize([],a.cross([],Pe,[0,1,0])),Ce=a.cross([],Be,Pe),De=[Be[0],Be[1],Be[2],0,Ce[0],Ce[1],Ce[2],0,Pe[0],Pe[1],Pe[2],0,0,0,0,1],Ne=[Le,a.latLngToECEF(re.lat,re.lng),a.latLngToECEF(te.lat,re.lng),a.latLngToECEF(te.lat,te.lng),a.latLngToECEF(re.lat,te.lng),a.latLngToECEF(pe,re.lng),a.latLngToECEF(pe,te.lng),a.latLngToECEF(re.lat,Ee),a.latLngToECEF(te.lat,Ee)];let Oe=a.Aabb.fromPoints(Ne.map(Mt=>[a.dot(Be,Mt),a.dot(Ce,Mt),a.dot(Pe,Mt)]));const qe=a.transformMat4([],Oe.center,De);a.squaredLength(qe)===0&&a.set(qe,0,0,1),a.normalize(qe,qe),a.scale$2(qe,qe,a.GLOBE_RADIUS),j.center=a.ecefToLatLng(qe);const ot=j.getWorldToCameraMatrix(),it=a.invert(new Float64Array(16),ot);Oe=a.Aabb.applyTransform(Oe,a.multiply([],ot,De)),a.transformMat4(qe,qe,ot);const gt=.5*(Oe.max[2]-Oe.min[2]),zt=this._minimumAABBFrustumDistance(j,Oe),Lt=a.scale$2([],[0,0,1],gt),wt=a.add(Lt,qe,Lt),Dr=zt+(j.pitch===0?0:a.distance(qe,wt)),Dt=j.globeCenterInViewSpace,ir=a.sub([],qe,[Dt[0],Dt[1],Dt[2]]);a.normalize(ir,ir),a.scale$2(ir,ir,Dr);const jt=a.add([],qe,ir);a.transformMat4(jt,jt,it);const wr=a.earthRadius/a.GLOBE_RADIUS,Zt=a.length(jt),fr=a.mercatorZfromAltitude(Zt*wr-a.earthRadius,0),kr=Math.min(j.zoomFromMercatorZAdjusted(fr),G.maxZoom);return kr>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(j.setProjection({name:"mercator"}),j.zoom=kr,this._cameraForBounds(j,p,x,S,I,O)):{center:j.center,zoom:kr,bearing:S,pitch:I}}queryTerrainElevation(c,p){const x=this.transform.elevation;return x?(p=a.extend({},{exaggerated:!0},p),x.getAtPoint(a.MercatorCoordinate.fromLngLat(c),null,p.exaggerated)):null}_cameraForBounds(c,p,x,S,I,O){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,p,x,S,I,O);const j=c.clone(),G=this._extendCameraOptions(O),re=j.padding;j.bearing=S,j.pitch=I;const te=a.LngLat.convert(p),pe=a.LngLat.convert(x),Ee=new a.LngLat(te.lng,pe.lat),Le=new a.LngLat(pe.lng,te.lat),Pe=j.project(te),Be=j.project(pe),Ce=this.queryTerrainElevation(te),De=this.queryTerrainElevation(pe),Ne=this.queryTerrainElevation(Ee),Oe=this.queryTerrainElevation(Le),qe=[[Pe.x,Pe.y,Math.min(Ce||0,De||0,Ne||0,Oe||0)],[Be.x,Be.y,Math.max(Ce||0,De||0,Ne||0,Oe||0)]];let ot=a.Aabb.fromPoints(qe);const it=j.getWorldToCameraMatrix(),gt=a.invert(new Float64Array(16),it);ot=a.Aabb.applyTransform(ot,it);const zt=a.sub([],ot.max,ot.min),Lt=re.left||0,wt=re.right||0,Dr=re.bottom||0,Dt=re.top||0,{left:ir,right:jt,top:wr,bottom:Zt}=G.padding,fr=.5*(Lt+wt),kr=.5*(Dt+Dr),Mt=Math.min(j.scaleZoom(j.scale*Math.min((j.width-(Lt+wt+ir+jt))/zt[0],(j.height-(Dr+Dt+Zt+wr))/zt[1])),G.maxZoom),Ut=j.scale/j.zoomScale(Mt);ot=new a.Aabb([ot.min[0]-(ir+fr)*Ut,ot.min[1]-(Zt+kr)*Ut,ot.min[2]],[ot.max[0]+(jt+fr)*Ut,ot.max[1]+(wr+kr)*Ut,ot.max[2]]);const ai=.5*zt[2],wi=this._minimumAABBFrustumDistance(j,ot),si=[0,0,1,0];a.transformMat4$1(si,si,it),a.normalize$2(si,si);const ki=a.scale$2([],si,wi+ai),qi=a.add([],ot.center,ki),Ei=(typeof G.offset.x=="number"&&typeof G.offset.y=="number"?new a.pointGeometry(G.offset.x,G.offset.y):a.pointGeometry.convert(G.offset)).rotate(-a.degToRad(S));ot.center[0]-=Ei.x*Ut,ot.center[1]+=Ei.y*Ut,a.transformMat4(ot.center,ot.center,gt),a.transformMat4(qi,qi,gt);const ti=[ot.center[0],ot.center[1],qi[2]*j.pixelsPerMeter];a.scale$2(ti,ti,1/j.worldSize);const Tn=a.lngFromMercatorX(ti[0]),xn=a.latFromMercatorY(ti[1]),Dn=Math.min(j._zoomFromMercatorZ(ti[2]),G.maxZoom),An=new a.LngLat(Tn,xn);return j.mercatorFromTransition&&Dn<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(j.setProjection({name:"globe"}),j.zoom=Dn,this._cameraForBounds(j,p,x,S,I,O)):{center:An,zoom:Dn,bearing:S,pitch:I}}fitBounds(c,p,x){const S=this.cameraForBounds(c,p);return this._fitInternal(S,p,x)}fitScreenCoordinates(c,p,x,S,I){const O=a.pointGeometry.convert(c),j=a.pointGeometry.convert(p),G=new a.pointGeometry(Math.min(O.x,j.x),Math.min(O.y,j.y)),re=new a.pointGeometry(Math.max(O.x,j.x),Math.max(O.y,j.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(O,j))return this;const te=this.transform.pointLocation3D(G),pe=this.transform.pointLocation3D(re),Ee=this.transform.pointLocation3D(new a.pointGeometry(G.x,re.y)),Le=this.transform.pointLocation3D(new a.pointGeometry(re.x,G.y)),Pe=[Math.min(te.lng,pe.lng,Ee.lng,Le.lng),Math.min(te.lat,pe.lat,Ee.lat,Le.lat)],Be=[Math.max(te.lng,pe.lng,Ee.lng,Le.lng),Math.max(te.lat,pe.lat,Ee.lat,Le.lat)],Ce=S&&S.pitch?S.pitch:this.getPitch(),De=this._cameraForBounds(this.transform,Pe,Be,x,Ce,S);return this._fitInternal(De,S,I)}_fitInternal(c,p,x){return c?(delete(p=a.extend(c,p)).padding,p.linear?this.easeTo(p,x):this.flyTo(p,x)):this}jumpTo(c,p){this.stop();const x=c.preloadOnly?this.transform.clone():this.transform;let S=!1,I=!1,O=!1;return"zoom"in c&&x.zoom!==+c.zoom&&(S=!0,x.zoom=+c.zoom),c.center!==void 0&&(x.center=a.LngLat.convert(c.center)),"bearing"in c&&x.bearing!==+c.bearing&&(I=!0,x.bearing=+c.bearing),"pitch"in c&&x.pitch!==+c.pitch&&(O=!0,x.pitch=+c.pitch),c.padding==null||x.isPaddingEqual(c.padding)||(x.padding=c.padding),c.preloadOnly?(this._preloadTiles(x),this):(this.fire(new a.Event("movestart",p)).fire(new a.Event("move",p)),S&&this.fire(new a.Event("zoomstart",p)).fire(new a.Event("zoom",p)).fire(new a.Event("zoomend",p)),I&&this.fire(new a.Event("rotatestart",p)).fire(new a.Event("rotate",p)).fire(new a.Event("rotateend",p)),O&&this.fire(new a.Event("pitchstart",p)).fire(new a.Event("pitch",p)).fire(new a.Event("pitchend",p)),this.fire(new a.Event("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Se),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,p){const x=this.transform;if(!x.projection.supportsFreeCamera)return a.warnOnce(Se),this;this.stop();const S=x.zoom,I=x.pitch,O=x.bearing;x.setFreeCameraOptions(c);const j=S!==x.zoom,G=I!==x.pitch,re=O!==x.bearing;return this.fire(new a.Event("movestart",p)).fire(new a.Event("move",p)),j&&this.fire(new a.Event("zoomstart",p)).fire(new a.Event("zoom",p)).fire(new a.Event("zoomend",p)),re&&this.fire(new a.Event("rotatestart",p)).fire(new a.Event("rotate",p)).fire(new a.Event("rotateend",p)),G&&this.fire(new a.Event("pitchstart",p)).fire(new a.Event("pitch",p)).fire(new a.Event("pitchend",p)),this.fire(new a.Event("moveend",p)),this}easeTo(c,p){this._stop(!1,c.easeId),((c=a.extend({offset:[0,0],duration:500,easing:a.ease},c)).animate===!1||!c.essential&&a.exported.prefersReducedMotion)&&(c.duration=0);const x=this.transform,S=this.getZoom(),I=this.getBearing(),O=this.getPitch(),j=this.getPadding(),G="zoom"in c?+c.zoom:S,re="bearing"in c?this._normalizeBearing(c.bearing,I):I,te="pitch"in c?+c.pitch:O,pe="padding"in c?c.padding:x.padding,Ee=a.pointGeometry.convert(c.offset);let Le,Pe,Be;if(x.projection.name==="globe"){const Lt=a.MercatorCoordinate.fromLngLat(x.center),wt=Ee.rotate(-x.angle);Lt.x+=wt.x/x.worldSize,Lt.y+=wt.y/x.worldSize;const Dr=Lt.toLngLat(),Dt=a.LngLat.convert(c.center||Dr);this._normalizeCenter(Dt),Le=x.centerPoint.add(wt),Pe=new a.pointGeometry(Lt.x,Lt.y).mult(x.worldSize),Be=new a.pointGeometry(a.mercatorXfromLng(Dt.lng),a.mercatorYfromLat(Dt.lat)).mult(x.worldSize).sub(Pe)}else{Le=x.centerPoint.add(Ee);const Lt=x.pointLocation(Le),wt=a.LngLat.convert(c.center||Lt);this._normalizeCenter(wt),Pe=x.project(Lt),Be=x.project(wt).sub(Pe)}const Ce=x.zoomScale(G-S);let De,Ne;c.around&&(De=a.LngLat.convert(c.around),Ne=x.locationPoint(De));const Oe=this._zooming||G!==S,qe=this._rotating||I!==re,ot=this._pitching||te!==O,it=!x.isPaddingEqual(pe),gt=Lt=>wt=>{if(Oe&&(Lt.zoom=a.number(S,G,wt)),qe&&(Lt.bearing=a.number(I,re,wt)),ot&&(Lt.pitch=a.number(O,te,wt)),it&&(Lt.interpolatePadding(j,pe,wt),Le=Lt.centerPoint.add(Ee)),De)Lt.setLocationAtPoint(De,Ne);else{const Dr=Lt.zoomScale(Lt.zoom-S),Dt=G>S?Math.min(2,Ce):Math.max(.5,Ce),ir=Math.pow(Dt,1-wt),jt=Lt.unproject(Pe.add(Be.mult(wt*ir)).mult(Dr));Lt.setLocationAtPoint(Lt.renderWorldCopies?jt.wrap():jt,Le)}return c.preloadOnly||this._fireMoveEvents(p),Lt};if(c.preloadOnly){const Lt=this._emulate(gt,c.duration,x);return this._preloadTiles(Lt),this}const zt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Oe,this._rotating=qe,this._pitching=ot,this._padding=it,this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,zt),this._ease(gt(x),Lt=>{x.recenterOnTerrain(),this._afterEase(p,Lt)},c),this}_prepareEase(c,p,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",p||x.moving||this.fire(new a.Event("movestart",c)),this._zooming&&!x.zooming&&this.fire(new a.Event("zoomstart",c)),this._rotating&&!x.rotating&&this.fire(new a.Event("rotatestart",c)),this._pitching&&!x.pitching&&this.fire(new a.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new a.Event("move",c)),this._zooming&&this.fire(new a.Event("zoom",c)),this._rotating&&this.fire(new a.Event("rotate",c)),this._pitching&&this.fire(new a.Event("pitch",c))}_afterEase(c,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const x=this._zooming,S=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new a.Event("zoomend",c)),S&&this.fire(new a.Event("rotateend",c)),I&&this.fire(new a.Event("pitchend",c)),this.fire(new a.Event("moveend",c))}flyTo(c,p){if(!c.essential&&a.exported.prefersReducedMotion){const Mt=a.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,p)}this.stop(),c=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},c);const x=this.transform,S=this.getZoom(),I=this.getBearing(),O=this.getPitch(),j=this.getPadding(),G="zoom"in c?a.clamp(+c.zoom,x.minZoom,x.maxZoom):S,re="bearing"in c?this._normalizeBearing(c.bearing,I):I,te="pitch"in c?+c.pitch:O,pe="padding"in c?c.padding:x.padding,Ee=x.zoomScale(G-S),Le=a.pointGeometry.convert(c.offset);let Pe=x.centerPoint.add(Le);const Be=x.pointLocation(Pe),Ce=a.LngLat.convert(c.center||Be);this._normalizeCenter(Ce);const De=x.project(Be),Ne=x.project(Ce).sub(De);let Oe=c.curve;const qe=Math.max(x.width,x.height),ot=qe/Ee,it=Ne.mag();if("minZoom"in c){const Mt=a.clamp(Math.min(c.minZoom,S,G),x.minZoom,x.maxZoom),Ut=qe/x.zoomScale(Mt-S);Oe=Math.sqrt(Ut/it*2)}const gt=Oe*Oe;function zt(Mt){const Ut=(ot*ot-qe*qe+(Mt?-1:1)*gt*gt*it*it)/(2*(Mt?ot:qe)*gt*it);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function Lt(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function wt(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const Dr=zt(0);let Dt=function(Mt){return wt(Dr)/wt(Dr+Oe*Mt)},ir=function(Mt){return qe*((wt(Dr)*(Lt(Ut=Dr+Oe*Mt)/wt(Ut))-Lt(Dr))/gt)/it;var Ut},jt=(zt(1)-Dr)/Oe;if(Math.abs(it)<1e-6||!isFinite(jt)){if(Math.abs(qe-ot)<1e-6)return this.easeTo(c,p);const Mt=ot<qe?-1:1;jt=Math.abs(Math.log(ot/qe))/Oe,ir=function(){return 0},Dt=function(Ut){return Math.exp(Mt*Oe*Ut)}}c.duration="duration"in c?+c.duration:1e3*jt/("screenSpeed"in c?+c.screenSpeed/Oe:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const wr=I!==re,Zt=te!==O,fr=!x.isPaddingEqual(pe),kr=Mt=>Ut=>{const ai=Ut*jt,wi=1/Dt(ai);Mt.zoom=Ut===1?G:S+Mt.scaleZoom(wi),wr&&(Mt.bearing=a.number(I,re,Ut)),Zt&&(Mt.pitch=a.number(O,te,Ut)),fr&&(Mt.interpolatePadding(j,pe,Ut),Pe=Mt.centerPoint.add(Le));const si=Ut===1?Ce:Mt.unproject(De.add(Ne.mult(ir(ai))).mult(wi));return Mt.setLocationAtPoint(Mt.renderWorldCopies?si.wrap():si,Pe),Mt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(p),Mt};if(c.preloadOnly){const Mt=this._emulate(kr,c.duration,x);return this._preloadTiles(Mt),this}return this._zooming=!0,this._rotating=wr,this._pitching=Zt,this._padding=fr,this._prepareEase(p,!1),this._ease(kr(x),()=>this._afterEase(p),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const x=this._onEaseEnd;this._onEaseEnd=void 0,x.call(this,p)}if(!c){const x=this.handlers;x&&x.stop(!1)}return this}_ease(c,p,x){x.animate===!1||x.duration===0?(c(1),p()):(this._easeStart=a.exported.now(),this._easeOptions=x,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,p){c=a.wrap(c,-180,180);const x=Math.abs(c-p);return Math.abs(c-360-p)<x&&(c-=360),Math.abs(c+360-p)<x&&(c+=360),c}_normalizeCenter(c){const p=this.transform;if(!p.renderWorldCopies||p.maxBounds)return;const x=c.lng-p.center.lng;c.lng+=x>180?-360:x<-180?360:0}_emulate(c,p,x){const S=Math.ceil(15*p/1e3),I=[],O=c(x.clone());for(let j=0;j<=S;j++){const G=O(j/S);I.push(G.clone())}return I}}class tt{constructor(c={}){this.options=c,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const p=this.options&&this.options.compact;return this._map=c,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),N("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,p){const x=this._map._getUIString(`AttributionControl.${p}`);c.setAttribute("aria-label",x),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(c){const x=p.reduce((S,I,O)=>(I.value&&(S+=`${I.key}=${I.value}${O<p.length-1?"&":""}`),S),"?");c.href=`${a.config.FEEDBACK_URL}/${x}#${Ko(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const p=this._map.style._sourceCaches;for(const S in p){const I=p[S];if(I.used){const O=I.getSource();O.attribution&&c.indexOf(O.attribution)<0&&c.push(O.attribution)}}c.sort((S,I)=>S.length-I.length),c=c.filter((S,I)=>{for(let O=I+1;O<c.length;O++)if(c[O].indexOf(S)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const x=c.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,c.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class bt{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=N("div","mapboxgl-ctrl");const p=N("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const p in c){const x=c[p].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class or{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p}remove(c){const p=this._currentlyRunning,x=p?this._queue.concat(p):this._queue;for(const S of x)if(S.id===c)return void(S.cancelled=!0)}run(c=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const x of p)if(!x.cancelled&&(x.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function $r(_,c,p){if(_=new a.LngLat(_.lng,_.lat),c){const x=new a.LngLat(_.lng-360,_.lat),S=new a.LngLat(_.lng+360,_.lat),I=360*Math.ceil(Math.abs(_.lng-p.center.lng)/360),O=p.locationPoint(_).distSqr(c),j=c.x<0||c.y<0||c.x>p.width||c.y>p.height;p.locationPoint(x).distSqr(c)<O&&(j||Math.abs(x.lng-p.center.lng)<I)?_=x:p.locationPoint(S).distSqr(c)<O&&(j||Math.abs(S.lng-p.center.lng)<I)&&(_=S)}for(;Math.abs(_.lng-p.center.lng)>180;){const x=p.locationPoint(_);if(x.x>=0&&x.y>=0&&x.x<=p.width&&x.y<=p.height)break;_.lng>p.center.lng?_.lng-=360:_.lng+=360}return _}const Fr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ht extends a.Evented{constructor(c,p){if(super(),(c instanceof a.window.HTMLElement||p)&&(c=a.extend({element:c},p)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=a.pointGeometry.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=N("div");const S=41,I=27,O=F("svg",{display:"block",height:S*this._scale+"px",width:I*this._scale+"px",viewBox:`0 0 ${I} ${S}`},this._element),j=F("radialGradient",{id:"shadowGradient"},F("defs",{},O));F("stop",{offset:"10%","stop-opacity":.4},j),F("stop",{offset:"100%","stop-opacity":.05},j),F("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),F("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),F("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),F("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=a.pointGeometry.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const x=this._element.classList;for(const S in Fr)x.remove(`mapboxgl-marker-anchor-${S}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=a.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const p=c.code,x=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(c){const p=c.originalEvent.target,x=this._element;this._popup&&(p===x||x.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,p=this._pos;if(!c||!p)return!1;const x=c.unproject(p),S=c.getFreeCameraOptions();if(!S.position)return!1;const I=S.position.toLngLat();return I.distanceTo(x)<.9*I.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const p=this._pos;if(!p||p.x<0||p.x>c.transform.width||p.y<0||p.y>c.transform.height)return void this._clearFadeTimer();const x=c.unproject(p);let S;c._showingGlobe()&&a.isLngLatBehindGlobe(c.transform,this._lngLat)?S=0:(S=1-c._queryFogOpacity(x),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Fr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const c=this._pos,p=this._map,x=this.getPitchAlignment();if(!p||!c||x!=="map")return"";if(!p._showingGlobe()){const G=p.getPitch();return G?`rotateX(${G}deg)`:""}const S=a.radToDeg(a.globeTiltAtLngLat(p.transform,this._lngLat)),I=c.sub(a.globeCenterToScreenPoint(p.transform)),O=Math.abs(I.x)+Math.abs(I.y);if(O===0)return"";const j=S/O;return`rotateX(${-I.y*j}deg) rotateY(${I.x*j}deg)`}_calculateZTransform(){const c=this._pos,p=this._map;if(!p||!c)return"";let x=0;const S=this.getRotationAlignment();if(S==="map")if(p._showingGlobe()){const I=p.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=p.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(I);x=a.radToDeg(Math.atan2(O.y,O.x))-90}else x=-p.getBearing();else if(S==="horizon"){const I=a.smoothstep(4,6,p.getZoom()),O=a.globeCenterToScreenPoint(p.transform);O.y+=I*p.transform.height;const j=c.sub(O),G=a.radToDeg(Math.atan2(j.y,j.x));x=(G>90?G-270:G+90)*(1-I)}return x+=this._rotation,x?`rotateZ(${x}deg)`:""}_update(c){a.window.cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=$r(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),c===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=a.pointGeometry.convert(c),this._update(),this}_onMove(c){const p=this._map;if(!p)return;const x=this._pointerdownPos,S=this._positionDelta;if(x&&S){if(!this._isDragging){const I=this._clickTolerance||p._clickTolerance;if(c.point.dist(x)<I)return;this._isDragging=!0}this._pos=c.point.sub(S),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(c){const p=this._map,x=this._pos;p&&x&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(x),this._pointerdownPos=c.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const p=this._map;return p&&(c?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const vi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ii=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ln(_=new a.pointGeometry(0,0),c="bottom"){if(typeof _=="number"){const p=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(c){case"top":return new a.pointGeometry(0,_);case"top-left":return new a.pointGeometry(p,p);case"top-right":return new a.pointGeometry(-p,p);case"bottom":return new a.pointGeometry(0,-_);case"bottom-left":return new a.pointGeometry(p,-p);case"bottom-right":return new a.pointGeometry(-p,-p);case"left":return new a.pointGeometry(_,0);case"right":return new a.pointGeometry(-_,0)}return new a.pointGeometry(0,0)}return _ instanceof a.pointGeometry||Array.isArray(_)?a.pointGeometry.convert(_):a.pointGeometry.convert(_[c]||[0,0])}class un{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const p=a.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,p,x){this._start=this.getValue(p),this._end=c,this._startTime=p,this._endTime=p+x}}const Io={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Kn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ja={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ua{constructor(c,p,x=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new ml({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,x&&(this.mousePitch=new gl({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),X()}move(c,p){const x=this.map,S=this.mouseRotate.mousemoveWindow(c,p),I=S&&S.bearingDelta;if(I&&x.setBearing(x.getBearing()+I),this.mousePitch){const O=this.mousePitch.mousemoveWindow(c,p),j=O&&O.pitchDelta;j&&x.setPitch(x.getPitch()+j)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ye(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(a.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),ue(this.element,c)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,ue(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Re(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=Re(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const bs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},vl={maxWidth:100,unit:"metric"};function pu(_,c,p){const x=Pc(c),S=x/c,I={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[p];this._map._requestDomTask(()=>{this._container.style.width=_*S+"px",this._container.innerHTML=`${x}&nbsp;${I}`})}function Pc(_){const c=Math.pow(10,`${Math.floor(_)}`.length-1);let p=_/c;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:p>=1?1:function(x){const S=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*S)/S}(p),c*p}const Gl={version:a.version,supported:T,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Ue{constructor(_){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(_=a.extend({},Kn,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(_.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gs(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new or,this._domRenderTaskQueue=new or,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Io,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new un(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,typeof _.container=="string"){if(this._container=a.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new we(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new Hr(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,a.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new tt({customAttribution:_.customAttribution})),this._logoControl=new bt,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new a.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new a.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(_,c){if(c===void 0&&(c=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=_.onAdd(this);this._controls.push(_);const x=this._controlPositions[c];return c.indexOf("bottom")!==-1?x.insertBefore(p,x.firstChild):x.appendChild(p),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(_);return c>-1&&this._controls.splice(c,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new a.Event("movestart",_)).fire(new a.Event("move",_)),this.fire(new a.Event("resize",_)),c&&this.fire(new a.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(a.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?a.window.navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(c=>c==="auto"?a.window.navigator.language:c):_}setLanguage(_){const c=this._parseLanguage(_);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const _=this.transform,c=_.projection.name;let p;c==="globe"&&_.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),p=!0):c==="mercator"&&_.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,c){return this._updateProjection(_||c||{name:"mercator"})}_updateProjection(_){let c;if(c=_.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const p in this.style._sourceCaches)this.style._sourceCaches[p].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(a.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(a.pointGeometry.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,c,p){if(_==="mouseenter"||_==="mouseover"){let x=!1;const S=O=>{const j=c.filter(re=>this.getLayer(re)),G=j.length?this.queryRenderedFeatures(O.point,{layers:j}):[];G.length?x||(x=!0,p.call(this,new Co(_,this,O.originalEvent,{features:G}))):x=!1},I=()=>{x=!1};return{layers:new Set(c),listener:p,delegates:{mousemove:S,mouseout:I}}}if(_==="mouseleave"||_==="mouseout"){let x=!1;const S=O=>{const j=c.filter(G=>this.getLayer(G));(j.length?this.queryRenderedFeatures(O.point,{layers:j}):[]).length?x=!0:x&&(x=!1,p.call(this,new Co(_,this,O.originalEvent)))},I=O=>{x&&(x=!1,p.call(this,new Co(_,this,O.originalEvent)))};return{layers:new Set(c),listener:p,delegates:{mousemove:S,mouseout:I}}}{const x=S=>{const I=c.filter(j=>this.getLayer(j)),O=I.length?this.queryRenderedFeatures(S.point,{layers:I}):[];O.length&&(S.features=O,p.call(this,S),delete S.features)};return{layers:new Set(c),listener:p,delegates:{[_]:x}}}}on(_,c,p){if(p===void 0)return super.on(_,c);Array.isArray(c)||(c=[c]);const x=this._createDelegatedListener(_,c,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(x);for(const S in x.delegates)this.on(S,x.delegates[S]);return this}once(_,c,p){if(p===void 0)return super.once(_,c);Array.isArray(c)||(c=[c]);const x=this._createDelegatedListener(_,c,p);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(_,c,p){if(p===void 0)return super.off(_,c);c=new Set(Array.isArray(c)?c:[c]);const x=(I,O)=>{if(I.size!==O.size)return!1;for(const j of I)if(!O.has(j))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[_]:void 0;return S&&(I=>{for(let O=0;O<I.length;O++){const j=I[O];if(j.listener===p&&x(j.layers,c)){for(const G in j.delegates)this.off(G,j.delegates[G]);return I.splice(O,1),this}}})(S),this}queryRenderedFeatures(_,c){return this.style?(c!==void 0||_===void 0||_ instanceof a.pointGeometry||Array.isArray(_)||(c=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(_,c){return this.style.querySourceFeatures(_,c)}setStyle(_,c){return(c=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(_,c))}_getUIString(_){const c=this._locale[_];if(c==null)throw new Error(`Missing UI string '${_}'`);return c}_updateStyle(_,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Qn(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,c){if(typeof _=="string"){const p=this._requestManager.normalizeStyleURL(_),x=this._requestManager.transformRequest(p,a.ResourceType.Style);a.getJSON(x,(S,I)=>{S?this.fire(new a.ErrorEvent(S)):I&&this._updateDiff(I,c)})}else typeof _=="object"&&this._updateDiff(_,c)}_updateDiff(_,c){try{this.style.setState(_)&&this._update(!0)}catch(p){a.warnOnce(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(_,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(_,c){return this._lazyInitEmptyStyle(),this.style.addSource(_,c),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const c in _){const p=_[c]._tiles;for(const x in p){const S=p[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(_,c,p){this._lazyInitEmptyStyle(),this.style.addSourceType(_,c,p)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,c,{pixelRatio:p=1,sdf:x=!1,stretchX:S,stretchY:I,content:O}={}){if(this._lazyInitEmptyStyle(),c instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&c instanceof a.window.ImageBitmap){const{width:j,height:G,data:re}=a.exported.getImageData(c);this.style.addImage(_,{data:new a.RGBAImage({width:j,height:G},re),pixelRatio:p,stretchX:S,stretchY:I,content:O,sdf:x,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:j,height:G}=c,re=c;this.style.addImage(_,{data:new a.RGBAImage({width:j,height:G},new Uint8Array(re.data)),pixelRatio:p,stretchX:S,stretchY:I,content:O,sdf:x,version:0,userImage:re}),re.onAdd&&re.onAdd(this,_)}}updateImage(_,c){const p=this.style.getImage(_);if(!p)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=c instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&c instanceof a.window.ImageBitmap?a.exported.getImageData(c):c,{width:S,height:I}=x;S!==void 0&&I!==void 0?S===p.data.width&&I===p.data.height?(p.data.replace(x.data,!(c instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&c instanceof a.window.ImageBitmap)),this.style.updateImage(_,p)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${I})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,c){a.getImage(this._requestManager.transformRequest(_,a.ResourceType.Image),(p,x)=>{c(p,x instanceof a.window.HTMLImageElement?a.exported.getImageData(x):x)})}listImages(){return this.style.listImages()}addLayer(_,c){return this._lazyInitEmptyStyle(),this.style.addLayer(_,c),this._update(!0)}moveLayer(_,c){return this.style.moveLayer(_,c),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,c,p){return this.style.setLayerZoomRange(_,c,p),this._update(!0)}setFilter(_,c,p={}){return this.style.setFilter(_,c,p),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,c,p,x={}){return this.style.setPaintProperty(_,c,p,x),this._update(!0)}getPaintProperty(_,c){return this.style.getPaintProperty(_,c)}setLayoutProperty(_,c,p,x={}){return this.style.setLayoutProperty(_,c,p,x),this._update(!0)}getLayoutProperty(_,c){return this.style.getLayoutProperty(_,c)}setLight(_,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(_),this.transform):0}setFeatureState(_,c){return this.style.setFeatureState(_,c),this._update()}removeFeatureState(_,c){return this.style.removeFeatureState(_,c),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let p,x,S,I=this._container;for(;I&&(!x||!S);){const O=a.window.getComputedStyle(I).transform;O&&O!=="none"&&(p=O.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&p[0]!=="0"&&p[0]!=="1"&&(x=p[0]),p[3]&&p[3]!=="0"&&p[3]!=="1"&&(S=p[3])),I=I.parentElement}this._containerWidth=x?Math.abs(_/x):_,this._containerHeight=S?Math.abs(c/S):c}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=N("div","mapboxgl-canvas-container",_);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=N("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=N("div","mapboxgl-control-container",_),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{x[S]=N("div",`mapboxgl-ctrl-${S}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,c){const p=a.exported.devicePixelRatio||1;this._canvas.width=p*Math.ceil(_),this._canvas.height=p*Math.ceil(c),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${c}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const c=this._markers.indexOf(_);c!==-1&&this._markers.splice(c,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const c=this._popups.indexOf(_);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const _=a.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);c?(a.storeAuthState(c,!0),this.painter=new oc(c,this.transform),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(c)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let c;const p=this.painter.context.extTimerQuery,x=a.exported.now();if(this.listens("gpu-timing-frame")&&(c=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,G=this.transform.pitch,re=a.exported.now(),te=new a.EvaluationParameters(j,{now:re,fadeDuration:S,pitch:G,transition:this.style.getTransition()});this.style.update(te)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(x),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(x),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const j=a.exported.now()-x;p.endQueryEXT(p.TIME_ELAPSED_EXT,c),setTimeout(()=>{const G=p.getQueryObjectEXT(c,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(c),this.fire(new a.Event("gpu-timing-frame",{cpuTime:j,gpuTime:G})),a.window.performance.mark("frame-gpu",{startTime:x,detail:{gpuTime:G}})},50)}if(this.listens("gpu-timing-layer")){const j=this.painter.collectGpuTimers();setTimeout(()=>{const G=this.painter.queryGpuTimers(j);this.fire(new a.Event("gpu-timing-layer",{layerTimes:G}))},50)}if(this.listens("gpu-timing-deferred-render")){const j=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const G=this.painter.queryGpuTimeDeferredRender(j);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:G}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(O||this._repaint)this.triggerRepaint();else{const j=!this.isMoving()&&this.loaded();if(j&&(I=this._updateAverageElevation(x,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),j&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const c of this._markers)_&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!_||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(_,c=!1){const p=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);if((c||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const x=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),I=!1;this.transform.elevation&&(I=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=_;const O=Math.abs(x-S);if(O>1){if(this._isInitialLoad||I)return this._averageElevation.jumpTo(S),p(S);this._averageElevation.easeTo(S,_,300)}else if(O>1e-4)return this._averageElevation.jumpTo(S),p(S)}return!!this._averageElevation.isEasing(_)&&p(this._averageElevation.getValue(_))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===a.AUTH_ERR_MSG||_.status===401)){const c=this.painter.context.gl;a.storeAuthState(c,!1),this._logoControl instanceof bt&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const p=this.painter.context.gl,x=p.createFramebuffer();function S(I){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,I,0);const O=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,O),O}return p.bindFramebuffer(p.FRAMEBUFFER,x),this._canvasPixelComparison(S(_),c.canvasCopies.map(S),c.timeStamps)}_canvasPixelComparison(_,c,p){let x=p[1]-p[0];const S=_.length/4;for(let I=0;I<c.length;I++){const O=c[I];let j=0;for(let G=0;G<O.length;G+=4)O[G]===_[G]&&O[G+1]===_[G+1]&&O[G+2]===_[G+2]&&O[G+3]===_[G+3]&&(j+=1);x+=(p[I+2]-p[I+1])*(1-j/S)}return x}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=a.exported.frame(c=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(c)}))}_preloadTiles(_){const c=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(c,(p,x)=>p._preloadTiles(_,x),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,c){a.setCacheLimits(_,c)}get version(){return a.version}},NavigationControl:class{constructor(_){this.options=a.extend({},Ja,_),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:c}):p.resetNorth({},{originalEvent:c}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const c=_.getZoom(),p=c===_.getMaxZoom(),x=c===_.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ua(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,c){const p=N("button",_,this._container);return p.type="button",p.addEventListener("click",c),p}_setButtonTitle(_,c){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${c}`);_.setAttribute("aria-label",p),_.firstElementChild&&_.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends a.Evented{constructor(_){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},bs,_),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ls(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const c=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,_(p)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(p=>c(p.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(_){const c=this._map.getMaxBounds(),p=_.coords;return!!c&&(p.longitude<c.getWest()||p.longitude>c.getEast()||p.latitude<c.getSouth()||p.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",_)),this._finish()}}_updateCamera(_){const c=new a.LngLat(_.coords.longitude,_.coords.latitude),p=_.coords.accuracy,x=this._map.getBearing(),S=a.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(p),S,{geolocateSource:!0})}_updateMarker(_){if(_){const c=new a.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,c=a.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,p=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ht({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ht({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:tt,ScaleControl:class{constructor(_){this.options=a.extend({},vl,_),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=pu.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,c=this._map,p=c._containerHeight/2,x=c._containerWidth/2-_/2,S=c.unproject([x,p]),I=c.unproject([x+_,p]),O=S.distanceTo(I);if(this.options.unit==="imperial"){const j=3.2808*O;j>5280?this._setScale(_,j/5280,"mile"):this._setScale(_,j,"foot")}else this.options.unit==="nautical"?this._setScale(_,O/1852,"nautical-mile"):O>=1e3?this._setScale(_,O/1e3,"kilometer"):this._setScale(_,O,"meter")}_setScale(_,c,p){const x=Pc(c),S=x/c;this._map._requestDomTask(()=>{this._container.style.width=_*S+"px",this._container.innerHTML=p!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:p}).format(x):`${x}&nbsp;nm`})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof a.window.HTMLElement?this._container=_.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(_){super(),this.options=a.extend(Object.create(vi),_),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=a.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(a.window.document.createTextNode(_))}setHTML(_){const c=a.window.document.createDocumentFragment(),p=a.window.document.createElement("body");let x;for(p.innerHTML=_;x=p.firstChild,x;)c.appendChild(x);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(_),this.options.closeButton){const p=this._closeButton=N("button","mapboxgl-popup-close-button",c);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let c;return this._classList.delete(_)?c=!1:(this._classList.add(_),c=!0),this._updateClassList(),c}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const c=this._map,p=this._container,x=this._pos;if(!c||!p||!x)return"bottom";const S=p.offsetWidth,I=p.offsetHeight,O=x.x<S/2,j=x.x>c.transform.width-S/2;if(x.y+_<I)return O?"top-left":j?"top-right":"top";if(x.y>c.transform.height-I){if(O)return"bottom-left";if(j)return"bottom-right"}return O?"left":j?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),_.className=c.join(" ")}_update(_){const c=this._map,p=this._content;if(!c||!this._lngLat&&!this._trackPointer||!p)return;let x=this._container;if(x||(x=this._container=N("div","mapboxgl-popup",c.getContainer()),this._tip=N("div","mapboxgl-popup-tip",x),x.appendChild(p)),this.options.maxWidth&&x.style.maxWidth!==this.options.maxWidth&&(x.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$r(this._lngLat,this._pos,c.transform)),!this._trackPointer||_){const S=this._pos=this._trackPointer&&_?_:c.project(this._lngLat),I=ln(this.options.offset),O=this._anchor=this._getAnchor(I.y),j=ln(this.options.offset,O),G=S.add(j).round();c._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${Fr[O]} translate(${G.x}px,${G.y}px)`)})}if(!this._marker&&c._showingGlobe()){const S=a.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Ii);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Ht,Style:Qn,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:hl,Evented:a.Evented,config:a.config,prewarm:function(){ni().acquire(Kr)},clearPrewarmedResources:function(){const _=Wr;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Kr),Wr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(_){a.config.ACCESS_TOKEN=_},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(_){a.config.API_URL=_},get workerCount(){return ri.workerCount},set workerCount(_){ri.workerCount=_},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){a.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){a.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Gl});var g=u;return g})})(mapboxGl);var mapboxgl=mapboxGl.exports,d2r=Math.PI/180,r2d=180/Math.PI;function tileToBBOX(e){var t=tile2lon(e[0]+1,e[2]),n=tile2lon(e[0],e[2]),o=tile2lat(e[1]+1,e[2]),u=tile2lat(e[1],e[2]);return[n,o,t,u]}function tileToGeoJSON(e){var t=tileToBBOX(e),n={type:"Polygon",coordinates:[[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]]};return n}function tile2lon(e,t){return e/Math.pow(2,t)*360-180}function tile2lat(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return r2d*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function pointToTile(e,t,n){var o=pointToTileFraction(e,t,n);return o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o}function getChildren(e){return[[e[0]*2,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2+1,e[2]+1],[e[0]*2,e[1]*2+1,e[2]+1]]}function getParent(e){return[e[0]>>1,e[1]>>1,e[2]-1]}function getSiblings(e){return getChildren(getParent(e))}function hasSiblings(e,t){for(var n=getSiblings(e),o=0;o<n.length;o++)if(!hasTile(t,n[o]))return!1;return!0}function hasTile(e,t){for(var n=0;n<e.length;n++)if(tilesEqual(e[n],t))return!0;return!1}function tilesEqual(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function tileToQuadkey(e){for(var t="",n=e[2];n>0;n--){var o=0,u=1<<n-1;(e[0]&u)!==0&&o++,(e[1]&u)!==0&&(o+=2),t+=o.toString()}return t}function quadkeyToTile(e){for(var t=0,n=0,o=e.length,u=o;u>0;u--){var f=1<<u-1,g=+e[o-u];g===1&&(t|=f),g===2&&(n|=f),g===3&&(t|=f,n|=f)}return[t,n,o]}function bboxToTile(e){var t=pointToTile(e[0],e[1],32),n=pointToTile(e[2],e[3],32),o=[t[0],t[1],n[0],n[1]],u=getBboxZoom(o);if(u===0)return[0,0,0];var f=o[0]>>>32-u,g=o[1]>>>32-u;return[f,g,u]}function getBboxZoom(e){for(var t=28,n=0;n<t;n++){var o=1<<32-(n+1);if((e[0]&o)!==(e[2]&o)||(e[1]&o)!==(e[3]&o))return n}return t}function pointToTileFraction(e,t,n){var o=Math.sin(t*d2r),u=Math.pow(2,n),f=u*(e/360+.5),g=u*(.5-.25*Math.log((1+o)/(1-o))/Math.PI);return f=f%u,f<0&&(f=f+u),[f,g,n]}var tilebelt={tileToGeoJSON,tileToBBOX,getChildren,getParent,getSiblings,hasTile,hasSiblings,tilesEqual,tileToQuadkey,quadkeyToTile,pointToTile,bboxToTile,pointToTileFraction},earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936};function feature(e,t,n){n===void 0&&(n={});var o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=t||{},o.geometry=e,o}function point(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(e[0])||!isNumber(e[1]))throw new Error("coordinates must contain numbers");var o={type:"Point",coordinates:e};return feature(o,t,n)}function polygon(e,t,n){n===void 0&&(n={});for(var o=0,u=e;o<u.length;o++){var f=u[o];if(f.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var g=0;g<f[f.length-1].length;g++)if(f[f.length-1][g]!==f[0][g])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return feature(a,t,n)}function radiansToLength(e,t){t===void 0&&(t="kilometers");var n=factors[t];if(!n)throw new Error(t+" units is invalid");return e*n}function lengthToRadians(e,t){t===void 0&&(t="kilometers");var n=factors[t];if(!n)throw new Error(t+" units is invalid");return e/n}function radiansToDegrees(e){var t=e%(2*Math.PI);return t*180/Math.PI}function degreesToRadians(e){var t=e%360;return t*Math.PI/180}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function geomEach(e,t){var n,o,u,f,g,a,b,T,C,L,N=0,F=e.type==="FeatureCollection",H=e.type==="Feature",se=F?e.features.length:1;for(n=0;n<se;n++){for(a=F?e.features[n].geometry:H?e.geometry:e,T=F?e.features[n].properties:H?e.properties:{},C=F?e.features[n].bbox:H?e.bbox:void 0,L=F?e.features[n].id:H?e.id:void 0,b=a?a.type==="GeometryCollection":!1,g=b?a.geometries.length:1,u=0;u<g;u++){if(f=b?a.geometries[u]:a,f===null){if(t(null,N,T,C,L)===!1)return!1;continue}switch(f.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(f,N,T,C,L)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<f.geometries.length;o++)if(t(f.geometries[o],N,T,C,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}function geomReduce(e,t,n){var o=n;return geomEach(e,function(u,f,g,a,b){f===0&&n===void 0?o=u:o=t(o,u,f,g,a,b)}),o}function getCoord(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function distance(e,t,n){n===void 0&&(n={});var o=getCoord(e),u=getCoord(t),f=degreesToRadians(u[1]-o[1]),g=degreesToRadians(u[0]-o[0]),a=degreesToRadians(o[1]),b=degreesToRadians(u[1]),T=Math.pow(Math.sin(f/2),2)+Math.pow(Math.sin(g/2),2)*Math.cos(a)*Math.cos(b);return radiansToLength(2*Math.atan2(Math.sqrt(T),Math.sqrt(1-T)),n.units)}function bboxPolygon(e,t){t===void 0&&(t={});var n=Number(e[0]),o=Number(e[1]),u=Number(e[2]),f=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var g=[n,o],a=[n,f],b=[u,f],T=[u,o];return polygon([[g,T,b,a,g]],t.properties,{bbox:e,id:t.id})}function destination(e,t,n,o){o===void 0&&(o={});var u=getCoord(e),f=degreesToRadians(u[0]),g=degreesToRadians(u[1]),a=degreesToRadians(n),b=lengthToRadians(t,o.units),T=Math.asin(Math.sin(g)*Math.cos(b)+Math.cos(g)*Math.sin(b)*Math.cos(a)),C=f+Math.atan2(Math.sin(a)*Math.sin(b)*Math.cos(g),Math.cos(b)-Math.sin(g)*Math.sin(T)),L=radiansToDegrees(C),N=radiansToDegrees(T);return point([L,N],o.properties)}function bearing(e,t,n){if(n===void 0&&(n={}),n.final===!0)return calculateFinalBearing(e,t);var o=getCoord(e),u=getCoord(t),f=degreesToRadians(o[0]),g=degreesToRadians(u[0]),a=degreesToRadians(o[1]),b=degreesToRadians(u[1]),T=Math.sin(g-f)*Math.cos(b),C=Math.cos(a)*Math.sin(b)-Math.sin(a)*Math.cos(b)*Math.cos(g-f);return radiansToDegrees(Math.atan2(T,C))}function calculateFinalBearing(e,t){var n=bearing(t,e);return n=(n+180)%360,n}function midpoint(e,t){var n=distance(e,t),o=bearing(e,t),u=destination(e,n/2,o);return u}var RADIUS=6378137;function area(e){return geomReduce(e,function(t,n){return t+calculateArea(n)},0)}function calculateArea(e){var t=0,n;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)t+=polygonArea(e.coordinates[n]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function polygonArea(e){var t=0;if(e&&e.length>0){t+=Math.abs(ringArea(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(ringArea(e[n]))}return t}function ringArea(e){var t,n,o,u,f,g,a,b=0,T=e.length;if(T>2){for(a=0;a<T;a++)a===T-2?(u=T-2,f=T-1,g=0):a===T-1?(u=T-1,f=0,g=1):(u=a,f=a+1,g=a+2),t=e[u],n=e[f],o=e[g],b+=(rad(o[0])-rad(t[0]))*Math.sin(rad(n[1]));b=b*RADIUS*RADIUS/2}return b}function rad(e){return e*Math.PI/180}const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,t){return e>=this.width||t>=this.height?0:this.getBit(t*this.width+e)},setBitXY(e,t){this.setBit(t*this.width+e)},clearBitXY(e,t){this.clearBit(t*this.width+e)},toggleBitXY(e,t){this.toggleBit(t*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const t in bitMethods)e.prototype[t]=bitMethods[t]}function checkProcessable(e,t={}){let{bitDepth:n,alpha:o,colorModel:u,components:f,channels:g}=t;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${n}`);if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${o}`);if(u&&(Array.isArray(u)||(u=[u]),!u.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${u}`);if(f&&(Array.isArray(f)||(f=[f]),!f.includes(this.components))){let a=`The process: ${e} can only be applied if the number of components is in: ${f}`;throw f.length===1&&f[0]===1?new TypeError(`${a}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(a)}if(g&&(Array.isArray(g)||(g=[g]),!g.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${g}`)}function createBlob(e,t){e=e||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(e,t)}catch(f){if(f.name!=="TypeError")throw f;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,o=new n,u=0;u<e.length;u+=1)o.append(e[u]);return o.getBlob(t.type)}}function dataURLToBlob(e){var t=e.match(/data:([^;]+)/)[1],n=e.replace(/^[^,]+,/,""),o=binaryStringToArrayBuffer(atob(n));return createBlob([o],{type:t})}function canvasToBlob(e,t,n){return typeof e.toBlob=="function"?new Promise(function(o){e.toBlob(o,t,n)}):Promise.resolve(dataURLToBlob(e.toDataURL(t,n)))}function binaryStringToArrayBuffer(e){for(var t=e.length,n=new ArrayBuffer(t),o=new Uint8Array(n),u=-1;++u<t;)o[u]=e.charCodeAt(u);return n}(function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function t(o="utf-8"){if(o!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${o}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(o,u={stream:!1}){if(u.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let f=0;const g=o.length;let a=0,b=Math.max(32,g+(g>>1)+7),T=new Uint8Array(b>>3<<3);for(;f<g;){let C=o.charCodeAt(f++);if(C>=55296&&C<=56319){if(f<g){const L=o.charCodeAt(f);(L&64512)===56320&&(++f,C=((C&1023)<<10)+(L&1023)+65536)}if(C>=55296&&C<=56319)continue}if(a+4>T.length){b+=8,b*=1+f/o.length*2,b=b>>3<<3;const L=new Uint8Array(b);L.set(T),T=L}if((C&4294967168)===0){T[a++]=C;continue}else if((C&4294965248)===0)T[a++]=C>>6&31|192;else if((C&4294901760)===0)T[a++]=C>>12&15|224,T[a++]=C>>6&63|128;else if((C&4292870144)===0)T[a++]=C>>18&7|240,T[a++]=C>>12&63|128,T[a++]=C>>6&63|128;else continue;T[a++]=C&63|128}return T.slice(0,a)};function n(o="utf-8",u={fatal:!1}){if(o!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${o}') is invalid.`);if(u.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1}),n.prototype.decode=function(o,u={stream:!1}){if(u.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const f=new Uint8Array(o);let g=0;const a=f.length,b=[];for(;g<a;){const T=f[g++];if(T===0)break;if((T&128)===0)b.push(T);else if((T&224)===192){const C=f[g++]&63;b.push((T&31)<<6|C)}else if((T&240)===224){const C=f[g++]&63,L=f[g++]&63;b.push((T&31)<<12|C<<6|L)}else if((T&248)===240){const C=f[g++]&63,L=f[g++]&63,N=f[g++]&63;let F=(T&7)<<18|C<<12|L<<6|N;F>65535&&(F-=65536,b.push(F>>>10&1023|55296),F=56320|F&1023),b.push(F)}}return String.fromCharCode.apply(null,b)},e.TextEncoder=t,e.TextDecoder=n})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$5(e,t="utf8"){return new TextDecoder(t).decode(e)}const encoder$1=new TextEncoder;function encode$3(e){return encoder$1.encode(e)}const defaultByteLength$1=1024*8;class IOBuffer$4{constructor(t=defaultByteLength$1,n={}){let o=!1;typeof t=="number"?t=new ArrayBuffer(t):(o=!0,this.lastWrittenByte=t.byteLength);const u=n.offset?n.offset>>>0:0,f=t.byteLength-u;let g=u;(ArrayBuffer.isView(t)||t instanceof IOBuffer$4)&&(t.byteLength!==t.buffer.byteLength&&(g=t.byteOffset+u),t=t.buffer),o?this.lastWrittenByte=f:this.lastWrittenByte=0,this.buffer=t,this.length=f,this.byteLength=f,this.byteOffset=g,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,g,f),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const o=(this.offset+t)*2,u=new Uint8Array(o);u.set(new Uint8Array(this.buffer)),this.buffer=u.buffer,this.length=this.byteLength=o,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=this.readByte();return n}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let n="";for(let o=0;o<t;o++)n+=this.readChar();return n}readUtf8(t=1){return decode$5(this.readBytes(t))}decodeText(t=1,n="utf-8"){return decode$5(this.readBytes(t),n)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let n=0;n<t.length;n++)this._data.setUint8(this.offset++,t[n]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));return this}writeUtf8(t){return this.writeBytes(encode$3(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}var IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(IOBuffer$5),constants$c={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$4,constants$b=constants$c,tableLeft=[];for(let e=0;e<=8;e++)tableLeft.push(255<<e);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const n=Math.floor((this.bitDepth*this.width+31)/32)*4,o=Math.ceil(this.bitDepth*this.width/8),u=n-o,f=this.bitDepth*this.width%8,g=f===0?0:8-f,a=n*this.height;let b,T,C=0,L=0,N=8;t.mark(),T=this.readUint8();for(let F=this.height-1;F>=0;F--){const H=F===0;t.reset(),t.skip(F*n);for(let se=0;se<o;se++){const ce=se===o-1;L<=g&&ce?(t.writeByte(T<<L),(g===0||g===L)&&!H&&(b=T,T=this.readByte())):L===0?(b=T,T=this.readUint8(),t.writeByte(b)):(b=T,T=this.readUint8(),t.writeByte(b<<L&tableLeft[L]|T>>N)),ce&&(C+=f||0,t.skip(u),L=C%8,N=8-L)}}n>o&&(t.reset(),t.skip(a-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const n=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$b.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(n).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$b.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$b.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(t){return new Encoder(t).encode()};/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,t,n,o,u){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=u,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,n)=>{e.bi_valid>Buf_size-n?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=n-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},send_code=(e,t,n)=>{send_bits(e,n[t*2],n[t*2+1])},bi_reverse=(e,t)=>{let n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const n=t.dyn_tree,o=t.max_code,u=t.stat_desc.static_tree,f=t.stat_desc.has_stree,g=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,b=t.stat_desc.max_length;let T,C,L,N,F,H,se=0;for(N=0;N<=MAX_BITS$1;N++)e.bl_count[N]=0;for(n[e.heap[e.heap_max]*2+1]=0,T=e.heap_max+1;T<HEAP_SIZE$1;T++)C=e.heap[T],N=n[n[C*2+1]*2+1]+1,N>b&&(N=b,se++),n[C*2+1]=N,!(C>o)&&(e.bl_count[N]++,F=0,C>=a&&(F=g[C-a]),H=n[C*2],e.opt_len+=H*(N+F),f&&(e.static_len+=H*(u[C*2+1]+F)));if(se!==0){do{for(N=b-1;e.bl_count[N]===0;)N--;e.bl_count[N]--,e.bl_count[N+1]+=2,e.bl_count[b]--,se-=2}while(se>0);for(N=b;N!==0;N--)for(C=e.bl_count[N];C!==0;)L=e.heap[--T],!(L>o)&&(n[L*2+1]!==N&&(e.opt_len+=(N-n[L*2+1])*n[L*2],n[L*2+1]=N),C--)}},gen_codes=(e,t,n)=>{const o=new Array(MAX_BITS$1+1);let u=0,f,g;for(f=1;f<=MAX_BITS$1;f++)o[f]=u=u+n[f-1]<<1;for(g=0;g<=t;g++){let a=e[g*2+1];a!==0&&(e[g*2]=bi_reverse(o[a]++,a))}},tr_static_init=()=>{let e,t,n,o,u;const f=new Array(MAX_BITS$1+1);for(n=0,o=0;o<LENGTH_CODES$1-1;o++)for(base_length[o]=n,e=0;e<1<<extra_lbits[o];e++)_length_code[n++]=o;for(_length_code[n-1]=o,u=0,o=0;o<16;o++)for(base_dist[o]=u,e=0;e<1<<extra_dbits[o];e++)_dist_code[u++]=o;for(u>>=7;o<D_CODES$1;o++)for(base_dist[o]=u<<7,e=0;e<1<<extra_dbits[o]-7;e++)_dist_code[256+u++]=o;for(t=0;t<=MAX_BITS$1;t++)f[t]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,f[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,f[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,f[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,f[8]++;for(gen_codes(static_ltree,L_CODES$1+1,f),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},copy_block=(e,t,n,o)=>{bi_windup(e),o&&(put_short(e,n),put_short(e,~n)),e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},smaller=(e,t,n,o)=>{const u=t*2,f=n*2;return e[u]<e[f]||e[u]===e[f]&&o[t]<=o[n]},pqdownheap=(e,t,n)=>{const o=e.heap[n];let u=n<<1;for(;u<=e.heap_len&&(u<e.heap_len&&smaller(t,e.heap[u+1],e.heap[u],e.depth)&&u++,!smaller(t,o,e.heap[u],e.depth));)e.heap[n]=e.heap[u],n=u,u<<=1;e.heap[n]=o},compress_block=(e,t,n)=>{let o,u,f=0,g,a;if(e.last_lit!==0)do o=e.pending_buf[e.d_buf+f*2]<<8|e.pending_buf[e.d_buf+f*2+1],u=e.pending_buf[e.l_buf+f],f++,o===0?send_code(e,u,t):(g=_length_code[u],send_code(e,g+LITERALS$1+1,t),a=extra_lbits[g],a!==0&&(u-=base_length[g],send_bits(e,u,a)),o--,g=d_code(o),send_code(e,g,n),a=extra_dbits[g],a!==0&&(o-=base_dist[g],send_bits(e,o,a)));while(f<e.last_lit);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const n=t.dyn_tree,o=t.stat_desc.static_tree,u=t.stat_desc.has_stree,f=t.stat_desc.elems;let g,a,b=-1,T;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,g=0;g<f;g++)n[g*2]!==0?(e.heap[++e.heap_len]=b=g,e.depth[g]=0):n[g*2+1]=0;for(;e.heap_len<2;)T=e.heap[++e.heap_len]=b<2?++b:0,n[T*2]=1,e.depth[T]=0,e.opt_len--,u&&(e.static_len-=o[T*2+1]);for(t.max_code=b,g=e.heap_len>>1;g>=1;g--)pqdownheap(e,n,g);T=f;do g=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=g,e.heap[--e.heap_max]=a,n[T*2]=n[g*2]+n[a*2],e.depth[T]=(e.depth[g]>=e.depth[a]?e.depth[g]:e.depth[a])+1,n[g*2+1]=n[a*2+1]=T,e.heap[1]=T++,pqdownheap(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(n,b,e.bl_count)},scan_tree=(e,t,n)=>{let o,u=-1,f,g=t[0*2+1],a=0,b=7,T=4;for(g===0&&(b=138,T=3),t[(n+1)*2+1]=65535,o=0;o<=n;o++)f=g,g=t[(o+1)*2+1],!(++a<b&&f===g)&&(a<T?e.bl_tree[f*2]+=a:f!==0?(f!==u&&e.bl_tree[f*2]++,e.bl_tree[REP_3_6*2]++):a<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,a=0,u=f,g===0?(b=138,T=3):f===g?(b=6,T=3):(b=7,T=4))},send_tree=(e,t,n)=>{let o,u=-1,f,g=t[0*2+1],a=0,b=7,T=4;for(g===0&&(b=138,T=3),o=0;o<=n;o++)if(f=g,g=t[(o+1)*2+1],!(++a<b&&f===g)){if(a<T)do send_code(e,f,e.bl_tree);while(--a!==0);else f!==0?(f!==u&&(send_code(e,f,e.bl_tree),a--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,a-3,2)):a<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,a-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,a-11,7));a=0,u=f,g===0?(b=138,T=3):f===g?(b=6,T=3):(b=7,T=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&e.bl_tree[bl_order[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,n,o)=>{let u;for(send_bits(e,t-257,5),send_bits(e,n-1,5),send_bits(e,o-4,4),u=0;u<o;u++)send_bits(e,e.bl_tree[bl_order[u]*2+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,n-1)},detect_data_type=e=>{let t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(n=32;n<LITERALS$1;n++)if(e.dyn_ltree[n*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,t,n,o)=>{send_bits(e,(STORED_BLOCK<<1)+(o?1:0),3),copy_block(e,t,n,!0)},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,t,n,o)=>{let u,f,g=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),g=build_bl_tree(e),u=e.opt_len+3+7>>>3,f=e.static_len+3+7>>>3,f<=u&&(u=f)):u=f=n+5,n+4<=u&&t!==-1?_tr_stored_block$1(e,t,n,o):e.strategy===Z_FIXED$1||f===u?(send_bits(e,(STATIC_TREES<<1)+(o?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(o?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,g+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),o&&bi_windup(e)},_tr_tally$1=(e,t,n)=>(e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=n&255,e.last_lit++,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code[n]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(t)*2]++),e.last_lit===e.lit_bufsize-1);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,t,n,o)=>{let u=e&65535|0,f=e>>>16&65535|0,g=0;for(;n!==0;){g=n>2e3?2e3:n,n-=g;do u=u+t[o++]|0,f=f+u|0;while(--g);u%=65521,f%=65521}return u|f<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t},crcTable$1=new Uint32Array(makeTable()),crc32=(e,t,n,o)=>{const u=crcTable$1,f=o+n;e^=-1;for(let g=o;g<f;g++)e=e>>>8^u[(e^t[g])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2$1,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=messages[t],t),rank=e=>(e<<1)-(e>4?9:0),zero=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let HASH_ZLIB=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf=(e,t,n,o)=>{let u=e.avail_in;return u>o&&(u=o),u===0?0:(e.avail_in-=u,t.set(e.input.subarray(e.next_in,e.next_in+u),n),e.state.wrap===1?e.adler=adler32_1(e.adler,t,u,n):e.state.wrap===2&&(e.adler=crc32_1(e.adler,t,u,n)),e.next_in+=u,e.total_in+=u,u)},longest_match=(e,t)=>{let n=e.max_chain_length,o=e.strstart,u,f,g=e.prev_length,a=e.nice_match;const b=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,T=e.window,C=e.w_mask,L=e.prev,N=e.strstart+MAX_MATCH;let F=T[o+g-1],H=T[o+g];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do if(u=t,!(T[u+g]!==H||T[u+g-1]!==F||T[u]!==T[o]||T[++u]!==T[o+1])){o+=2,u++;do;while(T[++o]===T[++u]&&T[++o]===T[++u]&&T[++o]===T[++u]&&T[++o]===T[++u]&&T[++o]===T[++u]&&T[++o]===T[++u]&&T[++o]===T[++u]&&T[++o]===T[++u]&&o<N);if(f=MAX_MATCH-(N-o),o=N-MAX_MATCH,f>g){if(e.match_start=t,g=f,f>=a)break;F=T[o+g-1],H=T[o+g]}}while((t=L[t&C])>b&&--n!==0);return g<=e.lookahead?g:e.lookahead},fill_window=e=>{const t=e.w_size;let n,o,u,f,g;do{if(f=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,o=e.hash_size,n=o;do u=e.head[--n],e.head[n]=u>=t?u-t:0;while(--o);o=t,n=o;do u=e.prev[--n],e.prev[n]=u>=t?u-t:0;while(--o);f+=t}if(e.strm.avail_in===0)break;if(o=read_buf(e.strm,e.window,e.strstart+e.lookahead,f),e.lookahead+=o,e.lookahead+e.insert>=MIN_MATCH)for(g=e.strstart-e.insert,e.ins_h=e.window[g],e.ins_h=HASH(e,e.ins_h,e.window[g+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[g+MIN_MATCH-1]),e.prev[g&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=g,g++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,t)=>{let n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),e.lookahead===0&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;const o=e.block_start+n;if((e.strstart===0||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,flush_block_only(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out===0),BS_NEED_MORE)},deflate_fast=(e,t)=>{let n,o;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(n=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,n)),e.match_length>=MIN_MATCH)if(o=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else o=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let n,o,u;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(n=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,n),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){u=e.strstart+e.lookahead-MIN_MATCH,o=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=u&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,o&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(o=_tr_tally(e,0,e.window[e.strstart-1]),o&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let n,o,u,f;const g=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(u=e.strstart-1,o=g[u],o===g[++u]&&o===g[++u]&&o===g[++u])){f=e.strstart+MAX_MATCH;do;while(o===g[++u]&&o===g[++u]&&o===g[++u]&&o===g[++u]&&o===g[++u]&&o===g[++u]&&o===g[++u]&&o===g[++u]&&u<f);e.match_length=MAX_MATCH-(f-u),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(n=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let n;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,n,o,u){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=u}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateResetKeep=e=>{if(!e||!e.state)return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=t.wrap===2?0:1,t.last_flush=Z_NO_FLUSH$2,_tr_init(t),Z_OK$3},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK$3&&lm_init(e.state),t},deflateSetHeader=(e,t)=>!e||!e.state||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=t,Z_OK$3),deflateInit2=(e,t,n,o,u,f)=>{if(!e)return Z_STREAM_ERROR$2;let g=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),o<0?(g=0,o=-o):o>15&&(g=2,o-=16),u<1||u>MAX_MEM_LEVEL||n!==Z_DEFLATED$2||o<8||o>15||t<0||t>9||f<0||f>Z_FIXED)return err(e,Z_STREAM_ERROR$2);o===8&&(o=9);const a=new DeflateState;return e.state=a,a.strm=e,a.wrap=g,a.gzhead=null,a.w_bits=o,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=u+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+MIN_MATCH-1)/MIN_MATCH),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<u+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=(1+2)*a.lit_bufsize,a.level=t,a.strategy=f,a.method=n,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,t)=>{let n,o;if(!e||!e.state||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const u=e.state;if(!e.output||!e.input&&e.avail_in!==0||u.status===FINISH_STATE&&t!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);u.strm=e;const f=u.last_flush;if(u.last_flush=t,u.status===INIT_STATE)if(u.wrap===2)e.adler=0,put_byte(u,31),put_byte(u,139),put_byte(u,8),u.gzhead?(put_byte(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),put_byte(u,u.gzhead.time&255),put_byte(u,u.gzhead.time>>8&255),put_byte(u,u.gzhead.time>>16&255),put_byte(u,u.gzhead.time>>24&255),put_byte(u,u.level===9?2:u.strategy>=Z_HUFFMAN_ONLY||u.level<2?4:0),put_byte(u,u.gzhead.os&255),u.gzhead.extra&&u.gzhead.extra.length&&(put_byte(u,u.gzhead.extra.length&255),put_byte(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=EXTRA_STATE):(put_byte(u,0),put_byte(u,0),put_byte(u,0),put_byte(u,0),put_byte(u,0),put_byte(u,u.level===9?2:u.strategy>=Z_HUFFMAN_ONLY||u.level<2?4:0),put_byte(u,OS_CODE),u.status=BUSY_STATE);else{let g=Z_DEFLATED$2+(u.w_bits-8<<4)<<8,a=-1;u.strategy>=Z_HUFFMAN_ONLY||u.level<2?a=0:u.level<6?a=1:u.level===6?a=2:a=3,g|=a<<6,u.strstart!==0&&(g|=PRESET_DICT),g+=31-g%31,u.status=BUSY_STATE,putShortMSB(u,g),u.strstart!==0&&(putShortMSB(u,e.adler>>>16),putShortMSB(u,e.adler&65535)),e.adler=1}if(u.status===EXTRA_STATE)if(u.gzhead.extra){for(n=u.pending;u.gzindex<(u.gzhead.extra.length&65535)&&!(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>n&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending-n,n)),flush_pending(e),n=u.pending,u.pending===u.pending_buf_size));)put_byte(u,u.gzhead.extra[u.gzindex]&255),u.gzindex++;u.gzhead.hcrc&&u.pending>n&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending-n,n)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=NAME_STATE)}else u.status=NAME_STATE;if(u.status===NAME_STATE)if(u.gzhead.name){n=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>n&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending-n,n)),flush_pending(e),n=u.pending,u.pending===u.pending_buf_size)){o=1;break}u.gzindex<u.gzhead.name.length?o=u.gzhead.name.charCodeAt(u.gzindex++)&255:o=0,put_byte(u,o)}while(o!==0);u.gzhead.hcrc&&u.pending>n&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending-n,n)),o===0&&(u.gzindex=0,u.status=COMMENT_STATE)}else u.status=COMMENT_STATE;if(u.status===COMMENT_STATE)if(u.gzhead.comment){n=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>n&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending-n,n)),flush_pending(e),n=u.pending,u.pending===u.pending_buf_size)){o=1;break}u.gzindex<u.gzhead.comment.length?o=u.gzhead.comment.charCodeAt(u.gzindex++)&255:o=0,put_byte(u,o)}while(o!==0);u.gzhead.hcrc&&u.pending>n&&(e.adler=crc32_1(e.adler,u.pending_buf,u.pending-n,n)),o===0&&(u.status=HCRC_STATE)}else u.status=HCRC_STATE;if(u.status===HCRC_STATE&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&flush_pending(e),u.pending+2<=u.pending_buf_size&&(put_byte(u,e.adler&255),put_byte(u,e.adler>>8&255),e.adler=0,u.status=BUSY_STATE)):u.status=BUSY_STATE),u.pending!==0){if(flush_pending(e),e.avail_out===0)return u.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(t)<=rank(f)&&t!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(u.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(e.avail_in!==0||u.lookahead!==0||t!==Z_NO_FLUSH$2&&u.status!==FINISH_STATE){let g=u.strategy===Z_HUFFMAN_ONLY?deflate_huff(u,t):u.strategy===Z_RLE?deflate_rle(u,t):configuration_table[u.level].func(u,t);if((g===BS_FINISH_STARTED||g===BS_FINISH_DONE)&&(u.status=FINISH_STATE),g===BS_NEED_MORE||g===BS_FINISH_STARTED)return e.avail_out===0&&(u.last_flush=-1),Z_OK$3;if(g===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(u):t!==Z_BLOCK$1&&(_tr_stored_block(u,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(u.head),u.lookahead===0&&(u.strstart=0,u.block_start=0,u.insert=0))),flush_pending(e),e.avail_out===0))return u.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:u.wrap<=0?Z_STREAM_END$3:(u.wrap===2?(put_byte(u,e.adler&255),put_byte(u,e.adler>>8&255),put_byte(u,e.adler>>16&255),put_byte(u,e.adler>>24&255),put_byte(u,e.total_in&255),put_byte(u,e.total_in>>8&255),put_byte(u,e.total_in>>16&255),put_byte(u,e.total_in>>24&255)):(putShortMSB(u,e.adler>>>16),putShortMSB(u,e.adler&65535)),flush_pending(e),u.wrap>0&&(u.wrap=-u.wrap),u.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(!e||!e.state)return Z_STREAM_ERROR$2;const t=e.state.status;return t!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR$2):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3)},deflateSetDictionary=(e,t)=>{let n=t.length;if(!e||!e.state)return Z_STREAM_ERROR$2;const o=e.state,u=o.wrap;if(u===2||u===1&&o.status!==INIT_STATE||o.lookahead)return Z_STREAM_ERROR$2;if(u===1&&(e.adler=adler32_1(e.adler,t,n,0)),o.wrap=0,n>=o.w_size){u===0&&(zero(o.head),o.strstart=0,o.block_start=0,o.insert=0);let b=new Uint8Array(o.w_size);b.set(t.subarray(n-o.w_size,n),0),t=b,n=o.w_size}const f=e.avail_in,g=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,fill_window(o);o.lookahead>=MIN_MATCH;){let b=o.strstart,T=o.lookahead-(MIN_MATCH-1);do o.ins_h=HASH(o,o.ins_h,o.window[b+MIN_MATCH-1]),o.prev[b&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=b,b++;while(--T);o.strstart=b,o.lookahead=MIN_MATCH-1,fill_window(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=MIN_MATCH-1,o.match_available=0,e.next_in=g,e.input=a,e.avail_in=f,o.wrap=u,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(!!n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const o in n)_has(n,o)&&(e[o]=n[o])}}return e},flattenChunks=e=>{let t=0;for(let o=0,u=e.length;o<u;o++)t+=e[o].length;const n=new Uint8Array(t);for(let o=0,u=0,f=e.length;o<f;o++){let g=e[o];n.set(g,u),u+=g.length}return n},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,o,u,f,g=e.length,a=0;for(u=0;u<g;u++)n=e.charCodeAt(u),(n&64512)===55296&&u+1<g&&(o=e.charCodeAt(u+1),(o&64512)===56320&&(n=65536+(n-55296<<10)+(o-56320),u++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),f=0,u=0;f<a;u++)n=e.charCodeAt(u),(n&64512)===55296&&u+1<g&&(o=e.charCodeAt(u+1),(o&64512)===56320&&(n=65536+(n-55296<<10)+(o-56320),u++)),n<128?t[f++]=n:n<2048?(t[f++]=192|n>>>6,t[f++]=128|n&63):n<65536?(t[f++]=224|n>>>12,t[f++]=128|n>>>6&63,t[f++]=128|n&63):(t[f++]=240|n>>>18,t[f++]=128|n>>>12&63,t[f++]=128|n>>>6&63,t[f++]=128|n&63);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n};var buf2string=(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let o,u;const f=new Array(n*2);for(u=0,o=0;o<n;){let g=e[o++];if(g<128){f[u++]=g;continue}let a=_utf8len[g];if(a>4){f[u++]=65533,o+=a-1;continue}for(g&=a===2?31:a===3?15:7;a>1&&o<n;)g=g<<6|e[o++]&63,a--;if(a>1){f[u++]=65533;continue}g<65536?f[u++]=g:(g-=65536,f[u++]=55296|g>>10&1023,f[u++]=56320|g&1023)}return buf2binstring(f,u)},utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(e[n]&192)===128;)n--;return n<0||n===0?t:n+_utf8len[e[n]]>t?n:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2$1;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let n=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Z_OK$2)throw new Error(messages[n]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let o;if(typeof t.dictionary=="string"?o=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?o=new Uint8Array(t.dictionary):o=t.dictionary,n=deflate_1$2.deflateSetDictionary(this.strm,o),n!==Z_OK$2)throw new Error(messages[n]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,t){const n=this.strm,o=this.options.chunkSize;let u,f;if(this.ended)return!1;for(t===~~t?f=t:f=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?n.input=strings.string2buf(e):toString$1$1.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(f===Z_SYNC_FLUSH||f===Z_FULL_FLUSH)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(u=deflate_1$2.deflate(n,f),u===Z_STREAM_END$2)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),u=deflate_1$2.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===Z_OK$2;if(n.avail_out===0){this.onData(n.output);continue}if(f>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,t){const n=new Deflate$1(t);if(n.push(e,!0),n.err)throw n.msg||messages[n.err];return n.result}function deflateRaw$1(e,t){return t=t||{},t.raw=!0,deflate$1(e,t)}function gzip$1(e,t){return t=t||{},t.gzip=!0,deflate$1(e,t)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1$1=constants$2$1,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1$1};const BAD$1=30,TYPE$1=12;var inffast=function(t,n){let o,u,f,g,a,b,T,C,L,N,F,H,se,ce,X,ye,oe,le,ue,Re,ze,ve,be,de;const Te=t.state;o=t.next_in,be=t.input,u=o+(t.avail_in-5),f=t.next_out,de=t.output,g=f-(n-t.avail_out),a=f+(t.avail_out-257),b=Te.dmax,T=Te.wsize,C=Te.whave,L=Te.wnext,N=Te.window,F=Te.hold,H=Te.bits,se=Te.lencode,ce=Te.distcode,X=(1<<Te.lenbits)-1,ye=(1<<Te.distbits)-1;e:do{H<15&&(F+=be[o++]<<H,H+=8,F+=be[o++]<<H,H+=8),oe=se[F&X];t:for(;;){if(le=oe>>>24,F>>>=le,H-=le,le=oe>>>16&255,le===0)de[f++]=oe&65535;else if(le&16){ue=oe&65535,le&=15,le&&(H<le&&(F+=be[o++]<<H,H+=8),ue+=F&(1<<le)-1,F>>>=le,H-=le),H<15&&(F+=be[o++]<<H,H+=8,F+=be[o++]<<H,H+=8),oe=ce[F&ye];r:for(;;){if(le=oe>>>24,F>>>=le,H-=le,le=oe>>>16&255,le&16){if(Re=oe&65535,le&=15,H<le&&(F+=be[o++]<<H,H+=8,H<le&&(F+=be[o++]<<H,H+=8)),Re+=F&(1<<le)-1,Re>b){t.msg="invalid distance too far back",Te.mode=BAD$1;break e}if(F>>>=le,H-=le,le=f-g,Re>le){if(le=Re-le,le>C&&Te.sane){t.msg="invalid distance too far back",Te.mode=BAD$1;break e}if(ze=0,ve=N,L===0){if(ze+=T-le,le<ue){ue-=le;do de[f++]=N[ze++];while(--le);ze=f-Re,ve=de}}else if(L<le){if(ze+=T+L-le,le-=L,le<ue){ue-=le;do de[f++]=N[ze++];while(--le);if(ze=0,L<ue){le=L,ue-=le;do de[f++]=N[ze++];while(--le);ze=f-Re,ve=de}}}else if(ze+=L-le,le<ue){ue-=le;do de[f++]=N[ze++];while(--le);ze=f-Re,ve=de}for(;ue>2;)de[f++]=ve[ze++],de[f++]=ve[ze++],de[f++]=ve[ze++],ue-=3;ue&&(de[f++]=ve[ze++],ue>1&&(de[f++]=ve[ze++]))}else{ze=f-Re;do de[f++]=de[ze++],de[f++]=de[ze++],de[f++]=de[ze++],ue-=3;while(ue>2);ue&&(de[f++]=de[ze++],ue>1&&(de[f++]=de[ze++]))}}else if((le&64)===0){oe=ce[(oe&65535)+(F&(1<<le)-1)];continue r}else{t.msg="invalid distance code",Te.mode=BAD$1;break e}break}}else if((le&64)===0){oe=se[(oe&65535)+(F&(1<<le)-1)];continue t}else if(le&32){Te.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",Te.mode=BAD$1;break e}break}}while(o<u&&f<a);ue=H>>3,o-=ue,H-=ue<<3,F&=(1<<H)-1,t.next_in=o,t.next_out=f,t.avail_in=o<u?5+(u-o):5-(o-u),t.avail_out=f<a?257+(a-f):257-(f-a),Te.hold=F,Te.bits=H};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,t,n,o,u,f,g,a)=>{const b=a.bits;let T=0,C=0,L=0,N=0,F=0,H=0,se=0,ce=0,X=0,ye=0,oe,le,ue,Re,ze,ve=null,be=0,de;const Te=new Uint16Array(MAXBITS+1),Ge=new Uint16Array(MAXBITS+1);let Ke=null,St=0,xt,Lr,Nr;for(T=0;T<=MAXBITS;T++)Te[T]=0;for(C=0;C<o;C++)Te[t[n+C]]++;for(F=b,N=MAXBITS;N>=1&&Te[N]===0;N--);if(F>N&&(F=N),N===0)return u[f++]=1<<24|64<<16|0,u[f++]=1<<24|64<<16|0,a.bits=1,0;for(L=1;L<N&&Te[L]===0;L++);for(F<L&&(F=L),ce=1,T=1;T<=MAXBITS;T++)if(ce<<=1,ce-=Te[T],ce<0)return-1;if(ce>0&&(e===CODES$1||N!==1))return-1;for(Ge[1]=0,T=1;T<MAXBITS;T++)Ge[T+1]=Ge[T]+Te[T];for(C=0;C<o;C++)t[n+C]!==0&&(g[Ge[t[n+C]]++]=C);if(e===CODES$1?(ve=Ke=g,de=19):e===LENS$1?(ve=lbase,be-=257,Ke=lext,St-=257,de=256):(ve=dbase,Ke=dext,de=-1),ye=0,C=0,T=L,ze=f,H=F,se=0,ue=-1,X=1<<F,Re=X-1,e===LENS$1&&X>ENOUGH_LENS$1||e===DISTS$1&&X>ENOUGH_DISTS$1)return 1;for(;;){xt=T-se,g[C]<de?(Lr=0,Nr=g[C]):g[C]>de?(Lr=Ke[St+g[C]],Nr=ve[be+g[C]]):(Lr=32+64,Nr=0),oe=1<<T-se,le=1<<H,L=le;do le-=oe,u[ze+(ye>>se)+le]=xt<<24|Lr<<16|Nr|0;while(le!==0);for(oe=1<<T-1;ye&oe;)oe>>=1;if(oe!==0?(ye&=oe-1,ye+=oe):ye=0,C++,--Te[T]===0){if(T===N)break;T=t[n+g[C]]}if(T>F&&(ye&Re)!==ue){for(se===0&&(se=F),ze+=L,H=T-se,ce=1<<H;H+se<N&&(ce-=Te[H+se],!(ce<=0));)H++,ce<<=1;if(X+=1<<H,e===LENS$1&&X>ENOUGH_LENS$1||e===DISTS$1&&X>ENOUGH_DISTS$1)return 1;ue=ye&Re,u[ue]=F<<24|H<<16|ze-f|0}}return ye!==0&&(u[ze+ye]=T-se<<24|64<<16|0),a.bits=F,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2$1,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateResetKeep=e=>{if(!e||!e.state)return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=e=>{if(!e||!e.state)return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let n;if(!e||!e.state)return Z_STREAM_ERROR$1;const o=e.state;return t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(o.window!==null&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const n=new InflateState;e.state=n,n.window=null;const o=inflateReset2(e,t);return o!==Z_OK$1&&(e.state=null),o},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,n,o)=>{let u;const f=e.state;return f.window===null&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new Uint8Array(f.wsize)),o>=f.wsize?(f.window.set(t.subarray(n-f.wsize,n),0),f.wnext=0,f.whave=f.wsize):(u=f.wsize-f.wnext,u>o&&(u=o),f.window.set(t.subarray(n-o,n-o+u),f.wnext),o-=u,o?(f.window.set(t.subarray(n-o,n),0),f.wnext=o,f.whave=f.wsize):(f.wnext+=u,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=u))),0},inflate$2=(e,t)=>{let n,o,u,f,g,a,b,T,C,L,N,F,H,se,ce=0,X,ye,oe,le,ue,Re,ze,ve;const be=new Uint8Array(4);let de,Te;const Ge=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;n=e.state,n.mode===TYPE&&(n.mode=TYPEDO),g=e.next_out,u=e.output,b=e.avail_out,f=e.next_in,o=e.input,a=e.avail_in,T=n.hold,C=n.bits,L=a,N=b,ve=Z_OK$1;e:for(;;)switch(n.mode){case HEAD:if(n.wrap===0){n.mode=TYPEDO;break}for(;C<16;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(n.wrap&2&&T===35615){n.check=0,be[0]=T&255,be[1]=T>>>8&255,n.check=crc32_1(n.check,be,2,0),T=0,C=0,n.mode=FLAGS;break}if(n.flags=0,n.head&&(n.head.done=!1),!(n.wrap&1)||(((T&255)<<8)+(T>>8))%31){e.msg="incorrect header check",n.mode=BAD;break}if((T&15)!==Z_DEFLATED){e.msg="unknown compression method",n.mode=BAD;break}if(T>>>=4,C-=4,ze=(T&15)+8,n.wbits===0)n.wbits=ze;else if(ze>n.wbits){e.msg="invalid window size",n.mode=BAD;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=T&512?DICTID:TYPE,T=0,C=0;break;case FLAGS:for(;C<16;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(n.flags=T,(n.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",n.mode=BAD;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=BAD;break}n.head&&(n.head.text=T>>8&1),n.flags&512&&(be[0]=T&255,be[1]=T>>>8&255,n.check=crc32_1(n.check,be,2,0)),T=0,C=0,n.mode=TIME;case TIME:for(;C<32;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}n.head&&(n.head.time=T),n.flags&512&&(be[0]=T&255,be[1]=T>>>8&255,be[2]=T>>>16&255,be[3]=T>>>24&255,n.check=crc32_1(n.check,be,4,0)),T=0,C=0,n.mode=OS;case OS:for(;C<16;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}n.head&&(n.head.xflags=T&255,n.head.os=T>>8),n.flags&512&&(be[0]=T&255,be[1]=T>>>8&255,n.check=crc32_1(n.check,be,2,0)),T=0,C=0,n.mode=EXLEN;case EXLEN:if(n.flags&1024){for(;C<16;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}n.length=T,n.head&&(n.head.extra_len=T),n.flags&512&&(be[0]=T&255,be[1]=T>>>8&255,n.check=crc32_1(n.check,be,2,0)),T=0,C=0}else n.head&&(n.head.extra=null);n.mode=EXTRA;case EXTRA:if(n.flags&1024&&(F=n.length,F>a&&(F=a),F&&(n.head&&(ze=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(o.subarray(f,f+F),ze)),n.flags&512&&(n.check=crc32_1(n.check,o,F,f)),a-=F,f+=F,n.length-=F),n.length))break e;n.length=0,n.mode=NAME;case NAME:if(n.flags&2048){if(a===0)break e;F=0;do ze=o[f+F++],n.head&&ze&&n.length<65536&&(n.head.name+=String.fromCharCode(ze));while(ze&&F<a);if(n.flags&512&&(n.check=crc32_1(n.check,o,F,f)),a-=F,f+=F,ze)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=COMMENT;case COMMENT:if(n.flags&4096){if(a===0)break e;F=0;do ze=o[f+F++],n.head&&ze&&n.length<65536&&(n.head.comment+=String.fromCharCode(ze));while(ze&&F<a);if(n.flags&512&&(n.check=crc32_1(n.check,o,F,f)),a-=F,f+=F,ze)break e}else n.head&&(n.head.comment=null);n.mode=HCRC;case HCRC:if(n.flags&512){for(;C<16;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(T!==(n.check&65535)){e.msg="header crc mismatch",n.mode=BAD;break}T=0,C=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=TYPE;break;case DICTID:for(;C<32;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}e.adler=n.check=zswap32(T),T=0,C=0,n.mode=DICT;case DICT:if(n.havedict===0)return e.next_out=g,e.avail_out=b,e.next_in=f,e.avail_in=a,n.hold=T,n.bits=C,Z_NEED_DICT$1;e.adler=n.check=1,n.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(n.last){T>>>=C&7,C-=C&7,n.mode=CHECK;break}for(;C<3;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}switch(n.last=T&1,T>>>=1,C-=1,T&3){case 0:n.mode=STORED;break;case 1:if(fixedtables(n),n.mode=LEN_,t===Z_TREES){T>>>=2,C-=2;break e}break;case 2:n.mode=TABLE;break;case 3:e.msg="invalid block type",n.mode=BAD}T>>>=2,C-=2;break;case STORED:for(T>>>=C&7,C-=C&7;C<32;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if((T&65535)!==(T>>>16^65535)){e.msg="invalid stored block lengths",n.mode=BAD;break}if(n.length=T&65535,T=0,C=0,n.mode=COPY_,t===Z_TREES)break e;case COPY_:n.mode=COPY;case COPY:if(F=n.length,F){if(F>a&&(F=a),F>b&&(F=b),F===0)break e;u.set(o.subarray(f,f+F),g),a-=F,f+=F,b-=F,g+=F,n.length-=F;break}n.mode=TYPE;break;case TABLE:for(;C<14;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(n.nlen=(T&31)+257,T>>>=5,C-=5,n.ndist=(T&31)+1,T>>>=5,C-=5,n.ncode=(T&15)+4,T>>>=4,C-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=BAD;break}n.have=0,n.mode=LENLENS;case LENLENS:for(;n.have<n.ncode;){for(;C<3;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}n.lens[Ge[n.have++]]=T&7,T>>>=3,C-=3}for(;n.have<19;)n.lens[Ge[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,de={bits:n.lenbits},ve=inftrees(CODES,n.lens,0,19,n.lencode,0,n.work,de),n.lenbits=de.bits,ve){e.msg="invalid code lengths set",n.mode=BAD;break}n.have=0,n.mode=CODELENS;case CODELENS:for(;n.have<n.nlen+n.ndist;){for(;ce=n.lencode[T&(1<<n.lenbits)-1],X=ce>>>24,ye=ce>>>16&255,oe=ce&65535,!(X<=C);){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(oe<16)T>>>=X,C-=X,n.lens[n.have++]=oe;else{if(oe===16){for(Te=X+2;C<Te;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(T>>>=X,C-=X,n.have===0){e.msg="invalid bit length repeat",n.mode=BAD;break}ze=n.lens[n.have-1],F=3+(T&3),T>>>=2,C-=2}else if(oe===17){for(Te=X+3;C<Te;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}T>>>=X,C-=X,ze=0,F=3+(T&7),T>>>=3,C-=3}else{for(Te=X+7;C<Te;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}T>>>=X,C-=X,ze=0,F=11+(T&127),T>>>=7,C-=7}if(n.have+F>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=BAD;break}for(;F--;)n.lens[n.have++]=ze}}if(n.mode===BAD)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=BAD;break}if(n.lenbits=9,de={bits:n.lenbits},ve=inftrees(LENS,n.lens,0,n.nlen,n.lencode,0,n.work,de),n.lenbits=de.bits,ve){e.msg="invalid literal/lengths set",n.mode=BAD;break}if(n.distbits=6,n.distcode=n.distdyn,de={bits:n.distbits},ve=inftrees(DISTS,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,de),n.distbits=de.bits,ve){e.msg="invalid distances set",n.mode=BAD;break}if(n.mode=LEN_,t===Z_TREES)break e;case LEN_:n.mode=LEN;case LEN:if(a>=6&&b>=258){e.next_out=g,e.avail_out=b,e.next_in=f,e.avail_in=a,n.hold=T,n.bits=C,inffast(e,N),g=e.next_out,u=e.output,b=e.avail_out,f=e.next_in,o=e.input,a=e.avail_in,T=n.hold,C=n.bits,n.mode===TYPE&&(n.back=-1);break}for(n.back=0;ce=n.lencode[T&(1<<n.lenbits)-1],X=ce>>>24,ye=ce>>>16&255,oe=ce&65535,!(X<=C);){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(ye&&(ye&240)===0){for(le=X,ue=ye,Re=oe;ce=n.lencode[Re+((T&(1<<le+ue)-1)>>le)],X=ce>>>24,ye=ce>>>16&255,oe=ce&65535,!(le+X<=C);){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}T>>>=le,C-=le,n.back+=le}if(T>>>=X,C-=X,n.back+=X,n.length=oe,ye===0){n.mode=LIT;break}if(ye&32){n.back=-1,n.mode=TYPE;break}if(ye&64){e.msg="invalid literal/length code",n.mode=BAD;break}n.extra=ye&15,n.mode=LENEXT;case LENEXT:if(n.extra){for(Te=n.extra;C<Te;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}n.length+=T&(1<<n.extra)-1,T>>>=n.extra,C-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=DIST;case DIST:for(;ce=n.distcode[T&(1<<n.distbits)-1],X=ce>>>24,ye=ce>>>16&255,oe=ce&65535,!(X<=C);){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if((ye&240)===0){for(le=X,ue=ye,Re=oe;ce=n.distcode[Re+((T&(1<<le+ue)-1)>>le)],X=ce>>>24,ye=ce>>>16&255,oe=ce&65535,!(le+X<=C);){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}T>>>=le,C-=le,n.back+=le}if(T>>>=X,C-=X,n.back+=X,ye&64){e.msg="invalid distance code",n.mode=BAD;break}n.offset=oe,n.extra=ye&15,n.mode=DISTEXT;case DISTEXT:if(n.extra){for(Te=n.extra;C<Te;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}n.offset+=T&(1<<n.extra)-1,T>>>=n.extra,C-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=BAD;break}n.mode=MATCH;case MATCH:if(b===0)break e;if(F=N-b,n.offset>F){if(F=n.offset-F,F>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=BAD;break}F>n.wnext?(F-=n.wnext,H=n.wsize-F):H=n.wnext-F,F>n.length&&(F=n.length),se=n.window}else se=u,H=g-n.offset,F=n.length;F>b&&(F=b),b-=F,n.length-=F;do u[g++]=se[H++];while(--F);n.length===0&&(n.mode=LEN);break;case LIT:if(b===0)break e;u[g++]=n.length,b--,n.mode=LEN;break;case CHECK:if(n.wrap){for(;C<32;){if(a===0)break e;a--,T|=o[f++]<<C,C+=8}if(N-=b,e.total_out+=N,n.total+=N,N&&(e.adler=n.check=n.flags?crc32_1(n.check,u,N,g-N):adler32_1(n.check,u,N,g-N)),N=b,(n.flags?T:zswap32(T))!==n.check){e.msg="incorrect data check",n.mode=BAD;break}T=0,C=0}n.mode=LENGTH;case LENGTH:if(n.wrap&&n.flags){for(;C<32;){if(a===0)break e;a--,T+=o[f++]<<C,C+=8}if(T!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=BAD;break}T=0,C=0}n.mode=DONE;case DONE:ve=Z_STREAM_END$1;break e;case BAD:ve=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=g,e.avail_out=b,e.next_in=f,e.avail_in=a,n.hold=T,n.bits=C,(n.wsize||N!==e.avail_out&&n.mode<BAD&&(n.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,N-e.avail_out),L-=e.avail_in,N-=e.avail_out,e.total_in+=L,e.total_out+=N,n.total+=N,n.wrap&&N&&(e.adler=n.check=n.flags?crc32_1(n.check,u,N,e.next_out-N):adler32_1(n.check,u,N,e.next_out-N)),e.data_type=n.bits+(n.last?64:0)+(n.mode===TYPE?128:0)+(n.mode===LEN_||n.mode===COPY_?256:0),(L===0&&N===0||t===Z_FINISH$1)&&ve===Z_OK$1&&(ve=Z_BUF_ERROR),ve},inflateEnd=e=>{if(!e||!e.state)return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,t)=>{if(!e||!e.state)return Z_STREAM_ERROR$1;const n=e.state;return(n.wrap&2)===0?Z_STREAM_ERROR$1:(n.head=t,t.done=!1,Z_OK$1)},inflateSetDictionary=(e,t)=>{const n=t.length;let o,u,f;return!e||!e.state||(o=e.state,o.wrap!==0&&o.mode!==DICT)?Z_STREAM_ERROR$1:o.mode===DICT&&(u=1,u=adler32_1(u,t,n,0),u!==o.check)?Z_DATA_ERROR$1:(f=updatewindow(e,t,n,n),f?(o.mode=MEM,Z_MEM_ERROR$1):(o.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$3=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2$1;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let n=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(n!==Z_OK)throw new Error(messages[n]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$3.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),n!==Z_OK)))throw new Error(messages[n])}Inflate$1.prototype.push=function(e,t){const n=this.strm,o=this.options.chunkSize,u=this.options.dictionary;let f,g,a;if(this.ended)return!1;for(t===~~t?g=t:g=t===!0?Z_FINISH:Z_NO_FLUSH,toString$3.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),f=inflate_1$2.inflate(n,g),f===Z_NEED_DICT&&u&&(f=inflate_1$2.inflateSetDictionary(n,u),f===Z_OK?f=inflate_1$2.inflate(n,g):f===Z_DATA_ERROR&&(f=Z_NEED_DICT));n.avail_in>0&&f===Z_STREAM_END&&n.state.wrap>0&&e[n.next_in]!==0;)inflate_1$2.inflateReset(n),f=inflate_1$2.inflate(n,g);switch(f){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(f),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||f===Z_STREAM_END))if(this.options.to==="string"){let b=strings.utf8border(n.output,n.next_out),T=n.next_out-b,C=strings.buf2string(n.output,b);n.next_out=T,n.avail_out=o-T,T&&n.output.set(n.output.subarray(b,b+T),0),this.onData(C)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(f===Z_OK&&a===0)){if(f===Z_STREAM_END)return f=inflate_1$2.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,t){const n=new Inflate$1(t);if(n.push(e),n.err)throw n.msg||messages[n.err];return n.result}function inflateRaw$1(e,t){return t=t||{},t.raw=!0,inflate$1(e,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants$a=constants$2$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants$a};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let e=0;e<256;e++){let t=e;for(let n=0;n<8;n++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable[e]=t}const initialCrc=4294967295;function updateCrc(e,t,n){let o=e;for(let u=0;u<n;u++)o=crcTable[(o^t[u])&255]^o>>>8;return o}function crc(e,t){return(updateCrc(initialCrc,e,t)^initialCrc)>>>0}var ColorType;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,n={}){super(t);const{checkCrc:o=!1}=n;this._checkCrc=o,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),n=this.readChars(4),o=this.offset;switch(n){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-o!==t)throw new Error(`Length mismatch while decoding chunk ${n}`);if(this._checkCrc){const u=this.readUint32(),f=t+4,g=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-f-4,f),f);if(g!==u)throw new Error(`CRC mismatch for chunk ${n}. Expected ${u}, found ${g}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const n=this.readUint8();this._colorType=n;let o;switch(n){case ColorType.GREYSCALE:o=1;break;case ColorType.TRUECOLOUR:o=3;break;case ColorType.INDEXED_COLOUR:o=1;break;case ColorType.GREYSCALE_ALPHA:o=2;break;case ColorType.TRUECOLOUR_ALPHA:o=4;break;default:throw new Error(`Unknown color type: ${n}`)}if(this._png.channels=o,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const n=t/3;this._hasPalette=!0;const o=[];this._palette=o;for(let u=0;u<n;u++)o.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(this._colorType===3){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let n=0;for(;n<t;n++){const o=this.readByte();this._palette[n].push(o)}for(;n<this._palette.length;n++)this._palette[n].push(255)}}decodeiCCP(t){let n="",o;for(;(o=this.readChar())!==NULL;)n+=o;const u=this.readUint8();if(u!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${u}`);const f=this.readBytes(t-n.length-2);this._png.iccEmbeddedProfile={name:n,profile:inflate_1(f)}}decodetEXt(t){let n="",o;for(;(o=this.readChar())!==NULL;)n+=o;this._png.text[n]=this.readChars(t-n.length-1)}decodepHYs(){const t=this.readUint32(),n=this.readUint32(),o=this.readByte();this._png.resolution={x:t,y:n,unit:o}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const n=this._png.height,o=this._png.channels*this._png.depth/8,u=this._png.width*o,f=new Uint8Array(this._png.height*u);let g=empty,a=0,b,T;for(let C=0;C<n;C++){switch(b=t.subarray(a+1,a+1+u),T=f.subarray(C*u,(C+1)*u),t[a]){case 0:unfilterNone(b,T,u);break;case 1:unfilterSub(b,T,u,o);break;case 2:unfilterUp(b,T,g,u);break;case 3:unfilterAverage(b,T,g,u,o);break;case 4:unfilterPaeth(b,T,g,u,o);break;default:throw new Error(`Unsupported filter: ${t[a]}`)}g=T,a+=u+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const C=new Uint16Array(f.buffer);if(osIsLittleEndian)for(let L=0;L<C.length;L++)C[L]=swap16(C[L]);this._png.data=C}else this._png.data=f}}function unfilterNone(e,t,n){for(let o=0;o<n;o++)t[o]=e[o]}function unfilterSub(e,t,n,o){let u=0;for(;u<o;u++)t[u]=e[u];for(;u<n;u++)t[u]=e[u]+t[u-o]&255}function unfilterUp(e,t,n,o){let u=0;if(n.length===0)for(;u<o;u++)t[u]=e[u];else for(;u<o;u++)t[u]=e[u]+n[u]&255}function unfilterAverage(e,t,n,o,u){let f=0;if(n.length===0){for(;f<u;f++)t[f]=e[f];for(;f<o;f++)t[f]=e[f]+(t[f-u]>>1)&255}else{for(;f<u;f++)t[f]=e[f]+(n[f]>>1)&255;for(;f<o;f++)t[f]=e[f]+(t[f-u]+n[f]>>1)&255}}function unfilterPaeth(e,t,n,o,u){let f=0;if(n.length===0){for(;f<u;f++)t[f]=e[f];for(;f<o;f++)t[f]=e[f]+t[f-u]&255}else{for(;f<u;f++)t[f]=e[f]+n[f]&255;for(;f<o;f++)t[f]=e[f]+paethPredictor(t[f-u],n[f],n[f-u])&255}}function paethPredictor(e,t,n){const o=e+t-n,u=Math.abs(o-e),f=Math.abs(o-t),g=Math.abs(o-n);return u<=f&&u<=g?e:f<=g?t:n}function swap16(e){return(e&255)<<8|e>>8&255}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,n={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,n.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:n,channels:o,depth:u,data:f}=this._png,g=o*t,a=new IOBuffer$4().setBigEndian();let b=0;for(let L=0;L<n;L++)if(a.writeByte(0),u===8)b=writeDataBytes(f,a,g,b);else if(u===16)b=writeDataUint16(f,a,g,b);else throw new Error("unreachable");const T=a.toArray(),C=deflate_1(T,this._zlibOptions);this.encodeIDAT(C)}_checkData(t){const{colorType:n,channels:o,depth:u}=getColorType(t),f={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:o,data:t.data,depth:u,text:{}};this._colorType=n;const g=f.width*f.height*o;if(f.data.length!==g)throw new RangeError(`wrong data size. Found ${f.data.length}, expected ${g}`);return f}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function getColorType(e){const{channels:t=4,depth:n=8}=e;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(n!==8&&n!==16)throw new RangeError(`unsupported bit depth: ${n}`);const o={channels:t,depth:n,colorType:ColorType.UNKNOWN};switch(t){case 4:o.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:o.colorType=ColorType.TRUECOLOUR;break;case 1:o.colorType=ColorType.GREYSCALE;break;case 2:o.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return o}function writeDataBytes(e,t,n,o){for(let u=0;u<n;u++)t.writeByte(e[o++]);return o}function writeDataUint16(e,t,n,o){for(let u=0;u<n;u++)t.writeUint16(e[o++]);return o}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,t){return new PngDecoder(e,t).decode()}function encodePng$1(e,t){return new PngEncoder(e,t).encode()}var encoder={exports:{}};(function(e){function t(o){var u=Math.floor,f=new Array(64),g=new Array(64),a=new Array(64),b=new Array(64),T,C,L,N,F=new Array(65535),H=new Array(65535),se=new Array(64),ce=new Array(64),X=[],ye=0,oe=7,le=new Array(64),ue=new Array(64),Re=new Array(64),ze=new Array(256),ve=new Array(2048),be,de=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Te=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Ge=[0,1,2,3,4,5,6,7,8,9,10,11],Ke=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],St=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],xt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Lr=[0,1,2,3,4,5,6,7,8,9,10,11],Nr=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Sr=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Gr(qt){for(var Er=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Gt=0;Gt<64;Gt++){var Jt=u((Er[Gt]*qt+50)/100);Jt<1?Jt=1:Jt>255&&(Jt=255),f[de[Gt]]=Jt}for(var st=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Pr=0;Pr<64;Pr++){var ht=u((st[Pr]*qt+50)/100);ht<1?ht=1:ht>255&&(ht=255),g[de[Pr]]=ht}for(var Nt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],xr=0,Qr=0;Qr<8;Qr++)for(var zr=0;zr<8;zr++)a[xr]=1/(f[de[xr]]*Nt[Qr]*Nt[zr]*8),b[xr]=1/(g[de[xr]]*Nt[Qr]*Nt[zr]*8),xr++}function _t(qt,Er){for(var Gt=0,Jt=0,st=new Array,Pr=1;Pr<=16;Pr++){for(var ht=1;ht<=qt[Pr];ht++)st[Er[Jt]]=[],st[Er[Jt]][0]=Gt,st[Er[Jt]][1]=Pr,Jt++,Gt++;Gt*=2}return st}function Kt(){T=_t(Te,Ge),C=_t(xt,Lr),L=_t(Ke,St),N=_t(Nr,Sr)}function mr(){for(var qt=1,Er=2,Gt=1;Gt<=15;Gt++){for(var Jt=qt;Jt<Er;Jt++)H[32767+Jt]=Gt,F[32767+Jt]=[],F[32767+Jt][1]=Gt,F[32767+Jt][0]=Jt;for(var st=-(Er-1);st<=-qt;st++)H[32767+st]=Gt,F[32767+st]=[],F[32767+st][1]=Gt,F[32767+st][0]=Er-1+st;qt<<=1,Er<<=1}}function Yt(){for(var qt=0;qt<256;qt++)ve[qt]=19595*qt,ve[qt+256>>0]=38470*qt,ve[qt+512>>0]=7471*qt+32768,ve[qt+768>>0]=-11059*qt,ve[qt+1024>>0]=-21709*qt,ve[qt+1280>>0]=32768*qt+8421375,ve[qt+1536>>0]=-27439*qt,ve[qt+1792>>0]=-5329*qt}function er(qt){for(var Er=qt[0],Gt=qt[1]-1;Gt>=0;)Er&1<<Gt&&(ye|=1<<oe),Gt--,oe--,oe<0&&(ye==255?(lr(255),lr(0)):lr(ye),oe=7,ye=0)}function lr(qt){X.push(qt)}function ar(qt){lr(qt>>8&255),lr(qt&255)}function dr(qt,Er){var Gt,Jt,st,Pr,ht,Nt,xr,Qr,zr=0,br,xi=8,ui=64;for(br=0;br<xi;++br){Gt=qt[zr],Jt=qt[zr+1],st=qt[zr+2],Pr=qt[zr+3],ht=qt[zr+4],Nt=qt[zr+5],xr=qt[zr+6],Qr=qt[zr+7];var di=Gt+Qr,Ti=Gt-Qr,Yi=Jt+xr,Zi=Jt-xr,oi=st+Nt,En=st-Nt,fo=Pr+ht,po=Pr-ht,bn=di+fo,oo=di-fo,Vi=Yi+oi,Xn=Yi-oi;qt[zr]=bn+Vi,qt[zr+4]=bn-Vi;var Pn=(Xn+oo)*.707106781;qt[zr+2]=oo+Pn,qt[zr+6]=oo-Pn,bn=po+En,Vi=En+Zi,Xn=Zi+Ti;var hn=(bn-Xn)*.382683433,Ie=.5411961*bn+hn,ut=1.306562965*Xn+hn,Bt=Vi*.707106781,_e=Ti+Bt,ae=Ti-Bt;qt[zr+5]=ae+Ie,qt[zr+3]=ae-Ie,qt[zr+1]=_e+ut,qt[zr+7]=_e-ut,zr+=8}for(zr=0,br=0;br<xi;++br){Gt=qt[zr],Jt=qt[zr+8],st=qt[zr+16],Pr=qt[zr+24],ht=qt[zr+32],Nt=qt[zr+40],xr=qt[zr+48],Qr=qt[zr+56];var fe=Gt+Qr,ke=Gt-Qr,Fe=Jt+xr,Ye=Jt-xr,mt=st+Nt,yt=st-Nt,Je=Pr+ht,vt=Pr-ht,$t=fe+Je,Ar=fe-Je,Qt=Fe+mt,Kr=Fe-mt;qt[zr]=$t+Qt,qt[zr+32]=$t-Qt;var ri=(Kr+Ar)*.707106781;qt[zr+16]=Ar+ri,qt[zr+48]=Ar-ri,$t=vt+yt,Qt=yt+Ye,Kr=Ye+ke;var Wr=($t-Kr)*.382683433,ni=.5411961*$t+Wr,Bi=1.306562965*Kr+Wr,et=Qt*.707106781,tr=ke+et,gr=ke-et;qt[zr+40]=gr+ni,qt[zr+24]=gr-ni,qt[zr+8]=tr+Bi,qt[zr+56]=tr-Bi,zr++}var Jr;for(br=0;br<ui;++br)Jr=qt[br]*Er[br],se[br]=Jr>0?Jr+.5|0:Jr-.5|0;return se}function ii(){ar(65504),ar(16),lr(74),lr(70),lr(73),lr(70),lr(0),lr(1),lr(1),lr(0),ar(1),ar(1),lr(0),lr(0)}function nr(qt){if(!!qt){ar(65505),qt[0]===69&&qt[1]===120&&qt[2]===105&&qt[3]===102?ar(qt.length+2):(ar(qt.length+5+2),lr(69),lr(120),lr(105),lr(102),lr(0));for(var Er=0;Er<qt.length;Er++)lr(qt[Er])}}function at(qt,Er){ar(65472),ar(17),lr(8),ar(Er),ar(qt),lr(3),lr(1),lr(17),lr(0),lr(2),lr(17),lr(1),lr(3),lr(17),lr(1)}function bi(){ar(65499),ar(132),lr(0);for(var qt=0;qt<64;qt++)lr(f[qt]);lr(1);for(var Er=0;Er<64;Er++)lr(g[Er])}function Br(){ar(65476),ar(418),lr(0);for(var qt=0;qt<16;qt++)lr(Te[qt+1]);for(var Er=0;Er<=11;Er++)lr(Ge[Er]);lr(16);for(var Gt=0;Gt<16;Gt++)lr(Ke[Gt+1]);for(var Jt=0;Jt<=161;Jt++)lr(St[Jt]);lr(1);for(var st=0;st<16;st++)lr(xt[st+1]);for(var Pr=0;Pr<=11;Pr++)lr(Lr[Pr]);lr(17);for(var ht=0;ht<16;ht++)lr(Nr[ht+1]);for(var Nt=0;Nt<=161;Nt++)lr(Sr[Nt])}function Xr(qt){typeof qt>"u"||qt.constructor!==Array||qt.forEach(Er=>{if(typeof Er=="string"){ar(65534);var Gt=Er.length;ar(Gt+2);var Jt;for(Jt=0;Jt<Gt;Jt++)lr(Er.charCodeAt(Jt))}})}function cr(){ar(65498),ar(12),lr(3),lr(1),lr(0),lr(2),lr(17),lr(3),lr(17),lr(0),lr(63),lr(0)}function ur(qt,Er,Gt,Jt,st){for(var Pr=st[0],ht=st[240],Nt,xr=16,Qr=63,zr=64,br=dr(qt,Er),xi=0;xi<zr;++xi)ce[de[xi]]=br[xi];var ui=ce[0]-Gt;Gt=ce[0],ui==0?er(Jt[0]):(Nt=32767+ui,er(Jt[H[Nt]]),er(F[Nt]));for(var di=63;di>0&&ce[di]==0;di--);if(di==0)return er(Pr),Gt;for(var Ti=1,Yi;Ti<=di;){for(var Zi=Ti;ce[Ti]==0&&Ti<=di;++Ti);var oi=Ti-Zi;if(oi>=xr){Yi=oi>>4;for(var En=1;En<=Yi;++En)er(ht);oi=oi&15}Nt=32767+ce[Ti],er(st[(oi<<4)+H[Nt]]),er(F[Nt]),Ti++}return di!=Qr&&er(Pr),Gt}function yi(){for(var qt=String.fromCharCode,Er=0;Er<256;Er++)ze[Er]=qt(Er)}this.encode=function(qt,Er){new Date().getTime(),Er&&Or(Er),X=new Array,ye=0,oe=7,ar(65496),ii(),Xr(qt.comments),nr(qt.exifBuffer),bi(),at(qt.width,qt.height),Br(),cr();var Gt=0,Jt=0,st=0;ye=0,oe=7,this.encode.displayName="_encode_";for(var Pr=qt.data,ht=qt.width,Nt=qt.height,xr=ht*4,Qr,zr=0,br,xi,ui,di,Ti,Yi,Zi,oi;zr<Nt;){for(Qr=0;Qr<xr;){for(di=xr*zr+Qr,Ti=di,Yi=-1,Zi=0,oi=0;oi<64;oi++)Zi=oi>>3,Yi=(oi&7)*4,Ti=di+Zi*xr+Yi,zr+Zi>=Nt&&(Ti-=xr*(zr+1+Zi-Nt)),Qr+Yi>=xr&&(Ti-=Qr+Yi-xr+4),br=Pr[Ti++],xi=Pr[Ti++],ui=Pr[Ti++],le[oi]=(ve[br]+ve[xi+256>>0]+ve[ui+512>>0]>>16)-128,ue[oi]=(ve[br+768>>0]+ve[xi+1024>>0]+ve[ui+1280>>0]>>16)-128,Re[oi]=(ve[br+1280>>0]+ve[xi+1536>>0]+ve[ui+1792>>0]>>16)-128;Gt=ur(le,a,Gt,T,L),Jt=ur(ue,b,Jt,C,N),st=ur(Re,b,st,C,N),Qr+=32}zr+=8}if(oe>=0){var En=[];En[1]=oe+1,En[0]=(1<<oe+1)-1,er(En)}return ar(65497),Buffer.from(X)};function Or(qt){if(qt<=0&&(qt=1),qt>100&&(qt=100),be!=qt){var Er=0;qt<50?Er=Math.floor(5e3/qt):Er=Math.floor(200-qt*2),Gr(Er),be=qt}}function mi(){var qt=new Date().getTime();o||(o=50),yi(),Kt(),mr(),Yt(),Or(o),new Date().getTime()-qt}mi()}e.exports=n;function n(o,u){typeof u>"u"&&(u=50);var f=new t(u),g=f.encode(o,u);return{data:g,width:o.width,height:o.height}}})(encoder);var decoder={exports:{}};(function(e){var t=function(){var u=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),f=4017,g=799,a=3406,b=2276,T=1567,C=3784,L=5793,N=2896;function F(){}function H(ue,Re){for(var ze=0,ve=[],be,de,Te=16;Te>0&&!ue[Te-1];)Te--;ve.push({children:[],index:0});var Ge=ve[0],Ke;for(be=0;be<Te;be++){for(de=0;de<ue[be];de++){for(Ge=ve.pop(),Ge.children[Ge.index]=Re[ze];Ge.index>0;){if(ve.length===0)throw new Error("Could not recreate Huffman Table");Ge=ve.pop()}for(Ge.index++,ve.push(Ge);ve.length<=be;)ve.push(Ke={children:[],index:0}),Ge.children[Ge.index]=Ke.children,Ge=Ke;ze++}be+1<Te&&(ve.push(Ke={children:[],index:0}),Ge.children[Ge.index]=Ke.children,Ge=Ke)}return ve[0].children}function se(ue,Re,ze,ve,be,de,Te,Ge,Ke,St){ze.precision,ze.samplesPerLine,ze.scanLines;var xt=ze.mcusPerLine,Lr=ze.progressive;ze.maxH,ze.maxV;var Nr=Re,Sr=0,Gr=0;function _t(){if(Gr>0)return Gr--,Sr>>Gr&1;if(Sr=ue[Re++],Sr==255){var Nt=ue[Re++];if(Nt)throw new Error("unexpected marker: "+(Sr<<8|Nt).toString(16))}return Gr=7,Sr>>>7}function Kt(Nt){for(var xr=Nt,Qr;(Qr=_t())!==null;){if(xr=xr[Qr],typeof xr=="number")return xr;if(typeof xr!="object")throw new Error("invalid huffman sequence")}return null}function mr(Nt){for(var xr=0;Nt>0;){var Qr=_t();if(Qr===null)return;xr=xr<<1|Qr,Nt--}return xr}function Yt(Nt){var xr=mr(Nt);return xr>=1<<Nt-1?xr:xr+(-1<<Nt)+1}function er(Nt,xr){var Qr=Kt(Nt.huffmanTableDC),zr=Qr===0?0:Yt(Qr);xr[0]=Nt.pred+=zr;for(var br=1;br<64;){var xi=Kt(Nt.huffmanTableAC),ui=xi&15,di=xi>>4;if(ui===0){if(di<15)break;br+=16;continue}br+=di;var Ti=u[br];xr[Ti]=Yt(ui),br++}}function lr(Nt,xr){var Qr=Kt(Nt.huffmanTableDC),zr=Qr===0?0:Yt(Qr)<<Ke;xr[0]=Nt.pred+=zr}function ar(Nt,xr){xr[0]|=_t()<<Ke}var dr=0;function ii(Nt,xr){if(dr>0){dr--;return}for(var Qr=de,zr=Te;Qr<=zr;){var br=Kt(Nt.huffmanTableAC),xi=br&15,ui=br>>4;if(xi===0){if(ui<15){dr=mr(ui)+(1<<ui)-1;break}Qr+=16;continue}Qr+=ui;var di=u[Qr];xr[di]=Yt(xi)*(1<<Ke),Qr++}}var nr=0,at;function bi(Nt,xr){for(var Qr=de,zr=Te,br=0;Qr<=zr;){var xi=u[Qr],ui=xr[xi]<0?-1:1;switch(nr){case 0:var di=Kt(Nt.huffmanTableAC),Ti=di&15,br=di>>4;if(Ti===0)br<15?(dr=mr(br)+(1<<br),nr=4):(br=16,nr=1);else{if(Ti!==1)throw new Error("invalid ACn encoding");at=Yt(Ti),nr=br?2:3}continue;case 1:case 2:xr[xi]?xr[xi]+=(_t()<<Ke)*ui:(br--,br===0&&(nr=nr==2?3:0));break;case 3:xr[xi]?xr[xi]+=(_t()<<Ke)*ui:(xr[xi]=at<<Ke,nr=0);break;case 4:xr[xi]&&(xr[xi]+=(_t()<<Ke)*ui);break}Qr++}nr===4&&(dr--,dr===0&&(nr=0))}function Br(Nt,xr,Qr,zr,br){var xi=Qr/xt|0,ui=Qr%xt,di=xi*Nt.v+zr,Ti=ui*Nt.h+br;Nt.blocks[di]===void 0&&St.tolerantDecoding||xr(Nt,Nt.blocks[di][Ti])}function Xr(Nt,xr,Qr){var zr=Qr/Nt.blocksPerLine|0,br=Qr%Nt.blocksPerLine;Nt.blocks[zr]===void 0&&St.tolerantDecoding||xr(Nt,Nt.blocks[zr][br])}var cr=ve.length,ur,yi,Or,mi,qt,Er;Lr?de===0?Er=Ge===0?lr:ar:Er=Ge===0?ii:bi:Er=er;var Gt=0,Jt,st;cr==1?st=ve[0].blocksPerLine*ve[0].blocksPerColumn:st=xt*ze.mcusPerColumn,be||(be=st);for(var Pr,ht;Gt<st;){for(yi=0;yi<cr;yi++)ve[yi].pred=0;if(dr=0,cr==1)for(ur=ve[0],qt=0;qt<be;qt++)Xr(ur,Er,Gt),Gt++;else for(qt=0;qt<be;qt++){for(yi=0;yi<cr;yi++)for(ur=ve[yi],Pr=ur.h,ht=ur.v,Or=0;Or<ht;Or++)for(mi=0;mi<Pr;mi++)Br(ur,Er,Gt,Or,mi);if(Gt++,Gt===st)break}if(Gt===st)do{if(ue[Re]===255&&ue[Re+1]!==0)break;Re+=1}while(Re<ue.length-2);if(Gr=0,Jt=ue[Re]<<8|ue[Re+1],Jt<65280)throw new Error("marker was not found");if(Jt>=65488&&Jt<=65495)Re+=2;else break}return Re-Nr}function ce(ue,Re){var ze=[],ve=Re.blocksPerLine,be=Re.blocksPerColumn,de=ve<<3,Te=new Int32Array(64),Ge=new Uint8Array(64);function Ke(mr,Yt,er){var lr=Re.quantizationTable,ar,dr,ii,nr,at,bi,Br,Xr,cr,ur=er,yi;for(yi=0;yi<64;yi++)ur[yi]=mr[yi]*lr[yi];for(yi=0;yi<8;++yi){var Or=8*yi;if(ur[1+Or]==0&&ur[2+Or]==0&&ur[3+Or]==0&&ur[4+Or]==0&&ur[5+Or]==0&&ur[6+Or]==0&&ur[7+Or]==0){cr=L*ur[0+Or]+512>>10,ur[0+Or]=cr,ur[1+Or]=cr,ur[2+Or]=cr,ur[3+Or]=cr,ur[4+Or]=cr,ur[5+Or]=cr,ur[6+Or]=cr,ur[7+Or]=cr;continue}ar=L*ur[0+Or]+128>>8,dr=L*ur[4+Or]+128>>8,ii=ur[2+Or],nr=ur[6+Or],at=N*(ur[1+Or]-ur[7+Or])+128>>8,Xr=N*(ur[1+Or]+ur[7+Or])+128>>8,bi=ur[3+Or]<<4,Br=ur[5+Or]<<4,cr=ar-dr+1>>1,ar=ar+dr+1>>1,dr=cr,cr=ii*C+nr*T+128>>8,ii=ii*T-nr*C+128>>8,nr=cr,cr=at-Br+1>>1,at=at+Br+1>>1,Br=cr,cr=Xr+bi+1>>1,bi=Xr-bi+1>>1,Xr=cr,cr=ar-nr+1>>1,ar=ar+nr+1>>1,nr=cr,cr=dr-ii+1>>1,dr=dr+ii+1>>1,ii=cr,cr=at*b+Xr*a+2048>>12,at=at*a-Xr*b+2048>>12,Xr=cr,cr=bi*g+Br*f+2048>>12,bi=bi*f-Br*g+2048>>12,Br=cr,ur[0+Or]=ar+Xr,ur[7+Or]=ar-Xr,ur[1+Or]=dr+Br,ur[6+Or]=dr-Br,ur[2+Or]=ii+bi,ur[5+Or]=ii-bi,ur[3+Or]=nr+at,ur[4+Or]=nr-at}for(yi=0;yi<8;++yi){var mi=yi;if(ur[8+mi]==0&&ur[16+mi]==0&&ur[24+mi]==0&&ur[32+mi]==0&&ur[40+mi]==0&&ur[48+mi]==0&&ur[56+mi]==0){cr=L*er[yi+0]+8192>>14,ur[0+mi]=cr,ur[8+mi]=cr,ur[16+mi]=cr,ur[24+mi]=cr,ur[32+mi]=cr,ur[40+mi]=cr,ur[48+mi]=cr,ur[56+mi]=cr;continue}ar=L*ur[0+mi]+2048>>12,dr=L*ur[32+mi]+2048>>12,ii=ur[16+mi],nr=ur[48+mi],at=N*(ur[8+mi]-ur[56+mi])+2048>>12,Xr=N*(ur[8+mi]+ur[56+mi])+2048>>12,bi=ur[24+mi],Br=ur[40+mi],cr=ar-dr+1>>1,ar=ar+dr+1>>1,dr=cr,cr=ii*C+nr*T+2048>>12,ii=ii*T-nr*C+2048>>12,nr=cr,cr=at-Br+1>>1,at=at+Br+1>>1,Br=cr,cr=Xr+bi+1>>1,bi=Xr-bi+1>>1,Xr=cr,cr=ar-nr+1>>1,ar=ar+nr+1>>1,nr=cr,cr=dr-ii+1>>1,dr=dr+ii+1>>1,ii=cr,cr=at*b+Xr*a+2048>>12,at=at*a-Xr*b+2048>>12,Xr=cr,cr=bi*g+Br*f+2048>>12,bi=bi*f-Br*g+2048>>12,Br=cr,ur[0+mi]=ar+Xr,ur[56+mi]=ar-Xr,ur[8+mi]=dr+Br,ur[48+mi]=dr-Br,ur[16+mi]=ii+bi,ur[40+mi]=ii-bi,ur[24+mi]=nr+at,ur[32+mi]=nr-at}for(yi=0;yi<64;++yi){var qt=128+(ur[yi]+8>>4);Yt[yi]=qt<0?0:qt>255?255:qt}}le(de*be*8);for(var St,xt,Lr=0;Lr<be;Lr++){var Nr=Lr<<3;for(St=0;St<8;St++)ze.push(new Uint8Array(de));for(var Sr=0;Sr<ve;Sr++){Ke(Re.blocks[Lr][Sr],Ge,Te);var Gr=0,_t=Sr<<3;for(xt=0;xt<8;xt++){var Kt=ze[Nr+xt];for(St=0;St<8;St++)Kt[_t+St]=Ge[Gr++]}}}return ze}function X(ue){return ue<0?0:ue>255?255:ue}F.prototype={load:function(Re){var ze=new XMLHttpRequest;ze.open("GET",Re,!0),ze.responseType="arraybuffer",ze.onload=function(){var ve=new Uint8Array(ze.response||ze.mozResponseArrayBuffer);this.parse(ve),this.onload&&this.onload()}.bind(this),ze.send(null)},parse:function(Re){var ze=this.opts.maxResolutionInMP*1e3*1e3,ve=0;Re.length;function be(){var ui=Re[ve]<<8|Re[ve+1];return ve+=2,ui}function de(){var ui=be(),di=Re.subarray(ve,ve+ui-2);return ve+=di.length,di}function Te(ui){var di=1,Ti=1,Yi,Zi;for(Zi in ui.components)ui.components.hasOwnProperty(Zi)&&(Yi=ui.components[Zi],di<Yi.h&&(di=Yi.h),Ti<Yi.v&&(Ti=Yi.v));var oi=Math.ceil(ui.samplesPerLine/8/di),En=Math.ceil(ui.scanLines/8/Ti);for(Zi in ui.components)if(ui.components.hasOwnProperty(Zi)){Yi=ui.components[Zi];var fo=Math.ceil(Math.ceil(ui.samplesPerLine/8)*Yi.h/di),po=Math.ceil(Math.ceil(ui.scanLines/8)*Yi.v/Ti),bn=oi*Yi.h,oo=En*Yi.v,Vi=oo*bn,Xn=[];le(Vi*256);for(var Pn=0;Pn<oo;Pn++){for(var hn=[],Ie=0;Ie<bn;Ie++)hn.push(new Int32Array(64));Xn.push(hn)}Yi.blocksPerLine=fo,Yi.blocksPerColumn=po,Yi.blocks=Xn}ui.maxH=di,ui.maxV=Ti,ui.mcusPerLine=oi,ui.mcusPerColumn=En}var Ge=null,Ke=null,St,xt,Lr=[],Nr=[],Sr=[],Gr=[],_t=be(),Kt=-1;if(this.comments=[],_t!=65496)throw new Error("SOI not found");for(_t=be();_t!=65497;){var mr,Yt;switch(_t){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var er=de();if(_t===65534){var lr=String.fromCharCode.apply(null,er);this.comments.push(lr)}_t===65504&&er[0]===74&&er[1]===70&&er[2]===73&&er[3]===70&&er[4]===0&&(Ge={version:{major:er[5],minor:er[6]},densityUnits:er[7],xDensity:er[8]<<8|er[9],yDensity:er[10]<<8|er[11],thumbWidth:er[12],thumbHeight:er[13],thumbData:er.subarray(14,14+3*er[12]*er[13])}),_t===65505&&er[0]===69&&er[1]===120&&er[2]===105&&er[3]===102&&er[4]===0&&(this.exifBuffer=er.subarray(5,er.length)),_t===65518&&er[0]===65&&er[1]===100&&er[2]===111&&er[3]===98&&er[4]===101&&er[5]===0&&(Ke={version:er[6],flags0:er[7]<<8|er[8],flags1:er[9]<<8|er[10],transformCode:er[11]});break;case 65499:for(var ar=be(),dr=ar+ve-2;ve<dr;){var ii=Re[ve++];le(256);var nr=new Int32Array(64);if(ii>>4===0)for(Yt=0;Yt<64;Yt++){var at=u[Yt];nr[at]=Re[ve++]}else if(ii>>4===1)for(Yt=0;Yt<64;Yt++){var at=u[Yt];nr[at]=be()}else throw new Error("DQT: invalid table spec");Lr[ii&15]=nr}break;case 65472:case 65473:case 65474:be(),St={},St.extended=_t===65473,St.progressive=_t===65474,St.precision=Re[ve++],St.scanLines=be(),St.samplesPerLine=be(),St.components={},St.componentsOrder=[];var bi=St.scanLines*St.samplesPerLine;if(bi>ze){var Br=Math.ceil((bi-ze)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Br}MP`)}var Xr=Re[ve++],cr;for(mr=0;mr<Xr;mr++){cr=Re[ve];var ur=Re[ve+1]>>4,yi=Re[ve+1]&15,Or=Re[ve+2];if(ur<=0||yi<=0)throw new Error("Invalid sampling factor, expected values above 0");St.componentsOrder.push(cr),St.components[cr]={h:ur,v:yi,quantizationIdx:Or},ve+=3}Te(St),Nr.push(St);break;case 65476:var mi=be();for(mr=2;mr<mi;){var qt=Re[ve++],Er=new Uint8Array(16),Gt=0;for(Yt=0;Yt<16;Yt++,ve++)Gt+=Er[Yt]=Re[ve];le(16+Gt);var Jt=new Uint8Array(Gt);for(Yt=0;Yt<Gt;Yt++,ve++)Jt[Yt]=Re[ve];mr+=17+Gt,(qt>>4===0?Gr:Sr)[qt&15]=H(Er,Jt)}break;case 65501:be(),xt=be();break;case 65500:be(),be();break;case 65498:be();var st=Re[ve++],Pr=[],ht;for(mr=0;mr<st;mr++){ht=St.components[Re[ve++]];var Nt=Re[ve++];ht.huffmanTableDC=Gr[Nt>>4],ht.huffmanTableAC=Sr[Nt&15],Pr.push(ht)}var xr=Re[ve++],Qr=Re[ve++],zr=Re[ve++],br=se(Re,ve,St,Pr,xt,xr,Qr,zr>>4,zr&15,this.opts);ve+=br;break;case 65535:Re[ve]!==255&&ve--;break;default:if(Re[ve-3]==255&&Re[ve-2]>=192&&Re[ve-2]<=254){ve-=3;break}else if(_t===224||_t==225){if(Kt!==-1)throw new Error(`first unknown JPEG marker at offset ${Kt.toString(16)}, second unknown JPEG marker ${_t.toString(16)} at offset ${(ve-1).toString(16)}`);Kt=ve-1;const ui=be();if(Re[ve+ui-2]===255){ve+=ui-2;break}}throw new Error("unknown JPEG marker "+_t.toString(16))}_t=be()}if(Nr.length!=1)throw new Error("only single frame JPEGs supported");for(var mr=0;mr<Nr.length;mr++){var xi=Nr[mr].components;for(var Yt in xi)xi[Yt].quantizationTable=Lr[xi[Yt].quantizationIdx],delete xi[Yt].quantizationIdx}this.width=St.samplesPerLine,this.height=St.scanLines,this.jfif=Ge,this.adobe=Ke,this.components=[];for(var mr=0;mr<St.componentsOrder.length;mr++){var ht=St.components[St.componentsOrder[mr]];this.components.push({lines:ce(St,ht),scaleX:ht.h/St.maxH,scaleY:ht.v/St.maxV})}},getData:function(Re,ze){var ve=this.width/Re,be=this.height/ze,de,Te,Ge,Ke,St,xt,Lr,Nr,Sr,Gr,_t=0,Kt,mr,Yt,er,lr,ar,dr,ii,nr,at,bi,Br=Re*ze*this.components.length;le(Br);var Xr=new Uint8Array(Br);switch(this.components.length){case 1:for(de=this.components[0],Gr=0;Gr<ze;Gr++)for(St=de.lines[0|Gr*de.scaleY*be],Sr=0;Sr<Re;Sr++)Kt=St[0|Sr*de.scaleX*ve],Xr[_t++]=Kt;break;case 2:for(de=this.components[0],Te=this.components[1],Gr=0;Gr<ze;Gr++)for(St=de.lines[0|Gr*de.scaleY*be],xt=Te.lines[0|Gr*Te.scaleY*be],Sr=0;Sr<Re;Sr++)Kt=St[0|Sr*de.scaleX*ve],Xr[_t++]=Kt,Kt=xt[0|Sr*Te.scaleX*ve],Xr[_t++]=Kt;break;case 3:for(bi=!0,this.adobe&&this.adobe.transformCode?bi=!0:typeof this.opts.colorTransform<"u"&&(bi=!!this.opts.colorTransform),de=this.components[0],Te=this.components[1],Ge=this.components[2],Gr=0;Gr<ze;Gr++)for(St=de.lines[0|Gr*de.scaleY*be],xt=Te.lines[0|Gr*Te.scaleY*be],Lr=Ge.lines[0|Gr*Ge.scaleY*be],Sr=0;Sr<Re;Sr++)bi?(Kt=St[0|Sr*de.scaleX*ve],mr=xt[0|Sr*Te.scaleX*ve],Yt=Lr[0|Sr*Ge.scaleX*ve],ii=X(Kt+1.402*(Yt-128)),nr=X(Kt-.3441363*(mr-128)-.71413636*(Yt-128)),at=X(Kt+1.772*(mr-128))):(ii=St[0|Sr*de.scaleX*ve],nr=xt[0|Sr*Te.scaleX*ve],at=Lr[0|Sr*Ge.scaleX*ve]),Xr[_t++]=ii,Xr[_t++]=nr,Xr[_t++]=at;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(bi=!1,this.adobe&&this.adobe.transformCode?bi=!0:typeof this.opts.colorTransform<"u"&&(bi=!!this.opts.colorTransform),de=this.components[0],Te=this.components[1],Ge=this.components[2],Ke=this.components[3],Gr=0;Gr<ze;Gr++)for(St=de.lines[0|Gr*de.scaleY*be],xt=Te.lines[0|Gr*Te.scaleY*be],Lr=Ge.lines[0|Gr*Ge.scaleY*be],Nr=Ke.lines[0|Gr*Ke.scaleY*be],Sr=0;Sr<Re;Sr++)bi?(Kt=St[0|Sr*de.scaleX*ve],mr=xt[0|Sr*Te.scaleX*ve],Yt=Lr[0|Sr*Ge.scaleX*ve],er=Nr[0|Sr*Ke.scaleX*ve],lr=255-X(Kt+1.402*(Yt-128)),ar=255-X(Kt-.3441363*(mr-128)-.71413636*(Yt-128)),dr=255-X(Kt+1.772*(mr-128))):(lr=St[0|Sr*de.scaleX*ve],ar=xt[0|Sr*Te.scaleX*ve],dr=Lr[0|Sr*Ge.scaleX*ve],er=Nr[0|Sr*Ke.scaleX*ve]),Xr[_t++]=255-lr,Xr[_t++]=255-ar,Xr[_t++]=255-dr,Xr[_t++]=255-er;break;default:throw new Error("Unsupported color mode")}return Xr},copyToImageData:function(Re,ze){var ve=Re.width,be=Re.height,de=Re.data,Te=this.getData(ve,be),Ge=0,Ke=0,St,xt,Lr,Nr,Sr,Gr,_t,Kt,mr;switch(this.components.length){case 1:for(xt=0;xt<be;xt++)for(St=0;St<ve;St++)Lr=Te[Ge++],de[Ke++]=Lr,de[Ke++]=Lr,de[Ke++]=Lr,ze&&(de[Ke++]=255);break;case 3:for(xt=0;xt<be;xt++)for(St=0;St<ve;St++)_t=Te[Ge++],Kt=Te[Ge++],mr=Te[Ge++],de[Ke++]=_t,de[Ke++]=Kt,de[Ke++]=mr,ze&&(de[Ke++]=255);break;case 4:for(xt=0;xt<be;xt++)for(St=0;St<ve;St++)Sr=Te[Ge++],Gr=Te[Ge++],Lr=Te[Ge++],Nr=Te[Ge++],_t=255-X(Sr*(1-Nr/255)+Nr),Kt=255-X(Gr*(1-Nr/255)+Nr),mr=255-X(Lr*(1-Nr/255)+Nr),de[Ke++]=_t,de[Ke++]=Kt,de[Ke++]=mr,ze&&(de[Ke++]=255);break;default:throw new Error("Unsupported color mode")}}};var ye=0,oe=0;function le(ue=0){var Re=ye+ue;if(Re>oe){var ze=Math.ceil((Re-oe)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ze}MB`)}ye=Re}return F.resetMaxMemoryUsage=function(ue){ye=0,oe=ue},F.getBytesAllocated=function(){return ye},F.requestMemoryAllocation=le,F}();e.exports=n;function n(o,u={}){var f={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},g={...f,...u},a=new Uint8Array(o),b=new t;b.opts=g,t.resetMaxMemoryUsage(g.maxMemoryUsageInMB*1024*1024),b.parse(a);var T=g.formatAsRGBA?4:3,C=b.width*b.height*T;try{t.requestMemoryAllocation(C);var L={width:b.width,height:b.height,exifBuffer:b.exifBuffer,data:g.useTArray?new Uint8Array(C):Buffer.alloc(C)};b.comments.length>0&&(L.comments=b.comments)}catch(N){throw N instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+C):N instanceof ReferenceError&&N.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):N}return b.copyToImageData(L,g.formatAsRGBA),L}})(decoder);var encode$1=encoder.exports,decode$4=decoder.exports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode(e){let t,n=e.length,o="";for(t=0;t<n;t+=3)o+=chars[e[t]>>2],o+=chars[(e[t]&3)<<4|e[t+1]>>4],o+=chars[(e[t+1]&15)<<2|e[t+2]>>6],o+=chars[e[t+2]&63];return n%3===2?o=`${o.substring(0,o.length-1)}=`:n%3===1&&(o=`${o.substring(0,o.length-2)}==`),o}function decode$3(e){let t=e.length*.75,n=e.length,o=0,u,f,g,a;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const b=new Uint8Array(t);for(let T=0;T<n;T+=4)u=lookup[e.charCodeAt(T)],f=lookup[e.charCodeAt(T+1)],g=lookup[e.charCodeAt(T+2)],a=lookup[e.charCodeAt(T+3)],b[o++]=u<<2|f>>4,b[o++]=(f&15)<<4|g>>2,b[o++]=(g&3)<<6|a&63;return b}function toBase64URL(e,t){const n=encode(e);return`data:${t};base64,${n}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(e,t){let n=self.document.createElement("canvas");return n.width=e,n.height=t,n}function fetchBinary(e,{withCredentials:t=!1}={}){return new Promise(function(n,o){let u=new self.XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.withCredentials=t,u.onload=function(f){this.status!==200?o(f):n(this.response)},u.onerror=o,u.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,t={}){const n={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJs.encode(n,t.quality).data}function encodePng(e,t){const n={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(n.depth===1||n.depth===32)&&(n.depth=8,n.channels=4,n.data=e.getRGBAData()),encodePng$1(n,t)}const exportMethods={save(e,t={}){const{useCanvas:n=!1,encoder:o=void 0}=t;let{format:u}=t;if(!u){const f=/\.(?<format>[a-zA-Z]+)$/.exec(e);f&&(u=f.groups.format.toLowerCase())}if(!u)throw new Error("file format not provided");return new Promise((f,g)=>{let a,b;switch(u.toLowerCase()){case"png":{n?a=this.getCanvas().pngStream():b=encodePng(this,o);break}case"jpg":case"jpeg":n?a=this.getCanvas().jpegStream():b=encodeJpeg(this,o);break;case"bmp":b=encode$2(this,o);break;default:throw new RangeError(`invalid output format: ${u}`)}if(a){let T=createWriteStream();T.on("finish",f),T.on("error",g),a.pipe(T)}else b&&writeFile()})},toDataURL(e="image/png",t={}){typeof e=="object"&&(t=e,e="image/png");const{useCanvas:n=!1,encoder:o=void 0}=t;e=getType(e);function u(f,g){const a=f(g,o);return toBase64URL(a,e)}return e==="image/bmp"?u(encode$2,this):e==="image/png"&&!n?u(encodePng,this):e==="image/jpeg"&&!n?u(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:t="png",encoder:n=void 0}=e;switch(t.toLowerCase()){case"png":return encodePng(this,n);case"jpeg":case"jpg":return encodeJpeg(this,n);case"bmp":return encode$2(this,n);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(e="image/png",t={}){if(t.async)return this.toDataURL(e,t).then(function(n){return n.substring(n.indexOf(",")+1)});{const n=this.toDataURL(e,t);return n.substring(n.indexOf(",")+1)}},toBlob(e="image/png",t=.8){return canvasToBlob(this.getCanvas(),e,t)},getCanvas(){const e=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(e,0,0),t}};function setExportMethods(e){for(const t in exportMethods)e.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"};var require$$0$3={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=t=function(u,f){return n.call(f,u)},t.version=require$$0$3.version})(hasOwn$1,hasOwn$1.exports);var hasOwn=hasOwn$1.exports;let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,t,n={}){let{inPlace:o=!1,returnThis:u=!0,partialArgs:f=[]}=n;return o?Image.prototype[e]=function(...g){this.computed=null;let a=t.apply(this,[...f,...g]);return u?this:a}:Image.prototype[e]=function(...g){return t.apply(this,[...f,...g])},Image}function extendProperty(e,t,n={}){let{partialArgs:o=[]}=n;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let u=t.apply(this,o);return this.computed[e]=u,u},Object.defineProperty(Image.prototype,e,computedPropertyDescriptor$1),Image}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK";var ColorModel=Object.freeze(Object.defineProperty({__proto__:null,GREY:GREY$1,RGB:RGB$1,HSL,HSV,CMYK:CMYK$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(e={}){const{clamped:t}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const n=this.width*this.height*4;let o=t?new Uint8ClampedArray(n):new Uint8Array(n);return this.bitDepth===1?fillDataFromBinary(this,o):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,o):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,o))):this.components===1?fillDataFromGrey(this,o):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,o)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,o)):fillAlpha(this,o),o}function fillDataFromBinary(e,t){for(let n=0;n<e.size;n++){const o=e.getBit(n);t[n*4]=o*255,t[n*4+1]=o*255,t[n*4+2]=o*255}}function fillDataFromGrey32(e,t){const n=e.min[0],u=e.max[0]-n;for(let f=0;f<e.size;f++){const g=Math.floor(255*(e.data[f]-n)/u);t[f*4]=g,t[f*4+1]=g,t[f*4+2]=g}}function fillDataFromRGB32(e,t){const n=Math.min(...e.min),u=Math.max(...e.max)-n;for(let f=0;f<e.size;f++){const g=Math.floor(255*(e.data[f*3]-n)/u),a=Math.floor(255*(e.data[f*3+1]-n)/u),b=Math.floor(255*(e.data[f*3+2]-n)/u);t[f*4]=g,t[f*4+1]=a,t[f*4+2]=b}}function fillDataFromGrey(e,t){for(let n=0;n<e.size;n++)t[n*4]=e.data[n*e.channels]>>>e.bitDepth-8,t[n*4+1]=e.data[n*e.channels]>>>e.bitDepth-8,t[n*4+2]=e.data[n*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,t){for(let n=0;n<e.size;n++)t[n*4]=e.data[n*e.channels]>>>e.bitDepth-8,t[n*4+1]=e.data[n*e.channels+1]>>>e.bitDepth-8,t[n*4+2]=e.data[n*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,t){for(let n=0;n<e.size;n++)t[n*4+3]=e.data[n*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,t){for(let n=0;n<e.size;n++)t[n*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const t=kinds[e];if(!t)throw new RangeError(`invalid image kind: ${e}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:t,alpha:n,bitDepth:o,colorModel:u}=e;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(n!==0&&n!==1&&typeof n!="boolean")throw new TypeError(`invalid alpha: ${n}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(o))throw new RangeError(`invalid bitDepth: ${o}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[u])throw new RangeError(`invalid colorModel: ${u}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,t,n){let o=t*e;return n===1&&(o=Math.ceil(o/8)),o}function createPixelArray(e,t,n,o,u,f){const g=o*e;let a;switch(u){case 1:a=new Uint8Array(Math.ceil(g/8));break;case 8:a=new Uint8Array(g);break;case 16:a=new Uint16Array(g);break;case 32:a=new Float32Array(g);break;default:throw new Error(`Cannot create pixel array for bit depth ${u}`)}if(n)for(let b=t;b<a.length;b+=o)a[b]=f;return a}const defaultByteLength=1024*8,charArray=[];class IOBuffer$2{constructor(t,n){n=n||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let o=t.byteLength;const u=n.offset?n.offset>>>0:0;t.buffer&&(o=t.byteLength-u,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+u,t.byteOffset+t.byteLength):u?t=t.buffer.slice(u):t=t.buffer),this.buffer=t,this.length=o,this.byteLength=o,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=o||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const n=this._increment+this._increment;this._increment=n;const o=this.length+n,u=new Uint8Array(o);u.set(new Uint8Array(this.buffer)),this.buffer=u.buffer,this.length=o,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var n=new Uint8Array(t),o=0;o<t;o++)n[o]=this.readByte();return n}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var n=0;n<t;n++)charArray[n]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var n=0;n<t.length;n++)this._data.setUint8(this.offset++,t[n])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$2{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const n=tags$1[this.kind].tagsById;for(var t of this.fields.keys())n[t]&&(this._map[n[t]]=this.fields.get(t))}return this._map}}var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,n=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(n[1],n[2]-1,n[3]),t.setHours(n[4],n[5],n[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray$1(e){return typeof e=="number"?[e]:e}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(e,t){return types$1.get(e)[0]*t};ifdValue.readData=function(e,t,n){return types$1.get(t)[1](e,n)};function readByte$1(e,t){if(t===1)return e.readUint8();for(var n=new Uint8Array(t),o=0;o<t;o++)n[o]=e.readUint8();return n}function readASCII$1(e,t){for(var n=[],o="",u=0;u<t;u++){var f=String.fromCharCode(e.readUint8());f==="\0"?(n.push(o),o=""):o+=f}return n.length===1?n[0]:n}function readShort$1(e,t){if(t===1)return e.readUint16();for(var n=new Uint16Array(t),o=0;o<t;o++)n[o]=e.readUint16();return n}function readLong$1(e,t){if(t===1)return e.readUint32();for(var n=new Uint32Array(t),o=0;o<t;o++)n[o]=e.readUint32();return n}function readRational$1(e,t){if(t===1)return e.readUint32()/e.readUint32();for(var n=new Array(t),o=0;o<t;o++)n[o]=e.readUint32()/e.readUint32();return n}function readSByte$1(e,t){if(t===1)return e.readInt8();for(var n=new Int8Array(t),o=0;o<t;o++)n[o]=e.readInt8();return n}function readSShort$1(e,t){if(t===1)return e.readInt16();for(var n=new Int16Array(t),o=0;o<t;o++)n[o]=e.readInt16();return n}function readSLong$1(e,t){if(t===1)return e.readInt32();for(var n=new Int32Array(t),o=0;o<t;o++)n[o]=e.readInt32();return n}function readSRational$1(e,t){if(t===1)return e.readInt32()/e.readInt32();for(var n=new Array(t),o=0;o<t;o++)n[o]=e.readInt32()/e.readInt32();return n}function readFloat$1(e,t){if(t===1)return e.readFloat32();for(var n=new Float32Array(t),o=0;o<t;o++)n[o]=e.readFloat32();return n}function readDouble$1(e,t){if(t===1)return e.readFloat64();for(var n=new Float64Array(t),o=0;o<t;o++)n[o]=e.readFloat64();return n}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$2 extends IOBuffer$1{constructor(t,n){super(t,n),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$d,t);const n=[];for(this.decodeHeader();this._nextIFD;)if(n.push(this.decodeIFD(t)),t.onlyFirst)return n[0];return n}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var n;t.kind?n=new IFD$1(t.kind):n=new TiffIFD;const o=this.readUint16();for(var u=0;u<o;u++)this.decodeIFDEntry(n);return t.ignoreImageData||this.decodeImageData(n),this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const n=this.offset,o=this.readUint16(),u=this.readUint16(),f=this.readUint32();if(u<1||u>12){this.skip(4);return}IFDValue.getByteLength(u,f)>4&&this.seek(this.readUint32());const a=IFDValue.readData(this,u,f);if(t.fields.set(o,a),o===34665||o===34853){let b=this.offset,T;o===34665?T="exif":o===34853&&(T="gps"),this._nextIFD=a,t[T]=this.decodeIFD({kind:T,ignoreImageData:!0}),this.offset=b}this.seek(n),this.skip(12)}decodeImageData(t){const n=t.orientation;switch(n&&n!==1&&unsupported$1("orientation",n),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const n=t.width,o=t.height,u=validateBitDepth(t.bitsPerSample),f=t.sampleFormat;let g=n*o;const a=getDataArray$1(g,1,u,f),b=t.compression,C=t.rowsPerStrip*n,L=t.stripOffsets,N=t.stripByteCounts;for(var F=0,H=0;H<L.length;H++){var se=this.getStripData(b,L[H],N[H]),ce=g>C?C:g;g-=ce,u===8?F=fill8bit$1(a,se,F,ce):u===16?F=fill16bit$1(a,se,F,ce,this.isLittleEndian()):u===32&&f===3?F=fillFloat32$1(a,se,F,ce,this.isLittleEndian()):unsupported$1("bitDepth",u)}t.data=a}getStripData(t,n,o){switch(t){case 1:return new DataView(this.buffer,n,o);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}}var tiffDecoder=TIFFDecoder$2;function getDataArray$1(e,t,n,o){return n===8?new Uint8Array(e*t):n===16?new Uint16Array(e*t):n===32&&o===3?new Float32Array(e*t):unsupported$1("bit depth / sample format",n+" / "+o)}function fill8bit$1(e,t,n,o){for(var u=0;u<o;u++)e[n++]=t.getUint8(u);return n}function fill16bit$1(e,t,n,o,u){for(var f=0;f<o*2;f+=2)e[n++]=t.getUint16(f,u);return n}function fillFloat32$1(e,t,n,o,u){for(var f=0;f<o*4;f+=4)e[n++]=t.getFloat32(f,u);return n}function unsupported$1(e,t){throw new Error("Unsupported "+e+": "+t)}function validateBitDepth(e){if(e.length){const n=e;e=n[0];for(var t=0;t<n.length;t++)n[t]!==e&&unsupported$1("bit depth",n)}return e}const TIFFDecoder$1=tiffDecoder;var decode$2=function(t,n){return new TIFFDecoder$1(t,n).decode(n)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(e){const t=new IOBuffer(e),n={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const f=t.readBytes(6);if(f[0]===69&&f[1]===120&&f[2]===105&&f[3]===102&&f[4]===0&&f[5]===0){const g=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});n.exif=g}}return n}var decode_1=decode$1,decode=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=e=>[...e].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,t=0){let n=e[t],o=1,u=0;for(;++u<8;)o*=256,n+=e[t+u]*o;return n}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(!(t&&t.length>1))return null;const n=(u,f)=>{f=Object.assign({offset:0},f);for(let g=0;g<u.length;g++)if(f.mask){if(u[g]!==(f.mask[g]&t[g+f.offset]))return!1}else if(u[g]!==t[g+f.offset])return!1;return!0},o=(u,f)=>n(toBytes(u),f);if(n([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(n([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(n([71,73,70]))return{ext:"gif",mime:"image/gif"};if(n([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(n([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((n([73,73,42,0])||n([77,77,0,42]))&&n([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(n([73,73,42,0])||n([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(n([66,77]))return{ext:"bmp",mime:"image/bmp"};if(n([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(n([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(n([80,75,3,4])){if(n([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(n(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(o("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(o("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(o("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const u=(b,T=0)=>b.findIndex((C,L,N)=>L>=T&&N[L]===80&&N[L+1]===75&&N[L+2]===3&&N[L+3]===4);let f=0,g=!1,a=null;do{const b=f+30;if(g||(g=n(oxmlContentTypes,{offset:b})||n(oxmlRels,{offset:b})),a||(o("word/",{offset:b})?a={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:o("ppt/",{offset:b})?a={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:o("xl/",{offset:b})&&(a={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),g&&a)return a;f=u(t,b)}while(f>=0);if(a)return a}if(n([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(n([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(n([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(n([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(n([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(n([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(n([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(n([51,103,112,53])||n([0,0,0])&&n([102,116,121,112],{offset:4})&&(n([109,112,52,49],{offset:8})||n([109,112,52,50],{offset:8})||n([105,115,111,109],{offset:8})||n([105,115,111,50],{offset:8})||n([109,109,112,52],{offset:8})||n([77,52,86],{offset:8})||n([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(n([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(n([26,69,223,163])){const u=t.subarray(4,4100),f=u.findIndex((g,a,b)=>b[a]===66&&b[a+1]===130);if(f!==-1){const g=f+3,a=b=>[...b].every((T,C)=>u[g+C]===T.charCodeAt(0));if(a("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(a("webm"))return{ext:"webm",mime:"video/webm"}}}if(n([0,0,0,20,102,116,121,112,113,116,32,32])||n([102,114,101,101],{offset:4})||n([102,116,121,112,113,116,32,32],{offset:4})||n([109,100,97,116],{offset:4})||n([109,111,111,118],{offset:4})||n([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(n([82,73,70,70])){if(n([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(n([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(n([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(n([48,38,178,117,142,102,207,17,166,217])){let u=30;do{const f=readUInt64LE(t,u+16);if(n([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:u})){if(n([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:u+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(n([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:u+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}u+=f}while(u+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(n([0,0,1,186])||n([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(n([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let u=0;u<2&&u<t.length-16;u++){if(n([73,68,51],{offset:u})||n([255,226],{offset:u,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(n([255,228],{offset:u,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(n([255,248],{offset:u,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(n([255,240],{offset:u,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(n([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(n([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(n([79,103,103,83]))return n([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:n([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:n([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:n([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:n([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(n([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(n([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(n([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(n([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(n([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(n([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&n([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(n([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(n([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(n([119,79,70,70])&&(n([0,1,0,0],{offset:4})||n([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(n([119,79,70,50])&&(n([0,1,0,0],{offset:4})||n([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(n([76,80],{offset:34})&&(n([0,0,1],{offset:8})||n([1,0,2],{offset:8})||n([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(n([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(n([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(n([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(n([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(n([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(n([37,33]))return{ext:"ps",mime:"application/postscript"};if(n([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(n([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(n([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(n([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(n([77,83,67,70])||n([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(n([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(n([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(n([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(n([31,160])||n([31,157]))return{ext:"Z",mime:"application/x-compress"};if(n([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(n([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(n([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(n([71],{offset:4})&&(n([71],{offset:192})||n([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(n([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(n([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(n([0,0,0,12,106,80,32,32,13,10,135,10])){if(n([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(n([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(n([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(n([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(n([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(o("<?xml "))return{ext:"xml",mime:"application/xml"};if(n([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(n([102,116,121,112],{offset:4})){if(n([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(n([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(n([104,101,105,99],{offset:8})||n([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(n([104,101,118,99],{offset:8})||n([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return n([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:n([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:n([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:n([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:n([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:n([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:n([212,195,178,161])||n([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(t)}catch(n){reject(n)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})})(fileType$1);const fileType=fileType$1.exports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=e=>{const t=fileType(e);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageType$1=imageType$2.exports;function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(e,t,n){let o=0;for(;o<e.length;){for(let u=n;u<t*n;u+=n)for(let f=0;f<n;f++)e[o+u+f]=e[o+u+f]+e[o+u-(n-f)]&255;o+=t*n}}function applyHorizontalDifferencing16Bit(e,t,n){let o=0;for(;o<e.length;){for(let u=n;u<t*n;u+=n)for(let f=0;f<n;f++)e[o+u+f]=e[o+u+f]+e[o+u-(n-f)]&65535;o+=t*n}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);var exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"}));const tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);var gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"}));const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);var standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"}));const tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let n of this.fields.keys())t[n]&&(this._map[t[n]]=this.fields.get(n));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,t){const n=types.get(e);if(!n)throw new Error(`type not found: ${e}`);return n[0]*t}function readData(e,t,n){const o=types.get(t);if(!o)throw new Error(`type not found: ${t}`);return o[1](e,n)}function readByte(e,t){if(t===1)return e.readUint8();let n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.readUint8();return n}function readASCII(e,t){let n=[],o="";for(let u=0;u<t;u++){let f=String.fromCharCode(e.readUint8());f==="\0"?(n.push(o),o=""):o+=f}return n.length===1?n[0]:n}function readShort(e,t){if(t===1)return e.readUint16();let n=new Uint16Array(t);for(let o=0;o<t;o++)n[o]=e.readUint16();return n}function readLong(e,t){if(t===1)return e.readUint32();let n=new Uint32Array(t);for(let o=0;o<t;o++)n[o]=e.readUint32();return n}function readRational(e,t){if(t===1)return e.readUint32()/e.readUint32();let n=new Array(t);for(let o=0;o<t;o++)n[o]=e.readUint32()/e.readUint32();return n}function readSByte(e,t){if(t===1)return e.readInt8();let n=new Int8Array(t);for(let o=0;o<t;o++)n[o]=e.readInt8();return n}function readSShort(e,t){if(t===1)return e.readInt16();let n=new Int16Array(t);for(let o=0;o<t;o++)n[o]=e.readInt16();return n}function readSLong(e,t){if(t===1)return e.readInt32();let n=new Int32Array(t);for(let o=0;o<t;o++)n[o]=e.readInt32();return n}function readSRational(e,t){if(t===1)return e.readInt32()/e.readInt32();let n=new Array(t);for(let o=0;o<t;o++)n[o]=e.readInt32()/e.readInt32();return n}function readFloat(e,t){if(t===1)return e.readFloat32();let n=new Float32Array(t);for(let o=0;o<t;o++)n[o]=e.readFloat32();return n}function readDouble(e,t){if(t===1)return e.readFloat64();let n=new Float64Array(t);for(let o=0;o<t;o++)n[o]=e.readFloat64();return n}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const e=[];for(let t=256;t<4096;t++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,n=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),n=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(n).concat(this.stringFromCode(t)[0])),n=t;else{const u=this.stringFromCode(n).concat(this.stringFromCode(n)[0]);this.writeString(u),this.addStringToTable(u),n=t}const o=this.outData.toArray();return new DataView(o.buffer,o.byteOffset,o.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,n=dateTimeRegex.exec(this.dateTime);if(n===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(n[1]),Number(n[2])-1,Number(n[3])),t.setHours(Number(n[4]),Number(n[5]),Number(n[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,n=this.get("ColorMap");if(!n)return;if(n.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const o=[];for(let u=0;u<t;u++)o.push([n[u],n[u+t],n[u+2*t]]);return o}}function alwaysArray(e){return typeof e=="number"?[e]:e}function decompressZlib(e){const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=inflate_1(t);return new DataView(n.buffer,n.byteOffset,n.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$c,t);const n=[];for(this.decodeHeader();this._nextIFD;)if(n.push(this.decodeIFD(t,!0)),t.onlyFirst)return[n[0]];return n}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,n){this.seek(this._nextIFD);let o;if(n)o=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");o=new IFD(t.kind)}const u=this.readUint16();for(let f=0;f<u;f++)this.decodeIFDEntry(o);if(!t.ignoreImageData){if(!(o instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(o)}return this._nextIFD=this.readUint32(),o}decodeIFDEntry(t){const n=this.offset,o=this.readUint16(),u=this.readUint16(),f=this.readUint32();if(u<1||u>12){this.skip(4);return}getByteLength(u,f)>4&&this.seek(this.readUint32());const a=readData(this,u,f);if(t.fields.set(o,a),o===34665||o===34853){let b=this.offset,T="exif";o===34665?T="exif":o===34853&&(T="gps"),this._nextIFD=a,t[T]=this.decodeIFD({kind:T,ignoreImageData:!0},!1),this.offset=b}this.seek(n),this.skip(12)}decodeImageData(t){const n=t.orientation;if(n&&n!==1)throw unsupported("orientation",n);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const o=t.bitsPerSample,u=Math.pow(2,o)-1;for(let f=0;f<t.data.length;f++)t.data[f]=u-t.data[f]}}readStripData(t){const n=t.width,o=t.height,u=t.bitsPerSample,f=t.sampleFormat,g=n*o*t.samplesPerPixel,a=getDataArray(g,u,f),T=t.rowsPerStrip*n*t.samplesPerPixel,C=t.stripOffsets,L=t.stripByteCounts||guessStripByteCounts(t);let N=g,F=0;for(let H=0;H<C.length;H++){let se=new DataView(this.buffer,this.byteOffset+C[H],L[H]),ce=N>T?T:N;N-=ce;let X=se;switch(t.compression){case 1:break;case 5:{X=decompressLzw(se);break}case 8:{X=decompressZlib(se);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}F=this.fillUncompressed(u,f,a,X,F,ce)}t.data=a}fillUncompressed(t,n,o,u,f,g){if(t===8)return fill8bit(o,u,f,g);if(t===16)return fill16bit(o,u,f,g,this.isLittleEndian());if(t===32&&n===3)return fillFloat32(o,u,f,g,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const n=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(n===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(n===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${n}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:n,components:o,maxSampleValue:u}=t;for(let f=0;f<n.length;f+=o){const g=n[f+o-1];for(let a=0;a<o-1;a++)n[f+a]=Math.round(n[f+a]*u/g)}}}}function getDataArray(e,t,n){if(t===8)return new Uint8Array(e);if(t===16)return new Uint16Array(e);if(t===32&&n===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${t} / ${n}`)}function fill8bit(e,t,n,o){for(let u=0;u<o;u++)e[n++]=t.getUint8(u);return n}function fill16bit(e,t,n,o,u){for(let f=0;f<o*2;f+=2)e[n++]=t.getUint16(f,u);return n}function fillFloat32(e,t,n,o,u){for(let f=0;f<o*4;f+=4)e[n++]=t.getFloat32(f,u);return n}function unsupported(e,t){return new Error(`Unsupported ${e}: ${t}`)}function decodeTIFF(e,t){return new TIFFDecoder(e).decode(t)}function matchAndCrop(e={}){let{algorithm:t="matchToPrevious",ignoreBorder:n=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let o=t==="matchToPrevious",u=this[0],f=[];f[0]={position:[0,0],image:this[0]};let g=[0,0];for(let N=1;N<this.length;N++){let F=u.getBestMatch(this[N],{border:n});f[N]={position:[F[0]+g[0],F[1]+g[1]],image:this[N]},o&&(g[0]+=F[0],g[1]+=F[1],u=this[N])}let a=0,b=0,T=0,C=0;for(let N=0;N<f.length;N++){let F=f[N];F.position[0]>a&&(a=F.position[0]),F.position[0]<b&&(b=F.position[0]),F.position[1]>T&&(T=F.position[1]),F.position[1]<C&&(C=F.position[1])}b=0-b,C=0-C;for(let N=0;N<f.length;N++){let F=f[N];F.crop=F.image.crop({x:a-F.position[0],y:T-F.position[1],width:u.width-b-a,height:u.height-C-T})}let L=[];for(let N=0;N<f.length;N++)L[N]=f[N].crop;return new Stack(L)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let t=1;t<this.length;t++)for(let n=0;n<e.length;n++)e[n]=Math.min(e[n],this[t].min[n]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let t=1;t<this.length;t++)for(let n=0;n<e.length;n++)e[n]=Math.max(e[n],this[t].max[n]);return e}function median$2(e){let t=e.reduce((g,a)=>g+a);if(t===0)throw new Error("unreachable");let n=0,o=0,u=t/2,f;for(;;){if(e[n]>0){if(f!==void 0)return(f+n)/2;if(o+=e[n],o>u)return n;o===u&&(f=n)}n++}}function mean$2(e){let t=0,n=0;for(let o=0;o<e.length;o++)t+=e[o],n+=e[o]*o;return t===0?0:n/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(e.length);for(let n=0;n<e.length;n++){let o=e[n];t[n]=median$2(o)}return t}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(e);for(let n=1;n<this.length;n++){let o=this[n].getHistogram(e);for(let u=0;u<t.length;u++)t[u]+=o[u]}return t}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(e),n=t[0].length;for(let o=1;o<this.length;o++){let u=this[o].getHistograms(e);for(let f=0;f<t.length;f++)for(let g=0;g<n;g++)t[f][g]+=u[f][g]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let o=0;o<this.length;o++){let u=this[o];for(let f=0;f<this[0].data.length;f++)e[f]+=u.data[f]}let t=Image.createFrom(this[0]),n=t.data;for(let o=0;o<this[0].data.length;o++)n[o]=e[o]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image.createFrom(this[0]);e.data.fill(0);for(const t of this)for(let n=0;n<e.data.length;n++)e.data[n]=Math.max(t.data[n],e.data[n]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image.createFrom(this[0]);e.data.fill(e.maxValue);for(const t of this)for(let n=0;n<e.data.length;n++)e.data[n]=Math.min(t.data[n],e.data[n]);return e}function extend$5(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let n=0;n<t.length;n++)this[n]=t[n]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image.load)).then(n=>new Stack(n))}static extendMethod(t,n,o={}){let{inPlace:u=!1,returnThis:f=!0,partialArgs:g=[]}=o;return u?Stack.prototype[t]=function(...a){this.computed=null;let b=n.apply(this,[...g,...a]);return f?this:b}:Stack.prototype[t]=function(...a){return n.apply(this,[...g,...a])},Stack}static extendProperty(t,n,o={}){let{partialArgs:u=[]}=o;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let f=n.apply(this,u);return this.computed[t]=f,f},Object.defineProperty(Stack.prototype,t,computedPropertyDescriptor),Stack}checkProcessable(t,n={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,n);for(let o=1;o<this.length;o++){if((n.sameSize===void 0||n.sameSize)&&this[0].width!==this[o].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((n.sameSize===void 0||n.sameSize)&&this[0].height!==this[o].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((n.sameAlpha===void 0||n.sameAlpha)&&this[0].alpha!==this[o].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((n.sameBitDepth===void 0||n.sameBitDepth)&&this[0].bitDepth!==this[o].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((n.sameColorModel===void 0||n.sameColorModel)&&this[0].colorModel!==this[o].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((n.sameNumberChannels===void 0||n.sameNumberChannels)&&this[0].channels!==this[o].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(e,t){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let n=new Stack(this.length);for(let o=0;o<this.length;o++)n[o]=e.call(t,this[o],o,this);return n});extend$5(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(e,t){if(typeof e=="string")return loadURL(e,t);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,t&&t.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,t,n){const o=imageType$1(e);if(o)switch(o.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,n);default:return loadGeneric(u(o.mime))}return loadGeneric(u("application/octet-stream"));function u(f){return t||toBase64URL(e,f)}}function loadURL(e,t){const n=e.slice(0,64).match(isDataURL);let o;return n!==null?o=Promise.resolve(decode$3(e.slice(n[0].length))):o=fetchBinary(e,t),o.then(u=>{const f=new Uint8Array(u);return loadBinary(f,n?e:void 0,t&&t.ignorePalette)})}function loadPNG(e){const t=decodePng(e);let n=t.channels,o,u=0;return n===2||n===4?(o=n-1,u=1):o=n,t.palette?loadPNGFromPalette(t):new Image(t.width,t.height,t.data,{components:o,alpha:u,bitDepth:t.depth})}function loadPNGFromPalette(e){const t=e.width*e.height,n=e.palette[0].length,o=new Uint8Array(t*n),u=8/e.depth,f=e.depth<8?u:1,g=parseInt("1".repeat(e.depth),2),a=n===4;let b=0;for(let T=0;T<t;T++){const C=Math.floor(T/f);let L=e.data[C];e.depth<8&&(L=L>>>e.depth*(u-1-T%u)&g);const N=e.palette[L];o[b++]=N[0],o[b++]=N[1],o[b++]=N[2],a&&(o[b++]=N[3])}return new Image(e.width,e.height,o,{components:3,alpha:a,bitDepth:8})}function loadJPEG(e){const t=decode(e);let n;t.exif&&(n=getMetadata(t.exif));const o=jpegJs.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let u=new Image(o.width,o.height,o.data,{meta:n});if(n&&n.tiff.tags.Orientation){const f=n.tiff.tags.Orientation;f>2&&(u=u.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[f])),[2,4,5,7].includes(f)&&(u=u.flipX())}return u}function loadTIFF(e,t){let n=decodeTIFF(e);return n.length===1?getImageFromIFD(n[0],t):new Stack(n.map(function(o){return getImageFromIFD(o,t)}))}function getMetadata(e){const t={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(t.exif=e.exif),e.gps&&(t.gps=e.gps),t}function getImageFromIFD(e,t){if(!t&&e.type===3){const n=new Uint16Array(3*e.width*e.height),o=e.palette;let u=0;for(let f=0;f<e.data.length;f++){const g=e.data[f],a=o[g];n[u++]=a[0],n[u++]=a[1],n[u++]=a[2]}return new Image(e.width,e.height,n,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,t){return t=t||{},new Promise(function(n,o){let u=new DOMImage;u.onload=function(){let f=u.width,g=u.height,b=createCanvas(f,g).getContext("2d");b.drawImage(u,0,0,f,g);let T=b.getImageData(0,0,f,g).data;n(new Image(f,g,T,t))},u.onerror=function(){o(new Error(`Could not load ${e}`))},u.src=e})}const valueMethods={getValueXY(e,t,n){return this.data[(t*this.width+e)*this.channels+n]},setValueXY(e,t,n,o){return this.data[(t*this.width+e)*this.channels+n]=o,this.computed=null,this},getValue(e,t){return this.data[e*this.channels+t]},setValue(e,t,n){return this.data[e*this.channels+t]=n,this.computed=null,this},getPixelXY(e,t){return this.getPixel(t*this.width+e)},setPixelXY(e,t,n){return this.setPixel(t*this.width+e,n)},getPixel(e){const t=new Array(this.channels),n=e*this.channels;for(let o=0;o<this.channels;o++)t[o]=this.data[n+o];return t},setPixel(e,t){const n=e*this.channels;for(let o=0;o<t.length;o++)this.data[n+o]=t[o];return this.computed=null,this}};function setValueMethods(e){for(const t in valueMethods)e.prototype[t]=valueMethods[t]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,t,n,o={}){const{out:u}=t;if(u===void 0)return o.copy?e.clone():Image.createFrom(e,n);{if(!Image.isImage(u))throw new TypeError("out must be an Image object");const f=Object.assign(getImageParameters(e),n);for(const g in f)if(u[g]!==f[g])throw new RangeError(`cannot use out. Its ${g} must be "${f[g]}" (found "${u[g]}")`);return u}}function getOutputImageOrInPlace(e,t,n){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,t,null,n)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,e);return absolute(this,t),t}function absolute(e,t){for(let n=0;n<e.data.length;n++)t.data[n]=Math.abs(e.data[n])}function copyAlphaChannel(e,t){if(e.alpha===1&&t.alpha===1)for(let n=0;n<e.size;n++)t.data[n*t.channels+t.components]=e.data[n*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(e,t){for(let n=0;n<e.data.length;n++)t.data[n]=~e.data[n]}function invertColor(e,t){for(let n=0;n<e.data.length;n+=e.channels)for(let o=0;o<e.components;o++)t.data[n+o]=e.maxValue-e.data[n+o]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let t=e*this.width*this.channels;for(let n=0;n<Math.floor(this.width/2);n++){let o=n*this.channels+t,u=(this.width-n-1)*this.channels+t;for(let f=0;f<this.channels;f++){let g=this.data[o+f];this.data[o+f]=this.data[u+f],this.data[u+f]=g}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let t=0;t<this.width;t++){let n=t*this.channels+e*this.width*this.channels,o=t*this.channels+(this.height-1-e)*this.channels*this.width;for(let u=0;u<this.channels;u++){let f=this.data[n+u];this.data[n+u]=this.data[o+u],this.data[o+u]=f}}return this}function blurFilter(e={}){const{radius:t=1}=e;if(t<1)throw new Error("radius must be greater than 1");const n=2*t+1,o=new Array(n);for(let u=0;u<n;u++){o[u]=new Array(n);for(let f=0;f<n;f++)o[u][f]=1/(n*n)}return this.convolution(o)}var medianQuickselect_min={exports:{}};(function(e){(function(){function t(u){for(var f=0,g=u.length-1,a=void 0,b=void 0,T=void 0,C=o(f,g);;){if(g<=f)return u[C];if(g==f+1)return u[f]>u[g]&&n(u,f,g),u[C];for(a=o(f,g),u[a]>u[g]&&n(u,a,g),u[f]>u[g]&&n(u,f,g),u[a]>u[f]&&n(u,a,f),n(u,a,f+1),b=f+1,T=g;;){do b++;while(u[f]>u[b]);do T--;while(u[T]>u[f]);if(T<b)break;n(u,b,T)}n(u,f,T),T<=C&&(f=b),T>=C&&(g=T-1)}}var n=function(f,g,a){var b;return b=[f[a],f[g]],f[g]=b[0],f[a]=b[1],b},o=function(f,g){return~~((f+g)/2)};e.exports?e.exports=t:window.median=t})()})(medianQuickselect_min);var quickSelectMedian=medianQuickselect_min.exports;function validateArrayOfChannels(e,t={}){let{channels:n,allowAlpha:o,defaultAlpha:u}=t;return typeof o!="boolean"&&(o=!0),typeof n>"u"?allChannels(e,u):validateChannels(e,n,o)}function allChannels(e,t){let n=t?e.channels:e.components,o=new Array(n);for(let u=0;u<n;u++)o[u]=u;return o}function validateChannels(e,t,n){Array.isArray(t)||(t=[t]);for(let o=0;o<t.length;o++)t[o]=validateChannel(e,t[o],n);return t}function validateChannel(e,t,n=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof t=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(t==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=e.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!n&&t>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(e={}){let{radius:t=1,border:n="copy",channels:o}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");o=validateArrayOfChannels(this,o);let u=t,f=t,g=Image.createFrom(this),a=(u*2+1)*(f*2+1),b=new Array(a);for(let T=0;T<o.length;T++){let C=o[T];for(let L=f;L<this.height-f;L++)for(let N=u;N<this.width-u;N++){let F=0;for(let se=-f;se<=f;se++)for(let ce=-u;ce<=u;ce++){let X=((L+se)*this.width+N+ce)*this.channels+C;b[F++]=this.data[X]}let H=(L*this.width+N)*this.channels+C;g.data[H]=quickSelectMedian(b)}}if(this.alpha&&!o.includes(this.channels))for(let T=this.components;T<this.data.length;T=T+this.channels)g.data[T]=this.data[T];return g.setBorder({size:[u,f],algorithm:n}),g}function gaussianFilter(e={}){let{radius:t=1,sigma:n,channels:o,border:u="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const f=getKernel(t,n);return this.convolution([f,f],{border:u,channels:o,algorithm:"separable"})}function getKernel(e,t){const n=e*2+1,o=new Array(n),u=t||((n-1)*.5-1)*.3+.8,f=-.5/(u*u);let g=0;for(let a=0;a<n;a++){const b=a-e,T=Math.exp(f*b*b);o[a]=T,g+=T}for(let a=0;a<n;a++)o[a]/=g;return o}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(e){(function(){var t;t=e;var n={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+n.release+", released "+n.date};for(var o=0,u=null,f=null,g={init:function(T){if(T!==0&&(T&T-1)===0)o=T,g._initArray(),g._makeBitReversalTable(),g._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(T,C){g.fft(T,C,1)},ifft1d:function(T,C){var L=1/o;g.fft(T,C,-1);for(var N=0;N<o;N++)T[N]*=L,C[N]*=L},bt1d:function(T,C){g.fft(T,C,-1)},fft2d:function(T,C){for(var L=[],N=[],F=0,H=0;H<o;H++){F=H*o;for(var se=0;se<o;se++)L[se]=T[se+F],N[se]=C[se+F];g.fft1d(L,N);for(var ce=0;ce<o;ce++)T[ce+F]=L[ce],C[ce+F]=N[ce]}for(var X=0;X<o;X++){for(var ye=0;ye<o;ye++)F=X+ye*o,L[ye]=T[F],N[ye]=C[F];g.fft1d(L,N);for(var oe=0;oe<o;oe++)F=X+oe*o,T[F]=L[oe],C[F]=N[oe]}},ifft2d:function(T,C){for(var L=[],N=[],F=0,H=0;H<o;H++){F=H*o;for(var se=0;se<o;se++)L[se]=T[se+F],N[se]=C[se+F];g.ifft1d(L,N);for(var ce=0;ce<o;ce++)T[ce+F]=L[ce],C[ce+F]=N[ce]}for(var X=0;X<o;X++){for(var ye=0;ye<o;ye++)F=X+ye*o,L[ye]=T[F],N[ye]=C[F];g.ifft1d(L,N);for(var oe=0;oe<o;oe++)F=X+oe*o,T[F]=L[oe],C[F]=N[oe]}},fft:function(T,C,L){for(var N,F,H,se,ce,X,ye,oe,le,ue=o>>2,Re=0;Re<o;Re++)se=u[Re],Re<se&&(ce=T[Re],T[Re]=T[se],T[se]=ce,ce=C[Re],C[Re]=C[se],C[se]=ce);for(var ze=1;ze<o;ze<<=1){F=0,N=o/(ze<<1);for(var ve=0;ve<ze;ve++){X=f[F+ue],ye=L*f[F];for(var be=ve;be<o;be+=ze<<1)H=be+ze,oe=X*T[H]+ye*C[H],le=X*C[H]-ye*T[H],T[H]=T[be]-oe,T[be]+=oe,C[H]=C[be]-le,C[be]+=le;F+=N}}},_initArray:function(){typeof Uint32Array<"u"?u=new Uint32Array(o):u=[],typeof Float64Array<"u"?f=new Float64Array(o*1.25):f=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var T=0,C=0,L=0;for(u[0]=0;++T<o;){for(L=o>>1;L<=C;)C-=L,L>>=1;C+=L,u[T]=C}},_makeCosSinTable:function(){var T=o>>1,C=o>>2,L=o>>3,N=T+C,F=Math.sin(Math.PI/o),H=2*F*F,se=Math.sqrt(H*(2-H)),ce=f[C]=1,X=f[0]=0;F=2*H;for(var ye=1;ye<L;ye++)ce-=H,H+=F*ce,X+=se,se-=F*X,f[ye]=X,f[C-ye]=ce;L!==0&&(f[L]=Math.sqrt(.5));for(var oe=0;oe<C;oe++)f[T-oe]=f[oe];for(var le=0;le<N;le++)f[le+T]=-f[le]}},a=["init","fft1d","ifft1d","fft2d","ifft2d"],b=0;b<a.length;b++)t[a[b]]=g[a[b]];return t.bt=g.bt1d,t.fft=g.fft1d,t.ifft=g.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(e,t,n){var o=new Array(t*n),u=t/2,f=(n-1)*2;FFT.init(u);for(var g={re:new Array(u),im:new Array(u)},a=0;a<n;a++){for(var b=u-1;b>=0;b--)g.re[b]=e[b*2*n+a],g.im[b]=e[(b*2+1)*n+a];FFT.bt(g.re,g.im);for(var b=u-1;b>=0;b--)o[b*2*n+a]=g.re[b],o[(b*2+1)*n+a]=g.im[b]}var T=new Array(u*f);FFT.init(f);for(var C={re:new Array(f),im:new Array(f)},L=f*u,b=0;b<t;b+=2){C.re[0]=o[b*n],C.im[0]=o[(b+1)*n];for(var a=1;a<n;a++)C.re[a]=o[b*n+a],C.im[a]=o[(b+1)*n+a],C.re[f-a]=o[b*n+a],C.im[f-a]=-o[(b+1)*n+a];FFT.bt(C.re,C.im);for(var N=b/2*f,a=f-1;a>=0;a--)T[N+a]=C.re[a]/L}return T},fft2DArray:function(e,t,n,o){Object.assign({},{inplace:!0});var u=n/2+1,f=t*2,g=new Array(f*u);FFT.init(n);for(var a={re:new Array(n),im:new Array(n)},b={re:new Array(n),im:new Array(n)},T={re:new Array(n),im:new Array(n)},C,L,N,F,H,se=0;se<t/2;se++){C=se*2*n,a.re=e.slice(C,C+n),C=(se*2+1)*n,a.im=e.slice(C,C+n),FFT.fft1d(a.re,a.im),this.reconstructTwoRealFFT(a,b,T),L=se*4*u,N=(se*4+1)*u,F=(se*4+2)*u,H=(se*4+3)*u;for(var ce=u-1;ce>=0;ce--)g[L+ce]=b.re[ce],g[N+ce]=b.im[ce],g[F+ce]=T.re[ce],g[H+ce]=T.im[ce]}b=null,T=null;var X=new Array(f*u);FFT.init(t);for(var ye={re:new Array(t),im:new Array(t)},oe=u-1;oe>=0;oe--){for(var se=t-1;se>=0;se--)ye.re[se]=g[se*2*u+oe],ye.im[se]=g[(se*2+1)*u+oe],isNaN(ye.re[se])&&(ye.re[se]=0),isNaN(ye.im[se])&&(ye.im[se]=0);FFT.fft1d(ye.re,ye.im);for(var se=t-1;se>=0;se--)X[se*2*u+oe]=ye.re[se],X[(se*2+1)*u+oe]=ye.im[se]}return X},reconstructTwoRealFFT:function(e,t,n){var o=e.re.length;t.re[0]=e.re[0],t.im[0]=0,n.re[0]=e.im[0],n.im[0]=0;for(var u,f,g,a,b,T=o/2;T>0;T--)b=o-T,u=.5*(e.re[T]-e.re[b]),f=.5*(e.re[T]+e.re[b]),g=.5*(e.im[T]-e.im[b]),a=.5*(e.im[T]+e.im[b]),t.re[T]=f,t.im[T]=g,t.re[b]=f,t.im[b]=-g,n.re[T]=a,n.im[T]=-u,n.re[b]=a,n.im[b]=u},convolute2DI:function(e,t,n,o){for(var u,f,g=0;g<n/2;g++)for(var a=0;a<o;a++)u=e[g*2*o+a]*t[g*2*o+a]-e[(g*2+1)*o+a]*t[(g*2+1)*o+a],f=e[g*2*o+a]*t[(g*2+1)*o+a]+e[(g*2+1)*o+a]*t[g*2*o+a],e[g*2*o+a]=u,e[(g*2+1)*o+a]=f},convolute:function(e,t,n,o,u){for(var f=new Array(o*n),g=0;g<n*o;g++)f[g]=e[g];f=this.fft2DArray(f,n,o);for(var a=t.length,b=t[0].length,T=new Array(o*n),g=0;g<o*n;g++)T[g]=0;for(var C,L,N=Math.floor((a-1)/2),F=Math.floor((b-1)/2),H=0;H<a;H++){C=(H-N+n)%n;for(var se=0;se<b;se++)L=(se-F+o)%o,T[C*o+L]=t[H][se]}T=this.fft2DArray(T,n,o);var ce=n*2,X=o/2+1;return this.convolute2DI(f,T,ce,X),this.ifft2DArray(f,ce,X)},toRadix2:function(e,t,n){var o,u,f,g,a=n,b=t;if(!(n!==0&&(n&n-1)===0)){for(a=0;n>>++a!=0;);a=1<<a}if(!(t!==0&&(t&t-1)===0)){for(b=0;t>>++b!=0;);b=1<<b}if(b==t&&a==n)return{data:e,rows:t,cols:n};var T=new Array(b*a),C=Math.floor((b-t)/2)-t,L=Math.floor((a-n)/2)-n;for(o=0;o<b;o++)for(f=o*a,g=(o-C)%t*n,u=0;u<a;u++)T[f+u]=e[g+(u-L)%n];return{data:T,rows:b,cols:a}},crop:function(e,t,n,o,u,f){if(t==o&&n==u)return e;Object.assign({},f);var g=new Array(u*o),a=Math.floor((t-o)/2),b=Math.floor((n-u)/2),T,C,L,N;for(L=0;L<o;L++)for(T=L*u,C=(L+a)*n,N=0;N<u;N++)g[T+N]=e[C+(N+b)];return g}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(e,t,n){var o=matrix2Array(e),u=o.data,f=Object.assign({normalize:!1,divisor:1,rows:o.rows,cols:o.cols},n),g,a;if(f.rows&&f.cols)g=f.rows,a=f.cols;else throw new Error("Invalid number of rows or columns "+g+" "+a);var b=f.divisor,T,C,L=t.length,N=t[0].length;if(f.normalize)for(b=0,T=0;T<L;T++)for(C=0;C<N;C++)b+=t[T][C];if(b===0)throw new RangeError("convolution: The divisor is equal to zero");var F=FFTUtils.toRadix2(u,g,a),H=FFTUtils.convolute(F.data,t,F.rows,F.cols);if(H=FFTUtils.crop(H,F.rows,F.cols,g,a),b!=0&&b!=1)for(T=0;T<H.length;T++)H[T]/=b;return H}function convolutionDirect(e,t,n){var o=matrix2Array(e),u=o.data,f=Object.assign({normalize:!1,divisor:1,rows:o.rows,cols:o.cols},n),g,a;if(f.rows&&f.cols)g=f.rows,a=f.cols;else throw new Error("Invalid number of rows or columns "+g+" "+a);var b=f.divisor,T=t.length,C=t[0].length,L,N,F,H,se,ce,X,ye,oe;if(f.normalize)for(b=0,L=0;L<T;L++)for(N=0;N<C;N++)b+=t[L][N];if(b===0)throw new RangeError("convolution: The divisor is equal to zero");var le=new Array(g*a),ue=Math.floor(T/2),Re=Math.floor(C/2);for(H=0;H<g;H++)for(F=0;F<a;F++){for(ce=0,N=0;N<T;N++)for(L=0;L<C;L++)X=t[T-N-1][C-L-1],ye=(H+N-ue+g)%g,oe=(F+L-Re+a)%a,se=ye*a+oe,ce+=u[se]*X;se=H*a+F,le[se]=ce/b}return le}function LoG(e,t,n){var o=1e3;n&&n.factor&&(o=n.factor);var u=new Array(t),f,g,a,b;o*=-1;var T=(t-1)/2,C=2*e*e;for(f=0;f<t;f++)for(u[f]=new Array(t),b=(f-T)*(f-T),g=0;g<t;g++)a=-((g-T)*(g-T)+b)/C,u[f][g]=Math.round(o*(1+a)*Math.exp(a));return u}function matrix2Array(e){var t=e,n,o;if(typeof e[0]!="number"){n=e.length,o=e[0].length,t=new Array(n*o);for(var u=0;u<n;u++)for(var f=0;f<o;f++)t[u*o+f]=e[u][f]}else{var g=Math.sqrt(e.length);Number.isInteger(g)&&(n=g,o=g)}return{data:t,rows:n,cols:o}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite$1(e)&&Math.floor(e)===e};function validateKernel(e){let t,n;if(Array.isArray(e))if(Array.isArray(e[0])){if((e.length&1)===0||(e[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(e.length/2),n=Math.floor(e[0].length/2)}else{let o=Math.sqrt(e.length);if(isInteger(o))n=t=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let u=new Array(o);for(let f=0;f<o;f++){u[f]=new Array(o);for(let g=0;g<o;g++)u[f][g]=e[f*o+g]}e=u}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:n,kHeight:t}}function clamp(e,t){return Math.round(Math.min(Math.max(e,0),t.maxValue))}function directConvolution(e,t,n){if(n===void 0){const f=e.length+t.length-1;n=new Array(f)}fill(n);for(var o=0;o<e.length;o++)for(var u=0;u<t.length;u++)n[o+u]+=e[o]*t[u];return n}function fill(e){for(var t=0;t<e.length;t++)e[t]=0}function convolutionSeparable(e,t,n,o){const u=new Array(e.length);let f,g,a,b;b=t[1],a=(b.length-1)/2,g=new Array(n+b.length-1),f=new Array(n);for(let T=0;T<o;T++){for(let C=0;C<n;C++)f[C]=e[T*n+C];directConvolution(f,b,g);for(let C=0;C<n;C++)u[T*n+C]=g[a+C]}b=t[0],a=(b.length-1)/2,g=new Array(o+b.length-1),f=new Array(o);for(let T=0;T<n;T++){for(let C=0;C<o;C++)f[C]=u[C*n+T];directConvolution(f,b,g);for(let C=0;C<o;C++)u[C*n+T]=g[a+C]}return u}const toString$2=Object.prototype.toString;function isAnyArray(e){return toString$2.call(e).endsWith("Array]")}function max$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var n=t.fromIndex,o=n===void 0?0:n,u=t.toIndex,f=u===void 0?e.length:u;if(o<0||o>=e.length||!Number.isInteger(o))throw new Error("fromIndex must be a positive integer smaller than length");if(f<=o||f>e.length||!Number.isInteger(f))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var g=e[o],a=o+1;a<f;a++)e[a]>g&&(g=e[a]);return g}function min$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var n=t.fromIndex,o=n===void 0?0:n,u=t.toIndex,f=u===void 0?e.length:u;if(o<0||o>=e.length||!Number.isInteger(o))throw new Error("fromIndex must be a positive integer smaller than length");if(f<=o||f>e.length||!Number.isInteger(f))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var g=e[o],a=o+1;a<f;a++)e[a]<g&&(g=e[a]);return g}function rescale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var n;if(t.output!==void 0){if(!isAnyArray(t.output))throw new TypeError("output option must be an array if specified");n=t.output}else n=new Array(e.length);var o=min$1(e),u=max$1(e);if(o===u)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var f=t.min,g=f===void 0?t.autoMinMax?o:0:f,a=t.max,b=a===void 0?t.autoMinMax?u:1:a;if(g>=b)throw new RangeError("min option must be smaller than max option");for(var T=(b-g)/(u-o),C=0;C<e.length;C++)n[C]=(e[C]-o)*T+g;return n}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(e,t={}){const{maxRows:n=15,maxColumns:o=10,maxNumSize:u=8}=t;return`${e.constructor.name} {
${indent}[
${indentData}${inspectData(e,n,o,u)}
${indent}]
${indent}rows: ${e.rows}
${indent}columns: ${e.columns}
}`}function inspectData(e,t,n,o){const{rows:u,columns:f}=e,g=Math.min(u,t),a=Math.min(f,n),b=[];for(let T=0;T<g;T++){let C=[];for(let L=0;L<a;L++)C.push(formatNumber(e.get(T,L),o));b.push(`${C.join(" ")}`)}return a!==f&&(b[b.length-1]+=` ... ${f-n} more columns`),g!==u&&b.push(`... ${u-t} more rows`),b.join(`
${indentData}`)}function formatNumber(e,t){const n=String(e);if(n.length<=t)return n.padEnd(t," ");const o=e.toPrecision(t-2);if(o.length<=t)return o;const u=e.toExponential(t-2),f=u.indexOf("e"),g=u.slice(f);return u.slice(0,t-g.length)+g}function installMathOperations(e,t){e.prototype.add=function(o){return typeof o=="number"?this.addS(o):this.addM(o)},e.prototype.addS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)+o);return this},e.prototype.addM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)+o.get(u,f));return this},e.add=function(o,u){return new t(o).add(u)},e.prototype.sub=function(o){return typeof o=="number"?this.subS(o):this.subM(o)},e.prototype.subS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)-o);return this},e.prototype.subM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)-o.get(u,f));return this},e.sub=function(o,u){return new t(o).sub(u)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(o){return typeof o=="number"?this.mulS(o):this.mulM(o)},e.prototype.mulS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)*o);return this},e.prototype.mulM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)*o.get(u,f));return this},e.mul=function(o,u){return new t(o).mul(u)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(o){return typeof o=="number"?this.divS(o):this.divM(o)},e.prototype.divS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)/o);return this},e.prototype.divM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)/o.get(u,f));return this},e.div=function(o,u){return new t(o).div(u)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(o){return typeof o=="number"?this.modS(o):this.modM(o)},e.prototype.modS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)%o);return this},e.prototype.modM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)%o.get(u,f));return this},e.mod=function(o,u){return new t(o).mod(u)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(o){return typeof o=="number"?this.andS(o):this.andM(o)},e.prototype.andS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)&o);return this},e.prototype.andM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)&o.get(u,f));return this},e.and=function(o,u){return new t(o).and(u)},e.prototype.or=function(o){return typeof o=="number"?this.orS(o):this.orM(o)},e.prototype.orS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)|o);return this},e.prototype.orM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)|o.get(u,f));return this},e.or=function(o,u){return new t(o).or(u)},e.prototype.xor=function(o){return typeof o=="number"?this.xorS(o):this.xorM(o)},e.prototype.xorS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)^o);return this},e.prototype.xorM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)^o.get(u,f));return this},e.xor=function(o,u){return new t(o).xor(u)},e.prototype.leftShift=function(o){return typeof o=="number"?this.leftShiftS(o):this.leftShiftM(o)},e.prototype.leftShiftS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)<<o);return this},e.prototype.leftShiftM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)<<o.get(u,f));return this},e.leftShift=function(o,u){return new t(o).leftShift(u)},e.prototype.signPropagatingRightShift=function(o){return typeof o=="number"?this.signPropagatingRightShiftS(o):this.signPropagatingRightShiftM(o)},e.prototype.signPropagatingRightShiftS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)>>o);return this},e.prototype.signPropagatingRightShiftM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)>>o.get(u,f));return this},e.signPropagatingRightShift=function(o,u){return new t(o).signPropagatingRightShift(u)},e.prototype.rightShift=function(o){return typeof o=="number"?this.rightShiftS(o):this.rightShiftM(o)},e.prototype.rightShiftS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)>>>o);return this},e.prototype.rightShiftM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,this.get(u,f)>>>o.get(u,f));return this},e.rightShift=function(o,u){return new t(o).rightShift(u)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,~this.get(o,u));return this},e.not=function(o){return new t(o).not()},e.prototype.abs=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.abs(this.get(o,u)));return this},e.abs=function(o){return new t(o).abs()},e.prototype.acos=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.acos(this.get(o,u)));return this},e.acos=function(o){return new t(o).acos()},e.prototype.acosh=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.acosh(this.get(o,u)));return this},e.acosh=function(o){return new t(o).acosh()},e.prototype.asin=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.asin(this.get(o,u)));return this},e.asin=function(o){return new t(o).asin()},e.prototype.asinh=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.asinh(this.get(o,u)));return this},e.asinh=function(o){return new t(o).asinh()},e.prototype.atan=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.atan(this.get(o,u)));return this},e.atan=function(o){return new t(o).atan()},e.prototype.atanh=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.atanh(this.get(o,u)));return this},e.atanh=function(o){return new t(o).atanh()},e.prototype.cbrt=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.cbrt(this.get(o,u)));return this},e.cbrt=function(o){return new t(o).cbrt()},e.prototype.ceil=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.ceil(this.get(o,u)));return this},e.ceil=function(o){return new t(o).ceil()},e.prototype.clz32=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.clz32(this.get(o,u)));return this},e.clz32=function(o){return new t(o).clz32()},e.prototype.cos=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.cos(this.get(o,u)));return this},e.cos=function(o){return new t(o).cos()},e.prototype.cosh=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.cosh(this.get(o,u)));return this},e.cosh=function(o){return new t(o).cosh()},e.prototype.exp=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.exp(this.get(o,u)));return this},e.exp=function(o){return new t(o).exp()},e.prototype.expm1=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.expm1(this.get(o,u)));return this},e.expm1=function(o){return new t(o).expm1()},e.prototype.floor=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.floor(this.get(o,u)));return this},e.floor=function(o){return new t(o).floor()},e.prototype.fround=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.fround(this.get(o,u)));return this},e.fround=function(o){return new t(o).fround()},e.prototype.log=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.log(this.get(o,u)));return this},e.log=function(o){return new t(o).log()},e.prototype.log1p=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.log1p(this.get(o,u)));return this},e.log1p=function(o){return new t(o).log1p()},e.prototype.log10=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.log10(this.get(o,u)));return this},e.log10=function(o){return new t(o).log10()},e.prototype.log2=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.log2(this.get(o,u)));return this},e.log2=function(o){return new t(o).log2()},e.prototype.round=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.round(this.get(o,u)));return this},e.round=function(o){return new t(o).round()},e.prototype.sign=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.sign(this.get(o,u)));return this},e.sign=function(o){return new t(o).sign()},e.prototype.sin=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.sin(this.get(o,u)));return this},e.sin=function(o){return new t(o).sin()},e.prototype.sinh=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.sinh(this.get(o,u)));return this},e.sinh=function(o){return new t(o).sinh()},e.prototype.sqrt=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.sqrt(this.get(o,u)));return this},e.sqrt=function(o){return new t(o).sqrt()},e.prototype.tan=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.tan(this.get(o,u)));return this},e.tan=function(o){return new t(o).tan()},e.prototype.tanh=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.tanh(this.get(o,u)));return this},e.tanh=function(o){return new t(o).tanh()},e.prototype.trunc=function(){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.set(o,u,Math.trunc(this.get(o,u)));return this},e.trunc=function(o){return new t(o).trunc()},e.pow=function(o,u){return new t(o).pow(u)},e.prototype.pow=function(o){return typeof o=="number"?this.powS(o):this.powM(o)},e.prototype.powS=function(o){for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,Math.pow(this.get(u,f),o));return this},e.prototype.powM=function(o){if(o=t.checkMatrix(o),this.rows!==o.rows||this.columns!==o.columns)throw new RangeError("Matrices dimensions must be equal");for(let u=0;u<this.rows;u++)for(let f=0;f<this.columns;f++)this.set(u,f,Math.pow(this.get(u,f),o.get(u,f)));return this}}function checkRowIndex(e,t,n){let o=n?e.rows:e.rows-1;if(t<0||t>o)throw new RangeError("Row index out of range")}function checkColumnIndex(e,t,n){let o=n?e.columns:e.columns-1;if(t<0||t>o)throw new RangeError("Column index out of range")}function checkRowVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(e,t){if(!isAnyArray(t))throw new TypeError("row indices must be an array");for(let n=0;n<t.length;n++)if(t[n]<0||t[n]>=e.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(e,t){if(!isAnyArray(t))throw new TypeError("column indices must be an array");for(let n=0;n<t.length;n++)if(t[n]<0||t[n]>=e.columns)throw new RangeError("column indices are out of range")}function checkRange(e,t,n,o,u){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",n),checkNumber("startColumn",o),checkNumber("endColumn",u),t>n||o>u||t<0||t>=e.rows||n<0||n>=e.rows||o<0||o>=e.columns||u<0||u>=e.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$1(e,t=0){let n=[];for(let o=0;o<e;o++)n.push(t);return n}function checkNumber(e,t){if(typeof t!="number")throw new TypeError(`${e} must be a number`)}function checkNonEmpty(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(e){let t=newArray$1(e.rows);for(let n=0;n<e.rows;++n)for(let o=0;o<e.columns;++o)t[n]+=e.get(n,o);return t}function sumByColumn(e){let t=newArray$1(e.columns);for(let n=0;n<e.rows;++n)for(let o=0;o<e.columns;++o)t[o]+=e.get(n,o);return t}function sumAll(e){let t=0;for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)t+=e.get(n,o);return t}function productByRow(e){let t=newArray$1(e.rows,1);for(let n=0;n<e.rows;++n)for(let o=0;o<e.columns;++o)t[n]*=e.get(n,o);return t}function productByColumn(e){let t=newArray$1(e.columns,1);for(let n=0;n<e.rows;++n)for(let o=0;o<e.columns;++o)t[o]*=e.get(n,o);return t}function productAll(e){let t=1;for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)t*=e.get(n,o);return t}function varianceByRow(e,t,n){const o=e.rows,u=e.columns,f=[];for(let g=0;g<o;g++){let a=0,b=0,T=0;for(let C=0;C<u;C++)T=e.get(g,C)-n[g],a+=T,b+=T*T;t?f.push((b-a*a/u)/(u-1)):f.push((b-a*a/u)/u)}return f}function varianceByColumn(e,t,n){const o=e.rows,u=e.columns,f=[];for(let g=0;g<u;g++){let a=0,b=0,T=0;for(let C=0;C<o;C++)T=e.get(C,g)-n[g],a+=T,b+=T*T;t?f.push((b-a*a/o)/(o-1)):f.push((b-a*a/o)/o)}return f}function varianceAll(e,t,n){const o=e.rows,u=e.columns,f=o*u;let g=0,a=0,b=0;for(let T=0;T<o;T++)for(let C=0;C<u;C++)b=e.get(T,C)-n,g+=b,a+=b*b;return t?(a-g*g/f)/(f-1):(a-g*g/f)/f}function centerByRow(e,t){for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)e.set(n,o,e.get(n,o)-t[n])}function centerByColumn(e,t){for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)e.set(n,o,e.get(n,o)-t[o])}function centerAll(e,t){for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)e.set(n,o,e.get(n,o)-t)}function getScaleByRow(e){const t=[];for(let n=0;n<e.rows;n++){let o=0;for(let u=0;u<e.columns;u++)o+=Math.pow(e.get(n,u),2)/(e.columns-1);t.push(Math.sqrt(o))}return t}function scaleByRow(e,t){for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)e.set(n,o,e.get(n,o)/t[n])}function getScaleByColumn(e){const t=[];for(let n=0;n<e.columns;n++){let o=0;for(let u=0;u<e.rows;u++)o+=Math.pow(e.get(u,n),2)/(e.rows-1);t.push(Math.sqrt(o))}return t}function scaleByColumn(e,t){for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)e.set(n,o,e.get(n,o)/t[o])}function getScaleAll(e){const t=e.size-1;let n=0;for(let o=0;o<e.columns;o++)for(let u=0;u<e.rows;u++)n+=Math.pow(e.get(u,o),2)/t;return Math.sqrt(n)}function scaleAll(e,t){for(let n=0;n<e.rows;n++)for(let o=0;o<e.columns;o++)e.set(n,o,e.get(n,o)/t)}class AbstractMatrix{static from1DArray(t,n,o){if(t*n!==o.length)throw new RangeError("data length does not match given dimensions");let f=new Matrix$2(t,n);for(let g=0;g<t;g++)for(let a=0;a<n;a++)f.set(g,a,o[g*n+a]);return f}static rowVector(t){let n=new Matrix$2(1,t.length);for(let o=0;o<t.length;o++)n.set(0,o,t[o]);return n}static columnVector(t){let n=new Matrix$2(t.length,1);for(let o=0;o<t.length;o++)n.set(o,0,t[o]);return n}static zeros(t,n){return new Matrix$2(t,n)}static ones(t,n){return new Matrix$2(t,n).fill(1)}static rand(t,n,o={}){if(typeof o!="object")throw new TypeError("options must be an object");const{random:u=Math.random}=o;let f=new Matrix$2(t,n);for(let g=0;g<t;g++)for(let a=0;a<n;a++)f.set(g,a,u());return f}static randInt(t,n,o={}){if(typeof o!="object")throw new TypeError("options must be an object");const{min:u=0,max:f=1e3,random:g=Math.random}=o;if(!Number.isInteger(u))throw new TypeError("min must be an integer");if(!Number.isInteger(f))throw new TypeError("max must be an integer");if(u>=f)throw new RangeError("min must be smaller than max");let a=f-u,b=new Matrix$2(t,n);for(let T=0;T<t;T++)for(let C=0;C<n;C++){let L=u+Math.round(g()*a);b.set(T,C,L)}return b}static eye(t,n,o){n===void 0&&(n=t),o===void 0&&(o=1);let u=Math.min(t,n),f=this.zeros(t,n);for(let g=0;g<u;g++)f.set(g,g,o);return f}static diag(t,n,o){let u=t.length;n===void 0&&(n=u),o===void 0&&(o=n);let f=Math.min(u,n,o),g=this.zeros(n,o);for(let a=0;a<f;a++)g.set(a,a,t[a]);return g}static min(t,n){t=this.checkMatrix(t),n=this.checkMatrix(n);let o=t.rows,u=t.columns,f=new Matrix$2(o,u);for(let g=0;g<o;g++)for(let a=0;a<u;a++)f.set(g,a,Math.min(t.get(g,a),n.get(g,a)));return f}static max(t,n){t=this.checkMatrix(t),n=this.checkMatrix(n);let o=t.rows,u=t.columns,f=new this(o,u);for(let g=0;g<o;g++)for(let a=0;a<u;a++)f.set(g,a,Math.max(t.get(g,a),n.get(g,a)));return f}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix$2(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)t.call(this,n,o);return this}to1DArray(){let t=[];for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)t.push(this.get(n,o));return t}to2DArray(){let t=[];for(let n=0;n<this.rows;n++){t.push([]);for(let o=0;o<this.columns;o++)t[n].push(this.get(n,o))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let n=0;n<=t;n++)if(this.get(t,n)!==this.get(n,t))return!1;return!0}return!1}isEchelonForm(){let t=0,n=0,o=-1,u=!0,f=!1;for(;t<this.rows&&u;){for(n=0,f=!1;n<this.columns&&f===!1;)this.get(t,n)===0?n++:this.get(t,n)===1&&n>o?(f=!0,o=n):(u=!1,f=!0);t++}return u}isReducedEchelonForm(){let t=0,n=0,o=-1,u=!0,f=!1;for(;t<this.rows&&u;){for(n=0,f=!1;n<this.columns&&f===!1;)this.get(t,n)===0?n++:this.get(t,n)===1&&n>o?(f=!0,o=n):(u=!1,f=!0);for(let g=n+1;g<this.rows;g++)this.get(t,g)!==0&&(u=!1);t++}return u}echelonForm(){let t=this.clone(),n=0,o=0;for(;n<t.rows&&o<t.columns;){let u=n;for(let f=n;f<t.rows;f++)t.get(f,o)>t.get(u,o)&&(u=f);if(t.get(u,o)===0)o++;else{t.swapRows(n,u);let f=t.get(n,o);for(let g=o;g<t.columns;g++)t.set(n,g,t.get(n,g)/f);for(let g=n+1;g<t.rows;g++){let a=t.get(g,o)/t.get(n,o);t.set(g,o,0);for(let b=o+1;b<t.columns;b++)t.set(g,b,t.get(g,b)-t.get(n,b)*a)}n++,o++}}return t}reducedEchelonForm(){let t=this.echelonForm(),n=t.columns,o=t.rows,u=o-1;for(;u>=0;)if(t.maxRow(u)===0)u--;else{let f=0,g=!1;for(;f<o&&g===!1;)t.get(u,f)===1?g=!0:f++;for(let a=0;a<u;a++){let b=t.get(a,f);for(let T=f;T<n;T++){let C=t.get(a,T)-b*t.get(u,T);t.set(a,T,C)}}u--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:n=1,columns:o=1}=t;if(!Number.isInteger(n)||n<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(o)||o<=0)throw new TypeError("columns must be a positive integer");let u=new Matrix$2(this.rows*n,this.columns*o);for(let f=0;f<n;f++)for(let g=0;g<o;g++)u.setSubMatrix(this,this.rows*f,this.columns*g);return u}fill(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let n=[];for(let o=0;o<this.columns;o++)n.push(this.get(t,o));return n}getRowVector(t){return Matrix$2.rowVector(this.getRow(t))}setRow(t,n){checkRowIndex(this,t),n=checkRowVector(this,n);for(let o=0;o<this.columns;o++)this.set(t,o,n[o]);return this}swapRows(t,n){checkRowIndex(this,t),checkRowIndex(this,n);for(let o=0;o<this.columns;o++){let u=this.get(t,o);this.set(t,o,this.get(n,o)),this.set(n,o,u)}return this}getColumn(t){checkColumnIndex(this,t);let n=[];for(let o=0;o<this.rows;o++)n.push(this.get(o,t));return n}getColumnVector(t){return Matrix$2.columnVector(this.getColumn(t))}setColumn(t,n){checkColumnIndex(this,t),n=checkColumnVector(this,n);for(let o=0;o<this.rows;o++)this.set(o,t,n[o]);return this}swapColumns(t,n){checkColumnIndex(this,t),checkColumnIndex(this,n);for(let o=0;o<this.rows;o++){let u=this.get(o,t);this.set(o,t,this.get(o,n)),this.set(o,n,u)}return this}addRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t[o]);return this}subRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t[o]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t[o]);return this}divRowVector(t){t=checkRowVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t[o]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t[n]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t[n]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t[n]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t[n]);return this}mulRow(t,n){checkRowIndex(this,t);for(let o=0;o<this.columns;o++)this.set(t,o,this.get(t,o)*n);return this}mulColumn(t,n){checkColumnIndex(this,t);for(let o=0;o<this.rows;o++)this.set(o,t,this.get(o,t)*n);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const n=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)>n[o]&&(n[o]=this.get(o,u));return n}case"column":{const n=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)>n[u]&&(n[u]=this.get(o,u));return n}case void 0:{let n=this.get(0,0);for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)>n&&(n=this.get(o,u));return n}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),n=[0,0];for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)>t&&(t=this.get(o,u),n[0]=o,n[1]=u);return n}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const n=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)<n[o]&&(n[o]=this.get(o,u));return n}case"column":{const n=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)<n[u]&&(n[u]=this.get(o,u));return n}case void 0:{let n=this.get(0,0);for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)<n&&(n=this.get(o,u));return n}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),n=[0,0];for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)this.get(o,u)<t&&(t=this.get(o,u),n[0]=o,n[1]=u);return n}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let n=this.get(t,0);for(let o=1;o<this.columns;o++)this.get(t,o)>n&&(n=this.get(t,o));return n}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let n=this.get(t,0),o=[t,0];for(let u=1;u<this.columns;u++)this.get(t,u)>n&&(n=this.get(t,u),o[1]=u);return o}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let n=this.get(t,0);for(let o=1;o<this.columns;o++)this.get(t,o)<n&&(n=this.get(t,o));return n}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let n=this.get(t,0),o=[t,0];for(let u=1;u<this.columns;u++)this.get(t,u)<n&&(n=this.get(t,u),o[1]=u);return o}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let n=this.get(0,t);for(let o=1;o<this.rows;o++)this.get(o,t)>n&&(n=this.get(o,t));return n}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let n=this.get(0,t),o=[0,t];for(let u=1;u<this.rows;u++)this.get(u,t)>n&&(n=this.get(u,t),o[0]=u);return o}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let n=this.get(0,t);for(let o=1;o<this.rows;o++)this.get(o,t)<n&&(n=this.get(o,t));return n}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let n=this.get(0,t),o=[0,t];for(let u=1;u<this.rows;u++)this.get(u,t)<n&&(n=this.get(u,t),o[0]=u);return o}diag(){let t=Math.min(this.rows,this.columns),n=[];for(let o=0;o<t;o++)n.push(this.get(o,o));return n}norm(t="frobenius"){let n=0;if(t==="max")return this.max();if(t==="frobenius"){for(let o=0;o<this.rows;o++)for(let u=0;u<this.columns;u++)n=n+this.get(o,u)*this.get(o,u);return Math.sqrt(n)}else throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)t+=this.get(n,o),this.set(n,o,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let n=this.to1DArray();if(n.length!==t.length)throw new RangeError("vectors do not have the same size");let o=0;for(let u=0;u<n.length;u++)o+=n[u]*t[u];return o}mmul(t){t=Matrix$2.checkMatrix(t);let n=this.rows,o=this.columns,u=t.columns,f=new Matrix$2(n,u),g=new Float64Array(o);for(let a=0;a<u;a++){for(let b=0;b<o;b++)g[b]=t.get(b,a);for(let b=0;b<n;b++){let T=0;for(let C=0;C<o;C++)T+=this.get(b,C)*g[C];f.set(b,a,T)}}return f}strassen2x2(t){t=Matrix$2.checkMatrix(t);let n=new Matrix$2(2,2);const o=this.get(0,0),u=t.get(0,0),f=this.get(0,1),g=t.get(0,1),a=this.get(1,0),b=t.get(1,0),T=this.get(1,1),C=t.get(1,1),L=(o+T)*(u+C),N=(a+T)*u,F=o*(g-C),H=T*(b-u),se=(o+f)*C,ce=(a-o)*(u+g),X=(f-T)*(b+C),ye=L+H-se+X,oe=F+se,le=N+H,ue=L-N+F+ce;return n.set(0,0,ye),n.set(0,1,oe),n.set(1,0,le),n.set(1,1,ue),n}strassen3x3(t){t=Matrix$2.checkMatrix(t);let n=new Matrix$2(3,3);const o=this.get(0,0),u=this.get(0,1),f=this.get(0,2),g=this.get(1,0),a=this.get(1,1),b=this.get(1,2),T=this.get(2,0),C=this.get(2,1),L=this.get(2,2),N=t.get(0,0),F=t.get(0,1),H=t.get(0,2),se=t.get(1,0),ce=t.get(1,1),X=t.get(1,2),ye=t.get(2,0),oe=t.get(2,1),le=t.get(2,2),ue=(o+u+f-g-a-C-L)*ce,Re=(o-g)*(-F+ce),ze=a*(-N+F+se-ce-X-ye+le),ve=(-o+g+a)*(N-F+ce),be=(g+a)*(-N+F),de=o*N,Te=(-o+T+C)*(N-H+X),Ge=(-o+T)*(H-X),Ke=(T+C)*(-N+H),St=(o+u+f-a-b-T-C)*X,xt=C*(-N+H+se-ce-X-ye+oe),Lr=(-f+C+L)*(ce+ye-oe),Nr=(f-L)*(ce-oe),Sr=f*ye,Gr=(C+L)*(-ye+oe),_t=(-f+a+b)*(X+ye-le),Kt=(f-b)*(X-le),mr=(a+b)*(-ye+le),Yt=u*se,er=b*oe,lr=g*H,ar=T*F,dr=L*le,ii=de+Sr+Yt,nr=ue+ve+be+de+Lr+Sr+Gr,at=de+Te+Ke+St+Sr+_t+mr,bi=Re+ze+ve+de+Sr+_t+Kt,Br=Re+ve+be+de+er,Xr=Sr+_t+Kt+mr+lr,cr=de+Te+Ge+xt+Lr+Nr+Sr,ur=Lr+Nr+Sr+Gr+ar,yi=de+Te+Ge+Ke+dr;return n.set(0,0,ii),n.set(0,1,nr),n.set(0,2,at),n.set(1,0,bi),n.set(1,1,Br),n.set(1,2,Xr),n.set(2,0,cr),n.set(2,1,ur),n.set(2,2,yi),n}mmulStrassen(t){t=Matrix$2.checkMatrix(t);let n=this.clone(),o=n.rows,u=n.columns,f=t.rows,g=t.columns;u!==f&&console.warn(`Multiplying ${o} x ${u} and ${f} x ${g} matrix: dimensions do not match.`);function a(L,N,F){let H=L.rows,se=L.columns;if(H===N&&se===F)return L;{let ce=AbstractMatrix.zeros(N,F);return ce=ce.setSubMatrix(L,0,0),ce}}let b=Math.max(o,f),T=Math.max(u,g);n=a(n,b,T),t=a(t,b,T);function C(L,N,F,H){if(F<=512||H<=512)return L.mmul(N);F%2===1&&H%2===1?(L=a(L,F+1,H+1),N=a(N,F+1,H+1)):F%2===1?(L=a(L,F+1,H),N=a(N,F+1,H)):H%2===1&&(L=a(L,F,H+1),N=a(N,F,H+1));let se=parseInt(L.rows/2,10),ce=parseInt(L.columns/2,10),X=L.subMatrix(0,se-1,0,ce-1),ye=N.subMatrix(0,se-1,0,ce-1),oe=L.subMatrix(0,se-1,ce,L.columns-1),le=N.subMatrix(0,se-1,ce,N.columns-1),ue=L.subMatrix(se,L.rows-1,0,ce-1),Re=N.subMatrix(se,N.rows-1,0,ce-1),ze=L.subMatrix(se,L.rows-1,ce,L.columns-1),ve=N.subMatrix(se,N.rows-1,ce,N.columns-1),be=C(AbstractMatrix.add(X,ze),AbstractMatrix.add(ye,ve),se,ce),de=C(AbstractMatrix.add(ue,ze),ye,se,ce),Te=C(X,AbstractMatrix.sub(le,ve),se,ce),Ge=C(ze,AbstractMatrix.sub(Re,ye),se,ce),Ke=C(AbstractMatrix.add(X,oe),ve,se,ce),St=C(AbstractMatrix.sub(ue,X),AbstractMatrix.add(ye,le),se,ce),xt=C(AbstractMatrix.sub(oe,ze),AbstractMatrix.add(Re,ve),se,ce),Lr=AbstractMatrix.add(be,Ge);Lr.sub(Ke),Lr.add(xt);let Nr=AbstractMatrix.add(Te,Ke),Sr=AbstractMatrix.add(de,Ge),Gr=AbstractMatrix.sub(be,de);Gr.add(Te),Gr.add(St);let _t=AbstractMatrix.zeros(2*Lr.rows,2*Lr.columns);return _t=_t.setSubMatrix(Lr,0,0),_t=_t.setSubMatrix(Nr,Lr.rows,0),_t=_t.setSubMatrix(Sr,0,Lr.columns),_t=_t.setSubMatrix(Gr,Lr.rows,Lr.columns),_t.subMatrix(0,F-1,0,H-1)}return C(n,t,b,T)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:o=1}=t;if(!Number.isFinite(n))throw new TypeError("min must be a number");if(!Number.isFinite(o))throw new TypeError("max must be a number");if(n>=o)throw new RangeError("min must be smaller than max");let u=new Matrix$2(this.rows,this.columns);for(let f=0;f<this.rows;f++){const g=this.getRow(f);g.length>0&&rescale(g,{min:n,max:o,output:g}),u.setRow(f,g)}return u}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:o=1}=t;if(!Number.isFinite(n))throw new TypeError("min must be a number");if(!Number.isFinite(o))throw new TypeError("max must be a number");if(n>=o)throw new RangeError("min must be smaller than max");let u=new Matrix$2(this.rows,this.columns);for(let f=0;f<this.columns;f++){const g=this.getColumn(f);g.length&&rescale(g,{min:n,max:o,output:g}),u.setColumn(f,g)}return u}flipRows(){const t=Math.ceil(this.columns/2);for(let n=0;n<this.rows;n++)for(let o=0;o<t;o++){let u=this.get(n,o),f=this.get(n,this.columns-1-o);this.set(n,o,f),this.set(n,this.columns-1-o,u)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let n=0;n<this.columns;n++)for(let o=0;o<t;o++){let u=this.get(o,n),f=this.get(this.rows-1-o,n);this.set(o,n,f),this.set(this.rows-1-o,n,u)}return this}kroneckerProduct(t){t=Matrix$2.checkMatrix(t);let n=this.rows,o=this.columns,u=t.rows,f=t.columns,g=new Matrix$2(n*u,o*f);for(let a=0;a<n;a++)for(let b=0;b<o;b++)for(let T=0;T<u;T++)for(let C=0;C<f;C++)g.set(u*a+T,f*b+C,this.get(a,b)*t.get(T,C));return g}kroneckerSum(t){if(t=Matrix$2.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let n=this.rows,o=t.rows,u=this.kroneckerProduct(Matrix$2.eye(o,o)),f=Matrix$2.eye(n,n).kroneckerProduct(t);return u.add(f)}transpose(){let t=new Matrix$2(this.columns,this.rows);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)t.set(o,n,this.get(n,o));return t}sortRows(t=compareNumbers){for(let n=0;n<this.rows;n++)this.setRow(n,this.getRow(n).sort(t));return this}sortColumns(t=compareNumbers){for(let n=0;n<this.columns;n++)this.setColumn(n,this.getColumn(n).sort(t));return this}subMatrix(t,n,o,u){checkRange(this,t,n,o,u);let f=new Matrix$2(n-t+1,u-o+1);for(let g=t;g<=n;g++)for(let a=o;a<=u;a++)f.set(g-t,a-o,this.get(g,a));return f}subMatrixRow(t,n,o){if(n===void 0&&(n=0),o===void 0&&(o=this.columns-1),n>o||n<0||n>=this.columns||o<0||o>=this.columns)throw new RangeError("Argument out of range");let u=new Matrix$2(t.length,o-n+1);for(let f=0;f<t.length;f++)for(let g=n;g<=o;g++){if(t[f]<0||t[f]>=this.rows)throw new RangeError(`Row index out of range: ${t[f]}`);u.set(f,g-n,this.get(t[f],g))}return u}subMatrixColumn(t,n,o){if(n===void 0&&(n=0),o===void 0&&(o=this.rows-1),n>o||n<0||n>=this.rows||o<0||o>=this.rows)throw new RangeError("Argument out of range");let u=new Matrix$2(o-n+1,t.length);for(let f=0;f<t.length;f++)for(let g=n;g<=o;g++){if(t[f]<0||t[f]>=this.columns)throw new RangeError(`Column index out of range: ${t[f]}`);u.set(g-n,f,this.get(g,t[f]))}return u}setSubMatrix(t,n,o){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return this;let u=n+t.rows-1,f=o+t.columns-1;checkRange(this,n,u,o,f);for(let g=0;g<t.rows;g++)for(let a=0;a<t.columns;a++)this.set(n+g,o+a,t.get(g,a));return this}selection(t,n){checkRowIndices(this,t),checkColumnIndices(this,n);let o=new Matrix$2(t.length,n.length);for(let u=0;u<t.length;u++){let f=t[u];for(let g=0;g<n.length;g++){let a=n[g];o.set(u,g,this.get(f,a))}}return o}trace(){let t=Math.min(this.rows,this.columns),n=0;for(let o=0;o<t;o++)n+=this.get(o,o);return n}clone(){let t=new Matrix$2(this.rows,this.columns);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)t.set(n,o,this.get(n,o));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const n=this.sum(t);switch(t){case"row":{for(let o=0;o<this.rows;o++)n[o]/=this.columns;return n}case"column":{for(let o=0;o<this.columns;o++)n[o]/=this.rows;return n}case void 0:return n/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,n={}){if(typeof t=="object"&&(n=t,t=void 0),typeof n!="object")throw new TypeError("options must be an object");const{unbiased:o=!0,mean:u=this.mean(t)}=n;if(typeof o!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray(u))throw new TypeError("mean must be an array");return varianceByRow(this,o,u)}case"column":{if(!isAnyArray(u))throw new TypeError("mean must be an array");return varianceByColumn(this,o,u)}case void 0:{if(typeof u!="number")throw new TypeError("mean must be a number");return varianceAll(this,o,u)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,n){typeof t=="object"&&(n=t,t=void 0);const o=this.variance(t,n);if(t===void 0)return Math.sqrt(o);for(let u=0;u<o.length;u++)o[u]=Math.sqrt(o[u]);return o}center(t,n={}){if(typeof t=="object"&&(n=t,t=void 0),typeof n!="object")throw new TypeError("options must be an object");const{center:o=this.mean(t)}=n;switch(t){case"row":{if(!isAnyArray(o))throw new TypeError("center must be an array");return centerByRow(this,o),this}case"column":{if(!isAnyArray(o))throw new TypeError("center must be an array");return centerByColumn(this,o),this}case void 0:{if(typeof o!="number")throw new TypeError("center must be a number");return centerAll(this,o),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,n={}){if(typeof t=="object"&&(n=t,t=void 0),typeof n!="object")throw new TypeError("options must be an object");let o=n.scale;switch(t){case"row":{if(o===void 0)o=getScaleByRow(this);else if(!isAnyArray(o))throw new TypeError("scale must be an array");return scaleByRow(this,o),this}case"column":{if(o===void 0)o=getScaleByColumn(this);else if(!isAnyArray(o))throw new TypeError("scale must be an array");return scaleByColumn(this,o),this}case void 0:{if(o===void 0)o=getScaleAll(this);else if(typeof o!="number")throw new TypeError("scale must be a number");return scaleAll(this,o),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(e,t){return e-t}function isArrayOfNumbers(e){return e.every(t=>typeof t=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix$2 extends AbstractMatrix{constructor(t,n){if(super(),Matrix$2.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0)if(this.data=[],Number.isInteger(n)&&n>=0)for(let o=0;o<t;o++)this.data.push(new Float64Array(n));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(t)){const o=t;if(t=o.length,n=t?o[0].length:0,typeof n!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let u=0;u<t;u++){if(o[u].length!==n)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(o[u]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(o[u]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=t,this.columns=n}set(t,n,o){return this.data[t][n]=o,this}get(t,n){return this.data[t][n]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,n){return n===void 0&&(n=t,t=this.rows),checkRowIndex(this,t,!0),n=Float64Array.from(checkRowVector(this,n)),this.data.splice(t,0,n),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let n=0;n<this.rows;n++){const o=new Float64Array(this.columns-1);for(let u=0;u<t;u++)o[u]=this.data[n][u];for(let u=t+1;u<this.columns;u++)o[u-1]=this.data[n][u];this.data[n]=o}return this.columns-=1,this}addColumn(t,n){typeof n>"u"&&(n=t,t=this.columns),checkColumnIndex(this,t,!0),n=checkColumnVector(this,n);for(let o=0;o<this.rows;o++){const u=new Float64Array(this.columns+1);let f=0;for(;f<t;f++)u[f]=this.data[o][f];for(u[f++]=n[o];f<this.columns+1;f++)u[f]=this.data[o][f-1];this.data[o]=u}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(t,n,o){super(),this.matrix=t,this.rows=n,this.columns=o}}class MatrixColumnView extends BaseView{constructor(t,n){checkColumnIndex(t,n),super(t,t.rows,1),this.column=n}set(t,n,o){return this.matrix.set(t,this.column,o),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,n){checkColumnIndices(t,n),super(t,t.rows,n.length),this.columnIndices=n}set(t,n,o){return this.matrix.set(t,this.columnIndices[n],o),this}get(t,n){return this.matrix.get(t,this.columnIndices[n])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,n,o){return this.matrix.set(t,this.columns-n-1,o),this}get(t,n){return this.matrix.get(t,this.columns-n-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,n,o){return this.matrix.set(this.rows-t-1,n,o),this}get(t,n){return this.matrix.get(this.rows-t-1,n)}}class MatrixRowView extends BaseView{constructor(t,n){checkRowIndex(t,n),super(t,1,t.columns),this.row=n}set(t,n,o){return this.matrix.set(this.row,n,o),this}get(t,n){return this.matrix.get(this.row,n)}}class MatrixRowSelectionView extends BaseView{constructor(t,n){checkRowIndices(t,n),super(t,n.length,t.columns),this.rowIndices=n}set(t,n,o){return this.matrix.set(this.rowIndices[t],n,o),this}get(t,n){return this.matrix.get(this.rowIndices[t],n)}}class MatrixSelectionView extends BaseView{constructor(t,n,o){checkRowIndices(t,n),checkColumnIndices(t,o),super(t,n.length,o.length),this.rowIndices=n,this.columnIndices=o}set(t,n,o){return this.matrix.set(this.rowIndices[t],this.columnIndices[n],o),this}get(t,n){return this.matrix.get(this.rowIndices[t],this.columnIndices[n])}}class MatrixSubView extends BaseView{constructor(t,n,o,u,f){checkRange(t,n,o,u,f),super(t,o-n+1,f-u+1),this.startRow=n,this.startColumn=u}set(t,n,o){return this.matrix.set(this.startRow+t,this.startColumn+n,o),this}get(t,n){return this.matrix.get(this.startRow+t,this.startColumn+n)}}class MatrixTransposeView$1 extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,n,o){return this.matrix.set(n,t,o),this}get(t,n){return this.matrix.get(n,t)}}class WrapperMatrix1D extends AbstractMatrix{constructor(t,n={}){const{rows:o=1}=n;if(t.length%o!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=o,this.columns=t.length/o,this.data=t}set(t,n,o){let u=this._calculateIndex(t,n);return this.data[u]=o,this}get(t,n){let o=this._calculateIndex(t,n);return this.data[o]}_calculateIndex(t,n){return t*this.columns+n}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,n,o){return this.data[t][n]=o,this}get(t,n){return this.data[t][n]}}function wrap(e,t){if(isAnyArray(e))return e[0]&&isAnyArray(e[0])?new WrapperMatrix2D(e):new WrapperMatrix1D(e,t);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let n=t.clone(),o=n.rows,u=n.columns,f=new Float64Array(o),g=1,a,b,T,C,L,N,F,H,se;for(a=0;a<o;a++)f[a]=a;for(H=new Float64Array(o),b=0;b<u;b++){for(a=0;a<o;a++)H[a]=n.get(a,b);for(a=0;a<o;a++){for(se=Math.min(a,b),L=0,T=0;T<se;T++)L+=n.get(a,T)*H[T];H[a]-=L,n.set(a,b,H[a])}for(C=b,a=b+1;a<o;a++)Math.abs(H[a])>Math.abs(H[C])&&(C=a);if(C!==b){for(T=0;T<u;T++)N=n.get(C,T),n.set(C,T,n.get(b,T)),n.set(b,T,N);F=f[C],f[C]=f[b],f[b]=F,g=-g}if(b<o&&n.get(b,b)!==0)for(a=b+1;a<o;a++)n.set(a,b,n.get(a,b)/n.get(b,b))}this.LU=n,this.pivotVector=f,this.pivotSign=g}isSingular(){let t=this.LU,n=t.columns;for(let o=0;o<n;o++)if(t.get(o,o)===0)return!0;return!1}solve(t){t=Matrix$2.checkMatrix(t);let n=this.LU;if(n.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let u=t.columns,f=t.subMatrixRow(this.pivotVector,0,u-1),g=n.columns,a,b,T;for(T=0;T<g;T++)for(a=T+1;a<g;a++)for(b=0;b<u;b++)f.set(a,b,f.get(a,b)-f.get(T,b)*n.get(a,T));for(T=g-1;T>=0;T--){for(b=0;b<u;b++)f.set(T,b,f.get(T,b)/n.get(T,T));for(a=0;a<T;a++)for(b=0;b<u;b++)f.set(a,b,f.get(a,b)-f.get(T,b)*n.get(a,T))}return f}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let n=this.pivotSign,o=t.columns;for(let u=0;u<o;u++)n*=t.get(u,u);return n}get lowerTriangularMatrix(){let t=this.LU,n=t.rows,o=t.columns,u=new Matrix$2(n,o);for(let f=0;f<n;f++)for(let g=0;g<o;g++)f>g?u.set(f,g,t.get(f,g)):f===g?u.set(f,g,1):u.set(f,g,0);return u}get upperTriangularMatrix(){let t=this.LU,n=t.rows,o=t.columns,u=new Matrix$2(n,o);for(let f=0;f<n;f++)for(let g=0;g<o;g++)f<=g?u.set(f,g,t.get(f,g)):u.set(f,g,0);return u}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(e,t){let n=0;return Math.abs(e)>Math.abs(t)?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):t!==0?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0}class QrDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let n=t.clone(),o=t.rows,u=t.columns,f=new Float64Array(u),g,a,b,T;for(b=0;b<u;b++){let C=0;for(g=b;g<o;g++)C=hypotenuse$1(C,n.get(g,b));if(C!==0){for(n.get(b,b)<0&&(C=-C),g=b;g<o;g++)n.set(g,b,n.get(g,b)/C);for(n.set(b,b,n.get(b,b)+1),a=b+1;a<u;a++){for(T=0,g=b;g<o;g++)T+=n.get(g,b)*n.get(g,a);for(T=-T/n.get(b,b),g=b;g<o;g++)n.set(g,a,n.get(g,a)+T*n.get(g,b))}}f[b]=-C}this.QR=n,this.Rdiag=f}solve(t){t=Matrix$2.checkMatrix(t);let n=this.QR,o=n.rows;if(t.rows!==o)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let u=t.columns,f=t.clone(),g=n.columns,a,b,T,C;for(T=0;T<g;T++)for(b=0;b<u;b++){for(C=0,a=T;a<o;a++)C+=n.get(a,T)*f.get(a,b);for(C=-C/n.get(T,T),a=T;a<o;a++)f.set(a,b,f.get(a,b)+C*n.get(a,T))}for(T=g-1;T>=0;T--){for(b=0;b<u;b++)f.set(T,b,f.get(T,b)/this.Rdiag[T]);for(a=0;a<T;a++)for(b=0;b<u;b++)f.set(a,b,f.get(a,b)-f.get(T,b)*n.get(a,T))}return f.subMatrix(0,g-1,0,u-1)}isFullRank(){let t=this.QR.columns;for(let n=0;n<t;n++)if(this.Rdiag[n]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,n=t.columns,o=new Matrix$2(n,n),u,f;for(u=0;u<n;u++)for(f=0;f<n;f++)u<f?o.set(u,f,t.get(u,f)):u===f?o.set(u,f,this.Rdiag[u]):o.set(u,f,0);return o}get orthogonalMatrix(){let t=this.QR,n=t.rows,o=t.columns,u=new Matrix$2(n,o),f,g,a,b;for(a=o-1;a>=0;a--){for(f=0;f<n;f++)u.set(f,a,0);for(u.set(a,a,1),g=a;g<o;g++)if(t.get(a,a)!==0){for(b=0,f=a;f<n;f++)b+=t.get(f,a)*u.get(f,g);for(b=-b/t.get(a,a),f=a;f<n;f++)u.set(f,g,u.get(f,g)+b*t.get(f,a))}}return u}}class SingularValueDecomposition{constructor(t,n={}){if(t=WrapperMatrix2D.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let o=t.rows,u=t.columns;const{computeLeftSingularVectors:f=!0,computeRightSingularVectors:g=!0,autoTranspose:a=!1}=n;let b=Boolean(f),T=Boolean(g),C=!1,L;if(o<u)if(!a)L=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{L=t.transpose(),o=L.rows,u=L.columns,C=!0;let de=b;b=T,T=de}else L=t.clone();let N=Math.min(o,u),F=Math.min(o+1,u),H=new Float64Array(F),se=new Matrix$2(o,N),ce=new Matrix$2(u,u),X=new Float64Array(u),ye=new Float64Array(o),oe=new Float64Array(F);for(let de=0;de<F;de++)oe[de]=de;let le=Math.min(o-1,u),ue=Math.max(0,Math.min(u-2,o)),Re=Math.max(le,ue);for(let de=0;de<Re;de++){if(de<le){H[de]=0;for(let Te=de;Te<o;Te++)H[de]=hypotenuse$1(H[de],L.get(Te,de));if(H[de]!==0){L.get(de,de)<0&&(H[de]=-H[de]);for(let Te=de;Te<o;Te++)L.set(Te,de,L.get(Te,de)/H[de]);L.set(de,de,L.get(de,de)+1)}H[de]=-H[de]}for(let Te=de+1;Te<u;Te++){if(de<le&&H[de]!==0){let Ge=0;for(let Ke=de;Ke<o;Ke++)Ge+=L.get(Ke,de)*L.get(Ke,Te);Ge=-Ge/L.get(de,de);for(let Ke=de;Ke<o;Ke++)L.set(Ke,Te,L.get(Ke,Te)+Ge*L.get(Ke,de))}X[Te]=L.get(de,Te)}if(b&&de<le)for(let Te=de;Te<o;Te++)se.set(Te,de,L.get(Te,de));if(de<ue){X[de]=0;for(let Te=de+1;Te<u;Te++)X[de]=hypotenuse$1(X[de],X[Te]);if(X[de]!==0){X[de+1]<0&&(X[de]=0-X[de]);for(let Te=de+1;Te<u;Te++)X[Te]/=X[de];X[de+1]+=1}if(X[de]=-X[de],de+1<o&&X[de]!==0){for(let Te=de+1;Te<o;Te++)ye[Te]=0;for(let Te=de+1;Te<o;Te++)for(let Ge=de+1;Ge<u;Ge++)ye[Te]+=X[Ge]*L.get(Te,Ge);for(let Te=de+1;Te<u;Te++){let Ge=-X[Te]/X[de+1];for(let Ke=de+1;Ke<o;Ke++)L.set(Ke,Te,L.get(Ke,Te)+Ge*ye[Ke])}}if(T)for(let Te=de+1;Te<u;Te++)ce.set(Te,de,X[Te])}}let ze=Math.min(u,o+1);if(le<u&&(H[le]=L.get(le,le)),o<ze&&(H[ze-1]=0),ue+1<ze&&(X[ue]=L.get(ue,ze-1)),X[ze-1]=0,b){for(let de=le;de<N;de++){for(let Te=0;Te<o;Te++)se.set(Te,de,0);se.set(de,de,1)}for(let de=le-1;de>=0;de--)if(H[de]!==0){for(let Te=de+1;Te<N;Te++){let Ge=0;for(let Ke=de;Ke<o;Ke++)Ge+=se.get(Ke,de)*se.get(Ke,Te);Ge=-Ge/se.get(de,de);for(let Ke=de;Ke<o;Ke++)se.set(Ke,Te,se.get(Ke,Te)+Ge*se.get(Ke,de))}for(let Te=de;Te<o;Te++)se.set(Te,de,-se.get(Te,de));se.set(de,de,1+se.get(de,de));for(let Te=0;Te<de-1;Te++)se.set(Te,de,0)}else{for(let Te=0;Te<o;Te++)se.set(Te,de,0);se.set(de,de,1)}}if(T)for(let de=u-1;de>=0;de--){if(de<ue&&X[de]!==0)for(let Te=de+1;Te<u;Te++){let Ge=0;for(let Ke=de+1;Ke<u;Ke++)Ge+=ce.get(Ke,de)*ce.get(Ke,Te);Ge=-Ge/ce.get(de+1,de);for(let Ke=de+1;Ke<u;Ke++)ce.set(Ke,Te,ce.get(Ke,Te)+Ge*ce.get(Ke,de))}for(let Te=0;Te<u;Te++)ce.set(Te,de,0);ce.set(de,de,1)}let ve=ze-1,be=Number.EPSILON;for(;ze>0;){let de,Te;for(de=ze-2;de>=-1&&de!==-1;de--){const Ge=Number.MIN_VALUE+be*Math.abs(H[de]+Math.abs(H[de+1]));if(Math.abs(X[de])<=Ge||Number.isNaN(X[de])){X[de]=0;break}}if(de===ze-2)Te=4;else{let Ge;for(Ge=ze-1;Ge>=de&&Ge!==de;Ge--){let Ke=(Ge!==ze?Math.abs(X[Ge]):0)+(Ge!==de+1?Math.abs(X[Ge-1]):0);if(Math.abs(H[Ge])<=be*Ke){H[Ge]=0;break}}Ge===de?Te=3:Ge===ze-1?Te=1:(Te=2,de=Ge)}switch(de++,Te){case 1:{let Ge=X[ze-2];X[ze-2]=0;for(let Ke=ze-2;Ke>=de;Ke--){let St=hypotenuse$1(H[Ke],Ge),xt=H[Ke]/St,Lr=Ge/St;if(H[Ke]=St,Ke!==de&&(Ge=-Lr*X[Ke-1],X[Ke-1]=xt*X[Ke-1]),T)for(let Nr=0;Nr<u;Nr++)St=xt*ce.get(Nr,Ke)+Lr*ce.get(Nr,ze-1),ce.set(Nr,ze-1,-Lr*ce.get(Nr,Ke)+xt*ce.get(Nr,ze-1)),ce.set(Nr,Ke,St)}break}case 2:{let Ge=X[de-1];X[de-1]=0;for(let Ke=de;Ke<ze;Ke++){let St=hypotenuse$1(H[Ke],Ge),xt=H[Ke]/St,Lr=Ge/St;if(H[Ke]=St,Ge=-Lr*X[Ke],X[Ke]=xt*X[Ke],b)for(let Nr=0;Nr<o;Nr++)St=xt*se.get(Nr,Ke)+Lr*se.get(Nr,de-1),se.set(Nr,de-1,-Lr*se.get(Nr,Ke)+xt*se.get(Nr,de-1)),se.set(Nr,Ke,St)}break}case 3:{const Ge=Math.max(Math.abs(H[ze-1]),Math.abs(H[ze-2]),Math.abs(X[ze-2]),Math.abs(H[de]),Math.abs(X[de])),Ke=H[ze-1]/Ge,St=H[ze-2]/Ge,xt=X[ze-2]/Ge,Lr=H[de]/Ge,Nr=X[de]/Ge,Sr=((St+Ke)*(St-Ke)+xt*xt)/2,Gr=Ke*xt*(Ke*xt);let _t=0;(Sr!==0||Gr!==0)&&(Sr<0?_t=0-Math.sqrt(Sr*Sr+Gr):_t=Math.sqrt(Sr*Sr+Gr),_t=Gr/(Sr+_t));let Kt=(Lr+Ke)*(Lr-Ke)+_t,mr=Lr*Nr;for(let Yt=de;Yt<ze-1;Yt++){let er=hypotenuse$1(Kt,mr);er===0&&(er=Number.MIN_VALUE);let lr=Kt/er,ar=mr/er;if(Yt!==de&&(X[Yt-1]=er),Kt=lr*H[Yt]+ar*X[Yt],X[Yt]=lr*X[Yt]-ar*H[Yt],mr=ar*H[Yt+1],H[Yt+1]=lr*H[Yt+1],T)for(let dr=0;dr<u;dr++)er=lr*ce.get(dr,Yt)+ar*ce.get(dr,Yt+1),ce.set(dr,Yt+1,-ar*ce.get(dr,Yt)+lr*ce.get(dr,Yt+1)),ce.set(dr,Yt,er);if(er=hypotenuse$1(Kt,mr),er===0&&(er=Number.MIN_VALUE),lr=Kt/er,ar=mr/er,H[Yt]=er,Kt=lr*X[Yt]+ar*H[Yt+1],H[Yt+1]=-ar*X[Yt]+lr*H[Yt+1],mr=ar*X[Yt+1],X[Yt+1]=lr*X[Yt+1],b&&Yt<o-1)for(let dr=0;dr<o;dr++)er=lr*se.get(dr,Yt)+ar*se.get(dr,Yt+1),se.set(dr,Yt+1,-ar*se.get(dr,Yt)+lr*se.get(dr,Yt+1)),se.set(dr,Yt,er)}X[ze-2]=Kt;break}case 4:{if(H[de]<=0&&(H[de]=H[de]<0?-H[de]:0,T))for(let Ge=0;Ge<=ve;Ge++)ce.set(Ge,de,-ce.get(Ge,de));for(;de<ve&&!(H[de]>=H[de+1]);){let Ge=H[de];if(H[de]=H[de+1],H[de+1]=Ge,T&&de<u-1)for(let Ke=0;Ke<u;Ke++)Ge=ce.get(Ke,de+1),ce.set(Ke,de+1,ce.get(Ke,de)),ce.set(Ke,de,Ge);if(b&&de<o-1)for(let Ke=0;Ke<o;Ke++)Ge=se.get(Ke,de+1),se.set(Ke,de+1,se.get(Ke,de)),se.set(Ke,de,Ge);de++}ze--;break}}}if(C){let de=ce;ce=se,se=de}this.m=o,this.n=u,this.s=H,this.U=se,this.V=ce}solve(t){let n=t,o=this.threshold,u=this.s.length,f=Matrix$2.zeros(u,u);for(let N=0;N<u;N++)Math.abs(this.s[N])<=o?f.set(N,N,0):f.set(N,N,1/this.s[N]);let g=this.U,a=this.rightSingularVectors,b=a.mmul(f),T=a.rows,C=g.rows,L=Matrix$2.zeros(T,C);for(let N=0;N<T;N++)for(let F=0;F<C;F++){let H=0;for(let se=0;se<u;se++)H+=b.get(N,se)*g.get(F,se);L.set(N,F,H)}return L.mmul(n)}solveForDiagonal(t){return this.solve(Matrix$2.diag(t))}inverse(){let t=this.V,n=this.threshold,o=t.rows,u=t.columns,f=new Matrix$2(o,this.s.length);for(let C=0;C<o;C++)for(let L=0;L<u;L++)Math.abs(this.s[L])>n&&f.set(C,L,t.get(C,L)/this.s[L]);let g=this.U,a=g.rows,b=g.columns,T=new Matrix$2(o,a);for(let C=0;C<o;C++)for(let L=0;L<a;L++){let N=0;for(let F=0;F<b;F++)N+=f.get(C,F)*g.get(L,F);T.set(C,L,N)}return T}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,n=0,o=this.s;for(let u=0,f=o.length;u<f;u++)o[u]>t&&n++;return n}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(e,t=!1){return e=WrapperMatrix2D.checkMatrix(e),t?new SingularValueDecomposition(e).inverse():solve(e,Matrix$2.eye(e.rows))}function solve(e,t,n=!1){return e=WrapperMatrix2D.checkMatrix(e),t=WrapperMatrix2D.checkMatrix(t),n?new SingularValueDecomposition(e).solve(t):e.isSquare()?new LuDecomposition(e).solve(t):new QrDecomposition(e).solve(t)}function determinant(e){if(e=Matrix$2.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let t,n,o,u;if(e.columns===2)return t=e.get(0,0),n=e.get(0,1),o=e.get(1,0),u=e.get(1,1),t*u-n*o;if(e.columns===3){let f,g,a;return f=new MatrixSelectionView(e,[1,2],[1,2]),g=new MatrixSelectionView(e,[1,2],[0,2]),a=new MatrixSelectionView(e,[1,2],[0,1]),t=e.get(0,0),n=e.get(0,1),o=e.get(0,2),t*determinant(f)-n*determinant(g)+o*determinant(a)}else return new LuDecomposition(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(e,t){let n=[];for(let o=0;o<e;o++)o!==t&&n.push(o);return n}function dependenciesOneRow(e,t,n,o=1e-9,u=1e-9){if(e>u)return new Array(t.rows+1).fill(0);{let f=t.addRow(n,[0]);for(let g=0;g<f.rows;g++)Math.abs(f.get(g,0))<o&&f.set(g,0,0);return f.to1DArray()}}function linearDependencies(e,t={}){const{thresholdValue:n=1e-9,thresholdError:o=1e-9}=t;e=Matrix$2.checkMatrix(e);let u=e.rows,f=new Matrix$2(u,u);for(let g=0;g<u;g++){let a=Matrix$2.columnVector(e.getRow(g)),b=e.subMatrixRow(xrange(u,g)).transpose(),C=new SingularValueDecomposition(b).solve(a),L=Matrix$2.sub(a,b.mmul(C)).abs().max();f.setRow(g,dependenciesOneRow(L,C,g,n,o))}return f}function pseudoInverse(e,t=Number.EPSILON){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return e.transpose();let n=new SingularValueDecomposition(e,{autoTranspose:!0}),o=n.leftSingularVectors,u=n.rightSingularVectors,f=n.diagonal;for(let g=0;g<f.length;g++)Math.abs(f[g])>t?f[g]=1/f[g]:f[g]=0;return u.mmul(Matrix$2.diag(f).mmul(o.transpose()))}function covariance(e,t=e,n={}){e=new Matrix$2(e);let o=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(n=t,t=e,o=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:u=!0}=n;u&&(e=e.center("column"),o||(t=t.center("column")));const f=e.transpose().mmul(t);for(let g=0;g<f.rows;g++)for(let a=0;a<f.columns;a++)f.set(g,a,f.get(g,a)*(1/(e.rows-1)));return f}function correlation(e,t=e,n={}){e=new Matrix$2(e);let o=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(n=t,t=e,o=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:u=!0,scale:f=!0}=n;u&&(e.center("column"),o||t.center("column")),f&&(e.scale("column"),o||t.scale("column"));const g=e.standardDeviation("column",{unbiased:!0}),a=o?g:t.standardDeviation("column",{unbiased:!0}),b=e.transpose().mmul(t);for(let T=0;T<b.rows;T++)for(let C=0;C<b.columns;C++)b.set(T,C,b.get(T,C)*(1/(g[T]*a[C]))*(1/(e.rows-1)));return b}class EigenvalueDecomposition{constructor(t,n={}){const{assumeSymmetric:o=!1}=n;if(t=WrapperMatrix2D.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let u=t.columns,f=new Matrix$2(u,u),g=new Float64Array(u),a=new Float64Array(u),b=t,T,C,L=!1;if(o?L=!0:L=t.isSymmetric(),L){for(T=0;T<u;T++)for(C=0;C<u;C++)f.set(T,C,b.get(T,C));tred2(u,a,g,f),tql2(u,a,g,f)}else{let N=new Matrix$2(u,u),F=new Float64Array(u);for(C=0;C<u;C++)for(T=0;T<u;T++)N.set(T,C,b.get(T,C));orthes(u,N,F,f),hqr2(u,a,g,f,N)}this.n=u,this.e=a,this.d=g,this.V=f}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,n=this.e,o=this.d,u=new Matrix$2(t,t),f,g;for(f=0;f<t;f++){for(g=0;g<t;g++)u.set(f,g,0);u.set(f,f,o[f]),n[f]>0?u.set(f,f+1,n[f]):n[f]<0&&u.set(f,f-1,n[f])}return u}}function tred2(e,t,n,o){let u,f,g,a,b,T,C,L;for(b=0;b<e;b++)n[b]=o.get(e-1,b);for(a=e-1;a>0;a--){for(L=0,g=0,T=0;T<a;T++)L=L+Math.abs(n[T]);if(L===0)for(t[a]=n[a-1],b=0;b<a;b++)n[b]=o.get(a-1,b),o.set(a,b,0),o.set(b,a,0);else{for(T=0;T<a;T++)n[T]/=L,g+=n[T]*n[T];for(u=n[a-1],f=Math.sqrt(g),u>0&&(f=-f),t[a]=L*f,g=g-u*f,n[a-1]=u-f,b=0;b<a;b++)t[b]=0;for(b=0;b<a;b++){for(u=n[b],o.set(b,a,u),f=t[b]+o.get(b,b)*u,T=b+1;T<=a-1;T++)f+=o.get(T,b)*n[T],t[T]+=o.get(T,b)*u;t[b]=f}for(u=0,b=0;b<a;b++)t[b]/=g,u+=t[b]*n[b];for(C=u/(g+g),b=0;b<a;b++)t[b]-=C*n[b];for(b=0;b<a;b++){for(u=n[b],f=t[b],T=b;T<=a-1;T++)o.set(T,b,o.get(T,b)-(u*t[T]+f*n[T]));n[b]=o.get(a-1,b),o.set(a,b,0)}}n[a]=g}for(a=0;a<e-1;a++){if(o.set(e-1,a,o.get(a,a)),o.set(a,a,1),g=n[a+1],g!==0){for(T=0;T<=a;T++)n[T]=o.get(T,a+1)/g;for(b=0;b<=a;b++){for(f=0,T=0;T<=a;T++)f+=o.get(T,a+1)*o.get(T,b);for(T=0;T<=a;T++)o.set(T,b,o.get(T,b)-f*n[T])}}for(T=0;T<=a;T++)o.set(T,a+1,0)}for(b=0;b<e;b++)n[b]=o.get(e-1,b),o.set(e-1,b,0);o.set(e-1,e-1,1),t[0]=0}function tql2(e,t,n,o){let u,f,g,a,b,T,C,L,N,F,H,se,ce,X,ye,oe;for(g=1;g<e;g++)t[g-1]=t[g];t[e-1]=0;let le=0,ue=0,Re=Number.EPSILON;for(T=0;T<e;T++){for(ue=Math.max(ue,Math.abs(n[T])+Math.abs(t[T])),C=T;C<e&&!(Math.abs(t[C])<=Re*ue);)C++;if(C>T)do{for(u=n[T],L=(n[T+1]-u)/(2*t[T]),N=hypotenuse$1(L,1),L<0&&(N=-N),n[T]=t[T]/(L+N),n[T+1]=t[T]*(L+N),F=n[T+1],f=u-n[T],g=T+2;g<e;g++)n[g]-=f;for(le=le+f,L=n[C],H=1,se=H,ce=H,X=t[T+1],ye=0,oe=0,g=C-1;g>=T;g--)for(ce=se,se=H,oe=ye,u=H*t[g],f=H*L,N=hypotenuse$1(L,t[g]),t[g+1]=ye*N,ye=t[g]/N,H=L/N,L=H*n[g]-ye*u,n[g+1]=f+ye*(H*u+ye*n[g]),b=0;b<e;b++)f=o.get(b,g+1),o.set(b,g+1,ye*o.get(b,g)+H*f),o.set(b,g,H*o.get(b,g)-ye*f);L=-ye*oe*ce*X*t[T]/F,t[T]=ye*L,n[T]=H*L}while(Math.abs(t[T])>Re*ue);n[T]=n[T]+le,t[T]=0}for(g=0;g<e-1;g++){for(b=g,L=n[g],a=g+1;a<e;a++)n[a]<L&&(b=a,L=n[a]);if(b!==g)for(n[b]=n[g],n[g]=L,a=0;a<e;a++)L=o.get(a,g),o.set(a,g,o.get(a,b)),o.set(a,b,L)}}function orthes(e,t,n,o){let u=0,f=e-1,g,a,b,T,C,L,N;for(L=u+1;L<=f-1;L++){for(N=0,T=L;T<=f;T++)N=N+Math.abs(t.get(T,L-1));if(N!==0){for(b=0,T=f;T>=L;T--)n[T]=t.get(T,L-1)/N,b+=n[T]*n[T];for(a=Math.sqrt(b),n[L]>0&&(a=-a),b=b-n[L]*a,n[L]=n[L]-a,C=L;C<e;C++){for(g=0,T=f;T>=L;T--)g+=n[T]*t.get(T,C);for(g=g/b,T=L;T<=f;T++)t.set(T,C,t.get(T,C)-g*n[T])}for(T=0;T<=f;T++){for(g=0,C=f;C>=L;C--)g+=n[C]*t.get(T,C);for(g=g/b,C=L;C<=f;C++)t.set(T,C,t.get(T,C)-g*n[C])}n[L]=N*n[L],t.set(L,L-1,N*a)}}for(T=0;T<e;T++)for(C=0;C<e;C++)o.set(T,C,T===C?1:0);for(L=f-1;L>=u+1;L--)if(t.get(L,L-1)!==0){for(T=L+1;T<=f;T++)n[T]=t.get(T,L-1);for(C=L;C<=f;C++){for(a=0,T=L;T<=f;T++)a+=n[T]*o.get(T,C);for(a=a/n[L]/t.get(L,L-1),T=L;T<=f;T++)o.set(T,C,o.get(T,C)+a*n[T])}}}function hqr2(e,t,n,o,u){let f=e-1,g=0,a=e-1,b=Number.EPSILON,T=0,C=0,L=0,N=0,F=0,H=0,se=0,ce=0,X,ye,oe,le,ue,Re,ze,ve,be,de,Te,Ge,Ke,St,xt;for(X=0;X<e;X++)for((X<g||X>a)&&(n[X]=u.get(X,X),t[X]=0),ye=Math.max(X-1,0);ye<e;ye++)C=C+Math.abs(u.get(X,ye));for(;f>=g;){for(le=f;le>g&&(H=Math.abs(u.get(le-1,le-1))+Math.abs(u.get(le,le)),H===0&&(H=C),!(Math.abs(u.get(le,le-1))<b*H));)le--;if(le===f)u.set(f,f,u.get(f,f)+T),n[f]=u.get(f,f),t[f]=0,f--,ce=0;else if(le===f-1){if(ze=u.get(f,f-1)*u.get(f-1,f),L=(u.get(f-1,f-1)-u.get(f,f))/2,N=L*L+ze,se=Math.sqrt(Math.abs(N)),u.set(f,f,u.get(f,f)+T),u.set(f-1,f-1,u.get(f-1,f-1)+T),ve=u.get(f,f),N>=0){for(se=L>=0?L+se:L-se,n[f-1]=ve+se,n[f]=n[f-1],se!==0&&(n[f]=ve-ze/se),t[f-1]=0,t[f]=0,ve=u.get(f,f-1),H=Math.abs(ve)+Math.abs(se),L=ve/H,N=se/H,F=Math.sqrt(L*L+N*N),L=L/F,N=N/F,ye=f-1;ye<e;ye++)se=u.get(f-1,ye),u.set(f-1,ye,N*se+L*u.get(f,ye)),u.set(f,ye,N*u.get(f,ye)-L*se);for(X=0;X<=f;X++)se=u.get(X,f-1),u.set(X,f-1,N*se+L*u.get(X,f)),u.set(X,f,N*u.get(X,f)-L*se);for(X=g;X<=a;X++)se=o.get(X,f-1),o.set(X,f-1,N*se+L*o.get(X,f)),o.set(X,f,N*o.get(X,f)-L*se)}else n[f-1]=ve+L,n[f]=ve+L,t[f-1]=se,t[f]=-se;f=f-2,ce=0}else{if(ve=u.get(f,f),be=0,ze=0,le<f&&(be=u.get(f-1,f-1),ze=u.get(f,f-1)*u.get(f-1,f)),ce===10){for(T+=ve,X=g;X<=f;X++)u.set(X,X,u.get(X,X)-ve);H=Math.abs(u.get(f,f-1))+Math.abs(u.get(f-1,f-2)),ve=be=.75*H,ze=-.4375*H*H}if(ce===30&&(H=(be-ve)/2,H=H*H+ze,H>0)){for(H=Math.sqrt(H),be<ve&&(H=-H),H=ve-ze/((be-ve)/2+H),X=g;X<=f;X++)u.set(X,X,u.get(X,X)-H);T+=H,ve=be=ze=.964}for(ce=ce+1,ue=f-2;ue>=le&&(se=u.get(ue,ue),F=ve-se,H=be-se,L=(F*H-ze)/u.get(ue+1,ue)+u.get(ue,ue+1),N=u.get(ue+1,ue+1)-se-F-H,F=u.get(ue+2,ue+1),H=Math.abs(L)+Math.abs(N)+Math.abs(F),L=L/H,N=N/H,F=F/H,!(ue===le||Math.abs(u.get(ue,ue-1))*(Math.abs(N)+Math.abs(F))<b*(Math.abs(L)*(Math.abs(u.get(ue-1,ue-1))+Math.abs(se)+Math.abs(u.get(ue+1,ue+1))))));)ue--;for(X=ue+2;X<=f;X++)u.set(X,X-2,0),X>ue+2&&u.set(X,X-3,0);for(oe=ue;oe<=f-1&&(St=oe!==f-1,oe!==ue&&(L=u.get(oe,oe-1),N=u.get(oe+1,oe-1),F=St?u.get(oe+2,oe-1):0,ve=Math.abs(L)+Math.abs(N)+Math.abs(F),ve!==0&&(L=L/ve,N=N/ve,F=F/ve)),ve!==0);oe++)if(H=Math.sqrt(L*L+N*N+F*F),L<0&&(H=-H),H!==0){for(oe!==ue?u.set(oe,oe-1,-H*ve):le!==ue&&u.set(oe,oe-1,-u.get(oe,oe-1)),L=L+H,ve=L/H,be=N/H,se=F/H,N=N/L,F=F/L,ye=oe;ye<e;ye++)L=u.get(oe,ye)+N*u.get(oe+1,ye),St&&(L=L+F*u.get(oe+2,ye),u.set(oe+2,ye,u.get(oe+2,ye)-L*se)),u.set(oe,ye,u.get(oe,ye)-L*ve),u.set(oe+1,ye,u.get(oe+1,ye)-L*be);for(X=0;X<=Math.min(f,oe+3);X++)L=ve*u.get(X,oe)+be*u.get(X,oe+1),St&&(L=L+se*u.get(X,oe+2),u.set(X,oe+2,u.get(X,oe+2)-L*F)),u.set(X,oe,u.get(X,oe)-L),u.set(X,oe+1,u.get(X,oe+1)-L*N);for(X=g;X<=a;X++)L=ve*o.get(X,oe)+be*o.get(X,oe+1),St&&(L=L+se*o.get(X,oe+2),o.set(X,oe+2,o.get(X,oe+2)-L*F)),o.set(X,oe,o.get(X,oe)-L),o.set(X,oe+1,o.get(X,oe+1)-L*N)}}}if(C!==0){for(f=e-1;f>=0;f--)if(L=n[f],N=t[f],N===0)for(le=f,u.set(f,f,1),X=f-1;X>=0;X--){for(ze=u.get(X,X)-L,F=0,ye=le;ye<=f;ye++)F=F+u.get(X,ye)*u.get(ye,f);if(t[X]<0)se=ze,H=F;else if(le=X,t[X]===0?u.set(X,f,ze!==0?-F/ze:-F/(b*C)):(ve=u.get(X,X+1),be=u.get(X+1,X),N=(n[X]-L)*(n[X]-L)+t[X]*t[X],Re=(ve*H-se*F)/N,u.set(X,f,Re),u.set(X+1,f,Math.abs(ve)>Math.abs(se)?(-F-ze*Re)/ve:(-H-be*Re)/se)),Re=Math.abs(u.get(X,f)),b*Re*Re>1)for(ye=X;ye<=f;ye++)u.set(ye,f,u.get(ye,f)/Re)}else if(N<0)for(le=f-1,Math.abs(u.get(f,f-1))>Math.abs(u.get(f-1,f))?(u.set(f-1,f-1,N/u.get(f,f-1)),u.set(f-1,f,-(u.get(f,f)-L)/u.get(f,f-1))):(xt=cdiv(0,-u.get(f-1,f),u.get(f-1,f-1)-L,N),u.set(f-1,f-1,xt[0]),u.set(f-1,f,xt[1])),u.set(f,f-1,0),u.set(f,f,1),X=f-2;X>=0;X--){for(de=0,Te=0,ye=le;ye<=f;ye++)de=de+u.get(X,ye)*u.get(ye,f-1),Te=Te+u.get(X,ye)*u.get(ye,f);if(ze=u.get(X,X)-L,t[X]<0)se=ze,F=de,H=Te;else if(le=X,t[X]===0?(xt=cdiv(-de,-Te,ze,N),u.set(X,f-1,xt[0]),u.set(X,f,xt[1])):(ve=u.get(X,X+1),be=u.get(X+1,X),Ge=(n[X]-L)*(n[X]-L)+t[X]*t[X]-N*N,Ke=(n[X]-L)*2*N,Ge===0&&Ke===0&&(Ge=b*C*(Math.abs(ze)+Math.abs(N)+Math.abs(ve)+Math.abs(be)+Math.abs(se))),xt=cdiv(ve*F-se*de+N*Te,ve*H-se*Te-N*de,Ge,Ke),u.set(X,f-1,xt[0]),u.set(X,f,xt[1]),Math.abs(ve)>Math.abs(se)+Math.abs(N)?(u.set(X+1,f-1,(-de-ze*u.get(X,f-1)+N*u.get(X,f))/ve),u.set(X+1,f,(-Te-ze*u.get(X,f)-N*u.get(X,f-1))/ve)):(xt=cdiv(-F-be*u.get(X,f-1),-H-be*u.get(X,f),se,N),u.set(X+1,f-1,xt[0]),u.set(X+1,f,xt[1]))),Re=Math.max(Math.abs(u.get(X,f-1)),Math.abs(u.get(X,f))),b*Re*Re>1)for(ye=X;ye<=f;ye++)u.set(ye,f-1,u.get(ye,f-1)/Re),u.set(ye,f,u.get(ye,f)/Re)}for(X=0;X<e;X++)if(X<g||X>a)for(ye=X;ye<e;ye++)o.set(X,ye,u.get(X,ye));for(ye=e-1;ye>=g;ye--)for(X=g;X<=a;X++){for(se=0,oe=g;oe<=Math.min(ye,a);oe++)se=se+o.get(X,oe)*u.get(oe,ye);o.set(X,ye,se)}}}function cdiv(e,t,n,o){let u,f;return Math.abs(n)>Math.abs(o)?(u=o/n,f=n+u*o,[(e+u*t)/f,(t-u*e)/f]):(u=n/o,f=o+u*n,[(u*e+t)/f,(u*t-e)/f])}class CholeskyDecomposition{constructor(t){if(t=WrapperMatrix2D.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let n=t,o=n.rows,u=new Matrix$2(o,o),f=!0,g,a,b;for(a=0;a<o;a++){let T=0;for(b=0;b<a;b++){let C=0;for(g=0;g<b;g++)C+=u.get(b,g)*u.get(a,g);C=(n.get(a,b)-C)/u.get(b,b),u.set(a,b,C),T=T+C*C}for(T=n.get(a,a)-T,f&=T>0,u.set(a,a,Math.sqrt(Math.max(T,0))),b=a+1;b<o;b++)u.set(a,b,0)}this.L=u,this.positiveDefinite=Boolean(f)}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let n=this.L,o=n.rows;if(t.rows!==o)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let u=t.columns,f=t.clone(),g,a,b;for(b=0;b<o;b++)for(a=0;a<u;a++){for(g=0;g<b;g++)f.set(b,a,f.get(b,a)-f.get(g,a)*n.get(b,g));f.set(b,a,f.get(b,a)/n.get(b,b))}for(b=o-1;b>=0;b--)for(a=0;a<u;a++){for(g=b+1;g<o;g++)f.set(b,a,f.get(b,a)-f.get(g,a)*n.get(g,b));f.set(b,a,f.get(b,a)/n.get(b,b))}return f}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,n={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:o}=n;const{scaleScores:u=!1,maxIterations:f=1e3,terminationCriteria:g=1e-10}=n;let a;if(o){if(isAnyArray(o)&&typeof o[0]=="number"?o=Matrix$2.columnVector(o):o=WrapperMatrix2D.checkMatrix(o),o.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=o.getColumnVector(0)}else a=t.getColumnVector(0);let b=1,T,C,L,N;for(let F=0;F<f&&b>g;F++)L=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),L=L.div(L.norm()),T=t.mmul(L).div(L.transpose().mmul(L).get(0,0)),F>0&&(b=T.clone().sub(N).pow(2).sum()),N=T.clone(),o?(C=o.transpose().mmul(T).div(T.transpose().mmul(T).get(0,0)),C=C.div(C.norm()),a=o.mmul(C).div(C.transpose().mmul(C).get(0,0))):a=T;if(o){let F=t.transpose().mmul(T).div(T.transpose().mmul(T).get(0,0));F=F.div(F.norm());let H=t.clone().sub(T.clone().mmul(F.transpose())),se=a.transpose().mmul(T).div(T.transpose().mmul(T).get(0,0)),ce=o.clone().sub(T.clone().mulS(se.get(0,0)).mmul(C.transpose()));this.t=T,this.p=F.transpose(),this.w=L.transpose(),this.q=C,this.u=a,this.s=T.transpose().mmul(T),this.xResidual=H,this.yResidual=ce,this.betas=se}else this.w=L.transpose(),this.s=T.transpose().mmul(T).sqrt(),u?this.t=T.clone().div(this.s.get(0,0)):this.t=T,this.xResidual=t.sub(T.mmul(L.transpose()))}}var src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,default:Matrix$2,Matrix:Matrix$2,wrap,WrapperMatrix1D,WrapperMatrix2D,solve,inverse,determinant,linearDependencies,pseudoInverse,covariance,correlation,SingularValueDecomposition,SVD:SingularValueDecomposition,EigenvalueDecomposition,EVD:EigenvalueDecomposition,CholeskyDecomposition,CHO:CholeskyDecomposition,LuDecomposition,LU:LuDecomposition,QrDecomposition,QR:QrDecomposition,Nipals:nipals,NIPALS:nipals,MatrixColumnView,MatrixColumnSelectionView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowView,MatrixRowSelectionView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(e){const t=new SingularValueDecomposition(e,{autoTranspose:!0});if(t.rank!==1)return null;const n=Math.sqrt(t.s[0]),o=t.U.to2DArray().map(f=>f[0]*n),u=t.V.to2DArray().map(f=>f[0]*n);return[o,u]}function convolution(e,t={}){let{channels:n,bitDepth:o,normalize:u=!1,divisor:f=1,border:g="copy",algorithm:a="auto"}=t,b={};o&&(b.bitDepth=o);let T=Image.createFrom(this,b);if(n=validateArrayOfChannels(this,n),a!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(a==="auto"){let le=getSeparatedKernel(e);le!==null?(a="separable",e=le):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?a="fft":a="direct"}let C,L;a==="separable"?(C=Math.floor(e[0].length/2),L=Math.floor(e[1].length/2)):(C=Math.floor(e.length/2),L=Math.floor(e[0].length/2));let N=T.isClamped,F=new Array(this.height*this.width),H,se,ce,X,ye,oe;for(X=0;X<n.length;X++){for(ye=n[X],ce=0;ce<this.height;ce++)for(se=0;se<this.width;se++)H=ce*this.width+se,F[H]=this.data[H*this.channels+ye];if(a==="direct")oe=src$2.direct(F,e,{rows:this.height,cols:this.width,normalize:u,divisor:f});else if(a==="separable"){if(oe=convolutionSeparable(F,e,this.width,this.height),u){f=0;for(let le=0;le<e[0].length;le++)for(let ue=0;ue<e[1].length;ue++)f+=e[0][le]*e[1][ue]}if(f!==1)for(let le=0;le<oe.length;le++)oe[le]/=f}else oe=src$2.fft(F,e,{rows:this.height,cols:this.width,normalize:u,divisor:f});for(ce=0;ce<this.height;ce++)for(se=0;se<this.width;se++)H=ce*this.width+se,N?T.data[H*this.channels+ye]=clamp(oe[H],T):T.data[H*this.channels+ye]=oe[H]}if(this.alpha&&!n.includes(this.channels))for(se=this.components;se<this.data.length;se=se+this.channels)T.data[se]=this.data[se];return g!=="periodic"&&T.setBorder({size:[L,C],algorithm:g}),T}function gradientFilter(e={}){let{direction:t="xy",border:n="copy",kernelX:o,kernelY:u,channels:f,bitDepth:g=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!o)throw new Error("kernelX option is missing");return convolution.call(this,o,{channels:f,border:n,bitDepth:g});case"y":if(!u)throw new Error("kernelY option is missing");return convolution.call(this,u,{channels:f,border:n,bitDepth:g});case"xy":{if(!o)throw new Error("kernelX option is missing");if(!u)throw new Error("kernelY option is missing");const a=convolution.call(this,o,{channels:f,border:n,bitDepth:32}),b=convolution.call(this,u,{channels:f,border:n,bitDepth:32});return a.hypotenuse(b,{bitDepth:g,channels:f})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(e,t){e=e||0;for(var n=new Array(e),o=0;o<e;o++)n[o]=t;return n}function level(e={}){let{algorithm:t="range",channels:n,min:o=this.min,max:u=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),n=validateArrayOfChannels(this,{channels:n}),n.length!==this.channel&&(Array.isArray(o)&&o.length===this.channels&&(o=o.filter((f,g)=>n.includes(g))),Array.isArray(u)&&u.length===this.channels&&(u=u.filter((f,g)=>n.includes(g)))),t){case"range":o<0&&(o=0),u>this.maxValue&&(u=this.maxValue),Array.isArray(o)||(o=newArray_1(n.length,o)),Array.isArray(u)||(u=newArray_1(n.length,u)),processImage(this,o,u,n);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(e,t,n,o){let u=1e-5,f=new Array(o.length);for(let g=0;g<o.length;g++)t[g]===0&&n[g]===e.maxValue||n[g]===t[g]?f[g]=0:f[g]=(e.maxValue+1-u)/(n[g]-t[g]),t[g]+=(.5-u/2)/f[g];for(let g=0;g<o.length;g++){let a=o[g];if(f[g]!==0)for(let b=0;b<e.data.length;b+=e.channels)e.data[b+a]=Math.min(Math.max(0,(e.data[b+a]-t[g])*f[g]+.5|0),e.maxValue)}}var toString$1=Object.prototype.toString,isArrayType=function e(t){return toString$1.call(t).substr(-6,5)==="Array"};function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image)return e.data;if(!isArrayType(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,t={}){let{channels:n}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.max(0,Math.min(this.maxValue,this.data[f+u]+e[f+u]>>0))}}else for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.min(this.maxValue,this.data[f+u]+e>>0)}return this}function subtract(e,t={}){let{channels:n}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.max(0,Math.min(this.maxValue,this.data[f+u]-e[f+u]>>0))}}else for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.max(0,this.data[f+u]-e>>0)}return this}function subtractImage(e,t={}){let{channels:n,absolute:o=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let u=this.clone();n=validateArrayOfChannels(this,{channels:n});for(let f=0;f<n.length;f++){let g=n[f];for(let a=g;a<this.data.length;a+=this.channels){let b=this.data[a]-e.data[a];o?u.data[a]=Math.abs(b):u.data[a]=Math.max(b,0)}}return u}function hypotenuse(e,t={}){let{bitDepth:n=this.bitDepth,channels:o}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let u=Image.createFrom(this,{bitDepth:n});o=validateArrayOfChannels(this,{channels:o});let f=u.isClamped;for(let g=0;g<o.length;g++){let a=o[g];for(let b=a;b<this.data.length;b+=this.channels){let T=Math.hypot(this.data[b],e.data[b]);f?u.data[b]=Math.min(Math.max(Math.round(T),0),u.maxValue):u.data[b]=T}}return u}function multiply(e,t={}){let{channels:n}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.max(0,Math.min(this.maxValue,this.data[f+u]*e[f+u]>>0))}}else for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.min(this.maxValue,this.data[f+u]*e>>0)}return this}function divide(e,t={}){let{channels:n}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),n=validateArrayOfChannels(this,{channels:n}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.max(0,Math.min(this.maxValue,this.data[f+u]/e[f+u]>>0))}}else for(let o=0;o<n.length;o++){let u=n[o];for(let f=0;f<this.data.length;f+=this.channels)this.data[f+u]=Math.min(this.maxValue,this.data[f+u]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray(t)){const n=[];for(let o=0;o<t.length;o++)n.push(this._predict(t[o]));return n}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,n){if(!isAnyArray(t)||!isAnyArray(n)||t.length!==n.length)throw new Error("x and y must be arrays of the same length");const o=t.length,u=new Array(o);for(let F=0;F<o;F++)u[F]=this._predict(t[F]);let f=0,g=0,a=0,b=0,T=0,C=0,L=0;for(let F=0;F<o;F++)f+=u[F],g+=n[F],T+=u[F]*u[F],C+=n[F]*n[F],L+=u[F]*n[F],n[F]!==0&&(a+=(n[F]-u[F])*(n[F]-u[F])/n[F]),b+=(n[F]-u[F])*(n[F]-u[F]);const N=(o*L-f*g)/Math.sqrt((o*T-f*f)*(o*C-g*g));return{r:N,r2:N*N,chi2:a,rmsd:Math.sqrt(b/o)}}}var require$$0$2=getAugmentedNamespace(src$1);function squaredEuclidean$4(e,t){let n=0;for(let o=0;o<e.length;o++)n+=(e[o]-t[o])*(e[o]-t[o]);return n}function euclidean$2(e,t){return Math.sqrt(squaredEuclidean$4(e,t))}var euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,squaredEuclidean:squaredEuclidean$4,euclidean:euclidean$2},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(euclidean$3);const{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$b={sigma:1};class GaussianKernel$1{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,n){const o=squaredEuclidean$3(t,n);return Math.exp(-o/this.divisor)}}var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};class PolynomialKernel$1{constructor(t){t=Object.assign({},defaultOptions$a,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,n){for(var o=0,u=0;u<t.length;u++)o+=t[u]*n[u];return Math.pow(this.scale*o+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};class SigmoidKernel$1{constructor(t){t=Object.assign({},defaultOptions$9,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,n){for(var o=0,u=0;u<t.length;u++)o+=t[u]*n[u];return Math.tanh(this.alpha*o+this.constant)}}var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};class ANOVAKernel$1{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,n){for(var o=0,u=Math.min(t.length,n.length),f=1;f<=u;++f)o+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[f-1],f)-Math.pow(n[f-1],f),2)),this.degree);return o}}var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$7={sigma:1};class CauchyKernel$1{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma}compute(t,n){return 1/(1+squaredEuclidean$2(t,n)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0$1,defaultOptions$6={sigma:1};class ExponentialKernel$1{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,n){const o=euclidean$1(t,n);return Math.exp(-o/this.divisor)}}var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,n){for(var o=Math.min(t.length,n.length),u=0,f=0;f<o;++f)u+=Math.min(t[f],n[f]);return u}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0$1,defaultOptions$5={sigma:1};class LaplacianKernel$1{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma}compute(t,n){const o=euclidean(t,n);return Math.exp(-o/this.sigma)}}var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$4={constant:1};class MultiquadraticKernel$1{constructor(t){t=Object.assign({},defaultOptions$4,t),this.constant=t.constant}compute(t,n){return Math.sqrt(squaredEuclidean$1(t,n)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0$1,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.constant=t.constant}compute(t,n){const o=squaredEuclidean(t,n);return 1-o/(o+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$2,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,n){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var o=kernelType[t];if(o)this.kernelFunction=new o(n);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,n){if(t=Matrix$1.checkMatrix(t),n===void 0?n=t:n=Matrix$1.checkMatrix(n),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(n));const o=new Matrix$1(t.rows,n.rows);if(t===n)for(let u=0;u<t.rows;u++)for(let f=u;f<t.rows;f++){const g=this.kernelFunction.compute(t.getRow(u),t.getRow(f));o.set(u,f,g),o.set(f,u,g)}else for(let u=0;u<t.rows;u++)for(let f=0;f<n.rows;f++)o.set(u,f,this.kernelFunction.compute(t.getRow(u),n.getRow(f)));return o}}var kernel=Kernel;const defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,n,o){if(super(),t===!0)this.alpha=n.alpha,this.inputs=n.inputs,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=new kernel(n.kernelType,n.kernelOptions);else{t=Matrix$2.checkMatrix(t),o=Object.assign({},defaultOptions$2,o);const u=new kernel(o.kernelType,o.kernelOptions),f=u.compute(t),g=t.rows;f.add(Matrix$2.eye(g,g).mul(o.lambda)),this.alpha=solve(f,n),this.inputs=t,this.kernelType=o.kernelType,this.kernelOptions=o.kernelOptions,this.kernel=u}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(e,t,n){const o=new KernelRidgeRegression(e,t,n),u=new Array(this.size);for(let a=0;a<this.width;a++)for(let b=0;b<this.height;b++)u[b*this.width+a]=[a,b];const f=o.predict(u),g=Image.createFrom(this);for(let a=0;a<this.size;a++)g.data[a]=Math.min(this.maxValue,Math.max(0,f[a][0]));return g}function dilate(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let o=!0;e:for(const f of t)for(const g of f)if(g!==1){o=!1;break e}let u=this;for(let f=0;f<n;f++)if(this.bitDepth===1)if(o){const g=u.clone();u=dilateOnceBinaryOnlyOnes(u,g,t.length,t[0].length)}else{const g=Image.createFrom(u);u=dilateOnceBinary(u,g,t)}else if(o){const g=Image.createFrom(u);u=dilateOnceGreyOnlyOnes(u,g,t.length,t[0].length)}else{const g=Image.createFrom(u);u=dilateOnceGrey(u,g,t)}return u}function dilateOnceGrey(e,t,n){const o=n.length,u=n[0].length;let f=(o-1)/2,g=(u-1)/2;for(let a=0;a<e.height;a++)for(let b=0;b<e.width;b++){let T=0;for(let C=0;C<u;C++)for(let L=0;L<o;L++){if(n[L][C]!==1)continue;let N=L-f+b,F=C-g+a;if(N<0||F<0||N>=e.width||F>=e.height)continue;const H=e.getValueXY(N,F,0);H>T&&(T=H)}t.setValueXY(b,a,0,T)}return t}function dilateOnceGreyOnlyOnes(e,t,n,o){const u=(n-1)/2,f=(o-1)/2,g=[];for(let a=0;a<e.width;a++)g.push(0);for(let a=0;a<e.height;a++){for(let b=0;b<e.width;b++){let T=0;for(let C=Math.max(0,a-f);C<Math.min(e.height,a+f+1);C++){const L=e.getValueXY(b,C,0);L>T&&(T=L)}g[b]=T}for(let b=0;b<e.width;b++){let T=0;for(let C=Math.max(0,b-u);C<Math.min(e.width,b+u+1);C++)g[C]>T&&(T=g[C]);t.setValueXY(b,a,0,T)}}return t}function dilateOnceBinary(e,t,n){const o=n.length,u=n[0].length;let f=(o-1)/2,g=(u-1)/2;for(let a=0;a<e.height;a++)for(let b=0;b<e.width;b++){let T=0;e:for(let C=0;C<u;C++)for(let L=0;L<o;L++){if(n[L][C]!==1)continue;let N=L-f+b,F=C-g+a;if(F<0||N<0||N>=e.width||F>=e.height)continue;if(e.getBitXY(N,F)===1){T=1;break e}}T===1&&t.setBitXY(b,a)}return t}function dilateOnceBinaryOnlyOnes(e,t,n,o){const u=(n-1)/2,f=(o-1)/2,g=[];for(let a=0;a<e.width;a++)g.push(1);for(let a=0;a<e.height;a++){for(let b=0;b<e.width;b++){g[b]=0;for(let T=Math.max(0,a-f);T<Math.min(e.height,a+f+1);T++)if(e.getBitXY(b,T)===1){g[b]=1;break}}for(let b=0;b<e.width;b++)if(t.getBitXY(b,a)!==1){for(let T=Math.max(0,b-u);T<Math.min(e.width,b+u+1);T++)if(g[T]===1){t.setBitXY(b,a);break}}}return t}function erode(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let o=!0;e:for(const f of t)for(const g of f)if(g!==1){o=!1;break e}let u=this;for(let f=0;f<n;f++)if(this.bitDepth===1)if(o){const g=u.clone();u=erodeOnceBinaryOnlyOnes(u,g,t.length,t[0].length)}else{const g=Image.createFrom(u);u=erodeOnceBinary(u,g,t)}else if(o){const g=Image.createFrom(u);u=erodeOnceGreyOnlyOnes(u,g,t.length,t[0].length)}else{const g=Image.createFrom(u);u=erodeOnceGrey(u,g,t)}return u}function erodeOnceGrey(e,t,n){const o=n.length,u=n[0].length;let f=(o-1)/2,g=(u-1)/2;for(let a=0;a<e.height;a++)for(let b=0;b<e.width;b++){let T=e.maxValue;for(let C=0;C<u;C++)for(let L=0;L<o;L++){if(n[L][C]!==1)continue;let N=L-f+b,F=C-g+a;if(N<0||F<0||N>=e.width||F>=e.height)continue;const H=e.getValueXY(N,F,0);H<T&&(T=H)}t.setValueXY(b,a,0,T)}return t}function erodeOnceGreyOnlyOnes(e,t,n,o){const u=(n-1)/2,f=(o-1)/2,g=[];for(let a=0;a<e.width;a++)g.push(0);for(let a=0;a<e.height;a++){for(let b=0;b<e.width;b++){let T=e.maxValue;for(let C=Math.max(0,a-f);C<Math.min(e.height,a+f+1);C++){const L=e.getValueXY(b,C,0);L<T&&(T=L)}g[b]=T}for(let b=0;b<e.width;b++){let T=e.maxValue;for(let C=Math.max(0,b-u);C<Math.min(e.width,b+u+1);C++)g[C]<T&&(T=g[C]);t.setValueXY(b,a,0,T)}}return t}function erodeOnceBinary(e,t,n){const o=n.length,u=n[0].length;let f=(o-1)/2,g=(u-1)/2;for(let a=0;a<e.height;a++)for(let b=0;b<e.width;b++){let T=1;e:for(let C=0;C<u;C++)for(let L=0;L<o;L++){if(n[L][C]!==1)continue;let N=L-f+b,F=C-g+a;if(F<0||N<0||N>=e.width||F>=e.height)continue;if(e.getBitXY(N,F)===0){T=0;break e}}T===1&&t.setBitXY(b,a)}return t}function erodeOnceBinaryOnlyOnes(e,t,n,o){const u=(n-1)/2,f=(o-1)/2,g=[];for(let a=0;a<e.width;a++)g.push(0);for(let a=0;a<e.height;a++){for(let b=0;b<e.width;b++){g[b]=1;for(let T=Math.max(0,a-f);T<Math.min(e.height,a+f+1);T++)if(e.getBitXY(b,T)===0){g[b]=0;break}}for(let b=0;b<e.width;b++)if(t.getBitXY(b,a)!==0){for(let T=Math.max(0,b-u);T<Math.min(e.width,b+u+1);T++)if(g[T]===0){t.clearBitXY(b,a);break}}}return t}function open(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let o=this;for(let u=0;u<n;u++)o=o.erode({kernel:t}),o=o.dilate({kernel:t});return o}function close(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let o=this;for(let u=0;u<n;u++)o=o.dilate({kernel:t}).erode({kernel:t});return o}function topHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let o=this;for(let u=0;u<n;u++)o=o.open({kernel:t}).subtractImage(o,{absolute:!0});return o}function blackHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let o=this;for(let u=0;u<n;u++)o=o.close({kernel:t}).subtractImage(o,{absolute:!0});return o}function morphologicalGradient(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:n=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let o=this;for(let u=0;u<n;u++){let f=o.dilate({kernel:t}),g=o.erode({kernel:t});o=f.subtractImage(g,{absolute:!0})}return o}function order4Points(e){let t=0,n=0,o=0,u=0,f=e[0][0],g=0;for(let T=1;T<e.length;T++)e[T][0]<f&&(f=e[T][0],g=T);let a=e[(g+1)%e.length][0],b=(g+1)%e.length;for(let T=1;T<e.length;T++)e[T][0]<a&&T!==g&&(a=e[T][0],b=T);return e[b][1]<e[g][1]?(t=e[b],u=e[g],g!==(b+1)%4?(n=e[(b+1)%4],o=e[(b+2)%4]):(n=e[(b+2)%4],o=e[(b+3)%4])):(u=e[b],t=e[g],b!==(g+1)%4?(n=e[(g+1)%4],o=e[(g+2)%4]):(n=e[(g+2)%4],o=e[(g+3)%4])),[t,n,o,u]}function distance2Points(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function crossVect(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dotVect(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function computeWidthAndHeigth(e,t,n,o,u,f){let g=Math.max(distance2Points(e,t),distance2Points(o,n)),a=Math.max(distance2Points(e,o),distance2Points(t,n)),b=0,T=0,C=Math.ceil(u/2),L=Math.ceil(f/2),N=g/a,F=[e[0],e[1],1],H=[t[0],t[1],1],se=[o[0],o[1],1],ce=[n[0],n[1],1],X=dotVect(crossVect(F,ce),se)/dotVect(crossVect(H,ce),se),ye=dotVect(crossVect(F,ce),H)/dotVect(crossVect(se,ce),H),oe=[X*H[0]-F[0],X*H[1]-F[1],X*H[2]-F[2]],le=[ye*se[0]-F[0],ye*se[1]-F[1],ye*se[2]-F[2]],ue=oe[0],Re=oe[1],ze=oe[2],ve=le[0],be=le[1],de=le[2],Te=1/(ze*de)*(ue*ve-(ue*de+ze*ve)*C+ze*de*C*C+(Re*be-(Re*de+ze*be)*L+ze*de*L*L));Te>=0?Te=Math.sqrt(Te):Te=Math.sqrt(-Te);let Ge=new Matrix$2([[Te,0,C],[0,Te,L],[0,0,1]]),Ke=Ge.transpose(),St=inverse(Ke),xt=inverse(Ge),Lr=Matrix$2.rowVector(oe),Nr=Matrix$2.rowVector(le),Sr=Math.sqrt(dotVect(Lr.mmul(St).mmul(xt).to1DArray(),oe)/dotVect(Nr.mmul(St).mmul(xt).to1DArray(),le));return Sr===0||N===0?(b=Math.ceil(g),T=Math.ceil(a)):Sr<N?(b=Math.ceil(g),T=Math.ceil(b/Sr)):(T=Math.ceil(a),b=Math.ceil(Sr*T)),[b,T]}function projectionPoint(e,t,n,o,u,f,g,a,b,T,C,L){let[N,F]=[(n*e+o*t+u)/(b*e+T*t+1),(f*e+g*t+a)/(b*e+T*t+1)];return C.getValueXY(Math.floor(N),Math.floor(F),L)}function warpingFourPoints(e,t={}){let{calculateRatio:n=!0}=t;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[o,u,f,g]=e,a=[o,u,f,g],[b,T,C,L]=order4Points(a),N,F;n?[N,F]=computeWidthAndHeigth(b,T,C,L,this.width,this.height):(N=Math.ceil(Math.max(distance2Points(b,T),distance2Points(L,C))),F=Math.ceil(Math.max(distance2Points(b,L),distance2Points(T,C))));let H=Image.createFrom(this,{width:N,height:F}),[se,ce]=b,[X,ye]=T,[oe,le]=C,[ue,Re]=L,[ze,ve]=[0,0],[be,de]=[0,N-1],[Te,Ge]=[F-1,N-1],[Ke,St]=[F-1,0],xt=new Matrix$2([[ze,ve,1,0,0,0,-ze*se,-ve*se],[be,de,1,0,0,0,-be*X,-de*X],[Te,Ge,1,0,0,0,-Te*oe,-ve*oe],[Ke,St,1,0,0,0,-Ke*ue,-St*ue],[0,0,0,ze,ve,1,-ze*ce,-ve*ce],[0,0,0,be,de,1,-be*ye,-de*ye],[0,0,0,Te,Ge,1,-Te*le,-Ge*le],[0,0,0,Ke,St,1,-Ke*Re,-St*Re]]),Lr=Matrix$2.columnVector([se,X,oe,ue,ce,ye,le,Re]),Sr=new SingularValueDecomposition(xt).solve(Lr),[Gr,_t,Kt,mr,Yt,er,lr,ar]=Sr.to1DArray(),dr=new Matrix$2(F,N);for(let ii=0;ii<this.channels;ii++){for(let nr=0;nr<F;nr++)for(let at=0;at<N;at++)dr.set(nr,at,projectionPoint(nr,at,Gr,_t,Kt,mr,Yt,er,lr,ar,this,ii));H.setMatrix(dr,{channel:ii})}return H}function crop(e={}){let{x:t=0,y:n=0,width:o=this.width-t,height:u=this.height-n}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),n=Math.round(n),o=Math.round(o),u=Math.round(u),t>this.width-1||n>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${n}) out of range (${this.width-1}; ${this.height-1})`);if(o<=0||u<=0)throw new RangeError(`crop: width and height (width:${o}; height:${u}) must be positive numbers`);if(t<0||n<0)throw new RangeError(`crop: x and y (x:${t}, y:${n}) must be positive numbers`);if(o>this.width-t||u>this.height-n)throw new RangeError(`crop: (x: ${t}, y:${n}, width:${o}, height:${u}) size is out of range`);let f=this;if(this.bitDepth===1){const g=new Image(o,u,{kind:"BINARY",parent:this});f=cropBinary(this,g,t,n,o,u)}else{const g=Image.createFrom(this,{width:o,height:u,position:[t,n]});f=cropDefault(this,g,t,n,o,u)}return f}function cropDefault(e,t,n,o,u,f){let g=u*e.channels,a=o+f,b=0,T=n*e.channels;for(let C=o;C<a;C++){let L=C*e.width*e.channels+T,N=L+g;for(;L<N;L++)t.data[b++]=e.data[L]}return t}function cropBinary(e,t,n,o,u,f){let g=u*e.channels,a=o+f,b=0,T=n*e.channels;for(let C=o;C<a;C++){let L=C*e.width*e.channels+T,N=L+g;for(;L<N;L++)e.getBit(L)&&t.setBit(b),++b}return t}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=e;let n=findLeft(this,t,this.components);if(n===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let o=findTop(this,t,this.components,n),u=findBottom(this,t,this.components,n),f=findRight(this,t,this.components,n,o,u);return this.crop({x:n,y:o,width:f-n+1,height:u-o+1})}function findLeft(e,t,n){for(let o=0;o<e.width;o++)for(let u=0;u<e.height;u++)if(e.getValueXY(o,u,n)>=t)return o;return-1}function findTop(e,t,n,o){for(let u=0;u<e.height;u++)for(let f=o;f<e.width;f++)if(e.getValueXY(f,u,n)>=t)return u;return-1}function findBottom(e,t,n,o){for(let u=e.height-1;u>=0;u--)for(let f=o;f<e.width;f++)if(e.getValueXY(f,u,n)>=t)return u;return-1}function findRight(e,t,n,o,u,f){for(let g=e.width-1;g>=o;g--)for(let a=u;a<=f;a++)if(e.getValueXY(g,a,n)>=t)return g;return-1}function getFactor(e){if(typeof e=="string"){const t=e[e.length-1];e=parseFloat(e),t==="%"&&(e/=100)}return e}function getThreshold$1(e,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*t}else{if(typeof e=="number")return e<1?e*t:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,t,n){e=getFactor(e);let o=Math.round(e*t),u=Math.round(e*n);return o<=0&&(o=1),u<=0&&(u=1),{width:o,height:u}}function checkRow(e,t){if(t<0||t>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${t}`)}function checkColumn(e,t){if(t<0||t>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${t}`)}function checkChannel(e,t){if(t<0||t>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,t,n){const o=this.width/t,u=this.height/n;if(this.bitDepth>1)for(let f=0;f<t;f++){const g=Math.floor((f+.5)*o);for(let a=0;a<n;a++){const b=Math.floor((a+.5)*u);for(let T=0;T<this.channels;T++)e.setValueXY(f,a,T,this.getValueXY(g,b,T))}}else for(let f=0;f<t;f++){const g=Math.floor((f+.5)*o);for(let a=0;a<n;a++){const b=Math.floor((a+.5)*u);this.getBitXY(g,b)&&e.setBitXY(f,a)}}}function resize(e={}){const{factor:t=1,interpolation:n=validInterpolations.nearestneighbor,preserveAspectRatio:o=!0}=e,u=checkInterpolation(n);let f=e.width,g=e.height;if(f||(g&&o?f=Math.round(g*(this.width/this.height)):f=this.width),g||(o?g=Math.round(f*(this.height/this.width)):g=this.height),{width:f,height:g}=factorDimensions(t,f,g),f===this.width&&g===this.height){const C=this.clone();return C.position=[0,0],C}let a=Math.round((this.width-f)/2),b=Math.round((this.height-g)/2);const T=Image.createFrom(this,{width:f,height:g,position:[a,b]});switch(u){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,T,f,g);break;default:throw new Error(`unsupported resize interpolation: ${u}`)}return T}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{colorModel:HSV}),t=0,n=this.data;for(let o=0;o<n.length;o+=this.channels){let u=n[o],f=n[o+1],g=n[o+2],a=Math.min(u,f,g),b=Math.max(u,f,g),T=b-a,C=0,L=b===0?0:T/b,N=b;if(b!==a){switch(b){case u:C=(f-g)/T+(f<g?6:0);break;case f:C=(g-u)/T+2;break;case g:C=(u-f)/T+4;break;default:throw new Error("unreachable")}C/=6}e.data[t++]=C*this.maxValue,e.data[t++]=L*this.maxValue,e.data[t++]=N,this.alpha&&(e.data[t++]=n[o+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),n=0,o=this.data;for(let u=0;u<o.length;u+=this.channels){let f=o[u],g=o[u+1],a=o[u+2],b=Math.max(f,g,a),T=Math.min(f,g,a),C=0,L=0,N=(b+T)/2;if(b!==T){let F=b-T;switch(L=N>t?F/(2-b-T):F/(b+T),b){case f:C=(g-a)/F+(g<a?6:0);break;case g:C=(a-f)/F+2;break;case a:C=(f-g)/F+4;break;default:throw new Error("unreachable")}C/=6}e.data[n++]=C*this.maxValue,e.data[n++]=L*this.maxValue,e.data[n++]=N,this.alpha&&(e.data[n++]=o[u+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,n=this.data;for(let o=0;o<n.length;o+=this.channels){let u=n[o],f=n[o+1],g=n[o+2],a=Math.min(this.maxValue-u,this.maxValue-f,this.maxValue-g),b=(this.maxValue-u-a)/(1-a/this.maxValue),T=(this.maxValue-f-a)/(1-a/this.maxValue),C=(this.maxValue-g-a)/(1-a/this.maxValue);e.data[t++]=Math.round(b),e.data[t++]=Math.round(T),e.data[t++]=Math.round(C),e.data[t++]=Math.round(a),this.alpha&&(e.data[t++]=n[o+3])}return e}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,t,n){return e*6966+t*23436+n*2366>>15},luma601(e,t,n){return e*9798+t*19235+n*3735>>15},maximum(e,t,n){return Math.max(e,t,n)},minimum(e,t,n){return Math.min(e,t,n)},average(e,t,n){return(e+t+n)/3>>0},minmax(e,t,n){return(Math.max(e,t,n)+Math.min(e,t,n))/2},red(e){return e},green(e,t){return t},blue(e,t,n){return n},cyan(e,t,n,o){let u=methods$1.black(e,t,n,o);return(o.maxValue-e-u)/(1-u/o.maxValue)>>0},magenta(e,t,n,o){let u=methods$1.black(e,t,n,o);return(o.maxValue-t-u)/(1-u/o.maxValue)>>0},yellow(e,t,n,o){let u=methods$1.black(e,t,n,o);return(o.maxValue-n-u)/(1-u/o.maxValue)>>0},black(e,t,n,o){return Math.min(o.maxValue-e,o.maxValue-t,o.maxValue-n)},hue(e,t,n,o){let u=methods$1.min(e,t,n),f=methods$1.max(e,t,n);if(f===u)return 0;let g=0,a=f-u;switch(f){case e:g=(t-n)/a+(t<n?6:0);break;case t:g=(n-e)/a+2;break;case n:g=(e-t)/a+4;break;default:throw new Error("unreachable")}return g/6*o.maxValue>>0},saturation(e,t,n,o){let u=methods$1.min(e,t,n),f=methods$1.max(e,t,n),g=f-u;return f===0?0:g/f*o.maxValue},lightness(e,t,n){let o=methods$1.min(e,t,n);return(methods$1.max(e,t,n)+o)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:t="luma709",keepAlpha:n=!1,mergeAlpha:o=!0}=e;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),n&=this.alpha,o&=this.alpha,n&&(o=!1);let u=getOutputImage(this,e,{components:1,alpha:n,colorModel:GREY$1}),f;if(typeof t=="function")f=t;else if(f=methods$1[t.toLowerCase()],!f)throw new Error(`unsupported grey algorithm: ${t}`);let g=0;for(let a=0;a<this.data.length;a+=this.channels)o?u.data[g++]=clamp(f(this.data[a],this.data[a+1],this.data[a+2],this)*this.data[a+this.components]/this.maxValue,this):(u.data[g++]=clamp(f(this.data[a],this.data[a+1],this.data[a+2],this),this),u.alpha&&(u.data[g++]=this.data[a+this.components]));return u}function huang(e){let t=0;for(let C=0;C<e.length;C++)if(e[C]!==0){t=C;break}let n=e.length-1;for(let C=e.length-1;C>=t;C--)if(e[C]!==0){n=C;break}let o=1/(n-t),u=new Array(e.length),f=0,g=0;for(let C=t;C<e.length;C++)f+=C*e[C],g+=e[C],u[C]=f/g;let a=new Array(e.length);f=g=0;for(let C=n;C>0;C--)f+=C*e[C],g+=e[C],a[C-1]=f/g;let b=-1,T=Number.MAX_VALUE;for(let C=0;C<e.length;C++){let L=0,N;for(let F=0;F<=C;F++)N=1/(1+o*Math.abs(F-u[C])),N<1e-6||N>.999999||(L+=e[F]*(-N*Math.log(N)-(1-N)*Math.log(1-N)));for(let F=C+1;F<e.length;F++)N=1/(1+o*Math.abs(F-a[C])),N<1e-6||N>.999999||(L+=e[F]*(-N*Math.log(N)-(1-N)*Math.log(1-N)));L<T&&(T=L,b=C)}return b}function intermodes(e){let t=e.slice(),n=0;for(;!bimodalTest$1(t);){let u=0,f=0,g=t[0];for(let a=0;a<e.length-1;a++)u=f,f=g,g=t[a+1],t[a]=(u+f+g)/3;if(t[e.length-1]=(f+g)/3,n++,n>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let o=0;for(let u=1;u<e.length-1;u++)t[u-1]<t[u]&&t[u+1]<t[u]&&(o+=u);return Math.floor(o/2)}function bimodalTest$1(e){let t=!1,n=0;for(let o=1;o<e.length-1;o++)if(e[o-1]<e[o]&&e[o+1]<e[o]&&(n++,n>2))return!1;return n===2&&(t=!0),t}function isodata(e){let t,n,o,u,f=0;for(let g=1;g<e.length;g++)if(e[g]>0){f=g+1;break}for(;;){t=0,o=0;for(let g=0;g<f;g++)o=o+e[g],t=t+e[g]*g;u=0,n=0;for(let g=f+1;g<e.length;g++)n+=e[g],u+=e[g]*g;if(o>0&&n>0&&(t/=o,u/=n,f===Math.round((t+u)/2)))break;if(f++,f>e.length-2)throw new Error("Threshold not found")}return f}function li(e,t){let n,o,u,f,g,a,b,T,C,L,N,F;N=.5,L=0;for(let H=0;H<e.length;H++)L+=H*e[H];L/=t,b=L;do{a=b,n=a+.5|0,o=0,f=0;for(let H=0;H<=n;H++)o+=H*e[H],f+=e[H];T=f===0?0:o/f,u=0,g=0;for(let H=n+1;H<e.length;H++)u+=H*e[H],g+=e[H];C=g===0?0:u/g,F=(T-C)/(Math.log(T)-Math.log(C)),F<-Number.EPSILON?b=F-.5|0:b=F+.5|0}while(Math.abs(b-a)>N);return n}function maxEntropy(e,t){let n=new Array(e.length);for(let N=0;N<e.length;N++)n[N]=e[N]/t;let o=new Array(e.length),u=new Array(e.length);o[0]=n[0],u[0]=1-o[0];for(let N=1;N<e.length;N++)o[N]=o[N-1]+n[N],u[N]=1-o[N];let f=0;for(let N=0;N<e.length;N++)if(Math.abs(o[N])>=Number.EPSILON){f=N;break}let g=e.length-1;for(let N=e.length-1;N>=f;N--)if(Math.abs(u[N])>=Number.EPSILON){g=N;break}let a=-1,b,T=Number.MIN_VALUE,C,L;for(let N=f;N<=g;N++){C=0;for(let F=0;F<=N;F++)e[F]!==0&&(C-=n[F]/o[N]*Math.log(n[F]/o[N]));L=0;for(let F=N+1;F<e.length;F++)e[F]!==0&&(L-=n[F]/u[N]*Math.log(n[F]/u[N]));b=C+L,T<b&&(T=b,a=N)}return a}function mean$1(e,t){let n=0;for(let o=0;o<e.length;o++)n+=o*e[o];return Math.floor(n/t)}function minError(e,t){let n,o=-2,u,f,g,a,b,T,C,L,N,F,H,se=0;for(let ce=0;ce<e.length;ce++)se+=ce*e[ce];for(se/=t,n=se;n!==o;){let ce=sumA(e,n),X=sumA(e,e.length-1),ye=sumB(e,n),oe=sumB(e,e.length-1),le=sumC(e,n),ue=sumC(e,e.length-1);if(u=ye/ce,f=(oe-ye)/(X-ce),g=ce/X,a=(X-ce)/X,b=le/ce-u*u,T=(ue-le)/(X-ce)-f*f,C=1/b-1/T,L=u/b-f/T,N=u*u/b-f*f/T+Math.log10(b*(a*a)/(T*(g*g))),F=L*L-C*N,F<0)return n;o=n,H=(L+Math.sqrt(F))/C,isNaN(H)?n=o:n=Math.floor(H)}return n}function sumA(e,t){let n=0;for(let o=0;o<=t;o++)n+=e[o];return n}function sumB(e,t){let n=0;for(let o=0;o<=t;o++)n+=o*e[o];return n}function sumC(e,t){let n=0;for(let o=0;o<=t;o++)n+=o*o*e[o];return n}function minimum(e){if(e.length<2)return 0;let t=0,n=-1,o=-1,u=new Array(e.length);for(let f=0;f<e.length;f++)u[f]=e[f],e[f]>0&&(o=f);for(;!bimodalTest(u);)if(u=smoothed(u),t++,t>1e4)return n;return n=minimumBetweenPeeks(u,o),n}function smoothed(e){let t=new Array(e.length);for(let n=1;n<e.length-1;n++)t[n]=(e[n-1]+e[n]+e[n+1])/3;return t[0]=(e[0]+e[1])/3,t[e.length-1]=(e[e.length-2]+e[e.length-1])/3,t}function minimumBetweenPeeks(e,t){let n;for(let o=1;o<t;o++)if(e[o-1]>e[o]&&e[o+1]>=e[o]){n=o;break}return n}function bimodalTest(e){let t=e.length,n=!1,o=0;for(let u=1;u<t-1;u++)if(e[u-1]<e[u]&&e[u+1]<e[u]&&(o++,o>2))return!1;return o===2&&(n=!0),n}function moments(e,t){let n=1,o=0,u=0,f=0,g=0,a,b,T,C,L,N,F=-1,H=e.length,se=new Array(H);for(let ce=0;ce<H;ce++)se[ce]=e[ce]/t;for(let ce=0;ce<H;ce++)o+=ce*se[ce],u+=ce*ce*se[ce],f+=ce*ce*ce*se[ce];b=n*u-o*o,T=(-u*u+o*f)/b,C=(n*-f+u*o)/b,L=.5*(-C-Math.sqrt(C*C-4*T)),N=.5*(-C+Math.sqrt(C*C-4*T)),a=(N-o)/(N-L);for(let ce=0;ce<H;ce++)if(g+=se[ce],g>a){F=ce;break}return F}function otsu(e,t){let n=0,o=0,u=0,f=0,g=0;for(let a=0;a<e.length;a++)g+=a*e[a];for(let a=0;a<e.length;a++){o=o+e[a];const b=t-o;if(o===0||b===0)continue;n=n+a*e[a];const T=(g-n)/b,C=o*b*(n/o-T)*(n/o-T);C>=u&&(f=a,u=C)}return f}function percentile(e){let t=-1,n=.5,o=new Array(e.length),u=partialSum(e,e.length-1),f=1;for(let g=0;g<e.length;g++)o[g]=Math.abs(partialSum(e,g)/u-n),o[g]<f&&(f=o[g],t=g);return t}function partialSum(e,t){let n=0;for(let o=0;o<=t;o++)n+=e[o];return n}function renyiEntropy(e,t){let n,o,u,f=new Array(e.length),g=new Array(e.length),a=new Array(e.length),b=0,T=0,C=0,L=0,N=0,F=0,se=1/(1-.5),X=1/(1-2);for(let ue=0;ue<e.length;ue++)f[ue]=e[ue]/t;g[0]=f[0],a[0]=1-g[0];for(let ue=1;ue<e.length;ue++)g[ue]=g[ue-1]+f[ue],a[ue]=1-g[ue];o=0;for(let ue=0;ue<e.length;ue++)if(Math.abs(g[ue])>=Number.EPSILON){o=ue;break}u=e.length-1;for(let ue=e.length-1;ue>=o;ue--)if(Math.abs(a[ue])>=Number.EPSILON){u=ue;break}for(let ue=o;ue<=u;ue++){let Re=0,ze=0,ve=0;for(let xt=0;xt<=ue;xt++)e[xt]!==0&&(Re-=f[xt]/g[ue]*Math.log(f[xt]/g[ue])),ze+=Math.sqrt(f[xt]/g[ue]),ve+=f[xt]*f[xt]/(g[ue]*g[ue]);let be=0,de=0,Te=0;for(let xt=ue+1;xt<e.length;xt++)e[xt]!==0&&(be-=f[xt]/a[ue]*Math.log(f[xt]/a[ue])),de+=Math.sqrt(f[xt]/a[ue]),Te+=f[xt]*f[xt]/(a[ue]*a[ue]);let Ge=Re+be,Ke=se*(ze*de>0?Math.log(ze*de):0),St=X*(ve*Te>0?Math.log(ve*Te):0);Ge>L&&(L=Ge,b=ue),Ke>N&&(N=Ke,T=ue),St>F&&(F=St,C=ue)}let ye=[b,T,C];ye.sort((ue,Re)=>ue-Re);let oe;Math.abs(ye[0]-ye[1])<=5?Math.abs(ye[1]-ye[2])<=5?oe=[1,2,1]:oe=[0,1,3]:Math.abs(ye[1]-ye[2])<=5?oe=[3,1,0]:oe=[1,2,1];let le=g[ye[2]]-g[ye[0]];return n=Math.round(ye[0]*(g[ye[0]]+.25*le*oe[0])+.25*ye[1]*le*oe[1]+ye[2]*(a[ye[2]]+.25*le*oe[2])),n}function shanbhag(e,t){let n=new Array(e.length);for(let F=0;F<e.length;F++)n[F]=e[F]/t;let o=new Array(e.length),u=new Array(e.length);o[0]=n[0],u[0]=1-o[0];for(let F=1;F<e.length;F++)o[F]=o[F-1]+n[F],u[F]=1-o[F];let f=0;for(let F=0;F<e.length;F++)if(Math.abs(o[F])>=Number.EPSILON){f=F;break}let g=e.length-1;for(let F=e.length-1;F>=f;F--)if(Math.abs(u[F])>=Number.EPSILON){g=F;break}let a=-1,b=Number.MAX_VALUE,T,C,L,N;for(let F=f;F<=g;F++){L=0,T=.5/o[F];for(let H=1;H<=F;H++)L-=n[H]*Math.log(1-T*o[H-1]);L*=T,N=0,T=.5/u[F];for(let H=F+1;H<e.length;H++)N-=n[H]*Math.log(1-T*u[H]);N*=T,C=Math.abs(L-N),C<b&&(b=C,a=F)}return a}function triangle$1(e){let t=0,n=0,o=0,u=0;for(let L=0;L<e.length;L++)if(e[L]>0){t=L;break}t>0&&t--;for(let L=e.length-1;L>0;L--)if(e[L]>0){u=L;break}u<e.length-1&&u++;for(let L=0;L<e.length;L++)e[L]>n&&(o=L,n=e[L]);let f=!1;if(o-t<u-o){f=!0;let L=0,N=e.length-1;for(;L<N;){let F=e[L];e[L]=e[N],e[N]=F,L++,N--}t=e.length-1-u,o=e.length-1-o}if(t===o)return t;let g,a,b;g=e[o],a=t-o,b=Math.sqrt(g*g+a*a),g/=b,a/=b,b=g*t+a*e[t];let T=t,C=0;for(let L=t+1;L<=o;L++){let N=g*L+a*e[L]-b;N>C&&(T=L,C=N)}if(T--,f){let L=0,N=e.length-1;for(;L<N;){let F=e[L];e[L]=e[N],e[N]=F,L++,N--}return e.length-1-T}else return T}function yen(e,t){let n=new Array(e.length);for(let T=0;T<e.length;T++)n[T]=e[T]/t;let o=new Array(e.length);o[0]=n[0];for(let T=1;T<e.length;T++)o[T]=o[T-1]+n[T];let u=new Array(e.length);u[0]=n[0]*n[0];for(let T=1;T<e.length;T++)u[T]=u[T-1]+n[T]*n[T];let f=new Array(e.length);f[e.length-1]=0;for(let T=e.length-2;T>=0;T--)f[T]=f[T+1]+n[T+1]*n[T+1];let g=-1,a=Number.MIN_VALUE,b;for(let T=0;T<e.length;T++)b=-1*(u[T]*f[T]>0?Math.log(u[T]*f[T]):0)+2*(o[T]*(1-o[T])>0?Math.log(o[T]*(1-o[T])):0),b>a&&(a=b,g=T);return g}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:t=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let n=methods[t.toLowerCase()];if(n){let o=this.getHistogram();return n(o,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:t=THRESHOLD,threshold:n=.5,useAlpha:o=!0,invert:u=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?n=getThreshold$1(n,this.maxValue):n=getThreshold.call(this,e);let f=new Image(this.width,this.height,{kind:"BINARY",parent:this}),g=0;if(this.alpha&&o)for(let a=0;a<this.data.length;a+=this.channels){let b=this.data[a]+(this.maxValue-this.data[a])*(this.maxValue-this.data[a+1])/this.maxValue;(u&&b<=n||!u&&b>=n)&&f.setBit(g),g++}else for(let a=0;a<this.data.length;a+=this.channels)(u&&this.data[a]<=n||!u&&this.data[a]>=n)&&f.setBit(g),g++;return f}function copyImage(e,t,n,o){let u=e.width,f=e.height,g=t.width,a=e.channels;for(let b=0;b<u;b++)for(let T=0;T<f;T++)for(let C=0;C<a;C++){let L=(T*u+b)*a+C,N=((o+T)*g+n+b)*a+C;t.data[N]=e.data[L]}}function pad(e={}){let{size:t=0,algorithm:n="copy",color:o}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),n==="set"){if(o.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let b=0;b<o.length;b++)o[b]===0&&(o[b]=.001)}else o=newArray_1(this.channels,null);Array.isArray(t)||(t=[t,t]);let u=this.width+t[0]*2,f=this.height+t[1]*2,g=this.channels,a=Image.createFrom(this,{width:u,height:f});copyImage(this,a,t[0],t[1]);for(let b=t[0];b<u-t[0];b++)for(let T=0;T<g;T++){let C=o[T]||a.data[(t[1]*u+b)*g+T];for(let L=0;L<t[1];L++)a.data[(L*u+b)*g+T]=C;C=o[T]||a.data[((f-t[1]-1)*u+b)*g+T];for(let L=f-t[1];L<f;L++)a.data[(L*u+b)*g+T]=C}for(let b=0;b<f;b++)for(let T=0;T<g;T++){let C=o[T]||a.data[(b*u+t[0])*g+T];for(let L=0;L<t[0];L++)a.data[(b*u+L)*g+T]=C;C=o[T]||a.data[(b*u+u-t[0]-1)*g+T];for(let L=u-t[0];L<u;L++)a.data[(b*u+L)*g+T]=C}return a}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let t=Image.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let n=0;n<this.size;n++)this.getBit(n)&&(t.data[n]=255);else for(let n=0;n<this.data.length;n++)t.data[n]=this.data[n]>>8;break;case 16:if(this.bitDepth===1)for(let n=0;n<this.size;n++)this.getBit(n)&&(t.data[n]=65535);else for(let n=0;n<this.data.length;n++)t.data[n]=this.data[n]<<8|this.data[n];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(e,t={}){const{interpolation:n=validInterpolations.nearestneighbor,width:o=this.width,height:u=this.height}=t;if(typeof e!="number")throw new TypeError("degrees must be a number");const f=checkInterpolation(n),g=e*Math.PI/180,a=Math.floor(Math.abs(o*Math.cos(g))+Math.abs(u*Math.sin(g))),b=Math.floor(Math.abs(u*Math.cos(g))+Math.abs(o*Math.sin(g))),T=Math.cos(-g),C=Math.sin(-g);let L=a/2,N=b/2;a%2===0?(L=L-.5,b%2===0?N=N-.5:N=Math.floor(N)):(L=Math.floor(L),b%2===0?N=N-.5:N=Math.floor(N));const F=Math.floor(o/2-L),H=Math.floor(u/2-N);if(this.bitDepth===1){const se=new Image(a,b,{kind:"BINARY",parent:this});switch(f){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,se,F,H,L,N,T,C);case validInterpolations.bilinear:return rotateBinaryBilinear(this,se,F,H,L,N,T,C);default:throw new Error(`unsupported rotate interpolation: ${f}`)}}else{const se=Image.createFrom(this,{width:a,height:b});switch(f){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,se,F,H,L,N,T,C);case validInterpolations.bilinear:return rotateBilinear(this,se,F,H,L,N,T,C);default:throw new Error(`unsupported rotate interpolation: ${f}`)}}}function rotateNearestNeighbor(e,t,n,o,u,f,g,a){for(let b=0;b<t.width;b+=1)for(let T=0;T<t.height;T+=1)for(let C=0;C<e.channels;C++){let L=Math.round((b-u)*g-(T-f)*a+u)+n,N=Math.round((T-f)*g+(b-u)*a+f)+o;L<0||L>=e.width||N<0||N>=e.height?e.alpha===1&&C===e.channels-1?t.setValueXY(b,T,C,0):t.setValueXY(b,T,C,e.maxValue):t.setValueXY(b,T,C,e.getValueXY(L,N,C))}return t}function rotateBinaryNearestNeighbor(e,t,n,o,u,f,g,a){for(let b=0;b<t.width;b+=1)for(let T=0;T<t.height;T+=1){let C=Math.round((b-u)*g-(T-f)*a+u)+n,L=Math.round((T-f)*g+(b-u)*a+f)+o;(C<0||C>=e.width||L<0||L>=e.height||e.getBitXY(C,L))&&t.setBitXY(b,T)}return t}function rotateBilinear(e,t,n,o,u,f,g,a){let b=e.width*e.channels;for(let T=0;T<t.height;T++)for(let C=0;C<t.width;C++){let L=(C-u)*g-(T-f)*a+u+n,N=(T-f)*g+(C-u)*a+f+o,F=L|0,H=N|0,se=L-F,ce=N-H;for(let X=0;X<e.channels;X++)if(L<0||L>=e.width||N<0||N>=e.height)e.alpha===1&&X===e.channels-1?t.setValueXY(C,T,X,0):t.setValueXY(C,T,X,e.maxValue);else{let ye=(H*e.width+F)*e.channels+X,oe=e.data[ye],le=e.data[ye+e.channels],ue=e.data[ye+b],Re=e.data[ye+b+e.channels],ze=oe+se*(le-oe)+ce*(ue-oe)+se*ce*(oe-le-ue+Re)|0;t.setValueXY(C,T,X,ze)}}return t}function rotateBinaryBilinear(e,t,n,o,u,f,g,a){let b=e.width;for(let T=0;T<t.height;T++)for(let C=0;C<t.width;C++){let L=(C-u)*g-(T-f)*a+u+n,N=(T-f)*g+(C-u)*a+f+o,F=L|0,H=N|0,se=L-F,ce=N-H;if(L<0||L>=e.width||N<0||N>=e.height)t.setBitXY(C,T);else{let X=H*e.width+F,ye=e.getBit(X),oe=e.getBit(X+1),le=e.getBit(X+b),ue=e.getBit(X+1+b);(ye|se&oe-ye|ce&le-ye|se&ce&ye-oe-le+ue)>0&&t.setBitXY(C,T)}}return t}function rotate$1(e,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,t)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image(this.height,this.width,{kind:"BINARY",parent:this}),t=e.height-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)this.getBitXY(o,n)&&e.setBitXY(n,t-o);return e}else{const e=Image.createFrom(this,{width:this.height,height:this.width}),t=e.height-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)for(let u=0;u<this.channels;u++)e.setValueXY(n,t-o,u,this.getValueXY(o,n,u));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image(this.height,this.width,{kind:"BINARY",parent:this}),t=e.width-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)this.getBitXY(o,n)&&e.setBitXY(t-n,o);return e}else{const e=Image.createFrom(this,{width:this.height,height:this.width}),t=e.width-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)for(let u=0;u<this.channels;u++)e.setValueXY(t-n,o,u,this.getValueXY(o,n,u));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image(this.width,this.height,{kind:"BINARY",parent:this}),t=e.width-1,n=e.height-1;for(let o=0;o<this.height;o++)for(let u=0;u<this.width;u++)this.getBitXY(u,o)&&e.setBitXY(t-u,n-o);return e}else{const e=Image.createFrom(this),t=e.width-1,n=e.height-1;for(let o=0;o<this.height;o++)for(let u=0;u<this.width;u++)for(let f=0;f<this.channels;f++)e.setValueXY(t-u,n-o,f,this.getValueXY(u,o,f));return e}}function insert(e,t={}){const n=getImageParameters(e);this.checkProcessable("insert",n);let{x:o=0,y:u=0}=t;const f=getOutputImageOrInPlace(this,t,{copy:!0}),g=Math.min(f.height,u+e.height),a=Math.min(f.width,o+e.width);if(f.bitDepth===1)for(let b=u;b<g;b++)for(let T=o;T<a;T++)e.getBitXY(T-o,b-u)?f.setBitXY(T,b):f.clearBitXY(T,b);else for(let b=u;b<g;b++)for(let T=o;T<a;T++)f.setPixelXY(T,b,e.getPixelXY(T-o,b-u));return f}function setBorder(e={}){let{size:t=0,algorithm:n="copy",color:o}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),n==="set"){if(o.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let a=0;a<o.length;a++)o[a]===0&&(o[a]=.001)}else o=newArray_1(this.channels,null);Array.isArray(t)||(t=[t,t]);let u=t[0],f=t[1],g=this.channels;for(let a=u;a<this.width-u;a++)for(let b=0;b<g;b++){let T=o[b]||this.data[(a+this.width*f)*g+b];for(let C=0;C<f;C++)this.data[(C*this.width+a)*g+b]=T;T=o[b]||this.data[(a+this.width*(this.height-f-1))*g+b];for(let C=this.height-f;C<this.height;C++)this.data[(C*this.width+a)*g+b]=T}for(let a=0;a<this.height;a++)for(let b=0;b<g;b++){let T=o[b]||this.data[(a*this.width+u)*g+b];for(let C=0;C<u;C++)this.data[(a*this.width+C)*g+b]=T;T=o[b]||this.data[(a*this.width+this.width-u-1)*g+b];for(let C=this.width-u;C<this.width;C++)this.data[(a*this.width+C)*g+b]=T}return this}function split(e={}){let{preserveAlpha:t=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let n=new Stack,o=this.data;if(this.alpha&&t)for(let u=0;u<this.components;u++){let f=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),g=0;for(let a=0;a<o.length;a+=this.channels)f.data[g++]=o[a+u],f.data[g++]=o[a+this.components];n.push(f)}else for(let u=0;u<this.channels;u++){let f=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),g=0;for(let a=0;a<o.length;a+=this.channels)f.data[g++]=o[a+u];n.push(f)}return n}function getChannel(e,t={}){let{keepAlpha:n=!1,mergeAlpha:o=!1}=t;n&=this.alpha,o&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let u=Image.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),f=0;for(let g=0;g<this.data.length;g+=this.channels)o?u.data[f++]=this.data[g+e]*this.data[g+this.components]/this.maxValue:(u.data[f++]=this.data[g+e],n&&(u.data[f++]=this.data[g+this.components]));return u}function combineChannels(e=defaultCombineMethod,t={}){let{mergeAlpha:n=!1,keepAlpha:o=!1}=t;n&=this.alpha,o&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let u=Image.createFrom(this,{components:1,alpha:o,colorModel:GREY$1}),f=0;for(let g=0;g<this.size;g++){let a=e(this.getPixel(g));n?u.data[f++]=a*this.data[g*this.channels+this.components]/this.maxValue:(u.data[f++]=a,o&&(u.data[f++]=this.data[g*this.channels+this.components]))}return u}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let n=e;for(let o=0;o<t.data.length;o++)this.data[n]=t.data[o],n+=this.channels;return this}function getSimilarity(e,t={}){let{shift:n=[0,0],average:o,channels:u,defaultAlpha:f,normalize:g,border:a=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(a)||(a=[a,a]),u=validateArrayOfChannels(this,{channels:u,defaultAlpha:f}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof o>"u"&&(o=!0);let b=Math.max(a[0],-n[0]),T=Math.min(this.width-a[0],this.width-n[0]),C=Math.max(a[1],-n[1]),L=Math.min(this.height-a[1],this.height-n[1]),N=newArray_1(u.length,0);for(let F=0;F<u.length;F++){let H=u[F],se=g?this.sum[H]:Math.max(this.sum[H],e.sum[H]),ce=g?e.sum[H]:Math.max(this.sum[H],e.sum[H]);if(se!==0&&ce!==0)for(let X=b;X<T;X++)for(let ye=C;ye<L;ye++){let oe=X*this.multiplierX+ye*this.multiplierY+H,le=oe+n[0]*this.multiplierX+n[1]*this.multiplierY;N[F]+=Math.min(this.data[oe]/se,e.data[le]/ce)}}return o?N.reduce((F,H)=>F+H)/N.length:N}function getPixelsGrid(e={}){let{sampling:t=[10,10],painted:n=!1,mask:o}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const u=t[0],f=t[1],g=[],a=[],b=this.width/u,T=this.height/f;let C=Math.floor(b/2);for(let N=0;N<u;N++){let F=Math.floor(T/2);for(let H=0;H<f;H++){let se=Math.round(C),ce=Math.round(F);(!o||o.getBitXY(se,ce))&&(g.push([se,ce]),a.push(this.getPixelXY(se,ce))),F+=T}C+=b}const L={xyS:g,zS:a};return n&&(L.painted=this.rgba8().paintPoints(g)),L}function Matrix(e,t,n){const o=new Array(e);for(let u=0;u<e;u++)o[u]=new Array(t);if(n)for(let u=0;u<e;u++)for(let f=0;f<t;f++)o[u][f]=n;return o.width=e,o.height=t,Object.setPrototypeOf(o,Matrix.prototype),o}Matrix.prototype.localMin=function(e,t){let n=this[e][t],o=[e,t];for(let u=Math.max(0,e-1);u<Math.min(this.length,e+2);u++)for(let f=Math.max(0,t-1);f<Math.min(this[0].length,t+2);f++)this[u][f]<n&&(n=this[u][f],o=[u,f]);return{position:o,value:n}};Matrix.prototype.localMax=function(e,t){let n=this[e][t],o=[e,t];for(let u=Math.max(0,e-1);u<Math.min(this.length,e+2);u++)for(let f=Math.max(0,t-1);f<Math.min(this[0].length,t+2);f++)this[u][f]>n&&(n=this[u][f],o=[u,f]);return{position:o,value:n}};Matrix.prototype.localSearch=function(e,t,n){let o=[];for(let u=Math.max(0,e-1);u<Math.min(this.length,e+2);u++)for(let f=Math.max(0,t-1);f<Math.min(this[0].length,t+2);f++)this[u][f]===n&&o.push([u,f]);return o};function getBestMatch(e,t={}){let{border:n}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let o=new Matrix(e.width,e.height,-1/0),u=Math.floor(e.width/2),f=Math.floor(e.height/2),g=u,a=f,b=!1;for(;!b;){let T=o.localSearch(u,f,-1/0);for(let L=0;L<T.length;L++){let N=T[L],F=this.getSimilarity(e,{border:n,shift:[g-N[0],a-N[1]]});o[N[0]][N[1]]=F}let C=o.localMax(u,f);C.position[0]!==u||C.position[1]!==f?(u=C.position[0],f=C.position[1]):b=!0}return[u-g,f-a]}function getRow(e,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,t);let n=new Array(this.width),o=0,u=e*this.width*this.channels+t,f=u+this.width*this.channels;for(let g=u;g<f;g+=this.channels)n[o++]=this.data[g];return n}function getColumn(e,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,t);let n=new Array(this.height),o=0,u=this.width*this.channels;for(let f=t+e*this.channels;f<this.data.length;f+=u)n[o++]=this.data[f];return n}function getMatrix(e={}){let{channel:t}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let n=new Matrix$2(this.height,this.width);for(let o=0;o<this.height;o++)for(let u=0;u<this.width;u++)n.set(o,u,this.getValueXY(u,o,t));return n}function setMatrix(e,t={}){e=new Matrix$2(e);let{channel:n}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),n===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");n=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let o=0;o<this.height;o++)for(let u=0;u<this.width;u++)this.setValueXY(u,o,n,e.get(o,u))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),t=0;for(let n=0;n<this.data.length;n+=this.channels){let o=new Array(this.components);for(let u=0;u<this.components;u++)o[u]=this.data[n+u];e[t++]=o}return e}function getIntersection(e){let t=this,n=t.getClosestCommonParent(e),o=t.getRelativePosition(n,{defaultFurther:!0}),u=getRelativePositionForAllPixels(t,o),f=e.getRelativePosition(n,{defaultFurther:!0}),g=getRelativePositionForAllPixels(e,f),a=getCommonSurface(u,g),b={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let T=0;T<a.length;T++){let C=a[T],L=[C[0]-o[0],C[1]-o[1]],N=[C[0]-f[0],C[1]-f[1]],F=t.getBitXY(L[0],L[1]),H=e.getBitXY(N[0],N[1]);F===1&&H===1&&b.commonWhitePixels.push(C)}for(let T=0;T<u.length;T++){let C,L;T!==0&&(C=Math.floor(T/t.width),L=T%t.width),t.getBitXY(C,L)===1&&b.whitePixelsMask1.push(u[T])}for(let T=0;T<g.length;T++){let C=0,L=0;T!==0&&(C=Math.floor(T/e.width),L=T%e.width),e.getBitXY(C,L)===1&&b.whitePixelsMask2.push(g[T])}return b}function getRelativePositionForAllPixels(e,t){let n=[];for(let o=0;o<e.height;o++)for(let u=0;u<e.width;u++){let f=[o,u];n.push([f[0]+t[0],f[1]+t[1]])}return n}function getCommonSurface(e,t){let n=0,o=0,u=[];for(;n<e.length&&o<t.length;)e[n][0]===t[o][0]&&e[n][1]===t[o][1]?(u.push(e[n]),n++,o++):e[n][0]<t[o][0]||e[n][0]===t[o][0]&&e[n][1]<t[o][1]?n++:o++;return u}function getClosestCommonParent(e){let t=getDepth(this),n=getDepth(e),o;if(t>=n?o=getFurthestParent(this,t):o=getFurthestParent(e,n),t===0||n===0)return o;let u=this,f=e;for(;t!==n;)if(t>n){if(u=u.parent,u===null)return o;t=t-1}else{if(f=f.parent,f===null)return o;n=n-1}for(;u!==f&&u!==null&&f!==null;)if(u=u.parent,f=f.parent,u===null||f===null)return o;return u!==f?o:u}function getDepth(e){let t=0,n=e;for(;n.parent!=null;)n=n.parent,t++;return t}function getFurthestParent(e,t){let n=e;for(;t>0;)n=n.parent,t=t-1;return n}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,t){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$1,t);const n=e.width,o=e.height,u=e.maxValue,f={sigma:t.gaussianBlur,radius:3},g=e.gaussianFilter(f),a=g.convolution(Gy,convOptions),b=g.convolution(Gx,convOptions),T=b.hypotenuse(a),C=e.constructor,L=new C(n,o,{kind:"GREY",bitDepth:32}),N=new C(n,o,{kind:"GREY",bitDepth:32}),F=new C(n,o,{kind:"GREY"});for(var H=1;H<n-1;H++)for(var se=1;se<o-1;se++){var ce=(Math.round(Math.atan2(b.getValueXY(H,se,0),a.getValueXY(H,se,0))*(5/Math.PI))+5)%5;ce===0&&(T.getValueXY(H,se,0)<=T.getValueXY(H,se-1,0)||T.getValueXY(H,se,0)<=T.getValueXY(H,se+1,0))||ce===1&&(T.getValueXY(H,se,0)<=T.getValueXY(H-1,se+1,0)||T.getValueXY(H,se,0)<=T.getValueXY(H+1,se-1,0))||ce===2&&(T.getValueXY(H,se,0)<=T.getValueXY(H-1,se,0)||T.getValueXY(H,se,0)<=T.getValueXY(H+1,se,0))||ce===3&&(T.getValueXY(H,se,0)<=T.getValueXY(H-1,se-1,0)||T.getValueXY(H,se,0)<=T.getValueXY(H+1,se+1,0))||L.setValueXY(H,se,0,T.getValueXY(H,se,0))}for(H=0;H<n*o;++H){var X=L.data[H],ye=0;X>t.highThreshold&&(ye++,F.data[H]=u),X>t.lowThreshold&&ye++,N.data[H]=ye}var oe=[];for(H=1;H<n-1;++H)for(se=1;se<o-1;++se){if(N.getValueXY(H,se,0)!==1)continue;e:for(var le=H-1;le<H+2;++le)for(var ue=se-1;ue<se+2;++ue)if(N.getValueXY(le,ue,0)===2){oe.push([H,se]),F.setValueXY(H,se,0,u);break e}}for(;oe.length>0;){var Re=[];for(H=0;H<oe.length;++H)for(se=-1;se<2;++se)for(le=-1;le<2;++le)if(!(se===0&&le===0)){var ze=oe[H][0]+se,ve=oe[H][1]+le;N.getValueXY(ze,ve,0)===1&&F.getValueXY(ze,ve,0)===0&&(Re.push([ze,ve]),F.setValueXY(ze,ve,0,u))}oe=Re}return F}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,t={}){let{position:n}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!n&&(n=e.getRelativePosition(this),!n))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let o=Image.createFrom(this,{width:e.width,height:e.height,alpha:1,position:n,parent:this});for(let u=0;u<e.width;u++)for(let f=0;f<e.height;f++){for(let g=0;g<this.channels;g++){let a=this.getValueXY(u+n[0],f+n[1],g);o.setValueXY(u,f,g,a)}e.getBitXY(u,f)||o.setValueXY(u,f,this.components,0)}return o}else{let o=Image.createFrom(this,{width:e.width,height:e.height,position:n,parent:this});for(let u=0;u<e.height;u++)for(let f=0;f<e.width;f++)e.getBitXY(f,u)&&this.getBitXY(f+n[0],u+n[1])&&o.setBitXY(f,u);return o}}var fastList={exports:{}};(function(e,t){(function(){function n(u,f,g){this.next=g,g&&(g.prev=this),this.prev=f,f&&(f.next=this),this.data=u}function o(){if(!(this instanceof o))return new o;this._head=null,this._tail=null,this.length=0}o.prototype={push:function(u){this._tail=new n(u,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var u=this._tail;return this._tail=u.prev,u.prev&&(u.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),u.data}},unshift:function(u){this._head=new n(u,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var u=this._head;return this._head=u.next,u.next&&(u.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),u.data}},item:function(u){u<0&&(u=this.length+u);for(var f=this._head;u-- >0&&f;)f=f.next;return f?f.data:void 0},slice:function(u,f){if(u||(u=0),f||(f=this.length),f<0&&(f=this.length+f),u<0&&(u=this.length+u),f===u)return[];if(f<u)throw new Error("invalid offset: "+u+","+f+" (length="+this.length+")");for(var g=f-u,a=new Array(g),b=0,T=this._head;u-- >0&&T;)T=T.next;for(;b<g&&T;)a[b++]=T.data,T=T.next;return a},drop:function(){o.call(this)},forEach:function(u,f){for(var g=this._head,a=0,b=this.length;a<b&&g;)u.call(f||this,g.data,a,this),g=g.next,a++},map:function(u,f){var g=new o;return this.forEach(function(a,b,T){g.push(u.call(f||T,a,b,T))}),g},filter:function(u,f){var g=new o;return this.forEach(function(a,b,T){u.call(f||T,a,b,T)&&g.push(a)}),g},reduce:function(u,f,g){var a=0,b=this._head,T=this.length;for(f||(a=1,f=b&&b.data,b=b&&b.next);a<T&&b;)f=u.call(g||this,f,b.data,this),a++,b=b.next;return f}},e.exports=o})()})(fastList);var LinkedList=fastList.exports;function floodFill(e={}){const{x:t=0,y:n=0,inPlace:o=!0}=e,u=o?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,n))return u;const g=new LinkedList;for(g.push(new Node(t,n));g.length>0;){const a=g.shift();u.setBitXY(a.x,a.y);for(let b=a.x+1;b<this.width&&(!u.getBitXY(b,a.y)&&!this.getBitXY(b,a.y));b++)u.setBitXY(b,a.y),a.y+1<this.height&&!this.getBitXY(b,a.y+1)&&g.push(new Node(b,a.y+1)),a.y-1>=0&&!this.getBitXY(b,a.y-1)&&g.push(new Node(b,a.y-1));for(let b=a.x-1;b>=0&&(!u.getBitXY(b,a.y)&&!this.getBitXY(b,a.y));b++)u.setBitXY(b,a.y),a.y+1<this.height&&!this.getBitXY(b,a.y+1)&&g.push(new Node(b,a.y+1)),a.y-1>=0&&!this.getBitXY(b,a.y-1)&&g.push(new Node(b,a.y-1))}return u}function Node(e,t){this.x=e,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_extends.apply(this,arguments)}function hsv2rgb(e,t,n){t=t/100,n=n/100;var o=[],u=n*t,f=e/60,g=u*(1-Math.abs(f%2-1)),a=n-u;return f>=0&&f<1?o=[u,g,0]:f>=1&&f<2?o=[g,u,0]:f>=2&&f<3?o=[0,u,g]:e>=3&&f<4?o=[0,g,u]:e>=4&&f<5?o=[g,0,u]:e>=5&&f<=6?o=[u,0,g]:o=[0,0,0],{r:Math.round(255*(o[0]+a)),g:Math.round(255*(o[1]+a)),b:Math.round(255*(o[2]+a))}}function hsl2hsv(e,t,n){return t*=(n<50?n:100-n)/100,{h:e,s:2*t/(n+t)*100,v:n+t}}function hsl2rgb$1(e,t,n){var o=hsl2hsv(e,t,n);return hsv2rgb(o.h,o.s,o.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var t=colors[e.toLowerCase()];if(!!t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(e){var t=e.match(/rgb\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */).map(Number);return{r:n[0],g:n[1],b:n[2],a:100}}}function rgba$1(e){var t=e.match(/rgba\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */).map(Number);return{r:n[0],g:n[1],b:n[2],a:n[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var t=e.match(/hsl\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */),o=parseInt(n[0],10),u=parseInt(n[1],10),f=parseInt(n[2],10),g=hsl2rgb$1(o,u,f);return _extends({},g,{a:100})}}function hsla(e){var t=e.match(/hsla\(([^)]+)\)/);if(t){var n=t[1].split(/ *, */),o=parseInt(n[0],10),u=parseInt(n[1],10),f=parseInt(n[2],10),g=parseInt(parseFloat(n[3])*100,10),a=hsl2rgb$1(o,u,f);return _extends({},a,{a:g})}}function css2array(e){let t=parse(e);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function hsl2rgb(e,t,n){let o,u,f,g,a,b;return t/=100,n/=100,t===0?g=a=b=n*255:(n<=.5?u=n*(t+1):u=n+t-n*t,o=n*2-u,f=e/360,g=hue2rgb(o,u,f+1/3),a=hue2rgb(o,u,f),b=hue2rgb(o,u,f-1/3)),{r:g,g:a,b}}function getDistinctColors(e){let t=new Array(e),n=0;for(let o=0;o<360;o+=360/e){n++;let u=hsl2rgb(o,100,30+n%4*15);t[n-1]=[Math.round(u.r*255),Math.round(u.g*255),Math.round(u.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:t,colors:n,randomColors:o,numberColors:u=50}=e;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(n)return n=n.map(function(f){return Array.isArray(f)?f:css2array(f)}),n;if(o){n=new Array(u);for(let f=0;f<u;f++)n[f]=getRandomColor()}return getDistinctColors(u)}function paintLabels(e,t,n={}){let{color:o="blue",colors:u,font:f="12px Helvetica",rotate:g=0}=n;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(o&&!Array.isArray(o)&&(o=css2array(o)),u?u=u.map(function(T){return Array.isArray(T)?T:css2array(T)}):u=[o],e.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(f)||(f=[f]),Array.isArray(g)||(g=[g]);let b=this.getCanvas().getContext("2d");for(let T=0;T<e.length;T++){b.save();let C=u[T%u.length];b.fillStyle=`rgba(${C[0]},${C[1]},${C[2]},${C[3]/this.maxValue})`,b.font=f[T%f.length];let L=t[T];b.translate(L[0],L[1]),b.rotate(g[T%g.length]/180*Math.PI),b.fillText(e[T],0,0),b.restore()}return this.data=Uint8Array.from(b.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,t={}){let{alpha:n=255,labels:o=[],labelsPosition:u=[],labelColor:f="blue",labelFont:g="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let a=getColors(Object.assign({},t,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let b=0;b<e.length;b++){let T=e[b],C=a[b%a.length];for(let L=0;L<T.width;L++)for(let N=0;N<T.height;N++)if(T.getBitXY(L,N))for(let F=0;F<Math.min(this.components,C.length);F++)if(n===255)this.setValueXY(L+T.position[0],N+T.position[1],F,C[F]);else{let H=this.getValueXY(L+T.position[0],N+T.position[1],F);H=Math.round((H*(255-n)+C[F]*n)/255),this.setValueXY(L+T.position[0],N+T.position[1],F,H)}}if(Array.isArray(o)&&o.length>0){let T=this.getCanvas().getContext("2d");T.fillStyle=f,T.font=g;for(let C=0;C<Math.min(e.length,o.length);C++){let L=u[C]?u[C]:e[C].position;T.fillText(o[C],L[0],L[1])}this.data=Uint8Array.from(T.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,t){let n=new Array(e);for(let o=0;o<e;o++)n[o]=new Array(t).fill(0);return n}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:n="cross",shape:o,size:u,width:f,height:g,filled:a=!0}=t;if(u&&(f=u,g=u),o)switch(o.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(f,g,{filled:a});break;case"circle":case"ellipse":this.matrix=ellipse(f,g,{filled:a});break;case"triangle":this.matrix=triangle(f,g,{filled:a});break;default:throw new Error(`Shape: unexpected shape: ${o}`)}else if(n)switch(n.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${n}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,n=[];for(let o=0;o<t.length;o++)for(let u=0;u<t[0].length;u++)t[o][u]&&n.push([u-this.halfWidth,o-this.halfHeight]);return n}getMask(){let t=new Image(this.width,this.height,{kind:BINARY});for(let n=0;n<this.matrix.length;n++)for(let o=0;o<this.matrix[0].length;o++)this.matrix[n][o]&&t.setBitXY(o,n);return t}}function rectangle(e,t,n){const o=zerosMatrix(t,e);if(n.filled)for(let u=0;u<t;u++)for(let f=0;f<e;f++)o[u][f]=1;else{for(let u of[0,t-1])for(let f=0;f<e;f++)o[u][f]=1;for(let u=0;u<t;u++)for(let f of[0,e-1])o[u][f]=1}return o}function ellipse(e,t,n){const o=zerosMatrix(t,e);let u=1-t%2,f=1-e%2,g=Math.floor((e-1)/2),a=Math.floor((t-1)/2),b=g*g,T=a*a;if(n.filled)for(let C=0;C<=a;C++){let L=Math.floor(Math.sqrt(b-b*C*C/T));for(let N=g-L;N<=g;N++)o[a-C][N]=1,o[a+C+u][N]=1,o[a-C][e-N-1]=1,o[a+C+u][e-N-1]=1}else{for(let C=0;C<=a;C++){let L=Math.floor(Math.sqrt(b-b*C*C/T)),N=g-L;o[a-C][N]=1,o[a+C+u][N]=1,o[a-C][e-N-1]=1,o[a+C+u][e-N-1]=1}for(let C=0;C<=g;C++){let L=Math.floor(Math.sqrt(T-T*C*C/b)),N=a-L;o[N][g-C]=1,o[N][g+C+f]=1,o[t-N-1][g-C]=1,o[t-N-1][g+C+f]=1}}return o}function triangle(e,t,n){if(!n.filled)throw new Error("Non filled triangle is not implemented");const o=zerosMatrix(t,e);for(let u=0;u<t;u++){let f=Math.floor((1-u/t)*e/2);for(let g=f;g<e-f;g++)o[u][g]=1}return o}function paintPoints(e,t={}){let{shape:n}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let o=getColors(Object.assign({},t,{numberColors:e.length})),u=new Shape(n).getPoints(),f=Math.min(this.channels,o[0].length);for(let g=0;g<e.length;g++){let a=o[g%o.length],b=e[g][0],T=e[g][1];for(let C=0;C<u.length;C++){let L=u[C][0],N=u[C][1];if(b+L>=0&&T+N>=0&&b+L<this.width&&T+N<this.height){let F=(b+L+(T+N)*this.width)*this.channels;for(let H=0;H<f;H++)this.data[F+H]=a[H]}}}return this}function paintPolyline(e,t={}){let{color:n=[this.maxValue,0,0],closed:o=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let u=Math.min(this.channels,n.length);for(let f=0;f<e.length-1+o;f++){let g=e[f],a=e[(f+1)%e.length],b=a[0]-g[0],T=a[1]-g[1],C=Math.max(Math.abs(b),Math.abs(T)),L=b/C,N=T/C,F=g[0],H=g[1];for(let se=0;se<=C;se++){let ce=Math.round(F),X=Math.round(H);if(ce>=0&&X>=0&&ce<this.width&&X<this.height)if(this.bitDepth===1)this.setBitXY(ce,X);else{let ye=(ce+X*this.width)*this.channels;for(let oe=0;oe<u;oe++)this.data[ye+oe]=n[oe]}F=F+L,H=H+N}}return this}function paintPolylines(e,t={}){let n=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let o=getColors(Object.assign({},t,{numberColors:e.length}));for(let u=0;u<e.length;u++)n.color=o[u%o.length],this.paintPolyline(e[u],n);return this}function paintPolygon(e,t={}){let{color:n=[this.maxValue,0,0],filled:o=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let u=deleteDouble(e);if(o===!1)return this.paintPolyline(e,t);{let f=Array(this.height);for(let g=0;g<this.height;g++){f[g]=[];for(let a=0;a<this.width;a++)f[g].push(0)}for(let g=0;g<u.length;g++){const a=lineBetweenTwoPoints(u[g],u[(g+1)%u.length]);for(let b=0;b<this.height;b++)for(let T=0;T<this.width;T++)isAtTheRightOfTheLine(T,b,a,this.height)&&(f[b][T]=f[b][T]===0?1:0)}for(let g=0;g<this.height;g++)for(let a=0;a<this.width;a++)if(f[g][a]===1)if(this.bitDepth===1)this.setBitXY(a,g);else{let b=Math.min(this.channels,n.length),T=(a+g*this.width)*this.channels;for(let C=0;C<b;C++)this.data[T+C]=n[C]}return this.paintPolyline(e,t)}}function deleteDouble(e){let t=[];for(let n=0;n<e.length;n++)if(!(e[n][0]===e[(n+1)%e.length][0]&&e[n][1]===e[(n+1)%e.length][1])){if(e[n][0]===e[(n-1+e.length)%e.length][0]&&e[n][1]===e[(n-1+e.length)%e.length][1])continue;if(e[(n+1)%e.length][0]===e[(n-1+e.length)%e.length][0]&&e[(n-1+e.length)%e.length][1]===e[(n+1)%e.length][1])continue;t.push(e[n])}return t}function lineBetweenTwoPoints(e,t){if(e[0]===t[0])return{a:0,b:e[0],vertical:!0};{const n=(t[1]-e[1])/(t[0]-e[0]),o=e[1]-n*e[0];return{a:n,b:o,vertical:!1}}}function isAtTheRightOfTheLine(e,t,n,o){if(n.vertical===!0)return n.b<=e;if(n.a===0)return!1;{const u=(t-n.b)/n.a;return u<e&&u>=0&&u<=o}}function paintPolygons(e,t={}){let n=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let o=getColors(Object.assign({},t,{numberColors:e.length}));for(let u=0;u<e.length;u++)n.color=o[u%o.length],this.paintPolygon(e[u],n);return this}function getHistogram(e={}){let{maxSlots:t=256,channel:n,useAlpha:o=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),n===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");n=0}return getChannelHistogram.call(this,n,{useAlpha:o,maxSlots:t})}function getHistograms(e={}){const{maxSlots:t=256,useAlpha:n=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let o=new Array(n?this.components:this.channels);for(let u=0;u<o.length;u++)o[u]=getChannelHistogram.call(this,u,{useAlpha:n,maxSlots:t});return o}function getChannelHistogram(e,t){let{useAlpha:n,maxSlots:o}=t;if(this.bitDepth===1){let b=[0,0];for(let T=0;T<this.height;T++)for(let C=0;C<this.width;C++){let L=this.getBitXY(T,C);L===0?b[0]+=1:L===1&&(b[1]+=1)}return b}let u=Math.log2(o);if(!isInteger(u))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let f=0;this.bitDepth>u&&(f=this.bitDepth-u);let g=this.data,a=newArray_1(Math.pow(2,Math.min(this.bitDepth,u)),0);if(n&&this.alpha){let b=this.channels-e-1;for(let T=e;T<g.length;T+=this.channels)a[g[T]>>f]+=g[T+b]/this.maxValue}else for(let b=e;b<g.length;b+=this.channels)a[g[b]>>f]++;return a}function getColorHistogram(e={}){let{useAlpha:t=!0,nbSlots:n=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let o=Math.log(n)/Math.log(8);if(o!==Math.floor(o))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let u=this.bitDepth-o,f=this.data,g=newArray_1(Math.pow(8,o),0),a=Math.pow(2,o*2),b=Math.pow(2,o);for(let T=0;T<f.length;T+=this.channels){let C=(f[T]>>u)*a+(f[T+1]>>u)*b+(f[T+2]>>u);t&&this.alpha?g[C]+=f[T+this.channels-1]/this.maxValue:g[C]++}return g}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray_1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let n=0;n<this.channels;n++)this.data[t+n]<e[n]&&(e[n]=this.data[t+n]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray_1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let n=0;n<this.channels;n++)this.data[t+n]>e[n]&&(e[n]=this.data[t+n]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray_1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let n=0;n<this.channels;n++)e[n]+=this.data[t+n];return e}function getMoment(e=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let n=0;for(let o=0;o<this.width;o++)for(let u=0;u<this.height;u++)this.getBitXY(o,u)===1&&(n+=o**e*u**t);return n}function localMaxima(e={}){let{mask:t,region:n=3,removeClosePoints:o=0,invert:u=!1,maxEquals:f=2}=e,g=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),n*=4;let a=u?0:1,b=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],T=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],C=n<=8?1:2,L=[];for(let N=C;N<g.height-C;N++)for(let F=C;F<g.width-C;F++){if(t&&t.getBitXY(F,N)!==a)continue;let H=0,se=0,ce=g.data[F+N*g.width];for(let X=0;X<n;X++)u?g.data[F+b[X]+(N+T[X])*g.width]>ce&&H++:g.data[F+b[X]+(N+T[X])*g.width]<ce&&H++,g.data[F+b[X]+(N+T[X])*g.width]===ce&&se++;H+se===n&&se<=f&&L.push([F,N])}if(o>0)for(let N=0;N<L.length;N++)for(let F=N+1;F<L.length;F++)Math.sqrt(Math.pow(L[N][0]-L[F][0],2)+Math.pow(L[N][1]-L[F][1],2))<o&&(L[N][0]=L[N][0]+L[F][0]>>1,L[N][1]=L[N][1]+L[F][1]>>1,L.splice(F,1),F--);return L}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let n=0;n<e.length;n++){let o=e[n];t[n]=mean$2(o)}return t}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let n=0;n<e.length;n++){let o=e[n];t[n]=median$2(o)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++)this.getBitXY(t,n)===1&&e.push([t,n]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)if(this.getBitXY(n,t)===1)for(e.push([n,t]),this.getBitXY(n+1,t)!==1?(e.push([n+1,t]),e.push([n+1,t+1]),this.getBitXY(n,t+1)!==1&&e.push([n,t+1])):this.getBitXY(n,t+1)!==1&&(e.push([n,t+1]),e.push([n+1,t+1]));n<this.width-2&&this.getBitXY(n+1,t)===1&&this.getBitXY(n+2,t)===1;)n++;return e}function getRelativePosition(e,t={}){if(this===e)return[0,0];let n=[0,0],o=this;for(;o;){if(o===e)return n;o.position&&(n[0]+=o.position[0],n[1]+=o.position[1]),o=o.parent}return t.defaultFurther?n:!1}function countAlphaPixels(e={}){let{alpha:t=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let n=0;if(t!==void 0){for(let o=this.components;o<this.data.length;o+=this.channels)this.data[o]===t&&n++;return n}else return this.size}function monotoneChainConvexHull$1(e,t={}){const{sorted:n}=t;n||(e=e.slice().sort(byXThenY));const o=e.length,u=new Array(o*2);let f=0;for(let a=0;a<o;a++){const b=e[a];for(;f>=2&&cw(u[f-2],u[f-1],b)<=0;)f--;u[f++]=b}const g=f+1;for(let a=o-2;a>=0;a--){const b=e[a];for(;f>=g&&cw(u[f-2],u[f-1],b)<=0;)f--;u[f++]=b}return u.slice(0,f-1)}function cw(e,t,n){return(t[1]-e[1])*(n[0]-e[0])-(t[0]-e[0])*(n[1]-e[1])}function byXThenY(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let t=0;t<e.length;t++)e[t][0]=Math.round(e[t][0]),e[t][1]=Math.round(e[t][1]);return e}function difference(e,t){return[e[0]-t[0],e[1]-t[1]]}function normalize(e){let t=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/t,e[1]/t]}function rotate(e,t,n){n===void 0&&(n=new Array(t.length));let o=Math.cos(e),u=Math.sin(e);for(let f=0;f<n.length;++f)n[f]=[o*t[f][0]-u*t[f][1],u*t[f][0]+o*t[f][1]];return n}function perimeter(e){let t=0;for(let n=0;n<e.length;n++){let o=e[n][0],u=e[n][1],f=e[n===e.length-1?0:n+1][0],g=e[n===e.length-1?0:n+1][1];t+=Math.sqrt((f-o)**2+(g-u)**2)}return t}function surface(e){let t=0;for(let n=0;n<e.length;n++){let o=e[n][0],u=e[n===e.length-1?0:n+1][1],f=e[n===e.length-1?0:n+1][0],g=e[n][1];t+=o*u*.5,t-=f*g*.5}return Math.abs(t)}function minMax(e){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(let f=0;f<e.length;f++)e[f][0]<t&&(t=e[f][0]),e[f][0]>o&&(o=e[f][0]),e[f][1]<n&&(n=e[f][1]),e[f][1]>u&&(u=e[f][1]);return[[t,n],[o,u]]}function moveToZeroZero(e,t){t===void 0&&(t=new Array(e.length).fill(0).map(()=>[]));let n=minMax(e),o=n[0][0],u=n[0][1];for(let f=0;f<e.length;f++)t[f][0]=e[f][0]-o,t[f][1]=e[f][1]-u;return t}function minimalBoundingRectangle(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const n=new Array(t.length);let o=1/0,u=0,f;for(let g=0;g<n.length;g++){let a=getAngle$1(t[g],t[(g+1)%n.length]);rotate(-a,t,n);let b=n[g][0],T=n[g][1],C=n[(g+1)%n.length][0],L=n[(g+1)%n.length][1],N=!0,F=0,H=0,se=0;for(let oe=0;oe<n.length;oe++){let le=n[oe][0],ue=n[oe][1],Re=(le-b)/(C-b);N===!0?(N=!1,F=Re,H=Re):(Re<F&&(F=Re),Re>H&&(H=Re));let ze=(-(C-b)*ue+C*T-L*b)/(C-b);Math.abs(ze)>Math.abs(se)&&(se=ze)}let ce=[b+F*(C-b),T],X=[b+H*(C-b),T],ye=Math.abs(se*(F-H)*(C-b));ye<o&&(u=a,o=ye,f=[ce,X,[X[0],X[1]-se],[ce[0],ce[1]-se]])}return rotate(u,f,f),f}function getAngle$1(e,t){let n=difference(t,e),o=normalize(n),u=Math.acos(o[0]);return o[1]<0?-u:u}function extend$4(e){let t={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,t),e.extendMethod("add",add,t),e.extendMethod("subtract",subtract,t),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,t),e.extendMethod("divide",divide,t),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,t),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,t),e.extendMethod("paintMasks",paintMasks,t),e.extendMethod("paintPoints",paintPoints,t),e.extendMethod("paintPolyline",paintPolyline,t),e.extendMethod("paintPolylines",paintPolylines,t),e.extendMethod("paintPolygon",paintPolygon,t),e.extendMethod("paintPolygons",paintPolygons,t),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(e,t){(function(n,o){e.exports=o()})(commonjsGlobal,function(){function n(Ie){return typeof Ie=="string"||Ie instanceof String}var o=Number.isFinite||window.isFinite;function u(Ie){return o(Ie)}function f(Ie){return Ie}function g(Ie){var ut={};return Ie.filter(function(Bt){return ut.hasOwnProperty(Bt)?!1:ut[Bt]=!0})}function a(Ie,ut){if(ut.length!==Ie.length)return!1;for(var Bt=0;Bt<Ie.length;Bt++)if(ut[Bt].compareArray&&!ut[Bt].compareArray(Ie[Bt])||ut[Bt]!==Ie[Bt])return!1;return!0}function b(Ie,ut){Object.keys(ut).forEach(function(Bt){Ie[Bt]=ut[Bt]})}function T(){for(var Ie=1,ut=0,Bt=0;Bt<arguments.length;Bt++){var _e=arguments[Bt];ut=ut+N(_e),Ie*=_e}return ut!==0?L(Ie,ut):Ie}function C(Ie,ut){if(ut===0)throw new Error("Divide by zero");var Bt=Math.pow(10,N(ut)),_e=Bt/(Bt*ut);return T(Ie,_e)}function L(Ie,ut){return Math.round(Ie*Math.pow(10,ut))/Math.pow(10,ut)}function N(Ie){if(!isFinite(Ie))return 0;for(var ut=0;Ie%1!==0;)Ie*=10,ut++;return ut}function F(){var Ie;if(!this)return Ie=Object.create(F.prototype),F.apply(Ie,arguments),Ie;Ie=Error.apply(this,arguments),this.name="QtyError",this.message=Ie.message,this.stack=Ie.stack}F.prototype=Object.create(Error.prototype,{constructor:{value:F}});function H(Ie,ut){throw new F("Incompatible units: "+Ie+" and "+ut)}var se={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","\u03BC","\xB5","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","\u03A9","\u2126"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},ce=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],X="<1>",ye=[X];function oe(Ie,ut){var Bt=ut[1],_e=ut[3]||[],ae=ut[4]||[];if(!u(Bt))throw new F(Ie+": Invalid unit definition. 'scalar' must be a number");_e.forEach(function(fe){if(se[fe]===void 0)throw new F(Ie+": Invalid unit definition. Unit "+fe+" in 'numerator' is not recognized")}),ae.forEach(function(fe){if(se[fe]===void 0)throw new F(Ie+": Invalid unit definition. Unit "+fe+" in 'denominator' is not recognized")})}var le={},ue={},Re={},ze={},ve={};for(var be in se)if(se.hasOwnProperty(be)){var de=se[be];if(de[2]==="prefix"){le[be]=de[1];for(var Te=0;Te<de[0].length;Te++)ue[de[0][Te]]=be}else{oe(be,de),Re[be]={scalar:de[1],numerator:de[3],denominator:de[4]};for(var Ge=0;Ge<de[0].length;Ge++)ze[de[0][Ge]]=be}ve[be]=de[0][0]}function Ke(Ie){var ut,Bt=[],_e=Object.keys(se);if(typeof Ie>"u")for(ut=0;ut<_e.length;ut++)["","prefix"].indexOf(se[_e[ut]][2])===-1&&Bt.push(_e[ut].substr(1,_e[ut].length-2));else{if(this.getKinds().indexOf(Ie)===-1)throw new F("Kind not recognized");for(ut=0;ut<_e.length;ut++)se[_e[ut]][2]===Ie&&Bt.push(_e[ut].substr(1,_e[ut].length-2))}return Bt.sort(function(ae,fe){return ae.toLowerCase()<fe.toLowerCase()?-1:ae.toLowerCase()>fe.toLowerCase()?1:0})}function St(Ie){if(!ze[Ie])throw new F("Unit not recognized");return se[ze[Ie]][0]}var xt=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function Lr(){if(this.signature)return this.signature;for(var Ie=Nr.call(this),ut=0;ut<Ie.length;ut++)Ie[ut]*=Math.pow(20,ut);return Ie.reduce(function(Bt,_e){return Bt+_e},0)}function Nr(){if(!this.isBase())return Nr.call(this.toBase());for(var Ie=new Array(xt.length),ut=0;ut<Ie.length;ut++)Ie[ut]=0;for(var Bt,_e,ae=0;ae<this.numerator.length;ae++)(Bt=se[this.numerator[ae]])&&(_e=xt.indexOf(Bt[2]),_e>=0&&(Ie[_e]=Ie[_e]+1));for(var fe=0;fe<this.denominator.length;fe++)(Bt=se[this.denominator[fe]])&&(_e=xt.indexOf(Bt[2]),_e>=0&&(Ie[_e]=Ie[_e]-1));return Ie}var Sr="[+-]",Gr="\\d+",_t=Sr+"?"+Gr,Kt="\\."+Gr,mr="(?:"+Gr+"(?:"+Kt+")?)|(?:"+Kt+")",Yt="[Ee]"+_t,er="(?:"+mr+")(?:"+Yt+")?",lr=Sr+"?\\s*"+er,ar="("+lr+")?\\s*([^/]*)(?:/(.+))?",dr=new RegExp("^"+ar+"$"),ii="\\^|\\*{2}",nr="[01234]",at=new RegExp("([^ \\*\\d]+?)(?:"+ii+")?(-?"+nr+"(?![a-zA-Z]))"),bi=new RegExp("([^ \\*\\d]+?)(?:"+ii+")?("+nr+"(?![a-zA-Z]))");function Br(Ie){n(Ie)||(Ie=Ie.toString()),Ie=Ie.trim();var ut=dr.exec(Ie);if(!ut)throw new F(Ie+": Quantity not recognized");var Bt=ut[1];Bt?(Bt=Bt.replace(/\s/g,""),this.scalar=parseFloat(Bt)):this.scalar=1;for(var _e=ut[2],ae=ut[3],fe,ke,Fe;ut=at.exec(_e);){if(fe=parseFloat(ut[2]),isNaN(fe))throw new F("Unit exponent is not a number");if(fe===0&&!Or.test(ut[1]))throw new F("Unit not recognized");ke=ut[1]+" ",Fe="";for(var Ye=0;Ye<Math.abs(fe);Ye++)Fe+=ke;fe>=0?_e=_e.replace(ut[0],Fe):(ae=ae?ae+Fe:Fe,_e=_e.replace(ut[0],""))}for(;ut=bi.exec(ae);){if(fe=parseFloat(ut[2]),isNaN(fe))throw new F("Unit exponent is not a number");if(fe===0&&!Or.test(ut[1]))throw new F("Unit not recognized");ke=ut[1]+" ",Fe="";for(var mt=0;mt<fe;mt++)Fe+=ke;ae=ae.replace(ut[0],Fe)}_e&&(this.numerator=Er(_e.trim())),ae&&(this.denominator=Er(ae.trim()))}var Xr=Object.keys(ue).sort(function(Ie,ut){return ut.length-Ie.length}).join("|"),cr=Object.keys(ze).sort(function(Ie,ut){return ut.length-Ie.length}).join("|"),ur="\\b|$",yi="("+Xr+")??("+cr+")(?:"+ur+")",Or=new RegExp("^\\s*("+yi+"[\\s\\*]*)+$"),mi=new RegExp(yi,"g"),qt={};function Er(Ie){var ut=qt[Ie];if(ut)return ut;var Bt,_e=[];if(!Or.test(Ie))throw new F("Unit not recognized");for(;Bt=mi.exec(Ie);)_e.push(Bt.slice(1));return _e=_e.map(function(ae){return ue[ae[0]]?[ue[ae[0]],ze[ae[1]]]:[ze[ae[1]]]}),_e=_e.reduce(function(ae,fe){return ae.concat(fe)},[]),_e=_e.filter(function(ae){return ae}),qt[Ie]=_e,_e}function Gt(Ie){if(!n(Ie))throw new F("Argument should be a string");try{return this(Ie)}catch{return null}}function Jt(Ie){return Ie instanceof st}function st(Ie,ut){if(Pr.apply(null,arguments),!Jt(this))return new st(Ie,ut);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=ye,this.denominator=ye,ht(Ie)?(this.scalar=Ie.scalar,this.numerator=Ie.numerator&&Ie.numerator.length!==0?Ie.numerator:ye,this.denominator=Ie.denominator&&Ie.denominator.length!==0?Ie.denominator:ye):ut?(Br.call(this,ut),this.scalar=Ie):Br.call(this,Ie),this.denominator.join("*").indexOf("temp")>=0)throw new F("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new F("Cannot multiply by temperatures");if(!a(this.denominator,ye))throw new F("Cannot divide with temperatures")}if(this.initValue=Ie,Nt.call(this),this.isTemperature()&&this.baseScalar<0)throw new F("Temperatures must not be less than absolute zero")}st.prototype={constructor:st};function Pr(Ie,ut){if(ut){if(!(u(Ie)&&n(ut)))throw new F("Only number accepted as initialization value when units are explicitly provided")}else if(!(n(Ie)||u(Ie)||Jt(Ie)||ht(Ie)))throw new F("Only string, number or quantity accepted as single initialization value")}function ht(Ie){return Ie&&typeof Ie=="object"&&Ie.hasOwnProperty("scalar")}function Nt(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=Lr.call(this);else{var Ie=this.toBase();this.baseScalar=Ie.scalar,this.signature=Ie.signature}}var xr={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function Qr(){return g(Object.keys(xr).map(function(Ie){return xr[Ie]}))}st.prototype.kind=function(){return xr[this.signature.toString()]},b(st.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&a(this.denominator,ye)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function zr(Ie,ut){var Bt=Ie.units(),_e=ut.to(Bt),ae=st(ui(Bt));return st({scalar:Ie.scalar-_e.scalar,numerator:ae.numerator,denominator:ae.denominator})}function br(Ie,ut){var Bt=ut.to(ui(Ie.units()));return st({scalar:Ie.scalar-Bt.scalar,numerator:Ie.numerator,denominator:Ie.denominator})}function xi(Ie,ut){var Bt=ut.to(ui(Ie.units()));return st({scalar:Ie.scalar+Bt.scalar,numerator:Ie.numerator,denominator:Ie.denominator})}function ui(Ie){if(Ie==="tempK")return"degK";if(Ie==="tempC")return"degC";if(Ie==="tempF")return"degF";if(Ie==="tempR")return"degR";throw new F("Unknown type for temp conversion from: "+Ie)}function di(Ie,ut){var Bt=Ti(Ie),_e=ut.units(),ae;if(_e==="degK")ae=Bt.scalar;else if(_e==="degC")ae=Bt.scalar;else if(_e==="degF")ae=Bt.scalar*9/5;else if(_e==="degR")ae=Bt.scalar*9/5;else throw new F("Unknown type for degree conversion to: "+_e);return st({scalar:ae,numerator:ut.numerator,denominator:ut.denominator})}function Ti(Ie){var ut=Ie.units(),Bt;if(ut.match(/(deg)[CFRK]/))Bt=Ie.baseScalar;else if(ut==="tempK")Bt=Ie.scalar;else if(ut==="tempC")Bt=Ie.scalar;else if(ut==="tempF")Bt=Ie.scalar*5/9;else if(ut==="tempR")Bt=Ie.scalar*5/9;else throw new F("Unknown type for temp conversion from: "+ut);return st({scalar:Bt,numerator:["<kelvin>"],denominator:ye})}function Yi(Ie,ut){var Bt=ut.units(),_e;if(Bt==="tempK")_e=Ie.baseScalar;else if(Bt==="tempC")_e=Ie.baseScalar-273.15;else if(Bt==="tempF")_e=Ie.baseScalar*9/5-459.67;else if(Bt==="tempR")_e=Ie.baseScalar*9/5;else throw new F("Unknown type for temp conversion to: "+Bt);return st({scalar:_e,numerator:ut.numerator,denominator:ut.denominator})}function Zi(Ie){var ut=Ie.units(),Bt;if(ut.match(/(deg)[CFRK]/))Bt=Ie.baseScalar;else if(ut==="tempK")Bt=Ie.scalar;else if(ut==="tempC")Bt=Ie.scalar+273.15;else if(ut==="tempF")Bt=(Ie.scalar+459.67)*5/9;else if(ut==="tempR")Bt=Ie.scalar*5/9;else throw new F("Unknown type for temp conversion from: "+ut);return st({scalar:Bt,numerator:["<temp-K>"],denominator:ye})}b(st.prototype,{to:function(Ie){var ut,Bt;if(Ie==null)return this;if(!n(Ie))return this.to(Ie.units());if(ut=this._conversionCache[Ie],ut)return ut;if(Bt=st(Ie),Bt.units()===this.units())return this;if(!this.isCompatible(Bt))this.isInverse(Bt)?Bt=this.inverse().to(Ie):H(this.units(),Bt.units());else if(Bt.isTemperature())Bt=Yi(this,Bt);else if(Bt.isDegrees())Bt=di(this,Bt);else{var _e=C(this.baseScalar,Bt.baseScalar);Bt=st({scalar:_e,numerator:Bt.numerator,denominator:Bt.denominator})}return this._conversionCache[Ie]=Bt,Bt},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Zi(this);var Ie=En[this.units()];return Ie||(Ie=fo(this.numerator,this.denominator),En[this.units()]=Ie),Ie.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new F("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(Ie){if(n(Ie)&&(Ie=st(Ie)),u(Ie)&&(Ie=st(Ie+" "+this.units())),this.isUnitless()?Ie.isUnitless()||H(this.units(),Ie.units()):Ie=Ie.to(this.units()),Ie.scalar===0)throw new F("Divide by zero");var ut=T(Math.round(this.scalar/Ie.scalar),Ie.scalar);return st(ut+this.units())}});function oi(Ie,ut){var Bt=st(Ie),_e=st(ut);if(Bt.eq(_e))return f;var ae;return Bt.isTemperature()?ae=function(fe){return Bt.mul(fe).to(_e).scalar}:ae=function(fe){return fe*Bt.baseScalar/_e.baseScalar},function(ke){var Fe,Ye,mt;if(Array.isArray(ke)){for(Ye=ke.length,mt=[],Fe=0;Fe<Ye;Fe++)mt.push(ae(ke[Fe]));return mt}else return ae(ke)}}var En={};function fo(Ie,ut){for(var Bt=[],_e=[],ae=1,fe,ke=0;ke<Ie.length;ke++)fe=Ie[ke],le[fe]?ae=T(ae,le[fe]):Re[fe]&&(ae*=Re[fe].scalar,Re[fe].numerator&&Bt.push(Re[fe].numerator),Re[fe].denominator&&_e.push(Re[fe].denominator));for(var Fe=0;Fe<ut.length;Fe++)fe=ut[Fe],le[fe]?ae/=le[fe]:Re[fe]&&(ae/=Re[fe].scalar,Re[fe].numerator&&_e.push(Re[fe].numerator),Re[fe].denominator&&Bt.push(Re[fe].denominator));return Bt=Bt.reduce(function(Ye,mt){return Ye.concat(mt)},[]),_e=_e.reduce(function(Ye,mt){return Ye.concat(mt)},[]),st({scalar:ae,numerator:Bt,denominator:_e})}st.parse=Gt,st.getUnits=Ke,st.getAliases=St,st.mulSafe=T,st.divSafe=C,st.getKinds=Qr,st.swiftConverter=oi,st.Error=F,b(st.prototype,{add:function(Ie){if(n(Ie)&&(Ie=st(Ie)),this.isCompatible(Ie)||H(this.units(),Ie.units()),this.isTemperature()&&Ie.isTemperature())throw new F("Cannot add two temperatures");return this.isTemperature()?xi(this,Ie):Ie.isTemperature()?xi(Ie,this):st({scalar:this.scalar+Ie.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(Ie){if(n(Ie)&&(Ie=st(Ie)),this.isCompatible(Ie)||H(this.units(),Ie.units()),this.isTemperature()&&Ie.isTemperature())return zr(this,Ie);if(this.isTemperature())return br(this,Ie);if(Ie.isTemperature())throw new F("Cannot subtract a temperature from a differential degree unit");return st({scalar:this.scalar-Ie.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(Ie){if(u(Ie))return st({scalar:T(this.scalar,Ie),numerator:this.numerator,denominator:this.denominator});if(n(Ie)&&(Ie=st(Ie)),(this.isTemperature()||Ie.isTemperature())&&!(this.isUnitless()||Ie.isUnitless()))throw new F("Cannot multiply by temperatures");var ut=this,Bt=Ie;ut.isCompatible(Bt)&&ut.signature!==400&&(Bt=Bt.to(ut));var _e=po(ut.numerator,ut.denominator,Bt.numerator,Bt.denominator);return st({scalar:T(ut.scalar,Bt.scalar,_e[2]),numerator:_e[0],denominator:_e[1]})},div:function(Ie){if(u(Ie)){if(Ie===0)throw new F("Divide by zero");return st({scalar:this.scalar/Ie,numerator:this.numerator,denominator:this.denominator})}else n(Ie)&&(Ie=st(Ie));if(Ie.scalar===0)throw new F("Divide by zero");if(Ie.isTemperature())throw new F("Cannot divide with temperatures");if(this.isTemperature()&&!Ie.isUnitless())throw new F("Cannot divide with temperatures");var ut=this,Bt=Ie;ut.isCompatible(Bt)&&ut.signature!==400&&(Bt=Bt.to(ut));var _e=po(ut.numerator,ut.denominator,Bt.denominator,Bt.numerator);return st({scalar:T(ut.scalar,_e[2])/Bt.scalar,numerator:_e[0],denominator:_e[1]})},inverse:function(){if(this.isTemperature())throw new F("Cannot divide with temperatures");if(this.scalar===0)throw new F("Divide by zero");return st({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function po(Ie,ut,Bt,_e){function ae($t){return $t!==X}Ie=Ie.filter(ae),Bt=Bt.filter(ae),ut=ut.filter(ae),_e=_e.filter(ae);var fe={};function ke($t,Ar){for(var Qt,Kr,ri,Wr=0;Wr<$t.length;Wr++)if(le[$t[Wr]]?(Qt=$t[Wr+1],Kr=$t[Wr],ri=le[Kr],Wr++):(Qt=$t[Wr],Kr=null,ri=1),Qt&&Qt!==X)if(fe[Qt]){fe[Qt][0]+=Ar;var ni=fe[Qt][2]?le[fe[Qt][2]]:1;fe[Qt][Ar===1?3:4]*=C(ri,ni)}else fe[Qt]=[Ar,Qt,Kr,1,1]}ke(Ie,1),ke(ut,-1),ke(Bt,1),ke(_e,-1);var Fe=[],Ye=[],mt=1;for(var yt in fe)if(fe.hasOwnProperty(yt)){var Je=fe[yt],vt;if(Je[0]>0)for(vt=0;vt<Je[0];vt++)Fe.push(Je[2]===null?Je[1]:[Je[2],Je[1]]);else if(Je[0]<0)for(vt=0;vt<-Je[0];vt++)Ye.push(Je[2]===null?Je[1]:[Je[2],Je[1]]);mt*=C(Je[3],Je[4])}return Fe.length===0&&(Fe=ye),Ye.length===0&&(Ye=ye),Fe=Fe.reduce(function($t,Ar){return $t.concat(Ar)},[]),Ye=Ye.reduce(function($t,Ar){return $t.concat(Ar)},[]),[Fe,Ye,mt]}b(st.prototype,{eq:function(Ie){return this.compareTo(Ie)===0},lt:function(Ie){return this.compareTo(Ie)===-1},lte:function(Ie){return this.eq(Ie)||this.lt(Ie)},gt:function(Ie){return this.compareTo(Ie)===1},gte:function(Ie){return this.eq(Ie)||this.gt(Ie)},compareTo:function(Ie){if(n(Ie))return this.compareTo(st(Ie));if(this.isCompatible(Ie)||H(this.units(),Ie.units()),this.baseScalar<Ie.baseScalar)return-1;if(this.baseScalar===Ie.baseScalar)return 0;if(this.baseScalar>Ie.baseScalar)return 1},same:function(Ie){return this.scalar===Ie.scalar&&this.units()===Ie.units()}}),b(st.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(Ie){return a(Ie,ye)})},isCompatible:function(Ie){return n(Ie)?this.isCompatible(st(Ie)):Jt(Ie)&&Ie.signature!==void 0?this.signature===Ie.signature:!1},isInverse:function(Ie){return this.inverse().isCompatible(Ie)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(Ie){Ie!==X&&ce.indexOf(Ie)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function bn(){}bn.prototype.get=function(Ie){return arguments.length>1&&(Ie=Array.apply(null,arguments)),Ie.reduce(function(ut,Bt,_e){if(ut){var ae=ut[Bt];return _e===Ie.length-1?ae?ae.data:void 0:ae}},this)},bn.prototype.set=function(Ie,ut){return arguments.length>2&&(Ie=Array.prototype.slice.call(arguments,0,-1),ut=arguments[arguments.length-1]),Ie.reduce(function(Bt,_e,ae){var fe=Bt[_e];return fe===void 0&&(fe=Bt[_e]={}),ae===Ie.length-1?(fe.data=ut,ut):fe},this)};function oo(Ie,ut){return(Ie+" "+ut).trim()}st.formatter=oo,b(st.prototype,{units:function(){if(this._units!==void 0)return this._units;var Ie=a(this.numerator,ye),ut=a(this.denominator,ye);if(Ie&&ut)return this._units="",this._units;var Bt=Xn(this.numerator),_e=Xn(this.denominator);return this._units=Bt+(ut?"":"/"+_e),this._units},toString:function(Ie,ut){var Bt;if(u(Ie))Bt=this.units(),ut=Ie;else if(n(Ie))Bt=Ie;else if(Jt(Ie))return this.toPrec(Ie).toString(ut);var _e=this.to(Bt),ae=ut!==void 0?L(_e.scalar,ut):_e.scalar;return _e=(ae+" "+_e.units()).trim(),_e},format:function(Ie,ut){arguments.length===1&&typeof Ie=="function"&&(ut=Ie,Ie=void 0),ut=ut||st.formatter;var Bt=this.to(Ie);return ut.call(this,Bt.scalar,Bt.units())}});var Vi=new bn;function Xn(Ie){var ut=Vi.get(Ie);if(ut)return ut;var Bt=a(Ie,ye);return Bt?ut="1":ut=hn(Pn(Ie)).join("*"),Vi.set(Ie,ut),ut}function Pn(Ie){for(var ut=[],Bt,_e,ae=0;ae<Ie.length;ae++)Bt=Ie[ae],_e=Ie[ae+1],le[Bt]?(ut.push(ve[Bt]+ve[_e]),ae++):ut.push(ve[Bt]);return ut}function hn(Ie){var ut=Ie.reduce(function(Bt,_e){var ae=Bt[_e];return ae||Bt.push(ae=Bt[_e]=[_e,0]),ae[1]++,Bt},[]);return ut.map(function(Bt){return Bt[0]+(Bt[1]>1?Bt[1]:"")})}return st.version="1.7.6",st})})(quantities);var Qty=quantities.exports;function deepValue(e,t=""){let n=t.split(".");for(let o of n){if(e[o]===void 0)return;e=e[o]}return e}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(e,t,n){var o=e*t,u=SPLITTER*e,f=u-e,g=u-f,a=e-g,b=SPLITTER*t,T=b-t,C=b-T,L=t-C,N=o-g*C,F=N-a*C,H=F-g*L,se=a*L-H;return n?(n[0]=se,n[1]=o,n):[se,o]}var robustSum=linearExpansionSum;function scalarScalar$1(e,t){var n=e+t,o=n-e,u=n-o,f=t-o,g=e-u,a=g+f;return a?[a,n]:[n]}function linearExpansionSum(e,t){var n=e.length|0,o=t.length|0;if(n===1&&o===1)return scalarScalar$1(e[0],t[0]);var u=n+o,f=new Array(u),g=0,a=0,b=0,T=Math.abs,C=e[a],L=T(C),N=t[b],F=T(N),H,se;L<F?(se=C,a+=1,a<n&&(C=e[a],L=T(C))):(se=N,b+=1,b<o&&(N=t[b],F=T(N))),a<n&&L<F||b>=o?(H=C,a+=1,a<n&&(C=e[a],L=T(C))):(H=N,b+=1,b<o&&(N=t[b],F=T(N)));for(var ce=H+se,X=ce-H,ye=se-X,oe=ye,le=ce,ue,Re,ze,ve,be;a<n&&b<o;)L<F?(H=C,a+=1,a<n&&(C=e[a],L=T(C))):(H=N,b+=1,b<o&&(N=t[b],F=T(N))),se=oe,ce=H+se,X=ce-H,ye=se-X,ye&&(f[g++]=ye),ue=le+ce,Re=ue-le,ze=ue-Re,ve=ce-Re,be=le-ze,oe=be+ve,le=ue;for(;a<n;)H=C,se=oe,ce=H+se,X=ce-H,ye=se-X,ye&&(f[g++]=ye),ue=le+ce,Re=ue-le,ze=ue-Re,ve=ce-Re,be=le-ze,oe=be+ve,le=ue,a+=1,a<n&&(C=e[a]);for(;b<o;)H=N,se=oe,ce=H+se,X=ce-H,ye=se-X,ye&&(f[g++]=ye),ue=le+ce,Re=ue-le,ze=ue-Re,ve=ce-Re,be=le-ze,oe=be+ve,le=ue,b+=1,b<o&&(N=t[b]);return oe&&(f[g++]=oe),le&&(f[g++]=le),g||(f[g++]=0),f.length=g,f}var twoSum$1=fastTwoSum;function fastTwoSum(e,t,n){var o=e+t,u=o-e,f=o-u,g=t-u,a=e-f;return n?(n[0]=a+g,n[1]=o,n):[a+g,o]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,t){var n=e.length;if(n===1){var o=twoProduct(e[0],t);return o[0]?o:[o[1]]}var u=new Array(2*n),f=[.1,.1],g=[.1,.1],a=0;twoProduct(e[0],t,f),f[0]&&(u[a++]=f[0]);for(var b=1;b<n;++b){twoProduct(e[b],t,g);var T=f[1];twoSum(T,g[0],f),f[0]&&(u[a++]=f[0]);var C=g[1],L=f[1],N=C+L,F=N-C,H=L-F;f[1]=N,H&&(u[a++]=H)}return f[1]&&(u[a++]=f[1]),a===0&&(u[a++]=0),u.length=a,u}var robustDiff=robustSubtract;function scalarScalar(e,t){var n=e+t,o=n-e,u=n-o,f=t-o,g=e-u,a=g+f;return a?[a,n]:[n]}function robustSubtract(e,t){var n=e.length|0,o=t.length|0;if(n===1&&o===1)return scalarScalar(e[0],-t[0]);var u=n+o,f=new Array(u),g=0,a=0,b=0,T=Math.abs,C=e[a],L=T(C),N=-t[b],F=T(N),H,se;L<F?(se=C,a+=1,a<n&&(C=e[a],L=T(C))):(se=N,b+=1,b<o&&(N=-t[b],F=T(N))),a<n&&L<F||b>=o?(H=C,a+=1,a<n&&(C=e[a],L=T(C))):(H=N,b+=1,b<o&&(N=-t[b],F=T(N)));for(var ce=H+se,X=ce-H,ye=se-X,oe=ye,le=ce,ue,Re,ze,ve,be;a<n&&b<o;)L<F?(H=C,a+=1,a<n&&(C=e[a],L=T(C))):(H=N,b+=1,b<o&&(N=-t[b],F=T(N))),se=oe,ce=H+se,X=ce-H,ye=se-X,ye&&(f[g++]=ye),ue=le+ce,Re=ue-le,ze=ue-Re,ve=ce-Re,be=le-ze,oe=be+ve,le=ue;for(;a<n;)H=C,se=oe,ce=H+se,X=ce-H,ye=se-X,ye&&(f[g++]=ye),ue=le+ce,Re=ue-le,ze=ue-Re,ve=ce-Re,be=le-ze,oe=be+ve,le=ue,a+=1,a<n&&(C=e[a]);for(;b<o;)H=N,se=oe,ce=H+se,X=ce-H,ye=se-X,ye&&(f[g++]=ye),ue=le+ce,Re=ue-le,ze=ue-Re,ve=ce-Re,be=le-ze,oe=be+ve,le=ue,b+=1,b<o&&(N=-t[b]);return oe&&(f[g++]=oe),le&&(f[g++]=le),g||(f[g++]=0),f.length=g,f}(function(e){var t=twoProduct_1,n=robustSum,o=robustScale,u=robustDiff,f=5,g=11102230246251565e-32,a=(3+16*g)*g,b=(7+56*g)*g;function T(oe,le,ue,Re){return function(ve,be,de){var Te=oe(oe(le(be[1],de[0]),le(-de[1],be[0])),oe(le(ve[1],be[0]),le(-be[1],ve[0]))),Ge=oe(le(ve[1],de[0]),le(-de[1],ve[0])),Ke=Re(Te,Ge);return Ke[Ke.length-1]}}function C(oe,le,ue,Re){return function(ve,be,de,Te){var Ge=oe(oe(ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),be[2]),oe(ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),-de[2]),ue(oe(le(be[1],de[0]),le(-de[1],be[0])),Te[2]))),oe(ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),Te[2])))),Ke=oe(oe(ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),ve[2]),oe(ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),-de[2]),ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),Te[2]))),oe(ue(oe(le(be[1],de[0]),le(-de[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),de[2])))),St=Re(Ge,Ke);return St[St.length-1]}}function L(oe,le,ue,Re){return function(ve,be,de,Te,Ge){var Ke=oe(oe(oe(ue(oe(ue(oe(le(Te[1],Ge[0]),le(-Ge[1],Te[0])),de[2]),oe(ue(oe(le(de[1],Ge[0]),le(-Ge[1],de[0])),-Te[2]),ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),Ge[2]))),be[3]),oe(ue(oe(ue(oe(le(Te[1],Ge[0]),le(-Ge[1],Te[0])),be[2]),oe(ue(oe(le(be[1],Ge[0]),le(-Ge[1],be[0])),-Te[2]),ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),Ge[2]))),-de[3]),ue(oe(ue(oe(le(de[1],Ge[0]),le(-Ge[1],de[0])),be[2]),oe(ue(oe(le(be[1],Ge[0]),le(-Ge[1],be[0])),-de[2]),ue(oe(le(be[1],de[0]),le(-de[1],be[0])),Ge[2]))),Te[3]))),oe(ue(oe(ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),be[2]),oe(ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),-de[2]),ue(oe(le(be[1],de[0]),le(-de[1],be[0])),Te[2]))),-Ge[3]),oe(ue(oe(ue(oe(le(Te[1],Ge[0]),le(-Ge[1],Te[0])),be[2]),oe(ue(oe(le(be[1],Ge[0]),le(-Ge[1],be[0])),-Te[2]),ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),Ge[2]))),ve[3]),ue(oe(ue(oe(le(Te[1],Ge[0]),le(-Ge[1],Te[0])),ve[2]),oe(ue(oe(le(ve[1],Ge[0]),le(-Ge[1],ve[0])),-Te[2]),ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),Ge[2]))),-be[3])))),oe(oe(ue(oe(ue(oe(le(be[1],Ge[0]),le(-Ge[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],Ge[0]),le(-Ge[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),Ge[2]))),Te[3]),oe(ue(oe(ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),Te[2]))),-Ge[3]),ue(oe(ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),be[2]),oe(ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),-de[2]),ue(oe(le(be[1],de[0]),le(-de[1],be[0])),Te[2]))),ve[3]))),oe(ue(oe(ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),ve[2]),oe(ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),-de[2]),ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),Te[2]))),-be[3]),oe(ue(oe(ue(oe(le(be[1],Te[0]),le(-Te[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),Te[2]))),de[3]),ue(oe(ue(oe(le(be[1],de[0]),le(-de[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),de[2]))),-Te[3]))))),St=oe(oe(oe(ue(oe(ue(oe(le(Te[1],Ge[0]),le(-Ge[1],Te[0])),de[2]),oe(ue(oe(le(de[1],Ge[0]),le(-Ge[1],de[0])),-Te[2]),ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),Ge[2]))),ve[3]),ue(oe(ue(oe(le(Te[1],Ge[0]),le(-Ge[1],Te[0])),ve[2]),oe(ue(oe(le(ve[1],Ge[0]),le(-Ge[1],ve[0])),-Te[2]),ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),Ge[2]))),-de[3])),oe(ue(oe(ue(oe(le(de[1],Ge[0]),le(-Ge[1],de[0])),ve[2]),oe(ue(oe(le(ve[1],Ge[0]),le(-Ge[1],ve[0])),-de[2]),ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),Ge[2]))),Te[3]),ue(oe(ue(oe(le(de[1],Te[0]),le(-Te[1],de[0])),ve[2]),oe(ue(oe(le(ve[1],Te[0]),le(-Te[1],ve[0])),-de[2]),ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),Te[2]))),-Ge[3]))),oe(oe(ue(oe(ue(oe(le(de[1],Ge[0]),le(-Ge[1],de[0])),be[2]),oe(ue(oe(le(be[1],Ge[0]),le(-Ge[1],be[0])),-de[2]),ue(oe(le(be[1],de[0]),le(-de[1],be[0])),Ge[2]))),ve[3]),ue(oe(ue(oe(le(de[1],Ge[0]),le(-Ge[1],de[0])),ve[2]),oe(ue(oe(le(ve[1],Ge[0]),le(-Ge[1],ve[0])),-de[2]),ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),Ge[2]))),-be[3])),oe(ue(oe(ue(oe(le(be[1],Ge[0]),le(-Ge[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],Ge[0]),le(-Ge[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),Ge[2]))),de[3]),ue(oe(ue(oe(le(be[1],de[0]),le(-de[1],be[0])),ve[2]),oe(ue(oe(le(ve[1],de[0]),le(-de[1],ve[0])),-be[2]),ue(oe(le(ve[1],be[0]),le(-be[1],ve[0])),de[2]))),-Ge[3])))),xt=Re(Ke,St);return xt[xt.length-1]}}function N(oe){var le=oe===3?T:oe===4?C:L;return le(n,t,o,u)}var F=N(3),H=N(4),se=[function(){return 0},function(){return 0},function(le,ue){return ue[0]-le[0]},function(le,ue,Re){var ze=(le[1]-Re[1])*(ue[0]-Re[0]),ve=(le[0]-Re[0])*(ue[1]-Re[1]),be=ze-ve,de;if(ze>0){if(ve<=0)return be;de=ze+ve}else if(ze<0){if(ve>=0)return be;de=-(ze+ve)}else return be;var Te=a*de;return be>=Te||be<=-Te?be:F(le,ue,Re)},function(le,ue,Re,ze){var ve=le[0]-ze[0],be=ue[0]-ze[0],de=Re[0]-ze[0],Te=le[1]-ze[1],Ge=ue[1]-ze[1],Ke=Re[1]-ze[1],St=le[2]-ze[2],xt=ue[2]-ze[2],Lr=Re[2]-ze[2],Nr=be*Ke,Sr=de*Ge,Gr=de*Te,_t=ve*Ke,Kt=ve*Ge,mr=be*Te,Yt=St*(Nr-Sr)+xt*(Gr-_t)+Lr*(Kt-mr),er=(Math.abs(Nr)+Math.abs(Sr))*Math.abs(St)+(Math.abs(Gr)+Math.abs(_t))*Math.abs(xt)+(Math.abs(Kt)+Math.abs(mr))*Math.abs(Lr),lr=b*er;return Yt>lr||-Yt>lr?Yt:H(le,ue,Re,ze)}];function ce(oe){var le=se[oe.length];return le||(le=se[oe.length]=N(oe.length)),le.apply(void 0,oe)}function X(oe,le,ue,Re,ze,ve,be){return function(Te,Ge,Ke,St,xt){switch(arguments.length){case 0:case 1:return 0;case 2:return Re(Te,Ge);case 3:return ze(Te,Ge,Ke);case 4:return ve(Te,Ge,Ke,St);case 5:return be(Te,Ge,Ke,St,xt)}for(var Lr=new Array(arguments.length),Nr=0;Nr<arguments.length;++Nr)Lr[Nr]=arguments[Nr];return oe(Lr)}}function ye(){for(;se.length<=f;)se.push(N(se.length));e.exports=X.apply(void 0,[ce].concat(se));for(var oe=0;oe<=f;++oe)e.exports[oe]=se[oe]}ye()})(orientation);var robustPnp=robustPointInPolygon,orient=orientation.exports;function robustPointInPolygon(e,t){for(var n=t[0],o=t[1],u=e.length,f=1,g=u,a=0,b=u-1;a<g;b=a++){var T=e[a],C=e[b],L=T[1],N=C[1];if(N<L){if(N<o&&o<L){var F=orient(T,C,t);if(F===0)return 0;f^=0<F|0}else if(o===L){var H=e[(a+1)%u],se=H[1];if(L<se){var F=orient(T,C,t);if(F===0)return 0;f^=0<F|0}}}else if(L<N){if(L<o&&o<N){var F=orient(T,C,t);if(F===0)return 0;f^=F<0|0}else if(o===L){var H=e[(a+1)%u],se=H[1];if(se<L){var F=orient(T,C,t);if(F===0)return 0;f^=F<0|0}}}else if(o===L){var ce=Math.min(T[0],C[0]),X=Math.max(T[0],C[0]);if(a===0){for(;b>0;){var ye=(b+u-1)%u,oe=e[ye];if(oe[1]!==o)break;var le=oe[0];ce=Math.min(ce,le),X=Math.max(X,le),b=ye}if(b===0)return ce<=n&&n<=X?0:1;g=b+1}for(var ue=e[(b+u-1)%u][1];a+1<g;){var oe=e[a+1];if(oe[1]!==o)break;var le=oe[0];ce=Math.min(ce,le),X=Math.max(X,le),a+=1}if(ce<=n&&n<=X)return 0;var Re=e[(a+1)%u][1];n<ce&&ue<o!=Re<o&&(f^=1)}}return 2*f-1}var robustPointInPolygon$1=robustPnp;function feretDiameters(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const n=new Array(t.length);let o=1/0,u=0,f=[];for(let T=0;T<t.length;T++){let C=getAngle(t[T],t[(T+1)%t.length]);rotate(-C,t,n);let L=0,N=[];for(let F=0;F<t.length;F++){let H=Math.abs(n[T][1]-n[F][1]);H>L&&(L=H,N=[],N.push([n[F][0],n[T][1]],[n[F][0],n[F][1]]))}L<o&&(o=L,u=C,f=N)}rotate(u,f,f);let g=0,a=[],b=0;for(let T=0;T<t.length-1;T++)for(let C=T+1;C<t.length;C++){let L=(t[T][0]-t[C][0])**2+(t[T][1]-t[C][1])**2;L>b&&(b=L,g=Math.sqrt(L),a=[t[T],t[C]])}return{min:o,minLine:f,max:g,maxLine:a,aspectRatio:o/g}}function getAngle(e,t){let n=difference(t,e),o=normalize(n),u=Math.acos(o[0]);return o[1]<0?-u:u}class Roi{constructor(t,n){this.map=t,this.id=n,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:n=1,kind:o=""}=t;let u;switch(o){case"contour":u=this.contourMask;break;case"box":u=this.boxMask;break;case"filled":u=this.filledMask;break;case"center":u=this.centerMask;break;case"mbr":u=this.mbrFilledMask;break;case"hull":u=this.convexHullFilledMask;break;case"hullContour":u=this.convexHullMask;break;case"mbrContour":u=this.mbrMask;break;case"feret":u=this.feretMask;break;default:u=this.mask}return n<1&&(u=u.resize({factor:n}),u.parent=this.mask.parent,u.position[0]+=this.minX,u.position[1]+=this.minY),u}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,n=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let o=this.internalIDs;for(let u=0;u<t.length;u++)o.includes(t[u])||(this.computed.externalIDs.push(t[u]),this.computed.externalLengths.push(n[u]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.map.data[n+this.minX+(o+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&o>0&&o<this.height-1?(this.map.data[n-1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(o-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(o+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(n,o):t.setBitXY(n,o));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)t.setBitXY(n,0),t.setBitXY(n,this.height-1);for(let n=0;n<this.height;n++)t.setBitXY(0,n),t.setBitXY(this.width-1,n);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.map.data[n+this.minX+(o+this.minY)*this.map.width]===this.id&&t.setBitXY(n,o);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++){let u=n+this.minX+(o+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[u])&&t.setBitXY(n,o)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let o=0;o<this.width;o++)for(let u=0;u<this.height;u++)this.map.data[o+this.minX+(u+this.minY)*this.map.width]===this.id&&(o>0&&o<this.width-1&&u>0&&u<this.height-1?(this.map.data[o-1+this.minX+(u+this.minY)*this.map.width]!==this.id||this.map.data[o+1+this.minX+(u+this.minY)*this.map.width]!==this.id||this.map.data[o+this.minX+(u-1+this.minY)*this.map.width]!==this.id||this.map.data[o+this.minX+(u+1+this.minY)*this.map.width]!==this.id)&&(t.push([o,u]),t.push([o+1,u]),t.push([o,u+1]),t.push([o+1,u+1])):(t.push([o,u]),t.push([o+1,u]),t.push([o,u+1]),t.push([o+1,u+1])));const n=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:n,surface:surface(n),perimeter:perimeter(n)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,n=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});n.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=n}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,n=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let o=0;o<this.width;o++)for(let u=0;u<this.height;u++)robustPointInPolygon$1(t.polyline,[o,u])!==1&&n.setBitXY(o,u);this.computed.convexHullFilledMask=n}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let n=t[0],o=t[1],u=t[2],f=Math.sqrt((n[0]-o[0])**2+(n[1]-o[1])**2),g=Math.sqrt((u[0]-o[0])**2+(u[1]-o[1])**2);this.computed.mbr={width:f,height:g,elongation:1-f/g,aspectRatio:f/g,surface:f*g,perimeter:(f+g)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,n=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-n*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const n=minMax(t),o=new Image(n[1][0]-n[0][0]+1,n[1][1]-n[0][1]+1,{kind:BINARY,position:[this.minX+n[0][0],this.minY+n[0][1]],parent:this.map.parent});t=moveToZeroZero(t),o.paintPolyline(t,{closed:!0}),this.computed.mbrMask=o}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),n=this.mask.minimalBoundingRectangle();for(let o=0;o<this.width;o++)for(let u=0;u<this.height;u++)robustPointInPolygon$1(n,[o,u])!==1&&t.setBitXY(o,u);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++){let u=(n+this.minY)*this.map.width+o+this.minX;this.map.data[u]===this.id&&t.push([o,n])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,n;const o=this.points;for(let u=0;u<o.length;u++)for(let f=u+1;f<o.length;f++){let g=Math.pow(o[u][0]-o[f][0],2)+Math.pow(o[u][1]-o[f][1],2);g>=t&&(t=g,n=[o[u],o[f]])}this.computed.maxLengthPoints=n}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,n=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=n}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let t=e.map,n=t.data,o=new Set,u=new Map,f=new Set,g=[1,0,-1,0],a=[0,1,0,-1];for(let C=e.minX;C<=e.maxX;C++)for(let L=e.minY;L<=e.maxY;L++){let N=C+L*t.width;if(n[N]===e.id)for(let F=0;F<4;F++){let H=C+g[F],se=L+a[F];if(H>=0&&se>=0&&H<t.width&&se<t.height){let ce=H+se*t.width;if(n[ce]!==e.id&&!f.has(ce)){f.add(ce),o.add(n[ce]);let X=u.get(n[ce]);X?u.set(n[ce],++X):u.set(n[ce],1)}}}}let b=Array.from(o),T=b.map(function(C){return u.get(C)});return{ids:b,lengths:T}}function getBoxIDs(e){let t=new Set,n=e.map,o=n.data;for(let u of[0,e.height-1])for(let f=0;f<e.width;f++){let g=(u+e.minY)*n.width+f+e.minX;if(f-e.minX>0&&o[g]===e.id&&o[g-1]!==e.id){let a=o[g-1];t.add(a)}if(n.width-f-e.minX>1&&o[g]===e.id&&o[g+1]!==e.id){let a=o[g+1];t.add(a)}}for(let u of[0,e.width-1])for(let f=0;f<e.height;f++){let g=(f+e.minY)*n.width+u+e.minX;if(f-e.minY>0&&o[g]===e.id&&o[g-n.width]!==e.id){let a=o[g-n.width];t.add(a)}if(n.height-f-e.minY>1&&o[g]===e.id&&o[g+n.width]!==e.id){let a=o[g+n.width];t.add(a)}}return Array.from(t)}function getBox(e){let t=0,n=e.map,o=n.data,u=[0];e.height>1&&(u[1]=e.height-1);for(let g of u)for(let a=1;a<e.width-1;a++){let b=(g+e.minY)*n.width+a+e.minX;o[b]===e.id&&t++}let f=[0];e.width>1&&(f[1]=e.width-1);for(let g of f)for(let a=0;a<e.height;a++){let b=(a+e.minY)*n.width+g+e.minX;o[b]===e.id&&t++}return t}function getBorder(e){let t=0,n=e.map,o=n.data;for(let u=1;u<e.width-1;u++)for(let f=1;f<e.height-1;f++){let g=(f+e.minY)*n.width+u+e.minX;o[g]===e.id&&(o[g-1]!==e.id||o[g+1]!==e.id||o[g-n.width]!==e.id||o[g+n.width]!==e.id)&&t++}return t+e.box}function getPerimeterInfo(e){let t=e.map,n=t.data,o=0,u=0,f=0,g=0;for(let a=0;a<e.width;a++)for(let b=0;b<e.height;b++){let T=(b+e.minY)*t.width+a+e.minX;if(n[T]===e.id){let C=0;switch((a===0||e.externalIDs.includes(n[T-1]))&&C++,(a===e.width-1||e.externalIDs.includes(n[T+1]))&&C++,(b===0||e.externalIDs.includes(n[T-t.width]))&&C++,(b===e.height-1||e.externalIDs.includes(n[T+t.width]))&&C++,C){case 1:o++;break;case 2:u++;break;case 3:f++;break;case 4:g++;break}}}return{one:o,two:u,three:f,four:g}}function getExternal(e){let t=0,n=e.map,o=n.data;for(let u=1;u<e.width-1;u++)for(let f=1;f<e.height-1;f++){let g=(f+e.minY)*n.width+u+e.minX;o[g]===e.id&&(e.externalIDs.includes(o[g-1])||e.externalIDs.includes(o[g+1])||e.externalIDs.includes(o[g-n.width])||e.externalIDs.includes(o[g+n.width]))&&t++}return t+e.box}function getHolesInfo(e){let t=0,n=e.map.width,o=e.map.data;for(let u=1;u<e.width-1;u++)for(let f=1;f<e.height-1;f++){let g=(f+e.minY)*n+u+e.minX;e.internalIDs.includes(o[g])&&o[g]!==e.id&&t++}return{number:e.internalIDs.length-1,surface:t}}function getInternalIDs(e){let t=[e.id],n=e.map,o=n.data;if(e.height>2)for(let f=0;f<e.width;f++){let g=e.minY*n.width+f+e.minX;if(t.includes(o[g])){let a=o[g+n.width];!t.includes(a)&&!e.boxIDs.includes(a)&&t.push(a)}}let u=new Array(4);for(let f=1;f<e.width-1;f++)for(let g=1;g<e.height-1;g++){let a=(g+e.minY)*n.width+f+e.minX;if(t.includes(o[a])){u[0]=o[a-1],u[1]=o[a+1],u[2]=o[a-n.width],u[3]=o[a+n.width];for(let b=0;b<4;b++){let T=u[b];!t.includes(T)&&!e.boxIDs.includes(T)&&t.push(T)}}}return t}class RoiLayer{constructor(t,n){this.roiMap=t,this.options=n,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,n={};this.roiMap.positive=0,this.roiMap.negative=0;for(let a=0;a<t.length;a++)t[a]&&!n[t[a]]&&(n[t[a]]=!0,t[a]>0?this.roiMap.positive++:this.roiMap.negative++);let o={};for(let a in n)o[a]=new Roi(this.roiMap,a*1);let u=this.roiMap.width,f=this.roiMap.height;for(let a=0;a<f;a++)for(let b=0;b<u;b++){let T=a*u+b;if(t[T]!==0){const C=t[T],L=o[C];b<L.minX&&(L.minX=b),b>L.maxX&&(L.maxX=b),a<L.minY&&(L.minY=a),a>L.maxY&&(L.maxY=a),L.meanX+=b,L.meanY+=a,L.surface++}}let g=[];for(let a in n)o[a].meanX/=o[a].surface,o[a].meanY/=o[a].surface,g.push(o[a]);return g}}function commonBorderLength(e){let t=e.data,n=[1,0,-1,0],o=[0,1,0,-1],u=e.minMax,f=-u.min,g=u.max+f,a=[];for(let T=0;T<=g;T++)a.push(Object.create(null));for(let T=0;T<e.width;T++)for(let C=0;C<e.height;C++){let L=T+C*e.width,N=t[L];if(N!==0){let F=Object.create(null),H=!1;for(let se=0;se<4;se++){let ce=T+n[se],X=C+o[se];if(ce>=0&&X>=0&&ce<e.width&&X<e.height){let ye=t[ce+X*e.width];N!==ye&&(H=!0,ye!==0&&F[ye]===void 0&&(F[ye]=!0,a[ye+f][N]?a[ye+f][N]++:a[ye+f][N]=1))}else H=!0}H&&(a[N+f][N]?a[N+f][N]++:a[N+f][N]=1)}}let b={};for(let T=0;T<a.length;T++)Object.keys(a[T]).length>0&&(b[T-f]=a[T]);return b}function mergeRoi(e={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:n=5,maxCommonBorderLength:o=100,minCommonBorderRatio:u=.3,maxCommonBorderRatio:f=1}=e;let g=function(ce,X,ye){return ce[ye]>=n&&ce[ye]<=o};typeof t=="function"&&(g=t),t.toLowerCase()==="commonborderratio"&&(g=function(ce,X,ye){let oe=Math.min(ce[ye]/ce[X],1);return oe>=u&&oe<=f});const a=this,b=a.commonBorderLength;let T={},C={};for(let ce of Object.keys(b)){let X=b[ce],ye=Object.keys(X);for(let oe of ye)if(oe!==ce&&g(X,ce,oe)){let le=oe;C[oe]&&(le=C[oe]);let ue=ce;if(C[ce]&&(ue=C[ce]),Number(le)!==ue){let Re=Math.min(le,ue),ze=Math.max(le,ue);if(T[Re]||(T[Re]={}),T[Re][ze]=!0,C[ze]=Re,T[ze]){for(let ve of Object.keys(T[ze]))T[Re][ve]=!0,C[ve]=Re;delete T[ze]}}}}let L=a.minMax,N=-L.min,F=L.max+N,H=new Array(F+1).fill(0);for(let ce of Object.keys(C))H[Number(ce)+N]=C[ce];let se=a.data;for(let ce=0;ce<se.length;ce++){let X=se[ce];if(X!==0){let ye=H[X+N];ye!==0&&(se[ce]=ye)}}return a.computed={},a}class RoiMap{constructor(t,n){this.parent=t,this.width=t.width,this.height=t.height,this.data=n,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let o=0;o<this.data.length;o++)this.data[o]<t&&(t=this.data[o]),this.data[o]>n&&(n=this.data[o]);return{min:t,max:n}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const n=t[0],o=t.slice(1);for(let u=0;u<this.data.length;u++)o.includes(this.data[u])&&(this.data[u]=n)}rowsInfo(){let t=new Array(this.height),n=0;for(let o=0;o<this.data.length;o+=this.width){let u={row:n,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[n++]=u;let f={},g={},a=[],b=this.data[o],T=0;for(let C=o;C<o+this.width;C++){let L=this.data[C];b!==L&&(b=L,a.push(T),T=0),T++,L>0?(u.positivePixel++,f[L]||(f[L]=!0)):L<0?(u.negativePixel++,g[L]||(g[L]=!0)):u.zeroPixel++}a.push(T),u.medianChange=a.sort((C,L)=>C-L)[Math.floor(a.length/2)],u.positiveRoiIDs=Object.keys(f),u.negativeRoiIDs=Object.keys(g),u.positiveRoi=u.positiveRoiIDs.length,u.negativeRoi=u.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),n=0;for(let o=0;o<this.width;o++){let u={col:n,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[n++]=u;let f={},g={},a=[],b=this.data[o],T=0;for(let C=o;C<o+this.data.length;C+=this.width){let L=this.data[C];b!==L&&(b=L,a.push(T),T=0),T++,L>0?(u.positivePixel++,f[L]||(f[L]=!0)):L<0?(u.negativePixel++,g[L]||(g[L]=!0)):u.zeroPixel++}a.push(T),u.medianChange=a.sort((C,L)=>C-L)[Math.floor(a.length/2)],u.positiveRoiIDs=Object.keys(f),u.negativeRoiIDs=Object.keys(g),u.positiveRoi=u.positiveRoiIDs.length,u.negativeRoi=u.negativeRoiIDs.length}return t}}function fromMask(e,t={}){const{allowCorners:n=!1}=t,o=65535;let u=new Int16Array(e.size),f=0,g=0,a=new Uint16Array(o+1),b=new Uint16Array(o+1);for(let C=0;C<e.width;C++)for(let L=0;L<e.height;L++)u[L*e.width+C]===0&&T(C,L);function T(C,L){let N=0,F=0,H=e.getBitXY(C,L),se=H?++f:--g;if(f>32767||g<-32768)throw new Error("Too many regions of interest");for(a[0]=C,b[0]=L;N<=F;){let ce=a[N&o],X=b[N&o];if(u[X*e.width+ce]=se,ce>0&&u[X*e.width+ce-1]===0&&e.getBitXY(ce-1,X)===H&&(F++,a[F&o]=ce-1,b[F&o]=X,u[X*e.width+ce-1]=-32768),X>0&&u[(X-1)*e.width+ce]===0&&e.getBitXY(ce,X-1)===H&&(F++,a[F&o]=ce,b[F&o]=X-1,u[(X-1)*e.width+ce]=-32768),ce<e.width-1&&u[X*e.width+ce+1]===0&&e.getBitXY(ce+1,X)===H&&(F++,a[F&o]=ce+1,b[F&o]=X,u[X*e.width+ce+1]=-32768),X<e.height-1&&u[(X+1)*e.width+ce]===0&&e.getBitXY(ce,X+1)===H&&(F++,a[F&o]=ce,b[F&o]=X+1,u[(X+1)*e.width+ce]=-32768),n&&(ce>0&&X>0&&u[(X-1)*e.width+ce-1]===0&&e.getBitXY(ce-1,X-1)===H&&(F++,a[F&o]=ce-1,b[F&o]=X-1,u[(X-1)*e.width+ce-1]=-32768),ce<e.width-1&&X>0&&u[(X-1)*e.width+ce+1]===0&&e.getBitXY(ce+1,X-1)===H&&(F++,a[F&o]=ce+1,b[F&o]=X-1,u[(X-1)*e.width+ce+1]=-32768),ce>0&&X<e.height-1&&u[(X+1)*e.width+ce-1]===0&&e.getBitXY(ce-1,X+1)===H&&(F++,a[F&o]=ce-1,b[F&o]=X+1,u[(X+1)*e.width+ce-1]=-32768),ce<e.width-1&&X<e.height-1&&u[(X+1)*e.width+ce+1]===0&&e.getBitXY(ce+1,X+1)===H&&(F++,a[F&o]=ce+1,b[F&o]=X+1,u[(X+1)*e.width+ce+1]=-32768)),N++,F-N>o)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,u)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var n=this.nodes.get(t);return n||(n=new DisjointSetNode(t),this.nodes.set(t,n)),n}union(t,n){const o=this.find(t),u=this.find(n);o!==u&&(o.rank<u.rank?o.parent=u:o.rank>u.rank?u.parent=o:(u.parent=o,o.rank++))}find(t){for(var n=t;n.parent!==null;)n=n.parent;for(var o=t;o.parent!==null;){var u=o;o=o.parent,u.parent=n}return n}connected(t,n){return this.find(t)===this.find(n)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(e){this.value=e,this.parent=null,this.rank=0}var DisjointSet$1=DisjointSet_1;const direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,t={}){const{allowCorners:n=!1}=t;let o=4;n&&(o=8);let u,f,g;if(o===8)u=direction8X,f=direction8Y,g=neighbours8;else if(o===4)u=direction4X,f=direction4Y,g=neighbours4;else throw new RangeError(`unsupported neighbours count: ${o}`);const a=e.size,b=e.width,T=e.height,C=new Array(a),L=new Uint32Array(a),N=new DisjointSet$1;let F=1;for(let H=0;H<T;H++)for(let se=0;se<b;se++){const ce=se+H*b;if(e.getBit(ce)){let X=null;for(let ye=0;ye<g.length;ye++){const oe=se+u[ye],le=H+f[ye];if(oe>=0&&le>=0&&oe<b&&le<T){const ue=oe+le*b;let Re=C[ue];Re?(g[ye]=Re,(!X||g[ye].value<X.value)&&(X=g[ye])):g[ye]=null}}if(!X)C[ce]=N.add(F++);else{C[ce]=X;for(let ye=0;ye<g.length;ye++)g[ye]&&g[ye]!==X&&N.union(X,g[ye])}}}for(let H=0;H<T;H++)for(let se=0;se<b;se++){const ce=se+H*b;e.getBit(ce)&&(L[ce]=N.find(C[ce]).value)}return new RoiMap(e,L)}function fromMaxima(e={}){let{allowCorner:t=!0,onlyTop:n=!1,invert:o=!1}=e,u=this;u.checkProcessable("fromMaxima",{components:[1]});const f=1,g=2;let a=0,b=0,T=new Int16Array(u.size),C=new Int8Array(u.size),L=new Float32Array(u.size),N=1048575,F=new Uint16Array(N+1),H=new Uint16Array(N+1),se=0,ce=0,X=new Uint16Array(N+1),ye=new Uint16Array(N+1),oe=0,le=0;for(ue(u);se<ce;){let ve=F[se&N],be=H[se&N];ze(ve,be,g),se++}return new RoiMap(u,T);function ue({maxima:ve=!0}){for(let be=1;be<u.height-1;be++)for(let de=1;de<u.width-1;de++){let Te=de+be*u.width;if(C[Te]===0){let Ge=ve?u.data[Te]:-u.data[de+be*u.width];if(u.data[be*u.width+de-1]>Ge||u.data[be*u.width+de+1]>Ge||u.data[(be-1)*u.width+de]>Ge||u.data[(be+1)*u.width+de]>Ge||t&&(u.data[(be-1)*u.width+de-1]>Ge||u.data[(be-1)*u.width+de+1]>Ge||u.data[(be+1)*u.width+de-1]>Ge||u.data[(be+1)*u.width+de+1]>Ge))continue;T[Te]=ve?++a:--b,Re(de,be)||(ve?--a:++b)}}}function Re(ve,be){let de=ce;oe=0,le=1,X[0]=ve,ye[0]=be;let Te=!0;for(;oe<le;){let Ge=X[oe&N],Ke=ye[oe&N];Te&=ze(Ge,Ke,f),oe++}if(!Te){for(let Ge=0;Ge<le;Ge++){let Ke=X[Ge&N],xt=ye[Ge&N]*u.width+Ke;T[xt]=0}ce=de}return Te}function ze(ve,be,de){let Te=T[be*u.width+ve],Ge=u.data[be*u.width+ve];for(let Ke=be-1;Ke<=be+1;Ke++)for(let St=ve-1;St<=ve+1;St++){let xt=Ke*u.width+St;if(C[xt]===0)switch(C[xt]=1,L[xt]=u.data[xt]-Ge,de){case f:if(L[xt]===0){if(St===0||Ke===0||St===u.width-1||Ke===u.height-1)return!1;T[xt]=Te,X[le&N]=St,ye[le&N]=Ke,le++}else{if(L[xt]>0)return!1;n||(T[xt]=Te,F[ce&N]=St,H[ce&N]=Ke,ce++)}break;case g:L[xt]<=0&&(T[xt]=Te,F[ce&N]=St,H[ce&N]=Ke,ce++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,t={}){let n=new Shape(t),o=new Int16Array(this.size),u=0,f=n.getPoints();for(let g=0;g<e.length;g++){u++;let a=e[g][0],b=e[g][1];for(let T=0;T<f.length;T++){let C=f[T][0],L=f[T][1];a+C>=0&&b+L>=0&&a+C<this.width&&b+L<this.height&&(o[a+C+(b+L)*this.width]=u)}}return new RoiMap(this,o)}var priorityQueue={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(o,u,f){function g(T,C){if(!u[T]){if(!o[T]){var L=typeof commonjsRequire=="function"&&commonjsRequire;if(!C&&L)return L(T,!0);if(a)return a(T,!0);var N=new Error("Cannot find module '"+T+"'");throw N.code="MODULE_NOT_FOUND",N}var F=u[T]={exports:{}};o[T][0].call(F.exports,function(H){var se=o[T][1][H];return g(se||H)},F,F.exports,n,o,u,f)}return u[T].exports}for(var a=typeof commonjsRequire=="function"&&commonjsRequire,b=0;b<f.length;b++)g(f[b]);return g}({1:[function(n,o,u){var f,g,a,b,T,C=function(N,F){for(var H in F)L.call(F,H)&&(N[H]=F[H]);function se(){this.constructor=N}return se.prototype=F.prototype,N.prototype=new se,N.__super__=F.prototype,N},L={}.hasOwnProperty;f=n("./PriorityQueue/AbstractPriorityQueue"),g=n("./PriorityQueue/ArrayStrategy"),b=n("./PriorityQueue/BinaryHeapStrategy"),a=n("./PriorityQueue/BHeapStrategy"),T=function(N){C(F,N);function F(H){H||(H={}),H.strategy||(H.strategy=b),H.comparator||(H.comparator=function(se,ce){return(se||0)-(ce||0)}),F.__super__.constructor.call(this,H)}return F}(f),T.ArrayStrategy=g,T.BinaryHeapStrategy=b,T.BHeapStrategy=a,o.exports=T},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(n,o,u){o.exports=function(){function f(g){var a;if(g?.strategy==null)throw"Must pass options.strategy, a strategy";if(g?.comparator==null)throw"Must pass options.comparator, a comparator";this.priv=new g.strategy(g),this.length=(g!=null&&(a=g.initialValues)!=null?a.length:void 0)||0}return f.prototype.queue=function(g){this.length++,this.priv.queue(g)},f.prototype.dequeue=function(g){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},f.prototype.peek=function(g){if(!this.length)throw"Empty queue";return this.priv.peek()},f.prototype.clear=function(){return this.length=0,this.priv.clear()},f}()},{}],3:[function(n,o,u){var f;f=function(g,a,b){var T,C,L;for(C=0,T=g.length;C<T;)L=C+T>>>1,b(g[L],a)>=0?C=L+1:T=L;return C},o.exports=function(){function g(a){var b;this.options=a,this.comparator=this.options.comparator,this.data=((b=this.options.initialValues)!=null?b.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return g.prototype.queue=function(a){var b;b=f(this.data,a,this.comparator),this.data.splice(b,0,a)},g.prototype.dequeue=function(){return this.data.pop()},g.prototype.peek=function(){return this.data[this.data.length-1]},g.prototype.clear=function(){this.data.length=0},g}()},{}],4:[function(n,o,u){o.exports=function(){function f(g){var a,b,T,C,L,N,F,H;for(this.comparator=g?.comparator||function(se,ce){return se-ce},this.pageSize=g?.pageSize||512,this.length=0,F=0;1<<F<this.pageSize;)F+=1;if(1<<F!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=F,this._emptyMemoryPageTemplate=a=[],b=0,L=this.pageSize;0<=L?b<L:b>L;0<=L?++b:--b)a.push(null);if(this._memory=[],this._mask=this.pageSize-1,g.initialValues)for(N=g.initialValues,T=0,C=N.length;T<C;T++)H=N[T],this.queue(H)}return f.prototype.queue=function(g){this.length+=1,this._write(this.length,g),this._bubbleUp(this.length,g)},f.prototype.dequeue=function(){var g,a;return g=this._read(1),a=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,a),this._bubbleDown(1,a)),g},f.prototype.peek=function(){return this._read(1)},f.prototype.clear=function(){this.length=0,this._memory.length=0},f.prototype._write=function(g,a){var b;for(b=g>>this._shift;b>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[b][g&this._mask]=a},f.prototype._read=function(g){return this._memory[g>>this._shift][g&this._mask]},f.prototype._bubbleUp=function(g,a){var b,T,C,L;for(b=this.comparator;g>1&&(T=g&this._mask,g<this.pageSize||T>3?C=g&~this._mask|T>>1:T<2?(C=g-this.pageSize>>this._shift,C+=C&~(this._mask>>1),C|=this.pageSize>>1):C=g-2,L=this._read(C),!(b(L,a)<0));)this._write(C,a),this._write(g,L),g=C},f.prototype._bubbleDown=function(g,a){var b,T,C,L,N;for(N=this.comparator;g<this.length;)if(g>this._mask&&!(g&this._mask-1)?b=T=g+2:g&this.pageSize>>1?(b=(g&~this._mask)>>1,b|=g&this._mask>>1,b=b+1<<this._shift,T=b+1):(b=g+(g&this._mask),T=b+1),b!==T&&T<=this.length)if(C=this._read(b),L=this._read(T),N(C,a)<0&&N(C,L)<=0)this._write(b,a),this._write(g,C),g=b;else if(N(L,a)<0)this._write(T,a),this._write(g,L),g=T;else break;else if(b<=this.length)if(C=this._read(b),N(C,a)<0)this._write(b,a),this._write(g,C),g=b;else break;else break},f}()},{}],5:[function(n,o,u){o.exports=function(){function f(g){var a;this.comparator=g?.comparator||function(b,T){return b-T},this.length=0,this.data=((a=g.initialValues)!=null?a.slice(0):void 0)||[],this._heapify()}return f.prototype._heapify=function(){var g,a,b;if(this.data.length>0)for(g=a=1,b=this.data.length;1<=b?a<b:a>b;g=1<=b?++a:--a)this._bubbleUp(g)},f.prototype.queue=function(g){this.data.push(g),this._bubbleUp(this.data.length-1)},f.prototype.dequeue=function(){var g,a;return a=this.data[0],g=this.data.pop(),this.data.length>0&&(this.data[0]=g,this._bubbleDown(0)),a},f.prototype.peek=function(){return this.data[0]},f.prototype.clear=function(){this.length=0,this.data.length=0},f.prototype._bubbleUp=function(g){for(var a,b;g>0&&(a=g-1>>>1,this.comparator(this.data[g],this.data[a])<0);)b=this.data[a],this.data[a]=this.data[g],this.data[g]=b,g=a},f.prototype._bubbleDown=function(g){var a,b,T,C,L;for(a=this.data.length-1;b=(g<<1)+1,C=b+1,T=g,b<=a&&this.comparator(this.data[b],this.data[T])<0&&(T=b),C<=a&&this.comparator(this.data[C],this.data[T])<0&&(T=C),T!==g;)L=this.data[T],this.data[T]=this.data[g],this.data[g]=L,g=T},f}()},{}]},{},[1])(1)})})(priorityQueue);var PriorityQueue=priorityQueue.exports;const dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:t,mask:n,image:o,fillMaxValue:u=this.maxValue,invert:f=!1}=e,g=o||this;g.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),f=!f,t||(t=g.getLocalMaxima({invert:f,mask:n}));let a=f?0:1,b=new Int16Array(g.size),T=g.width,C=g.height,L=new PriorityQueue({comparator:(N,F)=>N[2]-F[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let N=0;N<t.length;N++){let F=t[N][0]+t[N][1]*T;b[F]=N+1;let H=g.data[F];(f&&H<=u||!f&&H>=u)&&L.queue([t[N][0],t[N][1],H])}for(;L.length>0;){let N=L.dequeue(),F=N[0]+N[1]*T;for(let H=0;H<4;H++){let se=N[0]+dxs[H],ce=N[1]+dys[H];if(se>=0&&ce>=0&&se<T&&ce<C){let X=se+ce*T;if(!n||n.getBit(X)===a){let ye=g.data[X];(f&&ye<=u||!f&&ye>=u)&&b[X]===0&&(b[X]=b[F],L.queue([N[0]+dxs[H],N[1]+dys[H],ye]))}}}}return new RoiMap(g,b)}class RoiManager{constructor(t,n={}){this._image=t,this._options=n,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let n=Object.assign({},this._options,t),o=fromMaxima.call(this._image,t);this._layers[n.label]=new RoiLayer(o,n)}fromPoints(t,n={}){let o=Object.assign({},this._options,n),u=fromPoints.call(this._image,t,n);return this._layers[o.label]=new RoiLayer(u,o),this}putMap(t,n={}){let o=new RoiMap(this._image,t),u=Object.assign({},this._options,n);return this._layers[u.label]=new RoiLayer(o,u),this}fromWaterShed(t={}){let n=Object.assign({},this._options,t),o=fromWaterShed.call(this._image,t);this._layers[n.label]=new RoiLayer(o,n)}fromMask(t,n={}){let o=Object.assign({},this._options,n),u=fromMask.call(this._image,t,n);return this._layers[o.label]=new RoiLayer(u,o),this}fromMaskConnectedComponentLabelingAlgorithm(t,n={}){let o=Object.assign({},this._options,n),u=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,n);return this._layers[o.label]=new RoiLayer(u,o),this}getMap(t={}){let n=Object.assign({},this._options,t);return this._assertLayerWithLabel(n.label),this._layers[n.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let n=this.getRois(t);if(n){let o=new Array(n.length);for(let u=0;u<n.length;u++)o[u]=n[u].id;return o}throw new Error("ROIs not found")}getRois(t={}){let{label:n=this._options.label,positive:o=!0,negative:u=!0,minSurface:f=0,maxSurface:g=Number.POSITIVE_INFINITY,minWidth:a=0,maxWidth:b=Number.POSITIVE_INFINITY,minHeight:T=0,maxHeight:C=Number.POSITIVE_INFINITY,minRatio:L=0,maxRatio:N=Number.POSITIVE_INFINITY}=t;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const F=this._layers[n].roi,H=[];for(const se of F)(se.id<0&&u||se.id>0&&o)&&se.surface>=f&&se.surface<=g&&se.width>=a&&se.width<=b&&se.height>=T&&se.height<=C&&se.ratio>=L&&se.ratio<=N&&H.push(se);return H}getRoi(t,n={}){const{label:o=this._options.label}=n;if(!this._layers[o])throw new Error(`this Roi layer (${o}) does not exist`);const u=this._layers[o].roi.find(f=>f.id===t);if(!u)throw new Error(`found no Roi with id ${t}`);return u}getMasks(t={}){let n=this.getRois(t),o=new Array(n.length);for(let u=0;u<n.length;u++)o[u]=n[u].getMask(t);return o}getAnalysisMasks(t={}){const{analysisProperty:n}=t;let o=`${n}Mask`,u=this.getRois(t);return u.length===0||!u[0][o]?[]:u.map(f=>f[o])}getData(t={}){let n=Object.assign({},this._options,t);return this._assertLayerWithLabel(n.label),this._layers[n.label].roiMap.data}paint(t={}){let{labelProperty:n,analysisProperty:o}=t;this._painted||(this._painted=this._image.rgba8());let u=this.getMasks(t);if(n){const f=this.getRois(t);t.labels=f.map(T=>deepValue(T,n));const g=Math.max(...t.labels);let a=!1,b=!1;if(n.includes("surface")?a=!0:/(?:perimeter|min|max|external|width|height|length)/.test(n)&&(b=!0),isFinite(g)){let T="";if(t.unit!=="pixel"&&t.pixelSize&&(b||a)){T=a?`${t.unit}^2`:t.unit;let C=a?"m^2":"m",L=a?t.pixelSize**2:t.pixelSize;const N=Qty.swiftConverter(C,T);t.labels=t.labels.map(F=>N(L*F))}g>50?t.labels=t.labels.map(C=>Math.round(C)+T):g>10?t.labels=t.labels.map(C=>C.toFixed(1)+T):t.labels=t.labels.map(C=>C.toFixed(2)+T)}t.labelsPosition=f.map(T=>[T.meanX,T.meanY])}if(this._painted.paintMasks(u,t),o){let f=this.getAnalysisMasks(t);this._painted.paintMasks(f,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let n=new Image(this._image.width,this._image.height,{kind:"BINARY"}),o=this.getMasks(t);for(let u=0;u<o.length;u++){let f=o[u];for(let g=0;g<f.width;g++)for(let a=0;a<f.height;a++)f.getBitXY(g,a)&&n.setBitXY(g+f.position[0],a+f.position[1])}return n}resetPainted(t={}){const{image:n}=t;n?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const n=this.getMap(t);return n.mergeRoi(t),this.putMap(n.data,t),this}mergeRois(t,n={}){if(!Array.isArray(t)||t.some(u=>!Number.isInteger(u)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(u=>this.getRoi(u));const o=this.getMap(n);return o.mergeRois(t),this.putMap(o.data,n),this}findCorrespondingRoi(t,n={}){let o=this.getRois(n),u=[];for(let f=0;f<o.length;f++){let g=o[f],a=g.minX,b=g.minY,T=g.points,C=Math.sign(g.id),L=correspondingRoisInformation(a,b,T,t,C);u.push(L)}return u}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(e,t,n,o,u){let f={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let g=0;g<n.length;g++){let a=n[g],b=a[0],T=a[1],C=b+e+(T+t)*o.width,L=o.data[C];(L>0||L<0)&&(f.id.includes(L)?f.surface[f.id.indexOf(L)]+=1:(f.id.push(L),f.surface.push(1)))}for(let g=0;g<f.id.length;g++)Math.sign(f.id[g])===u?f.same+=f.surface[g]:f.opposite+=f.surface[g],f.roiSurfaceCovered[g]=f.surface[g]/n.length;return f.total=f.opposite+f.same,f}const objectToString$1=Object.prototype.toString;class Image{constructor(t,n,o,u){if(arguments.length===1?(u=t,{width:t,height:n,data:o}=u):o&&!o.length&&(u=o,{data:o}=u),t===void 0&&(t=1),n===void 0&&(n=1),u===void 0&&(u={}),typeof u!="object"||u===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new RangeError("height must be a positive integer");const{kind:f=RGBA}=u;if(typeof f!="string")throw new TypeError("kind must be a string");const g=getKind(f),a=Object.assign({},u);for(const se in g)a[se]===void 0&&(a[se]=g[se]);verifyKindDefinition(a);const{components:b,bitDepth:T,colorModel:C}=a,L=a.alpha+0,N=t*n,F=b+L,H=T===32?Number.MAX_VALUE:2**T-1;if(o===void 0)o=createPixelArray(N,b,L,F,T,H);else{const se=getTheoreticalPixelArraySize(N,F,T);if(o.length!==se)throw new RangeError(`incorrect data size: ${o.length}. Should be ${se}`)}this.width=t,this.height=n,this.data=o,this.size=N,this.components=b,this.alpha=L,this.bitDepth=T,this.maxValue=H,this.colorModel=C,this.channels=F,this.meta=u.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:u.parent||null}),this.position=u.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString$1.call(t)==="[object IJSImage]"}static fromCanvas(t){const o=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Image(o.width,o.height,o.data)}static createFrom(t,n){const o=getImageParameters(t);return Object.assign(o,{parent:t,position:[0,0]},n),new Image(o)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Image(this.width,this.height,t,this)}apply(t){for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++){let u=(n*this.width+o)*this.channels;t.call(this,u)}}}setValueMethods(Image);setBitMethods(Image);setExportMethods(Image);Image.prototype.checkProcessable=checkProcessable;Image.prototype.getRGBAData=getRGBAData;Image.load=load;Image.extendMethod=extendMethod;Image.extendProperty=extendProperty;extend$4(Image);var workerTemplate$1={},worker$1=function(){self.window=self;function e(){this._listeners={}}e.prototype.on=function(n,o){if(this._listeners[n])throw new RangeError("there is already a listener for "+n);if(typeof o!="function")throw new TypeError("callback argument must be a function");this._listeners[n]=o},e.prototype._send=function(n,o,u){u===void 0?u=[]:Array.isArray(u)||(u=[u]),self.postMessage({id:n,data:o},u)},e.prototype._trigger=function(n,o){if(!this._listeners[n])throw new Error("event "+n+" is not defined");this._listeners[n].apply(null,o)};var t=new e;self.onmessage=function(n){switch(n.data.action){case"exec":n.data.args.unshift(function(o,u){t._send(n.data.id,o,u)}),t._trigger(n.data.event,n.data.args);break;case"ping":t._send(n.data.id,"pong");break;default:throw new Error("unexpected action: "+n.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function e(t,n){var o=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(n)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(o)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(e,t){if(typeof e!="string"&&typeof e!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=e.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var n=t.deps;typeof n=="string"&&(n=[n]),Array.isArray(n)||(n=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(n)}WorkerManager.prototype._init=function(e){for(var t=workerTemplate.newWorkerURL(this._workerCode,e),n=0;n<this._numWorkers;n++){var o=new Worker(t);o.onmessage=this._onmessage.bind(this,o),o.onerror=this._onerror.bind(this,o),o.running=!1,o.id=n,this._workers.set(o,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(e,t){if(!this._terminated){this._working--,e.running=!1;var n=this._workers.get(e);n&&n[1](t.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(e,t){if(!this._terminated){this._working--,e.running=!1;var n=this._workers.get(e);n&&n[0](t.data.data),this._workers.set(e,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!e.running)for(var t=0;t<this._waiting.length;t++){var n=this._waiting[t];if(!(typeof n[4]=="number"&&n[4]!==e.id)){this._waiting.splice(t,1),e.postMessage({action:"exec",event:n[0],args:n[1]},n[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,n[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(e,t){if(this._terminated)throw new Error("Cannot post (terminated)");var n=[];for(var o of this._workers.keys())n.push(this.post(e,t,[],o.id));return Promise.all(n)};WorkerManager.prototype.post=function(e,t,n,o){t===void 0&&(t=[]),n===void 0&&(n=[]),Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]);var u=this;return new Promise(function(f,g){if(u._terminated)throw new Error("Cannot post (terminated)");u._waiting.push([e,t,n,[f,g],o]),u._exec()})};var src=WorkerManager;const defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,t,n){t=Object.assign({},defaultOptions,t);const o=this.manager;return Array.isArray(e)?Promise.all(e.map(function(u){const f=runOnce(o,u,t);return typeof n=="function"&&f.then(n),f})):runOnce(o,e,t)}function runOnce(e,t,n){return e.post("data",[t,n]).then(function(o){for(let u in o)o[u]=new Image(o[u]);return o})}function work(){worker.on("data",function(e,t,n){t=new IJS(t);const o={},u=[],f=t.grey(),g=f.sobelFilter();F("sobel",g);const a=g.level().mask({threshold:n.threshold});F("mask",a);const b=g.getRoiManager();b.fromMask(a);const T=b.getMask(n.roi);F("realMask",T);const C=f.getPixelsGrid({sampling:n.sampling,mask:T}),L=t.getBackground(C.xyS,C.zS,n.regression);F("background",L);const N=t.subtract(L);o.result=N,u.push(N.data.buffer),e(o,u);function F(H,se){n.include.includes(H)&&(o[H]=se,u.push(se.data.buffer))}})}const background={run,work};function extend$3(e){e.extendMethod("background",background)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,n){let o,u,f={};function g(...a){return o||(this.checkUrl(),u=this.url,o=new src(n.work,{deps:u}),f.manager=o),n.run.call(f,...a)}g.reset=function(){o&&(o.terminate(),o=new src(n.work,{deps:u}),f.manager=o)},Worker$1.prototype[t]=g}}extend$3(Worker$1);new Worker$1;function getTileInfo(e,t,n){let o={},u=Math.floor(n.getZoom()),f=40075016686e-3*Math.abs(Math.cos(t))/Math.pow(2,u),g=f/512,a=tilebelt.pointToTile(e,t,u);o.z=u,o.x=a[0],o.y=a[1],o.pointLng=e,o.pointLat=t,o.tileWidthInMeters=f,o.metersPerPixel=g,o.mapboxTileName=o.z+"-"+o.x+"-"+o.y,o.tile=[o.x,o.y,o.z],o.bbox=tilebelt.tileToBBOX(o.tile),o.polygon_bb=getTileGeoJsonBB(o.bbox),o.area_bb=getAreaBB(o.bbox);const b=new mapboxgl.LngLatBounds(o.bbox);o.bboxCT=b.getCenter(),o.bboxSW=b.getSouthWest(),o.bboxNE=b.getNorthEast(),o.bboxNW=b.getNorthWest(),o.bboxSE=b.getSouthEast(),o.bboxW=b.getWest().toFixed(5),o.bboxS=b.getSouth().toFixed(5),o.bboxE=b.getEast().toFixed(5),o.bboxN=b.getNorth().toFixed(5),o.topLeft=o.bboxNW,o.bottomLeft=o.bboxSW,o.topRight=o.bboxNE,o.bottomRight=o.bboxSE,o.center=o.bboxCT;const T=point([o.bboxNE.lng,o.bboxNE.lat]),C=point([o.bboxSW.lng,o.bboxNE.lat]),L=point([o.bboxNE.lng,o.bboxSW.lat]),N=point([o.bboxSW.lng,o.bboxSW.lat]),F=midpoint(T,L),H=midpoint(C,N);return o.distance=distance(F,H,"kilometers").toFixed(2),o.maxPngValue=65535,o.rgbFileName="terrain-rgb-"+o.mapboxTileName+".png",o.thirtyTwoFileName="thirtytwo-"+o.mapboxTileName+".png",o.tileInfoFileName="tile-info-"+o.mapboxTileName+".json",o.geoJsonFileName="geojson-"+o.mapboxTileName+".json",o}function getAreaBB(e){let t=bboxPolygon(e);return area(t)}function getTileGeoJsonBB(e){let t=bboxPolygon(e);return{type:"Feature",geometry:{type:t.geometry.type,coordinates:t.geometry.coordinates}}}function getFeaturesFromBB(e,t,n){t.swPt=e.project(t.bboxSW),t.nePt=e.project(t.bboxNE),t.nwPt=e.project(t.bboxNW),t.sePt=e.project(t.bboxSE);let o=e.queryRenderedFeatures([t.swPt,t.nePt]);return n===!0&&(o=getUniqueFeatures(o)),o}function getUniqueFeatures(e){const t=new Set,n=[];for(const o of e){const u=o.properties.name,f=o.geometry.type;let g=u+"-"+f;t.has(g)||(t.add(g),n.push(o))}return n}async function loadImageFromArray(e){return await Image.load(e)}function getHeightFromRgb(e,t,n){return-1e4+(e*256*256+t*256+n)*.1}function getHeightArray(e){let t=[],n=e.getPixelsArray();for(const o of n){let u=o[0],f=o[1],g=o[2],a=getHeightFromRgb(u,f,g);a=parseFloat(a),t.push(a)}return t}async function downloadTerrainRgb(e){return await(await fetch(e)).arrayBuffer()}async function unrealRemoteControl(e,t){let n,o={},u="";const f={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{n=await fetch(t,f)}catch(g){u=g}return o.response=n,o.error=u,o}async function getMapboxTerrainRgb(e,t,n){let o,u=await fileUtils.fileExists(e,t.rgbFileName),f;return u===!1?o=await downloadTerrainRgb(n):o=await fileUtils.readFileFromDisk(e,t.rgbFileName),idbKeyval.set("rgbImageArrayBuffer",o),f=await loadImageFromArray(o),f}function convertImage(e,t,n,o,u){return new Image(e,t,n,{kind:u,bitDepth:o})}function createHeightMapImage(e,t,n){let o={},u=getHeightArray(e);idbKeyval.set("decodedHeightArray",u);let f=convertImage(e.width,e.height,u,t,n);return o.minElevation=f.min[0],o.maxElevation=f.max[0],o.image=f,o.decodedHeightArray=u,o}var mapUtils={getTileInfo,getFeaturesFromBB,getMapboxTerrainRgb,createHeightMapImage,loadImageFromArray,unrealRemoteControl,downloadTerrainRgb};function mitt(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(u){u(n)}),(o=e.get("*"))&&o.slice().map(function(u){u(t,n)})}}}var emitter=mitt(),immutable=extend$2,hasOwnProperty=Object.prototype.hasOwnProperty;function extend$2(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}var fuzzy$1={exports:{}};(function(e,t){(function(){var n={};e.exports=n,n.simpleFilter=function(o,u){return u.filter(function(f){return n.test(o,f)})},n.test=function(o,u){return n.match(o,u)!==null},n.match=function(o,u,f){f=f||{};var g=0,a=[],b=u.length,T=0,C=0,L=f.pre||"",N=f.post||"",F=f.caseSensitive&&u||u.toLowerCase(),H;o=f.caseSensitive&&o||o.toLowerCase();for(var se=0;se<b;se++)H=u[se],F[se]===o[g]?(H=L+H+N,g+=1,C+=1+C):C=0,T+=C,a[a.length]=H;return g===o.length?(T=F===o?1/0:T,{rendered:a.join(""),score:T}):null},n.filter=function(o,u,f){return!u||u.length===0?[]:typeof o!="string"?u:(f=f||{},u.reduce(function(g,a,b,T){var C=a;f.extract&&(C=f.extract(a));var L=n.match(o,C,f);return L!=null&&(g[g.length]={string:L.rendered,score:L.score,index:b,original:a}),g},[]).sort(function(g,a){var b=a.score-g.score;return b||g.index-a.index}))}})()})(fuzzy$1);var List$1=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(e){this.items.push(e)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};List$1.prototype.drawItem=function(e,t){var n=document.createElement("li"),o=document.createElement("a");t&&(n.className+=" active"),o.innerHTML=e.string,n.appendChild(o),this.element.appendChild(n),n.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),n.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))};List$1.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};List$1.prototype.move=function(e){this.active=e,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var list=List$1,extend$1=immutable,fuzzy=fuzzy$1.exports,List=list,Suggestions$1=function(e,t,n){return n=n||{},this.options=extend$1({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=e,this.data=t||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(o){this.handleKeyUp(o.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(o){this.handleKeyDown(o)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(o){this.handlePaste(o)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(t){for(var n=0;n<t.length&&(this.list.add(t[n]),n!==this.options.limit-1);n++);this.list.draw()}.bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(e){this.data=e,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(e){return e=e.toLowerCase(),e};Suggestions$1.prototype.match=function(e,t){return e.indexOf(t)>-1};Suggestions$1.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(o){return this.getItemValue(o)}.bind(this)},n;this.options.filter?(n=fuzzy.filter(this.query,this.data,t),n=n.map(function(o){return{original:o.original,string:this.render(o.original,o.string)}}.bind(this))):n=this.data.map(function(o){var u=this.render(o);return{original:o,string:u}}.bind(this)),e(n)};Suggestions$1.prototype.getItemValue=function(e){return e};Suggestions$1.prototype.render=function(e,t){if(t)return t;for(var n=e.original?this.getItemValue(e.original):this.getItemValue(e),o=this.normalize(n),u=o.lastIndexOf(this.query);u>-1;){var f=u+this.query.length;n=n.slice(0,u)+"<strong>"+n.slice(u,f)+"</strong>"+n.slice(f),u=o.slice(0,u).lastIndexOf(this.query)}return n};Suggestions$1.prototype.renderError=function(e){this.list.drawError(e)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window<"u"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT="Expected a function",NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce$1(e,t,n){var o,u,f,g,a,b,T=0,C=!1,L=!1,N=!0;if(typeof e!="function")throw new TypeError(FUNC_ERROR_TEXT);t=toNumber(t)||0,isObject(n)&&(C=!!n.leading,L="maxWait"in n,f=L?nativeMax(toNumber(n.maxWait)||0,t):f,N="trailing"in n?!!n.trailing:N);function F(Re){var ze=o,ve=u;return o=u=void 0,T=Re,g=e.apply(ve,ze),g}function H(Re){return T=Re,a=setTimeout(X,t),C?F(Re):g}function se(Re){var ze=Re-b,ve=Re-T,be=t-ze;return L?nativeMin(be,f-ve):be}function ce(Re){var ze=Re-b,ve=Re-T;return b===void 0||ze>=t||ze<0||L&&ve>=f}function X(){var Re=now();if(ce(Re))return ye(Re);a=setTimeout(X,se(Re))}function ye(Re){return a=void 0,N&&o?F(Re):(o=u=void 0,g)}function oe(){a!==void 0&&clearTimeout(a),T=0,o=b=u=a=void 0}function le(){return a===void 0?g:ye(now())}function ue(){var Re=now(),ze=ce(Re);if(o=arguments,u=this,b=Re,ze){if(a===void 0)return H(b);if(L)return a=setTimeout(X,t),F(b)}return a===void 0&&(a=setTimeout(X,t)),g}return ue.cancel=oe,ue.flush=le,ue}function isObject(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function isObjectLike(e){return!!e&&typeof e=="object"}function isSymbol(e){return typeof e=="symbol"||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if(typeof e=="number")return e;if(isSymbol(e))return NAN;if(isObject(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=isObject(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(reTrim,"");var n=reIsBinary.test(e);return n||reIsOctal.test(e)?freeParseInt(e.slice(2),n?2:8):reIsBadHex.test(e)?NAN:+e}var lodash_debounce=debounce$1,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function e(t,n,o){return Function.prototype.apply.call(t,n,o)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}var NumberIsNaN=Number.isNaN||function e(t){return t!==t};function EventEmitter$3(){EventEmitter$3.init.call(this)}events$1.exports=EventEmitter$3;events$1.exports.once=once;EventEmitter$3.EventEmitter=EventEmitter$3;EventEmitter$3.prototype._events=void 0;EventEmitter$3.prototype._eventsCount=0;EventEmitter$3.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(EventEmitter$3,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}});EventEmitter$3.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$3.prototype.setMaxListeners=function e(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(e){return e._maxListeners===void 0?EventEmitter$3.defaultMaxListeners:e._maxListeners}EventEmitter$3.prototype.getMaxListeners=function e(){return _getMaxListeners(this)};EventEmitter$3.prototype.emit=function e(t){for(var n=[],o=1;o<arguments.length;o++)n.push(arguments[o]);var u=t==="error",f=this._events;if(f!==void 0)u=u&&f.error===void 0;else if(!u)return!1;if(u){var g;if(n.length>0&&(g=n[0]),g instanceof Error)throw g;var a=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw a.context=g,a}var b=f[t];if(b===void 0)return!1;if(typeof b=="function")ReflectApply(b,this,n);else for(var T=b.length,C=arrayClone(b,T),o=0;o<T;++o)ReflectApply(C[o],this,n);return!0};function _addListener(e,t,n,o){var u,f,g;if(checkListener(n),f=e._events,f===void 0?(f=e._events=Object.create(null),e._eventsCount=0):(f.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),f=e._events),g=f[t]),g===void 0)g=f[t]=n,++e._eventsCount;else if(typeof g=="function"?g=f[t]=o?[n,g]:[g,n]:o?g.unshift(n):g.push(n),u=_getMaxListeners(e),u>0&&g.length>u&&!g.warned){g.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=g.length,ProcessEmitWarning(a)}return e}EventEmitter$3.prototype.addListener=function e(t,n){return _addListener(this,t,n,!1)};EventEmitter$3.prototype.on=EventEmitter$3.prototype.addListener;EventEmitter$3.prototype.prependListener=function e(t,n){return _addListener(this,t,n,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},u=onceWrapper.bind(o);return u.listener=n,o.wrapFn=u,u}EventEmitter$3.prototype.once=function e(t,n){return checkListener(n),this.on(t,_onceWrap(this,t,n)),this};EventEmitter$3.prototype.prependOnceListener=function e(t,n){return checkListener(n),this.prependListener(t,_onceWrap(this,t,n)),this};EventEmitter$3.prototype.removeListener=function e(t,n){var o,u,f,g,a;if(checkListener(n),u=this._events,u===void 0)return this;if(o=u[t],o===void 0)return this;if(o===n||o.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete u[t],u.removeListener&&this.emit("removeListener",t,o.listener||n));else if(typeof o!="function"){for(f=-1,g=o.length-1;g>=0;g--)if(o[g]===n||o[g].listener===n){a=o[g].listener,f=g;break}if(f<0)return this;f===0?o.shift():spliceOne(o,f),o.length===1&&(u[t]=o[0]),u.removeListener!==void 0&&this.emit("removeListener",t,a||n)}return this};EventEmitter$3.prototype.off=EventEmitter$3.prototype.removeListener;EventEmitter$3.prototype.removeAllListeners=function e(t){var n,o,u;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[t]),this;if(arguments.length===0){var f=Object.keys(o),g;for(u=0;u<f.length;++u)g=f[u],g!=="removeListener"&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=o[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(u=n.length-1;u>=0;u--)this.removeListener(t,n[u]);return this};function _listeners(e,t,n){var o=e._events;if(o===void 0)return[];var u=o[t];return u===void 0?[]:typeof u=="function"?n?[u.listener||u]:[u]:n?unwrapListeners(u):arrayClone(u,u.length)}EventEmitter$3.prototype.listeners=function e(t){return _listeners(this,t,!0)};EventEmitter$3.prototype.rawListeners=function e(t){return _listeners(this,t,!1)};EventEmitter$3.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):listenerCount.call(e,t)};EventEmitter$3.prototype.listenerCount=listenerCount;function listenerCount(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}EventEmitter$3.prototype.eventNames=function e(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function unwrapListeners(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function once(e,t){return new Promise(function(n,o){function u(g){e.removeListener(t,f),o(g)}function f(){typeof e.removeListener=="function"&&e.removeListener("error",u),n([].slice.call(arguments))}eventTargetAgnosticAddListener(e,t,f,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(e,u,{once:!0})})}function addErrorHandlerIfEventEmitter(e,t,n){typeof e.on=="function"&&eventTargetAgnosticAddListener(e,"error",t,n)}function eventTargetAgnosticAddListener(e,t,n,o){if(typeof e.on=="function")o.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function u(f){o.once&&e.removeEventListener(t,u),n(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam$1(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink$1(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var n=t[1],o=t[2].split(";"),u=null,f=o.reduce(function(g,a){var b=parseParam$1(a);return b?b.key==="rel"?(u||(u=b.value),g):(g[b.key]=b.value,g):g},{});return u?{url:n,rel:u,params:f}:null}function parseLinkHeader$3(e){return e?e.split(/,\s*</).reduce(function(t,n){var o=parseLink$1(n);if(!o)return t;var u=o.rel.split(/\s+/);return u.forEach(function(f){t[f]||(t[f]={url:o.url,params:o.params})}),t},{}):{}}var parseLinkHeader_1$1=parseLinkHeader$3,parseLinkHeader$2=parseLinkHeader_1$1;function MapiResponse$3(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader$2(this.headers.link)}MapiResponse$3.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$3.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse$1=MapiResponse$3,constants$9={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$8=constants$9;function MapiError$3(e){var t=e.type||constants$8.ERROR_HTTP,n;if(e.body)try{n=JSON.parse(e.body)}catch{n=e.body}else n=null;var o=e.message||null;o||(typeof n=="string"?o=n:n&&typeof n.message=="string"?o=n.message:t===constants$8.ERROR_REQUEST_ABORTED&&(o="Request aborted")),this.message=o,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=n}var mapiError$1=MapiError$3;function parseSingleHeader$1(e){var t=e.indexOf(":"),n=e.substring(0,t).trim().toLowerCase(),o=e.substring(t+1).trim();return{name:n,value:o}}function parseHeaders$3(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(n){var o=parseSingleHeader$1(n);t[o.name]=o.value}),t}var parseHeaders_1$1=parseHeaders$3,MapiResponse$2=mapiResponse$1,MapiError$2=mapiError$1,constants$7=constants$9,parseHeaders$2=parseHeaders_1$1,requestsUnderway$1={};function browserAbort$1(e){var t=requestsUnderway$1[e.id];!t||(t.abort(),delete requestsUnderway$1[e.id])}function createResponse$1(e,t){return new MapiResponse$2(e,{body:t.response,headers:parseHeaders$2(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent$1(e){var t=e.total,n=e.loaded,o=100*n/t;return{total:t,transferred:n,percent:o}}function sendRequestXhr$1(e,t){return new Promise(function(n,o){t.onprogress=function(g){e.emitter.emit(constants$7.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent$1(g))};var u=e.file;u&&(t.upload.onprogress=function(g){e.emitter.emit(constants$7.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent$1(g))}),t.onerror=function(g){o(g)},t.onabort=function(){var g=new MapiError$2({request:e,type:constants$7.ERROR_REQUEST_ABORTED});o(g)},t.onload=function(){if(delete requestsUnderway$1[e.id],t.status<200||t.status>=400){var g=new MapiError$2({request:e,body:t.response,statusCode:t.status});o(g);return}n(t)};var f=e.body;typeof f=="string"?t.send(f):f?t.send(JSON.stringify(f)):u?t.send(u):t.send(),requestsUnderway$1[e.id]=t}).then(function(n){return createResponse$1(e,n)})}function createRequestXhr$1(e,t){var n=e.url(t),o=new window.XMLHttpRequest;return o.open(e.method,n),Object.keys(e.headers).forEach(function(u){o.setRequestHeader(u,e.headers[u])}),o}function browserSend$1(e){return Promise.resolve().then(function(){var t=createRequestXhr$1(e,e.client.accessToken);return sendRequestXhr$1(e,t)})}var browserLayer$1={browserAbort:browserAbort$1,sendRequestXhr:sendRequestXhr$1,browserSend:browserSend$1,createRequestXhr:createRequestXhr$1},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(e,t){(function(n){var o=t,u=e&&e.exports==o&&e,f=typeof commonjsGlobal=="object"&&commonjsGlobal;(f.global===f||f.window===f)&&(n=f);var g=function(H){this.message=H};g.prototype=new Error,g.prototype.name="InvalidCharacterError";var a=function(H){throw new g(H)},b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=/[\t\n\f\r ]/g,C=function(H){H=String(H).replace(T,"");var se=H.length;se%4==0&&(H=H.replace(/==?$/,""),se=H.length),(se%4==1||/[^+a-zA-Z0-9/]/.test(H))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var ce=0,X,ye,oe="",le=-1;++le<se;)ye=b.indexOf(H.charAt(le)),X=ce%4?X*64+ye:ye,ce++%4&&(oe+=String.fromCharCode(255&X>>(-2*ce&6)));return oe},L=function(H){H=String(H),/[^\0-\xFF]/.test(H)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var se=H.length%3,ce="",X=-1,ye,oe,le,ue,Re=H.length-se;++X<Re;)ye=H.charCodeAt(X)<<16,oe=H.charCodeAt(++X)<<8,le=H.charCodeAt(++X),ue=ye+oe+le,ce+=b.charAt(ue>>18&63)+b.charAt(ue>>12&63)+b.charAt(ue>>6&63)+b.charAt(ue&63);return se==2?(ye=H.charCodeAt(X)<<8,oe=H.charCodeAt(++X),ue=ye+oe,ce+=b.charAt(ue>>10)+b.charAt(ue>>4&63)+b.charAt(ue<<2&63)+"="):se==1&&(ue=H.charCodeAt(X),ce+=b.charAt(ue>>2)+b.charAt(ue<<4&63)+"=="),ce},N={encode:L,decode:C,version:"0.1.0"};if(o&&!o.nodeType)if(u)u.exports=N;else for(var F in N)N.hasOwnProperty(F)&&(o[F]=N[F]);else n.base64=N})(commonjsGlobal)})(base64$1,base64$1.exports);var base64=base64$1.exports,tokenCache={};function parseToken$4(e){if(tokenCache[e])return tokenCache[e];var t=e.split("."),n=t[0],o=t[1];if(!o)throw new Error("Invalid token");var u=parsePaylod(o),f={usage:n,user:u.u};return has(u,"a")&&(f.authorization=u.a),has(u,"exp")&&(f.expires=u.exp*1e3),has(u,"iat")&&(f.created=u.iat*1e3),has(u,"scopes")&&(f.scopes=u.scopes),has(u,"client")&&(f.client=u.client),has(u,"ll")&&(f.lastLogin=u.ll),has(u,"iu")&&(f.impersonator=u.iu),tokenCache[e]=f,f}function parsePaylod(e){try{return JSON.parse(base64.decode(e))}catch{throw new Error("Invalid token")}}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var parseMapboxToken=parseToken$4,eventemitter3={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(n=!1));function u(b,T,C){this.fn=b,this.context=T,this.once=C||!1}function f(b,T,C,L,N){if(typeof C!="function")throw new TypeError("The listener must be a function");var F=new u(C,L||b,N),H=n?n+T:T;return b._events[H]?b._events[H].fn?b._events[H]=[b._events[H],F]:b._events[H].push(F):(b._events[H]=F,b._eventsCount++),b}function g(b,T){--b._eventsCount===0?b._events=new o:delete b._events[T]}function a(){this._events=new o,this._eventsCount=0}a.prototype.eventNames=function(){var T=[],C,L;if(this._eventsCount===0)return T;for(L in C=this._events)t.call(C,L)&&T.push(n?L.slice(1):L);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(C)):T},a.prototype.listeners=function(T){var C=n?n+T:T,L=this._events[C];if(!L)return[];if(L.fn)return[L.fn];for(var N=0,F=L.length,H=new Array(F);N<F;N++)H[N]=L[N].fn;return H},a.prototype.listenerCount=function(T){var C=n?n+T:T,L=this._events[C];return L?L.fn?1:L.length:0},a.prototype.emit=function(T,C,L,N,F,H){var se=n?n+T:T;if(!this._events[se])return!1;var ce=this._events[se],X=arguments.length,ye,oe;if(ce.fn){switch(ce.once&&this.removeListener(T,ce.fn,void 0,!0),X){case 1:return ce.fn.call(ce.context),!0;case 2:return ce.fn.call(ce.context,C),!0;case 3:return ce.fn.call(ce.context,C,L),!0;case 4:return ce.fn.call(ce.context,C,L,N),!0;case 5:return ce.fn.call(ce.context,C,L,N,F),!0;case 6:return ce.fn.call(ce.context,C,L,N,F,H),!0}for(oe=1,ye=new Array(X-1);oe<X;oe++)ye[oe-1]=arguments[oe];ce.fn.apply(ce.context,ye)}else{var le=ce.length,ue;for(oe=0;oe<le;oe++)switch(ce[oe].once&&this.removeListener(T,ce[oe].fn,void 0,!0),X){case 1:ce[oe].fn.call(ce[oe].context);break;case 2:ce[oe].fn.call(ce[oe].context,C);break;case 3:ce[oe].fn.call(ce[oe].context,C,L);break;case 4:ce[oe].fn.call(ce[oe].context,C,L,N);break;default:if(!ye)for(ue=1,ye=new Array(X-1);ue<X;ue++)ye[ue-1]=arguments[ue];ce[oe].fn.apply(ce[oe].context,ye)}}return!0},a.prototype.on=function(T,C,L){return f(this,T,C,L,!1)},a.prototype.once=function(T,C,L){return f(this,T,C,L,!0)},a.prototype.removeListener=function(T,C,L,N){var F=n?n+T:T;if(!this._events[F])return this;if(!C)return g(this,F),this;var H=this._events[F];if(H.fn)H.fn===C&&(!N||H.once)&&(!L||H.context===L)&&g(this,F);else{for(var se=0,ce=[],X=H.length;se<X;se++)(H[se].fn!==C||N&&!H[se].once||L&&H[se].context!==L)&&ce.push(H[se]);ce.length?this._events[F]=ce.length===1?ce[0]:ce:g(this,F)}return this},a.prototype.removeAllListeners=function(T){var C;return T?(C=n?n+T:T,this._events[C]&&g(this,C)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})(eventemitter3);function encodeArray$1(e){return e.map(encodeURIComponent).join(",")}function encodeValue$1(e){return Array.isArray(e)?encodeArray$1(e):encodeURIComponent(String(e))}function appendQueryParam$1(e,t,n){if(n===!1||n===null)return e;var o=/\?/.test(e)?"&":"?",u=encodeURIComponent(t);return n!==void 0&&n!==""&&n!==!0&&(u+="="+encodeValue$1(n)),""+e+o+u}function appendQueryObject$1(e,t){if(!t)return e;var n=e;return Object.keys(t).forEach(function(o){var u=t[o];u!==void 0&&(Array.isArray(u)&&(u=u.filter(function(f){return f!=null}).join(",")),n=appendQueryParam$1(n,o,u))}),n}function prependOrigin$1(e,t){if(!t||e.slice(0,4)==="http")return e;var n=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+n+e}function interpolateRouteParams$1(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(n,o){var u=t[o];if(u===void 0)throw new Error("Unspecified route parameter "+o);var f=encodeValue$1(u);return"/"+f}):e}var urlUtils$3={appendQueryObject:appendQueryObject$1,appendQueryParam:appendQueryParam$1,prependOrigin:prependOrigin$1,interpolateRouteParams:interpolateRouteParams$1},parseToken$3=parseMapboxToken,xtend$6=immutable,EventEmitter$2=eventemitter3.exports,urlUtils$2=urlUtils$3,constants$6=constants$9,requestId$1=1;function MapiRequest$3(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};t.body&&(n["content-type"]="application/json");var o=xtend$6(n,t.headers),u=Object.keys(o).reduce(function(f,g){return f[g.toLowerCase()]=o[g],f},{});this.id=requestId$1++,this._options=t,this.emitter=new EventEmitter$2,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=u}MapiRequest$3.prototype.url=function e(t){var n=urlUtils$2.prependOrigin(this.path,this.origin);n=urlUtils$2.appendQueryObject(n,this.query);var o=this.params,u=t??this.client.accessToken;if(u){n=urlUtils$2.appendQueryParam(n,"access_token",u);var f=parseToken$3(u).user;o=xtend$6({ownerId:f},o)}return n=urlUtils$2.interpolateRouteParams(n,o),n};MapiRequest$3.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(n){return t.response=n,t.emitter.emit(constants$6.EVENT_RESPONSE,n),n},function(n){throw t.error=n,t.emitter.emit(constants$6.EVENT_ERROR,n),n})};MapiRequest$3.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$3.prototype.eachPage=function e(t){var n=this;function o(g){function a(){delete n._nextPageRequest;var b=g.nextPage();b&&(n._nextPageRequest=b,f(b))}t(null,g,a)}function u(g){t(g,null,function(){})}function f(g){g.send().then(o,u)}f(this)};MapiRequest$3.prototype.clone=function e(){return this._extend()};MapiRequest$3.prototype._extend=function e(t){var n=xtend$6(this._options,t);return new MapiRequest$3(this.client,n)};var mapiRequest$1=MapiRequest$3,parseToken$2=parseMapboxToken,MapiRequest$2=mapiRequest$1,constants$5=constants$9;function MapiClient$5(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken$2(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$5.API_ORIGIN}MapiClient$5.prototype.createRequest=function e(t){return new MapiRequest$2(this,t)};var mapiClient$1=MapiClient$5,browser$1=browserLayer$1,MapiClient$4=mapiClient$1;function BrowserClient$1(e){MapiClient$4.call(this,e)}BrowserClient$1.prototype=Object.create(MapiClient$4.prototype);BrowserClient$1.prototype.constructor=BrowserClient$1;BrowserClient$1.prototype.sendRequest=browser$1.browserSend;BrowserClient$1.prototype.abortRequest=browser$1.browserAbort;function createBrowserClient$1(e){return new BrowserClient$1(e)}var browserClient$1=createBrowserClient$1,client=browserClient$1,mapboxSdk=client,toString=Object.prototype.toString,isPlainObj=function(e){var t;return toString.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$5=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$4={};v$4.assert=function(e,t){return t=t||{},function(n){var o=validate(e,n);if(!!o){var u=processMessage(o,t);throw t.apiName&&(u=t.apiName+": "+u),new Error(u)}}};v$4.shape=function e(t){var n=objectEntries(t);return function(u){var f=validate(v$4.plainObject,u);if(f)return f;for(var g,a,b=[],T=0;T<n.length;T++)g=n[T].key,a=n[T].value,f=validate(a,u[g]),f&&b.push([g].concat(f));return b.length<2?b[0]:function(C){b=b.map(function(F){var H=F[0],se=processMessage(F,C).split(`
`).join(NEWLINE_INDENT);return"- "+H+": "+se});var L=C.path.join("."),N=L===DEFAULT_ERROR_PATH?"":" of "+L;return"The following properties"+N+" have invalid values:"+NEWLINE_INDENT+b.join(NEWLINE_INDENT)}}};v$4.strictShape=function e(t){var n=v$4.shape(t);return function(u){var f=n(u);if(f)return f;var g=Object.keys(u).reduce(function(a,b){return t[b]===void 0&&a.push(b),a},[]);if(g.length!==0)return function(){return"The following keys are invalid: "+g.join(", ")}}};v$4.arrayOf=function e(t){return createArrayValidator(t)};v$4.tuple=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(t)};function createArrayValidator(e){var t=Array.isArray(e),n=function(o){return t?e[o]:e};return function(u){var f=validate(v$4.plainArray,u);if(f)return f;if(t&&u.length!==e.length)return"an array with "+e.length+" items";for(var g=0;g<u.length;g++)if(f=validate(n(g),u[g]),f)return[g].concat(f)}}v$4.required=function e(t){function n(o){return o==null?function(u){return formatErrorMessage(u,isArrayCulprit(u.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return n.__required=!0,n};v$4.oneOfType=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(o){var u=t.map(function(f){return validate(f,o)}).filter(Boolean);if(u.length===t.length)return u.every(function(f){return f.length===1&&typeof f[0]=="string"})?orList(u.map(function(f){return f[0]})):u.reduce(function(f,g){return g.length>f.length?g:f})}};v$4.equal=function e(t){return function(o){if(o!==t)return JSON.stringify(t)}};v$4.oneOf=function e(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=t.map(function(o){return v$4.equal(o)});return v$4.oneOfType.apply(this,n)};v$4.range=function e(t){var n=t[0],o=t[1];return function(f){var g=validate(v$4.number,f);if(g||f<n||f>o)return"number between "+n+" & "+o+" (inclusive)"}};v$4.any=function e(){};v$4.boolean=function e(t){if(typeof t!="boolean")return"boolean"};v$4.number=function e(t){if(typeof t!="number")return"number"};v$4.plainArray=function e(t){if(!Array.isArray(t))return"array"};v$4.plainObject=function e(t){if(!isPlainObject(t))return"object"};v$4.string=function e(t){if(typeof t!="string")return"string"};v$4.func=function e(t){if(typeof t!="function")return"function"};function validate(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var n=e(t);if(n)return Array.isArray(n)?n:[n]}}function processMessage(e,t){var n=e.length,o=e[n-1],u=e.slice(0,n-1);return u.length===0&&(u=[DEFAULT_ERROR_PATH]),t=xtend$5(t,{path:u}),typeof o=="function"?o(t):formatErrorMessage(t,prettifyResult(o))}function orList(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function prettifyResult(e){return"must be "+addArticle(e)+"."}function addArticle(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function formatErrorMessage(e,t){var n=isArrayCulprit(e.path),o=e.path.join(".")+" "+t,u=n?"Item at position ":"";return u+o}function isArrayCulprit(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function objectEntries(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}v$4.validate=validate;v$4.processMessage=processMessage;var lib$1=v$4,xtend$4=immutable,v$3=lib$1;function file$1(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape$1(e,t){return v$3.assert(v$3.strictShape(e),t)}function date$1(e){var t="date";if(typeof e=="boolean")return t;try{var n=new Date(e);if(n.getTime&&isNaN(n.getTime()))return t}catch{return t}}function coordinates$1(e){return v$3.tuple(v$3.number,v$3.number)(e)}var validator$1=xtend$4(v$3,{file:file$1,date:date$1,coordinates:coordinates$1,assertShape:assertShape$1});function pick$3(e,t){var n=function(o,u){return t.indexOf(o)!==-1&&u!==void 0};return typeof t=="function"&&(n=t),Object.keys(e).filter(function(o){return n(o,e[o])}).reduce(function(o,u){return o[u]=e[u],o},{})}var pick_1$1=pick$3;function objectMap$3(e,t){return Object.keys(e).reduce(function(n,o){return n[o]=t(o,e[o]),n},{})}var objectMap_1$1=objectMap$3,objectMap$2=objectMap_1$1;function stringifyBoolean$1(e){return objectMap$2(e,function(t,n){return typeof n=="boolean"?JSON.stringify(n):n})}var stringifyBooleans$3=stringifyBoolean$1,MapiClient$3=mapiClient$1,createClient$1=browserClient$1;function createServiceFactory$3(e){return function(t){var n;MapiClient$3.prototype.isPrototypeOf(t)?n=t:n=createClient$1(t);var o=Object.create(e);return o.client=n,o}}var createServiceFactory_1$1=createServiceFactory$3,xtend$3=immutable,v$2=validator$1,pick$2=pick_1$1,stringifyBooleans$2=stringifyBooleans$3,createServiceFactory$2=createServiceFactory_1$1,Geocoding$1={},featureTypes$1=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding$1.forwardGeocode=function(e){v$2.assertShape({query:v$2.required(v$2.string),mode:v$2.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$2.arrayOf(v$2.string),proximity:v$2.oneOf(v$2.coordinates,"ip"),types:v$2.arrayOf(v$2.oneOf(featureTypes$1)),autocomplete:v$2.boolean,bbox:v$2.arrayOf(v$2.number),limit:v$2.number,language:v$2.arrayOf(v$2.string),routing:v$2.boolean,fuzzyMatch:v$2.boolean,worldview:v$2.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};Geocoding$1.reverseGeocode=function(e){v$2.assertShape({query:v$2.required(v$2.coordinates),mode:v$2.oneOf("mapbox.places","mapbox.places-permanent"),countries:v$2.arrayOf(v$2.string),types:v$2.arrayOf(v$2.oneOf(featureTypes$1)),bbox:v$2.arrayOf(v$2.number),limit:v$2.number,language:v$2.arrayOf(v$2.string),reverseMode:v$2.oneOf("distance","score"),routing:v$2.boolean,worldview:v$2.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans$2(xtend$3({country:e.countries},pick$2(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick$2(e,["mode","query"]),query:t})};var geocoding$1=createServiceFactory$2(Geocoding$1);let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random=e=>crypto.getRandomValues(new Uint8Array(e)),customRandom=(e,t,n)=>{let o=(2<<Math.log(e.length-1)/Math.LN2)-1,u=-~(1.6*o*t/e.length);return(f=t)=>{let g="";for(;;){let a=n(u),b=u;for(;b--;)if(g+=e[a[b]&o]||"",g.length===f)return g}}},customAlphabet=(e,t=21)=>customRandom(e,t,random),nanoid$1=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");var index_browser=Object.freeze(Object.defineProperty({__proto__:null,nanoid:nanoid$1,customAlphabet,customRandom,urlAlphabet,random},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(index_browser),nanoid=require$$0.nanoid;function MapboxEventManager$1(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(e,t){var n=this.getSelectedIndex(e,t),o=this.getEventPayload("search.select",t);if(o.resultIndex=n,o.resultPlaceName=e.place_name,o.resultId=e.id,!(n===this.lastSentIndex&&o.queryString===this.lastSentInput||n==-1)&&(this.lastSentIndex=n,this.lastSentInput=o.queryString,!!o.queryString))return this.push(o)},start:function(e){var t=this.getEventPayload("search.start",e);if(!!t.queryString)return this.push(t)},keyevent:function(e,t){if(!!e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var n=this.getEventPayload("search.keystroke",t);if(n.lastAction=e.key,!!n.queryString)return this.push(n)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var n=this.getRequestOptions(e);this.request(n,function(o){if(o)return this.handleError(o,t);if(t)return t()}.bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t){var n;t.options.proximity?typeof t.options.proximity=="object"?n=[t.options.proximity.longitude,t.options.proximity.latitude]:t.options.proximity==="ip"?n=[999,999]:n=t.options.proximity:n=null;var o=t._map?t._map.getZoom():void 0,u={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:n,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:o,keyboardLocale:this.locale};return e==="search.select"?u.queryString=t.inputString:e!="search.select"&&t._inputEl?u.queryString=t._inputEl.value:u.queryString=t.inputString,u},request:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},n.open(e.method,e.host+"/"+e.path,!0);for(var o in e.headers){var u=e.headers[o];n.setRequestHeader(o,u)}n.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(!!t._typeahead){var n=t._typeahead.data,o=e.id,u=n.map(function(g){return g.id}),f=u.indexOf(o);return f}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},localization$1={placeholder},subtag$1={exports:{}};(function(e){(function(t,n,o){e.exports?e.exports=o():t[n]=o()})(commonjsGlobal,"subtag",function(){var t="",n=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function o(b){return b.match(n)||[]}function u(b){return o(b).filter(function(T,C){return T&&C})}function f(b){return b=o(b),{language:b[1]||t,extlang:b[2]||t,script:b[3]||t,region:b[4]||t}}function g(b,T,C){Object.defineProperty(b,T,{value:C,enumerable:!0})}function a(b,T,C){function L(N){return o(N)[b]||t}g(L,"pattern",T),g(f,C,L)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),g(f,"split",u),f})})(subtag$1);function Geolocation$1(){}Geolocation$1.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,n){window.navigator.geolocation.getCurrentPosition(t,n,e)})}};var geolocation=Geolocation$1;function transformFeatureToGeolocationText(e,t){const n=getAddressInfo(e),o=["address","street","place","country"];var u;if(typeof t=="function")return t(n);const f=o.indexOf(t);return f===-1?u=o:u=o.slice(f),u.reduce(function(g,a){return n[a]?(g!==""&&(g=g+", "),g+n[a]):g},"")}function getAddressInfo(e){const t=e.address||"",n=e.text||"",o=e.place_name||"",f={address:o.split(",")[0],houseNumber:t,street:n,placeName:o};return e.context.forEach(function(g){const a=g.id.split(".")[0];f[a]=g.text}),f}const REVERSE_GEOCODE_COORD_RGX=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var utils$1={transformFeatureToGeolocationText,getAddressInfo,REVERSE_GEOCODE_COORD_RGX},Typeahead=suggestions,debounce=lodash_debounce,extend=immutable,EventEmitter$1=events$1.exports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding$1,MapboxEventManager=events,localization=localization$1,subtag=subtag$1.exports,Geolocation=geolocation,utils=utils$1;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function getFooterNode(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function MapboxGeocoder(e){this._eventEmitter=new EventEmitter$1,this.options=extend({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Geolocation}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(n,o){if(!document.body.contains(o))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const u=n.onAdd();o.appendChild(u)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const n=document.querySelectorAll(e);if(n.length===0)throw new Error("Element ",e,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,n[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(T){this.eventManager.keyevent(T,this)}.bind(this));var o=document.createElement("div");o.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var u=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(u),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),o.appendChild(this._clearEl),o.appendChild(this._loadingEl),t.appendChild(n),t.appendChild(this._inputEl),t.appendChild(o),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var f=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(f),o.appendChild(this._geolocateEl),this._showGeolocateButton()}var g=this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),g.getItemValue=this.options.getItemValue;var a=g.list.draw,b=this._footerNode=getFooterNode();return g.list.draw=function(){a.call(this),b.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),b.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(b)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const n={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const o=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(o),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(n).send().then(function(o){const u=o.body.features[0];if(u){const f=utils.transformFeatureToGeolocationText(u,this.options.addressAccuracy);this._setInputValue(f),u.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:u})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),n.innerHTML=t,n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,n=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var o=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,u=o?o.value:"";if(!u)return this.fresh=!0,e.keyCode!==n&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[n,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&o.value.length>=this.options.minLength&&this._geocode(o.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&exceptions[e.properties.short_code])t=extend({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[e.properties.short_code].bbox,t);else if(e.bbox){var n=e.bbox;t=extend({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],t)}else{var o={zoom:this.options.zoom};t=extend({},o,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var n;return e.localGeocoderOnly?n=GEOCODE_REQUEST_TYPE.LOCAL:e.reverseGeocode&&utils.REVERSE_GEOCODE_COORD_RGX.test(t)?n=GEOCODE_REQUEST_TYPE.REVERSE:n=GEOCODE_REQUEST_TYPE.FORWARD,n},_setupConfig:function(e,t){const n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],o=/[\s,]+/;var u=this,f=n.reduce(function(a,b){if(u.options[b]===void 0||u.options[b]===null)return a;["countries","types","language"].indexOf(b)>-1?a[b]=u.options[b].split(o):a[b]=u.options[b];const T=typeof u.options[b].longitude=="number"&&typeof u.options[b].latitude=="number";if(b==="proximity"&&T){const C=u.options[b].longitude,L=u.options[b].latitude;a[b]=[C,L]}return a},{});switch(e){case GEOCODE_REQUEST_TYPE.REVERSE:{var g=t.split(o).map(function(a){return parseFloat(a,10)});u.options.flipCoordinates||g.reverse(),f.types&&f.types[0],f=extend(f,{query:g,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(a){a in f&&delete f[a]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:{const a=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(a)&&(t=t.replace(/,/g," ")),f=extend(f,{query:t})}break}return f},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),n=this._setupConfig(t,e);var o;switch(t){case GEOCODE_REQUEST_TYPE.LOCAL:o=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:o=this.geocoderService.forwardGeocode(n).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:o=this.geocoderService.reverseGeocode(n).send();break}var u=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],f=[],g=null;return o.catch(function(a){g=a}.bind(this)).then(function(a){this._hideLoadingIcon();var b={};return a?a.statusCode=="200"&&(b=a.body,b.request=a.request,b.headers=a.headers):b={type:"FeatureCollection",features:[]},b.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),b.features=b.features?u.concat(b.features):u,this.options.externalGeocoder?(f=this.options.externalGeocoder(e,b.features)||Promise.resolve([]),f.then(function(T){return b.features=b.features?T.concat(b.features):T,b},function(){return b})):b}.bind(this)).then(function(a){if(g)throw g;this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter)),a.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",a),this._typeahead.update(a.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))}.bind(this)).catch(function(a){this._hideLoadingIcon(),this._hideAttribution(),u.length&&this.options.localGeocoder||f.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(u)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:u}),this._eventEmitter.emit("error",{error:a})}.bind(this)),o},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(!!t.features.length){var n=t.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=subtag.language(e),n=localization.placeholder[t];if(n)return n}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(!!this._map){this._removeMarker();var t={color:"#4668F2"},n=extend({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var lib=MapboxGeocoder,xtend$2=immutable,v$1=lib$1;function file(e){if(typeof window<"u")return e instanceof commonjsGlobal.Blob||e instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function assertShape(e,t){return v$1.assert(v$1.strictShape(e),t)}function date(e){var t="date";if(typeof e=="boolean")return t;try{var n=new Date(e);if(n.getTime&&isNaN(n.getTime()))return t}catch{return t}}function coordinates(e){return v$1.tuple(v$1.number,v$1.number)(e)}var validator=xtend$2(v$1,{file,date,coordinates,assertShape});function pick$1(e,t){var n=function(o,u){return t.indexOf(o)!==-1&&u!==void 0};return typeof t=="function"&&(n=t),Object.keys(e).filter(function(o){return n(o,e[o])}).reduce(function(o,u){return o[u]=e[u],o},{})}var pick_1=pick$1;function objectMap$1(e,t){return Object.keys(e).reduce(function(n,o){return n[o]=t(o,e[o]),n},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(e){return objectMap(e,function(t,n){return typeof n=="boolean"?JSON.stringify(n):n})}var stringifyBooleans$1=stringifyBoolean;function encodeArray(e){return e.map(encodeURIComponent).join(",")}function encodeValue(e){return Array.isArray(e)?encodeArray(e):encodeURIComponent(String(e))}function appendQueryParam(e,t,n){if(n===!1||n===null)return e;var o=/\?/.test(e)?"&":"?",u=encodeURIComponent(t);return n!==void 0&&n!==""&&n!==!0&&(u+="="+encodeValue(n)),""+e+o+u}function appendQueryObject(e,t){if(!t)return e;var n=e;return Object.keys(t).forEach(function(o){var u=t[o];u!==void 0&&(Array.isArray(u)&&(u=u.filter(function(f){return f!=null}).join(",")),n=appendQueryParam(n,o,u))}),n}function prependOrigin(e,t){if(!t||e.slice(0,4)==="http")return e;var n=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+n+e}function interpolateRouteParams(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(n,o){var u=t[o];if(u===void 0)throw new Error("Unspecified route parameter "+o);var f=encodeValue(u);return"/"+f}):e}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},constants$4={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},parseToken$1=parseMapboxToken,xtend$1=immutable,EventEmitter=eventemitter3.exports,urlUtils=urlUtils$1,constants$3=constants$4,requestId=1;function MapiRequest$1(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};t.body&&(n["content-type"]="application/json");var o=xtend$1(n,t.headers),u=Object.keys(o).reduce(function(f,g){return f[g.toLowerCase()]=o[g],f},{});this.id=requestId++,this._options=t,this.emitter=new EventEmitter,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=u}MapiRequest$1.prototype.url=function e(t){var n=urlUtils.prependOrigin(this.path,this.origin);n=urlUtils.appendQueryObject(n,this.query);var o=this.params,u=t??this.client.accessToken;if(u){n=urlUtils.appendQueryParam(n,"access_token",u);var f=parseToken$1(u).user;o=xtend$1({ownerId:f},o)}return n=urlUtils.interpolateRouteParams(n,o),n};MapiRequest$1.prototype.send=function e(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(n){return t.response=n,t.emitter.emit(constants$3.EVENT_RESPONSE,n),n},function(n){throw t.error=n,t.emitter.emit(constants$3.EVENT_ERROR,n),n})};MapiRequest$1.prototype.abort=function e(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function e(t){var n=this;function o(g){function a(){delete n._nextPageRequest;var b=g.nextPage();b&&(n._nextPageRequest=b,f(b))}t(null,g,a)}function u(g){t(g,null,function(){})}function f(g){g.send().then(o,u)}f(this)};MapiRequest$1.prototype.clone=function e(){return this._extend()};MapiRequest$1.prototype._extend=function e(t){var n=xtend$1(this._options,t);return new MapiRequest$1(this.client,n)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants$2=constants$4;function MapiClient$2(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");parseToken(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||constants$2.API_ORIGIN}MapiClient$2.prototype.createRequest=function e(t){return new MapiRequest(this,t)};var mapiClient=MapiClient$2;function parseParam(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var n=t[1],o=t[2].split(";"),u=null,f=o.reduce(function(g,a){var b=parseParam(a);return b?b.key==="rel"?(u||(u=b.value),g):(g[b.key]=b.value,g):g},{});return u?{url:n,rel:u,params:f}:null}function parseLinkHeader$1(e){return e?e.split(/,\s*</).reduce(function(t,n){var o=parseLink(n);if(!o)return t;var u=o.rel.split(/\s+/);return u.forEach(function(f){t[f]||(t[f]={url:o.url,params:o.params})}),t},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function e(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function e(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$1=constants$4;function MapiError$1(e){var t=e.type||constants$1.ERROR_HTTP,n;if(e.body)try{n=JSON.parse(e.body)}catch{n=e.body}else n=null;var o=e.message||null;o||(typeof n=="string"?o=n:n&&typeof n.message=="string"?o=n.message:t===constants$1.ERROR_REQUEST_ABORTED&&(o="Request aborted")),this.message=o,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=n}var mapiError=MapiError$1;function parseSingleHeader(e){var t=e.indexOf(":"),n=e.substring(0,t).trim().toLowerCase(),o=e.substring(t+1).trim();return{name:n,value:o}}function parseHeaders$1(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(n){var o=parseSingleHeader(n);t[o.name]=o.value}),t}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants=constants$4,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(e){var t=requestsUnderway[e.id];!t||(t.abort(),delete requestsUnderway[e.id])}function createResponse(e,t){return new MapiResponse(e,{body:t.response,headers:parseHeaders(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent(e){var t=e.total,n=e.loaded,o=100*n/t;return{total:t,transferred:n,percent:o}}function sendRequestXhr(e,t){return new Promise(function(n,o){t.onprogress=function(g){e.emitter.emit(constants.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(g))};var u=e.file;u&&(t.upload.onprogress=function(g){e.emitter.emit(constants.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(g))}),t.onerror=function(g){o(g)},t.onabort=function(){var g=new MapiError({request:e,type:constants.ERROR_REQUEST_ABORTED});o(g)},t.onload=function(){if(delete requestsUnderway[e.id],t.status<200||t.status>=400){var g=new MapiError({request:e,body:t.response,statusCode:t.status});o(g);return}n(t)};var f=e.body;typeof f=="string"?t.send(f):f?t.send(JSON.stringify(f)):u?t.send(u):t.send(),requestsUnderway[e.id]=t}).then(function(n){return createResponse(e,n)})}function createRequestXhr(e,t){var n=e.url(t),o=new window.XMLHttpRequest;return o.open(e.method,n),Object.keys(e.headers).forEach(function(u){o.setRequestHeader(u,e.headers[u])}),o}function browserSend(e){return Promise.resolve().then(function(){var t=createRequestXhr(e,e.client.accessToken);return sendRequestXhr(e,t)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(e){MapiClient$1.call(this,e)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(e){return new BrowserClient(e)}var browserClient=createBrowserClient,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(e){return function(t){var n;MapiClient.prototype.isPrototypeOf(t)?n=t:n=createClient(t);var o=Object.create(e);return o.client=n,o}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(e){v.assertShape({query:v.required(v.string),mode:v.oneOf("mapbox.places","mapbox.places-permanent"),countries:v.arrayOf(v.string),proximity:v.oneOf(v.coordinates,"ip"),types:v.arrayOf(v.oneOf(featureTypes)),autocomplete:v.boolean,bbox:v.arrayOf(v.number),limit:v.number,language:v.arrayOf(v.string),routing:v.boolean,fuzzyMatch:v.boolean,worldview:v.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};Geocoding.reverseGeocode=function(e){v.assertShape({query:v.required(v.coordinates),mode:v.oneOf("mapbox.places","mapbox.places-permanent"),countries:v.arrayOf(v.string),types:v.arrayOf(v.oneOf(featureTypes)),bbox:v.arrayOf(v.number),limit:v.number,language:v.arrayOf(v.string),reverseMode:v.oneOf("distance","score"),routing:v.boolean,worldview:v.string})(e),e.mode=e.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:e.countries},pick(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(e,["mode","query"]),query:t})};var geocoding=createServiceFactory(Geocoding),mapboxGlDraw$1={exports:{}};(function(e,t){(function(n,o){e.exports=o()})(commonjsGlobal,function(){var n=function(z,ee){var xe={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},lt={on:function(Et,At,Tr){if(xe[Et]===void 0)throw new Error("Invalid event type: "+Et);xe[Et].push({selector:At,fn:Tr})},render:function(Et){ee.store.featureChanged(Et)}},kt=function(Et,At){for(var Tr=xe[Et],_r=Tr.length;_r--;){var Ur=Tr[_r];if(Ur.selector(At)){Ur.fn.call(lt,At)||ee.store.render(),ee.ui.updateMapClasses();break}}};return z.start.call(lt),{render:z.render,stop:function(){z.stop&&z.stop()},trash:function(){z.trash&&(z.trash(),ee.store.render())},combineFeatures:function(){z.combineFeatures&&z.combineFeatures()},uncombineFeatures:function(){z.uncombineFeatures&&z.uncombineFeatures()},drag:function(Et){kt("drag",Et)},click:function(Et){kt("click",Et)},mousemove:function(Et){kt("mousemove",Et)},mousedown:function(Et){kt("mousedown",Et)},mouseup:function(Et){kt("mouseup",Et)},mouseout:function(Et){kt("mouseout",Et)},keydown:function(Et){kt("keydown",Et)},keyup:function(Et){kt("keyup",Et)},touchstart:function(Et){kt("touchstart",Et)},touchmove:function(Et){kt("touchmove",Et)},touchend:function(Et){kt("touchend",Et)},tap:function(Et){kt("tap",Et)}}},o=6378137;function u(z){var ee=0;if(z&&z.length>0){ee+=Math.abs(f(z[0]));for(var xe=1;xe<z.length;xe++)ee-=Math.abs(f(z[xe]))}return ee}function f(z){var ee,xe,lt,kt,Et,At,Tr=0,_r=z.length;if(_r>2){for(At=0;At<_r;At++)At===_r-2?(lt=_r-2,kt=_r-1,Et=0):At===_r-1?(lt=_r-1,kt=0,Et=1):(lt=At,kt=At+1,Et=At+2),ee=z[lt],xe=z[kt],Tr+=(g(z[Et][0])-g(ee[0]))*Math.sin(g(xe[1]));Tr=Tr*o*o/2}return Tr}function g(z){return z*Math.PI/180}var a={geometry:function z(ee){var xe,lt=0;switch(ee.type){case"Polygon":return u(ee.coordinates);case"MultiPolygon":for(xe=0;xe<ee.coordinates.length;xe++)lt+=u(ee.coordinates[xe]);return lt;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(xe=0;xe<ee.geometries.length;xe++)lt+=z(ee.geometries[xe]);return lt}},ring:f},b="mapboxgl-ctrl",T="mapbox-gl-draw_ctrl-draw-btn",C="mapbox-gl-draw_line",L="mapbox-gl-draw_polygon",N="mapbox-gl-draw_point",F="mapbox-gl-draw_trash",H="mapbox-gl-draw_combine",se="mapbox-gl-draw_uncombine",ce="mapboxgl-ctrl-group",X="active",ye="mapbox-gl-draw_boxselect",oe="mapbox-gl-draw-hot",le="mapbox-gl-draw-cold",ue="add",Re="move",ze="drag",ve="pointer",be="none",de={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Te="Feature",Ge="Polygon",Ke="LineString",St="Point",xt="FeatureCollection",Lr="Multi",Nr="MultiPoint",Sr="MultiLineString",Gr="MultiPolygon",_t={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Kt="draw.create",mr="draw.delete",Yt="draw.update",er="draw.selectionchange",lr="draw.modechange",ar="draw.actionable",dr="draw.render",ii="draw.combine",nr="draw.uncombine",at="move",bi="change_coordinates",Br="feature",Xr="midpoint",cr="vertex",ur="true",yi="false",Or=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],mi={Point:0,LineString:1,Polygon:2};function qt(z,ee){var xe=mi[z.geometry.type]-mi[ee.geometry.type];return xe===0&&z.geometry.type===Ge?z.area-ee.area:xe}function Er(z){if(this._items={},this._nums={},this._length=z?z.length:0,z)for(var ee=0,xe=z.length;ee<xe;ee++)this.add(z[ee]),z[ee]!==void 0&&(typeof z[ee]=="string"?this._items[z[ee]]=ee:this._nums[z[ee]]=ee)}Er.prototype.add=function(z){return this.has(z)||(this._length++,typeof z=="string"?this._items[z]=this._length:this._nums[z]=this._length),this},Er.prototype.delete=function(z){return this.has(z)===!1||(this._length--,delete this._items[z],delete this._nums[z]),this},Er.prototype.has=function(z){return(typeof z=="string"||typeof z=="number")&&(this._items[z]!==void 0||this._nums[z]!==void 0)},Er.prototype.values=function(){var z=this,ee=[];return Object.keys(this._items).forEach(function(xe){ee.push({k:xe,v:z._items[xe]})}),Object.keys(this._nums).forEach(function(xe){ee.push({k:JSON.parse(xe),v:z._nums[xe]})}),ee.sort(function(xe,lt){return xe.v-lt.v}).map(function(xe){return xe.k})},Er.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Gt=[Br,Xr,cr],Jt={click:function(z,ee,xe){return st(z,ee,xe,xe.options.clickBuffer)},touch:function(z,ee,xe){return st(z,ee,xe,xe.options.touchBuffer)}};function st(z,ee,xe,lt){if(xe.map===null)return[];var kt=z?function(Ur,It){return It===void 0&&(It=0),[[Ur.point.x-It,Ur.point.y-It],[Ur.point.x+It,Ur.point.y+It]]}(z,lt):ee,Et={};xe.options.styles&&(Et.layers=xe.options.styles.map(function(Ur){return Ur.id}));var At=xe.map.queryRenderedFeatures(kt,Et).filter(function(Ur){return Gt.indexOf(Ur.properties.meta)!==-1}),Tr=new Er,_r=[];return At.forEach(function(Ur){var It=Ur.properties.id;Tr.has(It)||(Tr.add(It),_r.push(Ur))}),function(Ur){return Ur.map(function(It){return It.geometry.type===Ge&&(It.area=a.geometry({type:Te,property:{},geometry:It.geometry})),It}).sort(qt).map(function(It){return delete It.area,It})}(_r)}function Pr(z,ee){var xe=Jt.click(z,null,ee),lt={mouse:be};return xe[0]&&(lt.mouse=xe[0].properties.active===ur?Re:ve,lt.feature=xe[0].properties.meta),ee.events.currentModeName().indexOf("draw")!==-1&&(lt.mouse=ue),ee.ui.queueMapClasses(lt),ee.ui.updateMapClasses(),xe[0]}function ht(z,ee){var xe=z.x-ee.x,lt=z.y-ee.y;return Math.sqrt(xe*xe+lt*lt)}function Nt(z,ee,xe){xe===void 0&&(xe={});var lt=xe.fineTolerance!=null?xe.fineTolerance:4,kt=xe.grossTolerance!=null?xe.grossTolerance:12,Et=xe.interval!=null?xe.interval:500;z.point=z.point||ee.point,z.time=z.time||ee.time;var At=ht(z.point,ee.point);return At<lt||At<kt&&ee.time-z.time<Et}function xr(z,ee,xe){xe===void 0&&(xe={});var lt=xe.tolerance!=null?xe.tolerance:25,kt=xe.interval!=null?xe.interval:250;return z.point=z.point||ee.point,z.time=z.time||ee.time,ht(z.point,ee.point)<lt&&ee.time-z.time<kt}function Qr(z,ee){return z(ee={exports:{}},ee.exports),ee.exports}var zr=Qr(function(z){var ee=z.exports=function(xe,lt){if(lt||(lt=16),xe===void 0&&(xe=128),xe<=0)return"0";for(var kt=Math.log(Math.pow(2,xe))/Math.log(lt),Et=2;kt===1/0;Et*=2)kt=Math.log(Math.pow(2,xe/Et))/Math.log(lt)*Et;var At=kt-Math.floor(kt),Tr="";for(Et=0;Et<Math.floor(kt);Et++)Tr=Math.floor(Math.random()*lt).toString(lt)+Tr;if(At){var _r=Math.pow(lt,At);Tr=Math.floor(Math.random()*_r).toString(lt)+Tr}var Ur=parseInt(Tr,lt);return Ur!==1/0&&Ur>=Math.pow(2,xe)?ee(xe,lt):Tr};ee.rack=function(xe,lt,kt){var Et=function(Tr){var _r=0;do{if(_r++>10){if(!kt)throw new Error("too many ID collisions, use more bits");xe+=kt}var Ur=ee(xe,lt)}while(Object.hasOwnProperty.call(At,Ur));return At[Ur]=Tr,Ur},At=Et.hats={};return Et.get=function(Tr){return Et.hats[Tr]},Et.set=function(Tr,_r){return Et.hats[Tr]=_r,Et},Et.bits=xe||128,Et.base=lt||16,Et}}),br=function(z,ee){this.ctx=z,this.properties=ee.properties||{},this.coordinates=ee.geometry.coordinates,this.id=ee.id||zr(),this.type=ee.geometry.type};br.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},br.prototype.incomingCoords=function(z){this.setCoordinates(z)},br.prototype.setCoordinates=function(z){this.coordinates=z,this.changed()},br.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},br.prototype.setProperty=function(z,ee){this.properties[z]=ee},br.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Te,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},br.prototype.internal=function(z){var ee={id:this.id,meta:Br,"meta:type":this.type,active:yi,mode:z};if(this.ctx.options.userProperties)for(var xe in this.properties)ee["user_"+xe]=this.properties[xe];return{type:Te,properties:ee,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var xi=function(z,ee){br.call(this,z,ee)};(xi.prototype=Object.create(br.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},xi.prototype.updateCoordinate=function(z,ee,xe){this.coordinates=arguments.length===3?[ee,xe]:[z,ee],this.changed()},xi.prototype.getCoordinate=function(){return this.getCoordinates()};var ui=function(z,ee){br.call(this,z,ee)};(ui.prototype=Object.create(br.prototype)).isValid=function(){return this.coordinates.length>1},ui.prototype.addCoordinate=function(z,ee,xe){this.changed();var lt=parseInt(z,10);this.coordinates.splice(lt,0,[ee,xe])},ui.prototype.getCoordinate=function(z){var ee=parseInt(z,10);return JSON.parse(JSON.stringify(this.coordinates[ee]))},ui.prototype.removeCoordinate=function(z){this.changed(),this.coordinates.splice(parseInt(z,10),1)},ui.prototype.updateCoordinate=function(z,ee,xe){var lt=parseInt(z,10);this.coordinates[lt]=[ee,xe],this.changed()};var di=function(z,ee){br.call(this,z,ee),this.coordinates=this.coordinates.map(function(xe){return xe.slice(0,-1)})};(di.prototype=Object.create(br.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(z){return z.length>2})},di.prototype.incomingCoords=function(z){this.coordinates=z.map(function(ee){return ee.slice(0,-1)}),this.changed()},di.prototype.setCoordinates=function(z){this.coordinates=z,this.changed()},di.prototype.addCoordinate=function(z,ee,xe){this.changed();var lt=z.split(".").map(function(kt){return parseInt(kt,10)});this.coordinates[lt[0]].splice(lt[1],0,[ee,xe])},di.prototype.removeCoordinate=function(z){this.changed();var ee=z.split(".").map(function(lt){return parseInt(lt,10)}),xe=this.coordinates[ee[0]];xe&&(xe.splice(ee[1],1),xe.length<3&&this.coordinates.splice(ee[0],1))},di.prototype.getCoordinate=function(z){var ee=z.split(".").map(function(lt){return parseInt(lt,10)}),xe=this.coordinates[ee[0]];return JSON.parse(JSON.stringify(xe[ee[1]]))},di.prototype.getCoordinates=function(){return this.coordinates.map(function(z){return z.concat([z[0]])})},di.prototype.updateCoordinate=function(z,ee,xe){this.changed();var lt=z.split("."),kt=parseInt(lt[0],10),Et=parseInt(lt[1],10);this.coordinates[kt]===void 0&&(this.coordinates[kt]=[]),this.coordinates[kt][Et]=[ee,xe]};var Ti={MultiPoint:xi,MultiLineString:ui,MultiPolygon:di},Yi=function(z,ee,xe,lt,kt){var Et=xe.split("."),At=parseInt(Et[0],10),Tr=Et[1]?Et.slice(1).join("."):null;return z[At][ee](Tr,lt,kt)},Zi=function(z,ee){if(br.call(this,z,ee),delete this.coordinates,this.model=Ti[ee.geometry.type],this.model===void 0)throw new TypeError(ee.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(ee.geometry.coordinates)};function oi(z){this.map=z.map,this.drawConfig=JSON.parse(JSON.stringify(z.options||{})),this._ctx=z}(Zi.prototype=Object.create(br.prototype))._coordinatesToFeatures=function(z){var ee=this,xe=this.model.bind(this);return z.map(function(lt){return new xe(ee.ctx,{id:zr(),type:Te,properties:{},geometry:{coordinates:lt,type:ee.type.replace("Multi","")}})})},Zi.prototype.isValid=function(){return this.features.every(function(z){return z.isValid()})},Zi.prototype.setCoordinates=function(z){this.features=this._coordinatesToFeatures(z),this.changed()},Zi.prototype.getCoordinate=function(z){return Yi(this.features,"getCoordinate",z)},Zi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(z){return z.type===Ge?z.getCoordinates():z.coordinates})))},Zi.prototype.updateCoordinate=function(z,ee,xe){Yi(this.features,"updateCoordinate",z,ee,xe),this.changed()},Zi.prototype.addCoordinate=function(z,ee,xe){Yi(this.features,"addCoordinate",z,ee,xe),this.changed()},Zi.prototype.removeCoordinate=function(z){Yi(this.features,"removeCoordinate",z),this.changed()},Zi.prototype.getFeatures=function(){return this.features},oi.prototype.setSelected=function(z){return this._ctx.store.setSelected(z)},oi.prototype.setSelectedCoordinates=function(z){var ee=this;this._ctx.store.setSelectedCoordinates(z),z.reduce(function(xe,lt){return xe[lt.feature_id]===void 0&&(xe[lt.feature_id]=!0,ee._ctx.store.get(lt.feature_id).changed()),xe},{})},oi.prototype.getSelected=function(){return this._ctx.store.getSelected()},oi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},oi.prototype.isSelected=function(z){return this._ctx.store.isSelected(z)},oi.prototype.getFeature=function(z){return this._ctx.store.get(z)},oi.prototype.select=function(z){return this._ctx.store.select(z)},oi.prototype.deselect=function(z){return this._ctx.store.deselect(z)},oi.prototype.deleteFeature=function(z,ee){return ee===void 0&&(ee={}),this._ctx.store.delete(z,ee)},oi.prototype.addFeature=function(z){return this._ctx.store.add(z)},oi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},oi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},oi.prototype.setActionableState=function(z){z===void 0&&(z={});var ee={trash:z.trash||!1,combineFeatures:z.combineFeatures||!1,uncombineFeatures:z.uncombineFeatures||!1};return this._ctx.events.actionable(ee)},oi.prototype.changeMode=function(z,ee,xe){return ee===void 0&&(ee={}),xe===void 0&&(xe={}),this._ctx.events.changeMode(z,ee,xe)},oi.prototype.updateUIClasses=function(z){return this._ctx.ui.queueMapClasses(z)},oi.prototype.activateUIButton=function(z){return this._ctx.ui.setActiveButton(z)},oi.prototype.featuresAt=function(z,ee,xe){if(xe===void 0&&(xe="click"),xe!=="click"&&xe!=="touch")throw new Error("invalid buffer type");return Jt[xe](z,ee,this._ctx)},oi.prototype.newFeature=function(z){var ee=z.geometry.type;return ee===St?new xi(this._ctx,z):ee===Ke?new ui(this._ctx,z):ee===Ge?new di(this._ctx,z):new Zi(this._ctx,z)},oi.prototype.isInstanceOf=function(z,ee){if(z===St)return ee instanceof xi;if(z===Ke)return ee instanceof ui;if(z===Ge)return ee instanceof di;if(z==="MultiFeature")return ee instanceof Zi;throw new Error("Unknown feature class: "+z)},oi.prototype.doRender=function(z){return this._ctx.store.featureChanged(z)},oi.prototype.onSetup=function(){},oi.prototype.onDrag=function(){},oi.prototype.onClick=function(){},oi.prototype.onMouseMove=function(){},oi.prototype.onMouseDown=function(){},oi.prototype.onMouseUp=function(){},oi.prototype.onMouseOut=function(){},oi.prototype.onKeyUp=function(){},oi.prototype.onKeyDown=function(){},oi.prototype.onTouchStart=function(){},oi.prototype.onTouchMove=function(){},oi.prototype.onTouchEnd=function(){},oi.prototype.onTap=function(){},oi.prototype.onStop=function(){},oi.prototype.onTrash=function(){},oi.prototype.onCombineFeature=function(){},oi.prototype.onUncombineFeature=function(){},oi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var En={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},fo=Object.keys(En);function po(z){var ee=Object.keys(z);return function(xe,lt){lt===void 0&&(lt={});var kt={},Et=ee.reduce(function(At,Tr){return At[Tr]=z[Tr],At},new oi(xe));return{start:function(){var At=this;kt=Et.onSetup(lt),fo.forEach(function(Tr){var _r,Ur=En[Tr],It=function(){return!1};z[Ur]&&(It=function(){return!0}),At.on(Tr,It,(_r=Ur,function(Ir){return Et[_r](kt,Ir)}))})},stop:function(){Et.onStop(kt)},trash:function(){Et.onTrash(kt)},combineFeatures:function(){Et.onCombineFeatures(kt)},uncombineFeatures:function(){Et.onUncombineFeatures(kt)},render:function(At,Tr){Et.toDisplayFeatures(kt,At,Tr)}}}}function bn(z){return[].concat(z).filter(function(ee){return ee!==void 0})}function oo(){var z=this;if(!(z.ctx.map&&z.ctx.map.getSource(oe)!==void 0))return _r();var ee=z.ctx.events.currentModeName();z.ctx.ui.queueMapClasses({mode:ee});var xe=[],lt=[];z.isDirty?lt=z.getAllIds():(xe=z.getChangedIds().filter(function(Ur){return z.get(Ur)!==void 0}),lt=z.sources.hot.filter(function(Ur){return Ur.properties.id&&xe.indexOf(Ur.properties.id)===-1&&z.get(Ur.properties.id)!==void 0}).map(function(Ur){return Ur.properties.id})),z.sources.hot=[];var kt=z.sources.cold.length;z.sources.cold=z.isDirty?[]:z.sources.cold.filter(function(Ur){var It=Ur.properties.id||Ur.properties.parent;return xe.indexOf(It)===-1});var Et=kt!==z.sources.cold.length||lt.length>0;function At(Ur,It){var Ir=z.get(Ur).internal(ee);z.ctx.events.currentModeRender(Ir,function(Yr){z.sources[It].push(Yr)})}if(xe.forEach(function(Ur){return At(Ur,"hot")}),lt.forEach(function(Ur){return At(Ur,"cold")}),Et&&z.ctx.map.getSource(le).setData({type:xt,features:z.sources.cold}),z.ctx.map.getSource(oe).setData({type:xt,features:z.sources.hot}),z._emitSelectionChange&&(z.ctx.map.fire(er,{features:z.getSelected().map(function(Ur){return Ur.toGeoJSON()}),points:z.getSelectedCoordinates().map(function(Ur){return{type:Te,properties:{},geometry:{type:St,coordinates:Ur.coordinates}}})}),z._emitSelectionChange=!1),z._deletedFeaturesToEmit.length){var Tr=z._deletedFeaturesToEmit.map(function(Ur){return Ur.toGeoJSON()});z._deletedFeaturesToEmit=[],z.ctx.map.fire(mr,{features:Tr})}function _r(){z.isDirty=!1,z.clearChangedIds()}_r(),z.ctx.map.fire(dr,{})}function Vi(z){var ee,xe=this;this._features={},this._featureIds=new Er,this._selectedFeatureIds=new Er,this._selectedCoordinates=[],this._changedFeatureIds=new Er,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=z,this.sources={hot:[],cold:[]},this.render=function(){ee||(ee=requestAnimationFrame(function(){ee=null,oo.call(xe)}))},this.isDirty=!1}function Xn(z,ee){var xe=z._selectedCoordinates.filter(function(lt){return z._selectedFeatureIds.has(lt.feature_id)});z._selectedCoordinates.length===xe.length||ee.silent||(z._emitSelectionChange=!0),z._selectedCoordinates=xe}Vi.prototype.createRenderBatch=function(){var z=this,ee=this.render,xe=0;return this.render=function(){xe++},function(){z.render=ee,xe>0&&z.render()}},Vi.prototype.setDirty=function(){return this.isDirty=!0,this},Vi.prototype.featureChanged=function(z){return this._changedFeatureIds.add(z),this},Vi.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Vi.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Vi.prototype.getAllIds=function(){return this._featureIds.values()},Vi.prototype.add=function(z){return this.featureChanged(z.id),this._features[z.id]=z,this._featureIds.add(z.id),this},Vi.prototype.delete=function(z,ee){var xe=this;return ee===void 0&&(ee={}),bn(z).forEach(function(lt){xe._featureIds.has(lt)&&(xe._featureIds.delete(lt),xe._selectedFeatureIds.delete(lt),ee.silent||xe._deletedFeaturesToEmit.indexOf(xe._features[lt])===-1&&xe._deletedFeaturesToEmit.push(xe._features[lt]),delete xe._features[lt],xe.isDirty=!0)}),Xn(this,ee),this},Vi.prototype.get=function(z){return this._features[z]},Vi.prototype.getAll=function(){var z=this;return Object.keys(this._features).map(function(ee){return z._features[ee]})},Vi.prototype.select=function(z,ee){var xe=this;return ee===void 0&&(ee={}),bn(z).forEach(function(lt){xe._selectedFeatureIds.has(lt)||(xe._selectedFeatureIds.add(lt),xe._changedFeatureIds.add(lt),ee.silent||(xe._emitSelectionChange=!0))}),this},Vi.prototype.deselect=function(z,ee){var xe=this;return ee===void 0&&(ee={}),bn(z).forEach(function(lt){xe._selectedFeatureIds.has(lt)&&(xe._selectedFeatureIds.delete(lt),xe._changedFeatureIds.add(lt),ee.silent||(xe._emitSelectionChange=!0))}),Xn(this,ee),this},Vi.prototype.clearSelected=function(z){return z===void 0&&(z={}),this.deselect(this._selectedFeatureIds.values(),{silent:z.silent}),this},Vi.prototype.setSelected=function(z,ee){var xe=this;return ee===void 0&&(ee={}),z=bn(z),this.deselect(this._selectedFeatureIds.values().filter(function(lt){return z.indexOf(lt)===-1}),{silent:ee.silent}),this.select(z.filter(function(lt){return!xe._selectedFeatureIds.has(lt)}),{silent:ee.silent}),this},Vi.prototype.setSelectedCoordinates=function(z){return this._selectedCoordinates=z,this._emitSelectionChange=!0,this},Vi.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Vi.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Vi.prototype.getSelected=function(){var z=this;return this._selectedFeatureIds.values().map(function(ee){return z.get(ee)})},Vi.prototype.getSelectedCoordinates=function(){var z=this;return this._selectedCoordinates.map(function(ee){return{coordinates:z.get(ee.feature_id).getCoordinate(ee.coord_path)}})},Vi.prototype.isSelected=function(z){return this._selectedFeatureIds.has(z)},Vi.prototype.setFeatureProperty=function(z,ee,xe){this.get(z).setProperty(ee,xe),this.featureChanged(z)},Vi.prototype.storeMapConfig=function(){var z=this;Or.forEach(function(ee){z.ctx.map[ee]&&(z._mapInitialConfig[ee]=z.ctx.map[ee].isEnabled())})},Vi.prototype.restoreMapConfig=function(){var z=this;Object.keys(this._mapInitialConfig).forEach(function(ee){z._mapInitialConfig[ee]?z.ctx.map[ee].enable():z.ctx.map[ee].disable()})},Vi.prototype.getInitialConfigValue=function(z){return this._mapInitialConfig[z]===void 0||this._mapInitialConfig[z]};var Pn=function(){for(var z=arguments,ee={},xe=0;xe<arguments.length;xe++){var lt=z[xe];for(var kt in lt)hn.call(lt,kt)&&(ee[kt]=lt[kt])}return ee},hn=Object.prototype.hasOwnProperty,Ie=["mode","feature","mouse"];function ut(z){var ee=null,xe=null,lt={onRemove:function(){return z.map.off("load",lt.connect),clearInterval(xe),lt.removeLayers(),z.store.restoreMapConfig(),z.ui.removeButtons(),z.events.removeEventListeners(),z.ui.clearMapClasses(),z.map=null,z.container=null,z.store=null,ee&&ee.parentNode&&ee.parentNode.removeChild(ee),ee=null,this},connect:function(){z.map.off("load",lt.connect),clearInterval(xe),lt.addLayers(),z.store.storeMapConfig(),z.events.addEventListeners()},onAdd:function(kt){var Et=kt.fire;return kt.fire=function(At,Tr){var _r=arguments;return Et.length===1&&arguments.length!==1&&(_r=[Pn({},{type:At},Tr)]),Et.apply(kt,_r)},z.map=kt,z.events=function(At){var Tr=Object.keys(At.options.modes).reduce(function(pr,ei){return pr[ei]=po(At.options.modes[ei]),pr},{}),_r={},Ur={},It={},Ir=null,Yr=null;It.drag=function(pr,ei){ei({point:pr.point,time:new Date().getTime()})?(At.ui.queueMapClasses({mouse:ze}),Yr.drag(pr)):pr.originalEvent.stopPropagation()},It.mousedrag=function(pr){It.drag(pr,function(ei){return!Nt(_r,ei)})},It.touchdrag=function(pr){It.drag(pr,function(ei){return!xr(Ur,ei)})},It.mousemove=function(pr){if((pr.originalEvent.buttons!==void 0?pr.originalEvent.buttons:pr.originalEvent.which)===1)return It.mousedrag(pr);var ei=Pr(pr,At);pr.featureTarget=ei,Yr.mousemove(pr)},It.mousedown=function(pr){_r={time:new Date().getTime(),point:pr.point};var ei=Pr(pr,At);pr.featureTarget=ei,Yr.mousedown(pr)},It.mouseup=function(pr){var ei=Pr(pr,At);pr.featureTarget=ei,Nt(_r,{point:pr.point,time:new Date().getTime()})?Yr.click(pr):Yr.mouseup(pr)},It.mouseout=function(pr){Yr.mouseout(pr)},It.touchstart=function(pr){if(pr.originalEvent.preventDefault(),At.options.touchEnabled){Ur={time:new Date().getTime(),point:pr.point};var ei=Jt.touch(pr,null,At)[0];pr.featureTarget=ei,Yr.touchstart(pr)}},It.touchmove=function(pr){if(pr.originalEvent.preventDefault(),At.options.touchEnabled)return Yr.touchmove(pr),It.touchdrag(pr)},It.touchend=function(pr){if(pr.originalEvent.preventDefault(),At.options.touchEnabled){var ei=Jt.touch(pr,null,At)[0];pr.featureTarget=ei,xr(Ur,{time:new Date().getTime(),point:pr.point})?Yr.tap(pr):Yr.touchend(pr)}};var hi=function(pr){return!(pr===8||pr===46||pr>=48&&pr<=57)};function pi(pr,ei,Oi){Oi===void 0&&(Oi={}),Yr.stop();var Ci=Tr[pr];if(Ci===void 0)throw new Error(pr+" is not valid");Ir=pr;var vn=Ci(At,ei);Yr=n(vn,At),Oi.silent||At.map.fire(lr,{mode:pr}),At.store.setDirty(),At.store.render()}It.keydown=function(pr){(pr.srcElement||pr.target).classList[0]==="mapboxgl-canvas"&&(pr.keyCode!==8&&pr.keyCode!==46||!At.options.controls.trash?hi(pr.keyCode)?Yr.keydown(pr):pr.keyCode===49&&At.options.controls.point?pi(_t.DRAW_POINT):pr.keyCode===50&&At.options.controls.line_string?pi(_t.DRAW_LINE_STRING):pr.keyCode===51&&At.options.controls.polygon&&pi(_t.DRAW_POLYGON):(pr.preventDefault(),Yr.trash()))},It.keyup=function(pr){hi(pr.keyCode)&&Yr.keyup(pr)},It.zoomend=function(){At.store.changeZoom()},It.data=function(pr){if(pr.dataType==="style"){var ei=At.setup,Oi=At.map,Ci=At.options,vn=At.store;Ci.styles.some(function(_i){return Oi.getLayer(_i.id)})||(ei.addLayers(),vn.setDirty(),vn.render())}};var pn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Ir=At.options.defaultMode,Yr=n(Tr[Ir](At),At)},changeMode:pi,actionable:function(pr){var ei=!1;Object.keys(pr).forEach(function(Oi){if(pn[Oi]===void 0)throw new Error("Invalid action type");pn[Oi]!==pr[Oi]&&(ei=!0),pn[Oi]=pr[Oi]}),ei&&At.map.fire(ar,{actions:pn})},currentModeName:function(){return Ir},currentModeRender:function(pr,ei){return Yr.render(pr,ei)},fire:function(pr,ei){It[pr]&&It[pr](ei)},addEventListeners:function(){At.map.on("mousemove",It.mousemove),At.map.on("mousedown",It.mousedown),At.map.on("mouseup",It.mouseup),At.map.on("data",It.data),At.map.on("touchmove",It.touchmove),At.map.on("touchstart",It.touchstart),At.map.on("touchend",It.touchend),At.container.addEventListener("mouseout",It.mouseout),At.options.keybindings&&(At.container.addEventListener("keydown",It.keydown),At.container.addEventListener("keyup",It.keyup))},removeEventListeners:function(){At.map.off("mousemove",It.mousemove),At.map.off("mousedown",It.mousedown),At.map.off("mouseup",It.mouseup),At.map.off("data",It.data),At.map.off("touchmove",It.touchmove),At.map.off("touchstart",It.touchstart),At.map.off("touchend",It.touchend),At.container.removeEventListener("mouseout",It.mouseout),At.options.keybindings&&(At.container.removeEventListener("keydown",It.keydown),At.container.removeEventListener("keyup",It.keyup))},trash:function(pr){Yr.trash(pr)},combineFeatures:function(){Yr.combineFeatures()},uncombineFeatures:function(){Yr.uncombineFeatures()},getMode:function(){return Ir}}}(z),z.ui=function(At){var Tr={},_r=null,Ur={mode:null,feature:null,mouse:null},It={mode:null,feature:null,mouse:null};function Ir(pr){It=Pn(It,pr)}function Yr(){var pr,ei;if(At.container){var Oi=[],Ci=[];Ie.forEach(function(vn){It[vn]!==Ur[vn]&&(Oi.push(vn+"-"+Ur[vn]),It[vn]!==null&&Ci.push(vn+"-"+It[vn]))}),Oi.length>0&&(pr=At.container.classList).remove.apply(pr,Oi),Ci.length>0&&(ei=At.container.classList).add.apply(ei,Ci),Ur=Pn(Ur,It)}}function hi(pr,ei){ei===void 0&&(ei={});var Oi=document.createElement("button");return Oi.className=T+" "+ei.className,Oi.setAttribute("title",ei.title),ei.container.appendChild(Oi),Oi.addEventListener("click",function(Ci){if(Ci.preventDefault(),Ci.stopPropagation(),Ci.target===_r)return pi(),void ei.onDeactivate();pn(pr),ei.onActivate()},!0),Oi}function pi(){_r&&(_r.classList.remove(X),_r=null)}function pn(pr){pi();var ei=Tr[pr];ei&&ei&&pr!=="trash"&&(ei.classList.add(X),_r=ei)}return{setActiveButton:pn,queueMapClasses:Ir,updateMapClasses:Yr,clearMapClasses:function(){Ir({mode:null,feature:null,mouse:null}),Yr()},addButtons:function(){var pr=At.options.controls,ei=document.createElement("div");return ei.className=ce+" "+b,pr&&(pr[de.LINE]&&(Tr[de.LINE]=hi(de.LINE,{container:ei,className:C,title:"LineString tool "+(At.options.keybindings?"(l)":""),onActivate:function(){return At.events.changeMode(_t.DRAW_LINE_STRING)},onDeactivate:function(){return At.events.trash()}})),pr[de.POLYGON]&&(Tr[de.POLYGON]=hi(de.POLYGON,{container:ei,className:L,title:"Polygon tool "+(At.options.keybindings?"(p)":""),onActivate:function(){return At.events.changeMode(_t.DRAW_POLYGON)},onDeactivate:function(){return At.events.trash()}})),pr[de.POINT]&&(Tr[de.POINT]=hi(de.POINT,{container:ei,className:N,title:"Marker tool "+(At.options.keybindings?"(m)":""),onActivate:function(){return At.events.changeMode(_t.DRAW_POINT)},onDeactivate:function(){return At.events.trash()}})),pr.trash&&(Tr.trash=hi("trash",{container:ei,className:F,title:"Delete",onActivate:function(){At.events.trash()}})),pr.combine_features&&(Tr.combine_features=hi("combineFeatures",{container:ei,className:H,title:"Combine",onActivate:function(){At.events.combineFeatures()}})),pr.uncombine_features&&(Tr.uncombine_features=hi("uncombineFeatures",{container:ei,className:se,title:"Uncombine",onActivate:function(){At.events.uncombineFeatures()}}))),ei},removeButtons:function(){Object.keys(Tr).forEach(function(pr){var ei=Tr[pr];ei.parentNode&&ei.parentNode.removeChild(ei),delete Tr[pr]})}}}(z),z.container=kt.getContainer(),z.store=new Vi(z),ee=z.ui.addButtons(),z.options.boxSelect&&(kt.boxZoom.disable(),kt.dragPan.disable(),kt.dragPan.enable()),kt.loaded()?lt.connect():(kt.on("load",lt.connect),xe=setInterval(function(){kt.loaded()&&lt.connect()},16)),z.events.start(),ee},addLayers:function(){z.map.addSource(le,{data:{type:xt,features:[]},type:"geojson"}),z.map.addSource(oe,{data:{type:xt,features:[]},type:"geojson"}),z.options.styles.forEach(function(kt){z.map.addLayer(kt)}),z.store.setDirty(!0),z.store.render()},removeLayers:function(){z.options.styles.forEach(function(kt){z.map.getLayer(kt.id)&&z.map.removeLayer(kt.id)}),z.map.getSource(le)&&z.map.removeSource(le),z.map.getSource(oe)&&z.map.removeSource(oe)}};return z.setup=lt,lt}function Bt(z){return function(ee){var xe=ee.featureTarget;return!!xe&&!!xe.properties&&xe.properties.meta===z}}function _e(z){return!!z.featureTarget&&!!z.featureTarget.properties&&z.featureTarget.properties.active===ur&&z.featureTarget.properties.meta===Br}function ae(z){return!!z.featureTarget&&!!z.featureTarget.properties&&z.featureTarget.properties.active===yi&&z.featureTarget.properties.meta===Br}function fe(z){return z.featureTarget===void 0}function ke(z){var ee=z.featureTarget;return!!ee&&!!ee.properties&&ee.properties.meta===cr}function Fe(z){return!!z.originalEvent&&z.originalEvent.shiftKey===!0}function Ye(z){return z.keyCode===27}function mt(z){return z.keyCode===13}var yt=Je;function Je(z,ee){this.x=z,this.y=ee}function vt(z,ee){var xe=ee.getBoundingClientRect();return new yt(z.clientX-xe.left-(ee.clientLeft||0),z.clientY-xe.top-(ee.clientTop||0))}function $t(z,ee,xe,lt){return{type:Te,properties:{meta:cr,parent:z,coord_path:xe,active:lt?ur:yi},geometry:{type:St,coordinates:ee}}}function Ar(z,ee,xe){ee===void 0&&(ee={}),xe===void 0&&(xe=null);var lt,kt=z.geometry,Et=kt.type,At=kt.coordinates,Tr=z.properties&&z.properties.id,_r=[];function Ur(Ir,Yr){var hi="",pi=null;Ir.forEach(function(pn,pr){var ei=Yr!=null?Yr+"."+pr:String(pr),Oi=$t(Tr,pn,ei,It(ei));if(ee.midpoints&&pi){var Ci=function(_i,yr,dn){var an=yr.geometry.coordinates,Zn=dn.geometry.coordinates;if(an[1]>85||an[1]<-85||Zn[1]>85||Zn[1]<-85)return null;var Nn={lng:(an[0]+Zn[0])/2,lat:(an[1]+Zn[1])/2};return{type:Te,properties:{meta:Xr,parent:_i,lng:Nn.lng,lat:Nn.lat,coord_path:dn.properties.coord_path},geometry:{type:St,coordinates:[Nn.lng,Nn.lat]}}}(Tr,pi,Oi);Ci&&_r.push(Ci)}pi=Oi;var vn=JSON.stringify(pn);hi!==vn&&_r.push(Oi),pr===0&&(hi=vn)})}function It(Ir){return!!ee.selectedPaths&&ee.selectedPaths.indexOf(Ir)!==-1}return Et===St?_r.push($t(Tr,At,xe,It(xe))):Et===Ge?At.forEach(function(Ir,Yr){Ur(Ir,xe!==null?xe+"."+Yr:String(Yr))}):Et===Ke?Ur(At,xe):Et.indexOf(Lr)===0&&(lt=Et.replace(Lr,""),At.forEach(function(Ir,Yr){var hi={type:Te,properties:z.properties,geometry:{type:lt,coordinates:Ir}};_r=_r.concat(Ar(hi,ee,Yr))})),_r}Je.prototype={clone:function(){return new Je(this.x,this.y)},add:function(z){return this.clone()._add(z)},sub:function(z){return this.clone()._sub(z)},multByPoint:function(z){return this.clone()._multByPoint(z)},divByPoint:function(z){return this.clone()._divByPoint(z)},mult:function(z){return this.clone()._mult(z)},div:function(z){return this.clone()._div(z)},rotate:function(z){return this.clone()._rotate(z)},rotateAround:function(z,ee){return this.clone()._rotateAround(z,ee)},matMult:function(z){return this.clone()._matMult(z)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(z){return this.x===z.x&&this.y===z.y},dist:function(z){return Math.sqrt(this.distSqr(z))},distSqr:function(z){var ee=z.x-this.x,xe=z.y-this.y;return ee*ee+xe*xe},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(z){return Math.atan2(this.y-z.y,this.x-z.x)},angleWith:function(z){return this.angleWithSep(z.x,z.y)},angleWithSep:function(z,ee){return Math.atan2(this.x*ee-this.y*z,this.x*z+this.y*ee)},_matMult:function(z){var ee=z[0]*this.x+z[1]*this.y,xe=z[2]*this.x+z[3]*this.y;return this.x=ee,this.y=xe,this},_add:function(z){return this.x+=z.x,this.y+=z.y,this},_sub:function(z){return this.x-=z.x,this.y-=z.y,this},_mult:function(z){return this.x*=z,this.y*=z,this},_div:function(z){return this.x/=z,this.y/=z,this},_multByPoint:function(z){return this.x*=z.x,this.y*=z.y,this},_divByPoint:function(z){return this.x/=z.x,this.y/=z.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var z=this.y;return this.y=this.x,this.x=-z,this},_rotate:function(z){var ee=Math.cos(z),xe=Math.sin(z),lt=ee*this.x-xe*this.y,kt=xe*this.x+ee*this.y;return this.x=lt,this.y=kt,this},_rotateAround:function(z,ee){var xe=Math.cos(z),lt=Math.sin(z),kt=ee.x+xe*(this.x-ee.x)-lt*(this.y-ee.y),Et=ee.y+lt*(this.x-ee.x)+xe*(this.y-ee.y);return this.x=kt,this.y=Et,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Je.convert=function(z){return z instanceof Je?z:Array.isArray(z)?new Je(z[0],z[1]):z};var Qt=function(z){setTimeout(function(){z.map&&z.map.doubleClickZoom&&z._ctx&&z._ctx.store&&z._ctx.store.getInitialConfigValue&&z._ctx.store.getInitialConfigValue("doubleClickZoom")&&z.map.doubleClickZoom.enable()},0)},Kr=function(z){setTimeout(function(){z.map&&z.map.doubleClickZoom&&z.map.doubleClickZoom.disable()},0)},ri=function(z){if(!z||!z.type)return null;var ee=Wr[z.type];if(!ee)return null;if(ee==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:z}]};if(ee==="feature")return{type:"FeatureCollection",features:[z]};if(ee==="featurecollection")return z},Wr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function ni(z){switch(z&&z.type||null){case"FeatureCollection":return z.features=z.features.reduce(function(ee,xe){return ee.concat(ni(xe))},[]),z;case"Feature":return z.geometry?ni(z.geometry).map(function(ee){var xe={type:"Feature",properties:JSON.parse(JSON.stringify(z.properties)),geometry:ee};return z.id!==void 0&&(xe.id=z.id),xe}):[z];case"MultiPoint":return z.coordinates.map(function(ee){return{type:"Point",coordinates:ee}});case"MultiPolygon":return z.coordinates.map(function(ee){return{type:"Polygon",coordinates:ee}});case"MultiLineString":return z.coordinates.map(function(ee){return{type:"LineString",coordinates:ee}});case"GeometryCollection":return z.geometries.map(ni).reduce(function(ee,xe){return ee.concat(xe)},[]);case"Point":case"Polygon":case"LineString":return[z]}}var Bi=function(z){if(!z)return[];var ee=ni(ri(z)),xe=[];return ee.features.forEach(function(lt){lt.geometry&&(xe=xe.concat(function kt(Et){return Array.isArray(Et)&&Et.length&&typeof Et[0]=="number"?[Et]:Et.reduce(function(At,Tr){return Array.isArray(Tr)&&Array.isArray(Tr[0])?At.concat(kt(Tr)):(At.push(Tr),At)},[])}(lt.geometry.coordinates)))}),xe},et=Qr(function(z){var ee=z.exports=function(It){return new xe(It)};function xe(It){this.value=It}function lt(It,Ir,Yr){var hi=[],pi=[],pn=!0;return function pr(ei){var Oi=Yr?kt(ei):ei,Ci={},vn=!0,_i={node:Oi,node_:ei,path:[].concat(hi),parent:pi[pi.length-1],parents:pi,key:hi.slice(-1)[0],isRoot:hi.length===0,level:hi.length,circular:null,update:function(an,Zn){_i.isRoot||(_i.parent.node[_i.key]=an),_i.node=an,Zn&&(vn=!1)},delete:function(an){delete _i.parent.node[_i.key],an&&(vn=!1)},remove:function(an){Tr(_i.parent.node)?_i.parent.node.splice(_i.key,1):delete _i.parent.node[_i.key],an&&(vn=!1)},keys:null,before:function(an){Ci.before=an},after:function(an){Ci.after=an},pre:function(an){Ci.pre=an},post:function(an){Ci.post=an},stop:function(){pn=!1},block:function(){vn=!1}};if(!pn)return _i;function yr(){if(typeof _i.node=="object"&&_i.node!==null){_i.keys&&_i.node_===_i.node||(_i.keys=Et(_i.node)),_i.isLeaf=_i.keys.length==0;for(var an=0;an<pi.length;an++)if(pi[an].node_===ei){_i.circular=pi[an];break}}else _i.isLeaf=!0,_i.keys=null;_i.notLeaf=!_i.isLeaf,_i.notRoot=!_i.isRoot}yr();var dn=Ir.call(_i,_i.node);return dn!==void 0&&_i.update&&_i.update(dn),Ci.before&&Ci.before.call(_i,_i.node),vn&&(typeof _i.node!="object"||_i.node===null||_i.circular||(pi.push(_i),yr(),_r(_i.keys,function(an,Zn){hi.push(an),Ci.pre&&Ci.pre.call(_i,_i.node[an],an);var Nn=pr(_i.node[an]);Yr&&Ur.call(_i.node,an)&&(_i.node[an]=Nn.node),Nn.isLast=Zn==_i.keys.length-1,Nn.isFirst=Zn==0,Ci.post&&Ci.post.call(_i,Nn),hi.pop()}),pi.pop()),Ci.after&&Ci.after.call(_i,_i.node)),_i}(It).node}function kt(It){if(typeof It=="object"&&It!==null){var Ir;if(Tr(It))Ir=[];else if(At(It)==="[object Date]")Ir=new Date(It.getTime?It.getTime():It);else if(function(pi){return At(pi)==="[object RegExp]"}(It))Ir=new RegExp(It);else if(function(pi){return At(pi)==="[object Error]"}(It))Ir={message:It.message};else if(function(pi){return At(pi)==="[object Boolean]"}(It))Ir=new Boolean(It);else if(function(pi){return At(pi)==="[object Number]"}(It))Ir=new Number(It);else if(function(pi){return At(pi)==="[object String]"}(It))Ir=new String(It);else if(Object.create&&Object.getPrototypeOf)Ir=Object.create(Object.getPrototypeOf(It));else if(It.constructor===Object)Ir={};else{var Yr=It.constructor&&It.constructor.prototype||It.__proto__||{},hi=function(){};hi.prototype=Yr,Ir=new hi}return _r(Et(It),function(pi){Ir[pi]=It[pi]}),Ir}return It}xe.prototype.get=function(It){for(var Ir=this.value,Yr=0;Yr<It.length;Yr++){var hi=It[Yr];if(!Ir||!Ur.call(Ir,hi)){Ir=void 0;break}Ir=Ir[hi]}return Ir},xe.prototype.has=function(It){for(var Ir=this.value,Yr=0;Yr<It.length;Yr++){var hi=It[Yr];if(!Ir||!Ur.call(Ir,hi))return!1;Ir=Ir[hi]}return!0},xe.prototype.set=function(It,Ir){for(var Yr=this.value,hi=0;hi<It.length-1;hi++){var pi=It[hi];Ur.call(Yr,pi)||(Yr[pi]={}),Yr=Yr[pi]}return Yr[It[hi]]=Ir,Ir},xe.prototype.map=function(It){return lt(this.value,It,!0)},xe.prototype.forEach=function(It){return this.value=lt(this.value,It,!1),this.value},xe.prototype.reduce=function(It,Ir){var Yr=arguments.length===1,hi=Yr?this.value:Ir;return this.forEach(function(pi){this.isRoot&&Yr||(hi=It.call(this,hi,pi))}),hi},xe.prototype.paths=function(){var It=[];return this.forEach(function(Ir){It.push(this.path)}),It},xe.prototype.nodes=function(){var It=[];return this.forEach(function(Ir){It.push(this.node)}),It},xe.prototype.clone=function(){var It=[],Ir=[];return function Yr(hi){for(var pi=0;pi<It.length;pi++)if(It[pi]===hi)return Ir[pi];if(typeof hi=="object"&&hi!==null){var pn=kt(hi);return It.push(hi),Ir.push(pn),_r(Et(hi),function(pr){pn[pr]=Yr(hi[pr])}),It.pop(),Ir.pop(),pn}return hi}(this.value)};var Et=Object.keys||function(It){var Ir=[];for(var Yr in It)Ir.push(Yr);return Ir};function At(It){return Object.prototype.toString.call(It)}var Tr=Array.isArray||function(It){return Object.prototype.toString.call(It)==="[object Array]"},_r=function(It,Ir){if(It.forEach)return It.forEach(Ir);for(var Yr=0;Yr<It.length;Yr++)Ir(It[Yr],Yr,It)};_r(Et(xe.prototype),function(It){ee[It]=function(Ir){var Yr=[].slice.call(arguments,1),hi=new xe(Ir);return hi[It].apply(hi,Yr)}});var Ur=Object.hasOwnProperty||function(It,Ir){return Ir in It}}),tr=gr;function gr(z){if(!(this instanceof gr))return new gr(z);this._bbox=z||[1/0,1/0,-1/0,-1/0],this._valid=!!z}gr.prototype.include=function(z){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],z[0]),this._bbox[1]=Math.min(this._bbox[1],z[1]),this._bbox[2]=Math.max(this._bbox[2],z[0]),this._bbox[3]=Math.max(this._bbox[3],z[1]),this},gr.prototype.equals=function(z){var ee;return ee=z instanceof gr?z.bbox():z,this._bbox[0]==ee[0]&&this._bbox[1]==ee[1]&&this._bbox[2]==ee[2]&&this._bbox[3]==ee[3]},gr.prototype.center=function(z){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},gr.prototype.union=function(z){var ee;return this._valid=!0,ee=z instanceof gr?z.bbox():z,this._bbox[0]=Math.min(this._bbox[0],ee[0]),this._bbox[1]=Math.min(this._bbox[1],ee[1]),this._bbox[2]=Math.max(this._bbox[2],ee[2]),this._bbox[3]=Math.max(this._bbox[3],ee[3]),this},gr.prototype.bbox=function(){return this._valid?this._bbox:null},gr.prototype.contains=function(z){if(!z)return this._fastContains();if(!this._valid)return null;var ee=z[0],xe=z[1];return this._bbox[0]<=ee&&this._bbox[1]<=xe&&this._bbox[2]>=ee&&this._bbox[3]>=xe},gr.prototype.intersect=function(z){return this._valid?(ee=z instanceof gr?z.bbox():z,!(this._bbox[0]>ee[2]||this._bbox[2]<ee[0]||this._bbox[3]<ee[1]||this._bbox[1]>ee[3])):null;var ee},gr.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var z="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",z)},gr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Jr={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ji=Object.keys(Jr),Gi=function(z){return Xi(z).bbox()};function Xi(z){for(var ee=tr(),xe=Bi(z),lt=0;lt<xe.length;lt++)ee.include(xe[lt]);return ee}Gi.polygon=function(z){return Xi(z).polygon()},Gi.bboxify=function(z){return et(z).map(function(ee){ee&&Ji.some(function(xe){return!!ee[xe]&&Jr[xe].indexOf(ee.type)!==-1})&&(ee.bbox=Xi(ee).bbox(),this.update(ee))})};function Ft(z,ee){var xe=-90,lt=90,kt=-90,Et=90,At=270,Tr=-270;z.forEach(function(Ur){var It=Gi(Ur),Ir=It[1],Yr=It[3],hi=It[0],pi=It[2];Ir>xe&&(xe=Ir),Yr<lt&&(lt=Yr),Yr>kt&&(kt=Yr),Ir<Et&&(Et=Ir),hi<At&&(At=hi),pi>Tr&&(Tr=pi)});var _r=ee;return xe+_r.lat>85&&(_r.lat=85-xe),kt+_r.lat>90&&(_r.lat=90-kt),lt+_r.lat<-85&&(_r.lat=-85-lt),Et+_r.lat<-90&&(_r.lat=-90-Et),At+_r.lng<=-270&&(_r.lng+=360*Math.ceil(Math.abs(_r.lng)/360)),Tr+_r.lng>=270&&(_r.lng-=360*Math.ceil(Math.abs(_r.lng)/360)),_r}function ao(z,ee){var xe=Ft(z.map(function(lt){return lt.toGeoJSON()}),ee);z.forEach(function(lt){var kt,Et=lt.getCoordinates(),At=function(_r){var Ur={lng:_r[0]+xe.lng,lat:_r[1]+xe.lat};return[Ur.lng,Ur.lat]},Tr=function(_r){return _r.map(function(Ur){return At(Ur)})};lt.type===St?kt=At(Et):lt.type===Ke||lt.type===Nr?kt=Et.map(At):lt.type===Ge||lt.type===Sr?kt=Et.map(Tr):lt.type===Gr&&(kt=Et.map(function(_r){return _r.map(function(Ur){return Tr(Ur)})})),lt.incomingCoords(kt)})}var Ki={onSetup:function(z){var ee=this,xe={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:z.featureIds||[]};return this.setSelected(xe.initiallySelectedFeatureIds.filter(function(lt){return ee.getFeature(lt)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),xe},fireUpdate:function(){this.map.fire(Yt,{action:at,features:this.getSelected().map(function(z){return z.toGeoJSON()})})},fireActionable:function(){var z=this,ee=this.getSelected(),xe=ee.filter(function(Tr){return z.isInstanceOf("MultiFeature",Tr)}),lt=!1;if(ee.length>1){lt=!0;var kt=ee[0].type.replace("Multi","");ee.forEach(function(Tr){Tr.type.replace("Multi","")!==kt&&(lt=!1)})}var Et=xe.length>0,At=ee.length>0;this.setActionableState({combineFeatures:lt,uncombineFeatures:Et,trash:At})},getUniqueIds:function(z){return z.length?z.map(function(ee){return ee.properties.id}).filter(function(ee){return ee!==void 0}).reduce(function(ee,xe){return ee.add(xe),ee},new Er).values():[]},stopExtendedInteractions:function(z){z.boxSelectElement&&(z.boxSelectElement.parentNode&&z.boxSelectElement.parentNode.removeChild(z.boxSelectElement),z.boxSelectElement=null),this.map.dragPan.enable(),z.boxSelecting=!1,z.canBoxSelect=!1,z.dragMoving=!1,z.canDragMove=!1},onStop:function(){Qt(this)},onMouseMove:function(z){return this.stopExtendedInteractions(z),!0},onMouseOut:function(z){return!z.dragMoving||this.fireUpdate()}};Ki.onTap=Ki.onClick=function(z,ee){return fe(ee)?this.clickAnywhere(z,ee):Bt(cr)(ee)?this.clickOnVertex(z,ee):function(xe){return!!xe.featureTarget&&!!xe.featureTarget.properties&&xe.featureTarget.properties.meta===Br}(ee)?this.clickOnFeature(z,ee):void 0},Ki.clickAnywhere=function(z){var ee=this,xe=this.getSelectedIds();xe.length&&(this.clearSelectedFeatures(),xe.forEach(function(lt){return ee.doRender(lt)})),Qt(this),this.stopExtendedInteractions(z)},Ki.clickOnVertex=function(z,ee){this.changeMode(_t.DIRECT_SELECT,{featureId:ee.featureTarget.properties.parent,coordPath:ee.featureTarget.properties.coord_path,startPos:ee.lngLat}),this.updateUIClasses({mouse:Re})},Ki.startOnActiveFeature=function(z,ee){this.stopExtendedInteractions(z),this.map.dragPan.disable(),this.doRender(ee.featureTarget.properties.id),z.canDragMove=!0,z.dragMoveLocation=ee.lngLat},Ki.clickOnFeature=function(z,ee){var xe=this;Kr(this),this.stopExtendedInteractions(z);var lt=Fe(ee),kt=this.getSelectedIds(),Et=ee.featureTarget.properties.id,At=this.isSelected(Et);if(!lt&&At&&this.getFeature(Et).type!==St)return this.changeMode(_t.DIRECT_SELECT,{featureId:Et});At&&lt?(this.deselect(Et),this.updateUIClasses({mouse:ve}),kt.length===1&&Qt(this)):!At&&lt?(this.select(Et),this.updateUIClasses({mouse:Re})):At||lt||(kt.forEach(function(Tr){return xe.doRender(Tr)}),this.setSelected(Et),this.updateUIClasses({mouse:Re})),this.doRender(Et)},Ki.onMouseDown=function(z,ee){return _e(ee)?this.startOnActiveFeature(z,ee):this.drawConfig.boxSelect&&function(xe){return!!xe.originalEvent&&!!xe.originalEvent.shiftKey&&xe.originalEvent.button===0}(ee)?this.startBoxSelect(z,ee):void 0},Ki.startBoxSelect=function(z,ee){this.stopExtendedInteractions(z),this.map.dragPan.disable(),z.boxSelectStartLocation=vt(ee.originalEvent,this.map.getContainer()),z.canBoxSelect=!0},Ki.onTouchStart=function(z,ee){if(_e(ee))return this.startOnActiveFeature(z,ee)},Ki.onDrag=function(z,ee){return z.canDragMove?this.dragMove(z,ee):this.drawConfig.boxSelect&&z.canBoxSelect?this.whileBoxSelect(z,ee):void 0},Ki.whileBoxSelect=function(z,ee){z.boxSelecting=!0,this.updateUIClasses({mouse:ue}),z.boxSelectElement||(z.boxSelectElement=document.createElement("div"),z.boxSelectElement.classList.add(ye),this.map.getContainer().appendChild(z.boxSelectElement));var xe=vt(ee.originalEvent,this.map.getContainer()),lt=Math.min(z.boxSelectStartLocation.x,xe.x),kt=Math.max(z.boxSelectStartLocation.x,xe.x),Et=Math.min(z.boxSelectStartLocation.y,xe.y),At=Math.max(z.boxSelectStartLocation.y,xe.y),Tr="translate("+lt+"px, "+Et+"px)";z.boxSelectElement.style.transform=Tr,z.boxSelectElement.style.WebkitTransform=Tr,z.boxSelectElement.style.width=kt-lt+"px",z.boxSelectElement.style.height=At-Et+"px"},Ki.dragMove=function(z,ee){z.dragMoving=!0,ee.originalEvent.stopPropagation();var xe={lng:ee.lngLat.lng-z.dragMoveLocation.lng,lat:ee.lngLat.lat-z.dragMoveLocation.lat};ao(this.getSelected(),xe),z.dragMoveLocation=ee.lngLat},Ki.onMouseUp=function(z,ee){var xe=this;if(z.dragMoving)this.fireUpdate();else if(z.boxSelecting){var lt=[z.boxSelectStartLocation,vt(ee.originalEvent,this.map.getContainer())],kt=this.featuresAt(null,lt,"click"),Et=this.getUniqueIds(kt).filter(function(At){return!xe.isSelected(At)});Et.length&&(this.select(Et),Et.forEach(function(At){return xe.doRender(At)}),this.updateUIClasses({mouse:Re}))}this.stopExtendedInteractions(z)},Ki.toDisplayFeatures=function(z,ee,xe){ee.properties.active=this.isSelected(ee.properties.id)?ur:yi,xe(ee),this.fireActionable(),ee.properties.active===ur&&ee.geometry.type!==St&&Ar(ee).forEach(xe)},Ki.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ki.onCombineFeatures=function(){var z=this.getSelected();if(!(z.length===0||z.length<2)){for(var ee=[],xe=[],lt=z[0].type.replace("Multi",""),kt=0;kt<z.length;kt++){var Et=z[kt];if(Et.type.replace("Multi","")!==lt)return;Et.type.includes("Multi")?Et.getCoordinates().forEach(function(Tr){ee.push(Tr)}):ee.push(Et.getCoordinates()),xe.push(Et.toGeoJSON())}if(xe.length>1){var At=this.newFeature({type:Te,properties:xe[0].properties,geometry:{type:"Multi"+lt,coordinates:ee}});this.addFeature(At),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([At.id]),this.map.fire(ii,{createdFeatures:[At.toGeoJSON()],deletedFeatures:xe})}this.fireActionable()}},Ki.onUncombineFeatures=function(){var z=this,ee=this.getSelected();if(ee.length!==0){for(var xe=[],lt=[],kt=function(At){var Tr=ee[At];z.isInstanceOf("MultiFeature",Tr)&&(Tr.getFeatures().forEach(function(_r){z.addFeature(_r),_r.properties=Tr.properties,xe.push(_r.toGeoJSON()),z.select([_r.id])}),z.deleteFeature(Tr.id,{silent:!0}),lt.push(Tr.toGeoJSON()))},Et=0;Et<ee.length;Et++)kt(Et);xe.length>1&&this.map.fire(nr,{createdFeatures:xe,deletedFeatures:lt}),this.fireActionable()}};var J=Bt(cr),Y=Bt(Xr),Me={fireUpdate:function(){this.map.fire(Yt,{action:bi,features:this.getSelected().map(function(z){return z.toGeoJSON()})})},fireActionable:function(z){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:z.selectedCoordPaths.length>0})},startDragging:function(z,ee){this.map.dragPan.disable(),z.canDragMove=!0,z.dragMoveLocation=ee.lngLat},stopDragging:function(z){this.map.dragPan.enable(),z.dragMoving=!1,z.canDragMove=!1,z.dragMoveLocation=null},onVertex:function(z,ee){this.startDragging(z,ee);var xe=ee.featureTarget.properties,lt=z.selectedCoordPaths.indexOf(xe.coord_path);Fe(ee)||lt!==-1?Fe(ee)&&lt===-1&&z.selectedCoordPaths.push(xe.coord_path):z.selectedCoordPaths=[xe.coord_path];var kt=this.pathsToCoordinates(z.featureId,z.selectedCoordPaths);this.setSelectedCoordinates(kt)},onMidpoint:function(z,ee){this.startDragging(z,ee);var xe=ee.featureTarget.properties;z.feature.addCoordinate(xe.coord_path,xe.lng,xe.lat),this.fireUpdate(),z.selectedCoordPaths=[xe.coord_path]},pathsToCoordinates:function(z,ee){return ee.map(function(xe){return{feature_id:z,coord_path:xe}})},onFeature:function(z,ee){z.selectedCoordPaths.length===0?this.startDragging(z,ee):this.stopDragging(z)},dragFeature:function(z,ee,xe){ao(this.getSelected(),xe),z.dragMoveLocation=ee.lngLat},dragVertex:function(z,ee,xe){for(var lt=z.selectedCoordPaths.map(function(Tr){return z.feature.getCoordinate(Tr)}),kt=Ft(lt.map(function(Tr){return{type:Te,properties:{},geometry:{type:St,coordinates:Tr}}}),xe),Et=0;Et<lt.length;Et++){var At=lt[Et];z.feature.updateCoordinate(z.selectedCoordPaths[Et],At[0]+kt.lng,At[1]+kt.lat)}},clickNoTarget:function(){this.changeMode(_t.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(_t.SIMPLE_SELECT)},clickActiveFeature:function(z){z.selectedCoordPaths=[],this.clearSelectedCoordinates(),z.feature.changed()},onSetup:function(z){var ee=z.featureId,xe=this.getFeature(ee);if(!xe)throw new Error("You must provide a featureId to enter direct_select mode");if(xe.type===St)throw new TypeError("direct_select mode doesn't handle point features");var lt={featureId:ee,feature:xe,dragMoveLocation:z.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:z.coordPath?[z.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(ee,lt.selectedCoordPaths)),this.setSelected(ee),Kr(this),this.setActionableState({trash:!0}),lt},onStop:function(){Qt(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(z,ee,xe){z.featureId===ee.properties.id?(ee.properties.active=ur,xe(ee),Ar(ee,{map:this.map,midpoints:!0,selectedPaths:z.selectedCoordPaths}).forEach(xe)):(ee.properties.active=yi,xe(ee)),this.fireActionable(z)},onTrash:function(z){z.selectedCoordPaths.sort(function(ee,xe){return xe.localeCompare(ee,"en",{numeric:!0})}).forEach(function(ee){return z.feature.removeCoordinate(ee)}),this.fireUpdate(),z.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(z),z.feature.isValid()===!1&&(this.deleteFeature([z.featureId]),this.changeMode(_t.SIMPLE_SELECT,{}))},onMouseMove:function(z,ee){var xe=_e(ee),lt=J(ee),kt=z.selectedCoordPaths.length===0;return xe&&kt||lt&&!kt?this.updateUIClasses({mouse:Re}):this.updateUIClasses({mouse:be}),this.stopDragging(z),!0},onMouseOut:function(z){return z.dragMoving&&this.fireUpdate(),!0}};Me.onTouchStart=Me.onMouseDown=function(z,ee){return J(ee)?this.onVertex(z,ee):_e(ee)?this.onFeature(z,ee):Y(ee)?this.onMidpoint(z,ee):void 0},Me.onDrag=function(z,ee){if(z.canDragMove===!0){z.dragMoving=!0,ee.originalEvent.stopPropagation();var xe={lng:ee.lngLat.lng-z.dragMoveLocation.lng,lat:ee.lngLat.lat-z.dragMoveLocation.lat};z.selectedCoordPaths.length>0?this.dragVertex(z,ee,xe):this.dragFeature(z,ee,xe),z.dragMoveLocation=ee.lngLat}},Me.onClick=function(z,ee){return fe(ee)?this.clickNoTarget(z,ee):_e(ee)?this.clickActiveFeature(z,ee):ae(ee)?this.clickInactive(z,ee):void this.stopDragging(z)},Me.onTap=function(z,ee){return fe(ee)?this.clickNoTarget(z,ee):_e(ee)?this.clickActiveFeature(z,ee):ae(ee)?this.clickInactive(z,ee):void 0},Me.onTouchEnd=Me.onMouseUp=function(z){z.dragMoving&&this.fireUpdate(),this.stopDragging(z)};var ct={};function Pt(z,ee){return!!z.lngLat&&z.lngLat.lng===ee[0]&&z.lngLat.lat===ee[1]}ct.onSetup=function(){var z=this.newFeature({type:Te,properties:{},geometry:{type:St,coordinates:[]}});return this.addFeature(z),this.clearSelectedFeatures(),this.updateUIClasses({mouse:ue}),this.activateUIButton(de.POINT),this.setActionableState({trash:!0}),{point:z}},ct.stopDrawingAndRemove=function(z){this.deleteFeature([z.point.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT)},ct.onTap=ct.onClick=function(z,ee){this.updateUIClasses({mouse:Re}),z.point.updateCoordinate("",ee.lngLat.lng,ee.lngLat.lat),this.map.fire(Kt,{features:[z.point.toGeoJSON()]}),this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.point.id]})},ct.onStop=function(z){this.activateUIButton(),z.point.getCoordinate().length||this.deleteFeature([z.point.id],{silent:!0})},ct.toDisplayFeatures=function(z,ee,xe){var lt=ee.properties.id===z.point.id;if(ee.properties.active=lt?ur:yi,!lt)return xe(ee)},ct.onTrash=ct.stopDrawingAndRemove,ct.onKeyUp=function(z,ee){if(Ye(ee)||mt(ee))return this.stopDrawingAndRemove(z,ee)};var Ve={onSetup:function(){var z=this.newFeature({type:Te,properties:{},geometry:{type:Ge,coordinates:[[]]}});return this.addFeature(z),this.clearSelectedFeatures(),Kr(this),this.updateUIClasses({mouse:ue}),this.activateUIButton(de.POLYGON),this.setActionableState({trash:!0}),{polygon:z,currentVertexPosition:0}},clickAnywhere:function(z,ee){if(z.currentVertexPosition>0&&Pt(ee,z.polygon.coordinates[0][z.currentVertexPosition-1]))return this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.polygon.id]});this.updateUIClasses({mouse:ue}),z.polygon.updateCoordinate("0."+z.currentVertexPosition,ee.lngLat.lng,ee.lngLat.lat),z.currentVertexPosition++,z.polygon.updateCoordinate("0."+z.currentVertexPosition,ee.lngLat.lng,ee.lngLat.lat)},clickOnVertex:function(z){return this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.polygon.id]})},onMouseMove:function(z,ee){z.polygon.updateCoordinate("0."+z.currentVertexPosition,ee.lngLat.lng,ee.lngLat.lat),ke(ee)&&this.updateUIClasses({mouse:ve})}};Ve.onTap=Ve.onClick=function(z,ee){return ke(ee)?this.clickOnVertex(z,ee):this.clickAnywhere(z,ee)},Ve.onKeyUp=function(z,ee){Ye(ee)?(this.deleteFeature([z.polygon.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT)):mt(ee)&&this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.polygon.id]})},Ve.onStop=function(z){this.updateUIClasses({mouse:be}),Qt(this),this.activateUIButton(),this.getFeature(z.polygon.id)!==void 0&&(z.polygon.removeCoordinate("0."+z.currentVertexPosition),z.polygon.isValid()?this.map.fire(Kt,{features:[z.polygon.toGeoJSON()]}):(this.deleteFeature([z.polygon.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT,{},{silent:!0})))},Ve.toDisplayFeatures=function(z,ee,xe){var lt=ee.properties.id===z.polygon.id;if(ee.properties.active=lt?ur:yi,!lt)return xe(ee);if(ee.geometry.coordinates.length!==0){var kt=ee.geometry.coordinates[0].length;if(!(kt<3)){if(ee.properties.meta=Br,xe($t(z.polygon.id,ee.geometry.coordinates[0][0],"0.0",!1)),kt>3){var Et=ee.geometry.coordinates[0].length-3;xe($t(z.polygon.id,ee.geometry.coordinates[0][Et],"0."+Et,!1))}if(kt<=4){var At=[[ee.geometry.coordinates[0][0][0],ee.geometry.coordinates[0][0][1]],[ee.geometry.coordinates[0][1][0],ee.geometry.coordinates[0][1][1]]];if(xe({type:Te,properties:ee.properties,geometry:{coordinates:At,type:Ke}}),kt===3)return}return xe(ee)}}},Ve.onTrash=function(z){this.deleteFeature([z.polygon.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT)};var pt={onSetup:function(z){var ee,xe,lt=(z=z||{}).featureId,kt="forward";if(lt){if(!(ee=this.getFeature(lt)))throw new Error("Could not find a feature with the provided featureId");var Et=z.from;if(Et&&Et.type==="Feature"&&Et.geometry&&Et.geometry.type==="Point"&&(Et=Et.geometry),Et&&Et.type==="Point"&&Et.coordinates&&Et.coordinates.length===2&&(Et=Et.coordinates),!Et||!Array.isArray(Et))throw new Error("Please use the `from` property to indicate which point to continue the line from");var At=ee.coordinates.length-1;if(ee.coordinates[At][0]===Et[0]&&ee.coordinates[At][1]===Et[1])xe=At+1,ee.addCoordinate.apply(ee,[xe].concat(ee.coordinates[At]));else{if(ee.coordinates[0][0]!==Et[0]||ee.coordinates[0][1]!==Et[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");kt="backwards",xe=0,ee.addCoordinate.apply(ee,[xe].concat(ee.coordinates[0]))}}else ee=this.newFeature({type:Te,properties:{},geometry:{type:Ke,coordinates:[]}}),xe=0,this.addFeature(ee);return this.clearSelectedFeatures(),Kr(this),this.updateUIClasses({mouse:ue}),this.activateUIButton(de.LINE),this.setActionableState({trash:!0}),{line:ee,currentVertexPosition:xe,direction:kt}},clickAnywhere:function(z,ee){if(z.currentVertexPosition>0&&Pt(ee,z.line.coordinates[z.currentVertexPosition-1])||z.direction==="backwards"&&Pt(ee,z.line.coordinates[z.currentVertexPosition+1]))return this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.line.id]});this.updateUIClasses({mouse:ue}),z.line.updateCoordinate(z.currentVertexPosition,ee.lngLat.lng,ee.lngLat.lat),z.direction==="forward"?(z.currentVertexPosition++,z.line.updateCoordinate(z.currentVertexPosition,ee.lngLat.lng,ee.lngLat.lat)):z.line.addCoordinate(0,ee.lngLat.lng,ee.lngLat.lat)},clickOnVertex:function(z){return this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.line.id]})},onMouseMove:function(z,ee){z.line.updateCoordinate(z.currentVertexPosition,ee.lngLat.lng,ee.lngLat.lat),ke(ee)&&this.updateUIClasses({mouse:ve})}};pt.onTap=pt.onClick=function(z,ee){if(ke(ee))return this.clickOnVertex(z,ee);this.clickAnywhere(z,ee)},pt.onKeyUp=function(z,ee){mt(ee)?this.changeMode(_t.SIMPLE_SELECT,{featureIds:[z.line.id]}):Ye(ee)&&(this.deleteFeature([z.line.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT))},pt.onStop=function(z){Qt(this),this.activateUIButton(),this.getFeature(z.line.id)!==void 0&&(z.line.removeCoordinate(""+z.currentVertexPosition),z.line.isValid()?this.map.fire(Kt,{features:[z.line.toGeoJSON()]}):(this.deleteFeature([z.line.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT,{},{silent:!0})))},pt.onTrash=function(z){this.deleteFeature([z.line.id],{silent:!0}),this.changeMode(_t.SIMPLE_SELECT)},pt.toDisplayFeatures=function(z,ee,xe){var lt=ee.properties.id===z.line.id;if(ee.properties.active=lt?ur:yi,!lt)return xe(ee);ee.geometry.coordinates.length<2||(ee.properties.meta=Br,xe($t(z.line.id,ee.geometry.coordinates[z.direction==="forward"?ee.geometry.coordinates.length-2:1],""+(z.direction==="forward"?ee.geometry.coordinates.length-2:1),!1)),xe(ee))};var dt={simple_select:Ki,direct_select:Me,draw_point:ct,draw_polygon:Ve,draw_line_string:pt},ft={defaultMode:_t.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:dt,controls:{},userProperties:!1},Rr={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},gi={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function q(z,ee){return z.map(function(xe){return xe.source?xe:Pn(xe,{id:xe.id+"."+ee,source:ee==="hot"?oe:le})})}var fi=Qr(function(z,ee){var xe="[object Arguments]",lt="[object Map]",kt="[object Object]",Et="[object Set]",At=/^\[object .+?Constructor\]$/,Tr=/^(?:0|[1-9]\d*)$/,_r={};_r["[object Float32Array]"]=_r["[object Float64Array]"]=_r["[object Int8Array]"]=_r["[object Int16Array]"]=_r["[object Int32Array]"]=_r["[object Uint8Array]"]=_r["[object Uint8ClampedArray]"]=_r["[object Uint16Array]"]=_r["[object Uint32Array]"]=!0,_r[xe]=_r["[object Array]"]=_r["[object ArrayBuffer]"]=_r["[object Boolean]"]=_r["[object DataView]"]=_r["[object Date]"]=_r["[object Error]"]=_r["[object Function]"]=_r[lt]=_r["[object Number]"]=_r[kt]=_r["[object RegExp]"]=_r[Et]=_r["[object String]"]=_r["[object WeakMap]"]=!1;var Ur=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,It=typeof self=="object"&&self&&self.Object===Object&&self,Ir=Ur||It||Function("return this")(),Yr=ee&&!ee.nodeType&&ee,hi=Yr&&z&&!z.nodeType&&z,pi=hi&&hi.exports===Yr,pn=pi&&Ur.process,pr=function(){try{return pn&&pn.binding&&pn.binding("util")}catch{}}(),ei=pr&&pr.isTypedArray;function Oi(Tt,Wt){for(var qr=-1,Si=Tt==null?0:Tt.length;++qr<Si;)if(Wt(Tt[qr],qr,Tt))return!0;return!1}function Ci(Tt){var Wt=-1,qr=Array(Tt.size);return Tt.forEach(function(Si,fn){qr[++Wt]=[fn,Si]}),qr}function vn(Tt){var Wt=-1,qr=Array(Tt.size);return Tt.forEach(function(Si){qr[++Wt]=Si}),qr}var _i,yr,dn,an=Array.prototype,Zn=Function.prototype,Nn=Object.prototype,Da=Ir["__core-js_shared__"],ka=Zn.toString,eo=Nn.hasOwnProperty,Go=(_i=/[^.]+$/.exec(Da&&Da.keys&&Da.keys.IE_PROTO||""))?"Symbol(src)_1."+_i:"",pa=Nn.toString,Pa=RegExp("^"+ka.call(eo).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xa=pi?Ir.Buffer:void 0,Ro=Ir.Symbol,Ga=Ir.Uint8Array,Qn=Nn.propertyIsEnumerable,Cs=an.splice,qo=Ro?Ro.toStringTag:void 0,xo=Object.getOwnPropertySymbols,sn=xa?xa.isBuffer:void 0,Hn=(yr=Object.keys,dn=Object,function(Tt){return yr(dn(Tt))}),ta=ie(Ir,"DataView"),Bo=ie(Ir,"Map"),ra=ie(Ir,"Promise"),ma=ie(Ir,"Set"),so=ie(Ir,"WeakMap"),ia=ie(Object,"create"),Is=Ho(ta),ba=Ho(Bo),cn=Ho(ra),Ds=Ho(ma),qa=Ho(so),wa=Ro?Ro.prototype:void 0,Ct=wa?wa.valueOf:void 0;function Mo(Tt){var Wt=-1,qr=Tt==null?0:Tt.length;for(this.clear();++Wt<qr;){var Si=Tt[Wt];this.set(Si[0],Si[1])}}function mo(Tt){var Wt=-1,qr=Tt==null?0:Tt.length;for(this.clear();++Wt<qr;){var Si=Tt[Wt];this.set(Si[0],Si[1])}}function lo(Tt){var Wt=-1,qr=Tt==null?0:Tt.length;for(this.clear();++Wt<qr;){var Si=Tt[Wt];this.set(Si[0],Si[1])}}function Xo(Tt){var Wt=-1,qr=Tt==null?0:Tt.length;for(this.__data__=new lo;++Wt<qr;)this.add(Tt[Wt])}function Oo(Tt){var Wt=this.__data__=new mo(Tt);this.size=Wt.size}function Ui(Tt,Wt){var qr=La(Tt),Si=!qr&&us(Tt),fn=!qr&&!Si&&Ra(Tt),tn=!qr&&!Si&&!fn&&Ya(Tt),Rn=qr||Si||fn||tn,qn=Rn?function(Bn,oa){for(var zo=-1,co=Array(Bn);++zo<Bn;)co[zo]=oa(zo);return co}(Tt.length,String):[],bo=qn.length;for(var Wn in Tt)!Wt&&!eo.call(Tt,Wn)||Rn&&(Wn=="length"||fn&&(Wn=="offset"||Wn=="parent")||tn&&(Wn=="buffer"||Wn=="byteLength"||Wn=="byteOffset")||Vn(Wn,bo))||qn.push(Wn);return qn}function na(Tt,Wt){for(var qr=Tt.length;qr--;)if(Xa(Tt[qr][0],Wt))return qr;return-1}function go(Tt){return Tt==null?Tt===void 0?"[object Undefined]":"[object Null]":qo&&qo in Object(Tt)?function(Wt){var qr=eo.call(Wt,qo),Si=Wt[qo];try{Wt[qo]=void 0;var fn=!0}catch{}var tn=pa.call(Wt);return fn&&(qr?Wt[qo]=Si:delete Wt[qo]),tn}(Tt):function(Wt){return pa.call(Wt)}(Tt)}function ga(Tt){return Ao(Tt)&&go(Tt)==xe}function Zo(Tt,Wt,qr,Si,fn){return Tt===Wt||(Tt==null||Wt==null||!Ao(Tt)&&!Ao(Wt)?Tt!=Tt&&Wt!=Wt:function(tn,Rn,qn,bo,Wn,Bn){var oa=La(tn),zo=La(Rn),co=oa?"[object Array]":Fo(tn),wo=zo?"[object Array]":Fo(Rn),Ea=(co=co==xe?kt:co)==kt,Ze=(wo=wo==xe?kt:wo)==kt,He=co==wo;if(He&&Ra(tn)){if(!Ra(Rn))return!1;oa=!0,Ea=!1}if(He&&!Ea)return Bn||(Bn=new Oo),oa||Ya(tn)?cs(tn,Rn,qn,bo,Wn,Bn):function(wn,gn,fs,_a,ks,Eo,No){switch(fs){case"[object DataView]":if(wn.byteLength!=gn.byteLength||wn.byteOffset!=gn.byteOffset)return!1;wn=wn.buffer,gn=gn.buffer;case"[object ArrayBuffer]":return!(wn.byteLength!=gn.byteLength||!Eo(new Ga(wn),new Ga(gn)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Xa(+wn,+gn);case"[object Error]":return wn.name==gn.name&&wn.message==gn.message;case"[object RegExp]":case"[object String]":return wn==gn+"";case lt:var sa=Ci;case Et:var Ba=1&_a;if(sa||(sa=vn),wn.size!=gn.size&&!Ba)return!1;var Oa=No.get(wn);if(Oa)return Oa==gn;_a|=2,No.set(wn,gn);var la=cs(sa(wn),sa(gn),_a,ks,Eo,No);return No.delete(wn),la;case"[object Symbol]":if(Ct)return Ct.call(wn)==Ct.call(gn)}return!1}(tn,Rn,co,qn,bo,Wn,Bn);if(!(1&qn)){var We=Ea&&eo.call(tn,"__wrapped__"),ds=Ze&&eo.call(Rn,"__wrapped__");if(We||ds){var aa=We?tn.value():tn,Xs=ds?Rn.value():Rn;return Bn||(Bn=new Oo),Wn(aa,Xs,qn,bo,Bn)}}return He?(Bn||(Bn=new Oo),function(wn,gn,fs,_a,ks,Eo){var No=1&fs,sa=Fi(wn),Ba=sa.length,Oa=Fi(gn).length;if(Ba!=Oa&&!No)return!1;for(var la=Ba;la--;){var to=sa[la];if(!(No?to in gn:eo.call(gn,to)))return!1}var Fa=Eo.get(wn);if(Fa&&Eo.get(gn))return Fa==gn;var Ka=!0;Eo.set(wn,gn),Eo.set(gn,wn);for(var _o=No;++la<Ba;){to=sa[la];var Wo=wn[to],Yo=gn[to];if(_a)var ps=No?_a(Yo,Wo,to,gn,wn,Eo):_a(Wo,Yo,to,wn,gn,Eo);if(!(ps===void 0?Wo===Yo||ks(Wo,Yo,fs,_a,Eo):ps)){Ka=!1;break}_o||(_o=to=="constructor")}if(Ka&&!_o){var rn=wn.constructor,ya=gn.constructor;rn==ya||!("constructor"in wn)||!("constructor"in gn)||typeof rn=="function"&&rn instanceof rn&&typeof ya=="function"&&ya instanceof ya||(Ka=!1)}return Eo.delete(wn),Eo.delete(gn),Ka}(tn,Rn,qn,bo,Wn,Bn)):!1}(Tt,Wt,qr,Si,Zo,fn))}function en(Tt){return!(!Wa(Tt)||function(Wt){return!!Go&&Go in Wt}(Tt))&&(Za(Tt)?Pa:At).test(Ho(Tt))}function Ni(Tt){if(qr=(Wt=Tt)&&Wt.constructor,Si=typeof qr=="function"&&qr.prototype||Nn,Wt!==Si)return Hn(Tt);var Wt,qr,Si,fn=[];for(var tn in Object(Tt))eo.call(Tt,tn)&&tn!="constructor"&&fn.push(tn);return fn}function cs(Tt,Wt,qr,Si,fn,tn){var Rn=1&qr,qn=Tt.length,bo=Wt.length;if(qn!=bo&&!(Rn&&bo>qn))return!1;var Wn=tn.get(Tt);if(Wn&&tn.get(Wt))return Wn==Wt;var Bn=-1,oa=!0,zo=2&qr?new Xo:void 0;for(tn.set(Tt,Wt),tn.set(Wt,Tt);++Bn<qn;){var co=Tt[Bn],wo=Wt[Bn];if(Si)var Ea=Rn?Si(wo,co,Bn,Wt,Tt,tn):Si(co,wo,Bn,Tt,Wt,tn);if(Ea!==void 0){if(Ea)continue;oa=!1;break}if(zo){if(!Oi(Wt,function(Ze,He){if(We=He,!zo.has(We)&&(co===Ze||fn(co,Ze,qr,Si,tn)))return zo.push(He);var We})){oa=!1;break}}else if(co!==wo&&!fn(co,wo,qr,Si,tn)){oa=!1;break}}return tn.delete(Tt),tn.delete(Wt),oa}function Fi(Tt){return function(Wt,qr,Si){var fn=qr(Wt);return La(Wt)?fn:function(tn,Rn){for(var qn=-1,bo=Rn.length,Wn=tn.length;++qn<bo;)tn[Wn+qn]=Rn[qn];return tn}(fn,Si(Wt))}(Tt,hs,Ri)}function Ln(Tt,Wt){var qr,Si,fn=Tt.__data__;return((Si=typeof(qr=Wt))=="string"||Si=="number"||Si=="symbol"||Si=="boolean"?qr!=="__proto__":qr===null)?fn[typeof Wt=="string"?"string":"hash"]:fn.map}function ie(Tt,Wt){var qr=function(Si,fn){return Si?.[fn]}(Tt,Wt);return en(qr)?qr:void 0}Mo.prototype.clear=function(){this.__data__=ia?ia(null):{},this.size=0},Mo.prototype.delete=function(Tt){var Wt=this.has(Tt)&&delete this.__data__[Tt];return this.size-=Wt?1:0,Wt},Mo.prototype.get=function(Tt){var Wt=this.__data__;if(ia){var qr=Wt[Tt];return qr==="__lodash_hash_undefined__"?void 0:qr}return eo.call(Wt,Tt)?Wt[Tt]:void 0},Mo.prototype.has=function(Tt){var Wt=this.__data__;return ia?Wt[Tt]!==void 0:eo.call(Wt,Tt)},Mo.prototype.set=function(Tt,Wt){var qr=this.__data__;return this.size+=this.has(Tt)?0:1,qr[Tt]=ia&&Wt===void 0?"__lodash_hash_undefined__":Wt,this},mo.prototype.clear=function(){this.__data__=[],this.size=0},mo.prototype.delete=function(Tt){var Wt=this.__data__,qr=na(Wt,Tt);return!(qr<0)&&(qr==Wt.length-1?Wt.pop():Cs.call(Wt,qr,1),--this.size,!0)},mo.prototype.get=function(Tt){var Wt=this.__data__,qr=na(Wt,Tt);return qr<0?void 0:Wt[qr][1]},mo.prototype.has=function(Tt){return na(this.__data__,Tt)>-1},mo.prototype.set=function(Tt,Wt){var qr=this.__data__,Si=na(qr,Tt);return Si<0?(++this.size,qr.push([Tt,Wt])):qr[Si][1]=Wt,this},lo.prototype.clear=function(){this.size=0,this.__data__={hash:new Mo,map:new(Bo||mo),string:new Mo}},lo.prototype.delete=function(Tt){var Wt=Ln(this,Tt).delete(Tt);return this.size-=Wt?1:0,Wt},lo.prototype.get=function(Tt){return Ln(this,Tt).get(Tt)},lo.prototype.has=function(Tt){return Ln(this,Tt).has(Tt)},lo.prototype.set=function(Tt,Wt){var qr=Ln(this,Tt),Si=qr.size;return qr.set(Tt,Wt),this.size+=qr.size==Si?0:1,this},Xo.prototype.add=Xo.prototype.push=function(Tt){return this.__data__.set(Tt,"__lodash_hash_undefined__"),this},Xo.prototype.has=function(Tt){return this.__data__.has(Tt)},Oo.prototype.clear=function(){this.__data__=new mo,this.size=0},Oo.prototype.delete=function(Tt){var Wt=this.__data__,qr=Wt.delete(Tt);return this.size=Wt.size,qr},Oo.prototype.get=function(Tt){return this.__data__.get(Tt)},Oo.prototype.has=function(Tt){return this.__data__.has(Tt)},Oo.prototype.set=function(Tt,Wt){var qr=this.__data__;if(qr instanceof mo){var Si=qr.__data__;if(!Bo||Si.length<199)return Si.push([Tt,Wt]),this.size=++qr.size,this;qr=this.__data__=new lo(Si)}return qr.set(Tt,Wt),this.size=qr.size,this};var Ri=xo?function(Tt){return Tt==null?[]:(Tt=Object(Tt),function(Wt,qr){for(var Si=-1,fn=Wt==null?0:Wt.length,tn=0,Rn=[];++Si<fn;){var qn=Wt[Si];qr(qn,Si,Wt)&&(Rn[tn++]=qn)}return Rn}(xo(Tt),function(Wt){return Qn.call(Tt,Wt)}))}:function(){return[]},Fo=go;function Vn(Tt,Wt){return!!(Wt=Wt??9007199254740991)&&(typeof Tt=="number"||Tr.test(Tt))&&Tt>-1&&Tt%1==0&&Tt<Wt}function Ho(Tt){if(Tt!=null){try{return ka.call(Tt)}catch{}try{return Tt+""}catch{}}return""}function Xa(Tt,Wt){return Tt===Wt||Tt!=Tt&&Wt!=Wt}(ta&&Fo(new ta(new ArrayBuffer(1)))!="[object DataView]"||Bo&&Fo(new Bo)!=lt||ra&&Fo(ra.resolve())!="[object Promise]"||ma&&Fo(new ma)!=Et||so&&Fo(new so)!="[object WeakMap]")&&(Fo=function(Tt){var Wt=go(Tt),qr=Wt==kt?Tt.constructor:void 0,Si=qr?Ho(qr):"";if(Si)switch(Si){case Is:return"[object DataView]";case ba:return lt;case cn:return"[object Promise]";case Ds:return Et;case qa:return"[object WeakMap]"}return Wt});var us=ga(function(){return arguments}())?ga:function(Tt){return Ao(Tt)&&eo.call(Tt,"callee")&&!Qn.call(Tt,"callee")},La=Array.isArray,Ra=sn||function(){return!1};function Za(Tt){if(!Wa(Tt))return!1;var Wt=go(Tt);return Wt=="[object Function]"||Wt=="[object GeneratorFunction]"||Wt=="[object AsyncFunction]"||Wt=="[object Proxy]"}function Ha(Tt){return typeof Tt=="number"&&Tt>-1&&Tt%1==0&&Tt<=9007199254740991}function Wa(Tt){var Wt=typeof Tt;return Tt!=null&&(Wt=="object"||Wt=="function")}function Ao(Tt){return Tt!=null&&typeof Tt=="object"}var Ya=ei?function(Tt){return function(Wt){return Tt(Wt)}}(ei):function(Tt){return Ao(Tt)&&Ha(Tt.length)&&!!_r[go(Tt)]};function hs(Tt){return(Wt=Tt)!=null&&Ha(Wt.length)&&!Za(Wt)?Ui(Tt):Ni(Tt);var Wt}z.exports=function(Tt,Wt){return Zo(Tt,Wt)}}),$i={Polygon:di,LineString:ui,Point:xi,MultiPolygon:Zi,MultiLineString:Zi,MultiPoint:Zi};function ji(z,ee){return ee.modes=_t,ee.getFeatureIdsAt=function(xe){return Jt.click({point:xe},null,z).map(function(lt){return lt.properties.id})},ee.getSelectedIds=function(){return z.store.getSelectedIds()},ee.getSelected=function(){return{type:xt,features:z.store.getSelectedIds().map(function(xe){return z.store.get(xe)}).map(function(xe){return xe.toGeoJSON()})}},ee.getSelectedPoints=function(){return{type:xt,features:z.store.getSelectedCoordinates().map(function(xe){return{type:Te,properties:{},geometry:{type:St,coordinates:xe.coordinates}}})}},ee.set=function(xe){if(xe.type===void 0||xe.type!==xt||!Array.isArray(xe.features))throw new Error("Invalid FeatureCollection");var lt=z.store.createRenderBatch(),kt=z.store.getAllIds().slice(),Et=ee.add(xe),At=new Er(Et);return(kt=kt.filter(function(Tr){return!At.has(Tr)})).length&&ee.delete(kt),lt(),Et},ee.add=function(xe){var lt=JSON.parse(JSON.stringify(ri(xe))).features.map(function(kt){if(kt.id=kt.id||zr(),kt.geometry===null)throw new Error("Invalid geometry: null");if(z.store.get(kt.id)===void 0||z.store.get(kt.id).type!==kt.geometry.type){var Et=$i[kt.geometry.type];if(Et===void 0)throw new Error("Invalid geometry type: "+kt.geometry.type+".");var At=new Et(z,kt);z.store.add(At)}else{var Tr=z.store.get(kt.id);Tr.properties=kt.properties,fi(Tr.getCoordinates(),kt.geometry.coordinates)||Tr.incomingCoords(kt.geometry.coordinates)}return kt.id});return z.store.render(),lt},ee.get=function(xe){var lt=z.store.get(xe);if(lt)return lt.toGeoJSON()},ee.getAll=function(){return{type:xt,features:z.store.getAll().map(function(xe){return xe.toGeoJSON()})}},ee.delete=function(xe){return z.store.delete(xe,{silent:!0}),ee.getMode()!==_t.DIRECT_SELECT||z.store.getSelectedIds().length?z.store.render():z.events.changeMode(_t.SIMPLE_SELECT,void 0,{silent:!0}),ee},ee.deleteAll=function(){return z.store.delete(z.store.getAllIds(),{silent:!0}),ee.getMode()===_t.DIRECT_SELECT?z.events.changeMode(_t.SIMPLE_SELECT,void 0,{silent:!0}):z.store.render(),ee},ee.changeMode=function(xe,lt){return lt===void 0&&(lt={}),xe===_t.SIMPLE_SELECT&&ee.getMode()===_t.SIMPLE_SELECT?(kt=lt.featureIds||[],Et=z.store.getSelectedIds(),kt.length===Et.length&&JSON.stringify(kt.map(function(At){return At}).sort())===JSON.stringify(Et.map(function(At){return At}).sort())||(z.store.setSelected(lt.featureIds,{silent:!0}),z.store.render()),ee):(xe===_t.DIRECT_SELECT&&ee.getMode()===_t.DIRECT_SELECT&&lt.featureId===z.store.getSelectedIds()[0]||z.events.changeMode(xe,lt,{silent:!0}),ee);var kt,Et},ee.getMode=function(){return z.events.getMode()},ee.trash=function(){return z.events.trash({silent:!0}),ee},ee.combineFeatures=function(){return z.events.combineFeatures({silent:!0}),ee},ee.uncombineFeatures=function(){return z.events.uncombineFeatures({silent:!0}),ee},ee.setFeatureProperty=function(xe,lt,kt){return z.store.setFeatureProperty(xe,lt,kt),ee},ee}var Hi=function(z,ee){var xe={options:z=function(kt){kt===void 0&&(kt={});var Et=Pn(kt);return kt.controls||(Et.controls={}),kt.displayControlsDefault===!1?Et.controls=Pn(gi,kt.controls):Et.controls=Pn(Rr,kt.controls),(Et=Pn(ft,Et)).styles=q(Et.styles,"cold").concat(q(Et.styles,"hot")),Et}(z)};ee=ji(xe,ee),xe.api=ee;var lt=ut(xe);return ee.onAdd=lt.onAdd,ee.onRemove=lt.onRemove,ee.types=de,ee.options=z,ee};function Ai(z){Hi(z,this)}return Ai.modes=dt,Ai})})(mapboxGlDraw$1);var mapboxGlDraw="",mapboxMapViewer_vue_vue_type_style_index_0_lang="";let geocoder;const _sfc_main$3={name:"mapbox-map-viewer",setup(){return{tileInfoString:ref(""),dirHandle:ref(""),style_url:ref(""),access_token:ref(""),mapbox_raster_png_dem:ref(""),mapbox_api_url:ref(""),mapbox_rgb_image_url:ref(""),map:ref(""),threedview:ref(!1),layers:ref(["hillshading","bounding_box","undersea-features-lines","undersea-features-points","undersea-features-points-label","10m-bathymetry-81bsvj"]),layer_type:[{label:"Hillshade",value:"hillshading"},{label:"Bounding Box",value:"bounding_box"},{label:"Undersea Lines",value:"undersea-features-lines"},{label:"Undersea Points",value:"undersea-features-points"},{label:"Undersea Labels",value:"undersea-features-points-label"},{label:"Depth",value:"10m-bathymetry-81bsvj"},{label:"Satellite",value:"satellite"},{label:"3D",value:"3d"}]}},mounted(){},methods:{async changeLayers(e){for(const t of this.layer_type)e.includes(t.value)?t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","visible"):this.map.setTerrain({source:"mapbox-3d",exaggeration:1.5}):t.value!=="3d"?this.map.setLayoutProperty(t.value,"visibility","none"):this.map.setTerrain(null)},loadMapSourcesLayers(e){e.addSource("mapbox_terrain_dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1"}),e.addSource("satellite",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:512}),e.addLayer({id:"satellite",source:"satellite",type:"raster",layout:{visibility:"none"}}),e.addLayer({id:"hillshading",source:"mapbox_terrain_dem",type:"hillshade"}),e.addSource("bounding_box_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]}}}),e.addLayer({id:"bounding_box",type:"fill",source:"bounding_box_source",paint:{"fill-color":"#008888","fill-opacity":0}}),e.addSource("bathymetry",{type:"vector",url:"mapbox://mapbox-public.bathymetry"}),e.addLayer({id:"undersea-features-lines",type:"line",source:"bathymetry","source-layer":"undersea-features-lines",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff69b4","line-width":2}}),e.addLayer({id:"undersea-features-points",type:"circle",source:"bathymetry","source-layer":"undersea-features-points",paint:{"circle-radius":4,"circle-color":"#01fe01"}}),e.addLayer({id:"undersea-features-points-label",type:"symbol",source:"bathymetry","source-layer":"undersea-features-points",layout:{"text-field":"{name}","text-anchor":"top-left","text-size":12}}),e.addSource("10m-bathymetry-81bsvj",{type:"vector",url:"mapbox://mapbox.9tm8dx88"}),e.addSource("mapbox-3d",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:15}),e.addLayer({id:"10m-bathymetry-81bsvj",type:"fill",source:"10m-bathymetry-81bsvj","source-layer":"10m-bathymetry-81bsvj",layout:{},paint:{"fill-outline-color":"hsla(337, 82%, 62%, 0)","fill-color":["interpolate",["cubic-bezier",0,.5,1,.5],["get","DEPTH"],200,"#78bced",9e3,"#15659f"]}},"land-structure-polygon")},async loadMapboxMap(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken,this.mapbox_api_url=await idbKeyval.get("mapbox_api_url"),this.dirHandle=await idbKeyval.get("dirHandle"),this.style_url=await idbKeyval.get("style_url"),this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem");let e=this,t=new mapboxgl.Map({container:"map",trackResize:!0,style:e.style_url,center:[-121.7598,46.876],zoom:9,maxZoom:14,doubleClickZoom:!0,antialias:!0,boxZoom:!0,failIfMajorPerformanceCaveat:!0});this.map=t;const n=function(g){const a=g.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!a)return null;function b(N,F){return{center:[N,F],geometry:{type:"Point",coordinates:[N,F]},place_name:"Lat: "+F+" Lng: "+N,place_type:["coordinate"],properties:{},type:"Feature"}}const T=Number(a[1]),C=Number(a[2]),L=[];return(T<-90||T>90)&&L.push(b(T,C)),(C<-90||C>90)&&L.push(b(C,T)),L.length===0&&(L.push(b(T,C)),L.push(b(C,T))),L};geocoder=new lib({accessToken:this.access_token,mapboxgl,localGeocoder:n,zoom:10,placeholder:"Try: -40, 170 or  Name",reverseGeocode:!0}),t.addControl(geocoder),t.addControl(new mapboxgl.FullscreenControl({})),t.addControl(new mapboxgl.NavigationControl);const o=100,u=25;function f(g){return g*(2-g)}t.on("style.load",()=>{const g=()=>{t.isStyleLoaded()?e.loadMapSourcesLayers(t):setTimeout(g,200)};g()}),t.on("load",function(){t.getCanvas().focus(),t.getCanvas().addEventListener("keydown",g=>{g.preventDefault(),g.which===87?t.panBy([0,-o],{easing:f}):g.which===83?t.panBy([0,o],{easing:f}):g.which===65?t.easeTo({bearing:t.getBearing()-u,easing:f}):g.which===68&&t.easeTo({bearing:t.getBearing()+u,easing:f})},!0)}),t.on("error",g=>{console.error(g)}),t.on("click",async function(g){let a=await idbKeyval.get("dirHandle");if(await fileUtils.verifyPermission(a,!0)===!1){console.error(`User did not grant permission to '${a.name}'`);return}let b=g.lngLat.lng,T=g.lngLat.lat,C=mapUtils.getTileInfo(b,T,t);idbKeyval.set("tile_info",C),e.tileInfoString="Slippy Tile Info String: "+C.x+","+C.y+","+C.z+" Bounding Box sides in KM: "+C.distance,await e.geoCodeReverse(C),t.getSource("bounding_box_source").setData(C.polygon_bb),t.setPaintProperty("bounding_box","fill-opacity",.45),e.mapbox_rgb_image_url=e.mapbox_api_url+e.mapbox_raster_png_dem+`/${C.z}/${C.x}/${C.y}@2x.pngraw?access_token=`+e.access_token;let L=await mapUtils.getMapboxTerrainRgb(a,C,e.mapbox_rgb_image_url),N=await L.toBuffer();await idbKeyval.set("rgb_image_buffer",N),await fileUtils.writeFileToDisk(a,C.rgbFileName,N);let F=mapUtils.createHeightMapImage(L,32,"GREY");if(await fileUtils.fileExists(a,C.thirtyTwoFileName)===!1){let se=await F.image.toBuffer();await fileUtils.writeFileToDisk(a,C.thirtyTwoFileName,se)}emitter.emit("updatePreviewImage",{dir_handle:a,tile_info:C,preview_image_info:F,map:t})}),t.on("mousemove",g=>{t.getCanvas().style.cursor="pointer";const a=t.queryRenderedFeatures(g.point);for(const b of a)if(Object.keys(b.type).length>0&&Object.keys(b.properties).length>0){let T=b.properties,C=b.layer;T.DEPTH&&T.DEPTH,b.type,C.id}})},resizeMap(){this.map.resize()},async geoCodeReverse(e){geocoding({accessToken:mapboxgl.accessToken}).reverseGeocode({query:[e.pointLng,e.pointLat]}).send().then(function(n){if(n&&n.body&&n.body.features){e.address=n.body.features[0].place_name;let o=n.body.features[0].context;for(let u of o){let f=u.id;switch(f.substring(0,f.indexOf("."))){case"neighborhood":e.neighborhood=u.text;break;case"postcode":e.postcode=u.text;break;case"locality":e.locality=u.text;break;case"place":e.place=u.text;break;case"district":e.district=u.text;break;case"region":e.region=u.text;break;case"country":e.country=u.text;break}}}})}}},_hoisted_1$3={id:"map"},_hoisted_2$3={class:"row no-wrap q-pa-md"},_hoisted_3$3={class:"column"},_hoisted_4$3=createBaseVNode("u",null,[createBaseVNode("b",null,"Enable Layers")],-1);function _sfc_render$3(e,t,n,o,u,f){return openBlock(),createElementBlock("div",_hoisted_1$3,[createVNode(QToolbar,{id:"mb-tbar",class:"bg-primary text-white q-pa-none q-ma-none"},{default:withCtx(()=>[createVNode(QBtn,{color:"info",label:"Map Settings"},{default:withCtx(()=>[createVNode(QMenu,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,[_hoisted_4$3,createVNode(QOptionGroup,{dense:"",color:"green","checked-icon":"check","unchecked-icon":"clear",options:o.layer_type,type:"toggle",modelValue:o.layers,"onUpdate:modelValue":[t[0]||(t[0]=g=>o.layers=g),f.changeLayers]},null,8,["options","modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1}),createTextVNode(" \xA0 \xA0 \xA0 "+toDisplayString(this.tileInfoString),1)]),_:1})])}var MapboxMapViewer=_export_sfc(_sfc_main$3,[["render",_sfc_render$3]]);const useRatioProps={ratio:[String,Number]};function useRatio(e,t){return computed(()=>{const n=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(n)!==!0&&n>0?{paddingBottom:`${100/n}%`}:null})}const defaultRatio=16/9;var QImg=createComponent({name:"QImg",props:{...useRatioProps,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:defaultRatio},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:n}){const o=ref(e.initialRatio),u=useRatio(e,o);let f=null,g=!1;const a=[ref(null),ref(ce())],b=ref(0),T=ref(!1),C=ref(!1),L=computed(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),N=computed(()=>({width:e.width,height:e.height})),F=computed(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),H=computed(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));watch(()=>se(),X);function se(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function ce(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function X(ve){f!==null&&(clearTimeout(f),f=null),C.value=!1,ve===null?(T.value=!1,a[b.value^1].value=ce()):T.value=!0,a[b.value].value=ve}function ye({target:ve}){g!==!0&&(f!==null&&(clearTimeout(f),f=null),o.value=ve.naturalHeight===0?.5:ve.naturalWidth/ve.naturalHeight,oe(ve,1))}function oe(ve,be){g===!0||be===1e3||(ve.complete===!0?le(ve):f=setTimeout(()=>{f=null,oe(ve,be+1)},50))}function le(ve){g!==!0&&(b.value=b.value^1,a[b.value].value=null,T.value=!1,C.value=!1,n("load",ve.currentSrc||ve.src))}function ue(ve){f!==null&&(clearTimeout(f),f=null),T.value=!1,C.value=!0,a[b.value].value=null,a[b.value^1].value=ce(),n("error",ve)}function Re(ve){const be=a[ve].value,de={key:"img_"+ve,class:F.value,style:H.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...be};return b.value===ve?(de.class+=" q-img__image--waiting",Object.assign(de,{onLoad:ye,onError:ue})):de.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+ve},h("img",de))}function ze(){return T.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},hSlot(t[C.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[h(QSpinner,{color:e.spinnerColor,size:e.spinnerSize})])}return X(se()),onBeforeUnmount(()=>{g=!0,f!==null&&(clearTimeout(f),f=null)}),()=>{const ve=[];return u.value!==null&&ve.push(h("div",{key:"filler",style:u.value})),C.value!==!0&&(a[0].value!==null&&ve.push(Re(0)),a[1].value!==null&&ve.push(Re(1))),ve.push(h(Transition,{name:"q-transition--fade"},ze)),h("div",{class:L.value,style:N.value,role:"img","aria-label":e.alt},ve)}}}),QField=createComponent({name:"QField",inheritAttrs:!1,props:useFieldProps,emits:useFieldEmits,setup(){return useField(useFieldState())}}),QItemLabel=createComponent({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(e,{slots:t}){const n=computed(()=>parseInt(e.lines,10)),o=computed(()=>"q-item__label"+(e.overline===!0?" q-item__label--overline text-overline":"")+(e.caption===!0?" q-item__label--caption text-caption":"")+(e.header===!0?" q-item__label--header":"")+(n.value===1?" ellipsis":"")),u=computed(()=>e.lines!==void 0&&n.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":n.value}:null);return()=>h("div",{style:u.value,class:o.value},hSlot(t.default))}});const defaultSizes={xs:8,sm:10,md:14,lg:20,xl:24};var QChip=createComponent({name:"QChip",props:{...useDarkProps,...useSizeProps,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:n}){const{proxy:{$q:o}}=getCurrentInstance(),u=useDark(e,o),f=useSize(e,defaultSizes),g=computed(()=>e.selected===!0||e.icon!==void 0),a=computed(()=>e.selected===!0?e.iconSelected||o.iconSet.chip.selected:e.icon),b=computed(()=>e.iconRemove||o.iconSet.chip.remove),T=computed(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),C=computed(()=>{const ce=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(ce?` text-${ce} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(T.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(u.value===!0?" q-chip--dark q-dark":"")}),L=computed(()=>{const ce=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},X={...ce,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||o.lang.label.remove};return{chip:ce,remove:X}});function N(ce){ce.keyCode===13&&F(ce)}function F(ce){e.disable||(n("update:selected",!e.selected),n("click",ce))}function H(ce){(ce.keyCode===void 0||ce.keyCode===13)&&(stopAndPrevent(ce),e.disable===!1&&(n("update:modelValue",!1),n("remove")))}function se(){const ce=[];T.value===!0&&ce.push(h("div",{class:"q-focus-helper"})),g.value===!0&&ce.push(h(QIcon,{class:"q-chip__icon q-chip__icon--left",name:a.value}));const X=e.label!==void 0?[h("div",{class:"ellipsis"},[e.label])]:void 0;return ce.push(h("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},hMergeSlotSafely(t.default,X))),e.iconRight&&ce.push(h(QIcon,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&ce.push(h(QIcon,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:b.value,...L.value.remove,onClick:H,onKeyup:H})),ce}return()=>{if(e.modelValue===!1)return;const ce={class:C.value,style:f.value};return T.value===!0&&Object.assign(ce,L.value.chip,{onClick:F,onKeyup:N}),hDir("div",ce,se(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Ripple,e.ripple]])}}}),QItem=createComponent({name:"QItem",props:{...useDarkProps,...useRouterLinkProps,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:t,emit:n}){const{proxy:{$q:o}}=getCurrentInstance(),u=useDark(e,o),{hasLink:f,linkAttrs:g,linkClass:a,linkTag:b,navigateOnClick:T}=useRouterLink(),C=ref(null),L=ref(null),N=computed(()=>e.clickable===!0||f.value===!0||e.tag==="label"),F=computed(()=>e.disable!==!0&&N.value===!0),H=computed(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(u.value===!0?" q-item--dark":"")+(f.value===!0&&e.active===null?a.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(F.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),se=computed(()=>{if(e.insetLevel===void 0)return null;const oe=o.lang.rtl===!0?"Right":"Left";return{["padding"+oe]:16+e.insetLevel*56+"px"}});function ce(oe){F.value===!0&&(L.value!==null&&(oe.qKeyEvent!==!0&&document.activeElement===C.value?L.value.focus():document.activeElement===L.value&&C.value.focus()),T(oe))}function X(oe){if(F.value===!0&&isKeyCode(oe,13)===!0){stopAndPrevent(oe),oe.qKeyEvent=!0;const le=new MouseEvent("click",oe);le.qKeyEvent=!0,C.value.dispatchEvent(le)}n("keyup",oe)}function ye(){const oe=hUniqueSlot(t.default,[]);return F.value===!0&&oe.unshift(h("div",{class:"q-focus-helper",tabindex:-1,ref:L})),oe}return()=>{const oe={ref:C,class:H.value,style:se.value,role:"listitem",onClick:ce,onKeyup:X};return F.value===!0?(oe.tabindex=e.tabindex||"0",Object.assign(oe,g.value)):N.value===!0&&(oe["aria-disabled"]="true"),h(b.value,oe,ye())}}}),QItemSection=createComponent({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:t}){const n=computed(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>h("div",{class:n.value},hSlot(t.default))}});const aggBucketSize=1e3,scrollToEdges=["start","center","end","start-force","center-force","end-force"],filterProto=Array.prototype.filter,setOverflowAnchor=window.getComputedStyle(document.body).overflowAnchor===void 0?noop:function(e,t){e!==null&&(cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;const n=e.children||[];filterProto.call(n,u=>u.dataset&&u.dataset.qVsAnchor!==void 0).forEach(u=>{delete u.dataset.qVsAnchor});const o=n[t];o&&o.dataset&&(o.dataset.qVsAnchor="")}))};function sumFn(e,t){return e+t}function getScrollDetails(e,t,n,o,u,f,g,a){const b=e===window?document.scrollingElement||document.documentElement:e,T=u===!0?"offsetWidth":"offsetHeight",C={scrollStart:0,scrollViewSize:-g-a,scrollMaxSize:0,offsetStart:-g,offsetEnd:-a};if(u===!0?(e===window?(C.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,C.scrollViewSize+=document.documentElement.clientWidth):(C.scrollStart=b.scrollLeft,C.scrollViewSize+=b.clientWidth),C.scrollMaxSize=b.scrollWidth,f===!0&&(C.scrollStart=(rtlHasScrollBug===!0?C.scrollMaxSize-C.scrollViewSize:0)-C.scrollStart)):(e===window?(C.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,C.scrollViewSize+=document.documentElement.clientHeight):(C.scrollStart=b.scrollTop,C.scrollViewSize+=b.clientHeight),C.scrollMaxSize=b.scrollHeight),n!==null)for(let L=n.previousElementSibling;L!==null;L=L.previousElementSibling)L.classList.contains("q-virtual-scroll--skip")===!1&&(C.offsetStart+=L[T]);if(o!==null)for(let L=o.nextElementSibling;L!==null;L=L.nextElementSibling)L.classList.contains("q-virtual-scroll--skip")===!1&&(C.offsetEnd+=L[T]);if(t!==e){const L=b.getBoundingClientRect(),N=t.getBoundingClientRect();u===!0?(C.offsetStart+=N.left-L.left,C.offsetEnd-=N.width):(C.offsetStart+=N.top-L.top,C.offsetEnd-=N.height),e!==window&&(C.offsetStart+=C.scrollStart),C.offsetEnd+=C.scrollMaxSize-C.offsetStart}return C}function setScroll(e,t,n,o){t==="end"&&(t=(e===window?document.body:e)[n===!0?"scrollWidth":"scrollHeight"]),e===window?n===!0?(o===!0&&(t=(rtlHasScrollBug===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-t),window.scrollTo(t,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,t):n===!0?(o===!0&&(t=(rtlHasScrollBug===!0?e.scrollWidth-e.offsetWidth:0)-t),e.scrollLeft=t):e.scrollTop=t}function sumSize(e,t,n,o){if(n>=o)return 0;const u=t.length,f=Math.floor(n/aggBucketSize),g=Math.floor((o-1)/aggBucketSize)+1;let a=e.slice(f,g).reduce(sumFn,0);return n%aggBucketSize!==0&&(a-=t.slice(f*aggBucketSize,n).reduce(sumFn,0)),o%aggBucketSize!==0&&o!==u&&(a-=t.slice(o,g*aggBucketSize).reduce(sumFn,0)),a}const commonVirtScrollProps={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},useVirtualScrollProps={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...commonVirtScrollProps};function useVirtualScroll({virtualScrollLength:e,getVirtualScrollTarget:t,getVirtualScrollEl:n,virtualScrollItemSizeComputed:o}){const u=getCurrentInstance(),{props:f,emit:g,proxy:a}=u,{$q:b}=a;let T,C,L,N=[],F;const H=ref(0),se=ref(0),ce=ref({}),X=ref(null),ye=ref(null),oe=ref(null),le=ref({from:0,to:0}),ue=computed(()=>f.tableColspan!==void 0?f.tableColspan:100);o===void 0&&(o=computed(()=>f.virtualScrollItemSize));const Re=computed(()=>o.value+";"+f.virtualScrollHorizontal),ze=computed(()=>Re.value+";"+f.virtualScrollSliceRatioBefore+";"+f.virtualScrollSliceRatioAfter);watch(ze,()=>{Lr()}),watch(Re,ve);function ve(){xt(C,!0)}function be(Kt){xt(Kt===void 0?C:Kt)}function de(Kt,mr){const Yt=t();if(Yt==null||Yt.nodeType===8)return;const er=getScrollDetails(Yt,n(),X.value,ye.value,f.virtualScrollHorizontal,b.lang.rtl,f.virtualScrollStickySizeStart,f.virtualScrollStickySizeEnd);L!==er.scrollViewSize&&Lr(er.scrollViewSize),Ge(Yt,er,Math.min(e.value-1,Math.max(0,parseInt(Kt,10)||0)),0,scrollToEdges.indexOf(mr)>-1?mr:C>-1&&Kt>C?"end":"start")}function Te(){const Kt=t();if(Kt==null||Kt.nodeType===8)return;const mr=getScrollDetails(Kt,n(),X.value,ye.value,f.virtualScrollHorizontal,b.lang.rtl,f.virtualScrollStickySizeStart,f.virtualScrollStickySizeEnd),Yt=e.value-1,er=mr.scrollMaxSize-mr.offsetStart-mr.offsetEnd-se.value;if(T===mr.scrollStart)return;if(mr.scrollMaxSize<=0){Ge(Kt,mr,0,0);return}L!==mr.scrollViewSize&&Lr(mr.scrollViewSize),Ke(le.value.from);const lr=Math.floor(mr.scrollMaxSize-Math.max(mr.scrollViewSize,mr.offsetEnd)-Math.min(F[Yt],mr.scrollViewSize/2));if(lr>0&&Math.ceil(mr.scrollStart)>=lr){Ge(Kt,mr,Yt,mr.scrollMaxSize-mr.offsetEnd-N.reduce(sumFn,0));return}let ar=0,dr=mr.scrollStart-mr.offsetStart,ii=dr;if(dr<=er&&dr+mr.scrollViewSize>=H.value)dr-=H.value,ar=le.value.from,ii=dr;else for(let nr=0;dr>=N[nr]&&ar<Yt;nr++)dr-=N[nr],ar+=aggBucketSize;for(;dr>0&&ar<Yt;)dr-=F[ar],dr>-mr.scrollViewSize?(ar++,ii=dr):ii=F[ar]+dr;Ge(Kt,mr,ar,ii)}function Ge(Kt,mr,Yt,er,lr){const ar=typeof lr=="string"&&lr.indexOf("-force")>-1,dr=ar===!0?lr.replace("-force",""):lr,ii=dr!==void 0?dr:"start";let nr=Math.max(0,Yt-ce.value[ii]),at=nr+ce.value.total;at>e.value&&(at=e.value,nr=Math.max(0,at-ce.value.total)),T=mr.scrollStart;const bi=nr!==le.value.from||at!==le.value.to;if(bi===!1&&dr===void 0){Sr(Yt);return}const{activeElement:Br}=document,Xr=oe.value;bi===!0&&Xr!==null&&Xr!==Br&&Xr.contains(Br)===!0&&(Xr.addEventListener("focusout",St),setTimeout(()=>{Xr!==null&&Xr.removeEventListener("focusout",St)})),setOverflowAnchor(Xr,Yt-nr);const cr=dr!==void 0?F.slice(nr,Yt).reduce(sumFn,0):0;if(bi===!0){const ur=at>=le.value.from&&nr<=le.value.to?le.value.to:at;le.value={from:nr,to:ur},H.value=sumSize(N,F,0,nr),se.value=sumSize(N,F,at,e.value),requestAnimationFrame(()=>{le.value.to!==at&&T===mr.scrollStart&&(le.value={from:le.value.from,to:at},se.value=sumSize(N,F,at,e.value))})}requestAnimationFrame(()=>{if(T!==mr.scrollStart)return;bi===!0&&Ke(nr);const ur=F.slice(nr,Yt).reduce(sumFn,0),yi=ur+mr.offsetStart+H.value,Or=yi+F[Yt];let mi=yi+er;if(dr!==void 0){const qt=ur-cr,Er=mr.scrollStart+qt;mi=ar!==!0&&Er<yi&&Or<Er+mr.scrollViewSize?Er:dr==="end"?Or-mr.scrollViewSize:yi-(dr==="start"?0:Math.round((mr.scrollViewSize-F[Yt])/2))}T=mi,setScroll(Kt,mi,f.virtualScrollHorizontal,b.lang.rtl),Sr(Yt)})}function Ke(Kt){const mr=oe.value;if(mr){const Yt=filterProto.call(mr.children,nr=>nr.classList&&nr.classList.contains("q-virtual-scroll--skip")===!1),er=Yt.length,lr=f.virtualScrollHorizontal===!0?nr=>nr.getBoundingClientRect().width:nr=>nr.offsetHeight;let ar=Kt,dr,ii;for(let nr=0;nr<er;){for(dr=lr(Yt[nr]),nr++;nr<er&&Yt[nr].classList.contains("q-virtual-scroll--with-prev")===!0;)dr+=lr(Yt[nr]),nr++;ii=dr-F[ar],ii!==0&&(F[ar]+=ii,N[Math.floor(ar/aggBucketSize)]+=ii),ar++}}}function St(){oe.value!==null&&oe.value!==void 0&&oe.value.focus()}function xt(Kt,mr){const Yt=1*o.value;(mr===!0||Array.isArray(F)===!1)&&(F=[]);const er=F.length;F.length=e.value;for(let ar=e.value-1;ar>=er;ar--)F[ar]=Yt;const lr=Math.floor((e.value-1)/aggBucketSize);N=[];for(let ar=0;ar<=lr;ar++){let dr=0;const ii=Math.min((ar+1)*aggBucketSize,e.value);for(let nr=ar*aggBucketSize;nr<ii;nr++)dr+=F[nr];N.push(dr)}C=-1,T=void 0,H.value=sumSize(N,F,0,le.value.from),se.value=sumSize(N,F,le.value.to,e.value),Kt>=0?(Ke(le.value.from),nextTick(()=>{de(Kt)})):Gr()}function Lr(Kt){if(Kt===void 0&&typeof window<"u"){const dr=t();dr!=null&&dr.nodeType!==8&&(Kt=getScrollDetails(dr,n(),X.value,ye.value,f.virtualScrollHorizontal,b.lang.rtl,f.virtualScrollStickySizeStart,f.virtualScrollStickySizeEnd).scrollViewSize)}L=Kt;const mr=parseFloat(f.virtualScrollSliceRatioBefore)||0,Yt=parseFloat(f.virtualScrollSliceRatioAfter)||0,er=1+mr+Yt,lr=Kt===void 0||Kt<=0?1:Math.ceil(Kt/o.value),ar=Math.max(1,lr,Math.ceil((f.virtualScrollSliceSize>0?f.virtualScrollSliceSize:10)/er));ce.value={total:Math.ceil(ar*er),start:Math.ceil(ar*mr),center:Math.ceil(ar*(.5+mr)),end:Math.ceil(ar*(1+mr)),view:lr}}function Nr(Kt,mr){const Yt=f.virtualScrollHorizontal===!0?"width":"height",er={["--q-virtual-scroll-item-"+Yt]:o.value+"px"};return[Kt==="tbody"?h(Kt,{class:"q-virtual-scroll__padding",key:"before",ref:X},[h("tr",[h("td",{style:{[Yt]:`${H.value}px`,...er},colspan:ue.value})])]):h(Kt,{class:"q-virtual-scroll__padding",key:"before",ref:X,style:{[Yt]:`${H.value}px`,...er}}),h(Kt,{class:"q-virtual-scroll__content",key:"content",ref:oe,tabindex:-1},mr.flat()),Kt==="tbody"?h(Kt,{class:"q-virtual-scroll__padding",key:"after",ref:ye},[h("tr",[h("td",{style:{[Yt]:`${se.value}px`,...er},colspan:ue.value})])]):h(Kt,{class:"q-virtual-scroll__padding",key:"after",ref:ye,style:{[Yt]:`${se.value}px`,...er}})]}function Sr(Kt){C!==Kt&&(f.onVirtualScroll!==void 0&&g("virtualScroll",{index:Kt,from:le.value.from,to:le.value.to-1,direction:Kt<C?"decrease":"increase",ref:a}),C=Kt)}Lr();const Gr=debounce$2(Te,b.platform.is.ios===!0?120:35);onBeforeMount(()=>{Lr()});let _t=!1;return onDeactivated(()=>{_t=!0}),onActivated(()=>{if(_t!==!0)return;const Kt=t();T!==void 0&&Kt!==void 0&&Kt!==null&&Kt.nodeType!==8?setScroll(Kt,T,f.virtualScrollHorizontal,b.lang.rtl):de(C)}),onBeforeUnmount(()=>{Gr.cancel()}),Object.assign(a,{scrollTo:de,reset:ve,refresh:be}),{virtualScrollSliceRange:le,virtualScrollSliceSizeComputed:ce,setVirtualScrollSize:Lr,onVirtualScrollEvt:Gr,localResetVirtualScroll:xt,padVirtualScroll:Nr,scrollTo:de,reset:ve,refresh:be}}const validateNewValueMode=e=>["add","add-unique","toggle"].includes(e),reEscapeList=".*+?^${}()|[]\\",fieldPropsList=Object.keys(useFieldProps);var QSelect=createComponent({name:"QSelect",inheritAttrs:!1,props:{...useVirtualScrollProps,...useFormProps,...useFieldProps,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:validateNewValueMode},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...useFieldEmits,"add","remove","inputValue","newValue","keyup","keypress","keydown","filterAbort"],setup(e,{slots:t,emit:n}){const{proxy:o}=getCurrentInstance(),{$q:u}=o,f=ref(!1),g=ref(!1),a=ref(-1),b=ref(""),T=ref(!1),C=ref(!1);let L=null,N,F,H,se=null,ce,X,ye,oe;const le=ref(null),ue=ref(null),Re=ref(null),ze=ref(null),ve=ref(null),be=useFormInputNameAttr(e),de=useKeyComposition(Pn),Te=computed(()=>Array.isArray(e.options)?e.options.length:0),Ge=computed(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:Ke,virtualScrollSliceSizeComputed:St,localResetVirtualScroll:xt,padVirtualScroll:Lr,onVirtualScrollEvt:Nr,scrollTo:Sr,setVirtualScrollSize:Gr}=useVirtualScroll({virtualScrollLength:Te,getVirtualScrollTarget:bn,getVirtualScrollEl:po,virtualScrollItemSizeComputed:Ge}),_t=useFieldState(),Kt=computed(()=>{const et=e.mapOptions===!0&&e.multiple!==!0,tr=e.modelValue!==void 0&&(e.modelValue!==null||et===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const gr=e.mapOptions===!0&&N!==void 0?N:[],Jr=tr.map(Ji=>ui(Ji,gr));return e.modelValue===null&&et===!0?Jr.filter(Ji=>Ji!==null):Jr}return tr}),mr=computed(()=>{const et={};return fieldPropsList.forEach(tr=>{const gr=e[tr];gr!==void 0&&(et[tr]=gr)}),et}),Yt=computed(()=>e.optionsDark===null?_t.isDark.value:e.optionsDark),er=computed(()=>fieldValueIsFilled(Kt.value)),lr=computed(()=>{let et="q-field__input q-placeholder col";return e.hideSelected===!0||Kt.value.length===0?[et,e.inputClass]:(et+=" q-field__input--padding",e.inputClass===void 0?et:[et,e.inputClass])}),ar=computed(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),dr=computed(()=>Te.value===0),ii=computed(()=>Kt.value.map(et=>Gt.value(et)).join(", ")),nr=computed(()=>e.displayValue!==void 0?e.displayValue:ii.value),at=computed(()=>e.optionsHtml===!0?()=>!0:et=>et!=null&&et.html===!0),bi=computed(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||Kt.value.some(at.value))),Br=computed(()=>_t.focused.value===!0?e.tabindex:-1),Xr=computed(()=>{const et={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":f.value===!0?"true":"false","aria-controls":`${_t.targetUid.value}_lb`};return a.value>=0&&(et["aria-activedescendant"]=`${_t.targetUid.value}_${a.value}`),et}),cr=computed(()=>({id:`${_t.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),ur=computed(()=>Kt.value.map((et,tr)=>({index:tr,opt:et,html:at.value(et),selected:!0,removeAtIndex:xr,toggleOption:zr,tabindex:Br.value}))),yi=computed(()=>{if(Te.value===0)return[];const{from:et,to:tr}=Ke.value;return e.options.slice(et,tr).map((gr,Jr)=>{const Ji=Jt.value(gr)===!0,Gi=et+Jr,Xi={clickable:!0,active:!1,activeClass:qt.value,manualFocus:!0,focused:!1,disable:Ji,tabindex:-1,dense:e.optionsDense,dark:Yt.value,role:"option",id:`${_t.targetUid.value}_${Gi}`,onClick:()=>{zr(gr)}};return Ji!==!0&&(Ti(gr)===!0&&(Xi.active=!0),a.value===Gi&&(Xi.focused=!0),Xi["aria-selected"]=Xi.active===!0?"true":"false",u.platform.is.desktop===!0&&(Xi.onMousemove=()=>{f.value===!0&&br(Gi)})),{index:Gi,opt:gr,html:at.value(gr),label:Gt.value(gr),selected:Xi.active,focused:Xi.focused,toggleOption:zr,setOptionIndex:br,itemProps:Xi}})}),Or=computed(()=>e.dropdownIcon!==void 0?e.dropdownIcon:u.iconSet.arrow.dropdown),mi=computed(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),qt=computed(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),Er=computed(()=>di(e.optionValue,"value")),Gt=computed(()=>di(e.optionLabel,"label")),Jt=computed(()=>di(e.optionDisable,"disable")),st=computed(()=>Kt.value.map(et=>Er.value(et))),Pr=computed(()=>{const et={onInput:Pn,onChange:de,onKeydown:fo,onKeyup:oi,onKeypress:En,onFocus:Yi,onClick(tr){F===!0&&stop(tr)}};return et.onCompositionstart=et.onCompositionupdate=et.onCompositionend=de,et});watch(Kt,et=>{N=et,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&_t.innerLoading.value!==!0&&(g.value!==!0&&f.value!==!0||er.value!==!0)&&(H!==!0&&Ar(),(g.value===!0||f.value===!0)&&ut(""))},{immediate:!0}),watch(()=>e.fillInput,Ar),watch(f,Qt),watch(Te,Kr);function ht(et){return e.emitValue===!0?Er.value(et):et}function Nt(et){if(et>-1&&et<Kt.value.length)if(e.multiple===!0){const tr=e.modelValue.slice();n("remove",{index:et,value:tr.splice(et,1)[0]}),n("update:modelValue",tr)}else n("update:modelValue",null)}function xr(et){Nt(et),_t.focus()}function Qr(et,tr){const gr=ht(et);if(e.multiple!==!0){e.fillInput===!0&&Ie(Gt.value(et),!0,!0),n("update:modelValue",gr);return}if(Kt.value.length===0){n("add",{index:0,value:gr}),n("update:modelValue",e.multiple===!0?[gr]:gr);return}if(tr===!0&&Ti(et)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const Jr=e.modelValue.slice();n("add",{index:Jr.length,value:gr}),Jr.push(gr),n("update:modelValue",Jr)}function zr(et,tr){if(_t.editable.value!==!0||et===void 0||Jt.value(et)===!0)return;const gr=Er.value(et);if(e.multiple!==!0){tr!==!0&&(Ie(e.fillInput===!0?Gt.value(et):"",!0,!0),$t()),ue.value!==null&&ue.value.focus(),(Kt.value.length===0||isDeepEqual(Er.value(Kt.value[0]),gr)!==!0)&&n("update:modelValue",e.emitValue===!0?gr:et);return}if((F!==!0||T.value===!0)&&_t.focus(),Yi(),Kt.value.length===0){const Gi=e.emitValue===!0?gr:et;n("add",{index:0,value:Gi}),n("update:modelValue",e.multiple===!0?[Gi]:Gi);return}const Jr=e.modelValue.slice(),Ji=st.value.findIndex(Gi=>isDeepEqual(Gi,gr));if(Ji>-1)n("remove",{index:Ji,value:Jr.splice(Ji,1)[0]});else{if(e.maxValues!==void 0&&Jr.length>=e.maxValues)return;const Gi=e.emitValue===!0?gr:et;n("add",{index:Jr.length,value:Gi}),Jr.push(Gi)}n("update:modelValue",Jr)}function br(et){if(u.platform.is.desktop!==!0)return;const tr=et>-1&&et<Te.value?et:-1;a.value!==tr&&(a.value=tr)}function xi(et=1,tr){if(f.value===!0){let gr=a.value;do gr=normalizeToInterval(gr+et,-1,Te.value-1);while(gr!==-1&&gr!==a.value&&Jt.value(e.options[gr])===!0);a.value!==gr&&(br(gr),Sr(gr),tr!==!0&&e.useInput===!0&&e.fillInput===!0&&hn(gr>=0?Gt.value(e.options[gr]):ce))}}function ui(et,tr){const gr=Jr=>isDeepEqual(Er.value(Jr),et);return e.options.find(gr)||tr.find(gr)||et}function di(et,tr){const gr=et!==void 0?et:tr;return typeof gr=="function"?gr:Jr=>Jr!==null&&typeof Jr=="object"&&gr in Jr?Jr[gr]:Jr}function Ti(et){const tr=Er.value(et);return st.value.find(gr=>isDeepEqual(gr,tr))!==void 0}function Yi(et){e.useInput===!0&&ue.value!==null&&(et===void 0||ue.value===et.target&&et.target.value===ii.value)&&ue.value.select()}function Zi(et){isKeyCode(et,27)===!0&&f.value===!0&&(stop(et),$t(),Ar()),n("keyup",et)}function oi(et){const{value:tr}=et.target;if(et.keyCode!==void 0){Zi(et);return}if(et.target.value="",L!==null&&(clearTimeout(L),L=null),Ar(),typeof tr=="string"&&tr.length>0){const gr=tr.toLocaleLowerCase(),Jr=Gi=>{const Xi=e.options.find(Ft=>Gi.value(Ft).toLocaleLowerCase()===gr);return Xi===void 0?!1:(Kt.value.indexOf(Xi)===-1?zr(Xi):$t(),!0)},Ji=Gi=>{Jr(Er)!==!0&&(Jr(Gt)===!0||Gi===!0||ut(tr,!0,()=>Ji(!0)))};Ji()}else _t.clearValue(et)}function En(et){n("keypress",et)}function fo(et){if(n("keydown",et),shouldIgnoreKey(et)===!0)return;const tr=b.value.length>0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),gr=et.shiftKey!==!0&&e.multiple!==!0&&(a.value>-1||tr===!0);if(et.keyCode===27){prevent(et);return}if(et.keyCode===9&&gr===!1){Je();return}if(et.target===void 0||et.target.id!==_t.targetUid.value)return;if(et.keyCode===40&&_t.innerLoading.value!==!0&&f.value===!1){stopAndPrevent(et),vt();return}if(et.keyCode===8&&e.hideSelected!==!0&&b.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?Nt(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&n("update:modelValue",null);return}(et.keyCode===35||et.keyCode===36)&&(typeof b.value!="string"||b.value.length===0)&&(stopAndPrevent(et),a.value=-1,xi(et.keyCode===36?1:-1,e.multiple)),(et.keyCode===33||et.keyCode===34)&&St.value!==void 0&&(stopAndPrevent(et),a.value=Math.max(-1,Math.min(Te.value,a.value+(et.keyCode===33?-1:1)*St.value.view)),xi(et.keyCode===33?1:-1,e.multiple)),(et.keyCode===38||et.keyCode===40)&&(stopAndPrevent(et),xi(et.keyCode===38?-1:1,e.multiple));const Jr=Te.value;if((ye===void 0||oe<Date.now())&&(ye=""),Jr>0&&e.useInput!==!0&&et.key!==void 0&&et.key.length===1&&et.altKey===!1&&et.ctrlKey===!1&&et.metaKey===!1&&(et.keyCode!==32||ye.length>0)){f.value!==!0&&vt(et);const Ji=et.key.toLocaleLowerCase(),Gi=ye.length===1&&ye[0]===Ji;oe=Date.now()+1500,Gi===!1&&(stopAndPrevent(et),ye+=Ji);const Xi=new RegExp("^"+ye.split("").map(ao=>reEscapeList.indexOf(ao)>-1?"\\"+ao:ao).join(".*"),"i");let Ft=a.value;if(Gi===!0||Ft<0||Xi.test(Gt.value(e.options[Ft]))!==!0)do Ft=normalizeToInterval(Ft+1,-1,Jr-1);while(Ft!==a.value&&(Jt.value(e.options[Ft])===!0||Xi.test(Gt.value(e.options[Ft]))!==!0));a.value!==Ft&&nextTick(()=>{br(Ft),Sr(Ft),Ft>=0&&e.useInput===!0&&e.fillInput===!0&&hn(Gt.value(e.options[Ft]))});return}if(!(et.keyCode!==13&&(et.keyCode!==32||e.useInput===!0||ye!=="")&&(et.keyCode!==9||gr===!1))){if(et.keyCode!==9&&stopAndPrevent(et),a.value>-1&&a.value<Jr){zr(e.options[a.value]);return}if(tr===!0){const Ji=(Gi,Xi)=>{if(Xi){if(validateNewValueMode(Xi)!==!0)return}else Xi=e.newValueMode;if(Gi==null)return;Ie("",e.multiple!==!0,!0),(Xi==="toggle"?zr:Qr)(Gi,Xi==="add-unique"),e.multiple!==!0&&(ue.value!==null&&ue.value.focus(),$t())};if(e.onNewValue!==void 0?n("newValue",b.value,Ji):Ji(b.value),e.multiple!==!0)return}f.value===!0?Je():_t.innerLoading.value!==!0&&vt()}}function po(){return F===!0?ve.value:Re.value!==null&&Re.value.contentEl!==null?Re.value.contentEl:void 0}function bn(){return po()}function oo(){return e.hideSelected===!0?[]:t["selected-item"]!==void 0?ur.value.map(et=>t["selected-item"](et)).slice():t.selected!==void 0?[].concat(t.selected()):e.useChips===!0?ur.value.map((et,tr)=>h(QChip,{key:"option-"+tr,removable:_t.editable.value===!0&&Jt.value(et.opt)!==!0,dense:!0,textColor:e.color,tabindex:Br.value,onRemove(){et.removeAtIndex(tr)}},()=>h("span",{class:"ellipsis",[et.html===!0?"innerHTML":"textContent"]:Gt.value(et.opt)}))):[h("span",{[bi.value===!0?"innerHTML":"textContent"]:nr.value})]}function Vi(){if(dr.value===!0)return t["no-option"]!==void 0?t["no-option"]({inputValue:b.value}):void 0;const et=t.option!==void 0?t.option:gr=>h(QItem,{key:gr.index,...gr.itemProps},()=>h(QItemSection,()=>h(QItemLabel,()=>h("span",{[gr.html===!0?"innerHTML":"textContent"]:gr.label}))));let tr=Lr("div",yi.value.map(et));return t["before-options"]!==void 0&&(tr=t["before-options"]().concat(tr)),hMergeSlot(t["after-options"],tr)}function Xn(et,tr){const gr=tr===!0?{...Xr.value,..._t.splitAttrs.attributes.value}:void 0,Jr={ref:tr===!0?ue:void 0,key:"i_t",class:lr.value,style:e.inputStyle,value:b.value!==void 0?b.value:"",type:"search",...gr,id:tr===!0?_t.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":et===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...Pr.value};return et!==!0&&F===!0&&(Array.isArray(Jr.class)===!0?Jr.class=[...Jr.class,"no-pointer-events"]:Jr.class+=" no-pointer-events"),h("input",Jr)}function Pn(et){L!==null&&(clearTimeout(L),L=null),!(et&&et.target&&et.target.qComposing===!0)&&(hn(et.target.value||""),H=!0,ce=b.value,_t.focused.value!==!0&&(F!==!0||T.value===!0)&&_t.focus(),e.onFilter!==void 0&&(L=setTimeout(()=>{L=null,ut(b.value)},e.inputDebounce)))}function hn(et){b.value!==et&&(b.value=et,n("inputValue",et))}function Ie(et,tr,gr){H=gr!==!0,e.useInput===!0&&(hn(et),(tr===!0||gr!==!0)&&(ce=et),tr!==!0&&ut(et))}function ut(et,tr,gr){if(e.onFilter===void 0||tr!==!0&&_t.focused.value!==!0)return;_t.innerLoading.value===!0?n("filterAbort"):(_t.innerLoading.value=!0,C.value=!0),et!==""&&e.multiple!==!0&&Kt.value.length>0&&H!==!0&&et===Gt.value(Kt.value[0])&&(et="");const Jr=setTimeout(()=>{f.value===!0&&(f.value=!1)},10);se!==null&&clearTimeout(se),se=Jr,n("filter",et,(Ji,Gi)=>{(tr===!0||_t.focused.value===!0)&&se===Jr&&(clearTimeout(se),typeof Ji=="function"&&Ji(),C.value=!1,nextTick(()=>{_t.innerLoading.value=!1,_t.editable.value===!0&&(tr===!0?f.value===!0&&$t():f.value===!0?Qt(!0):f.value=!0),typeof Gi=="function"&&nextTick(()=>{Gi(o)}),typeof gr=="function"&&nextTick(()=>{gr(o)})}))},()=>{_t.focused.value===!0&&se===Jr&&(clearTimeout(se),_t.innerLoading.value=!1,C.value=!1),f.value===!0&&(f.value=!1)})}function Bt(){return h(QMenu,{ref:Re,class:ar.value,style:e.popupContentStyle,modelValue:f.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&dr.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:Yt.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:mi.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...cr.value,onScrollPassive:Nr,onBeforeShow:Wr,onBeforeHide:_e,onShow:ae},Vi)}function _e(et){ni(et),Je()}function ae(){Gr()}function fe(et){stop(et),ue.value!==null&&ue.value.focus(),T.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function ke(et){stop(et),nextTick(()=>{T.value=!1})}function Fe(){const et=[h(QField,{class:`col-auto ${_t.fieldClass.value}`,...mr.value,for:_t.targetUid.value,dark:Yt.value,square:!0,loading:C.value,itemAligned:!1,filled:!0,stackLabel:b.value.length>0,..._t.splitAttrs.listeners.value,onFocus:fe,onBlur:ke},{...t,rawControl:()=>_t.getControl(!0),before:void 0,after:void 0})];return f.value===!0&&et.push(h("div",{ref:ve,class:ar.value+" scroll",style:e.popupContentStyle,...cr.value,onClick:prevent,onScrollPassive:Nr},Vi())),h(QDialog,{ref:ze,modelValue:g.value,position:e.useInput===!0?"top":void 0,transitionShow:X,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:Wr,onBeforeHide:Ye,onHide:mt,onShow:yt},()=>h("div",{class:"q-select__dialog"+(Yt.value===!0?" q-select__dialog--dark q-dark":"")+(T.value===!0?" q-select__dialog--focused":"")},et))}function Ye(et){ni(et),ze.value!==null&&ze.value.__updateRefocusTarget(_t.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),_t.focused.value=!1}function mt(et){$t(),_t.focused.value===!1&&n("blur",et),Ar()}function yt(){const et=document.activeElement;(et===null||et.id!==_t.targetUid.value)&&ue.value!==null&&ue.value!==et&&ue.value.focus(),Gr()}function Je(){g.value!==!0&&(a.value=-1,f.value===!0&&(f.value=!1),_t.focused.value===!1&&(se!==null&&(clearTimeout(se),se=null),_t.innerLoading.value===!0&&(n("filterAbort"),_t.innerLoading.value=!1,C.value=!1)))}function vt(et){_t.editable.value===!0&&(F===!0?(_t.onControlFocusin(et),g.value=!0,nextTick(()=>{_t.focus()})):_t.focus(),e.onFilter!==void 0?ut(b.value):(dr.value!==!0||t["no-option"]!==void 0)&&(f.value=!0))}function $t(){g.value=!1,Je()}function Ar(){e.useInput===!0&&Ie(e.multiple!==!0&&e.fillInput===!0&&Kt.value.length>0&&Gt.value(Kt.value[0])||"",!0,!0)}function Qt(et){let tr=-1;if(et===!0){if(Kt.value.length>0){const gr=Er.value(Kt.value[0]);tr=e.options.findIndex(Jr=>isDeepEqual(Er.value(Jr),gr))}xt(tr)}br(tr)}function Kr(et,tr){f.value===!0&&_t.innerLoading.value===!1&&(xt(-1,!0),nextTick(()=>{f.value===!0&&_t.innerLoading.value===!1&&(et>tr?xt():Qt(!0))}))}function ri(){g.value===!1&&Re.value!==null&&Re.value.updatePosition()}function Wr(et){et!==void 0&&stop(et),n("popupShow",et),_t.hasPopupOpen=!0,_t.onControlFocusin(et)}function ni(et){et!==void 0&&stop(et),n("popupHide",et),_t.hasPopupOpen=!1,_t.onControlFocusout(et)}function Bi(){F=u.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?t["no-option"]!==void 0||e.onFilter!==void 0||dr.value===!1:!0),X=u.platform.is.ios===!0&&F===!0&&e.useInput===!0?"fade":e.transitionShow}return onBeforeUpdate(Bi),onUpdated(ri),Bi(),onBeforeUnmount(()=>{L!==null&&clearTimeout(L)}),Object.assign(o,{showPopup:vt,hidePopup:$t,removeAtIndex:Nt,add:Qr,toggleOption:zr,getOptionIndex:()=>a.value,setOptionIndex:br,moveOptionSelection:xi,filter:ut,updateMenuPosition:ri,updateInputValue:Ie,isOptionSelected:Ti,getEmittingOptionValue:ht,isOptionDisabled:(...et)=>Jt.value.apply(null,et)===!0,getOptionValue:(...et)=>Er.value.apply(null,et),getOptionLabel:(...et)=>Gt.value.apply(null,et)}),Object.assign(_t,{innerValue:Kt,fieldClass:computed(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:le,targetRef:ue,hasValue:er,showPopup:vt,floatingLabel:computed(()=>e.hideSelected!==!0&&er.value===!0||typeof b.value=="number"||b.value.length>0||fieldValueIsFilled(e.displayValue)),getControlChild:()=>{if(_t.editable.value!==!1&&(g.value===!0||dr.value!==!0||t["no-option"]!==void 0))return F===!0?Fe():Bt();_t.hasPopupOpen===!0&&(_t.hasPopupOpen=!1)},controlEvents:{onFocusin(et){_t.onControlFocusin(et)},onFocusout(et){_t.onControlFocusout(et,()=>{Ar(),Je()})},onClick(et){if(prevent(et),F!==!0&&f.value===!0){Je(),ue.value!==null&&ue.value.focus();return}vt(et)}},getControl:et=>{const tr=oo(),gr=et===!0||g.value!==!0||F!==!0;if(e.useInput===!0)tr.push(Xn(et,gr));else if(_t.editable.value===!0){const Ji=gr===!0?Xr.value:void 0;tr.push(h("input",{ref:gr===!0?ue:void 0,key:"d_t",class:"q-select__focus-target",id:gr===!0?_t.targetUid.value:void 0,value:nr.value,readonly:!0,"data-autofocus":et===!0||e.autofocus===!0||void 0,...Ji,onKeydown:fo,onKeyup:Zi,onKeypress:En})),gr===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length>0&&tr.push(h("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:oi}))}if(be.value!==void 0&&e.disable!==!0&&st.value.length>0){const Ji=st.value.map(Gi=>h("option",{value:Gi,selected:!0}));tr.push(h("select",{class:"hidden",name:be.value,multiple:e.multiple},Ji))}const Jr=e.useInput===!0||gr!==!0?void 0:_t.splitAttrs.attributes.value;return h("div",{class:"q-field__native row items-center",...Jr},tr)},getInnerAppend:()=>e.loading!==!0&&C.value!==!0&&e.hideDropdownIcon!==!0?[h(QIcon,{class:"q-select__dropdown-icon"+(f.value===!0?" rotate-180":""),name:Or.value})]:null}),useField(_t)}});function useQuasar(){return inject(quasarKey)}var workerUrl="/assets/gdal3.a43b8649.js",dataUrl="/assets/gdal3WebAssembly.7e503367.data",wasmUrl="/assets/gdal3WebAssembly.42c9785f.wasm",gdal3={exports:{}};(function(e,t){(function(n,o){e.exports=o()})(commonjsGlobal,function(){function n(J){if(J.__esModule)return J;var Y=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(J).forEach(function(Me){var ct=Object.getOwnPropertyDescriptor(J,Me);Object.defineProperty(Y,Me,ct.get?ct:{enumerable:!0,get:function(){return J[Me]}})}),Y}var o=n(Object.freeze({__proto__:null,default:{}})),u=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";function f(J,Y){var Me,ct=Object.keys(J);return Object.getOwnPropertySymbols&&(Me=Object.getOwnPropertySymbols(J),Y&&(Me=Me.filter(function(Pt){return Object.getOwnPropertyDescriptor(J,Pt).enumerable})),ct.push.apply(ct,Me)),ct}function g(J){for(var Y=1;Y<arguments.length;Y++){var Me=arguments[Y]!=null?arguments[Y]:{};Y%2?f(Object(Me),!0).forEach(function(ct){var Pt,Ve;Pt=J,Ve=Me[ct=ct],ct in Pt?Object.defineProperty(Pt,ct,{value:Ve,enumerable:!0,configurable:!0,writable:!0}):Pt[ct]=Ve}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(Me)):f(Object(Me)).forEach(function(ct){Object.defineProperty(J,ct,Object.getOwnPropertyDescriptor(Me,ct))})}return J}function a(J){return(a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y})(J)}function b(J,Y){for(var Me=0;Me<Y.length;Me++){var ct=Y[Me];ct.enumerable=ct.enumerable||!1,ct.configurable=!0,"value"in ct&&(ct.writable=!0),Object.defineProperty(J,ct.key,ct)}}function T(J,Y){return function(Me){if(Array.isArray(Me))return Me}(J)||function(Me,ct){var Pt=Me==null?null:typeof Symbol<"u"&&Me[Symbol.iterator]||Me["@@iterator"];if(Pt!=null){var Ve,pt,dt=[],ft=!0,Rr=!1;try{for(Pt=Pt.call(Me);!(ft=(Ve=Pt.next()).done)&&(dt.push(Ve.value),!ct||dt.length!==ct);ft=!0);}catch(gi){Rr=!0,pt=gi}finally{try{ft||Pt.return==null||Pt.return()}finally{if(Rr)throw pt}}return dt}}(J,Y)||L(J,Y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function C(J){return function(Y){if(Array.isArray(Y))return N(Y)}(J)||function(Y){if(typeof Symbol<"u"&&Y[Symbol.iterator]!=null||Y["@@iterator"]!=null)return Array.from(Y)}(J)||L(J)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function L(J,Y){if(J){if(typeof J=="string")return N(J,Y);var Me=Object.prototype.toString.call(J).slice(8,-1);return(Me=Me==="Object"&&J.constructor?J.constructor.name:Me)==="Map"||Me==="Set"?Array.from(J):Me==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Me)?N(J,Y):void 0}}function N(J,Y){(Y==null||Y>J.length)&&(Y=J.length);for(var Me=0,ct=new Array(Y);Me<Y;Me++)ct[Me]=J[Me];return ct}var F,xr={exports:{}},H=n(Object.freeze({__proto__:null,default:{}})),Xi=xr;function se(J){var Y,Me,ct,Pt,Ve,pt,dt,ft,Rr,gi,q=(J=J||{})!==void 0?J:{};function fi(){function E(U,Z){if(!U)throw Z+new Error().stack}function M(U,Z,K){this.start=U,this.end=Z,this.audio=K}q.FS_createPath("/","usr",!0,!0),q.FS_createPath("/usr","share",!0,!0),q.FS_createPath("/usr/share","gdal",!0,!0),q.FS_createPath("/usr/share","proj",!0,!0),M.prototype={requests:{},open:function(U,Z){this.name=Z,this.requests[Z]=this,q.addRunDependency("fp "+this.name)},send:function(){},onload:function(){var U=this.byteArray.subarray(this.start,this.end);this.finish(U)},finish:function(U){q.FS_createDataFile(this.name,null,U,!0,!0,!0),q.removeRunDependency("fp "+this.name),this.requests[this.name]=null}};for(var D=ct.files,B=0;B<D.length;++B)new M(D[B].start,D[B].end,D[B].audio||0).open("GET",D[B].filename);function $(U){E(U,"Loading data file failed."),E(U instanceof ArrayBuffer,"bad input to processPackageData");for(var U=new Uint8Array(U),Z=(M.prototype.byteArray=U,ct.files),K=0;K<Z.length;++K)M.prototype.requests[Z[K].filename].onload();q.removeRunDependency("datafile_/home/bugra/Documents/MiniProject/gdal3.js/build/package/gdal3WebAssembly.data")}q.addRunDependency("datafile_/home/bugra/Documents/MiniProject/gdal3.js/build/package/gdal3WebAssembly.data"),q.preloadResults||(q.preloadResults={}),q.preloadResults["/home/bugra/Documents/MiniProject/gdal3.js/build/package/gdal3WebAssembly.data"]={fromCache:!1},gi?($(gi),gi=null):Rr=$}q.ready=new Promise(function(E,M){Y=E,Me=M}),q.expectedDataFileDownloads||(q.expectedDataFileDownloads=0),q.expectedDataFileDownloads++,q.ENVIRONMENT_IS_PTHREAD||(ct={files:[{filename:"/usr/share/gdal/jpfgdgml_RdArea.gfs",start:0,end:1515},{filename:"/usr/share/gdal/grib2_table_4_2_0_3.csv",start:1515,end:11849},{filename:"/usr/share/gdal/plscenesconf.json",start:11849,end:47162},{filename:"/usr/share/gdal/header.dxf",start:47162,end:53734},{filename:"/usr/share/gdal/grib2_table_4_2_10_2.csv",start:53734,end:63614},{filename:"/usr/share/gdal/pci_datum.txt",start:63614,end:98719},{filename:"/usr/share/gdal/nitf_spec.xml",start:98719,end:247574},{filename:"/usr/share/gdal/grib2_table_4_2_0_6.csv",start:247574,end:259216},{filename:"/usr/share/gdal/pci_ellips.txt",start:259216,end:262682},{filename:"/usr/share/gdal/grib2_table_4_2_4_5.csv",start:262682,end:272178},{filename:"/usr/share/gdal/grib2_table_4_2_4_4.csv",start:272178,end:281867},{filename:"/usr/share/gdal/inspire_cp_CadastralBoundary.gfs",start:281867,end:283517},{filename:"/usr/share/gdal/ozi_ellips.csv",start:283517,end:284866},{filename:"/usr/share/gdal/grib2_table_4_2_4_1.csv",start:284866,end:294552},{filename:"/usr/share/gdal/grib2_table_4_2_2_0.csv",start:294552,end:306753},{filename:"/usr/share/gdal/ozi_datum.csv",start:306753,end:315235},{filename:"/usr/share/gdal/grib2_table_4_2_10_4.csv",start:315235,end:325428},{filename:"/usr/share/gdal/eedaconf.json",start:325428,end:325807},{filename:"/usr/share/gdal/grib2_table_4_2_10_3.csv",start:325807,end:335583},{filename:"/usr/share/gdal/grib2_table_4_2_local_NCEP.csv",start:335583,end:363560},{filename:"/usr/share/gdal/jpfgdgml_RvrMgtBdry.gfs",start:363560,end:364948},{filename:"/usr/share/gdal/grib2_table_4_2_20_1.csv",start:364948,end:374802},{filename:"/usr/share/gdal/jpfgdgml_BldA.gfs",start:374802,end:376303},{filename:"/usr/share/gdal/vdv452.xsd",start:376303,end:379157},{filename:"/usr/share/gdal/grib2_table_4_2_0_19.csv",start:379157,end:391031},{filename:"/usr/share/gdal/s57expectedinput.csv",start:391031,end:411916},{filename:"/usr/share/gdal/jpfgdgml_WStrA.gfs",start:411916,end:413419},{filename:"/usr/share/gdal/ruian_vf_v1.gfs",start:413419,end:480753},{filename:"/usr/share/gdal/inspire_cp_BasicPropertyUnit.gfs",start:480753,end:482493},{filename:"/usr/share/gdal/grib2_table_4_2_4_6.csv",start:482493,end:492127},{filename:"/usr/share/gdal/GDALLogoGS.svg",start:492127,end:504432},{filename:"/usr/share/gdal/s57objectclasses.csv",start:504432,end:557759},{filename:"/usr/share/gdal/GDALLogoColor.svg",start:557759,end:570064},{filename:"/usr/share/gdal/pds4_template.xml",start:570064,end:573497},{filename:"/usr/share/gdal/default.rsc",start:573497,end:1037129},{filename:"/usr/share/gdal/grib2_table_4_2_0_17.csv",start:1037129,end:1037985},{filename:"/usr/share/gdal/tms_NZTM2000.json",start:1037985,end:1043202},{filename:"/usr/share/gdal/grib2_table_4_2_20_2.csv",start:1043202,end:1052708},{filename:"/usr/share/gdal/jpfgdgml_ElevPt.gfs",start:1052708,end:1054208},{filename:"/usr/share/gdal/cubewerx_extra.wkt",start:1054208,end:1066185},{filename:"/usr/share/gdal/ecw_cs.wkt",start:1066185,end:1429902},{filename:"/usr/share/gdal/grib2_table_4_2_1_2.csv",start:1429902,end:1439700},{filename:"/usr/share/gdal/osmconf.ini",start:1439700,end:1444895},{filename:"/usr/share/gdal/grib2_subcenter.csv",start:1444895,end:1447223},{filename:"/usr/share/gdal/grib2_table_4_2_0_2.csv",start:1447223,end:1458026},{filename:"/usr/share/gdal/grib2_table_4_2_0_16.csv",start:1458026,end:1467697},{filename:"/usr/share/gdal/epsg.wkt",start:1467697,end:1467724},{filename:"/usr/share/gdal/jpfgdgml_SBBdry.gfs",start:1467724,end:1468977},{filename:"/usr/share/gdal/jpfgdgml_BldL.gfs",start:1468977,end:1470480},{filename:"/usr/share/gdal/ruian_vf_st_v1.gfs",start:1470480,end:1516452},{filename:"/usr/share/gdal/grib2_table_4_2_0_190.csv",start:1516452,end:1525959},{filename:"/usr/share/gdal/gmlasconf.xml",start:1525959,end:1533391},{filename:"/usr/share/gdal/grib2_table_4_2_0_0.csv",start:1533391,end:1543754},{filename:"/usr/share/gdal/gt_datum.csv",start:1543754,end:1559558},{filename:"/usr/share/gdal/ruian_vf_st_uvoh_v1.gfs",start:1559558,end:1562158},{filename:"/usr/share/gdal/LICENSE.TXT",start:1562158,end:1581972},{filename:"/usr/share/gdal/jpfgdgml_SBAPt.gfs",start:1581972,end:1583347},{filename:"/usr/share/gdal/ruian_vf_ob_v1.gfs",start:1583347,end:1630122},{filename:"/usr/share/gdal/jpfgdgml_WL.gfs",start:1630122,end:1631621},{filename:"/usr/share/gdal/grib2_table_4_2_2_3.csv",start:1631621,end:1642255},{filename:"/usr/share/gdal/tms_LINZAntarticaMapTileGrid.json",start:1642255,end:1646382},{filename:"/usr/share/gdal/GDALLogoBW.svg",start:1646382,end:1659404},{filename:"/usr/share/gdal/grib2_table_4_2_4_9.csv",start:1659404,end:1668940},{filename:"/usr/share/gdal/gmlasconf.xsd",start:1668940,end:1717594},{filename:"/usr/share/gdal/jpfgdgml_RdCompt.gfs",start:1717594,end:1719240},{filename:"/usr/share/gdal/grib2_process.csv",start:1719240,end:1724166},{filename:"/usr/share/gdal/stateplane.csv",start:1724166,end:1734526},{filename:"/usr/share/gdal/trailer.dxf",start:1734526,end:1736801},{filename:"/usr/share/gdal/nitf_spec.xsd",start:1736801,end:1744488},{filename:"/usr/share/gdal/grib2_table_4_2_3_6.csv",start:1744488,end:1745307},{filename:"/usr/share/gdal/bag_template.xml",start:1745307,end:1754327},{filename:"/usr/share/gdal/s57attributes.csv",start:1754327,end:1774328},{filename:"/usr/share/gdal/vdv452.xml",start:1774328,end:1800144},{filename:"/usr/share/gdal/jpfgdgml_Cntr.gfs",start:1800144,end:1801645},{filename:"/usr/share/gdal/jpfgdgml_SBArea.gfs",start:1801645,end:1803152},{filename:"/usr/share/gdal/grib2_table_4_2_10_0.csv",start:1803152,end:1814925},{filename:"/usr/share/gdal/grib2_table_4_2_4_10.csv",start:1814925,end:1824626},{filename:"/usr/share/gdal/grib2_table_4_2_0_7.csv",start:1824626,end:1835117},{filename:"/usr/share/gdal/jpfgdgml_RailCL.gfs",start:1835117,end:1836624},{filename:"/usr/share/gdal/jpfgdgml_RdEdg.gfs",start:1836624,end:1838266},{filename:"/usr/share/gdal/esri_StatePlane_extra.wkt",start:1838266,end:2170812},{filename:"/usr/share/gdal/jpfgdgml_RdSgmtA.gfs",start:2170812,end:2172456},{filename:"/usr/share/gdal/grib2_table_4_2_10_191.csv",start:2172456,end:2182090},{filename:"/usr/share/gdal/seed_2d.dgn",start:2182090,end:2191306},{filename:"/usr/share/gdal/grib2_table_4_2_local_index.csv",start:2191306,end:2191557},{filename:"/usr/share/gdal/grib2_table_4_2_2_4.csv",start:2191557,end:2202785},{filename:"/usr/share/gdal/grib2_table_4_2_0_5.csv",start:2202785,end:2212611},{filename:"/usr/share/gdal/grib2_table_4_2_1_1.csv",start:2212611,end:2222266},{filename:"/usr/share/gdal/jpfgdgml_LeveeEdge.gfs",start:2222266,end:2223652},{filename:"/usr/share/gdal/grib2_table_4_2_3_3.csv",start:2223652,end:2224436},{filename:"/usr/share/gdal/tms_MapML_CBMTILE.json",start:2224436,end:2232233},{filename:"/usr/share/gdal/grib2_table_4_2_0_20.csv",start:2232233,end:2244359},{filename:"/usr/share/gdal/netcdf_config.xsd",start:2244359,end:2251850},{filename:"/usr/share/gdal/grib2_table_4_2_10_1.csv",start:2251850,end:2261448},{filename:"/usr/share/gdal/grib2_table_4_2_0_14.csv",start:2261448,end:2270999},{filename:"/usr/share/gdal/grib2_table_4_2_4_7.csv",start:2270999,end:2280555},{filename:"/usr/share/gdal/grib2_table_4_2_local_NDFD.csv",start:2280555,end:2283214},{filename:"/usr/share/gdal/grib2_table_4_2_4_2.csv",start:2283214,end:2292874},{filename:"/usr/share/gdal/grib2_table_4_2_3_2.csv",start:2292874,end:2296707},{filename:"/usr/share/gdal/jpfgdgml_RdASL.gfs",start:2296707,end:2297958},{filename:"/usr/share/gdal/jpfgdgml_CommBdry.gfs",start:2297958,end:2299342},{filename:"/usr/share/gdal/vicar.json",start:2299342,end:2301749},{filename:"/usr/share/gdal/grib2_table_4_2_0_18.csv",start:2301749,end:2311973},{filename:"/usr/share/gdal/s57agencies.csv",start:2311973,end:2325277},{filename:"/usr/share/gdal/jpfgdgml_CommPt.gfs",start:2325277,end:2326912},{filename:"/usr/share/gdal/grib2_table_4_2_0_15.csv",start:2326912,end:2336758},{filename:"/usr/share/gdal/grib2_table_4_2_3_1.csv",start:2336758,end:2347421},{filename:"/usr/share/gdal/jpfgdgml_RdMgtBdry.gfs",start:2347421,end:2348807},{filename:"/usr/share/gdal/inspire_cp_CadastralZoning.gfs",start:2348807,end:2353619},{filename:"/usr/share/gdal/inspire_cp_CadastralParcel.gfs",start:2353619,end:2356069},{filename:"/usr/share/gdal/grib2_table_4_2_4_0.csv",start:2356069,end:2365622},{filename:"/usr/share/gdal/grib2_table_4_2_local_MRMS.csv",start:2365622,end:2381209},{filename:"/usr/share/gdal/gt_ellips.csv",start:2381209,end:2382928},{filename:"/usr/share/gdal/seed_3d.dgn",start:2382928,end:2384976},{filename:"/usr/share/gdal/tms_MapML_APSTILE.json",start:2384976,end:2391249},{filename:"/usr/share/gdal/grib2_table_4_2_20_0.csv",start:2391249,end:2400795},{filename:"/usr/share/gdal/grib2_table_4_5.csv",start:2400795,end:2410808},{filename:"/usr/share/gdal/grib2_table_4_2_3_5.csv",start:2410808,end:2411728},{filename:"/usr/share/gdal/template_tiles.mapml",start:2411728,end:2413675},{filename:"/usr/share/gdal/gml_registry.xml",start:2413675,end:2420318},{filename:"/usr/share/gdal/grib2_table_4_2_0_13.csv",start:2420318,end:2429914},{filename:"/usr/share/gdal/jpfgdgml_WA.gfs",start:2429914,end:2431411},{filename:"/usr/share/gdal/grib2_table_versions.csv",start:2431411,end:2431451},{filename:"/usr/share/gdal/jpfgdgml_Cstline.gfs",start:2431451,end:2432960},{filename:"/usr/share/gdal/grib2_table_4_2_0_1.csv",start:2432960,end:2448697},{filename:"/usr/share/gdal/grib2_table_4_2_0_191.csv",start:2448697,end:2458317},{filename:"/usr/share/gdal/jpfgdgml_GCP.gfs",start:2458317,end:2460840},{filename:"/usr/share/gdal/ogrvrt.xsd",start:2460840,end:2486589},{filename:"/usr/share/gdal/grib2_table_4_2_local_HPC.csv",start:2486589,end:2486676},{filename:"/usr/share/gdal/jpfgdgml_AdmPt.gfs",start:2486676,end:2488309},{filename:"/usr/share/gdal/jpfgdgml_AdmArea.gfs",start:2488309,end:2489949},{filename:"/usr/share/gdal/jpfgdgml_WStrL.gfs",start:2489949,end:2491454},{filename:"/usr/share/gdal/grib2_center.csv",start:2491454,end:2495625},{filename:"/usr/share/gdal/gdalvrt.xsd",start:2495625,end:2523196},{filename:"/usr/share/gdal/grib2_table_4_2_3_0.csv",start:2523196,end:2534147},{filename:"/usr/share/gdal/gdalicon.png",start:2534147,end:2536168},{filename:"/usr/share/gdal/gdalmdiminfo_output.schema.json",start:2536168,end:2541629},{filename:"/usr/share/gdal/grib2_table_4_2_2_5.csv",start:2541629,end:2551142},{filename:"/usr/share/gdal/grib2_table_4_2_4_8.csv",start:2551142,end:2560828},{filename:"/usr/share/gdal/grib2_table_4_2_0_4.csv",start:2560828,end:2571139},{filename:"/usr/share/gdal/grib2_table_4_2_4_3.csv",start:2571139,end:2580861},{filename:"/usr/share/gdal/grib2_table_4_2_1_0.csv",start:2580861,end:2591003},{filename:"/usr/share/gdal/grib2_table_4_2_3_4.csv",start:2591003,end:2592054},{filename:"/usr/share/gdal/jpfgdgml_AdmBdry.gfs",start:2592054,end:2593436},{filename:"/usr/share/gdal/grib2_table_4_2_local_Canada.csv",start:2593436,end:2593769},{filename:"/usr/share/gdal/pdfcomposition.xsd",start:2593769,end:2628103},{filename:"/usr/share/proj/proj.ini",start:2628103,end:2629153},{filename:"/usr/share/proj/ITRF2000",start:2629153,end:2631252},{filename:"/usr/share/proj/projjson.schema.json",start:2631252,end:2668530},{filename:"/usr/share/proj/nad83",start:2668530,end:2685123},{filename:"/usr/share/proj/ITRF2014",start:2685123,end:2688612},{filename:"/usr/share/proj/other.extra",start:2688612,end:2692527},{filename:"/usr/share/proj/deformation_model.schema.json",start:2692527,end:2710198},{filename:"/usr/share/proj/nad27",start:2710198,end:2729733},{filename:"/usr/share/proj/triangulation.schema.json",start:2729733,end:2738136},{filename:"/usr/share/proj/nad.lst",start:2738136,end:2744521},{filename:"/usr/share/proj/GL27",start:2744521,end:2745249},{filename:"/usr/share/proj/world",start:2745249,end:2752328},{filename:"/usr/share/proj/CH",start:2752328,end:2753425},{filename:"/usr/share/proj/ITRF2008",start:2753425,end:2759105},{filename:"/usr/share/proj/proj.db",start:2759105,end:11037121}],remote_package_size:11037121},(typeof window>"u"?"undefined":a(window))==="object"?window.encodeURIComponent(window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/"):typeof process>"u"&&typeof location<"u"&&encodeURIComponent(location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"),xe="gdal3WebAssembly.data",typeof q.locateFilePackage!="function"||q.locateFile||(q.locateFile=q.locateFilePackage,hi("warning: you defined Module.locateFilePackage, that has been renamed to Module.locateFile (using your locateFilePackage for now)")),xe=q.locateFile?q.locateFile(xe,""):xe,_r=ct.remote_package_size,Rr=null,(gi=q.getPreloadedPackage?q.getPreloadedPackage(xe,_r):null)||(Pt=xe,Ve=_r,pt=function(E){Rr?(Rr(E),Rr=null):gi=E},dt=function(E){console.error("package error:",E)},(typeof process>"u"?"undefined":a(process))==="object"&&a(process.versions)==="object"&&typeof process.versions.node=="string"?o.readFile(Pt,function(E,M){E?dt(E):pt(M.buffer)}):((ft=new XMLHttpRequest).open("GET",Pt,!0),ft.responseType="arraybuffer",ft.onprogress=function(E){var M=Pt,D=Ve;if(E.total&&(D=E.total),E.loaded){ft.addedTotal?q.dataFileDownloads[M].loaded=E.loaded:(ft.addedTotal=!0,q.dataFileDownloads||(q.dataFileDownloads={}),q.dataFileDownloads[M]={loaded:E.loaded,total:D});var B,$=0,U=0,Z=0;for(B in q.dataFileDownloads){var K=q.dataFileDownloads[B];$+=K.total,U+=K.loaded,Z++}$=Math.ceil($*q.expectedDataFileDownloads/Z),q.setStatus&&q.setStatus("Downloading data... ("+U+"/"+$+")")}else q.dataFileDownloads||q.setStatus&&q.setStatus("Downloading data...")},ft.onerror=function(E){throw new Error("NetworkError for: "+Pt)},ft.onload=function(E){if(!(ft.status==200||ft.status==304||ft.status==206||ft.status==0&&ft.response))throw new Error(ft.statusText+" : "+ft.responseURL);var M=ft.response;pt(M)},ft.send(null))),q.calledRun?fi():(q.preRun||(q.preRun=[]),q.preRun.push(fi)));var $i,ji,Hi,Ai,z,ee,xe=Object.assign({},q),lt="./this.program",kt=function(E,M){throw M},Et=(typeof window>"u"?"undefined":a(window))=="object",At=typeof importScripts=="function",Tr=(typeof process>"u"?"undefined":a(process))=="object"&&a(process.versions)=="object"&&typeof process.versions.node=="string",_r="";function Ur(E){pi=E}Tr?(_r=At?H.dirname(_r)+"/":__dirname+"/",ee=function(){z||(Ai=o,z=H)},$i=function(E,M){return ee(),E=z.normalize(E),Ai.readFileSync(E,M?void 0:"utf8")},Hi=function(E){return E=$i(E,!0),E=E.buffer?E:new Uint8Array(E)},ji=function(E,M,D){ee(),E=z.normalize(E),Ai.readFile(E,function(B,$){B?D(B):M($.buffer)})},1<process.argv.length&&(lt=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(E){if(!(E instanceof cn))throw E}),process.on("unhandledRejection",function(E){throw E}),kt=function(E,M){if(pn)throw process.exitCode=E,M;(M=M)instanceof cn||hi("exiting due to exception: "+M),process.exit(E)},q.inspect=function(){return"[Emscripten Module object]"}):(Et||At)&&(At?_r=self.location.href:typeof document<"u"&&document.currentScript&&(_r=document.currentScript.src),_r=(_r=F||_r).indexOf("blob:")!==0?_r.substr(0,_r.replace(/[?#].*/,"").lastIndexOf("/")+1):"",$i=function(E){var M=new XMLHttpRequest;return M.open("GET",E,!1),M.send(null),M.responseText},At&&(Hi=function(E){var M=new XMLHttpRequest;return M.open("GET",E,!1),M.responseType="arraybuffer",M.send(null),new Uint8Array(M.response)}),ji=function(E,M,D){var B=new XMLHttpRequest;B.open("GET",E,!0),B.responseType="arraybuffer",B.onload=function(){B.status==200||B.status==0&&B.response?M(B.response):D()},B.onerror=D,B.send(null)});var It,Ir,Yr=q.print||console.log.bind(console),hi=q.printErr||console.warn.bind(console),pi=(Object.assign(q,xe),q.arguments,q.thisProgram&&(lt=q.thisProgram),q.quit&&(kt=q.quit),0),pn=(q.wasmBinary&&(It=q.wasmBinary),q.noExitRuntime||!0),pr=((typeof WebAssembly>"u"?"undefined":a(WebAssembly))!="object"&&so("no native wasm support detected"),!1);function ei(E,M){E||so(M)}var Oi,Ci,vn,_i,yr,dn,an,Zn,Nn,Da=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ka(E,M,D){for(var B=M+D,$=M;E[$]&&!(B<=$);)++$;if(16<$-M&&E.buffer&&Da)return Da.decode(E.subarray(M,$));for(var U="";M<$;){var Z,K,me=E[M++];128&me?(K=63&E[M++],(224&me)==192?U+=String.fromCharCode((31&me)<<6|K):(Z=63&E[M++],(me=(240&me)==224?(15&me)<<12|K<<6|Z:(7&me)<<18|K<<12|Z<<6|63&E[M++])<65536?U+=String.fromCharCode(me):(K=me-65536,U+=String.fromCharCode(55296|K>>10,56320|1023&K)))):U+=String.fromCharCode(me)}return U}function eo(E,M){return E?ka(vn,E,M):""}function Go(E,M,D,B){if(!(0<B))return 0;for(var $=D,U=D+B-1,Z=0;Z<E.length;++Z){var K=E.charCodeAt(Z);if((K=55296<=K&&K<=57343?65536+((1023&K)<<10)|1023&E.charCodeAt(++Z):K)<=127){if(U<=D)break;M[D++]=K}else if(K<=2047){if(U<=D+1)break;M[D++]=192|K>>6,M[D++]=128|63&K}else if(K<=65535){if(U<=D+2)break;M[D++]=224|K>>12,M[D++]=128|K>>6&63,M[D++]=128|63&K}else{if(U<=D+3)break;M[D++]=240|K>>18,M[D++]=128|K>>12&63,M[D++]=128|K>>6&63,M[D++]=128|63&K}}return M[D]=0,D-$}function pa(E,M,D){return Go(E,vn,M,D)}function Pa(E){for(var M=0,D=0;D<E.length;++D){var B=E.charCodeAt(D);B<=127?M++:B<=2047?M+=2:55296<=B&&B<=57343?(M+=4,++D):M+=3}return M}function xa(E){Oi=E,q.HEAP8=Ci=new Int8Array(E),q.HEAP16=_i=new Int16Array(E),q.HEAP32=yr=new Int32Array(E),q.HEAPU8=vn=new Uint8Array(E),q.HEAPU16=new Uint16Array(E),q.HEAPU32=dn=new Uint32Array(E),q.HEAPF32=an=new Float32Array(E),q.HEAPF64=Zn=new Float64Array(E)}q.INITIAL_MEMORY;var Ro=[],Ga=[],Qn=[];function Cs(){if(q.preRun)for(typeof q.preRun=="function"&&(q.preRun=[q.preRun]);q.preRun.length;)E=q.preRun.shift(),Ro.unshift(E);var E;Ds(Ro)}function qo(){if(q.postRun)for(typeof q.postRun=="function"&&(q.postRun=[q.postRun]);q.postRun.length;)E=q.postRun.shift(),Qn.unshift(E);var E;Ds(Qn)}var xo,sn,Hn,ta=0,Bo=null;function ra(E){ta++,q.monitorRunDependencies&&q.monitorRunDependencies(ta)}function ma(E){var M;ta--,q.monitorRunDependencies&&q.monitorRunDependencies(ta),ta==0&&Bo&&(M=Bo,Bo=null,M())}function so(E){throw q.onAbort&&q.onAbort(E),hi(E="Aborted("+E+")"),pr=!0,E+=". Build with -sASSERTIONS for more info.",E=new WebAssembly.RuntimeError(E),Me(E),E}function ia(E){return E.startsWith("data:application/octet-stream;base64,")}function Is(E){return E.startsWith("file://")}function ba(E){try{if(E==xo&&It)return new Uint8Array(It);if(Hi)return Hi(E);throw"both async and sync fetching of the wasm failed"}catch(M){so(M)}}function cn(E){this.name="ExitStatus",this.message="Program terminated with exit("+E+")",this.status=E}function Ds(E){for(;0<E.length;)E.shift()(q)}function qa(E,M){Ci.set(E,M)}ia(xo="gdal3WebAssembly.wasm")||(Ra=xo,xo=q.locateFile?q.locateFile(Ra,_r):_r+Ra);var wa=[];function Ct(E){var M=wa[E];return M||(E>=wa.length&&(wa.length=E+1),wa[E]=M=Nn.get(E)),M}var Mo=[],mo=0,lo=0;function Xo(E){this.excPtr=E,this.ptr=E-24,this.set_type=function(M){dn[this.ptr+4>>2]=M},this.get_type=function(){return dn[this.ptr+4>>2]},this.set_destructor=function(M){dn[this.ptr+8>>2]=M},this.get_destructor=function(){return dn[this.ptr+8>>2]},this.set_refcount=function(M){yr[this.ptr>>2]=M},this.set_caught=function(M){Ci[this.ptr+12>>0]=M=M?1:0},this.get_caught=function(){return Ci[this.ptr+12>>0]!=0},this.set_rethrown=function(M){Ci[this.ptr+13>>0]=M=M?1:0},this.get_rethrown=function(){return Ci[this.ptr+13>>0]!=0},this.init=function(M,D){this.set_adjusted_ptr(0),this.set_type(M),this.set_destructor(D),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var M=yr[this.ptr>>2];yr[this.ptr>>2]=M+1},this.release_ref=function(){var M=yr[this.ptr>>2];return yr[this.ptr>>2]=M-1,M===1},this.set_adjusted_ptr=function(M){dn[this.ptr+16>>2]=M},this.get_adjusted_ptr=function(){return dn[this.ptr+16>>2]},this.get_exception_ptr=function(){if(Xs(this.get_type()))return dn[this.excPtr>>2];var M=this.get_adjusted_ptr();return M!==0?M:this.excPtr}}function Oo(E){return wo(new Xo(E).ptr)}var Ui={isAbs:function(E){return E.charAt(0)==="/"},splitPath:function(E){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(E).slice(1)},normalizeArray:function(E,M){for(var D=0,B=E.length-1;0<=B;B--){var $=E[B];$==="."?E.splice(B,1):$===".."?(E.splice(B,1),D++):D&&(E.splice(B,1),D--)}if(M)for(;D;D--)E.unshift("..");return E},normalize:function(E){var M=Ui.isAbs(E),D=E.substr(-1)==="/";return(E=(E=Ui.normalizeArray(E.split("/").filter(function(B){return!!B}),!M).join("/"))||M?E:".")&&D&&(E+="/"),(M?"/":"")+E},dirname:function(D){var D=Ui.splitPath(D),M=D[0],D=D[1];return M||D?M+(D=D&&D.substr(0,D.length-1)):"."},basename:function(E){if(E==="/")return"/";var M=(E=(E=Ui.normalize(E)).replace(/\/$/,"")).lastIndexOf("/");return M===-1?E:E.substr(M+1)},join:function(){var E=Array.prototype.slice.call(arguments,0);return Ui.normalize(E.join("/"))},join2:function(E,M){return Ui.normalize(E+"/"+M)}};function na(){var E;if((typeof crypto>"u"?"undefined":a(crypto))=="object"&&typeof crypto.getRandomValues=="function")return E=new Uint8Array(1),function(){return crypto.getRandomValues(E),E[0]};if(Tr)try{var M=void 0;return function(){return M.randomBytes(1)[0]}}catch{}return function(){so("randomDevice")}}var go={resolve:function(){for(var E="",M=!1,D=arguments.length-1;-1<=D&&!M;D--){var B=0<=D?arguments[D]:ie.cwd();if(typeof B!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!B)return"";E=B+"/"+E,M=Ui.isAbs(B)}return(M?"/":"")+(E=Ui.normalizeArray(E.split("/").filter(function($){return!!$}),!M).join("/"))||"."},relative:function(E,M){function D(we){for(var Se=0;Se<we.length&&we[Se]==="";Se++);for(var Ue=we.length-1;0<=Ue&&we[Ue]==="";Ue--);return Ue<Se?[]:we.slice(Se,Ue-Se+1)}E=go.resolve(E).substr(1),M=go.resolve(M).substr(1);for(var B=D(E.split("/")),$=D(M.split("/")),U=Math.min(B.length,$.length),Z=U,K=0;K<U;K++)if(B[K]!==$[K]){Z=K;break}for(var me=[],K=Z;K<B.length;K++)me.push("..");return(me=me.concat($.slice(Z))).join("/")}};function ga(E,M,D){return D=0<D?D:Pa(E)+1,D=new Array(D),E=Go(E,D,0,D.length),M&&(D.length=E),D}var Zo={ttys:[],init:function(){},shutdown:function(){},register:function(E,M){Zo.ttys[E]={input:[],output:[],ops:M},ie.registerDevice(E,Zo.stream_ops)},stream_ops:{open:function(E){var M=Zo.ttys[E.node.rdev];if(!M)throw new ie.ErrnoError(43);E.tty=M,E.seekable=!1},close:function(E){E.tty.ops.flush(E.tty)},flush:function(E){E.tty.ops.flush(E.tty)},read:function(E,M,D,B,$){if(!E.tty||!E.tty.ops.get_char)throw new ie.ErrnoError(60);for(var U,Z=0,K=0;K<B;K++){try{U=E.tty.ops.get_char(E.tty)}catch{throw new ie.ErrnoError(29)}if(U===void 0&&Z===0)throw new ie.ErrnoError(6);if(U==null)break;Z++,M[D+K]=U}return Z&&(E.node.timestamp=Date.now()),Z},write:function(E,M,D,B,$){if(!E.tty||!E.tty.ops.put_char)throw new ie.ErrnoError(60);try{for(var U=0;U<B;U++)E.tty.ops.put_char(E.tty,M[D+U])}catch{throw new ie.ErrnoError(29)}return B&&(E.node.timestamp=Date.now()),U}},default_tty_ops:{get_char:function(E){if(!E.input.length){var M=null;if(Tr){var D=Buffer.alloc(256),B=0;try{B=Ai.readSync(process.stdin.fd,D,0,256,-1)}catch($){if(!$.toString().includes("EOF"))throw $;B=0}M=0<B?D.slice(0,B).toString("utf-8"):null}else typeof window<"u"&&typeof window.prompt=="function"?(M=window.prompt("Input: "))!==null&&(M+=`
`):typeof readline=="function"&&(M=readline())!==null&&(M+=`
`);if(!M)return null;E.input=ga(M,!0)}return E.input.shift()},put_char:function(E,M){M===null||M===10?(Yr(ka(E.output,0)),E.output=[]):M!=0&&E.output.push(M)},flush:function(E){E.output&&0<E.output.length&&(Yr(ka(E.output,0)),E.output=[])}},default_tty1_ops:{put_char:function(E,M){M===null||M===10?(hi(ka(E.output,0)),E.output=[]):M!=0&&E.output.push(M)},flush:function(E){E.output&&0<E.output.length&&(hi(ka(E.output,0)),E.output=[])}}};function en(E){D=E,M=65536,E=Math.ceil(D/M)*M;var M,D=Ea(65536,E);return D?(M=E,vn.fill(0,D,D+M),D):0}var Ni={ops_table:null,mount:function(E){return Ni.createNode(null,"/",16895,0)},createNode:function(E,M,D,B){if(ie.isBlkdev(D)||ie.isFIFO(D))throw new ie.ErrnoError(63);return Ni.ops_table||(Ni.ops_table={dir:{node:{getattr:Ni.node_ops.getattr,setattr:Ni.node_ops.setattr,lookup:Ni.node_ops.lookup,mknod:Ni.node_ops.mknod,rename:Ni.node_ops.rename,unlink:Ni.node_ops.unlink,rmdir:Ni.node_ops.rmdir,readdir:Ni.node_ops.readdir,symlink:Ni.node_ops.symlink},stream:{llseek:Ni.stream_ops.llseek}},file:{node:{getattr:Ni.node_ops.getattr,setattr:Ni.node_ops.setattr},stream:{llseek:Ni.stream_ops.llseek,read:Ni.stream_ops.read,write:Ni.stream_ops.write,allocate:Ni.stream_ops.allocate,mmap:Ni.stream_ops.mmap,msync:Ni.stream_ops.msync}},link:{node:{getattr:Ni.node_ops.getattr,setattr:Ni.node_ops.setattr,readlink:Ni.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Ni.node_ops.getattr,setattr:Ni.node_ops.setattr},stream:ie.chrdev_stream_ops}}),D=ie.createNode(E,M,D,B),ie.isDir(D.mode)?(D.node_ops=Ni.ops_table.dir.node,D.stream_ops=Ni.ops_table.dir.stream,D.contents={}):ie.isFile(D.mode)?(D.node_ops=Ni.ops_table.file.node,D.stream_ops=Ni.ops_table.file.stream,D.usedBytes=0,D.contents=null):ie.isLink(D.mode)?(D.node_ops=Ni.ops_table.link.node,D.stream_ops=Ni.ops_table.link.stream):ie.isChrdev(D.mode)&&(D.node_ops=Ni.ops_table.chrdev.node,D.stream_ops=Ni.ops_table.chrdev.stream),D.timestamp=Date.now(),E&&(E.contents[M]=D,E.timestamp=D.timestamp),D},getFileDataAsTypedArray:function(E){return E.contents?E.contents.subarray?E.contents.subarray(0,E.usedBytes):new Uint8Array(E.contents):new Uint8Array(0)},expandFileStorage:function(E,M){var D=E.contents?E.contents.length:0;M<=D||(M=Math.max(M,D*(D<1048576?2:1.125)>>>0),D!=0&&(M=Math.max(M,256)),D=E.contents,E.contents=new Uint8Array(M),0<E.usedBytes&&E.contents.set(D.subarray(0,E.usedBytes),0))},resizeFileStorage:function(E,M){var D;E.usedBytes!=M&&(M==0?(E.contents=null,E.usedBytes=0):(D=E.contents,E.contents=new Uint8Array(M),D&&E.contents.set(D.subarray(0,Math.min(M,E.usedBytes))),E.usedBytes=M))},node_ops:{getattr:function(E){var M={};return M.dev=ie.isChrdev(E.mode)?E.id:1,M.ino=E.id,M.mode=E.mode,M.nlink=1,M.uid=0,M.gid=0,M.rdev=E.rdev,ie.isDir(E.mode)?M.size=4096:ie.isFile(E.mode)?M.size=E.usedBytes:ie.isLink(E.mode)?M.size=E.link.length:M.size=0,M.atime=new Date(E.timestamp),M.mtime=new Date(E.timestamp),M.ctime=new Date(E.timestamp),M.blksize=4096,M.blocks=Math.ceil(M.size/M.blksize),M},setattr:function(E,M){M.mode!==void 0&&(E.mode=M.mode),M.timestamp!==void 0&&(E.timestamp=M.timestamp),M.size!==void 0&&Ni.resizeFileStorage(E,M.size)},lookup:function(E,M){throw ie.genericErrors[44]},mknod:function(E,M,D,B){return Ni.createNode(E,M,D,B)},rename:function(E,M,D){if(ie.isDir(E.mode)){var B;try{B=ie.lookupNode(M,D)}catch{}if(B)for(var $ in B.contents)throw new ie.ErrnoError(55)}delete E.parent.contents[E.name],E.parent.timestamp=Date.now(),E.name=D,M.contents[D]=E,M.timestamp=E.parent.timestamp,E.parent=M},unlink:function(E,M){delete E.contents[M],E.timestamp=Date.now()},rmdir:function(E,M){for(var D in ie.lookupNode(E,M).contents)throw new ie.ErrnoError(55);delete E.contents[M],E.timestamp=Date.now()},readdir:function(E){var M,D=[".",".."];for(M in E.contents)E.contents.hasOwnProperty(M)&&D.push(M);return D},symlink:function(E,M,D){return E=Ni.createNode(E,M,41471,0),E.link=D,E},readlink:function(E){if(ie.isLink(E.mode))return E.link;throw new ie.ErrnoError(28)}},stream_ops:{read:function(E,M,D,B,$){var U=E.node.contents;if($>=E.node.usedBytes)return 0;var Z=Math.min(E.node.usedBytes-$,B);if(8<Z&&U.subarray)M.set(U.subarray($,$+Z),D);else for(var K=0;K<Z;K++)M[D+K]=U[$+K];return Z},write:function(E,M,D,B,$,U){if(M.buffer===Ci.buffer&&(U=!1),!B)return 0;var Z=E.node;if(Z.timestamp=Date.now(),M.subarray&&(!Z.contents||Z.contents.subarray)){if(U)return Z.contents=M.subarray(D,D+B),Z.usedBytes=B;if(Z.usedBytes===0&&$===0)return Z.contents=M.slice(D,D+B),Z.usedBytes=B;if($+B<=Z.usedBytes)return Z.contents.set(M.subarray(D,D+B),$),B}if(Ni.expandFileStorage(Z,$+B),Z.contents.subarray&&M.subarray)Z.contents.set(M.subarray(D,D+B),$);else for(var K=0;K<B;K++)Z.contents[$+K]=M[D+K];return Z.usedBytes=Math.max(Z.usedBytes,$+B),B},llseek:function(E,M,D){if(D===1?M+=E.position:D===2&&ie.isFile(E.node.mode)&&(M+=E.node.usedBytes),M<0)throw new ie.ErrnoError(28);return M},allocate:function(E,M,D){Ni.expandFileStorage(E.node,M+D),E.node.usedBytes=Math.max(E.node.usedBytes,M+D)},mmap:function(K,M,D,B,$){if(!ie.isFile(K.node.mode))throw new ie.ErrnoError(43);var U,Z,K=K.node.contents;if(2&$||K.buffer!==Oi){if((0<D||D+M<K.length)&&(K=K.subarray?K.subarray(D,D+M):Array.prototype.slice.call(K,D,D+M)),Z=!0,!(U=en(M)))throw new ie.ErrnoError(48);Ci.set(K,U)}else Z=!1,U=K.byteOffset;return{ptr:U,allocated:Z}},msync:function(E,M,D,B,$){if(ie.isFile(E.node.mode))return 2&$||Ni.stream_ops.write(E,M,0,B,D,!1),0;throw new ie.ErrnoError(43)}}},cs={},Fi={isWindows:!1,staticInit:function(){Fi.isWindows=!!process.platform.match(/^win/);var E=process.binding("constants");E.fs&&(E=E.fs),Fi.flagsForNodeMap={1024:E.O_APPEND,64:E.O_CREAT,128:E.O_EXCL,256:E.O_NOCTTY,0:E.O_RDONLY,2:E.O_RDWR,4096:E.O_SYNC,512:E.O_TRUNC,1:E.O_WRONLY,131072:E.O_NOFOLLOW}},convertNodeCode:function(E){return E=E.code,cs[E]},mount:function(E){return Fi.createNode(null,"/",Fi.getMode(E.opts.root),0)},createNode:function(E,M,D,B){if(!ie.isDir(D)&&!ie.isFile(D)&&!ie.isLink(D))throw new ie.ErrnoError(28);return E=ie.createNode(E,M,D),E.node_ops=Fi.node_ops,E.stream_ops=Fi.stream_ops,E},getMode:function(E){var M;try{M=Ai.lstatSync(E),Fi.isWindows&&(M.mode=M.mode|(292&M.mode)>>2)}catch(D){throw D.code?new ie.ErrnoError(Fi.convertNodeCode(D)):D}return M.mode},realPath:function(E){for(var M=[];E.parent!==E;)M.push(E.name),E=E.parent;return M.push(E.mount.opts.root),M.reverse(),Ui.join.apply(null,M)},flagsForNode:function(E){E=-2097153&E&-2049&-32769&-524289&-65537;var M,D=0;for(M in Fi.flagsForNodeMap)E&M&&(D|=Fi.flagsForNodeMap[M],E^=M);if(E)throw new ie.ErrnoError(28);return D},node_ops:{getattr:function(D){var M,D=Fi.realPath(D);try{M=Ai.lstatSync(D)}catch(B){throw B.code?new ie.ErrnoError(Fi.convertNodeCode(B)):B}return Fi.isWindows&&!M.blksize&&(M.blksize=4096),Fi.isWindows&&!M.blocks&&(M.blocks=(M.size+M.blksize-1)/M.blksize|0),{dev:M.dev,ino:M.ino,mode:M.mode,nlink:M.nlink,uid:M.uid,gid:M.gid,rdev:M.rdev,size:M.size,atime:M.atime,mtime:M.mtime,ctime:M.ctime,blksize:M.blksize,blocks:M.blocks}},setattr:function(E,M){var D,B=Fi.realPath(E);try{M.mode!==void 0&&(Ai.chmodSync(B,M.mode),E.mode=M.mode),M.timestamp!==void 0&&(D=new Date(M.timestamp),Ai.utimesSync(B,D,D)),M.size!==void 0&&Ai.truncateSync(B,M.size)}catch($){throw $.code?new ie.ErrnoError(Fi.convertNodeCode($)):$}},lookup:function(E,M){var D=Ui.join2(Fi.realPath(E),M),D=Fi.getMode(D);return Fi.createNode(E,M,D)},mknod:function(E,M,D,B){E=Fi.createNode(E,M,D,B),M=Fi.realPath(E);try{ie.isDir(E.mode)?Ai.mkdirSync(M,E.mode):Ai.writeFileSync(M,"",{mode:E.mode})}catch($){throw $.code?new ie.ErrnoError(Fi.convertNodeCode($)):$}return E},rename:function(E,$,D){var B=Fi.realPath(E),$=Ui.join2(Fi.realPath($),D);try{Ai.renameSync(B,$)}catch(U){throw U.code?new ie.ErrnoError(Fi.convertNodeCode(U)):U}E.name=D},unlink:function(E,M){E=Ui.join2(Fi.realPath(E),M);try{Ai.unlinkSync(E)}catch(D){throw D.code?new ie.ErrnoError(Fi.convertNodeCode(D)):D}},rmdir:function(E,M){E=Ui.join2(Fi.realPath(E),M);try{Ai.rmdirSync(E)}catch(D){throw D.code?new ie.ErrnoError(Fi.convertNodeCode(D)):D}},readdir:function(E){E=Fi.realPath(E);try{return Ai.readdirSync(E)}catch(M){throw M.code?new ie.ErrnoError(Fi.convertNodeCode(M)):M}},symlink:function(E,M,D){E=Ui.join2(Fi.realPath(E),M);try{Ai.symlinkSync(D,E)}catch(B){throw B.code?new ie.ErrnoError(Fi.convertNodeCode(B)):B}},readlink:function(E){var M=Fi.realPath(E);try{return M=Ai.readlinkSync(M),z.relative(z.resolve(E.mount.opts.root),M)}catch(D){throw D.code?D.code==="UNKNOWN"?new ie.ErrnoError(28):new ie.ErrnoError(Fi.convertNodeCode(D)):D}}},stream_ops:{open:function(E){var M=Fi.realPath(E.node);try{ie.isFile(E.node.mode)&&(E.nfd=Ai.openSync(M,Fi.flagsForNode(E.flags)))}catch(D){throw D.code?new ie.ErrnoError(Fi.convertNodeCode(D)):D}},close:function(E){try{ie.isFile(E.node.mode)&&E.nfd&&Ai.closeSync(E.nfd)}catch(M){throw M.code?new ie.ErrnoError(Fi.convertNodeCode(M)):M}},read:function(E,M,D,B,$){if(B===0)return 0;try{return Ai.readSync(E.nfd,Buffer.from(M.buffer),D,B,$)}catch(U){throw new ie.ErrnoError(Fi.convertNodeCode(U))}},write:function(E,M,D,B,$){try{return Ai.writeSync(E.nfd,Buffer.from(M.buffer),D,B,$)}catch(U){throw new ie.ErrnoError(Fi.convertNodeCode(U))}},llseek:function(E,M,D){if(D===1)M+=E.position;else if(D===2&&ie.isFile(E.node.mode))try{M+=Ai.fstatSync(E.nfd).size}catch(B){throw new ie.ErrnoError(Fi.convertNodeCode(B))}if(M<0)throw new ie.ErrnoError(28);return M},mmap:function(E,M,D,B,$){if(!ie.isFile(E.node.mode))throw new ie.ErrnoError(43);var U=en(M);return Fi.stream_ops.read(E,Ci,U,M,D),{ptr:U,allocated:!0}},msync:function(E,M,D,B,$){if(ie.isFile(E.node.mode))return 2&$||Fi.stream_ops.write(E,M,0,B,D,!1),0;throw new ie.ErrnoError(43)}}},Ln={DIR_MODE:16895,FILE_MODE:33279,reader:null,mount:function(E){ei(At),Ln.reader||(Ln.reader=new FileReaderSync);var M=Ln.createNode(null,"/",Ln.DIR_MODE,0),D={};function B(U){for(var Z=U.split("/"),K=M,me=0;me<Z.length-1;me++){var we=Z.slice(0,me+1).join("/");D[we]||(D[we]=Ln.createNode(K,Z[me],Ln.DIR_MODE,0)),K=D[we]}return K}function $(U){return U=U.split("/"),U[U.length-1]}return Array.prototype.forEach.call(E.opts.files||[],function(U){Ln.createNode(B(U.name),$(U.name),Ln.FILE_MODE,0,U,U.lastModifiedDate)}),(E.opts.blobs||[]).forEach(function(U){Ln.createNode(B(U.name),$(U.name),Ln.FILE_MODE,0,U.data)}),(E.opts.packages||[]).forEach(function(U){U.metadata.files.forEach(function(Z){var K=Z.filename.substr(1);Ln.createNode(B(K),$(K),Ln.FILE_MODE,0,U.blob.slice(Z.start,Z.end))})}),M},createNode:function(E,M,D,B,$,U){var Z=ie.createNode(E,M,D);return Z.mode=D,Z.node_ops=Ln.node_ops,Z.stream_ops=Ln.stream_ops,Z.timestamp=(U||new Date).getTime(),ei(Ln.FILE_MODE!==Ln.DIR_MODE),D===Ln.FILE_MODE?(Z.size=$.size,Z.contents=$):(Z.size=4096,Z.contents={}),E&&(E.contents[M]=Z),Z},node_ops:{getattr:function(E){return{dev:1,ino:E.id,mode:E.mode,nlink:1,uid:0,gid:0,rdev:void 0,size:E.size,atime:new Date(E.timestamp),mtime:new Date(E.timestamp),ctime:new Date(E.timestamp),blksize:4096,blocks:Math.ceil(E.size/4096)}},setattr:function(E,M){M.mode!==void 0&&(E.mode=M.mode),M.timestamp!==void 0&&(E.timestamp=M.timestamp)},lookup:function(E,M){throw new ie.ErrnoError(44)},mknod:function(E,M,D,B){throw new ie.ErrnoError(63)},rename:function(E,M,D){throw new ie.ErrnoError(63)},unlink:function(E,M){throw new ie.ErrnoError(63)},rmdir:function(E,M){throw new ie.ErrnoError(63)},readdir:function(E){var M,D=[".",".."];for(M in E.contents)E.contents.hasOwnProperty(M)&&D.push(M);return D},symlink:function(E,M,D){throw new ie.ErrnoError(63)},readlink:function(E){throw new ie.ErrnoError(63)}},stream_ops:{read:function(E,M,D,B,$){return $>=E.node.size?0:(E=E.node.contents.slice($,$+B),$=Ln.reader.readAsArrayBuffer(E),M.set(new Uint8Array($),D),E.size)},write:function(E,M,D,B,$){throw new ie.ErrnoError(29)},llseek:function(E,M,D){if(D===1?M+=E.position:D===2&&ie.isFile(E.node.mode)&&(M+=E.node.size),M<0)throw new ie.ErrnoError(28);return M}}},ie={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(E){var M=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(!(E=go.resolve(ie.cwd(),E)))return{path:"",node:null};if(8<(M=Object.assign({follow_mount:!0,recurse_count:0},M)).recurse_count)throw new ie.ErrnoError(32);for(var D=Ui.normalizeArray(E.split("/").filter(function(we){return!!we}),!1),B=ie.root,$="/",U=0;U<D.length;U++){var Z=U===D.length-1;if(Z&&M.parent)break;if(B=ie.lookupNode(B,D[U]),$=Ui.join2($,D[U]),!ie.isMountpoint(B)||Z&&!M.follow_mount||(B=B.mounted.root),!Z||M.follow)for(var K=0;ie.isLink(B.mode);){var me=ie.readlink($),$=go.resolve(Ui.dirname($),me),B=ie.lookupPath($,{recurse_count:M.recurse_count+1}).node;if(40<K++)throw new ie.ErrnoError(32)}}return{path:$,node:B}},getPath:function(E){for(var M,D;;){if(ie.isRoot(E))return D=E.mount.mountpoint,M?D[D.length-1]!=="/"?D+"/"+M:D+M:D;M=M?E.name+"/"+M:E.name,E=E.parent}},hashName:function(E,M){for(var D=0,B=0;B<M.length;B++)D=(D<<5)-D+M.charCodeAt(B)|0;return(E+D>>>0)%ie.nameTable.length},hashAddNode:function(E){var M=ie.hashName(E.parent.id,E.name);E.name_next=ie.nameTable[M],ie.nameTable[M]=E},hashRemoveNode:function(E){var M=ie.hashName(E.parent.id,E.name);if(ie.nameTable[M]===E)ie.nameTable[M]=E.name_next;else for(var D=ie.nameTable[M];D;){if(D.name_next===E){D.name_next=E.name_next;break}D=D.name_next}},lookupNode:function(E,M){var D=ie.mayLookup(E);if(D)throw new ie.ErrnoError(D,E);for(var D=ie.hashName(E.id,M),B=ie.nameTable[D];B;B=B.name_next){var $=B.name;if(B.parent.id===E.id&&$===M)return B}return ie.lookup(E,M)},createNode:function(E,M,D,B){return E=new ie.FSNode(E,M,D,B),ie.hashAddNode(E),E},destroyNode:function(E){ie.hashRemoveNode(E)},isRoot:function(E){return E===E.parent},isMountpoint:function(E){return!!E.mounted},isFile:function(E){return(61440&E)==32768},isDir:function(E){return(61440&E)==16384},isLink:function(E){return(61440&E)==40960},isChrdev:function(E){return(61440&E)==8192},isBlkdev:function(E){return(61440&E)==24576},isFIFO:function(E){return(61440&E)==4096},isSocket:function(E){return(49152&E)==49152},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(E){var M=ie.flagModes[E];if(M===void 0)throw new Error("Unknown file open mode: "+E);return M},flagsToPermissionString:function(E){var M=["r","w","rw"][3&E];return 512&E&&(M+="w"),M},nodePermissions:function(E,M){return ie.ignorePermissions||(!M.includes("r")||292&E.mode)&&(!M.includes("w")||146&E.mode)&&(!M.includes("x")||73&E.mode)?0:2},mayLookup:function(E){var M=ie.nodePermissions(E,"x");return M||(E.node_ops.lookup?0:2)},mayCreate:function(E,M){try{return ie.lookupNode(E,M),20}catch{}return ie.nodePermissions(E,"wx")},mayDelete:function(E,M,D){var B;try{B=ie.lookupNode(E,M)}catch($){return $.errno}if(M=ie.nodePermissions(E,"wx"),M)return M;if(D){if(!ie.isDir(B.mode))return 54;if(ie.isRoot(B)||ie.getPath(B)===ie.cwd())return 10}else if(ie.isDir(B.mode))return 31;return 0},mayOpen:function(E,M){return E?ie.isLink(E.mode)?32:ie.isDir(E.mode)&&(ie.flagsToPermissionString(M)!=="r"||512&M)?31:ie.nodePermissions(E,ie.flagsToPermissionString(M)):44},MAX_OPEN_FDS:4096,nextfd:function(){for(var E=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,M=1<arguments.length&&arguments[1]!==void 0?arguments[1]:ie.MAX_OPEN_FDS,D=E;D<=M;D++)if(!ie.streams[D])return D;throw new ie.ErrnoError(33)},getStream:function(E){return ie.streams[E]},createStream:function(E,M,D){return ie.FSStream||(ie.FSStream=function(){this.shared={}},ie.FSStream.prototype={},Object.defineProperties(ie.FSStream.prototype,{object:{get:function(){return this.node},set:function(B){this.node=B}},isRead:{get:function(){return(2097155&this.flags)!=1}},isWrite:{get:function(){return(2097155&this.flags)!=0}},isAppend:{get:function(){return 1024&this.flags}},flags:{get:function(){return this.shared.flags},set:function(B){this.shared.flags=B}},position:{get:function(){return this.shared.position},set:function(B){this.shared.position=B}}})),E=Object.assign(new ie.FSStream,E),M=ie.nextfd(M,D),E.fd=M,ie.streams[M]=E},closeStream:function(E){ie.streams[E]=null},chrdev_stream_ops:{open:function(E){var M=ie.getDevice(E.node.rdev);E.stream_ops=M.stream_ops,E.stream_ops.open&&E.stream_ops.open(E)},llseek:function(){throw new ie.ErrnoError(70)}},major:function(E){return E>>8},minor:function(E){return 255&E},makedev:function(E,M){return E<<8|M},registerDevice:function(E,M){ie.devices[E]={stream_ops:M}},getDevice:function(E){return ie.devices[E]},getMounts:function(E){for(var M=[],D=[E];D.length;){var B=D.pop();M.push(B),D.push.apply(D,B.mounts)}return M},syncfs:function(E,M){typeof E=="function"&&(M=E,E=!1),ie.syncFSRequests++,1<ie.syncFSRequests&&hi("warning: "+ie.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var D=ie.getMounts(ie.root.mount),B=0;function $(Z){return ie.syncFSRequests--,M(Z)}function U(Z){if(Z)return U.errored?void 0:(U.errored=!0,$(Z));++B>=D.length&&$(null)}D.forEach(function(Z){if(!Z.type.syncfs)return U(null);Z.type.syncfs(Z,E,U)})},mount:function(E,M,D){var B,$=D==="/",U=!D;if($&&ie.root)throw new ie.ErrnoError(10);if(!$&&!U){if(U=ie.lookupPath(D,{follow_mount:!1}),D=U.path,B=U.node,ie.isMountpoint(B))throw new ie.ErrnoError(10);if(!ie.isDir(B.mode))throw new ie.ErrnoError(54)}return U={type:E,opts:M,mountpoint:D,mounts:[]},M=E.mount(U),(M.mount=U).root=M,$?ie.root=M:B&&(B.mounted=U,B.mount&&B.mount.mounts.push(U)),M},unmount:function(M){if(M=ie.lookupPath(M,{follow_mount:!1}),!ie.isMountpoint(M.node))throw new ie.ErrnoError(28);var M=M.node,B=M.mounted,D=ie.getMounts(B),B=(Object.keys(ie.nameTable).forEach(function($){for(var U=ie.nameTable[$];U;){var Z=U.name_next;D.includes(U.mount)&&ie.destroyNode(U),U=Z}}),M.mounted=null,M.mount.mounts.indexOf(B));M.mount.mounts.splice(B,1)},lookup:function(E,M){return E.node_ops.lookup(E,M)},mknod:function($,M,D){var B=ie.lookupPath($,{parent:!0}).node,$=Ui.basename($);if(!$||$==="."||$==="..")throw new ie.ErrnoError(28);var U=ie.mayCreate(B,$);if(U)throw new ie.ErrnoError(U);if(B.node_ops.mknod)return B.node_ops.mknod(B,$,M,D);throw new ie.ErrnoError(63)},create:function(E,M){return ie.mknod(E,M=(M=M!==void 0?M:438)&4095|32768,0)},mkdir:function(E,M){return ie.mknod(E,M=(M=M!==void 0?M:511)&1023|16384,0)},mkdirTree:function(E,M){for(var D=E.split("/"),B="",$=0;$<D.length;++$)if(D[$]){B+="/"+D[$];try{ie.mkdir(B,M)}catch(U){if(U.errno!=20)throw U}}},mkdev:function(E,M,D){return D===void 0&&(D=M,M=438),ie.mknod(E,M|=8192,D)},symlink:function(E,B){if(!go.resolve(E))throw new ie.ErrnoError(44);var D=ie.lookupPath(B,{parent:!0}).node;if(!D)throw new ie.ErrnoError(44);var B=Ui.basename(B),$=ie.mayCreate(D,B);if($)throw new ie.ErrnoError($);if(D.node_ops.symlink)return D.node_ops.symlink(D,B,E);throw new ie.ErrnoError(63)},rename:function(Se,M){var D=Ui.dirname(Se),B=Ui.dirname(M),$=Ui.basename(Se),U=Ui.basename(M),Z=ie.lookupPath(Se,{parent:!0}),Z=Z.node,K=ie.lookupPath(M,{parent:!0}).node;if(!Z||!K)throw new ie.ErrnoError(44);if(Z.mount!==K.mount)throw new ie.ErrnoError(75);var me,we=ie.lookupNode(Z,$),Se=go.relative(Se,B);if(Se.charAt(0)!==".")throw new ie.ErrnoError(28);if((Se=go.relative(M,D)).charAt(0)!==".")throw new ie.ErrnoError(55);try{me=ie.lookupNode(K,U)}catch{}if(we!==me){if(B=ie.isDir(we.mode),M=ie.mayDelete(Z,$,B),M)throw new ie.ErrnoError(M);if(M=me?ie.mayDelete(K,U,B):ie.mayCreate(K,U))throw new ie.ErrnoError(M);if(!Z.node_ops.rename)throw new ie.ErrnoError(63);if(ie.isMountpoint(we)||me&&ie.isMountpoint(me))throw new ie.ErrnoError(10);if(K!==Z&&(M=ie.nodePermissions(Z,"w")))throw new ie.ErrnoError(M);ie.hashRemoveNode(we);try{Z.node_ops.rename(we,K,U)}catch(Ue){throw Ue}finally{ie.hashAddNode(we)}}},rmdir:function(D){var M=ie.lookupPath(D,{parent:!0}).node,D=Ui.basename(D),B=ie.lookupNode(M,D),$=ie.mayDelete(M,D,!0);if($)throw new ie.ErrnoError($);if(!M.node_ops.rmdir)throw new ie.ErrnoError(63);if(ie.isMountpoint(B))throw new ie.ErrnoError(10);M.node_ops.rmdir(M,D),ie.destroyNode(B)},readdir:function(E){if(E=ie.lookupPath(E,{follow:!0}).node,E.node_ops.readdir)return E.node_ops.readdir(E);throw new ie.ErrnoError(54)},unlink:function(D){var M=ie.lookupPath(D,{parent:!0}).node;if(!M)throw new ie.ErrnoError(44);var D=Ui.basename(D),B=ie.lookupNode(M,D),$=ie.mayDelete(M,D,!1);if($)throw new ie.ErrnoError($);if(!M.node_ops.unlink)throw new ie.ErrnoError(63);if(ie.isMountpoint(B))throw new ie.ErrnoError(10);M.node_ops.unlink(M,D),ie.destroyNode(B)},readlink:function(E){if(E=ie.lookupPath(E).node,!E)throw new ie.ErrnoError(44);if(E.node_ops.readlink)return go.resolve(ie.getPath(E.parent),E.node_ops.readlink(E));throw new ie.ErrnoError(28)},stat:function(E,M){if(E=ie.lookupPath(E,{follow:!M}).node,!E)throw new ie.ErrnoError(44);if(E.node_ops.getattr)return E.node_ops.getattr(E);throw new ie.ErrnoError(63)},lstat:function(E){return ie.stat(E,!0)},chmod:function(E,M,D){if(!(D=typeof E=="string"?ie.lookupPath(E,{follow:!D}).node:E).node_ops.setattr)throw new ie.ErrnoError(63);D.node_ops.setattr(D,{mode:4095&M|-4096&D.mode,timestamp:Date.now()})},lchmod:function(E,M){ie.chmod(E,M,!0)},fchmod:function(E,M){if(E=ie.getStream(E),!E)throw new ie.ErrnoError(8);ie.chmod(E.node,M)},chown:function(E,M,D,B){if(!(B=typeof E=="string"?ie.lookupPath(E,{follow:!B}).node:E).node_ops.setattr)throw new ie.ErrnoError(63);B.node_ops.setattr(B,{timestamp:Date.now()})},lchown:function(E,M,D){ie.chown(E,M,D,!0)},fchown:function(E,M,D){if(E=ie.getStream(E),!E)throw new ie.ErrnoError(8);ie.chown(E.node,M,D)},truncate:function(E,M){if(M<0)throw new ie.ErrnoError(28);if(!(E=typeof E=="string"?ie.lookupPath(E,{follow:!0}).node:E).node_ops.setattr)throw new ie.ErrnoError(63);if(ie.isDir(E.mode))throw new ie.ErrnoError(31);if(!ie.isFile(E.mode))throw new ie.ErrnoError(28);var D=ie.nodePermissions(E,"w");if(D)throw new ie.ErrnoError(D);E.node_ops.setattr(E,{size:M,timestamp:Date.now()})},ftruncate:function(E,M){if(E=ie.getStream(E),!E)throw new ie.ErrnoError(8);if((2097155&E.flags)==0)throw new ie.ErrnoError(28);ie.truncate(E.node,M)},utime:function(E,M,D){E=ie.lookupPath(E,{follow:!0}).node,E.node_ops.setattr(E,{timestamp:Math.max(M,D)})},open:function(E,M,D){if(E==="")throw new ie.ErrnoError(44);if(D=D===void 0?438:D,D=64&(M=typeof M=="string"?ie.modeStringToFlags(M):M)?4095&D|32768:0,a(E)=="object")B=E;else{E=Ui.normalize(E);try{var B=ie.lookupPath(E,{follow:!(131072&M)}).node}catch{}}var $=!1;if(64&M)if(B){if(128&M)throw new ie.ErrnoError(20)}else B=ie.mknod(E,D,0),$=!0;if(!B)throw new ie.ErrnoError(44);if(ie.isChrdev(B.mode)&&(M&=-513),65536&M&&!ie.isDir(B.mode))throw new ie.ErrnoError(54);if(!$&&(D=ie.mayOpen(B,M),D))throw new ie.ErrnoError(D);return 512&M&&!$&&ie.truncate(B,0),M&=-131713,D=ie.createStream({node:B,path:ie.getPath(B),flags:M,seekable:!0,position:0,stream_ops:B.stream_ops,ungotten:[],error:!1}),D.stream_ops.open&&D.stream_ops.open(D),!q.logReadFiles||1&M||(ie.readFiles||(ie.readFiles={}),E in ie.readFiles||(ie.readFiles[E]=1)),D},close:function(E){if(ie.isClosed(E))throw new ie.ErrnoError(8);E.getdents&&(E.getdents=null);try{E.stream_ops.close&&E.stream_ops.close(E)}catch(M){throw M}finally{ie.closeStream(E.fd)}E.fd=null},isClosed:function(E){return E.fd===null},llseek:function(E,M,D){if(ie.isClosed(E))throw new ie.ErrnoError(8);if(!E.seekable||!E.stream_ops.llseek)throw new ie.ErrnoError(70);if(D!=0&&D!=1&&D!=2)throw new ie.ErrnoError(28);return E.position=E.stream_ops.llseek(E,M,D),E.ungotten=[],E.position},read:function(E,M,D,B,$){if(B<0||$<0)throw new ie.ErrnoError(28);if(ie.isClosed(E))throw new ie.ErrnoError(8);if((2097155&E.flags)==1)throw new ie.ErrnoError(8);if(ie.isDir(E.node.mode))throw new ie.ErrnoError(31);if(!E.stream_ops.read)throw new ie.ErrnoError(28);var U=$!==void 0;if(U){if(!E.seekable)throw new ie.ErrnoError(70)}else $=E.position;return M=E.stream_ops.read(E,M,D,B,$),U||(E.position+=M),M},write:function(E,M,D,B,$,U){if(B<0||$<0)throw new ie.ErrnoError(28);if(ie.isClosed(E))throw new ie.ErrnoError(8);if((2097155&E.flags)==0)throw new ie.ErrnoError(8);if(ie.isDir(E.node.mode))throw new ie.ErrnoError(31);if(!E.stream_ops.write)throw new ie.ErrnoError(28);E.seekable&&1024&E.flags&&ie.llseek(E,0,2);var Z=$!==void 0;if(Z){if(!E.seekable)throw new ie.ErrnoError(70)}else $=E.position;return M=E.stream_ops.write(E,M,D,B,$,U),Z||(E.position+=M),M},allocate:function(E,M,D){if(ie.isClosed(E))throw new ie.ErrnoError(8);if(M<0||D<=0)throw new ie.ErrnoError(28);if((2097155&E.flags)==0)throw new ie.ErrnoError(8);if(!ie.isFile(E.node.mode)&&!ie.isDir(E.node.mode))throw new ie.ErrnoError(43);if(!E.stream_ops.allocate)throw new ie.ErrnoError(138);E.stream_ops.allocate(E,M,D)},mmap:function(E,M,D,B,$){if((2&B)!=0&&(2&$)==0&&(2097155&E.flags)!=2)throw new ie.ErrnoError(2);if((2097155&E.flags)==1)throw new ie.ErrnoError(2);if(E.stream_ops.mmap)return E.stream_ops.mmap(E,M,D,B,$);throw new ie.ErrnoError(43)},msync:function(E,M,D,B,$){return E&&E.stream_ops.msync?E.stream_ops.msync(E,M,D,B,$):0},munmap:function(E){return 0},ioctl:function(E,M,D){if(E.stream_ops.ioctl)return E.stream_ops.ioctl(E,M,D);throw new ie.ErrnoError(59)},readFile:function($){var M,D=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(D.flags=D.flags||0,D.encoding=D.encoding||"binary",D.encoding!=="utf8"&&D.encoding!=="binary")throw new Error('Invalid encoding type "'+D.encoding+'"');var B=ie.open($,D.flags),$=ie.stat($).size,U=new Uint8Array($);return ie.read(B,U,0,$,0),D.encoding==="utf8"?M=ka(U,0):D.encoding==="binary"&&(M=U),ie.close(B),M},writeFile:function(B,M){var D=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},B=(D.flags=D.flags||577,ie.open(B,D.flags,D.mode));if(typeof M=="string"){var $=new Uint8Array(Pa(M)+1),U=Go(M,$,0,$.length);ie.write(B,$,0,U,void 0,D.canOwn)}else{if(!ArrayBuffer.isView(M))throw new Error("Unsupported data type");ie.write(B,M,0,M.byteLength,void 0,D.canOwn)}ie.close(B)},cwd:function(){return ie.currentPath},chdir:function(E){if(E=ie.lookupPath(E,{follow:!0}),E.node===null)throw new ie.ErrnoError(44);if(!ie.isDir(E.node.mode))throw new ie.ErrnoError(54);var M=ie.nodePermissions(E.node,"x");if(M)throw new ie.ErrnoError(M);ie.currentPath=E.path},createDefaultDirectories:function(){ie.mkdir("/tmp"),ie.mkdir("/home"),ie.mkdir("/home/web_user")},createDefaultDevices:function(){ie.mkdir("/dev"),ie.registerDevice(ie.makedev(1,3),{read:function(){return 0},write:function(M,D,B,$,U){return $}}),ie.mkdev("/dev/null",ie.makedev(1,3)),Zo.register(ie.makedev(5,0),Zo.default_tty_ops),Zo.register(ie.makedev(6,0),Zo.default_tty1_ops),ie.mkdev("/dev/tty",ie.makedev(5,0)),ie.mkdev("/dev/tty1",ie.makedev(6,0));var E=na();ie.createDevice("/dev","random",E),ie.createDevice("/dev","urandom",E),ie.mkdir("/dev/shm"),ie.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){ie.mkdir("/proc");var E=ie.mkdir("/proc/self");ie.mkdir("/proc/self/fd"),ie.mount({mount:function(){var M=ie.createNode(E,"fd",16895,73);return M.node_ops={lookup:function(D,B){var $=ie.getStream(+B);if(!$)throw new ie.ErrnoError(8);return B={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return $.path}}},B.parent=B}},M}},{},"/proc/self/fd")},createStandardStreams:function(){q.stdin?ie.createDevice("/dev","stdin",q.stdin):ie.symlink("/dev/tty","/dev/stdin"),q.stdout?ie.createDevice("/dev","stdout",null,q.stdout):ie.symlink("/dev/tty","/dev/stdout"),q.stderr?ie.createDevice("/dev","stderr",null,q.stderr):ie.symlink("/dev/tty1","/dev/stderr"),ie.open("/dev/stdin",0),ie.open("/dev/stdout",1),ie.open("/dev/stderr",1)},ensureErrnoError:function(){ie.ErrnoError||(ie.ErrnoError=function(E,M){this.node=M,this.setErrno=function(D){this.errno=D},this.setErrno(E),this.message="FS error"},ie.ErrnoError.prototype=new Error,ie.ErrnoError.prototype.constructor=ie.ErrnoError,[44].forEach(function(E){ie.genericErrors[E]=new ie.ErrnoError(E),ie.genericErrors[E].stack="<generic error, no stack>"}))},staticInit:function(){ie.ensureErrnoError(),ie.nameTable=new Array(4096),ie.mount(Ni,{},"/"),ie.createDefaultDirectories(),ie.createDefaultDevices(),ie.createSpecialDirectories(),ie.filesystems={MEMFS:Ni,NODEFS:Fi,WORKERFS:Ln}},init:function(E,M,D){ie.init.initialized=!0,ie.ensureErrnoError(),q.stdin=E||q.stdin,q.stdout=M||q.stdout,q.stderr=D||q.stderr,ie.createStandardStreams()},quit:function(){ie.init.initialized=!1;for(var E=0;E<ie.streams.length;E++){var M=ie.streams[E];M&&ie.close(M)}},getMode:function(E,M){var D=0;return E&&(D|=365),M&&(D|=146),D},findObject:function(E,M){return E=ie.analyzePath(E,M),E.exists?E.object:null},analyzePath:function(E,M){try{E=(B=ie.lookupPath(E,{follow:!M})).path}catch{}var D={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var B=ie.lookupPath(E,{parent:!0});D.parentExists=!0,D.parentPath=B.path,D.parentObject=B.node,D.name=Ui.basename(E),B=ie.lookupPath(E,{follow:!M}),D.exists=!0,D.path=B.path,D.object=B.node,D.name=B.node.name,D.isRoot=B.path==="/"}catch($){D.error=$.errno}return D},createPath:function(E,M,D,B){E=typeof E=="string"?E:ie.getPath(E);for(var $=M.split("/").reverse();$.length;){var U=$.pop();if(U){var Z=Ui.join2(E,U);try{ie.mkdir(Z)}catch{}E=Z}}return Z},createFile:function(E,M,D,B,$){return E=Ui.join2(typeof E=="string"?E:ie.getPath(E),M),M=ie.getMode(B,$),ie.create(E,M)},createDataFile:function(me,K,D,B,$,U){var Z=K,K=(me&&(me=typeof me=="string"?me:ie.getPath(me),Z=K?Ui.join2(me,K):me),ie.getMode(B,$)),me=ie.create(Z,K);if(D){if(typeof D=="string"){for(var we=new Array(D.length),Se=0,Ue=D.length;Se<Ue;++Se)we[Se]=D.charCodeAt(Se);D=we}ie.chmod(me,146|K),B=ie.open(me,577),ie.write(B,D,0,D.length,0,U),ie.close(B),ie.chmod(me,K)}return me},createDevice:function($,U,D,B){var $=Ui.join2(typeof $=="string"?$:ie.getPath($),U),U=ie.getMode(!!D,!!B),Z=(ie.createDevice.major||(ie.createDevice.major=64),ie.makedev(ie.createDevice.major++,0));return ie.registerDevice(Z,{open:function(K){K.seekable=!1},close:function(K){B&&B.buffer&&B.buffer.length&&B(10)},read:function(K,me,we,Se,Ue){for(var tt,bt=0,or=0;or<Se;or++){try{tt=D()}catch{throw new ie.ErrnoError(29)}if(tt===void 0&&bt===0)throw new ie.ErrnoError(6);if(tt==null)break;bt++,me[we+or]=tt}return bt&&(K.node.timestamp=Date.now()),bt},write:function(K,me,we,Se,Ue){for(var tt=0;tt<Se;tt++)try{B(me[we+tt])}catch{throw new ie.ErrnoError(29)}return Se&&(K.node.timestamp=Date.now()),tt}}),ie.mkdev($,U,Z)},forceLoadFile:function(E){if(E.isDevice||E.isFolder||E.link||E.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!$i)throw new Error("Cannot load without read() or XMLHttpRequest.");try{E.contents=ga($i(E.url),!0),E.usedBytes=E.contents.length}catch{throw new ie.ErrnoError(29)}},createLazyFile:function(E,M,D,B,$){function U(){this.lengthKnown=!1,this.chunks=[]}if(U.prototype.get=function(Se){var Ue;if(!(Se>this.length-1||Se<0))return Ue=Se%this.chunkSize,Se=Se/this.chunkSize|0,this.getter(Se)[Ue]},U.prototype.setDataGetter=function(Se){this.getter=Se},U.prototype.cacheLength=function(){var bt=new XMLHttpRequest;if(bt.open("HEAD",D,!1),bt.send(null),!(200<=bt.status&&bt.status<300||bt.status===304))throw new Error("Couldn't load "+D+". Status: "+bt.status);var Se,Ue=Number(bt.getResponseHeader("Content-length")),tt=(Se=bt.getResponseHeader("Accept-Ranges"))&&Se==="bytes",bt=(Se=bt.getResponseHeader("Content-Encoding"))&&Se==="gzip",or=1048576,$r=(tt||(or=Ue),this);$r.setDataGetter(function(Fr){var Ht=Fr*or,vi=(Fr+1)*or-1,vi=Math.min(vi,Ue-1);if($r.chunks[Fr]===void 0&&($r.chunks[Fr]=function(Ii,ln){if(ln<Ii)throw new Error("invalid range ("+Ii+", "+ln+") or no bytes requested!");if(Ue-1<ln)throw new Error("only "+Ue+" bytes available! programmer error!");var un=new XMLHttpRequest;if(un.open("GET",D,!1),Ue!==or&&un.setRequestHeader("Range","bytes="+Ii+"-"+ln),un.responseType="arraybuffer",un.overrideMimeType&&un.overrideMimeType("text/plain; charset=x-user-defined"),un.send(null),200<=un.status&&un.status<300||un.status===304)return un.response!==void 0?new Uint8Array(un.response||[]):ga(un.responseText||"",!0);throw new Error("Couldn't load "+D+". Status: "+un.status)}(Ht,vi)),$r.chunks[Fr]===void 0)throw new Error("doXHR failed!");return $r.chunks[Fr]}),!bt&&Ue||(or=Ue=1,Ue=this.getter(0).length,or=Ue,Yr("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Ue,this._chunkSize=or,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!At)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var Z=new U,Z=(Object.defineProperties(Z,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}}),{isDevice:!1,contents:Z})}else Z={isDevice:!1,url:D};var K=ie.createFile(E,M,Z,B,$),me=(Z.contents?K.contents=Z.contents:Z.url&&(K.contents=null,K.url=Z.url),Object.defineProperties(K,{usedBytes:{get:function(){return this.contents.length}}}),{});function we(Se,Ue,tt,bt,or){var $r=Se.node.contents;if(or>=$r.length)return 0;var Fr=Math.min($r.length-or,bt);if($r.slice)for(var Ht=0;Ht<Fr;Ht++)Ue[tt+Ht]=$r[or+Ht];else for(Ht=0;Ht<Fr;Ht++)Ue[tt+Ht]=$r.get(or+Ht);return Fr}return Object.keys(K.stream_ops).forEach(function(Se){var Ue=K.stream_ops[Se];me[Se]=function(){return ie.forceLoadFile(K),Ue.apply(null,arguments)}}),me.read=function(Se,Ue,tt,bt,or){return ie.forceLoadFile(K),we(Se,Ue,tt,bt,or)},me.mmap=function(Se,Ue,tt,bt,or){ie.forceLoadFile(K);var $r=en(Ue);if($r)return we(Se,Ci,$r,Ue,tt),{ptr:$r,allocated:!0};throw new ie.ErrnoError(48)},K.stream_ops=me,K},createPreloadedFile:function(E,M,D,B,$,U,Z,K,me,we){var Se,Ue,tt,bt,or=M?go.resolve(Ui.join2(E,M)):E;function $r(Fr){function Ht(vi){we&&we(),K||ie.createDataFile(E,M,vi,B,$,me),U&&U(),ma()}Browser.handledByPreloadPlugin(Fr,or,Ht,function(){Z&&Z(),ma()})||Ht(Fr)}ra(),typeof D=="string"?(Se=D,Ue=function(Fr){$r(Fr)},tt=Z,bt="al "+Se,ji(Se,function(Fr){ei(Fr,'Loading data file "'+Se+'" failed (no arrayBuffer).'),Ue(new Uint8Array(Fr)),bt&&ma()},function(Fr){if(!tt)throw'Loading data file "'+Se+'" failed.';tt()}),bt&&ra()):$r(D)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(E,M,D){M=M||function(){},D=D||function(){};var B=ie.indexedDB();try{var $=B.open(ie.DB_NAME(),ie.DB_VERSION)}catch(U){return D(U)}$.onupgradeneeded=function(){Yr("creating db"),$.result.createObjectStore(ie.DB_STORE_NAME)},$.onsuccess=function(){var U=$.result.transaction([ie.DB_STORE_NAME],"readwrite"),Z=U.objectStore(ie.DB_STORE_NAME),K=0,me=0,we=E.length;function Se(){(me==0?M:D)()}E.forEach(function(Ue){Ue=Z.put(ie.analyzePath(Ue).object.contents,Ue),Ue.onsuccess=function(){++K+me==we&&Se()},Ue.onerror=function(){K+ ++me==we&&Se()}}),U.onerror=D},$.onerror=D},loadFilesFromDB:function(E,M,D){M=M||function(){},D=D||function(){};var B=ie.indexedDB();try{var $=B.open(ie.DB_NAME(),ie.DB_VERSION)}catch(U){return D(U)}$.onupgradeneeded=D,$.onsuccess=function(){var U=$.result;try{var Z=U.transaction([ie.DB_STORE_NAME],"readonly")}catch(tt){return void D(tt)}var K=Z.objectStore(ie.DB_STORE_NAME),me=0,we=0,Se=E.length;function Ue(){(we==0?M:D)()}E.forEach(function(tt){var bt=K.get(tt);bt.onsuccess=function(){ie.analyzePath(tt).exists&&ie.unlink(tt),ie.createDataFile(Ui.dirname(tt),Ui.basename(tt),bt.result,!0,!0,!0),++me+we==Se&&Ue()},bt.onerror=function(){me+ ++we==Se&&Ue()}}),Z.onerror=D},$.onerror=D}},Ri={DEFAULT_POLLMASK:5,calculateAt:function(E,M,D){if(Ui.isAbs(M))return M;var B;if(E===-100)B=ie.cwd();else{if(E=ie.getStream(E),!E)throw new ie.ErrnoError(8);B=E.path}if(M.length!=0)return Ui.join2(B,M);if(D)return B;throw new ie.ErrnoError(44)},doStat:function(E,M,D){try{var B=E(M)}catch($){if($&&$.node&&Ui.normalize(M)!==Ui.normalize(ie.getPath($.node)))return-54;throw $}return yr[D>>2]=B.dev,yr[D+4>>2]=0,yr[D+8>>2]=B.ino,yr[D+12>>2]=B.mode,yr[D+16>>2]=B.nlink,yr[D+20>>2]=B.uid,yr[D+24>>2]=B.gid,yr[D+28>>2]=B.rdev,yr[D+32>>2]=0,Hn=[B.size>>>0,(sn=B.size,1<=+Math.abs(sn)?0<sn?(0|Math.min(+Math.floor(sn/4294967296),4294967295))>>>0:~~+Math.ceil((sn-(~~sn>>>0))/4294967296)>>>0:0)],yr[D+40>>2]=Hn[0],yr[D+44>>2]=Hn[1],yr[D+48>>2]=4096,yr[D+52>>2]=B.blocks,yr[D+56>>2]=B.atime.getTime()/1e3|0,yr[D+64>>2]=0,yr[D+72>>2]=B.mtime.getTime()/1e3|0,yr[D+80>>2]=0,yr[D+88>>2]=B.ctime.getTime()/1e3|0,yr[D+96>>2]=0,Hn=[B.ino>>>0,(sn=B.ino,1<=+Math.abs(sn)?0<sn?(0|Math.min(+Math.floor(sn/4294967296),4294967295))>>>0:~~+Math.ceil((sn-(~~sn>>>0))/4294967296)>>>0:0)],yr[D+104>>2]=Hn[0],yr[D+108>>2]=Hn[1],0},doMsync:function(E,M,D,B,$){E=vn.slice(E,E+D),ie.msync(M,E,$,D,B)},varargs:void 0,get:function(){return Ri.varargs+=4,yr[Ri.varargs-4>>2]},getStr:function(E){return eo(E)},getStreamFromFD:function(E){if(E=ie.getStream(E),E)return E;throw new ie.ErrnoError(8)}};function Fo(E,M){return M+2097152>>>0<4194305-!!E?(E>>>0)+4294967296*M:NaN}var Vn={BUCKET_BUFFER_SIZE:8192,mount:function(E){return ie.createNode(null,"/",16895,0)},createPipe:function(){var B={buckets:[],refcnt:2},$=(B.buckets.push({buffer:new Uint8Array(Vn.BUCKET_BUFFER_SIZE),offset:0,roffset:0}),Vn.nextname()),E=Vn.nextname(),M=ie.createNode(Vn.root,$,4096,0),D=ie.createNode(Vn.root,E,4096,0),B=(M.pipe=B,D.pipe=B,ie.createStream({path:$,node:M,flags:0,seekable:!1,stream_ops:Vn.stream_ops})),$=(M.stream=B,ie.createStream({path:E,node:D,flags:1,seekable:!1,stream_ops:Vn.stream_ops}));return D.stream=$,{readable_fd:B.fd,writable_fd:$.fd}},stream_ops:{poll:function(E){var M=E.node.pipe;if((2097155&E.flags)==1)return 260;if(0<M.buckets.length)for(var D=0;D<M.buckets.length;D++){var B=M.buckets[D];if(0<B.offset-B.roffset)return 65}return 0},ioctl:function(E,M,D){return 28},fsync:function(E){return 28},read:function(E,M,D,B,$){for(var U=E.node.pipe,Z=0,K=0;K<U.buckets.length;K++){var me=U.buckets[K];Z+=me.offset-me.roffset}ei(M instanceof ArrayBuffer||ArrayBuffer.isView(M));var we=M.subarray(D,D+B);if(B<=0)return 0;if(Z==0)throw new ie.ErrnoError(6);for(var Se=Math.min(Z,B),E=Se,Ue=0,K=0;K<U.buckets.length;K++){var tt=U.buckets[K],bt=tt.offset-tt.roffset;if(Se<=bt){var or=tt.buffer.subarray(tt.roffset,tt.offset);Se<bt?(or=or.subarray(0,Se),tt.roffset+=Se):Ue++,we.set(or);break}or=tt.buffer.subarray(tt.roffset,tt.offset),we.set(or),we=we.subarray(or.byteLength),Se-=or.byteLength,Ue++}return Ue&&Ue==U.buckets.length&&(U.buckets[--Ue].offset=0,U.buckets[Ue].roffset=0),U.buckets.splice(0,Ue),E},write:function(K,M,D,B,$){var U=K.node.pipe,Z=(ei(M instanceof ArrayBuffer||ArrayBuffer.isView(M)),M.subarray(D,D+B)),K=Z.byteLength;if(K<=0)return 0;if(M=null,U.buckets.length==0?(M={buffer:new Uint8Array(Vn.BUCKET_BUFFER_SIZE),offset:0,roffset:0},U.buckets.push(M)):M=U.buckets[U.buckets.length-1],ei(M.offset<=Vn.BUCKET_BUFFER_SIZE),D=Vn.BUCKET_BUFFER_SIZE-M.offset,K<=D)return M.buffer.set(Z,M.offset),M.offset+=K,K;0<D&&(M.buffer.set(Z.subarray(0,D),M.offset),M.offset+=D,Z=Z.subarray(D,Z.byteLength));for(var me=Z.byteLength/Vn.BUCKET_BUFFER_SIZE|0,B=Z.byteLength%Vn.BUCKET_BUFFER_SIZE,we=0;we<me;we++){var Se={buffer:new Uint8Array(Vn.BUCKET_BUFFER_SIZE),offset:Vn.BUCKET_BUFFER_SIZE,roffset:0};U.buckets.push(Se),Se.buffer.set(Z.subarray(0,Vn.BUCKET_BUFFER_SIZE)),Z=Z.subarray(Vn.BUCKET_BUFFER_SIZE,Z.byteLength)}return 0<B&&(Se={buffer:new Uint8Array(Vn.BUCKET_BUFFER_SIZE),offset:Z.byteLength,roffset:0},U.buckets.push(Se),Se.buffer.set(Z)),K},close:function(E){E=E.node.pipe,E.refcnt--,E.refcnt===0&&(E.buckets=null)}},nextname:function(){return Vn.nextname.current||(Vn.nextname.current=0),"pipe["+Vn.nextname.current+++"]"}},Ho="To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking";function Xa(E){var M=Pa(E)+1,D=co(M);return D&&Go(E,Ci,D,M),D}function us(E,M,D){var B,$,U,Z,K;function me(we){return we=we.toTimeString().match(/\(([A-Za-z ]+)\)$/),we?we[1]:"GMT"}us.called||(us.called=!0,E=E,M=M,D=D,B=new Date().getFullYear(),$=new Date(B,0,1),B=new Date(B,6,1),U=$.getTimezoneOffset(),Z=B.getTimezoneOffset(),K=Math.max(U,Z),yr[E>>2]=60*K,yr[M>>2]=Number(U!=Z),E=me($),K=me(B),M=Xa(E),$=Xa(K),Z<U?(dn[D>>2]=M,dn[D+4>>2]=$):(dn[D>>2]=$,dn[D+4>>2]=M))}function La(){return 2147483648}var Ra=Tr?function(){var E=process.hrtime();return 1e3*E[0]+E[1]/1e6}:function(){return performance.now()},Za={};function Ha(){if(!Ha.strings){var E={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:((typeof navigator>"u"?"undefined":a(navigator))=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:lt||"./this.program"};for(M in Za)Za[M]===void 0?delete E[M]:E[M]=Za[M];var M,D=[];for(M in E)D.push(M+"="+E[M]);Ha.strings=D}return Ha.strings}function Wa(E,M){E=E,pn||(q.onExit&&q.onExit(E),pr=!0),kt(E,new cn(E))}function Ao(E,M){Ao.randomDevice||(Ao.randomDevice=na());for(var D=0;D<M;D++)Ci[E+D>>0]=Ao.randomDevice();return 0}function Ya(E){return E%4==0&&(E%100!=0||E%400==0)}var hs=[31,29,31,30,31,30,31,31,30,31,30,31],Tt=[31,28,31,30,31,30,31,31,30,31,30,31];function Wt(E,M,D,B){var $=yr[B+40>>2],U={tm_sec:yr[B>>2],tm_min:yr[B+4>>2],tm_hour:yr[B+8>>2],tm_mday:yr[B+12>>2],tm_mon:yr[B+16>>2],tm_year:yr[B+20>>2],tm_wday:yr[B+24>>2],tm_yday:yr[B+28>>2],tm_isdst:yr[B+32>>2],tm_gmtoff:yr[B+36>>2],tm_zone:$?eo($):""},Fr=eo(D),Z={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(or in Z)Fr=Fr.replace(new RegExp(or,"g"),Z[or]);var K=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],me=["January","February","March","April","May","June","July","August","September","October","November","December"];function we(Ht,vi,Ii){for(var ln=typeof Ht=="number"?Ht.toString():Ht||"";ln.length<vi;)ln=Ii[0]+ln;return ln}function Se(Ht,vi){return we(Ht,vi,"0")}function Ue(Ht,vi){function Ii(un){return un<0?-1:0<un?1:0}var ln;return ln=(ln=Ii(Ht.getFullYear()-vi.getFullYear()))===0&&(ln=Ii(Ht.getMonth()-vi.getMonth()))===0?Ii(Ht.getDate()-vi.getDate()):ln}function tt(Ht){switch(Ht.getDay()){case 0:return new Date(Ht.getFullYear()-1,11,29);case 1:return Ht;case 2:return new Date(Ht.getFullYear(),0,3);case 3:return new Date(Ht.getFullYear(),0,2);case 4:return new Date(Ht.getFullYear(),0,1);case 5:return new Date(Ht.getFullYear()-1,11,31);case 6:return new Date(Ht.getFullYear()-1,11,30)}}function bt(vi){var vi=function(un,Io){for(var Kn=new Date(un.getTime());0<Io;){var Ua=Ya(Kn.getFullYear()),Ja=Kn.getMonth(),Ua=(Ua?hs:Tt)[Ja];if(!(Io>Ua-Kn.getDate()))return Kn.setDate(Kn.getDate()+Io),Kn;Io-=Ua-Kn.getDate()+1,Kn.setDate(1),Ja<11?Kn.setMonth(Ja+1):(Kn.setMonth(0),Kn.setFullYear(Kn.getFullYear()+1))}return Kn}(new Date(vi.tm_year+1900,0,1),vi.tm_yday),Ii=new Date(vi.getFullYear(),0,4),ln=new Date(vi.getFullYear()+1,0,4),Ii=tt(Ii),ln=tt(ln);return Ue(Ii,vi)<=0?Ue(ln,vi)<=0?vi.getFullYear()+1:vi.getFullYear():vi.getFullYear()-1}var or,$r={"%a":function(Ht){return K[Ht.tm_wday].substring(0,3)},"%A":function(Ht){return K[Ht.tm_wday]},"%b":function(Ht){return me[Ht.tm_mon].substring(0,3)},"%B":function(Ht){return me[Ht.tm_mon]},"%C":function(Ht){return Se((Ht.tm_year+1900)/100|0,2)},"%d":function(Ht){return Se(Ht.tm_mday,2)},"%e":function(Ht){return we(Ht.tm_mday,2," ")},"%g":function(Ht){return bt(Ht).toString().substring(2)},"%G":bt,"%H":function(Ht){return Se(Ht.tm_hour,2)},"%I":function(Ht){return Ht=Ht.tm_hour,Ht==0?Ht=12:12<Ht&&(Ht-=12),Se(Ht,2)},"%j":function(Ht){return Se(Ht.tm_mday+function(vi,Ii){for(var ln=0,un=0;un<=Ii;ln+=vi[un++]);return ln}(Ya(Ht.tm_year+1900)?hs:Tt,Ht.tm_mon-1),3)},"%m":function(Ht){return Se(Ht.tm_mon+1,2)},"%M":function(Ht){return Se(Ht.tm_min,2)},"%n":function(){return`
`},"%p":function(Ht){return 0<=Ht.tm_hour&&Ht.tm_hour<12?"AM":"PM"},"%S":function(Ht){return Se(Ht.tm_sec,2)},"%t":function(){return"	"},"%u":function(Ht){return Ht.tm_wday||7},"%U":function(Ht){return Ht=Ht.tm_yday+7-Ht.tm_wday,Se(Math.floor(Ht/7),2)},"%V":function(Ht){var vi,Ii=Math.floor((Ht.tm_yday+7-(Ht.tm_wday+6)%7)/7);return(Ht.tm_wday+371-Ht.tm_yday-2)%7<=2&&Ii++,Ii?Ii!=53||(vi=(Ht.tm_wday+371-Ht.tm_yday)%7)==4||vi==3&&Ya(Ht.tm_year)||(Ii=1):(Ii=52,((vi=(Ht.tm_wday+7-Ht.tm_yday-1)%7)==4||vi==5&&Ya(Ht.tm_year%400-1))&&Ii++),Se(Ii,2)},"%w":function(Ht){return Ht.tm_wday},"%W":function(Ht){return Ht=Ht.tm_yday+7-(Ht.tm_wday+6)%7,Se(Math.floor(Ht/7),2)},"%y":function(Ht){return(Ht.tm_year+1900).toString().substring(2)},"%Y":function(Ht){return Ht.tm_year+1900},"%z":function(Ii){var vi=0<=(Ii=Ii.tm_gmtoff),Ii=Math.abs(Ii)/60;return(vi?"+":"-")+String("0000"+(Ii/60*100+Ii%60)).slice(-4)},"%Z":function(Ht){return Ht.tm_zone},"%%":function(){return"%"}},Fr=Fr.replace(/%%/g,"\0\0");for(or in $r)Fr.includes(or)&&(Fr=Fr.replace(new RegExp(or,"g"),$r[or](U)));return B=ga(Fr=Fr.replace(/\0\0/g,"%"),!1),B.length>M?0:(qa(B,E),B.length-1)}function qr(E,M){E<128?M.push(E):M.push(E%128|128,E>>7)}function Si(E,M){if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(function(K){for(var me={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"},we={parameters:[],results:K[0]=="v"?[]:[me[K[0]]]},Se=1;Se<K.length;++Se)we.parameters.push(me[K[Se]]);return we}(M),E);var D=[1,96],B=M.slice(0,1),$=M.slice(1),U={i:127,p:127,j:126,f:125,d:124};qr($.length,D);for(var Z=0;Z<$.length;++Z)D.push(U[$[Z]]);return B=="v"?D.push(0):D.push(1,U[B]),M=[0,97,115,109,1,0,0,0,1],qr(D.length,M),M.push.apply(M,D),M.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),B=new WebAssembly.Module(new Uint8Array(M)),new WebAssembly.Instance(B,{e:{f:E}}).exports.f}var fn=void 0,tn=[];function Rn(E,M){Nn.set(E,M),wa[E]=Nn.get(E)}function qn(E){return q["_"+E]}function bo(Z,M,D,B,$){var U={string:function(Ue){var tt,bt=0;return Ue!=null&&Ue!==0&&(tt=1+(Ue.length<<2),pa(Ue,bt=ds(tt),tt)),bt},array:function(Ue){var tt=ds(Ue.length);return qa(Ue,tt),tt}},Z=qn(Z),K=[],me=0;if(B)for(var we=0;we<B.length;we++){var Se=U[D[we]];Se?(me===0&&(me=He()),K[we]=Se(B[we])):K[we]=B[we]}return Z=Z.apply(null,K),Z=Z,me!==0&&We(me),Z=Z,M==="string"?eo(Z):M==="boolean"?Boolean(Z):Z}function Wn(E,M,D,B){this.parent=E=E||this,this.mount=E.mount,this.mounted=null,this.id=ie.nextInode++,this.name=M,this.mode=D,this.node_ops={},this.stream_ops={},this.rdev=B}Object.defineProperties(Wn.prototype,{read:{get:function(){return(365&this.mode)==365},set:function(E){E?this.mode|=365:this.mode&=-366}},write:{get:function(){return(146&this.mode)==146},set:function(E){E?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return ie.isDir(this.mode)}},isDevice:{get:function(){return ie.isChrdev(this.mode)}}}),ie.FSNode=Wn,ie.staticInit(),q.FS_createPath=ie.createPath,q.FS_createDataFile=ie.createDataFile,q.FS_createPreloadedFile=ie.createPreloadedFile,q.FS_unlink=ie.unlink,q.FS_createLazyFile=ie.createLazyFile,q.FS_createDevice=ie.createDevice,Tr&&(ee(),Fi.staticInit()),cs={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};var Bn,oa={t:function(E,M,D,B){so("Assertion failed: "+eo(E)+", at: "+[M?eo(M):"unknown filename",D,B?eo(B):"unknown function"])},re:function(E,M){Ct(E)(M)},o:function(E){return co(E+24)+24},u:function(E){return(E=new Xo(E)).get_caught()||(E.set_caught(!0),mo--),E.set_rethrown(!1),Mo.push(E),E.add_ref(),E.get_exception_ptr()},Ne:function(E){throw hi("Unexpected exception thrown, this is not properly supported - aborting"),pr=!0,E},y:function(){Ze(0);var E,M=Mo.pop();(M=M).release_ref()&&!M.get_rethrown()&&((E=M.get_destructor())&&Ct(E)(M.excPtr),Oo(M.excPtr)),lo=0},b:function(){var E=lo;if(!E)return Ur(0),0;var M=new Xo(E),D=(M.set_adjusted_ptr(E),M.get_type());if(!D)return Ur(0),E;for(var B=Array.prototype.slice.call(arguments),$=0;$<B.length;$++){var U=B[$];if(U===0||U===D)break;var Z=M.ptr+16;if(aa(U,D,Z))return Ur(U),E}return Ur(D),E},j:function(){var E=lo;if(!E)return Ur(0),0;var M=new Xo(E),D=(M.set_adjusted_ptr(E),M.get_type());if(!D)return Ur(0),E;for(var B=Array.prototype.slice.call(arguments),$=0;$<B.length;$++){var U=B[$];if(U===0||U===D)break;var Z=M.ptr+16;if(aa(U,D,Z))return Ur(U),E}return Ur(D),E},C:function(){var E=lo;if(!E)return Ur(0),0;var M=new Xo(E),D=(M.set_adjusted_ptr(E),M.get_type());if(!D)return Ur(0),E;for(var B=Array.prototype.slice.call(arguments),$=0;$<B.length;$++){var U=B[$];if(U===0||U===D)break;var Z=M.ptr+16;if(aa(U,D,Z))return Ur(U),E}return Ur(D),E},p:Oo,wb:function(){var E=Mo.pop(),M=(E||so("no exception to throw"),E.excPtr);throw E.get_rethrown()||(Mo.push(E),E.set_rethrown(!0),E.set_caught(!1),mo++),lo=M},J:function(E,M,D){throw new Xo(E).init(M,D),mo++,lo=E},uc:function(){return mo},f:function(E){throw lo=lo||E,E},dc:function(E,M){try{return E=Ri.getStr(E),ie.chmod(E,M),0}catch(D){if(ie!==void 0&&D instanceof ie.ErrnoError)return-D.errno;throw D}},lc:function(E,M,D,B){try{if(M=Ri.getStr(M),M=Ri.calculateAt(E,M),-8&D)return-28;var $=ie.lookupPath(M,{follow:!0}).node;if(!$)return-44;var U="";return 4&D&&(U+="r"),2&D&&(U+="w"),1&D&&(U+="x"),U&&ie.nodePermissions($,U)?-2:0}catch(Z){if(ie!==void 0&&Z instanceof ie.ErrnoError)return-Z.errno;throw Z}},Fd:function(E,M,D,B,$,U){try{var Z=Fo(D,B);if(isNaN(Z))return-61;var K=Fo($,U);if(isNaN(K))return-61;var me=Ri.getStreamFromFD(E);return ie.allocate(me,Z,K),0}catch(we){if(ie!==void 0&&we instanceof ie.ErrnoError)return-we.errno;throw we}},ec:function(E,M){try{return ie.fchmod(E,M),0}catch(D){if(ie!==void 0&&D instanceof ie.ErrnoError)return-D.errno;throw D}},cc:function(E,M,D){try{return ie.fchown(E,M,D),0}catch(B){if(ie!==void 0&&B instanceof ie.ErrnoError)return-B.errno;throw B}},wa:function(E,M,D){Ri.varargs=D;try{var B=Ri.getStreamFromFD(E);switch(M){case 0:return($=Ri.get())<0?-28:ie.createStream(B,$).fd;case 1:case 2:return 0;case 3:return B.flags;case 4:var $=Ri.get();return B.flags|=$,0;case 5:return $=Ri.get(),_i[$+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return U=28,yr[zo()>>2]=U,-1;default:return-28}}catch(Z){if(ie!==void 0&&Z instanceof ie.ErrnoError)return-Z.errno;throw Z}var U},jc:function(E){try{return Ri.getStreamFromFD(E),0}catch(M){if(ie!==void 0&&M instanceof ie.ErrnoError)return-M.errno;throw M}},ve:function(E,M){try{var D=Ri.getStreamFromFD(E);return Ri.doStat(ie.stat,D.path,M)}catch(B){if(ie!==void 0&&B instanceof ie.ErrnoError)return-B.errno;throw B}},Pd:function(E,M,D){try{var B=Fo(M,D);return isNaN(B)?-61:(ie.ftruncate(E,B),0)}catch($){if(ie!==void 0&&$ instanceof ie.ErrnoError)return-$.errno;throw $}},vc:function(E,M){try{if(M===0)return-28;var D=ie.cwd(),B=Pa(D)+1;return M<B?-68:(pa(D,E,M),B)}catch($){if(ie!==void 0&&$ instanceof ie.ErrnoError)return-$.errno;throw $}},pc:function(E,M,D){try{for(var B=Ri.getStreamFromFD(E),$=(B.getdents||(B.getdents=ie.readdir(B.path)),0),U=ie.llseek(B,0,1),Z=Math.floor(U/280);Z<B.getdents.length&&$+280<=D;){var K,me,we,Se=B.getdents[Z];me=Se==="."?(K=B.node.id,4):Se===".."?(K=ie.lookupPath(B.path,{parent:!0}).node.id,4):(K=(we=ie.lookupNode(B.node,Se)).id,ie.isChrdev(we.mode)?2:ie.isDir(we.mode)?4:ie.isLink(we.mode)?10:8),Hn=[K>>>0,(sn=K,1<=+Math.abs(sn)?0<sn?(0|Math.min(+Math.floor(sn/4294967296),4294967295))>>>0:~~+Math.ceil((sn-(~~sn>>>0))/4294967296)>>>0:0)],yr[M+$>>2]=Hn[0],yr[M+$+4>>2]=Hn[1],Hn=[280*(Z+1)>>>0,(sn=280*(Z+1),1<=+Math.abs(sn)?0<sn?(0|Math.min(+Math.floor(sn/4294967296),4294967295))>>>0:~~+Math.ceil((sn-(~~sn>>>0))/4294967296)>>>0:0)],yr[M+$+8>>2]=Hn[0],yr[M+$+12>>2]=Hn[1],_i[M+$+16>>1]=280,Ci[M+$+18>>0]=me,pa(Se,M+$+19,256),$+=280,Z+=1}return ie.llseek(B,280*Z,0),$}catch(Ue){if(ie!==void 0&&Ue instanceof ie.ErrnoError)return-Ue.errno;throw Ue}},Ce:function(E,M,D){Ri.varargs=D;try{var B=Ri.getStreamFromFD(E);switch(M){case 21509:case 21505:return B.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return B.tty?0:-59;case 21519:if(!B.tty)return-59;var $=Ri.get();return yr[$>>2]=0;case 21520:return B.tty?-28:-59;case 21531:return $=Ri.get(),ie.ioctl(B,M,$);case 21523:case 21524:return B.tty?0:-59;default:so("bad ioctl syscall "+M)}}catch(U){if(ie!==void 0&&U instanceof ie.ErrnoError)return-U.errno;throw U}},be:function(E,M){try{return E=Ri.getStr(E),Ri.doStat(ie.lstat,E,M)}catch(D){if(ie!==void 0&&D instanceof ie.ErrnoError)return-D.errno;throw D}},rc:function(E,M,D){try{return M=Ri.getStr(M),M=Ri.calculateAt(E,M),(M=Ui.normalize(M))[M.length-1]==="/"&&(M=M.substr(0,M.length-1)),ie.mkdir(M,D,0),0}catch(B){if(ie!==void 0&&B instanceof ie.ErrnoError)return-B.errno;throw B}},je:function(E,M,D,B){try{M=Ri.getStr(M);var $=256&B,U=4096&B;return B&=-4353,M=Ri.calculateAt(E,M,U),Ri.doStat($?ie.lstat:ie.stat,M,D)}catch(Z){if(ie!==void 0&&Z instanceof ie.ErrnoError)return-Z.errno;throw Z}},Tb:function(E,M,D,B){Ri.varargs=B;try{M=Ri.getStr(M),M=Ri.calculateAt(E,M);var $=B?Ri.get():0;return ie.open(M,D,$).fd}catch(U){if(ie!==void 0&&U instanceof ie.ErrnoError)return-U.errno;throw U}},Ie:function(E){try{if(E==0)throw new ie.ErrnoError(21);var M=Vn.createPipe();return yr[E>>2]=M.readable_fd,yr[E+4>>2]=M.writable_fd,0}catch(D){if(ie!==void 0&&D instanceof ie.ErrnoError)return-D.errno;throw D}},$b:function(E,M,D,B){try{if(M=Ri.getStr(M),M=Ri.calculateAt(E,M),B<=0)return-28;var $=ie.readlink(M),U=Math.min(B,Pa($)),Z=Ci[D+U];return pa($,D,B+1),Ci[D+U]=Z,U}catch(K){if(ie!==void 0&&K instanceof ie.ErrnoError)return-K.errno;throw K}},sc:function(E,M,D,B){try{return M=Ri.getStr(M),B=Ri.getStr(B),M=Ri.calculateAt(E,M),B=Ri.calculateAt(D,B),ie.rename(M,B),0}catch($){if(ie!==void 0&&$ instanceof ie.ErrnoError)return-$.errno;throw $}},qc:function(E){try{return E=Ri.getStr(E),ie.rmdir(E),0}catch(M){if(ie!==void 0&&M instanceof ie.ErrnoError)return-M.errno;throw M}},pe:function(E,M){try{return E=Ri.getStr(E),Ri.doStat(ie.stat,E,M)}catch(D){if(ie!==void 0&&D instanceof ie.ErrnoError)return-D.errno;throw D}},oc:function(E,M,D){try{return E=Ri.getStr(E),yr[D+4>>2]=4096,yr[D+40>>2]=4096,yr[D+8>>2]=1e6,yr[D+12>>2]=5e5,yr[D+16>>2]=5e5,yr[D+20>>2]=ie.nextInode,yr[D+24>>2]=1e6,yr[D+28>>2]=42,yr[D+44>>2]=2,yr[D+36>>2]=255,0}catch(B){if(ie!==void 0&&B instanceof ie.ErrnoError)return-B.errno;throw B}},tc:function(E,M,D){try{return M=Ri.getStr(M),M=Ri.calculateAt(E,M),D===0?ie.unlink(M):D===512?ie.rmdir(M):so("Invalid flags passed to unlinkat"),0}catch(B){if(ie!==void 0&&B instanceof ie.ErrnoError)return-B.errno;throw B}},fc:function(E,M,D,B){try{var $,U;return M=Ri.getStr(M),M=Ri.calculateAt(E,M,!0),U=D?($=1e3*yr[D>>2]+yr[D+8>>2]/1e6,1e3*yr[(D+=16)>>2]+yr[D+8>>2]/1e6):$=Date.now(),ie.utime(M,$,U),0}catch(Z){if(ie!==void 0&&Z instanceof ie.ErrnoError)return-Z.errno;throw Z}},gc:function(E){},ic:function(E,M){so(Ho)},hc:function(E,M){so(Ho)},Sa:function(){return Date.now()},Oe:function(){throw 1/0},Gd:function($,M){var $=new Date(1e3*yr[$>>2]),B=(yr[M>>2]=$.getSeconds(),yr[M+4>>2]=$.getMinutes(),yr[M+8>>2]=$.getHours(),yr[M+12>>2]=$.getDate(),yr[M+16>>2]=$.getMonth(),yr[M+20>>2]=$.getFullYear()-1900,yr[M+24>>2]=$.getDay(),new Date($.getFullYear(),0,1)),D=($.getTime()-B.getTime())/864e5|0,D=(yr[M+28>>2]=D,yr[M+36>>2]=-60*$.getTimezoneOffset(),new Date($.getFullYear(),6,1).getTimezoneOffset()),B=B.getTimezoneOffset(),$=0|(D!=B&&$.getTimezoneOffset()==Math.min(B,D));yr[M+32>>2]=$},Rd:function(E){var M=new Date(yr[E+20>>2]+1900,yr[E+16>>2],yr[E+12>>2],yr[E+8>>2],yr[E+4>>2],yr[E>>2],0),K=yr[E+32>>2],D=M.getTimezoneOffset(),B=new Date(M.getFullYear(),0,1),$=new Date(M.getFullYear(),6,1).getTimezoneOffset(),U=B.getTimezoneOffset(),Z=Math.min(U,$),K=(K<0?yr[E+32>>2]=Number($!=U&&Z==D):0<K!=(Z==D)&&(U=Math.max(U,$),$=0<K?Z:U,M.setTime(M.getTime()+6e4*($-D))),yr[E+24>>2]=M.getDay(),(M.getTime()-B.getTime())/864e5|0);return yr[E+28>>2]=K,yr[E>>2]=M.getSeconds(),yr[E+4>>2]=M.getMinutes(),yr[E+8>>2]=M.getHours(),yr[E+12>>2]=M.getDate(),yr[E+16>>2]=M.getMonth(),M.getTime()/1e3|0},ac:function(E,M,D,B,$,U){try{var Z=ie.getStream(B);if(!Z)return-8;var K=ie.mmap(Z,E,$,M,D),me=K.ptr;return yr[U>>2]=K.allocated,me}catch(we){if(ie!==void 0&&we instanceof ie.ErrnoError)return-we.errno;throw we}},bc:function(E,M,D,B,$,U){try{var Z=ie.getStream($);Z&&(2&D&&Ri.doMsync(E,Z,M,B,U),ie.munmap(Z))}catch(K){if(ie!==void 0&&K instanceof ie.ErrnoError)return-K.errno;throw K}},Zd:us,Z:function(){so("")},Ke:La,vb:Ra,Pe:function(E,M,D){vn.copyWithin(E,M,M+D)},Qe:function(E){var M=vn.length,D=La();if(D<(E>>>=0))return!1;for(var B,$=1;$<=4;$*=2){var U=M*(1+.2/$),U=Math.min(U,E+100663296);if(function(Z){try{return Ir.grow(Z-Oi.byteLength+65535>>>16),xa(Ir.buffer),1}catch{}}(Math.min(D,(U=Math.max(E,U))+((B=65536)-U%B)%B)))return!0}return!1},mc:function(E,M){var D=0;return Ha().forEach(function(B,$){for(var U=M+D,Z=(dn[E+4*$>>2]=U,B),K=U,$=void 0,me=0;me<Z.length;++me)Ci[K++>>0]=Z.charCodeAt(me);$||(Ci[K>>0]=0),D+=B.length+1}),0},nc:function(E,M){var D=Ha(),B=(dn[E>>2]=D.length,0);return D.forEach(function($){B+=$.length+1}),dn[M>>2]=B,0},Ba:Wa,Ma:function(E){try{var M=Ri.getStreamFromFD(E);return ie.close(M),0}catch(D){if(ie!==void 0&&D instanceof ie.ErrnoError)return D.errno;throw D}},xb:function(E,M){try{var D=Ri.getStreamFromFD(E),B=D.tty?2:ie.isDir(D.mode)?3:ie.isLink(D.mode)?7:4;return Ci[M>>0]=B,0}catch($){if(ie!==void 0&&$ instanceof ie.ErrnoError)return $.errno;throw $}},Qb:function(E,M,D,B){try{var $=function(U,Z,K,me){for(var we=0,Se=0;Se<K;Se++){var tt=dn[Z>>2],Ue=dn[Z+4>>2],tt=(Z+=8,ie.read(U,Ci,tt,Ue,me));if(tt<0)return-1;if(we+=tt,tt<Ue)break}return we}(Ri.getStreamFromFD(E),M,D);return yr[B>>2]=$,0}catch(U){if(ie!==void 0&&U instanceof ie.ErrnoError)return U.errno;throw U}},Vd:function(E,M,D,B,$){try{var U=Fo(M,D);if(isNaN(U))return 61;var Z=Ri.getStreamFromFD(E);return ie.llseek(Z,U,B),Hn=[Z.position>>>0,(sn=Z.position,1<=+Math.abs(sn)?0<sn?(0|Math.min(+Math.floor(sn/4294967296),4294967295))>>>0:~~+Math.ceil((sn-(~~sn>>>0))/4294967296)>>>0:0)],yr[$>>2]=Hn[0],yr[$+4>>2]=Hn[1],Z.getdents&&U===0&&B===0&&(Z.getdents=null),0}catch(K){if(ie!==void 0&&K instanceof ie.ErrnoError)return K.errno;throw K}},jb:function(E,M,D,B){try{var $=function(U,Z,K,me){for(var we=0,Se=0;Se<K;Se++){var tt=dn[Z>>2],Ue=dn[Z+4>>2],tt=(Z+=8,ie.write(U,Ci,tt,Ue,me));if(tt<0)return-1;we+=tt}return we}(Ri.getStreamFromFD(E),M,D);return dn[B>>2]=$,0}catch(U){if(ie!==void 0&&U instanceof ie.ErrnoError)return U.errno;throw U}},a:function(){return pi},Me:Ao,db:function(E,M){var D=He();try{return Ct(E)(M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},Za:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},pb:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},Yd:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},q:function(E,M){var D=He();try{return Ct(E)(M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},ha:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},z:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},xa:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},E:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},F:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Cb:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Ea:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Vb:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Ra:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},B:function(E){var M=He();try{return Ct(E)()}catch(D){if(We(M),D!==D+0)throw D;Ze(1,0)}},na:function(E,M){var D=He();try{return Ct(E)(M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},ne:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},Ia:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},La:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Fe:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln,un,Io,Kn,Ja){var Ua=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln,un,Io,Kn,Ja)}catch(bs){if(We(Ua),bs!==bs+0)throw bs;Ze(1,0)}},ja:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Q:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},$:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},c:function(E,M){var D=He();try{return Ct(E)(M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},D:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},T:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},W:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},P:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},V:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},fa:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},ra:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Ya:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},ye:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},qb:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Ee:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},$d:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln){var un=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln)}catch(Io){if(We(un),Io!==Io+0)throw Io;Ze(1,0)}},Wb:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},ab:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ob:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Aa:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Bb:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},A:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},fe:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},we:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},d:function(E,M,D){var B=He();try{return Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},H:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},zb:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ga:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Je:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Ha:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Ge:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},Ab:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},Mb:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Pb:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},sb:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},zc:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return gs(E,M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Rb:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},ue:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},ta:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Oa:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},X:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},bb:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Nb:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},Le:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},e:function(E,M,D,B){var $=He();try{return Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Y:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},he:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},ge:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},Sb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},_a:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r){var Fr=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r)}catch(Ht){if(We(Fr),Ht!==Ht+0)throw Ht;Ze(1,0)}},Ja:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt){var or=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt)}catch($r){if(We(or),$r!==$r+0)throw $r;Ze(1,0)}},Fb:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Kb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},Lb:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},_d:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Da:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},nb:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},l:function(E,M,D,B,$){var U=He();try{return Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ya:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Xd:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},Gb:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},de:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Jb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},aa:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Ub:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},m:function(E,M,D,B,$,U){var Z=He();try{return Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Na:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},te:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},oe:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht){var vi=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht)}catch(Ii){if(We(vi),Ii!==Ii+0)throw Ii;Ze(1,0)}},qe:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r){var Fr=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r)}catch(Ht){if(We(Fr),Ht!==Ht+0)throw Ht;Ze(1,0)}},He:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Ka:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},x:function(E,M,D,B,$,U,Z){var K=He();try{return Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},ie:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},xe:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Be:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},ke:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},le:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},I:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},ce:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},mb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},me:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},O:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},De:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},yb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht){var vi=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht)}catch(Ii){if(We(vi),Ii!==Ii+0)throw Ii;Ze(1,0)}},Ib:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},U:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},da:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Ca:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt){var or=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt)}catch($r){if(We(or),$r!==$r+0)throw $r;Ze(1,0)}},ia:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},ua:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},pa:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},Wd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt){var or=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt)}catch($r){if(We(or),$r!==$r+0)throw $r;Ze(1,0)}},Fa:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt){var or=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt)}catch($r){if(We(or),$r!==$r+0)throw $r;Ze(1,0)}},fb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},Xa:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r){var Fr=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r)}catch(Ht){if(We(Fr),Ht!==Ht+0)throw Ht;Ze(1,0)}},ee:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii){var ln=He();try{return Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii)}catch(un){if(We(ln),un!==un+0)throw un;Ze(1,0)}},xc:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht){var vi=He();try{return cc(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht)}catch(Ii){if(We(vi),Ii!==Ii+0)throw Ii;Ze(1,0)}},hd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi){var Ii=He();try{return Pl(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi)}catch(ln){if(We(Ii),ln!==ln+0)throw ln;Ze(1,0)}},nd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii){var ln=He();try{return Ps(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii)}catch(un){if(We(ln),un!==un+0)throw un;Ze(1,0)}},ud:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r){var Fr=He();try{return za(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r)}catch(Ht){if(We(Fr),Ht!==Ht+0)throw Ht;Ze(1,0)}},Ec:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr){var Ht=He();try{return jl(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr)}catch(vi){if(We(Ht),vi!==vi+0)throw vi;Ze(1,0)}},Nc:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return zl(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Uc:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{return Ol(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},Vc:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{return Ks(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},rd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return fl(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Rc:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Fl(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},pd:function(E,M,D,B,$,U,Z,K){var me=He();try{return Wo(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},sd:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return Ls(E,M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},Fc:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return la(E,M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},Jd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Rl(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Hd:function(E,M,D,B,$,U,Z){var K=He();try{return Oa(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Bd:function(E,M,D,B,$,U,Z,K){var me=He();try{return ul(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},Mc:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Js(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},gd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Ll(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Sc:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Os(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},cd:function(E,M,D,B,$,U){var Z=He();try{return Fa(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},md:function(E,M,D,B,$,U,Z){var K=He();try{return ps(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},yc:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return yl(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},qd:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return lc(E,M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Md:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return No(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Ld:function(E,M,D,B,$){var U=He();try{return sa(E,M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ld:function(E,M,D,B,$,U){var Z=He();try{return Eo(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},kd:function(E,M,D,B,$,U,Z,K){var me=He();try{return Ko(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},Zc:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Bl(E,M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},yd:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{return pl(E,M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},Ad:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return hl(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},od:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{return Na(E,M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Xc:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return xs(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},$c:function(E,M,D,B,$,U,Z){var K=He();try{return ac(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Tc:function(E,M,D,B,$,U,Z,K,me){var we=He();try{return Qs(E,M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},id:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Rs(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Nd:function(E,M,D,B){var $=He();try{return ks(E,M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Od:function(E,M,D,B,$){var U=He();try{return fs(E,M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Oc:function(E,M,D,B,$,U){var Z=He();try{return _o(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Hc:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{return Ul(E,M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},vd:function(E,M,D){var B=He();try{return rn(E,M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},fd:function(E,M,D,B){var $=He();try{return _s(E,M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Kd:function(E){var M=He();try{return Ba(E)}catch(D){if(We(M),D!==D+0)throw D;Ze(1,0)}},Sd:function(E,M){var D=He();try{return _a(E,M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},Qd:function(E,M,D){var B=He();try{return gn(E,M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},Dd:function(E,M,D,B){var $=He();try{return Zs(E,M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Ic:function(E,M,D,B,$){var U=He();try{return el(E,M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Ud:function(E,M,D,B,$){var U=He();try{return wn(E,M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},jd:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln,un,Io,Kn,Ja,Ua){var bs=He();try{return Hr(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln,un,Io,Kn,Ja,Ua)}catch(vl){if(We(bs),vl!==vl+0)throw vl;Ze(1,0)}},_c:function(E,M,D,B,$,U){var Z=He();try{return Ys(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Yc:function(E,M,D,B,$,U,Z,K){var me=He();try{return ys(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},Gc:function(E,M,D,B){var $=He();try{return dl(E,M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Lc:function(E,M,D,B,$,U){var Z=He();try{return Nl(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Cc:function(E,M,D,B){var $=He();try{return Vl(E,M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},n:function(E){var M=He();try{Ct(E)()}catch(D){if(We(M),D!==D+0)throw D;Ze(1,0)}},la:function(E,M){var D=He();try{Ct(E)(M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},ae:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Db:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},h:function(E,M){var D=He();try{Ct(E)(M)}catch(B){if(We(D),B!==B+0)throw B;Ze(1,0)}},_:function(E,M,D){var B=He();try{Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},M:function(E,M,D,B){var $=He();try{Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},ca:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ma:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},ib:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},se:function(E,M,D,B,$,U,Z,K){var me=He();try{Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},rb:function(E,M,D,B,$,U,Z,K,me){var we=He();try{Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},kb:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},va:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},R:function(E,M,D,B){var $=He();try{Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},lb:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ba:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Eb:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},i:function(E,M,D){var B=He();try{Ct(E)(M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},G:function(E,M,D,B){var $=He();try{Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},K:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},ka:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Va:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Wa:function(E,M,D,B,$,U,Z,K,me){var we=He();try{Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},eb:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},L:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Qa:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},g:function(E,M,D,B){var $=He();try{Ct(E)(M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},sa:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},cb:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},wc:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},k:function(E,M,D,B,$){var U=He();try{Ct(E)(M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Pa:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Ua:function(E,M,D,B,$,U,Z,K){var me=He();try{Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},$a:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},Zb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},hb:function(E,M,D,B,$,U,Z,K,me){var we=He();try{Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Yb:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Ta:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Ob:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},s:function(E,M,D,B,$,U){var Z=He();try{Ct(E)(M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},_b:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln,un){var Io=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr,Ht,vi,Ii,ln,un)}catch(Kn){if(We(Io),Kn!==Kn+0)throw Kn;Ze(1,0)}},ub:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt){var or=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt)}catch($r){if(We(or),$r!==$r+0)throw $r;Ze(1,0)}},tb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Hb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},v:function(E,M,D,B,$,U,Z){var K=He();try{Ct(E)(M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},N:function(E,M,D,B,$,U,Z,K){var me=He();try{Ct(E)(M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},ea:function(E,M,D,B,$,U,Z,K,me){var we=He();try{Ct(E)(M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},ze:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},S:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},za:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr){var Ht=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r,Fr)}catch(vi){if(We(Ht),vi!==vi+0)throw vi;Ze(1,0)}},oa:function(E,M,D,B,$,U,Z,K,me,we,Se){var Ue=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se)}catch(tt){if(We(Ue),tt!==tt+0)throw tt;Ze(1,0)}},Ae:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue){var tt=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue)}catch(bt){if(We(tt),bt!==bt+0)throw bt;Ze(1,0)}},Xb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt){var bt=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt)}catch(or){if(We(bt),or!==or+0)throw or;Ze(1,0)}},gb:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or){var $r=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or)}catch(Fr){if(We($r),Fr!==Fr+0)throw Fr;Ze(1,0)}},Ga:function(E,M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r){var Fr=He();try{Ct(E)(M,D,B,$,U,Z,K,me,we,Se,Ue,tt,bt,or,$r)}catch(Ht){if(We(Fr),Ht!==Ht+0)throw Ht;Ze(1,0)}},td:function(E,M,D,B,$,U,Z,K,me){var we=He();try{Ws(E,M,D,B,$,U,Z,K,me)}catch(Se){if(We(we),Se!==Se+0)throw Se;Ze(1,0)}},Cd:function(E,M,D,B,$,U,Z){var K=He();try{ms(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Ac:function(E,M,D,B,$,U){var Z=He();try{To(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},zd:function(E,M,D,B,$,U,Z){var K=He();try{kl(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},ad:function(E,M,D,B,$,U,Z,K){var me=He();try{sc(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},wd:function(E,M,D,B,$){var U=He();try{oc(E,M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Dc:function(E,M,D,B,$,U){var Z=He();try{ya(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Id:function(E,M,D,B,$,U,Z){var K=He();try{to(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Td:function(E,M,D,B,$,U,Z){var K=He();try{Qa(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},Kc:function(E,M,D,B,$,U,Z,K){var me=He();try{_l(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},Wc:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{Bs(E,M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},Ed:function(E,M,D,B){var $=He();try{Yo(E,M,D,B)}catch(U){if(We($),U!==U+0)throw U;Ze(1,0)}},Bc:function(E,M,D,B,$){var U=He();try{Ta(E,M,D,B,$)}catch(Z){if(We(U),Z!==Z+0)throw Z;Ze(1,0)}},Pc:function(E,M,D,B,$,U){var Z=He();try{gl(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},ed:function(E,M,D,B,$,U){var Z=He();try{Ka(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},Jc:function(E,M,D,B,$,U,Z,K,me,we){var Se=He();try{$l(E,M,D,B,$,U,Z,K,me,we)}catch(Ue){if(We(Se),Ue!==Ue+0)throw Ue;Ze(1,0)}},Qc:function(E,M,D,B,$,U,Z){var K=He();try{ml(E,M,D,B,$,U,Z)}catch(me){if(We(K),me!==me+0)throw me;Ze(1,0)}},bd:function(E,M,D,B,$,U){var Z=He();try{vs(E,M,D,B,$,U)}catch(K){if(We(Z),K!==K+0)throw K;Ze(1,0)}},dd:function(E,M,D,B,$,U,Z,K){var me=He();try{Co(E,M,D,B,$,U,Z,K)}catch(we){if(We(me),we!==we+0)throw we;Ze(1,0)}},xd:function(E,M,D){var B=He();try{Hs(E,M,D)}catch($){if(We(B),$!==$+0)throw $;Ze(1,0)}},w:function(E){return E},r:function(E){Ur(E)},qa:Wt,kc:Wt},zo=(function(){var E={a:oa};function M(Z,U){var Z=Z.exports;q.asm=Z,xa((Ir=q.asm.Re).buffer),Nn=q.asm.Eg,Z=q.asm.Se,Ga.unshift(Z),ma()}function D($){M($.instance)}function B($){return function(){if(!It&&(Et||At)){if(typeof fetch=="function"&&!Is(xo))return fetch(xo,{credentials:"same-origin"}).then(function(U){if(U.ok)return U.arrayBuffer();throw"failed to load wasm binary file at '"+xo+"'"}).catch(function(){return ba(xo)});if(ji)return new Promise(function(U,Z){ji(xo,function(K){U(new Uint8Array(K))},Z)})}return Promise.resolve().then(function(){return ba(xo)})}().then(function(U){return WebAssembly.instantiate(U,E)}).then(function(U){return U}).then($,function(U){hi("failed to asynchronously prepare wasm: "+U),so(U)})}if(ra(),q.instantiateWasm)try{q.instantiateWasm(E,M);return}catch($){return hi("Module.instantiateWasm callback failed with error: "+$)}(It||typeof WebAssembly.instantiateStreaming!="function"||ia(xo)||Is(xo)||Tr||typeof fetch!="function"?B(D):fetch(xo,{credentials:"same-origin"}).then(function($){return WebAssembly.instantiateStreaming($,E).then(D,function(U){return hi("wasm streaming compile failed: "+U),hi("falling back to ArrayBuffer instantiation"),B(D)})})).catch(Me)}(),q.___wasm_call_ctors=function(){return(q.___wasm_call_ctors=q.asm.Se).apply(null,arguments)},q._CPLSetConfigOption=function(){return(q._CPLSetConfigOption=q.asm.Te).apply(null,arguments)},q._CPLSetThreadLocalConfigOption=function(){return(q._CPLSetThreadLocalConfigOption=q.asm.Ue).apply(null,arguments)},q._CPLError=function(){return(q._CPLError=q.asm.Ve).apply(null,arguments)},q._CPLErrorReset=function(){return(q._CPLErrorReset=q.asm.We).apply(null,arguments)},q._CPLGetLastErrorNo=function(){return(q._CPLGetLastErrorNo=q.asm.Xe).apply(null,arguments)},q._CPLGetLastErrorType=function(){return(q._CPLGetLastErrorType=q.asm.Ye).apply(null,arguments)},q._CPLGetLastErrorMsg=function(){return(q._CPLGetLastErrorMsg=q.asm.Ze).apply(null,arguments)},q._CPLQuietErrorHandler=function(){return(q._CPLQuietErrorHandler=q.asm._e).apply(null,arguments)},q._CPLSetErrorHandler=function(){return(q._CPLSetErrorHandler=q.asm.$e).apply(null,arguments)},q._CSLCount=function(){return(q._CSLCount=q.asm.af).apply(null,arguments)},q._GDALSuggestedWarpOutput=function(){return(q._GDALSuggestedWarpOutput=q.asm.bf).apply(null,arguments)},q._GDALGenImgProjTransform=function(){return(q._GDALGenImgProjTransform=q.asm.cf).apply(null,arguments)},q._GDALCreateGenImgProjTransformer=function(){return(q._GDALCreateGenImgProjTransformer=q.asm.df).apply(null,arguments)},q._GDALCreateGenImgProjTransformer2=function(){return(q._GDALCreateGenImgProjTransformer2=q.asm.ef).apply(null,arguments)},q._GDALDestroyGenImgProjTransformer=function(){return(q._GDALDestroyGenImgProjTransformer=q.asm.ff).apply(null,arguments)},q._GDALReprojectImage=function(){return(q._GDALReprojectImage=q.asm.gf).apply(null,arguments)},q._OSRNewSpatialReference=function(){return(q._OSRNewSpatialReference=q.asm.hf).apply(null,arguments)},q._OSRDestroySpatialReference=function(){return(q._OSRDestroySpatialReference=q.asm.jf).apply(null,arguments)},q._OSRSetFromUserInput=function(){return(q._OSRSetFromUserInput=q.asm.kf).apply(null,arguments)},q._OSRImportFromEPSG=function(){return(q._OSRImportFromEPSG=q.asm.lf).apply(null,arguments)},q._OCTDestroyCoordinateTransformation=function(){return(q._OCTDestroyCoordinateTransformation=q.asm.mf).apply(null,arguments)},q._OCTNewCoordinateTransformation=function(){return(q._OCTNewCoordinateTransformation=q.asm.nf).apply(null,arguments)},q._OCTTransform=function(){return(q._OCTTransform=q.asm.of).apply(null,arguments)},q._GDALAllRegister=function(){return(q._GDALAllRegister=q.asm.pf).apply(null,arguments)},q._OGRGetDriverCount=function(){return(q._OGRGetDriverCount=q.asm.qf).apply(null,arguments)},q._OGRGetDriver=function(){return(q._OGRGetDriver=q.asm.rf).apply(null,arguments)},q._OGR_L_GetFeatureCount=function(){return(q._OGR_L_GetFeatureCount=q.asm.sf).apply(null,arguments)},q._OGR_L_GetName=function(){return(q._OGR_L_GetName=q.asm.tf).apply(null,arguments)},q._OGR_DS_GetLayerCount=function(){return(q._OGR_DS_GetLayerCount=q.asm.uf).apply(null,arguments)},q._OGR_DS_GetLayer=function(){return(q._OGR_DS_GetLayer=q.asm.vf).apply(null,arguments)},q._OGR_DS_GetName=function(){return(q._OGR_DS_GetName=q.asm.wf).apply(null,arguments)},q._OGR_DS_GetDriver=function(){return(q._OGR_DS_GetDriver=q.asm.xf).apply(null,arguments)},q._OGR_Dr_GetName=function(){return(q._OGR_Dr_GetName=q.asm.yf).apply(null,arguments)},q._GDALCreate=function(){return(q._GDALCreate=q.asm.zf).apply(null,arguments)},q._GDALCreateCopy=function(){return(q._GDALCreateCopy=q.asm.Af).apply(null,arguments)},q._GDALGetDriverShortName=function(){return(q._GDALGetDriverShortName=q.asm.Bf).apply(null,arguments)},q._GDALGetDriverLongName=function(){return(q._GDALGetDriverLongName=q.asm.Cf).apply(null,arguments)},q._GDALGetDriverCount=function(){return(q._GDALGetDriverCount=q.asm.Df).apply(null,arguments)},q._GDALGetDriver=function(){return(q._GDALGetDriver=q.asm.Ef).apply(null,arguments)},q._GDALGetDriverByName=function(){return(q._GDALGetDriverByName=q.asm.Ff).apply(null,arguments)},q._GDALGetRasterXSize=function(){return(q._GDALGetRasterXSize=q.asm.Gf).apply(null,arguments)},q._GDALGetRasterYSize=function(){return(q._GDALGetRasterYSize=q.asm.Hf).apply(null,arguments)},q._GDALGetRasterBand=function(){return(q._GDALGetRasterBand=q.asm.If).apply(null,arguments)},q._GDALGetRasterCount=function(){return(q._GDALGetRasterCount=q.asm.Jf).apply(null,arguments)},q._GDALGetProjectionRef=function(){return(q._GDALGetProjectionRef=q.asm.Kf).apply(null,arguments)},q._GDALSetProjection=function(){return(q._GDALSetProjection=q.asm.Lf).apply(null,arguments)},q._GDALGetGeoTransform=function(){return(q._GDALGetGeoTransform=q.asm.Mf).apply(null,arguments)},q._GDALSetGeoTransform=function(){return(q._GDALSetGeoTransform=q.asm.Nf).apply(null,arguments)},q._GDALGetDatasetDriver=function(){return(q._GDALGetDatasetDriver=q.asm.Of).apply(null,arguments)},q._GDALGetFileList=function(){return(q._GDALGetFileList=q.asm.Pf).apply(null,arguments)},q._GDALOpen=function(){return(q._GDALOpen=q.asm.Qf).apply(null,arguments)},q._GDALOpenEx=function(){return(q._GDALOpenEx=q.asm.Rf).apply(null,arguments)},q._GDALClose=function(){return(q._GDALClose=q.asm.Sf).apply(null,arguments)},q._GDALDatasetGetLayerCount=function(){return(q._GDALDatasetGetLayerCount=q.asm.Tf).apply(null,arguments)},q._GDALDatasetGetLayer=function(){return(q._GDALDatasetGetLayer=q.asm.Uf).apply(null,arguments)},q._GDALGetRasterDataType=function(){return(q._GDALGetRasterDataType=q.asm.Vf).apply(null,arguments)},q._GDALGetRasterNoDataValue=function(){return(q._GDALGetRasterNoDataValue=q.asm.Wf).apply(null,arguments)},q._GDALGetRasterMaximum=function(){return(q._GDALGetRasterMaximum=q.asm.Xf).apply(null,arguments)},q._GDALGetRasterMinimum=function(){return(q._GDALGetRasterMinimum=q.asm.Yf).apply(null,arguments)},q._GDALGetRasterStatistics=function(){return(q._GDALGetRasterStatistics=q.asm.Zf).apply(null,arguments)},q._GDALSetCacheMax=function(){return(q._GDALSetCacheMax=q.asm._f).apply(null,arguments)},q._GDALGetDescription=function(){return(q._GDALGetDescription=q.asm.$f).apply(null,arguments)},q._GDALGetMetadataItem=function(){return(q._GDALGetMetadataItem=q.asm.ag).apply(null,arguments)},q._GDALBuildVRT=function(){return(q._GDALBuildVRT=q.asm.bg).apply(null,arguments)},q._GDALBuildVRTOptionsFree=function(){return(q._GDALBuildVRTOptionsFree=q.asm.cg).apply(null,arguments)},q._GDALBuildVRTOptionsNew=function(){return(q._GDALBuildVRTOptionsNew=q.asm.dg).apply(null,arguments)},q._GDALTranslate=function(){return(q._GDALTranslate=q.asm.eg).apply(null,arguments)},q._GDALTranslateOptionsNew=function(){return(q._GDALTranslateOptionsNew=q.asm.fg).apply(null,arguments)},q._GDALTranslateOptionsFree=function(){return(q._GDALTranslateOptionsFree=q.asm.gg).apply(null,arguments)},q._GDALRasterize=function(){return(q._GDALRasterize=q.asm.hg).apply(null,arguments)},q._GDALRasterizeOptionsNew=function(){return(q._GDALRasterizeOptionsNew=q.asm.ig).apply(null,arguments)},q._GDALRasterizeOptionsFree=function(){return(q._GDALRasterizeOptionsFree=q.asm.jg).apply(null,arguments)},q._GDALWarp=function(){return(q._GDALWarp=q.asm.kg).apply(null,arguments)},q._GDALWarpAppOptionsNew=function(){return(q._GDALWarpAppOptionsNew=q.asm.lg).apply(null,arguments)},q._GDALWarpAppOptionsFree=function(){return(q._GDALWarpAppOptionsFree=q.asm.mg).apply(null,arguments)},q._GDALWarpAppOptionsSetProgress=function(){return(q._GDALWarpAppOptionsSetProgress=q.asm.ng).apply(null,arguments)},q._GDALVectorTranslate=function(){return(q._GDALVectorTranslate=q.asm.og).apply(null,arguments)},q._GDALVectorTranslateOptionsFree=function(){return(q._GDALVectorTranslateOptionsFree=q.asm.pg).apply(null,arguments)},q._GDALVectorTranslateOptionsNew=function(){return(q._GDALVectorTranslateOptionsNew=q.asm.qg).apply(null,arguments)},q._GDALDEMProcessing=function(){return(q._GDALDEMProcessing=q.asm.rg).apply(null,arguments)},q._GDALDEMProcessingOptionsNew=function(){return(q._GDALDEMProcessingOptionsNew=q.asm.sg).apply(null,arguments)},q._GDALDEMProcessingOptionsFree=function(){return(q._GDALDEMProcessingOptionsFree=q.asm.tg).apply(null,arguments)},q.___errno_location=function(){return(zo=q.___errno_location=q.asm.ug).apply(null,arguments)}),co=q._malloc=function(){return(co=q._malloc=q.asm.vg).apply(null,arguments)},wo=q._free=function(){return(wo=q._free=q.asm.wg).apply(null,arguments)},Ea=q._emscripten_builtin_memalign=function(){return(Ea=q._emscripten_builtin_memalign=q.asm.xg).apply(null,arguments)},Ze=q._setThrew=function(){return(Ze=q._setThrew=q.asm.yg).apply(null,arguments)},He=q.stackSave=function(){return(He=q.stackSave=q.asm.zg).apply(null,arguments)},We=q.stackRestore=function(){return(We=q.stackRestore=q.asm.Ag).apply(null,arguments)},ds=q.stackAlloc=function(){return(ds=q.stackAlloc=q.asm.Bg).apply(null,arguments)},aa=q.___cxa_can_catch=function(){return(aa=q.___cxa_can_catch=q.asm.Cg).apply(null,arguments)},Xs=q.___cxa_is_pointer_type=function(){return(Xs=q.___cxa_is_pointer_type=q.asm.Dg).apply(null,arguments)},wn=q.dynCall_jiiii=function(){return(wn=q.dynCall_jiiii=q.asm.Fg).apply(null,arguments)},gn=q.dynCall_jii=function(){return(gn=q.dynCall_jii=q.asm.Gg).apply(null,arguments)},fs=q.dynCall_iiji=function(){return(fs=q.dynCall_iiji=q.asm.Hg).apply(null,arguments)},_a=q.dynCall_ji=function(){return(_a=q.dynCall_ji=q.asm.Ig).apply(null,arguments)},ks=q.dynCall_iij=function(){return(ks=q.dynCall_iij=q.asm.Jg).apply(null,arguments)},Eo=q.dynCall_iiiji=function(){return(Eo=q.dynCall_iiiji=q.asm.Kg).apply(null,arguments)},No=q.dynCall_iiiijjjii=function(){return(No=q.dynCall_iiiijjjii=q.asm.Lg).apply(null,arguments)},sa=q.dynCall_iiij=function(){return(sa=q.dynCall_iiij=q.asm.Mg).apply(null,arguments)},Ba=q.dynCall_j=function(){return(Ba=q.dynCall_j=q.asm.Ng).apply(null,arguments)},Oa=q.dynCall_iiiiij=function(){return(Oa=q.dynCall_iiiiij=q.asm.Og).apply(null,arguments)},la=q.dynCall_iiiiiijj=function(){return(la=q.dynCall_iiiiiijj=q.asm.Pg).apply(null,arguments)},to=q.dynCall_viijii=function(){return(to=q.dynCall_viijii=q.asm.Qg).apply(null,arguments)},Fa=q.dynCall_iiiij=function(){return(Fa=q.dynCall_iiiij=q.asm.Rg).apply(null,arguments)},Ka=q.dynCall_vijii=function(){return(Ka=q.dynCall_vijii=q.asm.Sg).apply(null,arguments)},_o=q.dynCall_iijii=function(){return(_o=q.dynCall_iijii=q.asm.Tg).apply(null,arguments)},Wo=q.dynCall_iiiiiij=function(){return(Wo=q.dynCall_iiiiiij=q.asm.Ug).apply(null,arguments)},Yo=q.dynCall_vij=function(){return(Yo=q.dynCall_vij=q.asm.Vg).apply(null,arguments)},ps=q.dynCall_iiiiji=function(){return(ps=q.dynCall_iiiiji=q.asm.Wg).apply(null,arguments)},rn=q.dynCall_ij=function(){return(rn=q.dynCall_ij=q.asm.Xg).apply(null,arguments)},ya=q.dynCall_viiji=function(){return(ya=q.dynCall_viiji=q.asm.Yg).apply(null,arguments)},oc=q.dynCall_viij=function(){return(oc=q.dynCall_viij=q.asm.Zg).apply(null,arguments)},Zs=q.dynCall_jiii=function(){return(Zs=q.dynCall_jiii=q.asm._g).apply(null,arguments)},ms=q.dynCall_viiiij=function(){return(ms=q.dynCall_viiiij=q.asm.$g).apply(null,arguments)},ul=q.dynCall_iiiiiji=function(){return(ul=q.dynCall_iiiiiji=q.asm.ah).apply(null,arguments)},kl=q.dynCall_viiiji=function(){return(kl=q.dynCall_viiiji=q.asm.bh).apply(null,arguments)},hl=q.dynCall_iiijiiiiii=function(){return(hl=q.dynCall_iiijiiiiii=q.asm.ch).apply(null,arguments)},dl=q.dynCall_jij=function(){return(dl=q.dynCall_jij=q.asm.dh).apply(null,arguments)},Hs=q.dynCall_vj=function(){return(Hs=q.dynCall_vj=q.asm.eh).apply(null,arguments)},Ps=q.dynCall_iiiiiiiiiiiiijjji=function(){return(Ps=q.dynCall_iiiiiiiiiiiiijjji=q.asm.fh).apply(null,arguments)},za=q.dynCall_iiiiiiiiiiijji=function(){return(za=q.dynCall_iiiiiiiiiiijji=q.asm.gh).apply(null,arguments)},Na=q.dynCall_iiijiiiiiii=function(){return(Na=q.dynCall_iiijiiiiiii=q.asm.hh).apply(null,arguments)},Ws=q.dynCall_viiiiiji=function(){return(Ws=q.dynCall_viiiiiji=q.asm.ih).apply(null,arguments)},fl=q.dynCall_iiiiiiijiii=function(){return(fl=q.dynCall_iiiiiiijiii=q.asm.jh).apply(null,arguments)},gs=q.dynCall_iiiddddj=function(){return(gs=q.dynCall_iiiddddj=q.asm.kh).apply(null,arguments)},Ls=q.dynCall_iiiiiijii=function(){return(Ls=q.dynCall_iiiiiijii=q.asm.lh).apply(null,arguments)},Hr=q.dynCall_jiiiiiiiiiiiiiiiiiiiiiiiii=function(){return(Hr=q.dynCall_jiiiiiiiiiiiiiiiiiiiiiiiii=q.asm.mh).apply(null,arguments)},Ko=q.dynCall_iiijiii=function(){return(Ko=q.dynCall_iiijiii=q.asm.nh).apply(null,arguments)},Rs=q.dynCall_iiijjiji=function(){return(Rs=q.dynCall_iiijjiji=q.asm.oh).apply(null,arguments)},Pl=q.dynCall_iiiiiiiiiiiiijjii=function(){return(Pl=q.dynCall_iiiiiiiiiiiiijjii=q.asm.ph).apply(null,arguments)},Ll=q.dynCall_iiiiijiiiii=function(){return(Ll=q.dynCall_iiiiijiiiii=q.asm.qh).apply(null,arguments)},_s=q.dynCall_iji=function(){return(_s=q.dynCall_iji=q.asm.rh).apply(null,arguments)},Rl=q.dynCall_iiiiiijjii=function(){return(Rl=q.dynCall_iiiiiijjii=q.asm.sh).apply(null,arguments)},Ys=q.dynCall_jiiji=function(){return(Ys=q.dynCall_jiiji=q.asm.th).apply(null,arguments)},ys=q.dynCall_jiijji=function(){return(ys=q.dynCall_jiijji=q.asm.uh).apply(null,arguments)},Qa=q.dynCall_viijj=function(){return(Qa=q.dynCall_viijj=q.asm.vh).apply(null,arguments)},Co=q.dynCall_vijjj=function(){return(Co=q.dynCall_vijjj=q.asm.wh).apply(null,arguments)},Bs=q.dynCall_viijjji=function(){return(Bs=q.dynCall_viijjji=q.asm.xh).apply(null,arguments)},vs=q.dynCall_vijj=function(){return(vs=q.dynCall_vijj=q.asm.yh).apply(null,arguments)},ac=q.dynCall_iiijj=function(){return(ac=q.dynCall_iiijj=q.asm.zh).apply(null,arguments)},sc=q.dynCall_viiijj=function(){return(sc=q.dynCall_viiijj=q.asm.Ah).apply(null,arguments)},Bl=q.dynCall_iiijiiii=function(){return(Bl=q.dynCall_iiijiiii=q.asm.Bh).apply(null,arguments)},xs=q.dynCall_iiijiiiji=function(){return(xs=q.dynCall_iiijiiiji=q.asm.Ch).apply(null,arguments)},pl=q.dynCall_iiijiiiii=function(){return(pl=q.dynCall_iiijiiiii=q.asm.Dh).apply(null,arguments)},Ks=q.dynCall_iiiiiiiijjji=function(){return(Ks=q.dynCall_iiiiiiiijjji=q.asm.Eh).apply(null,arguments)},Ol=q.dynCall_iiiiiiiijiii=function(){return(Ol=q.dynCall_iiiiiiiijiii=q.asm.Fh).apply(null,arguments)},Qs=q.dynCall_iiijjii=function(){return(Qs=q.dynCall_iiijjii=q.asm.Gh).apply(null,arguments)},Os=q.dynCall_iiiiijjii=function(){return(Os=q.dynCall_iiiiijjii=q.asm.Hh).apply(null,arguments)},Fl=q.dynCall_iiiiiiijji=function(){return(Fl=q.dynCall_iiiiiiijji=q.asm.Ih).apply(null,arguments)},ml=q.dynCall_vijiii=function(){return(ml=q.dynCall_vijiii=q.asm.Jh).apply(null,arguments)},gl=q.dynCall_vijid=function(){return(gl=q.dynCall_vijid=q.asm.Kh).apply(null,arguments)},zl=q.dynCall_iiiiiiiijii=function(){return(zl=q.dynCall_iiiiiiiijii=q.asm.Lh).apply(null,arguments)},Js=q.dynCall_iiiiijiiii=function(){return(Js=q.dynCall_iiiiijiiii=q.asm.Mh).apply(null,arguments)},Ta=q.dynCall_viji=function(){return(Ta=q.dynCall_viji=q.asm.Nh).apply(null,arguments)},_l=q.dynCall_viijji=function(){return(_l=q.dynCall_viijji=q.asm.Oh).apply(null,arguments)},Nl=q.dynCall_jijj=function(){return(Nl=q.dynCall_jijj=q.asm.Ph).apply(null,arguments)},Ul=q.dynCall_iijjjddi=function(){return(Ul=q.dynCall_iijjjddi=q.asm.Qh).apply(null,arguments)},$l=q.dynCall_vijiidddi=function(){return($l=q.dynCall_vijiidddi=q.asm.Rh).apply(null,arguments)},el=q.dynCall_jiiid=function(){return(el=q.dynCall_jiiid=q.asm.Sh).apply(null,arguments)},jl=q.dynCall_iiiiiiiiiijiiiii=function(){return(jl=q.dynCall_iiiiiiiiiijiiiii=q.asm.Th).apply(null,arguments)},Vl=q.dynCall_jji=function(){return(Vl=q.dynCall_jji=q.asm.Uh).apply(null,arguments)},To=q.dynCall_viiij=function(){return(To=q.dynCall_viiij=q.asm.Vh).apply(null,arguments)},lc=q.dynCall_iiiijji=function(){return(lc=q.dynCall_iiiijji=q.asm.Wh).apply(null,arguments)},yl=q.dynCall_iiiijiiiii=function(){return(yl=q.dynCall_iiiijiiiii=q.asm.Xh).apply(null,arguments)},cc=q.dynCall_iiiiiiiiiiiiiijj=function(){return(cc=q.dynCall_iiiiiiiiiiiiiijj=q.asm.Yh).apply(null,arguments)};function uc(){function E(){Bn||(Bn=!0,q.calledRun=!0,pr||(q.noFSInit||ie.init.initialized||ie.init(),ie.ignorePermissions=!1,Vn.root=ie.mount(Vn,{},null),Ds(Ga),Y(q),q.onRuntimeInitialized&&q.onRuntimeInitialized(),qo()))}0<ta||(Cs(),0<ta||(q.setStatus?(q.setStatus("Running..."),setTimeout(function(){setTimeout(function(){q.setStatus("")},1),E()},1)):E()))}if(q.stringToUTF8=pa,q.lengthBytesUTF8=Pa,q.addRunDependency=ra,q.removeRunDependency=ma,q.FS_createPath=ie.createPath,q.FS_createDataFile=ie.createDataFile,q.FS_createPreloadedFile=ie.createPreloadedFile,q.FS_createLazyFile=ie.createLazyFile,q.FS_createDevice=ie.createDevice,q.FS_unlink=ie.unlink,q.ENV=Za,q.ccall=bo,q.cwrap=function(E,M,D,B){var $=(D=D||[]).every(function(U){return U==="number"});return M!=="string"&&$&&!B?qn(E):function(){return bo(E,M,D,arguments)}},q.addFunction=function(E,M){if(!fn){fn=new WeakMap;var D=0,B=Nn.length;if(fn)for(var $=D;$<D+B;$++){var U=Ct($);U&&fn.set(U,$)}}if(fn.has(E))return fn.get(E);var Z=function(){if(tn.length)return tn.pop();try{Nn.grow(1)}catch(K){throw K instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":K}return Nn.length-1}();try{Rn(Z,E)}catch(K){if(!(K instanceof TypeError))throw K;Rn(Z,Si(E,M))}return fn.set(E,Z),Z},q.setValue=function(E,M){var D=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"i8";switch(D=D.endsWith("*")?"*":D){case"i1":case"i8":Ci[E>>0]=M;break;case"i16":_i[E>>1]=M;break;case"i32":yr[E>>2]=M;break;case"i64":Hn=[M>>>0,(sn=M,1<=+Math.abs(sn)?0<sn?(0|Math.min(+Math.floor(sn/4294967296),4294967295))>>>0:~~+Math.ceil((sn-(~~sn>>>0))/4294967296)>>>0:0)],yr[E>>2]=Hn[0],yr[E+4>>2]=Hn[1];break;case"float":an[E>>2]=M;break;case"double":Zn[E>>3]=M;break;case"*":dn[E>>2]=M;break;default:so("invalid type for setValue: "+D)}},q.getValue=function(E){var M=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"i8";switch(M=M.endsWith("*")?"*":M){case"i1":case"i8":return Ci[E>>0];case"i16":return _i[E>>1];case"i32":case"i64":return yr[E>>2];case"float":return an[E>>2];case"double":return Zn[E>>3];case"*":return dn[E>>2];default:so("invalid type for getValue: "+M)}return null},q.FS=ie,q.MEMFS=Ni,q.WORKERFS=Ln,q.NODEFS=Fi,Bo=function E(){Bn||uc(),Bn||(Bo=E)},q.preInit)for(typeof q.preInit=="function"&&(q.preInit=[q.preInit]);0<q.preInit.length;)q.preInit.pop()();return uc(),J.ready}F=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(F=F||__filename),Xi.exports=se;var ce=xr.exports,X={Module:{}};function ye(){var J=X.CPLGetLastErrorMsg(),Y=X.CPLGetLastErrorNo();return X.CPLErrorReset(),{no:Y,message:J}}function oe(J){for(var Y=[],Me={},ct=0;ct<J.length;ct+=1){var Pt=J[ct];Pt==="--config"?(Me[J[ct+1]]=J[ct+2],ct+=2):Y.push(Pt)}var Ve=Y.map(function(ft){return X.Module._malloc(X.Module.lengthBytesUTF8(ft)+1)}),pt=(Ve.push(0),Uint32Array.from(Ve)),dt=(Y.forEach(function(ft,Rr){X.Module.stringToUTF8(ft,pt[Rr],X.Module.lengthBytesUTF8(ft)+1)}),X.Module._malloc(pt.length*pt.BYTES_PER_ELEMENT));return X.Module.HEAPU32.set(pt,dt/pt.BYTES_PER_ELEMENT),{ptr:dt,ptrArray:Ve,config:Me}}function le(J){X.Module._free(J.ptr),J.ptrArray.forEach(function(Y){X.Module._free(Y)})}var ue="/input",Re="/output",ze=Re,Xi={},ve=n(Object.freeze({__proto__:null,default:{}})),be=Xi;be.parser=function(J,Y){return new Ge(J,Y)},be.SAXParser=Ge,be.SAXStream=St,be.createStream=function(J,Y){return new St(J,Y)},be.MAX_BUFFER_LENGTH=65536;var de,Te=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function Ge(J,Y){if(!(this instanceof Ge))return new Ge(J,Y);for(var Me=this,ct=Me,Pt=0,Ve=Te.length;Pt<Ve;Pt++)ct[Te[Pt]]="";Me.q=Me.c="",Me.bufferCheckPosition=be.MAX_BUFFER_LENGTH,Me.opt=Y||{},Me.opt.lowercase=Me.opt.lowercase||Me.opt.lowercasetags,Me.looseCase=Me.opt.lowercase?"toLowerCase":"toUpperCase",Me.tags=[],Me.closed=Me.closedRoot=Me.sawRoot=!1,Me.tag=Me.error=null,Me.strict=!!J,Me.noscript=!(!J&&!Me.opt.noscript),Me.state=at.BEGIN,Me.strictEntities=Me.opt.strictEntities,Me.ENTITIES=Me.strictEntities?Object.create(be.XML_ENTITIES):Object.create(be.ENTITIES),Me.attribList=[],Me.opt.xmlns&&(Me.ns=Object.create(Gr)),Me.trackPosition=Me.opt.position!==!1,Me.trackPosition&&(Me.position=Me.line=Me.column=0),bi(Me,"onready")}be.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(J){function Y(){}return Y.prototype=J,new Y}),Object.keys||(Object.keys=function(J){var Y,Me=[];for(Y in J)J.hasOwnProperty(Y)&&Me.push(Y);return Me}),Ge.prototype={end:function(){yi(this)},write:function(J){var Y=this;if(this.error)throw this.error;if(Y.closed)return ur(Y,"Cannot write after close. Assign an onready handler.");if(J===null)return yi(Y);typeof J=="object"&&(J=J.toString());for(var Me,ct,Pt=0,Ve="";Ve=st(J,Pt++),!!(Y.c=Ve);)switch(Y.trackPosition&&(Y.position++,Ve===`
`?(Y.line++,Y.column=0):Y.column++),Y.state){case at.BEGIN:if(Y.state=at.BEGIN_WHITESPACE,Ve==="\uFEFF")continue;Jt(Y,Ve);continue;case at.BEGIN_WHITESPACE:Jt(Y,Ve);continue;case at.TEXT:if(Y.sawRoot&&!Y.closedRoot){for(var pt=Pt-1;Ve&&Ve!=="<"&&Ve!=="&";)(Ve=st(J,Pt++))&&Y.trackPosition&&(Y.position++,Ve===`
`?(Y.line++,Y.column=0):Y.column++);Y.textNode+=J.substring(pt,Pt-1)}Ve!=="<"||Y.sawRoot&&Y.closedRoot&&!Y.strict?(er(Ve)||Y.sawRoot&&!Y.closedRoot||Or(Y,"Text data outside of root node."),Ve==="&"?Y.state=at.TEXT_ENTITY:Y.textNode+=Ve):(Y.state=at.OPEN_WAKA,Y.startTagPosition=Y.position);continue;case at.SCRIPT:Ve==="<"?Y.state=at.SCRIPT_ENDING:Y.script+=Ve;continue;case at.SCRIPT_ENDING:Ve==="/"?Y.state=at.CLOSE_TAG:(Y.script+="<"+Ve,Y.state=at.SCRIPT);continue;case at.OPEN_WAKA:Ve==="!"?(Y.state=at.SGML_DECL,Y.sgmlDecl=""):er(Ve)||(ar(_t,Ve)?(Y.state=at.OPEN_TAG,Y.tagName=Ve):Ve==="/"?(Y.state=at.CLOSE_TAG,Y.tagName=""):Ve==="?"?(Y.state=at.PROC_INST,Y.procInstName=Y.procInstBody=""):(Or(Y,"Unencoded <"),Y.startTagPosition+1<Y.position&&(pt=Y.position-Y.startTagPosition,Ve=new Array(pt).join(" ")+Ve),Y.textNode+="<"+Ve,Y.state=at.TEXT));continue;case at.SGML_DECL:(Y.sgmlDecl+Ve).toUpperCase()===xt?(Br(Y,"onopencdata"),Y.state=at.CDATA,Y.sgmlDecl="",Y.cdata=""):Y.sgmlDecl+Ve==="--"?(Y.state=at.COMMENT,Y.comment="",Y.sgmlDecl=""):(Y.sgmlDecl+Ve).toUpperCase()===Lr?(Y.state=at.DOCTYPE,(Y.doctype||Y.sawRoot)&&Or(Y,"Inappropriately located doctype declaration"),Y.doctype="",Y.sgmlDecl=""):Ve===">"?(Br(Y,"onsgmldeclaration",Y.sgmlDecl),Y.sgmlDecl="",Y.state=at.TEXT):(lr(Ve)&&(Y.state=at.SGML_DECL_QUOTED),Y.sgmlDecl+=Ve);continue;case at.SGML_DECL_QUOTED:Ve===Y.q&&(Y.state=at.SGML_DECL,Y.q=""),Y.sgmlDecl+=Ve;continue;case at.DOCTYPE:Ve===">"?(Y.state=at.TEXT,Br(Y,"ondoctype",Y.doctype),Y.doctype=!0):(Y.doctype+=Ve,Ve==="["?Y.state=at.DOCTYPE_DTD:lr(Ve)&&(Y.state=at.DOCTYPE_QUOTED,Y.q=Ve));continue;case at.DOCTYPE_QUOTED:Y.doctype+=Ve,Ve===Y.q&&(Y.q="",Y.state=at.DOCTYPE);continue;case at.DOCTYPE_DTD:Y.doctype+=Ve,Ve==="]"?Y.state=at.DOCTYPE:lr(Ve)&&(Y.state=at.DOCTYPE_DTD_QUOTED,Y.q=Ve);continue;case at.DOCTYPE_DTD_QUOTED:Y.doctype+=Ve,Ve===Y.q&&(Y.state=at.DOCTYPE_DTD,Y.q="");continue;case at.COMMENT:Ve==="-"?Y.state=at.COMMENT_ENDING:Y.comment+=Ve;continue;case at.COMMENT_ENDING:Ve==="-"?(Y.state=at.COMMENT_ENDED,Y.comment=cr(Y.opt,Y.comment),Y.comment&&Br(Y,"oncomment",Y.comment),Y.comment=""):(Y.comment+="-"+Ve,Y.state=at.COMMENT);continue;case at.COMMENT_ENDED:Ve!==">"?(Or(Y,"Malformed comment"),Y.comment+="--"+Ve,Y.state=at.COMMENT):Y.state=at.TEXT;continue;case at.CDATA:Ve==="]"?Y.state=at.CDATA_ENDING:Y.cdata+=Ve;continue;case at.CDATA_ENDING:Ve==="]"?Y.state=at.CDATA_ENDING_2:(Y.cdata+="]"+Ve,Y.state=at.CDATA);continue;case at.CDATA_ENDING_2:Ve===">"?(Y.cdata&&Br(Y,"oncdata",Y.cdata),Br(Y,"onclosecdata"),Y.cdata="",Y.state=at.TEXT):Ve==="]"?Y.cdata+="]":(Y.cdata+="]]"+Ve,Y.state=at.CDATA);continue;case at.PROC_INST:Ve==="?"?Y.state=at.PROC_INST_ENDING:er(Ve)?Y.state=at.PROC_INST_BODY:Y.procInstName+=Ve;continue;case at.PROC_INST_BODY:if(!Y.procInstBody&&er(Ve))continue;Ve==="?"?Y.state=at.PROC_INST_ENDING:Y.procInstBody+=Ve;continue;case at.PROC_INST_ENDING:Ve===">"?(Br(Y,"onprocessinginstruction",{name:Y.procInstName,body:Y.procInstBody}),Y.procInstName=Y.procInstBody="",Y.state=at.TEXT):(Y.procInstBody+="?"+Ve,Y.state=at.PROC_INST_BODY);continue;case at.OPEN_TAG:ar(Kt,Ve)?Y.tagName+=Ve:(function(dt){dt.strict||(dt.tagName=dt.tagName[dt.looseCase]());var ft=dt.tags[dt.tags.length-1]||dt,Rr=dt.tag={name:dt.tagName,attributes:{}};dt.opt.xmlns&&(Rr.ns=ft.ns),dt.attribList.length=0,Br(dt,"onopentagstart",Rr)}(Y),Ve===">"?Er(Y):Ve==="/"?Y.state=at.OPEN_TAG_SLASH:(er(Ve)||Or(Y,"Invalid character in tag name"),Y.state=at.ATTRIB));continue;case at.OPEN_TAG_SLASH:Ve===">"?(Er(Y,!0),Gt(Y)):(Or(Y,"Forward-slash in opening tag not followed by >"),Y.state=at.ATTRIB);continue;case at.ATTRIB:if(er(Ve))continue;Ve===">"?Er(Y):Ve==="/"?Y.state=at.OPEN_TAG_SLASH:ar(_t,Ve)?(Y.attribName=Ve,Y.attribValue="",Y.state=at.ATTRIB_NAME):Or(Y,"Invalid attribute name");continue;case at.ATTRIB_NAME:Ve==="="?Y.state=at.ATTRIB_VALUE:Ve===">"?(Or(Y,"Attribute without value"),Y.attribValue=Y.attribName,qt(Y),Er(Y)):er(Ve)?Y.state=at.ATTRIB_NAME_SAW_WHITE:ar(Kt,Ve)?Y.attribName+=Ve:Or(Y,"Invalid attribute name");continue;case at.ATTRIB_NAME_SAW_WHITE:if(Ve==="=")Y.state=at.ATTRIB_VALUE;else{if(er(Ve))continue;Or(Y,"Attribute without value"),Y.tag.attributes[Y.attribName]="",Y.attribValue="",Br(Y,"onattribute",{name:Y.attribName,value:""}),Y.attribName="",Ve===">"?Er(Y):ar(_t,Ve)?(Y.attribName=Ve,Y.state=at.ATTRIB_NAME):(Or(Y,"Invalid attribute name"),Y.state=at.ATTRIB)}continue;case at.ATTRIB_VALUE:if(er(Ve))continue;lr(Ve)?(Y.q=Ve,Y.state=at.ATTRIB_VALUE_QUOTED):(Or(Y,"Unquoted attribute value"),Y.state=at.ATTRIB_VALUE_UNQUOTED,Y.attribValue=Ve);continue;case at.ATTRIB_VALUE_QUOTED:if(Ve!==Y.q){Ve==="&"?Y.state=at.ATTRIB_VALUE_ENTITY_Q:Y.attribValue+=Ve;continue}qt(Y),Y.q="",Y.state=at.ATTRIB_VALUE_CLOSED;continue;case at.ATTRIB_VALUE_CLOSED:er(Ve)?Y.state=at.ATTRIB:Ve===">"?Er(Y):Ve==="/"?Y.state=at.OPEN_TAG_SLASH:ar(_t,Ve)?(Or(Y,"No whitespace between attributes"),Y.attribName=Ve,Y.attribValue="",Y.state=at.ATTRIB_NAME):Or(Y,"Invalid attribute name");continue;case at.ATTRIB_VALUE_UNQUOTED:if(!function(dt){return dt===">"||er(dt)}(Ve)){Ve==="&"?Y.state=at.ATTRIB_VALUE_ENTITY_U:Y.attribValue+=Ve;continue}qt(Y),Ve===">"?Er(Y):Y.state=at.ATTRIB;continue;case at.CLOSE_TAG:if(Y.tagName)Ve===">"?Gt(Y):ar(Kt,Ve)?Y.tagName+=Ve:Y.script?(Y.script+="</"+Y.tagName,Y.tagName="",Y.state=at.SCRIPT):(er(Ve)||Or(Y,"Invalid tagname in closing tag"),Y.state=at.CLOSE_TAG_SAW_WHITE);else{if(er(Ve))continue;(function(dt,ft){return!ar(dt,ft)})(_t,Ve)?Y.script?(Y.script+="</"+Ve,Y.state=at.SCRIPT):Or(Y,"Invalid tagname in closing tag."):Y.tagName=Ve}continue;case at.CLOSE_TAG_SAW_WHITE:if(er(Ve))continue;Ve===">"?Gt(Y):Or(Y,"Invalid characters in closing tag");continue;case at.TEXT_ENTITY:case at.ATTRIB_VALUE_ENTITY_Q:case at.ATTRIB_VALUE_ENTITY_U:switch(Y.state){case at.TEXT_ENTITY:Me=at.TEXT,ct="textNode";break;case at.ATTRIB_VALUE_ENTITY_Q:Me=at.ATTRIB_VALUE_QUOTED,ct="attribValue";break;case at.ATTRIB_VALUE_ENTITY_U:Me=at.ATTRIB_VALUE_UNQUOTED,ct="attribValue"}Ve===";"?(Y[ct]+=function(dt){var ft,Rr=dt.entity,gi=Rr.toLowerCase(),q="";return dt.ENTITIES[Rr]?dt.ENTITIES[Rr]:dt.ENTITIES[gi]?dt.ENTITIES[gi]:((Rr=gi).charAt(0)==="#"&&(q=Rr.charAt(1)==="x"?(Rr=Rr.slice(2),(ft=parseInt(Rr,16)).toString(16)):(Rr=Rr.slice(1),(ft=parseInt(Rr,10)).toString(10))),Rr=Rr.replace(/^0+/,""),isNaN(ft)||q.toLowerCase()!==Rr?(Or(dt,"Invalid character entity"),"&"+dt.entity+";"):String.fromCodePoint(ft))}(Y),Y.entity="",Y.state=Me):ar(Y.entity.length?Yt:mr,Ve)?Y.entity+=Ve:(Or(Y,"Invalid character in entity name"),Y[ct]+="&"+Y.entity+Ve,Y.entity="",Y.state=Me);continue;default:throw new Error(Y,"Unknown state: "+Y.state)}return Y.position>=Y.bufferCheckPosition&&function(dt){for(var ft=Math.max(be.MAX_BUFFER_LENGTH,10),Rr=0,gi=0,q=Te.length;gi<q;gi++){var fi=dt[Te[gi]].length;if(ft<fi)switch(Te[gi]){case"textNode":Xr(dt);break;case"cdata":Br(dt,"oncdata",dt.cdata),dt.cdata="";break;case"script":Br(dt,"onscript",dt.script),dt.script="";break;default:ur(dt,"Max buffer length exceeded: "+Te[gi])}Rr=Math.max(Rr,fi)}var $i=be.MAX_BUFFER_LENGTH-Rr;dt.bufferCheckPosition=$i+dt.position}(Y),Y},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var J;Xr(J=this),J.cdata!==""&&(Br(J,"oncdata",J.cdata),J.cdata=""),J.script!==""&&(Br(J,"onscript",J.script),J.script="")}};try{de=(void 0).Stream}catch{de=function(){}}var Ke=be.EVENTS.filter(function(J){return J!=="error"&&J!=="end"});function St(J,Y){if(!(this instanceof St))return new St(J,Y);de.apply(this),this._parser=new Ge(J,Y),this.writable=!0,this.readable=!0;var Me=this;this._parser.onend=function(){Me.emit("end")},this._parser.onerror=function(ct){Me.emit("error",ct),Me._parser.error=null},this._decoder=null,Ke.forEach(function(ct){Object.defineProperty(Me,"on"+ct,{get:function(){return Me._parser["on"+ct]},set:function(Pt){if(!Pt)return Me.removeAllListeners(ct),Me._parser["on"+ct]=Pt;Me.on(ct,Pt)},enumerable:!0,configurable:!1})})}(St.prototype=Object.create(de.prototype,{constructor:{value:St}})).write=function(J){var Y;return typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(J)&&(this._decoder||(Y=ve.StringDecoder,this._decoder=new Y("utf8")),J=this._decoder.write(J)),this._parser.write(J.toString()),this.emit("data",J),!0},St.prototype.end=function(J){return J&&J.length&&this.write(J),this._parser.end(),!0},St.prototype.on=function(J,Y){var Me=this;return Me._parser["on"+J]||Ke.indexOf(J)===-1||(Me._parser["on"+J]=function(){var ct=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);ct.splice(0,0,J),Me.emit.apply(Me,ct)}),de.prototype.on.call(Me,J,Y)};var xt="[CDATA[",Lr="DOCTYPE",Nr="http://www.w3.org/XML/1998/namespace",Sr="http://www.w3.org/2000/xmlns/",Gr={xml:Nr,xmlns:Sr},_t=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Kt=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,mr=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Yt=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function er(J){return J===" "||J===`
`||J==="\r"||J==="	"}function lr(J){return J==='"'||J==="'"}function ar(J,Y){return J.test(Y)}var dr,ii,nr,at=0;for(dr in be.STATE={BEGIN:at++,BEGIN_WHITESPACE:at++,TEXT:at++,TEXT_ENTITY:at++,OPEN_WAKA:at++,SGML_DECL:at++,SGML_DECL_QUOTED:at++,DOCTYPE:at++,DOCTYPE_QUOTED:at++,DOCTYPE_DTD:at++,DOCTYPE_DTD_QUOTED:at++,COMMENT_STARTING:at++,COMMENT:at++,COMMENT_ENDING:at++,COMMENT_ENDED:at++,CDATA:at++,CDATA_ENDING:at++,CDATA_ENDING_2:at++,PROC_INST:at++,PROC_INST_BODY:at++,PROC_INST_ENDING:at++,OPEN_TAG:at++,OPEN_TAG_SLASH:at++,ATTRIB:at++,ATTRIB_NAME:at++,ATTRIB_NAME_SAW_WHITE:at++,ATTRIB_VALUE:at++,ATTRIB_VALUE_QUOTED:at++,ATTRIB_VALUE_CLOSED:at++,ATTRIB_VALUE_UNQUOTED:at++,ATTRIB_VALUE_ENTITY_Q:at++,ATTRIB_VALUE_ENTITY_U:at++,CLOSE_TAG:at++,CLOSE_TAG_SAW_WHITE:at++,SCRIPT:at++,SCRIPT_ENDING:at++},be.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},be.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(be.ENTITIES).forEach(function(J){var Y=be.ENTITIES[J],Y=typeof Y=="number"?String.fromCharCode(Y):Y;be.ENTITIES[J]=Y}),be.STATE)be.STATE[be.STATE[dr]]=dr;function bi(J,Y,Me){J[Y]&&J[Y](Me)}function Br(J,Y,Me){J.textNode&&Xr(J),bi(J,Y,Me)}function Xr(J){J.textNode=cr(J.opt,J.textNode),J.textNode&&bi(J,"ontext",J.textNode),J.textNode=""}function cr(J,Y){return J.trim&&(Y=Y.trim()),Y=J.normalize?Y.replace(/\s+/g," "):Y}function ur(J,Y){return Xr(J),J.trackPosition&&(Y+=`
Line: `+J.line+`
Column: `+J.column+`
Char: `+J.c),Y=new Error(Y),J.error=Y,bi(J,"onerror",Y),J}function yi(J){return J.sawRoot&&!J.closedRoot&&Or(J,"Unclosed root tag"),J.state!==at.BEGIN&&J.state!==at.BEGIN_WHITESPACE&&J.state!==at.TEXT&&ur(J,"Unexpected end"),Xr(J),J.c="",J.closed=!0,bi(J,"onend"),Ge.call(J,J.strict,J.opt),J}function Or(J,Y){if(typeof J!="object"||!(J instanceof Ge))throw new Error("bad call to strictFail");J.strict&&ur(J,Y)}function mi(J,Y){var ct=J.indexOf(":")<0?["",J]:J.split(":"),Me=ct[0],ct=ct[1];return Y&&J==="xmlns"&&(Me="xmlns",ct=""),{prefix:Me,local:ct}}function qt(J){var Y,Me,ct;J.strict||(J.attribName=J.attribName[J.looseCase]()),J.attribList.indexOf(J.attribName)!==-1||J.tag.attributes.hasOwnProperty(J.attribName)||(J.opt.xmlns?(Me=(Y=mi(J.attribName,!0)).prefix,Y=Y.local,Me==="xmlns"&&(Y==="xml"&&J.attribValue!==Nr?Or(J,"xml: prefix must be bound to "+Nr+`
Actual: `+J.attribValue):Y==="xmlns"&&J.attribValue!==Sr?Or(J,"xmlns: prefix must be bound to "+Sr+`
Actual: `+J.attribValue):(Me=J.tag,ct=J.tags[J.tags.length-1]||J,Me.ns===ct.ns&&(Me.ns=Object.create(ct.ns)),Me.ns[Y]=J.attribValue)),J.attribList.push([J.attribName,J.attribValue])):(J.tag.attributes[J.attribName]=J.attribValue,Br(J,"onattribute",{name:J.attribName,value:J.attribValue}))),J.attribName=J.attribValue=""}function Er(J,Y){if(J.opt.xmlns){var Me=J.tag,ct=mi(J.tagName),ct=(Me.prefix=ct.prefix,Me.local=ct.local,Me.uri=Me.ns[ct.prefix]||"",Me.prefix&&!Me.uri&&(Or(J,"Unbound namespace prefix: "+JSON.stringify(J.tagName)),Me.uri=ct.prefix),J.tags[J.tags.length-1]||J);Me.ns&&ct.ns!==Me.ns&&Object.keys(Me.ns).forEach(function(q){Br(J,"onopennamespace",{prefix:q,uri:Me.ns[q]})});for(var Pt=0,Ve=J.attribList.length;Pt<Ve;Pt++){var gi=J.attribList[Pt],pt=gi[0],gi=gi[1],ft=mi(pt,!0),dt=ft.prefix,ft=ft.local,Rr=dt!==""&&Me.ns[dt]||"",gi={name:pt,value:gi,prefix:dt,local:ft,uri:Rr};dt&&dt!=="xmlns"&&!Rr&&(Or(J,"Unbound namespace prefix: "+JSON.stringify(dt)),gi.uri=dt),J.tag.attributes[pt]=gi,Br(J,"onattribute",gi)}J.attribList.length=0}J.tag.isSelfClosing=!!Y,J.sawRoot=!0,J.tags.push(J.tag),Br(J,"onopentag",J.tag),Y||(J.noscript||J.tagName.toLowerCase()!=="script"?J.state=at.TEXT:J.state=at.SCRIPT,J.tag=null,J.tagName=""),J.attribName=J.attribValue="",J.attribList.length=0}function Gt(J){if(!J.tagName)return Or(J,"Weird empty close tag."),J.textNode+="</>",void(J.state=at.TEXT);if(J.script){if(J.tagName!=="script")return J.script+="</"+J.tagName+">",J.tagName="",void(J.state=at.SCRIPT);Br(J,"onscript",J.script),J.script=""}for(var Y=J.tags.length,Me=J.tagName,ct=Me=J.strict?Me:Me[J.looseCase]();Y--&&J.tags[Y].name!==ct;)Or(J,"Unexpected close tag");if(Y<0)return Or(J,"Unmatched closing tag: "+J.tagName),J.textNode+="</"+J.tagName+">",void(J.state=at.TEXT);J.tagName=Me;for(var Pt=J.tags.length;Pt-- >Y;){var Ve,pt=J.tag=J.tags.pop(),dt=(J.tagName=J.tag.name,Br(J,"onclosetag",J.tagName),{});for(Ve in pt.ns)dt[Ve]=pt.ns[Ve];var ft=J.tags[J.tags.length-1]||J;J.opt.xmlns&&pt.ns!==ft.ns&&Object.keys(pt.ns).forEach(function(Rr){var gi=pt.ns[Rr];Br(J,"onclosenamespace",{prefix:Rr,uri:gi})})}Y===0&&(J.closedRoot=!0),J.tagName=J.attribValue=J.attribName="",J.attribList.length=0,J.state=at.TEXT}function Jt(J,Y){Y==="<"?(J.state=at.OPEN_WAKA,J.startTagPosition=J.position):er(Y)||(Or(J,"Non-whitespace before first tag."),J.textNode=Y,J.state=at.TEXT)}function st(J,Y){var Me="";return Me=Y<J.length?J.charAt(Y):Me}function Pr(){var J=[],Y=-1,Me=arguments.length;if(!Me)return"";for(var ct="";++Y<Me;){var Pt=Number(arguments[Y]);if(!isFinite(Pt)||Pt<0||1114111<Pt||nr(Pt)!==Pt)throw RangeError("Invalid code point: "+Pt);Pt<=65535?J.push(Pt):(Pt-=65536,J.push(55296+(Pt>>10),Pt%1024+56320)),(Y+1===Me||16384<J.length)&&(ct+=ii.apply(null,J),J.length=0)}return ct}at=be.STATE,String.fromCodePoint||(ii=String.fromCharCode,nr=Math.floor,Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:Pr,configurable:!0,writable:!0}):String.fromCodePoint=Pr);var ht,Nt,xr=function(J){return Array.isArray?Array.isArray(J):Object.prototype.toString.call(J)==="[object Array]"},Qr=xr,Ft={copyOptions:function(J){var Y,Me={};for(Y in J)J.hasOwnProperty(Y)&&(Me[Y]=J[Y]);return Me},ensureFlagExists:function(J,Y){J in Y&&typeof Y[J]=="boolean"||(Y[J]=!1)},ensureSpacesExists:function(J){"spaces"in J&&(typeof J.spaces=="number"||typeof J.spaces=="string")||(J.spaces=0)},ensureAlwaysArrayExists:function(J){"alwaysArray"in J&&(typeof J.alwaysArray=="boolean"||Qr(J.alwaysArray))||(J.alwaysArray=!1)},ensureKeyExists:function(J,Y){J+"Key"in Y&&typeof Y[J+"Key"]=="string"||(Y[J+"Key"]=Y.compact?"_"+J:J)},checkFnExists:function(J,Y){return J+"Fn"in Y}},zr=Xi,br=Ft,xi=xr;function ui(J){var Y=Number(J);return isNaN(Y)?(Y=J.toLowerCase(),Y==="true"||Y!=="false"&&J):Y}function di(J,Y){var Me,ct;if(ht.compact){if(!Nt[ht[J+"Key"]]&&(xi(ht.alwaysArray)?ht.alwaysArray.indexOf(ht[J+"Key"])!==-1:ht.alwaysArray)&&(Nt[ht[J+"Key"]]=[]),Nt[ht[J+"Key"]]&&!xi(Nt[ht[J+"Key"]])&&(Nt[ht[J+"Key"]]=[Nt[ht[J+"Key"]]]),J+"Fn"in ht&&typeof Y=="string"&&(Y=ht[J+"Fn"](Y,Nt)),J==="instruction"&&("instructionFn"in ht||"instructionNameFn"in ht))for(Me in Y)Y.hasOwnProperty(Me)&&("instructionFn"in ht?Y[Me]=ht.instructionFn(Y[Me],Me,Nt):(ct=Y[Me],delete Y[Me],Y[ht.instructionNameFn(Me,ct,Nt)]=ct));xi(Nt[ht[J+"Key"]])?Nt[ht[J+"Key"]].push(Y):Nt[ht[J+"Key"]]=Y}else{Nt[ht.elementsKey]||(Nt[ht.elementsKey]=[]);var Pt={};if((Pt[ht.typeKey]=J)==="instruction"){for(Me in Y)if(Y.hasOwnProperty(Me))break;Pt[ht.nameKey]="instructionNameFn"in ht?ht.instructionNameFn(Me,Y,Nt):Me,ht.instructionHasAttributes?(Pt[ht.attributesKey]=Y[Me][ht.attributesKey],"instructionFn"in ht&&(Pt[ht.attributesKey]=ht.instructionFn(Pt[ht.attributesKey],Me,Nt))):("instructionFn"in ht&&(Y[Me]=ht.instructionFn(Y[Me],Me,Nt)),Pt[ht.instructionKey]=Y[Me])}else J+"Fn"in ht&&(Y=ht[J+"Fn"](Y,Nt)),Pt[ht[J+"Key"]]=Y;ht.addParent&&(Pt[ht.parentKey]=Nt),Nt[ht.elementsKey].push(Pt)}}function Ti(J){var Y,Me;if("attributesFn"in ht&&J&&(J=ht.attributesFn(J,Nt)),(ht.trim||"attributeValueFn"in ht||"attributeNameFn"in ht||ht.nativeTypeAttributes)&&J)for(Y in J)J.hasOwnProperty(Y)&&(ht.trim&&(J[Y]=J[Y].trim()),ht.nativeTypeAttributes&&(J[Y]=ui(J[Y])),"attributeValueFn"in ht&&(J[Y]=ht.attributeValueFn(J[Y],Y,Nt)),"attributeNameFn"in ht&&(Me=J[Y],delete J[Y],J[ht.attributeNameFn(Y,J[Y],Nt)]=Me));return J}function Yi(J){var Y,Me={};if(J.body&&(J.name.toLowerCase()==="xml"||ht.instructionHasAttributes)){for(var ct,Pt=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g;(ct=Pt.exec(J.body))!==null;)Me[ct[1]]=ct[2]||ct[3]||ct[4];Me=Ti(Me)}J.name.toLowerCase()==="xml"?ht.ignoreDeclaration||(Nt[ht.declarationKey]={},Object.keys(Me).length&&(Nt[ht.declarationKey][ht.attributesKey]=Me),ht.addParent&&(Nt[ht.declarationKey][ht.parentKey]=Nt)):ht.ignoreInstruction||(ht.trim&&(J.body=J.body.trim()),Y={},ht.instructionHasAttributes&&Object.keys(Me).length?(Y[J.name]={},Y[J.name][ht.attributesKey]=Me):Y[J.name]=J.body,di("instruction",Y))}function Zi(J,Y){if(typeof J=="object"&&(Y=J.attributes,J=J.name),Y=Ti(Y),"elementNameFn"in ht&&(J=ht.elementNameFn(J,Nt)),ht.compact){var Me,ct={};if(!ht.ignoreAttributes&&Y&&Object.keys(Y).length)for(Me in ct[ht.attributesKey]={},Y)Y.hasOwnProperty(Me)&&(ct[ht.attributesKey][Me]=Y[Me]);J in Nt||(xi(ht.alwaysArray)?ht.alwaysArray.indexOf(J)===-1:!ht.alwaysArray)||(Nt[J]=[]),Nt[J]&&!xi(Nt[J])&&(Nt[J]=[Nt[J]]),xi(Nt[J])?Nt[J].push(ct):Nt[J]=ct}else Nt[ht.elementsKey]||(Nt[ht.elementsKey]=[]),(ct={})[ht.typeKey]="element",ct[ht.nameKey]=J,!ht.ignoreAttributes&&Y&&Object.keys(Y).length&&(ct[ht.attributesKey]=Y),ht.alwaysChildren&&(ct[ht.elementsKey]=[]),Nt[ht.elementsKey].push(ct);ct[ht.parentKey]=Nt,Nt=ct}function oi(J){ht.ignoreText||(J.trim()||ht.captureSpacesBetweenElements)&&(ht.trim&&(J=J.trim()),ht.nativeType&&(J=ui(J)),di("text",J=ht.sanitize?J.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):J))}function En(J){ht.ignoreComment||di("comment",J=ht.trim?J.trim():J)}function fo(J){var Y=Nt[ht.parentKey];ht.addParent||delete Nt[ht.parentKey],Nt=Y}function po(J){ht.ignoreCdata||di("cdata",J=ht.trim?J.trim():J)}function bn(J){ht.ignoreDoctype||(J=J.replace(/^ /,""),di("doctype",J=ht.trim?J.trim():J))}function oo(J){J.note=J}function Vi(J,Y){var Me=zr.parser(!0,{}),ct={};return Nt=ct,ht=br.copyOptions(Y),br.ensureFlagExists("ignoreDeclaration",ht),br.ensureFlagExists("ignoreInstruction",ht),br.ensureFlagExists("ignoreAttributes",ht),br.ensureFlagExists("ignoreText",ht),br.ensureFlagExists("ignoreComment",ht),br.ensureFlagExists("ignoreCdata",ht),br.ensureFlagExists("ignoreDoctype",ht),br.ensureFlagExists("compact",ht),br.ensureFlagExists("alwaysChildren",ht),br.ensureFlagExists("addParent",ht),br.ensureFlagExists("trim",ht),br.ensureFlagExists("nativeType",ht),br.ensureFlagExists("nativeTypeAttributes",ht),br.ensureFlagExists("sanitize",ht),br.ensureFlagExists("instructionHasAttributes",ht),br.ensureFlagExists("captureSpacesBetweenElements",ht),br.ensureAlwaysArrayExists(ht),br.ensureKeyExists("declaration",ht),br.ensureKeyExists("instruction",ht),br.ensureKeyExists("attributes",ht),br.ensureKeyExists("text",ht),br.ensureKeyExists("comment",ht),br.ensureKeyExists("cdata",ht),br.ensureKeyExists("doctype",ht),br.ensureKeyExists("type",ht),br.ensureKeyExists("name",ht),br.ensureKeyExists("elements",ht),br.ensureKeyExists("parent",ht),Me.opt={strictEntities:!0},Me.onopentag=Zi,Me.ontext=oi,Me.oncomment=En,Me.onclosetag=fo,Me.onerror=oo,Me.oncdata=po,Me.ondoctype=bn,Me.onprocessinginstruction=Yi,Me.write(J).close(),ct[ht.elementsKey]&&(Y=ct[ht.elementsKey],delete ct[ht.elementsKey],ct[ht.elementsKey]=Y,delete ct.text),ct}var Xn=Ft,Pn=Vi,hn,Ie,ut=Ft,Bt=xr;function _e(J,Y,Me){return(!Me&&J.spaces?`
`:"")+Array(Y+1).join(J.spaces)}function ae(J,Y,Me){if(Y.ignoreAttributes)return"";var ct,Pt,Ve,pt,dt=[];for(ct in J="attributesFn"in Y?Y.attributesFn(J,Ie,hn):J)J.hasOwnProperty(ct)&&J[ct]!==null&&J[ct]!==void 0&&(pt=Y.noQuotesForNativeAttributes&&typeof J[ct]!="string"?"":'"',Pt=(Pt=""+J[ct]).replace(/"/g,"&quot;"),Ve="attributeNameFn"in Y?Y.attributeNameFn(ct,Pt,Ie,hn):ct,dt.push(Y.spaces&&Y.indentAttributes?_e(Y,Me+1,!1):" "),dt.push(Ve+"="+pt+("attributeValueFn"in Y?Y.attributeValueFn(Pt,ct,Ie,hn):Pt)+pt));return J&&Object.keys(J).length&&Y.spaces&&Y.indentAttributes&&dt.push(_e(Y,Me,!1)),dt.join("")}function fe(J,Y,Me){return hn=J,Ie="xml",Y.ignoreDeclaration?"":"<?xml"+ae(J[Y.attributesKey],Y,Me)+"?>"}function ke(J,Y,Me){if(Y.ignoreInstruction)return"";for(var ct in J)if(J.hasOwnProperty(ct))break;var Pt="instructionNameFn"in Y?Y.instructionNameFn(ct,J[ct],Ie,hn):ct;return typeof J[ct]=="object"?"<?"+(Ie=Pt)+ae((hn=J)[ct][Y.attributesKey],Y,Me)+"?>":(Me=J[ct]||"","<?"+Pt+((Me="instructionFn"in Y?Y.instructionFn(Me,ct,Ie,hn):Me)?" "+Me:"")+"?>")}function Fe(J,Y){return Y.ignoreComment?"":"<!--"+("commentFn"in Y?Y.commentFn(J,Ie,hn):J)+"-->"}function Ye(J,Y){return Y.ignoreCdata?"":"<![CDATA["+("cdataFn"in Y?Y.cdataFn(J,Ie,hn):J.replace("]]>","]]]]><![CDATA[>"))+"]]>"}function mt(J,Y){return Y.ignoreDoctype?"":"<!DOCTYPE "+("doctypeFn"in Y?Y.doctypeFn(J,Ie,hn):J)+">"}function yt(J,Y){return Y.ignoreText?"":(J=(J=(J=""+J).replace(/&amp;/g,"&")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"textFn"in Y?Y.textFn(J,Ie,hn):J)}function Je(J,Y,Me){Ie=(hn=J).name;var ct=[],Pt="elementNameFn"in Y?Y.elementNameFn(J.name,J):J.name,Ve=(ct.push("<"+Pt),J[Y.attributesKey]&&ct.push(ae(J[Y.attributesKey],Y,Me)),J[Y.elementsKey]&&J[Y.elementsKey].length||J[Y.attributesKey]&&J[Y.attributesKey]["xml:space"]==="preserve");return(Ve=Ve||("fullTagEmptyElementFn"in Y?Y.fullTagEmptyElementFn(J.name,J):Y.fullTagEmptyElement))?(ct.push(">"),J[Y.elementsKey]&&J[Y.elementsKey].length&&(ct.push(vt(J[Y.elementsKey],Y,Me+1)),Ie=(hn=J).name),ct.push(Y.spaces&&function(pt,dt){var ft;if(pt.elements&&pt.elements.length)for(ft=0;ft<pt.elements.length;++ft)switch(pt.elements[ft][dt.typeKey]){case"text":if(dt.indentText)return 1;break;case"cdata":if(dt.indentCdata)return 1;break;case"instruction":if(dt.indentInstruction)return 1;break;default:return 1}}(J,Y)?`
`+Array(Me+1).join(Y.spaces):""),ct.push("</"+Pt+">")):ct.push("/>"),ct.join("")}function vt(J,Y,Me,ct){return J.reduce(function(Pt,Ve){var pt=_e(Y,Me,ct&&!Pt);switch(Ve.type){case"element":return Pt+pt+Je(Ve,Y,Me);case"comment":return Pt+pt+Fe(Ve[Y.commentKey],Y);case"doctype":return Pt+pt+mt(Ve[Y.doctypeKey],Y);case"cdata":return Pt+(Y.indentCdata?pt:"")+Ye(Ve[Y.cdataKey],Y);case"text":return Pt+(Y.indentText?pt:"")+yt(Ve[Y.textKey],Y);case"instruction":var dt={};return dt[Ve[Y.nameKey]]=Ve[Y.attributesKey]?Ve:Ve[Y.instructionKey],Pt+(Y.indentInstruction?pt:"")+ke(dt,Y,Me)}},"")}function $t(J,Y,Me){for(var ct in J)if(J.hasOwnProperty(ct))switch(ct){case Y.parentKey:case Y.attributesKey:break;case Y.textKey:if(Y.indentText||Me)return!0;break;case Y.cdataKey:if(Y.indentCdata||Me)return!0;break;case Y.instructionKey:if(Y.indentInstruction||Me)return!0;break;case Y.doctypeKey:case Y.commentKey:default:return!0}return!1}function Ar(J,Y,Me,ct){var Pt,Ve,pt,dt=[];for(Ve in J)if(J.hasOwnProperty(Ve))for(pt=Bt(J[Ve])?J[Ve]:[J[Ve]],Pt=0;Pt<pt.length;++Pt){switch(Ve){case Y.declarationKey:dt.push(fe(pt[Pt],Y,Me));break;case Y.instructionKey:dt.push((Y.indentInstruction?_e(Y,Me,ct):"")+ke(pt[Pt],Y,Me));break;case Y.attributesKey:case Y.parentKey:break;case Y.textKey:dt.push((Y.indentText?_e(Y,Me,ct):"")+yt(pt[Pt],Y));break;case Y.cdataKey:dt.push((Y.indentCdata?_e(Y,Me,ct):"")+Ye(pt[Pt],Y));break;case Y.doctypeKey:dt.push(_e(Y,Me,ct)+mt(pt[Pt],Y));break;case Y.commentKey:dt.push(_e(Y,Me,ct)+Fe(pt[Pt],Y));break;default:dt.push(_e(Y,Me,ct)+function(ft,Rr,gi,q,fi){hn=ft,Ie=Rr;var $i="elementNameFn"in gi?gi.elementNameFn(Rr,ft):Rr;if(ft==null||ft==="")return"fullTagEmptyElementFn"in gi&&gi.fullTagEmptyElementFn(Rr,ft)||gi.fullTagEmptyElement?"<"+$i+"></"+$i+">":"<"+$i+"/>";var ji=[];if(Rr){if(ji.push("<"+$i),typeof ft!="object")return ji.push(">"+yt(ft,gi)+"</"+$i+">"),ji.join("");ft[gi.attributesKey]&&ji.push(ae(ft[gi.attributesKey],gi,q));var Hi=$t(ft,gi,!0)||ft[gi.attributesKey]&&ft[gi.attributesKey]["xml:space"]==="preserve";if(!(Hi=Hi||("fullTagEmptyElementFn"in gi?gi.fullTagEmptyElementFn(Rr,ft):gi.fullTagEmptyElement)))return ji.push("/>"),ji.join("");ji.push(">")}return ji.push(Ar(ft,gi,q+1,!1)),hn=ft,(Ie=Rr)&&ji.push((fi?_e(gi,q,!1):"")+"</"+$i+">"),ji.join("")}(pt[Pt],Ve,Y,Me,$t(pt[Pt],Y)))}ct=ct&&!dt.length}return dt.join("")}function Qt(J,Y){Me=Y,Me=ut.copyOptions(Me),ut.ensureFlagExists("ignoreDeclaration",Me),ut.ensureFlagExists("ignoreInstruction",Me),ut.ensureFlagExists("ignoreAttributes",Me),ut.ensureFlagExists("ignoreText",Me),ut.ensureFlagExists("ignoreComment",Me),ut.ensureFlagExists("ignoreCdata",Me),ut.ensureFlagExists("ignoreDoctype",Me),ut.ensureFlagExists("compact",Me),ut.ensureFlagExists("indentText",Me),ut.ensureFlagExists("indentCdata",Me),ut.ensureFlagExists("indentAttributes",Me),ut.ensureFlagExists("indentInstruction",Me),ut.ensureFlagExists("fullTagEmptyElement",Me),ut.ensureFlagExists("noQuotesForNativeAttributes",Me),ut.ensureSpacesExists(Me),typeof Me.spaces=="number"&&(Me.spaces=Array(Me.spaces+1).join(" ")),ut.ensureKeyExists("declaration",Me),ut.ensureKeyExists("instruction",Me),ut.ensureKeyExists("attributes",Me),ut.ensureKeyExists("text",Me),ut.ensureKeyExists("comment",Me),ut.ensureKeyExists("cdata",Me),ut.ensureKeyExists("doctype",Me),ut.ensureKeyExists("type",Me),ut.ensureKeyExists("name",Me),ut.ensureKeyExists("elements",Me);var Me,ct=[];return hn=J,Ie="_root_",(Y=Me).compact?ct.push(Ar(J,Y,0,!0)):(J[Y.declarationKey]&&ct.push(fe(J[Y.declarationKey],Y,0)),J[Y.elementsKey]&&J[Y.elementsKey].length&&ct.push(vt(J[Y.elementsKey],Y,0,!ct.length))),ct.join("")}var Kr,ri=Qt,Wr={xml2js:Vi,xml2json:function(J,Y){var Me;return Y=Y,Y=Xn.copyOptions(Y),Xn.ensureSpacesExists(Y),Y=Pn(J,J=Y),Me="compact"in J&&J.compact?"_parent":"parent",("addParent"in J&&J.addParent?JSON.stringify(Y,function(ct,Pt){return ct===Me?"_":Pt},J.spaces):JSON.stringify(Y,null,J.spaces)).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},js2xml:Qt,json2xml:function(J,Y){var Me=null;if(typeof(J=J instanceof Buffer?J.toString():J)=="string")try{Me=JSON.parse(J)}catch{throw new Error("The JSON structure is invalid")}else Me=J;return ri(Me,Y)}},ni={raster:{},vector:{}};function Bi(J){return J&&(J=Wr.xml2js(J),J.elements&&0<J.elements.length&&(J.elements.length!==1&&console.warn("invalid xml!"),J.elements[0]&&J.elements[0].elements))?J.elements[0].elements.map(function(Y){var Me=Y.attributes;return Y.elements&&0<Y.elements.length&&(Me.options=Y.elements.map(function(ct){return ct.elements[0].text})),Me}):null}function et(){for(var J,Y,Me,ct=X.GDALGetDriverCount(),Pt=0;Pt<ct;Pt+=1){var Ve=X.GDALGetDriver(Pt),pt=(Ve=Ve,Me=Y=pt=J=void 0,J=X.GDALGetMetadataItem(Ve,"DMD_EXTENSIONS",null),(pt=(pt=X.GDALGetMetadataItem(Ve,"DMD_EXTENSION",null))===""&&J!==""?J.split(" ")[0]:pt)!==""&&(pt=pt.replace(".","").replace("/","")),(Y=X.GDALGetDescription(Ve))==="GeoJSON"&&(pt="geojson"),Me=X.GDALGetMetadataItem(Ve,"DMD_LONGNAME",null),{extension:pt,extensions:J,shortName:Y,longName:Me,isReadable:X.GDALGetMetadataItem(Ve,"DCAP_OPEN",null)==="YES",isWritable:X.GDALGetMetadataItem(Ve,"DCAP_CREATE",null)==="YES"||X.GDALGetMetadataItem(Ve,"DCAP_CREATECOPY",null)==="YES",isRaster:X.GDALGetMetadataItem(Ve,"DCAP_RASTER",null)==="YES",isVector:X.GDALGetMetadataItem(Ve,"DCAP_VECTOR",null)==="YES",openOptionsList:Bi(X.GDALGetMetadataItem(Ve,"DMD_OPENOPTIONLIST",null)),creationOptionList:Bi(X.GDALGetMetadataItem(Ve,"DMD_CREATIONOPTIONLIST",null)),layerCreationOptionList:Bi(X.GDALGetMetadataItem(Ve,"DS_LAYER_CREATIONOPTIONLIST",null)),helpUrl:X.GDALGetMetadataItem(Ve,"DMD_HELPTOPIC",null)});pt.isRaster&&(ni.raster[pt.shortName]=g(g({index:Pt},pt),{},{type:"raster"})),pt.isVector&&(ni.vector[pt.shortName]=g(g({index:Pt},pt),{},{type:"vector"}))}}function tr(){!u&&typeof importScripts!="function"||X.Module.FS.unmount(ue)}var gr={ogr2ogr:function(J){var Y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(Me,ct){var Pt=oe(Y),Ve=Pt.config,Ve=(Object.entries(Ve).forEach(function(fi){var fi=T(fi,2),q=fi[0],fi=fi[1];X.CPLSetConfigOption(q,fi)}),X.GDALVectorTranslateOptionsNew(Pt.ptr,null)),Rr=X.Module._malloc(4),dt=(X.Module.setValue(Rr,J.pointer,"*"),Y.indexOf("-f")+1),pt="unknown",dt=(dt!==0&&(dt=Y[dt],(ft=ni.vector[dt])&&(pt=dt==="MapInfo File"&&Y.indexOf("FORMAT=MIF")!==-1?"mif":ft.extension)),J.path.split(".",1)[0]),ft="".concat(Re,"/").concat(dt,".").concat(pt),Rr=X.GDALVectorTranslate(ft,null,1,Rr,Ve,null);X.GDALVectorTranslateOptionsFree(Ve),le(Pt),X.GDALClose(Rr),X.CPLGetLastErrorNo()!==0?ct(ye()):Me({local:ft,real:"".concat(ze,"/").concat(dt,".").concat(pt)})})},gdal_translate:function(J){var Y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(Me,ct){var Pt=oe(Y),Ve=Pt.config,Ve=(Object.entries(Ve).forEach(function(fi){var fi=T(fi,2),q=fi[0],fi=fi[1];X.CPLSetConfigOption(q,fi)}),X.GDALTranslateOptionsNew(Pt.ptr,null)),dt=Y.indexOf("-of")+1,pt="unknown",dt=(dt!==0&&(dt=Y[dt],(dt=ni.raster[dt])&&(pt=dt.extension)),J.path.split(".",1)[0]),ft="".concat(Re,"/").concat(dt,".").concat(pt),Rr=X.GDALTranslate(ft,J.pointer,Ve,null);X.GDALTranslateOptionsFree(Ve),le(Pt),X.GDALClose(Rr),X.CPLGetLastErrorNo()!==0?ct(ye()):Me({local:ft,real:"".concat(ze,"/").concat(dt,".").concat(pt)})})},gdal_rasterize:function(J){var Y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(Me,ct){var Pt=oe(Y),Ve=Pt.config,Ve=(Object.entries(Ve).forEach(function(fi){var fi=T(fi,2),q=fi[0],fi=fi[1];X.CPLSetConfigOption(q,fi)}),X.GDALRasterizeOptionsNew(Pt.ptr,null)),dt=Y.indexOf("-of")+1,pt="tif",dt=(dt!==0&&(dt=Y[dt],(dt=ni.raster[dt])&&(pt=dt.extension)),J.path.split(".",1)[0]),ft="".concat(Re,"/").concat(dt,".").concat(pt),Rr=X.GDALRasterize(ft,null,J.pointer,Ve,null);X.GDALRasterizeOptionsFree(Ve),le(Pt),X.GDALClose(Rr),X.CPLGetLastErrorNo()!==0?ct(ye()):Me({local:ft,real:"".concat(ze,"/").concat(dt,".").concat(pt)})})},gdalwarp:function(J){var Y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(Me,ct){var Pt=oe(Y),Ve=Pt.config,Ve=(Object.entries(Ve).forEach(function(fi){var fi=T(fi,2),q=fi[0],fi=fi[1];X.CPLSetConfigOption(q,fi)}),X.GDALWarpAppOptionsNew(Pt.ptr,null)),Rr=X.Module._malloc(4),dt=(X.Module.setValue(Rr,J.pointer,"*"),Y.indexOf("-of")+1),pt="unknown",dt=(dt!==0&&(dt=Y[dt],(dt=ni.raster[dt])&&(pt=dt.extension)),J.path.split(".",1)[0]),ft="".concat(Re,"/").concat(dt,".").concat(pt),Rr=X.GDALWarp(ft,null,1,Rr,Ve,null);X.GDALWarpAppOptionsFree(Ve),le(Pt),X.GDALClose(Rr),X.CPLGetLastErrorNo()!==0?ct(ye()):Me({local:ft,real:"".concat(ze,"/").concat(dt,".").concat(pt)})})},gdaltransform:function(J,Y){return new Promise(function(Me){for(var ct=new Float64Array(J.map(function(ee){return ee[0]})),Pt=new Float64Array(J.map(function(ee){return ee[1]})),Ve=new Float64Array(J.map(function(ee){return ee[2]||0})),pt=X.Module._malloc(ct.length*ct.BYTES_PER_ELEMENT),dt=X.Module._malloc(Pt.length*Pt.BYTES_PER_ELEMENT),ft=X.Module._malloc(Ve.length*Ve.BYTES_PER_ELEMENT),Rr=(X.Module.HEAPF64.set(ct,pt/ct.BYTES_PER_ELEMENT),X.Module.HEAPF64.set(Pt,dt/Pt.BYTES_PER_ELEMENT),X.Module.HEAPF64.set(Ve,ft/Ve.BYTES_PER_ELEMENT),!1),gi=!1,q=[],fi=0;fi<Y.length;fi+=1)switch(Y[fi]){case"-s_srs":fi+=1,q.push("SRC_SRS=".concat(Y[fi]));break;case"-t_srs":fi+=1,q.push("DST_SRS=".concat(Y[fi]));break;case"-ct":fi+=1,q.push("COORDINATE_OPERATION=".concat(Y[fi]));break;case"-order":fi+=1,q.push("MAX_GCP_ORDER=".concat(Y[fi]));break;case"-tps":q.push("METHOD=GCP_TPS");break;case"-rpc":q.push("METHOD=RPC");break;case"-geoloc":q.push("METHOD=GEOLOC_ARRAY");break;case"-i":Rr=!0;break;case"-to":fi+=1,q.push("".concat(Y[fi]));break;case"-output_xy":gi=!0}for(var $i=oe(q),ji=X.GDALCreateGenImgProjTransformer2(null,null,$i.ptr),Hi=(X.GDALGenImgProjTransform(ji,Rr,J.length,pt,dt,ft,null),[Array.from(X.Module.HEAPF64.subarray(pt/ct.BYTES_PER_ELEMENT,pt/ct.BYTES_PER_ELEMENT+ct.length)),Array.from(X.Module.HEAPF64.subarray(dt/Pt.BYTES_PER_ELEMENT,dt/Pt.BYTES_PER_ELEMENT+Pt.length)),Array.from(X.Module.HEAPF64.subarray(ft/Ve.BYTES_PER_ELEMENT,ft/Ve.BYTES_PER_ELEMENT+Ve.length))]),Ai=[],z=0;z<Hi[0].length;z+=1)gi?Ai.push([Hi[0][z],Hi[1][z]]):Ai.push([Hi[0][z],Hi[1][z],Hi[2][z]]);X.Module._free(pt),X.Module._free(dt),X.Module._free(ft),le($i),X.GDALDestroyGenImgProjTransformer(ji),Me(Ai)})},open:function(J){var Y=J,Me=oe(1<arguments.length&&arguments[1]!==void 0?arguments[1]:[]);return Array.isArray(Y)||typeof FileList=="function"&&Y instanceof FileList||(Y=[Y]),new Promise(function(ct,Pt){var Ve,pt=[],dt=[];C(Y).forEach(function(ft){!(typeof ft=="string"||ft instanceof String)||ft.substr(0,ue.length+1)!=="".concat(ue,"/")&&ft.substr(0,Re.length+1)!=="".concat(Re,"/")?dt.push(ft):pt.push({name:ft.substr(Re.length+1),internal:!0})}),Ve=dt,new Promise(function(ft){var Rr,gi;Ve.length===0?ft([]):u?(Rr=[],Ve.forEach(function($i){var $i=$i.split("/"),fi=$i.pop(),$i=$i.join("/")||".";Kr!==$i&&(Kr&&tr(),Kr=$i,X.Module.FS.mount(X.Module.NODEFS,{root:$i},ue)),Rr.push({name:fi})}),ft(Rr)):typeof importScripts=="function"?(Kr&&tr(),X.Module.FS.mount(X.Module.WORKERFS,{files:Ve},ue),Kr=!0,ft(Ve)):(gi=[],Ve.forEach(function(q){gi.push(q.arrayBuffer())}),Promise.all(gi).then(function(q){q.forEach(function(fi,$i){fi=new Uint8Array(fi),X.Module.FS.writeFile("".concat(ue,"/").concat(Ve[$i].name),fi)}),ft(Ve)}))}).then(function(ft){for(var Rr=[].concat(C(ft),pt),gi=[],q=(X.CPLErrorReset(),{}),fi=0;fi<Rr.length;fi+=1){var $i,ji=Rr[fi].name,Hi=ji.split(".",1)[0];q[Hi]||(q[Hi]={}),q[Hi].pointer||(q[Hi].path=ji,$i="".concat(ue,"/").concat(ji),Rr[fi].internal&&($i="".concat(Re,"/").concat(ji)),ji=X.GDALOpenEx($i,null,null,Me.ptr,null),X.CPLGetLastErrorNo()!==0||ji===0?($i=ye(),gi.push($i),delete q[Hi]):(q[Hi].pointer=ji,$i=X.GDALGetRasterCount(ji),ji=X.GDALDatasetGetLayerCount(ji),q[Hi].type=0<$i&&ji===0?"raster":"vector"))}le(Me),ft=Object.values(q),0<ft.length||gi.length===0?ct({datasets:ft,errors:gi}):Pt(gi)})})},close:function(J){return new Promise(function(Y){X.GDALClose(J.pointer),Y()})},getInfo:function(J){return new Promise(function(Y){var Me=X.GDALGetRasterCount(J.pointer),ct=X.GDALDatasetGetLayerCount(J.pointer);if(0<Me&&ct===0){var Pt=X.GDALGetRasterXSize(J.pointer),Ve=X.GDALGetRasterYSize(J.pointer),pt=X.GDALGetProjectionRef(J.pointer),ft=X.Module._malloc(6*Float64Array.BYTES_PER_ELEMENT),dt=(X.GDALGetGeoTransform(J.pointer,ft),X.Module.HEAPF64.subarray(ft/Float64Array.BYTES_PER_ELEMENT,ft/Float64Array.BYTES_PER_ELEMENT+6)),ft=[[0,0],[Pt,0],[Pt,Ve],[0,Ve]].map(function(z){var Ai=z[0],z=z[1];return[dt[0]+dt[1]*Ai+dt[2]*z,dt[3]+dt[4]*Ai+dt[5]*z]}),Rr=X.GDALGetDatasetDriver(J.pointer),Rr=X.GDALGetDriverLongName(Rr),gi=X.OGR_DS_GetName(J.pointer);Y(JSON.parse(JSON.stringify({type:"raster",bandCount:Me,width:Pt,height:Ve,projectionWkt:pt,coordinateTransform:dt,corners:ft,driverName:Rr,dsName:gi})))}else{for(var q=[],fi=0;fi<ct;fi+=1){var ji=X.OGR_DS_GetLayer(J.pointer,fi),$i=X.OGR_L_GetName(ji),ji=X.OGR_L_GetFeatureCount(ji,1);q.push({name:$i,featureCount:ji})}Me=q.reduce(function(Hi,Ai){return Hi+Ai.featureCount},0),Pt=X.OGR_DS_GetName(J.pointer),Ve=X.GDALGetDatasetDriver(J.pointer),Y({type:"vector",layerCount:ct,featureCount:Me,layers:q,dsName:Pt,driverName:X.GDALGetDriverLongName(Ve)})}})},getOutputFiles:function(){return new Promise(function(J){J(function Y(Me){var ct=0<arguments.length&&Me!==void 0?Me:Re.substr(1),Pt=ct.split("/").reduce(function(pt,dt){return pt.contents[dt]},X.Module.FS.root).contents,Ve=[];return Object.keys(Pt).forEach(function(pt){var dt=Pt[pt];dt.usedBytes?Ve.push({path:"/".concat(ct,"/").concat(pt),size:dt.usedBytes}):dt.contents&&Ve.push.apply(Ve,C(Y("".concat(ct,"/").concat(pt))))}),Ve}())})},getFileBytes:function(J){return new Promise(function(Y){var Me;J?(Me=J.local||J,Y(X.Module.FS.readFile(Me,{encoding:"binary"}))):Y(new Uint8Array)})},drivers:ni};function Jr(J){var Y;onmessage=function(Me){var ct;return Me.data&&Me.data.func==="constructor"?(ct={useWorker:!1},Me.data.params&&Me.data.params.config&&(ct=g(g({},Me.data.params.config),ct)),(Y=J(ct)).then(function(Pt){return Pt=Pt.drivers,postMessage({success:!0,id:"onload",data:Pt})}).catch(function(Pt){return postMessage({success:!1,id:"onload",data:Pt})}),null):Y.then(function(Pt){var Ve=this;this.data&&this.data.func&&Pt[this.data.func]?Pt[this.data.func].apply(Pt,C(this.data.params)).then(function(pt){postMessage({success:!0,id:Ve.data.id,data:pt})}).catch(function(pt){postMessage({success:!1,id:Ve.data.id,data:{message:pt.message}})}):console.error("undefined function",this.data)}.bind(Me)).catch(function(Pt){postMessage({success:!1,id:this.id,data:{no:-1,message:Pt.message}})}.bind(Me))}}var Ji,Gi={gdalWorkerWrapper:null,drivers:null},Xi=function(){function J(ct,Pt,Ve){var pt=this;if(!(this instanceof J))throw new TypeError("Cannot call a class as a function");this.promises={onload:{resolve:Ve,reject:console.error}},this.gdalWorker=new Worker(ct),this.gdalWorker.onmessage=function(dt){dt.data&&dt.data.id&&pt.promises[dt.data.id]&&(dt.data.success?pt.promises[dt.data.id].resolve(dt.data.data):pt.promises[dt.data.id].reject(dt.data.data))},this.gdalWorker.postMessage({func:"constructor",params:{config:Pt}})}var Y,Me;return Y=J,(Me=[{key:"call",value:function(ct){var Pt=this;return new Promise(function(Ve,pt){ct.id=Math.floor(1e5*Math.random()),Pt.promises[ct.id]={resolve:Ve,reject:pt},Pt.gdalWorker.postMessage(ct)})}},{key:"terminate",value:function(){this.gdalWorker.terminate(),delete this.gdalWorker,delete this.promises}}])&&b(Y.prototype,Me),Object.defineProperty(Y,"prototype",{writable:!1}),J}(),Ft=new Proxy({},{get:function(J,Y){return Y==="then"||Y==="catch"?J:Y==="drivers"?Gi.drivers:function(){for(var Me=arguments.length,ct=new Array(Me),Pt=0;Pt<Me;Pt++)ct[Pt]=arguments[Pt];return new Promise(function(Ve,pt){Gi.gdalWorkerWrapper.call({func:Y,params:ct}).then(function(dt){Ve(dt)}).catch(function(dt){return pt(dt)})})}}}),ao={variables:Gi,WorkerWrapper:Xi,gdalProxy:Ft};function Ki(){var J,Y,Me=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return Ji=Ji||(u||Me.useWorker===!1?new Promise(function(ct,Pt){var Ve=X.Module,pt=Ve.onAbort;Ve.onAbort=function(dt){Pt(new Error(dt)),pt&&pt(dt)},Ve.print=function(dt){console.debug("gdal stdout: ".concat(dt))},Ve.printErr=function(dt){console.error("gdal stderr: ".concat(dt))},Ve.preRun=[function(dt){dt=dt.ENV,dt.PROJ_LIB="/usr/share/proj",dt.GDAL_DATA="/usr/share/gdal",dt.DXF_FEATURE_LIMIT_PER_BLOCK="-1",dt.GDAL_NUM_THREADS="0",dt.GDAL_ENABLE_DEPRECATED_DRIVER_GTM="YES",dt.CPL_LOG_ERRORS="ON"}],Ve.onRuntimeInitialized=function(){var dt,ft;X.GDALOpen||((ft=X.Module).ccall("GDALAllRegister",null,[],[]),X.GDALOpen=ft.cwrap("GDALOpen","number",["string"]),X.GDALOpenEx=ft.cwrap("GDALOpenEx","number",["string","number","number","number","number"]),X.GDALClose=ft.cwrap("GDALClose",null,["number"]),X.CPLErrorReset=ft.cwrap("CPLErrorReset",null,[]),X.CPLSetErrorHandler=ft.cwrap("CPLSetErrorHandler","number",["number"]),X.CPLQuietErrorHandler=ft.cwrap("CPLQuietErrorHandler",null,["number","number","string"]),X.CPLGetLastErrorNo=ft.cwrap("CPLGetLastErrorNo","number",[]),X.CPLGetLastErrorMsg=ft.cwrap("CPLGetLastErrorMsg","string",[]),X.CPLGetLastErrorType=ft.cwrap("CPLGetLastErrorType","number",[]),X.CPLSetConfigOption=ft.cwrap("CPLSetConfigOption",null,["string","string"]),X.CPLSetThreadLocalConfigOption=ft.cwrap("CPLSetThreadLocalConfigOption",null,["string","string"]),X.GDALGetRasterCount=ft.cwrap("GDALGetRasterCount","number",["number"]),X.GDALGetRasterXSize=ft.cwrap("GDALGetRasterXSize","number",["number"]),X.GDALGetRasterYSize=ft.cwrap("GDALGetRasterYSize","number",["number"]),X.GDALGetProjectionRef=ft.cwrap("GDALGetProjectionRef","string",["number"]),X.GDALGetGeoTransform=ft.cwrap("GDALGetGeoTransform","number",["number","number"]),X.GDALVectorTranslate=ft.cwrap("GDALVectorTranslate","number",["string","number","number","number","number","number"]),X.GDALVectorTranslateOptionsNew=ft.cwrap("GDALVectorTranslateOptionsNew","number",["number","number"]),X.GDALVectorTranslateOptionsFree=ft.cwrap("GDALVectorTranslateOptionsFree","number",["number"]),X.GDALDatasetGetLayerCount=ft.cwrap("GDALDatasetGetLayerCount","number",["number"]),X.GDALDatasetGetLayer=ft.cwrap("GDALDatasetGetLayer","number",["number","number"]),X.OGR_DS_GetLayerCount=ft.cwrap("OGR_DS_GetLayerCount","number",["number"]),X.OGR_DS_GetName=ft.cwrap("OGR_DS_GetName","string",["number"]),X.OGR_DS_GetLayer=ft.cwrap("OGR_DS_GetLayer","number",["number","number"]),X.OGR_L_GetName=ft.cwrap("OGR_L_GetName","string",["number"]),X.OGR_DS_GetDriver=ft.cwrap("OGR_DS_GetDriver","number",["number"]),X.OGR_Dr_GetName=ft.cwrap("OGR_Dr_GetName","string",["number"]),X.GDALGetDatasetDriver=ft.cwrap("GDALGetDatasetDriver","number",["number"]),X.GDALGetDriverLongName=ft.cwrap("GDALGetDriverLongName","string",["number"]),X.GDALGetDriverShortName=ft.cwrap("GDALGetDriverShortName","string",["number"]),X.GDALTranslate=ft.cwrap("GDALTranslate","number",["string","number","number","number"]),X.GDALTranslateOptionsNew=ft.cwrap("GDALTranslateOptionsNew","number",["number","number"]),X.GDALTranslateOptionsFree=ft.cwrap("GDALTranslateOptionsFree","number",["number"]),X.GDALRasterize=ft.cwrap("GDALRasterize","number",["string","number","number","number","number"]),X.GDALRasterizeOptionsNew=ft.cwrap("GDALRasterizeOptionsNew","number",["number","number"]),X.GDALRasterizeOptionsFree=ft.cwrap("GDALRasterizeOptionsFree","number",["number"]),X.GDALWarp=ft.cwrap("GDALWarp","number",["string","number","number","number","number","number"]),X.GDALWarpAppOptionsNew=ft.cwrap("GDALWarpAppOptionsNew","number",["number","number"]),X.GDALWarpAppOptionsSetProgress=ft.cwrap("GDALWarpAppOptionsSetProgress","number",["number","number","number"]),X.GDALWarpAppOptionsFree=ft.cwrap("GDALWarpAppOptionsFree","number",["number"]),X.OSRNewSpatialReference=ft.cwrap("OSRNewSpatialReference","number",["string"]),X.OSRDestroySpatialReference=ft.cwrap("OSRDestroySpatialReference","number",["number"]),X.OCTNewCoordinateTransformation=ft.cwrap("OCTNewCoordinateTransformation","number",["number","number"]),X.OCTDestroyCoordinateTransformation=ft.cwrap("OCTDestroyCoordinateTransformation","number",["number"]),X.OCTTransform=ft.cwrap("OCTTransform","number",["number","number","number","number","number"]),X.GDALGetDriverCount=ft.cwrap("GDALGetDriverCount","number",[]),X.OGRGetDriverCount=ft.cwrap("OGRGetDriverCount","number",[]),X.GDALGetDriver=ft.cwrap("GDALGetDriver","number",["number"]),X.OGRGetDriver=ft.cwrap("OGRGetDriver","number",["number"]),X.GDALGetMetadataItem=ft.cwrap("GDALGetMetadataItem","string",["number","string","string"]),X.GDALGetDescription=ft.cwrap("GDALGetDescription","string",["number"]),X.OGR_L_GetFeatureCount=ft.cwrap("OGR_L_GetFeatureCount","number",["number","number"]),X.GDALGenImgProjTransform=ft.cwrap("GDALGenImgProjTransform","number",["number","number","number","number","number","number","number"]),X.GDALCreateGenImgProjTransformer2=ft.cwrap("GDALCreateGenImgProjTransformer2","number",["number","number","number"]),X.GDALDestroyGenImgProjTransformer=ft.cwrap("GDALDestroyGenImgProjTransformer",null,["number"]),X.OSRSetFromUserInput=ft.cwrap("OSRSetFromUserInput","number",["number","string"])),Ve.FS.mkdir(ue),Ve.FS.mkdir(Re),Me.dest&&(ft=Me.dest,ze=ft,dt=Me.dest,u&&X.Module.FS.mount(X.Module.NODEFS,{root:dt},Re)),et()},Ve.locateFile=function(Rr){var ft=Rr,Rr=(Me.paths&&Me.paths.wasm&&Rr.split(".").pop()==="wasm"?ft=Me.paths.wasm:Me.paths&&Me.paths.data&&Rr.split(".").pop()==="data"&&(ft=Me.paths.data),""),Rr=(Me.path?(Rr=Me.path).slice(-1)!=="/"&&(Rr+="/"):u&&(Rr="node_modules/gdal3.js/dist/package/"),Rr+ft);return Rr=u||Rr.substring(0,4)==="http"||Rr[0]==="/"?Rr:"/".concat(Rr)},u&&(Ve.getPreloadedPackage=function(dt){return o.readFileSync("./".concat(dt),{flag:"r"}).buffer}),ce(X.Module).then(function(){ct(gr)})}):(J=Me.paths&&Me.paths.js||"gdal3.js",Y="",Me.path&&(Y=Me.path).slice(-1)!=="/"&&(Y+="/"),new Promise(function(ct){ao.variables.gdalWorkerWrapper=new ao.WorkerWrapper("".concat(Y).concat(J),Me,function(Pt){ao.variables.drivers=Pt,ct(ao.gdalProxy)})})))}return u&&(commonjsGlobal.location={pathname:"./"}),typeof window<"u"&&(window.initGdalJs=Ki),typeof importScripts=="function"&&Jr(Ki),Ki})})(gdal3);var initGdalJs=getDefaultExportFromCjs(gdal3.exports);const paths={wasm:wasmUrl,data:dataUrl,js:workerUrl};let Gdal,ZrangeSeaLevel=32767;const _sfc_main$2={name:"SideNav",setup(){const e=useQuasar();return{alert:ref(!1),isAlphaBrush:ref(!1),blurRadius:ref(0),gridSize:ref(2),access_token:ref(""),isDisabled:ref(!1),isDownload:ref(!0),isWorldPartition:ref(!1),isLandscape:ref(!0),isExportOptions:ref(!0),isBlurRadius:ref(!0),isSendToUnreal:ref(!0),unrealLandscape:ref({label:505,value:505}),landscapeSize:[{label:"8129x8129",value:8129},{label:"6097x6097",value:6097},{label:"4033x4033",value:4033},{label:"3025x3025",value:3025},{label:"2017x2017",value:2017},{label:"1513x1513",value:1513},{label:"1009x1009",value:1009},{label:"512x512 -- Native Resolution",value:512},{label:"505x505",value:505}],url:ref("thirtytwo-9-82-180.png"),tile_info:ref(""),save_fileName:ref(""),dirHandle:ref(""),preview_image_info:ref(""),rgb_image:ref(""),img_min:ref(""),img_max:ref(""),map:null,data:null,bbinfoalert:ref(!1),exportType:ref({label:"Unreal Heightmap",value:"Unreal Heightmap"}),landscapeName:ref(""),alphaBrushName:ref(""),alphaBrushHeight:ref(505),alphaBrushWidth:ref(505),unrealMapPath:ref(""),qt:e,exportOptionsModel:ref(["zrange","combine_features"]),alertMsg:ref(""),exportOptions:[{label:"Zrange-sea level=0",value:"zrange"},{label:"Flip X",value:"flipx"},{label:"Flip y",value:"flipy"},{label:"Download Satellite",value:"satellite"},{label:"Download Geojson Features",value:"features"},{label:"Combine Unique Features",value:"combine_features"}],exportTyprOptions:[{label:"Unreal Heightmap",value:"Unreal Heightmap"},{label:"Unreal Terrain Magic Plugin -- EarthLandscape Clip",value:"Unreal Terrain Magic Plugin -- EarthLandscape Clip"},{label:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip",value:"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"},{label:"Unreal Stamp Brush Plugin",value:"Unreal Stamp Brush Plugin"},{label:"Unreal Landmass Effect Brush Plugin",value:"Unreal Landmass Effect Brush Plugin",cannotSelect:!1},{label:"None",value:"none"},{label:"Geojson Only",value:"geojson_only"}]}},async mounted(){Gdal=await initGdalJs({paths}),emitter.on("updatePreviewImage",e=>{this.data=e,this.updatePreviewImage()})},methods:{showNotify(e,t,n,o,u){this.qt.notify({message:e,color:t,position:n,icon:o,textColor:u})},copyTileInfoString(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Tile info string copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please select a location on the map first.",this.alert=!0)},copyExtents(){this.tile_info?navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){let t=this.tile_info.bboxW+","+this.tile_info.bboxS+","+this.tile_info.bboxE+","+this.tile_info.bboxN;navigator.clipboard.writeText(t).then(()=>{this.showNotify("Bounding box coordinates copied   "+t,"info","top","announcement","white")},()=>{})}}):(this.alertMsg="Please select a location on the map first.",this.alert=!0)},landscapeSizeChange(){this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale()},adjustedZscale(){let e=this.getUnrealZScale(this.preview_image_info.maxElevation,this.preview_image_info.minElevation),t=this.getUnrealXYScale();return this.tile_info.xyscale=t.toFixed(3),this.exportOptionsModel.includes("zrange")?(this.tile_info.startZRange=ZrangeSeaLevel,this.tile_info.zscale=e.toFixed(3)):(this.tile_info.startZRange=0,this.tile_info.zscale=e.toFixed(3)),this.tile_info.zscale},exportOptionsModelChange(e){this.exportOptionsModel=e,this.tile_info.resolution=this.unrealLandscape.value,this.adjustedZscale()},exportType_Change(e){this.exportType.label==="Unreal Heightmap"||this.exportType.label==="None"||this.exportType.label==="Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"?(this.isDownload=!0,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!0,this.isExportOptions=!0,this.isBlurRadius=!0):this.exportType.label==="Unreal Stamp Brush Plugin"||this.exportType.label==="Unreal Landmass Effect Brush Plugin"?(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!0,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!0):this.exportType.label==="Geojson Only"?(this.isDownload=!0,this.isSendToUnreal=!1,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1):this.exportType.label==="Unreal Terrain Magic Plugin -- EarthLandscape Clip"&&(this.isDownload=!1,this.isSendToUnreal=!0,this.isAlphaBrush=!1,this.isLandscape=!1,this.isExportOptions=!1,this.isBlurRadius=!1)},showBBInfo(){this.tile_info?this.bbinfoalert=!0:(this.bbinfoalert=!1,this.alertMsg="Please select a location on the map first.",this.alert=!0)},updateStats(){this.preview_image_info.maxElevation!==""?(this.tile_info.MaxElevation=this.preview_image_info.maxElevation,this.tile_info.MinElevation=this.preview_image_info.minElevation,this.tile_info.minmax=this.tile_info.MinElevation.toFixed(3)+" / "+this.tile_info.MaxElevation.toFixed(3),this.tile_info.elevation_range=(this.tile_info.MaxElevation-this.tile_info.MinElevation).toFixed(3),this.tile_info.zscale=this.adjustedZscale()):this.tile_info.minmax=""},getUnrealZScale(e,t){let n,o;return this.exportOptionsModel.includes("zrange")?n=e*100:(t<0&&(t=0),n=(e-t)*100),o=n*.001953125,o},getUnrealXYScale(){return this.tile_info.distance*1e3/this.unrealLandscape.value*100},async updatePreviewImage(){this.preview_image_info=await this.data.preview_image_info,this.tile_info=this.data.tile_info,this.map=this.data.map;let e=await this.preview_image_info.image.toBlob();const t=URL.createObjectURL(e);this.url=t,this.updateStats(this.tile_info)},async saveImage(e,t,n){let o=await idbKeyval.get("dirHandle"),u=new Blob([e],{type:"image/"+n});await fileUtils.writeFileToDisk(o,t,u)},async processGdal(e,t,n,o,u){let f=new Blob([new Uint8Array(e)],{type:"image/png"});const g=new File([f],t),b=(await Gdal.open(g)).datasets[0],T=await Gdal.gdal_translate(b,n),C=await Gdal.getFileBytes(T);u==="createHeightmap"&&await this.saveImage(C,t,o),Gdal.close(b)},async sendToUnreal(){let e="http://localhost:30010/",t="remote/object/call",n={},o,u,f,g="Mapbox_BP",a,b,T,C;if(this.tile_info)if(n={objectPath:"/Script/UnrealEd.Default__EditorActorSubsystem",functionName:"GetAllLevelActors"},o=await mapUtils.unrealRemoteControl(n,e+t),o.error)o.error.message==="Failed to fetch"?this.alertMsg="Cannot connect to Unreal server. Please make sure your project is open and Mapbox_BP is in the scene.  Also make sure you launched the Map using the Select Map button as this starts the Unreal Web Server":this.alertMsg=o.error.message,this.alert=!0;else{let L=await o.response.json();for(let N of L.ReturnValue)if(u=N.includes(g),u===!0){f=N;break}else f=null;if(f){this.exportType.label!=="Unreal Terrain Magic Plugin -- EarthLandscape Clip"?await this.createSixteenHeightMap():this.tile_info.resolution="505",this.exportType.label==="Unreal Stamp Brush Plugin"&&(a="/Game/Brushes/CustomBrushes/",b="/Game/Brushes/PEAKS/Peak_10_brush.Peak_10_brush",T="Textures/",C="HeightMap"),this.exportType.label==="Unreal Landmass Effect Brush Plugin"&&(a="/Game/Editor/Landscape/LandmassEffectBrush/CustomBrushes/",b="/Game/Editor/Landscape/LandmassEffectBrush/Effects/Variants/Map/HeightMapEffect.HeightMapEffect",T="Textures/",C="Heightmap (Greyscale / White is High)"),this.unrealMapPath=await idbKeyval.get("mappath"),this.tile_info.landscapeName=this.landscapeName;let N=this.tile_info.x+","+this.tile_info.y+","+this.tile_info.z,F;this.isWorldPartition===!0?F=this.gridSize:F=0,n={objectPath:f,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:this.tile_info.landscapeName,LandscapeSize:this.tile_info.resolution.toString(),TileHeightmapFileName:this.tile_info.sixteenFileName,TileGeojsonFileName:this.tile_info.geoJsonFileName,TileInfoFileName:this.tile_info.tileInfoFileName,MapMiddleLngX:this.tile_info.center.lng,MapMiddleLatY:this.tile_info.center.lat,MapBtmRLng:this.tile_info.bottomRight.lng,MapBtmLLng:this.tile_info.bottomLeft.lng,MapTopLLat:this.tile_info.topLeft.lat,MapBtmLLat:this.tile_info.bottomLeft.lat,RunFunction:this.exportType.label,SlippyMapTileString:N.trim(),HeightMapTexturesPath:"/Game/ImportedHeightMaps/",AlphaBrushName:this.tile_info.alphaBrushFileName,AlphaBrushDestinationPath:a,AlphaBrushTemplatePath:b,AlphaBrushTexturesPath:T,HeightmapProperty:C,WorldPartitionGridSize:F.toString()}},o=await mapUtils.unrealRemoteControl(n,e+t),o.error?(console.log(o.error),this.alertMsg=o.error.message,this.alert=!0):console.log(await o.response.json())}else this.alertMsg="Could not find Mapbox_BP in scene",this.alert=!0}else this.alertMsg="Please select a map location",this.alert=!0;this.qt.loading.hide()},async unrealTileFeatures(e){let t=mapUtils.getFeaturesFromBB(this.map,this.tile_info,e),n=JSON.stringify(t),o=JSON.stringify(this.tile_info);await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.geoJsonFileName,n),await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.tileInfoFileName,o)},async createSixteenHeightMap(){if(this.tile_info){let e,t;this.tile_info.resolution=this.unrealLandscape.value,mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken,this.tile_info.geoJsonFileName="geojson-"+this.tile_info.mapboxTileName+".json",this.tile_info.tileInfoFileName="tile-info-"+this.tile_info.mapboxTileName+".json",this.tile_info.sixteenFileName="sixteen-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".png";let n=await idbKeyval.get("mapbox_satellite_endpoint");if(this.tile_info.mapbox_satellite_image_url=n+`/${this.tile_info.z}/${this.tile_info.x}/${this.tile_info.y}@2x?access_token=`+this.access_token,this.tile_info.satelliteFileName="satellite-"+this.tile_info.mapboxTileName+"-LandscapeSize-"+this.tile_info.resolution+".jpg",this.qt.loading.show(),this.dirHandle=await idbKeyval.get("dirHandle"),await fileUtils.verifyPermission(this.dirHandle,!0)===!1){console.error(`User did not grant permission to '${this.dirHandle.name}'`);return}if(fileUtils.fileExists(this.dirHandle,this.tile_info.thirtytwoFile)){let u=await idbKeyval.get("rgb_image_buffer"),f=await mapUtils.loadImageFromArray(u),g=mapUtils.createHeightMapImage(f,16,"GREY"),a=g.image;if(this.exportOptionsModel.includes("flipy")&&(a=await a.flipY()),this.exportOptionsModel.includes("flipx")&&(a=await a.flipX()),this.blurRadius>=1&&(a=a.blurFilter({radius:this.blurRadius})),t=await a.toBuffer(),this.img_min=parseInt(g.minElevation).toString(),this.img_max=parseInt(g.maxElevation).toString(),this.tile_info.resampleSize=this.unrealLandscape.value.toString(),this.tile_info.resizeMethod="lanczos",this.tile_info.exportTypeLabel=this.exportType.label,this.tile_info.alphaBrushFileName="alphabrush-"+this.tile_info.mapboxTileName+"-height-"+this.alphaBrushHeight+"-width-"+this.alphaBrushWidth,this.exportOptionsModel.includes("features")){let b=!1;this.exportOptionsModel.includes("combine_features")&&(b=!0),await this.unrealTileFeatures(b)}switch(this.tile_info.exportTypeLabel){case"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip":if(e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")){e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod];let b=await mapUtils.downloadTerrainRgb(this.tile_info.mapbox_satellite_image_url);await this.processGdal(b,this.tile_info.satelliteFileName,e,"jpg","createHeightmap")}this.qt.loading.hide();break;case"Unreal Heightmap":if(this.tile_info.resampleSize!=512){if(e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod.toString()],await this.processGdal(t,this.tile_info.sixteenFileName,e,"png","createHeightmap"),this.exportOptionsModel.includes("satellite")){e=["-of","JPEG","-outsize",this.tile_info.resampleSize,this.tile_info.resampleSize,"-r",this.tile_info.resizeMethod];let b=await mapUtils.downloadTerrainRgb(this.tile_info.mapbox_satellite_image_url);await this.processGdal(b,this.tile_info.satelliteFileName,e,"jpg","createHeightmap")}}else if(await this.saveImage(t,this.tile_info.sixteenFileName,"png"),this.exportOptionsModel.includes("satellite")){let b=await mapUtils.downloadTerrainRgb(this.tile_info.mapbox_satellite_image_url);await this.saveImage(b,this.tile_info.satelliteFileName,"png")}this.qt.loading.hide();break;case"Geojson Only":await this.unrealTileFeatures(!0),this.qt.loading.hide();break;case"Unreal Stamp Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"Unreal Landmass Effect Brush Plugin":this.alphaBrushName.length>0&&(this.tile_info.alphaBrushFileName=this.alphaBrushName),e=["-ot","UInt16","-of","PNG","-scale",this.img_min,this.img_max,this.tile_info.startZRange.toString(),this.tile_info.maxPngValue.toString(),"-outsize",this.alphaBrushHeight.toString(),this.alphaBrushWidth.toString(),"-r",this.tile_info.resizeMethod],await this.processGdal(t,this.tile_info.alphaBrushFileName+".png",e,"png","createHeightmap"),this.qt.loading.hide();break;case"None":await fileUtils.writeFileToDisk(this.dirHandle,this.tile_info.sixteenFileName,a.toBuffer()),this.qt.loading.hide();break}}else this.alertMsg="Please select a location on the map first.",this.alert=!0}else this.alertMsg="Please select a location on the map first.",this.alert=!0}}},_hoisted_1$2=createBaseVNode("div",{id:"previewTitle",class:"text-h6 bg-primary text-white"},"Preview Image",-1),_hoisted_2$2={class:"row justify-start q-pa-none q-mb-md"},_hoisted_3$2={style:{width:"100%"}},_hoisted_4$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_5$2={class:"text-weight-bold q-pt-sm self-center full-width no-outline",tabindex:"0"},_hoisted_6$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Type:")],-1),_hoisted_7$2=createBaseVNode("b",null,[createBaseVNode("u",null,"Export Options:")],-1),_hoisted_8$1=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Coordinates for Unreal LandscapeGen Plugin")],-1),_hoisted_9$1=createBaseVNode("div",{class:"text-h6"},"Zoom:",-1),_hoisted_10$1=createBaseVNode("div",{class:"text-h6"},"Mouse Point Lat/Lng:",-1),_hoisted_11$1=createBaseVNode("div",{class:"text-h6"},[createBaseVNode("u",null,"Bounding Box Corners Lat/Lng:")],-1),_hoisted_12$1=createBaseVNode("div",{class:"text-h6"},"Top Left:",-1),_hoisted_13=createBaseVNode("div",{class:"text-h6"},"Bottom Left:",-1),_hoisted_14=createBaseVNode("div",{class:"text-h6"},"Top Right:",-1),_hoisted_15=createBaseVNode("div",{class:"text-h6"},"Bottom Right:",-1),_hoisted_16=createBaseVNode("div",{class:"text-h6"},"Lng/Lat Max/Min:",-1),_hoisted_17=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render$2(e,t,n,o,u,f){return openBlock(),createElementBlock(Fragment,null,[_hoisted_1$2,createVNode(QImg,{src:o.url,height:"150px"},null,8,["src"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(QField,{dense:"",class:"text-weight-bolder q-pt-none q-mt-xs",label:"Min/Max Elevation","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_4$2,toDisplayString(this.tile_info.minmax),1)]),_:1}),createVNode(QField,{class:"q-pt-none q-mt-xs",dense:"",label:"Unreal X,Y and Z-Scale",hint:"Input into Unreal Landscape Z scale","stack-label":""},{control:withCtx(()=>[createBaseVNode("div",_hoisted_5$2,toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.xyscale)+", "+toDisplayString(this.tile_info.zscale),1)]),_:1}),createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_6$2]),_:1}),createVNode(QSelect,{class:"q-mt-none q-pt-none","bg-color":"blue-2",outlined:"",filled:"",dense:"",modelValue:o.exportType,"onUpdate:modelValue":[t[0]||(t[0]=g=>o.exportType=g),f.exportType_Change],options:o.exportTyprOptions,"option-disable":"cannotSelect"},null,8,["modelValue","options","option-disable","onUpdate:modelValue"]),withDirectives(createVNode(QItemLabel,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[_hoisted_7$2]),_:1},512),[[vShow,o.isExportOptions]]),withDirectives(createVNode(QOptionGroup,{class:"q-mt-none q-pt-none",dense:"",inline:"",options:o.exportOptions,"onUpdate:modelValue":[f.exportOptionsModelChange,t[1]||(t[1]=g=>o.exportOptionsModel=g)],type:"checkbox",modelValue:o.exportOptionsModel},null,8,["options","onUpdate:modelValue","modelValue"]),[[vShow,o.isExportOptions]]),withDirectives(createVNode(QSelect,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Size","transition-show":"scale","transition-hide":"scale",hint:"Unreal Recommended Sizes",outlined:"",modelValue:o.unrealLandscape,"onUpdate:modelValue":[t[2]||(t[2]=g=>o.unrealLandscape=g),f.landscapeSizeChange],options:o.landscapeSize},null,8,["modelValue","options","onUpdate:modelValue"]),[[vShow,o.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs"},{default:withCtx(()=>[createVNode(QCheckbox,{modelValue:o.isWorldPartition,"onUpdate:modelValue":t[3]||(t[3]=g=>o.isWorldPartition=g),label:"Enable World Partition"},null,8,["modelValue"])]),_:1},512),[[vShow,o.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"World Partition Grid Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:o.gridSize,"onUpdate:modelValue":t[4]||(t[4]=g=>o.gridSize=g)},null,8,["modelValue"])]),_:1},512),[[vShow,o.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Brush Size"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:o.alphaBrushHeight,"onUpdate:modelValue":t[5]||(t[5]=g=>o.alphaBrushHeight=g),label:"Height"},null,8,["modelValue"]),createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",filled:"",modelValue:o.alphaBrushWidth,"onUpdate:modelValue":t[6]||(t[6]=g=>o.alphaBrushWidth=g),label:"Width"},null,8,["modelValue"]),createVNode(QInput,{ref:"alphaBrushNameRef",dense:"",modelValue:o.alphaBrushName,"onUpdate:modelValue":t[7]||(t[7]=g=>o.alphaBrushName=g),label:"Brush Name"},null,8,["modelValue"])]),_:1},512),[[vShow,o.isAlphaBrush]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Landscape Name (Optional)",hint:"Enter Unique Landscape Name"},{default:withCtx(()=>[createVNode(QInput,{dense:"",modelValue:o.landscapeName,"onUpdate:modelValue":t[8]||(t[8]=g=>o.landscapeName=g)},null,8,["modelValue"])]),_:1},512),[[vShow,o.isLandscape]]),withDirectives(createVNode(QField,{dense:"",class:"q-pt-none q-mt-xs",label:"Blur Radius"},{default:withCtx(()=>[createVNode(QInput,{dense:"",class:"q-pt-none q-mt-xs",modelValue:o.blurRadius,"onUpdate:modelValue":t[9]||(t[9]=g=>o.blurRadius=g)},null,8,["modelValue"])]),_:1},512),[[vShow,o.isBlurRadius]])])]),withDirectives(createVNode(QBtn,{onClick:f.createSixteenHeightMap,ref:"btnDownload",dense:"",color:"primary","no-caps":"",label:"Download HeightMap"},null,8,["onClick"]),[[vShow,o.isDownload]]),withDirectives(createVNode(QBtn,{onClick:f.sendToUnreal,disabled:o.isDisabled,dense:"",color:"green",class:"q-ml-xs","no-caps":"",label:"Send To Unreal"},null,8,["onClick","disabled"]),[[vShow,o.isSendToUnreal]]),createVNode(QBtn,{onClick:f.copyExtents,disabled:o.isDisabled,dense:"",color:"purple",class:"q-ml-xs","no-caps":"",label:"Copy Bounds for Blender Osm"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:f.copyTileInfoString,disabled:o.isDisabled,dense:"",color:"cyan",class:"q-ml-xs","no-caps":"",label:"Copy Slippy Tile Info String"},null,8,["onClick","disabled"]),createVNode(QBtn,{onClick:f.showBBInfo,dense:"",color:"orange","no-caps":"",label:"Show Bounding Box Info"},null,8,["onClick"]),createVNode(QDialog,{modelValue:o.bbinfoalert,"onUpdate:modelValue":t[10]||(t[10]=g=>o.bbinfoalert=g)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_8$1]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[_hoisted_9$1,createTextVNode(" "+toDisplayString(o.tile_info.z)+" ",1),_hoisted_10$1,createTextVNode(" Lat: "+toDisplayString(o.tile_info.pointLat)+" Lng: "+toDisplayString(o.tile_info.pointLng)+" ",1),_hoisted_11$1,_hoisted_12$1,createTextVNode(" Lat: "+toDisplayString(o.tile_info.topLeft.lat)+" Lng: "+toDisplayString(o.tile_info.topLeft.lng)+" ",1),_hoisted_13,createTextVNode(" Lat: "+toDisplayString(o.tile_info.bottomLeft.lat)+" Lng: "+toDisplayString(o.tile_info.bottomLeft.lng)+" ",1),_hoisted_14,createTextVNode(" Lat: "+toDisplayString(o.tile_info.topRight.lat)+" Lng: "+toDisplayString(o.tile_info.topRight.lng)+" ",1),_hoisted_15,createTextVNode(" Lat: "+toDisplayString(o.tile_info.bottomRight.lat)+" Lng: "+toDisplayString(o.tile_info.bottomRight.lng)+" ",1),_hoisted_16,createTextVNode(" Lng/Lat-Min: "+toDisplayString(o.tile_info.bboxW)+" , "+toDisplayString(o.tile_info.bboxS)+" Lng/Lat-Max: "+toDisplayString(o.tile_info.bboxE)+" , "+toDisplayString(o.tile_info.bboxN),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(QDialog,{modelValue:o.alert,"onUpdate:modelValue":t[11]||(t[11]=g=>o.alert=g)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_17]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var SideNav=_export_sfc(_sfc_main$2,[["render",_sfc_render$2]]);const _sfc_main$1={props:{},emits:["ok","hide"],methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){this.$emit("ok"),this.hide()},onCancelClick(){this.hide()}}},_hoisted_1$1=createBaseVNode("div",null,[createBaseVNode("b",null,"Help")],-1),_hoisted_2$1=createBaseVNode("br",null,null,-1),_hoisted_3$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Settings Page:")],-1),_hoisted_4$1=createBaseVNode("ol",null,[createBaseVNode("li",null,[createTextVNode(" You need to create a free Mapbox account and enter your mapbox access token. Goto "),createBaseVNode("a",{href:"https://www.mapbox.com",target:"_blank"},"Mapbox"),createTextVNode(" then goto your account page. There you can copy your access token. ")]),createBaseVNode("li",null," Select a download folder. This is a folder on your local pc where your heightmap files will be saved. ")],-1),_hoisted_5$1=createBaseVNode("div",{class:"q-mt-sm"},[createBaseVNode("b",null,"Map Page:")],-1),_hoisted_6$1=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Map Settings"),createTextVNode(" -- Enable different layers for viewing. This does not affect downloaded data ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Search Bar"),createTextVNode(" -- Enter the name of a location or Longitude Latitude seperated by a comma. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Top Bar"),createTextVNode(" -- Area in KM show the area of the blue bounding box in Kilometers. Slippy Tile Info String is a standard format identification for downloading map tiles. Format is X,Y,Z Z = zoom level. ")])],-1),_hoisted_7$1=createBaseVNode("div",{class:""},[createBaseVNode("b",null,"Map Navigation:")],-1),_hoisted_8=createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Click"),createTextVNode(" -- Selects a location on the map indicated by a blue bounding box. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Left Mouse Hold"),createTextVNode(" -- Drag the mouse around to move the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Right Mouse Hold"),createTextVNode(" -- Tilt and Rotate the map. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Scroll Wheel"),createTextVNode(" -- Zoom in and out. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Arrow Keys"),createTextVNode(" -- Move around the map. ")])],-1),_hoisted_9=createBaseVNode("div",{class:"q-mb-md"},[createBaseVNode("b",null,"Left Side Bar:")],-1),_hoisted_10=createBaseVNode("div",{class:"q-ml-md"},[createBaseVNode("div",null,[createBaseVNode("u",null,"Export Type:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Heightmap"),createTextVNode(" -- Generates a 16-bit png heightmap file. Can be used in other applications besides Unreal. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- EarthLandscape Clip"),createTextVNode(" -- Sends tile info string x,y and zoom to Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added it to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Terrain Magic Plugin -- HeightmapLandscape Clip"),createTextVNode(" -- Downloads heightmap from this app and loads it into Terrain Magic. You will need to install the custom version of Terrain Magic from this link "),createBaseVNode("a",{href:"https://github.com/delebash/unreal-terrain-magic/releases",target:"_blank"},"Custom Version Of Terrain Magic"),createTextVNode(". Terrain magic has it's own map to import heightmaps for Unreal but I just added to mine for ease of use. This just makes it a one click solution instead of copy and paste. If you like Terrain Magic please purchase it from the marketplace link in description. Original source for non-commercial "),createBaseVNode("a",{href:"https://github.com/GDi4K/unreal-terrain-magic",target:"_blank"},"Terrain Magic")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Stamp Brush Plugin"),createTextVNode(" -- You need to install paid plugin "),createBaseVNode("a",{href:"https://www.unrealengine.com/marketplace/en-US/product/landscape-stamping-tool-100-custom-brushes?sessionInvalidated=true"},"Landscape Stamping Tool - 100+ Custom Brushes"),createTextVNode(". This automates the creation of new stamps from selected map location. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Unreal Landmass Effect Brush Plugin"),createTextVNode(" -- Open source plugin for creating non-destructive landmass stamps and other features. Download the source from here "),createBaseVNode("a",{href:"https://github.com/AWeinb/SimplerLandmassBlueprints"},"SimplerLandmassBlueprints"),createTextVNode(". From the Content folder copy the whole Editor folder to your Content directory. Each time you click Send To Unreal it will import the texture to a sub folder CustomBrushes > Textures. For now it only imports the texture you have to manually add the texture to the brush according to the github instructions. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"None"),createTextVNode(" -- Generate 16-bit png heightmap but do not do any other transformations to the image. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Geojson Only"),createTextVNode(" -- Do not download a heightmap png file. Just download a Geojson file. ")])])]),createBaseVNode("div",null,[createBaseVNode("u",null,"Export Options:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Zrange-sea level="),createTextVNode(" -- By checking this the imported heightmap will keep the landscape height near 100 Unreal Units. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"FlipX/FlipY"),createTextVNode(" -- Flips the sides of the heightmap image in the X or Y direction. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Satellite"),createTextVNode(" -- Downloads a Satellite Image of the selected area. This can be used as on overlay in UE. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Download Geojson Features"),createTextVNode(" -- Downloads the features of the selected area in geojson format. Search Mapbox for geosjon. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Combine Unique Features"),createTextVNode(" -- Removes overlapping features when downloading geojson ")])])])],-1),_hoisted_11=createBaseVNode("div",null,[createBaseVNode("u",null,"Landscape:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Size"),createTextVNode(" -- Resamples the size of the image to recommended Unreal Landscape sizes. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Enable World Partition"),createTextVNode(" -- If you have a World Partition project and want a World Partition landscape with proxies, enable this.. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"World Partition Grid Size"),createTextVNode(" -- Grid size setting. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Landscape Name"),createTextVNode(" -- Name of the landscape to be imported. (Optional ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Blur Radius"),createTextVNode(" -- Adds a gaussian blur to the heightmap png. This can help smooth out your imported landscape if it has some sharp edges. The greater the number the greater the blur. 0 = no blur. ")])])],-1),_hoisted_12=createBaseVNode("div",null,[createBaseVNode("u",null,"Buttons:"),createBaseVNode("ul",null,[createBaseVNode("li",null,[createBaseVNode("u",null,"Download Heightmap"),createTextVNode(" -- Downloads the heightmap png to the folder location on the settings page. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Send To Unreal"),createTextVNode(" -- Automatically imports heightmap or stamp into your Unreal project. Required -- Mapbox_BP has to be installed in to your unreal project and configured. You can download the free plugin here "),createBaseVNode("a",{href:"https://github.com/delebash/UnrealMapboxBridgePlugin"},"Unreal Mapbox Bridge Plugin"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Bounds for Blender OSM"),createTextVNode(" -- A plugin for blend that downloads real world map info into blender. It has it's own map but you can use this one as well since it has a search by name feature. Download "),createBaseVNode("a",{href:"https://github.com/vvoovv/blender-osm"},"Blender OSM"),createTextVNode(". ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Copy Slippy Tile Info String"),createTextVNode(" -- This format is used in many other GIS applications to download map tile information. This is just a convenience function. This is also the same string Terrain Magic expects. ")]),createBaseVNode("li",null,[createBaseVNode("u",null,"Show Bounding Box Info"),createTextVNode(" -- General info such as Long/Lat info for bounding box. ")])])],-1);function _sfc_render$1(e,t,n,o,u,f){return openBlock(),createBlock(QDialog,{class:"dialog-plugin",ref:"dialog",onHide:f.onDialogHide},{default:withCtx(()=>[createVNode(QCard,{style:{width:"900px","max-width":"80vw",height:"700px"}},{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_1$1,_hoisted_2$1,createVNode(QSeparator),_hoisted_3$1,_hoisted_4$1,_hoisted_5$1,_hoisted_6$1,_hoisted_7$1,_hoisted_8,_hoisted_9,_hoisted_10,_hoisted_11,_hoisted_12,createVNode(QCardActions,{class:"absolute-top",align:"right"},{default:withCtx(()=>[createVNode(QBtn,{color:"primary",label:"Close",onClick:f.onOKClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"])}var Help=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]);const _sfc_main={setup(){const e=useQuasar();return{showDialog(){e.dialog({component:Help,componentProps:{text:""}}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},data_path:"",selectedTab:ref("map"),alert:ref(!1),alertMsg:ref(""),dirHandle:ref(""),dirName:ref(""),style_url:ref(""),access_token:ref(""),mapbox_api_url:ref(""),mapbox_raster_png_dem:ref(""),mapbox_satellite_endpoint:ref(""),isPwd:ref(!0),drawerLeft:ref(!1),createFolder:ref(!1)}},mounted:async function(){this.checkFileApiSupport(),await this.loadUserData(),this.isRequiredSettings()===!0&&await this.loadMap()},methods:{checkFileApiSupport(){fileUtils.checkFileApiSupport()===!1&&(this.alertMsg="This browser does not support File System Access API.  Try Edge or Chrome.",this.alert=!0)},resizeMap(){this.$refs.mapBoxViewer.resizeMap()},changeDrawer(){this.drawerLeft=!this.drawerLeft},async loadMap(){this.selectedTab="map",await this.$nextTick(()=>{this.$refs.mapBoxViewer.loadMapboxMap()})},isRequiredSettings(){return this.access_token&&this.style_url&&this.dirName?!0:(this.redirectToSettings(),!1)},redirectToSettings(){this.selectedTab="settings",Notify.create({color:"negative",textColor:"white",icon:"report_problem",message:"Please fill out the required fields!",position:"top"})},async openDirectory(){let e;try{e=await fileUtils.getDirHandle()}catch(t){if(t.name==="AbortError")return;console.error("An error occured trying to open the file.",t)}!e||(idbKeyval.set("dirHandle",e),this.dirName=e.name)},saveUserSettings(){idbKeyval.set("access_token",this.access_token),idbKeyval.set("style_url",this.style_url),idbKeyval.set("mapbox_api_url",this.mapbox_api_url),idbKeyval.set("mapbox_satellite_endpoint",this.mapbox_satellite_endpoint),idbKeyval.set("mapbox_raster_png_dem",this.mapbox_raster_png_dem),idbKeyval.set("create_folder",this.createFolder),this.isRequiredSettings()===!0&&this.loadMap()},async loadUserData(){mapboxgl.accessToken=await idbKeyval.get("access_token"),this.access_token=mapboxgl.accessToken||"",this.style_url=await idbKeyval.get("style_url")||"mapbox://styles/mapbox/streets-v11",this.mapbox_api_url=await idbKeyval.get("mapbox_api_url")||"https://api.mapbox.com/v4/",this.mapbox_satellite_endpoint=await idbKeyval.get("mapbox_satellite_endpoint")||"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles",this.mapbox_raster_png_dem=await idbKeyval.get("mapbox_raster_png_dem")||"mapbox.mapbox-terrain-dem-v1";let e=await idbKeyval.get("dirHandle")||"";this.createFolder=await idbKeyval.get("create_folder")||"",this.dirHandle=e,this.dirName=e.name}},components:{MapboxMapViewer,SideNav,Help}},_hoisted_1={class:"row q-pa-xs full-height"},_hoisted_2=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/access-token/",target:"_blank"},"Mapbox access token docs",-1),_hoisted_3=createBaseVNode("a",{href:"https://docs.mapbox.com/help/glossary/style-url/",target:"_blank"},"Mapbox style url docs",-1),_hoisted_4={class:"q-pa-none row items-start"},_hoisted_5={class:"col q-pa-none"},_hoisted_6=createBaseVNode("br",null,null,-1),_hoisted_7=createBaseVNode("div",{class:"text-h6"},"Alert",-1);function _sfc_render(e,t,n,o,u,f){const g=resolveComponent("side-nav"),a=resolveComponent("mapbox-map-viewer");return openBlock(),createBlock(QLayout,{view:"lHr lpr lfr"},{default:withCtx(()=>[createVNode(QHeader,{dense:"",elevated:"",class:"bg-primary text-white","height-hint":"98"}),createVNode(QDrawer,{dense:"","show-if-above":"",modelValue:o.drawerLeft,"onUpdate:modelValue":t[0]||(t[0]=b=>o.drawerLeft=b),side:"left",onHide:f.resizeMap,class:"no-margin no-padding"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(QCard,{class:"col q-pl-xs"},{default:withCtx(()=>[createVNode(g)]),_:1})])]),_:1},8,["modelValue","onHide"]),createVNode(QPageContainer,null,{default:withCtx(()=>[createVNode(QPage,{class:"row no-margin q-pa-sm"},{default:withCtx(()=>[createVNode(QCard,{class:"col"},{default:withCtx(()=>[createVNode(QTabs,{dense:"",modelValue:o.selectedTab,"onUpdate:modelValue":t[2]||(t[2]=b=>o.selectedTab=b),class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:withCtx(()=>[createVNode(QBtn,{dense:"",flat:"",onClick:f.changeDrawer,round:"",icon:"menu"},null,8,["onClick"]),createVNode(QTab,{dense:"",name:"map",label:"Map"}),createVNode(QTab,{dense:"",name:"settings",label:"Settings"}),createVNode(QBtn,{style:{background:"#FF0080",color:"white"},label:"Help",class:"q-mr-lg",onClick:o.showDialog},null,8,["onClick"]),createVNode(QBtn,{dense:"",flat:"",round:"",onClick:t[1]||(t[1]=b=>e.$q.dark.toggle()),icon:e.$q.dark.isActive?"nights_stay":"wb_sunny"},null,8,["icon"])]),_:1},8,["modelValue"]),createVNode(QSeparator),createVNode(QTabPanels,{class:"q-pa-none q-ma-none","keep-alive":"",modelValue:o.selectedTab,"onUpdate:modelValue":t[12]||(t[12]=b=>o.selectedTab=b),animated:""},{default:withCtx(()=>[createVNode(QTabPanel,{name:"map",class:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",style:{width:"100%",height:"calc(100vh - 65px)"}},{default:withCtx(()=>[createVNode(a,{class:"col",ref:"mapBoxViewer"},null,512)]),_:1}),createVNode(QTabPanel,{lass:"row q-pl-xs q-pt-xs q-pb-none q-ma-none",name:"settings"},{default:withCtx(()=>[createTextVNode(" See: "),_hoisted_2,createVNode(QInput,{dense:"",modelValue:o.access_token,"onUpdate:modelValue":t[4]||(t[4]=b=>o.access_token=b),label:"Mapbox Access Token *",filled:"",type:o.isPwd?"password":"text","lazy-rules":"",hint:"You will need your own access token created from your Mapbox accounts page. The Mapbox free plan is a great choice.",rules:[b=>b&&b.length>0||"Please type something"]},{append:withCtx(()=>[createVNode(QIcon,{dense:"",name:o.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[3]||(t[3]=b=>o.isPwd=!o.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),createTextVNode(" See: "),_hoisted_3,createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:o.style_url,"onUpdate:modelValue":t[5]||(t[5]=b=>o.style_url=b),label:"Enter your Mapbox style url *",filled:"","lazy-rules":"",hint:"You can use the default style or you can create your own custom style in Mapbox Studio.",rules:[b=>b&&b.length>0||"Please type something"],type:o.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:o.mapbox_api_url,"onUpdate:modelValue":t[6]||(t[6]=b=>o.mapbox_api_url=b),label:"Mapbox base api url *",filled:"","lazy-rules":"",hint:"",rules:[b=>b&&b.length>0||"Please type something"],type:o.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:o.mapbox_raster_png_dem,"onUpdate:modelValue":t[7]||(t[7]=b=>o.mapbox_raster_png_dem=b),label:"Mapbox Raster Dem Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[b=>b&&b.length>0||"Please type something"],type:o.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createVNode(QInput,{dense:"",class:"q-pb-lg",modelValue:o.mapbox_satellite_endpoint,"onUpdate:modelValue":t[8]||(t[8]=b=>o.mapbox_satellite_endpoint=b),label:"Mapbox Satellite Endpoint *",filled:"","lazy-rules":"",hint:"",rules:[b=>b&&b.length>0||"Please type something"],type:o.isPwd?"":"text"},null,8,["modelValue","rules","type"]),createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createVNode(QInput,{dense:"",class:"q-pb-none",modelValue:o.dirName,"onUpdate:modelValue":t[9]||(t[9]=b=>o.dirName=b),label:"Enter download directory path *",filled:"","lazy-rules":"",rules:[b=>b&&b.length>0||"Please type something"],type:o.isPwd?"":"text"},null,8,["modelValue","rules","type"])]),createVNode(QBtn,{class:"q-pb-none",dense:"",onClick:t[10]||(t[10]=b=>f.openDirectory()),color:"secondary",label:"Select download folder"})]),_hoisted_6,createVNode(QBtn,{class:"q-pt-none",dense:"",onClick:t[11]||(t[11]=b=>f.saveUserSettings()),color:"secondary",label:"Save settings"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),createVNode(QDialog,{modelValue:o.alert,"onUpdate:modelValue":t[13]||(t[13]=b=>o.alert=b)},{default:withCtx(()=>[createVNode(QCard,null,{default:withCtx(()=>[createVNode(QCardSection,null,{default:withCtx(()=>[_hoisted_7]),_:1}),createVNode(QCardSection,{class:"q-pt-none"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.alertMsg),1)]),_:1}),createVNode(QCardActions,{align:"right"},{default:withCtx(()=>[withDirectives(createVNode(QBtn,{flat:"",label:"OK",color:"primary"},null,512),[[ClosePopup]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}var MainLayout=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{MainLayout as default};
